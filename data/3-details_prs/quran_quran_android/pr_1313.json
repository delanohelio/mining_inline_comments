{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAyMDI4MjA4", "number": 1313, "title": "Floating highlights", "bodyText": "Pros:\n\nAbility to animate highlights from one ayah to another.\nIf current playing ayah changes while the animation is in progress, then the current \"in-between\" highlight is morphed to the changed ayah highlight\nIf user has selected ayahs in ayahMode then animation is not shown\n\nCons:\n\nVery inefficient code\nAnimation not scalable to other highlight types should we decide to add animation later to types other than AUDIO. May require quite a lot of refactoring later.\nNeeds thorough review\nLots of TODOs", "createdAt": "2020-04-10T18:59:23Z", "url": "https://github.com/quran/quran_android/pull/1313", "merged": true, "mergeCommit": {"oid": "74ec9095589e202c570933119272c7fddc6025b8"}, "closed": true, "closedAt": "2020-09-18T22:56:25Z", "author": {"login": "murtraja"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcV7bhSgH2gAyNDAyMDI4MjA4OjQwNDNlZWY3Yzk0ZTY1NmJhZWFiNzY4YjQ3OTI0YzRiMzkxYWEwMmM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc_YsiogH2gAyNDAyMDI4MjA4OjM2YjVkNmZjNjAwNzA1NmQ2ZDkzMmNhODMwNGUxYmE4MjA4YzAyMGY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4043eef7c94e656baeab768b47924c4b391aa02c", "author": {"user": null}, "url": "https://github.com/quran/quran_android/commit/4043eef7c94e656baeab768b47924c4b391aa02c", "committedDate": "2020-04-09T12:12:57Z", "message": "overlapping highlights - plan B"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e8b936842e838035b071d527a09c3a008e597642", "author": {"user": null}, "url": "https://github.com/quran/quran_android/commit/e8b936842e838035b071d527a09c3a008e597642", "committedDate": "2020-04-09T19:17:49Z", "message": "demonstrating all ways to animate"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6e48647900f4bef31dc72f98b9867545b1023ffd", "author": {"user": null}, "url": "https://github.com/quran/quran_android/commit/6e48647900f4bef31dc72f98b9867545b1023ffd", "committedDate": "2020-04-09T19:44:24Z", "message": "animating using the division algorithm"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c1a1cea64fea7024f1b4c0ac72e47824c01ab929", "author": {"user": null}, "url": "https://github.com/quran/quran_android/commit/c1a1cea64fea7024f1b4c0ac72e47824c01ab929", "committedDate": "2020-04-10T07:21:41Z", "message": "checking for coordinate data before making a copy"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a57e1d82ce5005f7a906e37a2bd9a5117a61af8e", "author": {"user": null}, "url": "https://github.com/quran/quran_android/commit/a57e1d82ce5005f7a906e37a2bd9a5117a61af8e", "committedDate": "2020-04-10T18:34:48Z", "message": "overlapping animations in ayahMode + animator null crash fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "63dcff2de261ab1097c6a06437483cb819fd61f5", "author": {"user": null}, "url": "https://github.com/quran/quran_android/commit/63dcff2de261ab1097c6a06437483cb819fd61f5", "committedDate": "2020-04-10T18:53:00Z", "message": "removing debugging changes, cleanup, sura -> surah, adding comments + TODOs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyODg5NzM5", "url": "https://github.com/quran/quran_android/pull/1313#pullrequestreview-452889739", "createdAt": "2020-07-21T23:07:49Z", "commit": {"oid": "63dcff2de261ab1097c6a06437483cb819fd61f5"}, "state": "COMMENTED", "comments": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQyMzowNzo1MFrOG1M8VA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQyMzoxNDo0MlrOG1NExw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQzOTc2NA==", "bodyText": "this loop will basically just get the \"last\" one, and that perhaps can change - what are you actually trying to get here then?", "url": "https://github.com/quran/quran_android/pull/1313#discussion_r458439764", "createdAt": "2020-07-21T23:07:50Z", "author": {"login": "ahmedre"}, "path": "app/src/main/java/com/quran/labs/androidquran/widgets/HighlightingImageView.java", "diffHunk": "@@ -130,17 +152,178 @@ public void setNightMode(boolean isNightMode, int textBrightness) {\n     adjustNightMode();\n   }\n \n-  public void highlightAyah(int sura, int ayah, HighlightType type) {\n+  private void highlightFloatableAyah(Set<String> highlights, String currentSurahAyah) {\n+    final Map<String, List<AyahBounds>> coordinatesData = ayahCoordinates.getAyahCoordinates();\n+\n+    String previousSurahAyah = currentSurahAyah;\n+    for(String surahAyahs: highlights) {\n+      previousSurahAyah = surahAyahs;\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "63dcff2de261ab1097c6a06437483cb819fd61f5"}, "originalPosition": 80}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ0MDA3Mw==", "bodyText": "i'd vote for an object - maybe AyahTransition or something that has a from and to instead of manually having an arrow and parsing it like this, since it's more complicated that way", "url": "https://github.com/quran/quran_android/pull/1313#discussion_r458440073", "createdAt": "2020-07-21T23:08:56Z", "author": {"login": "ahmedre"}, "path": "app/src/main/java/com/quran/labs/androidquran/widgets/HighlightingImageView.java", "diffHunk": "@@ -130,17 +152,178 @@ public void setNightMode(boolean isNightMode, int textBrightness) {\n     adjustNightMode();\n   }\n \n-  public void highlightAyah(int sura, int ayah, HighlightType type) {\n+  private void highlightFloatableAyah(Set<String> highlights, String currentSurahAyah) {\n+    final Map<String, List<AyahBounds>> coordinatesData = ayahCoordinates.getAyahCoordinates();\n+\n+    String previousSurahAyah = currentSurahAyah;\n+    for(String surahAyahs: highlights) {\n+      previousSurahAyah = surahAyahs;\n+    }\n+    List<AyahBounds> startingBounds;\n+    int arrowIndex = previousSurahAyah.indexOf(\"->\");\n+    if(arrowIndex != -1) {\n+      // The ayah changed during animating\n+      startingBounds = (List<AyahBounds>)animator.getAnimatedValue();\n+      animator.cancel();\n+      previousSurahAyah = previousSurahAyah.substring(arrowIndex + 2);\n+    } else {\n+      startingBounds = coordinatesData.get(previousSurahAyah);\n+    }\n+\n+    final String ayahTransition = previousSurahAyah+\"->\"+currentSurahAyah;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "63dcff2de261ab1097c6a06437483cb819fd61f5"}, "originalPosition": 92}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ0MDYyNA==", "bodyText": "i'd vote for not because:\n\nthis code doesn't ideally belong in HighlightingImageView\nyou can write a nice unit test for it that way without needing a ui test just to test the behavior (i.e if your standalone class exposes these as functions, and the animation stuff is outside that class)", "url": "https://github.com/quran/quran_android/pull/1313#discussion_r458440624", "createdAt": "2020-07-21T23:10:28Z", "author": {"login": "ahmedre"}, "path": "app/src/main/java/com/quran/labs/androidquran/widgets/HighlightingImageView.java", "diffHunk": "@@ -130,17 +152,178 @@ public void setNightMode(boolean isNightMode, int textBrightness) {\n     adjustNightMode();\n   }\n \n-  public void highlightAyah(int sura, int ayah, HighlightType type) {\n+  private void highlightFloatableAyah(Set<String> highlights, String currentSurahAyah) {\n+    final Map<String, List<AyahBounds>> coordinatesData = ayahCoordinates.getAyahCoordinates();\n+\n+    String previousSurahAyah = currentSurahAyah;\n+    for(String surahAyahs: highlights) {\n+      previousSurahAyah = surahAyahs;\n+    }\n+    List<AyahBounds> startingBounds;\n+    int arrowIndex = previousSurahAyah.indexOf(\"->\");\n+    if(arrowIndex != -1) {\n+      // The ayah changed during animating\n+      startingBounds = (List<AyahBounds>)animator.getAnimatedValue();\n+      animator.cancel();\n+      previousSurahAyah = previousSurahAyah.substring(arrowIndex + 2);\n+    } else {\n+      startingBounds = coordinatesData.get(previousSurahAyah);\n+    }\n+\n+    final String ayahTransition = previousSurahAyah+\"->\"+currentSurahAyah;\n+\n+    // yes we make copies, because normalizing the bounds will change them\n+    List<AyahBounds> previousAyahBoundsList = new ArrayList<>(startingBounds);\n+    List<AyahBounds> currentAyahBoundsList = new ArrayList<>(coordinatesData.get(currentSurahAyah));\n+\n+    highlights.clear();\n+    highlights.add(ayahTransition);\n+\n+    // TODO: reason whether this TypeEvaluator should be anonymous or not", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "63dcff2de261ab1097c6a06437483cb819fd61f5"}, "originalPosition": 101}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ0MDgxNQ==", "bodyText": "what's the o here for? can we expand it?", "url": "https://github.com/quran/quran_android/pull/1313#discussion_r458440815", "createdAt": "2020-07-21T23:11:05Z", "author": {"login": "ahmedre"}, "path": "app/src/main/java/com/quran/labs/androidquran/widgets/HighlightingImageView.java", "diffHunk": "@@ -130,17 +152,178 @@ public void setNightMode(boolean isNightMode, int textBrightness) {\n     adjustNightMode();\n   }\n \n-  public void highlightAyah(int sura, int ayah, HighlightType type) {\n+  private void highlightFloatableAyah(Set<String> highlights, String currentSurahAyah) {\n+    final Map<String, List<AyahBounds>> coordinatesData = ayahCoordinates.getAyahCoordinates();\n+\n+    String previousSurahAyah = currentSurahAyah;\n+    for(String surahAyahs: highlights) {\n+      previousSurahAyah = surahAyahs;\n+    }\n+    List<AyahBounds> startingBounds;\n+    int arrowIndex = previousSurahAyah.indexOf(\"->\");\n+    if(arrowIndex != -1) {\n+      // The ayah changed during animating\n+      startingBounds = (List<AyahBounds>)animator.getAnimatedValue();\n+      animator.cancel();\n+      previousSurahAyah = previousSurahAyah.substring(arrowIndex + 2);\n+    } else {\n+      startingBounds = coordinatesData.get(previousSurahAyah);\n+    }\n+\n+    final String ayahTransition = previousSurahAyah+\"->\"+currentSurahAyah;\n+\n+    // yes we make copies, because normalizing the bounds will change them\n+    List<AyahBounds> previousAyahBoundsList = new ArrayList<>(startingBounds);\n+    List<AyahBounds> currentAyahBoundsList = new ArrayList<>(coordinatesData.get(currentSurahAyah));\n+\n+    highlights.clear();\n+    highlights.add(ayahTransition);\n+\n+    // TODO: reason whether this TypeEvaluator should be anonymous or not\n+    animator = ValueAnimator.ofObject(new TypeEvaluator() {\n+\n+      private void normalizeAyahBoundsList(List<AyahBounds> start, List<AyahBounds> end) {\n+        // this function takes two unequal length lists and normalizes them\n+\n+        int startSize = start.size();\n+        int endSize = end.size();\n+        int minSize = Math.min(startSize, endSize);\n+        int maxSize = Math.max(startSize, endSize);\n+        List<AyahBounds> minList = startSize < endSize? start : end;\n+        int diff = maxSize - minSize;\n+\n+        RectF rectToBeDivided = minList.get(minSize-1).getBounds();\n+        float oLeft = rectToBeDivided.left;\n+        float oRight = rectToBeDivided.right;\n+        float oTop = rectToBeDivided.top;\n+        float oBottom = rectToBeDivided.bottom;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "63dcff2de261ab1097c6a06437483cb819fd61f5"}, "originalPosition": 118}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ0MDkxOQ==", "bodyText": "this function would really benefit from some unit tests", "url": "https://github.com/quran/quran_android/pull/1313#discussion_r458440919", "createdAt": "2020-07-21T23:11:23Z", "author": {"login": "ahmedre"}, "path": "app/src/main/java/com/quran/labs/androidquran/widgets/HighlightingImageView.java", "diffHunk": "@@ -130,17 +152,178 @@ public void setNightMode(boolean isNightMode, int textBrightness) {\n     adjustNightMode();\n   }\n \n-  public void highlightAyah(int sura, int ayah, HighlightType type) {\n+  private void highlightFloatableAyah(Set<String> highlights, String currentSurahAyah) {\n+    final Map<String, List<AyahBounds>> coordinatesData = ayahCoordinates.getAyahCoordinates();\n+\n+    String previousSurahAyah = currentSurahAyah;\n+    for(String surahAyahs: highlights) {\n+      previousSurahAyah = surahAyahs;\n+    }\n+    List<AyahBounds> startingBounds;\n+    int arrowIndex = previousSurahAyah.indexOf(\"->\");\n+    if(arrowIndex != -1) {\n+      // The ayah changed during animating\n+      startingBounds = (List<AyahBounds>)animator.getAnimatedValue();\n+      animator.cancel();\n+      previousSurahAyah = previousSurahAyah.substring(arrowIndex + 2);\n+    } else {\n+      startingBounds = coordinatesData.get(previousSurahAyah);\n+    }\n+\n+    final String ayahTransition = previousSurahAyah+\"->\"+currentSurahAyah;\n+\n+    // yes we make copies, because normalizing the bounds will change them\n+    List<AyahBounds> previousAyahBoundsList = new ArrayList<>(startingBounds);\n+    List<AyahBounds> currentAyahBoundsList = new ArrayList<>(coordinatesData.get(currentSurahAyah));\n+\n+    highlights.clear();\n+    highlights.add(ayahTransition);\n+\n+    // TODO: reason whether this TypeEvaluator should be anonymous or not\n+    animator = ValueAnimator.ofObject(new TypeEvaluator() {\n+\n+      private void normalizeAyahBoundsList(List<AyahBounds> start, List<AyahBounds> end) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "63dcff2de261ab1097c6a06437483cb819fd61f5"}, "originalPosition": 104}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ0MTExMg==", "bodyText": "this matters too because we're in onDraw here potentially", "url": "https://github.com/quran/quran_android/pull/1313#discussion_r458441112", "createdAt": "2020-07-21T23:11:57Z", "author": {"login": "ahmedre"}, "path": "app/src/main/java/com/quran/labs/androidquran/widgets/HighlightingImageView.java", "diffHunk": "@@ -130,17 +152,178 @@ public void setNightMode(boolean isNightMode, int textBrightness) {\n     adjustNightMode();\n   }\n \n-  public void highlightAyah(int sura, int ayah, HighlightType type) {\n+  private void highlightFloatableAyah(Set<String> highlights, String currentSurahAyah) {\n+    final Map<String, List<AyahBounds>> coordinatesData = ayahCoordinates.getAyahCoordinates();\n+\n+    String previousSurahAyah = currentSurahAyah;\n+    for(String surahAyahs: highlights) {\n+      previousSurahAyah = surahAyahs;\n+    }\n+    List<AyahBounds> startingBounds;\n+    int arrowIndex = previousSurahAyah.indexOf(\"->\");\n+    if(arrowIndex != -1) {\n+      // The ayah changed during animating\n+      startingBounds = (List<AyahBounds>)animator.getAnimatedValue();\n+      animator.cancel();\n+      previousSurahAyah = previousSurahAyah.substring(arrowIndex + 2);\n+    } else {\n+      startingBounds = coordinatesData.get(previousSurahAyah);\n+    }\n+\n+    final String ayahTransition = previousSurahAyah+\"->\"+currentSurahAyah;\n+\n+    // yes we make copies, because normalizing the bounds will change them\n+    List<AyahBounds> previousAyahBoundsList = new ArrayList<>(startingBounds);\n+    List<AyahBounds> currentAyahBoundsList = new ArrayList<>(coordinatesData.get(currentSurahAyah));\n+\n+    highlights.clear();\n+    highlights.add(ayahTransition);\n+\n+    // TODO: reason whether this TypeEvaluator should be anonymous or not\n+    animator = ValueAnimator.ofObject(new TypeEvaluator() {\n+\n+      private void normalizeAyahBoundsList(List<AyahBounds> start, List<AyahBounds> end) {\n+        // this function takes two unequal length lists and normalizes them\n+\n+        int startSize = start.size();\n+        int endSize = end.size();\n+        int minSize = Math.min(startSize, endSize);\n+        int maxSize = Math.max(startSize, endSize);\n+        List<AyahBounds> minList = startSize < endSize? start : end;\n+        int diff = maxSize - minSize;\n+\n+        RectF rectToBeDivided = minList.get(minSize-1).getBounds();\n+        float oLeft = rectToBeDivided.left;\n+        float oRight = rectToBeDivided.right;\n+        float oTop = rectToBeDivided.top;\n+        float oBottom = rectToBeDivided.bottom;\n+        minList.remove(minSize-1);\n+        float part = (oRight-oLeft) /(diff+1);\n+        for(int i=0; i<(diff+1); ++i) {\n+          float left = oLeft + part*i;\n+          float right = left + part;\n+          RectF rect = new RectF(left, oTop, right, oBottom);\n+          AyahBounds ayahBounds = new AyahBounds(0, 0, rect);\n+          minList.add(ayahBounds);\n+        }\n+      }\n+\n+      @Override\n+      public Object evaluate(float fraction, Object startObject, Object endObject) {\n+        List<AyahBounds> start = (List<AyahBounds>)startObject;\n+        List<AyahBounds> end = (List<AyahBounds>)endObject;\n+\n+        if(start.size() != end.size()) {\n+          normalizeAyahBoundsList(start, end);\n+        }\n+\n+        int size = start.size();\n+\n+        //TODO: instead of creating result every time, modify in-place", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "63dcff2de261ab1097c6a06437483cb819fd61f5"}, "originalPosition": 141}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ0MTI0Mg==", "bodyText": "if you move a lot of this out to new classes, let's move it there", "url": "https://github.com/quran/quran_android/pull/1313#discussion_r458441242", "createdAt": "2020-07-21T23:12:20Z", "author": {"login": "ahmedre"}, "path": "app/src/main/java/com/quran/labs/androidquran/widgets/HighlightingImageView.java", "diffHunk": "@@ -130,17 +152,178 @@ public void setNightMode(boolean isNightMode, int textBrightness) {\n     adjustNightMode();\n   }\n \n-  public void highlightAyah(int sura, int ayah, HighlightType type) {\n+  private void highlightFloatableAyah(Set<String> highlights, String currentSurahAyah) {\n+    final Map<String, List<AyahBounds>> coordinatesData = ayahCoordinates.getAyahCoordinates();\n+\n+    String previousSurahAyah = currentSurahAyah;\n+    for(String surahAyahs: highlights) {\n+      previousSurahAyah = surahAyahs;\n+    }\n+    List<AyahBounds> startingBounds;\n+    int arrowIndex = previousSurahAyah.indexOf(\"->\");\n+    if(arrowIndex != -1) {\n+      // The ayah changed during animating\n+      startingBounds = (List<AyahBounds>)animator.getAnimatedValue();\n+      animator.cancel();\n+      previousSurahAyah = previousSurahAyah.substring(arrowIndex + 2);\n+    } else {\n+      startingBounds = coordinatesData.get(previousSurahAyah);\n+    }\n+\n+    final String ayahTransition = previousSurahAyah+\"->\"+currentSurahAyah;\n+\n+    // yes we make copies, because normalizing the bounds will change them\n+    List<AyahBounds> previousAyahBoundsList = new ArrayList<>(startingBounds);\n+    List<AyahBounds> currentAyahBoundsList = new ArrayList<>(coordinatesData.get(currentSurahAyah));\n+\n+    highlights.clear();\n+    highlights.add(ayahTransition);\n+\n+    // TODO: reason whether this TypeEvaluator should be anonymous or not\n+    animator = ValueAnimator.ofObject(new TypeEvaluator() {\n+\n+      private void normalizeAyahBoundsList(List<AyahBounds> start, List<AyahBounds> end) {\n+        // this function takes two unequal length lists and normalizes them\n+\n+        int startSize = start.size();\n+        int endSize = end.size();\n+        int minSize = Math.min(startSize, endSize);\n+        int maxSize = Math.max(startSize, endSize);\n+        List<AyahBounds> minList = startSize < endSize? start : end;\n+        int diff = maxSize - minSize;\n+\n+        RectF rectToBeDivided = minList.get(minSize-1).getBounds();\n+        float oLeft = rectToBeDivided.left;\n+        float oRight = rectToBeDivided.right;\n+        float oTop = rectToBeDivided.top;\n+        float oBottom = rectToBeDivided.bottom;\n+        minList.remove(minSize-1);\n+        float part = (oRight-oLeft) /(diff+1);\n+        for(int i=0; i<(diff+1); ++i) {\n+          float left = oLeft + part*i;\n+          float right = left + part;\n+          RectF rect = new RectF(left, oTop, right, oBottom);\n+          AyahBounds ayahBounds = new AyahBounds(0, 0, rect);\n+          minList.add(ayahBounds);\n+        }\n+      }\n+\n+      @Override\n+      public Object evaluate(float fraction, Object startObject, Object endObject) {\n+        List<AyahBounds> start = (List<AyahBounds>)startObject;\n+        List<AyahBounds> end = (List<AyahBounds>)endObject;\n+\n+        if(start.size() != end.size()) {\n+          normalizeAyahBoundsList(start, end);\n+        }\n+\n+        int size = start.size();\n+\n+        //TODO: instead of creating result every time, modify in-place\n+        List<AyahBounds> result = new ArrayList<>(size);\n+\n+        for(int i=0; i<size; ++i) {\n+          RectF startValue = start.get(i).getBounds();\n+          RectF endValue = end.get(i).getBounds();\n+          float left = startValue.left + (endValue.left - startValue.left) * fraction;\n+          float top = startValue.top + (endValue.top - startValue.top) * fraction;\n+          float right = startValue.right + (endValue.right - startValue.right) * fraction;\n+          float bottom = startValue.bottom + (endValue.bottom - startValue.bottom) * fraction;\n+          AyahBounds intermediateBounds = new AyahBounds(0,0, new RectF(left, top, right, bottom));\n+          result.add(intermediateBounds);\n+        }\n+        return result;\n+      }\n+    }, previousAyahBoundsList, currentAyahBoundsList);\n+\n+    // TODO: where should this constant live?", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "63dcff2de261ab1097c6a06437483cb819fd61f5"}, "originalPosition": 158}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ0MTU5NQ==", "bodyText": "considering your comment on 279 of HighlightingImageView and your comment 27 here, i'd go for making this class and only adding the things we need now - i.e. not future proofing it for everything, but making it easy to add say the type of interpolator there later if we want to change it, etc.", "url": "https://github.com/quran/quran_android/pull/1313#discussion_r458441595", "createdAt": "2020-07-21T23:13:35Z", "author": {"login": "ahmedre"}, "path": "app/src/main/java/com/quran/labs/androidquran/ui/helpers/HighlightType.java", "diffHunk": "@@ -8,20 +8,30 @@\n \n public class HighlightType implements Comparable<HighlightType> {\n \n-  public static final HighlightType SELECTION = new HighlightType(1, false, R.color.selection_highlight);\n-  public static final HighlightType AUDIO =     new HighlightType(2, false, R.color.audio_highlight);\n-  public static final HighlightType NOTE =      new HighlightType(3, true,  R.color.note_highlight);\n-  public static final HighlightType BOOKMARK =  new HighlightType(4, true,  R.color.bookmark_highlight);\n+  public static final HighlightType SELECTION = new HighlightType(1, false, R.color.selection_highlight, false);\n+  public static final HighlightType AUDIO =     new HighlightType(2, false, R.color.audio_highlight,     true);\n+  public static final HighlightType NOTE =      new HighlightType(3, true,  R.color.note_highlight,      false);\n+  public static final HighlightType BOOKMARK =  new HighlightType(4, true,  R.color.bookmark_highlight,  false);\n \n   private Long id;\n   private boolean multipleHighlightsAllowed;\n   private int colorId;\n   private Integer color = null;\n+  private boolean floatable; \n+  // TODO: replace this with HighlightAnimationConfig", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "63dcff2de261ab1097c6a06437483cb819fd61f5"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ0MTkyNw==", "bodyText": "as a rule of thumb, i'd vote for - when in doubt, don't animate - or when it's complicated to figure it out, don't", "url": "https://github.com/quran/quran_android/pull/1313#discussion_r458441927", "createdAt": "2020-07-21T23:14:42Z", "author": {"login": "ahmedre"}, "path": "app/src/main/java/com/quran/labs/androidquran/widgets/HighlightingImageView.java", "diffHunk": "@@ -294,6 +477,28 @@ protected void onSizeChanged(int w, int h, int oldw, int oldh) {\n     }\n   }\n \n+  private boolean alreadyHighlightedContains(String ayah) {\n+    // ayah can either be like 89:7 or 89:7->89:8\n+    if(alreadyHighlighted.contains(ayah)) {\n+      return true;\n+    }\n+    int arrowIndex = ayah.indexOf(\"->\");\n+    if (arrowIndex == -1) {\n+      return false;\n+    }\n+    String startAyah = ayah.substring(0, arrowIndex);\n+    String endAyah = ayah.substring(arrowIndex + 2);\n+    if(alreadyHighlighted.contains(startAyah)\n+        // TODO: to show or not to show is the question!", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "63dcff2de261ab1097c6a06437483cb819fd61f5"}, "originalPosition": 267}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5588b8441ea3dcb7efc9d04a3617b71642ae8dd1", "author": {"user": null}, "url": "https://github.com/quran/quran_android/commit/5588b8441ea3dcb7efc9d04a3617b71642ae8dd1", "committedDate": "2020-07-29T01:49:49Z", "message": "expanding 'o' to original for rectToBeDivided"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "89350844a5bb4515493397b98a31f3dbf370c67b", "author": {"user": null}, "url": "https://github.com/quran/quran_android/commit/89350844a5bb4515493397b98a31f3dbf370c67b", "committedDate": "2020-07-29T02:18:24Z", "message": "can't modify Evaluator result in place, have to make it immutable"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5487df369baa6150efaac58a52f9c09ebd128d11", "author": {"user": null}, "url": "https://github.com/quran/quran_android/commit/5487df369baa6150efaac58a52f9c09ebd128d11", "committedDate": "2020-07-30T13:44:31Z", "message": "refactoring into various classes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "16af4afd474b16bc09981de0c10df1bb1b3c7d43", "author": {"user": null}, "url": "https://github.com/quran/quran_android/commit/16af4afd474b16bc09981de0c10df1bb1b3c7d43", "committedDate": "2020-07-30T14:24:27Z", "message": "cleanup: to show or not to show animation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4858fe34ca232e573e9ce877d20f46df74d843d4", "author": {"user": null}, "url": "https://github.com/quran/quran_android/commit/4858fe34ca232e573e9ce877d20f46df74d843d4", "committedDate": "2020-07-30T14:35:12Z", "message": "less convoluted way of accessing the highlights set and retrieving previousSurahAyah"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b71fc3beedd5d80fa2a143bcccc0e3c96f4d72ab", "author": {"user": null}, "url": "https://github.com/quran/quran_android/commit/b71fc3beedd5d80fa2a143bcccc0e3c96f4d72ab", "committedDate": "2020-08-03T17:58:03Z", "message": "adding another strategy which simplifies animation when going from more to less"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c5d57a03e3ec1c4bfe58e14b67d6909d44faa184", "author": {"user": null}, "url": "https://github.com/quran/quran_android/commit/c5d57a03e3ec1c4bfe58e14b67d6909d44faa184", "committedDate": "2020-08-04T04:22:25Z", "message": "using AyahHighlight instead of strings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "01c391ddc2f67365e8772d711d4f48524d66c597", "author": {"user": {"login": "murtraja", "name": "Murtaza Raja"}}, "url": "https://github.com/quran/quran_android/commit/01c391ddc2f67365e8772d711d4f48524d66c597", "committedDate": "2020-08-16T07:04:06Z", "message": "Merge branch 'master' into floating-highlights"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "278a33d13c8929073d3a4d3bc6277e178fd8bed8", "author": {"user": null}, "url": "https://github.com/quran/quran_android/commit/278a33d13c8929073d3a4d3bc6277e178fd8bed8", "committedDate": "2020-08-16T07:20:34Z", "message": "resolving conflicts introduced by 3e3de4"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "36b5d6fc6007056d6d932ca8304e1ba8208c020f", "author": {"user": null}, "url": "https://github.com/quran/quran_android/commit/36b5d6fc6007056d6d932ca8304e1ba8208c020f", "committedDate": "2020-08-16T07:29:41Z", "message": "Extracting AyahHighlight and friends out of the HighlightingImageView"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3070, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}