{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIxMDQ3MTM4", "number": 1363, "title": "#1361 show the translated names of the sura in the sura list fragment.", "bodyText": "#1361 show the translated names of the sura in the sura list fragment.", "createdAt": "2020-05-20T22:16:00Z", "url": "https://github.com/quran/quran_android/pull/1363", "merged": true, "mergeCommit": {"oid": "9fb30e5faf9828717e9e8f7bbdf35ff747efb492"}, "closed": true, "closedAt": "2020-06-01T17:00:06Z", "author": {"login": "AhmedGarhy"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcjQmeKAH2gAyNDIxMDQ3MTM4OjM1Mjk2MTczODIwZGU5NTU2ODNmZTA0NjI4NGNhNGMwY2ZiNGI4M2M=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcnBlFCAH2gAyNDIxMDQ3MTM4OmVkZDQ1MWExMTg4ZjlmODQ5OTRhMTdlMjY3ZDIzN2ZjMDAxNTJjOGI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "35296173820de955683fe046284ca4c0cfb4b83c", "author": {"user": {"login": "AhmedGarhy", "name": "Ahmed Garhy"}}, "url": "https://github.com/quran/quran_android/commit/35296173820de955683fe046284ca4c0cfb4b83c", "committedDate": "2020-05-20T22:13:56Z", "message": "#1361 show the translated names of the sura in the sura list fragment."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE1NzU1NDUx", "url": "https://github.com/quran/quran_android/pull/1363#pullrequestreview-415755451", "createdAt": "2020-05-20T22:22:01Z", "commit": {"oid": "35296173820de955683fe046284ca4c0cfb4b83c"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQyMjoyMjowMVrOGYf3yA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQyMjoyNTo0N1rOGYf91Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODM0MTE5Mg==", "bodyText": "replace with:\n  @Inject\n  QuranSettings quranSettings;\n\nfield at the top.", "url": "https://github.com/quran/quran_android/pull/1363#discussion_r428341192", "createdAt": "2020-05-20T22:22:01Z", "author": {"login": "ahmedre"}, "path": "app/src/main/java/com/quran/labs/androidquran/ui/fragment/SuraListFragment.java", "diffHunk": "@@ -128,7 +129,8 @@ private void updateScrollBarPositionHoneycomb() {\n \n     Activity activity = getActivity();\n     boolean wantPrefix = activity.getResources().getBoolean(R.bool.show_surat_prefix);\n-    boolean wantTranslation = activity.getResources().getBoolean(R.bool.show_sura_names_translation);\n+    QuranSettings settings = QuranSettings.getInstance(activity);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "35296173820de955683fe046284ca4c0cfb4b83c"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODM0MTc3MA==", "bodyText": "suggestion - instead of doing it this way, i would remove this code and let changing the variable cause SuraListFragment instead to recompute with the updated flag and notifyDataSetChanged.", "url": "https://github.com/quran/quran_android/pull/1363#discussion_r428341770", "createdAt": "2020-05-20T22:23:31Z", "author": {"login": "ahmedre"}, "path": "app/src/main/java/com/quran/labs/androidquran/ui/helpers/QuranListAdapter.java", "diffHunk": "@@ -248,6 +249,35 @@ public boolean onLongClick(View v) {\n     return false;\n   }\n \n+  public void showHideSuraTranslatedName(boolean showSuraTranslatedName) {\n+    if (showSuraTranslatedName && elements[1].text.indexOf(\"(\") != -1) return;\n+    if (!showSuraTranslatedName && elements[1].text.indexOf(\"(\") == -1) return;\n+    for (QuranRow row : elements) {\n+      if (row.sura != 0) {\n+        if (showSuraTranslatedName) {\n+          addTranslatedNameToSuraName(row);\n+        } else {\n+          removeSuraTranslatedName(row);\n+        }\n+      }\n+    }\n+    notifyDataSetChanged();\n+  }\n+\n+  private void removeSuraTranslatedName(QuranRow row) {\n+    if (row.text.indexOf(\"(\") != -1)\n+      row.text = row.text.substring(0, row.text.indexOf(\"(\") - 1);\n+  }\n+\n+  private void addTranslatedNameToSuraName(QuranRow row) {\n+    StringBuilder builder = new StringBuilder(row.text);\n+    String translation = context.getResources().getStringArray(R.array.sura_names_translation)[row.sura - 1];\n+    if (!TextUtils.isEmpty(translation)) {\n+      builder.append(\" (\" + translation + \")\");\n+    }\n+    row.text = builder.toString();\n+  }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "35296173820de955683fe046284ca4c0cfb4b83c"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODM0MTg5Mw==", "bodyText": "can you default to the value in R.bool.show_sura_names_translation", "url": "https://github.com/quran/quran_android/pull/1363#discussion_r428341893", "createdAt": "2020-05-20T22:23:53Z", "author": {"login": "ahmedre"}, "path": "app/src/main/java/com/quran/labs/androidquran/util/QuranSettings.java", "diffHunk": "@@ -167,6 +167,9 @@ public void setShowDate(boolean isDateShown) {\n     prefs.edit().putBoolean(Constants.PREF_SHOW_DATE, isDateShown).apply();\n   }\n \n+  public boolean isShowSuraTranslatedName() {\n+    return prefs.getBoolean(Constants.PREF_SURA_TRANSLATED_NAME, false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "35296173820de955683fe046284ca4c0cfb4b83c"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODM0Mjc0MQ==", "bodyText": "so you could replace that code with a check in onResume - if the value of the checkbox changed, then re-compute and notifyDataSetChanged, otherwise do nothing.", "url": "https://github.com/quran/quran_android/pull/1363#discussion_r428342741", "createdAt": "2020-05-20T22:25:47Z", "author": {"login": "ahmedre"}, "path": "app/src/main/java/com/quran/labs/androidquran/ui/helpers/QuranListAdapter.java", "diffHunk": "@@ -248,6 +249,35 @@ public boolean onLongClick(View v) {\n     return false;\n   }\n \n+  public void showHideSuraTranslatedName(boolean showSuraTranslatedName) {\n+    if (showSuraTranslatedName && elements[1].text.indexOf(\"(\") != -1) return;\n+    if (!showSuraTranslatedName && elements[1].text.indexOf(\"(\") == -1) return;\n+    for (QuranRow row : elements) {\n+      if (row.sura != 0) {\n+        if (showSuraTranslatedName) {\n+          addTranslatedNameToSuraName(row);\n+        } else {\n+          removeSuraTranslatedName(row);\n+        }\n+      }\n+    }\n+    notifyDataSetChanged();\n+  }\n+\n+  private void removeSuraTranslatedName(QuranRow row) {\n+    if (row.text.indexOf(\"(\") != -1)\n+      row.text = row.text.substring(0, row.text.indexOf(\"(\") - 1);\n+  }\n+\n+  private void addTranslatedNameToSuraName(QuranRow row) {\n+    StringBuilder builder = new StringBuilder(row.text);\n+    String translation = context.getResources().getStringArray(R.array.sura_names_translation)[row.sura - 1];\n+    if (!TextUtils.isEmpty(translation)) {\n+      builder.append(\" (\" + translation + \")\");\n+    }\n+    row.text = builder.toString();\n+  }\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODM0MTc3MA=="}, "originalCommit": {"oid": "35296173820de955683fe046284ca4c0cfb4b83c"}, "originalPosition": 40}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eb52558fd25306fc1afc1967f37fff814619ddd9", "author": {"user": {"login": "AhmedGarhy", "name": "Ahmed Garhy"}}, "url": "https://github.com/quran/quran_android/commit/eb52558fd25306fc1afc1967f37fff814619ddd9", "committedDate": "2020-05-20T22:57:45Z", "message": "- use R.bool.show_sura_names_translation as default value instead of hardcoded.\n- move the showing translated name from the adapter to the fragment."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxMjI3MTI5", "url": "https://github.com/quran/quran_android/pull/1363#pullrequestreview-421227129", "createdAt": "2020-05-29T19:29:05Z", "commit": {"oid": "eb52558fd25306fc1afc1967f37fff814619ddd9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQxOToyOTowNVrOGcpWUQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQxOToyOTowNVrOGcpWUQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjY5MDc2OQ==", "bodyText": "what i meant is replace these 2 lines with something like:\nfinal QuranRow[] updatedElements = getSuraList();\nadapter.setElements(updatedElements);\nand in onCreate, make the adapter in a variable so you can call this setter on it. expose the setter on the adapter also. then you can just remove the show/add methods that you added below.", "url": "https://github.com/quran/quran_android/pull/1363#discussion_r432690769", "createdAt": "2020-05-29T19:29:05Z", "author": {"login": "ahmedre"}, "path": "app/src/main/java/com/quran/labs/androidquran/ui/fragment/SuraListFragment.java", "diffHunk": "@@ -88,7 +92,11 @@ public void onPause() {\n   public void onResume() {\n     final Activity activity = getActivity();\n     if (activity instanceof QuranActivity) {\n-      QuranSettings settings = QuranSettings.getInstance(activity);\n+      boolean newValueOfShowSuraTranslatedName = quranSettings.isShowSuraTranslatedName();\n+      if (this.showSuraTranslatedName != newValueOfShowSuraTranslatedName) {\n+        showHideSuraTranslatedName(newValueOfShowSuraTranslatedName);\n+        this.showSuraTranslatedName = newValueOfShowSuraTranslatedName;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eb52558fd25306fc1afc1967f37fff814619ddd9"}, "originalPosition": 33}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "edd451a1188f9f84994a17e267d237fc00152c8b", "author": {"user": {"login": "AhmedGarhy", "name": "Ahmed Garhy"}}, "url": "https://github.com/quran/quran_android/commit/edd451a1188f9f84994a17e267d237fc00152c8b", "committedDate": "2020-06-01T14:59:32Z", "message": "- recall getSuraList method."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3080, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}