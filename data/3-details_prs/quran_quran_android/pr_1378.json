{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMzOTA5Nzg3", "number": 1378, "title": "Add widgets", "bodyText": "Add 2 widgets, a search widget and a bookmarks widget. See #458 and #845.\nCloses #458\nCloses #845\nRather than starting from scratch, I built on top of the work in #845 (Jazakallah @nyitgroup for your previous work).", "createdAt": "2020-06-12T22:32:13Z", "url": "https://github.com/quran/quran_android/pull/1378", "merged": true, "mergeCommit": {"oid": "592ce61c6cf631219924bf0012a811f3aabb4d48"}, "closed": true, "closedAt": "2020-09-29T19:43:26Z", "author": {"login": "ismail-s"}, "timelineItems": {"totalCount": 52, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcLcxL_gH2gAyNDMzOTA5Nzg3OjRjMzJkZGE4M2JmMWM2ZDgxMjBmM2ZiNTE5ZTY1OTk3MjEwN2VkMDk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdNbhjOAH2gAyNDMzOTA5Nzg3OmQyMDhlZWZlNzhkMDA1NmMxNWIwMTViYTcxMzIzNjRkNDU5ZDM3OWY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4c32dda83bf1c6d8120f3fb519e659972107ed09", "author": {"user": {"login": "nyitgroup", "name": null}}, "url": "https://github.com/quran/quran_android/commit/4c32dda83bf1c6d8120f3fb519e659972107ed09", "committedDate": "2020-03-07T22:50:19Z", "message": "Bookmarks Widget\n\nAdd bookmarks widget."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3db2fa18a198ff66a8145cc7a3f1a45de7c9a5f7", "author": {"user": {"login": "nyitgroup", "name": null}}, "url": "https://github.com/quran/quran_android/commit/3db2fa18a198ff66a8145cc7a3f1a45de7c9a5f7", "committedDate": "2020-03-07T23:13:07Z", "message": "Add two Widgets\n\nAdd search and bookmarks widgets"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "da447234db3f399ebf8d2e56e50b680a19d00ac9", "author": {"user": {"login": "nyitgroup", "name": null}}, "url": "https://github.com/quran/quran_android/commit/da447234db3f399ebf8d2e56e50b680a19d00ac9", "committedDate": "2020-03-07T23:24:32Z", "message": "Fix format\n\nsuggestions thanks to Shuhrat"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9db65ba547b17fc314798b3a348672d36eb9cf9e", "author": {"user": {"login": "nyitgroup", "name": null}}, "url": "https://github.com/quran/quran_android/commit/9db65ba547b17fc314798b3a348672d36eb9cf9e", "committedDate": "2020-03-07T23:29:51Z", "message": "Rename variables and format code #845"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "69afc2cb36a297348c5f9b9edb7dc03f78881d7a", "author": {"user": {"login": "ismail-s", "name": "Ismail S"}}, "url": "https://github.com/quran/quran_android/commit/69afc2cb36a297348c5f9b9edb7dc03f78881d7a", "committedDate": "2020-06-10T18:54:13Z", "message": "Fix jump to last page"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f8aa942cf10a23b133445e51562cebe3a23a3926", "author": {"user": {"login": "ismail-s", "name": "Ismail S"}}, "url": "https://github.com/quran/quran_android/commit/f8aa942cf10a23b133445e51562cebe3a23a3926", "committedDate": "2020-06-10T19:06:04Z", "message": "Tidy up code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "23d5a47603676bfb861f4dfac57472608f0446e3", "author": {"user": {"login": "ismail-s", "name": "Ismail S"}}, "url": "https://github.com/quran/quran_android/commit/23d5a47603676bfb861f4dfac57472608f0446e3", "committedDate": "2020-06-10T19:07:50Z", "message": "Make method public, call getter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ad800efaef87a9e1527771423322d5267a89e944", "author": {"user": {"login": "ismail-s", "name": "Ismail S"}}, "url": "https://github.com/quran/quran_android/commit/ad800efaef87a9e1527771423322d5267a89e944", "committedDate": "2020-06-10T19:09:21Z", "message": "Inject QuranInfo into WidgetListProvider"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "926e7ccec1d344d70cb384834d1e198abd83da74", "author": {"user": {"login": "ismail-s", "name": "Ismail S"}}, "url": "https://github.com/quran/quran_android/commit/926e7ccec1d344d70cb384834d1e198abd83da74", "committedDate": "2020-06-10T19:12:09Z", "message": "Add missing search activity xml changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "074e3643ffed19c55337eaffe57f5f943664e59e", "author": {"user": {"login": "ismail-s", "name": "Ismail S"}}, "url": "https://github.com/quran/quran_android/commit/074e3643ffed19c55337eaffe57f5f943664e59e", "committedDate": "2020-06-10T19:12:35Z", "message": "Minor code tidy up"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e6ec9604c714e2126456cfa3dd1db6545a738369", "author": {"user": {"login": "ismail-s", "name": "Ismail S"}}, "url": "https://github.com/quran/quran_android/commit/e6ec9604c714e2126456cfa3dd1db6545a738369", "committedDate": "2020-06-10T19:14:02Z", "message": "Make search widget have round corners"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0597ccc1affaa8f4e54ecbbbb943a768857e1482", "author": {"user": {"login": "ismail-s", "name": "Ismail S"}}, "url": "https://github.com/quran/quran_android/commit/0597ccc1affaa8f4e54ecbbbb943a768857e1482", "committedDate": "2020-06-10T19:14:49Z", "message": "Add preview image"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aeeddff433ce4ceb09ba365a859ef3d1cf1da98f", "author": {"user": {"login": "ismail-s", "name": "Ismail S"}}, "url": "https://github.com/quran/quran_android/commit/aeeddff433ce4ceb09ba365a859ef3d1cf1da98f", "committedDate": "2020-06-10T20:39:13Z", "message": "Merge remote-tracking branch 'origin-base/master' into add-widgets"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aeff390d3922d438a5d1de2485fd652009468f80", "author": {"user": {"login": "ismail-s", "name": "Ismail S"}}, "url": "https://github.com/quran/quran_android/commit/aeff390d3922d438a5d1de2485fd652009468f80", "committedDate": "2020-06-10T21:12:09Z", "message": "Fix case of ids"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ed94d940e03574f8b7bacc4f10f89f76c1ed7884", "author": {"user": {"login": "ismail-s", "name": "Ismail S"}}, "url": "https://github.com/quran/quran_android/commit/ed94d940e03574f8b7bacc4f10f89f76c1ed7884", "committedDate": "2020-06-11T18:41:52Z", "message": "Convert files to Kotlin"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "77a1e4eae306af873063d9471a7f1b7524126415", "author": {"user": {"login": "ismail-s", "name": "Ismail S"}}, "url": "https://github.com/quran/quran_android/commit/77a1e4eae306af873063d9471a7f1b7524126415", "committedDate": "2020-06-12T21:21:41Z", "message": "Use SearchView, fix app crashing sometimes when searching"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6757b767d4ea649e19b2e60d582340b428c22e8c", "author": {"user": {"login": "ismail-s", "name": "Ismail S"}}, "url": "https://github.com/quran/quran_android/commit/6757b767d4ea649e19b2e60d582340b428c22e8c", "committedDate": "2020-06-12T21:25:41Z", "message": "Remove unused variable & parameter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5ab499dae202a6f170c073fb691f0c461606e189", "author": {"user": {"login": "ismail-s", "name": "Ismail S"}}, "url": "https://github.com/quran/quran_android/commit/5ab499dae202a6f170c073fb691f0c461606e189", "committedDate": "2020-06-12T21:26:54Z", "message": "Remove line in bookmarks widget"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce3a7912baa16e08fda881093e2599fccb528744", "author": {"user": {"login": "ismail-s", "name": "Ismail S"}}, "url": "https://github.com/quran/quran_android/commit/ce3a7912baa16e08fda881093e2599fccb528744", "committedDate": "2020-06-12T22:12:19Z", "message": "Include only page bookmarks in bookmarks widget"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwMDcwMzk3", "url": "https://github.com/quran/quran_android/pull/1378#pullrequestreview-430070397", "createdAt": "2020-06-12T22:36:44Z", "commit": {"oid": "ce3a7912baa16e08fda881093e2599fccb528744"}, "state": "COMMENTED", "comments": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQyMjozNjo0NFrOGjTOiA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQyMzoxNDozNVrOGjTttg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY2ODM2MA==", "bodyText": "It had to work out that after working on the widgets, I decided to take a read through all the comments on #458 and realised that I haven't added a button to this search widget (or the bookmarks widget either) for jumping to a Surah/Ayah.\nI can add one if you want me to (or can be addressed in a later issue/PR). To get it to work, off the top of my head, I think I'd need to modify QuranActivity slightly to get it to take an intent and open the jump dialog.", "url": "https://github.com/quran/quran_android/pull/1378#discussion_r439668360", "createdAt": "2020-06-12T22:36:44Z", "author": {"login": "ismail-s"}, "path": "app/src/main/res/layout/search_widget.xml", "diffHunk": "@@ -0,0 +1,34 @@\n+<LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce3a7912baa16e08fda881093e2599fccb528744"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY2OTc4NQ==", "bodyText": "In terms of testing, I've done manual testing, I haven't written any automated tests. Especially around the widgets, I wasn't immediately sure how to do this (was thinking Robolectric but it isn't used elsewhere in this repo, plus I don't know how easy it would be to use to test a widget).", "url": "https://github.com/quran/quran_android/pull/1378#discussion_r439669785", "createdAt": "2020-06-12T22:42:49Z", "author": {"login": "ismail-s"}, "path": "app/src/main/AndroidManifest.xml", "diffHunk": "@@ -163,11 +163,35 @@\n         <action android:name=\"android.intent.action.MEDIA_BUTTON\"/>\n       </intent-filter>\n     </service>\n+    <service\n+        android:name=\".widgets.WidgetService\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce3a7912baa16e08fda881093e2599fccb528744"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY3MDA3MQ==", "bodyText": "I still need to add Javadocs (ok, KDoc comments).", "url": "https://github.com/quran/quran_android/pull/1378#discussion_r439670071", "createdAt": "2020-06-12T22:44:01Z", "author": {"login": "ismail-s"}, "path": "app/src/main/java/com/quran/labs/androidquran/BookmarksWidget.kt", "diffHunk": "@@ -0,0 +1,65 @@\n+package com.quran.labs.androidquran\n+\n+import android.app.PendingIntent\n+import android.appwidget.AppWidgetManager\n+import android.appwidget.AppWidgetProvider\n+import android.content.ComponentName\n+import android.content.Context\n+import android.content.Intent\n+import android.net.Uri\n+import android.widget.RemoteViews\n+import com.quran.labs.androidquran.ui.PagerActivity\n+import com.quran.labs.androidquran.ui.QuranActivity\n+import com.quran.labs.androidquran.widgets.WidgetService\n+\n+class BookmarksWidget : AppWidgetProvider() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce3a7912baa16e08fda881093e2599fccb528744"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY3MDQyMw==", "bodyText": "I still need to change this, but am not sure exactly how to, may need to investigate/test. What I am sure of though is that updateWidget shouldn't be being called every time this method is called.", "url": "https://github.com/quran/quran_android/pull/1378#discussion_r439670423", "createdAt": "2020-06-12T22:45:43Z", "author": {"login": "ismail-s"}, "path": "app/src/main/java/com/quran/labs/androidquran/BookmarksWidget.kt", "diffHunk": "@@ -0,0 +1,65 @@\n+package com.quran.labs.androidquran\n+\n+import android.app.PendingIntent\n+import android.appwidget.AppWidgetManager\n+import android.appwidget.AppWidgetProvider\n+import android.content.ComponentName\n+import android.content.Context\n+import android.content.Intent\n+import android.net.Uri\n+import android.widget.RemoteViews\n+import com.quran.labs.androidquran.ui.PagerActivity\n+import com.quran.labs.androidquran.ui.QuranActivity\n+import com.quran.labs.androidquran.widgets.WidgetService\n+\n+class BookmarksWidget : AppWidgetProvider() {\n+\n+  override fun onUpdate(context: Context, appWidgetManager: AppWidgetManager, appWidgetIds: IntArray) {\n+    for (appWidgetId in appWidgetIds) {\n+      val serviceIntent = Intent(context, WidgetService::class.java).apply {\n+        putExtra(AppWidgetManager.EXTRA_APPWIDGET_ID, appWidgetId)\n+        data = Uri.parse(toUri(Intent.URI_INTENT_SCHEME))\n+      }\n+\n+      val widget = RemoteViews(context.packageName, R.layout.bookmarks_widget)\n+\n+      var intent = Intent(context, QuranDataActivity::class.java)\n+      var pendingIntent = PendingIntent.getActivity(context, 0, intent, 0)\n+      widget.setOnClickPendingIntent(R.id.widget_icon_button, pendingIntent)\n+\n+      intent = Intent(context, SearchActivity::class.java)\n+      pendingIntent = PendingIntent.getActivity(context, 0, intent, 0)\n+      widget.setOnClickPendingIntent(R.id.widget_btn_search, pendingIntent)\n+\n+      intent = Intent(context, QuranActivity::class.java)\n+      intent.action = ShortcutsActivity.ACTION_JUMP_TO_LATEST\n+      pendingIntent = PendingIntent.getActivity(context, 0, intent, 0)\n+      widget.setOnClickPendingIntent(R.id.widget_btn_go_to_quran, pendingIntent)\n+\n+      widget.setRemoteAdapter(R.id.list_view_widget, serviceIntent)\n+      val clickIntent = Intent(context, PagerActivity::class.java)\n+      val clickPendingIntent = PendingIntent\n+          .getActivity(context, 0,\n+              clickIntent,\n+              PendingIntent.FLAG_UPDATE_CURRENT)\n+      widget.setPendingIntentTemplate(R.id.list_view_widget, clickPendingIntent)\n+      widget.setEmptyView(R.id.list_view_widget, R.id.empty_view)\n+\n+      appWidgetManager.updateAppWidget(appWidgetId, widget)\n+    }\n+    super.onUpdate(context, appWidgetManager, appWidgetIds)\n+  }\n+\n+  override fun onReceive(context: Context, intent: Intent) {\n+    super.onReceive(context, intent)\n+    updateWidget(context)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce3a7912baa16e08fda881093e2599fccb528744"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY3MDY4NQ==", "bodyText": "I was half-tempted to change the original code to not reuse these variables, but it seemed neat, so I left it (happy to change though if people want).", "url": "https://github.com/quran/quran_android/pull/1378#discussion_r439670685", "createdAt": "2020-06-12T22:46:59Z", "author": {"login": "ismail-s"}, "path": "app/src/main/java/com/quran/labs/androidquran/BookmarksWidget.kt", "diffHunk": "@@ -0,0 +1,65 @@\n+package com.quran.labs.androidquran\n+\n+import android.app.PendingIntent\n+import android.appwidget.AppWidgetManager\n+import android.appwidget.AppWidgetProvider\n+import android.content.ComponentName\n+import android.content.Context\n+import android.content.Intent\n+import android.net.Uri\n+import android.widget.RemoteViews\n+import com.quran.labs.androidquran.ui.PagerActivity\n+import com.quran.labs.androidquran.ui.QuranActivity\n+import com.quran.labs.androidquran.widgets.WidgetService\n+\n+class BookmarksWidget : AppWidgetProvider() {\n+\n+  override fun onUpdate(context: Context, appWidgetManager: AppWidgetManager, appWidgetIds: IntArray) {\n+    for (appWidgetId in appWidgetIds) {\n+      val serviceIntent = Intent(context, WidgetService::class.java).apply {\n+        putExtra(AppWidgetManager.EXTRA_APPWIDGET_ID, appWidgetId)\n+        data = Uri.parse(toUri(Intent.URI_INTENT_SCHEME))\n+      }\n+\n+      val widget = RemoteViews(context.packageName, R.layout.bookmarks_widget)\n+\n+      var intent = Intent(context, QuranDataActivity::class.java)\n+      var pendingIntent = PendingIntent.getActivity(context, 0, intent, 0)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce3a7912baa16e08fda881093e2599fccb528744"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY3MTgwNw==", "bodyText": "This took me a bunch of debugging and going through Android docs to figure out to add this code. Without it, if you do a search with results and then a search without results, the second search causes the app to crash (wasn't an issue before as there wasn't a search box in this activity then).", "url": "https://github.com/quran/quran_android/pull/1378#discussion_r439671807", "createdAt": "2020-06-12T22:52:11Z", "author": {"login": "ismail-s"}, "path": "app/src/main/java/com/quran/labs/androidquran/SearchActivity.java", "diffHunk": "@@ -169,6 +174,9 @@ public void onLoadFinished(@NonNull Loader<Cursor> loader, Cursor cursor) {\n         buttonGetTranslations.setText(R.string.get_translations);\n         buttonGetTranslations.setVisibility(View.VISIBLE);\n       }\n+      if (adapter != null) {\n+        adapter.swapCursor(null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce3a7912baa16e08fda881093e2599fccb528744"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY3MjU4Nw==", "bodyText": "I don't like this class being coupled to BookmarksWidget. It feels to me like there should be something in between, maybe something where this adapter fires out some stream of events and BookmarksWidget subscribes to that stream.\n@ahmedre do you have some ideas on the best way to do this (that also fits with how things are done in the rest of the app)?", "url": "https://github.com/quran/quran_android/pull/1378#discussion_r439672587", "createdAt": "2020-06-12T22:56:08Z", "author": {"login": "ismail-s"}, "path": "app/src/main/java/com/quran/labs/androidquran/database/BookmarksDBAdapter.java", "diffHunk": "@@ -144,6 +147,7 @@ public void replaceRecentRangeWithPage(int deleteRangeStart, int deleteRangeEnd,\n   }\n \n   public void addRecentPage(int page) {\n+    BookmarksWidget.updateWidget(context);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce3a7912baa16e08fda881093e2599fccb528744"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY3MzQwNw==", "bodyText": "The original code included both Ayah and page bookmarks in the bookmarks widget, but treated all of them as page bookmarks in terms of display and handling clicks. I've changed this to just show page bookmarks. A possible enhancement is to display Ayah bookmarks as well (this could be done multiple ways, or a config activity could even be added to the bookmarks widget to allow specifying what bookmark types/tags to display bookmarks for), but that feels to me like future enhancement.", "url": "https://github.com/quran/quran_android/pull/1378#discussion_r439673407", "createdAt": "2020-06-12T22:59:52Z", "author": {"login": "ismail-s"}, "path": "app/src/main/java/com/quran/labs/androidquran/widgets/WidgetListProvider.kt", "diffHunk": "@@ -0,0 +1,77 @@\n+package com.quran.labs.androidquran.widgets\n+\n+import android.content.Context\n+import android.content.Intent\n+import android.os.Bundle\n+import android.widget.RemoteViews\n+import android.widget.RemoteViewsService.RemoteViewsFactory\n+import com.quran.data.core.QuranInfo\n+import com.quran.labs.androidquran.QuranApplication\n+import com.quran.labs.androidquran.R\n+import com.quran.labs.androidquran.data.QuranDisplayData\n+import com.quran.labs.androidquran.database.BookmarksDBAdapter\n+import javax.inject.Inject\n+\n+class WidgetListProvider(private val context: Context) : RemoteViewsFactory {\n+\n+  private var suraPageItemList: List<SuraPageItem> = listOf()\n+\n+  @Inject\n+  lateinit var quranInfo: QuranInfo\n+\n+  @Inject\n+  lateinit var quranDisplayData: QuranDisplayData\n+\n+  init {\n+    (context.applicationContext as QuranApplication).applicationComponent.inject(this)\n+    populateListItem()\n+  }\n+\n+  private fun populateListItem() {\n+    val appContext = context.applicationContext\n+    val mBookmarksDBAdapter = BookmarksDBAdapter(appContext, quranInfo.numberOfPages)\n+    val bookmarksList = mBookmarksDBAdapter.getBookmarks(BookmarksDBAdapter.SORT_DATE_ADDED)\n+    suraPageItemList = bookmarksList.filter { it.isPageBookmark() }.map {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce3a7912baa16e08fda881093e2599fccb528744"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY3Mzc5NA==", "bodyText": "I could change this to sort by location if people want, that may seem more sensible.", "url": "https://github.com/quran/quran_android/pull/1378#discussion_r439673794", "createdAt": "2020-06-12T23:01:38Z", "author": {"login": "ismail-s"}, "path": "app/src/main/java/com/quran/labs/androidquran/widgets/WidgetListProvider.kt", "diffHunk": "@@ -0,0 +1,77 @@\n+package com.quran.labs.androidquran.widgets\n+\n+import android.content.Context\n+import android.content.Intent\n+import android.os.Bundle\n+import android.widget.RemoteViews\n+import android.widget.RemoteViewsService.RemoteViewsFactory\n+import com.quran.data.core.QuranInfo\n+import com.quran.labs.androidquran.QuranApplication\n+import com.quran.labs.androidquran.R\n+import com.quran.labs.androidquran.data.QuranDisplayData\n+import com.quran.labs.androidquran.database.BookmarksDBAdapter\n+import javax.inject.Inject\n+\n+class WidgetListProvider(private val context: Context) : RemoteViewsFactory {\n+\n+  private var suraPageItemList: List<SuraPageItem> = listOf()\n+\n+  @Inject\n+  lateinit var quranInfo: QuranInfo\n+\n+  @Inject\n+  lateinit var quranDisplayData: QuranDisplayData\n+\n+  init {\n+    (context.applicationContext as QuranApplication).applicationComponent.inject(this)\n+    populateListItem()\n+  }\n+\n+  private fun populateListItem() {\n+    val appContext = context.applicationContext\n+    val mBookmarksDBAdapter = BookmarksDBAdapter(appContext, quranInfo.numberOfPages)\n+    val bookmarksList = mBookmarksDBAdapter.getBookmarks(BookmarksDBAdapter.SORT_DATE_ADDED)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce3a7912baa16e08fda881093e2599fccb528744"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY3Mzk2OA==", "bodyText": "Reminder to self to tidy this up.", "url": "https://github.com/quran/quran_android/pull/1378#discussion_r439673968", "createdAt": "2020-06-12T23:02:23Z", "author": {"login": "ismail-s"}, "path": "app/src/main/java/com/quran/labs/androidquran/widgets/WidgetService.kt", "diffHunk": "@@ -0,0 +1,14 @@\n+package com.quran.labs.androidquran.widgets\n+\n+import android.content.Intent\n+import android.widget.RemoteViewsService\n+\n+class WidgetService : RemoteViewsService() {\n+  /*\n+* So pretty simple just defining the Adapter of the listview\n+* here Adapter is ListProvider\n+* */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce3a7912baa16e08fda881093e2599fccb528744"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY3NDI1Nw==", "bodyText": "Reminder to self to look into updating these preview images.", "url": "https://github.com/quran/quran_android/pull/1378#discussion_r439674257", "createdAt": "2020-06-12T23:03:47Z", "author": {"login": "ismail-s"}, "path": "app/src/main/res/xml/bookmarks_widget_info.xml", "diffHunk": "@@ -0,0 +1,10 @@\n+<?xml version=\"1.0\" encoding=\"utf-8\"?>\n+<appwidget-provider xmlns:android=\"http://schemas.android.com/apk/res/android\"\n+    android:initialKeyguardLayout=\"@layout/bookmarks_widget\"\n+    android:initialLayout=\"@layout/bookmarks_widget\"\n+    android:minHeight=\"110dp\"\n+    android:minWidth=\"180dp\"\n+    android:previewImage=\"@drawable/bookmarks_appwidget_preview\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce3a7912baa16e08fda881093e2599fccb528744"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY3NDg5Mg==", "bodyText": "Reminder to self to check if there's a better margin constant to use. And to more generally go over this file as a whole.", "url": "https://github.com/quran/quran_android/pull/1378#discussion_r439674892", "createdAt": "2020-06-12T23:06:46Z", "author": {"login": "ismail-s"}, "path": "app/src/main/res/layout/bookmarks_widget_list_row.xml", "diffHunk": "@@ -0,0 +1,44 @@\n+<LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n+    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n+    xmlns:tools=\"http://schemas.android.com/tools\"\n+    android:id=\"@+id/widget_item\"\n+    android:layout_width=\"match_parent\"\n+    android:layout_height=\"wrap_content\"\n+    android:layout_gravity=\"center_vertical\"\n+    android:layout_marginBottom=\"8dp\"\n+    android:layout_marginTop=\"8dp\"\n+    android:orientation=\"horizontal\">\n+\n+  <ImageView\n+      android:id=\"@+id/widget_favorite_icon\"\n+      android:layout_width=\"wrap_content\"\n+      android:layout_height=\"wrap_content\"\n+      android:layout_gravity=\"center_vertical\"\n+      android:layout_marginLeft=\"@dimen/audiobar_separator_padding\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce3a7912baa16e08fda881093e2599fccb528744"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY3NTE4Mg==", "bodyText": "#845 had an EditText here, I changed it to a SearchView.", "url": "https://github.com/quran/quran_android/pull/1378#discussion_r439675182", "createdAt": "2020-06-12T23:08:17Z", "author": {"login": "ismail-s"}, "path": "app/src/main/res/layout/search.xml", "diffHunk": "@@ -9,18 +9,28 @@\n               android:textSize=\"17sp\"\n               android:visibility=\"gone\"\n               android:textColor=\"?android:textColorPrimary\" />\n-    <Button android:id=\"@+id/btnGetTranslations\" android:text=\"@string/menu_get_translations\" \n+    <Button android:id=\"@+id/btnGetTranslations\" android:text=\"@string/menu_get_translations\"\n     \tandroid:layout_width=\"match_parent\" android:layout_height=\"wrap_content\" android:visibility=\"gone\"/>\n-    <TextView android:id=\"@+id/search_area\"\n-            android:textColor=\"?android:textColorPrimary\"\n-            android:textSize=\"17sp\"\n-            android:text=\"@string/search_key\"\n-            android:background=\"@android:drawable/title_bar\"\n-            android:layout_width=\"fill_parent\"\n-            android:layout_height=\"wrap_content\" />\n+\n+  <androidx.appcompat.widget.SearchView", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce3a7912baa16e08fda881093e2599fccb528744"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY3NTk0OQ==", "bodyText": "I spent a bit of time trying to make the widget have round corners, and ended up setting this custom background. It's not really a good way of doing this though, I was tempted to switch it back to as it was in #845, but thought I'd put it in this PR instead and see what people think. I haven't rounded the corners of the bookmarks widget, with this approach it felt like it'd probably be more complicated (and I think that widget looks ok as-is).", "url": "https://github.com/quran/quran_android/pull/1378#discussion_r439675949", "createdAt": "2020-06-12T23:12:11Z", "author": {"login": "ismail-s"}, "path": "app/src/main/res/layout/search_widget.xml", "diffHunk": "@@ -0,0 +1,34 @@\n+<LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n+    android:layout_width=\"match_parent\"\n+    android:layout_height=\"wrap_content\"\n+    android:background=\"@drawable/search_widget_background\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce3a7912baa16e08fda881093e2599fccb528744"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY3NjE1OA==", "bodyText": "Reminder to self to check why these changes were made to this file and revert if necessary.", "url": "https://github.com/quran/quran_android/pull/1378#discussion_r439676158", "createdAt": "2020-06-12T23:13:19Z", "author": {"login": "ismail-s"}, "path": "app/src/main/res/values/colors.xml", "diffHunk": "@@ -11,12 +11,12 @@\n   <color name=\"title_color\">#ffffffff</color>\n   <color name=\"sura_number_color\">#7fffffff</color>\n   <color name=\"sura_details_color\">#b2ffffff</color>\n-  <color name=\"transparent_actionbar_color\">#AA000000</color>\n+  <color name=\"transparent_actionbar_color\">#aa000000</color>\n   <color name=\"panel_background_color\">#ff424242</color>\n   <color name=\"translation_hdr_color\">#ff777777</color>\n   <color name=\"translation_sura_header\">#fff1ecd8</color>\n   <color name=\"translation_sura_header_night\">#ff424242</color>\n-  <color name=\"translation_verse_text_color\">#ff858383</color>\n+  <color name=\"translation_verse_text_color\">#858383</color>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce3a7912baa16e08fda881093e2599fccb528744"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY3NjM0Mg==", "bodyText": "Reminder to self to remove these strings if they're not being used.", "url": "https://github.com/quran/quran_android/pull/1378#discussion_r439676342", "createdAt": "2020-06-12T23:14:35Z", "author": {"login": "ismail-s"}, "path": "app/src/main/res/values/strings.xml", "diffHunk": "@@ -407,6 +407,9 @@\n \n   <!-- format strings -->\n   <string name=\"sura_ayah\" translatable=\"false\">%1$d:%2$d</string>\n+  <string name=\"bookmarks_appwidget_text\">Quran Bookmarks</string>\n+  <string name=\"add_widget\">Add widget</string>\n+  <string name=\"search_appwidget_text\">Quran Search </string>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce3a7912baa16e08fda881093e2599fccb528744"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "60fb32d21a029a340a8c867dadb0203fb5152e35", "author": {"user": {"login": "ismail-s", "name": "Ismail S"}}, "url": "https://github.com/quran/quran_android/commit/60fb32d21a029a340a8c867dadb0203fb5152e35", "committedDate": "2020-06-20T21:38:10Z", "message": "Use RelativeLayout instead of nested LinearLayouts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7d7735c705dd8b3311a2edbf30cb238212dbca8b", "author": {"user": {"login": "ismail-s", "name": "Ismail S"}}, "url": "https://github.com/quran/quran_android/commit/7d7735c705dd8b3311a2edbf30cb238212dbca8b", "committedDate": "2020-06-20T21:38:31Z", "message": "Remove unused strings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c7400723d3f57a75d0524113cafd626d8c2d9370", "author": {"user": {"login": "ismail-s", "name": "Ismail S"}}, "url": "https://github.com/quran/quran_android/commit/c7400723d3f57a75d0524113cafd626d8c2d9370", "committedDate": "2020-06-20T21:38:46Z", "message": "Revert changes to colour codes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQzNDIwOTA4", "url": "https://github.com/quran/quran_android/pull/1378#pullrequestreview-443420908", "createdAt": "2020-07-06T21:31:39Z", "commit": {"oid": "c7400723d3f57a75d0524113cafd626d8c2d9370"}, "state": "COMMENTED", "comments": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQyMTozMTozOVrOGtnxbg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQyMTo0Njo0NVrOGtoIyQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDQ5MDczNA==", "bodyText": "yeah - we can add Robolectric, but i am not sure how much you can test widgets with it - ideally i'd say let's just test any new \"business logic\" with just vanilla unit tests - since hopefully anything left is just the minimum required code for data / layout to the widget.", "url": "https://github.com/quran/quran_android/pull/1378#discussion_r450490734", "createdAt": "2020-07-06T21:31:39Z", "author": {"login": "ahmedre"}, "path": "app/src/main/AndroidManifest.xml", "diffHunk": "@@ -163,11 +163,35 @@\n         <action android:name=\"android.intent.action.MEDIA_BUTTON\"/>\n       </intent-filter>\n     </service>\n+    <service\n+        android:name=\".widgets.WidgetService\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY2OTc4NQ=="}, "originalCommit": {"oid": "ce3a7912baa16e08fda881093e2599fccb528744"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDQ5MTIyMQ==", "bodyText": "i'd vote for val over var whenever possible since it makes things cleaner generally - though as you said, in this particular case, it's not bad - but if you want to, i wouldn't mind :)", "url": "https://github.com/quran/quran_android/pull/1378#discussion_r450491221", "createdAt": "2020-07-06T21:32:52Z", "author": {"login": "ahmedre"}, "path": "app/src/main/java/com/quran/labs/androidquran/BookmarksWidget.kt", "diffHunk": "@@ -0,0 +1,65 @@\n+package com.quran.labs.androidquran\n+\n+import android.app.PendingIntent\n+import android.appwidget.AppWidgetManager\n+import android.appwidget.AppWidgetProvider\n+import android.content.ComponentName\n+import android.content.Context\n+import android.content.Intent\n+import android.net.Uri\n+import android.widget.RemoteViews\n+import com.quran.labs.androidquran.ui.PagerActivity\n+import com.quran.labs.androidquran.ui.QuranActivity\n+import com.quran.labs.androidquran.widgets.WidgetService\n+\n+class BookmarksWidget : AppWidgetProvider() {\n+\n+  override fun onUpdate(context: Context, appWidgetManager: AppWidgetManager, appWidgetIds: IntArray) {\n+    for (appWidgetId in appWidgetIds) {\n+      val serviceIntent = Intent(context, WidgetService::class.java).apply {\n+        putExtra(AppWidgetManager.EXTRA_APPWIDGET_ID, appWidgetId)\n+        data = Uri.parse(toUri(Intent.URI_INTENT_SCHEME))\n+      }\n+\n+      val widget = RemoteViews(context.packageName, R.layout.bookmarks_widget)\n+\n+      var intent = Intent(context, QuranDataActivity::class.java)\n+      var pendingIntent = PendingIntent.getActivity(context, 0, intent, 0)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY3MDY4NQ=="}, "originalCommit": {"oid": "ce3a7912baa16e08fda881093e2599fccb528744"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDQ5MjEzOA==", "bodyText": "according to the docs:\n\nThis is called for every broadcast and before each of the above callback methods. You normally don't need to implement this method because the default AppWidgetProvider implementation filters all App Widget broadcasts and calls the above methods as appropriate.\n\nfrom here", "url": "https://github.com/quran/quran_android/pull/1378#discussion_r450492138", "createdAt": "2020-07-06T21:35:07Z", "author": {"login": "ahmedre"}, "path": "app/src/main/java/com/quran/labs/androidquran/BookmarksWidget.kt", "diffHunk": "@@ -0,0 +1,65 @@\n+package com.quran.labs.androidquran\n+\n+import android.app.PendingIntent\n+import android.appwidget.AppWidgetManager\n+import android.appwidget.AppWidgetProvider\n+import android.content.ComponentName\n+import android.content.Context\n+import android.content.Intent\n+import android.net.Uri\n+import android.widget.RemoteViews\n+import com.quran.labs.androidquran.ui.PagerActivity\n+import com.quran.labs.androidquran.ui.QuranActivity\n+import com.quran.labs.androidquran.widgets.WidgetService\n+\n+class BookmarksWidget : AppWidgetProvider() {\n+\n+  override fun onUpdate(context: Context, appWidgetManager: AppWidgetManager, appWidgetIds: IntArray) {\n+    for (appWidgetId in appWidgetIds) {\n+      val serviceIntent = Intent(context, WidgetService::class.java).apply {\n+        putExtra(AppWidgetManager.EXTRA_APPWIDGET_ID, appWidgetId)\n+        data = Uri.parse(toUri(Intent.URI_INTENT_SCHEME))\n+      }\n+\n+      val widget = RemoteViews(context.packageName, R.layout.bookmarks_widget)\n+\n+      var intent = Intent(context, QuranDataActivity::class.java)\n+      var pendingIntent = PendingIntent.getActivity(context, 0, intent, 0)\n+      widget.setOnClickPendingIntent(R.id.widget_icon_button, pendingIntent)\n+\n+      intent = Intent(context, SearchActivity::class.java)\n+      pendingIntent = PendingIntent.getActivity(context, 0, intent, 0)\n+      widget.setOnClickPendingIntent(R.id.widget_btn_search, pendingIntent)\n+\n+      intent = Intent(context, QuranActivity::class.java)\n+      intent.action = ShortcutsActivity.ACTION_JUMP_TO_LATEST\n+      pendingIntent = PendingIntent.getActivity(context, 0, intent, 0)\n+      widget.setOnClickPendingIntent(R.id.widget_btn_go_to_quran, pendingIntent)\n+\n+      widget.setRemoteAdapter(R.id.list_view_widget, serviceIntent)\n+      val clickIntent = Intent(context, PagerActivity::class.java)\n+      val clickPendingIntent = PendingIntent\n+          .getActivity(context, 0,\n+              clickIntent,\n+              PendingIntent.FLAG_UPDATE_CURRENT)\n+      widget.setPendingIntentTemplate(R.id.list_view_widget, clickPendingIntent)\n+      widget.setEmptyView(R.id.list_view_widget, R.id.empty_view)\n+\n+      appWidgetManager.updateAppWidget(appWidgetId, widget)\n+    }\n+    super.onUpdate(context, appWidgetManager, appWidgetIds)\n+  }\n+\n+  override fun onReceive(context: Context, intent: Intent) {\n+    super.onReceive(context, intent)\n+    updateWidget(context)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY3MDQyMw=="}, "originalCommit": {"oid": "ce3a7912baa16e08fda881093e2599fccb528744"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDQ5MzkyMg==", "bodyText": "wow, great catch!\nto be honest we should stop using CursorAdapter here completely :( this whole class should be rewritten at some point :(", "url": "https://github.com/quran/quran_android/pull/1378#discussion_r450493922", "createdAt": "2020-07-06T21:39:26Z", "author": {"login": "ahmedre"}, "path": "app/src/main/java/com/quran/labs/androidquran/SearchActivity.java", "diffHunk": "@@ -169,6 +174,9 @@ public void onLoadFinished(@NonNull Loader<Cursor> loader, Cursor cursor) {\n         buttonGetTranslations.setText(R.string.get_translations);\n         buttonGetTranslations.setVisibility(View.VISIBLE);\n       }\n+      if (adapter != null) {\n+        adapter.swapCursor(null);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY3MTgwNw=="}, "originalCommit": {"oid": "ce3a7912baa16e08fda881093e2599fccb528744"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDQ5NTQyOQ==", "bodyText": "take a look at BookmarkPresenter i think - there's an rx observable there. we can just subscribe to it and refresh then - not sure what the right place to subscribe is, but in worst case, some object that subscribes whenever there is at least one active widget", "url": "https://github.com/quran/quran_android/pull/1378#discussion_r450495429", "createdAt": "2020-07-06T21:43:20Z", "author": {"login": "ahmedre"}, "path": "app/src/main/java/com/quran/labs/androidquran/database/BookmarksDBAdapter.java", "diffHunk": "@@ -144,6 +147,7 @@ public void replaceRecentRangeWithPage(int deleteRangeStart, int deleteRangeEnd,\n   }\n \n   public void addRecentPage(int page) {\n+    BookmarksWidget.updateWidget(context);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY3MjU4Nw=="}, "originalCommit": {"oid": "ce3a7912baa16e08fda881093e2599fccb528744"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDQ5NTgyOQ==", "bodyText": "what makes it tricky in this case to handle both (even if we say ui handling is identical for the time being with the exception that one shows an ayah number and one doesn't?)", "url": "https://github.com/quran/quran_android/pull/1378#discussion_r450495829", "createdAt": "2020-07-06T21:44:26Z", "author": {"login": "ahmedre"}, "path": "app/src/main/java/com/quran/labs/androidquran/widgets/WidgetListProvider.kt", "diffHunk": "@@ -0,0 +1,77 @@\n+package com.quran.labs.androidquran.widgets\n+\n+import android.content.Context\n+import android.content.Intent\n+import android.os.Bundle\n+import android.widget.RemoteViews\n+import android.widget.RemoteViewsService.RemoteViewsFactory\n+import com.quran.data.core.QuranInfo\n+import com.quran.labs.androidquran.QuranApplication\n+import com.quran.labs.androidquran.R\n+import com.quran.labs.androidquran.data.QuranDisplayData\n+import com.quran.labs.androidquran.database.BookmarksDBAdapter\n+import javax.inject.Inject\n+\n+class WidgetListProvider(private val context: Context) : RemoteViewsFactory {\n+\n+  private var suraPageItemList: List<SuraPageItem> = listOf()\n+\n+  @Inject\n+  lateinit var quranInfo: QuranInfo\n+\n+  @Inject\n+  lateinit var quranDisplayData: QuranDisplayData\n+\n+  init {\n+    (context.applicationContext as QuranApplication).applicationComponent.inject(this)\n+    populateListItem()\n+  }\n+\n+  private fun populateListItem() {\n+    val appContext = context.applicationContext\n+    val mBookmarksDBAdapter = BookmarksDBAdapter(appContext, quranInfo.numberOfPages)\n+    val bookmarksList = mBookmarksDBAdapter.getBookmarks(BookmarksDBAdapter.SORT_DATE_ADDED)\n+    suraPageItemList = bookmarksList.filter { it.isPageBookmark() }.map {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY3MzQwNw=="}, "originalCommit": {"oid": "ce3a7912baa16e08fda881093e2599fccb528744"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDQ5NTg3MA==", "bodyText": "remove", "url": "https://github.com/quran/quran_android/pull/1378#discussion_r450495870", "createdAt": "2020-07-06T21:44:33Z", "author": {"login": "ahmedre"}, "path": "app/src/main/java/com/quran/labs/androidquran/widgets/WidgetListProvider.kt", "diffHunk": "@@ -0,0 +1,77 @@\n+package com.quran.labs.androidquran.widgets\n+\n+import android.content.Context\n+import android.content.Intent\n+import android.os.Bundle\n+import android.widget.RemoteViews\n+import android.widget.RemoteViewsService.RemoteViewsFactory\n+import com.quran.data.core.QuranInfo\n+import com.quran.labs.androidquran.QuranApplication\n+import com.quran.labs.androidquran.R\n+import com.quran.labs.androidquran.data.QuranDisplayData\n+import com.quran.labs.androidquran.database.BookmarksDBAdapter\n+import javax.inject.Inject\n+\n+class WidgetListProvider(private val context: Context) : RemoteViewsFactory {\n+\n+  private var suraPageItemList: List<SuraPageItem> = listOf()\n+\n+  @Inject\n+  lateinit var quranInfo: QuranInfo\n+\n+  @Inject\n+  lateinit var quranDisplayData: QuranDisplayData\n+\n+  init {\n+    (context.applicationContext as QuranApplication).applicationComponent.inject(this)\n+    populateListItem()\n+  }\n+\n+  private fun populateListItem() {\n+    val appContext = context.applicationContext\n+    val mBookmarksDBAdapter = BookmarksDBAdapter(appContext, quranInfo.numberOfPages)\n+    val bookmarksList = mBookmarksDBAdapter.getBookmarks(BookmarksDBAdapter.SORT_DATE_ADDED)\n+    suraPageItemList = bookmarksList.filter { it.isPageBookmark() }.map {\n+      SuraPageItem(sura = quranDisplayData.getSuraNameString(appContext, it.page), page = it.page)\n+    }\n+  }\n+\n+  override fun onCreate() = Unit\n+  override fun onDestroy() = Unit", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c7400723d3f57a75d0524113cafd626d8c2d9370"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDQ5NjcxMw==", "bodyText": "is there no recycling that we can get with this?", "url": "https://github.com/quran/quran_android/pull/1378#discussion_r450496713", "createdAt": "2020-07-06T21:46:45Z", "author": {"login": "ahmedre"}, "path": "app/src/main/java/com/quran/labs/androidquran/widgets/WidgetListProvider.kt", "diffHunk": "@@ -0,0 +1,77 @@\n+package com.quran.labs.androidquran.widgets\n+\n+import android.content.Context\n+import android.content.Intent\n+import android.os.Bundle\n+import android.widget.RemoteViews\n+import android.widget.RemoteViewsService.RemoteViewsFactory\n+import com.quran.data.core.QuranInfo\n+import com.quran.labs.androidquran.QuranApplication\n+import com.quran.labs.androidquran.R\n+import com.quran.labs.androidquran.data.QuranDisplayData\n+import com.quran.labs.androidquran.database.BookmarksDBAdapter\n+import javax.inject.Inject\n+\n+class WidgetListProvider(private val context: Context) : RemoteViewsFactory {\n+\n+  private var suraPageItemList: List<SuraPageItem> = listOf()\n+\n+  @Inject\n+  lateinit var quranInfo: QuranInfo\n+\n+  @Inject\n+  lateinit var quranDisplayData: QuranDisplayData\n+\n+  init {\n+    (context.applicationContext as QuranApplication).applicationComponent.inject(this)\n+    populateListItem()\n+  }\n+\n+  private fun populateListItem() {\n+    val appContext = context.applicationContext\n+    val mBookmarksDBAdapter = BookmarksDBAdapter(appContext, quranInfo.numberOfPages)\n+    val bookmarksList = mBookmarksDBAdapter.getBookmarks(BookmarksDBAdapter.SORT_DATE_ADDED)\n+    suraPageItemList = bookmarksList.filter { it.isPageBookmark() }.map {\n+      SuraPageItem(sura = quranDisplayData.getSuraNameString(appContext, it.page), page = it.page)\n+    }\n+  }\n+\n+  override fun onCreate() = Unit\n+  override fun onDestroy() = Unit\n+\n+  override fun onDataSetChanged() {\n+    populateListItem()\n+  }\n+\n+  override fun getCount() = suraPageItemList.size\n+\n+  override fun getItemId(position: Int) = position.toLong()\n+\n+  override fun hasStableIds() = false\n+\n+  /*\n+  *Similar to getView of Adapter where instead of View\n+  *we return RemoteViews\n+  *\n+  */\n+  override fun getViewAt(position: Int): RemoteViews {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c7400723d3f57a75d0524113cafd626d8c2d9370"}, "originalPosition": 57}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "95b7ccb090a04009f9f884ed23419a8b8d8ada3a", "author": {"user": {"login": "ismail-s", "name": "Ismail S"}}, "url": "https://github.com/quran/quran_android/commit/95b7ccb090a04009f9f884ed23419a8b8d8ada3a", "committedDate": "2020-07-06T22:41:39Z", "message": "Remove unnecessary onReceive method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "148a9d0fe1aa426ec02fd1226cc2d9aaa5fe7ceb", "author": {"user": {"login": "ismail-s", "name": "Ismail S"}}, "url": "https://github.com/quran/quran_android/commit/148a9d0fe1aa426ec02fd1226cc2d9aaa5fe7ceb", "committedDate": "2020-07-09T22:38:24Z", "message": "Use rx observable for handling bookmarks changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d0174be051ca80813a348c9af404d9e9ab40d7b", "author": {"user": {"login": "ismail-s", "name": "Ismail S"}}, "url": "https://github.com/quran/quran_android/commit/8d0174be051ca80813a348c9af404d9e9ab40d7b", "committedDate": "2020-07-09T22:39:32Z", "message": "Update observable when bookmark is removed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8976ec0741a6ecdc2d43ab99f93d23f0c462c2fd", "author": {"user": {"login": "ismail-s", "name": "Ismail S"}}, "url": "https://github.com/quran/quran_android/commit/8976ec0741a6ecdc2d43ab99f93d23f0c462c2fd", "committedDate": "2020-07-22T21:32:20Z", "message": "Improve display of bookmarks and behaviour when clicked\n\nAlso display Ayah bookmarks in addition to page bookmarks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b5dc64331231d326f49dd98770762d5461fd4164", "author": {"user": {"login": "ismail-s", "name": "Ismail S"}}, "url": "https://github.com/quran/quran_android/commit/b5dc64331231d326f49dd98770762d5461fd4164", "committedDate": "2020-07-22T23:48:59Z", "message": "Move files to subpackage"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c5966731fb8ae1bd2bc75e4fc030f685762242e3", "author": {"user": {"login": "ismail-s", "name": "Ismail S"}}, "url": "https://github.com/quran/quran_android/commit/c5966731fb8ae1bd2bc75e4fc030f685762242e3", "committedDate": "2020-07-23T21:07:22Z", "message": "Populate search view with initial query, set focus correctly"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3b7df4e520755ac14bb94071c8cc34443c34070d", "author": {"user": {"login": "ismail-s", "name": "Ismail S"}}, "url": "https://github.com/quran/quran_android/commit/3b7df4e520755ac14bb94071c8cc34443c34070d", "committedDate": "2020-07-23T21:40:06Z", "message": "Fix bug with bookmark colors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ca9efb1c94c1dfc5d35a46917b62b016b6d1801f", "author": {"user": {"login": "ismail-s", "name": "Ismail S"}}, "url": "https://github.com/quran/quran_android/commit/ca9efb1c94c1dfc5d35a46917b62b016b6d1801f", "committedDate": "2020-08-02T12:56:57Z", "message": "Add button to search widget for jumping to location"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c26933d0a31e41e12f4fc38df29a746c304d5e8c", "author": {"user": {"login": "ismail-s", "name": "Ismail S"}}, "url": "https://github.com/quran/quran_android/commit/c26933d0a31e41e12f4fc38df29a746c304d5e8c", "committedDate": "2020-08-02T12:58:06Z", "message": "Remove unnecessary attribute"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e053590d33e33f3ded28ec05c85d9bd706f3a7b2", "author": {"user": {"login": "ismail-s", "name": "Ismail S"}}, "url": "https://github.com/quran/quran_android/commit/e053590d33e33f3ded28ec05c85d9bd706f3a7b2", "committedDate": "2020-08-02T12:58:25Z", "message": "Collapse tags"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "426380bebc6f7f8029176fa22b2dd2a0bc048a76", "author": {"user": {"login": "ismail-s", "name": "Ismail S"}}, "url": "https://github.com/quran/quran_android/commit/426380bebc6f7f8029176fa22b2dd2a0bc048a76", "committedDate": "2020-08-02T12:58:52Z", "message": "Change text when no bookmarks to display in widget"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU5NjUxMDY3", "url": "https://github.com/quran/quran_android/pull/1378#pullrequestreview-459651067", "createdAt": "2020-08-02T13:57:02Z", "commit": {"oid": "426380bebc6f7f8029176fa22b2dd2a0bc048a76"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wMlQxMzo1NzowMlrOG6lRvg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wMlQxMzo1NzowMlrOG6lRvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDA4MTM0Mg==", "bodyText": "These files I moved into a widget subpackage. There's already a subpackage called widgets, maybe that subpackage should be renamed to views instead?", "url": "https://github.com/quran/quran_android/pull/1378#discussion_r464081342", "createdAt": "2020-08-02T13:57:02Z", "author": {"login": "ismail-s"}, "path": "app/src/main/java/com/quran/labs/androidquran/widget/BookmarksWidgetUpdater.kt", "diffHunk": "@@ -0,0 +1,26 @@\n+package com.quran.labs.androidquran.widget", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "426380bebc6f7f8029176fa22b2dd2a0bc048a76"}, "originalPosition": 1}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "973f90f38f917807e14f8ea0a2ec0664ae977a88", "author": {"user": {"login": "ismail-s", "name": "Ismail S"}}, "url": "https://github.com/quran/quran_android/commit/973f90f38f917807e14f8ea0a2ec0664ae977a88", "committedDate": "2020-08-04T22:04:49Z", "message": "Fix exception on removing all bookmark widgets"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6a932afb97a52992ea60849d0de628add9f25654", "author": {"user": {"login": "ismail-s", "name": "Ismail S"}}, "url": "https://github.com/quran/quran_android/commit/6a932afb97a52992ea60849d0de628add9f25654", "committedDate": "2020-09-14T22:23:24Z", "message": "Add margin to text in widget"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "919c68f59a102d3200d06bfc0d209513e87d7bee", "author": {"user": {"login": "ismail-s", "name": "Ismail S"}}, "url": "https://github.com/quran/quran_android/commit/919c68f59a102d3200d06bfc0d209513e87d7bee", "committedDate": "2020-09-14T22:43:49Z", "message": "Refactor code into BookmarksWidgetSubscriber"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "22c48444a6ea1f2defe93e863d680cc9e3b6f876", "author": {"user": {"login": "ismail-s", "name": "Ismail S"}}, "url": "https://github.com/quran/quran_android/commit/22c48444a6ea1f2defe93e863d680cc9e3b6f876", "committedDate": "2020-09-19T20:56:22Z", "message": "Rename classes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3c7a4798547f9dab503f9bc02cf978e80752dcfa", "author": {"user": {"login": "ismail-s", "name": "Ismail S"}}, "url": "https://github.com/quran/quran_android/commit/3c7a4798547f9dab503f9bc02cf978e80752dcfa", "committedDate": "2020-09-19T20:57:48Z", "message": "Add docstrings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e43d6223823073f073fe2122c1aa59fd5f2f7d5c", "author": {"user": {"login": "ismail-s", "name": "Ismail S"}}, "url": "https://github.com/quran/quran_android/commit/e43d6223823073f073fe2122c1aa59fd5f2f7d5c", "committedDate": "2020-09-19T22:13:20Z", "message": "Update widget preview images"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "043117d1a4a2c4c00040f8b7bab039bece3938e8", "author": {"user": {"login": "ismail-s", "name": "Ismail S"}}, "url": "https://github.com/quran/quran_android/commit/043117d1a4a2c4c00040f8b7bab039bece3938e8", "committedDate": "2020-09-20T13:21:43Z", "message": "Merge remote-tracking branch 'origin-base/master' into add-widgets"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "07218246e4557bd7f8d5b220753586a703823e06", "author": {"user": {"login": "ismail-s", "name": "Ismail S"}}, "url": "https://github.com/quran/quran_android/commit/07218246e4557bd7f8d5b220753586a703823e06", "committedDate": "2020-09-20T13:21:58Z", "message": "Fix flaky unittest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f72bc5bd7a1e3dd6d4f160547ec87642750540e7", "author": {"user": {"login": "ismail-s", "name": "Ismail S"}}, "url": "https://github.com/quran/quran_android/commit/f72bc5bd7a1e3dd6d4f160547ec87642750540e7", "committedDate": "2020-09-26T14:22:05Z", "message": "Move SearchView to be in toolbar"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f82d46189d64ccd90ce62cac53803609e69a52cf", "author": {"user": {"login": "ismail-s", "name": "Ismail S"}}, "url": "https://github.com/quran/quran_android/commit/f82d46189d64ccd90ce62cac53803609e69a52cf", "committedDate": "2020-09-26T14:43:25Z", "message": "Consolidate code for handling action view"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "92bde9bdb5dc7617ba8fff6d1bd35549cc37bc72", "author": {"user": {"login": "ismail-s", "name": "Ismail S"}}, "url": "https://github.com/quran/quran_android/commit/92bde9bdb5dc7617ba8fff6d1bd35549cc37bc72", "committedDate": "2020-09-27T20:14:07Z", "message": "Merge remote-tracking branch 'origin-base/master' into add-widgets"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "230e3b082a08fcadf2297dba5e1451838d42c3ac", "author": {"user": {"login": "ismail-s", "name": "Ismail S"}}, "url": "https://github.com/quran/quran_android/commit/230e3b082a08fcadf2297dba5e1451838d42c3ac", "committedDate": "2020-09-27T20:14:45Z", "message": "Merge remote-tracking branch 'origin-base/master' into add-widgets"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3MjE0Njgw", "url": "https://github.com/quran/quran_android/pull/1378#pullrequestreview-497214680", "createdAt": "2020-09-28T06:23:14Z", "commit": {"oid": "230e3b082a08fcadf2297dba5e1451838d42c3ac"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQwNjoyMzoxNFrOHYv3lw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQwNjoyMzoxNFrOHYv3lw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTcxMjE1MQ==", "bodyText": "Can you please merge this with bookmarks_list_empty string? Perhaps, simply by rename that one. If you want, you  may rephrase it also. E.g.:\n<string name=\"no_bookmarks\">No bookmarks yet</string>", "url": "https://github.com/quran/quran_android/pull/1378#discussion_r495712151", "createdAt": "2020-09-28T06:23:14Z", "author": {"login": "ozbek"}, "path": "app/src/main/res/values/strings.xml", "diffHunk": "@@ -410,4 +410,7 @@\n   <!-- notification channel names [CHAR LIMIT=40] -->\n   <string name=\"notification_channel_download\">Quran Downloads</string>\n   <string name=\"notification_channel_audio\">Quran Recitation</string>\n+\n+  <!-- Widgets -->\n+  <string name=\"no_bookmarks\">No bookmarks currently set</string>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "230e3b082a08fcadf2297dba5e1451838d42c3ac"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "67aa22598ca63dbb0d0d3bb18ae193c60edd5594", "author": {"user": {"login": "ismail-s", "name": "Ismail S"}}, "url": "https://github.com/quran/quran_android/commit/67aa22598ca63dbb0d0d3bb18ae193c60edd5594", "committedDate": "2020-09-28T20:33:31Z", "message": "Consolidate bookmarks empty strings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b930b85c4e47dfd2e2845c4ad416c0d2f6af0957", "author": {"user": {"login": "ismail-s", "name": "Ismail S"}}, "url": "https://github.com/quran/quran_android/commit/b930b85c4e47dfd2e2845c4ad416c0d2f6af0957", "committedDate": "2020-09-28T22:41:20Z", "message": "Add jump button to bookmarks widget"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d208eefe78d0056c15b015ba7132364d459d379f", "author": {"user": {"login": "ismail-s", "name": "Ismail S"}}, "url": "https://github.com/quran/quran_android/commit/d208eefe78d0056c15b015ba7132364d459d379f", "committedDate": "2020-09-28T22:42:20Z", "message": "Increase range of widget resizing"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3007, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}