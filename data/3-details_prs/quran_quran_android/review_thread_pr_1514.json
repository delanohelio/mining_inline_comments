{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ1NzI3NjM5", "number": 1514, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0zMFQyMjo1NTo1MVrOFU2fbw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0zMFQyMjo1Njo0MFrOFU2fng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzU3NDA4NjIzOnYy", "diffSide": "RIGHT", "path": "app/src/main/java/com/quran/labs/androidquran/ui/fragment/BulkDownloadFragment.kt", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0zMFQyMjo1NTo1MVrOIdDJcA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0zMFQyMjo1NTo1MVrOIdDJcA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NzMzMTE4NA==", "bodyText": "val activity = requireActivity()\nval inflater = activity.layoutInflater", "url": "https://github.com/quran/quran_android/pull/1514#discussion_r567331184", "createdAt": "2021-01-30T22:55:51Z", "author": {"login": "ahmedre"}, "path": "app/src/main/java/com/quran/labs/androidquran/ui/fragment/BulkDownloadFragment.kt", "diffHunk": "@@ -0,0 +1,220 @@\n+package com.quran.labs.androidquran.ui.fragment\n+\n+import android.annotation.SuppressLint\n+import android.app.Activity\n+import android.app.Dialog\n+import android.content.Context\n+import android.content.DialogInterface\n+import android.os.Bundle\n+import android.view.LayoutInflater\n+import android.view.View\n+import android.view.ViewGroup\n+import android.view.WindowManager.LayoutParams\n+import android.widget.BaseAdapter\n+import android.widget.Filter\n+import android.widget.Filterable\n+import android.widget.TextView\n+import androidx.annotation.LayoutRes\n+import androidx.appcompat.app.AlertDialog.Builder\n+import androidx.fragment.app.DialogFragment\n+import com.quran.data.core.QuranInfo\n+import com.quran.labs.androidquran.R\n+import com.quran.labs.androidquran.R.*\n+import com.quran.labs.androidquran.ui.SheikhAudioManagerActivity\n+import com.quran.labs.androidquran.util.QuranUtils\n+import com.quran.labs.androidquran.view.ForceCompleteTextView\n+import timber.log.Timber\n+import java.util.*\n+import javax.inject.Inject\n+\n+/**\n+ * [BulkDownloadFragment] is a dialog for selecting audio download first Surah and last Surah\n+ */\n+class BulkDownloadFragment : DialogFragment() {\n+\n+  @Inject\n+  lateinit var quranInfo: QuranInfo\n+\n+  private lateinit var suraFirstInput: ForceCompleteTextView\n+  private lateinit var suraLastInput: ForceCompleteTextView\n+\n+  override fun onCreateDialog(savedInstanceState: Bundle?): Dialog {\n+    val activity: Activity? = activity\n+    val inflater = activity!!.layoutInflater", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ac38987bd58177d1adc947c93402d49471147b9e"}, "originalPosition": 43}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzU3NDA4NjcwOnYy", "diffSide": "RIGHT", "path": "app/src/main/java/com/quran/labs/androidquran/ui/fragment/BulkDownloadFragment.kt", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0zMFQyMjo1Njo0MFrOIdDJrQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0zMFQyMjo1Njo0MFrOIdDJrQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NzMzMTI0NQ==", "bodyText": "val suraFirst = max(suras.indexOf(suraFirstName) + 1, 1)", "url": "https://github.com/quran/quran_android/pull/1514#discussion_r567331245", "createdAt": "2021-01-30T22:56:40Z", "author": {"login": "ahmedre"}, "path": "app/src/main/java/com/quran/labs/androidquran/ui/fragment/BulkDownloadFragment.kt", "diffHunk": "@@ -0,0 +1,220 @@\n+package com.quran.labs.androidquran.ui.fragment\n+\n+import android.annotation.SuppressLint\n+import android.app.Activity\n+import android.app.Dialog\n+import android.content.Context\n+import android.content.DialogInterface\n+import android.os.Bundle\n+import android.view.LayoutInflater\n+import android.view.View\n+import android.view.ViewGroup\n+import android.view.WindowManager.LayoutParams\n+import android.widget.BaseAdapter\n+import android.widget.Filter\n+import android.widget.Filterable\n+import android.widget.TextView\n+import androidx.annotation.LayoutRes\n+import androidx.appcompat.app.AlertDialog.Builder\n+import androidx.fragment.app.DialogFragment\n+import com.quran.data.core.QuranInfo\n+import com.quran.labs.androidquran.R\n+import com.quran.labs.androidquran.R.*\n+import com.quran.labs.androidquran.ui.SheikhAudioManagerActivity\n+import com.quran.labs.androidquran.util.QuranUtils\n+import com.quran.labs.androidquran.view.ForceCompleteTextView\n+import timber.log.Timber\n+import java.util.*\n+import javax.inject.Inject\n+\n+/**\n+ * [BulkDownloadFragment] is a dialog for selecting audio download first Surah and last Surah\n+ */\n+class BulkDownloadFragment : DialogFragment() {\n+\n+  @Inject\n+  lateinit var quranInfo: QuranInfo\n+\n+  private lateinit var suraFirstInput: ForceCompleteTextView\n+  private lateinit var suraLastInput: ForceCompleteTextView\n+\n+  override fun onCreateDialog(savedInstanceState: Bundle?): Dialog {\n+    val activity: Activity? = activity\n+    val inflater = activity!!.layoutInflater\n+\n+    @SuppressLint(\"InflateParams\")\n+    val layout = inflater.inflate(layout.bulk_download_dialog, null)\n+\n+    val builder = Builder(activity)\n+    builder.setTitle(activity.getString(string.audio_manager_download_all))\n+\n+    // First Sura chooser\n+    suraFirstInput = layout.findViewById(R.id.first_sura_spinner)\n+    val suras = activity.resources.getStringArray(array.sura_names)\n+        .mapIndexed { index: Int, sura: String? ->\n+          QuranUtils.getLocalizedNumber(activity, index + 1) + \". \" + sura\n+        }\n+\n+    val suraFirstAdapter = InfixFilterArrayAdapter(\n+        activity,\n+        android.R.layout.simple_spinner_dropdown_item, suras\n+    )\n+    suraFirstInput.setAdapter(suraFirstAdapter)\n+\n+    suraFirstInput.setOnForceCompleteListener { _: ForceCompleteTextView?, position: Int, _: Long ->\n+      val enteredFirstText = suraFirstInput.text.toString()\n+      val suraFirstName: String?\n+\n+      suraFirstName = when {\n+        // user selects\n+        position >= 0 -> { suraFirstAdapter.getItem(position) }\n+        suras.contains(enteredFirstText) -> { enteredFirstText }\n+        // leave to the next code\n+        suraFirstAdapter.isEmpty -> { null }\n+        // maybe first initialization or invalid input\n+        else -> { suraFirstAdapter.getItem(0) }\n+      }\n+\n+      var suraFirst = suras.indexOf(suraFirstName) + 1\n+      // default to Al-Fatiha\n+      if (suraFirst == 0) suraFirst = 1", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ac38987bd58177d1adc947c93402d49471147b9e"}, "originalPosition": 80}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2058, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}