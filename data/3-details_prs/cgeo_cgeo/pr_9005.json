{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg2MDA2MjIy", "number": 9005, "title": "add logWriter utility class for separate and extended logfiles", "bodyText": "Since logcat can hold strings up to a certain length only, it is not possible to log whole HTML pages returned by gc.com during the login process.\nThis PR adds a small logging utils class to log into separate files. Can be combined with the regular Log functions in c:geo: use logWriter.d() instead of Log.d() etc., or logWriter.log() to log to separate file only.\nPR also adds specific logging for the login process to (hopefully) catch the differences sometimes happening during login at gc.com. Tries to support research for #8818.", "createdAt": "2020-09-12T19:49:27Z", "url": "https://github.com/cgeo/cgeo/pull/9005", "merged": true, "mergeCommit": {"oid": "f13deb96d97c4bcaa97a438ed71564f07b90e3f8"}, "closed": true, "closedAt": "2020-09-19T15:08:00Z", "author": {"login": "moving-bits"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdIQmKwAFqTQ4NzI1NjY5Ng==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdKYDS-ABqjM3ODUwMzc0NzU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3MjU2Njk2", "url": "https://github.com/cgeo/cgeo/pull/9005#pullrequestreview-487256696", "createdAt": "2020-09-12T21:08:48Z", "commit": {"oid": "de411d76b72d05c11ebb9806e0de38bbd7a84eb7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMlQyMTowODo0OFrOHQ3hpA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMlQyMTowODo0OFrOHQ3hpA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQ0ODk5Ng==", "bodyText": "You probably meant to write \"Log.i\" here? Because \"log\" logs to the newly created file, and when you are there the file path is known anyway", "url": "https://github.com/cgeo/cgeo/pull/9005#discussion_r487448996", "createdAt": "2020-09-12T21:08:48Z", "author": {"login": "eddiemuc"}, "path": "main/src/cgeo/geocaching/utils/LogWriter.java", "diffHunk": "@@ -0,0 +1,71 @@\n+package cgeo.geocaching.utils;\n+\n+import java.io.File;\n+import java.io.FileNotFoundException;\n+import java.io.PrintWriter;\n+\n+public class LogWriter {\n+    private PrintWriter logWriter = null;\n+    private String prefix;\n+\n+    public LogWriter(final String prefix) {\n+        this.prefix = prefix;\n+        checkLogfile();\n+    }\n+\n+    public void log(final String info) {\n+        checkLogfile();\n+        if (null != logWriter) {\n+            logWriter.println(\"--------------------------------------------------------------------\");\n+            logWriter.println(CalendarUtils.formatDateTime(\"yyyy-MM-dd HH:mm:ss.SSS\"));\n+            logWriter.println(info);\n+        }\n+    }\n+\n+    public void d(final String info) {\n+        Log.d(info);\n+        log(info);\n+    }\n+\n+    public void e(final String info) {\n+        Log.e(info);\n+        log(info);\n+    }\n+\n+    public void i(final String info) {\n+        Log.i(info);\n+        log(info);\n+    }\n+\n+    public void v(final String info) {\n+        Log.v(info);\n+        log(info);\n+    }\n+\n+    public void w(final String info) {\n+        Log.w(info);\n+        log(info);\n+    }\n+\n+    public void close() {\n+        if (null != logWriter) {\n+            log(\"end of logging\");\n+            logWriter.println(\"--------------------------------------------------------------------\");\n+            logWriter.close();\n+            logWriter = null;\n+        }\n+    }\n+\n+    private void checkLogfile() {\n+        if (null == logWriter && Log.isDebug()) {\n+            final File logfile = FileUtils.getUniqueNamedLogfile(prefix, \"txt\");\n+            try {\n+                logWriter = new PrintWriter(logfile);\n+                log(\"begin logging to file \" + logfile.getPath());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de411d76b72d05c11ebb9806e0de38bbd7a84eb7"}, "originalPosition": 64}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3MjU2ODE0", "url": "https://github.com/cgeo/cgeo/pull/9005#pullrequestreview-487256814", "createdAt": "2020-09-12T21:11:07Z", "commit": {"oid": "de411d76b72d05c11ebb9806e0de38bbd7a84eb7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMlQyMToxMTowOFrOHQ3iiw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMlQyMToxMTowOFrOHQ3iiw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQ0OTIyNw==", "bodyText": "Since \"checkLogfile\" is called on every call to \"LogWriter\" again: if an exception is catched later (and logWriter stays null) then this check will be repeated again and again, and on every call to LogWriter it will again try to instantiate the logWriter. Maybe a flag should be used so trying to set up file once it failed is not repeated", "url": "https://github.com/cgeo/cgeo/pull/9005#discussion_r487449227", "createdAt": "2020-09-12T21:11:08Z", "author": {"login": "eddiemuc"}, "path": "main/src/cgeo/geocaching/utils/LogWriter.java", "diffHunk": "@@ -0,0 +1,71 @@\n+package cgeo.geocaching.utils;\n+\n+import java.io.File;\n+import java.io.FileNotFoundException;\n+import java.io.PrintWriter;\n+\n+public class LogWriter {\n+    private PrintWriter logWriter = null;\n+    private String prefix;\n+\n+    public LogWriter(final String prefix) {\n+        this.prefix = prefix;\n+        checkLogfile();\n+    }\n+\n+    public void log(final String info) {\n+        checkLogfile();\n+        if (null != logWriter) {\n+            logWriter.println(\"--------------------------------------------------------------------\");\n+            logWriter.println(CalendarUtils.formatDateTime(\"yyyy-MM-dd HH:mm:ss.SSS\"));\n+            logWriter.println(info);\n+        }\n+    }\n+\n+    public void d(final String info) {\n+        Log.d(info);\n+        log(info);\n+    }\n+\n+    public void e(final String info) {\n+        Log.e(info);\n+        log(info);\n+    }\n+\n+    public void i(final String info) {\n+        Log.i(info);\n+        log(info);\n+    }\n+\n+    public void v(final String info) {\n+        Log.v(info);\n+        log(info);\n+    }\n+\n+    public void w(final String info) {\n+        Log.w(info);\n+        log(info);\n+    }\n+\n+    public void close() {\n+        if (null != logWriter) {\n+            log(\"end of logging\");\n+            logWriter.println(\"--------------------------------------------------------------------\");\n+            logWriter.close();\n+            logWriter = null;\n+        }\n+    }\n+\n+    private void checkLogfile() {\n+        if (null == logWriter && Log.isDebug()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de411d76b72d05c11ebb9806e0de38bbd7a84eb7"}, "originalPosition": 60}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3MjU2OTAw", "url": "https://github.com/cgeo/cgeo/pull/9005#pullrequestreview-487256900", "createdAt": "2020-09-12T21:13:19Z", "commit": {"oid": "de411d76b72d05c11ebb9806e0de38bbd7a84eb7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMlQyMToxMzoxOVrOHQ3jIQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMlQyMToxMzoxOVrOHQ3jIQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQ0OTM3Nw==", "bodyText": "My understand is that LogWriter is for logs too long to be handled by logcat? In this case, why log the info additionally to logcat (it won't be able to handle it anyway). Instead, maybe a link to the LogWriter file should be logged.", "url": "https://github.com/cgeo/cgeo/pull/9005#discussion_r487449377", "createdAt": "2020-09-12T21:13:19Z", "author": {"login": "eddiemuc"}, "path": "main/src/cgeo/geocaching/utils/LogWriter.java", "diffHunk": "@@ -0,0 +1,71 @@\n+package cgeo.geocaching.utils;\n+\n+import java.io.File;\n+import java.io.FileNotFoundException;\n+import java.io.PrintWriter;\n+\n+public class LogWriter {\n+    private PrintWriter logWriter = null;\n+    private String prefix;\n+\n+    public LogWriter(final String prefix) {\n+        this.prefix = prefix;\n+        checkLogfile();\n+    }\n+\n+    public void log(final String info) {\n+        checkLogfile();\n+        if (null != logWriter) {\n+            logWriter.println(\"--------------------------------------------------------------------\");\n+            logWriter.println(CalendarUtils.formatDateTime(\"yyyy-MM-dd HH:mm:ss.SSS\"));\n+            logWriter.println(info);\n+        }\n+    }\n+\n+    public void d(final String info) {\n+        Log.d(info);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de411d76b72d05c11ebb9806e0de38bbd7a84eb7"}, "originalPosition": 26}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "de411d76b72d05c11ebb9806e0de38bbd7a84eb7", "author": {"user": {"login": "moving-bits", "name": null}}, "url": "https://github.com/cgeo/cgeo/commit/de411d76b72d05c11ebb9806e0de38bbd7a84eb7", "committedDate": "2020-09-12T20:13:07Z", "message": "fix old scoping issue for Codacy"}, "afterCommit": {"oid": "8665bb04a33f9fdbd887df3fcc8f0b96b48cdc70", "author": {"user": {"login": "moving-bits", "name": null}}, "url": "https://github.com/cgeo/cgeo/commit/8665bb04a33f9fdbd887df3fcc8f0b96b48cdc70", "committedDate": "2020-09-19T10:40:47Z", "message": "add logwriter utility class"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8659cf45d5ec349b6fe1dcce3d4b991b2aa4d516", "author": {"user": {"login": "moving-bits", "name": null}}, "url": "https://github.com/cgeo/cgeo/commit/8659cf45d5ec349b6fe1dcce3d4b991b2aa4d516", "committedDate": "2020-09-19T10:57:25Z", "message": "add LogWriter utility class"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8665bb04a33f9fdbd887df3fcc8f0b96b48cdc70", "author": {"user": {"login": "moving-bits", "name": null}}, "url": "https://github.com/cgeo/cgeo/commit/8665bb04a33f9fdbd887df3fcc8f0b96b48cdc70", "committedDate": "2020-09-19T10:40:47Z", "message": "add logwriter utility class"}, "afterCommit": {"oid": "8659cf45d5ec349b6fe1dcce3d4b991b2aa4d516", "author": {"user": {"login": "moving-bits", "name": null}}, "url": "https://github.com/cgeo/cgeo/commit/8659cf45d5ec349b6fe1dcce3d4b991b2aa4d516", "committedDate": "2020-09-19T10:57:25Z", "message": "add LogWriter utility class"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1625, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}