{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc0NzgyMzM4", "number": 1455, "title": "Crash Fix on first occurrence what's new Screen", "bodyText": "Description\nLEARNER-7894\n\nFix crash occurred due to \"Don't Keep Activity\" option enabled\nDestroy Api call on MyCoursesListFragment.kt in OnDestroy\nHandle loader visibility", "createdAt": "2020-08-27T15:30:23Z", "url": "https://github.com/edx/edx-app-android/pull/1455", "merged": true, "mergeCommit": {"oid": "7ecb55a418477e2e49770ef94762b058ff063bf5"}, "closed": true, "closedAt": "2020-08-27T16:59:48Z", "author": {"login": "omerhabib26"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdDDFLpgFqTQ3Njg1NDgzNg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdDDUo6AFqTQ3NjkwNzM3Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc2ODU0ODM2", "url": "https://github.com/edx/edx-app-android/pull/1455#pullrequestreview-476854836", "createdAt": "2020-08-27T15:47:04Z", "commit": {"oid": "1cafe0e56bb1aceb07238cdcc29b22d07981d734"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxNTo0NzowNFrOHIWhOQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxNjoyNDozNFrOHIX-ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODUxOTYwOQ==", "bodyText": "This should be called enrolledCoursesCall", "url": "https://github.com/edx/edx-app-android/pull/1455#discussion_r478519609", "createdAt": "2020-08-27T15:47:04Z", "author": {"login": "miankhalid"}, "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/MyCoursesListFragment.kt", "diffHunk": "@@ -49,6 +49,7 @@ class MyCoursesListFragment : OfflineSupportBaseFragment(), RefreshListener {\n     @Inject\n     private lateinit var courseAPI: CourseAPI\n     private lateinit var errorNotification: FullScreenErrorNotification\n+    private lateinit var enrolledCoursesApi: Call<List<EnrolledCoursesResponse>>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1cafe0e56bb1aceb07238cdcc29b22d07981d734"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODUyMjEzMg==", "bodyText": "comment not needed.", "url": "https://github.com/edx/edx-app-android/pull/1455#discussion_r478522132", "createdAt": "2020-08-27T15:50:55Z", "author": {"login": "miankhalid"}, "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/MyCoursesListFragment.kt", "diffHunk": "@@ -100,13 +101,15 @@ class MyCoursesListFragment : OfflineSupportBaseFragment(), RefreshListener {\n     override fun onResume() {\n         super.onResume()\n         if (refreshOnResume) {\n-            loadData(showProgress = false, isCached = true)\n+            loadData(showProgress = true, isCached = true)\n             refreshOnResume = false\n         }\n     }\n \n     override fun onDestroy() {\n         super.onDestroy()\n+        // Cancel the api call in case of activity destroy", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1cafe0e56bb1aceb07238cdcc29b22d07981d734"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODUyODcwNA==", "bodyText": "why was this changed?", "url": "https://github.com/edx/edx-app-android/pull/1455#discussion_r478528704", "createdAt": "2020-08-27T16:00:56Z", "author": {"login": "miankhalid"}, "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/MyCoursesListFragment.kt", "diffHunk": "@@ -100,13 +101,15 @@ class MyCoursesListFragment : OfflineSupportBaseFragment(), RefreshListener {\n     override fun onResume() {\n         super.onResume()\n         if (refreshOnResume) {\n-            loadData(showProgress = false, isCached = true)\n+            loadData(showProgress = true, isCached = true)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1cafe0e56bb1aceb07238cdcc29b22d07981d734"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODU0MDUwMQ==", "bodyText": "isCached should be renamed to fromCache and javadoc should be updated accordingly.", "url": "https://github.com/edx/edx-app-android/pull/1455#discussion_r478540501", "createdAt": "2020-08-27T16:19:46Z", "author": {"login": "miankhalid"}, "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/MyCoursesListFragment.kt", "diffHunk": "@@ -124,23 +127,20 @@ class MyCoursesListFragment : OfflineSupportBaseFragment(), RefreshListener {\n             binding.loadingIndicator.root.visibility = View.VISIBLE\n             errorNotification.hideError()\n         }\n-        if (isCached) {\n-            getUserEnrolledCourses(courseAPI.enrolledCoursesFromCache, isCached = true)\n-        } else {\n-            getUserEnrolledCourses(courseAPI.enrolledCourses)\n-        }\n+        enrolledCoursesApi = if (isCached) courseAPI.enrolledCoursesFromCache else courseAPI.enrolledCourses", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1cafe0e56bb1aceb07238cdcc29b22d07981d734"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODU0MzUxOA==", "bodyText": "Should add a comment here:\n// Fetch latest data from server in the background after displaying previously cached data", "url": "https://github.com/edx/edx-app-android/pull/1455#discussion_r478543518", "createdAt": "2020-08-27T16:24:34Z", "author": {"login": "miankhalid"}, "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/MyCoursesListFragment.kt", "diffHunk": "@@ -124,23 +127,20 @@ class MyCoursesListFragment : OfflineSupportBaseFragment(), RefreshListener {\n             binding.loadingIndicator.root.visibility = View.VISIBLE\n             errorNotification.hideError()\n         }\n-        if (isCached) {\n-            getUserEnrolledCourses(courseAPI.enrolledCoursesFromCache, isCached = true)\n-        } else {\n-            getUserEnrolledCourses(courseAPI.enrolledCourses)\n-        }\n+        enrolledCoursesApi = if (isCached) courseAPI.enrolledCoursesFromCache else courseAPI.enrolledCourses\n+        getUserEnrolledCourses(isCached)\n     }\n \n-    private fun getUserEnrolledCourses(enrolledCoursesApi: Call<List<EnrolledCoursesResponse>>, isCached: Boolean = false) {\n+    private fun getUserEnrolledCourses(isCached: Boolean = false) {\n         enrolledCoursesApi.enqueue(object : Callback<List<EnrolledCoursesResponse>> {\n             override fun onResponse(call: Call<List<EnrolledCoursesResponse>>, response: Response<List<EnrolledCoursesResponse>>) {\n                 if (response.isSuccessful && response.code() == HttpStatus.OK) {\n                     populateCourseData(ArrayList(response.body()), isCachedData = isCached)\n                     if (isCached) {\n-                        getUserEnrolledCourses(courseAPI.enrolledCourses)\n+                        loadData(showProgress = response.body()?.isEmpty() == true, isCached = false)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1cafe0e56bb1aceb07238cdcc29b22d07981d734"}, "originalPosition": 46}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d5671272b8cb6ca4179680cfdadd6d79b60a367c", "author": {"user": {"login": "omerhabib26", "name": "Omer Habib"}}, "url": "https://github.com/edx/edx-app-android/commit/d5671272b8cb6ca4179680cfdadd6d79b60a367c", "committedDate": "2020-08-27T16:45:34Z", "message": "Fix crash on first occurrence of what's new screen\n- LEARNER-7894\nThe crash happens when \"Don't Keep Activity\" option is enabled.\nSo, by cancelling the API call and handling it gracefully when\nthe activity is destroyed fixes the problem.\nAlso, handled loader visibility when there's a cache miss."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1cafe0e56bb1aceb07238cdcc29b22d07981d734", "author": {"user": {"login": "omerhabib26", "name": "Omer Habib"}}, "url": "https://github.com/edx/edx-app-android/commit/1cafe0e56bb1aceb07238cdcc29b22d07981d734", "committedDate": "2020-08-27T15:28:35Z", "message": "Crash Fix on first occurrence what's new Screen\n- LEARNER-7894\n- Fix Crash occurred due to \"Don't Keep Activity\" option enabled\n- Destroy Api call on MyCoursesListFragment.kt\n- Handle loader visibility"}, "afterCommit": {"oid": "d5671272b8cb6ca4179680cfdadd6d79b60a367c", "author": {"user": {"login": "omerhabib26", "name": "Omer Habib"}}, "url": "https://github.com/edx/edx-app-android/commit/d5671272b8cb6ca4179680cfdadd6d79b60a367c", "committedDate": "2020-08-27T16:45:34Z", "message": "Fix crash on first occurrence of what's new screen\n- LEARNER-7894\nThe crash happens when \"Don't Keep Activity\" option is enabled.\nSo, by cancelling the API call and handling it gracefully when\nthe activity is destroyed fixes the problem.\nAlso, handled loader visibility when there's a cache miss."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc2OTA3Mzc2", "url": "https://github.com/edx/edx-app-android/pull/1455#pullrequestreview-476907376", "createdAt": "2020-08-27T16:51:16Z", "commit": {"oid": "d5671272b8cb6ca4179680cfdadd6d79b60a367c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4220, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}