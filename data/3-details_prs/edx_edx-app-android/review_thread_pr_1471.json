{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA0MzExOTUw", "number": 1471, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxMToxOTo1MlrOEucnhA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxMTo0NjowOVrOEudWGA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE3MTM4ODIwOnYy", "diffSide": "RIGHT", "path": "OpenEdXMobile/res/values/labels.xml", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxMToxOTo1MlrOHi2w6w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxMjo0NzoxNFrOHi6v4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjMxMDg5MQ==", "bodyText": "please change the name string into small letters", "url": "https://github.com/edx/edx-app-android/pull/1471#discussion_r506310891", "createdAt": "2020-10-16T11:19:52Z", "author": {"login": "omerhabib26"}, "path": "OpenEdXMobile/res/values/labels.xml", "diffHunk": "@@ -42,4 +42,6 @@\n     <string name=\"label_undo\">Undo</string>\n     <!-- Label denoting an error -->\n     <string name=\"label_error\">Error</string>\n+    <!-- Customer support text, using as button title for disabled user-->\n+    <string name=\"CUSTOMER_SUPPORT\">Customer Support</string>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e466aa2c51743c0c46a6af265672e42e0babe1c4"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjM3NjE2MA==", "bodyText": "update to label_customer_support", "url": "https://github.com/edx/edx-app-android/pull/1471#discussion_r506376160", "createdAt": "2020-10-16T12:47:14Z", "author": {"login": "farhan-arshad-dev"}, "path": "OpenEdXMobile/res/values/labels.xml", "diffHunk": "@@ -42,4 +42,6 @@\n     <string name=\"label_undo\">Undo</string>\n     <!-- Label denoting an error -->\n     <string name=\"label_error\">Error</string>\n+    <!-- Customer support text, using as button title for disabled user-->\n+    <string name=\"CUSTOMER_SUPPORT\">Customer Support</string>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjMxMDg5MQ=="}, "originalCommit": {"oid": "e466aa2c51743c0c46a6af265672e42e0babe1c4"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE3MTQwMTgwOnYy", "diffSide": "RIGHT", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/base/BaseFragmentActivity.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxMToyMzowNlrOHi254Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxMzozNzowNlrOHi-F0A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjMxMzE4NQ==", "bodyText": "IMO, we can remove the finish() from this method as we are clearing the stack in forceLogout", "url": "https://github.com/edx/edx-app-android/pull/1471#discussion_r506313185", "createdAt": "2020-10-16T11:23:06Z", "author": {"login": "omerhabib26"}, "path": "OpenEdXMobile/src/main/java/org/edx/mobile/base/BaseFragmentActivity.java", "diffHunk": "@@ -279,6 +279,9 @@ protected boolean isLandscape() {\n      */\n     @SuppressWarnings(\"unused\")\n     public void onEvent(LogoutEvent event) {\n+        environment.getRouter().forceLogout(this,\n+                environment.getAnalyticsRegistry(),\n+                environment.getNotificationDelegate());\n         finish();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e466aa2c51743c0c46a6af265672e42e0babe1c4"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjMyNzgzOA==", "bodyText": "Plus, in environment.getRouter().forceLogout we can remove the EventBus.getDefault().post(new LogoutEvent()); as it can make a loop", "url": "https://github.com/edx/edx-app-android/pull/1471#discussion_r506327838", "createdAt": "2020-10-16T11:41:32Z", "author": {"login": "omerhabib26"}, "path": "OpenEdXMobile/src/main/java/org/edx/mobile/base/BaseFragmentActivity.java", "diffHunk": "@@ -279,6 +279,9 @@ protected boolean isLandscape() {\n      */\n     @SuppressWarnings(\"unused\")\n     public void onEvent(LogoutEvent event) {\n+        environment.getRouter().forceLogout(this,\n+                environment.getAnalyticsRegistry(),\n+                environment.getNotificationDelegate());\n         finish();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjMxMzE4NQ=="}, "originalCommit": {"oid": "e466aa2c51743c0c46a6af265672e42e0babe1c4"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjM3NjY2MQ==", "bodyText": "removed.", "url": "https://github.com/edx/edx-app-android/pull/1471#discussion_r506376661", "createdAt": "2020-10-16T12:48:05Z", "author": {"login": "farhan-arshad-dev"}, "path": "OpenEdXMobile/src/main/java/org/edx/mobile/base/BaseFragmentActivity.java", "diffHunk": "@@ -279,6 +279,9 @@ protected boolean isLandscape() {\n      */\n     @SuppressWarnings(\"unused\")\n     public void onEvent(LogoutEvent event) {\n+        environment.getRouter().forceLogout(this,\n+                environment.getAnalyticsRegistry(),\n+                environment.getNotificationDelegate());\n         finish();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjMxMzE4NQ=="}, "originalCommit": {"oid": "e466aa2c51743c0c46a6af265672e42e0babe1c4"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjQzMDkyOA==", "bodyText": "added again the finish(); statment for the safe side.", "url": "https://github.com/edx/edx-app-android/pull/1471#discussion_r506430928", "createdAt": "2020-10-16T13:37:06Z", "author": {"login": "farhan-arshad-dev"}, "path": "OpenEdXMobile/src/main/java/org/edx/mobile/base/BaseFragmentActivity.java", "diffHunk": "@@ -279,6 +279,9 @@ protected boolean isLandscape() {\n      */\n     @SuppressWarnings(\"unused\")\n     public void onEvent(LogoutEvent event) {\n+        environment.getRouter().forceLogout(this,\n+                environment.getAnalyticsRegistry(),\n+                environment.getNotificationDelegate());\n         finish();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjMxMzE4NQ=="}, "originalCommit": {"oid": "e466aa2c51743c0c46a6af265672e42e0babe1c4"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE3MTQ0NjcwOnYy", "diffSide": "RIGHT", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/http/authenticator/OauthRefreshTokenAuthenticator.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxMTozMjo1N1rOHi3X2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxMjo1Mjo1N1rOHi7Iiw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjMyMDg1Ng==", "bodyText": "Can we add a doc here?\nIf the user logged In through social auth & if user got disabled then on next first API call app will force the user to logout and navigate it to the splash screen", "url": "https://github.com/edx/edx-app-android/pull/1471#discussion_r506320856", "createdAt": "2020-10-16T11:32:57Z", "author": {"login": "omerhabib26"}, "path": "OpenEdXMobile/src/main/java/org/edx/mobile/http/authenticator/OauthRefreshTokenAuthenticator.java", "diffHunk": "@@ -88,6 +91,9 @@ public synchronized Request authenticate(Route route, final Response response) t\n                                 .header(\"Authorization\", currentAuth.token_type + \" \" + currentAuth.access_token)\n                                 .build();\n                     }\n+                case DISABLED_USER_ERROR_MESSAGE:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e466aa2c51743c0c46a6af265672e42e0babe1c4"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjM4MjQ3NQ==", "bodyText": "update to\n                     // If the user is logged-in & marked as disabled then on the next server response\n                    // app will force the user to logout and navigate it to the launcher screen.", "url": "https://github.com/edx/edx-app-android/pull/1471#discussion_r506382475", "createdAt": "2020-10-16T12:52:57Z", "author": {"login": "farhan-arshad-dev"}, "path": "OpenEdXMobile/src/main/java/org/edx/mobile/http/authenticator/OauthRefreshTokenAuthenticator.java", "diffHunk": "@@ -88,6 +91,9 @@ public synchronized Request authenticate(Route route, final Response response) t\n                                 .header(\"Authorization\", currentAuth.token_type + \" \" + currentAuth.access_token)\n                                 .build();\n                     }\n+                case DISABLED_USER_ERROR_MESSAGE:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjMyMDg1Ng=="}, "originalCommit": {"oid": "e466aa2c51743c0c46a6af265672e42e0babe1c4"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE3MTUwMzgxOnYy", "diffSide": "RIGHT", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/LoginActivity.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxMTo0NToxNlrOHi3_AA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxMjo1NTo0MFrOHi7Thw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjMzMDg4MA==", "bodyText": "Can we change the subject in the email to \"Account Disabled\"", "url": "https://github.com/edx/edx-app-android/pull/1471#discussion_r506330880", "createdAt": "2020-10-16T11:45:16Z", "author": {"login": "omerhabib26"}, "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/LoginActivity.java", "diffHunk": "@@ -357,17 +357,28 @@ public void onUserLoginFailure(Exception ex, String accessToken, String backend)\n                     errorMessage.getMessageLine1(),\n                     (errorMessage.getMessageLine2() != null) ?\n                             errorMessage.getMessageLine2() : getString(R.string.login_failed));\n-        } else if (ex != null && ex instanceof HttpStatusException &&\n-                ((HttpStatusException) ex).getStatusCode() == HttpStatus.UPGRADE_REQUIRED) {\n-            LoginActivity.this.showAlertDialog(null,\n-                    getString(R.string.app_version_unsupported_login_msg),\n-                    getString(R.string.label_update),\n-                    new DialogInterface.OnClickListener() {\n-                        @Override\n-                        public void onClick(DialogInterface dialog, int which) {\n-                            AppStoreUtils.openAppInAppStore(LoginActivity.this);\n-                        }\n-                    }, getString(android.R.string.cancel), null);\n+        } else if (ex != null && ex instanceof HttpStatusException) {\n+            switch (((HttpStatusException) ex).getStatusCode()) {\n+                case HttpStatus.UPGRADE_REQUIRED:\n+                    LoginActivity.this.showAlertDialog(null,\n+                            getString(R.string.app_version_unsupported_login_msg),\n+                            getString(R.string.label_update),\n+                            (dialog, which) -> AppStoreUtils\n+                                    .openAppInAppStore(LoginActivity.this),\n+                            getString(android.R.string.cancel), null);\n+                    break;\n+                case HttpStatus.FORBIDDEN:\n+                    LoginActivity.this.showAlertDialog(getString(R.string.login_error),\n+                            getString(R.string.auth_provider_disabled_user_error),\n+                            getString(R.string.CUSTOMER_SUPPORT),\n+                            (dialog, which) -> environment.getRouter()\n+                                    .showFeedbackScreen(LoginActivity.this,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e466aa2c51743c0c46a6af265672e42e0babe1c4"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjM4NTI4Nw==", "bodyText": "done.", "url": "https://github.com/edx/edx-app-android/pull/1471#discussion_r506385287", "createdAt": "2020-10-16T12:55:40Z", "author": {"login": "farhan-arshad-dev"}, "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/LoginActivity.java", "diffHunk": "@@ -357,17 +357,28 @@ public void onUserLoginFailure(Exception ex, String accessToken, String backend)\n                     errorMessage.getMessageLine1(),\n                     (errorMessage.getMessageLine2() != null) ?\n                             errorMessage.getMessageLine2() : getString(R.string.login_failed));\n-        } else if (ex != null && ex instanceof HttpStatusException &&\n-                ((HttpStatusException) ex).getStatusCode() == HttpStatus.UPGRADE_REQUIRED) {\n-            LoginActivity.this.showAlertDialog(null,\n-                    getString(R.string.app_version_unsupported_login_msg),\n-                    getString(R.string.label_update),\n-                    new DialogInterface.OnClickListener() {\n-                        @Override\n-                        public void onClick(DialogInterface dialog, int which) {\n-                            AppStoreUtils.openAppInAppStore(LoginActivity.this);\n-                        }\n-                    }, getString(android.R.string.cancel), null);\n+        } else if (ex != null && ex instanceof HttpStatusException) {\n+            switch (((HttpStatusException) ex).getStatusCode()) {\n+                case HttpStatus.UPGRADE_REQUIRED:\n+                    LoginActivity.this.showAlertDialog(null,\n+                            getString(R.string.app_version_unsupported_login_msg),\n+                            getString(R.string.label_update),\n+                            (dialog, which) -> AppStoreUtils\n+                                    .openAppInAppStore(LoginActivity.this),\n+                            getString(android.R.string.cancel), null);\n+                    break;\n+                case HttpStatus.FORBIDDEN:\n+                    LoginActivity.this.showAlertDialog(getString(R.string.login_error),\n+                            getString(R.string.auth_provider_disabled_user_error),\n+                            getString(R.string.CUSTOMER_SUPPORT),\n+                            (dialog, which) -> environment.getRouter()\n+                                    .showFeedbackScreen(LoginActivity.this,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjMzMDg4MA=="}, "originalCommit": {"oid": "e466aa2c51743c0c46a6af265672e42e0babe1c4"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE3MTUwNzQ0OnYy", "diffSide": "RIGHT", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/RegisterActivity.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxMTo0NjowOVrOHi4BWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxMjo1NTo0NFrOHi7TsA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjMzMTQ4MQ==", "bodyText": "change email subject here as well", "url": "https://github.com/edx/edx-app-android/pull/1471#discussion_r506331481", "createdAt": "2020-10-16T11:46:09Z", "author": {"login": "omerhabib26"}, "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/RegisterActivity.java", "diffHunk": "@@ -653,9 +653,17 @@ public void onUserLoginFailure(Exception ex, String accessToken, String backend)\n         // handle if this is a LoginException\n         tryToSetUIInteraction(true);\n         logger.error(ex);\n-        SocialFactory.SOCIAL_SOURCE_TYPE socialType = SocialFactory.SOCIAL_SOURCE_TYPE.fromString(backend);\n-        updateUIOnSocialLoginToEdxFailure(socialType, accessToken);\n-\n+        if (ex instanceof HttpStatusException && ((HttpStatusException) ex).getStatusCode() == HttpStatus.FORBIDDEN) {\n+            RegisterActivity.this.showAlertDialog(getString(R.string.login_error),\n+                    getString(R.string.auth_provider_disabled_user_error),\n+                    getString(R.string.CUSTOMER_SUPPORT),\n+                    (dialog, which) -> environment.getRouter()\n+                            .showFeedbackScreen(RegisterActivity.this,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e466aa2c51743c0c46a6af265672e42e0babe1c4"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjM4NTMyOA==", "bodyText": "done.", "url": "https://github.com/edx/edx-app-android/pull/1471#discussion_r506385328", "createdAt": "2020-10-16T12:55:44Z", "author": {"login": "farhan-arshad-dev"}, "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/RegisterActivity.java", "diffHunk": "@@ -653,9 +653,17 @@ public void onUserLoginFailure(Exception ex, String accessToken, String backend)\n         // handle if this is a LoginException\n         tryToSetUIInteraction(true);\n         logger.error(ex);\n-        SocialFactory.SOCIAL_SOURCE_TYPE socialType = SocialFactory.SOCIAL_SOURCE_TYPE.fromString(backend);\n-        updateUIOnSocialLoginToEdxFailure(socialType, accessToken);\n-\n+        if (ex instanceof HttpStatusException && ((HttpStatusException) ex).getStatusCode() == HttpStatus.FORBIDDEN) {\n+            RegisterActivity.this.showAlertDialog(getString(R.string.login_error),\n+                    getString(R.string.auth_provider_disabled_user_error),\n+                    getString(R.string.CUSTOMER_SUPPORT),\n+                    (dialog, which) -> environment.getRouter()\n+                            .showFeedbackScreen(RegisterActivity.this,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjMzMTQ4MQ=="}, "originalCommit": {"oid": "e466aa2c51743c0c46a6af265672e42e0babe1c4"}, "originalPosition": 12}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 603, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}