{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk0Njc1OTI5", "number": 1390, "title": "Add Microsoft Authentication to Mobile Login / Registration.", "bodyText": "Description\nLEARNER-3877\n\nAdd Microsoft Authentication to Mobile Login / Registration.\nAdd Microsoft Log-in on registration and log-in screen.\nHandle edge cases that app leads to crash if required Microsoft configs are not available.\nGenerate Microsoft configs from the edx configs.yaml files.\n\nConfigurations:\nMICROSOFT:\n    ENABLED: true\n    CLIENT_ID: \"need to replace with Microsoft client_id\"\n    SIGNATURE_HASH: \"need to replace with Microsoft signature_hash\"\n    AUDIENCE_TYPE: \"need to replace with Microsoft audience_type\"\n    TENANT_ID: \"need to replace with Microsoft tenante_id\"\n\nAcceptance Criteria:\n\nVerify that users can register using Microsoft credentials\nVerify that existing users can log-in using their Microsoft credential\n\nKnown Limitation:\nYou can use Azure Active Directory to allow users with Microsoft Office 365 Business accounts to sign in to Open edX. Note that this feature currently does not work with other types of Microsoft accounts (such as \u201c@live.com\u201d or \u201c@hotmail.com\u201d accounts).\nRef: https://edx.readthedocs.io/projects/edx-installing-configuring-and-running/en/latest/configuration/tpa/tpa_integrate_open/tpa_oauth.html#register-the-open-edx-instance-with-azure-active-directory\nScreenshots:\n\n\n\nLogin\nRegistration\n\n\n\n\n\n\n\n\n\nRefs:\n\nhttps://identity.microsoft.com/Docs/Android\nhttps://docs.microsoft.com/en-us/azure/active-directory/develop/howto-add-branding-in-azure-ad-apps", "createdAt": "2020-03-27T10:37:40Z", "url": "https://github.com/edx/edx-app-android/pull/1390", "merged": true, "mergeCommit": {"oid": "b69a5671859c080242098ba3a08acea0569a0b41"}, "closed": true, "closedAt": "2020-04-17T11:11:13Z", "author": {"login": "farhan-arshad-dev"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcXNed1gFqTM5MjA4MzMwNw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcYe1qlABqjMyNDM4MjM4NDE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkyMDgzMzA3", "url": "https://github.com/edx/edx-app-android/pull/1390#pullrequestreview-392083307", "createdAt": "2020-04-13T11:00:49Z", "commit": {"oid": "b95a94bdc0053c5ddb1495b76dccd637d534183b"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xM1QxMTowMDo1MFrOGEjbdg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xM1QxMTozNzozMFrOGEkGlA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzQyNzk1OA==", "bodyText": "Why are we using an old version? and also a + instead of a fully resolved version?\np.s. the latest version according to docs is: implementation 'com.microsoft.identity.client:msal:1.+'", "url": "https://github.com/edx/edx-app-android/pull/1390#discussion_r407427958", "createdAt": "2020-04-13T11:00:50Z", "author": {"login": "miankhalid"}, "path": "OpenEdXMobile/build.gradle", "diffHunk": "@@ -149,6 +149,7 @@ dependencies {\n     implementation 'com.google.android.gms:play-services-cast-framework:16.2.0'\n \n     implementation 'com.facebook.android:facebook-login:5.9.0'\n+    implementation 'com.microsoft.identity.client:msal:0.3+'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b95a94bdc0053c5ddb1495b76dccd637d534183b"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzQyODgyNA==", "bodyText": "This comment should be above this line:\n// Apply the Performance Monitoring plugin to enable instrumentation", "url": "https://github.com/edx/edx-app-android/pull/1390#discussion_r407428824", "createdAt": "2020-04-13T11:03:38Z", "author": {"login": "miankhalid"}, "path": "OpenEdXMobile/build.gradle", "diffHunk": "@@ -259,6 +260,13 @@ def firebaseEnabled = firebaseConfig?.get('ENABLED')\n if (firebaseEnabled ?: false) {\n     apply plugin: 'com.google.gms.google-services'\n     // Apply the Performance Monitoring plugin to enable instrumentation\n+    // Getting some libraries conflict after adding the microsoft client library for microsoft SSO\n+    // with message \"In project '*' a resolved Google Play services library dependency depends on\n+    // another at an exact version (e.g. [1.3.1 ,2.3]).\" so ad below statement to resolve build issue.\n+    // Ref: https://stackoverflow.com/a/57479692\n+    googleServices {\n+        disableVersionCheck = true\n+    }\n     apply plugin: 'com.google.firebase.firebase-perf'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b95a94bdc0053c5ddb1495b76dccd637d534183b"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzQyOTc4OQ==", "bodyText": "I would suggest we use a block comment here instead of multi-line comments.\nnit:\n, so adding the following statement to resolve the build issue.\ninstead of\n so ad below statement to resolve build issue.", "url": "https://github.com/edx/edx-app-android/pull/1390#discussion_r407429789", "createdAt": "2020-04-13T11:06:58Z", "author": {"login": "miankhalid"}, "path": "OpenEdXMobile/build.gradle", "diffHunk": "@@ -259,6 +260,13 @@ def firebaseEnabled = firebaseConfig?.get('ENABLED')\n if (firebaseEnabled ?: false) {\n     apply plugin: 'com.google.gms.google-services'\n     // Apply the Performance Monitoring plugin to enable instrumentation\n+    // Getting some libraries conflict after adding the microsoft client library for microsoft SSO\n+    // with message \"In project '*' a resolved Google Play services library dependency depends on\n+    // another at an exact version (e.g. [1.3.1 ,2.3]).\" so ad below statement to resolve build issue.\n+    // Ref: https://stackoverflow.com/a/57479692", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b95a94bdc0053c5ddb1495b76dccd637d534183b"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzQzMDA5NQ==", "bodyText": "Also, did you try updating com.google.gms:google-services to version 4.3.3 instead?\np.s. this is also mentioned as a solution in the SO link you've added in the comment.", "url": "https://github.com/edx/edx-app-android/pull/1390#discussion_r407430095", "createdAt": "2020-04-13T11:08:03Z", "author": {"login": "miankhalid"}, "path": "OpenEdXMobile/build.gradle", "diffHunk": "@@ -259,6 +260,13 @@ def firebaseEnabled = firebaseConfig?.get('ENABLED')\n if (firebaseEnabled ?: false) {\n     apply plugin: 'com.google.gms.google-services'\n     // Apply the Performance Monitoring plugin to enable instrumentation\n+    // Getting some libraries conflict after adding the microsoft client library for microsoft SSO\n+    // with message \"In project '*' a resolved Google Play services library dependency depends on\n+    // another at an exact version (e.g. [1.3.1 ,2.3]).\" so ad below statement to resolve build issue.\n+    // Ref: https://stackoverflow.com/a/57479692\n+    googleServices {\n+        disableVersionCheck = true\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b95a94bdc0053c5ddb1495b76dccd637d534183b"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzQzNzcwOA==", "bodyText": "The task that generates auth_config.json for the config and executes for the Microsoft authentication", "url": "https://github.com/edx/edx-app-android/pull/1390#discussion_r407437708", "createdAt": "2020-04-13T11:32:50Z", "author": {"login": "miankhalid"}, "path": "OpenEdXMobile/build.gradle", "diffHunk": "@@ -510,6 +521,22 @@ android.applicationVariants.all { variant ->\n         tasks.getByName(googleServicesJsonValidationTask).dependsOn(serviceJsonTask)\n     }\n \n+    // Task that generate auth_config.json for the config and execute for the Microsoft authentication", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d8747deea9ef5a79fd9d78ba87238e430542d68c"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzQzODM5MA==", "bodyText": "java.net.URLEncoder is an unnecessary qualified reference, you can just use URLEncoder.encode instead.", "url": "https://github.com/edx/edx-app-android/pull/1390#discussion_r407438390", "createdAt": "2020-04-13T11:35:12Z", "author": {"login": "miankhalid"}, "path": "OpenEdXMobile/gradle_scripts/AndroidHelper.gradle", "diffHunk": "@@ -99,6 +99,65 @@ class AndroidHelper {\n         }\n         return available\n     }\n+\n+    static def saveMicrosoftAuthConfigs(project, microsoftConfig) {\n+        def microsoftConfigsJsonPath = project.projectDir.toString() + \"/res/raw/auth_config.json\"\n+        new FileWriter(microsoftConfigsJsonPath).withWriter {\n+            getMicrosoftConfigurations(project, microsoftConfig).writeTo(it)\n+        }\n+    }\n+\n+    static def getMicrosoftConfigurations(project, microsoftConfig) {\n+        if (isValidConfigurations(microsoftConfig)) {\n+            def jsonBuilder = new JsonBuilder()\n+            def clientId = microsoftConfig.get(\"CLIENT_ID\")\n+            def signatureHash = microsoftConfig.get(\"SIGNATURE_HASH\")\n+            def audienceType = microsoftConfig.get(\"AUDIENCE_TYPE\")\n+            def tenantId = microsoftConfig.get(\"TENANT_ID\")\n+            jsonBuilder {\n+                \"client_id\" \"$clientId\"\n+                \"authorization_user_agent\" \"DEFAULT\"\n+                \"redirect_uri\" \"msauth://\" + project.APPLICATION_ID + \"/\" + java.net.URLEncoder.encode(signatureHash, \"UTF-8\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d8747deea9ef5a79fd9d78ba87238e430542d68c"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzQzODk5Ng==", "bodyText": "why was this logic changed? previous logic seems fine to me", "url": "https://github.com/edx/edx-app-android/pull/1390#discussion_r407438996", "createdAt": "2020-04-13T11:37:30Z", "author": {"login": "miankhalid"}, "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/LoginActivity.java", "diffHunk": "@@ -145,12 +146,16 @@ public void setSocialLoginButtons(boolean googleEnabled, boolean facebookEnabled\n                                               boolean microsoftEnabled) {\n                 if (!facebookEnabled && !googleEnabled && !microsoftEnabled) {\n                     activityLoginBinding.panelLoginSocial.setVisibility(View.GONE);\n-                } else if (!facebookEnabled) {\n-                    activityLoginBinding.socialAuth.facebookButton.getRoot().setVisibility(View.GONE);\n-                } else if (!googleEnabled) {\n-                    activityLoginBinding.socialAuth.googleButton.getRoot().setVisibility(View.GONE);\n-                } else if (!microsoftEnabled) {\n-                    activityLoginBinding.socialAuth.microsoftButton.getRoot().setVisibility(View.GONE);\n+                } else {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8ba526d8fd65953090b85dc8e819ffc649e0161b"}, "originalPosition": 31}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd9c825d91be5fb4b1b20a8285bf43beb687fb8b", "author": {"user": {"login": "farhan-arshad-dev", "name": "Farhan Arshad"}}, "url": "https://github.com/edx/edx-app-android/commit/bd9c825d91be5fb4b1b20a8285bf43beb687fb8b", "committedDate": "2020-04-16T05:39:08Z", "message": "Add Microsoft Authentication to Mobile Login/Registration\n- LEARNER-3877"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d1463968997dfaf292a868c5213effb1396e835b", "author": {"user": {"login": "farhan-arshad-dev", "name": "Farhan Arshad"}}, "url": "https://github.com/edx/edx-app-android/commit/d1463968997dfaf292a868c5213effb1396e835b", "committedDate": "2020-04-15T19:33:32Z", "message": "Fix button cutting issue"}, "afterCommit": {"oid": "5c0f2eb5c36c00f6230a2f09f426892495bdda8b", "author": {"user": {"login": "farhan-arshad-dev", "name": "Farhan Arshad"}}, "url": "https://github.com/edx/edx-app-android/commit/5c0f2eb5c36c00f6230a2f09f426892495bdda8b", "committedDate": "2020-04-16T05:39:57Z", "message": "Fix button cutting issue"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5c0f2eb5c36c00f6230a2f09f426892495bdda8b", "author": {"user": {"login": "farhan-arshad-dev", "name": "Farhan Arshad"}}, "url": "https://github.com/edx/edx-app-android/commit/5c0f2eb5c36c00f6230a2f09f426892495bdda8b", "committedDate": "2020-04-16T05:39:57Z", "message": "Fix button cutting issue"}, "afterCommit": {"oid": "ae06649bcfbecdf86fd0fd6866105eb8aa3e00f4", "author": {"user": {"login": "farhan-arshad-dev", "name": "Farhan Arshad"}}, "url": "https://github.com/edx/edx-app-android/commit/ae06649bcfbecdf86fd0fd6866105eb8aa3e00f4", "committedDate": "2020-04-16T11:17:13Z", "message": "Address PR comments"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ae06649bcfbecdf86fd0fd6866105eb8aa3e00f4", "author": {"user": {"login": "farhan-arshad-dev", "name": "Farhan Arshad"}}, "url": "https://github.com/edx/edx-app-android/commit/ae06649bcfbecdf86fd0fd6866105eb8aa3e00f4", "committedDate": "2020-04-16T11:17:13Z", "message": "Address PR comments"}, "afterCommit": {"oid": "ab120e1e74d2a922965ab40e064af6215abd7f3d", "author": {"user": {"login": "farhan-arshad-dev", "name": "Farhan Arshad"}}, "url": "https://github.com/edx/edx-app-android/commit/ab120e1e74d2a922965ab40e064af6215abd7f3d", "committedDate": "2020-04-16T11:22:50Z", "message": "Address PR comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1Mjc3MzYz", "url": "https://github.com/edx/edx-app-android/pull/1390#pullrequestreview-395277363", "createdAt": "2020-04-17T08:53:56Z", "commit": {"oid": "ab120e1e74d2a922965ab40e064af6215abd7f3d"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QwODo1Mzo1NlrOGHFprA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QwODo1Mzo1NlrOGHFprA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDA4NTgwNA==", "bodyText": "This needs to be a block comment like:\n    /*\n     * Getting some libraries conflict after adding the microsoft client library for microsoft SSO\n     * another at an exact version (e.g. [1.3.1 ,2.3]).\", so adding the following statement to\n     * resolve the build issue.\n     * Ref: https://stackoverflow.com/a/57479692\n     */", "url": "https://github.com/edx/edx-app-android/pull/1390#discussion_r410085804", "createdAt": "2020-04-17T08:53:56Z", "author": {"login": "miankhalid"}, "path": "OpenEdXMobile/build.gradle", "diffHunk": "@@ -259,14 +259,15 @@ def firebaseConfig = config.get('FIREBASE')\n def firebaseEnabled = firebaseConfig?.get('ENABLED')\n if (firebaseEnabled ?: false) {\n     apply plugin: 'com.google.gms.google-services'\n-    // Apply the Performance Monitoring plugin to enable instrumentation\n     // Getting some libraries conflict after adding the microsoft client library for microsoft SSO\n     // with message \"In project '*' a resolved Google Play services library dependency depends on\n-    // another at an exact version (e.g. [1.3.1 ,2.3]).\" so ad below statement to resolve build issue.\n+    // another at an exact version (e.g. [1.3.1 ,2.3]).\", so adding the following statement to\n+    // resolve the build issue.\n     // Ref: https://stackoverflow.com/a/57479692", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ab120e1e74d2a922965ab40e064af6215abd7f3d"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5bdbc13a778fe807c965cb783196092afc84fa5e", "author": {"user": {"login": "farhan-arshad-dev", "name": "Farhan Arshad"}}, "url": "https://github.com/edx/edx-app-android/commit/5bdbc13a778fe807c965cb783196092afc84fa5e", "committedDate": "2020-04-17T10:27:35Z", "message": "Add gradle script to create auth_config.json\n- Test case fix that leads the travic-ci build failed."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ab120e1e74d2a922965ab40e064af6215abd7f3d", "author": {"user": {"login": "farhan-arshad-dev", "name": "Farhan Arshad"}}, "url": "https://github.com/edx/edx-app-android/commit/ab120e1e74d2a922965ab40e064af6215abd7f3d", "committedDate": "2020-04-16T11:22:50Z", "message": "Address PR comments"}, "afterCommit": {"oid": "5bdbc13a778fe807c965cb783196092afc84fa5e", "author": {"user": {"login": "farhan-arshad-dev", "name": "Farhan Arshad"}}, "url": "https://github.com/edx/edx-app-android/commit/5bdbc13a778fe807c965cb783196092afc84fa5e", "committedDate": "2020-04-17T10:27:35Z", "message": "Add gradle script to create auth_config.json\n- Test case fix that leads the travic-ci build failed."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4153, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}