{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc4MjQxMzMz", "number": 1375, "title": "Move firebase keys from json to config file", "bodyText": "Description\nLEARNER-7585\n\nMove google-services.json content to configs.\nGenerate google-services.json file using the configs at build time at the time of build before the keys validation task firebase.\n\nFollowing flags are used to create the google-services.json\nPROJECT_NUMBER: \"DUMMY_VALUE_REPLACE_with_PROJECT_NUMBER\"\nPROJECT_ID: \"DUMMY_VALUE_REPLACE_with_PROJECT_ID\"\nOAUTH_CLIENT_ID: \"DUMMY_VALUE_REPLACE_with_OAUTH_CLIENT_ID\"\nCURRENT_KEY: \"DUMMY_VALUE_REPLACE_with_CURRENT_KEY\"\nMOBILE_SDK_APP_ID: \"DUMMY_VALUE_REPLACE_with_MOBILE_SDK_APP_ID\"\nNote: Flags should be place under the Firebase Configurations\nFor more details see Jira Story", "createdAt": "2020-02-21T11:40:25Z", "url": "https://github.com/edx/edx-app-android/pull/1375", "merged": true, "mergeCommit": {"oid": "09e17b4acaa63c285b59820046eeeb16c64ea061"}, "closed": true, "closedAt": "2020-03-06T13:39:13Z", "author": {"login": "farhan-arshad-dev"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcIGUkBABqjMwNzM1OTMzODM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcK_a7_ABqjMxMDUxOTcxNDc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4c22adc394598db4db23095a8e0a7ddd148f0a1d", "author": {"user": {"login": "farhan-arshad-dev", "name": "Farhan Arshad"}}, "url": "https://github.com/edx/edx-app-android/commit/4c22adc394598db4db23095a8e0a7ddd148f0a1d", "committedDate": "2020-02-21T11:23:11Z", "message": "Move firebase keys from json to config file\n\n- LEARNER-7585.\n- Move google-services.json content to configs.\n- Generate google-services.json file using the\n  configs at build time at the time of build\n  before the keys validation task firebase."}, "afterCommit": {"oid": "f835b9f7da808418f5ffe06fa479e8ce418693fa", "author": {"user": {"login": "farhan-arshad-dev", "name": "Farhan Arshad"}}, "url": "https://github.com/edx/edx-app-android/commit/f835b9f7da808418f5ffe06fa479e8ce418693fa", "committedDate": "2020-02-26T10:48:29Z", "message": "Move firebase keys from json to config file\n\n- LEARNER-7585.\n- Move google-services.json content to configs.\n- Generate google-services.json file using the\n  configs at build time at the time of build\n  before the keys validation task firebase."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5MzU3NTIw", "url": "https://github.com/edx/edx-app-android/pull/1375#pullrequestreview-369357520", "createdAt": "2020-03-05T08:00:44Z", "commit": {"oid": "f835b9f7da808418f5ffe06fa479e8ce418693fa"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQwODowMDo0NFrOFyJgcg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQwODowMDo0NFrOFyJgcg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODEyODg4Mg==", "bodyText": "We should avoid the package_name hard coding.", "url": "https://github.com/edx/edx-app-android/pull/1375#discussion_r388128882", "createdAt": "2020-03-05T08:00:44Z", "author": {"login": "farhan"}, "path": "OpenEdXMobile/gradle_scripts/AndroidHelper.gradle", "diffHunk": "@@ -0,0 +1,117 @@\n+import groovy.json.JsonBuilder\n+\n+class AndroidHelper {\n+\n+    static def saveProcessedConfig(project, config) {\n+        def path = project.file(\"assets/config\")\n+        path.mkdirs()\n+        def jsonWriter = new FileWriter(path.absolutePath + \"/config.json\")\n+        def builder = new JsonBuilder(config)\n+        jsonWriter.withWriter {\n+            builder.writeTo(it)\n+        }\n+    }\n+\n+    static def saveGoogleServiceJson(project, firebaseConfig) {\n+        def googleServiceJsonPath = project.projectDir.toString() + \"/google-services.json\"\n+        new FileWriter(googleServiceJsonPath).withWriter {\n+            getGoogleServicesContent(firebaseConfig).writeTo(it)\n+        }\n+    }\n+\n+    static def getGoogleServicesContent(firebaseConfig) {\n+        if (checkRequiredFields(firebaseConfig)) {\n+            def jsonBuilder = new JsonBuilder()\n+            def projectNumber = firebaseConfig.get(\"PROJECT_NUMBER\")\n+            def projectId = firebaseConfig.get(\"PROJECT_ID\")\n+            def oauthClientId = firebaseConfig.get(\"OAUTH_CLIENT_ID\")\n+            def currentKey = firebaseConfig.get(\"CURRENT_KEY\")\n+            def otherPlatformOauthClientId = firebaseConfig.get(\"OTHER_PLATFORM_OAUTH_CLIENT_ID\")\n+            def appStoreId = firebaseConfig.get(\"APP_STORE_ID\")\n+            // construct the google-services.json fields\n+            jsonBuilder {\n+                project_info {\n+                    project_number projectNumber\n+                    firebase_url \"https://$projectId\" + \".firebaseio.com\"\n+                    project_id projectId\n+                    storage_bucket projectId + \".appspot.com\"\n+                }\n+                client([{\n+                            client_info {\n+                                \"mobilesdk_app_id\" \"1:$projectNumber:android:c04089bb49270266\"\n+                                \"android_client_info\" {\n+                                    \"package_name\" \"org.edx.mobile\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f835b9f7da808418f5ffe06fa479e8ce418693fa"}, "originalPosition": 43}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5MzU4MDYz", "url": "https://github.com/edx/edx-app-android/pull/1375#pullrequestreview-369358063", "createdAt": "2020-03-05T08:01:50Z", "commit": {"oid": "f835b9f7da808418f5ffe06fa479e8ce418693fa"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQwODowMTo1MFrOFyJiOA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNVQwODoxMDo0NFrOFyJvyg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODEyOTMzNg==", "bodyText": "We should avoid the mobilesdk_app_id value hard coding", "url": "https://github.com/edx/edx-app-android/pull/1375#discussion_r388129336", "createdAt": "2020-03-05T08:01:50Z", "author": {"login": "farhan"}, "path": "OpenEdXMobile/gradle_scripts/AndroidHelper.gradle", "diffHunk": "@@ -0,0 +1,117 @@\n+import groovy.json.JsonBuilder\n+\n+class AndroidHelper {\n+\n+    static def saveProcessedConfig(project, config) {\n+        def path = project.file(\"assets/config\")\n+        path.mkdirs()\n+        def jsonWriter = new FileWriter(path.absolutePath + \"/config.json\")\n+        def builder = new JsonBuilder(config)\n+        jsonWriter.withWriter {\n+            builder.writeTo(it)\n+        }\n+    }\n+\n+    static def saveGoogleServiceJson(project, firebaseConfig) {\n+        def googleServiceJsonPath = project.projectDir.toString() + \"/google-services.json\"\n+        new FileWriter(googleServiceJsonPath).withWriter {\n+            getGoogleServicesContent(firebaseConfig).writeTo(it)\n+        }\n+    }\n+\n+    static def getGoogleServicesContent(firebaseConfig) {\n+        if (checkRequiredFields(firebaseConfig)) {\n+            def jsonBuilder = new JsonBuilder()\n+            def projectNumber = firebaseConfig.get(\"PROJECT_NUMBER\")\n+            def projectId = firebaseConfig.get(\"PROJECT_ID\")\n+            def oauthClientId = firebaseConfig.get(\"OAUTH_CLIENT_ID\")\n+            def currentKey = firebaseConfig.get(\"CURRENT_KEY\")\n+            def otherPlatformOauthClientId = firebaseConfig.get(\"OTHER_PLATFORM_OAUTH_CLIENT_ID\")\n+            def appStoreId = firebaseConfig.get(\"APP_STORE_ID\")\n+            // construct the google-services.json fields\n+            jsonBuilder {\n+                project_info {\n+                    project_number projectNumber\n+                    firebase_url \"https://$projectId\" + \".firebaseio.com\"\n+                    project_id projectId\n+                    storage_bucket projectId + \".appspot.com\"\n+                }\n+                client([{\n+                            client_info {\n+                                \"mobilesdk_app_id\" \"1:$projectNumber:android:c04089bb49270266\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f835b9f7da808418f5ffe06fa479e8ce418693fa"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODEzMjgxMA==", "bodyText": "Let's put the minimum possible values required for our features.\nTry avoiding the info specially iOS-specific info and check if we can minimize the fields.", "url": "https://github.com/edx/edx-app-android/pull/1375#discussion_r388132810", "createdAt": "2020-03-05T08:10:44Z", "author": {"login": "farhan"}, "path": "OpenEdXMobile/gradle_scripts/AndroidHelper.gradle", "diffHunk": "@@ -0,0 +1,117 @@\n+import groovy.json.JsonBuilder\n+\n+class AndroidHelper {\n+\n+    static def saveProcessedConfig(project, config) {\n+        def path = project.file(\"assets/config\")\n+        path.mkdirs()\n+        def jsonWriter = new FileWriter(path.absolutePath + \"/config.json\")\n+        def builder = new JsonBuilder(config)\n+        jsonWriter.withWriter {\n+            builder.writeTo(it)\n+        }\n+    }\n+\n+    static def saveGoogleServiceJson(project, firebaseConfig) {\n+        def googleServiceJsonPath = project.projectDir.toString() + \"/google-services.json\"\n+        new FileWriter(googleServiceJsonPath).withWriter {\n+            getGoogleServicesContent(firebaseConfig).writeTo(it)\n+        }\n+    }\n+\n+    static def getGoogleServicesContent(firebaseConfig) {\n+        if (checkRequiredFields(firebaseConfig)) {\n+            def jsonBuilder = new JsonBuilder()\n+            def projectNumber = firebaseConfig.get(\"PROJECT_NUMBER\")\n+            def projectId = firebaseConfig.get(\"PROJECT_ID\")\n+            def oauthClientId = firebaseConfig.get(\"OAUTH_CLIENT_ID\")\n+            def currentKey = firebaseConfig.get(\"CURRENT_KEY\")\n+            def otherPlatformOauthClientId = firebaseConfig.get(\"OTHER_PLATFORM_OAUTH_CLIENT_ID\")\n+            def appStoreId = firebaseConfig.get(\"APP_STORE_ID\")\n+            // construct the google-services.json fields\n+            jsonBuilder {\n+                project_info {\n+                    project_number projectNumber\n+                    firebase_url \"https://$projectId\" + \".firebaseio.com\"\n+                    project_id projectId\n+                    storage_bucket projectId + \".appspot.com\"\n+                }\n+                client([{\n+                            client_info {\n+                                \"mobilesdk_app_id\" \"1:$projectNumber:android:c04089bb49270266\"\n+                                \"android_client_info\" {\n+                                    \"package_name\" \"org.edx.mobile\"\n+                                }\n+                            }\n+                            oauth_client([\n+                                    {\n+                                        \"client_id\" oauthClientId\n+                                        \"client_type\" 3\n+                                    }\n+                            ])\n+                            api_key(\n+                                    [{\n+                                         \"current_key\" currentKey\n+                                     }])\n+                            services {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f835b9f7da808418f5ffe06fa479e8ce418693fa"}, "originalPosition": 56}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4c0086d2ecd29630ac9b7a53a1b1cfbf8b3cb532", "author": {"user": {"login": "farhan-arshad-dev", "name": "Farhan Arshad"}}, "url": "https://github.com/edx/edx-app-android/commit/4c0086d2ecd29630ac9b7a53a1b1cfbf8b3cb532", "committedDate": "2020-03-05T11:42:51Z", "message": "Remove extra key related to the iOS"}, "afterCommit": {"oid": "fbf23722e09e5974a803709eaebad7d719dbc690", "author": {"user": {"login": "farhan-arshad-dev", "name": "Farhan Arshad"}}, "url": "https://github.com/edx/edx-app-android/commit/fbf23722e09e5974a803709eaebad7d719dbc690", "committedDate": "2020-03-06T09:29:12Z", "message": "Remove extra key related to the iOS"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwMjQ1NjU0", "url": "https://github.com/edx/edx-app-android/pull/1375#pullrequestreview-370245654", "createdAt": "2020-03-06T11:07:38Z", "commit": {"oid": "fbf23722e09e5974a803709eaebad7d719dbc690"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4e5c31d7bdacb3e9e974e635e2fcbf39115477ef", "author": {"user": {"login": "farhan-arshad-dev", "name": "Farhan Arshad"}}, "url": "https://github.com/edx/edx-app-android/commit/4e5c31d7bdacb3e9e974e635e2fcbf39115477ef", "committedDate": "2020-03-06T12:29:59Z", "message": "Move firebase keys from json to config file\n\n- LEARNER-7585.\n- Move google-services.json content to configs.\n- Generate google-services.json file using the\n  configs at build time at the time of build\n  before the keys validation task firebase."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ab308c2b57d2f85d68269126ec9f10afbd34bc91", "author": {"user": {"login": "farhan-arshad-dev", "name": "Farhan Arshad"}}, "url": "https://github.com/edx/edx-app-android/commit/ab308c2b57d2f85d68269126ec9f10afbd34bc91", "committedDate": "2020-03-06T12:37:51Z", "message": "Update README.md for firebase configurations"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fbf23722e09e5974a803709eaebad7d719dbc690", "author": {"user": {"login": "farhan-arshad-dev", "name": "Farhan Arshad"}}, "url": "https://github.com/edx/edx-app-android/commit/fbf23722e09e5974a803709eaebad7d719dbc690", "committedDate": "2020-03-06T09:29:12Z", "message": "Remove extra key related to the iOS"}, "afterCommit": {"oid": "ab308c2b57d2f85d68269126ec9f10afbd34bc91", "author": {"user": {"login": "farhan-arshad-dev", "name": "Farhan Arshad"}}, "url": "https://github.com/edx/edx-app-android/commit/ab308c2b57d2f85d68269126ec9f10afbd34bc91", "committedDate": "2020-03-06T12:37:51Z", "message": "Update README.md for firebase configurations"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4136, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}