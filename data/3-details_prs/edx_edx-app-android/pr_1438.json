{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ5Mzc1NjY4", "number": 1438, "title": "Prioritise cache response of course enrolments api", "bodyText": "Description\nLEARNER-7778\n\nRemove CourseAsyncLoader class\nprioritize cache response over API call\nUse retro for API calling instead of Async call\nRemove unnecessary code", "createdAt": "2020-07-15T09:56:56Z", "url": "https://github.com/edx/edx-app-android/pull/1438", "merged": true, "mergeCommit": {"oid": "eff85ae836ba43f90e96d90e499404813dc93ee5"}, "closed": true, "closedAt": "2020-07-22T18:06:40Z", "author": {"login": "omerhabib26"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc11OpTAFqTQ1MDU2MjY4MA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc3aBEcgBqjM1NzU1NDgzMzI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwNTYyNjgw", "url": "https://github.com/edx/edx-app-android/pull/1438#pullrequestreview-450562680", "createdAt": "2020-07-17T10:53:26Z", "commit": {"oid": "8faa0a574503f5865fdaea8a0e6e71a4ffc09b59"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QxMDo1MzoyNlrOGzOnnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QxNDo1Njo1NFrOGzWS0g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjM3MDA3Nw==", "bodyText": "no need to initialize Null.", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r456370077", "createdAt": "2020-07-17T10:53:26Z", "author": {"login": "farhan-arshad-dev"}, "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/MyCoursesListFragment.java", "diffHunk": "@@ -238,12 +183,74 @@ public void onEventMainThread(EnrolledInCourseEvent event) {\n         refreshOnResume = true;\n     }\n \n-    protected void loadData(boolean showProgress) {\n+    protected void loadData(boolean showProgress, boolean isCached) {\n+        if (isCached) {\n+            List<EnrolledCoursesResponse> enrolledCoursesResponse = null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8faa0a574503f5865fdaea8a0e6e71a4ffc09b59"}, "originalPosition": 191}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjM3MTMyOQ==", "bodyText": "these lines of code should be in the background thread otherwise increase load time.", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r456371329", "createdAt": "2020-07-17T10:56:18Z", "author": {"login": "farhan-arshad-dev"}, "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/MyCoursesListFragment.java", "diffHunk": "@@ -238,12 +183,74 @@ public void onEventMainThread(EnrolledInCourseEvent event) {\n         refreshOnResume = true;\n     }\n \n-    protected void loadData(boolean showProgress) {\n+    protected void loadData(boolean showProgress, boolean isCached) {\n+        if (isCached) {\n+            List<EnrolledCoursesResponse> enrolledCoursesResponse = null;\n+            try {\n+                enrolledCoursesResponse = executeStrict(api.getEnrolledCoursesFromCache());\n+                environment.getNotificationDelegate().syncWithServerForFailure();\n+                environment.getNotificationDelegate().checkCourseEnrollment(enrolledCoursesResponse);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8faa0a574503f5865fdaea8a0e6e71a4ffc09b59"}, "originalPosition": 195}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjM3MjI1Mg==", "bodyText": "better to display loadingIndicator before loading course data when getting cached data.", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r456372252", "createdAt": "2020-07-17T10:58:17Z", "author": {"login": "farhan-arshad-dev"}, "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/MyCoursesListFragment.java", "diffHunk": "@@ -238,12 +183,74 @@ public void onEventMainThread(EnrolledInCourseEvent event) {\n         refreshOnResume = true;\n     }\n \n-    protected void loadData(boolean showProgress) {\n+    protected void loadData(boolean showProgress, boolean isCached) {\n+        if (isCached) {\n+            List<EnrolledCoursesResponse> enrolledCoursesResponse = null;\n+            try {\n+                enrolledCoursesResponse = executeStrict(api.getEnrolledCoursesFromCache());\n+                environment.getNotificationDelegate().syncWithServerForFailure();\n+                environment.getNotificationDelegate().checkCourseEnrollment(enrolledCoursesResponse);\n+                setCourseData(new ArrayList<>(enrolledCoursesResponse));\n+                if (enrolledCoursesResponse.size() > 0) {\n+                    showProgress = false;\n+                }\n+            } catch (Exception exception) {\n+                logger.error(exception);\n+            }\n+        }\n         if (showProgress) {\n             binding.loadingIndicator.getRoot().setVisibility(View.VISIBLE);\n             errorNotification.hideError();\n         }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8faa0a574503f5865fdaea8a0e6e71a4ffc09b59"}, "originalPosition": 207}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjM3NjkzNQ==", "bodyText": "should cover all the scenarios as cover before. L#125", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r456376935", "createdAt": "2020-07-17T11:09:47Z", "author": {"login": "farhan-arshad-dev"}, "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/MyCoursesListFragment.java", "diffHunk": "@@ -238,12 +183,74 @@ public void onEventMainThread(EnrolledInCourseEvent event) {\n         refreshOnResume = true;\n     }\n \n-    protected void loadData(boolean showProgress) {\n+    protected void loadData(boolean showProgress, boolean isCached) {\n+        if (isCached) {\n+            List<EnrolledCoursesResponse> enrolledCoursesResponse = null;\n+            try {\n+                enrolledCoursesResponse = executeStrict(api.getEnrolledCoursesFromCache());\n+                environment.getNotificationDelegate().syncWithServerForFailure();\n+                environment.getNotificationDelegate().checkCourseEnrollment(enrolledCoursesResponse);\n+                setCourseData(new ArrayList<>(enrolledCoursesResponse));\n+                if (enrolledCoursesResponse.size() > 0) {\n+                    showProgress = false;\n+                }\n+            } catch (Exception exception) {\n+                logger.error(exception);\n+            }\n+        }\n         if (showProgress) {\n             binding.loadingIndicator.getRoot().setVisibility(View.VISIBLE);\n             errorNotification.hideError();\n         }\n-        getLoaderManager().restartLoader(MY_COURSE_LOADER_ID, null, this);\n+        getUserEnrolledCourses();\n+    }\n+\n+    private void getUserEnrolledCourses() {\n+        Call<List<EnrolledCoursesResponse>> apiCall = api.getEnrolledCourses();\n+        apiCall.enqueue(new Callback<List<EnrolledCoursesResponse>>() {\n+            @Override\n+            public void onResponse(Call<List<EnrolledCoursesResponse>> call, Response<List<EnrolledCoursesResponse>> response) {\n+                if (response.isSuccessful()) {\n+                    setCourseData(new ArrayList<>(response.body()));\n+                } else if (response.code() == HttpStatus.UNAUTHORIZED) {\n+                    environment.getRouter().forceLogout(getContext(),\n+                            environment.getAnalyticsRegistry(),\n+                            environment.getNotificationDelegate());\n+                } else {\n+                    errorNotification.showError(getContext(), new HttpStatusException(\n+                            Response.error(HttpStatus.INTERNAL_SERVER_ERROR,\n+                                    ResponseBody.create(MediaType.parse(\"text/plain\"), response.message()))),\n+                            R.string.lbl_reload,\n+                            new View.OnClickListener() {\n+                                @Override\n+                                public void onClick(View v) {\n+                                    if (NetworkUtil.isConnected(getContext())) {\n+                                        onRefresh();\n+                                    }\n+                                }\n+                            });\n+                }\n+                binding.swipeContainer.setRefreshing(false);\n+                binding.loadingIndicator.getRoot().setVisibility(View.GONE);\n+\n+                if (!EventBus.getDefault().isRegistered(MyCoursesListFragment.this)) {\n+                    EventBus.getDefault().registerSticky(MyCoursesListFragment.this);\n+                }\n+            }\n+\n+            @Override\n+            public void onFailure(Call<List<EnrolledCoursesResponse>> call, Throwable t) {\n+                errorNotification.showError(getContext(), t.getCause(), R.string.lbl_reload,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8faa0a574503f5865fdaea8a0e6e71a4ffc09b59"}, "originalPosition": 247}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjM3NzgxMA==", "bodyText": "IMO getEnrolledCourses is the more appropriate name here instated of apiCall", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r456377810", "createdAt": "2020-07-17T11:12:00Z", "author": {"login": "farhan-arshad-dev"}, "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/MyCoursesListFragment.java", "diffHunk": "@@ -238,12 +183,74 @@ public void onEventMainThread(EnrolledInCourseEvent event) {\n         refreshOnResume = true;\n     }\n \n-    protected void loadData(boolean showProgress) {\n+    protected void loadData(boolean showProgress, boolean isCached) {\n+        if (isCached) {\n+            List<EnrolledCoursesResponse> enrolledCoursesResponse = null;\n+            try {\n+                enrolledCoursesResponse = executeStrict(api.getEnrolledCoursesFromCache());\n+                environment.getNotificationDelegate().syncWithServerForFailure();\n+                environment.getNotificationDelegate().checkCourseEnrollment(enrolledCoursesResponse);\n+                setCourseData(new ArrayList<>(enrolledCoursesResponse));\n+                if (enrolledCoursesResponse.size() > 0) {\n+                    showProgress = false;\n+                }\n+            } catch (Exception exception) {\n+                logger.error(exception);\n+            }\n+        }\n         if (showProgress) {\n             binding.loadingIndicator.getRoot().setVisibility(View.VISIBLE);\n             errorNotification.hideError();\n         }\n-        getLoaderManager().restartLoader(MY_COURSE_LOADER_ID, null, this);\n+        getUserEnrolledCourses();\n+    }\n+\n+    private void getUserEnrolledCourses() {\n+        Call<List<EnrolledCoursesResponse>> apiCall = api.getEnrolledCourses();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8faa0a574503f5865fdaea8a0e6e71a4ffc09b59"}, "originalPosition": 213}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjM3ODE4MQ==", "bodyText": "better to add @NotNull annotation with call and response params.", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r456378181", "createdAt": "2020-07-17T11:13:01Z", "author": {"login": "farhan-arshad-dev"}, "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/MyCoursesListFragment.java", "diffHunk": "@@ -238,12 +183,74 @@ public void onEventMainThread(EnrolledInCourseEvent event) {\n         refreshOnResume = true;\n     }\n \n-    protected void loadData(boolean showProgress) {\n+    protected void loadData(boolean showProgress, boolean isCached) {\n+        if (isCached) {\n+            List<EnrolledCoursesResponse> enrolledCoursesResponse = null;\n+            try {\n+                enrolledCoursesResponse = executeStrict(api.getEnrolledCoursesFromCache());\n+                environment.getNotificationDelegate().syncWithServerForFailure();\n+                environment.getNotificationDelegate().checkCourseEnrollment(enrolledCoursesResponse);\n+                setCourseData(new ArrayList<>(enrolledCoursesResponse));\n+                if (enrolledCoursesResponse.size() > 0) {\n+                    showProgress = false;\n+                }\n+            } catch (Exception exception) {\n+                logger.error(exception);\n+            }\n+        }\n         if (showProgress) {\n             binding.loadingIndicator.getRoot().setVisibility(View.VISIBLE);\n             errorNotification.hideError();\n         }\n-        getLoaderManager().restartLoader(MY_COURSE_LOADER_ID, null, this);\n+        getUserEnrolledCourses();\n+    }\n+\n+    private void getUserEnrolledCourses() {\n+        Call<List<EnrolledCoursesResponse>> apiCall = api.getEnrolledCourses();\n+        apiCall.enqueue(new Callback<List<EnrolledCoursesResponse>>() {\n+            @Override\n+            public void onResponse(Call<List<EnrolledCoursesResponse>> call, Response<List<EnrolledCoursesResponse>> response) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8faa0a574503f5865fdaea8a0e6e71a4ffc09b59"}, "originalPosition": 216}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjM4MjY1Ng==", "bodyText": "IMO, we have to check response code 200, there is the min chance to get other response code, as isSuccessful Returns true if response code is in the range [200..300).", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r456382656", "createdAt": "2020-07-17T11:24:17Z", "author": {"login": "farhan-arshad-dev"}, "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/MyCoursesListFragment.java", "diffHunk": "@@ -238,12 +183,74 @@ public void onEventMainThread(EnrolledInCourseEvent event) {\n         refreshOnResume = true;\n     }\n \n-    protected void loadData(boolean showProgress) {\n+    protected void loadData(boolean showProgress, boolean isCached) {\n+        if (isCached) {\n+            List<EnrolledCoursesResponse> enrolledCoursesResponse = null;\n+            try {\n+                enrolledCoursesResponse = executeStrict(api.getEnrolledCoursesFromCache());\n+                environment.getNotificationDelegate().syncWithServerForFailure();\n+                environment.getNotificationDelegate().checkCourseEnrollment(enrolledCoursesResponse);\n+                setCourseData(new ArrayList<>(enrolledCoursesResponse));\n+                if (enrolledCoursesResponse.size() > 0) {\n+                    showProgress = false;\n+                }\n+            } catch (Exception exception) {\n+                logger.error(exception);\n+            }\n+        }\n         if (showProgress) {\n             binding.loadingIndicator.getRoot().setVisibility(View.VISIBLE);\n             errorNotification.hideError();\n         }\n-        getLoaderManager().restartLoader(MY_COURSE_LOADER_ID, null, this);\n+        getUserEnrolledCourses();\n+    }\n+\n+    private void getUserEnrolledCourses() {\n+        Call<List<EnrolledCoursesResponse>> apiCall = api.getEnrolledCourses();\n+        apiCall.enqueue(new Callback<List<EnrolledCoursesResponse>>() {\n+            @Override\n+            public void onResponse(Call<List<EnrolledCoursesResponse>> call, Response<List<EnrolledCoursesResponse>> response) {\n+                if (response.isSuccessful()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8faa0a574503f5865fdaea8a0e6e71a4ffc09b59"}, "originalPosition": 217}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjM4NTI4Mw==", "bodyText": "better to replace with lambda notation.", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r456385283", "createdAt": "2020-07-17T11:30:58Z", "author": {"login": "farhan-arshad-dev"}, "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/MyCoursesListFragment.java", "diffHunk": "@@ -238,12 +183,74 @@ public void onEventMainThread(EnrolledInCourseEvent event) {\n         refreshOnResume = true;\n     }\n \n-    protected void loadData(boolean showProgress) {\n+    protected void loadData(boolean showProgress, boolean isCached) {\n+        if (isCached) {\n+            List<EnrolledCoursesResponse> enrolledCoursesResponse = null;\n+            try {\n+                enrolledCoursesResponse = executeStrict(api.getEnrolledCoursesFromCache());\n+                environment.getNotificationDelegate().syncWithServerForFailure();\n+                environment.getNotificationDelegate().checkCourseEnrollment(enrolledCoursesResponse);\n+                setCourseData(new ArrayList<>(enrolledCoursesResponse));\n+                if (enrolledCoursesResponse.size() > 0) {\n+                    showProgress = false;\n+                }\n+            } catch (Exception exception) {\n+                logger.error(exception);\n+            }\n+        }\n         if (showProgress) {\n             binding.loadingIndicator.getRoot().setVisibility(View.VISIBLE);\n             errorNotification.hideError();\n         }\n-        getLoaderManager().restartLoader(MY_COURSE_LOADER_ID, null, this);\n+        getUserEnrolledCourses();\n+    }\n+\n+    private void getUserEnrolledCourses() {\n+        Call<List<EnrolledCoursesResponse>> apiCall = api.getEnrolledCourses();\n+        apiCall.enqueue(new Callback<List<EnrolledCoursesResponse>>() {\n+            @Override\n+            public void onResponse(Call<List<EnrolledCoursesResponse>> call, Response<List<EnrolledCoursesResponse>> response) {\n+                if (response.isSuccessful()) {\n+                    setCourseData(new ArrayList<>(response.body()));\n+                } else if (response.code() == HttpStatus.UNAUTHORIZED) {\n+                    environment.getRouter().forceLogout(getContext(),\n+                            environment.getAnalyticsRegistry(),\n+                            environment.getNotificationDelegate());\n+                } else {\n+                    errorNotification.showError(getContext(), new HttpStatusException(\n+                            Response.error(HttpStatus.INTERNAL_SERVER_ERROR,\n+                                    ResponseBody.create(MediaType.parse(\"text/plain\"), response.message()))),\n+                            R.string.lbl_reload,\n+                            new View.OnClickListener() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8faa0a574503f5865fdaea8a0e6e71a4ffc09b59"}, "originalPosition": 228}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjQ4OTIwNw==", "bodyText": "there should be more appropriate method name e.d populateCourseData.", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r456489207", "createdAt": "2020-07-17T14:46:49Z", "author": {"login": "farhan-arshad-dev"}, "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/MyCoursesListFragment.java", "diffHunk": "@@ -110,70 +108,25 @@ public void onRefresh() {\n     @Override\n     public void onViewCreated(View view, Bundle savedInstanceState) {\n         super.onViewCreated(view, savedInstanceState);\n-        loadData(true);\n-    }\n-\n-    @Override\n-    public Loader<AsyncTaskResult<List<EnrolledCoursesResponse>>> onCreateLoader(int i, Bundle bundle) {\n-        return new CoursesAsyncLoader(getActivity());\n+        loadData(true, true);\n     }\n \n-    @Override\n-    public void onLoadFinished(Loader<AsyncTaskResult<List<EnrolledCoursesResponse>>> asyncTaskResultLoader, AsyncTaskResult<List<EnrolledCoursesResponse>> result) {\n-        adapter.clear();\n-        final Exception exception = result.getEx();\n-        if (exception != null) {\n-            if (exception instanceof AuthException) {\n-                loginPrefs.clear();\n-                getActivity().finish();\n-            } else if (exception instanceof HttpStatusException) {\n-                final HttpStatusException httpStatusException = (HttpStatusException) exception;\n-                switch (httpStatusException.getStatusCode()) {\n-                    case HttpStatus.UNAUTHORIZED: {\n-                        environment.getRouter().forceLogout(getContext(),\n-                                environment.getAnalyticsRegistry(),\n-                                environment.getNotificationDelegate());\n-                        break;\n-                    }\n-                }\n-            } else {\n-                logger.error(exception);\n-            }\n-\n-            errorNotification.showError(getActivity(), exception, R.string.lbl_reload,\n-                    new View.OnClickListener() {\n-                        @Override\n-                        public void onClick(View v) {\n-                            if (NetworkUtil.isConnected(getContext())) {\n-                                onRefresh();\n-                            }\n-                        }\n-                    });\n-        } else if (result.getResult() != null) {\n-            ArrayList<EnrolledCoursesResponse> newItems = new ArrayList<EnrolledCoursesResponse>(result.getResult());\n-\n-            updateDatabaseAfterDownload(newItems);\n-\n-            if (result.getResult().size() > 0) {\n-                adapter.setItems(newItems);\n-            }\n-            addFindCoursesFooter();\n-            adapter.notifyDataSetChanged();\n+    private void setCourseData(ArrayList<EnrolledCoursesResponse> data) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8faa0a574503f5865fdaea8a0e6e71a4ffc09b59"}, "originalPosition": 132}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjQ5MDU4NQ==", "bodyText": "As these line of code is executed in any case pass/fail service response. Should cover in retrofit call fail/success too.", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r456490585", "createdAt": "2020-07-17T14:48:54Z", "author": {"login": "farhan-arshad-dev"}, "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/MyCoursesListFragment.java", "diffHunk": "@@ -110,70 +108,25 @@ public void onRefresh() {\n     @Override\n     public void onViewCreated(View view, Bundle savedInstanceState) {\n         super.onViewCreated(view, savedInstanceState);\n-        loadData(true);\n-    }\n-\n-    @Override\n-    public Loader<AsyncTaskResult<List<EnrolledCoursesResponse>>> onCreateLoader(int i, Bundle bundle) {\n-        return new CoursesAsyncLoader(getActivity());\n+        loadData(true, true);\n     }\n \n-    @Override\n-    public void onLoadFinished(Loader<AsyncTaskResult<List<EnrolledCoursesResponse>>> asyncTaskResultLoader, AsyncTaskResult<List<EnrolledCoursesResponse>> result) {\n-        adapter.clear();\n-        final Exception exception = result.getEx();\n-        if (exception != null) {\n-            if (exception instanceof AuthException) {\n-                loginPrefs.clear();\n-                getActivity().finish();\n-            } else if (exception instanceof HttpStatusException) {\n-                final HttpStatusException httpStatusException = (HttpStatusException) exception;\n-                switch (httpStatusException.getStatusCode()) {\n-                    case HttpStatus.UNAUTHORIZED: {\n-                        environment.getRouter().forceLogout(getContext(),\n-                                environment.getAnalyticsRegistry(),\n-                                environment.getNotificationDelegate());\n-                        break;\n-                    }\n-                }\n-            } else {\n-                logger.error(exception);\n-            }\n-\n-            errorNotification.showError(getActivity(), exception, R.string.lbl_reload,\n-                    new View.OnClickListener() {\n-                        @Override\n-                        public void onClick(View v) {\n-                            if (NetworkUtil.isConnected(getContext())) {\n-                                onRefresh();\n-                            }\n-                        }\n-                    });\n-        } else if (result.getResult() != null) {\n-            ArrayList<EnrolledCoursesResponse> newItems = new ArrayList<EnrolledCoursesResponse>(result.getResult());\n-\n-            updateDatabaseAfterDownload(newItems);\n-\n-            if (result.getResult().size() > 0) {\n-                adapter.setItems(newItems);\n-            }\n-            addFindCoursesFooter();\n-            adapter.notifyDataSetChanged();\n+    private void setCourseData(ArrayList<EnrolledCoursesResponse> data) {\n+        updateDatabaseAfterDownload(data);\n \n-            if (adapter.isEmpty() && !ConfigUtil.Companion.isCourseDiscoveryEnabled(environment)) {\n-                errorNotification.showError(R.string.no_courses_to_display,\n-                        FontAwesomeIcons.fa_exclamation_circle, 0, null);\n-                binding.myCourseList.setVisibility(View.GONE);\n-            } else {\n-                binding.myCourseList.setVisibility(View.VISIBLE);\n-                errorNotification.hideError();\n-            }\n+        if (data.size() > 0) {\n+            adapter.setItems(data);\n         }\n-        binding.swipeContainer.setRefreshing(false);\n-        binding.loadingIndicator.getRoot().setVisibility(View.GONE);\n+        addFindCoursesFooter();\n+        adapter.notifyDataSetChanged();\n \n-        if (!EventBus.getDefault().isRegistered(MyCoursesListFragment.this)) {\n-            EventBus.getDefault().registerSticky(MyCoursesListFragment.this);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8faa0a574503f5865fdaea8a0e6e71a4ffc09b59"}, "originalPosition": 152}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjQ5MTQ5Nw==", "bodyText": "should create a common method to show the error message, as these lines of code also using in case of success.", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r456491497", "createdAt": "2020-07-17T14:50:12Z", "author": {"login": "farhan-arshad-dev"}, "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/MyCoursesListFragment.java", "diffHunk": "@@ -238,12 +183,74 @@ public void onEventMainThread(EnrolledInCourseEvent event) {\n         refreshOnResume = true;\n     }\n \n-    protected void loadData(boolean showProgress) {\n+    protected void loadData(boolean showProgress, boolean isCached) {\n+        if (isCached) {\n+            List<EnrolledCoursesResponse> enrolledCoursesResponse = null;\n+            try {\n+                enrolledCoursesResponse = executeStrict(api.getEnrolledCoursesFromCache());\n+                environment.getNotificationDelegate().syncWithServerForFailure();\n+                environment.getNotificationDelegate().checkCourseEnrollment(enrolledCoursesResponse);\n+                setCourseData(new ArrayList<>(enrolledCoursesResponse));\n+                if (enrolledCoursesResponse.size() > 0) {\n+                    showProgress = false;\n+                }\n+            } catch (Exception exception) {\n+                logger.error(exception);\n+            }\n+        }\n         if (showProgress) {\n             binding.loadingIndicator.getRoot().setVisibility(View.VISIBLE);\n             errorNotification.hideError();\n         }\n-        getLoaderManager().restartLoader(MY_COURSE_LOADER_ID, null, this);\n+        getUserEnrolledCourses();\n+    }\n+\n+    private void getUserEnrolledCourses() {\n+        Call<List<EnrolledCoursesResponse>> apiCall = api.getEnrolledCourses();\n+        apiCall.enqueue(new Callback<List<EnrolledCoursesResponse>>() {\n+            @Override\n+            public void onResponse(Call<List<EnrolledCoursesResponse>> call, Response<List<EnrolledCoursesResponse>> response) {\n+                if (response.isSuccessful()) {\n+                    setCourseData(new ArrayList<>(response.body()));\n+                } else if (response.code() == HttpStatus.UNAUTHORIZED) {\n+                    environment.getRouter().forceLogout(getContext(),\n+                            environment.getAnalyticsRegistry(),\n+                            environment.getNotificationDelegate());\n+                } else {\n+                    errorNotification.showError(getContext(), new HttpStatusException(\n+                            Response.error(HttpStatus.INTERNAL_SERVER_ERROR,\n+                                    ResponseBody.create(MediaType.parse(\"text/plain\"), response.message()))),\n+                            R.string.lbl_reload,\n+                            new View.OnClickListener() {\n+                                @Override\n+                                public void onClick(View v) {\n+                                    if (NetworkUtil.isConnected(getContext())) {\n+                                        onRefresh();\n+                                    }\n+                                }\n+                            });\n+                }\n+                binding.swipeContainer.setRefreshing(false);\n+                binding.loadingIndicator.getRoot().setVisibility(View.GONE);\n+\n+                if (!EventBus.getDefault().isRegistered(MyCoursesListFragment.this)) {\n+                    EventBus.getDefault().registerSticky(MyCoursesListFragment.this);\n+                }\n+            }\n+\n+            @Override\n+            public void onFailure(Call<List<EnrolledCoursesResponse>> call, Throwable t) {\n+                errorNotification.showError(getContext(), t.getCause(), R.string.lbl_reload,\n+                        new View.OnClickListener() {\n+                            @Override\n+                            public void onClick(View v) {\n+                                if (NetworkUtil.isConnected(getContext())) {\n+                                    onRefresh();\n+                                }\n+                            }\n+                        });", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8faa0a574503f5865fdaea8a0e6e71a4ffc09b59"}, "originalPosition": 255}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjQ5NTgyNg==", "bodyText": "should place these line of code in onFailure case too.", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r456495826", "createdAt": "2020-07-17T14:56:54Z", "author": {"login": "farhan-arshad-dev"}, "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/MyCoursesListFragment.java", "diffHunk": "@@ -238,12 +183,74 @@ public void onEventMainThread(EnrolledInCourseEvent event) {\n         refreshOnResume = true;\n     }\n \n-    protected void loadData(boolean showProgress) {\n+    protected void loadData(boolean showProgress, boolean isCached) {\n+        if (isCached) {\n+            List<EnrolledCoursesResponse> enrolledCoursesResponse = null;\n+            try {\n+                enrolledCoursesResponse = executeStrict(api.getEnrolledCoursesFromCache());\n+                environment.getNotificationDelegate().syncWithServerForFailure();\n+                environment.getNotificationDelegate().checkCourseEnrollment(enrolledCoursesResponse);\n+                setCourseData(new ArrayList<>(enrolledCoursesResponse));\n+                if (enrolledCoursesResponse.size() > 0) {\n+                    showProgress = false;\n+                }\n+            } catch (Exception exception) {\n+                logger.error(exception);\n+            }\n+        }\n         if (showProgress) {\n             binding.loadingIndicator.getRoot().setVisibility(View.VISIBLE);\n             errorNotification.hideError();\n         }\n-        getLoaderManager().restartLoader(MY_COURSE_LOADER_ID, null, this);\n+        getUserEnrolledCourses();\n+    }\n+\n+    private void getUserEnrolledCourses() {\n+        Call<List<EnrolledCoursesResponse>> apiCall = api.getEnrolledCourses();\n+        apiCall.enqueue(new Callback<List<EnrolledCoursesResponse>>() {\n+            @Override\n+            public void onResponse(Call<List<EnrolledCoursesResponse>> call, Response<List<EnrolledCoursesResponse>> response) {\n+                if (response.isSuccessful()) {\n+                    setCourseData(new ArrayList<>(response.body()));\n+                } else if (response.code() == HttpStatus.UNAUTHORIZED) {\n+                    environment.getRouter().forceLogout(getContext(),\n+                            environment.getAnalyticsRegistry(),\n+                            environment.getNotificationDelegate());\n+                } else {\n+                    errorNotification.showError(getContext(), new HttpStatusException(\n+                            Response.error(HttpStatus.INTERNAL_SERVER_ERROR,\n+                                    ResponseBody.create(MediaType.parse(\"text/plain\"), response.message()))),\n+                            R.string.lbl_reload,\n+                            new View.OnClickListener() {\n+                                @Override\n+                                public void onClick(View v) {\n+                                    if (NetworkUtil.isConnected(getContext())) {\n+                                        onRefresh();\n+                                    }\n+                                }\n+                            });\n+                }\n+                binding.swipeContainer.setRefreshing(false);\n+                binding.loadingIndicator.getRoot().setVisibility(View.GONE);\n+\n+                if (!EventBus.getDefault().isRegistered(MyCoursesListFragment.this)) {\n+                    EventBus.getDefault().registerSticky(MyCoursesListFragment.this);\n+                }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8faa0a574503f5865fdaea8a0e6e71a4ffc09b59"}, "originalPosition": 242}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyMzcyMDU4", "url": "https://github.com/edx/edx-app-android/pull/1438#pullrequestreview-452372058", "createdAt": "2020-07-21T11:42:00Z", "commit": {"oid": "cb391aa762efb5db818e222477781fe218d8960e"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 19, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxMTo0MjowMFrOG00Gfw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxODoyNjoyOFrOG1EkJw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODAzMjc2Nw==", "bodyText": "Need auto-format.", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r458032767", "createdAt": "2020-07-21T11:42:00Z", "author": {"login": "farhan-arshad-dev"}, "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/MyCoursesListFragment.kt", "diffHunk": "@@ -0,0 +1,256 @@\n+package org.edx.mobile.view", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb391aa762efb5db818e222477781fe218d8960e"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODAzNDI4MQ==", "bodyText": "Need to remove single lambda parameter declaration.", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r458034281", "createdAt": "2020-07-21T11:44:54Z", "author": {"login": "farhan-arshad-dev"}, "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/MyCoursesListFragment.kt", "diffHunk": "@@ -0,0 +1,256 @@\n+package org.edx.mobile.view\n+\n+import android.os.Bundle\n+import android.view.LayoutInflater\n+import android.view.View\n+import android.view.ViewGroup\n+import androidx.databinding.DataBindingUtil\n+import com.joanzapata.iconify.fonts.FontAwesomeIcons\n+import de.greenrobot.event.EventBus\n+import okhttp3.MediaType\n+import okhttp3.ResponseBody\n+import org.edx.mobile.R\n+import org.edx.mobile.core.IEdxEnvironment\n+import org.edx.mobile.course.CourseAPI\n+import org.edx.mobile.databinding.FragmentMyCoursesListBinding\n+import org.edx.mobile.databinding.PanelFindCourseBinding\n+import org.edx.mobile.deeplink.Screen\n+import org.edx.mobile.event.EnrolledInCourseEvent\n+import org.edx.mobile.event.MainDashboardRefreshEvent\n+import org.edx.mobile.event.MoveToDiscoveryTabEvent\n+import org.edx.mobile.event.NetworkConnectivityChangeEvent\n+import org.edx.mobile.exception.AuthException\n+import org.edx.mobile.http.HttpStatus\n+import org.edx.mobile.http.HttpStatusException\n+import org.edx.mobile.http.notifications.FullScreenErrorNotification\n+import org.edx.mobile.interfaces.RefreshListener\n+import org.edx.mobile.logger.Logger\n+import org.edx.mobile.model.api.EnrolledCoursesResponse\n+import org.edx.mobile.module.db.DataCallback\n+import org.edx.mobile.module.prefs.LoginPrefs\n+import org.edx.mobile.util.ConfigUtil.Companion.isCourseDiscoveryEnabled\n+import org.edx.mobile.util.NetworkUtil\n+import org.edx.mobile.util.UiUtil\n+import org.edx.mobile.view.adapters.MyCoursesAdapter\n+import retrofit2.Call\n+import retrofit2.Callback\n+import retrofit2.Response\n+import java.util.*\n+import javax.inject.Inject\n+\n+class MyCoursesListFragment : OfflineSupportBaseFragment(), RefreshListener {\n+    private lateinit var adapter: MyCoursesAdapter\n+    private lateinit var binding: FragmentMyCoursesListBinding\n+    private val logger = Logger(javaClass.simpleName)\n+    private var refreshOnResume = false\n+    @Inject\n+    private var environment: IEdxEnvironment? = null\n+    @Inject\n+    var api: CourseAPI? = null\n+    private lateinit var errorNotification: FullScreenErrorNotification\n+    //TODO: All these callbacks aren't essentially part of MyCoursesListFragment and should move in\n+    // the Tabs container fragment that's going to be implemented in LEARNER-3251\n+    override fun onCreate(savedInstanceState: Bundle?) {\n+        super.onCreate(savedInstanceState)\n+        adapter = object : MyCoursesAdapter(activity, environment) {\n+            override fun onItemClicked(model: EnrolledCoursesResponse) {\n+                environment.router.showCourseDashboardTabs(activity!!, model, false)\n+            }\n+\n+            override fun onAnnouncementClicked(model: EnrolledCoursesResponse) {\n+                environment.router.showCourseDashboardTabs(activity!!, model, true)\n+            }\n+        }\n+    }\n+\n+    override fun onCreateView(inflater: LayoutInflater, container: ViewGroup?,\n+                              savedInstanceState: Bundle?): View? {\n+        binding = DataBindingUtil.inflate(inflater, R.layout.fragment_my_courses_list, container, false)\n+        errorNotification = FullScreenErrorNotification(binding.myCourseList)\n+        binding.swipeContainer.setOnRefreshListener {\n+            // Hide the progress bar as swipe layout has its own progress indicator\n+            binding.loadingIndicator.root.visibility = View.GONE\n+            errorNotification.hideError()\n+            loadData(showProgress = false, isCached = false)\n+        }\n+        UiUtil.setSwipeRefreshLayoutColors(binding.swipeContainer)\n+        // Add empty view to cause divider to render at the top of the list.\n+        binding.myCourseList.addHeaderView(View(context), null, false)\n+        binding.myCourseList.adapter = adapter\n+        binding.myCourseList.onItemClickListener = adapter\n+        return binding.root\n+    }\n+\n+    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {\n+        super.onViewCreated(view, savedInstanceState)\n+        loadData(showProgress = true, isCached = true)\n+    }\n+\n+    private fun populateCourseData(data: ArrayList<EnrolledCoursesResponse>) {\n+        updateDatabaseAfterDownload(data)\n+        if (data.size > 0) {\n+            adapter.setItems(data)\n+        }\n+        addFindCoursesFooter()\n+        adapter.notifyDataSetChanged()\n+        if (adapter.isEmpty && !isCourseDiscoveryEnabled(environment!!)) {\n+            errorNotification.showError(R.string.no_courses_to_display,\n+                    FontAwesomeIcons.fa_exclamation_circle, 0, null)\n+            binding.myCourseList.visibility = View.GONE\n+        } else {\n+            binding.myCourseList.visibility = View.VISIBLE\n+            errorNotification.hideError()\n+        }\n+    }\n+\n+    private fun updateDatabaseAfterDownload(list: ArrayList<EnrolledCoursesResponse>?) {\n+        if (list != null && list.size > 0) { //update all videos in the DB as Deactivated\n+            environment?.database?.updateAllVideosAsDeactivated(dataCallback)\n+            for (i in list.indices) { //Check if the flag of isIs_active is marked to true,\n+                //then activate all videos\n+                if (list[i].isIs_active) { //update all videos for a course fetched in the API as Activated\n+                    environment?.database?.updateVideosActivatedForCourse(list[i].course.id,\n+                            dataCallback)\n+                } else {\n+                    list.removeAt(i)\n+                }\n+            }\n+            //Delete all videos which are marked as Deactivated in the database\n+            environment?.storage?.deleteAllUnenrolledVideos()\n+        }\n+    }\n+\n+    private val dataCallback: DataCallback<Int> = object : DataCallback<Int>() {\n+        override fun onResult(result: Int) {}\n+        override fun onFail(ex: Exception) {\n+            logger.error(ex)\n+        }\n+    }\n+\n+    override fun onResume() {\n+        super.onResume()\n+        if (refreshOnResume) {\n+            loadData(showProgress = false, isCached = true)\n+            refreshOnResume = false\n+        }\n+    }\n+\n+    override fun onDestroy() {\n+        super.onDestroy()\n+        EventBus.getDefault().unregister(this)\n+    }\n+\n+    fun onEventMainThread(event: EnrolledInCourseEvent?) {\n+        refreshOnResume = true\n+    }\n+\n+    private fun loadData(showProgress: Boolean, isCached: Boolean) {\n+        if (showProgress) {\n+            binding.loadingIndicator.root.visibility = View.VISIBLE\n+            errorNotification.hideError()\n+        }\n+        if (isCached) {\n+            getUserEnrolledCourses(api?.enrolledCoursesFromCache!!)\n+        }\n+        getUserEnrolledCourses(api?.enrolledCourses!!)\n+    }\n+\n+    private fun invalidateView() {\n+        binding.swipeContainer.isRefreshing = false\n+        binding.loadingIndicator.root.visibility = View.GONE\n+\n+        if (!EventBus.getDefault().isRegistered(this@MyCoursesListFragment)) {\n+            EventBus.getDefault().registerSticky(this@MyCoursesListFragment)\n+        }\n+    }\n+\n+    private fun showError(error: Throwable) {\n+        context?.let { context ->\n+            error.cause?.let { cause ->\n+                errorNotification.showError(context, cause, R.string.lbl_reload) {\n+                    if (NetworkUtil.isConnected(context)) {\n+                        onRefresh()\n+                    }\n+                }\n+            }\n+        }\n+    }\n+\n+    private fun getUserEnrolledCourses(enrolledCoursesApi: Call<List<EnrolledCoursesResponse>>) {\n+        enrolledCoursesApi.enqueue(object : Callback<List<EnrolledCoursesResponse>> {\n+            override fun onResponse(call: Call<List<EnrolledCoursesResponse>>, response: Response<List<EnrolledCoursesResponse>>) {\n+                if (response.isSuccessful && response.code() == HttpStatus.OK) {\n+                    populateCourseData(ArrayList(response.body()))\n+                } else if (response.code() == HttpStatus.UNAUTHORIZED) {\n+                    environment?.router?.forceLogout(context,\n+                            environment?.analyticsRegistry,\n+                            environment?.notificationDelegate)\n+                } else {\n+                    showError(HttpStatusException(Response.error<Any>(HttpStatus.INTERNAL_SERVER_ERROR,\n+                            ResponseBody.create(MediaType.parse(\"text/plain\"), response.message()))))\n+                }\n+                invalidateView()\n+            }\n+\n+            override fun onFailure(call: Call<List<EnrolledCoursesResponse>>, t: Throwable) {\n+                if (t is AuthException || (t is HttpStatusException && t.statusCode == HttpStatus.UNAUTHORIZED)) {\n+                    environment?.router?.forceLogout(context,\n+                            environment?.analyticsRegistry,\n+                            environment?.notificationDelegate)\n+                } else {\n+                    showError(t)\n+                    invalidateView()\n+                }\n+            }\n+        })\n+\n+    }\n+\n+    private fun addFindCoursesFooter() { // Validate footer is not already added.\n+        if (binding.myCourseList.footerViewsCount > 0) {\n+            return\n+        }\n+        if (isCourseDiscoveryEnabled(environment!!)) { // Add 'Find a Course' list item as a footer.\n+            val footer: PanelFindCourseBinding = DataBindingUtil.inflate(LayoutInflater.from(activity),\n+                    R.layout.panel_find_course, binding.myCourseList, false)\n+            binding.myCourseList.addFooterView(footer.root, null, false)\n+            footer.courseBtn.setOnClickListener { v: View? ->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb391aa762efb5db818e222477781fe218d8960e"}, "originalPosition": 217}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODAzNTYyNg==", "bodyText": "should avoid using !!.", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r458035626", "createdAt": "2020-07-21T11:47:34Z", "author": {"login": "farhan-arshad-dev"}, "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/MyCoursesListFragment.kt", "diffHunk": "@@ -0,0 +1,256 @@\n+package org.edx.mobile.view\n+\n+import android.os.Bundle\n+import android.view.LayoutInflater\n+import android.view.View\n+import android.view.ViewGroup\n+import androidx.databinding.DataBindingUtil\n+import com.joanzapata.iconify.fonts.FontAwesomeIcons\n+import de.greenrobot.event.EventBus\n+import okhttp3.MediaType\n+import okhttp3.ResponseBody\n+import org.edx.mobile.R\n+import org.edx.mobile.core.IEdxEnvironment\n+import org.edx.mobile.course.CourseAPI\n+import org.edx.mobile.databinding.FragmentMyCoursesListBinding\n+import org.edx.mobile.databinding.PanelFindCourseBinding\n+import org.edx.mobile.deeplink.Screen\n+import org.edx.mobile.event.EnrolledInCourseEvent\n+import org.edx.mobile.event.MainDashboardRefreshEvent\n+import org.edx.mobile.event.MoveToDiscoveryTabEvent\n+import org.edx.mobile.event.NetworkConnectivityChangeEvent\n+import org.edx.mobile.exception.AuthException\n+import org.edx.mobile.http.HttpStatus\n+import org.edx.mobile.http.HttpStatusException\n+import org.edx.mobile.http.notifications.FullScreenErrorNotification\n+import org.edx.mobile.interfaces.RefreshListener\n+import org.edx.mobile.logger.Logger\n+import org.edx.mobile.model.api.EnrolledCoursesResponse\n+import org.edx.mobile.module.db.DataCallback\n+import org.edx.mobile.module.prefs.LoginPrefs\n+import org.edx.mobile.util.ConfigUtil.Companion.isCourseDiscoveryEnabled\n+import org.edx.mobile.util.NetworkUtil\n+import org.edx.mobile.util.UiUtil\n+import org.edx.mobile.view.adapters.MyCoursesAdapter\n+import retrofit2.Call\n+import retrofit2.Callback\n+import retrofit2.Response\n+import java.util.*\n+import javax.inject.Inject\n+\n+class MyCoursesListFragment : OfflineSupportBaseFragment(), RefreshListener {\n+    private lateinit var adapter: MyCoursesAdapter\n+    private lateinit var binding: FragmentMyCoursesListBinding\n+    private val logger = Logger(javaClass.simpleName)\n+    private var refreshOnResume = false\n+    @Inject\n+    private var environment: IEdxEnvironment? = null\n+    @Inject\n+    var api: CourseAPI? = null\n+    private lateinit var errorNotification: FullScreenErrorNotification\n+    //TODO: All these callbacks aren't essentially part of MyCoursesListFragment and should move in\n+    // the Tabs container fragment that's going to be implemented in LEARNER-3251\n+    override fun onCreate(savedInstanceState: Bundle?) {\n+        super.onCreate(savedInstanceState)\n+        adapter = object : MyCoursesAdapter(activity, environment) {\n+            override fun onItemClicked(model: EnrolledCoursesResponse) {\n+                environment.router.showCourseDashboardTabs(activity!!, model, false)\n+            }\n+\n+            override fun onAnnouncementClicked(model: EnrolledCoursesResponse) {\n+                environment.router.showCourseDashboardTabs(activity!!, model, true)\n+            }\n+        }\n+    }\n+\n+    override fun onCreateView(inflater: LayoutInflater, container: ViewGroup?,\n+                              savedInstanceState: Bundle?): View? {\n+        binding = DataBindingUtil.inflate(inflater, R.layout.fragment_my_courses_list, container, false)\n+        errorNotification = FullScreenErrorNotification(binding.myCourseList)\n+        binding.swipeContainer.setOnRefreshListener {\n+            // Hide the progress bar as swipe layout has its own progress indicator\n+            binding.loadingIndicator.root.visibility = View.GONE\n+            errorNotification.hideError()\n+            loadData(showProgress = false, isCached = false)\n+        }\n+        UiUtil.setSwipeRefreshLayoutColors(binding.swipeContainer)\n+        // Add empty view to cause divider to render at the top of the list.\n+        binding.myCourseList.addHeaderView(View(context), null, false)\n+        binding.myCourseList.adapter = adapter\n+        binding.myCourseList.onItemClickListener = adapter\n+        return binding.root\n+    }\n+\n+    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {\n+        super.onViewCreated(view, savedInstanceState)\n+        loadData(showProgress = true, isCached = true)\n+    }\n+\n+    private fun populateCourseData(data: ArrayList<EnrolledCoursesResponse>) {\n+        updateDatabaseAfterDownload(data)\n+        if (data.size > 0) {\n+            adapter.setItems(data)\n+        }\n+        addFindCoursesFooter()\n+        adapter.notifyDataSetChanged()\n+        if (adapter.isEmpty && !isCourseDiscoveryEnabled(environment!!)) {\n+            errorNotification.showError(R.string.no_courses_to_display,\n+                    FontAwesomeIcons.fa_exclamation_circle, 0, null)\n+            binding.myCourseList.visibility = View.GONE\n+        } else {\n+            binding.myCourseList.visibility = View.VISIBLE\n+            errorNotification.hideError()\n+        }\n+    }\n+\n+    private fun updateDatabaseAfterDownload(list: ArrayList<EnrolledCoursesResponse>?) {\n+        if (list != null && list.size > 0) { //update all videos in the DB as Deactivated\n+            environment?.database?.updateAllVideosAsDeactivated(dataCallback)\n+            for (i in list.indices) { //Check if the flag of isIs_active is marked to true,\n+                //then activate all videos\n+                if (list[i].isIs_active) { //update all videos for a course fetched in the API as Activated\n+                    environment?.database?.updateVideosActivatedForCourse(list[i].course.id,\n+                            dataCallback)\n+                } else {\n+                    list.removeAt(i)\n+                }\n+            }\n+            //Delete all videos which are marked as Deactivated in the database\n+            environment?.storage?.deleteAllUnenrolledVideos()\n+        }\n+    }\n+\n+    private val dataCallback: DataCallback<Int> = object : DataCallback<Int>() {\n+        override fun onResult(result: Int) {}\n+        override fun onFail(ex: Exception) {\n+            logger.error(ex)\n+        }\n+    }\n+\n+    override fun onResume() {\n+        super.onResume()\n+        if (refreshOnResume) {\n+            loadData(showProgress = false, isCached = true)\n+            refreshOnResume = false\n+        }\n+    }\n+\n+    override fun onDestroy() {\n+        super.onDestroy()\n+        EventBus.getDefault().unregister(this)\n+    }\n+\n+    fun onEventMainThread(event: EnrolledInCourseEvent?) {\n+        refreshOnResume = true\n+    }\n+\n+    private fun loadData(showProgress: Boolean, isCached: Boolean) {\n+        if (showProgress) {\n+            binding.loadingIndicator.root.visibility = View.VISIBLE\n+            errorNotification.hideError()\n+        }\n+        if (isCached) {\n+            getUserEnrolledCourses(api?.enrolledCoursesFromCache!!)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb391aa762efb5db818e222477781fe218d8960e"}, "originalPosition": 153}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODAzNTY3Mw==", "bodyText": "should avoid using !!.", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r458035673", "createdAt": "2020-07-21T11:47:39Z", "author": {"login": "farhan-arshad-dev"}, "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/MyCoursesListFragment.kt", "diffHunk": "@@ -0,0 +1,256 @@\n+package org.edx.mobile.view\n+\n+import android.os.Bundle\n+import android.view.LayoutInflater\n+import android.view.View\n+import android.view.ViewGroup\n+import androidx.databinding.DataBindingUtil\n+import com.joanzapata.iconify.fonts.FontAwesomeIcons\n+import de.greenrobot.event.EventBus\n+import okhttp3.MediaType\n+import okhttp3.ResponseBody\n+import org.edx.mobile.R\n+import org.edx.mobile.core.IEdxEnvironment\n+import org.edx.mobile.course.CourseAPI\n+import org.edx.mobile.databinding.FragmentMyCoursesListBinding\n+import org.edx.mobile.databinding.PanelFindCourseBinding\n+import org.edx.mobile.deeplink.Screen\n+import org.edx.mobile.event.EnrolledInCourseEvent\n+import org.edx.mobile.event.MainDashboardRefreshEvent\n+import org.edx.mobile.event.MoveToDiscoveryTabEvent\n+import org.edx.mobile.event.NetworkConnectivityChangeEvent\n+import org.edx.mobile.exception.AuthException\n+import org.edx.mobile.http.HttpStatus\n+import org.edx.mobile.http.HttpStatusException\n+import org.edx.mobile.http.notifications.FullScreenErrorNotification\n+import org.edx.mobile.interfaces.RefreshListener\n+import org.edx.mobile.logger.Logger\n+import org.edx.mobile.model.api.EnrolledCoursesResponse\n+import org.edx.mobile.module.db.DataCallback\n+import org.edx.mobile.module.prefs.LoginPrefs\n+import org.edx.mobile.util.ConfigUtil.Companion.isCourseDiscoveryEnabled\n+import org.edx.mobile.util.NetworkUtil\n+import org.edx.mobile.util.UiUtil\n+import org.edx.mobile.view.adapters.MyCoursesAdapter\n+import retrofit2.Call\n+import retrofit2.Callback\n+import retrofit2.Response\n+import java.util.*\n+import javax.inject.Inject\n+\n+class MyCoursesListFragment : OfflineSupportBaseFragment(), RefreshListener {\n+    private lateinit var adapter: MyCoursesAdapter\n+    private lateinit var binding: FragmentMyCoursesListBinding\n+    private val logger = Logger(javaClass.simpleName)\n+    private var refreshOnResume = false\n+    @Inject\n+    private var environment: IEdxEnvironment? = null\n+    @Inject\n+    var api: CourseAPI? = null\n+    private lateinit var errorNotification: FullScreenErrorNotification\n+    //TODO: All these callbacks aren't essentially part of MyCoursesListFragment and should move in\n+    // the Tabs container fragment that's going to be implemented in LEARNER-3251\n+    override fun onCreate(savedInstanceState: Bundle?) {\n+        super.onCreate(savedInstanceState)\n+        adapter = object : MyCoursesAdapter(activity, environment) {\n+            override fun onItemClicked(model: EnrolledCoursesResponse) {\n+                environment.router.showCourseDashboardTabs(activity!!, model, false)\n+            }\n+\n+            override fun onAnnouncementClicked(model: EnrolledCoursesResponse) {\n+                environment.router.showCourseDashboardTabs(activity!!, model, true)\n+            }\n+        }\n+    }\n+\n+    override fun onCreateView(inflater: LayoutInflater, container: ViewGroup?,\n+                              savedInstanceState: Bundle?): View? {\n+        binding = DataBindingUtil.inflate(inflater, R.layout.fragment_my_courses_list, container, false)\n+        errorNotification = FullScreenErrorNotification(binding.myCourseList)\n+        binding.swipeContainer.setOnRefreshListener {\n+            // Hide the progress bar as swipe layout has its own progress indicator\n+            binding.loadingIndicator.root.visibility = View.GONE\n+            errorNotification.hideError()\n+            loadData(showProgress = false, isCached = false)\n+        }\n+        UiUtil.setSwipeRefreshLayoutColors(binding.swipeContainer)\n+        // Add empty view to cause divider to render at the top of the list.\n+        binding.myCourseList.addHeaderView(View(context), null, false)\n+        binding.myCourseList.adapter = adapter\n+        binding.myCourseList.onItemClickListener = adapter\n+        return binding.root\n+    }\n+\n+    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {\n+        super.onViewCreated(view, savedInstanceState)\n+        loadData(showProgress = true, isCached = true)\n+    }\n+\n+    private fun populateCourseData(data: ArrayList<EnrolledCoursesResponse>) {\n+        updateDatabaseAfterDownload(data)\n+        if (data.size > 0) {\n+            adapter.setItems(data)\n+        }\n+        addFindCoursesFooter()\n+        adapter.notifyDataSetChanged()\n+        if (adapter.isEmpty && !isCourseDiscoveryEnabled(environment!!)) {\n+            errorNotification.showError(R.string.no_courses_to_display,\n+                    FontAwesomeIcons.fa_exclamation_circle, 0, null)\n+            binding.myCourseList.visibility = View.GONE\n+        } else {\n+            binding.myCourseList.visibility = View.VISIBLE\n+            errorNotification.hideError()\n+        }\n+    }\n+\n+    private fun updateDatabaseAfterDownload(list: ArrayList<EnrolledCoursesResponse>?) {\n+        if (list != null && list.size > 0) { //update all videos in the DB as Deactivated\n+            environment?.database?.updateAllVideosAsDeactivated(dataCallback)\n+            for (i in list.indices) { //Check if the flag of isIs_active is marked to true,\n+                //then activate all videos\n+                if (list[i].isIs_active) { //update all videos for a course fetched in the API as Activated\n+                    environment?.database?.updateVideosActivatedForCourse(list[i].course.id,\n+                            dataCallback)\n+                } else {\n+                    list.removeAt(i)\n+                }\n+            }\n+            //Delete all videos which are marked as Deactivated in the database\n+            environment?.storage?.deleteAllUnenrolledVideos()\n+        }\n+    }\n+\n+    private val dataCallback: DataCallback<Int> = object : DataCallback<Int>() {\n+        override fun onResult(result: Int) {}\n+        override fun onFail(ex: Exception) {\n+            logger.error(ex)\n+        }\n+    }\n+\n+    override fun onResume() {\n+        super.onResume()\n+        if (refreshOnResume) {\n+            loadData(showProgress = false, isCached = true)\n+            refreshOnResume = false\n+        }\n+    }\n+\n+    override fun onDestroy() {\n+        super.onDestroy()\n+        EventBus.getDefault().unregister(this)\n+    }\n+\n+    fun onEventMainThread(event: EnrolledInCourseEvent?) {\n+        refreshOnResume = true\n+    }\n+\n+    private fun loadData(showProgress: Boolean, isCached: Boolean) {\n+        if (showProgress) {\n+            binding.loadingIndicator.root.visibility = View.VISIBLE\n+            errorNotification.hideError()\n+        }\n+        if (isCached) {\n+            getUserEnrolledCourses(api?.enrolledCoursesFromCache!!)\n+        }\n+        getUserEnrolledCourses(api?.enrolledCourses!!)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb391aa762efb5db818e222477781fe218d8960e"}, "originalPosition": 155}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODAzNjQ3OA==", "bodyText": "should be nullable while removing !!.", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r458036478", "createdAt": "2020-07-21T11:49:08Z", "author": {"login": "farhan-arshad-dev"}, "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/MyCoursesListFragment.kt", "diffHunk": "@@ -0,0 +1,256 @@\n+package org.edx.mobile.view\n+\n+import android.os.Bundle\n+import android.view.LayoutInflater\n+import android.view.View\n+import android.view.ViewGroup\n+import androidx.databinding.DataBindingUtil\n+import com.joanzapata.iconify.fonts.FontAwesomeIcons\n+import de.greenrobot.event.EventBus\n+import okhttp3.MediaType\n+import okhttp3.ResponseBody\n+import org.edx.mobile.R\n+import org.edx.mobile.core.IEdxEnvironment\n+import org.edx.mobile.course.CourseAPI\n+import org.edx.mobile.databinding.FragmentMyCoursesListBinding\n+import org.edx.mobile.databinding.PanelFindCourseBinding\n+import org.edx.mobile.deeplink.Screen\n+import org.edx.mobile.event.EnrolledInCourseEvent\n+import org.edx.mobile.event.MainDashboardRefreshEvent\n+import org.edx.mobile.event.MoveToDiscoveryTabEvent\n+import org.edx.mobile.event.NetworkConnectivityChangeEvent\n+import org.edx.mobile.exception.AuthException\n+import org.edx.mobile.http.HttpStatus\n+import org.edx.mobile.http.HttpStatusException\n+import org.edx.mobile.http.notifications.FullScreenErrorNotification\n+import org.edx.mobile.interfaces.RefreshListener\n+import org.edx.mobile.logger.Logger\n+import org.edx.mobile.model.api.EnrolledCoursesResponse\n+import org.edx.mobile.module.db.DataCallback\n+import org.edx.mobile.module.prefs.LoginPrefs\n+import org.edx.mobile.util.ConfigUtil.Companion.isCourseDiscoveryEnabled\n+import org.edx.mobile.util.NetworkUtil\n+import org.edx.mobile.util.UiUtil\n+import org.edx.mobile.view.adapters.MyCoursesAdapter\n+import retrofit2.Call\n+import retrofit2.Callback\n+import retrofit2.Response\n+import java.util.*\n+import javax.inject.Inject\n+\n+class MyCoursesListFragment : OfflineSupportBaseFragment(), RefreshListener {\n+    private lateinit var adapter: MyCoursesAdapter\n+    private lateinit var binding: FragmentMyCoursesListBinding\n+    private val logger = Logger(javaClass.simpleName)\n+    private var refreshOnResume = false\n+    @Inject\n+    private var environment: IEdxEnvironment? = null\n+    @Inject\n+    var api: CourseAPI? = null\n+    private lateinit var errorNotification: FullScreenErrorNotification\n+    //TODO: All these callbacks aren't essentially part of MyCoursesListFragment and should move in\n+    // the Tabs container fragment that's going to be implemented in LEARNER-3251\n+    override fun onCreate(savedInstanceState: Bundle?) {\n+        super.onCreate(savedInstanceState)\n+        adapter = object : MyCoursesAdapter(activity, environment) {\n+            override fun onItemClicked(model: EnrolledCoursesResponse) {\n+                environment.router.showCourseDashboardTabs(activity!!, model, false)\n+            }\n+\n+            override fun onAnnouncementClicked(model: EnrolledCoursesResponse) {\n+                environment.router.showCourseDashboardTabs(activity!!, model, true)\n+            }\n+        }\n+    }\n+\n+    override fun onCreateView(inflater: LayoutInflater, container: ViewGroup?,\n+                              savedInstanceState: Bundle?): View? {\n+        binding = DataBindingUtil.inflate(inflater, R.layout.fragment_my_courses_list, container, false)\n+        errorNotification = FullScreenErrorNotification(binding.myCourseList)\n+        binding.swipeContainer.setOnRefreshListener {\n+            // Hide the progress bar as swipe layout has its own progress indicator\n+            binding.loadingIndicator.root.visibility = View.GONE\n+            errorNotification.hideError()\n+            loadData(showProgress = false, isCached = false)\n+        }\n+        UiUtil.setSwipeRefreshLayoutColors(binding.swipeContainer)\n+        // Add empty view to cause divider to render at the top of the list.\n+        binding.myCourseList.addHeaderView(View(context), null, false)\n+        binding.myCourseList.adapter = adapter\n+        binding.myCourseList.onItemClickListener = adapter\n+        return binding.root\n+    }\n+\n+    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {\n+        super.onViewCreated(view, savedInstanceState)\n+        loadData(showProgress = true, isCached = true)\n+    }\n+\n+    private fun populateCourseData(data: ArrayList<EnrolledCoursesResponse>) {\n+        updateDatabaseAfterDownload(data)\n+        if (data.size > 0) {\n+            adapter.setItems(data)\n+        }\n+        addFindCoursesFooter()\n+        adapter.notifyDataSetChanged()\n+        if (adapter.isEmpty && !isCourseDiscoveryEnabled(environment!!)) {\n+            errorNotification.showError(R.string.no_courses_to_display,\n+                    FontAwesomeIcons.fa_exclamation_circle, 0, null)\n+            binding.myCourseList.visibility = View.GONE\n+        } else {\n+            binding.myCourseList.visibility = View.VISIBLE\n+            errorNotification.hideError()\n+        }\n+    }\n+\n+    private fun updateDatabaseAfterDownload(list: ArrayList<EnrolledCoursesResponse>?) {\n+        if (list != null && list.size > 0) { //update all videos in the DB as Deactivated\n+            environment?.database?.updateAllVideosAsDeactivated(dataCallback)\n+            for (i in list.indices) { //Check if the flag of isIs_active is marked to true,\n+                //then activate all videos\n+                if (list[i].isIs_active) { //update all videos for a course fetched in the API as Activated\n+                    environment?.database?.updateVideosActivatedForCourse(list[i].course.id,\n+                            dataCallback)\n+                } else {\n+                    list.removeAt(i)\n+                }\n+            }\n+            //Delete all videos which are marked as Deactivated in the database\n+            environment?.storage?.deleteAllUnenrolledVideos()\n+        }\n+    }\n+\n+    private val dataCallback: DataCallback<Int> = object : DataCallback<Int>() {\n+        override fun onResult(result: Int) {}\n+        override fun onFail(ex: Exception) {\n+            logger.error(ex)\n+        }\n+    }\n+\n+    override fun onResume() {\n+        super.onResume()\n+        if (refreshOnResume) {\n+            loadData(showProgress = false, isCached = true)\n+            refreshOnResume = false\n+        }\n+    }\n+\n+    override fun onDestroy() {\n+        super.onDestroy()\n+        EventBus.getDefault().unregister(this)\n+    }\n+\n+    fun onEventMainThread(event: EnrolledInCourseEvent?) {\n+        refreshOnResume = true\n+    }\n+\n+    private fun loadData(showProgress: Boolean, isCached: Boolean) {\n+        if (showProgress) {\n+            binding.loadingIndicator.root.visibility = View.VISIBLE\n+            errorNotification.hideError()\n+        }\n+        if (isCached) {\n+            getUserEnrolledCourses(api?.enrolledCoursesFromCache!!)\n+        }\n+        getUserEnrolledCourses(api?.enrolledCourses!!)\n+    }\n+\n+    private fun invalidateView() {\n+        binding.swipeContainer.isRefreshing = false\n+        binding.loadingIndicator.root.visibility = View.GONE\n+\n+        if (!EventBus.getDefault().isRegistered(this@MyCoursesListFragment)) {\n+            EventBus.getDefault().registerSticky(this@MyCoursesListFragment)\n+        }\n+    }\n+\n+    private fun showError(error: Throwable) {\n+        context?.let { context ->\n+            error.cause?.let { cause ->\n+                errorNotification.showError(context, cause, R.string.lbl_reload) {\n+                    if (NetworkUtil.isConnected(context)) {\n+                        onRefresh()\n+                    }\n+                }\n+            }\n+        }\n+    }\n+\n+    private fun getUserEnrolledCourses(enrolledCoursesApi: Call<List<EnrolledCoursesResponse>>) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb391aa762efb5db818e222477781fe218d8960e"}, "originalPosition": 179}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODEzNDM5OA==", "bodyText": "Should not call when populateCourseData from the cache.", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r458134398", "createdAt": "2020-07-21T14:20:22Z", "author": {"login": "farhan-arshad-dev"}, "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/MyCoursesListFragment.kt", "diffHunk": "@@ -0,0 +1,256 @@\n+package org.edx.mobile.view\n+\n+import android.os.Bundle\n+import android.view.LayoutInflater\n+import android.view.View\n+import android.view.ViewGroup\n+import androidx.databinding.DataBindingUtil\n+import com.joanzapata.iconify.fonts.FontAwesomeIcons\n+import de.greenrobot.event.EventBus\n+import okhttp3.MediaType\n+import okhttp3.ResponseBody\n+import org.edx.mobile.R\n+import org.edx.mobile.core.IEdxEnvironment\n+import org.edx.mobile.course.CourseAPI\n+import org.edx.mobile.databinding.FragmentMyCoursesListBinding\n+import org.edx.mobile.databinding.PanelFindCourseBinding\n+import org.edx.mobile.deeplink.Screen\n+import org.edx.mobile.event.EnrolledInCourseEvent\n+import org.edx.mobile.event.MainDashboardRefreshEvent\n+import org.edx.mobile.event.MoveToDiscoveryTabEvent\n+import org.edx.mobile.event.NetworkConnectivityChangeEvent\n+import org.edx.mobile.exception.AuthException\n+import org.edx.mobile.http.HttpStatus\n+import org.edx.mobile.http.HttpStatusException\n+import org.edx.mobile.http.notifications.FullScreenErrorNotification\n+import org.edx.mobile.interfaces.RefreshListener\n+import org.edx.mobile.logger.Logger\n+import org.edx.mobile.model.api.EnrolledCoursesResponse\n+import org.edx.mobile.module.db.DataCallback\n+import org.edx.mobile.module.prefs.LoginPrefs\n+import org.edx.mobile.util.ConfigUtil.Companion.isCourseDiscoveryEnabled\n+import org.edx.mobile.util.NetworkUtil\n+import org.edx.mobile.util.UiUtil\n+import org.edx.mobile.view.adapters.MyCoursesAdapter\n+import retrofit2.Call\n+import retrofit2.Callback\n+import retrofit2.Response\n+import java.util.*\n+import javax.inject.Inject\n+\n+class MyCoursesListFragment : OfflineSupportBaseFragment(), RefreshListener {\n+    private lateinit var adapter: MyCoursesAdapter\n+    private lateinit var binding: FragmentMyCoursesListBinding\n+    private val logger = Logger(javaClass.simpleName)\n+    private var refreshOnResume = false\n+    @Inject\n+    private var environment: IEdxEnvironment? = null\n+    @Inject\n+    var api: CourseAPI? = null\n+    private lateinit var errorNotification: FullScreenErrorNotification\n+    //TODO: All these callbacks aren't essentially part of MyCoursesListFragment and should move in\n+    // the Tabs container fragment that's going to be implemented in LEARNER-3251\n+    override fun onCreate(savedInstanceState: Bundle?) {\n+        super.onCreate(savedInstanceState)\n+        adapter = object : MyCoursesAdapter(activity, environment) {\n+            override fun onItemClicked(model: EnrolledCoursesResponse) {\n+                environment.router.showCourseDashboardTabs(activity!!, model, false)\n+            }\n+\n+            override fun onAnnouncementClicked(model: EnrolledCoursesResponse) {\n+                environment.router.showCourseDashboardTabs(activity!!, model, true)\n+            }\n+        }\n+    }\n+\n+    override fun onCreateView(inflater: LayoutInflater, container: ViewGroup?,\n+                              savedInstanceState: Bundle?): View? {\n+        binding = DataBindingUtil.inflate(inflater, R.layout.fragment_my_courses_list, container, false)\n+        errorNotification = FullScreenErrorNotification(binding.myCourseList)\n+        binding.swipeContainer.setOnRefreshListener {\n+            // Hide the progress bar as swipe layout has its own progress indicator\n+            binding.loadingIndicator.root.visibility = View.GONE\n+            errorNotification.hideError()\n+            loadData(showProgress = false, isCached = false)\n+        }\n+        UiUtil.setSwipeRefreshLayoutColors(binding.swipeContainer)\n+        // Add empty view to cause divider to render at the top of the list.\n+        binding.myCourseList.addHeaderView(View(context), null, false)\n+        binding.myCourseList.adapter = adapter\n+        binding.myCourseList.onItemClickListener = adapter\n+        return binding.root\n+    }\n+\n+    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {\n+        super.onViewCreated(view, savedInstanceState)\n+        loadData(showProgress = true, isCached = true)\n+    }\n+\n+    private fun populateCourseData(data: ArrayList<EnrolledCoursesResponse>) {\n+        updateDatabaseAfterDownload(data)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb391aa762efb5db818e222477781fe218d8960e"}, "originalPosition": 90}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI1NDQxMg==", "bodyText": "The app should not handle the error codes in case of fetching data from the cache.", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r458254412", "createdAt": "2020-07-21T17:06:51Z", "author": {"login": "farhan-arshad-dev"}, "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/MyCoursesListFragment.kt", "diffHunk": "@@ -0,0 +1,256 @@\n+package org.edx.mobile.view\n+\n+import android.os.Bundle\n+import android.view.LayoutInflater\n+import android.view.View\n+import android.view.ViewGroup\n+import androidx.databinding.DataBindingUtil\n+import com.joanzapata.iconify.fonts.FontAwesomeIcons\n+import de.greenrobot.event.EventBus\n+import okhttp3.MediaType\n+import okhttp3.ResponseBody\n+import org.edx.mobile.R\n+import org.edx.mobile.core.IEdxEnvironment\n+import org.edx.mobile.course.CourseAPI\n+import org.edx.mobile.databinding.FragmentMyCoursesListBinding\n+import org.edx.mobile.databinding.PanelFindCourseBinding\n+import org.edx.mobile.deeplink.Screen\n+import org.edx.mobile.event.EnrolledInCourseEvent\n+import org.edx.mobile.event.MainDashboardRefreshEvent\n+import org.edx.mobile.event.MoveToDiscoveryTabEvent\n+import org.edx.mobile.event.NetworkConnectivityChangeEvent\n+import org.edx.mobile.exception.AuthException\n+import org.edx.mobile.http.HttpStatus\n+import org.edx.mobile.http.HttpStatusException\n+import org.edx.mobile.http.notifications.FullScreenErrorNotification\n+import org.edx.mobile.interfaces.RefreshListener\n+import org.edx.mobile.logger.Logger\n+import org.edx.mobile.model.api.EnrolledCoursesResponse\n+import org.edx.mobile.module.db.DataCallback\n+import org.edx.mobile.module.prefs.LoginPrefs\n+import org.edx.mobile.util.ConfigUtil.Companion.isCourseDiscoveryEnabled\n+import org.edx.mobile.util.NetworkUtil\n+import org.edx.mobile.util.UiUtil\n+import org.edx.mobile.view.adapters.MyCoursesAdapter\n+import retrofit2.Call\n+import retrofit2.Callback\n+import retrofit2.Response\n+import java.util.*\n+import javax.inject.Inject\n+\n+class MyCoursesListFragment : OfflineSupportBaseFragment(), RefreshListener {\n+    private lateinit var adapter: MyCoursesAdapter\n+    private lateinit var binding: FragmentMyCoursesListBinding\n+    private val logger = Logger(javaClass.simpleName)\n+    private var refreshOnResume = false\n+    @Inject\n+    private var environment: IEdxEnvironment? = null\n+    @Inject\n+    var api: CourseAPI? = null\n+    private lateinit var errorNotification: FullScreenErrorNotification\n+    //TODO: All these callbacks aren't essentially part of MyCoursesListFragment and should move in\n+    // the Tabs container fragment that's going to be implemented in LEARNER-3251\n+    override fun onCreate(savedInstanceState: Bundle?) {\n+        super.onCreate(savedInstanceState)\n+        adapter = object : MyCoursesAdapter(activity, environment) {\n+            override fun onItemClicked(model: EnrolledCoursesResponse) {\n+                environment.router.showCourseDashboardTabs(activity!!, model, false)\n+            }\n+\n+            override fun onAnnouncementClicked(model: EnrolledCoursesResponse) {\n+                environment.router.showCourseDashboardTabs(activity!!, model, true)\n+            }\n+        }\n+    }\n+\n+    override fun onCreateView(inflater: LayoutInflater, container: ViewGroup?,\n+                              savedInstanceState: Bundle?): View? {\n+        binding = DataBindingUtil.inflate(inflater, R.layout.fragment_my_courses_list, container, false)\n+        errorNotification = FullScreenErrorNotification(binding.myCourseList)\n+        binding.swipeContainer.setOnRefreshListener {\n+            // Hide the progress bar as swipe layout has its own progress indicator\n+            binding.loadingIndicator.root.visibility = View.GONE\n+            errorNotification.hideError()\n+            loadData(showProgress = false, isCached = false)\n+        }\n+        UiUtil.setSwipeRefreshLayoutColors(binding.swipeContainer)\n+        // Add empty view to cause divider to render at the top of the list.\n+        binding.myCourseList.addHeaderView(View(context), null, false)\n+        binding.myCourseList.adapter = adapter\n+        binding.myCourseList.onItemClickListener = adapter\n+        return binding.root\n+    }\n+\n+    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {\n+        super.onViewCreated(view, savedInstanceState)\n+        loadData(showProgress = true, isCached = true)\n+    }\n+\n+    private fun populateCourseData(data: ArrayList<EnrolledCoursesResponse>) {\n+        updateDatabaseAfterDownload(data)\n+        if (data.size > 0) {\n+            adapter.setItems(data)\n+        }\n+        addFindCoursesFooter()\n+        adapter.notifyDataSetChanged()\n+        if (adapter.isEmpty && !isCourseDiscoveryEnabled(environment!!)) {\n+            errorNotification.showError(R.string.no_courses_to_display,\n+                    FontAwesomeIcons.fa_exclamation_circle, 0, null)\n+            binding.myCourseList.visibility = View.GONE\n+        } else {\n+            binding.myCourseList.visibility = View.VISIBLE\n+            errorNotification.hideError()\n+        }\n+    }\n+\n+    private fun updateDatabaseAfterDownload(list: ArrayList<EnrolledCoursesResponse>?) {\n+        if (list != null && list.size > 0) { //update all videos in the DB as Deactivated\n+            environment?.database?.updateAllVideosAsDeactivated(dataCallback)\n+            for (i in list.indices) { //Check if the flag of isIs_active is marked to true,\n+                //then activate all videos\n+                if (list[i].isIs_active) { //update all videos for a course fetched in the API as Activated\n+                    environment?.database?.updateVideosActivatedForCourse(list[i].course.id,\n+                            dataCallback)\n+                } else {\n+                    list.removeAt(i)\n+                }\n+            }\n+            //Delete all videos which are marked as Deactivated in the database\n+            environment?.storage?.deleteAllUnenrolledVideos()\n+        }\n+    }\n+\n+    private val dataCallback: DataCallback<Int> = object : DataCallback<Int>() {\n+        override fun onResult(result: Int) {}\n+        override fun onFail(ex: Exception) {\n+            logger.error(ex)\n+        }\n+    }\n+\n+    override fun onResume() {\n+        super.onResume()\n+        if (refreshOnResume) {\n+            loadData(showProgress = false, isCached = true)\n+            refreshOnResume = false\n+        }\n+    }\n+\n+    override fun onDestroy() {\n+        super.onDestroy()\n+        EventBus.getDefault().unregister(this)\n+    }\n+\n+    fun onEventMainThread(event: EnrolledInCourseEvent?) {\n+        refreshOnResume = true\n+    }\n+\n+    private fun loadData(showProgress: Boolean, isCached: Boolean) {\n+        if (showProgress) {\n+            binding.loadingIndicator.root.visibility = View.VISIBLE\n+            errorNotification.hideError()\n+        }\n+        if (isCached) {\n+            getUserEnrolledCourses(api?.enrolledCoursesFromCache!!)\n+        }\n+        getUserEnrolledCourses(api?.enrolledCourses!!)\n+    }\n+\n+    private fun invalidateView() {\n+        binding.swipeContainer.isRefreshing = false\n+        binding.loadingIndicator.root.visibility = View.GONE\n+\n+        if (!EventBus.getDefault().isRegistered(this@MyCoursesListFragment)) {\n+            EventBus.getDefault().registerSticky(this@MyCoursesListFragment)\n+        }\n+    }\n+\n+    private fun showError(error: Throwable) {\n+        context?.let { context ->\n+            error.cause?.let { cause ->\n+                errorNotification.showError(context, cause, R.string.lbl_reload) {\n+                    if (NetworkUtil.isConnected(context)) {\n+                        onRefresh()\n+                    }\n+                }\n+            }\n+        }\n+    }\n+\n+    private fun getUserEnrolledCourses(enrolledCoursesApi: Call<List<EnrolledCoursesResponse>>) {\n+        enrolledCoursesApi.enqueue(object : Callback<List<EnrolledCoursesResponse>> {\n+            override fun onResponse(call: Call<List<EnrolledCoursesResponse>>, response: Response<List<EnrolledCoursesResponse>>) {\n+                if (response.isSuccessful && response.code() == HttpStatus.OK) {\n+                    populateCourseData(ArrayList(response.body()))\n+                } else if (response.code() == HttpStatus.UNAUTHORIZED) {\n+                    environment?.router?.forceLogout(context,\n+                            environment?.analyticsRegistry,\n+                            environment?.notificationDelegate)\n+                } else {\n+                    showError(HttpStatusException(Response.error<Any>(HttpStatus.INTERNAL_SERVER_ERROR,\n+                            ResponseBody.create(MediaType.parse(\"text/plain\"), response.message()))))\n+                }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb391aa762efb5db818e222477781fe218d8960e"}, "originalPosition": 191}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI1NDcyMQ==", "bodyText": "The app should not handle the error codes in case of fetching data from the cache.", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r458254721", "createdAt": "2020-07-21T17:07:18Z", "author": {"login": "farhan-arshad-dev"}, "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/MyCoursesListFragment.kt", "diffHunk": "@@ -0,0 +1,256 @@\n+package org.edx.mobile.view\n+\n+import android.os.Bundle\n+import android.view.LayoutInflater\n+import android.view.View\n+import android.view.ViewGroup\n+import androidx.databinding.DataBindingUtil\n+import com.joanzapata.iconify.fonts.FontAwesomeIcons\n+import de.greenrobot.event.EventBus\n+import okhttp3.MediaType\n+import okhttp3.ResponseBody\n+import org.edx.mobile.R\n+import org.edx.mobile.core.IEdxEnvironment\n+import org.edx.mobile.course.CourseAPI\n+import org.edx.mobile.databinding.FragmentMyCoursesListBinding\n+import org.edx.mobile.databinding.PanelFindCourseBinding\n+import org.edx.mobile.deeplink.Screen\n+import org.edx.mobile.event.EnrolledInCourseEvent\n+import org.edx.mobile.event.MainDashboardRefreshEvent\n+import org.edx.mobile.event.MoveToDiscoveryTabEvent\n+import org.edx.mobile.event.NetworkConnectivityChangeEvent\n+import org.edx.mobile.exception.AuthException\n+import org.edx.mobile.http.HttpStatus\n+import org.edx.mobile.http.HttpStatusException\n+import org.edx.mobile.http.notifications.FullScreenErrorNotification\n+import org.edx.mobile.interfaces.RefreshListener\n+import org.edx.mobile.logger.Logger\n+import org.edx.mobile.model.api.EnrolledCoursesResponse\n+import org.edx.mobile.module.db.DataCallback\n+import org.edx.mobile.module.prefs.LoginPrefs\n+import org.edx.mobile.util.ConfigUtil.Companion.isCourseDiscoveryEnabled\n+import org.edx.mobile.util.NetworkUtil\n+import org.edx.mobile.util.UiUtil\n+import org.edx.mobile.view.adapters.MyCoursesAdapter\n+import retrofit2.Call\n+import retrofit2.Callback\n+import retrofit2.Response\n+import java.util.*\n+import javax.inject.Inject\n+\n+class MyCoursesListFragment : OfflineSupportBaseFragment(), RefreshListener {\n+    private lateinit var adapter: MyCoursesAdapter\n+    private lateinit var binding: FragmentMyCoursesListBinding\n+    private val logger = Logger(javaClass.simpleName)\n+    private var refreshOnResume = false\n+    @Inject\n+    private var environment: IEdxEnvironment? = null\n+    @Inject\n+    var api: CourseAPI? = null\n+    private lateinit var errorNotification: FullScreenErrorNotification\n+    //TODO: All these callbacks aren't essentially part of MyCoursesListFragment and should move in\n+    // the Tabs container fragment that's going to be implemented in LEARNER-3251\n+    override fun onCreate(savedInstanceState: Bundle?) {\n+        super.onCreate(savedInstanceState)\n+        adapter = object : MyCoursesAdapter(activity, environment) {\n+            override fun onItemClicked(model: EnrolledCoursesResponse) {\n+                environment.router.showCourseDashboardTabs(activity!!, model, false)\n+            }\n+\n+            override fun onAnnouncementClicked(model: EnrolledCoursesResponse) {\n+                environment.router.showCourseDashboardTabs(activity!!, model, true)\n+            }\n+        }\n+    }\n+\n+    override fun onCreateView(inflater: LayoutInflater, container: ViewGroup?,\n+                              savedInstanceState: Bundle?): View? {\n+        binding = DataBindingUtil.inflate(inflater, R.layout.fragment_my_courses_list, container, false)\n+        errorNotification = FullScreenErrorNotification(binding.myCourseList)\n+        binding.swipeContainer.setOnRefreshListener {\n+            // Hide the progress bar as swipe layout has its own progress indicator\n+            binding.loadingIndicator.root.visibility = View.GONE\n+            errorNotification.hideError()\n+            loadData(showProgress = false, isCached = false)\n+        }\n+        UiUtil.setSwipeRefreshLayoutColors(binding.swipeContainer)\n+        // Add empty view to cause divider to render at the top of the list.\n+        binding.myCourseList.addHeaderView(View(context), null, false)\n+        binding.myCourseList.adapter = adapter\n+        binding.myCourseList.onItemClickListener = adapter\n+        return binding.root\n+    }\n+\n+    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {\n+        super.onViewCreated(view, savedInstanceState)\n+        loadData(showProgress = true, isCached = true)\n+    }\n+\n+    private fun populateCourseData(data: ArrayList<EnrolledCoursesResponse>) {\n+        updateDatabaseAfterDownload(data)\n+        if (data.size > 0) {\n+            adapter.setItems(data)\n+        }\n+        addFindCoursesFooter()\n+        adapter.notifyDataSetChanged()\n+        if (adapter.isEmpty && !isCourseDiscoveryEnabled(environment!!)) {\n+            errorNotification.showError(R.string.no_courses_to_display,\n+                    FontAwesomeIcons.fa_exclamation_circle, 0, null)\n+            binding.myCourseList.visibility = View.GONE\n+        } else {\n+            binding.myCourseList.visibility = View.VISIBLE\n+            errorNotification.hideError()\n+        }\n+    }\n+\n+    private fun updateDatabaseAfterDownload(list: ArrayList<EnrolledCoursesResponse>?) {\n+        if (list != null && list.size > 0) { //update all videos in the DB as Deactivated\n+            environment?.database?.updateAllVideosAsDeactivated(dataCallback)\n+            for (i in list.indices) { //Check if the flag of isIs_active is marked to true,\n+                //then activate all videos\n+                if (list[i].isIs_active) { //update all videos for a course fetched in the API as Activated\n+                    environment?.database?.updateVideosActivatedForCourse(list[i].course.id,\n+                            dataCallback)\n+                } else {\n+                    list.removeAt(i)\n+                }\n+            }\n+            //Delete all videos which are marked as Deactivated in the database\n+            environment?.storage?.deleteAllUnenrolledVideos()\n+        }\n+    }\n+\n+    private val dataCallback: DataCallback<Int> = object : DataCallback<Int>() {\n+        override fun onResult(result: Int) {}\n+        override fun onFail(ex: Exception) {\n+            logger.error(ex)\n+        }\n+    }\n+\n+    override fun onResume() {\n+        super.onResume()\n+        if (refreshOnResume) {\n+            loadData(showProgress = false, isCached = true)\n+            refreshOnResume = false\n+        }\n+    }\n+\n+    override fun onDestroy() {\n+        super.onDestroy()\n+        EventBus.getDefault().unregister(this)\n+    }\n+\n+    fun onEventMainThread(event: EnrolledInCourseEvent?) {\n+        refreshOnResume = true\n+    }\n+\n+    private fun loadData(showProgress: Boolean, isCached: Boolean) {\n+        if (showProgress) {\n+            binding.loadingIndicator.root.visibility = View.VISIBLE\n+            errorNotification.hideError()\n+        }\n+        if (isCached) {\n+            getUserEnrolledCourses(api?.enrolledCoursesFromCache!!)\n+        }\n+        getUserEnrolledCourses(api?.enrolledCourses!!)\n+    }\n+\n+    private fun invalidateView() {\n+        binding.swipeContainer.isRefreshing = false\n+        binding.loadingIndicator.root.visibility = View.GONE\n+\n+        if (!EventBus.getDefault().isRegistered(this@MyCoursesListFragment)) {\n+            EventBus.getDefault().registerSticky(this@MyCoursesListFragment)\n+        }\n+    }\n+\n+    private fun showError(error: Throwable) {\n+        context?.let { context ->\n+            error.cause?.let { cause ->\n+                errorNotification.showError(context, cause, R.string.lbl_reload) {\n+                    if (NetworkUtil.isConnected(context)) {\n+                        onRefresh()\n+                    }\n+                }\n+            }\n+        }\n+    }\n+\n+    private fun getUserEnrolledCourses(enrolledCoursesApi: Call<List<EnrolledCoursesResponse>>) {\n+        enrolledCoursesApi.enqueue(object : Callback<List<EnrolledCoursesResponse>> {\n+            override fun onResponse(call: Call<List<EnrolledCoursesResponse>>, response: Response<List<EnrolledCoursesResponse>>) {\n+                if (response.isSuccessful && response.code() == HttpStatus.OK) {\n+                    populateCourseData(ArrayList(response.body()))\n+                } else if (response.code() == HttpStatus.UNAUTHORIZED) {\n+                    environment?.router?.forceLogout(context,\n+                            environment?.analyticsRegistry,\n+                            environment?.notificationDelegate)\n+                } else {\n+                    showError(HttpStatusException(Response.error<Any>(HttpStatus.INTERNAL_SERVER_ERROR,\n+                            ResponseBody.create(MediaType.parse(\"text/plain\"), response.message()))))\n+                }\n+                invalidateView()\n+            }\n+\n+            override fun onFailure(call: Call<List<EnrolledCoursesResponse>>, t: Throwable) {\n+                if (t is AuthException || (t is HttpStatusException && t.statusCode == HttpStatus.UNAUTHORIZED)) {\n+                    environment?.router?.forceLogout(context,\n+                            environment?.analyticsRegistry,\n+                            environment?.notificationDelegate)\n+                } else {\n+                    showError(t)\n+                    invalidateView()\n+                }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb391aa762efb5db818e222477781fe218d8960e"}, "originalPosition": 203}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI1OTMyNg==", "bodyText": "IMO, App should make the server call on completion of the cache call.\n@miankhalid thoughts?", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r458259326", "createdAt": "2020-07-21T17:14:54Z", "author": {"login": "farhan-arshad-dev"}, "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/MyCoursesListFragment.kt", "diffHunk": "@@ -0,0 +1,256 @@\n+package org.edx.mobile.view\n+\n+import android.os.Bundle\n+import android.view.LayoutInflater\n+import android.view.View\n+import android.view.ViewGroup\n+import androidx.databinding.DataBindingUtil\n+import com.joanzapata.iconify.fonts.FontAwesomeIcons\n+import de.greenrobot.event.EventBus\n+import okhttp3.MediaType\n+import okhttp3.ResponseBody\n+import org.edx.mobile.R\n+import org.edx.mobile.core.IEdxEnvironment\n+import org.edx.mobile.course.CourseAPI\n+import org.edx.mobile.databinding.FragmentMyCoursesListBinding\n+import org.edx.mobile.databinding.PanelFindCourseBinding\n+import org.edx.mobile.deeplink.Screen\n+import org.edx.mobile.event.EnrolledInCourseEvent\n+import org.edx.mobile.event.MainDashboardRefreshEvent\n+import org.edx.mobile.event.MoveToDiscoveryTabEvent\n+import org.edx.mobile.event.NetworkConnectivityChangeEvent\n+import org.edx.mobile.exception.AuthException\n+import org.edx.mobile.http.HttpStatus\n+import org.edx.mobile.http.HttpStatusException\n+import org.edx.mobile.http.notifications.FullScreenErrorNotification\n+import org.edx.mobile.interfaces.RefreshListener\n+import org.edx.mobile.logger.Logger\n+import org.edx.mobile.model.api.EnrolledCoursesResponse\n+import org.edx.mobile.module.db.DataCallback\n+import org.edx.mobile.module.prefs.LoginPrefs\n+import org.edx.mobile.util.ConfigUtil.Companion.isCourseDiscoveryEnabled\n+import org.edx.mobile.util.NetworkUtil\n+import org.edx.mobile.util.UiUtil\n+import org.edx.mobile.view.adapters.MyCoursesAdapter\n+import retrofit2.Call\n+import retrofit2.Callback\n+import retrofit2.Response\n+import java.util.*\n+import javax.inject.Inject\n+\n+class MyCoursesListFragment : OfflineSupportBaseFragment(), RefreshListener {\n+    private lateinit var adapter: MyCoursesAdapter\n+    private lateinit var binding: FragmentMyCoursesListBinding\n+    private val logger = Logger(javaClass.simpleName)\n+    private var refreshOnResume = false\n+    @Inject\n+    private var environment: IEdxEnvironment? = null\n+    @Inject\n+    var api: CourseAPI? = null\n+    private lateinit var errorNotification: FullScreenErrorNotification\n+    //TODO: All these callbacks aren't essentially part of MyCoursesListFragment and should move in\n+    // the Tabs container fragment that's going to be implemented in LEARNER-3251\n+    override fun onCreate(savedInstanceState: Bundle?) {\n+        super.onCreate(savedInstanceState)\n+        adapter = object : MyCoursesAdapter(activity, environment) {\n+            override fun onItemClicked(model: EnrolledCoursesResponse) {\n+                environment.router.showCourseDashboardTabs(activity!!, model, false)\n+            }\n+\n+            override fun onAnnouncementClicked(model: EnrolledCoursesResponse) {\n+                environment.router.showCourseDashboardTabs(activity!!, model, true)\n+            }\n+        }\n+    }\n+\n+    override fun onCreateView(inflater: LayoutInflater, container: ViewGroup?,\n+                              savedInstanceState: Bundle?): View? {\n+        binding = DataBindingUtil.inflate(inflater, R.layout.fragment_my_courses_list, container, false)\n+        errorNotification = FullScreenErrorNotification(binding.myCourseList)\n+        binding.swipeContainer.setOnRefreshListener {\n+            // Hide the progress bar as swipe layout has its own progress indicator\n+            binding.loadingIndicator.root.visibility = View.GONE\n+            errorNotification.hideError()\n+            loadData(showProgress = false, isCached = false)\n+        }\n+        UiUtil.setSwipeRefreshLayoutColors(binding.swipeContainer)\n+        // Add empty view to cause divider to render at the top of the list.\n+        binding.myCourseList.addHeaderView(View(context), null, false)\n+        binding.myCourseList.adapter = adapter\n+        binding.myCourseList.onItemClickListener = adapter\n+        return binding.root\n+    }\n+\n+    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {\n+        super.onViewCreated(view, savedInstanceState)\n+        loadData(showProgress = true, isCached = true)\n+    }\n+\n+    private fun populateCourseData(data: ArrayList<EnrolledCoursesResponse>) {\n+        updateDatabaseAfterDownload(data)\n+        if (data.size > 0) {\n+            adapter.setItems(data)\n+        }\n+        addFindCoursesFooter()\n+        adapter.notifyDataSetChanged()\n+        if (adapter.isEmpty && !isCourseDiscoveryEnabled(environment!!)) {\n+            errorNotification.showError(R.string.no_courses_to_display,\n+                    FontAwesomeIcons.fa_exclamation_circle, 0, null)\n+            binding.myCourseList.visibility = View.GONE\n+        } else {\n+            binding.myCourseList.visibility = View.VISIBLE\n+            errorNotification.hideError()\n+        }\n+    }\n+\n+    private fun updateDatabaseAfterDownload(list: ArrayList<EnrolledCoursesResponse>?) {\n+        if (list != null && list.size > 0) { //update all videos in the DB as Deactivated\n+            environment?.database?.updateAllVideosAsDeactivated(dataCallback)\n+            for (i in list.indices) { //Check if the flag of isIs_active is marked to true,\n+                //then activate all videos\n+                if (list[i].isIs_active) { //update all videos for a course fetched in the API as Activated\n+                    environment?.database?.updateVideosActivatedForCourse(list[i].course.id,\n+                            dataCallback)\n+                } else {\n+                    list.removeAt(i)\n+                }\n+            }\n+            //Delete all videos which are marked as Deactivated in the database\n+            environment?.storage?.deleteAllUnenrolledVideos()\n+        }\n+    }\n+\n+    private val dataCallback: DataCallback<Int> = object : DataCallback<Int>() {\n+        override fun onResult(result: Int) {}\n+        override fun onFail(ex: Exception) {\n+            logger.error(ex)\n+        }\n+    }\n+\n+    override fun onResume() {\n+        super.onResume()\n+        if (refreshOnResume) {\n+            loadData(showProgress = false, isCached = true)\n+            refreshOnResume = false\n+        }\n+    }\n+\n+    override fun onDestroy() {\n+        super.onDestroy()\n+        EventBus.getDefault().unregister(this)\n+    }\n+\n+    fun onEventMainThread(event: EnrolledInCourseEvent?) {\n+        refreshOnResume = true\n+    }\n+\n+    private fun loadData(showProgress: Boolean, isCached: Boolean) {\n+        if (showProgress) {\n+            binding.loadingIndicator.root.visibility = View.VISIBLE\n+            errorNotification.hideError()\n+        }\n+        if (isCached) {\n+            getUserEnrolledCourses(api?.enrolledCoursesFromCache!!)\n+        }\n+        getUserEnrolledCourses(api?.enrolledCourses!!)\n+    }\n+\n+    private fun invalidateView() {\n+        binding.swipeContainer.isRefreshing = false\n+        binding.loadingIndicator.root.visibility = View.GONE\n+\n+        if (!EventBus.getDefault().isRegistered(this@MyCoursesListFragment)) {\n+            EventBus.getDefault().registerSticky(this@MyCoursesListFragment)\n+        }\n+    }\n+\n+    private fun showError(error: Throwable) {\n+        context?.let { context ->\n+            error.cause?.let { cause ->\n+                errorNotification.showError(context, cause, R.string.lbl_reload) {\n+                    if (NetworkUtil.isConnected(context)) {\n+                        onRefresh()\n+                    }\n+                }\n+            }\n+        }\n+    }\n+\n+    private fun getUserEnrolledCourses(enrolledCoursesApi: Call<List<EnrolledCoursesResponse>>) {\n+        enrolledCoursesApi.enqueue(object : Callback<List<EnrolledCoursesResponse>> {\n+            override fun onResponse(call: Call<List<EnrolledCoursesResponse>>, response: Response<List<EnrolledCoursesResponse>>) {\n+                if (response.isSuccessful && response.code() == HttpStatus.OK) {\n+                    populateCourseData(ArrayList(response.body()))\n+                } else if (response.code() == HttpStatus.UNAUTHORIZED) {\n+                    environment?.router?.forceLogout(context,\n+                            environment?.analyticsRegistry,\n+                            environment?.notificationDelegate)\n+                } else {\n+                    showError(HttpStatusException(Response.error<Any>(HttpStatus.INTERNAL_SERVER_ERROR,\n+                            ResponseBody.create(MediaType.parse(\"text/plain\"), response.message()))))\n+                }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb391aa762efb5db818e222477781fe218d8960e"}, "originalPosition": 191}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI3MjUwMQ==", "bodyText": "I think there is no need this TODO from now,  Should confirm before removing this TODO", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r458272501", "createdAt": "2020-07-21T17:36:42Z", "author": {"login": "farhan-arshad-dev"}, "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/MyCoursesListFragment.kt", "diffHunk": "@@ -0,0 +1,256 @@\n+package org.edx.mobile.view\n+\n+import android.os.Bundle\n+import android.view.LayoutInflater\n+import android.view.View\n+import android.view.ViewGroup\n+import androidx.databinding.DataBindingUtil\n+import com.joanzapata.iconify.fonts.FontAwesomeIcons\n+import de.greenrobot.event.EventBus\n+import okhttp3.MediaType\n+import okhttp3.ResponseBody\n+import org.edx.mobile.R\n+import org.edx.mobile.core.IEdxEnvironment\n+import org.edx.mobile.course.CourseAPI\n+import org.edx.mobile.databinding.FragmentMyCoursesListBinding\n+import org.edx.mobile.databinding.PanelFindCourseBinding\n+import org.edx.mobile.deeplink.Screen\n+import org.edx.mobile.event.EnrolledInCourseEvent\n+import org.edx.mobile.event.MainDashboardRefreshEvent\n+import org.edx.mobile.event.MoveToDiscoveryTabEvent\n+import org.edx.mobile.event.NetworkConnectivityChangeEvent\n+import org.edx.mobile.exception.AuthException\n+import org.edx.mobile.http.HttpStatus\n+import org.edx.mobile.http.HttpStatusException\n+import org.edx.mobile.http.notifications.FullScreenErrorNotification\n+import org.edx.mobile.interfaces.RefreshListener\n+import org.edx.mobile.logger.Logger\n+import org.edx.mobile.model.api.EnrolledCoursesResponse\n+import org.edx.mobile.module.db.DataCallback\n+import org.edx.mobile.module.prefs.LoginPrefs\n+import org.edx.mobile.util.ConfigUtil.Companion.isCourseDiscoveryEnabled\n+import org.edx.mobile.util.NetworkUtil\n+import org.edx.mobile.util.UiUtil\n+import org.edx.mobile.view.adapters.MyCoursesAdapter\n+import retrofit2.Call\n+import retrofit2.Callback\n+import retrofit2.Response\n+import java.util.*\n+import javax.inject.Inject\n+\n+class MyCoursesListFragment : OfflineSupportBaseFragment(), RefreshListener {\n+    private lateinit var adapter: MyCoursesAdapter\n+    private lateinit var binding: FragmentMyCoursesListBinding\n+    private val logger = Logger(javaClass.simpleName)\n+    private var refreshOnResume = false\n+    @Inject\n+    private var environment: IEdxEnvironment? = null\n+    @Inject\n+    var api: CourseAPI? = null\n+    private lateinit var errorNotification: FullScreenErrorNotification\n+    //TODO: All these callbacks aren't essentially part of MyCoursesListFragment and should move in\n+    // the Tabs container fragment that's going to be implemented in LEARNER-3251", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb391aa762efb5db818e222477781fe218d8960e"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI3ODE0MQ==", "bodyText": "IMO it's better to add lateinit with Inject labeled members.", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r458278141", "createdAt": "2020-07-21T17:45:37Z", "author": {"login": "farhan-arshad-dev"}, "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/MyCoursesListFragment.kt", "diffHunk": "@@ -0,0 +1,256 @@\n+package org.edx.mobile.view\n+\n+import android.os.Bundle\n+import android.view.LayoutInflater\n+import android.view.View\n+import android.view.ViewGroup\n+import androidx.databinding.DataBindingUtil\n+import com.joanzapata.iconify.fonts.FontAwesomeIcons\n+import de.greenrobot.event.EventBus\n+import okhttp3.MediaType\n+import okhttp3.ResponseBody\n+import org.edx.mobile.R\n+import org.edx.mobile.core.IEdxEnvironment\n+import org.edx.mobile.course.CourseAPI\n+import org.edx.mobile.databinding.FragmentMyCoursesListBinding\n+import org.edx.mobile.databinding.PanelFindCourseBinding\n+import org.edx.mobile.deeplink.Screen\n+import org.edx.mobile.event.EnrolledInCourseEvent\n+import org.edx.mobile.event.MainDashboardRefreshEvent\n+import org.edx.mobile.event.MoveToDiscoveryTabEvent\n+import org.edx.mobile.event.NetworkConnectivityChangeEvent\n+import org.edx.mobile.exception.AuthException\n+import org.edx.mobile.http.HttpStatus\n+import org.edx.mobile.http.HttpStatusException\n+import org.edx.mobile.http.notifications.FullScreenErrorNotification\n+import org.edx.mobile.interfaces.RefreshListener\n+import org.edx.mobile.logger.Logger\n+import org.edx.mobile.model.api.EnrolledCoursesResponse\n+import org.edx.mobile.module.db.DataCallback\n+import org.edx.mobile.module.prefs.LoginPrefs\n+import org.edx.mobile.util.ConfigUtil.Companion.isCourseDiscoveryEnabled\n+import org.edx.mobile.util.NetworkUtil\n+import org.edx.mobile.util.UiUtil\n+import org.edx.mobile.view.adapters.MyCoursesAdapter\n+import retrofit2.Call\n+import retrofit2.Callback\n+import retrofit2.Response\n+import java.util.*\n+import javax.inject.Inject\n+\n+class MyCoursesListFragment : OfflineSupportBaseFragment(), RefreshListener {\n+    private lateinit var adapter: MyCoursesAdapter\n+    private lateinit var binding: FragmentMyCoursesListBinding\n+    private val logger = Logger(javaClass.simpleName)\n+    private var refreshOnResume = false\n+    @Inject\n+    private var environment: IEdxEnvironment? = null\n+    @Inject\n+    var api: CourseAPI? = null", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb391aa762efb5db818e222477781fe218d8960e"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI5MDE3Mg==", "bodyText": "I think we have to add L54-L55 may be open edx community uses those lines of code?\n@miankhalid thoughts?", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r458290172", "createdAt": "2020-07-21T18:05:24Z", "author": {"login": "farhan-arshad-dev"}, "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/MyCoursesListFragment.kt", "diffHunk": "@@ -0,0 +1,256 @@\n+package org.edx.mobile.view\n+\n+import android.os.Bundle\n+import android.view.LayoutInflater\n+import android.view.View\n+import android.view.ViewGroup\n+import androidx.databinding.DataBindingUtil\n+import com.joanzapata.iconify.fonts.FontAwesomeIcons\n+import de.greenrobot.event.EventBus\n+import okhttp3.MediaType\n+import okhttp3.ResponseBody\n+import org.edx.mobile.R\n+import org.edx.mobile.core.IEdxEnvironment\n+import org.edx.mobile.course.CourseAPI\n+import org.edx.mobile.databinding.FragmentMyCoursesListBinding\n+import org.edx.mobile.databinding.PanelFindCourseBinding\n+import org.edx.mobile.deeplink.Screen\n+import org.edx.mobile.event.EnrolledInCourseEvent\n+import org.edx.mobile.event.MainDashboardRefreshEvent\n+import org.edx.mobile.event.MoveToDiscoveryTabEvent\n+import org.edx.mobile.event.NetworkConnectivityChangeEvent\n+import org.edx.mobile.exception.AuthException\n+import org.edx.mobile.http.HttpStatus\n+import org.edx.mobile.http.HttpStatusException\n+import org.edx.mobile.http.notifications.FullScreenErrorNotification\n+import org.edx.mobile.interfaces.RefreshListener\n+import org.edx.mobile.logger.Logger\n+import org.edx.mobile.model.api.EnrolledCoursesResponse\n+import org.edx.mobile.module.db.DataCallback\n+import org.edx.mobile.module.prefs.LoginPrefs\n+import org.edx.mobile.util.ConfigUtil.Companion.isCourseDiscoveryEnabled\n+import org.edx.mobile.util.NetworkUtil\n+import org.edx.mobile.util.UiUtil\n+import org.edx.mobile.view.adapters.MyCoursesAdapter\n+import retrofit2.Call\n+import retrofit2.Callback\n+import retrofit2.Response\n+import java.util.*\n+import javax.inject.Inject\n+\n+class MyCoursesListFragment : OfflineSupportBaseFragment(), RefreshListener {\n+    private lateinit var adapter: MyCoursesAdapter\n+    private lateinit var binding: FragmentMyCoursesListBinding\n+    private val logger = Logger(javaClass.simpleName)\n+    private var refreshOnResume = false\n+    @Inject\n+    private var environment: IEdxEnvironment? = null\n+    @Inject\n+    var api: CourseAPI? = null\n+    private lateinit var errorNotification: FullScreenErrorNotification\n+    //TODO: All these callbacks aren't essentially part of MyCoursesListFragment and should move in\n+    // the Tabs container fragment that's going to be implemented in LEARNER-3251\n+    override fun onCreate(savedInstanceState: Bundle?) {\n+        super.onCreate(savedInstanceState)\n+        adapter = object : MyCoursesAdapter(activity, environment) {\n+            override fun onItemClicked(model: EnrolledCoursesResponse) {\n+                environment.router.showCourseDashboardTabs(activity!!, model, false)\n+            }\n+\n+            override fun onAnnouncementClicked(model: EnrolledCoursesResponse) {\n+                environment.router.showCourseDashboardTabs(activity!!, model, true)\n+            }\n+        }\n+    }\n+\n+    override fun onCreateView(inflater: LayoutInflater, container: ViewGroup?,\n+                              savedInstanceState: Bundle?): View? {\n+        binding = DataBindingUtil.inflate(inflater, R.layout.fragment_my_courses_list, container, false)\n+        errorNotification = FullScreenErrorNotification(binding.myCourseList)\n+        binding.swipeContainer.setOnRefreshListener {\n+            // Hide the progress bar as swipe layout has its own progress indicator\n+            binding.loadingIndicator.root.visibility = View.GONE\n+            errorNotification.hideError()\n+            loadData(showProgress = false, isCached = false)\n+        }\n+        UiUtil.setSwipeRefreshLayoutColors(binding.swipeContainer)\n+        // Add empty view to cause divider to render at the top of the list.\n+        binding.myCourseList.addHeaderView(View(context), null, false)\n+        binding.myCourseList.adapter = adapter\n+        binding.myCourseList.onItemClickListener = adapter\n+        return binding.root\n+    }\n+\n+    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {\n+        super.onViewCreated(view, savedInstanceState)\n+        loadData(showProgress = true, isCached = true)\n+    }\n+\n+    private fun populateCourseData(data: ArrayList<EnrolledCoursesResponse>) {\n+        updateDatabaseAfterDownload(data)\n+        if (data.size > 0) {\n+            adapter.setItems(data)\n+        }\n+        addFindCoursesFooter()\n+        adapter.notifyDataSetChanged()\n+        if (adapter.isEmpty && !isCourseDiscoveryEnabled(environment!!)) {\n+            errorNotification.showError(R.string.no_courses_to_display,\n+                    FontAwesomeIcons.fa_exclamation_circle, 0, null)\n+            binding.myCourseList.visibility = View.GONE\n+        } else {\n+            binding.myCourseList.visibility = View.VISIBLE\n+            errorNotification.hideError()\n+        }\n+    }\n+\n+    private fun updateDatabaseAfterDownload(list: ArrayList<EnrolledCoursesResponse>?) {\n+        if (list != null && list.size > 0) { //update all videos in the DB as Deactivated\n+            environment?.database?.updateAllVideosAsDeactivated(dataCallback)\n+            for (i in list.indices) { //Check if the flag of isIs_active is marked to true,\n+                //then activate all videos\n+                if (list[i].isIs_active) { //update all videos for a course fetched in the API as Activated\n+                    environment?.database?.updateVideosActivatedForCourse(list[i].course.id,\n+                            dataCallback)\n+                } else {\n+                    list.removeAt(i)\n+                }\n+            }\n+            //Delete all videos which are marked as Deactivated in the database\n+            environment?.storage?.deleteAllUnenrolledVideos()\n+        }\n+    }\n+\n+    private val dataCallback: DataCallback<Int> = object : DataCallback<Int>() {\n+        override fun onResult(result: Int) {}\n+        override fun onFail(ex: Exception) {\n+            logger.error(ex)\n+        }\n+    }\n+\n+    override fun onResume() {\n+        super.onResume()\n+        if (refreshOnResume) {\n+            loadData(showProgress = false, isCached = true)\n+            refreshOnResume = false\n+        }\n+    }\n+\n+    override fun onDestroy() {\n+        super.onDestroy()\n+        EventBus.getDefault().unregister(this)\n+    }\n+\n+    fun onEventMainThread(event: EnrolledInCourseEvent?) {\n+        refreshOnResume = true\n+    }\n+\n+    private fun loadData(showProgress: Boolean, isCached: Boolean) {\n+        if (showProgress) {\n+            binding.loadingIndicator.root.visibility = View.VISIBLE\n+            errorNotification.hideError()\n+        }\n+        if (isCached) {\n+            getUserEnrolledCourses(api?.enrolledCoursesFromCache!!)\n+        }\n+        getUserEnrolledCourses(api?.enrolledCourses!!)\n+    }\n+\n+    private fun invalidateView() {\n+        binding.swipeContainer.isRefreshing = false\n+        binding.loadingIndicator.root.visibility = View.GONE\n+\n+        if (!EventBus.getDefault().isRegistered(this@MyCoursesListFragment)) {\n+            EventBus.getDefault().registerSticky(this@MyCoursesListFragment)\n+        }\n+    }\n+\n+    private fun showError(error: Throwable) {\n+        context?.let { context ->\n+            error.cause?.let { cause ->\n+                errorNotification.showError(context, cause, R.string.lbl_reload) {\n+                    if (NetworkUtil.isConnected(context)) {\n+                        onRefresh()\n+                    }\n+                }\n+            }\n+        }\n+    }\n+\n+    private fun getUserEnrolledCourses(enrolledCoursesApi: Call<List<EnrolledCoursesResponse>>) {\n+        enrolledCoursesApi.enqueue(object : Callback<List<EnrolledCoursesResponse>> {\n+            override fun onResponse(call: Call<List<EnrolledCoursesResponse>>, response: Response<List<EnrolledCoursesResponse>>) {\n+                if (response.isSuccessful && response.code() == HttpStatus.OK) {\n+                    populateCourseData(ArrayList(response.body()))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb391aa762efb5db818e222477781fe218d8960e"}, "originalPosition": 183}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI5NzczOA==", "bodyText": "there should be a Ref for this inspiration.", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r458297738", "createdAt": "2020-07-21T18:18:18Z", "author": {"login": "farhan-arshad-dev"}, "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/MyCoursesListFragment.kt", "diffHunk": "@@ -0,0 +1,256 @@\n+package org.edx.mobile.view\n+\n+import android.os.Bundle\n+import android.view.LayoutInflater\n+import android.view.View\n+import android.view.ViewGroup\n+import androidx.databinding.DataBindingUtil\n+import com.joanzapata.iconify.fonts.FontAwesomeIcons\n+import de.greenrobot.event.EventBus\n+import okhttp3.MediaType\n+import okhttp3.ResponseBody\n+import org.edx.mobile.R\n+import org.edx.mobile.core.IEdxEnvironment\n+import org.edx.mobile.course.CourseAPI\n+import org.edx.mobile.databinding.FragmentMyCoursesListBinding\n+import org.edx.mobile.databinding.PanelFindCourseBinding\n+import org.edx.mobile.deeplink.Screen\n+import org.edx.mobile.event.EnrolledInCourseEvent\n+import org.edx.mobile.event.MainDashboardRefreshEvent\n+import org.edx.mobile.event.MoveToDiscoveryTabEvent\n+import org.edx.mobile.event.NetworkConnectivityChangeEvent\n+import org.edx.mobile.exception.AuthException\n+import org.edx.mobile.http.HttpStatus\n+import org.edx.mobile.http.HttpStatusException\n+import org.edx.mobile.http.notifications.FullScreenErrorNotification\n+import org.edx.mobile.interfaces.RefreshListener\n+import org.edx.mobile.logger.Logger\n+import org.edx.mobile.model.api.EnrolledCoursesResponse\n+import org.edx.mobile.module.db.DataCallback\n+import org.edx.mobile.module.prefs.LoginPrefs\n+import org.edx.mobile.util.ConfigUtil.Companion.isCourseDiscoveryEnabled\n+import org.edx.mobile.util.NetworkUtil\n+import org.edx.mobile.util.UiUtil\n+import org.edx.mobile.view.adapters.MyCoursesAdapter\n+import retrofit2.Call\n+import retrofit2.Callback\n+import retrofit2.Response\n+import java.util.*\n+import javax.inject.Inject\n+\n+class MyCoursesListFragment : OfflineSupportBaseFragment(), RefreshListener {\n+    private lateinit var adapter: MyCoursesAdapter\n+    private lateinit var binding: FragmentMyCoursesListBinding\n+    private val logger = Logger(javaClass.simpleName)\n+    private var refreshOnResume = false\n+    @Inject\n+    private var environment: IEdxEnvironment? = null\n+    @Inject\n+    var api: CourseAPI? = null\n+    private lateinit var errorNotification: FullScreenErrorNotification\n+    //TODO: All these callbacks aren't essentially part of MyCoursesListFragment and should move in\n+    // the Tabs container fragment that's going to be implemented in LEARNER-3251\n+    override fun onCreate(savedInstanceState: Bundle?) {\n+        super.onCreate(savedInstanceState)\n+        adapter = object : MyCoursesAdapter(activity, environment) {\n+            override fun onItemClicked(model: EnrolledCoursesResponse) {\n+                environment.router.showCourseDashboardTabs(activity!!, model, false)\n+            }\n+\n+            override fun onAnnouncementClicked(model: EnrolledCoursesResponse) {\n+                environment.router.showCourseDashboardTabs(activity!!, model, true)\n+            }\n+        }\n+    }\n+\n+    override fun onCreateView(inflater: LayoutInflater, container: ViewGroup?,\n+                              savedInstanceState: Bundle?): View? {\n+        binding = DataBindingUtil.inflate(inflater, R.layout.fragment_my_courses_list, container, false)\n+        errorNotification = FullScreenErrorNotification(binding.myCourseList)\n+        binding.swipeContainer.setOnRefreshListener {\n+            // Hide the progress bar as swipe layout has its own progress indicator\n+            binding.loadingIndicator.root.visibility = View.GONE\n+            errorNotification.hideError()\n+            loadData(showProgress = false, isCached = false)\n+        }\n+        UiUtil.setSwipeRefreshLayoutColors(binding.swipeContainer)\n+        // Add empty view to cause divider to render at the top of the list.\n+        binding.myCourseList.addHeaderView(View(context), null, false)\n+        binding.myCourseList.adapter = adapter\n+        binding.myCourseList.onItemClickListener = adapter\n+        return binding.root\n+    }\n+\n+    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {\n+        super.onViewCreated(view, savedInstanceState)\n+        loadData(showProgress = true, isCached = true)\n+    }\n+\n+    private fun populateCourseData(data: ArrayList<EnrolledCoursesResponse>) {\n+        updateDatabaseAfterDownload(data)\n+        if (data.size > 0) {\n+            adapter.setItems(data)\n+        }\n+        addFindCoursesFooter()\n+        adapter.notifyDataSetChanged()\n+        if (adapter.isEmpty && !isCourseDiscoveryEnabled(environment!!)) {\n+            errorNotification.showError(R.string.no_courses_to_display,\n+                    FontAwesomeIcons.fa_exclamation_circle, 0, null)\n+            binding.myCourseList.visibility = View.GONE\n+        } else {\n+            binding.myCourseList.visibility = View.VISIBLE\n+            errorNotification.hideError()\n+        }\n+    }\n+\n+    private fun updateDatabaseAfterDownload(list: ArrayList<EnrolledCoursesResponse>?) {\n+        if (list != null && list.size > 0) { //update all videos in the DB as Deactivated\n+            environment?.database?.updateAllVideosAsDeactivated(dataCallback)\n+            for (i in list.indices) { //Check if the flag of isIs_active is marked to true,\n+                //then activate all videos\n+                if (list[i].isIs_active) { //update all videos for a course fetched in the API as Activated\n+                    environment?.database?.updateVideosActivatedForCourse(list[i].course.id,\n+                            dataCallback)\n+                } else {\n+                    list.removeAt(i)\n+                }\n+            }\n+            //Delete all videos which are marked as Deactivated in the database\n+            environment?.storage?.deleteAllUnenrolledVideos()\n+        }\n+    }\n+\n+    private val dataCallback: DataCallback<Int> = object : DataCallback<Int>() {\n+        override fun onResult(result: Int) {}\n+        override fun onFail(ex: Exception) {\n+            logger.error(ex)\n+        }\n+    }\n+\n+    override fun onResume() {\n+        super.onResume()\n+        if (refreshOnResume) {\n+            loadData(showProgress = false, isCached = true)\n+            refreshOnResume = false\n+        }\n+    }\n+\n+    override fun onDestroy() {\n+        super.onDestroy()\n+        EventBus.getDefault().unregister(this)\n+    }\n+\n+    fun onEventMainThread(event: EnrolledInCourseEvent?) {\n+        refreshOnResume = true\n+    }\n+\n+    private fun loadData(showProgress: Boolean, isCached: Boolean) {\n+        if (showProgress) {\n+            binding.loadingIndicator.root.visibility = View.VISIBLE\n+            errorNotification.hideError()\n+        }\n+        if (isCached) {\n+            getUserEnrolledCourses(api?.enrolledCoursesFromCache!!)\n+        }\n+        getUserEnrolledCourses(api?.enrolledCourses!!)\n+    }\n+\n+    private fun invalidateView() {\n+        binding.swipeContainer.isRefreshing = false\n+        binding.loadingIndicator.root.visibility = View.GONE\n+\n+        if (!EventBus.getDefault().isRegistered(this@MyCoursesListFragment)) {\n+            EventBus.getDefault().registerSticky(this@MyCoursesListFragment)\n+        }\n+    }\n+\n+    private fun showError(error: Throwable) {\n+        context?.let { context ->\n+            error.cause?.let { cause ->\n+                errorNotification.showError(context, cause, R.string.lbl_reload) {\n+                    if (NetworkUtil.isConnected(context)) {\n+                        onRefresh()\n+                    }\n+                }\n+            }\n+        }\n+    }\n+\n+    private fun getUserEnrolledCourses(enrolledCoursesApi: Call<List<EnrolledCoursesResponse>>) {\n+        enrolledCoursesApi.enqueue(object : Callback<List<EnrolledCoursesResponse>> {\n+            override fun onResponse(call: Call<List<EnrolledCoursesResponse>>, response: Response<List<EnrolledCoursesResponse>>) {\n+                if (response.isSuccessful && response.code() == HttpStatus.OK) {\n+                    populateCourseData(ArrayList(response.body()))\n+                } else if (response.code() == HttpStatus.UNAUTHORIZED) {\n+                    environment?.router?.forceLogout(context,\n+                            environment?.analyticsRegistry,\n+                            environment?.notificationDelegate)\n+                } else {\n+                    showError(HttpStatusException(Response.error<Any>(HttpStatus.INTERNAL_SERVER_ERROR,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb391aa762efb5db818e222477781fe218d8960e"}, "originalPosition": 189}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI5OTMxOA==", "bodyText": "comment should be in the next line.", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r458299318", "createdAt": "2020-07-21T18:20:50Z", "author": {"login": "farhan-arshad-dev"}, "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/MyCoursesListFragment.kt", "diffHunk": "@@ -0,0 +1,256 @@\n+package org.edx.mobile.view\n+\n+import android.os.Bundle\n+import android.view.LayoutInflater\n+import android.view.View\n+import android.view.ViewGroup\n+import androidx.databinding.DataBindingUtil\n+import com.joanzapata.iconify.fonts.FontAwesomeIcons\n+import de.greenrobot.event.EventBus\n+import okhttp3.MediaType\n+import okhttp3.ResponseBody\n+import org.edx.mobile.R\n+import org.edx.mobile.core.IEdxEnvironment\n+import org.edx.mobile.course.CourseAPI\n+import org.edx.mobile.databinding.FragmentMyCoursesListBinding\n+import org.edx.mobile.databinding.PanelFindCourseBinding\n+import org.edx.mobile.deeplink.Screen\n+import org.edx.mobile.event.EnrolledInCourseEvent\n+import org.edx.mobile.event.MainDashboardRefreshEvent\n+import org.edx.mobile.event.MoveToDiscoveryTabEvent\n+import org.edx.mobile.event.NetworkConnectivityChangeEvent\n+import org.edx.mobile.exception.AuthException\n+import org.edx.mobile.http.HttpStatus\n+import org.edx.mobile.http.HttpStatusException\n+import org.edx.mobile.http.notifications.FullScreenErrorNotification\n+import org.edx.mobile.interfaces.RefreshListener\n+import org.edx.mobile.logger.Logger\n+import org.edx.mobile.model.api.EnrolledCoursesResponse\n+import org.edx.mobile.module.db.DataCallback\n+import org.edx.mobile.module.prefs.LoginPrefs\n+import org.edx.mobile.util.ConfigUtil.Companion.isCourseDiscoveryEnabled\n+import org.edx.mobile.util.NetworkUtil\n+import org.edx.mobile.util.UiUtil\n+import org.edx.mobile.view.adapters.MyCoursesAdapter\n+import retrofit2.Call\n+import retrofit2.Callback\n+import retrofit2.Response\n+import java.util.*\n+import javax.inject.Inject\n+\n+class MyCoursesListFragment : OfflineSupportBaseFragment(), RefreshListener {\n+    private lateinit var adapter: MyCoursesAdapter\n+    private lateinit var binding: FragmentMyCoursesListBinding\n+    private val logger = Logger(javaClass.simpleName)\n+    private var refreshOnResume = false\n+    @Inject\n+    private var environment: IEdxEnvironment? = null\n+    @Inject\n+    var api: CourseAPI? = null\n+    private lateinit var errorNotification: FullScreenErrorNotification\n+    //TODO: All these callbacks aren't essentially part of MyCoursesListFragment and should move in\n+    // the Tabs container fragment that's going to be implemented in LEARNER-3251\n+    override fun onCreate(savedInstanceState: Bundle?) {\n+        super.onCreate(savedInstanceState)\n+        adapter = object : MyCoursesAdapter(activity, environment) {\n+            override fun onItemClicked(model: EnrolledCoursesResponse) {\n+                environment.router.showCourseDashboardTabs(activity!!, model, false)\n+            }\n+\n+            override fun onAnnouncementClicked(model: EnrolledCoursesResponse) {\n+                environment.router.showCourseDashboardTabs(activity!!, model, true)\n+            }\n+        }\n+    }\n+\n+    override fun onCreateView(inflater: LayoutInflater, container: ViewGroup?,\n+                              savedInstanceState: Bundle?): View? {\n+        binding = DataBindingUtil.inflate(inflater, R.layout.fragment_my_courses_list, container, false)\n+        errorNotification = FullScreenErrorNotification(binding.myCourseList)\n+        binding.swipeContainer.setOnRefreshListener {\n+            // Hide the progress bar as swipe layout has its own progress indicator\n+            binding.loadingIndicator.root.visibility = View.GONE\n+            errorNotification.hideError()\n+            loadData(showProgress = false, isCached = false)\n+        }\n+        UiUtil.setSwipeRefreshLayoutColors(binding.swipeContainer)\n+        // Add empty view to cause divider to render at the top of the list.\n+        binding.myCourseList.addHeaderView(View(context), null, false)\n+        binding.myCourseList.adapter = adapter\n+        binding.myCourseList.onItemClickListener = adapter\n+        return binding.root\n+    }\n+\n+    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {\n+        super.onViewCreated(view, savedInstanceState)\n+        loadData(showProgress = true, isCached = true)\n+    }\n+\n+    private fun populateCourseData(data: ArrayList<EnrolledCoursesResponse>) {\n+        updateDatabaseAfterDownload(data)\n+        if (data.size > 0) {\n+            adapter.setItems(data)\n+        }\n+        addFindCoursesFooter()\n+        adapter.notifyDataSetChanged()\n+        if (adapter.isEmpty && !isCourseDiscoveryEnabled(environment!!)) {\n+            errorNotification.showError(R.string.no_courses_to_display,\n+                    FontAwesomeIcons.fa_exclamation_circle, 0, null)\n+            binding.myCourseList.visibility = View.GONE\n+        } else {\n+            binding.myCourseList.visibility = View.VISIBLE\n+            errorNotification.hideError()\n+        }\n+    }\n+\n+    private fun updateDatabaseAfterDownload(list: ArrayList<EnrolledCoursesResponse>?) {\n+        if (list != null && list.size > 0) { //update all videos in the DB as Deactivated\n+            environment?.database?.updateAllVideosAsDeactivated(dataCallback)\n+            for (i in list.indices) { //Check if the flag of isIs_active is marked to true,\n+                //then activate all videos\n+                if (list[i].isIs_active) { //update all videos for a course fetched in the API as Activated\n+                    environment?.database?.updateVideosActivatedForCourse(list[i].course.id,\n+                            dataCallback)\n+                } else {\n+                    list.removeAt(i)\n+                }\n+            }\n+            //Delete all videos which are marked as Deactivated in the database\n+            environment?.storage?.deleteAllUnenrolledVideos()\n+        }\n+    }\n+\n+    private val dataCallback: DataCallback<Int> = object : DataCallback<Int>() {\n+        override fun onResult(result: Int) {}\n+        override fun onFail(ex: Exception) {\n+            logger.error(ex)\n+        }\n+    }\n+\n+    override fun onResume() {\n+        super.onResume()\n+        if (refreshOnResume) {\n+            loadData(showProgress = false, isCached = true)\n+            refreshOnResume = false\n+        }\n+    }\n+\n+    override fun onDestroy() {\n+        super.onDestroy()\n+        EventBus.getDefault().unregister(this)\n+    }\n+\n+    fun onEventMainThread(event: EnrolledInCourseEvent?) {\n+        refreshOnResume = true\n+    }\n+\n+    private fun loadData(showProgress: Boolean, isCached: Boolean) {\n+        if (showProgress) {\n+            binding.loadingIndicator.root.visibility = View.VISIBLE\n+            errorNotification.hideError()\n+        }\n+        if (isCached) {\n+            getUserEnrolledCourses(api?.enrolledCoursesFromCache!!)\n+        }\n+        getUserEnrolledCourses(api?.enrolledCourses!!)\n+    }\n+\n+    private fun invalidateView() {\n+        binding.swipeContainer.isRefreshing = false\n+        binding.loadingIndicator.root.visibility = View.GONE\n+\n+        if (!EventBus.getDefault().isRegistered(this@MyCoursesListFragment)) {\n+            EventBus.getDefault().registerSticky(this@MyCoursesListFragment)\n+        }\n+    }\n+\n+    private fun showError(error: Throwable) {\n+        context?.let { context ->\n+            error.cause?.let { cause ->\n+                errorNotification.showError(context, cause, R.string.lbl_reload) {\n+                    if (NetworkUtil.isConnected(context)) {\n+                        onRefresh()\n+                    }\n+                }\n+            }\n+        }\n+    }\n+\n+    private fun getUserEnrolledCourses(enrolledCoursesApi: Call<List<EnrolledCoursesResponse>>) {\n+        enrolledCoursesApi.enqueue(object : Callback<List<EnrolledCoursesResponse>> {\n+            override fun onResponse(call: Call<List<EnrolledCoursesResponse>>, response: Response<List<EnrolledCoursesResponse>>) {\n+                if (response.isSuccessful && response.code() == HttpStatus.OK) {\n+                    populateCourseData(ArrayList(response.body()))\n+                } else if (response.code() == HttpStatus.UNAUTHORIZED) {\n+                    environment?.router?.forceLogout(context,\n+                            environment?.analyticsRegistry,\n+                            environment?.notificationDelegate)\n+                } else {\n+                    showError(HttpStatusException(Response.error<Any>(HttpStatus.INTERNAL_SERVER_ERROR,\n+                            ResponseBody.create(MediaType.parse(\"text/plain\"), response.message()))))\n+                }\n+                invalidateView()\n+            }\n+\n+            override fun onFailure(call: Call<List<EnrolledCoursesResponse>>, t: Throwable) {\n+                if (t is AuthException || (t is HttpStatusException && t.statusCode == HttpStatus.UNAUTHORIZED)) {\n+                    environment?.router?.forceLogout(context,\n+                            environment?.analyticsRegistry,\n+                            environment?.notificationDelegate)\n+                } else {\n+                    showError(t)\n+                    invalidateView()\n+                }\n+            }\n+        })\n+\n+    }\n+\n+    private fun addFindCoursesFooter() { // Validate footer is not already added.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb391aa762efb5db818e222477781fe218d8960e"}, "originalPosition": 209}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI5OTQ2Ng==", "bodyText": "comment should be in the next line.", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r458299466", "createdAt": "2020-07-21T18:21:05Z", "author": {"login": "farhan-arshad-dev"}, "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/MyCoursesListFragment.kt", "diffHunk": "@@ -0,0 +1,256 @@\n+package org.edx.mobile.view\n+\n+import android.os.Bundle\n+import android.view.LayoutInflater\n+import android.view.View\n+import android.view.ViewGroup\n+import androidx.databinding.DataBindingUtil\n+import com.joanzapata.iconify.fonts.FontAwesomeIcons\n+import de.greenrobot.event.EventBus\n+import okhttp3.MediaType\n+import okhttp3.ResponseBody\n+import org.edx.mobile.R\n+import org.edx.mobile.core.IEdxEnvironment\n+import org.edx.mobile.course.CourseAPI\n+import org.edx.mobile.databinding.FragmentMyCoursesListBinding\n+import org.edx.mobile.databinding.PanelFindCourseBinding\n+import org.edx.mobile.deeplink.Screen\n+import org.edx.mobile.event.EnrolledInCourseEvent\n+import org.edx.mobile.event.MainDashboardRefreshEvent\n+import org.edx.mobile.event.MoveToDiscoveryTabEvent\n+import org.edx.mobile.event.NetworkConnectivityChangeEvent\n+import org.edx.mobile.exception.AuthException\n+import org.edx.mobile.http.HttpStatus\n+import org.edx.mobile.http.HttpStatusException\n+import org.edx.mobile.http.notifications.FullScreenErrorNotification\n+import org.edx.mobile.interfaces.RefreshListener\n+import org.edx.mobile.logger.Logger\n+import org.edx.mobile.model.api.EnrolledCoursesResponse\n+import org.edx.mobile.module.db.DataCallback\n+import org.edx.mobile.module.prefs.LoginPrefs\n+import org.edx.mobile.util.ConfigUtil.Companion.isCourseDiscoveryEnabled\n+import org.edx.mobile.util.NetworkUtil\n+import org.edx.mobile.util.UiUtil\n+import org.edx.mobile.view.adapters.MyCoursesAdapter\n+import retrofit2.Call\n+import retrofit2.Callback\n+import retrofit2.Response\n+import java.util.*\n+import javax.inject.Inject\n+\n+class MyCoursesListFragment : OfflineSupportBaseFragment(), RefreshListener {\n+    private lateinit var adapter: MyCoursesAdapter\n+    private lateinit var binding: FragmentMyCoursesListBinding\n+    private val logger = Logger(javaClass.simpleName)\n+    private var refreshOnResume = false\n+    @Inject\n+    private var environment: IEdxEnvironment? = null\n+    @Inject\n+    var api: CourseAPI? = null\n+    private lateinit var errorNotification: FullScreenErrorNotification\n+    //TODO: All these callbacks aren't essentially part of MyCoursesListFragment and should move in\n+    // the Tabs container fragment that's going to be implemented in LEARNER-3251\n+    override fun onCreate(savedInstanceState: Bundle?) {\n+        super.onCreate(savedInstanceState)\n+        adapter = object : MyCoursesAdapter(activity, environment) {\n+            override fun onItemClicked(model: EnrolledCoursesResponse) {\n+                environment.router.showCourseDashboardTabs(activity!!, model, false)\n+            }\n+\n+            override fun onAnnouncementClicked(model: EnrolledCoursesResponse) {\n+                environment.router.showCourseDashboardTabs(activity!!, model, true)\n+            }\n+        }\n+    }\n+\n+    override fun onCreateView(inflater: LayoutInflater, container: ViewGroup?,\n+                              savedInstanceState: Bundle?): View? {\n+        binding = DataBindingUtil.inflate(inflater, R.layout.fragment_my_courses_list, container, false)\n+        errorNotification = FullScreenErrorNotification(binding.myCourseList)\n+        binding.swipeContainer.setOnRefreshListener {\n+            // Hide the progress bar as swipe layout has its own progress indicator\n+            binding.loadingIndicator.root.visibility = View.GONE\n+            errorNotification.hideError()\n+            loadData(showProgress = false, isCached = false)\n+        }\n+        UiUtil.setSwipeRefreshLayoutColors(binding.swipeContainer)\n+        // Add empty view to cause divider to render at the top of the list.\n+        binding.myCourseList.addHeaderView(View(context), null, false)\n+        binding.myCourseList.adapter = adapter\n+        binding.myCourseList.onItemClickListener = adapter\n+        return binding.root\n+    }\n+\n+    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {\n+        super.onViewCreated(view, savedInstanceState)\n+        loadData(showProgress = true, isCached = true)\n+    }\n+\n+    private fun populateCourseData(data: ArrayList<EnrolledCoursesResponse>) {\n+        updateDatabaseAfterDownload(data)\n+        if (data.size > 0) {\n+            adapter.setItems(data)\n+        }\n+        addFindCoursesFooter()\n+        adapter.notifyDataSetChanged()\n+        if (adapter.isEmpty && !isCourseDiscoveryEnabled(environment!!)) {\n+            errorNotification.showError(R.string.no_courses_to_display,\n+                    FontAwesomeIcons.fa_exclamation_circle, 0, null)\n+            binding.myCourseList.visibility = View.GONE\n+        } else {\n+            binding.myCourseList.visibility = View.VISIBLE\n+            errorNotification.hideError()\n+        }\n+    }\n+\n+    private fun updateDatabaseAfterDownload(list: ArrayList<EnrolledCoursesResponse>?) {\n+        if (list != null && list.size > 0) { //update all videos in the DB as Deactivated\n+            environment?.database?.updateAllVideosAsDeactivated(dataCallback)\n+            for (i in list.indices) { //Check if the flag of isIs_active is marked to true,\n+                //then activate all videos\n+                if (list[i].isIs_active) { //update all videos for a course fetched in the API as Activated\n+                    environment?.database?.updateVideosActivatedForCourse(list[i].course.id,\n+                            dataCallback)\n+                } else {\n+                    list.removeAt(i)\n+                }\n+            }\n+            //Delete all videos which are marked as Deactivated in the database\n+            environment?.storage?.deleteAllUnenrolledVideos()\n+        }\n+    }\n+\n+    private val dataCallback: DataCallback<Int> = object : DataCallback<Int>() {\n+        override fun onResult(result: Int) {}\n+        override fun onFail(ex: Exception) {\n+            logger.error(ex)\n+        }\n+    }\n+\n+    override fun onResume() {\n+        super.onResume()\n+        if (refreshOnResume) {\n+            loadData(showProgress = false, isCached = true)\n+            refreshOnResume = false\n+        }\n+    }\n+\n+    override fun onDestroy() {\n+        super.onDestroy()\n+        EventBus.getDefault().unregister(this)\n+    }\n+\n+    fun onEventMainThread(event: EnrolledInCourseEvent?) {\n+        refreshOnResume = true\n+    }\n+\n+    private fun loadData(showProgress: Boolean, isCached: Boolean) {\n+        if (showProgress) {\n+            binding.loadingIndicator.root.visibility = View.VISIBLE\n+            errorNotification.hideError()\n+        }\n+        if (isCached) {\n+            getUserEnrolledCourses(api?.enrolledCoursesFromCache!!)\n+        }\n+        getUserEnrolledCourses(api?.enrolledCourses!!)\n+    }\n+\n+    private fun invalidateView() {\n+        binding.swipeContainer.isRefreshing = false\n+        binding.loadingIndicator.root.visibility = View.GONE\n+\n+        if (!EventBus.getDefault().isRegistered(this@MyCoursesListFragment)) {\n+            EventBus.getDefault().registerSticky(this@MyCoursesListFragment)\n+        }\n+    }\n+\n+    private fun showError(error: Throwable) {\n+        context?.let { context ->\n+            error.cause?.let { cause ->\n+                errorNotification.showError(context, cause, R.string.lbl_reload) {\n+                    if (NetworkUtil.isConnected(context)) {\n+                        onRefresh()\n+                    }\n+                }\n+            }\n+        }\n+    }\n+\n+    private fun getUserEnrolledCourses(enrolledCoursesApi: Call<List<EnrolledCoursesResponse>>) {\n+        enrolledCoursesApi.enqueue(object : Callback<List<EnrolledCoursesResponse>> {\n+            override fun onResponse(call: Call<List<EnrolledCoursesResponse>>, response: Response<List<EnrolledCoursesResponse>>) {\n+                if (response.isSuccessful && response.code() == HttpStatus.OK) {\n+                    populateCourseData(ArrayList(response.body()))\n+                } else if (response.code() == HttpStatus.UNAUTHORIZED) {\n+                    environment?.router?.forceLogout(context,\n+                            environment?.analyticsRegistry,\n+                            environment?.notificationDelegate)\n+                } else {\n+                    showError(HttpStatusException(Response.error<Any>(HttpStatus.INTERNAL_SERVER_ERROR,\n+                            ResponseBody.create(MediaType.parse(\"text/plain\"), response.message()))))\n+                }\n+                invalidateView()\n+            }\n+\n+            override fun onFailure(call: Call<List<EnrolledCoursesResponse>>, t: Throwable) {\n+                if (t is AuthException || (t is HttpStatusException && t.statusCode == HttpStatus.UNAUTHORIZED)) {\n+                    environment?.router?.forceLogout(context,\n+                            environment?.analyticsRegistry,\n+                            environment?.notificationDelegate)\n+                } else {\n+                    showError(t)\n+                    invalidateView()\n+                }\n+            }\n+        })\n+\n+    }\n+\n+    private fun addFindCoursesFooter() { // Validate footer is not already added.\n+        if (binding.myCourseList.footerViewsCount > 0) {\n+            return\n+        }\n+        if (isCourseDiscoveryEnabled(environment!!)) { // Add 'Find a Course' list item as a footer.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb391aa762efb5db818e222477781fe218d8960e"}, "originalPosition": 213}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODMwMDExNg==", "bodyText": "comment should be in the next line.", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r458300116", "createdAt": "2020-07-21T18:22:17Z", "author": {"login": "farhan-arshad-dev"}, "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/MyCoursesListFragment.kt", "diffHunk": "@@ -0,0 +1,256 @@\n+package org.edx.mobile.view\n+\n+import android.os.Bundle\n+import android.view.LayoutInflater\n+import android.view.View\n+import android.view.ViewGroup\n+import androidx.databinding.DataBindingUtil\n+import com.joanzapata.iconify.fonts.FontAwesomeIcons\n+import de.greenrobot.event.EventBus\n+import okhttp3.MediaType\n+import okhttp3.ResponseBody\n+import org.edx.mobile.R\n+import org.edx.mobile.core.IEdxEnvironment\n+import org.edx.mobile.course.CourseAPI\n+import org.edx.mobile.databinding.FragmentMyCoursesListBinding\n+import org.edx.mobile.databinding.PanelFindCourseBinding\n+import org.edx.mobile.deeplink.Screen\n+import org.edx.mobile.event.EnrolledInCourseEvent\n+import org.edx.mobile.event.MainDashboardRefreshEvent\n+import org.edx.mobile.event.MoveToDiscoveryTabEvent\n+import org.edx.mobile.event.NetworkConnectivityChangeEvent\n+import org.edx.mobile.exception.AuthException\n+import org.edx.mobile.http.HttpStatus\n+import org.edx.mobile.http.HttpStatusException\n+import org.edx.mobile.http.notifications.FullScreenErrorNotification\n+import org.edx.mobile.interfaces.RefreshListener\n+import org.edx.mobile.logger.Logger\n+import org.edx.mobile.model.api.EnrolledCoursesResponse\n+import org.edx.mobile.module.db.DataCallback\n+import org.edx.mobile.module.prefs.LoginPrefs\n+import org.edx.mobile.util.ConfigUtil.Companion.isCourseDiscoveryEnabled\n+import org.edx.mobile.util.NetworkUtil\n+import org.edx.mobile.util.UiUtil\n+import org.edx.mobile.view.adapters.MyCoursesAdapter\n+import retrofit2.Call\n+import retrofit2.Callback\n+import retrofit2.Response\n+import java.util.*\n+import javax.inject.Inject\n+\n+class MyCoursesListFragment : OfflineSupportBaseFragment(), RefreshListener {\n+    private lateinit var adapter: MyCoursesAdapter\n+    private lateinit var binding: FragmentMyCoursesListBinding\n+    private val logger = Logger(javaClass.simpleName)\n+    private var refreshOnResume = false\n+    @Inject\n+    private var environment: IEdxEnvironment? = null\n+    @Inject\n+    var api: CourseAPI? = null\n+    private lateinit var errorNotification: FullScreenErrorNotification\n+    //TODO: All these callbacks aren't essentially part of MyCoursesListFragment and should move in\n+    // the Tabs container fragment that's going to be implemented in LEARNER-3251\n+    override fun onCreate(savedInstanceState: Bundle?) {\n+        super.onCreate(savedInstanceState)\n+        adapter = object : MyCoursesAdapter(activity, environment) {\n+            override fun onItemClicked(model: EnrolledCoursesResponse) {\n+                environment.router.showCourseDashboardTabs(activity!!, model, false)\n+            }\n+\n+            override fun onAnnouncementClicked(model: EnrolledCoursesResponse) {\n+                environment.router.showCourseDashboardTabs(activity!!, model, true)\n+            }\n+        }\n+    }\n+\n+    override fun onCreateView(inflater: LayoutInflater, container: ViewGroup?,\n+                              savedInstanceState: Bundle?): View? {\n+        binding = DataBindingUtil.inflate(inflater, R.layout.fragment_my_courses_list, container, false)\n+        errorNotification = FullScreenErrorNotification(binding.myCourseList)\n+        binding.swipeContainer.setOnRefreshListener {\n+            // Hide the progress bar as swipe layout has its own progress indicator\n+            binding.loadingIndicator.root.visibility = View.GONE\n+            errorNotification.hideError()\n+            loadData(showProgress = false, isCached = false)\n+        }\n+        UiUtil.setSwipeRefreshLayoutColors(binding.swipeContainer)\n+        // Add empty view to cause divider to render at the top of the list.\n+        binding.myCourseList.addHeaderView(View(context), null, false)\n+        binding.myCourseList.adapter = adapter\n+        binding.myCourseList.onItemClickListener = adapter\n+        return binding.root\n+    }\n+\n+    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {\n+        super.onViewCreated(view, savedInstanceState)\n+        loadData(showProgress = true, isCached = true)\n+    }\n+\n+    private fun populateCourseData(data: ArrayList<EnrolledCoursesResponse>) {\n+        updateDatabaseAfterDownload(data)\n+        if (data.size > 0) {\n+            adapter.setItems(data)\n+        }\n+        addFindCoursesFooter()\n+        adapter.notifyDataSetChanged()\n+        if (adapter.isEmpty && !isCourseDiscoveryEnabled(environment!!)) {\n+            errorNotification.showError(R.string.no_courses_to_display,\n+                    FontAwesomeIcons.fa_exclamation_circle, 0, null)\n+            binding.myCourseList.visibility = View.GONE\n+        } else {\n+            binding.myCourseList.visibility = View.VISIBLE\n+            errorNotification.hideError()\n+        }\n+    }\n+\n+    private fun updateDatabaseAfterDownload(list: ArrayList<EnrolledCoursesResponse>?) {\n+        if (list != null && list.size > 0) { //update all videos in the DB as Deactivated", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb391aa762efb5db818e222477781fe218d8960e"}, "originalPosition": 107}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODMwMDE1NA==", "bodyText": "comment should be in the next line.", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r458300154", "createdAt": "2020-07-21T18:22:22Z", "author": {"login": "farhan-arshad-dev"}, "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/MyCoursesListFragment.kt", "diffHunk": "@@ -0,0 +1,256 @@\n+package org.edx.mobile.view\n+\n+import android.os.Bundle\n+import android.view.LayoutInflater\n+import android.view.View\n+import android.view.ViewGroup\n+import androidx.databinding.DataBindingUtil\n+import com.joanzapata.iconify.fonts.FontAwesomeIcons\n+import de.greenrobot.event.EventBus\n+import okhttp3.MediaType\n+import okhttp3.ResponseBody\n+import org.edx.mobile.R\n+import org.edx.mobile.core.IEdxEnvironment\n+import org.edx.mobile.course.CourseAPI\n+import org.edx.mobile.databinding.FragmentMyCoursesListBinding\n+import org.edx.mobile.databinding.PanelFindCourseBinding\n+import org.edx.mobile.deeplink.Screen\n+import org.edx.mobile.event.EnrolledInCourseEvent\n+import org.edx.mobile.event.MainDashboardRefreshEvent\n+import org.edx.mobile.event.MoveToDiscoveryTabEvent\n+import org.edx.mobile.event.NetworkConnectivityChangeEvent\n+import org.edx.mobile.exception.AuthException\n+import org.edx.mobile.http.HttpStatus\n+import org.edx.mobile.http.HttpStatusException\n+import org.edx.mobile.http.notifications.FullScreenErrorNotification\n+import org.edx.mobile.interfaces.RefreshListener\n+import org.edx.mobile.logger.Logger\n+import org.edx.mobile.model.api.EnrolledCoursesResponse\n+import org.edx.mobile.module.db.DataCallback\n+import org.edx.mobile.module.prefs.LoginPrefs\n+import org.edx.mobile.util.ConfigUtil.Companion.isCourseDiscoveryEnabled\n+import org.edx.mobile.util.NetworkUtil\n+import org.edx.mobile.util.UiUtil\n+import org.edx.mobile.view.adapters.MyCoursesAdapter\n+import retrofit2.Call\n+import retrofit2.Callback\n+import retrofit2.Response\n+import java.util.*\n+import javax.inject.Inject\n+\n+class MyCoursesListFragment : OfflineSupportBaseFragment(), RefreshListener {\n+    private lateinit var adapter: MyCoursesAdapter\n+    private lateinit var binding: FragmentMyCoursesListBinding\n+    private val logger = Logger(javaClass.simpleName)\n+    private var refreshOnResume = false\n+    @Inject\n+    private var environment: IEdxEnvironment? = null\n+    @Inject\n+    var api: CourseAPI? = null\n+    private lateinit var errorNotification: FullScreenErrorNotification\n+    //TODO: All these callbacks aren't essentially part of MyCoursesListFragment and should move in\n+    // the Tabs container fragment that's going to be implemented in LEARNER-3251\n+    override fun onCreate(savedInstanceState: Bundle?) {\n+        super.onCreate(savedInstanceState)\n+        adapter = object : MyCoursesAdapter(activity, environment) {\n+            override fun onItemClicked(model: EnrolledCoursesResponse) {\n+                environment.router.showCourseDashboardTabs(activity!!, model, false)\n+            }\n+\n+            override fun onAnnouncementClicked(model: EnrolledCoursesResponse) {\n+                environment.router.showCourseDashboardTabs(activity!!, model, true)\n+            }\n+        }\n+    }\n+\n+    override fun onCreateView(inflater: LayoutInflater, container: ViewGroup?,\n+                              savedInstanceState: Bundle?): View? {\n+        binding = DataBindingUtil.inflate(inflater, R.layout.fragment_my_courses_list, container, false)\n+        errorNotification = FullScreenErrorNotification(binding.myCourseList)\n+        binding.swipeContainer.setOnRefreshListener {\n+            // Hide the progress bar as swipe layout has its own progress indicator\n+            binding.loadingIndicator.root.visibility = View.GONE\n+            errorNotification.hideError()\n+            loadData(showProgress = false, isCached = false)\n+        }\n+        UiUtil.setSwipeRefreshLayoutColors(binding.swipeContainer)\n+        // Add empty view to cause divider to render at the top of the list.\n+        binding.myCourseList.addHeaderView(View(context), null, false)\n+        binding.myCourseList.adapter = adapter\n+        binding.myCourseList.onItemClickListener = adapter\n+        return binding.root\n+    }\n+\n+    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {\n+        super.onViewCreated(view, savedInstanceState)\n+        loadData(showProgress = true, isCached = true)\n+    }\n+\n+    private fun populateCourseData(data: ArrayList<EnrolledCoursesResponse>) {\n+        updateDatabaseAfterDownload(data)\n+        if (data.size > 0) {\n+            adapter.setItems(data)\n+        }\n+        addFindCoursesFooter()\n+        adapter.notifyDataSetChanged()\n+        if (adapter.isEmpty && !isCourseDiscoveryEnabled(environment!!)) {\n+            errorNotification.showError(R.string.no_courses_to_display,\n+                    FontAwesomeIcons.fa_exclamation_circle, 0, null)\n+            binding.myCourseList.visibility = View.GONE\n+        } else {\n+            binding.myCourseList.visibility = View.VISIBLE\n+            errorNotification.hideError()\n+        }\n+    }\n+\n+    private fun updateDatabaseAfterDownload(list: ArrayList<EnrolledCoursesResponse>?) {\n+        if (list != null && list.size > 0) { //update all videos in the DB as Deactivated\n+            environment?.database?.updateAllVideosAsDeactivated(dataCallback)\n+            for (i in list.indices) { //Check if the flag of isIs_active is marked to true,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb391aa762efb5db818e222477781fe218d8960e"}, "originalPosition": 109}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODMwMDIwNA==", "bodyText": "comment should be in the next line.", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r458300204", "createdAt": "2020-07-21T18:22:26Z", "author": {"login": "farhan-arshad-dev"}, "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/MyCoursesListFragment.kt", "diffHunk": "@@ -0,0 +1,256 @@\n+package org.edx.mobile.view\n+\n+import android.os.Bundle\n+import android.view.LayoutInflater\n+import android.view.View\n+import android.view.ViewGroup\n+import androidx.databinding.DataBindingUtil\n+import com.joanzapata.iconify.fonts.FontAwesomeIcons\n+import de.greenrobot.event.EventBus\n+import okhttp3.MediaType\n+import okhttp3.ResponseBody\n+import org.edx.mobile.R\n+import org.edx.mobile.core.IEdxEnvironment\n+import org.edx.mobile.course.CourseAPI\n+import org.edx.mobile.databinding.FragmentMyCoursesListBinding\n+import org.edx.mobile.databinding.PanelFindCourseBinding\n+import org.edx.mobile.deeplink.Screen\n+import org.edx.mobile.event.EnrolledInCourseEvent\n+import org.edx.mobile.event.MainDashboardRefreshEvent\n+import org.edx.mobile.event.MoveToDiscoveryTabEvent\n+import org.edx.mobile.event.NetworkConnectivityChangeEvent\n+import org.edx.mobile.exception.AuthException\n+import org.edx.mobile.http.HttpStatus\n+import org.edx.mobile.http.HttpStatusException\n+import org.edx.mobile.http.notifications.FullScreenErrorNotification\n+import org.edx.mobile.interfaces.RefreshListener\n+import org.edx.mobile.logger.Logger\n+import org.edx.mobile.model.api.EnrolledCoursesResponse\n+import org.edx.mobile.module.db.DataCallback\n+import org.edx.mobile.module.prefs.LoginPrefs\n+import org.edx.mobile.util.ConfigUtil.Companion.isCourseDiscoveryEnabled\n+import org.edx.mobile.util.NetworkUtil\n+import org.edx.mobile.util.UiUtil\n+import org.edx.mobile.view.adapters.MyCoursesAdapter\n+import retrofit2.Call\n+import retrofit2.Callback\n+import retrofit2.Response\n+import java.util.*\n+import javax.inject.Inject\n+\n+class MyCoursesListFragment : OfflineSupportBaseFragment(), RefreshListener {\n+    private lateinit var adapter: MyCoursesAdapter\n+    private lateinit var binding: FragmentMyCoursesListBinding\n+    private val logger = Logger(javaClass.simpleName)\n+    private var refreshOnResume = false\n+    @Inject\n+    private var environment: IEdxEnvironment? = null\n+    @Inject\n+    var api: CourseAPI? = null\n+    private lateinit var errorNotification: FullScreenErrorNotification\n+    //TODO: All these callbacks aren't essentially part of MyCoursesListFragment and should move in\n+    // the Tabs container fragment that's going to be implemented in LEARNER-3251\n+    override fun onCreate(savedInstanceState: Bundle?) {\n+        super.onCreate(savedInstanceState)\n+        adapter = object : MyCoursesAdapter(activity, environment) {\n+            override fun onItemClicked(model: EnrolledCoursesResponse) {\n+                environment.router.showCourseDashboardTabs(activity!!, model, false)\n+            }\n+\n+            override fun onAnnouncementClicked(model: EnrolledCoursesResponse) {\n+                environment.router.showCourseDashboardTabs(activity!!, model, true)\n+            }\n+        }\n+    }\n+\n+    override fun onCreateView(inflater: LayoutInflater, container: ViewGroup?,\n+                              savedInstanceState: Bundle?): View? {\n+        binding = DataBindingUtil.inflate(inflater, R.layout.fragment_my_courses_list, container, false)\n+        errorNotification = FullScreenErrorNotification(binding.myCourseList)\n+        binding.swipeContainer.setOnRefreshListener {\n+            // Hide the progress bar as swipe layout has its own progress indicator\n+            binding.loadingIndicator.root.visibility = View.GONE\n+            errorNotification.hideError()\n+            loadData(showProgress = false, isCached = false)\n+        }\n+        UiUtil.setSwipeRefreshLayoutColors(binding.swipeContainer)\n+        // Add empty view to cause divider to render at the top of the list.\n+        binding.myCourseList.addHeaderView(View(context), null, false)\n+        binding.myCourseList.adapter = adapter\n+        binding.myCourseList.onItemClickListener = adapter\n+        return binding.root\n+    }\n+\n+    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {\n+        super.onViewCreated(view, savedInstanceState)\n+        loadData(showProgress = true, isCached = true)\n+    }\n+\n+    private fun populateCourseData(data: ArrayList<EnrolledCoursesResponse>) {\n+        updateDatabaseAfterDownload(data)\n+        if (data.size > 0) {\n+            adapter.setItems(data)\n+        }\n+        addFindCoursesFooter()\n+        adapter.notifyDataSetChanged()\n+        if (adapter.isEmpty && !isCourseDiscoveryEnabled(environment!!)) {\n+            errorNotification.showError(R.string.no_courses_to_display,\n+                    FontAwesomeIcons.fa_exclamation_circle, 0, null)\n+            binding.myCourseList.visibility = View.GONE\n+        } else {\n+            binding.myCourseList.visibility = View.VISIBLE\n+            errorNotification.hideError()\n+        }\n+    }\n+\n+    private fun updateDatabaseAfterDownload(list: ArrayList<EnrolledCoursesResponse>?) {\n+        if (list != null && list.size > 0) { //update all videos in the DB as Deactivated\n+            environment?.database?.updateAllVideosAsDeactivated(dataCallback)\n+            for (i in list.indices) { //Check if the flag of isIs_active is marked to true,\n+                //then activate all videos\n+                if (list[i].isIs_active) { //update all videos for a course fetched in the API as Activated", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb391aa762efb5db818e222477781fe218d8960e"}, "originalPosition": 111}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODMwMjUwMw==", "bodyText": "comment should be in the next line.", "url": "https://github.com/edx/edx-app-android/pull/1438#discussion_r458302503", "createdAt": "2020-07-21T18:26:28Z", "author": {"login": "farhan-arshad-dev"}, "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/MyCoursesListFragment.kt", "diffHunk": "@@ -0,0 +1,256 @@\n+package org.edx.mobile.view\n+\n+import android.os.Bundle\n+import android.view.LayoutInflater\n+import android.view.View\n+import android.view.ViewGroup\n+import androidx.databinding.DataBindingUtil\n+import com.joanzapata.iconify.fonts.FontAwesomeIcons\n+import de.greenrobot.event.EventBus\n+import okhttp3.MediaType\n+import okhttp3.ResponseBody\n+import org.edx.mobile.R\n+import org.edx.mobile.core.IEdxEnvironment\n+import org.edx.mobile.course.CourseAPI\n+import org.edx.mobile.databinding.FragmentMyCoursesListBinding\n+import org.edx.mobile.databinding.PanelFindCourseBinding\n+import org.edx.mobile.deeplink.Screen\n+import org.edx.mobile.event.EnrolledInCourseEvent\n+import org.edx.mobile.event.MainDashboardRefreshEvent\n+import org.edx.mobile.event.MoveToDiscoveryTabEvent\n+import org.edx.mobile.event.NetworkConnectivityChangeEvent\n+import org.edx.mobile.exception.AuthException\n+import org.edx.mobile.http.HttpStatus\n+import org.edx.mobile.http.HttpStatusException\n+import org.edx.mobile.http.notifications.FullScreenErrorNotification\n+import org.edx.mobile.interfaces.RefreshListener\n+import org.edx.mobile.logger.Logger\n+import org.edx.mobile.model.api.EnrolledCoursesResponse\n+import org.edx.mobile.module.db.DataCallback\n+import org.edx.mobile.module.prefs.LoginPrefs\n+import org.edx.mobile.util.ConfigUtil.Companion.isCourseDiscoveryEnabled\n+import org.edx.mobile.util.NetworkUtil\n+import org.edx.mobile.util.UiUtil\n+import org.edx.mobile.view.adapters.MyCoursesAdapter\n+import retrofit2.Call\n+import retrofit2.Callback\n+import retrofit2.Response\n+import java.util.*\n+import javax.inject.Inject\n+\n+class MyCoursesListFragment : OfflineSupportBaseFragment(), RefreshListener {\n+    private lateinit var adapter: MyCoursesAdapter\n+    private lateinit var binding: FragmentMyCoursesListBinding\n+    private val logger = Logger(javaClass.simpleName)\n+    private var refreshOnResume = false\n+    @Inject\n+    private var environment: IEdxEnvironment? = null\n+    @Inject\n+    var api: CourseAPI? = null\n+    private lateinit var errorNotification: FullScreenErrorNotification\n+    //TODO: All these callbacks aren't essentially part of MyCoursesListFragment and should move in\n+    // the Tabs container fragment that's going to be implemented in LEARNER-3251\n+    override fun onCreate(savedInstanceState: Bundle?) {\n+        super.onCreate(savedInstanceState)\n+        adapter = object : MyCoursesAdapter(activity, environment) {\n+            override fun onItemClicked(model: EnrolledCoursesResponse) {\n+                environment.router.showCourseDashboardTabs(activity!!, model, false)\n+            }\n+\n+            override fun onAnnouncementClicked(model: EnrolledCoursesResponse) {\n+                environment.router.showCourseDashboardTabs(activity!!, model, true)\n+            }\n+        }\n+    }\n+\n+    override fun onCreateView(inflater: LayoutInflater, container: ViewGroup?,\n+                              savedInstanceState: Bundle?): View? {\n+        binding = DataBindingUtil.inflate(inflater, R.layout.fragment_my_courses_list, container, false)\n+        errorNotification = FullScreenErrorNotification(binding.myCourseList)\n+        binding.swipeContainer.setOnRefreshListener {\n+            // Hide the progress bar as swipe layout has its own progress indicator\n+            binding.loadingIndicator.root.visibility = View.GONE\n+            errorNotification.hideError()\n+            loadData(showProgress = false, isCached = false)\n+        }\n+        UiUtil.setSwipeRefreshLayoutColors(binding.swipeContainer)\n+        // Add empty view to cause divider to render at the top of the list.\n+        binding.myCourseList.addHeaderView(View(context), null, false)\n+        binding.myCourseList.adapter = adapter\n+        binding.myCourseList.onItemClickListener = adapter\n+        return binding.root\n+    }\n+\n+    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {\n+        super.onViewCreated(view, savedInstanceState)\n+        loadData(showProgress = true, isCached = true)\n+    }\n+\n+    private fun populateCourseData(data: ArrayList<EnrolledCoursesResponse>) {\n+        updateDatabaseAfterDownload(data)\n+        if (data.size > 0) {\n+            adapter.setItems(data)\n+        }\n+        addFindCoursesFooter()\n+        adapter.notifyDataSetChanged()\n+        if (adapter.isEmpty && !isCourseDiscoveryEnabled(environment!!)) {\n+            errorNotification.showError(R.string.no_courses_to_display,\n+                    FontAwesomeIcons.fa_exclamation_circle, 0, null)\n+            binding.myCourseList.visibility = View.GONE\n+        } else {\n+            binding.myCourseList.visibility = View.VISIBLE\n+            errorNotification.hideError()\n+        }\n+    }\n+\n+    private fun updateDatabaseAfterDownload(list: ArrayList<EnrolledCoursesResponse>?) {\n+        if (list != null && list.size > 0) { //update all videos in the DB as Deactivated\n+            environment?.database?.updateAllVideosAsDeactivated(dataCallback)\n+            for (i in list.indices) { //Check if the flag of isIs_active is marked to true,\n+                //then activate all videos\n+                if (list[i].isIs_active) { //update all videos for a course fetched in the API as Activated\n+                    environment?.database?.updateVideosActivatedForCourse(list[i].course.id,\n+                            dataCallback)\n+                } else {\n+                    list.removeAt(i)\n+                }\n+            }\n+            //Delete all videos which are marked as Deactivated in the database\n+            environment?.storage?.deleteAllUnenrolledVideos()\n+        }\n+    }\n+\n+    private val dataCallback: DataCallback<Int> = object : DataCallback<Int>() {\n+        override fun onResult(result: Int) {}\n+        override fun onFail(ex: Exception) {\n+            logger.error(ex)\n+        }\n+    }\n+\n+    override fun onResume() {\n+        super.onResume()\n+        if (refreshOnResume) {\n+            loadData(showProgress = false, isCached = true)\n+            refreshOnResume = false\n+        }\n+    }\n+\n+    override fun onDestroy() {\n+        super.onDestroy()\n+        EventBus.getDefault().unregister(this)\n+    }\n+\n+    fun onEventMainThread(event: EnrolledInCourseEvent?) {\n+        refreshOnResume = true\n+    }\n+\n+    private fun loadData(showProgress: Boolean, isCached: Boolean) {\n+        if (showProgress) {\n+            binding.loadingIndicator.root.visibility = View.VISIBLE\n+            errorNotification.hideError()\n+        }\n+        if (isCached) {\n+            getUserEnrolledCourses(api?.enrolledCoursesFromCache!!)\n+        }\n+        getUserEnrolledCourses(api?.enrolledCourses!!)\n+    }\n+\n+    private fun invalidateView() {\n+        binding.swipeContainer.isRefreshing = false\n+        binding.loadingIndicator.root.visibility = View.GONE\n+\n+        if (!EventBus.getDefault().isRegistered(this@MyCoursesListFragment)) {\n+            EventBus.getDefault().registerSticky(this@MyCoursesListFragment)\n+        }\n+    }\n+\n+    private fun showError(error: Throwable) {\n+        context?.let { context ->\n+            error.cause?.let { cause ->\n+                errorNotification.showError(context, cause, R.string.lbl_reload) {\n+                    if (NetworkUtil.isConnected(context)) {\n+                        onRefresh()\n+                    }\n+                }\n+            }\n+        }\n+    }\n+\n+    private fun getUserEnrolledCourses(enrolledCoursesApi: Call<List<EnrolledCoursesResponse>>) {\n+        enrolledCoursesApi.enqueue(object : Callback<List<EnrolledCoursesResponse>> {\n+            override fun onResponse(call: Call<List<EnrolledCoursesResponse>>, response: Response<List<EnrolledCoursesResponse>>) {\n+                if (response.isSuccessful && response.code() == HttpStatus.OK) {\n+                    populateCourseData(ArrayList(response.body()))\n+                } else if (response.code() == HttpStatus.UNAUTHORIZED) {\n+                    environment?.router?.forceLogout(context,\n+                            environment?.analyticsRegistry,\n+                            environment?.notificationDelegate)\n+                } else {\n+                    showError(HttpStatusException(Response.error<Any>(HttpStatus.INTERNAL_SERVER_ERROR,\n+                            ResponseBody.create(MediaType.parse(\"text/plain\"), response.message()))))\n+                }\n+                invalidateView()\n+            }\n+\n+            override fun onFailure(call: Call<List<EnrolledCoursesResponse>>, t: Throwable) {\n+                if (t is AuthException || (t is HttpStatusException && t.statusCode == HttpStatus.UNAUTHORIZED)) {\n+                    environment?.router?.forceLogout(context,\n+                            environment?.analyticsRegistry,\n+                            environment?.notificationDelegate)\n+                } else {\n+                    showError(t)\n+                    invalidateView()\n+                }\n+            }\n+        })\n+\n+    }\n+\n+    private fun addFindCoursesFooter() { // Validate footer is not already added.\n+        if (binding.myCourseList.footerViewsCount > 0) {\n+            return\n+        }\n+        if (isCourseDiscoveryEnabled(environment!!)) { // Add 'Find a Course' list item as a footer.\n+            val footer: PanelFindCourseBinding = DataBindingUtil.inflate(LayoutInflater.from(activity),\n+                    R.layout.panel_find_course, binding.myCourseList, false)\n+            binding.myCourseList.addFooterView(footer.root, null, false)\n+            footer.courseBtn.setOnClickListener { v: View? ->\n+                environment?.analyticsRegistry?.trackUserFindsCourses()\n+                EventBus.getDefault().post(MoveToDiscoveryTabEvent(Screen.COURSE_DISCOVERY))\n+            }\n+        }\n+        // Add empty view to cause divider to render at the bottom of the list.\n+        binding.myCourseList.addFooterView(View(context), null, false)\n+    }\n+\n+    override fun onRefresh() {\n+        EventBus.getDefault().post(MainDashboardRefreshEvent())\n+    }\n+\n+    fun onEvent(event: MainDashboardRefreshEvent?) {\n+        loadData(showProgress = true, isCached = false)\n+    }\n+\n+    override fun onRevisit() {\n+        super.onRevisit()\n+        if (NetworkUtil.isConnected(activity)) {\n+            binding.swipeContainer.isEnabled = true\n+        }\n+    }\n+\n+    fun onEvent(event: NetworkConnectivityChangeEvent?) {\n+        if (activity != null) {\n+            if (NetworkUtil.isConnected(context)) {\n+                binding.swipeContainer.isEnabled = true\n+            } else { //Disable swipe functionality and hide the loading view", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cb391aa762efb5db818e222477781fe218d8960e"}, "originalPosition": 245}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUzMjQyMzQ5", "url": "https://github.com/edx/edx-app-android/pull/1438#pullrequestreview-453242349", "createdAt": "2020-07-22T11:51:09Z", "commit": {"oid": "dc36d23ece7469bda972161d25854ea92325248c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d448916df86d6e349b8f68066f9c4cc628e39eed", "author": {"user": {"login": "omerhabib26", "name": "Omer Habib"}}, "url": "https://github.com/edx/edx-app-android/commit/d448916df86d6e349b8f68066f9c4cc628e39eed", "committedDate": "2020-07-22T12:30:15Z", "message": "Prioritise cache response of course enrolments api\n-LEARNER-7778\n-Remove AsynLoader Class\n-Convert MyCourseListFragment into kotlin\n-Improve line of codes\n-Prioritise cache response over server call"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "dc36d23ece7469bda972161d25854ea92325248c", "author": {"user": {"login": "omerhabib26", "name": "Omer Habib"}}, "url": "https://github.com/edx/edx-app-android/commit/dc36d23ece7469bda972161d25854ea92325248c", "committedDate": "2020-07-22T10:29:20Z", "message": "remove Todo and auto align"}, "afterCommit": {"oid": "d448916df86d6e349b8f68066f9c4cc628e39eed", "author": {"user": {"login": "omerhabib26", "name": "Omer Habib"}}, "url": "https://github.com/edx/edx-app-android/commit/d448916df86d6e349b8f68066f9c4cc628e39eed", "committedDate": "2020-07-22T12:30:15Z", "message": "Prioritise cache response of course enrolments api\n-LEARNER-7778\n-Remove AsynLoader Class\n-Convert MyCourseListFragment into kotlin\n-Improve line of codes\n-Prioritise cache response over server call"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4205, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}