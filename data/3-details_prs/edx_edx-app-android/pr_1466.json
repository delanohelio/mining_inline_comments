{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk2Mzk3NTg1", "number": 1466, "title": "Add Course Reset Dates banner on CourseOutlineFragment.java", "bodyText": "Description\nLEARNER-7824\n\nAdd Course Dates banner on Course Unit Fragment\nAdd Option to shift dates for verified learner\nShow dialog box on success/unsuccess of shift dates API call\nUpgrade button disable as per discussion on LEARNER-7814\nBanner strings are defined in MFE", "createdAt": "2020-10-01T16:42:22Z", "url": "https://github.com/edx/edx-app-android/pull/1466", "merged": true, "mergeCommit": {"oid": "b15ad7367150b339e4e9655442360df99d38d581"}, "closed": true, "closedAt": "2020-10-05T11:32:01Z", "author": {"login": "omerhabib26"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdOpHASAFqTUwMTIwNzgzOA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdPfDKwgBqjM4MzkwNTQyOTQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxMjA3ODM4", "url": "https://github.com/edx/edx-app-android/pull/1466#pullrequestreview-501207838", "createdAt": "2020-10-02T14:55:24Z", "commit": {"oid": "651d9514ba99b5352061a4274d6bf30f17ca62fd"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxNDo1NToyNFrOHbwzxA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxNzowMzoxM1rOHb1BLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODg3MzI4NA==", "bodyText": "can use edx_box_radius from the dimens.\ncreate a new dimension instated of hardcode if general dimen is not existe.", "url": "https://github.com/edx/edx-app-android/pull/1466#discussion_r498873284", "createdAt": "2020-10-02T14:55:24Z", "author": {"login": "farhan-arshad-dev"}, "path": "OpenEdXMobile/res/drawable/blue_border_white_roundedbg.xml", "diffHunk": "@@ -0,0 +1,9 @@\n+<?xml version=\"1.0\" encoding=\"utf-8\"?>\n+<shape xmlns:android=\"http://schemas.android.com/apk/res/android\">\n+\n+    <solid android:color=\"@android:color/white\" />\n+    <stroke\n+        android:width=\"1dp\"\n+        android:color=\"@color/edx_brand_primary_base\" />\n+    <corners android:radius=\"5dp\" />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "651d9514ba99b5352061a4274d6bf30f17ca62fd"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODg3ODI4Mg==", "bodyText": "rename the id for the LinearLayout .", "url": "https://github.com/edx/edx-app-android/pull/1466#discussion_r498878282", "createdAt": "2020-10-02T15:03:30Z", "author": {"login": "farhan-arshad-dev"}, "path": "OpenEdXMobile/res/layout/layout_course_dates_banner.xml", "diffHunk": "@@ -0,0 +1,35 @@\n+<?xml version=\"1.0\" encoding=\"utf-8\"?>\n+<layout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n+    xmlns:tools=\"http://schemas.android.com/tools\">\n+\n+    <LinearLayout\n+        android:id=\"@+id/last_accessed_bar\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "651d9514ba99b5352061a4274d6bf30f17ca62fd"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODg4NzI5NA==", "bodyText": "better to use 12dp padding as per mockups.", "url": "https://github.com/edx/edx-app-android/pull/1466#discussion_r498887294", "createdAt": "2020-10-02T15:18:30Z", "author": {"login": "farhan-arshad-dev"}, "path": "OpenEdXMobile/res/layout/layout_course_dates_banner.xml", "diffHunk": "@@ -0,0 +1,35 @@\n+<?xml version=\"1.0\" encoding=\"utf-8\"?>\n+<layout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n+    xmlns:tools=\"http://schemas.android.com/tools\">\n+\n+    <LinearLayout\n+        android:id=\"@+id/last_accessed_bar\"\n+        android:layout_width=\"match_parent\"\n+        android:layout_height=\"wrap_content\"\n+        android:background=\"@color/edx_brand_primary_back\"\n+        android:orientation=\"vertical\"\n+        android:padding=\"@dimen/widget_margin\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "651d9514ba99b5352061a4274d6bf30f17ca62fd"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODg5MTg4Nw==", "bodyText": "use / before the path, to make parity with others.", "url": "https://github.com/edx/edx-app-android/pull/1466#discussion_r498891887", "createdAt": "2020-10-02T15:26:27Z", "author": {"login": "farhan-arshad-dev"}, "path": "OpenEdXMobile/src/main/java/org/edx/mobile/course/CourseService.java", "diffHunk": "@@ -138,6 +140,12 @@ public CourseService get() {\n     @GET(\"api/course_home/v1/dates/{course_key}\")\n     Call<CourseDates> getCourseDates(@Path(\"course_key\") String courseId);\n \n+    @GET(\"api/course_experience/v1/course_deadlines_info/{course_key}\")\n+    Call<CourseBannerInfoModel> getCourseBannerInfo(@Path(\"course_key\") String courseId);\n+\n+    @POST(\"api/course_experience/v1/reset_course_deadlines\")\n+    Call<ResetCourseDates> resetCourseDates(@Body HashMap<String, String> courseBody);\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "651d9514ba99b5352061a4274d6bf30f17ca62fd"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODkxMjM0NQ==", "bodyText": "why need to add this isBannerVisible ? deserve doc string.", "url": "https://github.com/edx/edx-app-android/pull/1466#discussion_r498912345", "createdAt": "2020-10-02T16:03:20Z", "author": {"login": "farhan-arshad-dev"}, "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/CourseOutlineFragment.java", "diffHunk": "@@ -97,6 +106,7 @@\n     private EnrolledCoursesResponse courseData;\n     private String courseComponentId;\n     private boolean isVideoMode;\n+    private boolean isBannerVisible = false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "651d9514ba99b5352061a4274d6bf30f17ca62fd"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODkxMjc0NQ==", "bodyText": "Remove un-necessary comments.", "url": "https://github.com/edx/edx-app-android/pull/1466#discussion_r498912745", "createdAt": "2020-10-02T16:04:06Z", "author": {"login": "farhan-arshad-dev"}, "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/CourseOutlineFragment.java", "diffHunk": "@@ -398,6 +478,54 @@ public void viewDownloadsStatus() {\n         }\n     }\n \n+    /**\n+     * Initialized dates info banner on CourseOutlineFragment\n+     *\n+     * @param courseBannerInfo object of course deadline info\n+     */\n+    private void initDatesBanner(CourseBannerInfoModel courseBannerInfo) {\n+        LayoutCourseDatesBannerBinding bannerViewBinding = DataBindingUtil.inflate(getLayoutInflater(), R.layout.layout_course_dates_banner, listView, false);\n+        if (courseBannerInfo != null && !isVideoMode && isOnCourseOutline && !courseBannerInfo.getHasEnded()) {\n+            String buttonText = \"\";\n+            // Currently we are only handling RESET_DATES case,\n+            // UPGRADE_TO_GRADED & UPGRADE_TO_RESET will be enable once we are allowed to do payment through mobile\n+            switch (courseBannerInfo.getDatesBannerInfo().getCourseBannerType()) {\n+                case UPGRADE_TO_GRADED:\n+                    bannerViewBinding.bannerInfo.setText(getText(R.string.course_dates_banner_upgrade_to_graded));\n+//                    buttonText = getContextOrThrow().getString(R.string.course_dates_banner_upgrade_to_graded_button);\n+                    break;\n+                case UPGRADE_TO_RESET:\n+                    bannerViewBinding.bannerInfo.setText(getText(R.string.course_dates_banner_upgrade_to_reset));\n+//                    buttonText = getContextOrThrow().getString(R.string.course_dates_banner_upgrade_to_reset_button);\n+                    break;\n+                case RESET_DATES:\n+                    bannerViewBinding.bannerInfo.setText(getText(R.string.course_dates_banner_reset_date));\n+                    buttonText = getContextOrThrow().getString(R.string.course_dates_banner_reset_date_button);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "651d9514ba99b5352061a4274d6bf30f17ca62fd"}, "originalPosition": 183}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODk0MDIwNw==", "bodyText": "Add todo.", "url": "https://github.com/edx/edx-app-android/pull/1466#discussion_r498940207", "createdAt": "2020-10-02T16:58:53Z", "author": {"login": "farhan-arshad-dev"}, "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/CourseOutlineFragment.java", "diffHunk": "@@ -398,6 +478,54 @@ public void viewDownloadsStatus() {\n         }\n     }\n \n+    /**\n+     * Initialized dates info banner on CourseOutlineFragment\n+     *\n+     * @param courseBannerInfo object of course deadline info\n+     */\n+    private void initDatesBanner(CourseBannerInfoModel courseBannerInfo) {\n+        LayoutCourseDatesBannerBinding bannerViewBinding = DataBindingUtil.inflate(getLayoutInflater(), R.layout.layout_course_dates_banner, listView, false);\n+        if (courseBannerInfo != null && !isVideoMode && isOnCourseOutline && !courseBannerInfo.getHasEnded()) {\n+            String buttonText = \"\";\n+            // Currently we are only handling RESET_DATES case,\n+            // UPGRADE_TO_GRADED & UPGRADE_TO_RESET will be enable once we are allowed to do payment through mobile", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "651d9514ba99b5352061a4274d6bf30f17ca62fd"}, "originalPosition": 171}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODk0MDUxMQ==", "bodyText": "better to add the following code:\n            listView.removeHeaderView(bannerViewBinding.getRoot());\n            isBannerVisible = false;", "url": "https://github.com/edx/edx-app-android/pull/1466#discussion_r498940511", "createdAt": "2020-10-02T16:59:31Z", "author": {"login": "farhan-arshad-dev"}, "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/CourseOutlineFragment.java", "diffHunk": "@@ -398,6 +478,54 @@ public void viewDownloadsStatus() {\n         }\n     }\n \n+    /**\n+     * Initialized dates info banner on CourseOutlineFragment\n+     *\n+     * @param courseBannerInfo object of course deadline info\n+     */\n+    private void initDatesBanner(CourseBannerInfoModel courseBannerInfo) {\n+        LayoutCourseDatesBannerBinding bannerViewBinding = DataBindingUtil.inflate(getLayoutInflater(), R.layout.layout_course_dates_banner, listView, false);\n+        if (courseBannerInfo != null && !isVideoMode && isOnCourseOutline && !courseBannerInfo.getHasEnded()) {\n+            String buttonText = \"\";\n+            // Currently we are only handling RESET_DATES case,\n+            // UPGRADE_TO_GRADED & UPGRADE_TO_RESET will be enable once we are allowed to do payment through mobile\n+            switch (courseBannerInfo.getDatesBannerInfo().getCourseBannerType()) {\n+                case UPGRADE_TO_GRADED:\n+                    bannerViewBinding.bannerInfo.setText(getText(R.string.course_dates_banner_upgrade_to_graded));\n+//                    buttonText = getContextOrThrow().getString(R.string.course_dates_banner_upgrade_to_graded_button);\n+                    break;\n+                case UPGRADE_TO_RESET:\n+                    bannerViewBinding.bannerInfo.setText(getText(R.string.course_dates_banner_upgrade_to_reset));\n+//                    buttonText = getContextOrThrow().getString(R.string.course_dates_banner_upgrade_to_reset_button);\n+                    break;\n+                case RESET_DATES:\n+                    bannerViewBinding.bannerInfo.setText(getText(R.string.course_dates_banner_reset_date));\n+                    buttonText = getContextOrThrow().getString(R.string.course_dates_banner_reset_date_button);\n+                    break;\n+                case INFO_BANNER:\n+                    bannerViewBinding.bannerInfo.setText(getText(R.string.course_dates_info_banner));\n+                    break;\n+                case BLANK:\n+                    break;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "651d9514ba99b5352061a4274d6bf30f17ca62fd"}, "originalPosition": 189}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODk0MDc4Mw==", "bodyText": "no need to pass the boolean as always show progress.", "url": "https://github.com/edx/edx-app-android/pull/1466#discussion_r498940783", "createdAt": "2020-10-02T17:00:10Z", "author": {"login": "farhan-arshad-dev"}, "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/CourseOutlineFragment.java", "diffHunk": "@@ -398,6 +478,54 @@ public void viewDownloadsStatus() {\n         }\n     }\n \n+    /**\n+     * Initialized dates info banner on CourseOutlineFragment\n+     *\n+     * @param courseBannerInfo object of course deadline info\n+     */\n+    private void initDatesBanner(CourseBannerInfoModel courseBannerInfo) {\n+        LayoutCourseDatesBannerBinding bannerViewBinding = DataBindingUtil.inflate(getLayoutInflater(), R.layout.layout_course_dates_banner, listView, false);\n+        if (courseBannerInfo != null && !isVideoMode && isOnCourseOutline && !courseBannerInfo.getHasEnded()) {\n+            String buttonText = \"\";\n+            // Currently we are only handling RESET_DATES case,\n+            // UPGRADE_TO_GRADED & UPGRADE_TO_RESET will be enable once we are allowed to do payment through mobile\n+            switch (courseBannerInfo.getDatesBannerInfo().getCourseBannerType()) {\n+                case UPGRADE_TO_GRADED:\n+                    bannerViewBinding.bannerInfo.setText(getText(R.string.course_dates_banner_upgrade_to_graded));\n+//                    buttonText = getContextOrThrow().getString(R.string.course_dates_banner_upgrade_to_graded_button);\n+                    break;\n+                case UPGRADE_TO_RESET:\n+                    bannerViewBinding.bannerInfo.setText(getText(R.string.course_dates_banner_upgrade_to_reset));\n+//                    buttonText = getContextOrThrow().getString(R.string.course_dates_banner_upgrade_to_reset_button);\n+                    break;\n+                case RESET_DATES:\n+                    bannerViewBinding.bannerInfo.setText(getText(R.string.course_dates_banner_reset_date));\n+                    buttonText = getContextOrThrow().getString(R.string.course_dates_banner_reset_date_button);\n+                    break;\n+                case INFO_BANNER:\n+                    bannerViewBinding.bannerInfo.setText(getText(R.string.course_dates_info_banner));\n+                    break;\n+                case BLANK:\n+                    break;\n+            }\n+\n+            if (listView.getHeaderViewsCount() == 0 && !TextUtils.isEmpty(bannerViewBinding.bannerInfo.getText())) {\n+                if (!TextUtils.isEmpty(buttonText)) {\n+                    bannerViewBinding.btnShiftDates.setText(buttonText);\n+                    bannerViewBinding.btnShiftDates.setVisibility(View.VISIBLE);\n+                    bannerViewBinding.btnShiftDates.setOnClickListener(v -> {\n+                        resetCourseDatesBanner(true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "651d9514ba99b5352061a4274d6bf30f17ca62fd"}, "originalPosition": 197}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODk0MTU3Nw==", "bodyText": "better to rename as COURSE_KEY", "url": "https://github.com/edx/edx-app-android/pull/1466#discussion_r498941577", "createdAt": "2020-10-02T17:01:53Z", "author": {"login": "farhan-arshad-dev"}, "path": "OpenEdXMobile/src/main/java/org/edx/mobile/http/constants/ApiConstants.java", "diffHunk": "@@ -44,6 +44,8 @@\n \n     public static final String VALIDATION_DECISIONS = \"validation_decisions\";\n \n+    public static final String KEY_COURSE_ID = \"course_key\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "651d9514ba99b5352061a4274d6bf30f17ca62fd"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODk0MjE2Ng==", "bodyText": "need doc-string.", "url": "https://github.com/edx/edx-app-android/pull/1466#discussion_r498942166", "createdAt": "2020-10-02T17:03:01Z", "author": {"login": "farhan-arshad-dev"}, "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/CourseOutlineFragment.java", "diffHunk": "@@ -339,6 +413,9 @@ private void initListView(@NonNull View view) {\n         listView.setOnItemClickListener(new AdapterView.OnItemClickListener() {\n             @Override\n             public void onItemClick(AdapterView<?> parent, View view, int position, long id) {\n+                if (!isVideoMode && isBannerVisible && position == 0) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "651d9514ba99b5352061a4274d6bf30f17ca62fd"}, "originalPosition": 141}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODk0MjI1Mg==", "bodyText": "same.", "url": "https://github.com/edx/edx-app-android/pull/1466#discussion_r498942252", "createdAt": "2020-10-02T17:03:13Z", "author": {"login": "farhan-arshad-dev"}, "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/CourseOutlineFragment.java", "diffHunk": "@@ -357,6 +434,9 @@ public void onItemClick(AdapterView<?> parent, View view, int position, long id)\n         listView.setOnItemLongClickListener(new AdapterView.OnItemLongClickListener() {\n             @Override\n             public boolean onItemLongClick(AdapterView<?> parent, View view, int position, long id) {\n+                if (!isVideoMode && isBannerVisible && position == 0) {\n+                    return false;\n+                }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "651d9514ba99b5352061a4274d6bf30f17ca62fd"}, "originalPosition": 153}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxNTk4NDk4", "url": "https://github.com/edx/edx-app-android/pull/1466#pullrequestreview-501598498", "createdAt": "2020-10-04T07:37:53Z", "commit": {"oid": "4f243be800e41d2016d57d728324be852f19a445"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNFQwNzozNzo1M1rOHcFubA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNFQwNzozNzo1M1rOHcFubA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTIxNTk4MA==", "bodyText": "Create a new padding dimen constant for this, divider_with_text_margin  is created to other view.", "url": "https://github.com/edx/edx-app-android/pull/1466#discussion_r499215980", "createdAt": "2020-10-04T07:37:53Z", "author": {"login": "farhan-arshad-dev"}, "path": "OpenEdXMobile/res/layout/layout_course_dates_banner.xml", "diffHunk": "@@ -0,0 +1,35 @@\n+<?xml version=\"1.0\" encoding=\"utf-8\"?>\n+<layout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n+    xmlns:tools=\"http://schemas.android.com/tools\">\n+\n+    <LinearLayout\n+        android:id=\"@+id/container_layout\"\n+        android:layout_width=\"match_parent\"\n+        android:layout_height=\"wrap_content\"\n+        android:background=\"@color/edx_brand_primary_back\"\n+        android:orientation=\"vertical\"\n+        android:padding=\"@dimen/divider_with_text_margin\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4f243be800e41d2016d57d728324be852f19a445"}, "originalPosition": 11}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1ee7dcd913bc5abc49a2cb8ddb6bca5b4088d195", "author": {"user": {"login": "omerhabib26", "name": "Omer Habib"}}, "url": "https://github.com/edx/edx-app-android/commit/1ee7dcd913bc5abc49a2cb8ddb6bca5b4088d195", "committedDate": "2020-10-05T07:56:18Z", "message": "Add Course Reset Dates banner on CourseOutlineFragment.java\n- LEARNER-7824\n- Add Option to shift dates for verified learner\n- Show dialog box on success/unsuccess of shift dates API call"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4f243be800e41d2016d57d728324be852f19a445", "author": {"user": {"login": "omerhabib26", "name": "Omer Habib"}}, "url": "https://github.com/edx/edx-app-android/commit/4f243be800e41d2016d57d728324be852f19a445", "committedDate": "2020-10-02T21:59:56Z", "message": "Address PR Changes"}, "afterCommit": {"oid": "1ee7dcd913bc5abc49a2cb8ddb6bca5b4088d195", "author": {"user": {"login": "omerhabib26", "name": "Omer Habib"}}, "url": "https://github.com/edx/edx-app-android/commit/1ee7dcd913bc5abc49a2cb8ddb6bca5b4088d195", "committedDate": "2020-10-05T07:56:18Z", "message": "Add Course Reset Dates banner on CourseOutlineFragment.java\n- LEARNER-7824\n- Add Option to shift dates for verified learner\n- Show dialog box on success/unsuccess of shift dates API call"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4233, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}