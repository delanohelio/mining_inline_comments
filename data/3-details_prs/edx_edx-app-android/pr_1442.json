{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU1OTQ3MDM1", "number": 1442, "title": "Registration Form Validation", "bodyText": "Description\nLEARNER-7835\n\nImplement validation API for a registration form.\nValidate the registration form using the API: POST /api/user/v1/validation/registration.\nThe validation API should be hit before the actual registration API.\nThe validation API should be initiated upon the click on the Register button.\nIf the validation API doesn't return any error in its response, the app should automatically call the registration API and register the learner.\nIf the validation API returns an error in its response, the app should not call the registration API and show the error inline with each field that had invalid data.\n\nHow to test this PR\n\n  Use some previously used username in the Registration Form, it should give invalid error after hitting validation API.\n  Use some previously used email in the Registration Form, it should give invalid error after hitting validation API.\n  Use an invalid password, i.e without numbers, it should give invalid error after hitting validation API.\n  If validation API returns no invalid form field, then the usual registration flow should work, i.e. Register user and navigation to Home Screen.", "createdAt": "2020-07-23T20:55:10Z", "url": "https://github.com/edx/edx-app-android/pull/1442", "merged": true, "mergeCommit": {"oid": "a10faaa7c45e2520454952c25e8be336bf4efc90"}, "closed": true, "closedAt": "2020-07-24T13:09:26Z", "author": {"login": "farhan-arshad-dev"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc31sEMgH2gAyNDU1OTQ3MDM1OjM2MDBkZmM5MmU5NGRlZTAxMDM0YTZjNTEwMWVhNmEyMDUyMDkyY2Q=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc4Db6vgFqTQ1NDg1NjYyMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3600dfc92e94dee01034a6c5101ea6a2052092cd", "author": {"user": {"login": "farhan-arshad-dev", "name": "Farhan Arshad"}}, "url": "https://github.com/edx/edx-app-android/commit/3600dfc92e94dee01034a6c5101ea6a2052092cd", "committedDate": "2020-07-23T20:45:01Z", "message": "Registration Validation API usage\n- LEARNER-7835\n- Validate the registration form and show the error inline with each field that had invalid data, otherwise call the registration API and register the learner."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU0NzY1OTEz", "url": "https://github.com/edx/edx-app-android/pull/1442#pullrequestreview-454765913", "createdAt": "2020-07-24T09:56:23Z", "commit": {"oid": "3600dfc92e94dee01034a6c5101ea6a2052092cd"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNFQwOTo1NjoyNFrOG2pvmQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yNFQxMToyMTozMFrOG2r0pA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTk2MDIxNw==", "bodyText": "Remove extra line", "url": "https://github.com/edx/edx-app-android/pull/1442#discussion_r459960217", "createdAt": "2020-07-24T09:56:24Z", "author": {"login": "omerhabib26"}, "path": "OpenEdXMobile/src/main/java/org/edx/mobile/authentication/LoginService.java", "diffHunk": "@@ -41,6 +42,17 @@ public LoginService get() {\n         }\n     }\n \n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3600dfc92e94dee01034a6c5101ea6a2052092cd"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTk2MTQzNw==", "bodyText": "IMO, it should be \"URL_VALIDATE_REGISTERATION_FIELDS\"", "url": "https://github.com/edx/edx-app-android/pull/1442#discussion_r459961437", "createdAt": "2020-07-24T09:59:13Z", "author": {"login": "omerhabib26"}, "path": "OpenEdXMobile/src/main/java/org/edx/mobile/http/constants/ApiConstants.java", "diffHunk": "@@ -32,6 +32,8 @@\n \n     public static final String URL_REGISTRATION = \"/user_api/{\" + API_VERSION + \"}/account/registration/\";\n \n+    public static final String URL_VALIDATION_REGISTRATION = \"/api/user/v1/validation/registration\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3600dfc92e94dee01034a6c5101ea6a2052092cd"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTk3MTAzOA==", "bodyText": "IMO, it should be \"getRegistrationParameters\"", "url": "https://github.com/edx/edx-app-android/pull/1442#discussion_r459971038", "createdAt": "2020-07-24T10:22:29Z", "author": {"login": "omerhabib26"}, "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/RegisterActivity.java", "diffHunk": "@@ -368,6 +391,46 @@ public void onClick(DialogInterface dialog, int which) {\n         task.execute();\n     }\n \n+    private Bundle getRegistrationParameter() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3600dfc92e94dee01034a6c5101ea6a2052092cd"}, "originalPosition": 173}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTk3MTMxMA==", "bodyText": "remove irrelevant comment or update it", "url": "https://github.com/edx/edx-app-android/pull/1442#discussion_r459971310", "createdAt": "2020-07-24T10:23:11Z", "author": {"login": "omerhabib26"}, "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/RegisterActivity.java", "diffHunk": "@@ -368,6 +391,46 @@ public void onClick(DialogInterface dialog, int which) {\n         task.execute();\n     }\n \n+    private Bundle getRegistrationParameter() {\n+        boolean hasError = false;\n+        // prepare query (POST body)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3600dfc92e94dee01034a6c5101ea6a2052092cd"}, "originalPosition": 175}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTk4MjI0MQ==", "bodyText": "IMO, can we make the doc a bit simple?", "url": "https://github.com/edx/edx-app-android/pull/1442#discussion_r459982241", "createdAt": "2020-07-24T10:50:31Z", "author": {"login": "omerhabib26"}, "path": "OpenEdXMobile/src/main/java/org/edx/mobile/authentication/LoginService.java", "diffHunk": "@@ -41,6 +42,17 @@ public LoginService get() {\n         }\n     }\n \n+\n+    /**\n+     * Depending on the query parameters for this endpoint, a different action will be triggered", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3600dfc92e94dee01034a6c5101ea6a2052092cd"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTk5MjUwNg==", "bodyText": "Can we make a common function for this as L:329 has the same code", "url": "https://github.com/edx/edx-app-android/pull/1442#discussion_r459992506", "createdAt": "2020-07-24T11:17:01Z", "author": {"login": "omerhabib26"}, "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/RegisterActivity.java", "diffHunk": "@@ -183,6 +189,62 @@ public void onClick(View v) {\n         tryToSetUIInteraction(true);\n     }\n \n+    private void validateRegistrationFields() {\n+        Bundle parameters = getRegistrationParameter();\n+        if (parameters == null) {\n+            return;\n+        }\n+        showProgress();\n+        final Map<String, String> parameterMap = new HashMap<>();\n+        for (String key : parameters.keySet()) {\n+            parameterMap.put(key, parameters.getString(key));\n+        }\n+        Call<JsonObject> validateRegistrationFields = loginService.validateRegistrationFields(parameterMap);\n+        validateRegistrationFields.enqueue(new ErrorHandlingCallback<JsonObject>(this) {\n+            @Override\n+            protected void onResponse(@NonNull JsonObject responseBody) {\n+                final Type stringMapType = new TypeToken<HashMap<String, String>>() {\n+                }.getType();\n+                final HashMap<String, String> messageBody = new Gson().fromJson(responseBody.get(\"validation_decisions\"), stringMapType);\n+                if (hasValidationError(messageBody)) {\n+                    hideProgress();\n+                } else {\n+                    createAccount(parameters);\n+                }\n+            }\n+\n+            @Override\n+            protected void onFailure(@NonNull Throwable error) {\n+                hideProgress();\n+                RegisterActivity.this.showAlertDialog(null, ErrorUtils.getErrorMessage(error,\n+                        RegisterActivity.this));\n+                logger.error(error);\n+            }\n+        });\n+    }\n+\n+    private boolean hasValidationError(HashMap<String, String> messageBody) {\n+        boolean errorShown = false;\n+        for (String key : messageBody.keySet()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3600dfc92e94dee01034a6c5101ea6a2052092cd"}, "originalPosition": 91}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTk5NDI3Ng==", "bodyText": "Can we use a constant for \"validation_decisions\"", "url": "https://github.com/edx/edx-app-android/pull/1442#discussion_r459994276", "createdAt": "2020-07-24T11:21:30Z", "author": {"login": "omerhabib26"}, "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/RegisterActivity.java", "diffHunk": "@@ -183,6 +189,62 @@ public void onClick(View v) {\n         tryToSetUIInteraction(true);\n     }\n \n+    private void validateRegistrationFields() {\n+        Bundle parameters = getRegistrationParameter();\n+        if (parameters == null) {\n+            return;\n+        }\n+        showProgress();\n+        final Map<String, String> parameterMap = new HashMap<>();\n+        for (String key : parameters.keySet()) {\n+            parameterMap.put(key, parameters.getString(key));\n+        }\n+        Call<JsonObject> validateRegistrationFields = loginService.validateRegistrationFields(parameterMap);\n+        validateRegistrationFields.enqueue(new ErrorHandlingCallback<JsonObject>(this) {\n+            @Override\n+            protected void onResponse(@NonNull JsonObject responseBody) {\n+                final Type stringMapType = new TypeToken<HashMap<String, String>>() {\n+                }.getType();\n+                final HashMap<String, String> messageBody = new Gson().fromJson(responseBody.get(\"validation_decisions\"), stringMapType);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3600dfc92e94dee01034a6c5101ea6a2052092cd"}, "originalPosition": 71}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d4a61739cd97403f388f792406d89104c5dd8c3", "author": {"user": {"login": "farhan-arshad-dev", "name": "Farhan Arshad"}}, "url": "https://github.com/edx/edx-app-android/commit/1d4a61739cd97403f388f792406d89104c5dd8c3", "committedDate": "2020-07-24T12:42:31Z", "message": "Address PR comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU0ODU2NjIw", "url": "https://github.com/edx/edx-app-android/pull/1442#pullrequestreview-454856620", "createdAt": "2020-07-24T12:46:03Z", "commit": {"oid": "1d4a61739cd97403f388f792406d89104c5dd8c3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4208, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}