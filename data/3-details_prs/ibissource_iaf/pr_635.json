{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA3OTYzODUz", "number": 635, "title": "Generate wsdl with extra comment", "bodyText": "Vanuit de IBIS-console kan voor iedere adapter met een inputValidator een WSDL gegenereerd en gedownload worden. Echter, bij dit genereren wordt er vanuit gegaan dat de pipeline standaard is waarbij een soap request (text) wordt ontvangen en een soap response (text) wordt teruggestuurd.\nBij de AM-API zijn meerdere adapters welke naast de soap request (text) ook een of meer documenten meesturen. Omdat MTOM upload toendertijd nog niet beschikbaar was in het IAF is gekozen voor form-based file upload: request multipart/form-data waarbij het soap request (text) in het eerste part van het multipart zit en ieder document (stream) in een volgend part. De gegeneerde WSDL voor deze multipart berichten slaat dan enkel op het soap request (text) dat in het eerste part zit.\nMet deze PR wordt extra comment aan de gegenereerde WSDL toegevoegd zodat e.e.a. duidelijk gemaakt wordt. Hiervoor dient de IBIS developer wel op de ApiSoapValidator het attribuut multipart=true te zetten. Het attribuut had ook op de SoapValidator gezet kunnen worden, maar omdat deze functionaliteit specifiek is voor de AM-API heb ik het op de ApiSoapValidator gezet. Het zal ook zo snel niet meer gebruikt worden nu MTOM beschikbaar is in het IAF.", "createdAt": "2020-04-23T14:32:25Z", "url": "https://github.com/ibissource/iaf/pull/635", "merged": true, "mergeCommit": {"oid": "817abae3ee0be032ee215cf0494fef45e9098597"}, "closed": true, "closedAt": "2020-05-11T06:14:21Z", "author": {"login": "leeuw73"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcZ0lYcgH2gAyNDA3OTYzODUzOjExNGM3Mjc1M2NjMGE3YzRkZDFkOGE2N2M5YTVkYzU1MjE3NGQ3NDk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcgJee7AFqTQwODg4NDU1NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "114c72753cc0a7c4dd1d8a67c9a5dc552174d749", "author": {"user": {"login": "leeuw73", "name": null}}, "url": "https://github.com/ibissource/iaf/commit/114c72753cc0a7c4dd1d8a67c9a5dc552174d749", "committedDate": "2020-04-21T14:30:05Z", "message": "Add clarified comment in multipart WSDLs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bec83cc423ffa749b95d17c8ee5d404008a42b01", "author": {"user": {"login": "leeuw73", "name": null}}, "url": "https://github.com/ibissource/iaf/commit/bec83cc423ffa749b95d17c8ee5d404008a42b01", "committedDate": "2020-04-23T14:00:04Z", "message": "Fix Larva scenarios"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAxNTQwODA5", "url": "https://github.com/ibissource/iaf/pull/635#pullrequestreview-401540809", "createdAt": "2020-04-28T06:46:56Z", "commit": {"oid": "bec83cc423ffa749b95d17c8ee5d404008a42b01"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQwNjo0Njo1NlrOGNFIeA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQwNjo0Njo1NlrOGNFIeA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjM2ODc2MA==", "bodyText": "Ik wil niet het interface IXmlValidator aanpassen voor deze functionaliteit, waarvan je zegt dat hij alleen op de AM-API gebruikt wordt, en in de toekomst ook niet gebruikt zal worden, omdat er dan MTOM gedaan wordt,", "url": "https://github.com/ibissource/iaf/pull/635#discussion_r416368760", "createdAt": "2020-04-28T06:46:56Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/core/IXmlValidator.java", "diffHunk": "@@ -14,4 +14,5 @@\n \tpublic String getSchema();\n \tpublic String getSchemaLocation();\n \tpublic Set<XSD> getXsds() throws ConfigurationException;\n+\tpublic String getInfo();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bec83cc423ffa749b95d17c8ee5d404008a42b01"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzMzkzNjQ4", "url": "https://github.com/ibissource/iaf/pull/635#pullrequestreview-403393648", "createdAt": "2020-04-30T10:27:39Z", "commit": {"oid": "bec83cc423ffa749b95d17c8ee5d404008a42b01"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQxMDoyNzozOVrOGOjQlw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQxMDoyNzozOVrOGOjQlw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzkxMDkzNQ==", "bodyText": "Dit commentaar moet niet in de GUI er bij geplakt worden, maar onderdeel zijn van het genereren van de WSDL.\nTen eerste omdat dit niet in de GUI moet, en ten tweede omdat het ook in GUI 3.0 moet werken. (Daarom moet het ook niet in de GUI, zeg maar)", "url": "https://github.com/ibissource/iaf/pull/635#discussion_r417910935", "createdAt": "2020-04-30T10:27:39Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/webcontrol/pipes/Webservices.java", "diffHunk": "@@ -207,16 +208,21 @@ private void zip(Adapter adapter, IPipeLineSession session)\n \t\t\tNamingException {\n \t\tWsdl wsdl = new Wsdl(adapter.getPipeLine());\n \t\twsdl.setUseIncludes(true);\n-\t\twsdl.setDocumentation(getDocumentation(wsdl, session));\n+\t\twsdl.setDocumentation(getDocumentation(wsdl, adapter, session));\n \t\twsdl.init();\n \t\twsdl.zip(RestListenerUtils.retrieveServletOutputStream(session),\n \t\t\t\tRestListenerUtils.retrieveSOAPRequestURL(session));\n \t}\n \n-\tprivate String getDocumentation(Wsdl wsdl, IPipeLineSession session)\n+\tprivate String getDocumentation(Wsdl wsdl, Adapter adapter, IPipeLineSession session)\n \t\t\tthrows IOException {\n-\t\treturn \"Generated at \" + RestListenerUtils.retrieveRequestURL(session)\n+\t\tString doc = \"Generated at \" + RestListenerUtils.retrieveRequestURL(session)\n \t\t\t\t+ \" as \" + wsdl.getFilename() + getWsdlExtention() + \" on \"\n \t\t\t\t+ DateUtils.getIsoTimeStamp() + \".\";\n+\t\tString info = ((IXmlValidator)adapter.getPipeLine().getInputValidator()).getInfo();\n+\t\tif (info!=null) {\n+\t\t\tdoc = doc + info;\n+\t\t}\n+\t\treturn doc;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bec83cc423ffa749b95d17c8ee5d404008a42b01"}, "originalPosition": 39}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6256a326a848d858af4d3233455f698f92fc6c24", "author": {"user": {"login": "leeuw73", "name": null}}, "url": "https://github.com/ibissource/iaf/commit/6256a326a848d858af4d3233455f698f92fc6c24", "committedDate": "2020-05-04T13:27:37Z", "message": "Move getDocumentation() from Webservices to Wsdl\n\nand renamed IXmlValidator GetInfo() to GetDocumentation()"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "674dc3b464cedc8a4b6d1d04eb3136c34670cdcb", "author": {"user": {"login": "leeuw73", "name": null}}, "url": "https://github.com/ibissource/iaf/commit/674dc3b464cedc8a4b6d1d04eb3136c34670cdcb", "committedDate": "2020-05-04T17:39:11Z", "message": "Merge branch 'master' into GenerateWsdlWithExtraComment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f76a2c08e184adaade15f61a9eb98212985c33be", "author": {"user": {"login": "leeuw73", "name": null}}, "url": "https://github.com/ibissource/iaf/commit/f76a2c08e184adaade15f61a9eb98212985c33be", "committedDate": "2020-05-04T17:56:26Z", "message": "Merge remote-tracking branch 'origin/master' into GenerateWsdlWithExtraComment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "733cf580e76dd8cd2963824843527b08db7e0909", "author": {"user": {"login": "leeuw73", "name": null}}, "url": "https://github.com/ibissource/iaf/commit/733cf580e76dd8cd2963824843527b08db7e0909", "committedDate": "2020-05-04T18:06:04Z", "message": "Fix log4j compilation error"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4MDY2Mzgy", "url": "https://github.com/ibissource/iaf/pull/635#pullrequestreview-408066382", "createdAt": "2020-05-08T07:52:21Z", "commit": {"oid": "733cf580e76dd8cd2963824843527b08db7e0909"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwNzo1MjoyMVrOGSc25A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQwNzo1MjoyMVrOGSc25A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAwMDM1Ng==", "bodyText": "Nog \u00e9\u00e9n keer iets op te merken:\nJe hebt hier het argument IPipeLineSession session geintroduceerd, alleen maar om de requestURL op te halen.\nDeze Wsdl heeft verder helemaal niets met deze sessie.\nIk stel voor dat je in plaats hiervan een argument 'String generationInfo' opneemt, zodat je op regel 321 zoiets kan doen als:\n'documentation = \"Generated\" + (generationInfo!= null ? \" \" + generationInfo: \"\") + \" as \" + ... '\nJe kan daar dan ook dingen in stoppen als 'by testtool' of zo.\nEn ook een constructor zonder dat argument, zodat je niet altijd null hoeft mee te geven als je er niet in geinteresseerd bent.", "url": "https://github.com/ibissource/iaf/pull/635#discussion_r422000356", "createdAt": "2020-05-08T07:52:21Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/soap/Wsdl.java", "diffHunk": "@@ -131,7 +140,7 @@\n \n     private List<String> warnings = new ArrayList<String>();\n \n-    public Wsdl(PipeLine pipeLine) {\n+    public Wsdl(PipeLine pipeLine, IPipeLineSession session) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "733cf580e76dd8cd2963824843527b08db7e0909"}, "originalPosition": 49}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "111c69ccd510c6d04452d2fca317f31937fd8e33", "author": {"user": {"login": "leeuw73", "name": null}}, "url": "https://github.com/ibissource/iaf/commit/111c69ccd510c6d04452d2fca317f31937fd8e33", "committedDate": "2020-05-08T14:16:35Z", "message": "Remove IPipeLineSession from Wsdl constructor"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4ODg0NTU1", "url": "https://github.com/ibissource/iaf/pull/635#pullrequestreview-408884555", "createdAt": "2020-05-11T06:14:06Z", "commit": {"oid": "111c69ccd510c6d04452d2fca317f31937fd8e33"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1336, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}