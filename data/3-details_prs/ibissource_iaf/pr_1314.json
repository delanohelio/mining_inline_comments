{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMxOTQwNTk0", "number": 1314, "title": "Fix exchange messageLog and errorStorage browsers", "bodyText": "impact of #1305 is reduced, but not completely solved. ExchangeService is not thread safe.", "createdAt": "2020-12-03T17:12:12Z", "url": "https://github.com/ibissource/iaf/pull/1314", "merged": true, "mergeCommit": {"oid": "c4d24710fb553bdfa4c97fd7390859ad65a8c4b9"}, "closed": true, "closedAt": "2020-12-15T16:51:53Z", "author": {"login": "gvanbrakel"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdiRrmQAH2gAyNTMxOTQwNTk0OmFlZTgzMTgxMTE0ZjExYmY5NzE0Y2IwZjJlOTAzNGU4ZTQ1NzkyMDM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdmdP9PAFqTU1MjY2MjU0NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "aee83181114f11bf9714cb0f2e9034e8e4579203", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/aee83181114f11bf9714cb0f2e9034e8e4579203", "committedDate": "2020-12-02T17:06:40Z", "message": "Fix ExchangeMailListener messageLog and errorStorage browsers"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3b40d561ecb24453cdaf67ad6e022f76ab5df720", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/3b40d561ecb24453cdaf67ad6e022f76ab5df720", "committedDate": "2020-12-03T13:24:37Z", "message": "Fix #1305 Avoid reading message logs when ExchangeFileSystem closed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f165b2cb0342266cdcf99364a567c2661fea8bf4", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/f165b2cb0342266cdcf99364a567c2661fea8bf4", "committedDate": "2020-12-03T17:31:53Z", "message": "Fix Codacy issues"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d6380ced570f29e67f4e02816ac72e49d503c4f2", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/d6380ced570f29e67f4e02816ac72e49d503c4f2", "committedDate": "2020-12-04T08:40:02Z", "message": "Add configuration for ImapListener to iaf-test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "925f4aee88c724fe4bfca255454cb20bf16e7724", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/925f4aee88c724fe4bfca255454cb20bf16e7724", "committedDate": "2020-12-07T16:02:14Z", "message": "Make use of threadLocal ExchangeService"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ2NDQ3OTA1", "url": "https://github.com/ibissource/iaf/pull/1314#pullrequestreview-546447905", "createdAt": "2020-12-07T19:03:53Z", "commit": {"oid": "925f4aee88c724fe4bfca255454cb20bf16e7724"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxOTowMzo1M1rOIA18VQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QxOTo0NDoyNFrOIA3oXg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzc1NDcwOQ==", "bodyText": "Waarom kan een openThread een Map teruggeven? wat zou hier in staan?", "url": "https://github.com/ibissource/iaf/pull/1314#discussion_r537754709", "createdAt": "2020-12-07T19:03:53Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/filesystem/FileSystemListener.java", "diffHunk": "@@ -150,12 +151,21 @@ public void close() throws ListenerException {\n \n \t@Override\n \tpublic Map<String,Object> openThread() throws ListenerException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "925f4aee88c724fe4bfca255454cb20bf16e7724"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzc1OTA3MA==", "bodyText": "Eigenlijk is het dus messageIdKey ?", "url": "https://github.com/ibissource/iaf/pull/1314#discussion_r537759070", "createdAt": "2020-12-07T19:11:06Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/filesystem/FileSystemMessageBrowsingIteratorItem.java", "diffHunk": "@@ -38,7 +43,11 @@ public String getId() throws ListenerException {\n \t@Override\n \tpublic String getOriginalId() throws ListenerException {\n \t\ttry {\n-\t\t\treturn fileSystem.getCanonicalName(item);\n+\t\t\tif (StringUtils.isNotEmpty(messageIdProperty)) {\n+\t\t\t\tMap<String,Object> properties = fileSystem.getAdditionalFileProperties(item);\n+\t\t\t\treturn (String)properties.get(messageIdProperty);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "925f4aee88c724fe4bfca255454cb20bf16e7724"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzc2NTIxMw==", "bodyText": "mag weg toch?", "url": "https://github.com/ibissource/iaf/pull/1314#discussion_r537765213", "createdAt": "2020-12-07T19:20:32Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/filesystem/Samba1FileSystem.java", "diffHunk": "@@ -81,12 +81,12 @@ public void open() throws FileSystemException {\n \t\t} catch (IOException e) {\n \t\t\tthrow new FileSystemException(e);\n \t\t}\n-\n+\t\tsuper.open();\n \t}\n \n \t@Override\n-\tpublic void close() {\n-\t\t// Automatically closes\n+\tpublic void close() throws FileSystemException {\n+\t\tsuper.close();\n \t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "925f4aee88c724fe4bfca255454cb20bf16e7724"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzc2OTkzMA==", "bodyText": "kan/mag utf-8 een constante zijn?", "url": "https://github.com/ibissource/iaf/pull/1314#discussion_r537769930", "createdAt": "2020-12-07T19:27:54Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/webcontrol/api/TransactionalStorage.java", "diffHunk": "@@ -94,6 +95,13 @@ public Response browseReceiverMessage(\n \t\telse\n \t\t\tstorage = receiver.getErrorStorageBrowser();\n \n+\t\ttry {\n+\t\t\t// messageId is double URLEncoded, because it can contain '/' in ExchangeMailListener\n+\t\t\tmessageId = URLDecoder.decode(messageId,\"UTF-8\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "925f4aee88c724fe4bfca255454cb20bf16e7724"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzc3MDQzMA==", "bodyText": "Ik zie dit nu 6x verschijnen..", "url": "https://github.com/ibissource/iaf/pull/1314#discussion_r537770430", "createdAt": "2020-12-07T19:28:44Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/webcontrol/api/TransactionalStorage.java", "diffHunk": "@@ -386,6 +422,13 @@ public Response downloadPipeMessage(\n \t\t\tthrow new ApiException(\"Pipe [\"+pipeName+\"] not found!\");\n \t\t}\n \n+\t\ttry {\n+\t\t\t// messageId is double URLEncoded, because it can contain '/' in ExchangeMailListener\n+\t\t\tmessageId = URLDecoder.decode(messageId,\"UTF-8\");\n+\t\t} catch (UnsupportedEncodingException e) {\n+\t\t\tlog.warn(e);\n+\t\t}\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "925f4aee88c724fe4bfca255454cb20bf16e7724"}, "originalPosition": 97}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzc3MjE0NQ==", "bodyText": "Ik moet zeggen dat ik dit niet de meest elegante oplossing vind maar goed..", "url": "https://github.com/ibissource/iaf/pull/1314#discussion_r537772145", "createdAt": "2020-12-07T19:31:20Z", "author": {"login": "nielsm5"}, "path": "webapp/src/main/webapp/iaf/gui/js/controllers.js", "diffHunk": "@@ -1221,7 +1221,7 @@ angular.module('iaf.beheerconsole')\n \t$scope.doDeleteMessage = function(message, callback) {\n \t\tmessage.deleting = true;\n \n-\t\tApi.Delete($scope.base_url+\"/\"+message.id, function() {\n+\t\tApi.Delete($scope.base_url+\"/\"+encodeURIComponent(encodeURIComponent(message.id)), function() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "925f4aee88c724fe4bfca255454cb20bf16e7724"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzc3ODIzMg==", "bodyText": "Ik snap hier niets van. Waarom geef je niet altijd terug wat in de threadlocal zit. Ik zie iig geen toegevoegde waarde om het naast een threadlocal ook in een global bij te houden...\nDe threadlocal moet/kan een initialValue hebben waar hij de ExchangeService aanmaakt. Dan hoef je geen return localExchangeService !=null ? localExchangeService : createService(); te doen...", "url": "https://github.com/ibissource/iaf/pull/1314#discussion_r537778232", "createdAt": "2020-12-07T19:37:42Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/filesystem/ExchangeFileSystem.java", "diffHunk": "@@ -253,19 +211,96 @@ public FolderId findFolder(FolderId baseFolderId, String folderName) throws Exce\n \t\treturn result;\n \t}\n \n+\tprivate ExchangeService createExchangeService() throws FileSystemException {\n+\t\tExchangeService exchangeService = new ExchangeService(ExchangeVersion.Exchange2010_SP2);\n+\t\t\n+\t\tString defaultUsername = StringUtils.isEmpty(getAccessToken())? getUsername() : null;\n+\t\tString defaultPassword = StringUtils.isEmpty(getAccessToken())? getPassword() : getAccessToken();\n+\n+\t\tCredentialFactory cf = new CredentialFactory(getAuthAlias(), defaultUsername, defaultPassword);\n+\t\tif (StringUtils.isEmpty(cf.getUsername())) {\n+\t\t\t// use OAuth Bearer token authentication\n+\t\t\texchangeService.getHttpHeaders().put(\"Authorization\", \"Bearer \"+cf.getPassword());\n+\t\t} else {\n+\t\t\t// use deprecated Basic Authentication. Support will end 2021-Q3!\n+\t\t\tlog.warn(\"Using deprecated Basic Authentication method for authentication to Exchange Web Services\");\n+\t\t\tExchangeCredentials credentials = new WebCredentials(cf.getUsername(), cf.getPassword());\n+\t\t\texchangeService.setCredentials(credentials);\n+\t\t}\n+\n+\t\t\n+\t\t\n+\t\tif (StringUtils.isNotEmpty(getProxyHost()) && (StringUtils.isNotEmpty(getProxyAuthAlias()) || StringUtils.isNotEmpty(getProxyUsername()) || StringUtils.isNotEmpty(getProxyPassword()))) {\n+\t\t\tCredentialFactory proxyCf = new CredentialFactory(getProxyAuthAlias(), getProxyUsername(), getProxyPassword());\n+\t\t\tWebProxyCredentials webProxyCredentials = new WebProxyCredentials(proxyCf.getUsername(), proxyCf.getPassword(), getProxyDomain());\n+\t\t\tWebProxy webProxy = new WebProxy(getProxyHost(), getProxyPort(), webProxyCredentials);\n+\t\t\texchangeService.setWebProxy(webProxy);\n+\t\t}\n+\n+\t\tRedirectionUrlCallback redirectionUrlCallback = new RedirectionUrlCallback() {\n+\n+\t\t\t@Override\n+\t\t\tpublic boolean autodiscoverRedirectionUrlValidationCallback(String redirectionUrl) {\n+\t\t\t\tif (isValidateAllRedirectUrls()) {\n+\t\t\t\t\tlog.debug(\"validated redirection url [\"+redirectionUrl+\"]\");\n+\t\t\t\t\treturn true;\n+\t\t\t\t}\n+\t\t\t\tlog.debug(\"did not validate redirection url [\"+redirectionUrl+\"]\");\n+\t\t\t\treturn super.autodiscoverRedirectionUrlValidationCallback(redirectionUrl);\n+\t\t\t}\n+\t\t\t\n+\t\t};\n+\n+\t\tif (StringUtils.isEmpty(getUrl())) {\n+\t\t\tlog.debug(\"performing autodiscovery for [\"+getMailAddress()+\"]\");\n+\t\t\ttry {\n+\t\t\t\texchangeService.autodiscoverUrl(getMailAddress(),redirectionUrlCallback);\n+\t\t\t} catch (Exception e) {\n+\t\t\t\tthrow new FileSystemException(\"cannot autodiscover for [\"+getMailAddress()+\"]\", e);\n+\t\t\t}\n+\t\t} else {\n+\t\t\ttry {\n+\t\t\t\texchangeService.setUrl(new URI(getUrl()));\n+\t\t\t} catch (URISyntaxException e) {\n+\t\t\t\tthrow new FileSystemException(\"cannot set URL [\"+getUrl()+\"]\", e);\n+\t\t\t}\n+\t\t}\n+\t\tlog.debug(\"using url [\"+exchangeService.getUrl()+\"]\");\n+\t\treturn exchangeService;\n+\t}\n+\t\n+\tprivate ExchangeService getExchangeService() {\n+\t\tExchangeService localExchangeService = threadLocalExchangeService.get();\n+\t\treturn localExchangeService !=null ? localExchangeService : globalExchangeService;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "925f4aee88c724fe4bfca255454cb20bf16e7724"}, "originalPosition": 174}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzc3OTEyNQ==", "bodyText": "Hier zou je dan naast de close ook een threadlocal.remove() moeten doen.", "url": "https://github.com/ibissource/iaf/pull/1314#discussion_r537779125", "createdAt": "2020-12-07T19:39:10Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/filesystem/ExchangeFileSystem.java", "diffHunk": "@@ -253,19 +211,96 @@ public FolderId findFolder(FolderId baseFolderId, String folderName) throws Exce\n \t\treturn result;\n \t}\n \n+\tprivate ExchangeService createExchangeService() throws FileSystemException {\n+\t\tExchangeService exchangeService = new ExchangeService(ExchangeVersion.Exchange2010_SP2);\n+\t\t\n+\t\tString defaultUsername = StringUtils.isEmpty(getAccessToken())? getUsername() : null;\n+\t\tString defaultPassword = StringUtils.isEmpty(getAccessToken())? getPassword() : getAccessToken();\n+\n+\t\tCredentialFactory cf = new CredentialFactory(getAuthAlias(), defaultUsername, defaultPassword);\n+\t\tif (StringUtils.isEmpty(cf.getUsername())) {\n+\t\t\t// use OAuth Bearer token authentication\n+\t\t\texchangeService.getHttpHeaders().put(\"Authorization\", \"Bearer \"+cf.getPassword());\n+\t\t} else {\n+\t\t\t// use deprecated Basic Authentication. Support will end 2021-Q3!\n+\t\t\tlog.warn(\"Using deprecated Basic Authentication method for authentication to Exchange Web Services\");\n+\t\t\tExchangeCredentials credentials = new WebCredentials(cf.getUsername(), cf.getPassword());\n+\t\t\texchangeService.setCredentials(credentials);\n+\t\t}\n+\n+\t\t\n+\t\t\n+\t\tif (StringUtils.isNotEmpty(getProxyHost()) && (StringUtils.isNotEmpty(getProxyAuthAlias()) || StringUtils.isNotEmpty(getProxyUsername()) || StringUtils.isNotEmpty(getProxyPassword()))) {\n+\t\t\tCredentialFactory proxyCf = new CredentialFactory(getProxyAuthAlias(), getProxyUsername(), getProxyPassword());\n+\t\t\tWebProxyCredentials webProxyCredentials = new WebProxyCredentials(proxyCf.getUsername(), proxyCf.getPassword(), getProxyDomain());\n+\t\t\tWebProxy webProxy = new WebProxy(getProxyHost(), getProxyPort(), webProxyCredentials);\n+\t\t\texchangeService.setWebProxy(webProxy);\n+\t\t}\n+\n+\t\tRedirectionUrlCallback redirectionUrlCallback = new RedirectionUrlCallback() {\n+\n+\t\t\t@Override\n+\t\t\tpublic boolean autodiscoverRedirectionUrlValidationCallback(String redirectionUrl) {\n+\t\t\t\tif (isValidateAllRedirectUrls()) {\n+\t\t\t\t\tlog.debug(\"validated redirection url [\"+redirectionUrl+\"]\");\n+\t\t\t\t\treturn true;\n+\t\t\t\t}\n+\t\t\t\tlog.debug(\"did not validate redirection url [\"+redirectionUrl+\"]\");\n+\t\t\t\treturn super.autodiscoverRedirectionUrlValidationCallback(redirectionUrl);\n+\t\t\t}\n+\t\t\t\n+\t\t};\n+\n+\t\tif (StringUtils.isEmpty(getUrl())) {\n+\t\t\tlog.debug(\"performing autodiscovery for [\"+getMailAddress()+\"]\");\n+\t\t\ttry {\n+\t\t\t\texchangeService.autodiscoverUrl(getMailAddress(),redirectionUrlCallback);\n+\t\t\t} catch (Exception e) {\n+\t\t\t\tthrow new FileSystemException(\"cannot autodiscover for [\"+getMailAddress()+\"]\", e);\n+\t\t\t}\n+\t\t} else {\n+\t\t\ttry {\n+\t\t\t\texchangeService.setUrl(new URI(getUrl()));\n+\t\t\t} catch (URISyntaxException e) {\n+\t\t\t\tthrow new FileSystemException(\"cannot set URL [\"+getUrl()+\"]\", e);\n+\t\t\t}\n+\t\t}\n+\t\tlog.debug(\"using url [\"+exchangeService.getUrl()+\"]\");\n+\t\treturn exchangeService;\n+\t}\n+\t\n+\tprivate ExchangeService getExchangeService() {\n+\t\tExchangeService localExchangeService = threadLocalExchangeService.get();\n+\t\treturn localExchangeService !=null ? localExchangeService : globalExchangeService;\n+\t}\n+\n \t@Override\n \tpublic void close() throws FileSystemException {\n-\t\tif (exchangeService!=null) {\n-\t\t\texchangeService.close();\n+\t\tsuper.close();\n+\t\tif (globalExchangeService!=null) {\n+\t\t\tglobalExchangeService.close();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "925f4aee88c724fe4bfca255454cb20bf16e7724"}, "originalPosition": 183}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzc4MjM2Ng==", "bodyText": "Aangezien de PhysicalDestinationName redelijk vaak opgehaald wordt is het misschien handig de url alleen weer te geven als deze daadwerkelijk opgegeven is, en anders 'using autodiscovery' te gebruiken.", "url": "https://github.com/ibissource/iaf/pull/1314#discussion_r537782366", "createdAt": "2020-12-07T19:44:24Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/filesystem/ExchangeFileSystem.java", "diffHunk": "@@ -757,10 +796,11 @@ public void extractAttachment(Attachment attachment, SaxElementBuilder attachmen\n \n \t@Override\n \tpublic String getPhysicalDestinationName() {\n-\t\tif (exchangeService != null) {\n-\t\t\treturn \"url [\" + (exchangeService == null ? \"\" : exchangeService.getUrl()) + \"] mailAddress [\" + (getMailAddress() == null ? \"\" : getMailAddress()) + \"]\";\n+\t\tString result = super.getPhysicalDestinationName();\n+\t\tif (globalExchangeService != null) {\n+\t\t\tresult = Misc.concatStrings(\"url [\" + (globalExchangeService == null ? \"\" : globalExchangeService.getUrl()) + \"] mailAddress [\" + (getMailAddress() == null ? \"\" : getMailAddress()) + \"]\", \" \", result);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "925f4aee88c724fe4bfca255454cb20bf16e7724"}, "originalPosition": 311}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b64a5a422aa8bd2d7095ef9ae5c2e773859fdac", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/5b64a5a422aa8bd2d7095ef9ae5c2e773859fdac", "committedDate": "2020-12-08T08:46:21Z", "message": "Rename messageIdProperty into messageIdPropertyKey"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6eb41a51e25d8ee0384d391647070844e17cf64c", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/6eb41a51e25d8ee0384d391647070844e17cf64c", "committedDate": "2020-12-08T08:51:49Z", "message": "use constant for 'UTF-8' and introduce Misc.urlDecode()"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2abbf6f7be6f64a46faec3bfecb9744be9880cc6", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/2abbf6f7be6f64a46faec3bfecb9744be9880cc6", "committedDate": "2020-12-11T09:59:32Z", "message": "Introduce ConnectedFileSystemBase"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0685c6262f02b7e519c31459c9797dfc39624693", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/0685c6262f02b7e519c31459c9797dfc39624693", "committedDate": "2020-12-11T10:21:00Z", "message": "Fix issues"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "79f99067abe5d05a9455ceda02d0f08eddca1ec2", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/79f99067abe5d05a9455ceda02d0f08eddca1ec2", "committedDate": "2020-12-11T12:01:29Z", "message": "Use Connector instead of Proxy"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7bbd8a346816e69f5131de6801dd63abf660bbba", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/7bbd8a346816e69f5131de6801dd63abf660bbba", "committedDate": "2020-12-11T12:09:12Z", "message": "Merged branch 'master'"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0140dbfdb54fc9ef67fc548d7cbc358925dd3303", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/0140dbfdb54fc9ef67fc548d7cbc358925dd3303", "committedDate": "2020-12-14T08:19:13Z", "message": "Remove connection from pool after exception"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "35234d7bec16899b4aa9d66eb82a74545812c079", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/35234d7bec16899b4aa9d66eb82a74545812c079", "committedDate": "2020-12-14T09:29:27Z", "message": "Only close IMAP folder if it is open"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUxMjUyMjQ4", "url": "https://github.com/ibissource/iaf/pull/1314#pullrequestreview-551252248", "createdAt": "2020-12-14T10:51:06Z", "commit": {"oid": "35234d7bec16899b4aa9d66eb82a74545812c079"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQxMDo1MTowNlrOIFKuhA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQxNDoyNzowMlrOIFS-gw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjI4OTU0MA==", "bodyText": "Ik denk dat het handig is als je dit bij de javadoc vermeld. Je kan dus ook niet-pooled connectors invalideren en deze worden dan automatisch opnieuw aangemaakt.", "url": "https://github.com/ibissource/iaf/pull/1314#discussion_r542289540", "createdAt": "2020-12-14T10:51:06Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/filesystem/ConnectedFileSystemBase.java", "diffHunk": "@@ -0,0 +1,159 @@\n+/*\n+   Copyright 2020 WeAreFrank!\n+\n+   Licensed under the Apache License, Version 2.0 (the \"License\");\n+   you may not use this file except in compliance with the License.\n+   You may obtain a copy of the License at\n+\n+       http://www.apache.org/licenses/LICENSE-2.0\n+\n+   Unless required by applicable law or agreed to in writing, software\n+   distributed under the License is distributed on an \"AS IS\" BASIS,\n+   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+   See the License for the specific language governing permissions and\n+   limitations under the License.\n+ */\n+package nl.nn.adapterframework.filesystem;\n+\n+import org.apache.commons.pool2.BasePooledObjectFactory;\n+import org.apache.commons.pool2.ObjectPool;\n+import org.apache.commons.pool2.PooledObject;\n+import org.apache.commons.pool2.impl.DefaultPooledObject;\n+import org.apache.commons.pool2.impl.GenericObjectPool;\n+\n+import lombok.Getter;\n+import lombok.Setter;\n+\n+/**\n+ * Baseclass for {@link IBasicFileSystem FileSystems} that use a 'Connection' to connect to their storage.\n+ * \n+ * @author Gerrit van Brakel\n+ *\n+ */\n+public abstract class ConnectedFileSystemBase<F,C> extends FileSystemBase<F> {\n+\n+\t// implementations that have a thread-safe connector can set pooledConnection = false to use a shared connection.\n+\tprivate @Setter @Getter boolean pooledConnection=true;\n+\t\n+\tprivate Connector<C> globalConnector;\n+\tprivate ObjectPool<Connector<C>> connectorPool;\n+\n+\tprotected abstract C createConnection() throws FileSystemException;\n+\t\n+\tprotected void closeConnection(C connection) throws FileSystemException {\n+\t\tif (connection instanceof AutoCloseable) {\n+\t\t\ttry {\n+\t\t\t\t((AutoCloseable) connection).close();\n+\t\t\t} catch (Exception e) {\n+\t\t\t\tthrow new FileSystemException(e);\n+\t\t\t}\n+\t\t}\n+\t}\n+\t\n+\t\n+\t@Override\n+\tpublic void open() throws FileSystemException {\n+\t\tif (isPooledConnection()) {\n+\t\t\topenPool();\n+\t\t} else {\n+\t\t\tglobalConnector = new Connector<>(createConnection(), null);\n+\t\t}\n+\t\tsuper.open();\n+\t}\n+\t\n+\t@Override\n+\tpublic void close() throws FileSystemException {\n+\t\ttry {\n+\t\t\tsuper.close();\n+\t\t} finally {\n+\t\t\tif (isPooledConnection()) {\n+\t\t\t\tclosePool();\n+\t\t\t} else {\n+\t\t\t\tif (globalConnector!=null) {\n+\t\t\t\t\tcloseConnection(globalConnector.getConnection());\n+\t\t\t\t}\n+\t\t\t}\n+\t\t}\n+\t}\n+\t\n+\n+\t/**\n+\t * Get the Connector from the thread, or a fresh one from the pool.\n+\t * At close(), it is returned to the pool, if it came from the pool; \n+\t * If it was allocated, it is just left allocated.\n+\t */\n+\tprotected Connector<C> getConnector() throws FileSystemException {\n+\t\ttry {\n+\t\t\treturn isPooledConnection() ? connectorPool.borrowObject() : globalConnector;\n+\t\t} catch (Exception e) {\n+\t\t\tthrow new FileSystemException(\"Cannot get connector from pool\", e);\n+\t\t}\n+\t}\n+\t\n+\t/**\n+\t * Remove the connector from the pool, e.g. after it has been part of trouble.\n+\t */\n+\tprotected void invalidateConnector(Connector<C> connector) {\n+\t\ttry {\n+\t\t\tif (isPooledConnection()) {\n+\t\t\t\tconnectorPool.invalidateObject(connector);\n+\t\t\t} else {\n+\t\t\t\ttry {\n+\t\t\t\t\tcloseConnection(globalConnector.getConnection());\n+\t\t\t\t} finally {\n+\t\t\t\t\tglobalConnector = new Connector(createConnection(), null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "35234d7bec16899b4aa9d66eb82a74545812c079"}, "originalPosition": 104}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjI5MTA5MQ==", "bodyText": "Ik zie een aantal nuttige log statements maar misschien dat er iets meer informatie in kan staan? Welk FS betreft het?", "url": "https://github.com/ibissource/iaf/pull/1314#discussion_r542291091", "createdAt": "2020-12-14T10:53:25Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/filesystem/ConnectedFileSystemBase.java", "diffHunk": "@@ -0,0 +1,159 @@\n+/*\n+   Copyright 2020 WeAreFrank!\n+\n+   Licensed under the Apache License, Version 2.0 (the \"License\");\n+   you may not use this file except in compliance with the License.\n+   You may obtain a copy of the License at\n+\n+       http://www.apache.org/licenses/LICENSE-2.0\n+\n+   Unless required by applicable law or agreed to in writing, software\n+   distributed under the License is distributed on an \"AS IS\" BASIS,\n+   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+   See the License for the specific language governing permissions and\n+   limitations under the License.\n+ */\n+package nl.nn.adapterframework.filesystem;\n+\n+import org.apache.commons.pool2.BasePooledObjectFactory;\n+import org.apache.commons.pool2.ObjectPool;\n+import org.apache.commons.pool2.PooledObject;\n+import org.apache.commons.pool2.impl.DefaultPooledObject;\n+import org.apache.commons.pool2.impl.GenericObjectPool;\n+\n+import lombok.Getter;\n+import lombok.Setter;\n+\n+/**\n+ * Baseclass for {@link IBasicFileSystem FileSystems} that use a 'Connection' to connect to their storage.\n+ * \n+ * @author Gerrit van Brakel\n+ *\n+ */\n+public abstract class ConnectedFileSystemBase<F,C> extends FileSystemBase<F> {\n+\n+\t// implementations that have a thread-safe connector can set pooledConnection = false to use a shared connection.\n+\tprivate @Setter @Getter boolean pooledConnection=true;\n+\t\n+\tprivate Connector<C> globalConnector;\n+\tprivate ObjectPool<Connector<C>> connectorPool;\n+\n+\tprotected abstract C createConnection() throws FileSystemException;\n+\t\n+\tprotected void closeConnection(C connection) throws FileSystemException {\n+\t\tif (connection instanceof AutoCloseable) {\n+\t\t\ttry {\n+\t\t\t\t((AutoCloseable) connection).close();\n+\t\t\t} catch (Exception e) {\n+\t\t\t\tthrow new FileSystemException(e);\n+\t\t\t}\n+\t\t}\n+\t}\n+\t\n+\t\n+\t@Override\n+\tpublic void open() throws FileSystemException {\n+\t\tif (isPooledConnection()) {\n+\t\t\topenPool();\n+\t\t} else {\n+\t\t\tglobalConnector = new Connector<>(createConnection(), null);\n+\t\t}\n+\t\tsuper.open();\n+\t}\n+\t\n+\t@Override\n+\tpublic void close() throws FileSystemException {\n+\t\ttry {\n+\t\t\tsuper.close();\n+\t\t} finally {\n+\t\t\tif (isPooledConnection()) {\n+\t\t\t\tclosePool();\n+\t\t\t} else {\n+\t\t\t\tif (globalConnector!=null) {\n+\t\t\t\t\tcloseConnection(globalConnector.getConnection());\n+\t\t\t\t}\n+\t\t\t}\n+\t\t}\n+\t}\n+\t\n+\n+\t/**\n+\t * Get the Connector from the thread, or a fresh one from the pool.\n+\t * At close(), it is returned to the pool, if it came from the pool; \n+\t * If it was allocated, it is just left allocated.\n+\t */\n+\tprotected Connector<C> getConnector() throws FileSystemException {\n+\t\ttry {\n+\t\t\treturn isPooledConnection() ? connectorPool.borrowObject() : globalConnector;\n+\t\t} catch (Exception e) {\n+\t\t\tthrow new FileSystemException(\"Cannot get connector from pool\", e);\n+\t\t}\n+\t}\n+\t\n+\t/**\n+\t * Remove the connector from the pool, e.g. after it has been part of trouble.\n+\t */\n+\tprotected void invalidateConnector(Connector<C> connector) {\n+\t\ttry {\n+\t\t\tif (isPooledConnection()) {\n+\t\t\t\tconnectorPool.invalidateObject(connector);\n+\t\t\t} else {\n+\t\t\t\ttry {\n+\t\t\t\t\tcloseConnection(globalConnector.getConnection());\n+\t\t\t\t} finally {\n+\t\t\t\t\tglobalConnector = new Connector(createConnection(), null);\n+\t\t\t\t}\n+\t\t\t}\n+\t\t} catch (Exception e) {\n+\t\t\tlog.warn(\"Cannot invalidate connector\", e);\n+\t\t}\n+\t}\n+\n+\tprivate void openPool() {\n+\t\tif (connectorPool==null) {\n+\t\t\tconnectorPool=new GenericObjectPool<>(new BasePooledObjectFactory<Connector<C>>() {\n+\n+\t\t\t\t@Override\n+\t\t\t\tpublic Connector<C> create() throws Exception {\n+\t\t\t\t\treturn new Connector<C>(createConnection(), connectorPool);\n+\t\t\t\t}\n+\n+\t\t\t\t@Override\n+\t\t\t\tpublic PooledObject<Connector<C>> wrap(Connector<C> connector) {\n+\t\t\t\t\treturn new DefaultPooledObject<Connector<C>>(connector);\n+\t\t\t\t}\n+\n+\t\t\t\t@Override\n+\t\t\t\tpublic void destroyObject(PooledObject<Connector<C>> p) throws Exception {\n+\t\t\t\t\tcloseConnection(p.getObject().getConnection());\n+\t\t\t\t\tsuper.destroyObject(p);\n+\t\t\t\t}\n+\n+\t\t\t\t@Override\n+\t\t\t\tpublic void activateObject(PooledObject<Connector<C>> p) throws Exception {\n+\t\t\t\t\tsuper.activateObject(p);\n+\t\t\t\t\tp.getObject().setActive(true);\n+\t\t\t\t}\n+\n+\t\t\t\t@Override\n+\t\t\t\tpublic void passivateObject(PooledObject<Connector<C>> p) throws Exception {\n+\t\t\t\t\tsuper.passivateObject(p);\n+\t\t\t\t\tp.getObject().setActive(false);\n+\t\t\t\t}\n+\n+\t\t\t}); \n+\t\t}\n+\t}\n+\n+\tprivate void closePool() {\n+\t\ttry {\n+\t\t\tif (connectorPool!=null) {\n+\t\t\t\tconnectorPool.close();\n+\t\t\t\tconnectorPool=null;\n+\t\t\t}\n+\t\t} catch (Exception e) {\n+\t\t\tlog.warn(\"exception clearing Pool\",e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "35234d7bec16899b4aa9d66eb82a74545812c079"}, "originalPosition": 155}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjI5MjE1Nw==", "bodyText": "connectorPool refereert naar this toch?", "url": "https://github.com/ibissource/iaf/pull/1314#discussion_r542292157", "createdAt": "2020-12-14T10:55:09Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/filesystem/ConnectedFileSystemBase.java", "diffHunk": "@@ -0,0 +1,159 @@\n+/*\n+   Copyright 2020 WeAreFrank!\n+\n+   Licensed under the Apache License, Version 2.0 (the \"License\");\n+   you may not use this file except in compliance with the License.\n+   You may obtain a copy of the License at\n+\n+       http://www.apache.org/licenses/LICENSE-2.0\n+\n+   Unless required by applicable law or agreed to in writing, software\n+   distributed under the License is distributed on an \"AS IS\" BASIS,\n+   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+   See the License for the specific language governing permissions and\n+   limitations under the License.\n+ */\n+package nl.nn.adapterframework.filesystem;\n+\n+import org.apache.commons.pool2.BasePooledObjectFactory;\n+import org.apache.commons.pool2.ObjectPool;\n+import org.apache.commons.pool2.PooledObject;\n+import org.apache.commons.pool2.impl.DefaultPooledObject;\n+import org.apache.commons.pool2.impl.GenericObjectPool;\n+\n+import lombok.Getter;\n+import lombok.Setter;\n+\n+/**\n+ * Baseclass for {@link IBasicFileSystem FileSystems} that use a 'Connection' to connect to their storage.\n+ * \n+ * @author Gerrit van Brakel\n+ *\n+ */\n+public abstract class ConnectedFileSystemBase<F,C> extends FileSystemBase<F> {\n+\n+\t// implementations that have a thread-safe connector can set pooledConnection = false to use a shared connection.\n+\tprivate @Setter @Getter boolean pooledConnection=true;\n+\t\n+\tprivate Connector<C> globalConnector;\n+\tprivate ObjectPool<Connector<C>> connectorPool;\n+\n+\tprotected abstract C createConnection() throws FileSystemException;\n+\t\n+\tprotected void closeConnection(C connection) throws FileSystemException {\n+\t\tif (connection instanceof AutoCloseable) {\n+\t\t\ttry {\n+\t\t\t\t((AutoCloseable) connection).close();\n+\t\t\t} catch (Exception e) {\n+\t\t\t\tthrow new FileSystemException(e);\n+\t\t\t}\n+\t\t}\n+\t}\n+\t\n+\t\n+\t@Override\n+\tpublic void open() throws FileSystemException {\n+\t\tif (isPooledConnection()) {\n+\t\t\topenPool();\n+\t\t} else {\n+\t\t\tglobalConnector = new Connector<>(createConnection(), null);\n+\t\t}\n+\t\tsuper.open();\n+\t}\n+\t\n+\t@Override\n+\tpublic void close() throws FileSystemException {\n+\t\ttry {\n+\t\t\tsuper.close();\n+\t\t} finally {\n+\t\t\tif (isPooledConnection()) {\n+\t\t\t\tclosePool();\n+\t\t\t} else {\n+\t\t\t\tif (globalConnector!=null) {\n+\t\t\t\t\tcloseConnection(globalConnector.getConnection());\n+\t\t\t\t}\n+\t\t\t}\n+\t\t}\n+\t}\n+\t\n+\n+\t/**\n+\t * Get the Connector from the thread, or a fresh one from the pool.\n+\t * At close(), it is returned to the pool, if it came from the pool; \n+\t * If it was allocated, it is just left allocated.\n+\t */\n+\tprotected Connector<C> getConnector() throws FileSystemException {\n+\t\ttry {\n+\t\t\treturn isPooledConnection() ? connectorPool.borrowObject() : globalConnector;\n+\t\t} catch (Exception e) {\n+\t\t\tthrow new FileSystemException(\"Cannot get connector from pool\", e);\n+\t\t}\n+\t}\n+\t\n+\t/**\n+\t * Remove the connector from the pool, e.g. after it has been part of trouble.\n+\t */\n+\tprotected void invalidateConnector(Connector<C> connector) {\n+\t\ttry {\n+\t\t\tif (isPooledConnection()) {\n+\t\t\t\tconnectorPool.invalidateObject(connector);\n+\t\t\t} else {\n+\t\t\t\ttry {\n+\t\t\t\t\tcloseConnection(globalConnector.getConnection());\n+\t\t\t\t} finally {\n+\t\t\t\t\tglobalConnector = new Connector(createConnection(), null);\n+\t\t\t\t}\n+\t\t\t}\n+\t\t} catch (Exception e) {\n+\t\t\tlog.warn(\"Cannot invalidate connector\", e);\n+\t\t}\n+\t}\n+\n+\tprivate void openPool() {\n+\t\tif (connectorPool==null) {\n+\t\t\tconnectorPool=new GenericObjectPool<>(new BasePooledObjectFactory<Connector<C>>() {\n+\n+\t\t\t\t@Override\n+\t\t\t\tpublic Connector<C> create() throws Exception {\n+\t\t\t\t\treturn new Connector<C>(createConnection(), connectorPool);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "35234d7bec16899b4aa9d66eb82a74545812c079"}, "originalPosition": 118}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjI5MjcxMg==", "bodyText": "misschien is het handig om ook een constructor te hebben zonder ObjectPool, aangezien deze optioneel is..", "url": "https://github.com/ibissource/iaf/pull/1314#discussion_r542292712", "createdAt": "2020-12-14T10:56:00Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/filesystem/Connector.java", "diffHunk": "@@ -0,0 +1,47 @@\n+/*\n+   Copyright 2020 WeAreFrank!\n+\n+   Licensed under the Apache License, Version 2.0 (the \"License\");\n+   you may not use this file except in compliance with the License.\n+   You may obtain a copy of the License at\n+\n+       http://www.apache.org/licenses/LICENSE-2.0\n+\n+   Unless required by applicable law or agreed to in writing, software\n+   distributed under the License is distributed on an \"AS IS\" BASIS,\n+   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+   See the License for the specific language governing permissions and\n+   limitations under the License.\n+ */\n+package nl.nn.adapterframework.filesystem;\n+\n+import org.apache.commons.pool2.ObjectPool;\n+\n+import lombok.Getter;\n+import lombok.Setter;\n+\n+/*\n+ * Wrapper around Connection, that returns it to pool at close().\n+ */\n+public class Connector<C> implements AutoCloseable {\n+\tprivate @Getter C connection;\n+\tprivate ObjectPool<Connector<C>> pool;\n+\tprivate @Getter @Setter boolean active;\n+\t\n+\tpublic Connector(C connection, ObjectPool<Connector<C>> pool) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "35234d7bec16899b4aa9d66eb82a74545812c079"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjMwMDc1Ng==", "bodyText": "Moet hij ook gesloten worden?", "url": "https://github.com/ibissource/iaf/pull/1314#discussion_r542300756", "createdAt": "2020-12-14T11:08:51Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/filesystem/ExchangeFileSystem.java", "diffHunk": "@@ -338,10 +361,15 @@ public EmailMessage next() {\n \t\t\t\t\t\treturn (EmailMessage)itemIterator.next();\n \t\t\t\t\t}\n \t\t\t\t\t\n-\t\t\t\t});\n+\t\t\t\t}, connector);\n \t\t\t}\n \t\t} catch (Exception e) {\n-\t\t\tthrow new FileSystemException(\"Cannot list messages in folder [\"+folder+\"]\", e);\n+\t\t\ttry {\n+\t\t\t\tinvalidateConnector(connector);\n+\t\t\t\tconnector.close();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "35234d7bec16899b4aa9d66eb82a74545812c079"}, "originalPosition": 395}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjMzNjU3MA==", "bodyText": "niet backwards compatible?", "url": "https://github.com/ibissource/iaf/pull/1314#discussion_r542336570", "createdAt": "2020-12-14T12:11:34Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/filesystem/FileSystemListener.java", "diffHunk": "@@ -483,12 +484,12 @@ public long getMinStableTime() {\n \t\treturn minStableTime;\n \t}\n \n-\t@IbisDoc({\"14\", \"Property to use as messageId. If not set, the filename of the file as it was received in the inputFolder is used as the messageId\", \"for MailFileSystems: Message-ID\"})\n-\tpublic void setMessageIdProperty(String messageIdProperty) {\n-\t\tthis.messageIdProperty = messageIdProperty;\n+\t@IbisDoc({\"14\", \"Key of Property to use as messageId. If not set, the filename of the file as it was received in the inputFolder is used as the messageId\", \"for MailFileSystems: Message-ID\"})\n+\tpublic void setMessageIdPropertyKey(String messageIdPropertyKey) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "35234d7bec16899b4aa9d66eb82a74545812c079"}, "originalPosition": 119}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjQyNDcwNw==", "bodyText": "Kan je dit niet beter CloseAfterRead noemen ofzo?", "url": "https://github.com/ibissource/iaf/pull/1314#discussion_r542424707", "createdAt": "2020-12-14T14:27:02Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/util/StreamUtil.java", "diffHunk": "@@ -218,4 +219,59 @@ public static ZipOutputStream openZipDownload(HttpServletResponse response, Stri\n \t\treturn zipOutputStream;\n \t}\n \n+\tpublic static InputStream closeOnClose(InputStream stream, AutoCloseable resource) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "35234d7bec16899b4aa9d66eb82a74545812c079"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d495a21963bec72c507647f22da2e1bf6ad38223", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/d495a21963bec72c507647f22da2e1bf6ad38223", "committedDate": "2020-12-15T10:34:21Z", "message": "Simplify connection handling"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUyNjYyNTQ0", "url": "https://github.com/ibissource/iaf/pull/1314#pullrequestreview-552662544", "createdAt": "2020-12-15T16:51:02Z", "commit": {"oid": "d495a21963bec72c507647f22da2e1bf6ad38223"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 928, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}