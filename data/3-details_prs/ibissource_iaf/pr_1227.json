{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE0NjY0MzM0", "number": 1227, "title": "Use Path instead of File in LocalFileSystem", "bodyText": "", "createdAt": "2020-11-03T11:19:33Z", "url": "https://github.com/ibissource/iaf/pull/1227", "merged": true, "mergeCommit": {"oid": "ec1016845e1f715e2f609ebd112a817e6c465912"}, "closed": true, "closedAt": "2020-11-06T09:01:11Z", "author": {"login": "alisihab"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdY3UvXgH2gAyNTE0NjY0MzM0OjI3OGY1MGM0MmRmYTZhNjg0NmExZjIxNTdiOTg3ZDgwYjQ0ZTcyYmQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdZyPgeAH2gAyNTE0NjY0MzM0OjM0NzhiMTc0MWVlMjQyOWI1MjI1YzQ2MjliZDRmYTE4YTE1NDcxNzg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "278f50c42dfa6a6846a1f2157b987d80b44e72bd", "author": {"user": null}, "url": "https://github.com/ibissource/iaf/commit/278f50c42dfa6a6846a1f2157b987d80b44e72bd", "committedDate": "2020-11-03T11:18:51Z", "message": "Use Path instead of File in LocalFileSystem"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8f7f2f3830d30588c09214176d3cb1509166f3a9", "author": {"user": null}, "url": "https://github.com/ibissource/iaf/commit/8f7f2f3830d30588c09214176d3cb1509166f3a9", "committedDate": "2020-11-03T11:30:20Z", "message": "remove semicolon"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e64d33a9ab267dab39823533653d8ee69e9bb7f3", "author": {"user": null}, "url": "https://github.com/ibissource/iaf/commit/e64d33a9ab267dab39823533653d8ee69e9bb7f3", "committedDate": "2020-11-03T11:51:17Z", "message": "remove unused import"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIzMDk5MTY0", "url": "https://github.com/ibissource/iaf/pull/1227#pullrequestreview-523099164", "createdAt": "2020-11-04T07:32:07Z", "commit": {"oid": "e64d33a9ab267dab39823533653d8ee69e9bb7f3"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQwNzozMjowN1rOHtL4uA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQwNzo0MzozNVrOHtMMhA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzE0MjcxMg==", "bodyText": "These two try statements can be combined. The getFileSystem() need not be inside the try.", "url": "https://github.com/ibissource/iaf/pull/1227#discussion_r517142712", "createdAt": "2020-11-04T07:32:07Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/filesystem/FileSystemListener.java", "diffHunk": "@@ -166,39 +168,40 @@ public FS getFileSystem() {\n \tpublic synchronized F getRawMessage(Map<String,Object> threadContext) throws ListenerException {\n \t\ttry {\n \t\t\tFS fileSystem=getFileSystem();\n-\t\t\tIterator<F> it = fileSystem.listFiles(getInputFolder());\n-\t\t\tif (it==null || !it.hasNext()) {\n-\t\t\t\treturn null;\n-\t\t\t}\n-\t\t\t\n-\t\t\tlong stabilityLimit = getMinStableTime();\n-\t\t\tif (stabilityLimit>0) {\n-\t\t\t\tstabilityLimit=System.currentTimeMillis()-stabilityLimit;\n-\t\t\t}\n-\t\t\twhile (it.hasNext()) {\n-\t\t\t\tF file = it.next();\n+\t\t\ttry(DirectoryStream<F> ds = fileSystem.listFiles(getInputFolder())) {\n+\t\t\t\tIterator<F> it = ds.iterator();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e64d33a9ab267dab39823533653d8ee69e9bb7f3"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzE0MzA5MA==", "bodyText": "These two try statements can be combined.", "url": "https://github.com/ibissource/iaf/pull/1227#discussion_r517143090", "createdAt": "2020-11-04T07:33:06Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/filesystem/FileSystemMessageBrowser.java", "diffHunk": "@@ -102,8 +104,12 @@ public void deleteMessage(String messageId) throws ListenerException {\n \tpublic int getMessageCount() throws ListenerException {\n \t\ttry {\n \t\t\tint count = 0;\n-\t\t\tfor (Iterator<F> it = fileSystem.listFiles(folder); it.hasNext(); it.next()) {\n-\t\t\t\tcount++;\n+\t\t\ttry(DirectoryStream<F> ds = fileSystem.listFiles(folder)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e64d33a9ab267dab39823533653d8ee69e9bb7f3"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzE0NjQ0Nw==", "bodyText": "Please add \"Cannot create folder [\"+ foldername +\"]\"", "url": "https://github.com/ibissource/iaf/pull/1227#discussion_r517146447", "createdAt": "2020-11-04T07:40:39Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/filesystem/LocalFileSystem.java", "diffHunk": "@@ -165,7 +147,11 @@ public boolean folderExists(String folder) throws FileSystemException {\n \t@Override\n \tpublic void createFolder(String folder) throws FileSystemException {\n \t\tif (!folderExists(folder)) {\n-\t\t\ttoFile(folder).mkdir();\n+\t\t\ttry {\n+\t\t\t\tFiles.createDirectories(toFile(folder));\n+\t\t\t} catch (IOException e) {\n+\t\t\t\tthrow new FileSystemException(e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e64d33a9ab267dab39823533653d8ee69e9bb7f3"}, "originalPosition": 189}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzE0NjY4Mg==", "bodyText": "Please add \"Cannot remove folder [\"+ foldername +\"]\"", "url": "https://github.com/ibissource/iaf/pull/1227#discussion_r517146682", "createdAt": "2020-11-04T07:41:10Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/filesystem/LocalFileSystem.java", "diffHunk": "@@ -174,66 +160,79 @@ public void createFolder(String folder) throws FileSystemException {\n \t@Override\n \tpublic void removeFolder(String folder) throws FileSystemException {\n \t\tif (folderExists(folder)) {\n-\t\t\ttoFile(folder).delete();\n+\t\t\ttry {\n+\t\t\t\tFiles.delete(toFile(folder));\n+\t\t\t} catch (IOException e) {\n+\t\t\t\tthrow new FileSystemException(e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e64d33a9ab267dab39823533653d8ee69e9bb7f3"}, "originalPosition": 202}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzE0NzA1OA==", "bodyText": "Please add \"Cannot rename folder [\"+ foldername +\"] to [\"+ destination+\"]\"", "url": "https://github.com/ibissource/iaf/pull/1227#discussion_r517147058", "createdAt": "2020-11-04T07:41:57Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/filesystem/LocalFileSystem.java", "diffHunk": "@@ -174,66 +160,79 @@ public void createFolder(String folder) throws FileSystemException {\n \t@Override\n \tpublic void removeFolder(String folder) throws FileSystemException {\n \t\tif (folderExists(folder)) {\n-\t\t\ttoFile(folder).delete();\n+\t\t\ttry {\n+\t\t\t\tFiles.delete(toFile(folder));\n+\t\t\t} catch (IOException e) {\n+\t\t\t\tthrow new FileSystemException(e);\n+\t\t\t}\n \t\t}else {\n \t\t\tthrow new FileSystemException(\"Remove directory for [\" + folder + \"] has failed. Directory does not exist.\");\n \t\t}\n \t}\n \n \t@Override\n-\tpublic File renameFile(File source, File destination) throws FileSystemException {\n-\t\tif (!source.renameTo(destination)) {\n-\t\t\tthrow new FileSystemException(\"Could not rename [\"+source.getPath()+\"] to [\"+destination.getPath()+\"]\");\n+\tpublic Path renameFile(Path source, Path destination) throws FileSystemException {\n+\t\ttry {\n+\t\t\treturn Files.move(source, destination);\n+\t\t} catch (IOException e) {\n+\t\t\tthrow new FileSystemException(e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e64d33a9ab267dab39823533653d8ee69e9bb7f3"}, "originalPosition": 217}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzE0NzU3NQ==", "bodyText": "Please add \"Cannot move file  [\"+ f.getFileName()+\"] to [\"+ destinationFolder+\"]\"", "url": "https://github.com/ibissource/iaf/pull/1227#discussion_r517147575", "createdAt": "2020-11-04T07:43:03Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/filesystem/LocalFileSystem.java", "diffHunk": "@@ -174,66 +160,79 @@ public void createFolder(String folder) throws FileSystemException {\n \t@Override\n \tpublic void removeFolder(String folder) throws FileSystemException {\n \t\tif (folderExists(folder)) {\n-\t\t\ttoFile(folder).delete();\n+\t\t\ttry {\n+\t\t\t\tFiles.delete(toFile(folder));\n+\t\t\t} catch (IOException e) {\n+\t\t\t\tthrow new FileSystemException(e);\n+\t\t\t}\n \t\t}else {\n \t\t\tthrow new FileSystemException(\"Remove directory for [\" + folder + \"] has failed. Directory does not exist.\");\n \t\t}\n \t}\n \n \t@Override\n-\tpublic File renameFile(File source, File destination) throws FileSystemException {\n-\t\tif (!source.renameTo(destination)) {\n-\t\t\tthrow new FileSystemException(\"Could not rename [\"+source.getPath()+\"] to [\"+destination.getPath()+\"]\");\n+\tpublic Path renameFile(Path source, Path destination) throws FileSystemException {\n+\t\ttry {\n+\t\t\treturn Files.move(source, destination);\n+\t\t} catch (IOException e) {\n+\t\t\tthrow new FileSystemException(e);\n \t\t}\n-\t\treturn destination;\n \t}\n \t\n \t@Override\n-\tpublic File moveFile(File f, String destinationFolder, boolean createFolder) throws FileSystemException {\n-\t\tFile target = toFile(destinationFolder, f.getName());\n-\t\tif (!f.renameTo(target)) {\n-\t\t\tthrow new FileSystemException(\"cannot move file [\"+f.getPath()+\"] to [\"+target.getPath()+\"]\");\n+\tpublic Path moveFile(Path f, String destinationFolder, boolean createFolder) throws FileSystemException {\n+\t\ttry {\n+\t\t\treturn Files.move(f, toFile(destinationFolder, f.getFileName().toString()));\n+\t\t} catch (IOException e) {\n+\t\t\tthrow new FileSystemException(e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e64d33a9ab267dab39823533653d8ee69e9bb7f3"}, "originalPosition": 231}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzE0Nzc4MA==", "bodyText": "Please add \"Cannot copy file  [\"+ f.getFileName()+\"] to [\"+ destinationFolder+\"]\"", "url": "https://github.com/ibissource/iaf/pull/1227#discussion_r517147780", "createdAt": "2020-11-04T07:43:35Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/filesystem/LocalFileSystem.java", "diffHunk": "@@ -174,66 +160,79 @@ public void createFolder(String folder) throws FileSystemException {\n \t@Override\n \tpublic void removeFolder(String folder) throws FileSystemException {\n \t\tif (folderExists(folder)) {\n-\t\t\ttoFile(folder).delete();\n+\t\t\ttry {\n+\t\t\t\tFiles.delete(toFile(folder));\n+\t\t\t} catch (IOException e) {\n+\t\t\t\tthrow new FileSystemException(e);\n+\t\t\t}\n \t\t}else {\n \t\t\tthrow new FileSystemException(\"Remove directory for [\" + folder + \"] has failed. Directory does not exist.\");\n \t\t}\n \t}\n \n \t@Override\n-\tpublic File renameFile(File source, File destination) throws FileSystemException {\n-\t\tif (!source.renameTo(destination)) {\n-\t\t\tthrow new FileSystemException(\"Could not rename [\"+source.getPath()+\"] to [\"+destination.getPath()+\"]\");\n+\tpublic Path renameFile(Path source, Path destination) throws FileSystemException {\n+\t\ttry {\n+\t\t\treturn Files.move(source, destination);\n+\t\t} catch (IOException e) {\n+\t\t\tthrow new FileSystemException(e);\n \t\t}\n-\t\treturn destination;\n \t}\n \t\n \t@Override\n-\tpublic File moveFile(File f, String destinationFolder, boolean createFolder) throws FileSystemException {\n-\t\tFile target = toFile(destinationFolder, f.getName());\n-\t\tif (!f.renameTo(target)) {\n-\t\t\tthrow new FileSystemException(\"cannot move file [\"+f.getPath()+\"] to [\"+target.getPath()+\"]\");\n+\tpublic Path moveFile(Path f, String destinationFolder, boolean createFolder) throws FileSystemException {\n+\t\ttry {\n+\t\t\treturn Files.move(f, toFile(destinationFolder, f.getFileName().toString()));\n+\t\t} catch (IOException e) {\n+\t\t\tthrow new FileSystemException(e);\n \t\t}\n-\t\treturn target;\n \t}\n \t@Override\n-\tpublic File copyFile(File f, String destinationFolder, boolean createFolder) throws FileSystemException {\n-\t\tFile target = toFile(destinationFolder, f.getName());\n+\tpublic Path copyFile(Path f, String destinationFolder, boolean createFolder) throws FileSystemException {\n+\t\tPath target = toFile(destinationFolder, f.getFileName().toString());\n \t\ttry {\n-\t\t\tFileUtils.copyFile(f, target);\n+\t\t\tFiles.copy(f, target);\n \t\t} catch (IOException e) {\n-\t\t\tthrow new FileSystemException(\"cannot copy file [\"+f.getPath()+\"] to [\"+target.getPath()+\"]\",e);\n+\t\t\tthrow new FileSystemException(e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e64d33a9ab267dab39823533653d8ee69e9bb7f3"}, "originalPosition": 245}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ca02863672b10633dcb5ae35a5bad6a6ee7df0f3", "author": {"user": null}, "url": "https://github.com/ibissource/iaf/commit/ca02863672b10633dcb5ae35a5bad6a6ee7df0f3", "committedDate": "2020-11-04T08:55:31Z", "message": "work on PR comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIzNTYyNDQ5", "url": "https://github.com/ibissource/iaf/pull/1227#pullrequestreview-523562449", "createdAt": "2020-11-04T17:04:41Z", "commit": {"oid": "ca02863672b10633dcb5ae35a5bad6a6ee7df0f3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0MTEyMzc4", "url": "https://github.com/ibissource/iaf/pull/1227#pullrequestreview-524112378", "createdAt": "2020-11-05T10:16:38Z", "commit": {"oid": "ca02863672b10633dcb5ae35a5bad6a6ee7df0f3"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0OTIxNjAx", "url": "https://github.com/ibissource/iaf/pull/1227#pullrequestreview-524921601", "createdAt": "2020-11-06T07:53:02Z", "commit": {"oid": "ca02863672b10633dcb5ae35a5bad6a6ee7df0f3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3478b1741ee2429b5225c4629bd4fa18a1547178", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/3478b1741ee2429b5225c4629bd4fa18a1547178", "committedDate": "2020-11-06T07:57:32Z", "message": "Merge branch 'master' into io_to_nio"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1028, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}