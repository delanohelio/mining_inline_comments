{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI0NzY1NTA0", "number": 1282, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QwOTo1MDoyMVrOE8I9EA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QwOTo1NDoxOFrOE8JDQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMxNDk2NzIwOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/nl/nn/adapterframework/filesystem/IMailFileSystem.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QwOTo1MDoyMVrOH4F6qA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QwOTo1MDoyMVrOH4F6qA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODU3OTI0MA==", "bodyText": "Ik zou het fijn vinden als er een regel commentaar bij staat wat het verschil tussen een from en een sender is...", "url": "https://github.com/ibissource/iaf/pull/1282#discussion_r528579240", "createdAt": "2020-11-23T09:50:21Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/filesystem/IMailFileSystem.java", "diffHunk": "@@ -25,25 +25,21 @@\n \tpublic String MAIL_MESSAGE_ID = \"Message-ID\";\n \t\n \tpublic Iterable<String> getToRecipients(M emailMessage) throws FileSystemException ;\n-\n \tpublic Iterable<String> getCCRecipients(M emailMessage) throws FileSystemException;\n-\t\n \tpublic Iterable<String> getBCCRecipients(M emailMessage) throws FileSystemException;\n \t\n \tpublic String getFrom(M emailMessage) throws FileSystemException;\n+\tpublic String getSender(M emailMessage) throws FileSystemException;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d40fcee0a730561554303ec26289c183e79b3439"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMxNDk3MTQ3OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/nl/nn/adapterframework/filesystem/ExchangeFileSystem.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QwOTo1MTozMFrOH4F9Vw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QwOTo1MTozMFrOH4F9Vw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODU3OTkyNw==", "bodyText": "Moet hier geen getValidAddress(...) ?", "url": "https://github.com/ibissource/iaf/pull/1282#discussion_r528579927", "createdAt": "2020-11-23T09:51:30Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/filesystem/ExchangeFileSystem.java", "diffHunk": "@@ -697,6 +697,38 @@ public String getFrom(EmailMessage emailMessage) throws FileSystemException {\n \t\t}\n \t}\n \n+\t@Override\n+\tpublic String getSender(EmailMessage emailMessage) throws FileSystemException {\n+\t\ttry {\n+\t\t\tEmailAddress sender = emailMessage.getSender();\n+\t\t\treturn sender==null ? null : sender.getAddress();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d40fcee0a730561554303ec26289c183e79b3439"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMxNDk3NzAwOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/nl/nn/adapterframework/filesystem/MailFileSystemUtils.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QwOTo1Mjo0OVrOH4GAnA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QwOTo1Mjo0OVrOH4GAnA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODU4MDc2NA==", "bodyText": "Ik denk dat je als type hier beter de RETURN_PATH_HEADER constant kan gebruiken", "url": "https://github.com/ibissource/iaf/pull/1282#discussion_r528580764", "createdAt": "2020-11-23T09:52:49Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/filesystem/MailFileSystemUtils.java", "diffHunk": "@@ -88,4 +101,40 @@\n \t\t}\n \t}\n \t\n+\n+\tpublic static String findBestReplyAddress(String from, String replyTo, String sender, Map<String,Object> headers) {\n+\t\tString result;\n+\t\t\n+\t\tif (null != (result = getValidAddress(\"replyTo\", replyTo))) {\n+\t\t\treturn result; \n+\t\t}\n+\t\tif (null != (result = getValidAddress(\"from\", from))) {\n+\t\t\treturn result; \n+\t\t}\n+\t\tif (null != (result = getValidAddress(\"sender\", sender))) {\n+\t\t\treturn result; \n+\t\t}\n+\t\tObject returnPath = headers.get(RETURN_PATH_HEADER);\n+\t\tif (returnPath instanceof String && null != (result = getValidAddress(\"return path\", (String)returnPath))) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d40fcee0a730561554303ec26289c183e79b3439"}, "originalPosition": 63}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMxNDk4MzA0OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/nl/nn/adapterframework/filesystem/MailFileSystemUtils.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QwOTo1NDoxOFrOH4GEQA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QwOTo1NDoxOFrOH4GEQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODU4MTY5Ng==", "bodyText": "type en address omdraaien? Het is een adres-type niet een type-adres\naddress [xyz] of type [abc] is invalid, vs type [abc] address [xyz] is invalid", "url": "https://github.com/ibissource/iaf/pull/1282#discussion_r528581696", "createdAt": "2020-11-23T09:54:18Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/filesystem/MailFileSystemUtils.java", "diffHunk": "@@ -88,4 +101,40 @@\n \t\t}\n \t}\n \t\n+\n+\tpublic static String findBestReplyAddress(String from, String replyTo, String sender, Map<String,Object> headers) {\n+\t\tString result;\n+\t\t\n+\t\tif (null != (result = getValidAddress(\"replyTo\", replyTo))) {\n+\t\t\treturn result; \n+\t\t}\n+\t\tif (null != (result = getValidAddress(\"from\", from))) {\n+\t\t\treturn result; \n+\t\t}\n+\t\tif (null != (result = getValidAddress(\"sender\", sender))) {\n+\t\t\treturn result; \n+\t\t}\n+\t\tObject returnPath = headers.get(RETURN_PATH_HEADER);\n+\t\tif (returnPath instanceof String && null != (result = getValidAddress(\"return path\", (String)returnPath))) {\n+\t\t\treturn result; \n+\t\t}\n+\t\treturn null;\n+\t}\n+\t\n+\tpublic static String getValidAddress(String type, String address) {\n+\t\ttry {\n+\t\t\tif (StringUtils.isEmpty(address)) {\n+\t\t\t\treturn null;\n+\t\t\t}\n+\t\t\tInternetAddress[] addresses = InternetAddress.parseHeader(address, true);\n+\t\t\tif (addresses.length==0) {\n+\t\t\t\treturn null;\n+\t\t\t} \n+\t\t\treturn InternetAddress.toString(addresses);\n+\t\t} catch (AddressException e) {\n+\t\t\tlog.warn(\"type [\"+type+\"] address [\"+address+\"] is invalid: \"+e.getMessage());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d40fcee0a730561554303ec26289c183e79b3439"}, "originalPosition": 80}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 661, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}