{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA3NDc4MTI3", "number": 1178, "title": "Frank!Doc: Add element type and config child to the model", "bodyText": "", "createdAt": "2020-10-21T11:54:57Z", "url": "https://github.com/ibissource/iaf/pull/1178", "merged": true, "mergeCommit": {"oid": "4ee00934e96e7303cb9d54b737e286a5b9f8c16b"}, "closed": true, "closedAt": "2020-10-28T12:14:33Z", "author": {"login": "mhdirkse"}, "timelineItems": {"totalCount": 58, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdSyEjfAH2gAyNTA3NDc4MTI3OjY1YjMxNWYyZDY0MzUxOTFhNGEwNTFkNmVlNGQ4MjlhMWE5MDI3NGU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdW8hMoAFqTUxODU5NTk2NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "65b315f2d6435191a4a051d6ee4d829a1a90274e", "author": {"user": null}, "url": "https://github.com/ibissource/iaf/commit/65b315f2d6435191a4a051d6ee4d829a1a90274e", "committedDate": "2020-10-15T13:48:06Z", "message": "Work in progress - fixing the IbisDoc tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "40c29efcc360da6d1d7b29a2d4b4efc6e75f8c31", "author": {"user": null}, "url": "https://github.com/ibissource/iaf/commit/40c29efcc360da6d1d7b29a2d4b4efc6e75f8c31", "committedDate": "2020-10-15T17:27:40Z", "message": "Finish fixing the IbisDoc Larva tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f085b18612869c967d79a04b16fd22f0c6d00f51", "author": {"user": null}, "url": "https://github.com/ibissource/iaf/commit/f085b18612869c967d79a04b16fd22f0c6d00f51", "committedDate": "2020-10-16T13:24:35Z", "message": "Undo unwanted changes and add more excludes to avoid Ifsa in docs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2b0022d9721ac3e44e66ad2d011606e88597c4ff", "author": {"user": null}, "url": "https://github.com/ibissource/iaf/commit/2b0022d9721ac3e44e66ad2d011606e88597c4ff", "committedDate": "2020-10-16T13:25:55Z", "message": "Undo changes of .project"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b8550782686dc82d4a3d13264ccb5851e0dc41c2", "author": {"user": null}, "url": "https://github.com/ibissource/iaf/commit/b8550782686dc82d4a3d13264ccb5851e0dc41c2", "committedDate": "2020-10-16T13:29:56Z", "message": "Undo change of test/.project"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "45ee0ad7abee6f7dd5f32b36b8e28f137aa5a59c", "author": {"user": null}, "url": "https://github.com/ibissource/iaf/commit/45ee0ad7abee6f7dd5f32b36b8e28f137aa5a59c", "committedDate": "2020-10-16T13:54:05Z", "message": "Add backwards compatible deprecated setProxyUserName()"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e1218f43e0da85a7a22a0a9f76e53abdc59caec3", "author": {"user": null}, "url": "https://github.com/ibissource/iaf/commit/e1218f43e0da85a7a22a0a9f76e53abdc59caec3", "committedDate": "2020-10-16T15:33:50Z", "message": "Accept FrankDoc results as they are now"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b05ccd9656ad5a6950ac693ca5a484c182aed3b", "author": {"user": null}, "url": "https://github.com/ibissource/iaf/commit/4b05ccd9656ad5a6950ac693ca5a484c182aed3b", "committedDate": "2020-10-19T08:00:06Z", "message": "Follow-up review comments, not yet tested"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e7db6f596837c0e5c99f3efd2d2765267714db37", "author": {"user": null}, "url": "https://github.com/ibissource/iaf/commit/e7db6f596837c0e5c99f3efd2d2765267714db37", "committedDate": "2020-10-19T08:19:04Z", "message": "Forgot a local variable username instead of userName"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cc294b1bd0fad9c8c60d768ee84d93f93107524d", "author": {"user": null}, "url": "https://github.com/ibissource/iaf/commit/cc294b1bd0fad9c8c60d768ee84d93f93107524d", "committedDate": "2020-10-19T08:28:46Z", "message": "Fix expected ibisdoc.xsd"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b37f049c151609e1d9ff14d82ea0975060f0d1f7", "author": {"user": null}, "url": "https://github.com/ibissource/iaf/commit/b37f049c151609e1d9ff14d82ea0975060f0d1f7", "committedDate": "2020-10-20T08:27:12Z", "message": "Follow Niels' review comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "61d07acc47547b04bf2a1721499c9eee4ac119a8", "author": {"user": null}, "url": "https://github.com/ibissource/iaf/commit/61d07acc47547b04bf2a1721499c9eee4ac119a8", "committedDate": "2020-10-20T13:23:43Z", "message": "Add @IbisDoc for config children and then fix IbisDoc tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "69fa631b228dbdaf0e2b94b08baf88530528e290", "author": {"user": null}, "url": "https://github.com/ibissource/iaf/commit/69fa631b228dbdaf0e2b94b08baf88530528e290", "committedDate": "2020-10-20T15:28:55Z", "message": "Create ElementType"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "78220e7ae46c4809d4392882e0c0bbde81594c1d", "author": {"user": null}, "url": "https://github.com/ibissource/iaf/commit/78220e7ae46c4809d4392882e0c0bbde81594c1d", "committedDate": "2020-10-20T17:44:02Z", "message": "Test that elements added to the type and all elements"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9f04a0930c086c4c0078d62fc0436aabe0b68a5f", "author": {"user": null}, "url": "https://github.com/ibissource/iaf/commit/9f04a0930c086c4c0078d62fc0436aabe0b68a5f", "committedDate": "2020-10-20T17:48:56Z", "message": "Clean up"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e3bf8675cc2656ac3d3c3df4fd0bc3b300dd3b15", "author": {"user": null}, "url": "https://github.com/ibissource/iaf/commit/e3bf8675cc2656ac3d3c3df4fd0bc3b300dd3b15", "committedDate": "2020-10-21T08:18:36Z", "message": "ChildConfigDictionary"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d37d40fcd18a59367c755da5d45eabedc6747f2", "author": {"user": null}, "url": "https://github.com/ibissource/iaf/commit/3d37d40fcd18a59367c755da5d45eabedc6747f2", "committedDate": "2020-10-21T11:39:42Z", "message": "Finish config children"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1b9702de09c2504d2e228bbadf0cf89e646b8649", "author": {"user": null}, "url": "https://github.com/ibissource/iaf/commit/1b9702de09c2504d2e228bbadf0cf89e646b8649", "committedDate": "2020-10-21T11:51:44Z", "message": "Merge branch 'master' into fillDataModel3"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f554fb40206ea75785a969b6048929dc661b52c1", "author": {"user": null}, "url": "https://github.com/ibissource/iaf/commit/f554fb40206ea75785a969b6048929dc661b52c1", "committedDate": "2020-10-21T14:20:09Z", "message": "Make FrankElement and ElementType creation recursion-proof\n\nNot covered yet by unit tests, if ever"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "47ea7d3b9165a20002eda39ed8c589a4be6686c1", "author": {"user": null}, "url": "https://github.com/ibissource/iaf/commit/47ea7d3b9165a20002eda39ed8c589a4be6686c1", "committedDate": "2020-10-21T15:19:02Z", "message": "Rename and comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEzNjg1NjEz", "url": "https://github.com/ibissource/iaf/pull/1178#pullrequestreview-513685613", "createdAt": "2020-10-21T13:33:23Z", "commit": {"oid": "1b9702de09c2504d2e228bbadf0cf89e646b8649"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQxMzozMzoyM1rOHlsZHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQxNToxOToxN1rOHlyBDA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTI4NjY4Ng==", "bodyText": "Ik wil graag de volgende volgorde voorstellen:\n10 InputValidator\n20 OutputValidator\n30 InputWrapper\n40 OutputWrapper\n50 Exit\n60 Locker\n70 Cache\n80 Pipe", "url": "https://github.com/ibissource/iaf/pull/1178#discussion_r509286686", "createdAt": "2020-10-21T13:33:23Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/core/PipeLine.java", "diffHunk": "@@ -161,6 +161,7 @@\n \t * to prevail.\n \t * @see AbstractPipe\n \t **/\n+\t@IbisDoc(\"60\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b9702de09c2504d2e228bbadf0cf89e646b8649"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTI5NTUzMg==", "bodyText": "Voor Receiver:\n10 listener\n20 sender\n30 errorSender\n40 messageLog\n50 errorStorage", "url": "https://github.com/ibissource/iaf/pull/1178#discussion_r509295532", "createdAt": "2020-10-21T13:44:38Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/receivers/ReceiverBase.java", "diffHunk": "@@ -1724,6 +1724,7 @@ public ISender getSender() {\n \t\treturn sender;\n \t}\n \t\n+\t@IbisDoc(\"60\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b9702de09c2504d2e228bbadf0cf89e646b8649"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTM0NzEzNw==", "bodyText": "Je moet niet zomaar RuntimeExceptions gooien, maar altijd checked exceptions.\nOok moet je niet het path als parameter meegeven, alleen maar om in de foutmelding te kunnen gebruiken.\nAls je hier een SaxParseException gooit, dan kan je op regel 94 daar het pad aan toevoegen, en hoef je het hier niet te hebben.", "url": "https://github.com/ibissource/iaf/pull/1178#discussion_r509347137", "createdAt": "2020-10-21T14:40:59Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/doc/model/ConfigChildDictionary.java", "diffHunk": "@@ -0,0 +1,122 @@\n+package nl.nn.adapterframework.doc.model;\n+\n+import java.io.IOException;\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.StringTokenizer;\n+\n+import org.apache.commons.lang3.StringUtils;\n+import org.apache.logging.log4j.Logger;\n+import org.xml.sax.SAXException;\n+\n+import lombok.Getter;\n+import nl.nn.adapterframework.configuration.digester.DigesterRule;\n+import nl.nn.adapterframework.configuration.digester.DigesterRulesHandler;\n+import nl.nn.adapterframework.core.Resource;\n+import nl.nn.adapterframework.util.LogUtil;\n+import nl.nn.adapterframework.util.XmlUtils;\n+\n+class ConfigChildDictionary {\n+\tprivate static Logger log = LogUtil.getLogger(ConfigChildDictionary.class);\n+\n+\tpublic static final ConfigChildDictionary EMPTY = new ConfigChildDictionary();\n+\n+\tclass Item {\n+\t\tprivate @Getter String methodName;\n+\t\tprivate @Getter boolean mandatory;\n+\t\tprivate @Getter boolean allowMultiple;\n+\t\tprivate @Getter String syntax1Name;\n+\t\tprivate @Getter Integer defaultOrder;\n+\n+\t\tItem(String methodName, String syntax1Name, String path) {\n+\t\t\tthis.methodName = methodName;\n+\t\t\tthis.syntax1Name = syntax1Name;\n+\t\t\tmandatory = false;\n+\t\t\tif(methodName.startsWith(\"set\")) {\n+\t\t\t\tallowMultiple = false;\n+\t\t\t} else if((methodName.startsWith(\"add\")) || methodName.startsWith(\"register\")) {\n+\t\t\t\tallowMultiple = true;\n+\t\t\t} else {\n+\t\t\t\tthrow new RuntimeException(String.format(\n+\t\t\t\t\t\t\"Do not know how many elements go in method [%s], digester rules from [%s]\", methodName, path));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f554fb40206ea75785a969b6048929dc661b52c1"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTM1Mjg5MA==", "bodyText": "Is het nodig om hier ConfigChildDictionary.Item te introduceren? Kan je niet meteen een ConfigChild maken/gebruiken?", "url": "https://github.com/ibissource/iaf/pull/1178#discussion_r509352890", "createdAt": "2020-10-21T14:47:37Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/doc/model/ConfigChildDictionary.java", "diffHunk": "@@ -0,0 +1,122 @@\n+package nl.nn.adapterframework.doc.model;\n+\n+import java.io.IOException;\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.StringTokenizer;\n+\n+import org.apache.commons.lang3.StringUtils;\n+import org.apache.logging.log4j.Logger;\n+import org.xml.sax.SAXException;\n+\n+import lombok.Getter;\n+import nl.nn.adapterframework.configuration.digester.DigesterRule;\n+import nl.nn.adapterframework.configuration.digester.DigesterRulesHandler;\n+import nl.nn.adapterframework.core.Resource;\n+import nl.nn.adapterframework.util.LogUtil;\n+import nl.nn.adapterframework.util.XmlUtils;\n+\n+class ConfigChildDictionary {\n+\tprivate static Logger log = LogUtil.getLogger(ConfigChildDictionary.class);\n+\n+\tpublic static final ConfigChildDictionary EMPTY = new ConfigChildDictionary();\n+\n+\tclass Item {\n+\t\tprivate @Getter String methodName;\n+\t\tprivate @Getter boolean mandatory;\n+\t\tprivate @Getter boolean allowMultiple;\n+\t\tprivate @Getter String syntax1Name;\n+\t\tprivate @Getter Integer defaultOrder;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f554fb40206ea75785a969b6048929dc661b52c1"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTM3NzM4NQ==", "bodyText": "Deze verandering hoeft niet. ClassLoaderManager is bij de imports opgenomen.", "url": "https://github.com/ibissource/iaf/pull/1178#discussion_r509377385", "createdAt": "2020-10-21T15:17:29Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/pipes/AbstractPipe.java", "diffHunk": "@@ -403,7 +403,7 @@ public IAdapter getAdapter() {\n \n \t/**\n \t * This ClassLoader is set upon creation of the pipe, used to retrieve resources configured by the Ibis application.\n-\t * @return returns the ClassLoader created by the {@link ClassLoaderManager ClassLoaderManager}.\n+\t * @return returns the ClassLoader created by the {@link nl.nn.adapterframework.configuration.ClassLoaderManager ClassLoaderManager}.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f554fb40206ea75785a969b6048929dc661b52c1"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTM3ODgyOA==", "bodyText": "Dit lijkt me te kort door de bocht. Je kan de documenatie-tekst hier gebruiken om het subelement te documenteren.", "url": "https://github.com/ibissource/iaf/pull/1178#discussion_r509378828", "createdAt": "2020-10-21T15:19:17Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/doc/InfoBuilder.java", "diffHunk": "@@ -231,6 +231,9 @@ private void enrichPropertyOfIbisBean(BeanProperty beanProperty, IbisBean ibisBe\n \t}\n \n \tprivate static FromAnnotations parseIbisDocAndIbisDocRef(Method method, boolean isJson) {\n+\t\tif(!InfoBuilderSource.isGetterOrSetter(method)) {\n+\t\t\treturn null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f554fb40206ea75785a969b6048929dc661b52c1"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8a35e40eb86ea300e5708ba39a38f9af2600347a", "author": {"user": null}, "url": "https://github.com/ibissource/iaf/commit/8a35e40eb86ea300e5708ba39a38f9af2600347a", "committedDate": "2020-10-21T15:46:48Z", "message": "Change sort order config childrein of pipeline"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f24ad7d7bffa60d6510ca49b36b6d293cb85bed6", "author": {"user": null}, "url": "https://github.com/ibissource/iaf/commit/f24ad7d7bffa60d6510ca49b36b6d293cb85bed6", "committedDate": "2020-10-21T16:03:57Z", "message": "Change config children order ReceiverBase"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a0a96e75342ed79b634bccad8ef368937eb4572d", "author": {"user": null}, "url": "https://github.com/ibissource/iaf/commit/a0a96e75342ed79b634bccad8ef368937eb4572d", "committedDate": "2020-10-21T16:27:50Z", "message": "In JavaDoc comment ClassLoaderManager zonder pad"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "111ceaf5aac7430de3e3124fa6a9983364e3c5e3", "author": {"user": null}, "url": "https://github.com/ibissource/iaf/commit/111ceaf5aac7430de3e3124fa6a9983364e3c5e3", "committedDate": "2020-10-21T17:06:45Z", "message": "Rename ModelBuilderTest to UtilsTest and improve coverage"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE0NDcwMjY0", "url": "https://github.com/ibissource/iaf/pull/1178#pullrequestreview-514470264", "createdAt": "2020-10-22T08:16:48Z", "commit": {"oid": "111ceaf5aac7430de3e3124fa6a9983364e3c5e3"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQwODoxNjo0OFrOHmV7YA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQwODoyMTo0NlrOHmWIjQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTk2NzIwMA==", "bodyText": "Ik stel voor dat je deze class 'ConfigChildSetter' noemt, en dat je er niet een inner class van maakt, maar een gewone.\nConfigChildDictionary is vervolgens (volgens mij) alleen maar een Map<String,ConfigChildSetter>, waarbij de string de methodname is. Hij kan dat zijn (extenden), hij hoeft niet zo'n map te hebben.", "url": "https://github.com/ibissource/iaf/pull/1178#discussion_r509967200", "createdAt": "2020-10-22T08:16:48Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/doc/model/ConfigChildDictionary.java", "diffHunk": "@@ -0,0 +1,122 @@\n+package nl.nn.adapterframework.doc.model;\n+\n+import java.io.IOException;\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.StringTokenizer;\n+\n+import org.apache.commons.lang3.StringUtils;\n+import org.apache.logging.log4j.Logger;\n+import org.xml.sax.SAXException;\n+\n+import lombok.Getter;\n+import nl.nn.adapterframework.configuration.digester.DigesterRule;\n+import nl.nn.adapterframework.configuration.digester.DigesterRulesHandler;\n+import nl.nn.adapterframework.core.Resource;\n+import nl.nn.adapterframework.util.LogUtil;\n+import nl.nn.adapterframework.util.XmlUtils;\n+\n+class ConfigChildDictionary {\n+\tprivate static Logger log = LogUtil.getLogger(ConfigChildDictionary.class);\n+\n+\tpublic static final ConfigChildDictionary EMPTY = new ConfigChildDictionary();\n+\n+\tclass Item {\n+\t\tprivate @Getter String methodName;\n+\t\tprivate @Getter boolean mandatory;\n+\t\tprivate @Getter boolean allowMultiple;\n+\t\tprivate @Getter String syntax1Name;\n+\t\tprivate @Getter Integer defaultOrder;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTM1Mjg5MA=="}, "originalCommit": {"oid": "f554fb40206ea75785a969b6048929dc661b52c1"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTk3MDU3Mw==", "bodyText": "Ik stel voor dat ConfigChildDictionary een veld wordt van FrankDocModel, dat je meegeeft bij het aanroepen van de constructor, zodat je zeker weet dat er er voordat je het model gaat maken.\nJe moet het niet steeds doorgeven als parameter, want hij verandert nooit.", "url": "https://github.com/ibissource/iaf/pull/1178#discussion_r509970573", "createdAt": "2020-10-22T08:21:46Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/doc/model/FrankDocModel.java", "diffHunk": "@@ -17,33 +17,64 @@\n import lombok.Setter;\n import nl.nn.adapterframework.doc.IbisDoc;\n import nl.nn.adapterframework.doc.IbisDocRef;\n+import nl.nn.adapterframework.doc.Utils;\n import nl.nn.adapterframework.util.LogUtil;\n \n public class FrankDocModel {\n-\tprivate static final String JAVA_STRING = \"java.lang.String\";\n-\n \tprivate static Logger log = LogUtil.getLogger(FrankDocModel.class);\n \n \tprivate @Getter List<FrankDocGroup> groups;\n \tprivate @Getter Map<String, FrankElement> allElements = new HashMap<>();\n+\tprivate @Getter Map<String, ElementType> allTypes = new HashMap<>();\n \n \tpublic FrankDocModel() {\n \t\tgroups = new ArrayList<>();\n \t}\n \n-\tpublic FrankElement findOrCreateFrankElement(Class<?> clazz) {\n+\tpublic ElementType findOrCreateElementType(Class<?> clazz, ConfigChildDictionary dictionary) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "111ceaf5aac7430de3e3124fa6a9983364e3c5e3"}, "originalPosition": 21}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "82040e8ca668807c2df5964c1da65e8ec254101c", "author": {"user": null}, "url": "https://github.com/ibissource/iaf/commit/82040e8ca668807c2df5964c1da65e8ec254101c", "committedDate": "2020-10-22T08:52:42Z", "message": "Constructor of Item should not throw RuntimeException"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE0OTIwNTg4", "url": "https://github.com/ibissource/iaf/pull/1178#pullrequestreview-514920588", "createdAt": "2020-10-22T16:38:41Z", "commit": {"oid": "82040e8ca668807c2df5964c1da65e8ec254101c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxNjozODo0MVrOHmqjJA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxNjozODo0MVrOHmqjJA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDMwNTA2MA==", "bodyText": "t.a.v. Item / ConfigChildSetter:\nIk begrijp je punt dat wat ik een ConfigChildSetter wil noemen niet een setter van ConfigChilds is. Maar het beschrijft wel methods die ConfigChildSetters zijn. Dus nieuw voorstel: ConfigChildSetterDescriptor.\nDit kan ook een publieke class in een eigen file zijn, in plaats van een inner class\nt.a.v. structuur ConfigChildDictionary:\nIk vind eigenlijk niet dat die setMethodNameOrder() zo belangrijk is dat hij de structuur van de class moet bepalen. Ik denk eigenlijk ook dat we die defaultOrders niet gaan gebruiken. Het is net zo makkelijk en overzichtelijk om bij de bewuste methods een IbisDoc annotatie te zetten, om de volgorde aan te geven, maar uiteindelijk ook om het subelement te documenteren.\nIk denk dus dat\n\nwe het veld defaultOrder uit Item / ConfigChildSetterDescriptor weg moeten halen;\nde method setMethodNameOrder() uit ConfigChildDictionary weg moeten halen;\nEn dan blijft er over dat ConfigChildDictionary een Map van Items / ConfigChildSetterDescriptors is.", "url": "https://github.com/ibissource/iaf/pull/1178#discussion_r510305060", "createdAt": "2020-10-22T16:38:41Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/doc/model/ConfigChildDictionary.java", "diffHunk": "@@ -0,0 +1,122 @@\n+package nl.nn.adapterframework.doc.model;\n+\n+import java.io.IOException;\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.StringTokenizer;\n+\n+import org.apache.commons.lang3.StringUtils;\n+import org.apache.logging.log4j.Logger;\n+import org.xml.sax.SAXException;\n+\n+import lombok.Getter;\n+import nl.nn.adapterframework.configuration.digester.DigesterRule;\n+import nl.nn.adapterframework.configuration.digester.DigesterRulesHandler;\n+import nl.nn.adapterframework.core.Resource;\n+import nl.nn.adapterframework.util.LogUtil;\n+import nl.nn.adapterframework.util.XmlUtils;\n+\n+class ConfigChildDictionary {\n+\tprivate static Logger log = LogUtil.getLogger(ConfigChildDictionary.class);\n+\n+\tpublic static final ConfigChildDictionary EMPTY = new ConfigChildDictionary();\n+\n+\tclass Item {\n+\t\tprivate @Getter String methodName;\n+\t\tprivate @Getter boolean mandatory;\n+\t\tprivate @Getter boolean allowMultiple;\n+\t\tprivate @Getter String syntax1Name;\n+\t\tprivate @Getter Integer defaultOrder;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTM1Mjg5MA=="}, "originalCommit": {"oid": "f554fb40206ea75785a969b6048929dc661b52c1"}, "originalPosition": 29}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "939ecf3dda1109fe63d57ea5f5f369fc3ca25118", "author": {"user": null}, "url": "https://github.com/ibissource/iaf/commit/939ecf3dda1109fe63d57ea5f5f369fc3ca25118", "committedDate": "2020-10-23T09:49:26Z", "message": "Reorganize to have ConfigChildSetterDescriptor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bbd714124c28c1b5d672a85d766b081874b13cde", "author": {"user": null}, "url": "https://github.com/ibissource/iaf/commit/bbd714124c28c1b5d672a85d766b081874b13cde", "committedDate": "2020-10-23T09:56:44Z", "message": "Styling"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d44856a89488de45ba37b90c976c4c6a9667a0eb", "author": {"user": null}, "url": "https://github.com/ibissource/iaf/commit/d44856a89488de45ba37b90c976c4c6a9667a0eb", "committedDate": "2020-10-23T09:58:48Z", "message": "Styling"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9fdb9e75e1c34eac8544409150a0b05dd12b2596", "author": {"user": null}, "url": "https://github.com/ibissource/iaf/commit/9fdb9e75e1c34eac8544409150a0b05dd12b2596", "committedDate": "2020-10-23T10:01:49Z", "message": "Styling"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "879ecf8d995f2253124cf28c5b2a715bcc46b0d6", "author": {"user": null}, "url": "https://github.com/ibissource/iaf/commit/879ecf8d995f2253124cf28c5b2a715bcc46b0d6", "committedDate": "2020-10-23T10:07:13Z", "message": "Clean up and styling"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "09b4df8274ce90789cd8bb039a145879b6cc39b1", "author": {"user": null}, "url": "https://github.com/ibissource/iaf/commit/09b4df8274ce90789cd8bb039a145879b6cc39b1", "committedDate": "2020-10-23T10:18:49Z", "message": "Make digester-rules.xml method names unique"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "226be78dda946daf37efe36b2994c49d1fc89206", "author": {"user": null}, "url": "https://github.com/ibissource/iaf/commit/226be78dda946daf37efe36b2994c49d1fc89206", "committedDate": "2020-10-23T11:58:37Z", "message": "Fix unit tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3fb47d48f30e60c052aa732b3b5d98a4b262b6bd", "author": {"user": null}, "url": "https://github.com/ibissource/iaf/commit/3fb47d48f30e60c052aa732b3b5d98a4b262b6bd", "committedDate": "2020-10-23T12:14:53Z", "message": "Test that @IbisDoc of derived has precedence"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE1NjQ2ODc0", "url": "https://github.com/ibissource/iaf/pull/1178#pullrequestreview-515646874", "createdAt": "2020-10-23T13:05:27Z", "commit": {"oid": "3fb47d48f30e60c052aa732b3b5d98a4b262b6bd"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QxMzowNToyN1rOHnM_-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QxMzozMjowN1rOHnN_bA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDg2OTQ5OQ==", "bodyText": "Ik denk dat je deze javadoc het beste kan beginnen met wat het is, bijvoorbeeld:\nThis class describes a method that a child element can call to register itself at its parent.\nIf such a method exists for a class, that class can have ConfigChildren of the type of the parameter of the method.", "url": "https://github.com/ibissource/iaf/pull/1178#discussion_r510869499", "createdAt": "2020-10-23T13:05:27Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/doc/model/ConfigChildSetterDescriptor.java", "diffHunk": "@@ -0,0 +1,35 @@\n+package nl.nn.adapterframework.doc.model;\n+\n+import org.xml.sax.SAXException;\n+\n+import lombok.Getter;\n+\n+/**\n+ * This class is similar to {@link ConfigChild}, but it is not the same. As an example,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3fb47d48f30e60c052aa732b3b5d98a4b262b6bd"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDg3MjkzMg==", "bodyText": "Met 'this can happen' bedoel je denk ik: dat dit FrankElement al aangemaakt is als gevolg van het aanmaken van de parent class. Als dat zo is, dan moet je dat concreter zeggen.", "url": "https://github.com/ibissource/iaf/pull/1178#discussion_r510872932", "createdAt": "2020-10-23T13:11:17Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/doc/model/FrankDocModel.java", "diffHunk": "@@ -1,46 +1,136 @@\n package nl.nn.adapterframework.doc.model;\n \n+import java.io.IOException;\n import java.lang.reflect.Method;\n import java.util.ArrayList;\n import java.util.Arrays;\n import java.util.HashMap;\n import java.util.LinkedHashMap;\n import java.util.List;\n import java.util.Map;\n+import java.util.StringTokenizer;\n import java.util.Map.Entry;\n import java.util.stream.Collectors;\n \n+import org.apache.commons.lang3.StringUtils;\n import org.apache.logging.log4j.Logger;\n import org.springframework.core.annotation.AnnotationUtils;\n+import org.xml.sax.SAXException;\n \n import lombok.Getter;\n import lombok.Setter;\n+import nl.nn.adapterframework.configuration.digester.DigesterRule;\n+import nl.nn.adapterframework.configuration.digester.DigesterRulesHandler;\n+import nl.nn.adapterframework.core.Resource;\n import nl.nn.adapterframework.doc.IbisDoc;\n import nl.nn.adapterframework.doc.IbisDocRef;\n+import nl.nn.adapterframework.doc.Utils;\n import nl.nn.adapterframework.util.LogUtil;\n+import nl.nn.adapterframework.util.XmlUtils;\n \n public class FrankDocModel {\n-\tprivate static final String JAVA_STRING = \"java.lang.String\";\n-\n \tprivate static Logger log = LogUtil.getLogger(FrankDocModel.class);\n \n+\tprivate @Getter Map<String, ConfigChildSetterDescriptor> configChildDescriptors;\n \tprivate @Getter List<FrankDocGroup> groups;\n \tprivate @Getter Map<String, FrankElement> allElements = new HashMap<>();\n+\tprivate @Getter Map<String, ElementType> allTypes = new HashMap<>();\n \n \tpublic FrankDocModel() {\n+\t\tconfigChildDescriptors = new HashMap<>();\n \t\tgroups = new ArrayList<>();\n \t}\n \n+\tpublic void createConfigChildDescriptorsFrom(String path) {\n+\t\tResource resource = Resource.getResource(path);\n+\t\tif(resource == null) {\n+\t\t\tthrow new RuntimeException(String.format(\"Cannot find resource on the classpath: [%s]\", path));\n+\t\t}\n+\t\ttry {\n+\t\t\tXmlUtils.parseXml(resource.asInputSource(), new Handler(path));\n+\t\t}\n+\t\tcatch(IOException e) {\n+\t\t\tthrow new RuntimeException(String.format(\"An IOException occurred while parsing XML from [%s]\", path), e);\n+\t\t}\n+\t\tcatch(SAXException e) {\n+\t\t\tthrow new RuntimeException(String.format(\"A SAXException occurred while parsing XML from [%s]\", path), e);\n+\t\t}\n+\t}\n+\n+\tprivate class Handler extends DigesterRulesHandler {\n+\t\tprivate final String path;\n+\n+\t\tHandler(String path) {\n+\t\t\tthis.path = path;\n+\t\t}\n+\n+\t\t@Override\n+\t\tprotected void handle(DigesterRule rule) throws SAXException {\n+\t\t\tString pattern = rule.getPattern();\n+\t\t\tStringTokenizer tokenizer = new StringTokenizer(pattern, \"/\");\n+\t\t\tString syntax1Name = null;\n+\t\t\twhile(tokenizer.hasMoreElements()) {\n+\t\t\t\tString token = tokenizer.nextToken();\n+\t\t\t\tif(!\"*\".equals(token)) {\n+\t\t\t\t\tsyntax1Name = token;\n+\t\t\t\t}\n+\t\t\t}\n+\t\t\tif(StringUtils.isNotEmpty(rule.getRegisterMethod())) {\n+\t\t\t\tadd(rule.getRegisterMethod(), syntax1Name);\n+\t\t\t}\t\t\t\n+\t\t}\n+\n+\t\tprivate void add(String registerMethod, String syntax1Name) throws SAXException {\n+\t\t\tConfigChildSetterDescriptor item = new ConfigChildSetterDescriptor(registerMethod, syntax1Name);\n+\t\t\tif(configChildDescriptors.containsKey(item.getMethodName())) {\n+\t\t\t\tlog.warn(String.format(\"In digester rules [%s], duplicate method name [%s]\", path, registerMethod));\n+\t\t\t} else {\n+\t\t\t\tconfigChildDescriptors.put(item.getMethodName(), item);\n+\t\t\t}\n+\t\t}\n+\t}\n+\n+\tpublic ElementType findOrCreateElementType(Class<?> clazz) {\n+\t\tif(allTypes.containsKey(clazz.getName())) {\n+\t\t\treturn allTypes.get(clazz.getName());\n+\t\t}\n+\t\tfinal ElementType result = new ElementType(clazz);\n+\t\t// If a containing FrankElement contains the type being created, we do not\n+\t\t// want recursion.\n+\t\tallTypes.put(result.getFullName(), result);\n+\t\tif(clazz.isInterface()) {\n+\t\t\tUtils.getSpringBeans(clazz.getName()).stream()\n+\t\t\t\t\t.map(b -> b.getClazz())\n+\t\t\t\t\t.map(cl -> findOrCreateFrankElement(cl))\n+\t\t\t\t\t.forEach(result::addMember);\n+\t\t} else {\n+\t\t\tresult.addMember(findOrCreateFrankElement(clazz));\n+\t\t}\n+\t\treturn result;\n+\t}\n+\n+\tpublic boolean hasType(String typeName) {\n+\t\treturn allTypes.containsKey(typeName);\n+\t}\n+\n \tpublic FrankElement findOrCreateFrankElement(Class<?> clazz) {\n \t\tif(allElements.containsKey(clazz.getName())) {\n \t\t\treturn allElements.get(clazz.getName());\n \t\t}\n \t\tClass<?> superClass = clazz.getSuperclass();\n \t\tFrankElement parent = superClass == null ? null : findOrCreateFrankElement(superClass);\n-\t\tFrankElement current = new FrankElement(clazz, parent);\n-\t\tcurrent.setAttributes(createAttributes(clazz.getDeclaredMethods(), current));\n-\t\tallElements.put(current.getFullName(), current);\n-\t\treturn current;\n+\t\tif(allElements.containsKey(clazz.getName())) {\n+\t\t\t// This can happen when element C inherits from element P, while P can have\n+\t\t\t// C as a configuration child.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3fb47d48f30e60c052aa732b3b5d98a4b262b6bd"}, "originalPosition": 130}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDg3NjM0MA==", "bodyText": "Kan createConfigChildren() (en ook createAttributes()) niet een method van FrankElement zijn?", "url": "https://github.com/ibissource/iaf/pull/1178#discussion_r510876340", "createdAt": "2020-10-23T13:17:00Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/doc/model/FrankDocModel.java", "diffHunk": "@@ -201,9 +277,43 @@ private static Method getParentMethod(String className, String methodName) {\n \t\t}\n \t}\n \n-\tpublic FrankDocGroup addGroup(String name) {\n-\t\tFrankDocGroup group = new FrankDocGroup(name);\n-\t\tgroups.add(group);\n-\t\treturn group;\n+\tprivate List<ConfigChild> createConfigChildren(\tMethod[] methods, FrankElement parent) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3fb47d48f30e60c052aa732b3b5d98a4b262b6bd"}, "originalPosition": 181}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDg3NzkwMw==", "bodyText": "Deze parseIbisDocAnnotation() is er alleen voor ConfigChildren. Kan hij dan niet daar een method van zijn?", "url": "https://github.com/ibissource/iaf/pull/1178#discussion_r510877903", "createdAt": "2020-10-23T13:19:33Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/doc/model/FrankDocModel.java", "diffHunk": "@@ -201,9 +277,43 @@ private static Method getParentMethod(String className, String methodName) {\n \t\t}\n \t}\n \n-\tpublic FrankDocGroup addGroup(String name) {\n-\t\tFrankDocGroup group = new FrankDocGroup(name);\n-\t\tgroups.add(group);\n-\t\treturn group;\n+\tprivate List<ConfigChild> createConfigChildren(\tMethod[] methods, FrankElement parent) {\n+\t\tList<Method> configChildSetters = Arrays.asList(methods).stream()\n+\t\t\t\t.filter(Utils::isConfigChildSetter)\n+\t\t\t\t.filter(m -> configChildDescriptors.get(m.getName()) != null)\n+\t\t\t\t.collect(Collectors.toList());\n+\t\tList<ConfigChild> result = new ArrayList<>();\n+\t\tfor(Method m: configChildSetters) {\n+\t\t\tConfigChild configChild = new ConfigChild(parent);\n+\t\t\tConfigChildSetterDescriptor configChildDescriptor = configChildDescriptors.get(m.getName());\n+\t\t\tIbisDoc ibisDoc = AnnotationUtils.findAnnotation(m, IbisDoc.class);\n+\t\t\tInteger optionalOrder = parseIbisDocAnnotation(ibisDoc);\n+\t\t\tif(optionalOrder != null) {\n+\t\t\t\tconfigChild.setSequenceInConfig(optionalOrder);\n+\t\t\t} else {\n+\t\t\t\tlog.warn(String.format(\"No config child order for method [%s] of Frank element [%s]\",\n+\t\t\t\t\t\tm.getName(), parent.getSimpleName()));\n+\t\t\t\tconfigChild.setSequenceInConfig(Integer.MAX_VALUE);\n+\t\t\t}\n+\t\t\tClass<?> elementClass = m.getParameterTypes()[0];\n+\t\t\tconfigChild.setElementType(findOrCreateElementType(elementClass));\n+\t\t\tconfigChild.setAllowMultiple(configChildDescriptor.isAllowMultiple());\n+\t\t\tconfigChild.setMandatory(configChildDescriptor.isMandatory());\n+\t\t\tconfigChild.setSyntax1Name(configChildDescriptor.getSyntax1Name());\n+\t\t\tresult.add(configChild);\n+\t\t}\n+\t\treturn result;\n+\t}\n+\n+\tprivate static Integer parseIbisDocAnnotation(IbisDoc ibisDoc) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3fb47d48f30e60c052aa732b3b5d98a4b262b6bd"}, "originalPosition": 209}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDg4MjEwMw==", "bodyText": "Kunnen deze niet het beste ook naar Utils verhuizen?", "url": "https://github.com/ibissource/iaf/pull/1178#discussion_r510882103", "createdAt": "2020-10-23T13:26:15Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/doc/InfoBuilderSource.java", "diffHunk": "@@ -386,4 +397,25 @@ private static void getBeanProperties(Class<?> clazz, String verb, Map<String, M\n \t\t}\n \t}\n \n+\tpublic static boolean isGetterOrSetter(Method method) {\n+\t\tboolean isSetter = method.getReturnType().isPrimitive()\n+\t\t\t\t&& method.getReturnType().getName().equals(\"void\")\n+\t\t\t\t&& (method.getParameterTypes().length == 1)\n+\t\t\t\t&& (method.getParameterTypes()[0].isPrimitive()\n+\t\t\t\t\t\t|| JAVA_BOXED.contains(method.getParameterTypes()[0].getName()));\n+\t\tboolean isGetter = (\n+\t\t\t\t\t(method.getReturnType().isPrimitive()\n+\t\t\t\t\t\t\t&& !method.getReturnType().getName().equals(\"void\"))\n+\t\t\t\t\t|| JAVA_BOXED.contains(method.getReturnType().getName())\n+\t\t\t\t) && (method.getParameterTypes().length == 0);\n+\t\treturn isSetter || isGetter;\n+\t}\n+\n+\tpublic static boolean isConfigChildSetter(Method method) {\n+\t\treturn (method.getParameterTypes().length == 1)\n+\t\t\t\t&& (! method.getParameterTypes()[0].isPrimitive())\n+\t\t\t\t&& (! JAVA_BOXED.contains(method.getParameterTypes()[0].getName()))\n+\t\t\t\t&& (method.getReturnType().isPrimitive())\n+\t\t\t\t&& (method.getReturnType().getName().equals(\"void\"));\n+\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3fb47d48f30e60c052aa732b3b5d98a4b262b6bd"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDg4NTc0MA==", "bodyText": "Het lijkt me goed als je ook nog een  method maakt zoals 'populateModel()', die het model vult in de volgorde waarin dat hoort. Als ik het goed heb is dat:\n\nconfigChildDescriptors bepalen uit digesterRules\nelementTypes creeren uit configChildDescriptors\nSpringBeans ophalen voor alle elementTypes\nFrankElements en Attributes creeren uit SpringBeans", "url": "https://github.com/ibissource/iaf/pull/1178#discussion_r510885740", "createdAt": "2020-10-23T13:32:07Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/doc/model/FrankDocModel.java", "diffHunk": "@@ -1,46 +1,136 @@\n package nl.nn.adapterframework.doc.model;\n \n+import java.io.IOException;\n import java.lang.reflect.Method;\n import java.util.ArrayList;\n import java.util.Arrays;\n import java.util.HashMap;\n import java.util.LinkedHashMap;\n import java.util.List;\n import java.util.Map;\n+import java.util.StringTokenizer;\n import java.util.Map.Entry;\n import java.util.stream.Collectors;\n \n+import org.apache.commons.lang3.StringUtils;\n import org.apache.logging.log4j.Logger;\n import org.springframework.core.annotation.AnnotationUtils;\n+import org.xml.sax.SAXException;\n \n import lombok.Getter;\n import lombok.Setter;\n+import nl.nn.adapterframework.configuration.digester.DigesterRule;\n+import nl.nn.adapterframework.configuration.digester.DigesterRulesHandler;\n+import nl.nn.adapterframework.core.Resource;\n import nl.nn.adapterframework.doc.IbisDoc;\n import nl.nn.adapterframework.doc.IbisDocRef;\n+import nl.nn.adapterframework.doc.Utils;\n import nl.nn.adapterframework.util.LogUtil;\n+import nl.nn.adapterframework.util.XmlUtils;\n \n public class FrankDocModel {\n-\tprivate static final String JAVA_STRING = \"java.lang.String\";\n-\n \tprivate static Logger log = LogUtil.getLogger(FrankDocModel.class);\n \n+\tprivate @Getter Map<String, ConfigChildSetterDescriptor> configChildDescriptors;\n \tprivate @Getter List<FrankDocGroup> groups;\n \tprivate @Getter Map<String, FrankElement> allElements = new HashMap<>();\n+\tprivate @Getter Map<String, ElementType> allTypes = new HashMap<>();\n \n \tpublic FrankDocModel() {\n+\t\tconfigChildDescriptors = new HashMap<>();\n \t\tgroups = new ArrayList<>();\n \t}\n ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3fb47d48f30e60c052aa732b3b5d98a4b262b6bd"}, "originalPosition": 45}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2NDk1ODU4", "url": "https://github.com/ibissource/iaf/pull/1178#pullrequestreview-516495858", "createdAt": "2020-10-26T06:35:14Z", "commit": {"oid": "3fb47d48f30e60c052aa732b3b5d98a4b262b6bd"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQwNjozNToxNVrOHoCS4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQwNjozNToxNVrOHoCS4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTc0MjY4OQ==", "bodyText": "Ook over deze if():\nAls je problemen met circular references wil voorkomen (bijvoorbeeld door een IbisDocRef van een class naar een child), dan moet je niet deze if doen, maar het element al aanmaken en in de lijst opnemen v\u00f3\u00f3r dat je findOrCreateFrankElement(superClass) aanroept.\nDe if() die je nu hebt gaat je er niet bij helpen, die komt te laat. Ik denk dus dat hij weg kan.", "url": "https://github.com/ibissource/iaf/pull/1178#discussion_r511742689", "createdAt": "2020-10-26T06:35:15Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/doc/model/FrankDocModel.java", "diffHunk": "@@ -1,46 +1,136 @@\n package nl.nn.adapterframework.doc.model;\n \n+import java.io.IOException;\n import java.lang.reflect.Method;\n import java.util.ArrayList;\n import java.util.Arrays;\n import java.util.HashMap;\n import java.util.LinkedHashMap;\n import java.util.List;\n import java.util.Map;\n+import java.util.StringTokenizer;\n import java.util.Map.Entry;\n import java.util.stream.Collectors;\n \n+import org.apache.commons.lang3.StringUtils;\n import org.apache.logging.log4j.Logger;\n import org.springframework.core.annotation.AnnotationUtils;\n+import org.xml.sax.SAXException;\n \n import lombok.Getter;\n import lombok.Setter;\n+import nl.nn.adapterframework.configuration.digester.DigesterRule;\n+import nl.nn.adapterframework.configuration.digester.DigesterRulesHandler;\n+import nl.nn.adapterframework.core.Resource;\n import nl.nn.adapterframework.doc.IbisDoc;\n import nl.nn.adapterframework.doc.IbisDocRef;\n+import nl.nn.adapterframework.doc.Utils;\n import nl.nn.adapterframework.util.LogUtil;\n+import nl.nn.adapterframework.util.XmlUtils;\n \n public class FrankDocModel {\n-\tprivate static final String JAVA_STRING = \"java.lang.String\";\n-\n \tprivate static Logger log = LogUtil.getLogger(FrankDocModel.class);\n \n+\tprivate @Getter Map<String, ConfigChildSetterDescriptor> configChildDescriptors;\n \tprivate @Getter List<FrankDocGroup> groups;\n \tprivate @Getter Map<String, FrankElement> allElements = new HashMap<>();\n+\tprivate @Getter Map<String, ElementType> allTypes = new HashMap<>();\n \n \tpublic FrankDocModel() {\n+\t\tconfigChildDescriptors = new HashMap<>();\n \t\tgroups = new ArrayList<>();\n \t}\n \n+\tpublic void createConfigChildDescriptorsFrom(String path) {\n+\t\tResource resource = Resource.getResource(path);\n+\t\tif(resource == null) {\n+\t\t\tthrow new RuntimeException(String.format(\"Cannot find resource on the classpath: [%s]\", path));\n+\t\t}\n+\t\ttry {\n+\t\t\tXmlUtils.parseXml(resource.asInputSource(), new Handler(path));\n+\t\t}\n+\t\tcatch(IOException e) {\n+\t\t\tthrow new RuntimeException(String.format(\"An IOException occurred while parsing XML from [%s]\", path), e);\n+\t\t}\n+\t\tcatch(SAXException e) {\n+\t\t\tthrow new RuntimeException(String.format(\"A SAXException occurred while parsing XML from [%s]\", path), e);\n+\t\t}\n+\t}\n+\n+\tprivate class Handler extends DigesterRulesHandler {\n+\t\tprivate final String path;\n+\n+\t\tHandler(String path) {\n+\t\t\tthis.path = path;\n+\t\t}\n+\n+\t\t@Override\n+\t\tprotected void handle(DigesterRule rule) throws SAXException {\n+\t\t\tString pattern = rule.getPattern();\n+\t\t\tStringTokenizer tokenizer = new StringTokenizer(pattern, \"/\");\n+\t\t\tString syntax1Name = null;\n+\t\t\twhile(tokenizer.hasMoreElements()) {\n+\t\t\t\tString token = tokenizer.nextToken();\n+\t\t\t\tif(!\"*\".equals(token)) {\n+\t\t\t\t\tsyntax1Name = token;\n+\t\t\t\t}\n+\t\t\t}\n+\t\t\tif(StringUtils.isNotEmpty(rule.getRegisterMethod())) {\n+\t\t\t\tadd(rule.getRegisterMethod(), syntax1Name);\n+\t\t\t}\t\t\t\n+\t\t}\n+\n+\t\tprivate void add(String registerMethod, String syntax1Name) throws SAXException {\n+\t\t\tConfigChildSetterDescriptor item = new ConfigChildSetterDescriptor(registerMethod, syntax1Name);\n+\t\t\tif(configChildDescriptors.containsKey(item.getMethodName())) {\n+\t\t\t\tlog.warn(String.format(\"In digester rules [%s], duplicate method name [%s]\", path, registerMethod));\n+\t\t\t} else {\n+\t\t\t\tconfigChildDescriptors.put(item.getMethodName(), item);\n+\t\t\t}\n+\t\t}\n+\t}\n+\n+\tpublic ElementType findOrCreateElementType(Class<?> clazz) {\n+\t\tif(allTypes.containsKey(clazz.getName())) {\n+\t\t\treturn allTypes.get(clazz.getName());\n+\t\t}\n+\t\tfinal ElementType result = new ElementType(clazz);\n+\t\t// If a containing FrankElement contains the type being created, we do not\n+\t\t// want recursion.\n+\t\tallTypes.put(result.getFullName(), result);\n+\t\tif(clazz.isInterface()) {\n+\t\t\tUtils.getSpringBeans(clazz.getName()).stream()\n+\t\t\t\t\t.map(b -> b.getClazz())\n+\t\t\t\t\t.map(cl -> findOrCreateFrankElement(cl))\n+\t\t\t\t\t.forEach(result::addMember);\n+\t\t} else {\n+\t\t\tresult.addMember(findOrCreateFrankElement(clazz));\n+\t\t}\n+\t\treturn result;\n+\t}\n+\n+\tpublic boolean hasType(String typeName) {\n+\t\treturn allTypes.containsKey(typeName);\n+\t}\n+\n \tpublic FrankElement findOrCreateFrankElement(Class<?> clazz) {\n \t\tif(allElements.containsKey(clazz.getName())) {\n \t\t\treturn allElements.get(clazz.getName());\n \t\t}\n \t\tClass<?> superClass = clazz.getSuperclass();\n \t\tFrankElement parent = superClass == null ? null : findOrCreateFrankElement(superClass);\n-\t\tFrankElement current = new FrankElement(clazz, parent);\n-\t\tcurrent.setAttributes(createAttributes(clazz.getDeclaredMethods(), current));\n-\t\tallElements.put(current.getFullName(), current);\n-\t\treturn current;\n+\t\tif(allElements.containsKey(clazz.getName())) {\n+\t\t\t// This can happen when element C inherits from element P, while P can have\n+\t\t\t// C as a configuration child.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDg3MjkzMg=="}, "originalCommit": {"oid": "3fb47d48f30e60c052aa732b3b5d98a4b262b6bd"}, "originalPosition": 130}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "732e1e398c1422469d3614186e13d3d9afbd08bf", "author": {"user": null}, "url": "https://github.com/ibissource/iaf/commit/732e1e398c1422469d3614186e13d3d9afbd08bf", "committedDate": "2020-10-26T10:33:46Z", "message": "Merge branch 'master' into fillDataModel3"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "887a6798b7be2cfb821e1689b2391f066c9f1cf6", "author": {"user": null}, "url": "https://github.com/ibissource/iaf/commit/887a6798b7be2cfb821e1689b2391f066c9f1cf6", "committedDate": "2020-10-26T11:12:58Z", "message": "Move parsing @IbisDoc to ConfigChild"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5e4295c49526be2006181beabf00ba4886653648", "author": {"user": null}, "url": "https://github.com/ibissource/iaf/commit/5e4295c49526be2006181beabf00ba4886653648", "committedDate": "2020-10-26T11:31:58Z", "message": "Improve Javadoc of ConfigChildSetterDescriptor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f871993244c7b9eb082a797b10174cc5fb600f71", "author": {"user": null}, "url": "https://github.com/ibissource/iaf/commit/f871993244c7b9eb082a797b10174cc5fb600f71", "committedDate": "2020-10-26T11:52:51Z", "message": "Correct invalid solution for FrankElement creation recursion"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "94c570724f745508e089434619ce1a80b2047c8f", "author": {"user": null}, "url": "https://github.com/ibissource/iaf/commit/94c570724f745508e089434619ce1a80b2047c8f", "committedDate": "2020-10-26T20:13:11Z", "message": "Exercise the FrankDocModel"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE3NDk5MDcz", "url": "https://github.com/ibissource/iaf/pull/1178#pullrequestreview-517499073", "createdAt": "2020-10-27T09:29:11Z", "commit": {"oid": "94c570724f745508e089434619ce1a80b2047c8f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QwOToyOToxMlrOHoyqSA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QwOTo1NTo1NVrOHozuoQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjUzNTExMg==", "bodyText": "Ik wil graag de IbisDoc annotatie bij childElementSetters gaan gebruiken om de functie van de children te gaan documenteren. Daarop moet deze method niet stuk gaan; hij moet er dus tegen kunnen dat er meer dan \u00e9\u00e9n argument is. Hij moet dus:\n\nals er minimaal \u00e9\u00e9n argument is\nchecken of dat argument een integer is\nals dat zo is, dan dat als de order teruggeven.", "url": "https://github.com/ibissource/iaf/pull/1178#discussion_r512535112", "createdAt": "2020-10-27T09:29:12Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/doc/model/ConfigChild.java", "diffHunk": "@@ -0,0 +1,53 @@\n+package nl.nn.adapterframework.doc.model;\n+\n+import java.text.ParseException;\n+import java.util.Arrays;\n+import java.util.stream.Collectors;\n+\n+import org.apache.logging.log4j.Logger;\n+\n+import lombok.Getter;\n+import lombok.Setter;\n+import nl.nn.adapterframework.doc.IbisDoc;\n+import nl.nn.adapterframework.util.LogUtil;\n+\n+public class ConfigChild {\n+\tprivate static Logger log = LogUtil.getLogger(ConfigChild.class);\n+\n+\tprivate @Getter FrankElement configParent;\n+\tprivate @Getter @Setter ElementType elementType;\n+\tprivate @Getter int sequenceInConfig;\n+\tprivate @Getter @Setter boolean mandatory;\n+\tprivate @Getter @Setter boolean allowMultiple;\n+\tprivate @Getter @Setter String syntax1Name;\n+\n+\tConfigChild(FrankElement configParent) {\n+\t\tthis.configParent = configParent;\n+\t}\n+\n+\tpublic void setSequenceInConfigFromIbisDocAnnotation(IbisDoc ibisDoc) throws ParseException {\n+\t\tsequenceInConfig = Integer.MAX_VALUE;\n+\t\tif(ibisDoc == null) {\n+\t\t\tthrow new ParseException(\"No @IbisDoc available\", 0);\n+\t\t}\n+\t\tInteger optionalOrder = parseIbisDocAnnotation(ibisDoc);\n+\t\tif(optionalOrder != null) {\n+\t\t\tsequenceInConfig = optionalOrder;\n+\t\t} else {\n+\t\t\tthrow new ParseException(String.format(\"Could not get order from @IbisDoc annotation with value [%s]\",\n+\t\t\t\t\tArrays.asList(ibisDoc.value()).stream().collect(Collectors.joining(\", \"))), 0);\n+\t\t}\n+\t}\n+\n+\tprivate static Integer parseIbisDocAnnotation(IbisDoc ibisDoc) {\n+\t\tInteger result = null;\n+\t\tif((ibisDoc != null) && (ibisDoc.value().length == 1)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "94c570724f745508e089434619ce1a80b2047c8f"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjU0MTMwNA==", "bodyText": "Ik denk dat je hier het beste kan beginnen met nl.nn.adapterframework.configuration.Configuration", "url": "https://github.com/ibissource/iaf/pull/1178#discussion_r512541304", "createdAt": "2020-10-27T09:38:49Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/doc/model/FrankDocModel.java", "diffHunk": "@@ -1,45 +1,143 @@\n package nl.nn.adapterframework.doc.model;\n \n+import java.io.IOException;\n import java.lang.reflect.Method;\n+import java.text.ParseException;\n import java.util.ArrayList;\n import java.util.Arrays;\n import java.util.HashMap;\n import java.util.LinkedHashMap;\n import java.util.List;\n import java.util.Map;\n import java.util.Map.Entry;\n+import java.util.StringTokenizer;\n import java.util.stream.Collectors;\n \n+import org.apache.commons.lang3.StringUtils;\n import org.apache.logging.log4j.Logger;\n import org.springframework.core.annotation.AnnotationUtils;\n+import org.xml.sax.SAXException;\n \n import lombok.Getter;\n import lombok.Setter;\n+import nl.nn.adapterframework.configuration.digester.DigesterRule;\n+import nl.nn.adapterframework.configuration.digester.DigesterRulesHandler;\n+import nl.nn.adapterframework.core.Resource;\n import nl.nn.adapterframework.doc.IbisDoc;\n import nl.nn.adapterframework.doc.IbisDocRef;\n+import nl.nn.adapterframework.doc.Utils;\n import nl.nn.adapterframework.util.LogUtil;\n+import nl.nn.adapterframework.util.XmlUtils;\n \n public class FrankDocModel {\n-\tprivate static final String JAVA_STRING = \"java.lang.String\";\n-\n \tprivate static Logger log = LogUtil.getLogger(FrankDocModel.class);\n-\n+\tprivate static final String DIGESTER_RULES = \"digester-rules.xml\";\n+\t\n+\tprivate @Getter Map<String, ConfigChildSetterDescriptor> configChildDescriptors;\n \tprivate @Getter List<FrankDocGroup> groups;\n \tprivate @Getter Map<String, FrankElement> allElements = new HashMap<>();\n+\tprivate @Getter Map<String, ElementType> allTypes = new HashMap<>();\n+\n+\t/**\n+\t * Get the FrankDocModel needed in production. This is just a first draft. The\n+\t * present version does not have groups yet. It will be improved in future\n+\t * pull requests. \n+\t */\n+\tpublic static FrankDocModel populate() {\n+\t\tFrankDocModel result = new FrankDocModel();\n+\t\tresult.createConfigChildDescriptorsFrom(DIGESTER_RULES);\n+\t\tresult.findOrCreateElementType(Utils.getClass(\"nl.nn.adapterframework.core.IAdapter\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "94c570724f745508e089434619ce1a80b2047c8f"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjU0NDUxOQ==", "bodyText": "Je moet hier, en op andere plekken, niet zomaar RuntimeExceptions gooien, maar 'normale' (checked) exceptions, die je vangt en afhandelt op een plek waar je er wat mee kan.", "url": "https://github.com/ibissource/iaf/pull/1178#discussion_r512544519", "createdAt": "2020-10-27T09:43:49Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/doc/model/FrankDocModel.java", "diffHunk": "@@ -1,45 +1,143 @@\n package nl.nn.adapterframework.doc.model;\n \n+import java.io.IOException;\n import java.lang.reflect.Method;\n+import java.text.ParseException;\n import java.util.ArrayList;\n import java.util.Arrays;\n import java.util.HashMap;\n import java.util.LinkedHashMap;\n import java.util.List;\n import java.util.Map;\n import java.util.Map.Entry;\n+import java.util.StringTokenizer;\n import java.util.stream.Collectors;\n \n+import org.apache.commons.lang3.StringUtils;\n import org.apache.logging.log4j.Logger;\n import org.springframework.core.annotation.AnnotationUtils;\n+import org.xml.sax.SAXException;\n \n import lombok.Getter;\n import lombok.Setter;\n+import nl.nn.adapterframework.configuration.digester.DigesterRule;\n+import nl.nn.adapterframework.configuration.digester.DigesterRulesHandler;\n+import nl.nn.adapterframework.core.Resource;\n import nl.nn.adapterframework.doc.IbisDoc;\n import nl.nn.adapterframework.doc.IbisDocRef;\n+import nl.nn.adapterframework.doc.Utils;\n import nl.nn.adapterframework.util.LogUtil;\n+import nl.nn.adapterframework.util.XmlUtils;\n \n public class FrankDocModel {\n-\tprivate static final String JAVA_STRING = \"java.lang.String\";\n-\n \tprivate static Logger log = LogUtil.getLogger(FrankDocModel.class);\n-\n+\tprivate static final String DIGESTER_RULES = \"digester-rules.xml\";\n+\t\n+\tprivate @Getter Map<String, ConfigChildSetterDescriptor> configChildDescriptors;\n \tprivate @Getter List<FrankDocGroup> groups;\n \tprivate @Getter Map<String, FrankElement> allElements = new HashMap<>();\n+\tprivate @Getter Map<String, ElementType> allTypes = new HashMap<>();\n+\n+\t/**\n+\t * Get the FrankDocModel needed in production. This is just a first draft. The\n+\t * present version does not have groups yet. It will be improved in future\n+\t * pull requests. \n+\t */\n+\tpublic static FrankDocModel populate() {\n+\t\tFrankDocModel result = new FrankDocModel();\n+\t\tresult.createConfigChildDescriptorsFrom(DIGESTER_RULES);\n+\t\tresult.findOrCreateElementType(Utils.getClass(\"nl.nn.adapterframework.core.IAdapter\"));\n+\t\treturn result;\n+\t}\n \n \tpublic FrankDocModel() {\n+\t\tconfigChildDescriptors = new HashMap<>();\n \t\tgroups = new ArrayList<>();\n \t}\n \n+\tpublic void createConfigChildDescriptorsFrom(String path) {\n+\t\tResource resource = Resource.getResource(path);\n+\t\tif(resource == null) {\n+\t\t\tthrow new RuntimeException(String.format(\"Cannot find resource on the classpath: [%s]\", path));\n+\t\t}\n+\t\ttry {\n+\t\t\tXmlUtils.parseXml(resource.asInputSource(), new Handler(path));\n+\t\t}\n+\t\tcatch(IOException e) {\n+\t\t\tthrow new RuntimeException(String.format(\"An IOException occurred while parsing XML from [%s]\", path), e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "94c570724f745508e089434619ce1a80b2047c8f"}, "originalPosition": 70}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjU0NjYyNg==", "bodyText": "Ik denk dat het ook handig is om de waarde van clazz.isInterface() te bewaren in ElementType result. Die gaat nog van pas komen denk ik.", "url": "https://github.com/ibissource/iaf/pull/1178#discussion_r512546626", "createdAt": "2020-10-27T09:47:02Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/doc/model/FrankDocModel.java", "diffHunk": "@@ -1,45 +1,143 @@\n package nl.nn.adapterframework.doc.model;\n \n+import java.io.IOException;\n import java.lang.reflect.Method;\n+import java.text.ParseException;\n import java.util.ArrayList;\n import java.util.Arrays;\n import java.util.HashMap;\n import java.util.LinkedHashMap;\n import java.util.List;\n import java.util.Map;\n import java.util.Map.Entry;\n+import java.util.StringTokenizer;\n import java.util.stream.Collectors;\n \n+import org.apache.commons.lang3.StringUtils;\n import org.apache.logging.log4j.Logger;\n import org.springframework.core.annotation.AnnotationUtils;\n+import org.xml.sax.SAXException;\n \n import lombok.Getter;\n import lombok.Setter;\n+import nl.nn.adapterframework.configuration.digester.DigesterRule;\n+import nl.nn.adapterframework.configuration.digester.DigesterRulesHandler;\n+import nl.nn.adapterframework.core.Resource;\n import nl.nn.adapterframework.doc.IbisDoc;\n import nl.nn.adapterframework.doc.IbisDocRef;\n+import nl.nn.adapterframework.doc.Utils;\n import nl.nn.adapterframework.util.LogUtil;\n+import nl.nn.adapterframework.util.XmlUtils;\n \n public class FrankDocModel {\n-\tprivate static final String JAVA_STRING = \"java.lang.String\";\n-\n \tprivate static Logger log = LogUtil.getLogger(FrankDocModel.class);\n-\n+\tprivate static final String DIGESTER_RULES = \"digester-rules.xml\";\n+\t\n+\tprivate @Getter Map<String, ConfigChildSetterDescriptor> configChildDescriptors;\n \tprivate @Getter List<FrankDocGroup> groups;\n \tprivate @Getter Map<String, FrankElement> allElements = new HashMap<>();\n+\tprivate @Getter Map<String, ElementType> allTypes = new HashMap<>();\n+\n+\t/**\n+\t * Get the FrankDocModel needed in production. This is just a first draft. The\n+\t * present version does not have groups yet. It will be improved in future\n+\t * pull requests. \n+\t */\n+\tpublic static FrankDocModel populate() {\n+\t\tFrankDocModel result = new FrankDocModel();\n+\t\tresult.createConfigChildDescriptorsFrom(DIGESTER_RULES);\n+\t\tresult.findOrCreateElementType(Utils.getClass(\"nl.nn.adapterframework.core.IAdapter\"));\n+\t\treturn result;\n+\t}\n \n \tpublic FrankDocModel() {\n+\t\tconfigChildDescriptors = new HashMap<>();\n \t\tgroups = new ArrayList<>();\n \t}\n \n+\tpublic void createConfigChildDescriptorsFrom(String path) {\n+\t\tResource resource = Resource.getResource(path);\n+\t\tif(resource == null) {\n+\t\t\tthrow new RuntimeException(String.format(\"Cannot find resource on the classpath: [%s]\", path));\n+\t\t}\n+\t\ttry {\n+\t\t\tXmlUtils.parseXml(resource.asInputSource(), new Handler(path));\n+\t\t}\n+\t\tcatch(IOException e) {\n+\t\t\tthrow new RuntimeException(String.format(\"An IOException occurred while parsing XML from [%s]\", path), e);\n+\t\t}\n+\t\tcatch(SAXException e) {\n+\t\t\tthrow new RuntimeException(String.format(\"A SAXException occurred while parsing XML from [%s]\", path), e);\n+\t\t}\n+\t}\n+\n+\tprivate class Handler extends DigesterRulesHandler {\n+\t\tprivate final String path;\n+\n+\t\tHandler(String path) {\n+\t\t\tthis.path = path;\n+\t\t}\n+\n+\t\t@Override\n+\t\tprotected void handle(DigesterRule rule) throws SAXException {\n+\t\t\tString pattern = rule.getPattern();\n+\t\t\tStringTokenizer tokenizer = new StringTokenizer(pattern, \"/\");\n+\t\t\tString syntax1Name = null;\n+\t\t\twhile(tokenizer.hasMoreElements()) {\n+\t\t\t\tString token = tokenizer.nextToken();\n+\t\t\t\tif(!\"*\".equals(token)) {\n+\t\t\t\t\tsyntax1Name = token;\n+\t\t\t\t}\n+\t\t\t}\n+\t\t\tif(StringUtils.isNotEmpty(rule.getRegisterMethod())) {\n+\t\t\t\tadd(rule.getRegisterMethod(), syntax1Name);\n+\t\t\t}\t\t\t\n+\t\t}\n+\n+\t\tprivate void add(String registerMethod, String syntax1Name) throws SAXException {\n+\t\t\tConfigChildSetterDescriptor item = new ConfigChildSetterDescriptor(registerMethod, syntax1Name);\n+\t\t\tif(configChildDescriptors.containsKey(item.getMethodName())) {\n+\t\t\t\tlog.warn(String.format(\"In digester rules [%s], duplicate method name [%s]\", path, registerMethod));\n+\t\t\t} else {\n+\t\t\t\tconfigChildDescriptors.put(item.getMethodName(), item);\n+\t\t\t}\n+\t\t}\n+\t}\n+\n+\tpublic ElementType findOrCreateElementType(Class<?> clazz) {\n+\t\tif(allTypes.containsKey(clazz.getName())) {\n+\t\t\treturn allTypes.get(clazz.getName());\n+\t\t}\n+\t\tfinal ElementType result = new ElementType(clazz);\n+\t\t// If a containing FrankElement contains the type being created, we do not\n+\t\t// want recursion.\n+\t\tallTypes.put(result.getFullName(), result);\n+\t\tif(clazz.isInterface()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "94c570724f745508e089434619ce1a80b2047c8f"}, "originalPosition": 118}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjU0ODAyMQ==", "bodyText": "Ik zou hier voor de duidelijkheid allElements.put(clazz.getName(), current) zetten. Dat je dezelfde key gebruikt voor je put als dat je voor containsKey() hebt gebruikt", "url": "https://github.com/ibissource/iaf/pull/1178#discussion_r512548021", "createdAt": "2020-10-27T09:49:10Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/doc/model/FrankDocModel.java", "diffHunk": "@@ -1,45 +1,143 @@\n package nl.nn.adapterframework.doc.model;\n \n+import java.io.IOException;\n import java.lang.reflect.Method;\n+import java.text.ParseException;\n import java.util.ArrayList;\n import java.util.Arrays;\n import java.util.HashMap;\n import java.util.LinkedHashMap;\n import java.util.List;\n import java.util.Map;\n import java.util.Map.Entry;\n+import java.util.StringTokenizer;\n import java.util.stream.Collectors;\n \n+import org.apache.commons.lang3.StringUtils;\n import org.apache.logging.log4j.Logger;\n import org.springframework.core.annotation.AnnotationUtils;\n+import org.xml.sax.SAXException;\n \n import lombok.Getter;\n import lombok.Setter;\n+import nl.nn.adapterframework.configuration.digester.DigesterRule;\n+import nl.nn.adapterframework.configuration.digester.DigesterRulesHandler;\n+import nl.nn.adapterframework.core.Resource;\n import nl.nn.adapterframework.doc.IbisDoc;\n import nl.nn.adapterframework.doc.IbisDocRef;\n+import nl.nn.adapterframework.doc.Utils;\n import nl.nn.adapterframework.util.LogUtil;\n+import nl.nn.adapterframework.util.XmlUtils;\n \n public class FrankDocModel {\n-\tprivate static final String JAVA_STRING = \"java.lang.String\";\n-\n \tprivate static Logger log = LogUtil.getLogger(FrankDocModel.class);\n-\n+\tprivate static final String DIGESTER_RULES = \"digester-rules.xml\";\n+\t\n+\tprivate @Getter Map<String, ConfigChildSetterDescriptor> configChildDescriptors;\n \tprivate @Getter List<FrankDocGroup> groups;\n \tprivate @Getter Map<String, FrankElement> allElements = new HashMap<>();\n+\tprivate @Getter Map<String, ElementType> allTypes = new HashMap<>();\n+\n+\t/**\n+\t * Get the FrankDocModel needed in production. This is just a first draft. The\n+\t * present version does not have groups yet. It will be improved in future\n+\t * pull requests. \n+\t */\n+\tpublic static FrankDocModel populate() {\n+\t\tFrankDocModel result = new FrankDocModel();\n+\t\tresult.createConfigChildDescriptorsFrom(DIGESTER_RULES);\n+\t\tresult.findOrCreateElementType(Utils.getClass(\"nl.nn.adapterframework.core.IAdapter\"));\n+\t\treturn result;\n+\t}\n \n \tpublic FrankDocModel() {\n+\t\tconfigChildDescriptors = new HashMap<>();\n \t\tgroups = new ArrayList<>();\n \t}\n \n+\tpublic void createConfigChildDescriptorsFrom(String path) {\n+\t\tResource resource = Resource.getResource(path);\n+\t\tif(resource == null) {\n+\t\t\tthrow new RuntimeException(String.format(\"Cannot find resource on the classpath: [%s]\", path));\n+\t\t}\n+\t\ttry {\n+\t\t\tXmlUtils.parseXml(resource.asInputSource(), new Handler(path));\n+\t\t}\n+\t\tcatch(IOException e) {\n+\t\t\tthrow new RuntimeException(String.format(\"An IOException occurred while parsing XML from [%s]\", path), e);\n+\t\t}\n+\t\tcatch(SAXException e) {\n+\t\t\tthrow new RuntimeException(String.format(\"A SAXException occurred while parsing XML from [%s]\", path), e);\n+\t\t}\n+\t}\n+\n+\tprivate class Handler extends DigesterRulesHandler {\n+\t\tprivate final String path;\n+\n+\t\tHandler(String path) {\n+\t\t\tthis.path = path;\n+\t\t}\n+\n+\t\t@Override\n+\t\tprotected void handle(DigesterRule rule) throws SAXException {\n+\t\t\tString pattern = rule.getPattern();\n+\t\t\tStringTokenizer tokenizer = new StringTokenizer(pattern, \"/\");\n+\t\t\tString syntax1Name = null;\n+\t\t\twhile(tokenizer.hasMoreElements()) {\n+\t\t\t\tString token = tokenizer.nextToken();\n+\t\t\t\tif(!\"*\".equals(token)) {\n+\t\t\t\t\tsyntax1Name = token;\n+\t\t\t\t}\n+\t\t\t}\n+\t\t\tif(StringUtils.isNotEmpty(rule.getRegisterMethod())) {\n+\t\t\t\tadd(rule.getRegisterMethod(), syntax1Name);\n+\t\t\t}\t\t\t\n+\t\t}\n+\n+\t\tprivate void add(String registerMethod, String syntax1Name) throws SAXException {\n+\t\t\tConfigChildSetterDescriptor item = new ConfigChildSetterDescriptor(registerMethod, syntax1Name);\n+\t\t\tif(configChildDescriptors.containsKey(item.getMethodName())) {\n+\t\t\t\tlog.warn(String.format(\"In digester rules [%s], duplicate method name [%s]\", path, registerMethod));\n+\t\t\t} else {\n+\t\t\t\tconfigChildDescriptors.put(item.getMethodName(), item);\n+\t\t\t}\n+\t\t}\n+\t}\n+\n+\tpublic ElementType findOrCreateElementType(Class<?> clazz) {\n+\t\tif(allTypes.containsKey(clazz.getName())) {\n+\t\t\treturn allTypes.get(clazz.getName());\n+\t\t}\n+\t\tfinal ElementType result = new ElementType(clazz);\n+\t\t// If a containing FrankElement contains the type being created, we do not\n+\t\t// want recursion.\n+\t\tallTypes.put(result.getFullName(), result);\n+\t\tif(clazz.isInterface()) {\n+\t\t\tUtils.getSpringBeans(clazz.getName()).stream()\n+\t\t\t\t\t.map(b -> b.getClazz())\n+\t\t\t\t\t.map(cl -> findOrCreateFrankElement(cl))\n+\t\t\t\t\t.forEach(result::addMember);\n+\t\t} else {\n+\t\t\tresult.addMember(findOrCreateFrankElement(clazz));\n+\t\t}\n+\t\treturn result;\n+\t}\n+\n+\tpublic boolean hasType(String typeName) {\n+\t\treturn allTypes.containsKey(typeName);\n+\t}\n+\n \tpublic FrankElement findOrCreateFrankElement(Class<?> clazz) {\n \t\tif(allElements.containsKey(clazz.getName())) {\n \t\t\treturn allElements.get(clazz.getName());\n \t\t}\n+\t\tFrankElement current = new FrankElement(clazz);\n+\t\tallElements.put(current.getFullName(), current);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "94c570724f745508e089434619ce1a80b2047c8f"}, "originalPosition": 138}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjU1MjU0Nw==", "bodyText": "Dit zijn geen attributen, maar child elements", "url": "https://github.com/ibissource/iaf/pull/1178#discussion_r512552547", "createdAt": "2020-10-27T09:55:49Z", "author": {"login": "gvanbrakel"}, "path": "test/src/test/resources/TestTool/IbisDoc/ibisdoc.xsd", "diffHunk": "@@ -31841,11 +31836,16 @@\n         <xs:documentation>forces that each pipe in the pipeline is not automatically added to the globalforwards table (default: application default)</xs:documentation>\n       </xs:annotation>\n     </xs:attribute>\n+    <xs:attribute name=\"inputValidator\" type=\"xs:string\" />\n+    <xs:attribute name=\"inputWrapper\" type=\"xs:string\" />\n+    <xs:attribute name=\"locker\" type=\"xs:string\" />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "94c570724f745508e089434619ce1a80b2047c8f"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjU1MjYwOQ==", "bodyText": "Dit zijn geen attributen, maar child elements", "url": "https://github.com/ibissource/iaf/pull/1178#discussion_r512552609", "createdAt": "2020-10-27T09:55:55Z", "author": {"login": "gvanbrakel"}, "path": "test/src/test/resources/TestTool/IbisDoc/ibisdoc.xsd", "diffHunk": "@@ -31841,11 +31836,16 @@\n         <xs:documentation>forces that each pipe in the pipeline is not automatically added to the globalforwards table (default: application default)</xs:documentation>\n       </xs:annotation>\n     </xs:attribute>\n+    <xs:attribute name=\"inputValidator\" type=\"xs:string\" />\n+    <xs:attribute name=\"inputWrapper\" type=\"xs:string\" />\n+    <xs:attribute name=\"locker\" type=\"xs:string\" />\n     <xs:attribute name=\"messageSizeWarn\" type=\"xs:string\">\n       <xs:annotation>\n         <xs:documentation>if messagesizewarn&gt;=0 and the size of the input or result pipe message exceeds the value specified a warning message is logged (default: application default (3mb))</xs:documentation>\n       </xs:annotation>\n     </xs:attribute>\n+    <xs:attribute name=\"outputValidator\" type=\"xs:string\" />\n+    <xs:attribute name=\"outputWrapper\" type=\"xs:string\" />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "94c570724f745508e089434619ce1a80b2047c8f"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b44657fc7871014ef7e258680d67cf89f35d1370", "author": {"user": null}, "url": "https://github.com/ibissource/iaf/commit/b44657fc7871014ef7e258680d67cf89f35d1370", "committedDate": "2020-10-27T12:58:39Z", "message": "Correct that unwanted attributes were created"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2b2740585a7a2c4f6e0961152380ea16a6d698b7", "author": {"user": null}, "url": "https://github.com/ibissource/iaf/commit/2b2740585a7a2c4f6e0961152380ea16a6d698b7", "committedDate": "2020-10-27T13:05:46Z", "message": "Small improvement"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7dbbe72132764cb99477f5c874b9bb641995ff55", "author": {"user": null}, "url": "https://github.com/ibissource/iaf/commit/7dbbe72132764cb99477f5c874b9bb641995ff55", "committedDate": "2020-10-27T13:14:23Z", "message": "Save whether a type comes from a Java interface"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "11831a69543b4cbe6179ccff50533aea0c34c620", "author": {"user": null}, "url": "https://github.com/ibissource/iaf/commit/11831a69543b4cbe6179ccff50533aea0c34c620", "committedDate": "2020-10-27T13:31:56Z", "message": "Dont throw RuntimeException - most cases"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3f23bee10069b671337677eee339a5053503f698", "author": {"user": null}, "url": "https://github.com/ibissource/iaf/commit/3f23bee10069b671337677eee339a5053503f698", "committedDate": "2020-10-27T13:58:36Z", "message": "Eliminate throwing subclasses of RuntimeException"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cd74219137218b85e004da734ab757333b46ea2d", "author": {"user": null}, "url": "https://github.com/ibissource/iaf/commit/cd74219137218b85e004da734ab757333b46ea2d", "committedDate": "2020-10-27T14:45:59Z", "message": "Populate model from Configuration instead of IAdapter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6761950fec4d6d43846999dbb38fea865effb48b", "author": {"user": null}, "url": "https://github.com/ibissource/iaf/commit/6761950fec4d6d43846999dbb38fea865effb48b", "committedDate": "2020-10-27T15:24:13Z", "message": "setSequenceNumberInConfigFromIbisDocAnnotation should not throw"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "97028cc28e555914ecf05b4e5a88a96fdb24689c", "author": {"user": null}, "url": "https://github.com/ibissource/iaf/commit/97028cc28e555914ecf05b4e5a88a96fdb24689c", "committedDate": "2020-10-27T15:48:25Z", "message": "Save the results from the IbisDoc tests, to be reviewed"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE3OTAzMzQw", "url": "https://github.com/ibissource/iaf/pull/1178#pullrequestreview-517903340", "createdAt": "2020-10-27T16:27:35Z", "commit": {"oid": "97028cc28e555914ecf05b4e5a88a96fdb24689c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxNjoyNzozNVrOHpFaAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxNjoyNzozNVrOHpFaAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjg0MjI0Mw==", "bodyText": "Ik denk dat groups een Map<Class, List> moet zijn, waarbij de key de interface van het child element is, of 'null' voor de elementTypes die niet een interface representeren, maar een class. De group met class null wordt dan de group 'overig'", "url": "https://github.com/ibissource/iaf/pull/1178#discussion_r512842243", "createdAt": "2020-10-27T16:27:35Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/doc/model/FrankDocModel.java", "diffHunk": "@@ -8,42 +9,145 @@\n import java.util.List;\n import java.util.Map;\n import java.util.Map.Entry;\n+import java.util.StringTokenizer;\n import java.util.stream.Collectors;\n \n+import org.apache.commons.lang3.StringUtils;\n import org.apache.logging.log4j.Logger;\n import org.springframework.core.annotation.AnnotationUtils;\n+import org.xml.sax.SAXException;\n \n import lombok.Getter;\n import lombok.Setter;\n+import nl.nn.adapterframework.configuration.digester.DigesterRule;\n+import nl.nn.adapterframework.configuration.digester.DigesterRulesHandler;\n+import nl.nn.adapterframework.core.Resource;\n import nl.nn.adapterframework.doc.IbisDoc;\n import nl.nn.adapterframework.doc.IbisDocRef;\n+import nl.nn.adapterframework.doc.Utils;\n+import nl.nn.adapterframework.doc.objects.SpringBean;\n import nl.nn.adapterframework.util.LogUtil;\n+import nl.nn.adapterframework.util.XmlUtils;\n \n public class FrankDocModel {\n-\tprivate static final String JAVA_STRING = \"java.lang.String\";\n-\n \tprivate static Logger log = LogUtil.getLogger(FrankDocModel.class);\n-\n+\tprivate static final String DIGESTER_RULES = \"digester-rules.xml\";\n+\t\n+\tprivate @Getter Map<String, ConfigChildSetterDescriptor> configChildDescriptors;\n \tprivate @Getter List<FrankDocGroup> groups;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "97028cc28e555914ecf05b4e5a88a96fdb24689c"}, "originalPosition": 39}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e659d52fa7574a6f04a725fd35c9b2b93958b234", "author": {"user": null}, "url": "https://github.com/ibissource/iaf/commit/e659d52fa7574a6f04a725fd35c9b2b93958b234", "committedDate": "2020-10-27T17:35:48Z", "message": "Change type of groups in the model."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4NDkyMjk0", "url": "https://github.com/ibissource/iaf/pull/1178#pullrequestreview-518492294", "createdAt": "2020-10-28T09:57:28Z", "commit": {"oid": "e659d52fa7574a6f04a725fd35c9b2b93958b234"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQwOTo1NzoyOFrOHpiOrg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQwOTo1NzoyOFrOHpiOrg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzMxNDQ3OA==", "bodyText": "Handige tip, de HashSet kan ook als volgt geschreven worden:\nnew HashSet<>(Arrays.asList(JAVA_STRING, JAVA_INTEGER, JAVA_BOOLEAN, JAVA_LONG, JAVA_BYTE, JAVA_SHORT));", "url": "https://github.com/ibissource/iaf/pull/1178#discussion_r513314478", "createdAt": "2020-10-28T09:57:28Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/doc/InfoBuilderSource.java", "diffHunk": "@@ -51,6 +52,16 @@\n import nl.nn.adapterframework.util.XmlUtils;\n \n class InfoBuilderSource {\n+\tprivate static final String JAVA_STRING = \"java.lang.String\";\n+\tprivate static final String JAVA_INTEGER = \"java.lang.Integer\";\n+\tprivate static final String JAVA_BOOLEAN = \"java.lang.Boolean\";\n+\tprivate static final String JAVA_LONG = \"java.lang.Long\";\n+\tprivate static final String JAVA_BYTE = \"java.lang.Byte\";\n+\tprivate static final String JAVA_SHORT = \"java.lang.Short\";\n+\n+\tprivate static final Set<String> JAVA_BOXED = new HashSet<String>(Arrays.asList(new String[] {\n+\t\t\tJAVA_STRING, JAVA_INTEGER, JAVA_BOOLEAN, JAVA_LONG, JAVA_BYTE, JAVA_SHORT}));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e659d52fa7574a6f04a725fd35c9b2b93958b234"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4NTAyNjk2", "url": "https://github.com/ibissource/iaf/pull/1178#pullrequestreview-518502696", "createdAt": "2020-10-28T10:09:21Z", "commit": {"oid": "e659d52fa7574a6f04a725fd35c9b2b93958b234"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxMDowOToyMVrOHpissg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxMDowOToyMVrOHpissg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzMyMjE2Mg==", "bodyText": "Een kleine kanttekening betreft excepties, soms zie ik je message: %s en soms zie ik je message [%s] gebruiken. Hier staat nu een combinatie van de twee message: [%s]. Binnen de framework meldingen gebruiken wij [%s] omdat je dan een 'postfix' hebt waar de melding ophoudt.", "url": "https://github.com/ibissource/iaf/pull/1178#discussion_r513322162", "createdAt": "2020-10-28T10:09:21Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/doc/model/FrankDocModel.java", "diffHunk": "@@ -8,42 +9,145 @@\n import java.util.List;\n import java.util.Map;\n import java.util.Map.Entry;\n+import java.util.StringTokenizer;\n import java.util.stream.Collectors;\n \n+import org.apache.commons.lang3.StringUtils;\n import org.apache.logging.log4j.Logger;\n import org.springframework.core.annotation.AnnotationUtils;\n+import org.xml.sax.SAXException;\n \n import lombok.Getter;\n import lombok.Setter;\n+import nl.nn.adapterframework.configuration.digester.DigesterRule;\n+import nl.nn.adapterframework.configuration.digester.DigesterRulesHandler;\n+import nl.nn.adapterframework.core.Resource;\n import nl.nn.adapterframework.doc.IbisDoc;\n import nl.nn.adapterframework.doc.IbisDocRef;\n+import nl.nn.adapterframework.doc.Utils;\n+import nl.nn.adapterframework.doc.objects.SpringBean;\n import nl.nn.adapterframework.util.LogUtil;\n+import nl.nn.adapterframework.util.XmlUtils;\n \n public class FrankDocModel {\n-\tprivate static final String JAVA_STRING = \"java.lang.String\";\n-\n \tprivate static Logger log = LogUtil.getLogger(FrankDocModel.class);\n-\n-\tprivate @Getter List<FrankDocGroup> groups;\n+\tprivate static final String DIGESTER_RULES = \"digester-rules.xml\";\n+\t\n+\tprivate @Getter Map<String, ConfigChildSetterDescriptor> configChildDescriptors;\n+\tprivate @Getter Map<String, FrankDocGroup> groups;\n \tprivate @Getter Map<String, FrankElement> allElements = new HashMap<>();\n+\tprivate @Getter Map<String, ElementType> allTypes = new HashMap<>();\n+\n+\t/**\n+\t * Get the FrankDocModel needed in production. This is just a first draft. The\n+\t * present version does not have groups yet. It will be improved in future\n+\t * pull requests. \n+\t */\n+\tpublic static FrankDocModel populate() {\n+\t\tFrankDocModel result = new FrankDocModel();\n+\t\ttry {\n+\t\t\tresult.createConfigChildDescriptorsFrom(DIGESTER_RULES);\n+\t\t\tresult.findOrCreateElementType(Utils.getClass(\"nl.nn.adapterframework.configuration.Configuration\"));\n+\t\t} catch(Exception e) {\n+\t\t\tlog.fatal(\"Could not populate FrankDocModel\", e);\n+\t\t\treturn null;\n+\t\t}\n+\t\treturn result;\n+\t}\n \n \tpublic FrankDocModel() {\n-\t\tgroups = new ArrayList<>();\n+\t\tconfigChildDescriptors = new HashMap<>();\n+\t\tgroups = new HashMap<>();\n+\t}\n+\n+\tpublic void createConfigChildDescriptorsFrom(String path) throws IOException, SAXException {\n+\t\tResource resource = Resource.getResource(path);\n+\t\tif(resource == null) {\n+\t\t\tthrow new IOException(String.format(\"Cannot find resource on the classpath: [%s]\", path));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e659d52fa7574a6f04a725fd35c9b2b93958b234"}, "originalPosition": 70}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4NTEwMjU3", "url": "https://github.com/ibissource/iaf/pull/1178#pullrequestreview-518510257", "createdAt": "2020-10-28T10:18:47Z", "commit": {"oid": "e659d52fa7574a6f04a725fd35c9b2b93958b234"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4NTk1OTY1", "url": "https://github.com/ibissource/iaf/pull/1178#pullrequestreview-518595965", "createdAt": "2020-10-28T12:14:08Z", "commit": {"oid": "e659d52fa7574a6f04a725fd35c9b2b93958b234"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 997, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}