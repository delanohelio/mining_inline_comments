{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk2ODI2NzY0", "number": 1119, "title": "Fix #1070 improve file system rename", "bodyText": "", "createdAt": "2020-10-02T10:39:18Z", "url": "https://github.com/ibissource/iaf/pull/1119", "merged": true, "mergeCommit": {"oid": "c5f510208802956a763f849b0970a8c84f99bb16"}, "closed": true, "closedAt": "2020-10-09T09:36:28Z", "author": {"login": "gvanbrakel"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdN8TitAH2gAyNDk2ODI2NzY0Ojc3ZWMwM2MwMjI2NDhjYjczMWFiODliYzFlNjY1YTJhZTM3ZjYxOWU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdQy33lAFqTUwNTUxNTU4MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "77ec03c022648cb731ab89bc1e665a2ae37f619e", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/77ec03c022648cb731ab89bc1e665a2ae37f619e", "committedDate": "2020-09-30T12:53:54Z", "message": "First commit"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0477086cc00fdc467c158938b7366de4f9440e09", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/0477086cc00fdc467c158938b7366de4f9440e09", "committedDate": "2020-10-01T14:47:42Z", "message": "Merge branch 'master' into fix_#1070_improve_FileSystem_rename"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "866572e8205a84ed7b8afc3b40247f378c205666", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/866572e8205a84ed7b8afc3b40247f378c205666", "committedDate": "2020-10-02T06:54:36Z", "message": "second commit"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "16ee44c1ee9420f6b56b5a0eb7407b6b203aab7f", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/16ee44c1ee9420f6b56b5a0eb7407b6b203aab7f", "committedDate": "2020-10-02T10:38:50Z", "message": "Simplify filesystems"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b0bb0b00d3cf240c74575a0a9873194a6e38f05", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/9b0bb0b00d3cf240c74575a0a9873194a6e38f05", "committedDate": "2020-10-02T11:57:00Z", "message": "Add comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxMTM5MzI2", "url": "https://github.com/ibissource/iaf/pull/1119#pullrequestreview-501139326", "createdAt": "2020-10-02T13:34:30Z", "commit": {"oid": "9b0bb0b00d3cf240c74575a0a9873194a6e38f05"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxMzozNDozMFrOHbt1mg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxMzozNDozMFrOHbt1mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODgyNDYwMg==", "bodyText": "of contains  \\\\", "url": "https://github.com/ibissource/iaf/pull/1119#discussion_r498824602", "createdAt": "2020-10-02T13:34:30Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/filesystem/FileSystemActor.java", "diffHunk": "@@ -380,34 +384,28 @@ protected void finalize() throws Throwable {\n \t\t\t\tfileSystem.removeFolder(folder);\n \t\t\t\treturn folder;\n \t\t\t} else if (action.equalsIgnoreCase(ACTION_RENAME)) {\n-\t\t\t\tF file=getFile(input, pvl);\n-\t\t\t\tString destination = determineDestination(pvl);\n-\t\t\t\tif (destination == null) {\n-\t\t\t\t\tthrow new FileSystemException(\"unknown destination [\" + destination + \"]\");\n+\t\t\t\tF source=getFile(input, pvl);\n+\t\t\t\tString destinationName = determineDestination(pvl);\n+\t\t\t\tF destination;\n+\t\t\t\tif (destinationName.contains(\"/\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9b0bb0b00d3cf240c74575a0a9873194a6e38f05"}, "originalPosition": 60}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9282928b2a793f8965b7440738a2e2c7a6b00564", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/9282928b2a793f8965b7440738a2e2c7a6b00564", "committedDate": "2020-10-02T13:43:34Z", "message": "fix slash issue"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d3b4da3cd189093c758cced241c706cdab328aba", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/d3b4da3cd189093c758cced241c706cdab328aba", "committedDate": "2020-10-06T13:34:15Z", "message": "Fix ExchangeFileSystem support"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4bd08a2735d661089b2b9b518ce689a942d88d2f", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/4bd08a2735d661089b2b9b518ce689a942d88d2f", "committedDate": "2020-10-06T13:53:09Z", "message": "Fix small issue"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d628518200fdc1ff2e4f92175cc3520315a283f6", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/d628518200fdc1ff2e4f92175cc3520315a283f6", "committedDate": "2020-10-06T15:21:38Z", "message": "Add overwrite attribute to FileSystemSender and FileSystemPipe"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e5becb486dc93721a536a82af4925e107f85ec0d", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/e5becb486dc93721a536a82af4925e107f85ec0d", "committedDate": "2020-10-07T06:47:41Z", "message": "Clarify contract of move, copy and rename"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA0OTMwNTYy", "url": "https://github.com/ibissource/iaf/pull/1119#pullrequestreview-504930562", "createdAt": "2020-10-08T15:54:15Z", "commit": {"oid": "e5becb486dc93721a536a82af4925e107f85ec0d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQxNTo1NDoxNVrOHelVBQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQxNTo1NTozOVrOHelZBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTgzMDkxNw==", "bodyText": "dit kan weg toch?", "url": "https://github.com/ibissource/iaf/pull/1119#discussion_r501830917", "createdAt": "2020-10-08T15:54:15Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/filesystem/ExchangeFileSystem.java", "diffHunk": "@@ -271,37 +273,47 @@ public Item toFile(String folder, String filename) throws FileSystemException {\n \t\tthrow new NotImplementedException(\"Cannot make item for [\"+filename+\"] file in Exchange folder [\"+folder+\"]\");\n \t}\n \n-\n-\t@Override\n-\tpublic boolean exists(Item f) throws FileSystemException {\n+\tprivate boolean itemExistsInFolder(FolderId folderId, String itemId) throws FileSystemException{\n \t\ttry {\n \t\t\tItemView view = new ItemView(1);\n \t\t\tview.getOrderBy().add(ItemSchema.DateTimeReceived, SortDirection.Ascending);\n-\t\t\tSearchFilter searchFilter =  new SearchFilter.IsEqualTo(ItemSchema.Id, f.getId().toString());\n+\t\t\tSearchFilter searchFilter =  new SearchFilter.IsEqualTo(ItemSchema.Id, itemId);\n \t\t\tFindItemsResults<Item> findResults;\n-\t\t\tfindResults = exchangeService.findItems(basefolderId,searchFilter, view);\n+\t\t\tfindResults = exchangeService.findItems(folderId,searchFilter, view);\n \t\t\treturn findResults.getTotalCount()!=0;\n \t\t} catch (Exception e) {\n \t\t\tthrow new FileSystemException(e);\n \t\t}\n \t}\n \n-\tpublic Item extractNestedItem(Item item) throws Exception {\n-\t\tIterator<Attachment> attachments = listAttachments(item);\n-\t\tif (attachments!=null) {\n-\t\t\twhile (attachments.hasNext()) {\n-\t\t\t\tAttachment attachment=attachments.next();\n-\t\t\t\tif (attachment instanceof ItemAttachment) {\n-\t\t\t\t\tItemAttachment itemAttachment = (ItemAttachment)attachment;\n-\t\t\t\t\titemAttachment.load();\n-\t\t\t\t\treturn itemAttachment.getItem();\n-\t\t\t\t}\n+\t@Override\n+\tpublic boolean exists(Item f) throws FileSystemException {\n+\t\ttry {\n+\t\t\tEmailMessage emailMessage = EmailMessage.bind(exchangeService, f.getId());\n+\t\t\treturn itemExistsInFolder(emailMessage.getParentFolderId(), f.getId().toString());\n+\t\t} catch (ServiceResponseException e) {\n+\t\t\tServiceError errorCode = e.getErrorCode();\n+\t\t\tif (errorCode == ServiceError.ErrorItemNotFound) {\n+\t\t\t\treturn false;\n \t\t\t}\n+\t\t\tthrow new FileSystemException(e);\n+\t\t} catch (Exception e) {\n+\t\t\tthrow new FileSystemException(e);\n \t\t}\n-\t\treturn null;\n \t}\n-\t\n-\t\n+\n+\t//\t@Override\n+//\tpublic boolean filenameExistsInFolder(String folder, String filename) throws FileSystemException{\n+//\t\ttry {\n+//\t\t\tFolderId folderId = findFolder(folder);\n+//\t\t\treturn itemExistsInFolder(folderId, filename);\n+//\t\t} catch (Exception e) {\n+//\t\t\tthrow new FileSystemException(e);\n+//\t\t}\n+//\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e5becb486dc93721a536a82af4925e107f85ec0d"}, "originalPosition": 73}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTgzMTk0Mw==", "bodyText": "Ik snap dat je er nu niets mee wilt doen maar hier is de base64 pipe toch voor, dit moet weg!", "url": "https://github.com/ibissource/iaf/pull/1119#discussion_r501831943", "createdAt": "2020-10-08T15:55:39Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/filesystem/FileSystemActor.java", "diffHunk": "@@ -609,4 +599,12 @@ public int getNumberOfBackups() {\n \t\treturn numberOfBackups;\n \t}\n \n+\t@IbisDoc({\"9\", \"Can be set to 'encode' or 'decode' for actions \"+ACTION_READ1+\", \"+ACTION_WRITE1+\" and \"+ACTION_APPEND+\". When set the stream is base64 encoded or decoded, respectively\", \"\"})\n+\tpublic void setBase64(String base64) {\n+\t\tthis.base64 = base64;\n+\t}\n+\tpublic String getBase64() {\n+\t\treturn base64;\n+\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e5becb486dc93721a536a82af4925e107f85ec0d"}, "originalPosition": 154}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3da8174833c2450e6bb14141e8ba7a027b46c283", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/3da8174833c2450e6bb14141e8ba7a027b46c283", "committedDate": "2020-10-09T06:45:58Z", "message": "Addressed comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1NTE1NTgx", "url": "https://github.com/ibissource/iaf/pull/1119#pullrequestreview-505515581", "createdAt": "2020-10-09T09:36:18Z", "commit": {"oid": "3da8174833c2450e6bb14141e8ba7a027b46c283"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1122, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}