{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEwNzA5NzU3", "number": 1210, "reviewThreads": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxMzoxMDo0M1rOEyV_kw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQwNzo1MTo0N1rOEzrs7Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxMjI0NTk1OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/nl/nn/adapterframework/configuration/IbisContext.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxMzoxMDo0M1rOHo7WsQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxNDo0MzoyMFrOHo_79g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjY3NzU1Mw==", "bodyText": "I don't think it is a good idea to log this message in the ConfigurationWarnings as well as in the MessageKeeper.", "url": "https://github.com/ibissource/iaf/pull/1210#discussion_r512677553", "createdAt": "2020-10-27T13:10:43Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/configuration/IbisContext.java", "diffHunk": "@@ -351,6 +351,7 @@ private void digestClassLoaderConfiguration(ClassLoader classLoader,\n \t\t\t\t\t\tdatabaseMigrator.close();\n \t\t\t\t\t}\n \t\t\t\t\tcatch (Exception e) {\n+\t\t\t\t\t\tConfigurationWarnings.add(LOG, e.getMessage());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f359abea32a47ef5049716e0a6935572a4c84d5b"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjc1MjYzMA==", "bodyText": "I do agree", "url": "https://github.com/ibissource/iaf/pull/1210#discussion_r512752630", "createdAt": "2020-10-27T14:43:20Z", "author": {"login": "alisihab"}, "path": "core/src/main/java/nl/nn/adapterframework/configuration/IbisContext.java", "diffHunk": "@@ -351,6 +351,7 @@ private void digestClassLoaderConfiguration(ClassLoader classLoader,\n \t\t\t\t\t\tdatabaseMigrator.close();\n \t\t\t\t\t}\n \t\t\t\t\tcatch (Exception e) {\n+\t\t\t\t\t\tConfigurationWarnings.add(LOG, e.getMessage());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjY3NzU1Mw=="}, "originalCommit": {"oid": "f359abea32a47ef5049716e0a6935572a4c84d5b"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxODI0MjQyOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/nl/nn/adapterframework/configuration/ConfigurationDigester.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxNzowOTozMVrOHp0wLA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxNzowOTozMVrOHp0wLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzYxNzk2NA==", "bodyText": "These warnings are very configuration specific. If you pass the Configuration that is parsed in the constructor of XmlErrorHandler, than you can make these warnings configuration specific", "url": "https://github.com/ibissource/iaf/pull/1210#discussion_r513617964", "createdAt": "2020-10-28T17:09:31Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/configuration/ConfigurationDigester.java", "diffHunk": "@@ -100,15 +100,15 @@\n \tprivate class XmlErrorHandler implements ErrorHandler  {\n \t\t@Override\n \t\tpublic void warning(SAXParseException exception) throws SAXParseException {\n-\t\t\tConfigurationWarnings.add(log, \"Warning when validating against schema [\"+CONFIGURATION_VALIDATION_SCHEMA+\"] at line,column [\"+exception.getLineNumber()+\",\"+exception.getColumnNumber()+\"]: \" + exception.getMessage());\n+\t\t\tConfigurationWarnings.addGlobalWarning(log, \"Warning when validating against schema [\"+CONFIGURATION_VALIDATION_SCHEMA+\"] at line,column [\"+exception.getLineNumber()+\",\"+exception.getColumnNumber()+\"]: \" + exception.getMessage());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7707e88a076b649f5fb14bb1a88cd6beca5dec4e"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIxODI4OTI2OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/nl/nn/adapterframework/jdbc/migration/LiquibaseImpl.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxNzoyMDoxM1rOHp1NoQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxNzoyMDoxM1rOHp1NoQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzYyNTUwNQ==", "bodyText": "LiquibaseImpl is not really a named object, so this is a tricky/hacky way to pass the name.\nI suggest you pass the Configuration as an argument to databaseMigrator.configure() in IbisContext line 349, and use that as the named object", "url": "https://github.com/ibissource/iaf/pull/1210#discussion_r513625505", "createdAt": "2020-10-28T17:20:13Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/jdbc/migration/LiquibaseImpl.java", "diffHunk": "@@ -37,7 +38,7 @@\n  * @since\t7.0-B4\n  *\n  */\n-public class LiquibaseImpl {\n+public class LiquibaseImpl implements INamedObject{", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7707e88a076b649f5fb14bb1a88cd6beca5dec4e"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyMjIwNzc3OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/nl/nn/adapterframework/jdbc/migration/Migrator.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxMzoxOToxNlrOHqbZMQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxMzoxOToxNlrOHqbZMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDI1MTA1Nw==", "bodyText": "You don't need to specify the ClassLoader as you can retrieve this from the Configuration.", "url": "https://github.com/ibissource/iaf/pull/1210#discussion_r514251057", "createdAt": "2020-10-29T13:19:16Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/jdbc/migration/Migrator.java", "diffHunk": "@@ -41,19 +42,16 @@ public Migrator() {\n \n \t@Override\n \tpublic void configure() throws ConfigurationException {\n-\t\tconfigure(null, null, null);\n+\t\tthrow new IllegalStateException(\"No configuration is specified!\");\n \t}\n \n-\tpublic void configure(String configurationName) throws ConfigurationException {\n-\t\tconfigure(configurationName, null, null);\n+\tpublic void configure(Configuration configuration, ClassLoader classLoader) throws ConfigurationException {\n+\t\tconfigure(configuration, classLoader, null);\n \t}\n \n-\tpublic void configure(String configurationName, ClassLoader classLoader) throws ConfigurationException {\n-\t\tconfigure(configurationName, classLoader, null);\n-\t}\n-\n-\tpublic synchronized void configure(String configurationName, ClassLoader classLoader, String changeLogFile) throws ConfigurationException {\n-\t\tsetName(\"JdbcMigrator for configuration[\"+configurationName+\"]\");\n+\tpublic synchronized void configure(Configuration configuration, ClassLoader classLoader, String changeLogFile) throws ConfigurationException {\n+\t\tsetName(\"JdbcMigrator for configuration[\"+ configuration.getName() +\"]\");\n+\t\tsuper.configure();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f40a8386a092ee6d24e943c6202385d1cc5f124f"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyMjIxNzY5OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/nl/nn/adapterframework/jdbc/DirectQuerySender.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxMzoyMTo0MVrOHqbfXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxMzoyMTo0MVrOHqbfXA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDI1MjYzNg==", "bodyText": "This can be a configuration warning", "url": "https://github.com/ibissource/iaf/pull/1210#discussion_r514252636", "createdAt": "2020-10-29T13:21:41Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/jdbc/DirectQuerySender.java", "diffHunk": "@@ -50,7 +50,7 @@ public void configure() throws ConfigurationException {\n \tpublic void configure(boolean trust) throws ConfigurationException {\n \t\tsuper.configure();\n \t\tif (!trust) {\n-\t\t\tConfigurationWarnings.add(log, \"The class [\"+ClassUtils.nameOf(this)+\"] is used one or more times. This may cause potential SQL injections!\");\n+\t\t\tConfigurationWarnings.addGlobalWarning(log, \"The class [\"+ClassUtils.nameOf(this)+\"] is used one or more times. This may cause potential SQL injections!\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f40a8386a092ee6d24e943c6202385d1cc5f124f"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyMjIyNTkzOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/nl/nn/adapterframework/configuration/IbisContext.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxMzoyMzo0M1rOHqbkhg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxMzoyMzo0M1rOHqbkhg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDI1Mzk1OA==", "bodyText": "Might be best to leave this in the try/catch, as otherwise it can prevent the configuration from starting up.", "url": "https://github.com/ibissource/iaf/pull/1210#discussion_r514253958", "createdAt": "2020-10-29T13:23:43Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/configuration/IbisContext.java", "diffHunk": "@@ -343,15 +343,15 @@ private void digestClassLoaderConfiguration(ClassLoader classLoader,\n \t\t\t\tConfigurationWarnings.getInstance().setActiveConfiguration(configuration);\n \n \t\t\t\tif(AppConstants.getInstance(classLoader).getBoolean(\"jdbc.migrator.active\", false)) {\n+\t\t\t\t\tMigrator databaseMigrator = getBean(\"jdbcMigrator\", Migrator.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f40a8386a092ee6d24e943c6202385d1cc5f124f"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyNjI4MjYyOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/nl/nn/adapterframework/jdbc/migration/Migrator.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQwNzo0OTozNFrOHrERhQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQwNzo0OTozNFrOHrERhQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDkyMDgzNw==", "bodyText": "The null check is not necessary here anymore", "url": "https://github.com/ibissource/iaf/pull/1210#discussion_r514920837", "createdAt": "2020-10-30T07:49:34Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/jdbc/migration/Migrator.java", "diffHunk": "@@ -41,30 +43,27 @@ public Migrator() {\n \n \t@Override\n \tpublic void configure() throws ConfigurationException {\n-\t\tconfigure(null, null, null);\n+\t\tthrow new IllegalStateException(\"No configuration is specified!\");\n \t}\n \n-\tpublic void configure(String configurationName) throws ConfigurationException {\n-\t\tconfigure(configurationName, null, null);\n+\tpublic void configure(Configuration configuration) throws ConfigurationException {\n+\t\tconfigure(configuration, null);\n \t}\n \n-\tpublic void configure(String configurationName, ClassLoader classLoader) throws ConfigurationException {\n-\t\tconfigure(configurationName, classLoader, null);\n-\t}\n-\n-\tpublic synchronized void configure(String configurationName, ClassLoader classLoader, String changeLogFile) throws ConfigurationException {\n-\t\tsetName(\"JdbcMigrator for configuration[\"+configurationName+\"]\");\n+\tpublic synchronized void configure(Configuration configuration, String changeLogFile) throws ConfigurationException {\n+\t\tsetName(\"JdbcMigrator for configuration[\"+ configuration.getName() +\"]\");\n+\t\tsuper.configure();\n \n-\t\tAppConstants appConstants = AppConstants.getInstance(classLoader);\n+\t\tAppConstants appConstants = AppConstants.getInstance(configuration.getClassLoader());\n \n \t\tif(changeLogFile == null)\n \t\t\tchangeLogFile = appConstants.getString(\"liquibase.changeLogFile\", \"DatabaseChangelog.xml\");\n \n-\t\tLiquibaseClassLoaderWrapper cl = new LiquibaseClassLoaderWrapper(classLoader);\n+\t\tLiquibaseClassLoaderWrapper cl = new LiquibaseClassLoaderWrapper(configuration.getClassLoader());\n \t\tif(cl.getResource(changeLogFile) == null) {\n \t\t\tString msg = \"unable to find database changelog file [\"+changeLogFile+\"]\";\n-\t\t\tif(configurationName != null)\n-\t\t\t\tmsg += \" classLoader [\"+ClassUtils.nameOf(classLoader)+\"]\";\n+\t\t\tif(configuration.getName() != null)\n+\t\t\t\tmsg += \" classLoader [\"+ClassUtils.nameOf(configuration.getClassLoader())+\"]\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "df5d019b5a86320502aee1aef0ea510974826b3e"}, "originalPosition": 47}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyNjI4Nzg3OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/nl/nn/adapterframework/unmanaged/DefaultIbisManager.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQwNzo1MTozNVrOHrEUhA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQwNzo1MTozNVrOHrEUhA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDkyMTYwNA==", "bodyText": "This can be a configuration warning", "url": "https://github.com/ibissource/iaf/pull/1210#discussion_r514921604", "createdAt": "2020-10-30T07:51:35Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/unmanaged/DefaultIbisManager.java", "diffHunk": "@@ -119,7 +119,7 @@ private void updateFlowDiagram(Configuration configuration) {\n \t\t\ttry {\n \t\t\t\tflowDiagramManager.generate(configuration);\n \t\t\t} catch (IOException e) {\n-\t\t\t\tConfigurationWarnings.add(log, \"Error generating flow diagram for configuration [\"+configuration.getName()+\"]\", e);\n+\t\t\t\tConfigurationWarnings.addGlobalWarning(log, \"Error generating flow diagram for configuration [\"+configuration.getName()+\"]\", e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "df5d019b5a86320502aee1aef0ea510974826b3e"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIyNjI4ODQ1OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/nl/nn/adapterframework/validation/XercesXmlValidator.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQwNzo1MTo0N1rOHrEU2w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQwOTozNDo1MlrOHrHYcQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDkyMTY5MQ==", "bodyText": "This can be a configuration warning", "url": "https://github.com/ibissource/iaf/pull/1210#discussion_r514921691", "createdAt": "2020-10-30T07:51:47Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/validation/XercesXmlValidator.java", "diffHunk": "@@ -132,7 +132,7 @@\n \t\t\t\tcache.open();\n \t\t\t} catch (ConfigurationException e) {\n \t\t\t\tcache = null;\n-\t\t\t\tConfigurationWarnings.add(log, \"Could not configure EhCache for XercesXmlValidator (xmlValidator.maxInitialised will be ignored)\", e);\n+\t\t\t\tConfigurationWarnings.addGlobalWarning(log, \"Could not configure EhCache for XercesXmlValidator (xmlValidator.maxInitialised will be ignored)\", e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "df5d019b5a86320502aee1aef0ea510974826b3e"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDk3MTc2MQ==", "bodyText": "it is in a static block where we don't have the configuration info", "url": "https://github.com/ibissource/iaf/pull/1210#discussion_r514971761", "createdAt": "2020-10-30T09:34:52Z", "author": {"login": "alisihab"}, "path": "core/src/main/java/nl/nn/adapterframework/validation/XercesXmlValidator.java", "diffHunk": "@@ -132,7 +132,7 @@\n \t\t\t\tcache.open();\n \t\t\t} catch (ConfigurationException e) {\n \t\t\t\tcache = null;\n-\t\t\t\tConfigurationWarnings.add(log, \"Could not configure EhCache for XercesXmlValidator (xmlValidator.maxInitialised will be ignored)\", e);\n+\t\t\t\tConfigurationWarnings.addGlobalWarning(log, \"Could not configure EhCache for XercesXmlValidator (xmlValidator.maxInitialised will be ignored)\", e);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDkyMTY5MQ=="}, "originalCommit": {"oid": "df5d019b5a86320502aee1aef0ea510974826b3e"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 605, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}