{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA2NjUyMDA4", "number": 1165, "title": "response mapping for all non empty exits in open api", "bodyText": "Fixes #1093\nFixes #1096", "createdAt": "2020-10-20T09:58:08Z", "url": "https://github.com/ibissource/iaf/pull/1165", "merged": true, "mergeCommit": {"oid": "4352815a121f8d05572d63ade4e4c4b80ba0b97e"}, "closed": true, "closedAt": "2020-10-22T07:40:35Z", "author": {"login": "alisihab"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdUVjPQgH2gAyNTA2NjUyMDA4OjVhOWJhMzUzODhkMmE5MzFiY2Q2M2I1NWFjZTRkZGJkNTlmYWNmODE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdU9AXqAFqTUxNDQ0MDkyOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5a9ba35388d2a931bcd63b55ace4ddbd59facf81", "author": {"user": {"login": "alisihab", "name": null}}, "url": "https://github.com/ibissource/iaf/commit/5a9ba35388d2a931bcd63b55ace4ddbd59facf81", "committedDate": "2020-10-20T09:42:13Z", "message": "response mapping for all non empty exits in open api"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d3e026a04a29afb5dbfe8ddde972c890a213a8b", "author": {"user": null}, "url": "https://github.com/ibissource/iaf/commit/1d3e026a04a29afb5dbfe8ddde972c890a213a8b", "committedDate": "2020-10-20T11:22:04Z", "message": "comment on the change"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEyNjgyODM0", "url": "https://github.com/ibissource/iaf/pull/1165#pullrequestreview-512682834", "createdAt": "2020-10-20T13:03:37Z", "commit": {"oid": "1d3e026a04a29afb5dbfe8ddde972c890a213a8b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEzMzc1NTkx", "url": "https://github.com/ibissource/iaf/pull/1165#pullrequestreview-513375591", "createdAt": "2020-10-21T07:22:45Z", "commit": {"oid": "1d3e026a04a29afb5dbfe8ddde972c890a213a8b"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQwNzoyMjo0NlrOHldrvQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQwNzoyMjo0NlrOHldrvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTA0NTY5Mw==", "bodyText": "What is ref is null?", "url": "https://github.com/ibissource/iaf/pull/1165#discussion_r509045693", "createdAt": "2020-10-21T07:22:46Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/http/rest/ApiServiceDispatcher.java", "diffHunk": "@@ -242,6 +242,8 @@ private JsonObjectBuilder mapResponses(IAdapter adapter, MediaTypes contentType,\n \t\t\t\tif(schema == null) {\n \t\t\t\t\tcontent.addNull(contentType.getContentType());\n \t\t\t\t} else {\n+\t\t\t\t\t// JsonObjectBuilder add method consumes the schema\n+\t\t\t\t\tschema.add(\"schema\", Json.createObjectBuilder().add(\"$ref\", \"#/components/schemas/\"+ref));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1d3e026a04a29afb5dbfe8ddde972c890a213a8b"}, "originalPosition": 32}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "74d76f45907c084cd53d7f2b3faa5d46f4fb2283", "author": {"user": null}, "url": "https://github.com/ibissource/iaf/commit/74d76f45907c084cd53d7f2b3faa5d46f4fb2283", "committedDate": "2020-10-21T08:56:34Z", "message": "add requestBody to open api schema"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEzNTAxMDA3", "url": "https://github.com/ibissource/iaf/pull/1165#pullrequestreview-513501007", "createdAt": "2020-10-21T09:50:53Z", "commit": {"oid": "74d76f45907c084cd53d7f2b3faa5d46f4fb2283"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQwOTo1MDo1M1rOHljsLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQwOTo1MDo1M1rOHljsLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTE0NDExMA==", "bodyText": "In the spirit of 'we want enums', could you refactor the ApiListener a bit?\nReplace the getProduces() and getConsumes with getProducesEnum() and getConsumesEnum. So you don't have to convert the strings back to enums on line 186 and 190?", "url": "https://github.com/ibissource/iaf/pull/1165#discussion_r509144110", "createdAt": "2020-10-21T09:50:53Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/http/rest/ApiServiceDispatcher.java", "diffHunk": "@@ -180,7 +180,12 @@ protected JsonObject generateOpenApiJsonSchema(Collection<ApiDispatchConfig> cli\n \t\t\t\t\t\tmethodBuilder.add(\"summary\", adapter.getDescription());\n \t\t\t\t\t}\n \t\t\t\t\tmethodBuilder.add(\"operationId\", adapter.getName());\n-\n+\t\t\t\t\tPipeLine pipeline = adapter.getPipeLine();\n+\t\t\t\t\tJson2XmlValidator validator = getJsonValidator(pipeline);\n+\t\t\t\t\tif(validator != null && StringUtils.isNotEmpty(validator.getRoot())) {\n+\t\t\t\t\t\tMediaTypes consumes = MediaTypes.valueOf(listener.getConsumes());\n+\t\t\t\t\t\tmethodBuilder.add(\"requestBody\", mapRequest(consumes, validator.getRoot()));\n+\t\t\t\t\t}\n \t\t\t\t\t//ContentType may have more parameters such as charset and formdata-boundry\n \t\t\t\t\tMediaTypes produces = MediaTypes.valueOf(listener.getProduces());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "74d76f45907c084cd53d7f2b3faa5d46f4fb2283"}, "originalPosition": 21}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "52431eb23abc4795b055733920529e7bcd41d100", "author": {"user": null}, "url": "https://github.com/ibissource/iaf/commit/52431eb23abc4795b055733920529e7bcd41d100", "committedDate": "2020-10-21T10:44:18Z", "message": "refactor requestBody schema, add larva scenario"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE0NDQwOTI5", "url": "https://github.com/ibissource/iaf/pull/1165#pullrequestreview-514440929", "createdAt": "2020-10-22T07:40:20Z", "commit": {"oid": "52431eb23abc4795b055733920529e7bcd41d100"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 994, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}