{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc4MjU5MTA1", "number": 444, "reviewThreads": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxMjo1MToyNFrODh3jRA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxMToxODoxMlrODnCJZg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2ODM5NzQ4OnYy", "diffSide": "LEFT", "path": "core/src/main/java/nl/nn/adapterframework/pipes/EtagHandlerPipe.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxMjo1MToyNFrOFs15Yg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxMjo1MToyNFrOFs15Yg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjU2NDcwNg==", "bodyText": "Let op: equalsIgnoreCase", "url": "https://github.com/ibissource/iaf/pull/444#discussion_r382564706", "createdAt": "2020-02-21T12:51:24Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/pipes/EtagHandlerPipe.java", "diffHunk": "@@ -90,10 +90,9 @@ public PipeRunResult doPipe(Object input, IPipeLineSession session) throws PipeR\n \t\t\ttry {\n \t\t\t\tpvl = prc.getValues(getParameterList());\n \t\t\t\tif (pvl != null) {\n-\t\t\t\t\tfor (int i = 0; i < parameterList.size(); i++) {\n-\t\t\t\t\t\tParameter parameter = parameterList.getParameter(i);\n-\t\t\t\t\t\tif(\"uriPattern\".equalsIgnoreCase(parameter.getName()))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "51d1056f627c0b828548a1ba7d16338553c80e71"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQxOTcyNDMxOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/nl/nn/adapterframework/jdbc/JdbcQuerySenderBase.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQxNjo0MDoyOFrOF0Xazg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxMjowNTozN1rOF00KdA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDQ1Mzk2Ng==", "bodyText": "Hier zat, maar nu niet meer, een null check op prc!", "url": "https://github.com/ibissource/iaf/pull/444#discussion_r390453966", "createdAt": "2020-03-10T16:40:28Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/jdbc/JdbcQuerySenderBase.java", "diffHunk": "@@ -262,18 +262,18 @@ protected String sendMessage(Connection connection, String correlationID, Messag\n \t\t\t\tif (StringUtils.isEmpty(getBlobSessionKey())) {\n \t\t\t\t\treturn executeUpdateBlobQuery(statement,message.asInputStream());\n \t\t\t\t} \n-\t\t\t\treturn executeUpdateBlobQuery(statement,prc==null?null:prc.getSession().get(getBlobSessionKey()));\n+\t\t\t\treturn executeUpdateBlobQuery(statement,session.get(getBlobSessionKey()));\n \t\t\t} \n \t\t\tif (\"updateClob\".equalsIgnoreCase(queryContext.getQueryType())) {\n \t\t\t\tif (StringUtils.isEmpty(getClobSessionKey())) {\n \t\t\t\t\treturn executeUpdateClobQuery(statement,message.asReader());\n \t\t\t\t} \n-\t\t\t\treturn executeUpdateClobQuery(statement,prc==null?null:prc.getSession().get(getClobSessionKey()));\n+\t\t\t\treturn executeUpdateClobQuery(statement,session.get(getClobSessionKey()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c0f991da12ebdf4fe5119d4209081341cd2ab96f"}, "originalPosition": 92}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDkyNDkxNg==", "bodyText": "Fixed", "url": "https://github.com/ibissource/iaf/pull/444#discussion_r390924916", "createdAt": "2020-03-11T12:05:37Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/jdbc/JdbcQuerySenderBase.java", "diffHunk": "@@ -262,18 +262,18 @@ protected String sendMessage(Connection connection, String correlationID, Messag\n \t\t\t\tif (StringUtils.isEmpty(getBlobSessionKey())) {\n \t\t\t\t\treturn executeUpdateBlobQuery(statement,message.asInputStream());\n \t\t\t\t} \n-\t\t\t\treturn executeUpdateBlobQuery(statement,prc==null?null:prc.getSession().get(getBlobSessionKey()));\n+\t\t\t\treturn executeUpdateBlobQuery(statement,session.get(getBlobSessionKey()));\n \t\t\t} \n \t\t\tif (\"updateClob\".equalsIgnoreCase(queryContext.getQueryType())) {\n \t\t\t\tif (StringUtils.isEmpty(getClobSessionKey())) {\n \t\t\t\t\treturn executeUpdateClobQuery(statement,message.asReader());\n \t\t\t\t} \n-\t\t\t\treturn executeUpdateClobQuery(statement,prc==null?null:prc.getSession().get(getClobSessionKey()));\n+\t\t\t\treturn executeUpdateClobQuery(statement,session.get(getClobSessionKey()));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDQ1Mzk2Ng=="}, "originalCommit": {"oid": "c0f991da12ebdf4fe5119d4209081341cd2ab96f"}, "originalPosition": 92}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQxOTc2NjUyOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/nl/nn/adapterframework/http/HttpSender.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQxNjo1MDozOVrOF0X2NQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQxNjo1MDozOVrOF0X2NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDQ2MDk4MQ==", "bodyText": "De session mag niet leeg zijn, anders gaat de hele sender kaduuk...", "url": "https://github.com/ibissource/iaf/pull/444#discussion_r390460981", "createdAt": "2020-03-10T16:50:39Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/http/HttpSender.java", "diffHunk": "@@ -435,7 +434,7 @@ protected FormBodyPart elementToFormBodyPart(Element element, IPipeLineSession s\n \t}\n \n \t@Override\n-\tprotected String extractResult(HttpResponseHandler responseHandler, ParameterResolutionContext prc) throws SenderException, IOException {\n+\tprotected String extractResult(HttpResponseHandler responseHandler, IPipeLineSession session) throws SenderException, IOException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c0f991da12ebdf4fe5119d4209081341cd2ab96f"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQxOTc3Njg4OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/nl/nn/adapterframework/filesystem/FileSystemPipe.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQxNjo1MzowOFrOF0X80Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxMjowNzo1MFrOF00Ofw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDQ2MjY3Mw==", "bodyText": "Waarom hier null ipv message input ?", "url": "https://github.com/ibissource/iaf/pull/444#discussion_r390462673", "createdAt": "2020-03-10T16:53:08Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/filesystem/FileSystemPipe.java", "diffHunk": "@@ -122,12 +122,11 @@ public MessageOutputStream provideOutputStream(String correlationID, IPipeLineSe\n \t@Override\n \tpublic PipeRunResult doPipe (Object input, IPipeLineSession session, IOutputStreamingSupport next) throws PipeRunException {\n \t\tParameterList paramList = getParameterList();\n-\t\tParameterResolutionContext prc = new ParameterResolutionContext(input, session);\n \t\tParameterValueList pvl=null;\n \t\t\n \t\ttry {\n \t\t\tif (paramList != null) {\n-\t\t\t\tpvl = prc.getValues(paramList);\n+\t\t\t\tpvl = paramList.getValues(null, session);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c0f991da12ebdf4fe5119d4209081341cd2ab96f"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDkyNTk1MQ==", "bodyText": "fixed", "url": "https://github.com/ibissource/iaf/pull/444#discussion_r390925951", "createdAt": "2020-03-11T12:07:50Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/filesystem/FileSystemPipe.java", "diffHunk": "@@ -122,12 +122,11 @@ public MessageOutputStream provideOutputStream(String correlationID, IPipeLineSe\n \t@Override\n \tpublic PipeRunResult doPipe (Object input, IPipeLineSession session, IOutputStreamingSupport next) throws PipeRunException {\n \t\tParameterList paramList = getParameterList();\n-\t\tParameterResolutionContext prc = new ParameterResolutionContext(input, session);\n \t\tParameterValueList pvl=null;\n \t\t\n \t\ttry {\n \t\t\tif (paramList != null) {\n-\t\t\t\tpvl = prc.getValues(paramList);\n+\t\t\t\tpvl = paramList.getValues(null, session);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDQ2MjY3Mw=="}, "originalCommit": {"oid": "c0f991da12ebdf4fe5119d4209081341cd2ab96f"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQyMjUwMDQ3OnYy", "diffSide": "RIGHT", "path": "core/src/test/java/nl/nn/adapterframework/pipes/ForEachChildElementPipeTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxMDo1ODo1OFrOF0yKDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxMDo1ODo1OFrOF0yKDg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDg5MjA0Ng==", "bodyText": "Hier wel een mooie spatie!", "url": "https://github.com/ibissource/iaf/pull/444#discussion_r390892046", "createdAt": "2020-03-11T10:58:58Z", "author": {"login": "nielsm5"}, "path": "core/src/test/java/nl/nn/adapterframework/pipes/ForEachChildElementPipeTest.java", "diffHunk": "@@ -125,12 +125,12 @@ protected ISender getElementRenderer(final SwitchCounter sc, final Exception e)\n     \tEchoSender sender = new EchoSender() {\n \n \t\t\t@Override\n-\t\t\tpublic String sendMessage(String correlationID, String message, ParameterResolutionContext prc) throws SenderException, TimeOutException {\n+\t\t\tpublic Message sendMessage(Message message, IPipeLineSession session) throws SenderException, TimeOutException, IOException {\n \t\t\t\tif (sc!=null) sc.mark(\"out\");\n-\t\t\t\tif (message.contains(\"error\")) {\n-\t\t\t\t\tthrow new SenderException(\"Exception triggered\",e);\n+\t\t\t\tif (message.asString().contains(\"error\")) {\n+\t\t\t\t\tthrow new SenderException(\"Exception triggered\", e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c0f991da12ebdf4fe5119d4209081341cd2ab96f"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQyMjUwODM2OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/nl/nn/adapterframework/webcontrol/pipes/ShowConfig.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxMTowMToxNlrOF0yO9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxMjoxMDozN1rOF00TTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDg5MzMwMg==", "bodyText": "Deze moet weg!", "url": "https://github.com/ibissource/iaf/pull/444#discussion_r390893302", "createdAt": "2020-03-11T11:01:16Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/webcontrol/pipes/ShowConfig.java", "diffHunk": "@@ -143,9 +144,8 @@ private String retrieveAllConfigs(IPipeLineSession session)\n \t\t\t\tqs.setIncludeFieldDefinition(false);\n \t\t\t\tqs.configure();\n \t\t\t\tqs.open();\n-\t\t\t\tParameterResolutionContext prc = new ParameterResolutionContext(\n-\t\t\t\t\t\t\"dummy\", session);\n-\t\t\t\tString queryResult = qs.sendMessage(\"dummy\", \"dummy\", prc);\n+\t\t\t\tParameterResolutionContext prc = new ParameterResolutionContext (\"dummy\", session);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c0f991da12ebdf4fe5119d4209081341cd2ab96f"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDkyNzE4MA==", "bodyText": "fixed", "url": "https://github.com/ibissource/iaf/pull/444#discussion_r390927180", "createdAt": "2020-03-11T12:10:37Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/webcontrol/pipes/ShowConfig.java", "diffHunk": "@@ -143,9 +144,8 @@ private String retrieveAllConfigs(IPipeLineSession session)\n \t\t\t\tqs.setIncludeFieldDefinition(false);\n \t\t\t\tqs.configure();\n \t\t\t\tqs.open();\n-\t\t\t\tParameterResolutionContext prc = new ParameterResolutionContext(\n-\t\t\t\t\t\t\"dummy\", session);\n-\t\t\t\tString queryResult = qs.sendMessage(\"dummy\", \"dummy\", prc);\n+\t\t\t\tParameterResolutionContext prc = new ParameterResolutionContext (\"dummy\", session);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDg5MzMwMg=="}, "originalCommit": {"oid": "c0f991da12ebdf4fe5119d4209081341cd2ab96f"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQyMjUwOTg4OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/nl/nn/adapterframework/webcontrol/pipes/ExecuteJdbcProperties.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxMTowMTo0M1rOF0yP4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxMjoxMTowMlrOF00ULg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDg5MzUzOA==", "bodyText": "Deze moet weg!", "url": "https://github.com/ibissource/iaf/pull/444#discussion_r390893538", "createdAt": "2020-03-11T11:01:43Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/webcontrol/pipes/ExecuteJdbcProperties.java", "diffHunk": "@@ -167,9 +167,9 @@ private String doPost(IPipeLineSession session) throws PipeRunException {\n \t\t\t\tqs.addParameter(param);\n \t\t\t\tqs.configure();\n \t\t\t\tqs.open();\n-\t\t\t\tParameterResolutionContext prc = new ParameterResolutionContext(\n+\t\t\t\tParameterResolutionContext prc = new ParameterResolutionContext (", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c0f991da12ebdf4fe5119d4209081341cd2ab96f"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDkyNzQwNg==", "bodyText": "fixed", "url": "https://github.com/ibissource/iaf/pull/444#discussion_r390927406", "createdAt": "2020-03-11T12:11:02Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/webcontrol/pipes/ExecuteJdbcProperties.java", "diffHunk": "@@ -167,9 +167,9 @@ private String doPost(IPipeLineSession session) throws PipeRunException {\n \t\t\t\tqs.addParameter(param);\n \t\t\t\tqs.configure();\n \t\t\t\tqs.open();\n-\t\t\t\tParameterResolutionContext prc = new ParameterResolutionContext(\n+\t\t\t\tParameterResolutionContext prc = new ParameterResolutionContext (", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDg5MzUzOA=="}, "originalCommit": {"oid": "c0f991da12ebdf4fe5119d4209081341cd2ab96f"}, "originalPosition": 54}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQyMjUyNDE3OnYy", "diffSide": "RIGHT", "path": "ifsa/src/main/java/nl/nn/adapterframework/webcontrol/pipes/TestIfsaService.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxMTowNjowNFrOF0yYvg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxMjoyMzoxNlrOF00qZg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDg5NTgwNg==", "bodyText": "Wat is id? Waarom hebben we id, messageId, cid en tcid!?", "url": "https://github.com/ibissource/iaf/pull/444#discussion_r390895806", "createdAt": "2020-03-11T11:06:04Z", "author": {"login": "nielsm5"}, "path": "ifsa/src/main/java/nl/nn/adapterframework/webcontrol/pipes/TestIfsaService.java", "diffHunk": "@@ -181,7 +183,9 @@ private String processMessage(String applicationId, String serviceId,\n \t\tsender.setMessageProtocol(messageProtocol);\n \t\tsender.configure();\n \t\tsender.open();\n-\t\treturn sender.sendMessage(\"testmsg_\" + Misc.createUUID(), message);\n+\t\tPipeLineSessionBase session = new PipeLineSessionBase();\n+\t\tsession.put(\"id\", \"testmsg_\" + Misc.createUUID());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c0f991da12ebdf4fe5119d4209081341cd2ab96f"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDkzMzA5NA==", "bodyText": "fixed", "url": "https://github.com/ibissource/iaf/pull/444#discussion_r390933094", "createdAt": "2020-03-11T12:23:16Z", "author": {"login": "gvanbrakel"}, "path": "ifsa/src/main/java/nl/nn/adapterframework/webcontrol/pipes/TestIfsaService.java", "diffHunk": "@@ -181,7 +183,9 @@ private String processMessage(String applicationId, String serviceId,\n \t\tsender.setMessageProtocol(messageProtocol);\n \t\tsender.configure();\n \t\tsender.open();\n-\t\treturn sender.sendMessage(\"testmsg_\" + Misc.createUUID(), message);\n+\t\tPipeLineSessionBase session = new PipeLineSessionBase();\n+\t\tsession.put(\"id\", \"testmsg_\" + Misc.createUUID());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDg5NTgwNg=="}, "originalCommit": {"oid": "c0f991da12ebdf4fe5119d4209081341cd2ab96f"}, "originalPosition": 39}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQyMjU1MTIwOnYy", "diffSide": "RIGHT", "path": "sap/src/main/java/nl/nn/adapterframework/extensions/sap/jco2/IdocSender.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxMToxNDo0OFrOF0yp4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxMjoyNjowMlrOF00voQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDkwMDE5NA==", "bodyText": "Hier moet je de message meegeven. je maakt er nu een string van, en 2 regels later weer een message", "url": "https://github.com/ibissource/iaf/pull/444#discussion_r390900194", "createdAt": "2020-03-11T11:14:48Z", "author": {"login": "nielsm5"}, "path": "sap/src/main/java/nl/nn/adapterframework/extensions/sap/jco2/IdocSender.java", "diffHunk": "@@ -65,14 +66,16 @@\n \n \t\n \t@Override\n-\tpublic String sendMessage(String correlationID, String message, ParameterResolutionContext prc) throws SenderException, TimeOutException {\n+\tpublic Message sendMessage(Message message, IPipeLineSession session) throws SenderException, TimeOutException {\n \t\tString tid=null;\n \t\ttry {\n \t\t\tParameterValueList pvl = null;\n-\t\t\tpvl=prc.getValues(paramList);\n+\t\t\tif (paramList!=null) {\n+\t\t\t\tpvl = paramList.getValues(message, session);\n+\t\t\t}\n \t\t\tSapSystem sapSystem = getSystem(pvl);\n \t\t\t\n-\t\t\tIDoc.Document idoc = parseIdoc(sapSystem,message);\n+\t\t\tIDoc.Document idoc = parseIdoc(sapSystem,message.asString());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c0f991da12ebdf4fe5119d4209081341cd2ab96f"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDkzNDQzMw==", "bodyText": "fixed", "url": "https://github.com/ibissource/iaf/pull/444#discussion_r390934433", "createdAt": "2020-03-11T12:26:02Z", "author": {"login": "gvanbrakel"}, "path": "sap/src/main/java/nl/nn/adapterframework/extensions/sap/jco2/IdocSender.java", "diffHunk": "@@ -65,14 +66,16 @@\n \n \t\n \t@Override\n-\tpublic String sendMessage(String correlationID, String message, ParameterResolutionContext prc) throws SenderException, TimeOutException {\n+\tpublic Message sendMessage(Message message, IPipeLineSession session) throws SenderException, TimeOutException {\n \t\tString tid=null;\n \t\ttry {\n \t\t\tParameterValueList pvl = null;\n-\t\t\tpvl=prc.getValues(paramList);\n+\t\t\tif (paramList!=null) {\n+\t\t\t\tpvl = paramList.getValues(message, session);\n+\t\t\t}\n \t\t\tSapSystem sapSystem = getSystem(pvl);\n \t\t\t\n-\t\t\tIDoc.Document idoc = parseIdoc(sapSystem,message);\n+\t\t\tIDoc.Document idoc = parseIdoc(sapSystem,message.asString());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDkwMDE5NA=="}, "originalCommit": {"oid": "c0f991da12ebdf4fe5119d4209081341cd2ab96f"}, "originalPosition": 37}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQyMjU2MDc4OnYy", "diffSide": "RIGHT", "path": "larva/src/main/java/nl/nn/adapterframework/testtool/SenderThread.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxMToxNzo0MlrOF0yvpg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxMjozMTo1OVrOF0060A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDkwMTY3MA==", "bodyText": "Dit moet opgeschoond worden. Je doet 2x het zelfde, ook al is de session null", "url": "https://github.com/ibissource/iaf/pull/444#discussion_r390901670", "createdAt": "2020-03-11T11:17:42Z", "author": {"login": "nielsm5"}, "path": "larva/src/main/java/nl/nn/adapterframework/testtool/SenderThread.java", "diffHunk": "@@ -34,22 +39,26 @@\n \t\tlog.debug(\"Request: \" + request);\n     }\n \n-\tSenderThread(ISenderWithParameters senderWithParameters, String request, ParameterResolutionContext parameterResolutionContext, boolean convertExceptionToMessage) {\n+\tSenderThread(ISenderWithParameters senderWithParameters, String request, IPipeLineSession session, boolean convertExceptionToMessage) {\n \t\tname = senderWithParameters.getName();\n \t\tthis.senderWithParameters = senderWithParameters;\n-\t\tthis.parameterResolutionContext = parameterResolutionContext;\n \t\tthis.request = request;\n+\t\tthis.session = session;\n \t\tthis.convertExceptionToMessage = convertExceptionToMessage;\n \t\tlog.debug(\"Creating SenderThread for ISenderWithParameters '\" + name + \"'\");\n \t\tlog.debug(\"Request: \" + request);\n \t}\n \n     public void run() {\n         try {\n+        \tif (session==null) {\n+        \t\tsession = new PipeLineSessionBase();\n+        \t}\n+        \tsession.put(IPipeLineSession.businessCorrelationIdKey, TestTool.TESTTOOL_CORRELATIONID);\n         \tif (senderWithParameters == null) {\n-\t\t\t\tresponse = sender.sendMessage(TestTool.TESTTOOL_CORRELATIONID, request);\n+\t\t\t\tresponse = sender.sendMessage(new Message(request), session).asString();\n         \t} else {\n-\t\t\t\tresponse = senderWithParameters.sendMessage(TestTool.TESTTOOL_CORRELATIONID, request, parameterResolutionContext);\n+\t\t\t\tresponse = senderWithParameters.sendMessage(new Message(request),  session).asString();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c0f991da12ebdf4fe5119d4209081341cd2ab96f"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDkzNzI5Ng==", "bodyText": "fixed", "url": "https://github.com/ibissource/iaf/pull/444#discussion_r390937296", "createdAt": "2020-03-11T12:31:59Z", "author": {"login": "gvanbrakel"}, "path": "larva/src/main/java/nl/nn/adapterframework/testtool/SenderThread.java", "diffHunk": "@@ -34,22 +39,26 @@\n \t\tlog.debug(\"Request: \" + request);\n     }\n \n-\tSenderThread(ISenderWithParameters senderWithParameters, String request, ParameterResolutionContext parameterResolutionContext, boolean convertExceptionToMessage) {\n+\tSenderThread(ISenderWithParameters senderWithParameters, String request, IPipeLineSession session, boolean convertExceptionToMessage) {\n \t\tname = senderWithParameters.getName();\n \t\tthis.senderWithParameters = senderWithParameters;\n-\t\tthis.parameterResolutionContext = parameterResolutionContext;\n \t\tthis.request = request;\n+\t\tthis.session = session;\n \t\tthis.convertExceptionToMessage = convertExceptionToMessage;\n \t\tlog.debug(\"Creating SenderThread for ISenderWithParameters '\" + name + \"'\");\n \t\tlog.debug(\"Request: \" + request);\n \t}\n \n     public void run() {\n         try {\n+        \tif (session==null) {\n+        \t\tsession = new PipeLineSessionBase();\n+        \t}\n+        \tsession.put(IPipeLineSession.businessCorrelationIdKey, TestTool.TESTTOOL_CORRELATIONID);\n         \tif (senderWithParameters == null) {\n-\t\t\t\tresponse = sender.sendMessage(TestTool.TESTTOOL_CORRELATIONID, request);\n+\t\t\t\tresponse = sender.sendMessage(new Message(request), session).asString();\n         \t} else {\n-\t\t\t\tresponse = senderWithParameters.sendMessage(TestTool.TESTTOOL_CORRELATIONID, request, parameterResolutionContext);\n+\t\t\t\tresponse = senderWithParameters.sendMessage(new Message(request),  session).asString();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDkwMTY3MA=="}, "originalCommit": {"oid": "c0f991da12ebdf4fe5119d4209081341cd2ab96f"}, "originalPosition": 62}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQyMjU2MjMwOnYy", "diffSide": "RIGHT", "path": "larva/src/main/java/nl/nn/adapterframework/testtool/TestTool.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxMToxODoxMlrOF0ywjQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxMjozMjoyOFrOF007tg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDkwMTkwMQ==", "bodyText": "Dit klopt ook niet. Moet 1 functie zijn met session, ongeacht of hij leeg is.", "url": "https://github.com/ibissource/iaf/pull/444#discussion_r390901901", "createdAt": "2020-03-11T11:18:12Z", "author": {"login": "nielsm5"}, "path": "larva/src/main/java/nl/nn/adapterframework/testtool/TestTool.java", "diffHunk": "@@ -2494,12 +2500,12 @@ private static int executeSenderWrite(String stepDisplayName, Map<String, Map<St\n \t\tMap senderInfo = (Map)queues.get(queueName);\n \t\tISender sender = (ISender)senderInfo.get(senderType + \"Sender\");\n \t\tBoolean convertExceptionToMessage = (Boolean)senderInfo.get(\"convertExceptionToMessage\");\n-\t\tParameterResolutionContext parameterResolutionContext = (ParameterResolutionContext)senderInfo.get(\"parameterResolutionContext\");\n+\t\tIPipeLineSession session = (IPipeLineSession)senderInfo.get(\"session\");\n \t\tSenderThread senderThread;\n-\t\tif (parameterResolutionContext == null) {\n+\t\tif (session == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c0f991da12ebdf4fe5119d4209081341cd2ab96f"}, "originalPosition": 169}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDkzNzUyNg==", "bodyText": "fixed", "url": "https://github.com/ibissource/iaf/pull/444#discussion_r390937526", "createdAt": "2020-03-11T12:32:28Z", "author": {"login": "gvanbrakel"}, "path": "larva/src/main/java/nl/nn/adapterframework/testtool/TestTool.java", "diffHunk": "@@ -2494,12 +2500,12 @@ private static int executeSenderWrite(String stepDisplayName, Map<String, Map<St\n \t\tMap senderInfo = (Map)queues.get(queueName);\n \t\tISender sender = (ISender)senderInfo.get(senderType + \"Sender\");\n \t\tBoolean convertExceptionToMessage = (Boolean)senderInfo.get(\"convertExceptionToMessage\");\n-\t\tParameterResolutionContext parameterResolutionContext = (ParameterResolutionContext)senderInfo.get(\"parameterResolutionContext\");\n+\t\tIPipeLineSession session = (IPipeLineSession)senderInfo.get(\"session\");\n \t\tSenderThread senderThread;\n-\t\tif (parameterResolutionContext == null) {\n+\t\tif (session == null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDkwMTkwMQ=="}, "originalCommit": {"oid": "c0f991da12ebdf4fe5119d4209081341cd2ab96f"}, "originalPosition": 169}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 486, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}