{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI0NzY1NTA0", "number": 1282, "title": "Fix #1279 EWS address parsing problem, added 'bestReplyAddress'", "bodyText": "Added <bestReplyAddress> field to email-xml", "createdAt": "2020-11-20T15:05:40Z", "url": "https://github.com/ibissource/iaf/pull/1282", "merged": true, "mergeCommit": {"oid": "e87f61a1f55dd108585c781ef5e234e77d53dcbd"}, "closed": true, "closedAt": "2020-11-24T17:00:01Z", "author": {"login": "gvanbrakel"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdeF8HWgH2gAyNTI0NzY1NTA0OjIxZDBlNmIxYTEzMzBlMzM0ZDQxZDgwNTAxMWU4ODJmZjhiYmU5YjQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdfsye1gFqTUzNzcyMjEyOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "21d0e6b1a1330e334d41d805011e882ff8bbe9b4", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/21d0e6b1a1330e334d41d805011e882ff8bbe9b4", "committedDate": "2020-11-19T17:10:09Z", "message": "First test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d40fcee0a730561554303ec26289c183e79b3439", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/d40fcee0a730561554303ec26289c183e79b3439", "committedDate": "2020-11-20T15:03:57Z", "message": "add bestReplyAddress field to email"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM2MzEwODU3", "url": "https://github.com/ibissource/iaf/pull/1282#pullrequestreview-536310857", "createdAt": "2020-11-23T09:50:21Z", "commit": {"oid": "d40fcee0a730561554303ec26289c183e79b3439"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QwOTo1MDoyMVrOH4F6qA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QwOTo1NDoxOFrOH4GEQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODU3OTI0MA==", "bodyText": "Ik zou het fijn vinden als er een regel commentaar bij staat wat het verschil tussen een from en een sender is...", "url": "https://github.com/ibissource/iaf/pull/1282#discussion_r528579240", "createdAt": "2020-11-23T09:50:21Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/filesystem/IMailFileSystem.java", "diffHunk": "@@ -25,25 +25,21 @@\n \tpublic String MAIL_MESSAGE_ID = \"Message-ID\";\n \t\n \tpublic Iterable<String> getToRecipients(M emailMessage) throws FileSystemException ;\n-\n \tpublic Iterable<String> getCCRecipients(M emailMessage) throws FileSystemException;\n-\t\n \tpublic Iterable<String> getBCCRecipients(M emailMessage) throws FileSystemException;\n \t\n \tpublic String getFrom(M emailMessage) throws FileSystemException;\n+\tpublic String getSender(M emailMessage) throws FileSystemException;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d40fcee0a730561554303ec26289c183e79b3439"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODU3OTkyNw==", "bodyText": "Moet hier geen getValidAddress(...) ?", "url": "https://github.com/ibissource/iaf/pull/1282#discussion_r528579927", "createdAt": "2020-11-23T09:51:30Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/filesystem/ExchangeFileSystem.java", "diffHunk": "@@ -697,6 +697,38 @@ public String getFrom(EmailMessage emailMessage) throws FileSystemException {\n \t\t}\n \t}\n \n+\t@Override\n+\tpublic String getSender(EmailMessage emailMessage) throws FileSystemException {\n+\t\ttry {\n+\t\t\tEmailAddress sender = emailMessage.getSender();\n+\t\t\treturn sender==null ? null : sender.getAddress();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d40fcee0a730561554303ec26289c183e79b3439"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODU4MDc2NA==", "bodyText": "Ik denk dat je als type hier beter de RETURN_PATH_HEADER constant kan gebruiken", "url": "https://github.com/ibissource/iaf/pull/1282#discussion_r528580764", "createdAt": "2020-11-23T09:52:49Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/filesystem/MailFileSystemUtils.java", "diffHunk": "@@ -88,4 +101,40 @@\n \t\t}\n \t}\n \t\n+\n+\tpublic static String findBestReplyAddress(String from, String replyTo, String sender, Map<String,Object> headers) {\n+\t\tString result;\n+\t\t\n+\t\tif (null != (result = getValidAddress(\"replyTo\", replyTo))) {\n+\t\t\treturn result; \n+\t\t}\n+\t\tif (null != (result = getValidAddress(\"from\", from))) {\n+\t\t\treturn result; \n+\t\t}\n+\t\tif (null != (result = getValidAddress(\"sender\", sender))) {\n+\t\t\treturn result; \n+\t\t}\n+\t\tObject returnPath = headers.get(RETURN_PATH_HEADER);\n+\t\tif (returnPath instanceof String && null != (result = getValidAddress(\"return path\", (String)returnPath))) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d40fcee0a730561554303ec26289c183e79b3439"}, "originalPosition": 63}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODU4MTY5Ng==", "bodyText": "type en address omdraaien? Het is een adres-type niet een type-adres\naddress [xyz] of type [abc] is invalid, vs type [abc] address [xyz] is invalid", "url": "https://github.com/ibissource/iaf/pull/1282#discussion_r528581696", "createdAt": "2020-11-23T09:54:18Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/filesystem/MailFileSystemUtils.java", "diffHunk": "@@ -88,4 +101,40 @@\n \t\t}\n \t}\n \t\n+\n+\tpublic static String findBestReplyAddress(String from, String replyTo, String sender, Map<String,Object> headers) {\n+\t\tString result;\n+\t\t\n+\t\tif (null != (result = getValidAddress(\"replyTo\", replyTo))) {\n+\t\t\treturn result; \n+\t\t}\n+\t\tif (null != (result = getValidAddress(\"from\", from))) {\n+\t\t\treturn result; \n+\t\t}\n+\t\tif (null != (result = getValidAddress(\"sender\", sender))) {\n+\t\t\treturn result; \n+\t\t}\n+\t\tObject returnPath = headers.get(RETURN_PATH_HEADER);\n+\t\tif (returnPath instanceof String && null != (result = getValidAddress(\"return path\", (String)returnPath))) {\n+\t\t\treturn result; \n+\t\t}\n+\t\treturn null;\n+\t}\n+\t\n+\tpublic static String getValidAddress(String type, String address) {\n+\t\ttry {\n+\t\t\tif (StringUtils.isEmpty(address)) {\n+\t\t\t\treturn null;\n+\t\t\t}\n+\t\t\tInternetAddress[] addresses = InternetAddress.parseHeader(address, true);\n+\t\t\tif (addresses.length==0) {\n+\t\t\t\treturn null;\n+\t\t\t} \n+\t\t\treturn InternetAddress.toString(addresses);\n+\t\t} catch (AddressException e) {\n+\t\t\tlog.warn(\"type [\"+type+\"] address [\"+address+\"] is invalid: \"+e.getMessage());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d40fcee0a730561554303ec26289c183e79b3439"}, "originalPosition": 80}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f1a6c1c77f2aca487fa94aef7285e86dfe66e490", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/f1a6c1c77f2aca487fa94aef7285e86dfe66e490", "committedDate": "2020-11-23T16:56:30Z", "message": "Special fields via additionalProperties"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b4b66df16251aaf6f5911253d8bd0fe258a01650", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/b4b66df16251aaf6f5911253d8bd0fe258a01650", "committedDate": "2020-11-24T09:27:27Z", "message": "Make replyAddressFields configurable"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "266f06a7a81c09e98f43bc1bc3717faacc736bac", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/266f06a7a81c09e98f43bc1bc3717faacc736bac", "committedDate": "2020-11-24T09:34:17Z", "message": "Add more tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM3NzIyMTI4", "url": "https://github.com/ibissource/iaf/pull/1282#pullrequestreview-537722128", "createdAt": "2020-11-24T16:59:51Z", "commit": {"oid": "266f06a7a81c09e98f43bc1bc3717faacc736bac"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1074, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}