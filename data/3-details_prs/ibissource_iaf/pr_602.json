{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAzMDk0MDM4", "number": 602, "title": "configuration to set proxy to AmazonS3FileSystem class was added", "bodyText": "", "createdAt": "2020-04-14T10:15:03Z", "url": "https://github.com/ibissource/iaf/pull/602", "merged": true, "mergeCommit": {"oid": "e185bc76f48407143a5636aa3dfbb8076bd54cab"}, "closed": true, "closedAt": "2020-04-22T06:16:25Z", "author": {"login": "ccamiletti"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcXgsHGgH2gAyNDAzMDk0MDM4OmExN2M4NmYwMTM3ZGM5ZDYyYmQxYjM0ZGY5OGM0YWFhMTM3ZGU2NDE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcaCG-4gFqTM5Nzg3MTkxNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a17c86f0137dc9d62bd1b34df98c4aaa137de641", "author": {"user": {"login": "ccamiletti", "name": "carlo"}}, "url": "https://github.com/ibissource/iaf/commit/a17c86f0137dc9d62bd1b34df98c4aaa137de641", "committedDate": "2020-04-14T10:11:29Z", "message": "configuration to set proxy to AmazonS3FileSystem class was added"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzODAyMDg3", "url": "https://github.com/ibissource/iaf/pull/602#pullrequestreview-393802087", "createdAt": "2020-04-15T14:00:23Z", "commit": {"oid": "a17c86f0137dc9d62bd1b34df98c4aaa137de641"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxNDowMDoyM1rOGF7Itw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxNDowMzoyNFrOGF7RWg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODg2NDk1MQ==", "bodyText": "I can imagine that you should only add the client configuration if the proxy configuration has really been set,\nand that if no proxy is configured, it should not be added.", "url": "https://github.com/ibissource/iaf/pull/602#discussion_r408864951", "createdAt": "2020-04-15T14:00:23Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/filesystem/AmazonS3FileSystem.java", "diffHunk": "@@ -110,7 +114,8 @@ public void open() {\n \t\tAmazonS3ClientBuilder s3ClientBuilder = AmazonS3ClientBuilder.standard()\n \t\t\t\t.withChunkedEncodingDisabled(isChunkedEncodingDisabled())\n \t\t\t\t.withForceGlobalBucketAccessEnabled(isForceGlobalBucketAccessEnabled()).withRegion(getClientRegion())\n-\t\t\t\t.withCredentials(new AWSStaticCredentialsProvider(awsCreds));\n+\t\t\t\t.withCredentials(new AWSStaticCredentialsProvider(awsCreds))\n+\t\t\t\t.withClientConfiguration(this.getProxyConfig());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a17c86f0137dc9d62bd1b34df98c4aaa137de641"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODg2NTA0Mg==", "bodyText": "You'll have to create two separate setters for this: one for proxyHost and one for proxyPort.\nCreating these two setters results in the possibility to set values in the configuration.xml, like:\nproxyHost=\"hq.proxy.insim.biz\" proxyPort=\"9400\"", "url": "https://github.com/ibissource/iaf/pull/602#discussion_r408865042", "createdAt": "2020-04-15T14:00:29Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/filesystem/AmazonS3FileSystem.java", "diffHunk": "@@ -603,5 +608,19 @@ public void setBucketCreationEnabled(boolean bucketCreationEnabled) {\n \tpublic boolean isBucketExistsThrowException() {\n \t\treturn bucketExistsThrowException;\n \t}\n+\n+\tpublic ClientConfiguration getProxyConfig() {\n+\t\treturn proxyConfig;\n+\t}\n+\n+\tpublic void setProxyConfig(String proxyHost, Integer proxyPort) {\n+\t\tif (proxyHost != null && proxyPort != null) {\n+\t\t\tproxyConfig = new ClientConfiguration();\n+\t\t\tproxyConfig.setProtocol(Protocol.HTTPS);\n+\t\t\tproxyConfig.setProxyHost(proxyHost);\n+\t\t\tproxyConfig.setProxyPort(proxyPort);\n+\t\t}\n+\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a17c86f0137dc9d62bd1b34df98c4aaa137de641"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODg2NzE2Mg==", "bodyText": "Could you show in a test that it works both with and without a proxy configured?", "url": "https://github.com/ibissource/iaf/pull/602#discussion_r408867162", "createdAt": "2020-04-15T14:03:24Z", "author": {"login": "gvanbrakel"}, "path": "test-integration/src/test/java/nl/nn/adapterframework/filesystem/AmazonS3SenderTest.java", "diffHunk": "@@ -78,6 +81,7 @@ public AmazonS3Sender createFileSystemSender(){\n \t\ts3.setAccessKey(accessKey);\n \t\ts3.setSecretKey(secretKey);\n \t\ts3.setBucketName(bucketName);\n+\t\ts3.setProxyConfig(proxyHost, proxyPort);\n \t\treturn s3;\n \t}\n ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a17c86f0137dc9d62bd1b34df98c4aaa137de641"}, "originalPosition": 26}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "67908d688df737151278e3f51b6803cd3d1ce434", "author": {"user": {"login": "ccamiletti", "name": "carlo"}}, "url": "https://github.com/ibissource/iaf/commit/67908d688df737151278e3f51b6803cd3d1ce434", "committedDate": "2020-04-15T16:27:38Z", "message": "attributes ProxyHost and ProxyPort were added"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9c525394ff64331139468d80a8e1915b30b5c2bd", "author": {"user": {"login": "ccamiletti", "name": "carlo"}}, "url": "https://github.com/ibissource/iaf/commit/9c525394ff64331139468d80a8e1915b30b5c2bd", "committedDate": "2020-04-16T07:48:44Z", "message": "creating setter and getters proxy host and port"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db50c2738e0953a09f150872d2f5aad1eb4a727c", "author": {"user": {"login": "ccamiletti", "name": "carlo"}}, "url": "https://github.com/ibissource/iaf/commit/db50c2738e0953a09f150872d2f5aad1eb4a727c", "committedDate": "2020-04-16T09:27:03Z", "message": "remove accessKey"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e29dab8d9eccc88c53094b3d25e5481e9aab0d7e", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/e29dab8d9eccc88c53094b3d25e5481e9aab0d7e", "committedDate": "2020-04-22T06:04:13Z", "message": "Merge branch 'master' into http_proxy_as3file"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3ODcxOTE2", "url": "https://github.com/ibissource/iaf/pull/602#pullrequestreview-397871916", "createdAt": "2020-04-22T06:15:33Z", "commit": {"oid": "e29dab8d9eccc88c53094b3d25e5481e9aab0d7e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1324, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}