{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA2NzExMTIx", "number": 624, "title": "PipeRunResult using Message and fix for output streaming", "bodyText": "", "createdAt": "2020-04-21T14:27:42Z", "url": "https://github.com/ibissource/iaf/pull/624", "merged": true, "mergeCommit": {"oid": "c69989560c237383dbfbcab4b4accda3dc74ded4"}, "closed": true, "closedAt": "2020-04-24T16:09:45Z", "author": {"login": "gvanbrakel"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcZ0ikwgH2gAyNDA2NzExMTIxOjEyMjUwNDg5Njk2YWM3NjQzMGZlMWY1NmNlNmU5YjNmMzExMjg5MTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcazzkgAFqTQwMDA4MjU4OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "12250489696ac76430fe1f56ce6e9b3f31128918", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/12250489696ac76430fe1f56ce6e9b3f31128918", "committedDate": "2020-04-21T14:27:01Z", "message": "PipeRunResult using Message and fix for output streaming"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "855e04f108628d1a02ac09c94d6d59391fc95910", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/855e04f108628d1a02ac09c94d6d59391fc95910", "committedDate": "2020-04-21T14:28:39Z", "message": "Merge branch 'master' into PipeRunResult_using_Message"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "95dc2e84c4cf97c378293e2a295a19d89e569ddf", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/95dc2e84c4cf97c378293e2a295a19d89e569ddf", "committedDate": "2020-04-21T14:40:43Z", "message": "Fix ClassCastException"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "56e07ba8443f35321d27f6c3dac9ce9eb227edb4", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/56e07ba8443f35321d27f6c3dac9ce9eb227edb4", "committedDate": "2020-04-21T14:55:16Z", "message": "Solve Codacy issues"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4ODc2MjMz", "url": "https://github.com/ibissource/iaf/pull/624#pullrequestreview-398876233", "createdAt": "2020-04-23T08:31:27Z", "commit": {"oid": "56e07ba8443f35321d27f6c3dac9ce9eb227edb4"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QwODozMToyN1rOGKdWkg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QxNTozNToxN1rOGKukvw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzYxOTg1OA==", "bodyText": "Nu lijkt het of de PLE een naam heeft?", "url": "https://github.com/ibissource/iaf/pull/624#discussion_r413619858", "createdAt": "2020-04-23T08:31:27Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/core/PipeLineExit.java", "diffHunk": "@@ -61,6 +61,10 @@\n \tpublic String getPath() {\n \t\treturn path;\n \t}\n+\t@Override\n+\tpublic String getName() {\n+\t\treturn getPath();\n+\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "56e07ba8443f35321d27f6c3dac9ce9eb227edb4"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzkwMjAxNQ==", "bodyText": "Misschien handig hier te documenteren wat getName in deze context representeert.", "url": "https://github.com/ibissource/iaf/pull/624#discussion_r413902015", "createdAt": "2020-04-23T15:35:17Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/core/IForwardTarget.java", "diffHunk": "@@ -0,0 +1,22 @@\n+/*\n+   Copyright 2020 WeAreFrank!\n+\n+   Licensed under the Apache License, Version 2.0 (the \"License\");\n+   you may not use this file except in compliance with the License.\n+   You may obtain a copy of the License at\n+\n+       http://www.apache.org/licenses/LICENSE-2.0\n+\n+   Unless required by applicable law or agreed to in writing, software\n+   distributed under the License is distributed on an \"AS IS\" BASIS,\n+   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+   See the License for the specific language governing permissions and\n+   limitations under the License.\n+*/\n+package nl.nn.adapterframework.core;\n+\n+public interface IForwardTarget {\n+\t\n+\tpublic String getName();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "56e07ba8443f35321d27f6c3dac9ce9eb227edb4"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "685717794f08a2814e0ae31697e1174d036a358b", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/685717794f08a2814e0ae31697e1174d036a358b", "committedDate": "2020-04-24T06:12:28Z", "message": "Simplify provideOutputStream() for pipes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f2fd682086f5f4845b54794b2c883a4c9ab34514", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/f2fd682086f5f4845b54794b2c883a4c9ab34514", "committedDate": "2020-04-24T06:12:44Z", "message": "Document IForwardTarget"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "063361f4a1a8ed13dd38e1f0c9d5a84169ee3509", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/063361f4a1a8ed13dd38e1f0c9d5a84169ee3509", "committedDate": "2020-04-24T06:51:15Z", "message": "Fix Codacy issues"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5ODc1NTQ0", "url": "https://github.com/ibissource/iaf/pull/624#pullrequestreview-399875544", "createdAt": "2020-04-24T11:48:46Z", "commit": {"oid": "063361f4a1a8ed13dd38e1f0c9d5a84169ee3509"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxMTo0ODo0NlrOGLT7tg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxMTo0ODo0NlrOGLT7tg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDUxNDEwMg==", "bodyText": "Wat doet dit? .. ?", "url": "https://github.com/ibissource/iaf/pull/624#discussion_r414514102", "createdAt": "2020-04-24T11:48:46Z", "author": {"login": "nielsm5"}, "path": "ladybug/src/main/resources/springIbisDebuggerAdvice.xml", "diffHunk": "@@ -123,17 +123,18 @@\n \t\t\t<aop:around\n \t\t\t\tpointcut=\n \t\t\t\t\t\"\n-\t \t\t\t\t\texecution(\n-\t \t\t\t\t\t\t*\n-\t \t\t\t\t\t\tnl.nn.adapterframework.stream.IOutputStreamingSupport.provideOutputStream(\n-\t \t\t\t\t\t\t\tnl.nn.adapterframework.core.IPipeLineSession, nl.nn.adapterframework.stream.IOutputStreamingSupport\n-\t \t\t\t\t\t\t)\n+\t \t\t\t\texecution(\n+\t \t\t\t\t\t*\n+\t \t\t\t\t\tnl.nn.adapterframework.stream.IOutputStreamingSupport.provideOutputStream(\n+\t \t\t\t\t\t\tnl.nn.adapterframework.core.IPipeLineSession, \n+\t \t\t\t\t\t\t..", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "063361f4a1a8ed13dd38e1f0c9d5a84169ee3509"}, "originalPosition": 22}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5ODc5Nzcw", "url": "https://github.com/ibissource/iaf/pull/624#pullrequestreview-399879770", "createdAt": "2020-04-24T11:56:03Z", "commit": {"oid": "063361f4a1a8ed13dd38e1f0c9d5a84169ee3509"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxMTo1NjowM1rOGLULgQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxMjoxNDowNVrOGLU0hQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDUxODE0NQ==", "bodyText": "wat doet deze methode nu nog??", "url": "https://github.com/ibissource/iaf/pull/624#discussion_r414518145", "createdAt": "2020-04-24T11:56:03Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/stream/StreamingPipe.java", "diffHunk": "@@ -63,66 +70,18 @@ public boolean requiresOutputStream() {\n \n \t/**\n \t * provide the outputstream, or null if a stream cannot be provided.\n-\t * If nextProvider is null, then descendants must replace it with getStreamTarget().\n+\t * Implementations should provide a forward target by calling {@link #getNextPipe()}.\n \t */\n-\t@Override\n-\tpublic MessageOutputStream provideOutputStream(IPipeLineSession session, IOutputStreamingSupport nextProvider) throws StreamingException {\n+\tpublic MessageOutputStream provideOutputStream(IPipeLineSession session) throws StreamingException {\n \t\treturn null;\n \t}\n \n-\t/**\n-\t * Descendants of this class must implement this method. When nextProvider is not null, they can use that to obtain an OutputStream to write their results to. \n-\t */\n-\tpublic abstract PipeRunResult doPipe(Message input, IPipeLineSession session, IOutputStreamingSupport nextProvider) throws PipeRunException;\n-\t\n \t@Override\n-\tpublic final PipeRunResult doPipe(Message message, IPipeLineSession session) throws PipeRunException {\n-\t\treturn doPipe(message, session, getStreamTarget());\n+\tpublic final MessageOutputStream provideOutputStream(IPipeLineSession session, IForwardTarget next) throws StreamingException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "063361f4a1a8ed13dd38e1f0c9d5a84169ee3509"}, "originalPosition": 71}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDUyMjg3NA==", "bodyText": "Waarom asString? kan het geen message blijven?\nIk zou hier return new PipeRunResult(getForward(), message); verwachten", "url": "https://github.com/ibissource/iaf/pull/624#discussion_r414522874", "createdAt": "2020-04-24T12:04:25Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/pipes/TimeoutGuardPipe.java", "diffHunk": "@@ -100,9 +100,8 @@ public PipeRunResult doPipe(Message message, IPipeLineSession session) throws Pi\n \t\tFuture future = service.submit(doPipe);\n \t\tString result = null;\n \t\ttry {\n-\t\t\tlog.debug(getLogPrefix(session) + \"setting timeout of [\"\n-\t\t\t\t\t+ timeout_work + \"] s\");\n-\t\t\tresult = (String) future.get(timeout_work, TimeUnit.SECONDS);\n+\t\t\tlog.debug(getLogPrefix(session) + \"setting timeout of [\" + timeout_work + \"] s\");\n+\t\t\tresult = Message.asString(future.get(timeout_work, TimeUnit.SECONDS));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "063361f4a1a8ed13dd38e1f0c9d5a84169ee3509"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDUyNDU5MQ==", "bodyText": "waarom geen message?", "url": "https://github.com/ibissource/iaf/pull/624#discussion_r414524591", "createdAt": "2020-04-24T12:07:24Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/pipes/Json2XmlValidator.java", "diffHunk": "@@ -144,9 +144,11 @@ public PipeRunResult doPipe(Message input, IPipeLineSession session, boolean res\n \t\t\t\tif (!getOutputFormat(session,responseMode).equalsIgnoreCase(FORMAT_JSON)) {\n \t\t\t\t\tPipeRunResult result=super.doPipe(new Message(messageToValidate),session, responseMode);\n \t\t\t\t\tif (isProduceNamespaceLessXml()) {\n-\t\t\t\t\t\tString msg=(String)result.getResult();\n-\t\t\t\t\t\tmsg=XmlUtils.removeNamespaces(msg);\n-\t\t\t\t\t\tresult.setResult(msg);\n+\t\t\t\t\t\ttry {\n+\t\t\t\t\t\t\tresult.setResult(XmlUtils.removeNamespaces(result.getResult().asString()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "063361f4a1a8ed13dd38e1f0c9d5a84169ee3509"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDUyNjY4OA==", "bodyText": "Misschien handig hier ook javadoc toe te voegen :)", "url": "https://github.com/ibissource/iaf/pull/624#discussion_r414526688", "createdAt": "2020-04-24T12:10:48Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/core/PipeLine.java", "diffHunk": "@@ -555,6 +555,21 @@ public void setPipeLineProcessor(PipeLineProcessor pipeLineProcessor) {\n \t\tthis.pipeLineProcessor = pipeLineProcessor;\n \t}\n \n+\tpublic IForwardTarget getForward(IPipe pipe, String path) throws PipeRunException {\n+\t\tif ((null==path) || (path.length()==0)){\n+\t\t\tthrow new PipeRunException(pipe, \"Pipeline of [\"+getOwner().getName()+\"] got a path that equals null or has a zero-length value from pipe [\"+pipe.getName()+\"]. Check the configuration, probably forwards are not defined for this pipe.\");\n+\t\t}\n+\t\tPipeLineExit plExit= getPipeLineExits().get(path);\n+\t\tif (plExit != null ) {\n+\t\t\treturn plExit;\n+\t\t}\n+\t\tIPipe nextPipe=getPipe(path);\n+\t\tif (nextPipe==null) {\n+\t\t\tthrow new PipeRunException(pipe, \"Pipeline of adapter [\"+ getOwner().getName()+\"] got an erroneous definition from pipe [\"+pipe.getName()+\"]. Pipe to execute [\"+path+ \"] is not defined.\");\n+\t\t}\n+\t\treturn nextPipe;\n+\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "063361f4a1a8ed13dd38e1f0c9d5a84169ee3509"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDUyODY0NQ==", "bodyText": "Is hier ook een test voor? Een adapter die een sub-adapter aanroept, en een IMessageOutputStream teruggeeft?", "url": "https://github.com/ibissource/iaf/pull/624#discussion_r414528645", "createdAt": "2020-04-24T12:14:05Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/core/IForwardTarget.java", "diffHunk": "@@ -0,0 +1,30 @@\n+/*\n+   Copyright 2020 WeAreFrank!\n+\n+   Licensed under the Apache License, Version 2.0 (the \"License\");\n+   you may not use this file except in compliance with the License.\n+   You may obtain a copy of the License at\n+\n+       http://www.apache.org/licenses/LICENSE-2.0\n+\n+   Unless required by applicable law or agreed to in writing, software\n+   distributed under the License is distributed on an \"AS IS\" BASIS,\n+   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+   See the License for the specific language governing permissions and\n+   limitations under the License.\n+*/\n+package nl.nn.adapterframework.core;\n+\n+/**\n+ * IForwardTarget represents the destination of a PipeForward, so a {@link IPipe} or {@link PipeLineExit}.\n+ * \n+ * @author Gerrit van Brakel\n+ */\n+public interface IForwardTarget {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "063361f4a1a8ed13dd38e1f0c9d5a84169ee3509"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "302da3820ed8fd6e50447d563c3364897ac157b0", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/302da3820ed8fd6e50447d563c3364897ac157b0", "committedDate": "2020-04-24T14:02:43Z", "message": "Change PipeLine.getForward() into resolveForward()"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "438780b2752c0d370b60f185f8596efde63c9c7d", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/438780b2752c0d370b60f185f8596efde63c9c7d", "committedDate": "2020-04-24T15:24:23Z", "message": "Merge branch 'master' into PipeRunResult_using_Message\n\nConflicts:\n\tcore/src/main/java/nl/nn/adapterframework/pipes/TimeoutGuardPipe.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "56926f6a36763ece617a129cac5b28868d62f556", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/56926f6a36763ece617a129cac5b28868d62f556", "committedDate": "2020-04-24T16:02:32Z", "message": "Comment out TimeoutGuardPipe deprecation, as it breaks IbisConsoleTest"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwMDgyNTg4", "url": "https://github.com/ibissource/iaf/pull/624#pullrequestreview-400082588", "createdAt": "2020-04-24T16:09:36Z", "commit": {"oid": "56926f6a36763ece617a129cac5b28868d62f556"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1333, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}