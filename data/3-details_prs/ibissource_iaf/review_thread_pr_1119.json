{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk2ODI2NzY0", "number": 1119, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxMzozNDozMFrOEp0Owg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQxNTo1NTozOVrOErrjjA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEyMjgyODE4OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/nl/nn/adapterframework/filesystem/FileSystemActor.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxMzozNDozMFrOHbt1mg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMlQxMzozNDozMFrOHbt1mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODgyNDYwMg==", "bodyText": "of contains  \\\\", "url": "https://github.com/ibissource/iaf/pull/1119#discussion_r498824602", "createdAt": "2020-10-02T13:34:30Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/filesystem/FileSystemActor.java", "diffHunk": "@@ -380,34 +384,28 @@ protected void finalize() throws Throwable {\n \t\t\t\tfileSystem.removeFolder(folder);\n \t\t\t\treturn folder;\n \t\t\t} else if (action.equalsIgnoreCase(ACTION_RENAME)) {\n-\t\t\t\tF file=getFile(input, pvl);\n-\t\t\t\tString destination = determineDestination(pvl);\n-\t\t\t\tif (destination == null) {\n-\t\t\t\t\tthrow new FileSystemException(\"unknown destination [\" + destination + \"]\");\n+\t\t\t\tF source=getFile(input, pvl);\n+\t\t\t\tString destinationName = determineDestination(pvl);\n+\t\t\t\tF destination;\n+\t\t\t\tif (destinationName.contains(\"/\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9b0bb0b00d3cf240c74575a0a9873194a6e38f05"}, "originalPosition": 60}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE0MjM3MTg1OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/nl/nn/adapterframework/filesystem/ExchangeFileSystem.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQxNTo1NDoxNVrOHelVBQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQxNTo1NDoxNVrOHelVBQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTgzMDkxNw==", "bodyText": "dit kan weg toch?", "url": "https://github.com/ibissource/iaf/pull/1119#discussion_r501830917", "createdAt": "2020-10-08T15:54:15Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/filesystem/ExchangeFileSystem.java", "diffHunk": "@@ -271,37 +273,47 @@ public Item toFile(String folder, String filename) throws FileSystemException {\n \t\tthrow new NotImplementedException(\"Cannot make item for [\"+filename+\"] file in Exchange folder [\"+folder+\"]\");\n \t}\n \n-\n-\t@Override\n-\tpublic boolean exists(Item f) throws FileSystemException {\n+\tprivate boolean itemExistsInFolder(FolderId folderId, String itemId) throws FileSystemException{\n \t\ttry {\n \t\t\tItemView view = new ItemView(1);\n \t\t\tview.getOrderBy().add(ItemSchema.DateTimeReceived, SortDirection.Ascending);\n-\t\t\tSearchFilter searchFilter =  new SearchFilter.IsEqualTo(ItemSchema.Id, f.getId().toString());\n+\t\t\tSearchFilter searchFilter =  new SearchFilter.IsEqualTo(ItemSchema.Id, itemId);\n \t\t\tFindItemsResults<Item> findResults;\n-\t\t\tfindResults = exchangeService.findItems(basefolderId,searchFilter, view);\n+\t\t\tfindResults = exchangeService.findItems(folderId,searchFilter, view);\n \t\t\treturn findResults.getTotalCount()!=0;\n \t\t} catch (Exception e) {\n \t\t\tthrow new FileSystemException(e);\n \t\t}\n \t}\n \n-\tpublic Item extractNestedItem(Item item) throws Exception {\n-\t\tIterator<Attachment> attachments = listAttachments(item);\n-\t\tif (attachments!=null) {\n-\t\t\twhile (attachments.hasNext()) {\n-\t\t\t\tAttachment attachment=attachments.next();\n-\t\t\t\tif (attachment instanceof ItemAttachment) {\n-\t\t\t\t\tItemAttachment itemAttachment = (ItemAttachment)attachment;\n-\t\t\t\t\titemAttachment.load();\n-\t\t\t\t\treturn itemAttachment.getItem();\n-\t\t\t\t}\n+\t@Override\n+\tpublic boolean exists(Item f) throws FileSystemException {\n+\t\ttry {\n+\t\t\tEmailMessage emailMessage = EmailMessage.bind(exchangeService, f.getId());\n+\t\t\treturn itemExistsInFolder(emailMessage.getParentFolderId(), f.getId().toString());\n+\t\t} catch (ServiceResponseException e) {\n+\t\t\tServiceError errorCode = e.getErrorCode();\n+\t\t\tif (errorCode == ServiceError.ErrorItemNotFound) {\n+\t\t\t\treturn false;\n \t\t\t}\n+\t\t\tthrow new FileSystemException(e);\n+\t\t} catch (Exception e) {\n+\t\t\tthrow new FileSystemException(e);\n \t\t}\n-\t\treturn null;\n \t}\n-\t\n-\t\n+\n+\t//\t@Override\n+//\tpublic boolean filenameExistsInFolder(String folder, String filename) throws FileSystemException{\n+//\t\ttry {\n+//\t\t\tFolderId folderId = findFolder(folder);\n+//\t\t\treturn itemExistsInFolder(folderId, filename);\n+//\t\t} catch (Exception e) {\n+//\t\t\tthrow new FileSystemException(e);\n+//\t\t}\n+//\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e5becb486dc93721a536a82af4925e107f85ec0d"}, "originalPosition": 73}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE0MjM3ODM2OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/nl/nn/adapterframework/filesystem/FileSystemActor.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQxNTo1NTozOVrOHelZBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQxNTo1NTozOVrOHelZBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTgzMTk0Mw==", "bodyText": "Ik snap dat je er nu niets mee wilt doen maar hier is de base64 pipe toch voor, dit moet weg!", "url": "https://github.com/ibissource/iaf/pull/1119#discussion_r501831943", "createdAt": "2020-10-08T15:55:39Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/filesystem/FileSystemActor.java", "diffHunk": "@@ -609,4 +599,12 @@ public int getNumberOfBackups() {\n \t\treturn numberOfBackups;\n \t}\n \n+\t@IbisDoc({\"9\", \"Can be set to 'encode' or 'decode' for actions \"+ACTION_READ1+\", \"+ACTION_WRITE1+\" and \"+ACTION_APPEND+\". When set the stream is base64 encoded or decoded, respectively\", \"\"})\n+\tpublic void setBase64(String base64) {\n+\t\tthis.base64 = base64;\n+\t}\n+\tpublic String getBase64() {\n+\t\treturn base64;\n+\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e5becb486dc93721a536a82af4925e107f85ec0d"}, "originalPosition": 154}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 702, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}