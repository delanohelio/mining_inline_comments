{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk3NTYxMDg5", "number": 572, "title": "XML Query Output Transformer", "bodyText": "Created an abstract transformer extending XMLFilter, and one implementation (so far).", "createdAt": "2020-04-02T12:56:26Z", "url": "https://github.com/ibissource/iaf/pull/572", "merged": true, "mergeCommit": {"oid": "7093fe6d0f6e0efef4cb49f2fb0f7cc99de4a543"}, "closed": true, "closedAt": "2020-04-03T12:37:43Z", "author": {"login": "mkmeral"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcTrzJxAH2gAyMzk3NTYxMDg5OmE2NWI3MWNkOTAxZmMwMzVmNWFmZDI1YWE4MTk4NGYyZDVkOTJjOWY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcUAKYBAFqTM4NzIxNDkzNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a65b71cd901fc035f5afd25aa81984f2d5d92c9f", "author": {"user": {"login": "mkmeral", "name": "Murat Kaan Meral"}}, "url": "https://github.com/ibissource/iaf/commit/a65b71cd901fc035f5afd25aa81984f2d5d92c9f", "committedDate": "2020-04-02T12:52:26Z", "message": "Add tests for transofmer."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "494169c4dc5ee184a10b39e0aae524c3d7dd6893", "author": {"user": {"login": "mkmeral", "name": "Murat Kaan Meral"}}, "url": "https://github.com/ibissource/iaf/commit/494169c4dc5ee184a10b39e0aae524c3d7dd6893", "committedDate": "2020-04-02T12:52:48Z", "message": "Create xml query output to csv transformer."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ea566939cbabaece14aed50cea1d12848993ac7a", "author": {"user": {"login": "mkmeral", "name": "Murat Kaan Meral"}}, "url": "https://github.com/ibissource/iaf/commit/ea566939cbabaece14aed50cea1d12848993ac7a", "committedDate": "2020-04-02T13:02:05Z", "message": "Debug transformer."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0283d16d972583b4c7c8c3058c51b64d4a8572a4", "author": {"user": {"login": "mkmeral", "name": "Murat Kaan Meral"}}, "url": "https://github.com/ibissource/iaf/commit/0283d16d972583b4c7c8c3058c51b64d4a8572a4", "committedDate": "2020-04-02T14:07:55Z", "message": "Create query output to json transformer."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0755c70ec388a8f6e98b8b5cec5fe3962740735a", "author": {"user": {"login": "mkmeral", "name": "Murat Kaan Meral"}}, "url": "https://github.com/ibissource/iaf/commit/0755c70ec388a8f6e98b8b5cec5fe3962740735a", "committedDate": "2020-04-02T14:08:17Z", "message": "Cleanup and debug query output transformers."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "43823060fe4eeacc745120b5706b28cb9909b505", "author": {"user": {"login": "mkmeral", "name": "Murat Kaan Meral"}}, "url": "https://github.com/ibissource/iaf/commit/43823060fe4eeacc745120b5706b28cb9909b505", "committedDate": "2020-04-02T14:08:58Z", "message": "Use new transformers for query output."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7c6b1c4d20469369fed7887de68f18bd438ecd25", "author": {"user": {"login": "mkmeral", "name": "Murat Kaan Meral"}}, "url": "https://github.com/ibissource/iaf/commit/7c6b1c4d20469369fed7887de68f18bd438ecd25", "committedDate": "2020-04-02T14:09:19Z", "message": "Create tests for xml query output transformers."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fea62a659e992f55ab26569ceae1db082ae39e3b", "author": {"user": {"login": "mkmeral", "name": "Murat Kaan Meral"}}, "url": "https://github.com/ibissource/iaf/commit/fea62a659e992f55ab26569ceae1db082ae39e3b", "committedDate": "2020-04-02T14:31:24Z", "message": "Add test case for xml query output transformer."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "044f6716d637382bb3efc20a68ddc17582e6b5a7", "author": {"user": {"login": "mkmeral", "name": "Murat Kaan Meral"}}, "url": "https://github.com/ibissource/iaf/commit/044f6716d637382bb3efc20a68ddc17582e6b5a7", "committedDate": "2020-04-02T14:31:40Z", "message": "Debug QueryOutputToJson."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2NjM5NTk4", "url": "https://github.com/ibissource/iaf/pull/572#pullrequestreview-386639598", "createdAt": "2020-04-02T17:25:07Z", "commit": {"oid": "044f6716d637382bb3efc20a68ddc17582e6b5a7"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxNzoyNTowOFrOF_1owQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxNzoyNjowNFrOF_1rDg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQ4MzM5Mw==", "bodyText": "Could you turn the resultType in an if else case and if none matches do asString?", "url": "https://github.com/ibissource/iaf/pull/572#discussion_r402483393", "createdAt": "2020-04-02T17:25:08Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/webcontrol/api/ExecuteJdbcQuery.java", "diffHunk": "@@ -130,30 +129,23 @@ public Response execute(LinkedHashMap<String, Object> json) throws ApiException\n \t\t\tqs.setBlobSmartGet(true);\n \t\t\tqs.configure(true);\n \t\t\tqs.open();\n-\t\t\tresult = qs.sendMessage(new Message(query), null).asString();\n+\t\t\tMessage message = qs.sendMessage(new Message(query), null);\n+\t\t\tresult = message.asString();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "044f6716d637382bb3efc20a68ddc17582e6b5a7"}, "originalPosition": 77}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQ4Mzk4Mg==", "bodyText": "We have also made a helper class for this: TestFileUtils.getTestFile(URL)", "url": "https://github.com/ibissource/iaf/pull/572#discussion_r402483982", "createdAt": "2020-04-02T17:26:04Z", "author": {"login": "nielsm5"}, "path": "core/src/test/java/nl/nn/adapterframework/jdbc/transformer/toJson.java", "diffHunk": "@@ -0,0 +1,55 @@\n+package nl.nn.adapterframework.jdbc.transformer;\n+\n+import nl.nn.adapterframework.stream.Message;\n+import org.junit.Assert;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.junit.runners.Parameterized;\n+import org.xml.sax.SAXException;\n+\n+import java.io.File;\n+import java.io.IOException;\n+import java.nio.file.Files;\n+import java.nio.file.Paths;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.List;\n+\n+@RunWith(Parameterized.class)\n+public class toJson {\n+\tprivate final static String FOLDER = \"src/test/resources/Jdbc.transformer\";\n+\tprivate File xmlFile, expectedFile;\n+\n+\tpublic toJson(File xmlFile, File expectedFile) {\n+\t\tthis.xmlFile = xmlFile;\n+\t\tthis.expectedFile = expectedFile;\n+\t}\n+\n+\t@Parameterized.Parameters\n+\tpublic static Collection<Object[]> data() {\n+\t\tList<Object[]> files = new ArrayList<>();\n+\t\tint i = 0;\n+\t\tFile xml = new File(FOLDER, i + \".xml\");\n+\t\tFile json = new File(FOLDER, i + \".json\");\n+\t\tSystem.out.println(xml.getAbsolutePath());\n+\t\twhile (xml.exists() && json.exists()) {\n+\t\t\tSystem.out.println(String.format(\"Added [%s] and [%s]\", xml.getName(), json.getName()));\n+\t\t\tfiles.add(new File[] {xml, json});\n+\t\t\ti++;\n+\t\t\txml = new File(FOLDER, i + \".xml\");\n+\t\t\tjson = new File(FOLDER, i + \".json\");\n+\t\t}\n+\n+\t\treturn files;\n+\t}\n+\n+\t@Test\n+\tpublic void doTest() throws IOException, SAXException {\n+\t\tString expected = new String(Files.readAllBytes(Paths.get(expectedFile.getAbsolutePath())));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "044f6716d637382bb3efc20a68ddc17582e6b5a7"}, "originalPosition": 48}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2OTU3NDcy", "url": "https://github.com/ibissource/iaf/pull/572#pullrequestreview-386957472", "createdAt": "2020-04-03T06:07:45Z", "commit": {"oid": "044f6716d637382bb3efc20a68ddc17582e6b5a7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QwNjowNzo0NVrOGAGOGA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QwNjowNzo0NVrOGAGOGA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjc1NTA5Ng==", "bodyText": "I suggest you use org.apache.commons.lang.StringEscapeUtils.escapeCSV() here.", "url": "https://github.com/ibissource/iaf/pull/572#discussion_r402755096", "createdAt": "2020-04-03T06:07:45Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/jdbc/transformer/QueryOutputToCSV.java", "diffHunk": "@@ -0,0 +1,55 @@\n+package nl.nn.adapterframework.jdbc.transformer;\n+\n+import org.xml.sax.Attributes;\n+import org.xml.sax.SAXException;\n+import org.xml.sax.XMLReader;\n+\n+public class QueryOutputToCSV extends AbstractQueryOutputTransformer {\n+\tpublic QueryOutputToCSV() throws SAXException {\n+\t\tsuper();\n+\t}\n+\n+\tpublic QueryOutputToCSV(XMLReader parent) {\n+\t\tsuper(parent);\n+\t}\n+\n+\t@Override\n+\tprotected void startRow() {\n+\t\toutput.append(\"\\n\");\n+\t}\n+\n+\t@Override\n+\tprotected void endRow() {\n+\t\t// Delete last comma\n+\t\toutput.deleteCharAt(output.length() - 1);\n+\t}\n+\n+\t@Override\n+\tprotected void addFieldDefinition(Attributes atts) {\n+\t\toutput.append(\"\\\"\").append(atts.getValue(\"name\")).append(\"\\\",\");\n+\t}\n+\n+\t@Override\n+\tprotected void addField(String fieldName, String value) {\n+\t\toutput.append(\"\\\"\").append(value).append(\"\\\",\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "044f6716d637382bb3efc20a68ddc17582e6b5a7"}, "originalPosition": 34}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "de0f925d170d2cc70b64e5c321da610204885b34", "author": {"user": {"login": "mkmeral", "name": "Murat Kaan Meral"}}, "url": "https://github.com/ibissource/iaf/commit/de0f925d170d2cc70b64e5c321da610204885b34", "committedDate": "2020-04-03T08:47:28Z", "message": "Escape characters in their formats."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ed199d39f3e5c5f8dac1c4171c8d7c70ebc7fee9", "author": {"user": {"login": "mkmeral", "name": "Murat Kaan Meral"}}, "url": "https://github.com/ibissource/iaf/commit/ed199d39f3e5c5f8dac1c4171c8d7c70ebc7fee9", "committedDate": "2020-04-03T11:37:31Z", "message": "Change class names."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3085e8ed97f046988f9482efc60885b21ff3b8de", "author": {"user": {"login": "mkmeral", "name": "Murat Kaan Meral"}}, "url": "https://github.com/ibissource/iaf/commit/3085e8ed97f046988f9482efc60885b21ff3b8de", "committedDate": "2020-04-03T11:38:39Z", "message": "Create XMLFilter implementation to transform to map."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4dea45a077e298f97ec2f349c807737971e4ab47", "author": {"user": {"login": "mkmeral", "name": "Murat Kaan Meral"}}, "url": "https://github.com/ibissource/iaf/commit/4dea45a077e298f97ec2f349c807737971e4ab47", "committedDate": "2020-04-03T11:49:12Z", "message": "Small changes and improvements to transformers."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7835548d0da5c81cf98cb23557c2b348398a8d8d", "author": {"user": {"login": "mkmeral", "name": "Murat Kaan Meral"}}, "url": "https://github.com/ibissource/iaf/commit/7835548d0da5c81cf98cb23557c2b348398a8d8d", "committedDate": "2020-04-03T11:49:30Z", "message": "Adapt tests."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "206c9d3ca3ee539b51abfd1948ea5101afa72d5b", "author": {"user": {"login": "mkmeral", "name": "Murat Kaan Meral"}}, "url": "https://github.com/ibissource/iaf/commit/206c9d3ca3ee539b51abfd1948ea5101afa72d5b", "committedDate": "2020-04-03T11:59:06Z", "message": "Add tests for toMap transofmer."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c77a3860a81ecaadbc410c682dda3e74663d5a43", "author": {"user": {"login": "mkmeral", "name": "Murat Kaan Meral"}}, "url": "https://github.com/ibissource/iaf/commit/c77a3860a81ecaadbc410c682dda3e74663d5a43", "committedDate": "2020-04-03T12:04:44Z", "message": "Remove unused function."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fa8de7bfc9aa7881a9f2a786833b3dbc1886a1e7", "author": {"user": {"login": "mkmeral", "name": "Murat Kaan Meral"}}, "url": "https://github.com/ibissource/iaf/commit/fa8de7bfc9aa7881a9f2a786833b3dbc1886a1e7", "committedDate": "2020-04-03T12:17:35Z", "message": "Add try/catch to throw ApiException."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3MjE0OTM0", "url": "https://github.com/ibissource/iaf/pull/572#pullrequestreview-387214934", "createdAt": "2020-04-03T12:35:54Z", "commit": {"oid": "fa8de7bfc9aa7881a9f2a786833b3dbc1886a1e7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1308, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}