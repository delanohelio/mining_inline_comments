{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk4MzM1ODQz", "number": 1124, "title": "Add option to use an adapter to determine cmis event routing", "bodyText": "", "createdAt": "2020-10-06T07:37:13Z", "url": "https://github.com/ibissource/iaf/pull/1124", "merged": true, "mergeCommit": {"oid": "5b07a21a403a84ff31d6ab9ca8b5a894f1042186"}, "closed": true, "closedAt": "2020-10-13T08:05:29Z", "author": {"login": "nielsm5"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdPj5LlAH2gAyNDk4MzM1ODQzOmE0Njk5OTE2YmIwYjFlYTM4NWEzY2EzYjU0OGY4Y2I2ZTRkY2M1NDU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdSDYjEAFqTUwNzEzODAyNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a4699916bb0b1ea385a3ca3b548f8cb6e4dcc545", "author": {"user": {"login": "nielsm5", "name": "Niels"}}, "url": "https://github.com/ibissource/iaf/commit/a4699916bb0b1ea385a3ca3b548f8cb6e4dcc545", "committedDate": "2020-10-05T13:35:14Z", "message": "Add option to use an adapter to determine cmis event routing"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyOTkyMTE1", "url": "https://github.com/ibissource/iaf/pull/1124#pullrequestreview-502992115", "createdAt": "2020-10-06T13:57:20Z", "commit": {"oid": "a4699916bb0b1ea385a3ca3b548f8cb6e4dcc545"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxMzo1NzoyMFrOHdID2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNTozOTo0MFrOHdODAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDMwMjgwOA==", "bodyText": "Hier mogen toch wel meer snorhaken", "url": "https://github.com/ibissource/iaf/pull/1124#discussion_r500302808", "createdAt": "2020-10-06T13:57:20Z", "author": {"login": "gvanbrakel"}, "path": "cmis/src/main/java/nl/nn/adapterframework/extensions/cmis/CmisUtils.java", "diffHunk": "@@ -679,14 +679,21 @@ private static XmlBuilder repositoryCapabilities2xml(RepositoryCapabilities capa\n \t\t\tif(capabilities.isVersionSpecificFilingSupported() != null)\n \t\t\t\trepositoryXml.addAttribute(\"supportsVersionSpecificFiling\", capabilities.isVersionSpecificFilingSupported());\n \n-\t\t\trepositoryXml.addAttribute(\"aclCapability\", capabilities.getAclCapability().name());\n-\t\t\trepositoryXml.addAttribute(\"changesCapability\", capabilities.getChangesCapability().name());\n-\t\t\trepositoryXml.addAttribute(\"contentStreamUpdatesCapability\", capabilities.getContentStreamUpdatesCapability().name());\n+\t\t\tif(capabilities.getAclCapability() != null)\n+\t\t\t\trepositoryXml.addAttribute(\"aclCapability\", capabilities.getAclCapability().name());\n+\t\t\tif(capabilities.getChangesCapability() != null)\n+\t\t\t\trepositoryXml.addAttribute(\"changesCapability\", capabilities.getChangesCapability().name());\n+\t\t\tif(capabilities.getContentStreamUpdatesCapability() != null)\n+\t\t\t\trepositoryXml.addAttribute(\"contentStreamUpdatesCapability\", capabilities.getContentStreamUpdatesCapability().name());\n \t\t\trepositoryXml.addSubElement(CmisUtils.creatablePropertyTypes2xml(capabilities.getCreatablePropertyTypes()));\n+\t\t\tif(capabilities.getJoinCapability() != null)\n \t\t\trepositoryXml.addAttribute(\"joinCapability\", capabilities.getJoinCapability().name());\n \t\t\trepositoryXml.addSubElement(CmisUtils.newTypeSettableAttributes2xml(capabilities.getNewTypeSettableAttributes()));\n-\t\t\trepositoryXml.addAttribute(\"orderByCapability\", capabilities.getOrderByCapability().name());\n+\t\t\tif(capabilities.getOrderByCapability() != null)\n+\t\t\t\trepositoryXml.addAttribute(\"orderByCapability\", capabilities.getOrderByCapability().name());\n+\t\t\tif(capabilities.getQueryCapability() != null)\n \t\t\trepositoryXml.addAttribute(\"queryCapability\", capabilities.getQueryCapability().name());\n+\t\t\tif(capabilities.getRenditionsCapability() != null)\n \t\t\trepositoryXml.addAttribute(\"renditionsCapability\", capabilities.getRenditionsCapability().name());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a4699916bb0b1ea385a3ca3b548f8cb6e4dcc545"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDMwNTcyNQ==", "bodyText": "Zou je dit niet proxying moeten noemen?", "url": "https://github.com/ibissource/iaf/pull/1124#discussion_r500305725", "createdAt": "2020-10-06T14:00:20Z", "author": {"login": "gvanbrakel"}, "path": "cmis/src/main/java/nl/nn/adapterframework/extensions/cmis/server/CmisEventDispatcher.java", "diffHunk": "@@ -67,14 +77,16 @@ public Element trigger(CmisEvent event, String message, CallContext callContext)\n \t}\n \n \tpublic Element trigger(CmisEvent event, String message, IPipeLineSession messageContext) {\n-\t\tCmisUtils.populateCmisAttributes(messageContext);\n-\n \t\tif(!eventListeners.containsKey(event))\n-\t\t\tthrow new CmisRuntimeException(\"event [\"+event.toString()+\"] not found\");\n+\t\t\tthrow new CmisRuntimeException(\"event [\"+event.name()+\"] not registered\");\n+\n+\t\tif(log.isDebugEnabled()) log.debug(\"bridging CmisEvent [\"+event.name()+\"]\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a4699916bb0b1ea385a3ca3b548f8cb6e4dcc545"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQwMDg5OQ==", "bodyText": "Waarom geef je niet zoiets als true of false terug, en zodat je excepties voor excepties kan bewaren?", "url": "https://github.com/ibissource/iaf/pull/1124#discussion_r500400899", "createdAt": "2020-10-06T15:39:40Z", "author": {"login": "gvanbrakel"}, "path": "cmis/src/main/java/nl/nn/adapterframework/extensions/cmis/server/CmisEventDispatcher.java", "diffHunk": "@@ -99,6 +111,29 @@ else if (XmlUtils.isWellFormed(result, \"cmis\")) {\n \t}\n \n \tpublic boolean contains(CmisEvent event) {\n-\t\treturn eventListeners.containsKey(event);\n+\t\tif(StringUtils.isNotEmpty(dispatcherName)) {\n+\t\t\tJavaListener listener = JavaListener.getListener(dispatcherName);\n+\t\t\tif(listener == null) {\n+\t\t\t\tthrow new CmisRuntimeException(\"unable to bridge cmis request, dispatcher offline\"); //Adapter registered but not started\n+\t\t\t}\n+\n+\t\t\tHashMap<String, Object> messageContext = new HashMap<>();\n+\t\t\tmessageContext.put(\"CmisEvent\", event.name());\n+\n+\t\t\ttry {\n+\t\t\t\tlistener.processRequest(null, event.name(), messageContext);\n+\t\t\t\t// Nothing is done with the result, it's purely to check if the event should be bridged or not. If not, an execption should be thrown.\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a4699916bb0b1ea385a3ca3b548f8cb6e4dcc545"}, "originalPosition": 91}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1NTQzOTcy", "url": "https://github.com/ibissource/iaf/pull/1124#pullrequestreview-505543972", "createdAt": "2020-10-09T10:17:34Z", "commit": {"oid": "a4699916bb0b1ea385a3ca3b548f8cb6e4dcc545"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQxMDoxNzozNFrOHfD0og==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQxMDoxNzozNFrOHfD0og==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjMzMDUzMA==", "bodyText": "indent!", "url": "https://github.com/ibissource/iaf/pull/1124#discussion_r502330530", "createdAt": "2020-10-09T10:17:34Z", "author": {"login": "nielsm5"}, "path": "cmis/src/main/java/nl/nn/adapterframework/extensions/cmis/CmisUtils.java", "diffHunk": "@@ -679,14 +679,21 @@ private static XmlBuilder repositoryCapabilities2xml(RepositoryCapabilities capa\n \t\t\tif(capabilities.isVersionSpecificFilingSupported() != null)\n \t\t\t\trepositoryXml.addAttribute(\"supportsVersionSpecificFiling\", capabilities.isVersionSpecificFilingSupported());\n \n-\t\t\trepositoryXml.addAttribute(\"aclCapability\", capabilities.getAclCapability().name());\n-\t\t\trepositoryXml.addAttribute(\"changesCapability\", capabilities.getChangesCapability().name());\n-\t\t\trepositoryXml.addAttribute(\"contentStreamUpdatesCapability\", capabilities.getContentStreamUpdatesCapability().name());\n+\t\t\tif(capabilities.getAclCapability() != null)\n+\t\t\t\trepositoryXml.addAttribute(\"aclCapability\", capabilities.getAclCapability().name());\n+\t\t\tif(capabilities.getChangesCapability() != null)\n+\t\t\t\trepositoryXml.addAttribute(\"changesCapability\", capabilities.getChangesCapability().name());\n+\t\t\tif(capabilities.getContentStreamUpdatesCapability() != null)\n+\t\t\t\trepositoryXml.addAttribute(\"contentStreamUpdatesCapability\", capabilities.getContentStreamUpdatesCapability().name());\n \t\t\trepositoryXml.addSubElement(CmisUtils.creatablePropertyTypes2xml(capabilities.getCreatablePropertyTypes()));\n+\t\t\tif(capabilities.getJoinCapability() != null)\n \t\t\trepositoryXml.addAttribute(\"joinCapability\", capabilities.getJoinCapability().name());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a4699916bb0b1ea385a3ca3b548f8cb6e4dcc545"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1NTQ0MTI1", "url": "https://github.com/ibissource/iaf/pull/1124#pullrequestreview-505544125", "createdAt": "2020-10-09T10:17:46Z", "commit": {"oid": "a4699916bb0b1ea385a3ca3b548f8cb6e4dcc545"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQxMDoxNzo0NlrOHfD1Fw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQxMDoxNzo0NlrOHfD1Fw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjMzMDY0Nw==", "bodyText": "indent!", "url": "https://github.com/ibissource/iaf/pull/1124#discussion_r502330647", "createdAt": "2020-10-09T10:17:46Z", "author": {"login": "nielsm5"}, "path": "cmis/src/main/java/nl/nn/adapterframework/extensions/cmis/CmisUtils.java", "diffHunk": "@@ -679,14 +679,21 @@ private static XmlBuilder repositoryCapabilities2xml(RepositoryCapabilities capa\n \t\t\tif(capabilities.isVersionSpecificFilingSupported() != null)\n \t\t\t\trepositoryXml.addAttribute(\"supportsVersionSpecificFiling\", capabilities.isVersionSpecificFilingSupported());\n \n-\t\t\trepositoryXml.addAttribute(\"aclCapability\", capabilities.getAclCapability().name());\n-\t\t\trepositoryXml.addAttribute(\"changesCapability\", capabilities.getChangesCapability().name());\n-\t\t\trepositoryXml.addAttribute(\"contentStreamUpdatesCapability\", capabilities.getContentStreamUpdatesCapability().name());\n+\t\t\tif(capabilities.getAclCapability() != null)\n+\t\t\t\trepositoryXml.addAttribute(\"aclCapability\", capabilities.getAclCapability().name());\n+\t\t\tif(capabilities.getChangesCapability() != null)\n+\t\t\t\trepositoryXml.addAttribute(\"changesCapability\", capabilities.getChangesCapability().name());\n+\t\t\tif(capabilities.getContentStreamUpdatesCapability() != null)\n+\t\t\t\trepositoryXml.addAttribute(\"contentStreamUpdatesCapability\", capabilities.getContentStreamUpdatesCapability().name());\n \t\t\trepositoryXml.addSubElement(CmisUtils.creatablePropertyTypes2xml(capabilities.getCreatablePropertyTypes()));\n+\t\t\tif(capabilities.getJoinCapability() != null)\n \t\t\trepositoryXml.addAttribute(\"joinCapability\", capabilities.getJoinCapability().name());\n \t\t\trepositoryXml.addSubElement(CmisUtils.newTypeSettableAttributes2xml(capabilities.getNewTypeSettableAttributes()));\n-\t\t\trepositoryXml.addAttribute(\"orderByCapability\", capabilities.getOrderByCapability().name());\n+\t\t\tif(capabilities.getOrderByCapability() != null)\n+\t\t\t\trepositoryXml.addAttribute(\"orderByCapability\", capabilities.getOrderByCapability().name());\n+\t\t\tif(capabilities.getQueryCapability() != null)\n \t\t\trepositoryXml.addAttribute(\"queryCapability\", capabilities.getQueryCapability().name());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a4699916bb0b1ea385a3ca3b548f8cb6e4dcc545"}, "originalPosition": 21}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2ed6fb589c16d225f020ca50277829855e04e8a4", "author": {"user": {"login": "nielsm5", "name": "Niels"}}, "url": "https://github.com/ibissource/iaf/commit/2ed6fb589c16d225f020ca50277829855e04e8a4", "committedDate": "2020-10-12T14:38:24Z", "message": "Use the dispatcherAdapter result; either true, false or an exception"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3MTM4MDI0", "url": "https://github.com/ibissource/iaf/pull/1124#pullrequestreview-507138024", "createdAt": "2020-10-13T07:24:25Z", "commit": {"oid": "2ed6fb589c16d225f020ca50277829855e04e8a4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 965, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}