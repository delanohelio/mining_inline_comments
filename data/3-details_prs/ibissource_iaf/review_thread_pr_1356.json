{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ0ODA0MTQy", "number": 1356, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNVQxNDo1MDowMFrOFLT0QQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNVQxNTozMjo0MVrOFLU4Dw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ3NDAzMzI5OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/nl/nn/adapterframework/jdbc/JdbcQueryListener.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNVQxNDo1MDowMFrOIOaHag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNVQxNDo1MDowMFrOIOaHag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTk3ODg1OA==", "bodyText": "manageability", "url": "https://github.com/ibissource/iaf/pull/1356#discussion_r551978858", "createdAt": "2021-01-05T14:50:00Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/jdbc/JdbcQueryListener.java", "diffHunk": "@@ -28,6 +29,8 @@\n  *\n  * @since   4.7\n  */\n+@Deprecated\n+@ConfigurationWarning(\"Please replace with JdbcTableListener for ease of configuration and improved managebility\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6e7f16e3605bed599ab1701f116743fb189f3e4e"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ3NDA0NDg0OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/nl/nn/adapterframework/receivers/Receiver.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNVQxNDo1MzowM1rOIOaOlQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNVQxNDo1MzowM1rOIOaOlQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTk4MDY5Mw==", "bodyText": "oeps?", "url": "https://github.com/ibissource/iaf/pull/1356#discussion_r551980693", "createdAt": "2021-01-05T14:53:03Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/receivers/Receiver.java", "diffHunk": "@@ -1954,21 +1993,22 @@ public void setMessageLog(ITransactionalStorage<Serializable> messageLog) {\n \t * returns the {@link ITransactionalStorage} if it is provided in the configuration. It is used to store messages that have been processed successfully. If present, this storage will be managed by the Receiver.\n \t */\n \tpublic ITransactionalStorage<Serializable> getMessageLog() {\n-\t\treturn messageLog!=null && messageLog instanceof ITransactionalStorage ? (ITransactionalStorage)messageLog: null;\n-\t}\n-\t/**\n-\t * returns a browser for the messageLog, either provided as a {@link IMessageBrowser} by the listener itself, or as a {@link ITransactionalStorage messageLog} in the configuration. \n-\t */\n-\tpublic IMessageBrowser<Serializable> getMessageLogBrowser() {\n-\t\treturn messageLog;\n-\t}\n-\n-\t/**\n-\t * returns a browser of messages inProcess, if provided as a {@link IMessageBrowser} by the listener itself. \n-\t */\n-\tpublic IMessageBrowser<Serializable> getInProcessBrowser() {\n-\t\treturn inProcessBrowser;\n-\t}\n+\t\tIMessageBrowser<?> messageLog =  messageBrowsers.get(ProcessState.DONE);\n+\t\treturn messageLog instanceof ITransactionalStorage ? (ITransactionalStorage)messageLog: null;\n+\t}\n+//\t/**\n+//\t * returns a browser for the messageLog, either provided as a {@link IMessageBrowser} by the listener itself, or as a {@link ITransactionalStorage messageLog} in the configuration. \n+//\t */\n+//\tpublic IMessageBrowser<Serializable> getMessageLogBrowser() {\n+//\t\treturn (IMessageBrowser<Serializable>)messageBrowsers.get(ProcessState.DONE);\n+//\t}\n+//\n+//\t/**\n+//\t * returns a browser of messages inProcess, if provided as a {@link IMessageBrowser} by the listener itself. \n+//\t */\n+//\tpublic IMessageBrowser<Serializable> getInProcessBrowser() {\n+//\t\treturn (IMessageBrowser<Serializable>)messageBrowsers.get(ProcessState.INPROCESS);\n+//\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6e7f16e3605bed599ab1701f116743fb189f3e4e"}, "originalPosition": 245}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ3NDA0OTcyOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/nl/nn/adapterframework/receivers/Receiver.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNVQxNDo1NDoxMlrOIOaRkQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNVQxNDo1NDoxMlrOIOaRkQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTk4MTQ1Nw==", "bodyText": "oeps", "url": "https://github.com/ibissource/iaf/pull/1356#discussion_r551981457", "createdAt": "2021-01-05T14:54:12Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/receivers/Receiver.java", "diffHunk": "@@ -1929,20 +1967,21 @@ public void setErrorStorage(ITransactionalStorage<Serializable> errorStorage) {\n \t * returns the {@link ITransactionalStorage} if it is provided in the configuration. It is used to store failed messages. If present, this storage will be managed by the Receiver.\n \t */\n \tpublic ITransactionalStorage<Serializable> getErrorStorage() {\n-\t\treturn errorStorage!=null && errorStorage instanceof ITransactionalStorage ? (ITransactionalStorage)errorStorage: null;\n-\t}\n-\t/**\n-\t * returns a browser for the errorStorage, either provided as a {@link IMessageBrowser} by the listener itself, or as a {@link ITransactionalStorage} in the configuration. \n-\t */\n-\tpublic IMessageBrowser<Serializable> getErrorStorageBrowser() {\n-\t\treturn errorStorage;\n-\t}\n+\t\tIMessageBrowser<?> errorStorage =  messageBrowsers.get(ProcessState.ERROR);\n+\t\treturn errorStorage instanceof ITransactionalStorage ? (ITransactionalStorage)errorStorage: null;\n+\t}\n+//\t/**\n+//\t * returns a browser for the errorStorage, either provided as a {@link IMessageBrowser} by the listener itself, or as a {@link ITransactionalStorage} in the configuration. \n+//\t */\n+//\tpublic IMessageBrowser<Serializable> getErrorStorageBrowser() {\n+//\t\treturn (IMessageBrowser<Serializable>)messageBrowsers.get(ProcessState.ERROR);\n+//\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6e7f16e3605bed599ab1701f116743fb189f3e4e"}, "originalPosition": 200}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ3NDE3NjMzOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/nl/nn/adapterframework/core/IHasProcessState.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNVQxNToyNTo0M1rOIObg9w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNVQxNTozMTozNFrOIObw_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjAwMTc4Mw==", "bodyText": "changeProcessState", "url": "https://github.com/ibissource/iaf/pull/1356#discussion_r552001783", "createdAt": "2021-01-05T15:25:43Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/core/IHasProcessState.java", "diffHunk": "@@ -0,0 +1,45 @@\n+/*\n+   Copyright 2020 WeAreFrank!\n+\n+   Licensed under the Apache License, Version 2.0 (the \"License\");\n+   you may not use this file except in compliance with the License.\n+   You may obtain a copy of the License at\n+\n+       http://www.apache.org/licenses/LICENSE-2.0\n+\n+   Unless required by applicable law or agreed to in writing, software\n+   distributed under the License is distributed on an \"AS IS\" BASIS,\n+   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+   See the License for the specific language governing permissions and\n+   limitations under the License.\n+*/\n+package nl.nn.adapterframework.core;\n+\n+import java.util.Map;\n+import java.util.Set;\n+\n+/**\n+ * Interface that can be implemented by Listeners that provide their own management of\n+ * messages processed and in error.\n+ * \n+ * @see IUsesInProcessState\n+ */\n+public interface IHasProcessState<M> {\n+\n+\t/**\n+\t * Provides the set of ProcessStates used by this listener.\n+\t */\n+\tpublic Set<ProcessState> knownProcessStates();\n+\t\n+\t/**\n+\t * Provides the set of ProcessStates that a message in the specified state can be moved to, e.g. from a MessageBrowser for that state.\n+\t */\n+\tpublic Map<ProcessState,Set<ProcessState>> targetProcessStates();\n+\n+\t/**\n+\t * Change the processState of the message.\n+\t * If it returns <code>true</code>, this signals that the active transaction must be committed to make other threads aware of the state change.\n+\t */\n+\tpublic boolean moveToProcessState(M message, ProcessState toState, Map<String,Object> context) throws ListenerException;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6e7f16e3605bed599ab1701f116743fb189f3e4e"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjAwNTg4Ng==", "bodyText": "Misschien ook iets beter documenteren", "url": "https://github.com/ibissource/iaf/pull/1356#discussion_r552005886", "createdAt": "2021-01-05T15:31:34Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/core/IHasProcessState.java", "diffHunk": "@@ -0,0 +1,45 @@\n+/*\n+   Copyright 2020 WeAreFrank!\n+\n+   Licensed under the Apache License, Version 2.0 (the \"License\");\n+   you may not use this file except in compliance with the License.\n+   You may obtain a copy of the License at\n+\n+       http://www.apache.org/licenses/LICENSE-2.0\n+\n+   Unless required by applicable law or agreed to in writing, software\n+   distributed under the License is distributed on an \"AS IS\" BASIS,\n+   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+   See the License for the specific language governing permissions and\n+   limitations under the License.\n+*/\n+package nl.nn.adapterframework.core;\n+\n+import java.util.Map;\n+import java.util.Set;\n+\n+/**\n+ * Interface that can be implemented by Listeners that provide their own management of\n+ * messages processed and in error.\n+ * \n+ * @see IUsesInProcessState\n+ */\n+public interface IHasProcessState<M> {\n+\n+\t/**\n+\t * Provides the set of ProcessStates used by this listener.\n+\t */\n+\tpublic Set<ProcessState> knownProcessStates();\n+\t\n+\t/**\n+\t * Provides the set of ProcessStates that a message in the specified state can be moved to, e.g. from a MessageBrowser for that state.\n+\t */\n+\tpublic Map<ProcessState,Set<ProcessState>> targetProcessStates();\n+\n+\t/**\n+\t * Change the processState of the message.\n+\t * If it returns <code>true</code>, this signals that the active transaction must be committed to make other threads aware of the state change.\n+\t */\n+\tpublic boolean moveToProcessState(M message, ProcessState toState, Map<String,Object> context) throws ListenerException;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjAwMTc4Mw=="}, "originalCommit": {"oid": "6e7f16e3605bed599ab1701f116743fb189f3e4e"}, "originalPosition": 43}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ3NDIwNjg3OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/nl/nn/adapterframework/filesystem/FileSystemListener.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNVQxNTozMjo0MVrOIOb0Wg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNVQxNTozMjo0MVrOIOb0Wg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjAwNjc0Ng==", "bodyText": "Check if stateFolder != null", "url": "https://github.com/ibissource/iaf/pull/1356#discussion_r552006746", "createdAt": "2021-01-05T15:32:41Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/filesystem/FileSystemListener.java", "diffHunk": "@@ -314,28 +339,42 @@ public String getIdFromRawMessage(F rawMessage, Map<String, Object> threadContex\n \t\t}\n \t}\n \n-\tprotected IMessageBrowser<F> getMessageBrowser(String folder) {\n-\t\tif (isDisableMessageBrowsers() || StringUtils.isEmpty(folder)) {\n-\t\t\treturn null;\n-\t\t}\n-\t\treturn new FileSystemMessageBrowser<F, FS>(fileSystem, folder, getMessageIdPropertyKey());\n-\t}\t\n-\t\n \t@Override\n-\tpublic IMessageBrowser<F> getInProcessBrowser() {\n-\t\treturn getMessageBrowser(getInProcessFolder());\n+\tpublic boolean moveToProcessState(F message, ProcessState toState, Map<String,Object> context) throws ListenerException {\n+\t\ttry {\n+\t\t\tgetFileSystem().moveFile(message, getStateFolder(toState), false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6e7f16e3605bed599ab1701f116743fb189f3e4e"}, "originalPosition": 80}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 548, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}