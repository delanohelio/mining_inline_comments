{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM1OTc3MzA0", "number": 840, "reviewThreads": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxMToyNzo0OFrOEGtcOg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxMzoyNTozM1rOEHHX-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1NDcxNDE4OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/nl/nn/adapterframework/cache/CacheAdapterBase.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxMToyNzo0OFrOGlrIDQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxMToyNzo0OFrOGlrIDQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjE1NzA2OQ==", "bodyText": "Message.asMessage()", "url": "https://github.com/ibissource/iaf/pull/840#discussion_r442157069", "createdAt": "2020-06-18T11:27:48Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/cache/CacheAdapterBase.java", "diffHunk": "@@ -102,26 +103,26 @@ public String transformKey(String input, IPipeLineSession session) {\n \t}\n \n \t@Override\n-\tpublic V transformValue(String value, IPipeLineSession session) {\n+\tpublic V transformValue(Message value, IPipeLineSession session) {\n \t\tif (StringUtils.isNotEmpty(getValueInputSessionKey()) && session!=null) {\n-\t\t\tvalue=(String)session.get(getValueInputSessionKey());\n+\t\t\tvalue=Message.asMessage(session.get(getValueInputSessionKey()));\n \t\t}\n \t\tif (valueTp!=null) {\n \t\t\ttry{\n-\t\t\t\tvalue=valueTp.transform(value, null);\n+\t\t\t\tvalue=new Message(valueTp.transform(value, null));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4306bb287dc91660fb9d38cca8f0707579104426"}, "originalPosition": 37}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1NDczODI2OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/nl/nn/adapterframework/errormessageformatters/ErrorMessageFormatter.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxMTozNTo0N1rOGlrXHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxMTozNTo0N1rOGlrXHA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjE2MDkyNA==", "bodyText": "Graag in de warning ook het messageid verwerken zodat het aan iets gecorreleerd kan worden.", "url": "https://github.com/ibissource/iaf/pull/840#discussion_r442160924", "createdAt": "2020-06-18T11:35:47Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/errormessageformatters/ErrorMessageFormatter.java", "diffHunk": "@@ -92,7 +94,12 @@ public String format(String errorMessage, Throwable t, INamedObject location, St\n \t\t\toriginalMessageXml.addAttribute(\"receivedTime\", new Date(receivedTime).toString());\n \t\t}\n \t\t// originalMessageXml.setCdataValue(originalMessage);\n-\t\toriginalMessageXml.setValue(originalMessage, true);\n+\t\ttry {\n+\t\t\toriginalMessageXml.setValue(originalMessage.asString(), true);\n+\t\t} catch (IOException e) {\n+\t\t\tlog.warn(\"Could not transform originalMessage\",e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4306bb287dc91660fb9d38cca8f0707579104426"}, "originalPosition": 37}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1NDc0NTQ2OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/nl/nn/adapterframework/extensions/bis/BisJmsListener.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxMTozODoxMFrOGlrbeQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxMTozODoxMFrOGlrbeQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjE2MjA0MQ==", "bodyText": "Is het niet verstanding/handig hier Message.asMessage() te gebruiken?", "url": "https://github.com/ibissource/iaf/pull/840#discussion_r442162041", "createdAt": "2020-06-18T11:38:10Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/extensions/bis/BisJmsListener.java", "diffHunk": "@@ -204,20 +205,20 @@ public String extractMessageBody(String rawMessageText, Map<String,Object> conte\n \t}\n \n \t@Override\n-\tpublic String prepareReply(String rawReply, Map<String,Object> threadContext) throws ListenerException {\n+\tpublic Message prepareReply(Message rawReply, Map<String,Object> threadContext) throws ListenerException {\n \t\tString originalMessageText = (String) threadContext.get(MESSAGETEXT_KEY);\n \t\tString messageBodyNamespace = (String) threadContext.get(MESSAGEBODYNAMESPACE_KEY);\n-\t\tif (isLayByNamespace() && messageBodyNamespace != null) {\n-\t\t\trawReply = XmlUtils.addRootNamespace(rawReply, messageBodyNamespace);\n-\t\t}\n-\t\tString errorCode = null;\n-\t\tif (StringUtils.isNotEmpty(getErrorCodeSessionKey())) {\n-\t\t\terrorCode = (String) threadContext.get(getErrorCodeSessionKey());\n-\t\t}\n \t\tString messageHeader;\n \t\tString payload;\n-\t\tString result;\n \t\ttry {\n+\t\t\tif (isLayByNamespace() && messageBodyNamespace != null) {\n+\t\t\t\trawReply = new Message(XmlUtils.addRootNamespace(rawReply.asString(), messageBodyNamespace));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4306bb287dc91660fb9d38cca8f0707579104426"}, "originalPosition": 43}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1NDc1MzA0OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/nl/nn/adapterframework/extensions/bis/BisJmsListener.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxMTo0MDozN1rOGlrgLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxMTo0MDozN1rOGlrgLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjE2MzI0Ng==", "bodyText": "Is het handig om deze methode een Message terug te laten geven? in de super zit een soapwrapper die, hopelijk, ook omgezet wordt naar een message. Het zou zonde zijn als in die methode asString kwam te staan.", "url": "https://github.com/ibissource/iaf/pull/840#discussion_r442163246", "createdAt": "2020-06-18T11:40:37Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/extensions/bis/BisJmsListener.java", "diffHunk": "@@ -229,7 +230,7 @@ public String prepareReply(String rawReply, Map<String,Object> threadContext) th\n \t\t} catch (Exception e) {\n \t\t\tthrow new ListenerException(e);\n \t\t}\n-\t\treturn super.prepareReply(payload, threadContext, isMessageHeaderInSoapBody() ? null : messageHeader);\n+\t\treturn super.prepareReply(new Message(payload), threadContext, isMessageHeaderInSoapBody() ? null : messageHeader);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4306bb287dc91660fb9d38cca8f0707579104426"}, "originalPosition": 58}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1NDc3MjA1OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/nl/nn/adapterframework/extensions/mqtt/MqttListener.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxMTo0NzowM1rOGlrsBQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxMTo0NzowM1rOGlrsBQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjE2NjI3Nw==", "bodyText": "Ik snap wat er gebeurd maar vind het stom. Nu wordt een byte[] omgezet naar een String (met de juiste charset) om vervolgens een Message te worken. Is het een idee Message een charset mee te geven?", "url": "https://github.com/ibissource/iaf/pull/840#discussion_r442166277", "createdAt": "2020-06-18T11:47:03Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/extensions/mqtt/MqttListener.java", "diffHunk": "@@ -164,9 +166,12 @@ public String getIdFromRawMessage(MqttMessage rawMessage, Map<String, Object> co\n \t}\n \n \t@Override\n-\tpublic String getStringFromRawMessage(MqttMessage rawMessage, Map<String, Object> context) throws ListenerException {\n+\tpublic Message extractMessage(MqttMessage rawMessage, Map<String, Object> context) throws ListenerException {\n+\t\tif (StreamUtil.DEFAULT_INPUT_STREAM_ENCODING.equalsIgnoreCase(getCharset())) {\n+\t\t\treturn new Message(rawMessage.getPayload());\n+\t\t}\n \t\ttry {\n-\t\t\treturn new String(rawMessage.getPayload(), getCharset());\n+\t\t\treturn new Message(new String(rawMessage.getPayload(), getCharset()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4306bb287dc91660fb9d38cca8f0707579104426"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1NDc5Mzg3OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/nl/nn/adapterframework/http/PushingListenerAdapter.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxMTo1Mzo1NlrOGlr5og==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxNToxOTowMVrOGl0QZg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjE2OTc2Mg==", "bodyText": "Kan je niet beter of een combined catch cause van maken of een catch(IOException e){...} toevoegen?", "url": "https://github.com/ibissource/iaf/pull/840#discussion_r442169762", "createdAt": "2020-06-18T11:53:56Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/http/PushingListenerAdapter.java", "diffHunk": "@@ -84,14 +86,18 @@ public String processRequest(String correlationId, String message, Map<String, O\n \t\ttry {\n \t\t\tlog.debug(\"PushingListenerAdapter.processRequest() for correlationId [\"+correlationId+\"]\");\n \t\t\t// serviceclient has no rawMessage, but it has no afterMessageProcessed either, therefor rawMessage can safely be null in handler.processRequest()\n-\t\t\treturn handler.processRequest(this, correlationId, null, message, requestContext); \n+\t\t\ttry {\n+\t\t\t\treturn handler.processRequest(this, correlationId, null, new Message(message), requestContext).asString();\n+\t\t\t} catch (IOException e) {\n+\t\t\t\tthrow new ListenerException(e);\n+\t\t\t} \n \t\t} catch (ListenerException e) {\n \t\t\tif (isApplicationFaultsAsExceptions()) {\n \t\t\t\tlog.debug(\"PushingListenerAdapter.processRequest() rethrows ListenerException...\");\n \t\t\t\tthrow e;\n \t\t\t} ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4306bb287dc91660fb9d38cca8f0707579104426"}, "originalPosition": 58}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjMwNjY2Mg==", "bodyText": "Dan moet ik ook die afhandelingscode dupliceren, of daarin gaan checken of het een ListenerException is", "url": "https://github.com/ibissource/iaf/pull/840#discussion_r442306662", "createdAt": "2020-06-18T15:19:01Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/http/PushingListenerAdapter.java", "diffHunk": "@@ -84,14 +86,18 @@ public String processRequest(String correlationId, String message, Map<String, O\n \t\ttry {\n \t\t\tlog.debug(\"PushingListenerAdapter.processRequest() for correlationId [\"+correlationId+\"]\");\n \t\t\t// serviceclient has no rawMessage, but it has no afterMessageProcessed either, therefor rawMessage can safely be null in handler.processRequest()\n-\t\t\treturn handler.processRequest(this, correlationId, null, message, requestContext); \n+\t\t\ttry {\n+\t\t\t\treturn handler.processRequest(this, correlationId, null, new Message(message), requestContext).asString();\n+\t\t\t} catch (IOException e) {\n+\t\t\t\tthrow new ListenerException(e);\n+\t\t\t} \n \t\t} catch (ListenerException e) {\n \t\t\tif (isApplicationFaultsAsExceptions()) {\n \t\t\t\tlog.debug(\"PushingListenerAdapter.processRequest() rethrows ListenerException...\");\n \t\t\t\tthrow e;\n \t\t\t} ", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjE2OTc2Mg=="}, "originalCommit": {"oid": "4306bb287dc91660fb9d38cca8f0707579104426"}, "originalPosition": 58}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1NDgwMDAxOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/nl/nn/adapterframework/jdbc/JdbcListener.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxMTo1NTo1MVrOGlr9fw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxNToyMTozMVrOGl0XWw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjE3MDc1MQ==", "bodyText": "Hier zou het mee kunnen geven van de charset aan de Message ook goed van pas komen", "url": "https://github.com/ibissource/iaf/pull/840#discussion_r442170751", "createdAt": "2020-06-18T11:55:51Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/jdbc/JdbcListener.java", "diffHunk": "@@ -209,20 +210,20 @@ protected Object getRawMessage(Connection conn, Map<String,Object> threadContext\n \t\t\t\t\t\tString key=rs.getString(getKeyField());\n \t\t\t\t\t\t\n \t\t\t\t\t\tif (StringUtils.isNotEmpty(getMessageField())) {\n-\t\t\t\t\t\t\tString message;\n+\t\t\t\t\t\t\tMessage message;\n \t\t\t\t\t\t\tif (\"clob\".equalsIgnoreCase(getMessageFieldType())) {\n-\t\t\t\t\t\t\t\tmessage=JdbcUtil.getClobAsString(rs,getMessageField(),false);\n+\t\t\t\t\t\t\t\tmessage=new Message(JdbcUtil.getClobAsString(rs,getMessageField(),false));\n \t\t\t\t\t\t\t} else {\n \t\t\t\t\t\t\t\tif (\"blob\".equalsIgnoreCase(getMessageFieldType())) {\n-\t\t\t\t\t\t\t\t\tmessage=JdbcUtil.getBlobAsString(rs,getMessageField(),getBlobCharset(),false,isBlobsCompressed(),isBlobSmartGet(),false);\n+\t\t\t\t\t\t\t\t\tmessage=new Message(JdbcUtil.getBlobAsString(rs,getMessageField(),getBlobCharset(),false,isBlobsCompressed(),isBlobSmartGet(),false)); // TODO: should not convert Blob to String, but keep as byte array", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4306bb287dc91660fb9d38cca8f0707579104426"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjMwODQ0Mw==", "bodyText": "Eens, maar ga nu niet de blob handling overhoop halen. Heb er een issue voor gemaakt.", "url": "https://github.com/ibissource/iaf/pull/840#discussion_r442308443", "createdAt": "2020-06-18T15:21:31Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/jdbc/JdbcListener.java", "diffHunk": "@@ -209,20 +210,20 @@ protected Object getRawMessage(Connection conn, Map<String,Object> threadContext\n \t\t\t\t\t\tString key=rs.getString(getKeyField());\n \t\t\t\t\t\t\n \t\t\t\t\t\tif (StringUtils.isNotEmpty(getMessageField())) {\n-\t\t\t\t\t\t\tString message;\n+\t\t\t\t\t\t\tMessage message;\n \t\t\t\t\t\t\tif (\"clob\".equalsIgnoreCase(getMessageFieldType())) {\n-\t\t\t\t\t\t\t\tmessage=JdbcUtil.getClobAsString(rs,getMessageField(),false);\n+\t\t\t\t\t\t\t\tmessage=new Message(JdbcUtil.getClobAsString(rs,getMessageField(),false));\n \t\t\t\t\t\t\t} else {\n \t\t\t\t\t\t\t\tif (\"blob\".equalsIgnoreCase(getMessageFieldType())) {\n-\t\t\t\t\t\t\t\t\tmessage=JdbcUtil.getBlobAsString(rs,getMessageField(),getBlobCharset(),false,isBlobsCompressed(),isBlobSmartGet(),false);\n+\t\t\t\t\t\t\t\t\tmessage=new Message(JdbcUtil.getBlobAsString(rs,getMessageField(),getBlobCharset(),false,isBlobsCompressed(),isBlobSmartGet(),false)); // TODO: should not convert Blob to String, but keep as byte array", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjE3MDc1MQ=="}, "originalCommit": {"oid": "4306bb287dc91660fb9d38cca8f0707579104426"}, "originalPosition": 42}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1NDgwNTM4OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/nl/nn/adapterframework/jms/JMSFacade.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxMTo1NzoyOFrOGlsA0g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxMTo1NzoyOFrOGlsA0g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjE3MTYwMg==", "bodyText": "Als je hem niet meer gebruikt mag hij weg toch?", "url": "https://github.com/ibissource/iaf/pull/840#discussion_r442171602", "createdAt": "2020-06-18T11:57:28Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/jms/JMSFacade.java", "diffHunk": "@@ -24,7 +24,7 @@\n import javax.jms.Destination;\n import javax.jms.InvalidDestinationException;\n import javax.jms.JMSException;\n-import javax.jms.Message;\n+//import javax.jms.Message;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4306bb287dc91660fb9d38cca8f0707579104426"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1NDgxMjg3OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/nl/nn/adapterframework/jms/JmsListenerBase.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxMTo1OTo1M1rOGlsFzA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxMTo1OTo1M1rOGlsFzA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjE3Mjg3Ng==", "bodyText": "Hier misschien ook Message.asMessage(..) gebruiken?", "url": "https://github.com/ibissource/iaf/pull/840#discussion_r442172876", "createdAt": "2020-06-18T11:59:53Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/jms/JmsListenerBase.java", "diffHunk": "@@ -250,29 +251,33 @@ protected String retrieveIdFromMessage(Message message, Map<String, Object> thre\n \t * other parameters from the message and put those in the threadContext.\n \t * @return String  input message for adapter.\n \t */\n-\tpublic String getStringFromRawMessage(Message rawMessage, Map<String,Object> threadContext) throws ListenerException {\n+\tpublic Message extractMessage(javax.jms.Message rawMessage, Map<String,Object> threadContext) throws ListenerException {\n \t\ttry {\n-\t\t\treturn getStringFromRawMessage(rawMessage, threadContext, isSoap(), getSoapHeaderSessionKey(),soapWrapper);\n+\t\t\treturn extractMessage(rawMessage, threadContext, isSoap(), getSoapHeaderSessionKey(), soapWrapper);\n \t\t} catch (Exception e) {\n \t\t\tthrow new ListenerException(e);\n \t\t}\n \t}\n \n-\tpublic String prepareReply(String rawReply, Map<String,Object> threadContext) throws ListenerException {\n+\tpublic Message prepareReply(Message rawReply, Map<String,Object> threadContext) throws ListenerException {\n \t\treturn prepareReply(rawReply, threadContext, null);\n \t}\n \n-\tpublic String prepareReply(String rawReply, Map<String,Object> threadContext, String soapHeader) throws ListenerException {\n+\tpublic Message prepareReply(Message rawReply, Map<String,Object> threadContext, String soapHeader) throws ListenerException {\n \t\tif (!isSoap()) {\n \t\t\treturn rawReply;\n \t\t}\n-\t\tString replyMessage;\n+\t\tMessage replyMessage;\n \t\tif (soapHeader==null) {\n \t\t\tif (StringUtils.isNotEmpty(getSoapHeaderSessionKey())) {\n \t\t\t\tsoapHeader=(String)threadContext.get(getSoapHeaderSessionKey());\n \t\t\t}\n \t\t}\n-\t\treplyMessage = soapWrapper.putInEnvelope(rawReply, getReplyEncodingStyleURI(),getReplyNamespaceURI(),soapHeader);\n+\t\ttry {\n+\t\t\treplyMessage = new Message(soapWrapper.putInEnvelope(rawReply.asString(), getReplyEncodingStyleURI(),getReplyNamespaceURI(),soapHeader));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4306bb287dc91660fb9d38cca8f0707579104426"}, "originalPosition": 92}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1NDg0OTUwOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/nl/nn/adapterframework/jms/PullingJmsListener.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxMjoxMTozNFrOGlscnw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxMjoxMTozNFrOGlscnw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjE3ODcxOQ==", "bodyText": "Ik denk dat het mooier is als de send message hier een adaperframework message accepteert. Wij gebruiken nu alleen jms TextMessages, maar er zijn er nog meer.. (BytesMessage, MapMessage, ObjectMessage, StreamMessage).\nDie hoeft niet nu, maar misschien handig als comment ergens bij te zetten.", "url": "https://github.com/ibissource/iaf/pull/840#discussion_r442178719", "createdAt": "2020-06-18T12:11:34Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/jms/PullingJmsListener.java", "diffHunk": "@@ -212,12 +211,12 @@ public void afterMessageProcessed(PipeLineResult plr, Object rawMessageOrWrapper\n \t\t\t\tif (session==null) { \n \t\t\t\t\ttry {\n \t\t\t\t\t\tsession=getSession(threadContext);\n-\t\t\t\t\t\tsend(session, replyTo, cid, prepareReply(plr.getResult(),threadContext), getReplyMessageType(), timeToLive, stringToDeliveryMode(getReplyDeliveryMode()), getReplyPriority(), ignoreInvalidDestinationException);\n+\t\t\t\t\t\tsend(session, replyTo, cid, prepareReply(plr.getResult(),threadContext).asString(), getReplyMessageType(), timeToLive, stringToDeliveryMode(getReplyDeliveryMode()), getReplyPriority(), ignoreInvalidDestinationException);\n \t\t\t\t\t} finally {\n \t\t\t\t\t\treleaseSession(session);\t\t\t\t\t \n \t\t\t\t\t}\n \t\t\t\t}  else {\n-\t\t\t\t\tsend(session, replyTo, cid, plr.getResult(), getReplyMessageType(), timeToLive, stringToDeliveryMode(getReplyDeliveryMode()), getReplyPriority(), ignoreInvalidDestinationException); \n+\t\t\t\t\tsend(session, replyTo, cid, plr.getResult().asString(), getReplyMessageType(), timeToLive, stringToDeliveryMode(getReplyDeliveryMode()), getReplyPriority(), ignoreInvalidDestinationException); \n \t\t\t\t}\n \t\t\t} else {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4306bb287dc91660fb9d38cca8f0707579104426"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1NDk2NjE2OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/nl/nn/adapterframework/receivers/ReceiverBase.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxMjo0NDozM1rOGltlmQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQwNzo1NzozNVrOGmLw0g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjE5NzQwMQ==", "bodyText": "hoeft de Misc.cleanseMessage niet meer?", "url": "https://github.com/ibissource/iaf/pull/840#discussion_r442197401", "createdAt": "2020-06-18T12:44:33Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/receivers/ReceiverBase.java", "diffHunk": "@@ -863,38 +857,38 @@ private void moveInProcessToError(String originalMessageId, String correlationId\n \t\t\t} \n \t\t\ttxManager.commit(txStatus);\n \t\t} catch (Exception e) {\n-\t\t\tlog.error(getLogPrefix()+\"Exception moving message with id [\"+originalMessageId+\"] correlationId [\"+correlationId+\"] to error sender, original message: [\" + Misc.cleanseMessage(message, getHideRegex(), getHideMethod()) + \"]\", e);\n+\t\t\tlog.error(getLogPrefix()+\"Exception moving message with id [\"+originalMessageId+\"] correlationId [\"+correlationId+\"] to error sender, original message: [\" + message.toString() + \"]\", e);\n \t\t\ttry {\n \t\t\t\tif (!txStatus.isCompleted()) {\n \t\t\t\t\ttxManager.rollback(txStatus);\n \t\t\t\t}\n \t\t\t} catch (Exception rbe) {\n-\t\t\t\tlog.error(getLogPrefix()+\"Exception while rolling back transaction for message  with id [\"+originalMessageId+\"] correlationId [\"+correlationId+\"], original message: [\" + Misc.cleanseMessage(message, getHideRegex(), getHideMethod()) + \"]\", rbe);\n+\t\t\t\tlog.error(getLogPrefix()+\"Exception while rolling back transaction for message  with id [\"+originalMessageId+\"] correlationId [\"+correlationId+\"], original message: [\" + message.toString() + \"]\", rbe);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4306bb287dc91660fb9d38cca8f0707579104426"}, "originalPosition": 149}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjMxNDMwNw==", "bodyText": "Inderdaad, dat gebeurt al in de IbisMaskingLayout", "url": "https://github.com/ibissource/iaf/pull/840#discussion_r442314307", "createdAt": "2020-06-18T15:29:55Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/receivers/ReceiverBase.java", "diffHunk": "@@ -863,38 +857,38 @@ private void moveInProcessToError(String originalMessageId, String correlationId\n \t\t\t} \n \t\t\ttxManager.commit(txStatus);\n \t\t} catch (Exception e) {\n-\t\t\tlog.error(getLogPrefix()+\"Exception moving message with id [\"+originalMessageId+\"] correlationId [\"+correlationId+\"] to error sender, original message: [\" + Misc.cleanseMessage(message, getHideRegex(), getHideMethod()) + \"]\", e);\n+\t\t\tlog.error(getLogPrefix()+\"Exception moving message with id [\"+originalMessageId+\"] correlationId [\"+correlationId+\"] to error sender, original message: [\" + message.toString() + \"]\", e);\n \t\t\ttry {\n \t\t\t\tif (!txStatus.isCompleted()) {\n \t\t\t\t\ttxManager.rollback(txStatus);\n \t\t\t\t}\n \t\t\t} catch (Exception rbe) {\n-\t\t\t\tlog.error(getLogPrefix()+\"Exception while rolling back transaction for message  with id [\"+originalMessageId+\"] correlationId [\"+correlationId+\"], original message: [\" + Misc.cleanseMessage(message, getHideRegex(), getHideMethod()) + \"]\", rbe);\n+\t\t\t\tlog.error(getLogPrefix()+\"Exception while rolling back transaction for message  with id [\"+originalMessageId+\"] correlationId [\"+correlationId+\"], original message: [\" + message.toString() + \"]\", rbe);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjE5NzQwMQ=="}, "originalCommit": {"oid": "4306bb287dc91660fb9d38cca8f0707579104426"}, "originalPosition": 149}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjY5MTc5NA==", "bodyText": "Dat klopt, die klasse heb ik zelf nog gemaakt... oops, vergeten!", "url": "https://github.com/ibissource/iaf/pull/840#discussion_r442691794", "createdAt": "2020-06-19T07:57:35Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/receivers/ReceiverBase.java", "diffHunk": "@@ -863,38 +857,38 @@ private void moveInProcessToError(String originalMessageId, String correlationId\n \t\t\t} \n \t\t\ttxManager.commit(txStatus);\n \t\t} catch (Exception e) {\n-\t\t\tlog.error(getLogPrefix()+\"Exception moving message with id [\"+originalMessageId+\"] correlationId [\"+correlationId+\"] to error sender, original message: [\" + Misc.cleanseMessage(message, getHideRegex(), getHideMethod()) + \"]\", e);\n+\t\t\tlog.error(getLogPrefix()+\"Exception moving message with id [\"+originalMessageId+\"] correlationId [\"+correlationId+\"] to error sender, original message: [\" + message.toString() + \"]\", e);\n \t\t\ttry {\n \t\t\t\tif (!txStatus.isCompleted()) {\n \t\t\t\t\ttxManager.rollback(txStatus);\n \t\t\t\t}\n \t\t\t} catch (Exception rbe) {\n-\t\t\t\tlog.error(getLogPrefix()+\"Exception while rolling back transaction for message  with id [\"+originalMessageId+\"] correlationId [\"+correlationId+\"], original message: [\" + Misc.cleanseMessage(message, getHideRegex(), getHideMethod()) + \"]\", rbe);\n+\t\t\t\tlog.error(getLogPrefix()+\"Exception while rolling back transaction for message  with id [\"+originalMessageId+\"] correlationId [\"+correlationId+\"], original message: [\" + message.toString() + \"]\", rbe);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjE5NzQwMQ=="}, "originalCommit": {"oid": "4306bb287dc91660fb9d38cca8f0707579104426"}, "originalPosition": 149}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1NDk3MjAxOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/nl/nn/adapterframework/receivers/ReceiverBase.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxMjo0NjowM1rOGltpJA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQxNTozMzozNlrOGl04UQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjE5ODMwOA==", "bodyText": "voorheen was dit return null. Nu ineens een Message, waarom niet null?", "url": "https://github.com/ibissource/iaf/pull/840#discussion_r442198308", "createdAt": "2020-06-18T12:46:03Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/receivers/ReceiverBase.java", "diffHunk": "@@ -1141,11 +1131,11 @@ private String processMessageInAdapter(Object rawMessageOrWrapper, String messag\n \t\t\t\t\tlog.warn(getLogPrefix()+\"received message with messageId [\" + messageId + \"] which has a problematic history; aborting processing\");\n \t\t\t\t}\n \t\t\t\tnumRejected.increase();\n-\t\t\t\treturn result;\n+\t\t\t\treturn new Message(\"\");\n \t\t\t}\n \t\t\tif (isDuplicateAndSkip(getMessageLog(), messageId, businessCorrelationId)) {\n \t\t\t\tnumRejected.increase();\n-\t\t\t\treturn result;\n+\t\t\t\treturn new Message(\"\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4306bb287dc91660fb9d38cca8f0707579104426"}, "originalPosition": 281}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjMxNjg4MQ==", "bodyText": "Omdat er op een aantal plekken .asString() van het resultaat wordt gedaan", "url": "https://github.com/ibissource/iaf/pull/840#discussion_r442316881", "createdAt": "2020-06-18T15:33:36Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/receivers/ReceiverBase.java", "diffHunk": "@@ -1141,11 +1131,11 @@ private String processMessageInAdapter(Object rawMessageOrWrapper, String messag\n \t\t\t\t\tlog.warn(getLogPrefix()+\"received message with messageId [\" + messageId + \"] which has a problematic history; aborting processing\");\n \t\t\t\t}\n \t\t\t\tnumRejected.increase();\n-\t\t\t\treturn result;\n+\t\t\t\treturn new Message(\"\");\n \t\t\t}\n \t\t\tif (isDuplicateAndSkip(getMessageLog(), messageId, businessCorrelationId)) {\n \t\t\t\tnumRejected.increase();\n-\t\t\t\treturn result;\n+\t\t\t\treturn new Message(\"\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjE5ODMwOA=="}, "originalCommit": {"oid": "4306bb287dc91660fb9d38cca8f0707579104426"}, "originalPosition": 281}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc1ODk2MzE1OnYy", "diffSide": "RIGHT", "path": "webapp/src/main/webapp/iaf/gui/views/ShowConfigurationStatus.html", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxMzoyNTozM1rOGmUvaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxMzoyNTozM1rOGmUvaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjgzODg4OA==", "bodyText": "Messages Processed (Messages in Process) | Messages in Error", "url": "https://github.com/ibissource/iaf/pull/840#discussion_r442838888", "createdAt": "2020-06-19T13:25:33Z", "author": {"login": "nielsm5"}, "path": "webapp/src/main/webapp/iaf/gui/views/ShowConfigurationStatus.html", "diffHunk": "@@ -224,7 +224,7 @@ <h5>{{::adapter.name}} <small class=\"m-l-sm\">&nbsp;{{::adapter.description}}</sm\n                                 </div>\n                                 <div class=\"col-sm-5\" ng-if=\"!adapter.lastMessage > 0\">\n                                 </div>\n-                                <div class=\"col-sm-2\" title=\"Messages Processed\">{{adapter.messagesProcessed}}\n+                                <div class=\"col-sm-2\" title=\"Messages Processed Sucessfully (In Process) | Processed in Error\">{{adapter.messagesProcessed}}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bb4a9d1c85143556fa28efcd4872f3fbf79e266b"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 386, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}