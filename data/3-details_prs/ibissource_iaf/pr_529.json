{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkyMjQwNDg1", "number": 529, "title": "Add ability to run the framework without a database", "bodyText": "", "createdAt": "2020-03-23T08:46:34Z", "url": "https://github.com/ibissource/iaf/pull/529", "merged": true, "mergeCommit": {"oid": "6b296c50f307c4befb70ea0d8e017511d5397d6c"}, "closed": true, "closedAt": "2020-03-24T10:11:02Z", "author": {"login": "nielsm5"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcOnbJJAH2gAyMzkyMjQwNDg1OmFiMzNhZjFlZWMzZGIwNDc2NzY3ZWNlMzY2ZWUxYmM2NzE2MjIyMWI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcQv6BXgFqTM4MDE1NDI1NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ab33af1eec3db0476767ece366ee1bc67162221b", "author": {"user": {"login": "nielsm5", "name": "Niels"}}, "url": "https://github.com/ibissource/iaf/commit/ab33af1eec3db0476767ece366ee1bc67162221b", "committedDate": "2020-03-17T18:56:58Z", "message": "Remove IAF_Util dependency from main configuration"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5555be225e3a7382d21decff009c09b5974c792a", "author": {"user": {"login": "nielsm5", "name": "Niels"}}, "url": "https://github.com/ibissource/iaf/commit/5555be225e3a7382d21decff009c09b5974c792a", "committedDate": "2020-03-19T11:15:08Z", "message": "Remove database requirement on startup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "95195212f4519f385deb95bb790aec6f927e537a", "author": {"user": {"login": "nielsm5", "name": "Niels"}}, "url": "https://github.com/ibissource/iaf/commit/95195212f4519f385deb95bb790aec6f927e537a", "committedDate": "2020-03-19T14:54:14Z", "message": "Add is-database-present check"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ca67dcc6789cd688d9009adb8e4e4d55735bd7f5", "author": {"user": {"login": "nielsm5", "name": "Niels"}}, "url": "https://github.com/ibissource/iaf/commit/ca67dcc6789cd688d9009adb8e4e4d55735bd7f5", "committedDate": "2020-03-23T09:46:18Z", "message": "Change order of elements"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5NDkxMDg3", "url": "https://github.com/ibissource/iaf/pull/529#pullrequestreview-379491087", "createdAt": "2020-03-23T14:37:59Z", "commit": {"oid": "ca67dcc6789cd688d9009adb8e4e4d55735bd7f5"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxNDozNzo1OVrOF6IX_A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxNDo0MjoxMVrOF6IkgQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQ5ODk0MA==", "bodyText": "Ik denk dat als connection!=null, dat je hem dan moet close()en.", "url": "https://github.com/ibissource/iaf/pull/529#discussion_r396498940", "createdAt": "2020-03-23T14:37:59Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/jdbc/JdbcSenderBase.java", "diffHunk": "@@ -81,14 +80,19 @@ public void configure() throws ConfigurationException {\n \n \t@Override\n \tpublic void open() throws SenderException {\n-\t\tif (!isConnectionsArePooled()) {\n-\t\t\ttry {\n-\t\t\t\tconnection = getConnection();\n-\t\t\t} catch (JdbcException e) {\n-\t\t\t\tthrow new SenderException(e);\n-\t\t\t}\n+\t\ttry {\n+\t\t\tconnection = getConnection();\n+\t\t\tconnection.getMetaData(); //We have to perform some DB action, it could be stale or not present (yet)\n+\t\t} catch (Throwable t) {\n+\t\t\tconnection = null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ca67dcc6789cd688d9009adb8e4e4d55735bd7f5"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQ5OTY5OA==", "bodyText": "Van waar deze bazooka?", "url": "https://github.com/ibissource/iaf/pull/529#discussion_r396499698", "createdAt": "2020-03-23T14:38:57Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/jdbc/migration/Migrator.java", "diffHunk": "@@ -74,15 +73,15 @@ public synchronized void configure(String configurationName, ClassLoader classLo\n \t\t\t\tJdbcConnection connection = new JdbcConnection(getConnection());\n \t\t\t\tinstance = new LiquibaseImpl(ibisContext, cl, connection, configurationName, changeLogFile);\n \t\t\t}\n-\t\t\tcatch (JdbcException e) {\n-\t\t\t\tthrow new ConfigurationException(\"migrator error connecting to database [\"+dataSource+\"]\", e);\n-\t\t\t}\n \t\t\tcatch (ValidationFailedException e) {\n \t\t\t\tthrow new ConfigurationException(\"liquibase validation failed\", e);\n \t\t\t}\n \t\t\tcatch (LiquibaseException e) {\n \t\t\t\tthrow new ConfigurationException(\"liquibase failed to initialize\", e);\n \t\t\t}\n+\t\t\tcatch (Throwable e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ca67dcc6789cd688d9009adb8e4e4d55735bd7f5"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjUwMDU4Mw==", "bodyText": "waarom deze twee hier toegevoegd, en uit de config verwijderd?", "url": "https://github.com/ibissource/iaf/pull/529#discussion_r396500583", "createdAt": "2020-03-23T14:40:06Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/scheduler/SchedulerFactoryBean.java", "diffHunk": "@@ -35,4 +39,13 @@ public void afterPropertiesSet() throws Exception {\n \t\t\tthrow e;\n \t\t}\n \t}\n+\n+\t@Override\n+\tpublic void setDataSource(DataSource dataSource) {\n+\t\t//Make sure this isn't autowired by Spring\n+\t}\n+\t@Override\n+\tpublic void setTransactionManager(PlatformTransactionManager transactionManager) {\n+\t\t//Make sure this isn't autowired by Spring\n+\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ca67dcc6789cd688d9009adb8e4e4d55735bd7f5"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjUwMTcwMg==", "bodyText": "requiresDatabase hoeft niet te betekenen dat er ook een transactiemanager moet zijn.", "url": "https://github.com/ibissource/iaf/pull/529#discussion_r396501702", "createdAt": "2020-03-23T14:41:36Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/unmanaged/DefaultIbisManager.java", "diffHunk": "@@ -462,4 +465,13 @@ public void setApplicationEventPublisher(ApplicationEventPublisher applicationEv\n \tpublic ApplicationEventPublisher getApplicationEventPublisher() {\n \t\treturn applicationEventPublisher;\n \t}\n+\n+\t@Override\n+\tpublic void afterPropertiesSet() throws Exception {\n+\t\tboolean requiresDatabase = AppConstants.getInstance().getBoolean(\"jdbc.required\", true);\n+\t\tif(requiresDatabase) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ca67dcc6789cd688d9009adb8e4e4d55735bd7f5"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjUwMjE0NQ==", "bodyText": "Waarom moet dit, en hoefde het eerst niet?", "url": "https://github.com/ibissource/iaf/pull/529#discussion_r396502145", "createdAt": "2020-03-23T14:42:11Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/resources/AppConstants.properties", "diffHunk": "@@ -29,9 +29,8 @@ instance.timestamp=\n #Deprecated should be automatically determined by the instance.version and instance.timestamp properties (typically automatically generated and stored in BuildInfo.properties)\n instance.build_id=not-used\n \n-configurations.names.application=IAF_WebControl,${configurations.names},IAF_Util\n+configurations.names.application=IAF_WebControl,IAF_Util,${configurations.names}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ca67dcc6789cd688d9009adb8e4e4d55735bd7f5"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "17958a3c50715c5ad948833222a532c6b1c2fe0c", "author": {"user": {"login": "nielsm5", "name": "Niels"}}, "url": "https://github.com/ibissource/iaf/commit/17958a3c50715c5ad948833222a532c6b1c2fe0c", "committedDate": "2020-03-23T15:15:04Z", "message": "Close connection"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwMTU0MjU1", "url": "https://github.com/ibissource/iaf/pull/529#pullrequestreview-380154255", "createdAt": "2020-03-24T09:57:47Z", "commit": {"oid": "17958a3c50715c5ad948833222a532c6b1c2fe0c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1419, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}