{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk4MzM1ODQz", "number": 1124, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxMzo1NzoyMFrOEqvtmg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQxMDoxNzo0NlrOEr_Sgg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEzMjU3MzcwOnYy", "diffSide": "RIGHT", "path": "cmis/src/main/java/nl/nn/adapterframework/extensions/cmis/CmisUtils.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxMzo1NzoyMFrOHdID2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxMzo1NzoyMFrOHdID2A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDMwMjgwOA==", "bodyText": "Hier mogen toch wel meer snorhaken", "url": "https://github.com/ibissource/iaf/pull/1124#discussion_r500302808", "createdAt": "2020-10-06T13:57:20Z", "author": {"login": "gvanbrakel"}, "path": "cmis/src/main/java/nl/nn/adapterframework/extensions/cmis/CmisUtils.java", "diffHunk": "@@ -679,14 +679,21 @@ private static XmlBuilder repositoryCapabilities2xml(RepositoryCapabilities capa\n \t\t\tif(capabilities.isVersionSpecificFilingSupported() != null)\n \t\t\t\trepositoryXml.addAttribute(\"supportsVersionSpecificFiling\", capabilities.isVersionSpecificFilingSupported());\n \n-\t\t\trepositoryXml.addAttribute(\"aclCapability\", capabilities.getAclCapability().name());\n-\t\t\trepositoryXml.addAttribute(\"changesCapability\", capabilities.getChangesCapability().name());\n-\t\t\trepositoryXml.addAttribute(\"contentStreamUpdatesCapability\", capabilities.getContentStreamUpdatesCapability().name());\n+\t\t\tif(capabilities.getAclCapability() != null)\n+\t\t\t\trepositoryXml.addAttribute(\"aclCapability\", capabilities.getAclCapability().name());\n+\t\t\tif(capabilities.getChangesCapability() != null)\n+\t\t\t\trepositoryXml.addAttribute(\"changesCapability\", capabilities.getChangesCapability().name());\n+\t\t\tif(capabilities.getContentStreamUpdatesCapability() != null)\n+\t\t\t\trepositoryXml.addAttribute(\"contentStreamUpdatesCapability\", capabilities.getContentStreamUpdatesCapability().name());\n \t\t\trepositoryXml.addSubElement(CmisUtils.creatablePropertyTypes2xml(capabilities.getCreatablePropertyTypes()));\n+\t\t\tif(capabilities.getJoinCapability() != null)\n \t\t\trepositoryXml.addAttribute(\"joinCapability\", capabilities.getJoinCapability().name());\n \t\t\trepositoryXml.addSubElement(CmisUtils.newTypeSettableAttributes2xml(capabilities.getNewTypeSettableAttributes()));\n-\t\t\trepositoryXml.addAttribute(\"orderByCapability\", capabilities.getOrderByCapability().name());\n+\t\t\tif(capabilities.getOrderByCapability() != null)\n+\t\t\t\trepositoryXml.addAttribute(\"orderByCapability\", capabilities.getOrderByCapability().name());\n+\t\t\tif(capabilities.getQueryCapability() != null)\n \t\t\trepositoryXml.addAttribute(\"queryCapability\", capabilities.getQueryCapability().name());\n+\t\t\tif(capabilities.getRenditionsCapability() != null)\n \t\t\trepositoryXml.addAttribute(\"renditionsCapability\", capabilities.getRenditionsCapability().name());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a4699916bb0b1ea385a3ca3b548f8cb6e4dcc545"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEzMjU5MTU4OnYy", "diffSide": "RIGHT", "path": "cmis/src/main/java/nl/nn/adapterframework/extensions/cmis/server/CmisEventDispatcher.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNDowMDoyMFrOHdIPPQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQwOTozOTo0MFrOHfCn-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDMwNTcyNQ==", "bodyText": "Zou je dit niet proxying moeten noemen?", "url": "https://github.com/ibissource/iaf/pull/1124#discussion_r500305725", "createdAt": "2020-10-06T14:00:20Z", "author": {"login": "gvanbrakel"}, "path": "cmis/src/main/java/nl/nn/adapterframework/extensions/cmis/server/CmisEventDispatcher.java", "diffHunk": "@@ -67,14 +77,16 @@ public Element trigger(CmisEvent event, String message, CallContext callContext)\n \t}\n \n \tpublic Element trigger(CmisEvent event, String message, IPipeLineSession messageContext) {\n-\t\tCmisUtils.populateCmisAttributes(messageContext);\n-\n \t\tif(!eventListeners.containsKey(event))\n-\t\t\tthrow new CmisRuntimeException(\"event [\"+event.toString()+\"] not found\");\n+\t\t\tthrow new CmisRuntimeException(\"event [\"+event.name()+\"] not registered\");\n+\n+\t\tif(log.isDebugEnabled()) log.debug(\"bridging CmisEvent [\"+event.name()+\"]\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a4699916bb0b1ea385a3ca3b548f8cb6e4dcc545"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjMxMDkwNw==", "bodyText": "Wij hebben de Apache OpenCmis bridge dus vandaar de naam. Het extra wat wij er bij doen is dingen door een Frank! heen halen.", "url": "https://github.com/ibissource/iaf/pull/1124#discussion_r502310907", "createdAt": "2020-10-09T09:39:40Z", "author": {"login": "nielsm5"}, "path": "cmis/src/main/java/nl/nn/adapterframework/extensions/cmis/server/CmisEventDispatcher.java", "diffHunk": "@@ -67,14 +77,16 @@ public Element trigger(CmisEvent event, String message, CallContext callContext)\n \t}\n \n \tpublic Element trigger(CmisEvent event, String message, IPipeLineSession messageContext) {\n-\t\tCmisUtils.populateCmisAttributes(messageContext);\n-\n \t\tif(!eventListeners.containsKey(event))\n-\t\t\tthrow new CmisRuntimeException(\"event [\"+event.toString()+\"] not found\");\n+\t\t\tthrow new CmisRuntimeException(\"event [\"+event.name()+\"] not registered\");\n+\n+\t\tif(log.isDebugEnabled()) log.debug(\"bridging CmisEvent [\"+event.name()+\"]\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDMwNTcyNQ=="}, "originalCommit": {"oid": "a4699916bb0b1ea385a3ca3b548f8cb6e4dcc545"}, "originalPosition": 62}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEzMzE5MDU4OnYy", "diffSide": "RIGHT", "path": "cmis/src/main/java/nl/nn/adapterframework/extensions/cmis/server/CmisEventDispatcher.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNTozOTo0MFrOHdODAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQxMDoxMjo0N1rOHfDrlw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQwMDg5OQ==", "bodyText": "Waarom geef je niet zoiets als true of false terug, en zodat je excepties voor excepties kan bewaren?", "url": "https://github.com/ibissource/iaf/pull/1124#discussion_r500400899", "createdAt": "2020-10-06T15:39:40Z", "author": {"login": "gvanbrakel"}, "path": "cmis/src/main/java/nl/nn/adapterframework/extensions/cmis/server/CmisEventDispatcher.java", "diffHunk": "@@ -99,6 +111,29 @@ else if (XmlUtils.isWellFormed(result, \"cmis\")) {\n \t}\n \n \tpublic boolean contains(CmisEvent event) {\n-\t\treturn eventListeners.containsKey(event);\n+\t\tif(StringUtils.isNotEmpty(dispatcherName)) {\n+\t\t\tJavaListener listener = JavaListener.getListener(dispatcherName);\n+\t\t\tif(listener == null) {\n+\t\t\t\tthrow new CmisRuntimeException(\"unable to bridge cmis request, dispatcher offline\"); //Adapter registered but not started\n+\t\t\t}\n+\n+\t\t\tHashMap<String, Object> messageContext = new HashMap<>();\n+\t\t\tmessageContext.put(\"CmisEvent\", event.name());\n+\n+\t\t\ttry {\n+\t\t\t\tlistener.processRequest(null, event.name(), messageContext);\n+\t\t\t\t// Nothing is done with the result, it's purely to check if the event should be bridged or not. If not, an execption should be thrown.\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a4699916bb0b1ea385a3ca3b548f8cb6e4dcc545"}, "originalPosition": 91}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjMxMTM1Nw==", "bodyText": "Omdat je bij een exceptie echt wilt dat hij niets doet, en je mooi een foutmelding mee kan geven.", "url": "https://github.com/ibissource/iaf/pull/1124#discussion_r502311357", "createdAt": "2020-10-09T09:40:34Z", "author": {"login": "nielsm5"}, "path": "cmis/src/main/java/nl/nn/adapterframework/extensions/cmis/server/CmisEventDispatcher.java", "diffHunk": "@@ -99,6 +111,29 @@ else if (XmlUtils.isWellFormed(result, \"cmis\")) {\n \t}\n \n \tpublic boolean contains(CmisEvent event) {\n-\t\treturn eventListeners.containsKey(event);\n+\t\tif(StringUtils.isNotEmpty(dispatcherName)) {\n+\t\t\tJavaListener listener = JavaListener.getListener(dispatcherName);\n+\t\t\tif(listener == null) {\n+\t\t\t\tthrow new CmisRuntimeException(\"unable to bridge cmis request, dispatcher offline\"); //Adapter registered but not started\n+\t\t\t}\n+\n+\t\t\tHashMap<String, Object> messageContext = new HashMap<>();\n+\t\t\tmessageContext.put(\"CmisEvent\", event.name());\n+\n+\t\t\ttry {\n+\t\t\t\tlistener.processRequest(null, event.name(), messageContext);\n+\t\t\t\t// Nothing is done with the result, it's purely to check if the event should be bridged or not. If not, an execption should be thrown.\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQwMDg5OQ=="}, "originalCommit": {"oid": "a4699916bb0b1ea385a3ca3b548f8cb6e4dcc545"}, "originalPosition": 91}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjMyODIxNQ==", "bodyText": "always false unless explicitly true", "url": "https://github.com/ibissource/iaf/pull/1124#discussion_r502328215", "createdAt": "2020-10-09T10:12:47Z", "author": {"login": "nielsm5"}, "path": "cmis/src/main/java/nl/nn/adapterframework/extensions/cmis/server/CmisEventDispatcher.java", "diffHunk": "@@ -99,6 +111,29 @@ else if (XmlUtils.isWellFormed(result, \"cmis\")) {\n \t}\n \n \tpublic boolean contains(CmisEvent event) {\n-\t\treturn eventListeners.containsKey(event);\n+\t\tif(StringUtils.isNotEmpty(dispatcherName)) {\n+\t\t\tJavaListener listener = JavaListener.getListener(dispatcherName);\n+\t\t\tif(listener == null) {\n+\t\t\t\tthrow new CmisRuntimeException(\"unable to bridge cmis request, dispatcher offline\"); //Adapter registered but not started\n+\t\t\t}\n+\n+\t\t\tHashMap<String, Object> messageContext = new HashMap<>();\n+\t\t\tmessageContext.put(\"CmisEvent\", event.name());\n+\n+\t\t\ttry {\n+\t\t\t\tlistener.processRequest(null, event.name(), messageContext);\n+\t\t\t\t// Nothing is done with the result, it's purely to check if the event should be bridged or not. If not, an execption should be thrown.\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQwMDg5OQ=="}, "originalCommit": {"oid": "a4699916bb0b1ea385a3ca3b548f8cb6e4dcc545"}, "originalPosition": 91}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE0NTYxMDY5OnYy", "diffSide": "RIGHT", "path": "cmis/src/main/java/nl/nn/adapterframework/extensions/cmis/CmisUtils.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQxMDoxNzozNFrOHfD0og==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQxMDoxNzozNFrOHfD0og==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjMzMDUzMA==", "bodyText": "indent!", "url": "https://github.com/ibissource/iaf/pull/1124#discussion_r502330530", "createdAt": "2020-10-09T10:17:34Z", "author": {"login": "nielsm5"}, "path": "cmis/src/main/java/nl/nn/adapterframework/extensions/cmis/CmisUtils.java", "diffHunk": "@@ -679,14 +679,21 @@ private static XmlBuilder repositoryCapabilities2xml(RepositoryCapabilities capa\n \t\t\tif(capabilities.isVersionSpecificFilingSupported() != null)\n \t\t\t\trepositoryXml.addAttribute(\"supportsVersionSpecificFiling\", capabilities.isVersionSpecificFilingSupported());\n \n-\t\t\trepositoryXml.addAttribute(\"aclCapability\", capabilities.getAclCapability().name());\n-\t\t\trepositoryXml.addAttribute(\"changesCapability\", capabilities.getChangesCapability().name());\n-\t\t\trepositoryXml.addAttribute(\"contentStreamUpdatesCapability\", capabilities.getContentStreamUpdatesCapability().name());\n+\t\t\tif(capabilities.getAclCapability() != null)\n+\t\t\t\trepositoryXml.addAttribute(\"aclCapability\", capabilities.getAclCapability().name());\n+\t\t\tif(capabilities.getChangesCapability() != null)\n+\t\t\t\trepositoryXml.addAttribute(\"changesCapability\", capabilities.getChangesCapability().name());\n+\t\t\tif(capabilities.getContentStreamUpdatesCapability() != null)\n+\t\t\t\trepositoryXml.addAttribute(\"contentStreamUpdatesCapability\", capabilities.getContentStreamUpdatesCapability().name());\n \t\t\trepositoryXml.addSubElement(CmisUtils.creatablePropertyTypes2xml(capabilities.getCreatablePropertyTypes()));\n+\t\t\tif(capabilities.getJoinCapability() != null)\n \t\t\trepositoryXml.addAttribute(\"joinCapability\", capabilities.getJoinCapability().name());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a4699916bb0b1ea385a3ca3b548f8cb6e4dcc545"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE0NTYxMTU0OnYy", "diffSide": "RIGHT", "path": "cmis/src/main/java/nl/nn/adapterframework/extensions/cmis/CmisUtils.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQxMDoxNzo0NlrOHfD1Fw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQxMDoxNzo0NlrOHfD1Fw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjMzMDY0Nw==", "bodyText": "indent!", "url": "https://github.com/ibissource/iaf/pull/1124#discussion_r502330647", "createdAt": "2020-10-09T10:17:46Z", "author": {"login": "nielsm5"}, "path": "cmis/src/main/java/nl/nn/adapterframework/extensions/cmis/CmisUtils.java", "diffHunk": "@@ -679,14 +679,21 @@ private static XmlBuilder repositoryCapabilities2xml(RepositoryCapabilities capa\n \t\t\tif(capabilities.isVersionSpecificFilingSupported() != null)\n \t\t\t\trepositoryXml.addAttribute(\"supportsVersionSpecificFiling\", capabilities.isVersionSpecificFilingSupported());\n \n-\t\t\trepositoryXml.addAttribute(\"aclCapability\", capabilities.getAclCapability().name());\n-\t\t\trepositoryXml.addAttribute(\"changesCapability\", capabilities.getChangesCapability().name());\n-\t\t\trepositoryXml.addAttribute(\"contentStreamUpdatesCapability\", capabilities.getContentStreamUpdatesCapability().name());\n+\t\t\tif(capabilities.getAclCapability() != null)\n+\t\t\t\trepositoryXml.addAttribute(\"aclCapability\", capabilities.getAclCapability().name());\n+\t\t\tif(capabilities.getChangesCapability() != null)\n+\t\t\t\trepositoryXml.addAttribute(\"changesCapability\", capabilities.getChangesCapability().name());\n+\t\t\tif(capabilities.getContentStreamUpdatesCapability() != null)\n+\t\t\t\trepositoryXml.addAttribute(\"contentStreamUpdatesCapability\", capabilities.getContentStreamUpdatesCapability().name());\n \t\t\trepositoryXml.addSubElement(CmisUtils.creatablePropertyTypes2xml(capabilities.getCreatablePropertyTypes()));\n+\t\t\tif(capabilities.getJoinCapability() != null)\n \t\t\trepositoryXml.addAttribute(\"joinCapability\", capabilities.getJoinCapability().name());\n \t\t\trepositoryXml.addSubElement(CmisUtils.newTypeSettableAttributes2xml(capabilities.getNewTypeSettableAttributes()));\n-\t\t\trepositoryXml.addAttribute(\"orderByCapability\", capabilities.getOrderByCapability().name());\n+\t\t\tif(capabilities.getOrderByCapability() != null)\n+\t\t\t\trepositoryXml.addAttribute(\"orderByCapability\", capabilities.getOrderByCapability().name());\n+\t\t\tif(capabilities.getQueryCapability() != null)\n \t\t\trepositoryXml.addAttribute(\"queryCapability\", capabilities.getQueryCapability().name());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a4699916bb0b1ea385a3ca3b548f8cb6e4dcc545"}, "originalPosition": 21}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 551, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}