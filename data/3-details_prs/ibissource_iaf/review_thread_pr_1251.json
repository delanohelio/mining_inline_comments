{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE4NDIxOTky", "number": 1251, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxNjoyMDo1MlrOE3TdNA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxNzozNTo0M1rOE3zg1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI2NDI1OTA4OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/nl/nn/adapterframework/filesystem/FileSystemUtils.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxNjoyMDo1MlrOHwkiYQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxNjoyMDo1MlrOHwkiYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDY5MjMyMQ==", "bodyText": "Dit hoort meer thuis in een MailFileSystemUtils... We moeten er voor zorgen dat de util classes niet uit de klauwen gaan lopen qua compliciteit en grootte.", "url": "https://github.com/ibissource/iaf/pull/1251#discussion_r520692321", "createdAt": "2020-11-10T16:20:52Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/filesystem/FileSystemUtils.java", "diffHunk": "@@ -201,4 +206,63 @@ public void close() throws IOException {\n \t\t}\n \t}\n \n+\tpublic static <M,A> void addEmailInfoSimple(IMailFileSystem<M,A> fileSystem, M emailMessage, SaxElementBuilder emailXml) throws FileSystemException, SAXException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d2dff84feeacc29c9ccbd2df3bdb47f654bb4ff9"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI2NDI2MzAyOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/nl/nn/adapterframework/filesystem/FileSystemUtils.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxNjoyMTo0N1rOHwkk4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQxNjo1Nzo1MlrOHyEW5Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDY5Mjk2MQ==", "bodyText": "Kan je hier niet beter attachmentXml.addAttribute(\"filename\", filename); gebruiken?", "url": "https://github.com/ibissource/iaf/pull/1251#discussion_r520692961", "createdAt": "2020-11-10T16:21:47Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/filesystem/FileSystemUtils.java", "diffHunk": "@@ -201,4 +206,63 @@ public void close() throws IOException {\n \t\t}\n \t}\n \n+\tpublic static <M,A> void addEmailInfoSimple(IMailFileSystem<M,A> fileSystem, M emailMessage, SaxElementBuilder emailXml) throws FileSystemException, SAXException {\n+\t\temailXml.addElement(\"subject\", fileSystem.getSubject(emailMessage));\n+\t}\n+\n+\tpublic static <M,A> void addEmailInfo(IMailFileSystem<M,A> fileSystem, M emailMessage, SaxElementBuilder emailXml) throws FileSystemException, SAXException {\n+\t\ttry (SaxElementBuilder recipientsXml = emailXml.startElement(\"recipients\")) {\n+\t\t\tfor(String address:fileSystem.getToRecipients(emailMessage)) {\n+\t\t\t\trecipientsXml.addElement(\"recipient\", \"type\", \"to\", address);\n+\t\t\t}\n+\t\t\tfor(String address:fileSystem.getCCRecipients(emailMessage)) {\n+\t\t\t\trecipientsXml.addElement(\"recipient\", \"type\", \"cc\", address);\n+\t\t\t}\n+\t\t\tfor(String address:fileSystem.getBCCRecipients(emailMessage)) {\n+\t\t\t\trecipientsXml.addElement(\"recipient\", \"type\", \"bcc\", address);\n+\t\t\t}\n+\t\t}\n+\t\temailXml.addElement(\"from\", fileSystem.getFrom(emailMessage));\n+\t\temailXml.addElement(\"subject\", fileSystem.getSubject(emailMessage));\n+\t\temailXml.addElement(\"message\", fileSystem.getMessageBody(emailMessage));\n+\t\ttry (SaxElementBuilder attachmentsXml = emailXml.startElement(\"attachments\")) {\n+\t\t\tfor (Iterator<A> it = fileSystem.listAttachments(emailMessage); it.hasNext();) {\n+\t\t\t\tfileSystem.extractAttachment(it.next(), attachmentsXml);\n+\t\t\t}\n+\t\t} catch (Exception e) {\n+\t\t\tthrow new FileSystemException(\"Cannot extract attachment\",e);\n+\t\t}\n+\t\ttry (SaxElementBuilder headersXml = emailXml.startElement(\"headers\")) {\n+\t\t\tMap<String,Object> properties = fileSystem.getAdditionalFileProperties(emailMessage);\n+\t\t\tif (properties != null) {\n+\t\t\t\tfor (Map.Entry<String,Object> header: properties.entrySet()) {\n+\t\t\t\t\tif (header.getValue() instanceof List) {\n+\t\t\t\t\t\tfor(Object value:(List<?>)header.getValue()) {\n+\t\t\t\t\t\t\theadersXml.addElement(\"header\", \"name\", header.getKey(), (String)value);\n+\t\t\t\t\t\t}\n+\t\t\t\t\t} else {\n+\t\t\t\t\t\theadersXml.addElement(\"header\", \"name\", header.getKey(), (String)header.getValue());\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\t\t\t}\n+\t\t}\n+\t\tSimpleDateFormat sdf = new SimpleDateFormat(\"yyyy-MM-dd'T'HH:mm:ss.SSSZ\");\n+\t\temailXml.addElement(\"dateTimeSent\", sdf.format(fileSystem.getDateTimeSent(emailMessage)));\n+\t\temailXml.addElement(\"dateTimeReceived\", sdf.format(fileSystem.getDateTimeReceived(emailMessage)));\n+\t}\n+\n+\tpublic static <M,A> void addAttachmentInfo(IMailFileSystem<M,A> fileSystem, A attachment, SaxElementBuilder attachmentsXml) throws FileSystemException, SAXException {\n+\t\ttry (SaxElementBuilder attachmentXml = attachmentsXml.startElement(\"attachment\")) {\n+\t\t\tattachmentXml.addAttribute(\"name\", fileSystem.getAttachmentName(attachment));\n+\t\t\tString filename = fileSystem.getAttachmentFileName(attachment);\n+\t\t\tif (filename!=null) {\n+\t\t\t\tattachmentXml.addAttribute(\"filename\", fileSystem.getAttachmentFileName(attachment));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d2dff84feeacc29c9ccbd2df3bdb47f654bb4ff9"}, "originalPosition": 74}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjI2MjI0NQ==", "bodyText": "oeps", "url": "https://github.com/ibissource/iaf/pull/1251#discussion_r522262245", "createdAt": "2020-11-12T16:57:52Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/filesystem/FileSystemUtils.java", "diffHunk": "@@ -201,4 +206,63 @@ public void close() throws IOException {\n \t\t}\n \t}\n \n+\tpublic static <M,A> void addEmailInfoSimple(IMailFileSystem<M,A> fileSystem, M emailMessage, SaxElementBuilder emailXml) throws FileSystemException, SAXException {\n+\t\temailXml.addElement(\"subject\", fileSystem.getSubject(emailMessage));\n+\t}\n+\n+\tpublic static <M,A> void addEmailInfo(IMailFileSystem<M,A> fileSystem, M emailMessage, SaxElementBuilder emailXml) throws FileSystemException, SAXException {\n+\t\ttry (SaxElementBuilder recipientsXml = emailXml.startElement(\"recipients\")) {\n+\t\t\tfor(String address:fileSystem.getToRecipients(emailMessage)) {\n+\t\t\t\trecipientsXml.addElement(\"recipient\", \"type\", \"to\", address);\n+\t\t\t}\n+\t\t\tfor(String address:fileSystem.getCCRecipients(emailMessage)) {\n+\t\t\t\trecipientsXml.addElement(\"recipient\", \"type\", \"cc\", address);\n+\t\t\t}\n+\t\t\tfor(String address:fileSystem.getBCCRecipients(emailMessage)) {\n+\t\t\t\trecipientsXml.addElement(\"recipient\", \"type\", \"bcc\", address);\n+\t\t\t}\n+\t\t}\n+\t\temailXml.addElement(\"from\", fileSystem.getFrom(emailMessage));\n+\t\temailXml.addElement(\"subject\", fileSystem.getSubject(emailMessage));\n+\t\temailXml.addElement(\"message\", fileSystem.getMessageBody(emailMessage));\n+\t\ttry (SaxElementBuilder attachmentsXml = emailXml.startElement(\"attachments\")) {\n+\t\t\tfor (Iterator<A> it = fileSystem.listAttachments(emailMessage); it.hasNext();) {\n+\t\t\t\tfileSystem.extractAttachment(it.next(), attachmentsXml);\n+\t\t\t}\n+\t\t} catch (Exception e) {\n+\t\t\tthrow new FileSystemException(\"Cannot extract attachment\",e);\n+\t\t}\n+\t\ttry (SaxElementBuilder headersXml = emailXml.startElement(\"headers\")) {\n+\t\t\tMap<String,Object> properties = fileSystem.getAdditionalFileProperties(emailMessage);\n+\t\t\tif (properties != null) {\n+\t\t\t\tfor (Map.Entry<String,Object> header: properties.entrySet()) {\n+\t\t\t\t\tif (header.getValue() instanceof List) {\n+\t\t\t\t\t\tfor(Object value:(List<?>)header.getValue()) {\n+\t\t\t\t\t\t\theadersXml.addElement(\"header\", \"name\", header.getKey(), (String)value);\n+\t\t\t\t\t\t}\n+\t\t\t\t\t} else {\n+\t\t\t\t\t\theadersXml.addElement(\"header\", \"name\", header.getKey(), (String)header.getValue());\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\t\t\t}\n+\t\t}\n+\t\tSimpleDateFormat sdf = new SimpleDateFormat(\"yyyy-MM-dd'T'HH:mm:ss.SSSZ\");\n+\t\temailXml.addElement(\"dateTimeSent\", sdf.format(fileSystem.getDateTimeSent(emailMessage)));\n+\t\temailXml.addElement(\"dateTimeReceived\", sdf.format(fileSystem.getDateTimeReceived(emailMessage)));\n+\t}\n+\n+\tpublic static <M,A> void addAttachmentInfo(IMailFileSystem<M,A> fileSystem, A attachment, SaxElementBuilder attachmentsXml) throws FileSystemException, SAXException {\n+\t\ttry (SaxElementBuilder attachmentXml = attachmentsXml.startElement(\"attachment\")) {\n+\t\t\tattachmentXml.addAttribute(\"name\", fileSystem.getAttachmentName(attachment));\n+\t\t\tString filename = fileSystem.getAttachmentFileName(attachment);\n+\t\t\tif (filename!=null) {\n+\t\t\t\tattachmentXml.addAttribute(\"filename\", fileSystem.getAttachmentFileName(attachment));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDY5Mjk2MQ=="}, "originalCommit": {"oid": "d2dff84feeacc29c9ccbd2df3bdb47f654bb4ff9"}, "originalPosition": 74}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI2OTUwNTE5OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/nl/nn/adapterframework/filesystem/ExchangeFileSystem.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxNzozNDozMVrOHxXSPQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQxNjo1Nzo1OFrOHyEXKQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTUyMzc3Mw==", "bodyText": "Ik snap niet waarom je dit hier doet", "url": "https://github.com/ibissource/iaf/pull/1251#discussion_r521523773", "createdAt": "2020-11-11T17:34:31Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/filesystem/ExchangeFileSystem.java", "diffHunk": "@@ -332,7 +330,20 @@ public boolean exists(Item f) throws FileSystemException {\n \t\t\tif (findResults.getTotalCount() == 0) {\n \t\t\t\treturn FileSystemUtils.getDirectoryStream(null);\n \t\t\t} else {\n-\t\t\t\treturn FileSystemUtils.getDirectoryStream(findResults.getItems().iterator());\n+\t\t\t\tIterator<Item> itemIterator = findResults.getItems().iterator();\n+\t\t\t\treturn FileSystemUtils.getDirectoryStream(new Iterator<EmailMessage>() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d2dff84feeacc29c9ccbd2df3bdb47f654bb4ff9"}, "originalPosition": 95}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjI2MjMxMw==", "bodyText": "must cast  to  separately, cannot cast Iterator to Iterator", "url": "https://github.com/ibissource/iaf/pull/1251#discussion_r522262313", "createdAt": "2020-11-12T16:57:58Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/filesystem/ExchangeFileSystem.java", "diffHunk": "@@ -332,7 +330,20 @@ public boolean exists(Item f) throws FileSystemException {\n \t\t\tif (findResults.getTotalCount() == 0) {\n \t\t\t\treturn FileSystemUtils.getDirectoryStream(null);\n \t\t\t} else {\n-\t\t\t\treturn FileSystemUtils.getDirectoryStream(findResults.getItems().iterator());\n+\t\t\t\tIterator<Item> itemIterator = findResults.getItems().iterator();\n+\t\t\t\treturn FileSystemUtils.getDirectoryStream(new Iterator<EmailMessage>() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTUyMzc3Mw=="}, "originalCommit": {"oid": "d2dff84feeacc29c9ccbd2df3bdb47f654bb4ff9"}, "originalPosition": 95}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI2OTUxMTI2OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/nl/nn/adapterframework/filesystem/ExchangeFileSystem.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxNzozNTo0M1rOHxXV1w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxNzozNTo0M1rOHxXV1w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTUyNDY5NQ==", "bodyText": "Hier ook een log.warn oid neerzetten dat een onverwacht attachment ding opgegeven is?", "url": "https://github.com/ibissource/iaf/pull/1251#discussion_r521524695", "createdAt": "2020-11-11T17:35:43Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/filesystem/ExchangeFileSystem.java", "diffHunk": "@@ -555,6 +569,18 @@ public InputStream readAttachment(Attachment a) throws FileSystemException, IOEx\n \t\treturn binaryInputStream;\n \t}\n \n+\t@Override\n+\tpublic EmailMessage getFileFromAttachment(Attachment a) throws FileSystemException {\n+\t\tif (a instanceof ItemAttachment) {\n+\t\t\tItemAttachment ia = (ItemAttachment) a;\n+\t\t\tItem aItem = ia.getItem();\n+\t\t\tif (aItem instanceof EmailMessage) {\n+\t\t\t\treturn (EmailMessage) aItem;\n+\t\t\t}\n+\t\t}\n+\t\treturn null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d2dff84feeacc29c9ccbd2df3bdb47f654bb4ff9"}, "originalPosition": 312}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 625, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}