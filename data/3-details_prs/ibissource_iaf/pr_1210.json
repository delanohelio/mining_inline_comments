{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEwNzA5NzU3", "number": 1210, "title": "Show liquibase exceptions in configuration warnings", "bodyText": "Fixes #1132", "createdAt": "2020-10-27T12:17:08Z", "url": "https://github.com/ibissource/iaf/pull/1210", "merged": true, "mergeCommit": {"oid": "a2c8f65f91333b45b0482d556a5b6a9a4aa16b6b"}, "closed": true, "closedAt": "2020-10-30T12:20:08Z", "author": {"login": "alisihab"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdWn8_UgH2gAyNTEwNzA5NzU3OmYzNTlhYmVhMzJhNDdlZjUwNDk3MTZlMGE2OTM1NTcyYTRjODRkNWI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdXlBRNAFqTUyMDU3OTU5MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f359abea32a47ef5049716e0a6935572a4c84d5b", "author": {"user": null}, "url": "https://github.com/ibissource/iaf/commit/f359abea32a47ef5049716e0a6935572a4c84d5b", "committedDate": "2020-10-27T12:16:29Z", "message": "Show liquibase exceptions in configuration warnings"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE3NjgzNTc1", "url": "https://github.com/ibissource/iaf/pull/1210#pullrequestreview-517683575", "createdAt": "2020-10-27T13:10:43Z", "commit": {"oid": "f359abea32a47ef5049716e0a6935572a4c84d5b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxMzoxMDo0M1rOHo7WsQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxMzoxMDo0M1rOHo7WsQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjY3NzU1Mw==", "bodyText": "I don't think it is a good idea to log this message in the ConfigurationWarnings as well as in the MessageKeeper.", "url": "https://github.com/ibissource/iaf/pull/1210#discussion_r512677553", "createdAt": "2020-10-27T13:10:43Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/configuration/IbisContext.java", "diffHunk": "@@ -351,6 +351,7 @@ private void digestClassLoaderConfiguration(ClassLoader classLoader,\n \t\t\t\t\t\tdatabaseMigrator.close();\n \t\t\t\t\t}\n \t\t\t\t\tcatch (Exception e) {\n+\t\t\t\t\t\tConfigurationWarnings.add(LOG, e.getMessage());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f359abea32a47ef5049716e0a6935572a4c84d5b"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0b6ca07e2e01ea0f26fd05dbc1821f5b7bd0940d", "author": {"user": null}, "url": "https://github.com/ibissource/iaf/commit/0b6ca07e2e01ea0f26fd05dbc1821f5b7bd0940d", "committedDate": "2020-10-27T14:44:53Z", "message": "do not show the message in the configuration messages only show it in configuration warnings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "084ed6c23e25c710ecb4ca4d846d99792ec095dc", "author": {"user": null}, "url": "https://github.com/ibissource/iaf/commit/084ed6c23e25c710ecb4ca4d846d99792ec095dc", "committedDate": "2020-10-28T10:06:18Z", "message": "rename add method for global warnings, show liquibase exceptions as config warnings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7707e88a076b649f5fb14bb1a88cd6beca5dec4e", "author": {"user": null}, "url": "https://github.com/ibissource/iaf/commit/7707e88a076b649f5fb14bb1a88cd6beca5dec4e", "committedDate": "2020-10-28T12:39:29Z", "message": "remove unused import"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4ODk4MTM3", "url": "https://github.com/ibissource/iaf/pull/1210#pullrequestreview-518898137", "createdAt": "2020-10-28T17:09:31Z", "commit": {"oid": "7707e88a076b649f5fb14bb1a88cd6beca5dec4e"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxNzowOTozMVrOHp0wLA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxNzoyMDoxM1rOHp1NoQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzYxNzk2NA==", "bodyText": "These warnings are very configuration specific. If you pass the Configuration that is parsed in the constructor of XmlErrorHandler, than you can make these warnings configuration specific", "url": "https://github.com/ibissource/iaf/pull/1210#discussion_r513617964", "createdAt": "2020-10-28T17:09:31Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/configuration/ConfigurationDigester.java", "diffHunk": "@@ -100,15 +100,15 @@\n \tprivate class XmlErrorHandler implements ErrorHandler  {\n \t\t@Override\n \t\tpublic void warning(SAXParseException exception) throws SAXParseException {\n-\t\t\tConfigurationWarnings.add(log, \"Warning when validating against schema [\"+CONFIGURATION_VALIDATION_SCHEMA+\"] at line,column [\"+exception.getLineNumber()+\",\"+exception.getColumnNumber()+\"]: \" + exception.getMessage());\n+\t\t\tConfigurationWarnings.addGlobalWarning(log, \"Warning when validating against schema [\"+CONFIGURATION_VALIDATION_SCHEMA+\"] at line,column [\"+exception.getLineNumber()+\",\"+exception.getColumnNumber()+\"]: \" + exception.getMessage());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7707e88a076b649f5fb14bb1a88cd6beca5dec4e"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzYyNTUwNQ==", "bodyText": "LiquibaseImpl is not really a named object, so this is a tricky/hacky way to pass the name.\nI suggest you pass the Configuration as an argument to databaseMigrator.configure() in IbisContext line 349, and use that as the named object", "url": "https://github.com/ibissource/iaf/pull/1210#discussion_r513625505", "createdAt": "2020-10-28T17:20:13Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/jdbc/migration/LiquibaseImpl.java", "diffHunk": "@@ -37,7 +38,7 @@\n  * @since\t7.0-B4\n  *\n  */\n-public class LiquibaseImpl {\n+public class LiquibaseImpl implements INamedObject{", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7707e88a076b649f5fb14bb1a88cd6beca5dec4e"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f40a8386a092ee6d24e943c6202385d1cc5f124f", "author": {"user": null}, "url": "https://github.com/ibissource/iaf/commit/f40a8386a092ee6d24e943c6202385d1cc5f124f", "committedDate": "2020-10-29T12:49:37Z", "message": "work on the feedback"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE5NjU0MTQ3", "url": "https://github.com/ibissource/iaf/pull/1210#pullrequestreview-519654147", "createdAt": "2020-10-29T13:19:16Z", "commit": {"oid": "f40a8386a092ee6d24e943c6202385d1cc5f124f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxMzoxOToxNlrOHqbZMQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxMzoyMzo0M1rOHqbkhg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDI1MTA1Nw==", "bodyText": "You don't need to specify the ClassLoader as you can retrieve this from the Configuration.", "url": "https://github.com/ibissource/iaf/pull/1210#discussion_r514251057", "createdAt": "2020-10-29T13:19:16Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/jdbc/migration/Migrator.java", "diffHunk": "@@ -41,19 +42,16 @@ public Migrator() {\n \n \t@Override\n \tpublic void configure() throws ConfigurationException {\n-\t\tconfigure(null, null, null);\n+\t\tthrow new IllegalStateException(\"No configuration is specified!\");\n \t}\n \n-\tpublic void configure(String configurationName) throws ConfigurationException {\n-\t\tconfigure(configurationName, null, null);\n+\tpublic void configure(Configuration configuration, ClassLoader classLoader) throws ConfigurationException {\n+\t\tconfigure(configuration, classLoader, null);\n \t}\n \n-\tpublic void configure(String configurationName, ClassLoader classLoader) throws ConfigurationException {\n-\t\tconfigure(configurationName, classLoader, null);\n-\t}\n-\n-\tpublic synchronized void configure(String configurationName, ClassLoader classLoader, String changeLogFile) throws ConfigurationException {\n-\t\tsetName(\"JdbcMigrator for configuration[\"+configurationName+\"]\");\n+\tpublic synchronized void configure(Configuration configuration, ClassLoader classLoader, String changeLogFile) throws ConfigurationException {\n+\t\tsetName(\"JdbcMigrator for configuration[\"+ configuration.getName() +\"]\");\n+\t\tsuper.configure();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f40a8386a092ee6d24e943c6202385d1cc5f124f"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDI1MjYzNg==", "bodyText": "This can be a configuration warning", "url": "https://github.com/ibissource/iaf/pull/1210#discussion_r514252636", "createdAt": "2020-10-29T13:21:41Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/jdbc/DirectQuerySender.java", "diffHunk": "@@ -50,7 +50,7 @@ public void configure() throws ConfigurationException {\n \tpublic void configure(boolean trust) throws ConfigurationException {\n \t\tsuper.configure();\n \t\tif (!trust) {\n-\t\t\tConfigurationWarnings.add(log, \"The class [\"+ClassUtils.nameOf(this)+\"] is used one or more times. This may cause potential SQL injections!\");\n+\t\t\tConfigurationWarnings.addGlobalWarning(log, \"The class [\"+ClassUtils.nameOf(this)+\"] is used one or more times. This may cause potential SQL injections!\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f40a8386a092ee6d24e943c6202385d1cc5f124f"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDI1Mzk1OA==", "bodyText": "Might be best to leave this in the try/catch, as otherwise it can prevent the configuration from starting up.", "url": "https://github.com/ibissource/iaf/pull/1210#discussion_r514253958", "createdAt": "2020-10-29T13:23:43Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/configuration/IbisContext.java", "diffHunk": "@@ -343,15 +343,15 @@ private void digestClassLoaderConfiguration(ClassLoader classLoader,\n \t\t\t\tConfigurationWarnings.getInstance().setActiveConfiguration(configuration);\n \n \t\t\t\tif(AppConstants.getInstance(classLoader).getBoolean(\"jdbc.migrator.active\", false)) {\n+\t\t\t\t\tMigrator databaseMigrator = getBean(\"jdbcMigrator\", Migrator.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f40a8386a092ee6d24e943c6202385d1cc5f124f"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "df5d019b5a86320502aee1aef0ea510974826b3e", "author": {"user": null}, "url": "https://github.com/ibissource/iaf/commit/df5d019b5a86320502aee1aef0ea510974826b3e", "committedDate": "2020-10-29T14:29:19Z", "message": "feedback fixes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwNDM2MjA0", "url": "https://github.com/ibissource/iaf/pull/1210#pullrequestreview-520436204", "createdAt": "2020-10-30T07:49:34Z", "commit": {"oid": "df5d019b5a86320502aee1aef0ea510974826b3e"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQwNzo0OTozNFrOHrERhQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQwNzo1MTo0N1rOHrEU2w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDkyMDgzNw==", "bodyText": "The null check is not necessary here anymore", "url": "https://github.com/ibissource/iaf/pull/1210#discussion_r514920837", "createdAt": "2020-10-30T07:49:34Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/jdbc/migration/Migrator.java", "diffHunk": "@@ -41,30 +43,27 @@ public Migrator() {\n \n \t@Override\n \tpublic void configure() throws ConfigurationException {\n-\t\tconfigure(null, null, null);\n+\t\tthrow new IllegalStateException(\"No configuration is specified!\");\n \t}\n \n-\tpublic void configure(String configurationName) throws ConfigurationException {\n-\t\tconfigure(configurationName, null, null);\n+\tpublic void configure(Configuration configuration) throws ConfigurationException {\n+\t\tconfigure(configuration, null);\n \t}\n \n-\tpublic void configure(String configurationName, ClassLoader classLoader) throws ConfigurationException {\n-\t\tconfigure(configurationName, classLoader, null);\n-\t}\n-\n-\tpublic synchronized void configure(String configurationName, ClassLoader classLoader, String changeLogFile) throws ConfigurationException {\n-\t\tsetName(\"JdbcMigrator for configuration[\"+configurationName+\"]\");\n+\tpublic synchronized void configure(Configuration configuration, String changeLogFile) throws ConfigurationException {\n+\t\tsetName(\"JdbcMigrator for configuration[\"+ configuration.getName() +\"]\");\n+\t\tsuper.configure();\n \n-\t\tAppConstants appConstants = AppConstants.getInstance(classLoader);\n+\t\tAppConstants appConstants = AppConstants.getInstance(configuration.getClassLoader());\n \n \t\tif(changeLogFile == null)\n \t\t\tchangeLogFile = appConstants.getString(\"liquibase.changeLogFile\", \"DatabaseChangelog.xml\");\n \n-\t\tLiquibaseClassLoaderWrapper cl = new LiquibaseClassLoaderWrapper(classLoader);\n+\t\tLiquibaseClassLoaderWrapper cl = new LiquibaseClassLoaderWrapper(configuration.getClassLoader());\n \t\tif(cl.getResource(changeLogFile) == null) {\n \t\t\tString msg = \"unable to find database changelog file [\"+changeLogFile+\"]\";\n-\t\t\tif(configurationName != null)\n-\t\t\t\tmsg += \" classLoader [\"+ClassUtils.nameOf(classLoader)+\"]\";\n+\t\t\tif(configuration.getName() != null)\n+\t\t\t\tmsg += \" classLoader [\"+ClassUtils.nameOf(configuration.getClassLoader())+\"]\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "df5d019b5a86320502aee1aef0ea510974826b3e"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDkyMTYwNA==", "bodyText": "This can be a configuration warning", "url": "https://github.com/ibissource/iaf/pull/1210#discussion_r514921604", "createdAt": "2020-10-30T07:51:35Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/unmanaged/DefaultIbisManager.java", "diffHunk": "@@ -119,7 +119,7 @@ private void updateFlowDiagram(Configuration configuration) {\n \t\t\ttry {\n \t\t\t\tflowDiagramManager.generate(configuration);\n \t\t\t} catch (IOException e) {\n-\t\t\t\tConfigurationWarnings.add(log, \"Error generating flow diagram for configuration [\"+configuration.getName()+\"]\", e);\n+\t\t\t\tConfigurationWarnings.addGlobalWarning(log, \"Error generating flow diagram for configuration [\"+configuration.getName()+\"]\", e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "df5d019b5a86320502aee1aef0ea510974826b3e"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDkyMTY5MQ==", "bodyText": "This can be a configuration warning", "url": "https://github.com/ibissource/iaf/pull/1210#discussion_r514921691", "createdAt": "2020-10-30T07:51:47Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/validation/XercesXmlValidator.java", "diffHunk": "@@ -132,7 +132,7 @@\n \t\t\t\tcache.open();\n \t\t\t} catch (ConfigurationException e) {\n \t\t\t\tcache = null;\n-\t\t\t\tConfigurationWarnings.add(log, \"Could not configure EhCache for XercesXmlValidator (xmlValidator.maxInitialised will be ignored)\", e);\n+\t\t\t\tConfigurationWarnings.addGlobalWarning(log, \"Could not configure EhCache for XercesXmlValidator (xmlValidator.maxInitialised will be ignored)\", e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "df5d019b5a86320502aee1aef0ea510974826b3e"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fcaebe8dee36660134b095c7166b81c7340d279b", "author": {"user": null}, "url": "https://github.com/ibissource/iaf/commit/fcaebe8dee36660134b095c7166b81c7340d279b", "committedDate": "2020-10-30T09:38:08Z", "message": "work on the feedback"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwNTExNTM2", "url": "https://github.com/ibissource/iaf/pull/1210#pullrequestreview-520511536", "createdAt": "2020-10-30T09:46:55Z", "commit": {"oid": "fcaebe8dee36660134b095c7166b81c7340d279b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwNTc5NTkw", "url": "https://github.com/ibissource/iaf/pull/1210#pullrequestreview-520579590", "createdAt": "2020-10-30T11:25:22Z", "commit": {"oid": "fcaebe8dee36660134b095c7166b81c7340d279b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1019, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}