{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI0MDc3ODg2", "number": 766, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQwNjoxMToyM1rOEAxGWg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQwOToxODoxN1rOEA0XKQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY5MjM5ODk4OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/nl/nn/adapterframework/http/rest/ApiListenerServlet.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQwNjoxMToyM1rOGcP9NQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQwODozODo1NFrOGcT57g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI3NDc0MQ==", "bodyText": "Dit moet m.i. niet hier, maar in ApiListener.getIdFromRawMessage()", "url": "https://github.com/ibissource/iaf/pull/766#discussion_r432274741", "createdAt": "2020-05-29T06:11:23Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/http/rest/ApiListenerServlet.java", "diffHunk": "@@ -444,7 +445,15 @@ else if(segment.startsWith(\"{\") && segment.endsWith(\"}\")) {\n \t\t\tif (!ServletFileUpload.isMultipartContent(request)) {\n \t\t\t\tbody = Misc.streamToString(request.getInputStream(),\"\\n\",false);\n \t\t\t}\n-\t\t\t//TODO: String correlationId = request.getHeader(\"message-id\");\n+\n+\t\t\tString messageId = null;\n+\t\t\tif(StringUtils.isNotEmpty(listener.getMessageIdHeader())) {\n+\t\t\t\tString messageIdHeader = request.getHeader(listener.getMessageIdHeader());\n+\t\t\t\tif(StringUtils.isNotEmpty(messageIdHeader)) {\n+\t\t\t\t\tmessageId = messageIdHeader;\n+\t\t\t\t}\n+\t\t\t}\n+\t\t\tPipeLineSessionBase.setListenerParameters(messageContext, messageId, null, null, null); //We're only using this method to keep setting id/cid/tcid uniform", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01b40c4dc693795bac4ccb345435d1f38fef3b85"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjMzOTQzOA==", "bodyText": "Ik heb hier issue #769 voor aangemaakt", "url": "https://github.com/ibissource/iaf/pull/766#discussion_r432339438", "createdAt": "2020-05-29T08:38:54Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/http/rest/ApiListenerServlet.java", "diffHunk": "@@ -444,7 +445,15 @@ else if(segment.startsWith(\"{\") && segment.endsWith(\"}\")) {\n \t\t\tif (!ServletFileUpload.isMultipartContent(request)) {\n \t\t\t\tbody = Misc.streamToString(request.getInputStream(),\"\\n\",false);\n \t\t\t}\n-\t\t\t//TODO: String correlationId = request.getHeader(\"message-id\");\n+\n+\t\t\tString messageId = null;\n+\t\t\tif(StringUtils.isNotEmpty(listener.getMessageIdHeader())) {\n+\t\t\t\tString messageIdHeader = request.getHeader(listener.getMessageIdHeader());\n+\t\t\t\tif(StringUtils.isNotEmpty(messageIdHeader)) {\n+\t\t\t\t\tmessageId = messageIdHeader;\n+\t\t\t\t}\n+\t\t\t}\n+\t\t\tPipeLineSessionBase.setListenerParameters(messageContext, messageId, null, null, null); //We're only using this method to keep setting id/cid/tcid uniform", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI3NDc0MQ=="}, "originalCommit": {"oid": "01b40c4dc693795bac4ccb345435d1f38fef3b85"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY5MjQwNDI2OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/nl/nn/adapterframework/receivers/ReceiverBase.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQwNjoxNDowNVrOGcQAaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQwODozOTowNFrOGcT6OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI3NTU2MA==", "bodyText": "Kunnen we dat niet op een nette manier fixen?", "url": "https://github.com/ibissource/iaf/pull/766#discussion_r432275560", "createdAt": "2020-05-29T06:14:05Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/receivers/ReceiverBase.java", "diffHunk": "@@ -894,15 +894,26 @@ public String processRequest(IListener origin, String correlationId, String mess\n \t\tDate tsReceived = null;\n \t\tDate tsSent = null;\n \t\tif (context!=null) {\n-\t\t\t//TODO ClassCasting Exceptions occur when using PipeLineSessionBase.setListenerParameters\n-\t\t\ttsReceived = (Date)context.get(IPipeLineSession.tsReceivedKey);\n-\t\t\ttsSent = (Date)context.get(IPipeLineSession.tsSentKey);\n+\t\t\t//ClassCasting Exceptions occur when using PipeLineSessionBase.setListenerParameters, hence these silly instanceof's", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01b40c4dc693795bac4ccb345435d1f38fef3b85"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjMzOTUxMw==", "bodyText": "Ik heb hier issue #770 voor aangemaakt", "url": "https://github.com/ibissource/iaf/pull/766#discussion_r432339513", "createdAt": "2020-05-29T08:39:04Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/receivers/ReceiverBase.java", "diffHunk": "@@ -894,15 +894,26 @@ public String processRequest(IListener origin, String correlationId, String mess\n \t\tDate tsReceived = null;\n \t\tDate tsSent = null;\n \t\tif (context!=null) {\n-\t\t\t//TODO ClassCasting Exceptions occur when using PipeLineSessionBase.setListenerParameters\n-\t\t\ttsReceived = (Date)context.get(IPipeLineSession.tsReceivedKey);\n-\t\t\ttsSent = (Date)context.get(IPipeLineSession.tsSentKey);\n+\t\t\t//ClassCasting Exceptions occur when using PipeLineSessionBase.setListenerParameters, hence these silly instanceof's", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI3NTU2MA=="}, "originalCommit": {"oid": "01b40c4dc693795bac4ccb345435d1f38fef3b85"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY5MjkzMzUzOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/nl/nn/adapterframework/http/rest/ApiListener.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQwOToxODoxN1rOGcVMsw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQwOToxODoxN1rOGcVMsw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjM2MDYyNw==", "bodyText": "Het lijkt me zinvol om de message-id niet alleen uit een Http Header te kunnen halen, maar ook uit een request-parameter.", "url": "https://github.com/ibissource/iaf/pull/766#discussion_r432360627", "createdAt": "2020-05-29T09:18:17Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/http/rest/ApiListener.java", "diffHunk": "@@ -237,6 +241,15 @@ public String getMultipartBodyName() {\n \t\treturn null;\n \t}\n \n+\t@IbisDoc({\"8\", \"name of the header which contains the message-id\", \"message-id\"})\n+\tpublic void setMessageIdHeader(String messageIdHeader) {\n+\t\tthis.messageIdHeader = messageIdHeader;\n+\t}\n+\n+\tpublic String getMessageIdHeader() {\n+\t\treturn messageIdHeader;\n+\t}\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01b40c4dc693795bac4ccb345435d1f38fef3b85"}, "originalPosition": 30}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 367, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}