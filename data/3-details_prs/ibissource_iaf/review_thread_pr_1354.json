{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ0MTYzMTc5", "number": 1354, "reviewThreads": {"totalCount": 22, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQxNTowMDowM1rOFIMCRg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNVQwOTozMDo0MFrOFPGmqA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ0MTMwMTE4OnYy", "diffSide": "LEFT", "path": "core/src/main/java/nl/nn/adapterframework/extensions/mqtt/MqttListener.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQxNTowMDowM1rOIJ-F2g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQxNTowMDowM1rOIJ-F2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzMyNTQwMg==", "bodyText": "Dit lijkt me de documentatie van de Recover feature. Misschien goed om die te bewaren/valideren", "url": "https://github.com/ibissource/iaf/pull/1354#discussion_r547325402", "createdAt": "2020-12-22T15:00:03Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/extensions/mqtt/MqttListener.java", "diffHunk": "@@ -99,21 +97,10 @@ public void open() throws ListenerException {\n \t\t\tsuper.open();\n \t\t\tclient.subscribe(getTopic(), getQos());\n \t\t} catch (Exception e) {\n-\t\t\te.printStackTrace();\n \t\t\tthrow new ListenerException(\"Could not subscribe to topic\", e);\n \t\t}\n \t}\n \n-\t@Override\n-\tpublic void close() {\n-\t\t// Prevent log.warn() when trying to recover. Recover will be triggered\n-\t\t// when connectionLost was called or listener could not start in which\n-\t\t// case client is already disconnected.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c0de5407d18c06fc1b53853942b639f8142b2aff"}, "originalPosition": 39}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ0MTMwNjQ1OnYy", "diffSide": "LEFT", "path": "core/src/main/java/nl/nn/adapterframework/pipes/XmlValidator.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQxNTowMTozM1rOIJ-I7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQxNTowMTozM1rOIJ-I7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzMyNjE4OA==", "bodyText": "Doen we dit niet meer?", "url": "https://github.com/ibissource/iaf/pull/1354#discussion_r547326188", "createdAt": "2020-12-22T15:01:33Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/pipes/XmlValidator.java", "diffHunk": "@@ -860,12 +874,6 @@ public void setIgnoreCaching(boolean ignoreCaching) {\n \t\tvalidator.setIgnoreCaching(ignoreCaching);\n \t}\n \n-\t@IbisDocRef({ABSTRACTXMLVALIDATOR})\n-\tpublic void setLazyInit(boolean lazyInit) {\n-\t\tvalidator.setLazyInit(lazyInit);\n-\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c0de5407d18c06fc1b53853942b639f8142b2aff"}, "originalPosition": 41}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ0MTMxMTI2OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/nl/nn/adapterframework/receivers/Receiver.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQxNTowMjo1NFrOIJ-LyQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQxNTowMjo1NFrOIJ-LyQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzMyNjkyMQ==", "bodyText": "Dit mag als getOnErrorEnum()==ON_ERROR.CONTINUE\nof beter nog\nswitch (getOnErrorEnum()) {", "url": "https://github.com/ibissource/iaf/pull/1354#discussion_r547326921", "createdAt": "2020-12-22T15:02:54Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/receivers/Receiver.java", "diffHunk": "@@ -1462,10 +1457,9 @@ private boolean isDuplicateAndSkip(IMessageBrowser<Serializable> transactionStor\n \t@Override\n \tpublic void exceptionThrown(INamedObject object, Throwable t) {\n \t\tString msg = getLogPrefix()+\"received exception [\"+t.getClass().getName()+\"] from [\"+object.getName()+\"]\";\n-\t\tif (ONERROR_CONTINUE.equalsIgnoreCase(getOnError())) {\n-//\t\t\twarn(msg+\", will continue processing messages when they arrive: \"+ t.getMessage());\n-\t\t\terror(msg+\", will continue processing messages when they arrive\",t);\n-\t\t} else if (ONERROR_RECOVER.equalsIgnoreCase(getOnError())) {\n+\t\tif (ON_ERROR.CONTINUE.equals(getOnErrorEnum())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c0de5407d18c06fc1b53853942b639f8142b2aff"}, "originalPosition": 46}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ0MTM1ODU3OnYy", "diffSide": "RIGHT", "path": "core/src/test/java/nl/nn/adapterframework/pipes/Json2XmlValidatorTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQxNToxNTo0MFrOIJ-oGQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQxNToxNTo0MFrOIJ-oGQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzMzNDE2OQ==", "bodyText": "Als je hem niet gebruikt hoef je hem ook niet op te halen", "url": "https://github.com/ibissource/iaf/pull/1354#discussion_r547334169", "createdAt": "2020-12-22T15:15:40Z", "author": {"login": "gvanbrakel"}, "path": "core/src/test/java/nl/nn/adapterframework/pipes/Json2XmlValidatorTest.java", "diffHunk": "@@ -33,13 +33,13 @@ public void testNoNamespaceXml2Json() throws Exception {\n \t\tpipe.setThrowException(true);\n \t\tpipe.configure();\n \t\tpipe.start();\n-\t\t\n+\n \t\tString input = TestFileUtils.getTestFile(\"/Validation/NoNamespace/bp-response.xml\");\n-\t\tString expected = TestFileUtils.getTestFile(\"/Validation/NoNamespace/bp-response-compact.json\");\n-\t\t\n+\t\tTestFileUtils.getTestFile(\"/Validation/NoNamespace/bp-response-compact.json\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c0de5407d18c06fc1b53853942b639f8142b2aff"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ0MTM2MDA0OnYy", "diffSide": "RIGHT", "path": "core/src/test/java/nl/nn/adapterframework/pipes/Json2XmlValidatorTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQxNToxNjowMFrOIJ-o4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQxNToxNjowMFrOIJ-o4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzMzNDM2OQ==", "bodyText": "Als je hem niet gebruikt hoef je hem ook niet op te halen", "url": "https://github.com/ibissource/iaf/pull/1354#discussion_r547334369", "createdAt": "2020-12-22T15:16:00Z", "author": {"login": "gvanbrakel"}, "path": "core/src/test/java/nl/nn/adapterframework/pipes/Json2XmlValidatorTest.java", "diffHunk": "@@ -60,11 +60,11 @@ public void testNoNamespaceXml() throws Exception {\n \t\tpipe.start();\n \t\t\n \t\tString input = TestFileUtils.getTestFile(\"/Validation/NoNamespace/bp-response.xml\");\n-\t\tString expected = TestFileUtils.getTestFile(\"/Validation/NoNamespace/bp-response-compact.json\");\n+\t\tTestFileUtils.getTestFile(\"/Validation/NoNamespace/bp-response-compact.json\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c0de5407d18c06fc1b53853942b639f8142b2aff"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ0MTM2NjQ3OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/nl/nn/adapterframework/configuration/Configuration.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQxNToxNzo0MVrOIJ-skw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQxNToxNzo0MVrOIJ-skw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzMzNTMxNQ==", "bodyText": "Maak je dan een issue om dit recht te trekken?", "url": "https://github.com/ibissource/iaf/pull/1354#discussion_r547335315", "createdAt": "2020-12-22T15:17:41Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/configuration/Configuration.java", "diffHunk": "@@ -240,13 +240,18 @@ public boolean isRegisteredReceiver(String adapterName, String receiverName) {\n \t/**\n \t * Register an adapter with the configuration.\n \t */\n-\tpublic void registerAdapter(Adapter adapter) throws ConfigurationException {\n+\tpublic void registerAdapter(Adapter adapter) {\n \t\tif (!adapter.isActive()) {\n \t\t\tlog.debug(\"adapter [\" + adapter.getName() + \"] is not active, therefore not included in configuration\");\n \t\t\treturn;\n \t\t}\n \t\tadapter.setConfiguration(this);\n-\t\tadapterService.registerAdapter(adapter);\n+\t\ttry {\n+\t\t\tadapterService.registerAdapter(adapter);\n+\t\t} catch (ConfigurationException e) { //For some reason the adapterService configures the adapter...\n+\t\t\t//Do nothing as this will cause the digester to stop digesting the configuration\n+\t\t\t//TODO: this the configuration should have a configure method which configures every adapter.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c0de5407d18c06fc1b53853942b639f8142b2aff"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ0MTM3MTQzOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/nl/nn/adapterframework/core/PipeLine.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQxNToxOTowMVrOIJ-vZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQxNToxOTowMVrOIJ-vZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzMzNjAzOQ==", "bodyText": "Dit moet de MessageSendingPipe zelf doen", "url": "https://github.com/ibissource/iaf/pull/1354#discussion_r547336039", "createdAt": "2020-12-22T15:19:01Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/core/PipeLine.java", "diffHunk": "@@ -598,15 +631,51 @@ public void start() throws PipeStartException {\n \t */\n \tpublic void stop() {\n \t\tlog.info(getLogPrefix()+\"is closing pipeline\");\n+\n+\t\tif (getInputWrapper()!=null) {\n+\t\t\tlog.debug(getLogPrefix()+\"stopping InputWrapper [\"+getInputWrapper().getName()+\"]\");\n+\t\t\tgetInputWrapper().stop();\n+\t\t}\n+\n+\t\tif (getInputValidator()!=null) {\n+\t\t\tlog.debug(getLogPrefix()+\"stopping InputValidator [\"+getInputValidator().getName()+\"]\");\n+\t\t\tgetInputValidator().stop();\n+\t\t}\n+\n \t\tfor (int i=0; i<pipes.size(); i++) {\n \t\t\tIPipe pipe = getPipe(i);\n \t\t\tString pipeName = pipe.getName();\n \n \t\t\tlog.debug(getLogPrefix()+\"is stopping [\" + pipeName+\"]\");\n+\t\t\tif (pipe instanceof MessageSendingPipe) {\n+\t\t\t\tMessageSendingPipe messageSendingPipe = (MessageSendingPipe) pipe;\n+\t\t\t\tif (messageSendingPipe.getInputValidator() != null) {\n+\t\t\t\t\tmessageSendingPipe.getInputValidator().stop();\n+\t\t\t\t}\n+\t\t\t\tif (messageSendingPipe.getOutputValidator() != null) {\n+\t\t\t\t\tmessageSendingPipe.getOutputValidator().stop();\n+\t\t\t\t}\n+\t\t\t\tif (messageSendingPipe.getInputWrapper() != null) {\n+\t\t\t\t\tmessageSendingPipe.getInputWrapper().stop();\n+\t\t\t\t}\n+\t\t\t\tif (messageSendingPipe.getOutputWrapper() != null) {\n+\t\t\t\t\tmessageSendingPipe.getOutputWrapper().stop();\n+\t\t\t\t}\n+\t\t\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c0de5407d18c06fc1b53853942b639f8142b2aff"}, "originalPosition": 106}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ0MTM3MzAzOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/nl/nn/adapterframework/core/PipeLine.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQxNToxOToyNVrOIJ-wWg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQxNToxOToyNVrOIJ-wWg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzMzNjI4Mg==", "bodyText": "Dit moet de MessageSendingPipe zelf doen", "url": "https://github.com/ibissource/iaf/pull/1354#discussion_r547336282", "createdAt": "2020-12-22T15:19:25Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/core/PipeLine.java", "diffHunk": "@@ -579,16 +577,51 @@ public void start() throws PipeStartException {\n \t\t\tcache.open();\n \t\t}\n \n+\t\tif (getInputWrapper()!=null) {\n+\t\t\tlog.debug(getLogPrefix()+\"starting InputWrapper [\"+getInputWrapper().getName()+\"]\");\n+\t\t\tgetInputWrapper().start();\n+\t\t}\n+\n+\t\tif (getInputValidator()!=null) {\n+\t\t\tlog.debug(getLogPrefix()+\"starting InputValidator [\"+getInputValidator().getName()+\"]\");\n+\t\t\tgetInputValidator().start();\n+\t\t}\n+\n \t\tfor (int i=0; i<pipes.size(); i++) {\n \t\t\tIPipe pipe = getPipe(i);\n \t\t\tString pipeName = pipe.getName();\n \n \t\t\tlog.debug(getLogPrefix()+\"starting pipe [\" + pipeName+\"]\");\n+\t\t\tif (pipe instanceof MessageSendingPipe) {\n+\t\t\t\tMessageSendingPipe messageSendingPipe = (MessageSendingPipe) pipe;\n+\t\t\t\tif (messageSendingPipe.getInputValidator() != null) {\n+\t\t\t\t\tmessageSendingPipe.getInputValidator().start();\n+\t\t\t\t}\n+\t\t\t\tif (messageSendingPipe.getOutputValidator() != null) {\n+\t\t\t\t\tmessageSendingPipe.getOutputValidator().start();\n+\t\t\t\t}\n+\t\t\t\tif (messageSendingPipe.getInputWrapper() != null) {\n+\t\t\t\t\tmessageSendingPipe.getInputWrapper().start();\n+\t\t\t\t}\n+\t\t\t\tif (messageSendingPipe.getOutputWrapper() != null) {\n+\t\t\t\t\tmessageSendingPipe.getOutputWrapper().start();\n+\t\t\t\t}\n+\t\t\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c0de5407d18c06fc1b53853942b639f8142b2aff"}, "originalPosition": 52}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ0MTM3NjY4OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/nl/nn/adapterframework/scheduler/JobDef.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQxNToyMDozMVrOIJ-ymA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQxNToyMDozMVrOIJ-ymA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzMzNjg1Ng==", "bodyText": "Oeps?", "url": "https://github.com/ibissource/iaf/pull/1354#discussion_r547336856", "createdAt": "2020-12-22T15:20:31Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/scheduler/JobDef.java", "diffHunk": "@@ -1111,57 +1087,41 @@ private void recoverAdapters(IbisManager ibisManager) {\n \t\t\t} else {\n \t\t\t\theartbeatLog.warn(message);\n \t\t\t}\n+\n \t\t\tfor (Receiver receiver: adapter.getReceivers()) {\n \t\t\t\tcountReceiver++;\n \n \t\t\t\tRunStateEnum receiverRunState = receiver.getRunState();\n-\t\t\t\tif (!adapterRunState.equals(RunStateEnum.ERROR) && receiverRunState.equals(RunStateEnum.ERROR)) {\n+\t\t\t\tif (adapterRunState.equals(RunStateEnum.STARTED) && receiverRunState.equals(RunStateEnum.ERROR) && receiver.configurationSucceeded()) { //Only try to (re-)start receivers in a running adapter\n \t\t\t\t\tlog.debug(\"trying to recover receiver [\" + receiver.getName() + \"] of adapter [\" + adapter.getName() + \"]\");\n-\t\t\t\t\ttry {\n-\t\t\t\t\t\treceiver.setRecover(true);\n-\t\t\t\t\t\tadapter.configureReceiver(receiver);\n-\t\t\t\t\t} finally {\n-\t\t\t\t\t\treceiver.setRecover(false);\n-\t\t\t\t\t}\n-\t\t\t\t\tif (receiver.configurationSucceeded()) {\n-\t\t\t\t\t\treceiver.stopRunning();\n-\t\t\t\t\t\tint count = 10;\n-\t\t\t\t\t\twhile (count-- >= 0\n-\t\t\t\t\t\t\t\t&& !receiver.getRunState().equals(RunStateEnum.STOPPED)) {\n-\t\t\t\t\t\t\ttry {\n-\t\t\t\t\t\t\t\tThread.sleep(1000);\n-\t\t\t\t\t\t\t} catch (InterruptedException e) {\n-\t\t\t\t\t\t\t\tlog.debug(\"Interrupted waiting for receiver to stop\", e);\n-\t\t\t\t\t\t\t}\n-\t\t\t\t\t\t}\n-\t\t\t\t\t}\n-\t\t\t\t\t// check for start is in method startRunning in Receiver itself\n+\n \t\t\t\t\treceiver.startRunning();\n+\n \t\t\t\t\tlog.debug(\"finished recovering receiver [\" + receiver.getName() + \"] of adapter [\" + adapter.getName() + \"]\");\n-\t\t\t\t} else if (receiverRunState\n-\t\t\t\t\t\t.equals(RunStateEnum.STARTED)) {\n+\t\t\t\t} else if (receiverRunState.equals(RunStateEnum.STARTED)) {\n \t\t\t\t\t// workaround for started RestListeners of which\n \t\t\t\t\t// uriPattern is not registered correctly\n \t\t\t\t\tIListener listener = receiver.getListener();\n \t\t\t\t\tif (listener instanceof RestListener) {\n \t\t\t\t\t\tRestListener restListener = (RestListener) listener;\n \t\t\t\t\t\tString matchingPattern = RestServiceDispatcher.getInstance().findMatchingPattern(\"/\" + restListener.getUriPattern());\n \t\t\t\t\t\tif (matchingPattern == null) {\n-\t\t\t\t\t\t\tlog.debug(\"trying to recover receiver [\" + receiver.getName() + \"] (restListener) of adapter [\" + adapter.getName() + \"]\");\n-\t\t\t\t\t\t\tif (receiver.configurationSucceeded()) {\n-\t\t\t\t\t\t\t\treceiver.stopRunning();\n-\t\t\t\t\t\t\t\tint count = 10;\n-\t\t\t\t\t\t\t\twhile (count-- >= 0 && !receiver.getRunState().equals(RunStateEnum.STOPPED)) {\n-\t\t\t\t\t\t\t\t\ttry {\n-\t\t\t\t\t\t\t\t\t\tThread.sleep(1000);\n-\t\t\t\t\t\t\t\t\t} catch (InterruptedException e) {\n-\t\t\t\t\t\t\t\t\t\tlog.debug(\"Interrupted waiting for receiver to stop\", e);\n-\t\t\t\t\t\t\t\t\t}\n-\t\t\t\t\t\t\t\t}\n-\t\t\t\t\t\t\t}\n-\t\t\t\t\t\t\t// check for start is in method startRunning in Receiver itself\n-\t\t\t\t\t\t\treceiver.startRunning();\n-\t\t\t\t\t\t\tlog.debug(\"finished recovering receiver [\" + receiver.getName() + \"] (restListener) of adapter [\" + adapter.getName() + \"]\");\n+\t\t\t\t\t\t\tSystem.err.println(\"yoyoyo matcher dasher in the house\");\n+//\t\t\t\t\t\t\tlog.debug(\"trying to recover receiver [\" + receiver.getName() + \"] (restListener) of adapter [\" + adapter.getName() + \"]\");\n+//\t\t\t\t\t\t\tif (receiver.configurationSucceeded()) {\n+//\t\t\t\t\t\t\t\treceiver.stopRunning();\n+//\t\t\t\t\t\t\t\tint count = 10;\n+//\t\t\t\t\t\t\t\twhile (count-- >= 0 && !receiver.getRunState().equals(RunStateEnum.STOPPED)) {\n+//\t\t\t\t\t\t\t\t\ttry {\n+//\t\t\t\t\t\t\t\t\t\tThread.sleep(1000);\n+//\t\t\t\t\t\t\t\t\t} catch (InterruptedException e) {\n+//\t\t\t\t\t\t\t\t\t\tlog.debug(\"Interrupted waiting for receiver to stop\", e);\n+//\t\t\t\t\t\t\t\t\t}\n+//\t\t\t\t\t\t\t\t}\n+//\t\t\t\t\t\t\t}\n+//\t\t\t\t\t\t\t// check for start is in method startRunning in Receiver itself\n+//\t\t\t\t\t\t\treceiver.startRunning();\n+//\t\t\t\t\t\t\tlog.debug(\"finished recovering receiver [\" + receiver.getName() + \"] (restListener) of adapter [\" + adapter.getName() + \"]\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c0de5407d18c06fc1b53853942b639f8142b2aff"}, "originalPosition": 124}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ0NDEzODkxOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/nl/nn/adapterframework/core/PipeLine.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QwNzo0NDozM1rOIKY20w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QwNzo0NDozM1rOIKY20w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Nzc2MzkyMw==", "bodyText": "Dat moet die MessageSendingPipe toch ook zelf doen?", "url": "https://github.com/ibissource/iaf/pull/1354#discussion_r547763923", "createdAt": "2020-12-23T07:44:33Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/core/PipeLine.java", "diffHunk": "@@ -377,18 +375,6 @@ public void configure(IPipe pipe) throws ConfigurationException {\n \t\t\t}\n \t\t\tif (pipe instanceof MessageSendingPipe) {\n \t\t\t\tMessageSendingPipe messageSendingPipe = (MessageSendingPipe) pipe;\n-\t\t\t\tif (messageSendingPipe.getInputValidator() != null) {\n-\t\t\t\t\tconfigure(messageSendingPipe.getInputValidator());\n-\t\t\t\t}\n-\t\t\t\tif (messageSendingPipe.getOutputValidator() != null) {\n-\t\t\t\t\tconfigure(messageSendingPipe.getOutputValidator());\n-\t\t\t\t}\n-\t\t\t\tif (messageSendingPipe.getInputWrapper() != null) {\n-\t\t\t\t\tconfigure(messageSendingPipe.getInputWrapper());\n-\t\t\t\t}\n-\t\t\t\tif (messageSendingPipe.getOutputWrapper() != null) {\n-\t\t\t\t\tconfigure(messageSendingPipe.getOutputWrapper());\n-\t\t\t\t}\n \t\t\t\tif (messageSendingPipe.getMessageLog() != null) {\n \t\t\t\t\tpipeStatistics.put(messageSendingPipe.getMessageLog().getName(), new StatisticsKeeper(messageSendingPipe.getMessageLog().getName()));\n \t\t\t\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d0c03cca00c653d39965897c2faec19074a662f2"}, "originalPosition": 37}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ0NDE0NTc4OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/nl/nn/adapterframework/core/PipeLine.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QwNzo0NTo1NVrOIKY7JQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QwNzo0NTo1NVrOIKY7JQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Nzc2NTAyOQ==", "bodyText": "Ik zou dit blok op regel 577 gezet hebben.", "url": "https://github.com/ibissource/iaf/pull/1354#discussion_r547765029", "createdAt": "2020-12-23T07:45:55Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/core/PipeLine.java", "diffHunk": "@@ -587,8 +583,18 @@ public void start() throws PipeStartException {\n \t\t\tpipe.start();\n \t\t\tlog.debug(getLogPrefix()+\"successfully started pipe [\" + pipeName + \"]\");\n \t\t}\n-\tlog.info(getLogPrefix()+\"is successfully started pipeline\");\n \n+\t\tif (getOutputValidator()!=null) {\n+\t\t\tlog.debug(getLogPrefix()+\"starting OutputValidator [\"+getOutputValidator().getName()+\"]\");\n+\t\t\tgetOutputValidator().start();\n+\t\t}\n+\n+\t\tif (getOutputWrapper()!=null) {\n+\t\t\tlog.debug(getLogPrefix()+\"starting OutputWrapper [\"+getOutputWrapper().getName()+\"]\");\n+\t\t\tgetOutputWrapper().start();\n+\t\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d0c03cca00c653d39965897c2faec19074a662f2"}, "originalPosition": 69}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ0NDE0NzY5OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/nl/nn/adapterframework/core/PipeLine.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QwNzo0NjoxN1rOIKY8Rw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QwNzo0NjoxN1rOIKY8Rw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Nzc2NTMxOQ==", "bodyText": "En dit blok op 617", "url": "https://github.com/ibissource/iaf/pull/1354#discussion_r547765319", "createdAt": "2020-12-23T07:46:17Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/core/PipeLine.java", "diffHunk": "@@ -607,6 +624,16 @@ public void stop() {\n \t\t\tlog.debug(getLogPrefix()+\"successfully stopped pipe [\" + pipeName + \"]\");\n \t\t}\n \n+\t\tif (getOutputValidator()!=null) {\n+\t\t\tlog.debug(getLogPrefix()+\"stopping OutputValidator [\"+getOutputValidator().getName()+\"]\");\n+\t\t\tgetOutputValidator().stop();\n+\t\t}\n+\n+\t\tif (getOutputWrapper()!=null) {\n+\t\t\tlog.debug(getLogPrefix()+\"stopping OutputWrapper [\"+getOutputWrapper().getName()+\"]\");\n+\t\t\tgetOutputWrapper().stop();\n+\t\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d0c03cca00c653d39965897c2faec19074a662f2"}, "originalPosition": 105}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzUxMDE4NTQxOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/nl/nn/adapterframework/core/Adapter.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNFQxNjo0NTo0NFrOITtbhA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNVQwOTo0Njo0OVrOIUSqbA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzUzODE4MA==", "bodyText": "Hier bedoel je dan toch: 'check if we should fail when configurationSucceeded!=true'", "url": "https://github.com/ibissource/iaf/pull/1354#discussion_r557538180", "createdAt": "2021-01-14T16:45:44Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/core/Adapter.java", "diffHunk": "@@ -169,34 +169,37 @@ public boolean configurationSucceeded() {\n \t * @see nl.nn.adapterframework.core.Pipeline#configurePipes\n \t */\n \t@Override\n-\tpublic void configure() throws ConfigurationException {\n+\tpublic void configure() throws ConfigurationException { //TODO check if we should fail when configurationSucceeded==true", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "24351c83b46f8dc94ac2f0b4e4540066d73ac986"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODE0ODIwNA==", "bodyText": "Nee, ik bedoel wanneer je 2x configure() aanroept.", "url": "https://github.com/ibissource/iaf/pull/1354#discussion_r558148204", "createdAt": "2021-01-15T09:46:49Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/core/Adapter.java", "diffHunk": "@@ -169,34 +169,37 @@ public boolean configurationSucceeded() {\n \t * @see nl.nn.adapterframework.core.Pipeline#configurePipes\n \t */\n \t@Override\n-\tpublic void configure() throws ConfigurationException {\n+\tpublic void configure() throws ConfigurationException { //TODO check if we should fail when configurationSucceeded==true", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzUzODE4MA=="}, "originalCommit": {"oid": "24351c83b46f8dc94ac2f0b4e4540066d73ac986"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzUxMzU3MzgxOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/nl/nn/adapterframework/receivers/PullingListenerContainer.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNVQwOTowMzowMlrOIUOqtA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNVQxMDowMjowMVrOIUULmw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODA4Mjc0MA==", "bodyText": "Het lijkt er op dat je dit opneemt om van de getLogPrefix() af te komen.\nDan moet je wel ook een %x in de log4j conversion patterns opnemen.", "url": "https://github.com/ibissource/iaf/pull/1354#discussion_r558082740", "createdAt": "2021-01-15T09:03:02Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/receivers/PullingListenerContainer.java", "diffHunk": "@@ -136,17 +138,18 @@ public boolean isLongLived() {\n \n \t\t@Override\n \t\tpublic void run() {\n-\t\t\tlog.debug(receiver.getLogPrefix()+\" taskExecutor [\"+ToStringBuilder.reflectionToString(taskExecutor)+\"]\");\n+\t\t\tThreadContext.push(ClassUtils.nameOf(receiver) + \" [\"+receiver.getName()+\"]\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "24351c83b46f8dc94ac2f0b4e4540066d73ac986"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODE3MzA4Mw==", "bodyText": "Wij gebruiken %TC een eigen implementatie om de NDC stack weer te geven. Zie IbisNdcPatternConverter", "url": "https://github.com/ibissource/iaf/pull/1354#discussion_r558173083", "createdAt": "2021-01-15T10:02:01Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/receivers/PullingListenerContainer.java", "diffHunk": "@@ -136,17 +138,18 @@ public boolean isLongLived() {\n \n \t\t@Override\n \t\tpublic void run() {\n-\t\t\tlog.debug(receiver.getLogPrefix()+\" taskExecutor [\"+ToStringBuilder.reflectionToString(taskExecutor)+\"]\");\n+\t\t\tThreadContext.push(ClassUtils.nameOf(receiver) + \" [\"+receiver.getName()+\"]\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODA4Mjc0MA=="}, "originalCommit": {"oid": "24351c83b46f8dc94ac2f0b4e4540066d73ac986"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzUxMzYzMzE1OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/nl/nn/adapterframework/receivers/Receiver.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNVQwOTowOToyOVrOIUPSsQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNVQwOTo1NToyNVrOIUTgNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODA5Mjk3Nw==", "bodyText": "Waarom deze if toegevoegd?\nDus waarom mag hij alleen uit STOPPING naar STOPPED?", "url": "https://github.com/ibissource/iaf/pull/1354#discussion_r558092977", "createdAt": "2021-01-15T09:09:29Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/receivers/Receiver.java", "diffHunk": "@@ -483,13 +493,17 @@ protected void closeAllResources() {\n \t\t\t\terror(\"error closing message log\", t);\n \t\t\t}\n \t\t}\n+\n \t\tlog.debug(getLogPrefix()+\"closed\");\n-\t\trunState.setRunState(RunStateEnum.STOPPED);\n+\t\tif (runState.isInState(RunStateEnum.STOPPING)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "24351c83b46f8dc94ac2f0b4e4540066d73ac986"}, "originalPosition": 96}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODE2MTk3Mg==", "bodyText": "Ja, ik vond dit nodig. Dan krijgen wij vanzelf gezeur wanneer het niet op STOPPED gezet wordt (en dus de close niet goed aangeroepen wordt!)", "url": "https://github.com/ibissource/iaf/pull/1354#discussion_r558161972", "createdAt": "2021-01-15T09:55:25Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/receivers/Receiver.java", "diffHunk": "@@ -483,13 +493,17 @@ protected void closeAllResources() {\n \t\t\t\terror(\"error closing message log\", t);\n \t\t\t}\n \t\t}\n+\n \t\tlog.debug(getLogPrefix()+\"closed\");\n-\t\trunState.setRunState(RunStateEnum.STOPPED);\n+\t\tif (runState.isInState(RunStateEnum.STOPPING)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODA5Mjk3Nw=="}, "originalCommit": {"oid": "24351c83b46f8dc94ac2f0b4e4540066d73ac986"}, "originalPosition": 96}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzUxMzY2ODc1OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/nl/nn/adapterframework/receivers/Receiver.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNVQwOToxNDowM1rOIUPrUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNVQwOToxNDowM1rOIUPrUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODA5OTI4Mg==", "bodyText": "Dit zou op \u00e9\u00e9n regel, \u00e9\u00e9n aanroep naar zoiets als log_info() moeten zijn.", "url": "https://github.com/ibissource/iaf/pull/1354#discussion_r558099282", "createdAt": "2021-01-15T09:14:03Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/receivers/Receiver.java", "diffHunk": "@@ -735,78 +753,71 @@ public void startRunning() {\n \t\t\tif (adapter != null) {\n \t\t\t\tRunStateEnum adapterRunState = adapter.getRunState();\n \t\t\t\tif (!adapterRunState.equals(RunStateEnum.STARTED)) {\n-\t\t\t\t\tlog.warn(getLogPrefix()+\"on adapter [\"\n-\t\t\t\t\t\t\t+ adapter.getName()\n-\t\t\t\t\t\t\t+ \"] was tried to start, but the adapter is in state [\"+adapterRunState+\"]. Ignoring command.\");\n-\t\t\t\t\tadapter.getMessageKeeper().add(\n-\t\t\t\t\t\t\"ignored start command on [\" + getName()  + \"]; adapter is in state [\"+adapterRunState+\"]\");\n+\t\t\t\t\tlog.warn(getLogPrefix()+\"on adapter [\" + adapter.getName() + \"] was tried to start, but the adapter is in state [\"+adapterRunState+\"]. Ignoring command.\");\n+\t\t\t\t\tadapter.getMessageKeeper().add(\"ignored start command on [\" + getName()  + \"]; adapter is in state [\"+adapterRunState+\"]\");\n \t\t\t\t\treturn;\n \t\t\t\t}\n \t\t\t}\n \t\t\t// See also Adapter.startRunning()\n \t\t\tif (!configurationSucceeded) {\n-\t\t\t\tlog.error(\n-\t\t\t\t\t\"configuration of receiver [\"\n-\t\t\t\t\t\t+ getName()\n-\t\t\t\t\t\t+ \"] did not succeed, therefore starting the receiver is not possible\");\n+\t\t\t\tlog.error(\"configuration of receiver [\" + getName() + \"] did not succeed, therefore starting the receiver is not possible\");\n \t\t\t\twarn(\"configuration did not succeed. Starting the receiver [\"+getName()+\"] is not possible\");\n \t\t\t\trunState.setRunState(RunStateEnum.ERROR);\n \t\t\t\treturn;\n \t\t\t}\n \t\t\tif (adapter.getConfiguration().isUnloadInProgressOrDone()) {\n-\t\t\t\tlog.error(\n-\t\t\t\t\t\"configuration of receiver [\"\n-\t\t\t\t\t\t+ getName()\n-\t\t\t\t\t\t+ \"] unload in progress or done, therefore starting the receiver is not possible\");\n+\t\t\t\tlog.error( \"configuration of receiver [\" + getName() + \"] unload in progress or done, therefore starting the receiver is not possible\");\n \t\t\t\twarn(\"configuration unload in progress or done. Starting the receiver [\"+getName()+\"] is not possible\");\n \t\t\t\treturn;\n \t\t\t}\n \t\t\tsynchronized (runState) {\n \t\t\t\tRunStateEnum currentRunState = getRunState();\n-\t\t\t\tif (!currentRunState.equals(RunStateEnum.STOPPED)) {\n+\t\t\t\tif (!currentRunState.equals(RunStateEnum.STOPPED) && !(runState.isInState(RunStateEnum.ERROR) && configurationSucceeded())) { // stopped OR in error after configuring the receiver\n \t\t\t\t\tif (currentRunState.equals(RunStateEnum.STARTING) || currentRunState.equals(RunStateEnum.STARTED)) {\n-\t\t\t\t\t\tinfo(\"receiver already in state [\" + currentRunState + \"]\");\n+\t\t\t\t\t\tlog.info(\"already in state [\" + currentRunState + \"]\");\n \t\t\t\t\t} else {\n-\t\t\t\t\t\twarn(getLogPrefix()+\"currently in state [\" + currentRunState + \"], ignoring start() command\");\n+\t\t\t\t\t\tlog.warn(\"currently in state [\" + currentRunState + \"], ignoring start() command\");\n \t\t\t\t\t}\n \t\t\t\t\treturn;\n \t\t\t\t}\n \t\t\t\trunState.setRunState(RunStateEnum.STARTING);\n \t\t\t}\n-\t\t\tString msg=(getLogPrefix()+\"starts listening\");\n+\n+\t\t\topenAllResources();\n+\n+\t\t\tString msg = getLogPrefix()+\"starts listening\"; // Don't log that it's ready before it's ready!?\n \t\t\tlog.info(msg);\n \t\t\tif (adapter != null) { \n \t\t\t\tadapter.getMessageKeeper().add(msg);\n \t\t\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "24351c83b46f8dc94ac2f0b4e4540066d73ac986"}, "originalPosition": 226}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzUxMzY4Njc3OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/nl/nn/adapterframework/receivers/Receiver.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNVQwOToxNjoxOVrOIUP3tA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNVQwOToxNjoxOVrOIUP3tA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODEwMjQ1Mg==", "bodyText": "Waarom is dit synchronized?", "url": "https://github.com/ibissource/iaf/pull/1354#discussion_r558102452", "createdAt": "2021-01-15T09:16:19Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/receivers/Receiver.java", "diffHunk": "@@ -1651,8 +1669,18 @@ public void decreaseThreadCount() {\n \t\t}\n \t}\n \n+\t/**\n+\t * Changes runstate. \n+\t * Always stops the receiver when state is `**ERROR**`\n+\t */\n \tpublic void setRunState(RunStateEnum state) {\n-\t\trunState.setRunState(state);\n+\t\tif(RunStateEnum.ERROR.equals(state)) {\n+\t\t\tstopRunning();\n+\t\t}\n+\n+\t\tsynchronized (runState) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "24351c83b46f8dc94ac2f0b4e4540066d73ac986"}, "originalPosition": 344}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzUxMzY5MTY0OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/nl/nn/adapterframework/receivers/Receiver.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNVQwOToxNjo1NVrOIUP6-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNVQwOTo1NzoxOVrOIUTtOw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODEwMzI5MA==", "bodyText": "enums mag je met == vergelijken", "url": "https://github.com/ibissource/iaf/pull/1354#discussion_r558103290", "createdAt": "2021-01-15T09:16:55Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/receivers/Receiver.java", "diffHunk": "@@ -1678,7 +1706,7 @@ private String sendResultToSender(String correlationId, Message result) {\n \t\t\tString msg = \"caught exception in message post processing\";\n \t\t\terror(msg, e);\n \t\t\terrorMessage = msg + \": \" + e.getMessage();\n-\t\t\tif (ONERROR_CLOSE.equalsIgnoreCase(getOnError())) {\n+\t\t\tif (ON_ERROR.CLOSE.equals(getOnErrorEnum())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "24351c83b46f8dc94ac2f0b4e4540066d73ac986"}, "originalPosition": 355}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODE2NTMwNw==", "bodyText": "mag, hoeft niet, maar zal het aanpassen", "url": "https://github.com/ibissource/iaf/pull/1354#discussion_r558165307", "createdAt": "2021-01-15T09:57:19Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/receivers/Receiver.java", "diffHunk": "@@ -1678,7 +1706,7 @@ private String sendResultToSender(String correlationId, Message result) {\n \t\t\tString msg = \"caught exception in message post processing\";\n \t\t\terror(msg, e);\n \t\t\terrorMessage = msg + \": \" + e.getMessage();\n-\t\t\tif (ONERROR_CLOSE.equalsIgnoreCase(getOnError())) {\n+\t\t\tif (ON_ERROR.CLOSE.equals(getOnErrorEnum())) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODEwMzI5MA=="}, "originalCommit": {"oid": "24351c83b46f8dc94ac2f0b4e4540066d73ac986"}, "originalPosition": 355}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzUxMzczNzM0OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/nl/nn/adapterframework/unmanaged/DefaultIbisManager.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNVQwOToyMjoxMVrOIUQYrg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNVQwOToyMjoxMVrOIUQYrg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODExMDg5NA==", "bodyText": "Code onder STOPRECEIVER lijkt heel erg op die onder STARTRECEIVER. Lijkt me goed om die te combineren in een method.", "url": "https://github.com/ibissource/iaf/pull/1354#discussion_r558110894", "createdAt": "2021-01-15T09:22:11Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/unmanaged/DefaultIbisManager.java", "diffHunk": "@@ -240,7 +240,19 @@ public void handleAdapter(String action, String configurationName,\n \t\t\tfor (Configuration configuration : configurations) {\n \t\t\t\tif (configuration.getRegisteredAdapter(adapterName) != null) {\n \t\t\t\t\tAdapter adapter = configuration.getRegisteredAdapter(adapterName);\n-\t\t\t\t\tReceiver receiver = adapter.getReceiverByName(receiverName);\n+\n+\t\t\t\t\tReceiver<?> receiver = adapter.getReceiverByName(receiverName);\n+\t\t\t\t\tRunStateEnum currentRunState = receiver.getRunState();\n+\t\t\t\t\tif (!currentRunState.equals(RunStateEnum.STARTED)) {\n+\t\t\t\t\t\tif (currentRunState.equals(RunStateEnum.STOPPING) || currentRunState.equals(RunStateEnum.STOPPED)) {\n+\t\t\t\t\t\t\tadapter.getMessageKeeper().info(receiver, \"already in state [\" + currentRunState + \"]\");\n+\t\t\t\t\t\t\treturn;\n+\t\t\t\t\t\t} else {\n+\t\t\t\t\t\t\tadapter.getMessageKeeper().warn(receiver, \"currently in state [\" + currentRunState + \"], ignoring start() command\");\n+\t\t\t\t\t\t\treturn;\n+\t\t\t\t\t\t}\n+\t\t\t\t\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "24351c83b46f8dc94ac2f0b4e4540066d73ac986"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzUxMzc3Njg0OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/nl/nn/adapterframework/util/RunStateManager.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNVQwOToyNjo0NlrOIUQyww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNVQwOToyNjo0NlrOIUQyww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODExNzU3MQ==", "bodyText": "Waarom zijn deze synchronized?", "url": "https://github.com/ibissource/iaf/pull/1354#discussion_r558117571", "createdAt": "2021-01-15T09:26:46Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/util/RunStateManager.java", "diffHunk": "@@ -27,16 +27,22 @@\n \n \tprivate RunStateEnum runState = RunStateEnum.STOPPED;\n \n+\t@Override\n \tpublic synchronized RunStateEnum getRunState() {\n \t\treturn runState;\n \t}\n+\n+\t@Override\n \tpublic synchronized boolean isInState(RunStateEnum state) {\n \t\treturn runState.equals(state);\n \t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "24351c83b46f8dc94ac2f0b4e4540066d73ac986"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzUxMzc4NzAzOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/nl/nn/adapterframework/util/RunStateManager.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNVQwOToyNzo1NFrOIUQ5fw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNVQxMDowNDowMVrOIUUX8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODExOTI5NQ==", "bodyText": "Ik vind dat bij isDebugEnabled() en isTraceEnabled() het log statement er direct achter mag, zonder accolades", "url": "https://github.com/ibissource/iaf/pull/1354#discussion_r558119295", "createdAt": "2021-01-15T09:27:54Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/util/RunStateManager.java", "diffHunk": "@@ -27,16 +27,22 @@\n \n \tprivate RunStateEnum runState = RunStateEnum.STOPPED;\n \n+\t@Override\n \tpublic synchronized RunStateEnum getRunState() {\n \t\treturn runState;\n \t}\n+\n+\t@Override\n \tpublic synchronized boolean isInState(RunStateEnum state) {\n \t\treturn runState.equals(state);\n \t}\n+\n \tpublic synchronized void setRunState(RunStateEnum newRunState) {\n \t\tif (! runState.equals(newRunState)) {\n-\t\t\tif (log.isDebugEnabled())\n+\t\t\tif (log.isDebugEnabled()) {\n \t\t\t\tlog.debug(\"Runstate [\" + this + \"] set from \" + runState + \" to \" + newRunState);\n+\t\t\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "24351c83b46f8dc94ac2f0b4e4540066d73ac986"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODE3NjI0MA==", "bodyText": "ja, maar dan moet het er wel direct achter, en dus niet onder, staan.", "url": "https://github.com/ibissource/iaf/pull/1354#discussion_r558176240", "createdAt": "2021-01-15T10:04:01Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/util/RunStateManager.java", "diffHunk": "@@ -27,16 +27,22 @@\n \n \tprivate RunStateEnum runState = RunStateEnum.STOPPED;\n \n+\t@Override\n \tpublic synchronized RunStateEnum getRunState() {\n \t\treturn runState;\n \t}\n+\n+\t@Override\n \tpublic synchronized boolean isInState(RunStateEnum state) {\n \t\treturn runState.equals(state);\n \t}\n+\n \tpublic synchronized void setRunState(RunStateEnum newRunState) {\n \t\tif (! runState.equals(newRunState)) {\n-\t\t\tif (log.isDebugEnabled())\n+\t\t\tif (log.isDebugEnabled()) {\n \t\t\t\tlog.debug(\"Runstate [\" + this + \"] set from \" + runState + \" to \" + newRunState);\n+\t\t\t}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODExOTI5NQ=="}, "originalCommit": {"oid": "24351c83b46f8dc94ac2f0b4e4540066d73ac986"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzUxMzgxMTYwOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/nl/nn/adapterframework/validation/JavaxXmlValidator.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNVQwOTozMDo0MFrOIURKCQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xNVQxMDowODozNVrOIUUyKA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODEyMzUyOQ==", "bodyText": "Zo krijg je natuurlijk nooit die ConfigurationException(\"cannot start an already started validator\");", "url": "https://github.com/ibissource/iaf/pull/1354#discussion_r558123529", "createdAt": "2021-01-15T09:30:40Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/validation/JavaxXmlValidator.java", "diffHunk": "@@ -77,11 +77,11 @@ public void configure(String logPrefix) throws ConfigurationException {\n \t\t}\n \t\tsuper.configure(logPrefix);\n \t}\n-\t\n+\n \t@Override\n-\tprotected void init() throws ConfigurationException {\n-\t\tif (needsInit) {\n-\t\t\tsuper.init();\n+\tpublic void start() throws ConfigurationException {\n+\t\tif(!isStarted()) {\n+\t\t\tsuper.start();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "24351c83b46f8dc94ac2f0b4e4540066d73ac986"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODE4Mjk1Mg==", "bodyText": "Dat klopt, het was of dit of 56 junit tests aanpassen...", "url": "https://github.com/ibissource/iaf/pull/1354#discussion_r558182952", "createdAt": "2021-01-15T10:08:35Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/validation/JavaxXmlValidator.java", "diffHunk": "@@ -77,11 +77,11 @@ public void configure(String logPrefix) throws ConfigurationException {\n \t\t}\n \t\tsuper.configure(logPrefix);\n \t}\n-\t\n+\n \t@Override\n-\tprotected void init() throws ConfigurationException {\n-\t\tif (needsInit) {\n-\t\t\tsuper.init();\n+\tpublic void start() throws ConfigurationException {\n+\t\tif(!isStarted()) {\n+\t\t\tsuper.start();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODEyMzUyOQ=="}, "originalCommit": {"oid": "24351c83b46f8dc94ac2f0b4e4540066d73ac986"}, "originalPosition": 12}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 546, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}