{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI0MDc3ODg2", "number": 766, "title": "Api listener duplicate check", "bodyText": "", "createdAt": "2020-05-27T19:45:05Z", "url": "https://github.com/ibissource/iaf/pull/766", "merged": true, "mergeCommit": {"oid": "cbcde459b12f7903aa71bca9fae9a77be5e79299"}, "closed": true, "closedAt": "2020-05-29T09:53:40Z", "author": {"login": "nielsm5"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcleW81AH2gAyNDI0MDc3ODg2OjgyOTcxYjA2Y2MxMWM2MzZlMTdlYjkxNmUwMjE4OGFjYzg1MzM4OWE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcl_ZycAFqTQyMDgxMTk0OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "82971b06cc11c636e17eb916e02188acc853389a", "author": {"user": {"login": "nielsm5", "name": "Niels"}}, "url": "https://github.com/ibissource/iaf/commit/82971b06cc11c636e17eb916e02188acc853389a", "committedDate": "2020-05-27T19:23:30Z", "message": "Set MessageId in IPipelineSession"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "426873b4e2c35fcbd9294e1e34bd734ee77cc1ed", "author": {"user": {"login": "nielsm5", "name": "Niels"}}, "url": "https://github.com/ibissource/iaf/commit/426873b4e2c35fcbd9294e1e34bd734ee77cc1ed", "committedDate": "2020-05-27T19:44:36Z", "message": "allow setting the header via apilistener"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "01b40c4dc693795bac4ccb345435d1f38fef3b85", "author": {"user": {"login": "nielsm5", "name": "Niels"}}, "url": "https://github.com/ibissource/iaf/commit/01b40c4dc693795bac4ccb345435d1f38fef3b85", "committedDate": "2020-05-28T10:38:32Z", "message": "Add larva tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIwNjc2MDc5", "url": "https://github.com/ibissource/iaf/pull/766#pullrequestreview-420676079", "createdAt": "2020-05-29T06:11:23Z", "commit": {"oid": "01b40c4dc693795bac4ccb345435d1f38fef3b85"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQwNjoxMToyM1rOGcP9NQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQwNjoxNDowNVrOGcQAaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI3NDc0MQ==", "bodyText": "Dit moet m.i. niet hier, maar in ApiListener.getIdFromRawMessage()", "url": "https://github.com/ibissource/iaf/pull/766#discussion_r432274741", "createdAt": "2020-05-29T06:11:23Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/http/rest/ApiListenerServlet.java", "diffHunk": "@@ -444,7 +445,15 @@ else if(segment.startsWith(\"{\") && segment.endsWith(\"}\")) {\n \t\t\tif (!ServletFileUpload.isMultipartContent(request)) {\n \t\t\t\tbody = Misc.streamToString(request.getInputStream(),\"\\n\",false);\n \t\t\t}\n-\t\t\t//TODO: String correlationId = request.getHeader(\"message-id\");\n+\n+\t\t\tString messageId = null;\n+\t\t\tif(StringUtils.isNotEmpty(listener.getMessageIdHeader())) {\n+\t\t\t\tString messageIdHeader = request.getHeader(listener.getMessageIdHeader());\n+\t\t\t\tif(StringUtils.isNotEmpty(messageIdHeader)) {\n+\t\t\t\t\tmessageId = messageIdHeader;\n+\t\t\t\t}\n+\t\t\t}\n+\t\t\tPipeLineSessionBase.setListenerParameters(messageContext, messageId, null, null, null); //We're only using this method to keep setting id/cid/tcid uniform", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01b40c4dc693795bac4ccb345435d1f38fef3b85"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI3NTU2MA==", "bodyText": "Kunnen we dat niet op een nette manier fixen?", "url": "https://github.com/ibissource/iaf/pull/766#discussion_r432275560", "createdAt": "2020-05-29T06:14:05Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/receivers/ReceiverBase.java", "diffHunk": "@@ -894,15 +894,26 @@ public String processRequest(IListener origin, String correlationId, String mess\n \t\tDate tsReceived = null;\n \t\tDate tsSent = null;\n \t\tif (context!=null) {\n-\t\t\t//TODO ClassCasting Exceptions occur when using PipeLineSessionBase.setListenerParameters\n-\t\t\ttsReceived = (Date)context.get(IPipeLineSession.tsReceivedKey);\n-\t\t\ttsSent = (Date)context.get(IPipeLineSession.tsSentKey);\n+\t\t\t//ClassCasting Exceptions occur when using PipeLineSessionBase.setListenerParameters, hence these silly instanceof's", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01b40c4dc693795bac4ccb345435d1f38fef3b85"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIwNzg1ODc3", "url": "https://github.com/ibissource/iaf/pull/766#pullrequestreview-420785877", "createdAt": "2020-05-29T09:15:59Z", "commit": {"oid": "01b40c4dc693795bac4ccb345435d1f38fef3b85"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIwNzg3NTE0", "url": "https://github.com/ibissource/iaf/pull/766#pullrequestreview-420787514", "createdAt": "2020-05-29T09:18:17Z", "commit": {"oid": "01b40c4dc693795bac4ccb345435d1f38fef3b85"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQwOToxODoxN1rOGcVMsw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQwOToxODoxN1rOGcVMsw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjM2MDYyNw==", "bodyText": "Het lijkt me zinvol om de message-id niet alleen uit een Http Header te kunnen halen, maar ook uit een request-parameter.", "url": "https://github.com/ibissource/iaf/pull/766#discussion_r432360627", "createdAt": "2020-05-29T09:18:17Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/http/rest/ApiListener.java", "diffHunk": "@@ -237,6 +241,15 @@ public String getMultipartBodyName() {\n \t\treturn null;\n \t}\n \n+\t@IbisDoc({\"8\", \"name of the header which contains the message-id\", \"message-id\"})\n+\tpublic void setMessageIdHeader(String messageIdHeader) {\n+\t\tthis.messageIdHeader = messageIdHeader;\n+\t}\n+\n+\tpublic String getMessageIdHeader() {\n+\t\treturn messageIdHeader;\n+\t}\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01b40c4dc693795bac4ccb345435d1f38fef3b85"}, "originalPosition": 30}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIwODExOTQ5", "url": "https://github.com/ibissource/iaf/pull/766#pullrequestreview-420811949", "createdAt": "2020-05-29T09:53:28Z", "commit": {"oid": "01b40c4dc693795bac4ccb345435d1f38fef3b85"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1230, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}