{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg5MTUxMTgz", "number": 1071, "title": "Add support for PostgreSQL", "bodyText": "Support for PostgreSQL, tested in non-XA mode", "createdAt": "2020-09-18T08:08:04Z", "url": "https://github.com/ibissource/iaf/pull/1071", "merged": true, "mergeCommit": {"oid": "d45f00032045b9fb4cf29672137cc51b519c4d4f"}, "closed": true, "closedAt": "2020-09-22T08:10:25Z", "author": {"login": "gvanbrakel"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdKBAfRgH2gAyNDg5MTUxMTgzOjA0NzhkYjNhYTQ2YjFmNjcyMTVjMTc3NTk2ZGUxOWYzMmRhMDM1ODg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdLTbzZAFqTQ5MzIxNzMxNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0478db3aa46b1f67215c177596de19f32da03588", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/0478db3aa46b1f67215c177596de19f32da03588", "committedDate": "2020-09-18T08:06:55Z", "message": "Add support for PostgreSQL"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6f2f39045283c66ad289c623464de65583119a04", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/6f2f39045283c66ad289c623464de65583119a04", "committedDate": "2020-09-18T08:33:33Z", "message": "Added pom"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8e9777c5bf32aecc1c6205778817a16b9477b3a2", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/8e9777c5bf32aecc1c6205778817a16b9477b3a2", "committedDate": "2020-09-18T09:21:45Z", "message": "Fix Codacy issues"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7bac5ec2eed3037152e287d47c88bfbc950dbdcf", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/7bac5ec2eed3037152e287d47c88bfbc950dbdcf", "committedDate": "2020-09-21T07:14:53Z", "message": "Simplify interfaces"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "76d5c40fce7b77b91284bc25d234c77a39566fa7", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/76d5c40fce7b77b91284bc25d234c77a39566fa7", "committedDate": "2020-09-21T08:24:21Z", "message": "Add XA support for MariaDB by using MySQL driver"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8ba86816b6151b6eb14af0a610e3e18128b09153", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/8ba86816b6151b6eb14af0a610e3e18128b09153", "committedDate": "2020-09-21T10:30:19Z", "message": "Add test for JdbcTableListener"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bc7e26689ffccd7b89c9473df20391a9680530ce", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/bc7e26689ffccd7b89c9473df20391a9680530ce", "committedDate": "2020-09-21T12:06:35Z", "message": "Make JdbcTestBase abstract, add JdbcTableListenerTest"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkyNTI4OTM0", "url": "https://github.com/ibissource/iaf/pull/1071#pullrequestreview-492528934", "createdAt": "2020-09-21T12:05:53Z", "commit": {"oid": "8ba86816b6151b6eb14af0a610e3e18128b09153"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxMjowNTo1M1rOHVMxSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxMjozOTozNlrOHVN9qA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTk5MTM3MQ==", "bodyText": "Als je overal var++ na de statement doet moet je het hier ook doen", "url": "https://github.com/ibissource/iaf/pull/1071#discussion_r491991371", "createdAt": "2020-09-21T12:05:53Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/jdbc/XmlQuerySender.java", "diffHunk": "@@ -579,14 +586,13 @@ private void applyParameters(PreparedStatement statement, Vector<Column> columns\n \t\t\t\t\tstatement.setTimestamp(var, (Timestamp) column.getParameter());\n \t\t\t\t\tvar++;\n \t\t\t\t} else if (column.getParameter() instanceof byte[]) {\n-\t\t\t\t\tlog.debug(\"parm [\" + var + \"] is a byte array with value [\" + column.getParameter().toString() + \"]\");\n+\t\t\t\t\tlog.debug(\"parm [\" + var + \"] is a byte array with value [\" + column.getParameter().toString() + \"] = [\" + new String((byte[]) column.getParameter()) + \"]\");\n \t\t\t\t\tstatement.setBytes(var, (byte[]) column.getParameter());\n \t\t\t\t\tvar++;\n \t\t\t\t} else {\n \t\t\t\t\t//if (column.getParameter() instanceof String) \n \t\t\t\t\tlog.debug(\"parm [\" + var + \"] is a String with value [\" + column.getParameter().toString() + \"]\");\n-\t\t\t\t\tstatement.setString(var, (String) column.getParameter());\n-\t\t\t\t\tvar++;\n+\t\t\t\t\tJdbcUtil.setParameter(statement, var++, (String) column.getParameter(), getDbmsSupport().isParameterTypeMatchRequired());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8ba86816b6151b6eb14af0a610e3e18128b09153"}, "originalPosition": 139}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTk5MjIwNA==", "bodyText": "Kan dit niet mooier? we krijgen nu 6+ if statements... waarom dit zit niet in de enum?", "url": "https://github.com/ibissource/iaf/pull/1071#discussion_r491992204", "createdAt": "2020-09-21T12:07:32Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/jdbc/dbms/DbmsSupportFactory.java", "diffHunk": "@@ -77,13 +85,21 @@ public IDbmsSupport getDbmsSupport(Connection conn) {\n \t\t\t\treturn new MsSqlServerDbmsSupport();\n \t\t\t}\n \t\t\tif (Dbms.MYSQL.getProductName().equals(product)) {\n+\t\t\t\tif (productVersion.contains(\"MariaDB\")) {\n+\t\t\t\t\tlog.debug(\"Setting databasetype to MARIADB (using MySQL driver)\");\n+\t\t\t\t\treturn new MariaDbDbmsSupport();\n+\t\t\t\t}\n \t\t\t\tlog.debug(\"Setting databasetype to MYSQL\");\n \t\t\t\treturn new MySqlDbmsSupport();\n \t\t\t}\n \t\t\tif (Dbms.MARIADB.getProductName().equals(product)) {\n-\t\t\t\tlog.debug(\"Setting databasetype to MARIADB\");\n+\t\t\t\tlog.debug(\"Setting databasetype to MARIADB (using MariaDB driver)\");\n \t\t\t\treturn new MariaDbDbmsSupport();\n \t\t\t}\n+\t\t\tif (Dbms.POSTGRESQL.getProductName().equals(product)) {\n+\t\t\t\tlog.debug(\"Setting databasetype to POSTGRESQL\");\n+\t\t\t\treturn new PostgresqlDbmsSupport();\n+\t\t\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8ba86816b6151b6eb14af0a610e3e18128b09153"}, "originalPosition": 76}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTk5NDEwOA==", "bodyText": "Deze moeten toch altijd gelijk zijn aan elkaar?", "url": "https://github.com/ibissource/iaf/pull/1071#discussion_r491994108", "createdAt": "2020-09-21T12:10:58Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/util/StreamUtil.java", "diffHunk": "@@ -39,7 +41,8 @@\n  */\n public class StreamUtil {\n \tpublic static final String DEFAULT_INPUT_STREAM_ENCODING=\"UTF-8\";\n-\n+\tpublic static final Charset DEFAULT_CHARSET = Charsets.UTF_8;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8ba86816b6151b6eb14af0a610e3e18128b09153"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTk5NTQ0Nw==", "bodyText": "Dit moet naar de enum toe, zie mijn comment in DbmsSupportFactory. Hartstikke leuk dat je dingen toe kan voegen via Spring, dat kan vast handig zijn, maar de 7 of 8 defaults moeten toch ergens vast liggen?", "url": "https://github.com/ibissource/iaf/pull/1071#discussion_r491995447", "createdAt": "2020-09-21T12:13:36Z", "author": {"login": "nielsm5"}, "path": "core/src/main/resources/springCommon.xml", "diffHunk": "@@ -391,8 +391,10 @@\n \t\t\t\t<prop key=\"DB2/NT\">nl.nn.adapterframework.jdbc.dbms.Db2DbmsSupport</prop>\n \t\t\t\t<prop key=\"DB2/LINUXX8664\">nl.nn.adapterframework.jdbc.dbms.Db2DbmsSupport</prop>\n \t\t\t\t<prop key=\"H2\">nl.nn.adapterframework.jdbc.dbms.H2DbmsSupport</prop>\n-\t\t\t\t<prop key=\"MySQL\">nl.nn.adapterframework.jdbc.dbms.MySqlDbmsSupport</prop>\n+\t\t\t\t<!-- keep MySQL out of dbmsSupport map, to let DbmsSupportFactory distinguish between MySQL and MariaDB -->\n+\t\t\t\t<!-- <prop key=\"MySQL\">nl.nn.adapterframework.jdbc.dbms.MySqlDbmsSupport</prop> -->\n \t\t\t\t<prop key=\"MariaDB\">nl.nn.adapterframework.jdbc.dbms.MariaDbDbmsSupport</prop>\n+\t\t\t\t<prop key=\"PostgreSQL\">nl.nn.adapterframework.jdbc.dbms.PostgresqlDbmsSupport</prop>\n \t\t\t</props>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8ba86816b6151b6eb14af0a610e3e18128b09153"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjAxMDYxNA==", "bodyText": "CalendarParserException ?", "url": "https://github.com/ibissource/iaf/pull/1071#discussion_r492010614", "createdAt": "2020-09-21T12:39:04Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/util/JdbcUtil.java", "diffHunk": "@@ -1276,7 +1188,48 @@ public static void applyParameter(PreparedStatement statement, ParameterValue pv\n \t\t} else if (\"bytes\".equals(paramType)) {\n \t\t\tstatement.setBytes(parameterIndex, (byte[]) value);\n \t\t} else {\n+\t\t\tsetParameter(statement, parameterIndex, (String)value, parameterTypeMatchRequired);\n+\t\t}\n+\t}\n+\n+\tpublic static void setParameter(PreparedStatement statement, int parameterIndex, String value, boolean parameterTypeMatchRequired) throws SQLException {\n+\t\tif (!parameterTypeMatchRequired) {\n \t\t\tstatement.setString(parameterIndex, (String) value);\n+\t\t\treturn;\n+\t\t}\n+\t\tint sqlTYpe=statement.getParameterMetaData().getParameterType(parameterIndex);\n+\t\ttry {\n+\t\t\tswitch(sqlTYpe) {\n+\t\t\tcase Types.INTEGER:\n+\t\t\t\tstatement.setInt(parameterIndex, Integer.parseInt((String)value));\n+\t\t\t\tbreak;\n+\t\t\tcase Types.NUMERIC:\n+\t\t\tcase Types.DOUBLE:\n+\t\t\t\tstatement.setDouble(parameterIndex, Double.parseDouble((String)value));\n+\t\t\t\tbreak;\n+\t\t\tcase Types.BIGINT:\n+\t\t\t\tstatement.setLong(parameterIndex, Long.parseLong((String)value));\n+\t\t\t\tbreak;\n+\t\t\tcase Types.BLOB:\n+\t\t\t\tstatement.setBytes(parameterIndex, ((String)value).getBytes(Charsets.UTF_8));\n+\t\t\t\tbreak;\n+\t\t\tcase Types.DATE:\n+\t\t\t\tstatement.setDate(parameterIndex, new java.sql.Date(DateUtils.parseAnyDate((String) value).getTime()));\n+\t\t\t\tbreak;\n+\t\t\tcase Types.TIMESTAMP:\n+\t\t\t\tstatement.setTimestamp(parameterIndex, new Timestamp(DateUtils.parseAnyDate((String) value).getTime()));\n+\t\t\t\tbreak;\n+\t\t\tdefault:\n+\t\t\t\tlog.warn(\"parameter type [\"+JDBCType.valueOf(sqlTYpe).getName()+\"] handled as String\");\n+\t\t\t\t//$FALL-THROUGH$\n+\t\t\tcase Types.CHAR:\n+\t\t\tcase Types.VARCHAR:\n+\t\t\t\tstatement.setString(parameterIndex, (String) value);\n+\t\t\t\tbreak;\n+\t\t\t}\n+\t\t} catch (CalendarParserException e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8ba86816b6151b6eb14af0a610e3e18128b09153"}, "originalPosition": 572}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjAxMDkyMA==", "bodyText": "provided scope? dan wordt hij niet meegepackaged maar is hij wel compile time aanwezig", "url": "https://github.com/ibissource/iaf/pull/1071#discussion_r492010920", "createdAt": "2020-09-21T12:39:36Z", "author": {"login": "nielsm5"}, "path": "core/pom.xml", "diffHunk": "@@ -598,9 +598,34 @@\n \t\t<dependency>\n \t\t\t<groupId>com.h2database</groupId>\n \t\t\t<artifactId>h2</artifactId>\n-\t\t\t<version>1.0.20061217</version>\n+\t\t\t<version>1.4.200</version>\n \t\t\t<scope>test</scope>\n \t\t</dependency>\n+\t\t<dependency>\n+\t\t\t<groupId>com.microsoft.sqlserver</groupId>\n+\t\t\t<artifactId>mssql-jdbc</artifactId>\n+\t\t\t<version>7.2.2.jre8</version>\n+\t\t\t<scope>test</scope>\n+\t\t</dependency>\n+\t\t<dependency>\n+\t\t\t<groupId>mysql</groupId>\n+\t\t\t<artifactId>mysql-connector-java</artifactId>\n+\t\t\t<version>8.0.21</version>\n+\t\t\t<scope>test</scope>\n+\t\t</dependency>\n+\t\t<dependency>\n+\t\t\t<groupId>org.mariadb.jdbc</groupId>\n+\t\t\t<artifactId>mariadb-java-client</artifactId>\n+\t\t\t<version>2.6.2</version>\n+\t\t\t<scope>test</scope>\n+\t\t</dependency>\n+\t\t<dependency>\n+\t\t\t<groupId>org.postgresql</groupId>\n+\t\t\t<artifactId>postgresql</artifactId>\n+\t\t\t<version>42.2.16</version>\n+\t\t\t<!-- compile scope required for LargeObjectManager (to handle PostgreSQL BLOBs and CLOBs in an alternative way), could consider to remove that, and change scope to 'test' -->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8ba86816b6151b6eb14af0a610e3e18128b09153"}, "originalPosition": 30}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e9a8fb2f46980676e534c9a4813e5481213854c4", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/e9a8fb2f46980676e534c9a4813e5481213854c4", "committedDate": "2020-09-21T14:54:42Z", "message": "Fix issues"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e61d4f9b7f1128fb55f1c62bceab3edaa2979c99", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/e61d4f9b7f1128fb55f1c62bceab3edaa2979c99", "committedDate": "2020-09-21T14:55:44Z", "message": "set PostgreSQL to test scope in pom"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkzMjE3MzE3", "url": "https://github.com/ibissource/iaf/pull/1071#pullrequestreview-493217317", "createdAt": "2020-09-22T08:08:58Z", "commit": {"oid": "e61d4f9b7f1128fb55f1c62bceab3edaa2979c99"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1093, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}