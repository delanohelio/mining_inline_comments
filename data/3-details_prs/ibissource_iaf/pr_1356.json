{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ0ODA0MTQy", "number": 1356, "title": "Introduction of ProcessState", "bodyText": "", "createdAt": "2020-12-23T13:39:22Z", "url": "https://github.com/ibissource/iaf/pull/1356", "merged": true, "mergeCommit": {"oid": "8e4be875e8b6ec919f6e6b798973684097b09838"}, "closed": true, "closedAt": "2021-01-07T13:06:51Z", "author": {"login": "gvanbrakel"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdo_SRbgH2gAyNTQ0ODA0MTQyOmZkNDlhMzdiMmMzYzdjZTY0MTkxZDg5ZTY3ZjUwNmQyYzg2NDA1NTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdtxY4QgH2gAyNTQ0ODA0MTQyOmUwNWViZDFkNDkyZGM1ZGFkOTkzOTY4NTMxYjUyZjFiMDc3NDI0NmQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "fd49a37b2c3c7ce64191d89e67f506d2c8640553", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/fd49a37b2c3c7ce64191d89e67f506d2c8640553", "committedDate": "2020-12-23T13:38:11Z", "message": "Introduction of ProcessState"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "847ee3fff18e602b36984c80dc518c26157b4896", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/847ee3fff18e602b36984c80dc518c26157b4896", "committedDate": "2021-01-04T13:43:23Z", "message": "Merge branch 'master' into Approach_to_#1321_generalised_message_browsers"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "587b403d0dc0671fb88ecc2b46d9b9e9023a16cc", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/587b403d0dc0671fb88ecc2b46d9b9e9023a16cc", "committedDate": "2021-01-05T13:54:05Z", "message": "Fix #1363 make move to inProcess more robust"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6e7f16e3605bed599ab1701f116743fb189f3e4e", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/6e7f16e3605bed599ab1701f116743fb189f3e4e", "committedDate": "2021-01-05T14:03:15Z", "message": "Deprecate JdbcQueryListener in favor of JdbcTableListener"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYxODUwNjQx", "url": "https://github.com/ibissource/iaf/pull/1356#pullrequestreview-561850641", "createdAt": "2021-01-05T14:50:00Z", "commit": {"oid": "6e7f16e3605bed599ab1701f116743fb189f3e4e"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNVQxNDo1MDowMFrOIOaHag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNVQxNTozMjo0MVrOIOb0Wg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTk3ODg1OA==", "bodyText": "manageability", "url": "https://github.com/ibissource/iaf/pull/1356#discussion_r551978858", "createdAt": "2021-01-05T14:50:00Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/jdbc/JdbcQueryListener.java", "diffHunk": "@@ -28,6 +29,8 @@\n  *\n  * @since   4.7\n  */\n+@Deprecated\n+@ConfigurationWarning(\"Please replace with JdbcTableListener for ease of configuration and improved managebility\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6e7f16e3605bed599ab1701f116743fb189f3e4e"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTk4MDY5Mw==", "bodyText": "oeps?", "url": "https://github.com/ibissource/iaf/pull/1356#discussion_r551980693", "createdAt": "2021-01-05T14:53:03Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/receivers/Receiver.java", "diffHunk": "@@ -1954,21 +1993,22 @@ public void setMessageLog(ITransactionalStorage<Serializable> messageLog) {\n \t * returns the {@link ITransactionalStorage} if it is provided in the configuration. It is used to store messages that have been processed successfully. If present, this storage will be managed by the Receiver.\n \t */\n \tpublic ITransactionalStorage<Serializable> getMessageLog() {\n-\t\treturn messageLog!=null && messageLog instanceof ITransactionalStorage ? (ITransactionalStorage)messageLog: null;\n-\t}\n-\t/**\n-\t * returns a browser for the messageLog, either provided as a {@link IMessageBrowser} by the listener itself, or as a {@link ITransactionalStorage messageLog} in the configuration. \n-\t */\n-\tpublic IMessageBrowser<Serializable> getMessageLogBrowser() {\n-\t\treturn messageLog;\n-\t}\n-\n-\t/**\n-\t * returns a browser of messages inProcess, if provided as a {@link IMessageBrowser} by the listener itself. \n-\t */\n-\tpublic IMessageBrowser<Serializable> getInProcessBrowser() {\n-\t\treturn inProcessBrowser;\n-\t}\n+\t\tIMessageBrowser<?> messageLog =  messageBrowsers.get(ProcessState.DONE);\n+\t\treturn messageLog instanceof ITransactionalStorage ? (ITransactionalStorage)messageLog: null;\n+\t}\n+//\t/**\n+//\t * returns a browser for the messageLog, either provided as a {@link IMessageBrowser} by the listener itself, or as a {@link ITransactionalStorage messageLog} in the configuration. \n+//\t */\n+//\tpublic IMessageBrowser<Serializable> getMessageLogBrowser() {\n+//\t\treturn (IMessageBrowser<Serializable>)messageBrowsers.get(ProcessState.DONE);\n+//\t}\n+//\n+//\t/**\n+//\t * returns a browser of messages inProcess, if provided as a {@link IMessageBrowser} by the listener itself. \n+//\t */\n+//\tpublic IMessageBrowser<Serializable> getInProcessBrowser() {\n+//\t\treturn (IMessageBrowser<Serializable>)messageBrowsers.get(ProcessState.INPROCESS);\n+//\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6e7f16e3605bed599ab1701f116743fb189f3e4e"}, "originalPosition": 245}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTk4MTQ1Nw==", "bodyText": "oeps", "url": "https://github.com/ibissource/iaf/pull/1356#discussion_r551981457", "createdAt": "2021-01-05T14:54:12Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/receivers/Receiver.java", "diffHunk": "@@ -1929,20 +1967,21 @@ public void setErrorStorage(ITransactionalStorage<Serializable> errorStorage) {\n \t * returns the {@link ITransactionalStorage} if it is provided in the configuration. It is used to store failed messages. If present, this storage will be managed by the Receiver.\n \t */\n \tpublic ITransactionalStorage<Serializable> getErrorStorage() {\n-\t\treturn errorStorage!=null && errorStorage instanceof ITransactionalStorage ? (ITransactionalStorage)errorStorage: null;\n-\t}\n-\t/**\n-\t * returns a browser for the errorStorage, either provided as a {@link IMessageBrowser} by the listener itself, or as a {@link ITransactionalStorage} in the configuration. \n-\t */\n-\tpublic IMessageBrowser<Serializable> getErrorStorageBrowser() {\n-\t\treturn errorStorage;\n-\t}\n+\t\tIMessageBrowser<?> errorStorage =  messageBrowsers.get(ProcessState.ERROR);\n+\t\treturn errorStorage instanceof ITransactionalStorage ? (ITransactionalStorage)errorStorage: null;\n+\t}\n+//\t/**\n+//\t * returns a browser for the errorStorage, either provided as a {@link IMessageBrowser} by the listener itself, or as a {@link ITransactionalStorage} in the configuration. \n+//\t */\n+//\tpublic IMessageBrowser<Serializable> getErrorStorageBrowser() {\n+//\t\treturn (IMessageBrowser<Serializable>)messageBrowsers.get(ProcessState.ERROR);\n+//\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6e7f16e3605bed599ab1701f116743fb189f3e4e"}, "originalPosition": 200}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjAwMTc4Mw==", "bodyText": "changeProcessState", "url": "https://github.com/ibissource/iaf/pull/1356#discussion_r552001783", "createdAt": "2021-01-05T15:25:43Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/core/IHasProcessState.java", "diffHunk": "@@ -0,0 +1,45 @@\n+/*\n+   Copyright 2020 WeAreFrank!\n+\n+   Licensed under the Apache License, Version 2.0 (the \"License\");\n+   you may not use this file except in compliance with the License.\n+   You may obtain a copy of the License at\n+\n+       http://www.apache.org/licenses/LICENSE-2.0\n+\n+   Unless required by applicable law or agreed to in writing, software\n+   distributed under the License is distributed on an \"AS IS\" BASIS,\n+   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+   See the License for the specific language governing permissions and\n+   limitations under the License.\n+*/\n+package nl.nn.adapterframework.core;\n+\n+import java.util.Map;\n+import java.util.Set;\n+\n+/**\n+ * Interface that can be implemented by Listeners that provide their own management of\n+ * messages processed and in error.\n+ * \n+ * @see IUsesInProcessState\n+ */\n+public interface IHasProcessState<M> {\n+\n+\t/**\n+\t * Provides the set of ProcessStates used by this listener.\n+\t */\n+\tpublic Set<ProcessState> knownProcessStates();\n+\t\n+\t/**\n+\t * Provides the set of ProcessStates that a message in the specified state can be moved to, e.g. from a MessageBrowser for that state.\n+\t */\n+\tpublic Map<ProcessState,Set<ProcessState>> targetProcessStates();\n+\n+\t/**\n+\t * Change the processState of the message.\n+\t * If it returns <code>true</code>, this signals that the active transaction must be committed to make other threads aware of the state change.\n+\t */\n+\tpublic boolean moveToProcessState(M message, ProcessState toState, Map<String,Object> context) throws ListenerException;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6e7f16e3605bed599ab1701f116743fb189f3e4e"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjAwNTg4Ng==", "bodyText": "Misschien ook iets beter documenteren", "url": "https://github.com/ibissource/iaf/pull/1356#discussion_r552005886", "createdAt": "2021-01-05T15:31:34Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/core/IHasProcessState.java", "diffHunk": "@@ -0,0 +1,45 @@\n+/*\n+   Copyright 2020 WeAreFrank!\n+\n+   Licensed under the Apache License, Version 2.0 (the \"License\");\n+   you may not use this file except in compliance with the License.\n+   You may obtain a copy of the License at\n+\n+       http://www.apache.org/licenses/LICENSE-2.0\n+\n+   Unless required by applicable law or agreed to in writing, software\n+   distributed under the License is distributed on an \"AS IS\" BASIS,\n+   WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+   See the License for the specific language governing permissions and\n+   limitations under the License.\n+*/\n+package nl.nn.adapterframework.core;\n+\n+import java.util.Map;\n+import java.util.Set;\n+\n+/**\n+ * Interface that can be implemented by Listeners that provide their own management of\n+ * messages processed and in error.\n+ * \n+ * @see IUsesInProcessState\n+ */\n+public interface IHasProcessState<M> {\n+\n+\t/**\n+\t * Provides the set of ProcessStates used by this listener.\n+\t */\n+\tpublic Set<ProcessState> knownProcessStates();\n+\t\n+\t/**\n+\t * Provides the set of ProcessStates that a message in the specified state can be moved to, e.g. from a MessageBrowser for that state.\n+\t */\n+\tpublic Map<ProcessState,Set<ProcessState>> targetProcessStates();\n+\n+\t/**\n+\t * Change the processState of the message.\n+\t * If it returns <code>true</code>, this signals that the active transaction must be committed to make other threads aware of the state change.\n+\t */\n+\tpublic boolean moveToProcessState(M message, ProcessState toState, Map<String,Object> context) throws ListenerException;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjAwMTc4Mw=="}, "originalCommit": {"oid": "6e7f16e3605bed599ab1701f116743fb189f3e4e"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjAwNjc0Ng==", "bodyText": "Check if stateFolder != null", "url": "https://github.com/ibissource/iaf/pull/1356#discussion_r552006746", "createdAt": "2021-01-05T15:32:41Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/filesystem/FileSystemListener.java", "diffHunk": "@@ -314,28 +339,42 @@ public String getIdFromRawMessage(F rawMessage, Map<String, Object> threadContex\n \t\t}\n \t}\n \n-\tprotected IMessageBrowser<F> getMessageBrowser(String folder) {\n-\t\tif (isDisableMessageBrowsers() || StringUtils.isEmpty(folder)) {\n-\t\t\treturn null;\n-\t\t}\n-\t\treturn new FileSystemMessageBrowser<F, FS>(fileSystem, folder, getMessageIdPropertyKey());\n-\t}\t\n-\t\n \t@Override\n-\tpublic IMessageBrowser<F> getInProcessBrowser() {\n-\t\treturn getMessageBrowser(getInProcessFolder());\n+\tpublic boolean moveToProcessState(F message, ProcessState toState, Map<String,Object> context) throws ListenerException {\n+\t\ttry {\n+\t\t\tgetFileSystem().moveFile(message, getStateFolder(toState), false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6e7f16e3605bed599ab1701f116743fb189f3e4e"}, "originalPosition": 80}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e396c169f8e3b594fb95f5daa1a6c3ac36d057b9", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/e396c169f8e3b594fb95f5daa1a6c3ac36d057b9", "committedDate": "2021-01-05T16:30:55Z", "message": "Fix issues"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c3c037ca7d55296e9b2f4741065c59c869ed8b8f", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/c3c037ca7d55296e9b2f4741065c59c869ed8b8f", "committedDate": "2021-01-05T16:48:23Z", "message": "Fix issues"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "69d29d8a71981b1e0355f7d49b7acea3fd929a47", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/69d29d8a71981b1e0355f7d49b7acea3fd929a47", "committedDate": "2021-01-05T16:50:39Z", "message": "Merge branch 'master' into Approach_to_#1321_generalised_message_browsers"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c48452041807c63ed98cce710d1a28fcda356685", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/c48452041807c63ed98cce710d1a28fcda356685", "committedDate": "2021-01-05T19:58:33Z", "message": "Merge branch 'Approach_to_#1321_generalised_message_browsers' of https://github.com/ibissource/iaf.git into Approach_to_#1321_generalised_message_browsers"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3b1e4d269b3bdcbc47b2bc9ee868c1d90cdb29dc", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/3b1e4d269b3bdcbc47b2bc9ee868c1d90cdb29dc", "committedDate": "2021-01-05T20:01:43Z", "message": "Fix merge problem"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYyODIwMTQ0", "url": "https://github.com/ibissource/iaf/pull/1356#pullrequestreview-562820144", "createdAt": "2021-01-06T15:52:56Z", "commit": {"oid": "3b1e4d269b3bdcbc47b2bc9ee868c1d90cdb29dc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e05ebd1d492dc5dad993968531b52f1b0774246d", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/e05ebd1d492dc5dad993968531b52f1b0774246d", "committedDate": "2021-01-07T10:16:21Z", "message": "Add move from Error to Available"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 959, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}