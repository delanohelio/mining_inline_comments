{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkwOTMyNjY0", "number": 1083, "title": "Fix #1048 Add MariaDB full jdbc listener support", "bodyText": "", "createdAt": "2020-09-22T13:15:38Z", "url": "https://github.com/ibissource/iaf/pull/1083", "merged": true, "mergeCommit": {"oid": "6d1ba4e5c9ed1d6f6c2905d2941614c135317528"}, "closed": true, "closedAt": "2020-09-28T12:54:02Z", "author": {"login": "gvanbrakel"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdLV2TFgH2gAyNDkwOTMyNjY0OjIxMmNkYjUxMzg4NDAxZDliN2E0ZTA2ODI0ZTdiMDBkODI2ZjBkY2Q=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdNTA7wAH2gAyNDkwOTMyNjY0OjJlNTM1YzM2YzU1MzZlODRhMWJkMjIyMjcwNmEzZDhmNGJlYzg2Y2I=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "212cdb51388401d9b7a4e06824e7b00d826f0dcd", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/212cdb51388401d9b7a4e06824e7b00d826f0dcd", "committedDate": "2020-09-22T10:57:43Z", "message": "Add support for parallel JdbcListeners for Dbmses without 'skip locked'"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "875ab7644e88c022e1fc06e1c374a209a9112898", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/875ab7644e88c022e1fc06e1c374a209a9112898", "committedDate": "2020-09-22T11:38:54Z", "message": "Merge branch 'master' into Add_MariaDB_full_JdbcListener_support"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c0f838c2a1f311e1de4f53725c457bef722396ae", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/c0f838c2a1f311e1de4f53725c457bef722396ae", "committedDate": "2020-09-22T13:13:08Z", "message": "Add InProcessLog-browser icon to adapter status"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f9666805c8817a259827c39bf91dc34f8502b0f1", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/f9666805c8817a259827c39bf91dc34f8502b0f1", "committedDate": "2020-09-22T13:15:01Z", "message": "Test for locking problems in JdbcListener"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6deecc861960b9e61483551ab8e8b676c2b39c2e", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/6deecc861960b9e61483551ab8e8b676c2b39c2e", "committedDate": "2020-09-23T15:14:06Z", "message": "Rollback to status 'available' for dbmses without skip locked support"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1ce673af4f62e072f08f867fbfbcb49577d05777", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/1ce673af4f62e072f08f867fbfbcb49577d05777", "committedDate": "2020-09-23T15:16:02Z", "message": "Fix test for MySQL: use uppercase tablename in delete"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd395a65dd1f929734046a1cbe2ee3bb373e42c2", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/bd395a65dd1f929734046a1cbe2ee3bb373e42c2", "committedDate": "2020-09-23T15:34:40Z", "message": "Fix Codacy issues"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "665f61a0b95ad97f7bfe78c3b7d46c1e511e0f77", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/665f61a0b95ad97f7bfe78c3b7d46c1e511e0f77", "committedDate": "2020-09-23T16:28:12Z", "message": "Enable postgres-xa datasource"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1MzM0ODEw", "url": "https://github.com/ibissource/iaf/pull/1083#pullrequestreview-495334810", "createdAt": "2020-09-24T08:27:46Z", "commit": {"oid": "665f61a0b95ad97f7bfe78c3b7d46c1e511e0f77"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQwODoyNzo0NlrOHXPcaQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQwOTowMjo1MlrOHXQ2fw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDEzMjMyOQ==", "bodyText": "Ik vind het erg tof dat je met de tijd mee gaat en allemaal lambda's gebruikt, ik vind het er alleen niet duidelijker op worden. ConnectedOperation is gewoon een Boolean?", "url": "https://github.com/ibissource/iaf/pull/1083#discussion_r494132329", "createdAt": "2020-09-24T08:27:46Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/jdbc/JdbcListener.java", "diffHunk": "@@ -266,8 +258,61 @@ public void afterMessageProcessed(PipeLineResult processResult, Object rawMessag\n \t\t\t}\n \t\t}\n \t}\n+\n+\t@Override\n+\tpublic boolean setMessageStateToInProcess(Object rawMessage, Map<String, Object> threadContext) throws ListenerException {\n+\t\tif (StringUtils.isEmpty(getUpdateStatusToInProcessQuery())) {\n+\t\t\treturn false;\n+\t\t} \n+\t\treturn doConnected(rawMessage, threadContext, setMessageStateToInProcess);\n+\t}\n+\n+\tpublic ConnectedOperation<Boolean> setMessageStateToInProcess = (Connection conn, Object rawMessage, Map<String, Object> threadContext) -> {\n+\t\tif (StringUtils.isEmpty(getUpdateStatusToInProcessQuery())) {\n+\t\t\treturn false;\n+\t\t}\n+\t\tString key = getIdFromRawMessage(rawMessage, threadContext);\n+\t\texecute(conn,getUpdateStatusToInProcessQuery(), key);\n+\t\treturn true;\n+\t};\n+\n+\n+\t@Override\n+\tpublic void revertInProcessStatusToAvailable(Object rawMessage, Map<String, Object> threadContext) throws ListenerException {\n+\t\tif (StringUtils.isEmpty(getRevertInProcessStatusQuery())) {\n+\t\t\treturn;\n+\t\t}\n+\t\tdoConnected(rawMessage, threadContext, revertInProcessStatusToAvailable);\t\n+\t}\n+\n+\tprotected ConnectedOperation<Boolean> revertInProcessStatusToAvailable = (Connection conn, Object rawMessage, Map<String, Object> threadContext) -> {\n+\t\tif (StringUtils.isEmpty(getRevertInProcessStatusQuery())) {\n+\t\t\treturn false;\n+\t\t}\n+\t\tString key=getIdFromRawMessage(rawMessage,threadContext);\n+\t\texecute(conn,getRevertInProcessStatusQuery(), key);\n+\t\treturn true;\n+\t};\n+\n+\tprotected interface ConnectedOperation<X> {\n+\t\tX operate(Connection conn, Object rawMessage, Map<String, Object> threadContext) throws ListenerException;\n+\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "665f61a0b95ad97f7bfe78c3b7d46c1e511e0f77"}, "originalPosition": 219}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDE1NTM5MQ==", "bodyText": "Ik vind het stom dat je 2 setters hebt en vervolgens een field direct wijzigt.", "url": "https://github.com/ibissource/iaf/pull/1083#discussion_r494155391", "createdAt": "2020-09-24T09:02:52Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/jdbc/MessageStoreListener.java", "diffHunk": "@@ -128,6 +128,18 @@ public Object getRawMessage(Map<String,Object> threadContext) throws ListenerExc\n \t\treturn rawMessage;\n \t}\n \n+\t@Override\n+\tpublic IMessageBrowser<Object> getInProcessBrowser() {\n+\t\tIMessageBrowser<Object> result = super.getInProcessBrowser();\n+\t\tif (result!=null && result instanceof JdbcTableMessageBrowser) {\n+\t\t\tJdbcTableMessageBrowser<Object> jtmb = (JdbcTableMessageBrowser<Object>)result;\n+\t\t\tjtmb.setCommentField(\"COMMENTS\");\n+\t\t\tjtmb.setExpiryDateField(\"EXPIRYDATE\");\n+\t\t\tjtmb.hostField=\"HOST\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "665f61a0b95ad97f7bfe78c3b7d46c1e511e0f77"}, "originalPosition": 11}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "41aecf0e4ff21f2f07126b8357769d8a71d96a18", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/41aecf0e4ff21f2f07126b8357769d8a71d96a18", "committedDate": "2020-09-24T16:31:32Z", "message": "Add XA support to PostgreSQL docker container"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d27fc69e708ba0fb07fb25a24bb773266a1552af", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/d27fc69e708ba0fb07fb25a24bb773266a1552af", "committedDate": "2020-09-25T06:52:18Z", "message": "Fix Issues"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk2MjEyNTE3", "url": "https://github.com/ibissource/iaf/pull/1083#pullrequestreview-496212517", "createdAt": "2020-09-25T08:25:29Z", "commit": {"oid": "d27fc69e708ba0fb07fb25a24bb773266a1552af"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQwODoyNToyOVrOHX5-yg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQwODoyNToyOVrOHX5-yg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDgyOTI1OA==", "bodyText": "Heeeeeeeee, dit gebeurd nu 3 keer?", "url": "https://github.com/ibissource/iaf/pull/1083#discussion_r494829258", "createdAt": "2020-09-25T08:25:29Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/jdbc/MessageStoreListener.java", "diffHunk": "@@ -128,14 +128,26 @@ public Object getRawMessage(Map<String,Object> threadContext) throws ListenerExc\n \t\treturn rawMessage;\n \t}\n \n+\t@Override\n+\tpublic IMessageBrowser<Object> getInProcessBrowser() {\n+\t\tIMessageBrowser<Object> result = super.getInProcessBrowser();\n+\t\tif (result!=null && result instanceof JdbcTableMessageBrowser) {\n+\t\t\tJdbcTableMessageBrowser<Object> jtmb = (JdbcTableMessageBrowser<Object>)result;\n+\t\t\tjtmb.setCommentField(\"COMMENTS\");\n+\t\t\tjtmb.setExpiryDateField(\"EXPIRYDATE\");\n+\t\t\tjtmb.setHostField(\"HOST\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d27fc69e708ba0fb07fb25a24bb773266a1552af"}, "originalPosition": 11}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk2MjE1Mzk0", "url": "https://github.com/ibissource/iaf/pull/1083#pullrequestreview-496215394", "createdAt": "2020-09-25T08:29:16Z", "commit": {"oid": "d27fc69e708ba0fb07fb25a24bb773266a1552af"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQwODoyOToxNlrOHX6HIg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQwODoyOToxNlrOHX6HIg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDgzMTM5NA==", "bodyText": "Mag dan weg toch? als het toch niets doet...", "url": "https://github.com/ibissource/iaf/pull/1083#discussion_r494831394", "createdAt": "2020-09-25T08:29:16Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/jdbc/JdbcTransactionalStorage.java", "diffHunk": "@@ -1013,9 +1013,10 @@ public boolean isActive() {\n \t\treturn active;\n \t}\n \n+\t@Override\n \t@IbisDoc({\"the name of the column that stores the hostname of the server\", \"host\"})\n \tpublic void setHostField(String hostField) {\n-\t\tthis.hostField = hostField;\n+\t\tsuper.setHostField(hostField);\n \t}\n ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d27fc69e708ba0fb07fb25a24bb773266a1552af"}, "originalPosition": 39}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4a220025d6d019023eaf6b7789757ff779d07d08", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/4a220025d6d019023eaf6b7789757ff779d07d08", "committedDate": "2020-09-25T16:01:32Z", "message": "Fix issue"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9bd84d21c6c0b4ffdd96b7c355bd21ea1a920dbb", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/9bd84d21c6c0b4ffdd96b7c355bd21ea1a920dbb", "committedDate": "2020-09-28T08:23:57Z", "message": "Use Datasource and Driver for Oracle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "72c9b4ccab19fa1c0bcf3676838dc0b7d70de472", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/72c9b4ccab19fa1c0bcf3676838dc0b7d70de472", "committedDate": "2020-09-28T08:41:58Z", "message": "MsSqlServer using type datasource and driverClassName"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6f7cc68ebe5f4635511d9a6d5f91734f2e61f884", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/6f7cc68ebe5f4635511d9a6d5f91734f2e61f884", "committedDate": "2020-09-28T09:04:15Z", "message": "MySQL and MariaDB using type datasource and driverClassName"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3MzcwNjQ4", "url": "https://github.com/ibissource/iaf/pull/1083#pullrequestreview-497370648", "createdAt": "2020-09-28T10:10:55Z", "commit": {"oid": "6f7cc68ebe5f4635511d9a6d5f91734f2e61f884"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e139a8e7ae54127da5f75c13bfae901a1ebb5349", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/e139a8e7ae54127da5f75c13bfae901a1ebb5349", "committedDate": "2020-09-28T11:33:05Z", "message": "Merge branch 'master' into Add_MariaDB_full_JdbcListener_support"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2e535c36c5536e84a1bd2222706a3d8f4bec86cb", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/2e535c36c5536e84a1bd2222706a3d8f4bec86cb", "committedDate": "2020-09-28T12:47:28Z", "message": "cosmetic"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1099, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}