{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAzMDk0MDM4", "number": 602, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxNDowMDoyM1rODyFe5A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxNDowMzoyNFrODyFkUw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzODQ1MjIwOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/nl/nn/adapterframework/filesystem/AmazonS3FileSystem.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxNDowMDoyM1rOGF7Itw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxNDoxMzoxOVrOGF7tfA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODg2NDk1MQ==", "bodyText": "I can imagine that you should only add the client configuration if the proxy configuration has really been set,\nand that if no proxy is configured, it should not be added.", "url": "https://github.com/ibissource/iaf/pull/602#discussion_r408864951", "createdAt": "2020-04-15T14:00:23Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/filesystem/AmazonS3FileSystem.java", "diffHunk": "@@ -110,7 +114,8 @@ public void open() {\n \t\tAmazonS3ClientBuilder s3ClientBuilder = AmazonS3ClientBuilder.standard()\n \t\t\t\t.withChunkedEncodingDisabled(isChunkedEncodingDisabled())\n \t\t\t\t.withForceGlobalBucketAccessEnabled(isForceGlobalBucketAccessEnabled()).withRegion(getClientRegion())\n-\t\t\t\t.withCredentials(new AWSStaticCredentialsProvider(awsCreds));\n+\t\t\t\t.withCredentials(new AWSStaticCredentialsProvider(awsCreds))\n+\t\t\t\t.withClientConfiguration(this.getProxyConfig());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a17c86f0137dc9d62bd1b34df98c4aaa137de641"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODg3NDM2NA==", "bodyText": "if getProxyConfig is null, the connection will be without proxy. we are not going to get a nullPointerException o something like that.", "url": "https://github.com/ibissource/iaf/pull/602#discussion_r408874364", "createdAt": "2020-04-15T14:13:19Z", "author": {"login": "ccamiletti"}, "path": "core/src/main/java/nl/nn/adapterframework/filesystem/AmazonS3FileSystem.java", "diffHunk": "@@ -110,7 +114,8 @@ public void open() {\n \t\tAmazonS3ClientBuilder s3ClientBuilder = AmazonS3ClientBuilder.standard()\n \t\t\t\t.withChunkedEncodingDisabled(isChunkedEncodingDisabled())\n \t\t\t\t.withForceGlobalBucketAccessEnabled(isForceGlobalBucketAccessEnabled()).withRegion(getClientRegion())\n-\t\t\t\t.withCredentials(new AWSStaticCredentialsProvider(awsCreds));\n+\t\t\t\t.withCredentials(new AWSStaticCredentialsProvider(awsCreds))\n+\t\t\t\t.withClientConfiguration(this.getProxyConfig());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODg2NDk1MQ=="}, "originalCommit": {"oid": "a17c86f0137dc9d62bd1b34df98c4aaa137de641"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzODQ1Mjc3OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/nl/nn/adapterframework/filesystem/AmazonS3FileSystem.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxNDowMDoyOVrOGF7JEg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxNDoxMzoyM1rOGF7toA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODg2NTA0Mg==", "bodyText": "You'll have to create two separate setters for this: one for proxyHost and one for proxyPort.\nCreating these two setters results in the possibility to set values in the configuration.xml, like:\nproxyHost=\"hq.proxy.insim.biz\" proxyPort=\"9400\"", "url": "https://github.com/ibissource/iaf/pull/602#discussion_r408865042", "createdAt": "2020-04-15T14:00:29Z", "author": {"login": "gvanbrakel"}, "path": "core/src/main/java/nl/nn/adapterframework/filesystem/AmazonS3FileSystem.java", "diffHunk": "@@ -603,5 +608,19 @@ public void setBucketCreationEnabled(boolean bucketCreationEnabled) {\n \tpublic boolean isBucketExistsThrowException() {\n \t\treturn bucketExistsThrowException;\n \t}\n+\n+\tpublic ClientConfiguration getProxyConfig() {\n+\t\treturn proxyConfig;\n+\t}\n+\n+\tpublic void setProxyConfig(String proxyHost, Integer proxyPort) {\n+\t\tif (proxyHost != null && proxyPort != null) {\n+\t\t\tproxyConfig = new ClientConfiguration();\n+\t\t\tproxyConfig.setProtocol(Protocol.HTTPS);\n+\t\t\tproxyConfig.setProxyHost(proxyHost);\n+\t\t\tproxyConfig.setProxyPort(proxyPort);\n+\t\t}\n+\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a17c86f0137dc9d62bd1b34df98c4aaa137de641"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODg3NDQwMA==", "bodyText": "ok, i will change it", "url": "https://github.com/ibissource/iaf/pull/602#discussion_r408874400", "createdAt": "2020-04-15T14:13:23Z", "author": {"login": "ccamiletti"}, "path": "core/src/main/java/nl/nn/adapterframework/filesystem/AmazonS3FileSystem.java", "diffHunk": "@@ -603,5 +608,19 @@ public void setBucketCreationEnabled(boolean bucketCreationEnabled) {\n \tpublic boolean isBucketExistsThrowException() {\n \t\treturn bucketExistsThrowException;\n \t}\n+\n+\tpublic ClientConfiguration getProxyConfig() {\n+\t\treturn proxyConfig;\n+\t}\n+\n+\tpublic void setProxyConfig(String proxyHost, Integer proxyPort) {\n+\t\tif (proxyHost != null && proxyPort != null) {\n+\t\t\tproxyConfig = new ClientConfiguration();\n+\t\t\tproxyConfig.setProtocol(Protocol.HTTPS);\n+\t\t\tproxyConfig.setProxyHost(proxyHost);\n+\t\t\tproxyConfig.setProxyPort(proxyPort);\n+\t\t}\n+\t}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODg2NTA0Mg=="}, "originalCommit": {"oid": "a17c86f0137dc9d62bd1b34df98c4aaa137de641"}, "originalPosition": 44}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzODQ2NjExOnYy", "diffSide": "RIGHT", "path": "test-integration/src/test/java/nl/nn/adapterframework/filesystem/AmazonS3SenderTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxNDowMzoyNFrOGF7RWg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxNDowMzoyNFrOGF7RWg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODg2NzE2Mg==", "bodyText": "Could you show in a test that it works both with and without a proxy configured?", "url": "https://github.com/ibissource/iaf/pull/602#discussion_r408867162", "createdAt": "2020-04-15T14:03:24Z", "author": {"login": "gvanbrakel"}, "path": "test-integration/src/test/java/nl/nn/adapterframework/filesystem/AmazonS3SenderTest.java", "diffHunk": "@@ -78,6 +81,7 @@ public AmazonS3Sender createFileSystemSender(){\n \t\ts3.setAccessKey(accessKey);\n \t\ts3.setSecretKey(secretKey);\n \t\ts3.setBucketName(bucketName);\n+\t\ts3.setProxyConfig(proxyHost, proxyPort);\n \t\treturn s3;\n \t}\n ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a17c86f0137dc9d62bd1b34df98c4aaa137de641"}, "originalPosition": 26}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 431, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}