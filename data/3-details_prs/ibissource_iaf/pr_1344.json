{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQxMjg5NTE5", "number": 1344, "title": "Introduce javascript.engines property for flowchart", "bodyText": "", "createdAt": "2020-12-16T16:30:33Z", "url": "https://github.com/ibissource/iaf/pull/1344", "merged": true, "mergeCommit": {"oid": "35ee0e28cd8ba60fb5d5a18cb8b7226b672d09f9"}, "closed": true, "closedAt": "2020-12-22T15:16:34Z", "author": {"login": "alisihab"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdmxXasgH2gAyNTQxMjg5NTE5OmM1NTYzMTRhNWJjY2Y3YTFhN2JmNzkwNzA3NzUxODIxZTQxZGU1YzA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdosF3RAFqTU1NzE1Mzk4Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c556314a5bccf7a1a7bf790707751821e41de5c0", "author": {"user": {"login": "alisihab", "name": null}}, "url": "https://github.com/ibissource/iaf/commit/c556314a5bccf7a1a7bf790707751821e41de5c0", "committedDate": "2020-12-16T16:17:17Z", "message": "Introduce javascript.engines property to set comma separated engine list"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU0NTM4NTg5", "url": "https://github.com/ibissource/iaf/pull/1344#pullrequestreview-554538589", "createdAt": "2020-12-17T12:01:17Z", "commit": {"oid": "c556314a5bccf7a1a7bf790707751821e41de5c0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU1MzI4Nzcx", "url": "https://github.com/ibissource/iaf/pull/1344#pullrequestreview-555328771", "createdAt": "2020-12-18T09:28:26Z", "commit": {"oid": "c556314a5bccf7a1a7bf790707751821e41de5c0"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQwOToyODoyNlrOIIbTRw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQwOTozNToyMVrOIIbnFg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTcwNjgyMw==", "bodyText": "I think this should be done once, (moved to the top). Otherwise this will happen every time a new engine is generated..\nYou can, instead of using split, use AppConstants.getTokenizedProperty()", "url": "https://github.com/ibissource/iaf/pull/1344#discussion_r545706823", "createdAt": "2020-12-18T09:28:26Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/extensions/graphviz/GraphvizEngine.java", "diffHunk": "@@ -156,21 +155,22 @@ private String getVisJsWrapper() {\n \n \t\tEngine(String initScript, String graphvisJsLibrary) {\n \t\t\t// Available JS Engines. Lower index has priority.\n-\t\t\tClass<?>[] engines = new Class[]{J2V8.class, Nashorn.class};\n+\t\t\tString[] engines = AppConstants.getInstance().getString(\"javascript.engines\", \"nl.nn.adapterframework.extensions.javascript.J2V8,nl.nn.adapterframework.extensions.javascript.Nashorn\").split(\",\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c556314a5bccf7a1a7bf790707751821e41de5c0"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTcwNzY4MQ==", "bodyText": "Since this property is solely for the flow diagrams maybe change it to flow.javascript.engine", "url": "https://github.com/ibissource/iaf/pull/1344#discussion_r545707681", "createdAt": "2020-12-18T09:29:18Z", "author": {"login": "nielsm5"}, "path": "core/src/main/resources/AppConstants.properties", "diffHunk": "@@ -50,6 +50,7 @@ upload.dir=${ibis.tmpdir}\n \n flow.adapter.dir=${ibis.tmpdir}/flow/adapter\n flow.config.dir=${ibis.tmpdir}/flow/config\n+javascript.engines=nl.nn.adapterframework.extensions.javascript.J2V8,nl.nn.adapterframework.extensions.javascript.Nashorn", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c556314a5bccf7a1a7bf790707751821e41de5c0"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTcxMTg5NA==", "bodyText": "I think it would be a good idea, to have some form of instanceof check here, to validate if the new class instance is indeed castable to JavascriptEngine and if not returns a readable error message. If you move all this logic to the constructor, instead of keeping a String[] you can keep using the Class[].", "url": "https://github.com/ibissource/iaf/pull/1344#discussion_r545711894", "createdAt": "2020-12-18T09:35:21Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/extensions/graphviz/GraphvizEngine.java", "diffHunk": "@@ -156,21 +155,22 @@ private String getVisJsWrapper() {\n \n \t\tEngine(String initScript, String graphvisJsLibrary) {\n \t\t\t// Available JS Engines. Lower index has priority.\n-\t\t\tClass<?>[] engines = new Class[]{J2V8.class, Nashorn.class};\n+\t\t\tString[] engines = AppConstants.getInstance().getString(\"javascript.engines\", \"nl.nn.adapterframework.extensions.javascript.J2V8,nl.nn.adapterframework.extensions.javascript.Nashorn\").split(\",\");\n \n \t\t\tfor (int i = 0; i < engines.length && jsEngine == null; i++) {\n \t\t\t\ttry {\n-\t\t\t\t\tlog.debug(\"Trying Javascript engine [\" + engines[i].getName() + \"] for Graphviz.\");\n-\t\t\t\t\tJavascriptEngine<?> engine = ((JavascriptEngine<?>) engines[i].newInstance());\n+\t\t\t\t\tClass<?> clazz = Class.forName(engines[i]);\n+\t\t\t\t\tlog.debug(\"Trying Javascript engine [\" + engines[i] + \"] for Graphviz.\");\n+\t\t\t\t\tJavascriptEngine<?> engine = ((JavascriptEngine<?>) clazz.newInstance());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c556314a5bccf7a1a7bf790707751821e41de5c0"}, "originalPosition": 38}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "723f19d270feba2a43df0415d681deac07d0adaa", "author": {"user": {"login": "alisihab", "name": null}}, "url": "https://github.com/ibissource/iaf/commit/723f19d270feba2a43df0415d681deac07d0adaa", "committedDate": "2020-12-21T14:22:11Z", "message": "work on the feedback"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a835701efd8bd8fd8e5762ca81bda78653753d89", "author": {"user": {"login": "alisihab", "name": null}}, "url": "https://github.com/ibissource/iaf/commit/a835701efd8bd8fd8e5762ca81bda78653753d89", "committedDate": "2020-12-21T15:10:51Z", "message": "fix failing tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU3MTUzOTgy", "url": "https://github.com/ibissource/iaf/pull/1344#pullrequestreview-557153982", "createdAt": "2020-12-22T15:16:26Z", "commit": {"oid": "a835701efd8bd8fd8e5762ca81bda78653753d89"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 948, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}