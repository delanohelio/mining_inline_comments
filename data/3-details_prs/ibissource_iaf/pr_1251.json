{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE4NDIxOTky", "number": 1251, "title": "Fix #1060 use internet MessageID for ExchangeMailListener", "bodyText": "", "createdAt": "2020-11-10T11:29:46Z", "url": "https://github.com/ibissource/iaf/pull/1251", "merged": true, "mergeCommit": {"oid": "4d3754245b476e18e018153e2f2e6224c3e14a3a"}, "closed": true, "closedAt": "2020-11-13T10:27:09Z", "author": {"login": "gvanbrakel"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdbHoE5AH2gAyNTE4NDIxOTkyOjc0NjZkYWVhZmFiMDM0NzBiNTBhOGM3Zjk5MTViYzliOWU1ZDA3ODc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdcEHdcgFqTUyOTkyMzg2NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7466daeafab03470b50a8c7f9915bc9b9e5d0787", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/7466daeafab03470b50a8c7f9915bc9b9e5d0787", "committedDate": "2020-11-10T11:26:18Z", "message": "Fix #160 use Internet MessageID for refactored ExchangeMailListener"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1ed9de30895835c081884bb436f1ef8016ec78fe", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/1ed9de30895835c081884bb436f1ef8016ec78fe", "committedDate": "2020-11-10T11:28:02Z", "message": "add test file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec9b8035338eb452e790533e94e0aa919f8e1cd6", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/ec9b8035338eb452e790533e94e0aa919f8e1cd6", "committedDate": "2020-11-10T12:06:49Z", "message": "Add ExchangeFolderSender to PR"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d2dff84feeacc29c9ccbd2df3bdb47f654bb4ff9", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/d2dff84feeacc29c9ccbd2df3bdb47f654bb4ff9", "committedDate": "2020-11-10T12:31:20Z", "message": "Fix Codacy issue"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3Mzc1MjE5", "url": "https://github.com/ibissource/iaf/pull/1251#pullrequestreview-527375219", "createdAt": "2020-11-10T16:20:52Z", "commit": {"oid": "d2dff84feeacc29c9ccbd2df3bdb47f654bb4ff9"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxNjoyMDo1MlrOHwkiYQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxNzozNTo0M1rOHxXV1w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDY5MjMyMQ==", "bodyText": "Dit hoort meer thuis in een MailFileSystemUtils... We moeten er voor zorgen dat de util classes niet uit de klauwen gaan lopen qua compliciteit en grootte.", "url": "https://github.com/ibissource/iaf/pull/1251#discussion_r520692321", "createdAt": "2020-11-10T16:20:52Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/filesystem/FileSystemUtils.java", "diffHunk": "@@ -201,4 +206,63 @@ public void close() throws IOException {\n \t\t}\n \t}\n \n+\tpublic static <M,A> void addEmailInfoSimple(IMailFileSystem<M,A> fileSystem, M emailMessage, SaxElementBuilder emailXml) throws FileSystemException, SAXException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d2dff84feeacc29c9ccbd2df3bdb47f654bb4ff9"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDY5Mjk2MQ==", "bodyText": "Kan je hier niet beter attachmentXml.addAttribute(\"filename\", filename); gebruiken?", "url": "https://github.com/ibissource/iaf/pull/1251#discussion_r520692961", "createdAt": "2020-11-10T16:21:47Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/filesystem/FileSystemUtils.java", "diffHunk": "@@ -201,4 +206,63 @@ public void close() throws IOException {\n \t\t}\n \t}\n \n+\tpublic static <M,A> void addEmailInfoSimple(IMailFileSystem<M,A> fileSystem, M emailMessage, SaxElementBuilder emailXml) throws FileSystemException, SAXException {\n+\t\temailXml.addElement(\"subject\", fileSystem.getSubject(emailMessage));\n+\t}\n+\n+\tpublic static <M,A> void addEmailInfo(IMailFileSystem<M,A> fileSystem, M emailMessage, SaxElementBuilder emailXml) throws FileSystemException, SAXException {\n+\t\ttry (SaxElementBuilder recipientsXml = emailXml.startElement(\"recipients\")) {\n+\t\t\tfor(String address:fileSystem.getToRecipients(emailMessage)) {\n+\t\t\t\trecipientsXml.addElement(\"recipient\", \"type\", \"to\", address);\n+\t\t\t}\n+\t\t\tfor(String address:fileSystem.getCCRecipients(emailMessage)) {\n+\t\t\t\trecipientsXml.addElement(\"recipient\", \"type\", \"cc\", address);\n+\t\t\t}\n+\t\t\tfor(String address:fileSystem.getBCCRecipients(emailMessage)) {\n+\t\t\t\trecipientsXml.addElement(\"recipient\", \"type\", \"bcc\", address);\n+\t\t\t}\n+\t\t}\n+\t\temailXml.addElement(\"from\", fileSystem.getFrom(emailMessage));\n+\t\temailXml.addElement(\"subject\", fileSystem.getSubject(emailMessage));\n+\t\temailXml.addElement(\"message\", fileSystem.getMessageBody(emailMessage));\n+\t\ttry (SaxElementBuilder attachmentsXml = emailXml.startElement(\"attachments\")) {\n+\t\t\tfor (Iterator<A> it = fileSystem.listAttachments(emailMessage); it.hasNext();) {\n+\t\t\t\tfileSystem.extractAttachment(it.next(), attachmentsXml);\n+\t\t\t}\n+\t\t} catch (Exception e) {\n+\t\t\tthrow new FileSystemException(\"Cannot extract attachment\",e);\n+\t\t}\n+\t\ttry (SaxElementBuilder headersXml = emailXml.startElement(\"headers\")) {\n+\t\t\tMap<String,Object> properties = fileSystem.getAdditionalFileProperties(emailMessage);\n+\t\t\tif (properties != null) {\n+\t\t\t\tfor (Map.Entry<String,Object> header: properties.entrySet()) {\n+\t\t\t\t\tif (header.getValue() instanceof List) {\n+\t\t\t\t\t\tfor(Object value:(List<?>)header.getValue()) {\n+\t\t\t\t\t\t\theadersXml.addElement(\"header\", \"name\", header.getKey(), (String)value);\n+\t\t\t\t\t\t}\n+\t\t\t\t\t} else {\n+\t\t\t\t\t\theadersXml.addElement(\"header\", \"name\", header.getKey(), (String)header.getValue());\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\t\t\t}\n+\t\t}\n+\t\tSimpleDateFormat sdf = new SimpleDateFormat(\"yyyy-MM-dd'T'HH:mm:ss.SSSZ\");\n+\t\temailXml.addElement(\"dateTimeSent\", sdf.format(fileSystem.getDateTimeSent(emailMessage)));\n+\t\temailXml.addElement(\"dateTimeReceived\", sdf.format(fileSystem.getDateTimeReceived(emailMessage)));\n+\t}\n+\n+\tpublic static <M,A> void addAttachmentInfo(IMailFileSystem<M,A> fileSystem, A attachment, SaxElementBuilder attachmentsXml) throws FileSystemException, SAXException {\n+\t\ttry (SaxElementBuilder attachmentXml = attachmentsXml.startElement(\"attachment\")) {\n+\t\t\tattachmentXml.addAttribute(\"name\", fileSystem.getAttachmentName(attachment));\n+\t\t\tString filename = fileSystem.getAttachmentFileName(attachment);\n+\t\t\tif (filename!=null) {\n+\t\t\t\tattachmentXml.addAttribute(\"filename\", fileSystem.getAttachmentFileName(attachment));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d2dff84feeacc29c9ccbd2df3bdb47f654bb4ff9"}, "originalPosition": 74}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTUyMzc3Mw==", "bodyText": "Ik snap niet waarom je dit hier doet", "url": "https://github.com/ibissource/iaf/pull/1251#discussion_r521523773", "createdAt": "2020-11-11T17:34:31Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/filesystem/ExchangeFileSystem.java", "diffHunk": "@@ -332,7 +330,20 @@ public boolean exists(Item f) throws FileSystemException {\n \t\t\tif (findResults.getTotalCount() == 0) {\n \t\t\t\treturn FileSystemUtils.getDirectoryStream(null);\n \t\t\t} else {\n-\t\t\t\treturn FileSystemUtils.getDirectoryStream(findResults.getItems().iterator());\n+\t\t\t\tIterator<Item> itemIterator = findResults.getItems().iterator();\n+\t\t\t\treturn FileSystemUtils.getDirectoryStream(new Iterator<EmailMessage>() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d2dff84feeacc29c9ccbd2df3bdb47f654bb4ff9"}, "originalPosition": 95}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTUyNDY5NQ==", "bodyText": "Hier ook een log.warn oid neerzetten dat een onverwacht attachment ding opgegeven is?", "url": "https://github.com/ibissource/iaf/pull/1251#discussion_r521524695", "createdAt": "2020-11-11T17:35:43Z", "author": {"login": "nielsm5"}, "path": "core/src/main/java/nl/nn/adapterframework/filesystem/ExchangeFileSystem.java", "diffHunk": "@@ -555,6 +569,18 @@ public InputStream readAttachment(Attachment a) throws FileSystemException, IOEx\n \t\treturn binaryInputStream;\n \t}\n \n+\t@Override\n+\tpublic EmailMessage getFileFromAttachment(Attachment a) throws FileSystemException {\n+\t\tif (a instanceof ItemAttachment) {\n+\t\t\tItemAttachment ia = (ItemAttachment) a;\n+\t\t\tItem aItem = ia.getItem();\n+\t\t\tif (aItem instanceof EmailMessage) {\n+\t\t\t\treturn (EmailMessage) aItem;\n+\t\t\t}\n+\t\t}\n+\t\treturn null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d2dff84feeacc29c9ccbd2df3bdb47f654bb4ff9"}, "originalPosition": 312}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3db18f7e51ec4ad3a716d05e4948b7c005733871", "author": {"user": {"login": "gvanbrakel", "name": "Gerrit van Brakel"}}, "url": "https://github.com/ibissource/iaf/commit/3db18f7e51ec4ad3a716d05e4948b7c005733871", "committedDate": "2020-11-12T17:27:12Z", "message": "Fix issues, add separate MailListener and MailFileSystemUtils"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI5OTIzODY1", "url": "https://github.com/ibissource/iaf/pull/1251#pullrequestreview-529923865", "createdAt": "2020-11-13T09:54:53Z", "commit": {"oid": "3db18f7e51ec4ad3a716d05e4948b7c005733871"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1040, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}