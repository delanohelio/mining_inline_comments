{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIwNDQ5OTg0", "number": 858, "title": "swift: refactor public functionality as precursor to L7 filters", "bodyText": "Context\nAs part of the work to support platform (Swift/Kotlin) L7 filters, we are updating the public interfaces/functionality of the Envoy Mobile library to combine the concepts of a StreamEmitter and ResponseHandler into a \"stream\".\nGoals\n\nUnify the existing response handler and stream emitter types into a single \"stream\" type that will make it easier to communicate with an underlying filter manager for both outbound requests and inbound responses\nProvide guard rails that prevent the consumer from making mistakes, such as setting callback handlers after starting a stream and thus missing updates\nProvide a clear interface to the user for creating and starting streams\nFocus on the basics (bi-directional streaming support), which will allow for other wrappers to be written in the future (i.e., GRPC, unary, Rx, etc.)\nUpdate interfaces to utilize the new wrapper types introduced on master (ResponseHeaders, RequestHeaders, etc.)\n\nTypes\n\nStreamClient: The publicly exposed interface of EnvoyEngine. Provides a function for starting a new stream using Envoy Mobile, and is built using StreamClientBuilder\nStreamPrototype: Type that allows users to set up a stream (providing callbacks, etc.) prior to starting it\nStream: Produced by calling start() on a StreamPrototype, and allows the consumer to send data over the stream and eventually close it\nGRPCClient / GRPCStreamPrototype / GRPCStream: Types wrapping the above 3 types, converting the existing gRPC types to utilize the new functionality\n\nTo start a stream, consumers now do something like this:\nlet streamClient = try StreamClientBuilder().build()\n...\nlet headers = RequestHeadersBuilder(method: .get, authority: \"envoyproxy.io\", path: \"/test\")\n  .addUpstreamHttpProtocol(.http2)\n  .build()\n\nstreamClient\n  .newStream()\n  .setOnResponseHeaders { ... }\n  .setOnResponseData { ... }\n  .start()\n  .sendHeaders(headers, endStream: false)\n  .sendData(data)\n  .close()\nTests\n\nUnit tests have been added / updated accordingly.\nSample apps have also been updated (CI validates via \"hello world\").\n\nNotes\n\nA follow-up PR will migrate Android to mirror these\nDocumentation will be updated separately\n\nSigned-off-by: Michael Rebello me@michaelrebello.com", "createdAt": "2020-05-20T01:17:39Z", "url": "https://github.com/envoyproxy/envoy-mobile/pull/858", "merged": true, "mergeCommit": {"oid": "d7b6af3e3e02c2f1152e9ee7f179418c4b5062c4"}, "closed": true, "closedAt": "2020-06-09T16:42:09Z", "author": {"login": "rebello95"}, "timelineItems": {"totalCount": 34, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABci-n5cAH2gAyNDIwNDQ5OTg0OmYwOTdjOTQ1N2JmMzU1YzU4YjVlNGM4NTY3NzA2NjgyNWMwYjNjOGY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcpapfvAFqTQyNjcyNTI1Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f097c9457bf355c58b5e4c85677066825c0b3c8f", "author": {"user": {"login": "rebello95", "name": "Michael Rebello"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/f097c9457bf355c58b5e4c85677066825c0b3c8f", "committedDate": "2020-05-20T01:17:12Z", "message": "wip: l7 filters M2\n\nSigned-off-by: Michael Rebello <me@michaelrebello.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "363541cf2f82b35152474aec0ace3f50242b4233", "author": {"user": {"login": "rebello95", "name": "Michael Rebello"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/363541cf2f82b35152474aec0ace3f50242b4233", "committedDate": "2020-05-20T18:13:27Z", "message": "Merge remote-tracking branch 'origin/master' into swift-l7-m2\n\nSigned-off-by: Michael Rebello <me@michaelrebello.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "37019ddb4afbd77e310b444cc7ec874bb62993d8", "author": {"user": {"login": "rebello95", "name": "Michael Rebello"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/37019ddb4afbd77e310b444cc7ec874bb62993d8", "committedDate": "2020-05-22T00:46:35Z", "message": "push before moving branches\n\nSigned-off-by: Michael Rebello <me@michaelrebello.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "18726c3288dcfc1748df7ddbf88eaf96e5764d98", "author": {"user": {"login": "rebello95", "name": "Michael Rebello"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/18726c3288dcfc1748df7ddbf88eaf96e5764d98", "committedDate": "2020-05-27T17:30:34Z", "message": "Merge remote-tracking branch 'origin/master' into swift-l7-m2\n\nSigned-off-by: Michael Rebello <me@michaelrebello.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b4f5df12e6bc49388ce472f49a4d08367869312c", "author": {"user": {"login": "rebello95", "name": "Michael Rebello"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/b4f5df12e6bc49388ce472f49a4d08367869312c", "committedDate": "2020-05-29T00:42:01Z", "message": "Merge remote-tracking branch 'origin/master' into swift-l7-m2\n\nSigned-off-by: Michael Rebello <me@michaelrebello.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f9d66f2d40813fc0c5cfa5936b5d7b43af662c1e", "author": {"user": {"login": "rebello95", "name": "Michael Rebello"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/f9d66f2d40813fc0c5cfa5936b5d7b43af662c1e", "committedDate": "2020-05-29T23:56:10Z", "message": "checkpoint\n\nSigned-off-by: Michael Rebello <me@michaelrebello.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f28419cafef7c8869a73e629a3e3df1dc2f3bf42", "author": {"user": {"login": "rebello95", "name": "Michael Rebello"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/f28419cafef7c8869a73e629a3e3df1dc2f3bf42", "committedDate": "2020-05-29T23:56:20Z", "message": "Merge remote-tracking branch 'origin/master' into swift-l7-m2\n\nSigned-off-by: Michael Rebello <me@michaelrebello.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0d0c2eb78107d93e4e988f06d1cfbc11b541bafe", "author": {"user": {"login": "rebello95", "name": "Michael Rebello"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/0d0c2eb78107d93e4e988f06d1cfbc11b541bafe", "committedDate": "2020-05-30T01:07:52Z", "message": "make grpc compile\n\nSigned-off-by: Michael Rebello <me@michaelrebello.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "943b419ff56a95077a25d865c5464a03042c010f", "author": {"user": {"login": "rebello95", "name": "Michael Rebello"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/943b419ff56a95077a25d865c5464a03042c010f", "committedDate": "2020-05-30T01:11:58Z", "message": "linter fixes\n\nSigned-off-by: Michael Rebello <me@michaelrebello.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7bec6847911fb715fe7dc145e753f434e8c79ab8", "author": {"user": {"login": "rebello95", "name": "Michael Rebello"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/7bec6847911fb715fe7dc145e753f434e8c79ab8", "committedDate": "2020-06-05T17:53:56Z", "message": "tests are green\n\nSigned-off-by: Michael Rebello <me@michaelrebello.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "98518e432c125be204d45e071840fbd701b10034", "author": {"user": {"login": "rebello95", "name": "Michael Rebello"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/98518e432c125be204d45e071840fbd701b10034", "committedDate": "2020-06-05T17:54:05Z", "message": "Merge remote-tracking branch 'origin/master' into swift-l7-m2\n\nSigned-off-by: Michael Rebello <me@michaelrebello.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f848888adeed5eefeb16a37053a4415aef292522", "author": {"user": {"login": "rebello95", "name": "Michael Rebello"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/f848888adeed5eefeb16a37053a4415aef292522", "committedDate": "2020-06-05T22:14:15Z", "message": "fix demos\n\nSigned-off-by: Michael Rebello <me@michaelrebello.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7b2a3a0588d2f5acfa2b31743e0026714e4a92bf", "author": {"user": {"login": "rebello95", "name": "Michael Rebello"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/7b2a3a0588d2f5acfa2b31743e0026714e4a92bf", "committedDate": "2020-06-05T22:19:53Z", "message": "Merge remote-tracking branch 'origin/master' into swift-l7-m2\n\nSigned-off-by: Michael Rebello <me@michaelrebello.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "15cbedd64a7b8060a2200c851df43b31af7344ee", "author": {"user": {"login": "rebello95", "name": "Michael Rebello"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/15cbedd64a7b8060a2200c851df43b31af7344ee", "committedDate": "2020-06-05T23:10:12Z", "message": "self review\n\nSigned-off-by: Michael Rebello <me@michaelrebello.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a93893dc74322a693e78d3a2cfc240e499765072", "author": {"user": {"login": "rebello95", "name": "Michael Rebello"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/a93893dc74322a693e78d3a2cfc240e499765072", "committedDate": "2020-06-05T23:20:36Z", "message": "fixup\n\nSigned-off-by: Michael Rebello <me@michaelrebello.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "efc034ab636d06a7a6a39c1a87a38ab24dfb0419", "author": {"user": {"login": "rebello95", "name": "Michael Rebello"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/efc034ab636d06a7a6a39c1a87a38ab24dfb0419", "committedDate": "2020-06-05T23:20:50Z", "message": "Merge remote-tracking branch 'origin/master' into swift-l7-m2\n\nSigned-off-by: Michael Rebello <me@michaelrebello.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8a8ac406de021d6d880f366360d25fc448935765", "author": {"user": {"login": "rebello95", "name": "Michael Rebello"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/8a8ac406de021d6d880f366360d25fc448935765", "committedDate": "2020-06-05T23:23:39Z", "message": "swiftlint\n\nSigned-off-by: Michael Rebello <me@michaelrebello.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a63422f927aa84db6fa237730ff4544494a052c3", "author": {"user": {"login": "rebello95", "name": "Michael Rebello"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/a63422f927aa84db6fa237730ff4544494a052c3", "committedDate": "2020-06-05T23:29:02Z", "message": "swiftlint\n\nSigned-off-by: Michael Rebello <me@michaelrebello.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2NjA0MjQ5", "url": "https://github.com/envoyproxy/envoy-mobile/pull/858#pullrequestreview-426604249", "createdAt": "2020-06-08T20:40:51Z", "commit": {"oid": "a63422f927aa84db6fa237730ff4544494a052c3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQyMDo0MDo1MVrOGgvnZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQyMDo0MDo1MVrOGgvnZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjk4Nzc0OA==", "bodyText": "Should we change the name of the builder, since what it builds has changed?", "url": "https://github.com/envoyproxy/envoy-mobile/pull/858#discussion_r436987748", "createdAt": "2020-06-08T20:40:51Z", "author": {"login": "goaway"}, "path": "examples/objective-c/hello_world/ViewController.m", "diffHunk": "@@ -37,7 +37,7 @@ - (void)startEnvoy {\n   NSLog(@\"Starting Envoy...\");\n   NSError *error;\n   EnvoyClientBuilder *builder = [[EnvoyClientBuilder alloc] init];", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a63422f927aa84db6fa237730ff4544494a052c3"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2NjA1MTY1", "url": "https://github.com/envoyproxy/envoy-mobile/pull/858#pullrequestreview-426605165", "createdAt": "2020-06-08T20:42:18Z", "commit": {"oid": "a63422f927aa84db6fa237730ff4544494a052c3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQyMDo0MjoxOFrOGgvqeQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQyMDo0MjoxOFrOGgvqeQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjk4ODUzNw==", "bodyText": "StreamPrototype?", "url": "https://github.com/envoyproxy/envoy-mobile/pull/858#discussion_r436988537", "createdAt": "2020-06-08T20:42:18Z", "author": {"login": "goaway"}, "path": "examples/objective-c/hello_world/ViewController.m", "diffHunk": "@@ -65,38 +65,38 @@ - (void)performRequest {\n   self.requestCount++;\n   NSLog(@\"Starting request to '%@'\", _REQUEST_PATH);\n \n-  int requestID = self.requestCount;\n   // Note: this request will use an http/1.1 stream for the upstream request.\n   // The Swift example uses h2. This is done on purpose to test both paths in end-to-end tests\n   // in CI.\n-  RequestBuilder *builder = [[RequestBuilder alloc] initWithMethod:RequestMethodGet\n-                                                            scheme:_REQUEST_SCHEME\n-                                                         authority:_REQUEST_AUTHORITY\n-                                                              path:_REQUEST_PATH];\n-  Request *request = [builder build];\n-  ResponseHandler *handler = [[ResponseHandler alloc] initWithQueue:dispatch_get_main_queue()];\n+  int requestID = self.requestCount;\n+  RequestHeadersBuilder *builder = [[RequestHeadersBuilder alloc] initWithMethod:RequestMethodGet\n+                                                                          scheme:_REQUEST_SCHEME\n+                                                                       authority:_REQUEST_AUTHORITY\n+                                                                            path:_REQUEST_PATH];\n+  [builder addUpstreamHttpProtocol:UpstreamHttpProtocolHttp1];\n+  RequestHeaders *headers = [builder build];\n \n   __weak ViewController *weakSelf = self;\n-  [handler onHeaders:^(NSDictionary<NSString *, NSArray<NSString *> *> *headers,\n-                       NSInteger statusCode, BOOL endStream) {\n-    NSLog(@\"Response status (%i): %ld\\n%@\", requestID, statusCode, headers);\n-    NSString *body = [NSString stringWithFormat:@\"Status: %ld\", statusCode];\n+  InactiveStream *inactiveStream = [self.client newStream];", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a63422f927aa84db6fa237730ff4544494a052c3"}, "originalPosition": 45}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2NjA2OTI0", "url": "https://github.com/envoyproxy/envoy-mobile/pull/858#pullrequestreview-426606924", "createdAt": "2020-06-08T20:45:04Z", "commit": {"oid": "a63422f927aa84db6fa237730ff4544494a052c3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQyMDo0NTowNFrOGgvv-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQyMDo0NTowNFrOGgvv-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjk4OTk0Nw==", "bodyText": "I feel like onCancellation is most grammatically in line with the other callbacks, but \u00af\\_(\u30c4)_/\u00af", "url": "https://github.com/envoyproxy/envoy-mobile/pull/858#discussion_r436989947", "createdAt": "2020-06-08T20:45:04Z", "author": {"login": "goaway"}, "path": "library/kotlin/src/io/envoyproxy/envoymobile/filters/ResponseFilter.kt", "diffHunk": "@@ -66,5 +66,5 @@ interface ResponseFilter: Filter {\n    * This should be considered a terminal state, and invalidates any previous attempts to\n    * `stopIteration{...}`.\n    */\n-  fun onCanceled()\n+  fun onCancel()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a63422f927aa84db6fa237730ff4544494a052c3"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2Njk1MzM5", "url": "https://github.com/envoyproxy/envoy-mobile/pull/858#pullrequestreview-426695339", "createdAt": "2020-06-08T23:46:49Z", "commit": {"oid": "a63422f927aa84db6fa237730ff4544494a052c3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQyMzo0Njo0OVrOGg0Esg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQyMzo0Njo0OVrOGg0Esg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzA2MDc4Ng==", "bodyText": "I sort of prefer the old naming scheme (onHeaders) since setOnResponseHeaders to a degree suggests the implementation detail that this is a functor captured as a member, whereas I feel onHeaders (or onResponseHeaders) to me simply suggests \"on headers, do x\". But this is subjective.", "url": "https://github.com/envoyproxy/envoy-mobile/pull/858#discussion_r437060786", "createdAt": "2020-06-08T23:46:49Z", "author": {"login": "goaway"}, "path": "examples/swift/hello_world/ViewController.swift", "diffHunk": "@@ -38,33 +38,36 @@ final class ViewController: UITableViewController {\n   }\n \n   private func performRequest() {\n-    guard let envoy = self.envoy else {\n+    guard let client = self.client else {\n       NSLog(\"Failed to start request - Envoy is not running\")\n       return\n     }\n \n     self.requestCount += 1\n     NSLog(\"Starting request to '\\(kRequestPath)'\")\n \n-    let requestID = self.requestCount\n     // Note: this request will use an h2 stream for the upstream request.\n     // The Objective-C example uses http/1.1. This is done on purpose to test both paths in\n     // end-to-end tests in CI.\n-    let request = RequestBuilder(method: .get, scheme: kRequestScheme,\n-                                 authority: kRequestAuthority,\n-                                 path: kRequestPath)\n-        .addUpstreamHttpProtocol(.http2)\n-        .build()\n-    let handler = ResponseHandler()\n-      .onHeaders { [weak self] headers, statusCode, _ in\n+    let requestID = self.requestCount\n+    let headers = RequestHeadersBuilder(method: .get, scheme: kRequestScheme,\n+                                        authority: kRequestAuthority, path: kRequestPath)\n+      .addUpstreamHttpProtocol(.http2)\n+      .build()\n+\n+    client\n+      .newStream()\n+      .setOnResponseHeaders { [weak self] headers, _ in", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a63422f927aa84db6fa237730ff4544494a052c3"}, "originalPosition": 48}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2Njk3ODY5", "url": "https://github.com/envoyproxy/envoy-mobile/pull/858#pullrequestreview-426697869", "createdAt": "2020-06-08T23:53:07Z", "commit": {"oid": "a63422f927aa84db6fa237730ff4544494a052c3"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2d386599ccb265e05af7fe309e9304c4481dfc40", "author": {"user": {"login": "rebello95", "name": "Michael Rebello"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/2d386599ccb265e05af7fe309e9304c4481dfc40", "committedDate": "2020-06-09T00:53:19Z", "message": "s/EnvoyClientBuilder/StreamClientBuilder\n\nSigned-off-by: Michael Rebello <me@michaelrebello.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "79cf99bab34681934932fefff77e93f352831f93", "author": {"user": {"login": "rebello95", "name": "Michael Rebello"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/79cf99bab34681934932fefff77e93f352831f93", "committedDate": "2020-06-09T00:55:38Z", "message": "s/InactiveStream/StreamPrototype\n\nSigned-off-by: Michael Rebello <me@michaelrebello.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6daabe5ade3e15aced884ae2e1737b5d4c840eaa", "author": {"user": {"login": "rebello95", "name": "Michael Rebello"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/6daabe5ade3e15aced884ae2e1737b5d4c840eaa", "committedDate": "2020-06-09T00:56:35Z", "message": "s/newStream/newStreamPrototype\n\nSigned-off-by: Michael Rebello <me@michaelrebello.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "105c9e033e7b5035e28522189ca66e47db2e0d3f", "author": {"user": {"login": "rebello95", "name": "Michael Rebello"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/105c9e033e7b5035e28522189ca66e47db2e0d3f", "committedDate": "2020-06-09T00:57:59Z", "message": "s/ActiveStream/Stream\n\nSigned-off-by: Michael Rebello <me@michaelrebello.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "201d1ff03967c0a8f84baf965c9192b569ef953a", "author": {"user": {"login": "rebello95", "name": "Michael Rebello"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/201d1ff03967c0a8f84baf965c9192b569ef953a", "committedDate": "2020-06-09T01:01:51Z", "message": "add missing builders\n\nSigned-off-by: Michael Rebello <me@michaelrebello.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8956be0c398327fd1d11be11051e49974b69ebbf", "author": {"user": {"login": "rebello95", "name": "Michael Rebello"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/8956be0c398327fd1d11be11051e49974b69ebbf", "committedDate": "2020-06-09T01:02:42Z", "message": "missed file rename\n\nSigned-off-by: Michael Rebello <me@michaelrebello.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2NzIxNzQ1", "url": "https://github.com/envoyproxy/envoy-mobile/pull/858#pullrequestreview-426721745", "createdAt": "2020-06-09T01:07:48Z", "commit": {"oid": "8956be0c398327fd1d11be11051e49974b69ebbf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQwMTowNzo0OFrOGg1W5g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQwMTowNzo0OFrOGg1W5g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzA4MTgzMA==", "bodyText": "No need for final?\n(RequestTrailers is final btw)", "url": "https://github.com/envoyproxy/envoy-mobile/pull/858#discussion_r437081830", "createdAt": "2020-06-09T01:07:48Z", "author": {"login": "buildbreaker"}, "path": "library/swift/src/RequestHeaders.swift", "diffHunk": "@@ -2,7 +2,7 @@ import Foundation\n \n /// Headers representing an outbound request.\n @objcMembers\n-public final class RequestHeaders: Headers {\n+public class RequestHeaders: Headers {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8956be0c398327fd1d11be11051e49974b69ebbf"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2NzIzMTMy", "url": "https://github.com/envoyproxy/envoy-mobile/pull/858#pullrequestreview-426723132", "createdAt": "2020-06-09T01:12:37Z", "commit": {"oid": "8956be0c398327fd1d11be11051e49974b69ebbf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQwMToxMjozN1rOGg1bwA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQwMToxMjozN1rOGg1bwA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzA4MzA3Mg==", "bodyText": "I'd be fine with newStream or newStreamPrototype, but if you're going with the latter, looks like you missed this.", "url": "https://github.com/envoyproxy/envoy-mobile/pull/858#discussion_r437083072", "createdAt": "2020-06-09T01:12:37Z", "author": {"login": "goaway"}, "path": "examples/objective-c/hello_world/ViewController.m", "diffHunk": "@@ -65,38 +65,38 @@ - (void)performRequest {\n   self.requestCount++;\n   NSLog(@\"Starting request to '%@'\", _REQUEST_PATH);\n \n-  int requestID = self.requestCount;\n   // Note: this request will use an http/1.1 stream for the upstream request.\n   // The Swift example uses h2. This is done on purpose to test both paths in end-to-end tests\n   // in CI.\n-  RequestBuilder *builder = [[RequestBuilder alloc] initWithMethod:RequestMethodGet\n-                                                            scheme:_REQUEST_SCHEME\n-                                                         authority:_REQUEST_AUTHORITY\n-                                                              path:_REQUEST_PATH];\n-  Request *request = [builder build];\n-  ResponseHandler *handler = [[ResponseHandler alloc] initWithQueue:dispatch_get_main_queue()];\n+  int requestID = self.requestCount;\n+  RequestHeadersBuilder *builder = [[RequestHeadersBuilder alloc] initWithMethod:RequestMethodGet\n+                                                                          scheme:_REQUEST_SCHEME\n+                                                                       authority:_REQUEST_AUTHORITY\n+                                                                            path:_REQUEST_PATH];\n+  [builder addUpstreamHttpProtocol:UpstreamHttpProtocolHttp1];\n+  RequestHeaders *headers = [builder build];\n \n   __weak ViewController *weakSelf = self;\n-  [handler onHeaders:^(NSDictionary<NSString *, NSArray<NSString *> *> *headers,\n-                       NSInteger statusCode, BOOL endStream) {\n-    NSLog(@\"Response status (%i): %ld\\n%@\", requestID, statusCode, headers);\n-    NSString *body = [NSString stringWithFormat:@\"Status: %ld\", statusCode];\n+  StreamPrototype *prototype = [self.client newStream];", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8956be0c398327fd1d11be11051e49974b69ebbf"}, "originalPosition": 47}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2NzI0MjE1", "url": "https://github.com/envoyproxy/envoy-mobile/pull/858#pullrequestreview-426724215", "createdAt": "2020-06-09T01:16:10Z", "commit": {"oid": "8956be0c398327fd1d11be11051e49974b69ebbf"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "14bcca65b7ed32bfde38ef6b55316bebb176e7b4", "author": {"user": {"login": "rebello95", "name": "Michael Rebello"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/14bcca65b7ed32bfde38ef6b55316bebb176e7b4", "committedDate": "2020-06-09T01:17:05Z", "message": "fix objc\n\nSigned-off-by: Michael Rebello <me@michaelrebello.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2NzI1MjU2", "url": "https://github.com/envoyproxy/envoy-mobile/pull/858#pullrequestreview-426725256", "createdAt": "2020-06-09T01:19:50Z", "commit": {"oid": "14bcca65b7ed32bfde38ef6b55316bebb176e7b4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4228, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}