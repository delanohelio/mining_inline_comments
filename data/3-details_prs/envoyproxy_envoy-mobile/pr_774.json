{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk1OTQzMjk3", "number": 774, "title": "retries: enable retry budget for concurrent retries", "bodyText": "Description: previously the cluster configuration for circuit breakers was not specified. This meant that Envoy Mobile was using the default of 3 concurrent retries. This is not appropriate, specially because all* active traffic goes through the same cluster. This PR changes the configuration and explicitly sets the retry_budget configuration.\nRisk Level: low (more retries will actually be allowed)\nTesting: local\nSigned-off-by: Jose Nino jnino@lyft.com", "createdAt": "2020-03-30T22:34:49Z", "url": "https://github.com/envoyproxy/envoy-mobile/pull/774", "merged": true, "mergeCommit": {"oid": "9ea806e20c6cced5f99a74f3fab0d5620909d560"}, "closed": true, "closedAt": "2020-03-31T03:32:37Z", "author": {"login": "junr03"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcS2SWRAH2gAyMzk1OTQzMjk3OmZiN2RjMGFkMTY3MjkzMTJmOTA4YTlhMjZjN2ZmZTY4MTdkZWMxZTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcS46LegFqTM4NDM0NTQ5Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "fb7dc0ad16729312f908a9a26c7ffe6817dec1e4", "author": {"user": {"login": "junr03", "name": "Jose Ulises Nino Rivera"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/fb7dc0ad16729312f908a9a26c7ffe6817dec1e4", "committedDate": "2020-03-30T22:31:38Z", "message": "retries: enable retry budget for concurrent retries\n\nSigned-off-by: Jose Nino <jnino@lyft.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0MjgxNzEx", "url": "https://github.com/envoyproxy/envoy-mobile/pull/774#pullrequestreview-384281711", "createdAt": "2020-03-30T22:37:25Z", "commit": {"oid": "fb7dc0ad16729312f908a9a26c7ffe6817dec1e4"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0MjgyODc0", "url": "https://github.com/envoyproxy/envoy-mobile/pull/774#pullrequestreview-384282874", "createdAt": "2020-03-30T22:39:53Z", "commit": {"oid": "fb7dc0ad16729312f908a9a26c7ffe6817dec1e4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQyMjozOTo1M1rOF9-2gQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQyMjozOTo1M1rOF9-2gQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDUzNzIxNw==", "bodyText": "Curious, why not set this to 100? Also looks like this defaults to 20%, how does that work with the 3 mentioned in the description? https://www.envoyproxy.io/docs/envoy/latest/api-v2/api/v2/cluster/circuit_breaker.proto", "url": "https://github.com/envoyproxy/envoy-mobile/pull/774#discussion_r400537217", "createdAt": "2020-03-30T22:39:53Z", "author": {"login": "rebello95"}, "path": "library/common/config_template.cc", "diffHunk": "@@ -70,6 +70,12 @@ const char* config_template = R\"(\n         keepalive_interval: 10\n         keepalive_probes: 1\n         keepalive_time: 5\n+    circuit_breakers: &circuit_breakers_settings\n+      thresholds:\n+        - priority: DEFAULT\n+          retry_budget:\n+            budget_percent:\n+              value: 50", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fb7dc0ad16729312f908a9a26c7ffe6817dec1e4"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "86d44592b305cb906f48d25eb427d1df0ce015c3", "author": {"user": {"login": "junr03", "name": "Jose Ulises Nino Rivera"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/86d44592b305cb906f48d25eb427d1df0ce015c3", "committedDate": "2020-03-30T23:00:40Z", "message": "update\n\nSigned-off-by: Jose Nino <jnino@lyft.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a2e41f175fc2534d0d428c3508e43ed8022c71a9", "author": {"user": {"login": "junr03", "name": "Jose Ulises Nino Rivera"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/a2e41f175fc2534d0d428c3508e43ed8022c71a9", "committedDate": "2020-03-30T23:01:24Z", "message": "a word\n\nSigned-off-by: Jose Nino <jnino@lyft.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0MjkyNTIz", "url": "https://github.com/envoyproxy/envoy-mobile/pull/774#pullrequestreview-384292523", "createdAt": "2020-03-30T23:01:50Z", "commit": {"oid": "a2e41f175fc2534d0d428c3508e43ed8022c71a9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQyMzowMTo1MFrOF9_XjQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMFQyMzowMTo1MFrOF9_XjQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU0NTY3Nw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                      # retries, e.g when the phone goes offline. Therefore, Envoy Mobile allows all concurrent\n          \n          \n            \n                      # retries (e.g., when the phone goes offline). Therefore, Envoy Mobile allows all concurrent", "url": "https://github.com/envoyproxy/envoy-mobile/pull/774#discussion_r400545677", "createdAt": "2020-03-30T23:01:50Z", "author": {"login": "rebello95"}, "path": "library/common/config_template.cc", "diffHunk": "@@ -70,6 +70,18 @@ const char* config_template = R\"(\n         keepalive_interval: 10\n         keepalive_probes: 1\n         keepalive_time: 5\n+    circuit_breakers: &circuit_breakers_settings\n+      thresholds:\n+        - priority: DEFAULT\n+          # n.b: with mobile clients there are scenarios where all concurrent requests might be\n+          # retries, e.g when the phone goes offline. Therefore, Envoy Mobile allows all concurrent", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a2e41f175fc2534d0d428c3508e43ed8022c71a9"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b701f00e20f0bdf8ed0dafc9d0f444a8a238b659", "author": {"user": {"login": "junr03", "name": "Jose Ulises Nino Rivera"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/b701f00e20f0bdf8ed0dafc9d0f444a8a238b659", "committedDate": "2020-03-30T23:03:15Z", "message": "a word\n\nSigned-off-by: Jose Nino <jnino@lyft.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0Mjk0NzM3", "url": "https://github.com/envoyproxy/envoy-mobile/pull/774#pullrequestreview-384294737", "createdAt": "2020-03-30T23:07:31Z", "commit": {"oid": "b701f00e20f0bdf8ed0dafc9d0f444a8a238b659"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0MzA0OTE2", "url": "https://github.com/envoyproxy/envoy-mobile/pull/774#pullrequestreview-384304916", "createdAt": "2020-03-30T23:33:53Z", "commit": {"oid": "b701f00e20f0bdf8ed0dafc9d0f444a8a238b659"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8702ac1212f34b27c66529c2c710f5e40edd5b6e", "author": {"user": {"login": "junr03", "name": "Jose Ulises Nino Rivera"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/8702ac1212f34b27c66529c2c710f5e40edd5b6e", "committedDate": "2020-03-31T01:26:08Z", "message": "Merge branch 'master' into concurrent-retries\n\nSigned-off-by: Jose Nino <jnino@lyft.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0MzQ1NDk3", "url": "https://github.com/envoyproxy/envoy-mobile/pull/774#pullrequestreview-384345497", "createdAt": "2020-03-31T01:34:57Z", "commit": {"oid": "8702ac1212f34b27c66529c2c710f5e40edd5b6e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4326, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}