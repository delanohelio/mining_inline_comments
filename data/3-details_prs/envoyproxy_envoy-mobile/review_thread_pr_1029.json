{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY3MDE2MDc4", "number": 1029, "reviewThreads": {"totalCount": 37, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQyMToyNzo1N1rOEXzkVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxODo0OTo1NFrOEYlS3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzMzk3NTg4OnYy", "diffSide": "RIGHT", "path": "library/kotlin/src/io/envoyproxy/envoymobile/filters/FilterDataStatus.kt", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQyMToyNzo1N1rOG_zftA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QwMToyNDo0M1rOG_4rUw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTU1NzE3Mg==", "bodyText": "If the caller omits headers here (passes nil), that will result in the underlying filter manager passing its internally buffered headers, correct? If so, I think that's worth documenting above", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1029#discussion_r469557172", "createdAt": "2020-08-12T21:27:57Z", "author": {"login": "rebello95"}, "path": "library/kotlin/src/io/envoyproxy/envoymobile/filters/FilterDataStatus.kt", "diffHunk": "@@ -45,4 +45,14 @@ sealed class FilterDataStatus {\n    * continuing processing, and will handle their own buffering.\n    */\n   class StopIterationNoBuffer : FilterDataStatus()\n+\n+  /**\n+   * Resume previously-stopped iteration, possibly forwarding headers, if iteration was previously\n+   * stopped during an on*Headers invocation.\n+   *\n+   * It is an error to return ResumeIteration if iteration is not currently stopped, and it is\n+   * an error to include headers if headers have already been forwarded to the next filter\n+   * (i.e. iteration was stopped during an on*Data invocation instead of on*Headers).\n+   */\n+  class ResumeIteration<T : Headers>(val headers: T?, val data: ByteBuffer) : FilterDataStatus()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "95b8d9f5e4fbc7c5c19ab4009ffd4c9d9b6675e6"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTY0MjA2Nw==", "bodyText": "Another option is for that to be an error (and I can update the documentation accordingly). To simplify reasoning, the contract could always be that all forwarded entities are passed back as part of a return from a filter invocation. If it's not explicitly passed back, it hasn't been forwarded.", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1029#discussion_r469642067", "createdAt": "2020-08-13T01:24:43Z", "author": {"login": "goaway"}, "path": "library/kotlin/src/io/envoyproxy/envoymobile/filters/FilterDataStatus.kt", "diffHunk": "@@ -45,4 +45,14 @@ sealed class FilterDataStatus {\n    * continuing processing, and will handle their own buffering.\n    */\n   class StopIterationNoBuffer : FilterDataStatus()\n+\n+  /**\n+   * Resume previously-stopped iteration, possibly forwarding headers, if iteration was previously\n+   * stopped during an on*Headers invocation.\n+   *\n+   * It is an error to return ResumeIteration if iteration is not currently stopped, and it is\n+   * an error to include headers if headers have already been forwarded to the next filter\n+   * (i.e. iteration was stopped during an on*Data invocation instead of on*Headers).\n+   */\n+  class ResumeIteration<T : Headers>(val headers: T?, val data: ByteBuffer) : FilterDataStatus()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTU1NzE3Mg=="}, "originalCommit": {"oid": "95b8d9f5e4fbc7c5c19ab4009ffd4c9d9b6675e6"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzMzk3Njc2OnYy", "diffSide": "RIGHT", "path": "library/kotlin/src/io/envoyproxy/envoymobile/filters/FilterTrailersStatus.kt", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQyMToyODoyMlrOG_zgTg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxMDowODo1NlrOHAFApA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTU1NzMyNg==", "bodyText": "Same comment here regarding behavior in the nil case", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1029#discussion_r469557326", "createdAt": "2020-08-12T21:28:22Z", "author": {"login": "rebello95"}, "path": "library/kotlin/src/io/envoyproxy/envoymobile/filters/FilterTrailersStatus.kt", "diffHunk": "@@ -17,4 +17,14 @@ sealed class FilterTrailersStatus<T : Headers> {\n    * is desired.\n    */\n   class StopIteration<T : Headers>(val trailers: T) : FilterTrailersStatus<T>()\n+\n+  /**\n+   * Resume previously-stopped iteration, possibly forwarding headers and data, if iteration was\n+   * previously stopped during an on*Headers or on*Data invocation.\n+   *\n+   * It is an error to return ResumeIteration if iteration is not currently stopped, and it is\n+   * an error to include headers if headers have already been forwarded to the next filter\n+   * (i.e. iteration was stopped during an on*Data invocation instead of on*Headers).\n+   */\n+  class ResumeIteration<T : Headers>(val headers: Headers?, val data: ByteBuffer?, val trailers: T) : FilterTrailersStatus<T>()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "95b8d9f5e4fbc7c5c19ab4009ffd4c9d9b6675e6"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTY0MzcwNw==", "bodyText": "I intentionally introduced a discrepancy between Kotlin and Swift here to demonstrate two potential approaches (we should ultimately pick one). The Swift approach allows unused entities to be defaulted to nil and left off of the return status. The Kotlin approach positions the entities in the order in which they'll appear.\nI'm open to either and think there's pros to both.", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1029#discussion_r469643707", "createdAt": "2020-08-13T01:27:02Z", "author": {"login": "goaway"}, "path": "library/kotlin/src/io/envoyproxy/envoymobile/filters/FilterTrailersStatus.kt", "diffHunk": "@@ -17,4 +17,14 @@ sealed class FilterTrailersStatus<T : Headers> {\n    * is desired.\n    */\n   class StopIteration<T : Headers>(val trailers: T) : FilterTrailersStatus<T>()\n+\n+  /**\n+   * Resume previously-stopped iteration, possibly forwarding headers and data, if iteration was\n+   * previously stopped during an on*Headers or on*Data invocation.\n+   *\n+   * It is an error to return ResumeIteration if iteration is not currently stopped, and it is\n+   * an error to include headers if headers have already been forwarded to the next filter\n+   * (i.e. iteration was stopped during an on*Data invocation instead of on*Headers).\n+   */\n+  class ResumeIteration<T : Headers>(val headers: Headers?, val data: ByteBuffer?, val trailers: T) : FilterTrailersStatus<T>()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTU1NzMyNg=="}, "originalCommit": {"oid": "95b8d9f5e4fbc7c5c19ab4009ffd4c9d9b6675e6"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTg0NDEzMg==", "bodyText": "I was playing around with the Swift playground, and it turns out that with named parameters, defaulted arguments on enum cases can be left off in any position. And with Kotlin I think we can achieve this with overloaded constructors. So in short, we should be able to support .resumeIteration(headers: myHeaders, data: myData) seamlessly with simple case of .resumeIteration(data: myData), realizing both the benefits of conceptually consistent ordering and defaulting.", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1029#discussion_r469844132", "createdAt": "2020-08-13T10:08:56Z", "author": {"login": "goaway"}, "path": "library/kotlin/src/io/envoyproxy/envoymobile/filters/FilterTrailersStatus.kt", "diffHunk": "@@ -17,4 +17,14 @@ sealed class FilterTrailersStatus<T : Headers> {\n    * is desired.\n    */\n   class StopIteration<T : Headers>(val trailers: T) : FilterTrailersStatus<T>()\n+\n+  /**\n+   * Resume previously-stopped iteration, possibly forwarding headers and data, if iteration was\n+   * previously stopped during an on*Headers or on*Data invocation.\n+   *\n+   * It is an error to return ResumeIteration if iteration is not currently stopped, and it is\n+   * an error to include headers if headers have already been forwarded to the next filter\n+   * (i.e. iteration was stopped during an on*Data invocation instead of on*Headers).\n+   */\n+  class ResumeIteration<T : Headers>(val headers: Headers?, val data: ByteBuffer?, val trailers: T) : FilterTrailersStatus<T>()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTU1NzMyNg=="}, "originalCommit": {"oid": "95b8d9f5e4fbc7c5c19ab4009ffd4c9d9b6675e6"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzMzk4MjY2OnYy", "diffSide": "RIGHT", "path": "library/swift/src/filters/FilterDataStatus.swift", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQyMTozMDoyM1rOG_zj7Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQyMTozMDoyM1rOG_zj7Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTU1ODI1Mw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              case resumeIteration(Data, withHeaders: Headers? = nil)\n          \n          \n            \n              case resumeIteration(headers: Headers? = nil, data: Data)", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1029#discussion_r469558253", "createdAt": "2020-08-12T21:30:23Z", "author": {"login": "rebello95"}, "path": "library/swift/src/filters/FilterDataStatus.swift", "diffHunk": "@@ -35,4 +35,14 @@ public enum FilterDataStatus: Equatable {\n   /// This may be called by filters which must parse a larger block of the incoming data before\n   /// continuing processing, and will handle their own buffering.\n   case stopIterationNoBuffer\n+\n+  /**\n+   * Resume previously-stopped iteration, possibly forwarding headers, if iteration was previously\n+   * stopped during an on*Headers invocation.\n+   *\n+   * It is an error to return `resumeIteration` if iteration is not currently stopped, and it is\n+   * an error to include headers if headers have already been forwarded to the next filter\n+   * (i.e. iteration was stopped during an on*Data invocation instead of on*Headers).\n+   */\n+  case resumeIteration(Data, withHeaders: Headers? = nil)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "95b8d9f5e4fbc7c5c19ab4009ffd4c9d9b6675e6"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzMzk4NDQ3OnYy", "diffSide": "RIGHT", "path": "library/swift/src/filters/FilterTrailersStatus.swift", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQyMTozMTowMVrOG_zlFQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQyMTozMToyOVrOG_zl0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTU1ODU0OQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              case resumeIteration(T, withHeaders: Headers? = nil, withData: Data? = nil)\n          \n          \n            \n              case resumeIteration(headers: Headers? = nil, data: Data? = nil, trailers: T)", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1029#discussion_r469558549", "createdAt": "2020-08-12T21:31:01Z", "author": {"login": "rebello95"}, "path": "library/swift/src/filters/FilterTrailersStatus.swift", "diffHunk": "@@ -9,4 +9,14 @@ public enum FilterTrailersStatus<T: Headers>: Equatable {\n   /// Calling `continueRequest()`/`continueResponse()` MUST occur when continued filter iteration\n   /// is desired.\n   case stopIteration(T)\n+\n+  /**\n+   * Resume previously-stopped iteration, possibly forwarding headers and data, if iteration was\n+   * previously stopped during an on*Headers or on*Data invocation.\n+   *\n+   * It is an error to return ResumeIteration if iteration is not currently stopped, and it is\n+   * an error to include headers if headers have already been forwarded to the next filter\n+   * (i.e. iteration was stopped during an on*Data invocation instead of on*Headers).\n+   */\n+  case resumeIteration(T, withHeaders: Headers? = nil, withData: Data? = nil)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "95b8d9f5e4fbc7c5c19ab4009ffd4c9d9b6675e6"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTU1ODczNw==", "bodyText": "This ordering matches Kotlin - I also think it's nice to name the values explicitly but don't feel too strongly", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1029#discussion_r469558737", "createdAt": "2020-08-12T21:31:29Z", "author": {"login": "rebello95"}, "path": "library/swift/src/filters/FilterTrailersStatus.swift", "diffHunk": "@@ -9,4 +9,14 @@ public enum FilterTrailersStatus<T: Headers>: Equatable {\n   /// Calling `continueRequest()`/`continueResponse()` MUST occur when continued filter iteration\n   /// is desired.\n   case stopIteration(T)\n+\n+  /**\n+   * Resume previously-stopped iteration, possibly forwarding headers and data, if iteration was\n+   * previously stopped during an on*Headers or on*Data invocation.\n+   *\n+   * It is an error to return ResumeIteration if iteration is not currently stopped, and it is\n+   * an error to include headers if headers have already been forwarded to the next filter\n+   * (i.e. iteration was stopped during an on*Data invocation instead of on*Headers).\n+   */\n+  case resumeIteration(T, withHeaders: Headers? = nil, withData: Data? = nil)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTU1ODU0OQ=="}, "originalCommit": {"oid": "95b8d9f5e4fbc7c5c19ab4009ffd4c9d9b6675e6"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzMzk4NzAyOnYy", "diffSide": "RIGHT", "path": "library/swift/src/filters/ResponseFilter.swift", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQyMTozMTo0OVrOG_zmfw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QwMToyOTo0NlrOG_414Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTU1ODkxMQ==", "bodyText": "Are we missing the FilterResumeStatus type in this PR?", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1029#discussion_r469558911", "createdAt": "2020-08-12T21:31:49Z", "author": {"login": "rebello95"}, "path": "library/swift/src/filters/ResponseFilter.swift", "diffHunk": "@@ -38,6 +38,14 @@ public protocol ResponseFilter: Filter {\n   /// - returns: The trailer status containing body with which to continue or buffer.\n   func onResponseTrailers(_ trailers: ResponseTrailers) -> FilterTrailersStatus<ResponseTrailers>\n \n+  /// Invoked explicitly in response to an asynchronous resume() callback when filter\n+  /// iteration has been stopped.\n+  /// \n+  /// @return: The resumption status including any previously held entities that remain\n+  ///          to be forwarded.\n+  /// \n+  func onResumeIteration() -> FilterResumeStatus<ResponseHeaders, ResponseTrailers>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "95b8d9f5e4fbc7c5c19ab4009ffd4c9d9b6675e6"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTY0NDc2OQ==", "bodyText": "They're coming. :)", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1029#discussion_r469644769", "createdAt": "2020-08-13T01:29:46Z", "author": {"login": "goaway"}, "path": "library/swift/src/filters/ResponseFilter.swift", "diffHunk": "@@ -38,6 +38,14 @@ public protocol ResponseFilter: Filter {\n   /// - returns: The trailer status containing body with which to continue or buffer.\n   func onResponseTrailers(_ trailers: ResponseTrailers) -> FilterTrailersStatus<ResponseTrailers>\n \n+  /// Invoked explicitly in response to an asynchronous resume() callback when filter\n+  /// iteration has been stopped.\n+  /// \n+  /// @return: The resumption status including any previously held entities that remain\n+  ///          to be forwarded.\n+  /// \n+  func onResumeIteration() -> FilterResumeStatus<ResponseHeaders, ResponseTrailers>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTU1ODkxMQ=="}, "originalCommit": {"oid": "95b8d9f5e4fbc7c5c19ab4009ffd4c9d9b6675e6"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzMzk5MzA4OnYy", "diffSide": "RIGHT", "path": "library/kotlin/src/io/envoyproxy/envoymobile/filters/ResponseFilter.kt", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQyMTozNDowNlrOG_zqWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QwMTozMDozN1rOG_42wA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTU1OTg5Nw==", "bodyText": "These functions are currently called continueRequest() / continueResponse(); I think they need to be updated in this PR on the callback types\nCan we add documentation to the callbacks indicating that this function will be called on the filter's execution thread as an immediate result of calling the callback?\nIt'd be nice to add an example use case to these descriptions. Personally I think we should be as clear/verbose as possible on these interface descriptions", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1029#discussion_r469559897", "createdAt": "2020-08-12T21:34:06Z", "author": {"login": "rebello95"}, "path": "library/kotlin/src/io/envoyproxy/envoymobile/filters/ResponseFilter.kt", "diffHunk": "@@ -50,6 +50,15 @@ interface ResponseFilter : Filter {\n    */\n   fun onResponseTrailers(trailers: ResponseTrailers): FilterTrailersStatus<ResponseTrailers>\n \n+  /**\n+   * Invoked explicitly in response to an asynchronous resume() callback when filter\n+   * iteration has been stopped.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "95b8d9f5e4fbc7c5c19ab4009ffd4c9d9b6675e6"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTY0NDk5Mg==", "bodyText": "Updated.\nSure.\nGood idea.", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1029#discussion_r469644992", "createdAt": "2020-08-13T01:30:37Z", "author": {"login": "goaway"}, "path": "library/kotlin/src/io/envoyproxy/envoymobile/filters/ResponseFilter.kt", "diffHunk": "@@ -50,6 +50,15 @@ interface ResponseFilter : Filter {\n    */\n   fun onResponseTrailers(trailers: ResponseTrailers): FilterTrailersStatus<ResponseTrailers>\n \n+  /**\n+   * Invoked explicitly in response to an asynchronous resume() callback when filter\n+   * iteration has been stopped.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTU1OTg5Nw=="}, "originalCommit": {"oid": "95b8d9f5e4fbc7c5c19ab4009ffd4c9d9b6675e6"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzODE4MDExOnYy", "diffSide": "RIGHT", "path": "library/kotlin/src/io/envoyproxy/envoymobile/AsycRequestFilter.kt", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxOTozNzoxNlrOHAazgw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQwMDoyODoyMVrOHAimgQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDIwMTIxOQ==", "bodyText": "Interface to be updated", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1029#discussion_r470201219", "createdAt": "2020-08-13T19:37:16Z", "author": {"login": "buildbreaker"}, "path": "library/kotlin/src/io/envoyproxy/envoymobile/AsycRequestFilter.kt", "diffHunk": "@@ -0,0 +1,23 @@\n+package io.envoyproxy.envoymobile\n+\n+/*\n+ * RequestFilter supporting asynchronous resumption.\n+ */\n+interface AsyncRequestFilter : RequestFilter {\n+  /**\n+   * Invoked explicitly in response to an asynchronous resumeRequest() callback when filter\n+   * iteration has been stopped.\n+   *\n+   * @return: The resumption status including any previously held entities that remain\n+   *          to be forwarded.\n+   */\n+  fun onResumeRequest(): FilterResumeStatus<RequestHeaders, RequestTrailers>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "caedca6dfd92c731635aa743cfd633ac9a3dae69"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDIyMjgwMg==", "bodyText": "What will this be updated to?", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1029#discussion_r470222802", "createdAt": "2020-08-13T20:17:11Z", "author": {"login": "rebello95"}, "path": "library/kotlin/src/io/envoyproxy/envoymobile/AsycRequestFilter.kt", "diffHunk": "@@ -0,0 +1,23 @@\n+package io.envoyproxy.envoymobile\n+\n+/*\n+ * RequestFilter supporting asynchronous resumption.\n+ */\n+interface AsyncRequestFilter : RequestFilter {\n+  /**\n+   * Invoked explicitly in response to an asynchronous resumeRequest() callback when filter\n+   * iteration has been stopped.\n+   *\n+   * @return: The resumption status including any previously held entities that remain\n+   *          to be forwarded.\n+   */\n+  fun onResumeRequest(): FilterResumeStatus<RequestHeaders, RequestTrailers>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDIwMTIxOQ=="}, "originalCommit": {"oid": "caedca6dfd92c731635aa743cfd633ac9a3dae69"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDMyODg0NA==", "bodyText": "Updated to match swift.", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1029#discussion_r470328844", "createdAt": "2020-08-14T00:28:13Z", "author": {"login": "goaway"}, "path": "library/kotlin/src/io/envoyproxy/envoymobile/AsycRequestFilter.kt", "diffHunk": "@@ -0,0 +1,23 @@\n+package io.envoyproxy.envoymobile\n+\n+/*\n+ * RequestFilter supporting asynchronous resumption.\n+ */\n+interface AsyncRequestFilter : RequestFilter {\n+  /**\n+   * Invoked explicitly in response to an asynchronous resumeRequest() callback when filter\n+   * iteration has been stopped.\n+   *\n+   * @return: The resumption status including any previously held entities that remain\n+   *          to be forwarded.\n+   */\n+  fun onResumeRequest(): FilterResumeStatus<RequestHeaders, RequestTrailers>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDIwMTIxOQ=="}, "originalCommit": {"oid": "caedca6dfd92c731635aa743cfd633ac9a3dae69"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDMyODk2MQ==", "bodyText": "(It has been.)", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1029#discussion_r470328961", "createdAt": "2020-08-14T00:28:21Z", "author": {"login": "goaway"}, "path": "library/kotlin/src/io/envoyproxy/envoymobile/AsycRequestFilter.kt", "diffHunk": "@@ -0,0 +1,23 @@\n+package io.envoyproxy.envoymobile\n+\n+/*\n+ * RequestFilter supporting asynchronous resumption.\n+ */\n+interface AsyncRequestFilter : RequestFilter {\n+  /**\n+   * Invoked explicitly in response to an asynchronous resumeRequest() callback when filter\n+   * iteration has been stopped.\n+   *\n+   * @return: The resumption status including any previously held entities that remain\n+   *          to be forwarded.\n+   */\n+  fun onResumeRequest(): FilterResumeStatus<RequestHeaders, RequestTrailers>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDIwMTIxOQ=="}, "originalCommit": {"oid": "caedca6dfd92c731635aa743cfd633ac9a3dae69"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzODE4MzA2OnYy", "diffSide": "RIGHT", "path": "library/kotlin/src/io/envoyproxy/envoymobile/AsycRequestFilter.kt", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxOTozODowMVrOHAa1MA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QyMDoxNzoxOVrOHAcIEw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDIwMTY0OA==", "bodyText": "Can we have this first", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1029#discussion_r470201648", "createdAt": "2020-08-13T19:38:01Z", "author": {"login": "buildbreaker"}, "path": "library/kotlin/src/io/envoyproxy/envoymobile/AsycRequestFilter.kt", "diffHunk": "@@ -0,0 +1,23 @@\n+package io.envoyproxy.envoymobile\n+\n+/*\n+ * RequestFilter supporting asynchronous resumption.\n+ */\n+interface AsyncRequestFilter : RequestFilter {\n+  /**\n+   * Invoked explicitly in response to an asynchronous resumeRequest() callback when filter\n+   * iteration has been stopped.\n+   *\n+   * @return: The resumption status including any previously held entities that remain\n+   *          to be forwarded.\n+   */\n+  fun onResumeRequest(): FilterResumeStatus<RequestHeaders, RequestTrailers>\n+\n+  /**\n+   * Called by the filter manager once to initialize the filter callbacks that the filter should\n+   * use.\n+   *\n+   * @param callbacks: The callbacks for this filter to use to interact with the chain.\n+   */\n+   fun setRequestFilterCallbacks(callbacks: RequestFilterCallbacks)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "caedca6dfd92c731635aa743cfd633ac9a3dae69"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDIyMjg2Nw==", "bodyText": "+1 to putting this first in the file", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1029#discussion_r470222867", "createdAt": "2020-08-13T20:17:19Z", "author": {"login": "rebello95"}, "path": "library/kotlin/src/io/envoyproxy/envoymobile/AsycRequestFilter.kt", "diffHunk": "@@ -0,0 +1,23 @@\n+package io.envoyproxy.envoymobile\n+\n+/*\n+ * RequestFilter supporting asynchronous resumption.\n+ */\n+interface AsyncRequestFilter : RequestFilter {\n+  /**\n+   * Invoked explicitly in response to an asynchronous resumeRequest() callback when filter\n+   * iteration has been stopped.\n+   *\n+   * @return: The resumption status including any previously held entities that remain\n+   *          to be forwarded.\n+   */\n+  fun onResumeRequest(): FilterResumeStatus<RequestHeaders, RequestTrailers>\n+\n+  /**\n+   * Called by the filter manager once to initialize the filter callbacks that the filter should\n+   * use.\n+   *\n+   * @param callbacks: The callbacks for this filter to use to interact with the chain.\n+   */\n+   fun setRequestFilterCallbacks(callbacks: RequestFilterCallbacks)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDIwMTY0OA=="}, "originalCommit": {"oid": "caedca6dfd92c731635aa743cfd633ac9a3dae69"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzODE4NDAzOnYy", "diffSide": "RIGHT", "path": "library/kotlin/src/io/envoyproxy/envoymobile/AsycResponseFilter.kt", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxOTozODoxNVrOHAa1uA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxOTozODoxNVrOHAa1uA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDIwMTc4NA==", "bodyText": "nit: have this first\n(same on swift)", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1029#discussion_r470201784", "createdAt": "2020-08-13T19:38:15Z", "author": {"login": "buildbreaker"}, "path": "library/kotlin/src/io/envoyproxy/envoymobile/AsycResponseFilter.kt", "diffHunk": "@@ -0,0 +1,23 @@\n+package io.envoyproxy.envoymobile\n+\n+/*\n+ * ResponseFilter supporting asynchronous resumption.\n+ */\n+interface AsyncResponseFilter : ResponseFilter {\n+  /**\n+   * Invoked explicitly in response to an asynchronous resumeResponse() callback when filter\n+   * iteration has been stopped.\n+   *\n+   * @return: The resumption status including any previously held entities that remain\n+   *          to be forwarded.\n+   */\n+  fun onResumeResponse(): FilterResumeStatus<ResponseHeaders, ResponseTrailers>\n+\n+  /**\n+   * Called by the filter manager once to initialize the filter callbacks that the filter should\n+   * use.\n+   *\n+   * @param callbacks: The callbacks for this filter to use to interact with the chain.\n+   */\n+   fun setResponseFilterCallbacks(callbacks: ResponseFilterCallbacks)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "caedca6dfd92c731635aa743cfd633ac9a3dae69"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzODE5NjA5OnYy", "diffSide": "RIGHT", "path": "library/kotlin/src/io/envoyproxy/envoymobile/filters/FilterDataStatus.kt", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxOTo0MjowNFrOHAa9FQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QyMDoxODozM1rOHAcKew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDIwMzY2OQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n               * Resume previously-stopped iteration, possibly forwarding headers, if iteration was previously\n          \n          \n            \n               * stopped during an on*Headers invocation.\n          \n          \n            \n               * Resume previously-stopped iteration, possibly forwarding headers, if iteration was previously\n          \n          \n            \n               * stopped during an on*Headers invocation. If headers are already sent, headers should not be passed in the return status.", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1029#discussion_r470203669", "createdAt": "2020-08-13T19:42:04Z", "author": {"login": "buildbreaker"}, "path": "library/kotlin/src/io/envoyproxy/envoymobile/filters/FilterDataStatus.kt", "diffHunk": "@@ -44,5 +44,15 @@ sealed class FilterDataStatus {\n    * This may be called by filters which must parse a larger block of the incoming data before\n    * continuing processing, and will handle their own buffering.\n    */\n-  class StopIterationNoBuffer : FilterDataStatus()\n+  class StopIterationNoBuffer<T : Headers> : FilterDataStatus<T>()\n+\n+  /**\n+   * Resume previously-stopped iteration, possibly forwarding headers, if iteration was previously\n+   * stopped during an on*Headers invocation.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "caedca6dfd92c731635aa743cfd633ac9a3dae69"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDIyMzQ4Mw==", "bodyText": "* stopped during an on*Headers invocation. If headers have already been sent, headers should not be passed in the return status.", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1029#discussion_r470223483", "createdAt": "2020-08-13T20:18:33Z", "author": {"login": "rebello95"}, "path": "library/kotlin/src/io/envoyproxy/envoymobile/filters/FilterDataStatus.kt", "diffHunk": "@@ -44,5 +44,15 @@ sealed class FilterDataStatus {\n    * This may be called by filters which must parse a larger block of the incoming data before\n    * continuing processing, and will handle their own buffering.\n    */\n-  class StopIterationNoBuffer : FilterDataStatus()\n+  class StopIterationNoBuffer<T : Headers> : FilterDataStatus<T>()\n+\n+  /**\n+   * Resume previously-stopped iteration, possibly forwarding headers, if iteration was previously\n+   * stopped during an on*Headers invocation.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDIwMzY2OQ=="}, "originalCommit": {"oid": "caedca6dfd92c731635aa743cfd633ac9a3dae69"}, "originalPosition": 36}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzODE5Nzc0OnYy", "diffSide": "RIGHT", "path": "library/kotlin/src/io/envoyproxy/envoymobile/filters/FilterResumeStatus.kt", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxOTo0MjozMlrOHAa-Dg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxOTo0MjozMlrOHAa-Dg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDIwMzkxOA==", "bodyText": "same as https://github.com/lyft/envoy-mobile/pull/1029/files#r470203669", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1029#discussion_r470203918", "createdAt": "2020-08-13T19:42:32Z", "author": {"login": "buildbreaker"}, "path": "library/kotlin/src/io/envoyproxy/envoymobile/filters/FilterResumeStatus.kt", "diffHunk": "@@ -0,0 +1,18 @@\n+package io.envoyproxy.envoymobile\n+\n+import java.nio.ByteBuffer\n+\n+/*\n+ * Status returned by filters when transmitting or receiving trailers.\n+ */\n+sealed class FilterResumeStatus<T : Headers, U : Headers> {\n+  /**\n+   * Resume previously-stopped iteration, possibly forwarding headers and data, if iteration was\n+   * previously stopped during an on*Headers or on*Data invocation.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "caedca6dfd92c731635aa743cfd633ac9a3dae69"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzODE5ODE5OnYy", "diffSide": "RIGHT", "path": "library/kotlin/src/io/envoyproxy/envoymobile/filters/FilterTrailersStatus.kt", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxOTo0MjozOVrOHAa-VQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxOTo0MjozOVrOHAa-VQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDIwMzk4OQ==", "bodyText": "same as https://github.com/lyft/envoy-mobile/pull/1029/files#r470203669", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1029#discussion_r470203989", "createdAt": "2020-08-13T19:42:39Z", "author": {"login": "buildbreaker"}, "path": "library/kotlin/src/io/envoyproxy/envoymobile/filters/FilterTrailersStatus.kt", "diffHunk": "@@ -1,20 +1,33 @@\n package io.envoyproxy.envoymobile\n \n+import java.nio.ByteBuffer\n+\n /*\n  * Status returned by filters when transmitting or receiving trailers.\n  */\n-// TODO: create abstract Trailers class.\n-sealed class FilterTrailersStatus<T : Headers> {\n+sealed class FilterTrailersStatus<T : Headers, U : Headers> {\n   /**\n    * Continue filter chain iteration, passing the provided trailers through.\n    */\n-  class Continue<T : Headers>(val trailers: T) : FilterTrailersStatus<T>()\n+  class Continue<T : Headers, U : Headers>(val trailers: T) : FilterTrailersStatus<T, U>()\n \n   /**\n    * Do not iterate to any of the remaining filters in the chain with trailers.\n    *\n+   * Because trailers are by definition the last HTTP entity of a request or response, only\n+   * asynchronous filters support resumption after returning StopIteration from on*Trailers.\n    * Calling `continueRequest()`/`continueResponse()` MUST occur when continued filter iteration\n    * is desired.\n    */\n-  class StopIteration<T : Headers>(val trailers: T) : FilterTrailersStatus<T>()\n+  class StopIteration<T : Headers, U : Headers> : FilterTrailersStatus<T, U>()\n+\n+  /**\n+   * Resume previously-stopped iteration, possibly forwarding headers and data, if iteration was\n+   * previously stopped during an on*Headers or on*Data invocation.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "caedca6dfd92c731635aa743cfd633ac9a3dae69"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzODIwMTI3OnYy", "diffSide": "RIGHT", "path": "library/swift/src/filters/FilterDataStatus.swift", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxOTo0MzozMVrOHAbADQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxOTo0MzozMVrOHAbADQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDIwNDQyOQ==", "bodyText": "same as https://github.com/lyft/envoy-mobile/pull/1029/files#r470203669", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1029#discussion_r470204429", "createdAt": "2020-08-13T19:43:31Z", "author": {"login": "buildbreaker"}, "path": "library/swift/src/filters/FilterDataStatus.swift", "diffHunk": "@@ -35,4 +35,14 @@ public enum FilterDataStatus: Equatable {\n   /// This may be called by filters which must parse a larger block of the incoming data before\n   /// continuing processing, and will handle their own buffering.\n   case stopIterationNoBuffer\n+\n+  /**\n+   * Resume previously-stopped iteration, possibly forwarding headers, if iteration was previously\n+   * stopped during an on*Headers invocation.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "caedca6dfd92c731635aa743cfd633ac9a3dae69"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzODIwMTcwOnYy", "diffSide": "RIGHT", "path": "library/swift/src/filters/FilterResumeStatus.swift", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxOTo0MzozNlrOHAbAQA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxOTo0MzozNlrOHAbAQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDIwNDQ4MA==", "bodyText": "same as https://github.com/lyft/envoy-mobile/pull/1029/files#r470203669", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1029#discussion_r470204480", "createdAt": "2020-08-13T19:43:36Z", "author": {"login": "buildbreaker"}, "path": "library/swift/src/filters/FilterResumeStatus.swift", "diffHunk": "@@ -0,0 +1,15 @@\n+import Foundation\n+\n+/// Status returned by filters after resuming iteration asynchronously.\n+@frozen\n+public enum FilterResumeStatus<T: Headers, U: Headers>: Equatable {\n+  /**\n+   * Resume previously-stopped iteration, possibly forwarding headers and data, if iteration was\n+   * previously stopped during an on*Headers or on*Data invocation.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "caedca6dfd92c731635aa743cfd633ac9a3dae69"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzODMzNjI1OnYy", "diffSide": "RIGHT", "path": "library/kotlin/src/io/envoyproxy/envoymobile/filters/FilterTrailersStatus.kt", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QyMDoyMTowMlrOHAcPvA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QyMzoxMjo1OVrOHAgumQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDIyNDgyOA==", "bodyText": "Shouldn't this be val trailers: U?", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1029#discussion_r470224828", "createdAt": "2020-08-13T20:21:02Z", "author": {"login": "rebello95"}, "path": "library/kotlin/src/io/envoyproxy/envoymobile/filters/FilterTrailersStatus.kt", "diffHunk": "@@ -1,20 +1,33 @@\n package io.envoyproxy.envoymobile\n \n+import java.nio.ByteBuffer\n+\n /*\n  * Status returned by filters when transmitting or receiving trailers.\n  */\n-// TODO: create abstract Trailers class.\n-sealed class FilterTrailersStatus<T : Headers> {\n+sealed class FilterTrailersStatus<T : Headers, U : Headers> {\n   /**\n    * Continue filter chain iteration, passing the provided trailers through.\n    */\n-  class Continue<T : Headers>(val trailers: T) : FilterTrailersStatus<T>()\n+  class Continue<T : Headers, U : Headers>(val trailers: T) : FilterTrailersStatus<T, U>()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "caedca6dfd92c731635aa743cfd633ac9a3dae69"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDI5ODI2NQ==", "bodyText": "yes, good catch, thank you", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1029#discussion_r470298265", "createdAt": "2020-08-13T23:12:59Z", "author": {"login": "goaway"}, "path": "library/kotlin/src/io/envoyproxy/envoymobile/filters/FilterTrailersStatus.kt", "diffHunk": "@@ -1,20 +1,33 @@\n package io.envoyproxy.envoymobile\n \n+import java.nio.ByteBuffer\n+\n /*\n  * Status returned by filters when transmitting or receiving trailers.\n  */\n-// TODO: create abstract Trailers class.\n-sealed class FilterTrailersStatus<T : Headers> {\n+sealed class FilterTrailersStatus<T : Headers, U : Headers> {\n   /**\n    * Continue filter chain iteration, passing the provided trailers through.\n    */\n-  class Continue<T : Headers>(val trailers: T) : FilterTrailersStatus<T>()\n+  class Continue<T : Headers, U : Headers>(val trailers: T) : FilterTrailersStatus<T, U>()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDIyNDgyOA=="}, "originalCommit": {"oid": "caedca6dfd92c731635aa743cfd633ac9a3dae69"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzODM0Mzg0OnYy", "diffSide": "RIGHT", "path": "library/kotlin/src/io/envoyproxy/envoymobile/filters/FilterDataStatus.kt", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QyMDoyMzoyNVrOHAcUfw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQwMDo1MTo0N1rOHAjhfg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDIyNjA0Nw==", "bodyText": "I think it's worth including details as to why trailers are not specified here, similarly to how you have in the StopIteration case definition", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1029#discussion_r470226047", "createdAt": "2020-08-13T20:23:25Z", "author": {"login": "rebello95"}, "path": "library/kotlin/src/io/envoyproxy/envoymobile/filters/FilterDataStatus.kt", "diffHunk": "@@ -44,5 +44,15 @@ sealed class FilterDataStatus {\n    * This may be called by filters which must parse a larger block of the incoming data before\n    * continuing processing, and will handle their own buffering.\n    */\n-  class StopIterationNoBuffer : FilterDataStatus()\n+  class StopIterationNoBuffer<T : Headers> : FilterDataStatus<T>()\n+\n+  /**\n+   * Resume previously-stopped iteration, possibly forwarding headers, if iteration was previously\n+   * stopped during an on*Headers invocation.\n+   *\n+   * It is an error to return ResumeIteration if iteration is not currently stopped, and it is\n+   * an error to include headers if headers have already been forwarded to the next filter\n+   * (i.e. iteration was stopped during an on*Data invocation instead of on*Headers).\n+   */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "caedca6dfd92c731635aa743cfd633ac9a3dae69"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDM0NDA2Mg==", "bodyText": "I'm a little bit concerned that describing an option that's not present might be more confusing than simply describing those that are.", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1029#discussion_r470344062", "createdAt": "2020-08-14T00:51:47Z", "author": {"login": "goaway"}, "path": "library/kotlin/src/io/envoyproxy/envoymobile/filters/FilterDataStatus.kt", "diffHunk": "@@ -44,5 +44,15 @@ sealed class FilterDataStatus {\n    * This may be called by filters which must parse a larger block of the incoming data before\n    * continuing processing, and will handle their own buffering.\n    */\n-  class StopIterationNoBuffer : FilterDataStatus()\n+  class StopIterationNoBuffer<T : Headers> : FilterDataStatus<T>()\n+\n+  /**\n+   * Resume previously-stopped iteration, possibly forwarding headers, if iteration was previously\n+   * stopped during an on*Headers invocation.\n+   *\n+   * It is an error to return ResumeIteration if iteration is not currently stopped, and it is\n+   * an error to include headers if headers have already been forwarded to the next filter\n+   * (i.e. iteration was stopped during an on*Data invocation instead of on*Headers).\n+   */", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDIyNjA0Nw=="}, "originalCommit": {"oid": "caedca6dfd92c731635aa743cfd633ac9a3dae69"}, "originalPosition": 41}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzODM0NzU3OnYy", "diffSide": "RIGHT", "path": "library/swift/src/filters/AsyncRequestFilter.swift", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QyMDoyNDozMVrOHAcWxg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QyMDoyNDozMVrOHAcWxg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDIyNjYzMA==", "bodyText": "Same suggestion as @buildbreaker above regarding listing this first", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1029#discussion_r470226630", "createdAt": "2020-08-13T20:24:31Z", "author": {"login": "rebello95"}, "path": "library/swift/src/filters/AsyncRequestFilter.swift", "diffHunk": "@@ -0,0 +1,22 @@\n+import Foundation\n+\n+/// RequestFilter supporting asynchronous resumption.\n+public protocol AsyncRequestFilter: RequestFilter {\n+  /// Invoked explicitly in response to an asynchronous resumeRequest() callback when filter\n+  /// iteration has been stopped. The parameters passed to this invocation will be a snapshot\n+  /// of any stream state that has not yet been forwarded along the filter chain.\n+  ///\n+  /// - return: The resumption status including any HTTP entities that will be forwarded.\n+  func onResumeRequest(\n+    headers: RequestHeaders?,\n+    data: Data?,\n+    trailers: RequestTrailers?,\n+    endStream: Bool\n+  ) -> FilterResumeStatus<RequestHeaders, RequestTrailers>\n+\n+  /// Called by the filter manager once to initialize the filter callbacks that the filter should\n+  /// use.\n+  ///\n+  /// - parameter callbacks: The callbacks for this filter to use to interact with the chain.\n+  func setRequestFilterCallbacks(_ callbacks: RequestFilterCallbacks)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "caedca6dfd92c731635aa743cfd633ac9a3dae69"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzODM0OTg2OnYy", "diffSide": "RIGHT", "path": "library/swift/src/filters/AsyncResponseFilter.swift", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QyMDoyNToxNVrOHAcYUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QyMDoyNToxNVrOHAcYUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDIyNzAyNg==", "bodyText": "Same comments in this file", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1029#discussion_r470227026", "createdAt": "2020-08-13T20:25:15Z", "author": {"login": "rebello95"}, "path": "library/swift/src/filters/AsyncResponseFilter.swift", "diffHunk": "@@ -0,0 +1,21 @@\n+import Foundation\n+\n+/// ResponseFilter supporting asynchronous resumption.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "caedca6dfd92c731635aa743cfd633ac9a3dae69"}, "originalPosition": 3}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzODM1Mjg5OnYy", "diffSide": "RIGHT", "path": "library/swift/src/filters/AsyncRequestFilter.swift", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QyMDoyNjowOFrOHAcaTw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QyMDoyNjoyOVrOHAcbIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDIyNzUzNQ==", "bodyText": "When will endStream be true? Will it be true if either there's a data frame with endStream=true or trailers?", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1029#discussion_r470227535", "createdAt": "2020-08-13T20:26:08Z", "author": {"login": "rebello95"}, "path": "library/swift/src/filters/AsyncRequestFilter.swift", "diffHunk": "@@ -0,0 +1,22 @@\n+import Foundation\n+\n+/// RequestFilter supporting asynchronous resumption.\n+public protocol AsyncRequestFilter: RequestFilter {\n+  /// Invoked explicitly in response to an asynchronous resumeRequest() callback when filter\n+  /// iteration has been stopped. The parameters passed to this invocation will be a snapshot\n+  /// of any stream state that has not yet been forwarded along the filter chain.\n+  ///\n+  /// - return: The resumption status including any HTTP entities that will be forwarded.\n+  func onResumeRequest(\n+    headers: RequestHeaders?,\n+    data: Data?,\n+    trailers: RequestTrailers?,\n+    endStream: Bool", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "caedca6dfd92c731635aa743cfd633ac9a3dae69"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDIyNzc0NA==", "bodyText": "I think it's worth adding - parameter docs for each of these (same with the response filter) to clarify these points", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1029#discussion_r470227744", "createdAt": "2020-08-13T20:26:29Z", "author": {"login": "rebello95"}, "path": "library/swift/src/filters/AsyncRequestFilter.swift", "diffHunk": "@@ -0,0 +1,22 @@\n+import Foundation\n+\n+/// RequestFilter supporting asynchronous resumption.\n+public protocol AsyncRequestFilter: RequestFilter {\n+  /// Invoked explicitly in response to an asynchronous resumeRequest() callback when filter\n+  /// iteration has been stopped. The parameters passed to this invocation will be a snapshot\n+  /// of any stream state that has not yet been forwarded along the filter chain.\n+  ///\n+  /// - return: The resumption status including any HTTP entities that will be forwarded.\n+  func onResumeRequest(\n+    headers: RequestHeaders?,\n+    data: Data?,\n+    trailers: RequestTrailers?,\n+    endStream: Bool", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDIyNzUzNQ=="}, "originalCommit": {"oid": "caedca6dfd92c731635aa743cfd633ac9a3dae69"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzODQ0NTAyOnYy", "diffSide": "RIGHT", "path": "library/swift/src/filters/AsyncRequestFilter.swift", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QyMDo1MjowN1rOHAdQdQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QyMzo1NDoyOFrOHAheAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDI0MTM5Nw==", "bodyText": "Thinking about how users will consume this, I think they'll likely end up force-unwrapping the values they called resume with, which might be a little unwieldy. However, I suppose we can't really make these non-optional since resumeRequest() can be called after headers or data, in which case data will sometimes be nil. Probably nothing actionable here, just thinking out loud (though it might be good to list some examples in docs here)", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1029#discussion_r470241397", "createdAt": "2020-08-13T20:52:07Z", "author": {"login": "rebello95"}, "path": "library/swift/src/filters/AsyncRequestFilter.swift", "diffHunk": "@@ -0,0 +1,22 @@\n+import Foundation\n+\n+/// RequestFilter supporting asynchronous resumption.\n+public protocol AsyncRequestFilter: RequestFilter {\n+  /// Invoked explicitly in response to an asynchronous resumeRequest() callback when filter\n+  /// iteration has been stopped. The parameters passed to this invocation will be a snapshot\n+  /// of any stream state that has not yet been forwarded along the filter chain.\n+  ///\n+  /// - return: The resumption status including any HTTP entities that will be forwarded.\n+  func onResumeRequest(\n+    headers: RequestHeaders?,\n+    data: Data?,\n+    trailers: RequestTrailers?,\n+    endStream: Bool\n+  ) -> FilterResumeStatus<RequestHeaders, RequestTrailers>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "caedca6dfd92c731635aa743cfd633ac9a3dae69"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDMxMDQwMg==", "bodyText": "I've been thinking about this too, but short of having multiple different onResume invocations with overloaded signatures based on what's present, and their own specific return types, I can't see another way of supporting the different states. (Multiple onResumes would probably be annoying to implement also.)", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1029#discussion_r470310402", "createdAt": "2020-08-13T23:54:28Z", "author": {"login": "goaway"}, "path": "library/swift/src/filters/AsyncRequestFilter.swift", "diffHunk": "@@ -0,0 +1,22 @@\n+import Foundation\n+\n+/// RequestFilter supporting asynchronous resumption.\n+public protocol AsyncRequestFilter: RequestFilter {\n+  /// Invoked explicitly in response to an asynchronous resumeRequest() callback when filter\n+  /// iteration has been stopped. The parameters passed to this invocation will be a snapshot\n+  /// of any stream state that has not yet been forwarded along the filter chain.\n+  ///\n+  /// - return: The resumption status including any HTTP entities that will be forwarded.\n+  func onResumeRequest(\n+    headers: RequestHeaders?,\n+    data: Data?,\n+    trailers: RequestTrailers?,\n+    endStream: Bool\n+  ) -> FilterResumeStatus<RequestHeaders, RequestTrailers>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDI0MTM5Nw=="}, "originalCommit": {"oid": "caedca6dfd92c731635aa743cfd633ac9a3dae69"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzODQ1NTE0OnYy", "diffSide": "RIGHT", "path": "library/swift/src/filters/AsyncResponseFilter.swift", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QyMDo1NDo1NVrOHAdWXw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QyMDo1NDo1NVrOHAdWXw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDI0MjkxMQ==", "bodyText": "Same here", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1029#discussion_r470242911", "createdAt": "2020-08-13T20:54:55Z", "author": {"login": "rebello95"}, "path": "library/swift/src/filters/AsyncResponseFilter.swift", "diffHunk": "@@ -0,0 +1,21 @@\n+import Foundation\n+\n+/// ResponseFilter supporting asynchronous resumption.\n+public protocol AsyncResponseFilter: ResponseFilter {\n+  /// Invoked explicitly in response to an asynchronous resumeResponse() callback when filter\n+  /// iteration has been stopped.\n+  ///\n+  /// - return: The resumption status including any HTTP entities that will be forwarded.\n+  func onResumeResponse(\n+    headers: ResponseHeaders?,\n+    data: Data?,\n+    trailers: ResponseTrailers?,\n+    endStream: Bool", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "caedca6dfd92c731635aa743cfd633ac9a3dae69"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkzODQ2MTMzOnYy", "diffSide": "RIGHT", "path": "library/swift/src/filters/FilterHeadersStatus.swift", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QyMDo1Njo0N1rOHAdZ_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QyMDo1Njo0N1rOHAdZ_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDI0MzgzOA==", "bodyText": "These docstrings are outdated (can you grep for any references to these functions and update please?)", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1029#discussion_r470243838", "createdAt": "2020-08-13T20:56:47Z", "author": {"login": "rebello95"}, "path": "library/swift/src/filters/FilterHeadersStatus.swift", "diffHunk": "@@ -9,5 +9,5 @@ public enum FilterHeadersStatus<T: Headers>: Equatable {\n   /// Returning `continue` from `onRequestData()`/`onResponseData()` or calling\n   /// `continueRequest()`/`continueResponse()` MUST occur when continued filter iteration is", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "caedca6dfd92c731635aa743cfd633ac9a3dae69"}, "originalPosition": 2}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0MTc0NjY1OnYy", "diffSide": "RIGHT", "path": "library/kotlin/src/io/envoyproxy/envoymobile/AsyncRequestFilter.kt", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxNzowODoxMlrOHA8MzQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxNzowODoxMlrOHA8MzQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDc0ODM2NQ==", "bodyText": "\ud83d\udc4f", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1029#discussion_r470748365", "createdAt": "2020-08-14T17:08:12Z", "author": {"login": "rebello95"}, "path": "library/kotlin/src/io/envoyproxy/envoymobile/AsyncRequestFilter.kt", "diffHunk": "@@ -0,0 +1,36 @@\n+package io.envoyproxy.envoymobile\n+\n+/*\n+ * RequestFilter supporting asynchronous resumption.\n+ */\n+interface AsyncRequestFilter : RequestFilter {\n+  /**\n+   * Called by the filter manager once to initialize the filter callbacks that the filter should\n+   * use.\n+   *\n+   * @param callbacks: The callbacks for this filter to use to interact with the chain.\n+   */\n+  fun setRequestFilterCallbacks(callbacks: RequestFilterCallbacks)\n+\n+  /**\n+   * Invoked explicitly in response to an asynchronous resumeRequest() callback when filter\n+   * iteration has been stopped. The parameters passed to this invocation will be a snapshot\n+   * of any stream state that has not yet been forwarded along the filter chain.\n+   *\n+   * As with other filter invocations, this will be called on Envoy's main thread, and thus\n+   * no additional synchronization is required between this and other invocations.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b3ff051216c634865382e6744e850f5dc7c1592"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0MTc1NTg0OnYy", "diffSide": "RIGHT", "path": "library/kotlin/src/io/envoyproxy/envoymobile/AsyncRequestFilter.kt", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxNzoxMTowNlrOHA8SgA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQyMDoyNzoyM1rOHBCarg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDc0OTgyNA==", "bodyText": "Got it, so this will be true for trailers or data, endStream: true \ud83d\udc4d", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1029#discussion_r470749824", "createdAt": "2020-08-14T17:11:06Z", "author": {"login": "rebello95"}, "path": "library/kotlin/src/io/envoyproxy/envoymobile/AsyncRequestFilter.kt", "diffHunk": "@@ -0,0 +1,36 @@\n+package io.envoyproxy.envoymobile\n+\n+/*\n+ * RequestFilter supporting asynchronous resumption.\n+ */\n+interface AsyncRequestFilter : RequestFilter {\n+  /**\n+   * Called by the filter manager once to initialize the filter callbacks that the filter should\n+   * use.\n+   *\n+   * @param callbacks: The callbacks for this filter to use to interact with the chain.\n+   */\n+  fun setRequestFilterCallbacks(callbacks: RequestFilterCallbacks)\n+\n+  /**\n+   * Invoked explicitly in response to an asynchronous resumeRequest() callback when filter\n+   * iteration has been stopped. The parameters passed to this invocation will be a snapshot\n+   * of any stream state that has not yet been forwarded along the filter chain.\n+   *\n+   * As with other filter invocations, this will be called on Envoy's main thread, and thus\n+   * no additional synchronization is required between this and other invocations.\n+   *\n+   * @param headers: Headers, if `StopIteration` was returned from `onRequestHeaders`.\n+   * @param data: Any data that has been buffered where `StopIterationAndBuffer` was returned.\n+   * @param trailers: Trailers, if `StopIteration` was returned from `onRequestTrailers`.\n+   * @param endStream: True, if the stream ended with the previous (and thus, last) invocation.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b3ff051216c634865382e6744e850f5dc7c1592"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDg1MDIyMg==", "bodyText": "Correct, in fact any of:\nonHeaders(... endStream: true)\nonData(... endStream: true)\nonTrailers(...)", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1029#discussion_r470850222", "createdAt": "2020-08-14T20:27:23Z", "author": {"login": "goaway"}, "path": "library/kotlin/src/io/envoyproxy/envoymobile/AsyncRequestFilter.kt", "diffHunk": "@@ -0,0 +1,36 @@\n+package io.envoyproxy.envoymobile\n+\n+/*\n+ * RequestFilter supporting asynchronous resumption.\n+ */\n+interface AsyncRequestFilter : RequestFilter {\n+  /**\n+   * Called by the filter manager once to initialize the filter callbacks that the filter should\n+   * use.\n+   *\n+   * @param callbacks: The callbacks for this filter to use to interact with the chain.\n+   */\n+  fun setRequestFilterCallbacks(callbacks: RequestFilterCallbacks)\n+\n+  /**\n+   * Invoked explicitly in response to an asynchronous resumeRequest() callback when filter\n+   * iteration has been stopped. The parameters passed to this invocation will be a snapshot\n+   * of any stream state that has not yet been forwarded along the filter chain.\n+   *\n+   * As with other filter invocations, this will be called on Envoy's main thread, and thus\n+   * no additional synchronization is required between this and other invocations.\n+   *\n+   * @param headers: Headers, if `StopIteration` was returned from `onRequestHeaders`.\n+   * @param data: Any data that has been buffered where `StopIterationAndBuffer` was returned.\n+   * @param trailers: Trailers, if `StopIteration` was returned from `onRequestTrailers`.\n+   * @param endStream: True, if the stream ended with the previous (and thus, last) invocation.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDc0OTgyNA=="}, "originalCommit": {"oid": "1b3ff051216c634865382e6744e850f5dc7c1592"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0MTc1NjEzOnYy", "diffSide": "RIGHT", "path": "library/kotlin/src/io/envoyproxy/envoymobile/AsyncRequestFilter.kt", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxNzoxMToxMlrOHA8Ssw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQyMDoyODowM1rOHBCbrg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDc0OTg3NQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                trailrs: RequestTrailers?,\n          \n          \n            \n                trailers: RequestTrailers?,", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1029#discussion_r470749875", "createdAt": "2020-08-14T17:11:12Z", "author": {"login": "rebello95"}, "path": "library/kotlin/src/io/envoyproxy/envoymobile/AsyncRequestFilter.kt", "diffHunk": "@@ -0,0 +1,36 @@\n+package io.envoyproxy.envoymobile\n+\n+/*\n+ * RequestFilter supporting asynchronous resumption.\n+ */\n+interface AsyncRequestFilter : RequestFilter {\n+  /**\n+   * Called by the filter manager once to initialize the filter callbacks that the filter should\n+   * use.\n+   *\n+   * @param callbacks: The callbacks for this filter to use to interact with the chain.\n+   */\n+  fun setRequestFilterCallbacks(callbacks: RequestFilterCallbacks)\n+\n+  /**\n+   * Invoked explicitly in response to an asynchronous resumeRequest() callback when filter\n+   * iteration has been stopped. The parameters passed to this invocation will be a snapshot\n+   * of any stream state that has not yet been forwarded along the filter chain.\n+   *\n+   * As with other filter invocations, this will be called on Envoy's main thread, and thus\n+   * no additional synchronization is required between this and other invocations.\n+   *\n+   * @param headers: Headers, if `StopIteration` was returned from `onRequestHeaders`.\n+   * @param data: Any data that has been buffered where `StopIterationAndBuffer` was returned.\n+   * @param trailers: Trailers, if `StopIteration` was returned from `onRequestTrailers`.\n+   * @param endStream: True, if the stream ended with the previous (and thus, last) invocation.\n+   *\n+   * @return: The resumption status including any HTTP entities that will be forwarded.\n+   */\n+  fun onResumeRequest(\n+    headers: RequestHeaders?,\n+    data: ByteBuffer?,\n+    trailrs: RequestTrailers?,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b3ff051216c634865382e6744e850f5dc7c1592"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDg1MDQ3OA==", "bodyText": "nice, thanks", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1029#discussion_r470850478", "createdAt": "2020-08-14T20:28:03Z", "author": {"login": "goaway"}, "path": "library/kotlin/src/io/envoyproxy/envoymobile/AsyncRequestFilter.kt", "diffHunk": "@@ -0,0 +1,36 @@\n+package io.envoyproxy.envoymobile\n+\n+/*\n+ * RequestFilter supporting asynchronous resumption.\n+ */\n+interface AsyncRequestFilter : RequestFilter {\n+  /**\n+   * Called by the filter manager once to initialize the filter callbacks that the filter should\n+   * use.\n+   *\n+   * @param callbacks: The callbacks for this filter to use to interact with the chain.\n+   */\n+  fun setRequestFilterCallbacks(callbacks: RequestFilterCallbacks)\n+\n+  /**\n+   * Invoked explicitly in response to an asynchronous resumeRequest() callback when filter\n+   * iteration has been stopped. The parameters passed to this invocation will be a snapshot\n+   * of any stream state that has not yet been forwarded along the filter chain.\n+   *\n+   * As with other filter invocations, this will be called on Envoy's main thread, and thus\n+   * no additional synchronization is required between this and other invocations.\n+   *\n+   * @param headers: Headers, if `StopIteration` was returned from `onRequestHeaders`.\n+   * @param data: Any data that has been buffered where `StopIterationAndBuffer` was returned.\n+   * @param trailers: Trailers, if `StopIteration` was returned from `onRequestTrailers`.\n+   * @param endStream: True, if the stream ended with the previous (and thus, last) invocation.\n+   *\n+   * @return: The resumption status including any HTTP entities that will be forwarded.\n+   */\n+  fun onResumeRequest(\n+    headers: RequestHeaders?,\n+    data: ByteBuffer?,\n+    trailrs: RequestTrailers?,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDc0OTg3NQ=="}, "originalCommit": {"oid": "1b3ff051216c634865382e6744e850f5dc7c1592"}, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0MTc1Njk2OnYy", "diffSide": "RIGHT", "path": "library/kotlin/src/io/envoyproxy/envoymobile/AsyncResponseFilter.kt", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxNzoxMTozMlrOHA8TQw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxNzoxMTozMlrOHA8TQw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDc1MDAxOQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                trailrs: ResponseTrailers?,\n          \n          \n            \n                trailers: ResponseTrailers?,", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1029#discussion_r470750019", "createdAt": "2020-08-14T17:11:32Z", "author": {"login": "rebello95"}, "path": "library/kotlin/src/io/envoyproxy/envoymobile/AsyncResponseFilter.kt", "diffHunk": "@@ -0,0 +1,36 @@\n+package io.envoyproxy.envoymobile\n+\n+/*\n+ * ResponseFilter supporting asynchronous resumption.\n+ */\n+interface AsyncResponseFilter : ResponseFilter {\n+  /**\n+   * Called by the filter manager once to initialize the filter callbacks that the filter should\n+   * use.\n+   *\n+   * @param callbacks: The callbacks for this filter to use to interact with the chain.\n+   */\n+  fun setResponseFilterCallbacks(callbacks: ResponseFilterCallbacks)\n+\n+  /**\n+   * Invoked explicitly in response to an asynchronous resumeResponse() callback when filter\n+   * iteration has been stopped. The parameters passed to this invocation will be a snapshot\n+   * of any stream state that has not yet been forwarded along the filter chain.\n+   *\n+   * As with other filter invocations, this will be called on Envoy's main thread, and thus\n+   * no additional synchronization is required between this and other invocations.\n+   *\n+   * @param headers: Headers, if `StopIteration` was returned from `onResponseHeaders`.\n+   * @param data: Any data that has been buffered where `StopIterationAndBuffer` was returned.\n+   * @param trailers: Trailers, if `StopIteration` was returned from `onReponseTrailers`.\n+   * @param endStream: True, if the stream ended with the previous (and thus, last) invocation.\n+   *\n+   * @return: The resumption status including any HTTP entities that will be forwarded.\n+   */\n+  fun onResumeResponse(\n+    headers: ResponseHeaders?,\n+    data: ByteBuffer?,\n+    trailrs: ResponseTrailers?,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b3ff051216c634865382e6744e850f5dc7c1592"}, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0MTc1OTgzOnYy", "diffSide": "RIGHT", "path": "library/kotlin/src/io/envoyproxy/envoymobile/filters/FilterDataStatus.kt", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxNzoxMjozMFrOHA8VKA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNVQwMDoyNzo1MlrOHBGULQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDc1MDUwNA==", "bodyText": "Might be worth resolving this while we're here, can also do separately", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1029#discussion_r470750504", "createdAt": "2020-08-14T17:12:30Z", "author": {"login": "rebello95"}, "path": "library/kotlin/src/io/envoyproxy/envoymobile/filters/FilterDataStatus.kt", "diffHunk": "@@ -14,7 +14,7 @@ sealed class FilterDataStatus {\n    * before the entirety is sent to the next filter.\n    * TODO: add param docs. name param in swift.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b3ff051216c634865382e6744e850f5dc7c1592"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDkxNDA5Mw==", "bodyText": "\ud83d\udc4d", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1029#discussion_r470914093", "createdAt": "2020-08-15T00:27:52Z", "author": {"login": "goaway"}, "path": "library/kotlin/src/io/envoyproxy/envoymobile/filters/FilterDataStatus.kt", "diffHunk": "@@ -14,7 +14,7 @@ sealed class FilterDataStatus {\n    * before the entirety is sent to the next filter.\n    * TODO: add param docs. name param in swift.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDc1MDUwNA=="}, "originalCommit": {"oid": "1b3ff051216c634865382e6744e850f5dc7c1592"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0MTc2MTEzOnYy", "diffSide": "RIGHT", "path": "library/kotlin/src/io/envoyproxy/envoymobile/filters/FilterDataStatus.kt", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxNzoxMjo1MVrOHA8V8Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxNzoxMjo1MVrOHA8V8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDc1MDcwNQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n               * Returning `Continue` or `ResumeIteration from another filter invocation or calling\n          \n          \n            \n               * Returning `Continue` or `ResumeIteration` from another filter invocation or calling", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1029#discussion_r470750705", "createdAt": "2020-08-14T17:12:51Z", "author": {"login": "rebello95"}, "path": "library/kotlin/src/io/envoyproxy/envoymobile/filters/FilterDataStatus.kt", "diffHunk": "@@ -29,20 +29,30 @@ sealed class FilterDataStatus {\n    * This should be called by filters which must parse a larger block of the incoming data before\n    * continuing processing.\n    */\n-  class StopIterationAndBuffer(val data: ByteBuffer) : FilterDataStatus()\n+  class StopIterationAndBuffer<T : Headers> : FilterDataStatus<T>()\n \n   /**\n    * Do not iterate to any of the remaining filters in the chain, and do not internally buffer\n    * data.\n    *\n    * This filter will continue to be called with new chunks of data.\n    *\n-   * Returning `Continue` from `onRequestData()`/`onResponseData()` or calling\n-   * `continueRequest()`/`continueResponse()` MUST be called when continued filter iteration is\n+   * Returning `Continue` or `ResumeIteration from another filter invocation or calling", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b3ff051216c634865382e6744e850f5dc7c1592"}, "originalPosition": 36}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0MTc2MjI1OnYy", "diffSide": "RIGHT", "path": "library/kotlin/src/io/envoyproxy/envoymobile/filters/FilterDataStatus.kt", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxNzoxMzoxMFrOHA8WpA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxNzoxMzoxMFrOHA8WpA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDc1MDg4NA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n               * `resumeRequest()`/`resumeResponse()` MUST be called when continued filter iteration is\n          \n          \n            \n               * `resumeRequest()`/`resumeResponse()` MUST occur when continued filter iteration is", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1029#discussion_r470750884", "createdAt": "2020-08-14T17:13:10Z", "author": {"login": "rebello95"}, "path": "library/kotlin/src/io/envoyproxy/envoymobile/filters/FilterDataStatus.kt", "diffHunk": "@@ -29,20 +29,30 @@ sealed class FilterDataStatus {\n    * This should be called by filters which must parse a larger block of the incoming data before\n    * continuing processing.\n    */\n-  class StopIterationAndBuffer(val data: ByteBuffer) : FilterDataStatus()\n+  class StopIterationAndBuffer<T : Headers> : FilterDataStatus<T>()\n \n   /**\n    * Do not iterate to any of the remaining filters in the chain, and do not internally buffer\n    * data.\n    *\n    * This filter will continue to be called with new chunks of data.\n    *\n-   * Returning `Continue` from `onRequestData()`/`onResponseData()` or calling\n-   * `continueRequest()`/`continueResponse()` MUST be called when continued filter iteration is\n+   * Returning `Continue` or `ResumeIteration from another filter invocation or calling\n+   * `resumeRequest()`/`resumeResponse()` MUST be called when continued filter iteration is", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b3ff051216c634865382e6744e850f5dc7c1592"}, "originalPosition": 37}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0MTc2NDc3OnYy", "diffSide": "RIGHT", "path": "library/kotlin/src/io/envoyproxy/envoymobile/filters/FilterHeadersStatus.kt", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxNzoxMzo1M1rOHA8YJA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxNzoxMzo1M1rOHA8YJA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDc1MTI2OA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n               * Returning `Continue` or `ResumeIteration from another filter invocation or calling\n          \n          \n            \n               * Returning `Continue` or `ResumeIteration` from another filter invocation or calling", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1029#discussion_r470751268", "createdAt": "2020-08-14T17:13:53Z", "author": {"login": "rebello95"}, "path": "library/kotlin/src/io/envoyproxy/envoymobile/filters/FilterHeadersStatus.kt", "diffHunk": "@@ -12,9 +12,9 @@ sealed class FilterHeadersStatus<T : Headers> {\n   /**\n    * Do not iterate to any of the remaining filters in the chain with headers.\n    *\n-   * Returning `continue` from `onRequestData()`/`onResponseData()` or calling\n-   * `continueRequest()`/`continueResponse()` MUST occur when continued filter iteration is\n+   * Returning `Continue` or `ResumeIteration from another filter invocation or calling", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b3ff051216c634865382e6744e850f5dc7c1592"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0MTc2NzM0OnYy", "diffSide": "RIGHT", "path": "library/kotlin/src/io/envoyproxy/envoymobile/filters/FilterResumeStatus.kt", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxNzoxNDo0MFrOHA8ZvQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxNzoxNDo0MFrOHA8ZvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDc1MTY3Nw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n               * an error to include data or trailers if endStream was previously sent or if trailers have\n          \n          \n            \n               * an error to include data or trailers if endStream=true was previously sent or if trailers have", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1029#discussion_r470751677", "createdAt": "2020-08-14T17:14:40Z", "author": {"login": "rebello95"}, "path": "library/kotlin/src/io/envoyproxy/envoymobile/filters/FilterResumeStatus.kt", "diffHunk": "@@ -0,0 +1,24 @@\n+package io.envoyproxy.envoymobile\n+\n+import java.nio.ByteBuffer\n+\n+/*\n+ * Status to be returned by filters after resuming iteration asynchronously.\n+ */\n+sealed class FilterResumeStatus<T : Headers, U : Headers> {\n+  /**\n+   * Resume previously-stopped iteration, potentially forwarding headers, data, and/or trailers\n+   * that have not yet been passed along the filter chain.\n+   *\n+   * It is an error to return ResumeIteration if iteration is not currently stopped, and it is\n+   * an error to include headers if headers have already been forwarded to the next filter\n+   * (i.e. iteration was stopped during an on*Data invocation instead of on*Headers). It is also\n+   * an error to include data or trailers if endStream was previously sent or if trailers have", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b3ff051216c634865382e6744e850f5dc7c1592"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0MTc3NDYxOnYy", "diffSide": "RIGHT", "path": "library/swift/src/filters/FilterDataStatus.swift", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxNzoxNjo0NVrOHA8eGw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxNzoxNjo0NVrOHA8eGw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDc1Mjc5NQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              /// Returning `continue` or `resumeIteration from another filter invocation or calling\n          \n          \n            \n              /// Returning `continue` or `resumeIteration` from another filter invocation or calling", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1029#discussion_r470752795", "createdAt": "2020-08-14T17:16:45Z", "author": {"login": "rebello95"}, "path": "library/swift/src/filters/FilterDataStatus.swift", "diffHunk": "@@ -15,13 +15,13 @@ public enum FilterDataStatus: Equatable {\n   ///\n   /// This filter will continue to be called with new chunks of data.\n   ///\n-  /// Returning `continue` from `onRequestData()`/`onResponseData()` or calling\n-  /// `continueRequest()`/`continueResponse()` MUST be called when continued filter iteration is\n+  /// Returning `continue` or `resumeIteration from another filter invocation or calling", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b3ff051216c634865382e6744e850f5dc7c1592"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0MTc3NDk4OnYy", "diffSide": "RIGHT", "path": "library/swift/src/filters/FilterDataStatus.swift", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxNzoxNjo1M1rOHA8eWA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNVQwMDoyMzo0MlrOHBGRsA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDc1Mjg1Ng==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              /// `resumeRequest()`/`resumeResponse()` MUST be called when continued filter iteration is\n          \n          \n            \n              /// `resumeRequest()`/`resumeResponse()` MUST occur when continued filter iteration is", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1029#discussion_r470752856", "createdAt": "2020-08-14T17:16:53Z", "author": {"login": "rebello95"}, "path": "library/swift/src/filters/FilterDataStatus.swift", "diffHunk": "@@ -15,13 +15,13 @@ public enum FilterDataStatus: Equatable {\n   ///\n   /// This filter will continue to be called with new chunks of data.\n   ///\n-  /// Returning `continue` from `onRequestData()`/`onResponseData()` or calling\n-  /// `continueRequest()`/`continueResponse()` MUST be called when continued filter iteration is\n+  /// Returning `continue` or `resumeIteration from another filter invocation or calling\n+  /// `resumeRequest()`/`resumeResponse()` MUST be called when continued filter iteration is", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b3ff051216c634865382e6744e850f5dc7c1592"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDkxMzQ1Ng==", "bodyText": "I still think \"must be called\" is accurate and maybe clearer?", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1029#discussion_r470913456", "createdAt": "2020-08-15T00:23:42Z", "author": {"login": "goaway"}, "path": "library/swift/src/filters/FilterDataStatus.swift", "diffHunk": "@@ -15,13 +15,13 @@ public enum FilterDataStatus: Equatable {\n   ///\n   /// This filter will continue to be called with new chunks of data.\n   ///\n-  /// Returning `continue` from `onRequestData()`/`onResponseData()` or calling\n-  /// `continueRequest()`/`continueResponse()` MUST be called when continued filter iteration is\n+  /// Returning `continue` or `resumeIteration from another filter invocation or calling\n+  /// `resumeRequest()`/`resumeResponse()` MUST be called when continued filter iteration is", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDc1Mjg1Ng=="}, "originalCommit": {"oid": "1b3ff051216c634865382e6744e850f5dc7c1592"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0MTc3NjA5OnYy", "diffSide": "RIGHT", "path": "library/swift/src/filters/AsyncResponseFilter.swift", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxNzoxNzoxOVrOHA8fHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxNzoxNzoxOVrOHA8fHg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDc1MzA1NA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              /// - param headers: Headers, if `StopIteration` was returned from `onResponseHeaders`.\n          \n          \n            \n              /// - param data: Any data that has been buffered where `StopIterationAndBuffer` was returned.\n          \n          \n            \n              /// - param trailers: Trailers, if `StopIteration` was returned from `onReponseTrailers`.\n          \n          \n            \n              /// - param endStream: True, if the stream ended with the previous (and thus, last) invocation.\n          \n          \n            \n              /// - param headers: Headers, if `stopIteration` was returned from `onResponseHeaders`.\n          \n          \n            \n              /// - param data: Any data that has been buffered where `stopIterationAndBuffer` was returned.\n          \n          \n            \n              /// - param trailers: Trailers, if `stopIteration` was returned from `onReponseTrailers`.\n          \n          \n            \n              /// - param endStream: True, if the stream ended with the previous (and thus, last) invocation.", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1029#discussion_r470753054", "createdAt": "2020-08-14T17:17:19Z", "author": {"login": "rebello95"}, "path": "library/swift/src/filters/AsyncResponseFilter.swift", "diffHunk": "@@ -0,0 +1,30 @@\n+import Foundation\n+\n+/// ResponseFilter supporting asynchronous resumption.\n+public protocol AsyncResponseFilter: ResponseFilter {\n+  /// Called by the filter manager once to initialize the filter callbacks that the filter should\n+  /// use.\n+  ///\n+  /// - parameter callbacks: The callbacks for this filter to use to interact with the chain.\n+  func setResponseFilterCallbacks(_ callbacks: ResponseFilterCallbacks)\n+\n+  /// Invoked explicitly in response to an asynchronous resumeResponse() callback when filter\n+  /// iteration has been stopped. The parameters passed to this invocation will be a snapshot\n+  /// of any stream state that has not yet been forwarded along the filter chain.\n+  ///\n+  /// As with other filter invocations, this will be called on Envoy's main thread, and thus\n+  /// no additional synchronization is required between this and other invocations.\n+  ///\n+  /// - param headers: Headers, if `StopIteration` was returned from `onResponseHeaders`.\n+  /// - param data: Any data that has been buffered where `StopIterationAndBuffer` was returned.\n+  /// - param trailers: Trailers, if `StopIteration` was returned from `onReponseTrailers`.\n+  /// - param endStream: True, if the stream ended with the previous (and thus, last) invocation.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b3ff051216c634865382e6744e850f5dc7c1592"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0MTc3OTQzOnYy", "diffSide": "RIGHT", "path": "library/swift/src/filters/FilterResumeStatus.swift", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxNzoxODoyOVrOHA8hLQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxNzoxODoyOVrOHA8hLQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDc1MzU4MQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              /// an error to include data or trailers if endStream was previously sent or if trailers have\n          \n          \n            \n              /// an error to include data or trailers if endStream=true was previously sent or if trailers have", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1029#discussion_r470753581", "createdAt": "2020-08-14T17:18:29Z", "author": {"login": "rebello95"}, "path": "library/swift/src/filters/FilterResumeStatus.swift", "diffHunk": "@@ -0,0 +1,15 @@\n+import Foundation\n+\n+/// Status returned by filters after resuming iteration asynchronously.\n+@frozen\n+public enum FilterResumeStatus<T: Headers, U: Headers>: Equatable {\n+  /// Resume previously-stopped iteration, potentially forwarding headers, data, and/or trailers\n+  /// that have not yet been passed along the filter chain.\n+  ///\n+  /// It is an error to return resumeIteration if iteration is not currently stopped, and it is\n+  /// an error to include headers if headers have already been forwarded to the next filter\n+  /// (i.e. iteration was stopped during an on*Data invocation instead of on*Headers). It is also\n+  /// an error to include data or trailers if endStream was previously sent or if trailers have", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b3ff051216c634865382e6744e850f5dc7c1592"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0MTc4MDI4OnYy", "diffSide": "RIGHT", "path": "library/swift/src/filters/FilterTrailersStatus.swift", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxNzoxODo0OFrOHA8huQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxNzoxODo0OFrOHA8huQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDc1MzcyMQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              /// It is an error to return ResumeIteration if iteration is not currently stopped, and it is\n          \n          \n            \n              /// It is an error to return resumeIteration if iteration is not currently stopped, and it is", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1029#discussion_r470753721", "createdAt": "2020-08-14T17:18:48Z", "author": {"login": "rebello95"}, "path": "library/swift/src/filters/FilterTrailersStatus.swift", "diffHunk": "@@ -1,12 +1,24 @@\n+import Foundation\n+\n /// Status returned by filters when transmitting or receiving trailers.\n @frozen\n-public enum FilterTrailersStatus<T: Headers>: Equatable {\n+public enum FilterTrailersStatus<T: Headers, U: Headers>: Equatable {\n   /// Continue filter chain iteration, passing the provided trailers through.\n-  case `continue`(T)\n+  case `continue`(U)\n \n   /// Do not iterate to any of the remaining filters in the chain with trailers.\n   ///\n-  /// Calling `continueRequest()`/`continueResponse()` MUST occur when continued filter iteration\n+  /// Because trailers are by definition the last HTTP entity of a request or response, only\n+  /// asynchronous filters support resumption after returning StopIteration from on*Trailers.\n+  /// Calling `resumeRequest()`/`resumeResponse()` MUST occur if continued filter iteration\n   /// is desired.\n-  case stopIteration(T)\n+  case stopIteration\n+\n+  /// Resume previously-stopped iteration, possibly forwarding headers and data if iteration was\n+  /// stopped during an on*Headers or on*Data invocation.\n+  ///\n+  /// It is an error to return ResumeIteration if iteration is not currently stopped, and it is", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b3ff051216c634865382e6744e850f5dc7c1592"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0MjEyMzE3OnYy", "diffSide": "RIGHT", "path": "library/swift/src/filters/FilterDataStatus.swift", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxODo0OTo1NFrOHA_7bA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNVQwMDoyNToxOFrOHBGSuA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDgwOTQ1Mg==", "bodyText": "Something I noticed while testing out these interfaces on a filter migration is that it's not immediately obvious to the consumer that returning .resumeIteration(...) does not call onResumeIteration() - only calling resumeRequest() does. Thoughts on how we could clarify that either through naming or documentation?", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1029#discussion_r470809452", "createdAt": "2020-08-14T18:49:54Z", "author": {"login": "rebello95"}, "path": "library/swift/src/filters/FilterDataStatus.swift", "diffHunk": "@@ -35,4 +35,12 @@ public enum FilterDataStatus: Equatable {\n   /// This may be called by filters which must parse a larger block of the incoming data before\n   /// continuing processing, and will handle their own buffering.\n   case stopIterationNoBuffer\n+\n+  /// Resume previously-stopped iteration, possibly forwarding headers if iteration was stopped\n+  /// during an on*Headers invocation.\n+  ///\n+  /// It is an error to return `resumeIteration` if iteration is not currently stopped, and it is\n+  /// an error to include headers if headers have already been forwarded to the next filter\n+  /// (i.e. iteration was stopped during an on*Data invocation instead of on*Headers).\n+  case resumeIteration(headers: T? = nil, data: Data)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b3ff051216c634865382e6744e850f5dc7c1592"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDgxMTc3NA==", "bodyText": "Would it make sense to simply rename continue and allow optional headers to be passed there? Since my understanding is the ability to pass headers here is the only difference between the two", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1029#discussion_r470811774", "createdAt": "2020-08-14T18:54:43Z", "author": {"login": "rebello95"}, "path": "library/swift/src/filters/FilterDataStatus.swift", "diffHunk": "@@ -35,4 +35,12 @@ public enum FilterDataStatus: Equatable {\n   /// This may be called by filters which must parse a larger block of the incoming data before\n   /// continuing processing, and will handle their own buffering.\n   case stopIterationNoBuffer\n+\n+  /// Resume previously-stopped iteration, possibly forwarding headers if iteration was stopped\n+  /// during an on*Headers invocation.\n+  ///\n+  /// It is an error to return `resumeIteration` if iteration is not currently stopped, and it is\n+  /// an error to include headers if headers have already been forwarded to the next filter\n+  /// (i.e. iteration was stopped during an on*Data invocation instead of on*Headers).\n+  case resumeIteration(headers: T? = nil, data: Data)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDgwOTQ1Mg=="}, "originalCommit": {"oid": "1b3ff051216c634865382e6744e850f5dc7c1592"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDkxMzcyMA==", "bodyText": "Based on our discussion elsewhere, I believe we've all settled on having \"continue\" be for continuing ongoing iteration and \"resume\" specifically for starting again when iteration has been stopped.", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1029#discussion_r470913720", "createdAt": "2020-08-15T00:25:18Z", "author": {"login": "goaway"}, "path": "library/swift/src/filters/FilterDataStatus.swift", "diffHunk": "@@ -35,4 +35,12 @@ public enum FilterDataStatus: Equatable {\n   /// This may be called by filters which must parse a larger block of the incoming data before\n   /// continuing processing, and will handle their own buffering.\n   case stopIterationNoBuffer\n+\n+  /// Resume previously-stopped iteration, possibly forwarding headers if iteration was stopped\n+  /// during an on*Headers invocation.\n+  ///\n+  /// It is an error to return `resumeIteration` if iteration is not currently stopped, and it is\n+  /// an error to include headers if headers have already been forwarded to the next filter\n+  /// (i.e. iteration was stopped during an on*Data invocation instead of on*Headers).\n+  case resumeIteration(headers: T? = nil, data: Data)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDgwOTQ1Mg=="}, "originalCommit": {"oid": "1b3ff051216c634865382e6744e850f5dc7c1592"}, "originalPosition": 37}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 757, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}