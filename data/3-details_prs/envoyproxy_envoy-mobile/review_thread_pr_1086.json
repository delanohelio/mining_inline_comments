{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg1NjI2MzE3", "number": 1086, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMlQwMTo1OToyNFrOEiu8OQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMlQwMjowNzo1NlrOEiu-8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA0ODU2MTIxOnYy", "diffSide": "RIGHT", "path": "library/common/jni/jni_interface.cc", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMlQwMTo1OToyNFrOHQxsKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQxNzozNToyOVrOHRft7g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzM1MzM4Ng==", "bodyText": "Exactly one of on_error, on_complete, or on_cancel should be called for every stream. Those should be the only place we delete j_context like this.", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1086#discussion_r487353386", "createdAt": "2020-09-12T01:59:24Z", "author": {"login": "goaway"}, "path": "library/common/jni/jni_interface.cc", "diffHunk": "@@ -133,6 +135,10 @@ static void* jvm_on_headers(const char* method, envoy_headers headers, bool end_\n                                          end_stream ? JNI_TRUE : JNI_FALSE);\n \n   env->DeleteLocalRef(jcls_JvmCallbackContext);\n+  if (end_stream) {\n+    env->DeleteGlobalRef(j_context);\n+  }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a148ed9a3d072c9ceef895653a0e1e76bf98e341"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzYyNTU5OA==", "bodyText": "Opened #1089", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1086#discussion_r487625598", "createdAt": "2020-09-14T02:54:39Z", "author": {"login": "goaway"}, "path": "library/common/jni/jni_interface.cc", "diffHunk": "@@ -133,6 +135,10 @@ static void* jvm_on_headers(const char* method, envoy_headers headers, bool end_\n                                          end_stream ? JNI_TRUE : JNI_FALSE);\n \n   env->DeleteLocalRef(jcls_JvmCallbackContext);\n+  if (end_stream) {\n+    env->DeleteGlobalRef(j_context);\n+  }\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzM1MzM4Ng=="}, "originalCommit": {"oid": "a148ed9a3d072c9ceef895653a0e1e76bf98e341"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODEwNzUwMg==", "bodyText": "Oh right, I've forgotten we have an on_complete which is called after a stream successfully finishes", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1086#discussion_r488107502", "createdAt": "2020-09-14T17:35:29Z", "author": {"login": "buildbreaker"}, "path": "library/common/jni/jni_interface.cc", "diffHunk": "@@ -133,6 +135,10 @@ static void* jvm_on_headers(const char* method, envoy_headers headers, bool end_\n                                          end_stream ? JNI_TRUE : JNI_FALSE);\n \n   env->DeleteLocalRef(jcls_JvmCallbackContext);\n+  if (end_stream) {\n+    env->DeleteGlobalRef(j_context);\n+  }\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzM1MzM4Ng=="}, "originalCommit": {"oid": "a148ed9a3d072c9ceef895653a0e1e76bf98e341"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA0ODU2MjMwOnYy", "diffSide": "RIGHT", "path": "library/common/jni/jni_interface.cc", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMlQwMjowMDoyMlrOHQxsrQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMlQwMjowMDoyMlrOHQxsrQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzM1MzUxNw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              if (end_stream) {\n          \n          \n            \n                env->DeleteGlobalRef(j_context);\n          \n          \n            \n              }", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1086#discussion_r487353517", "createdAt": "2020-09-12T02:00:22Z", "author": {"login": "goaway"}, "path": "library/common/jni/jni_interface.cc", "diffHunk": "@@ -190,6 +210,10 @@ static void* jvm_on_data(const char* method, envoy_data data, bool end_stream, v\n   data.release(data.context);\n   env->DeleteLocalRef(j_data);\n   env->DeleteLocalRef(jcls_JvmCallbackContext);\n+  if (end_stream) {\n+    env->DeleteGlobalRef(j_context);\n+  }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a148ed9a3d072c9ceef895653a0e1e76bf98e341"}, "originalPosition": 63}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA0ODU2Mjg0OnYy", "diffSide": "RIGHT", "path": "library/common/jni/jni_interface.cc", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMlQwMjowMToxMVrOHQxs8Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMlQwMjowMToxMVrOHQxs8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzM1MzU4NQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              env->DeleteGlobalRef(j_context);", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1086#discussion_r487353585", "createdAt": "2020-09-12T02:01:11Z", "author": {"login": "goaway"}, "path": "library/common/jni/jni_interface.cc", "diffHunk": "@@ -244,6 +282,8 @@ static void* jvm_on_trailers(const char* method, envoy_headers trailers, void* c\n   jobject result = env->CallObjectMethod(j_context, jmid_onTrailers, (jlong)trailers.length);\n \n   env->DeleteLocalRef(jcls_JvmCallbackContext);\n+  env->DeleteGlobalRef(j_context);\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a148ed9a3d072c9ceef895653a0e1e76bf98e341"}, "originalPosition": 108}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA0ODU2NzQ1OnYy", "diffSide": "RIGHT", "path": "library/common/jni/jni_interface.cc", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMlQwMjowNjo1M1rOHQxvMA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMlQwMjowNjo1M1rOHQxvMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzM1NDE2MA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            // released automatically. Manual book keeping is required for these methods.\n          \n          \n            \n            // released automatically. Manual bookkeeping is required for these methods.\n          \n      \n    \n    \n  \n\nTrivia: \"bookkeeping\" is the only English word with three pairs of double letters in a row.", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1086#discussion_r487354160", "createdAt": "2020-09-12T02:06:53Z", "author": {"login": "goaway"}, "path": "library/common/jni/jni_interface.cc", "diffHunk": "@@ -116,6 +116,8 @@ static void pass_headers(JNIEnv* env, envoy_headers headers, jobject j_context)\n }\n \n // Platform callback implementation\n+// These methods call jvm methods which means the local references created will not be\n+// released automatically. Manual book keeping is required for these methods.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a148ed9a3d072c9ceef895653a0e1e76bf98e341"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA0ODU2ODE4OnYy", "diffSide": "RIGHT", "path": "library/common/jni/jni_interface.cc", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMlQwMjowNzo1NlrOHQxvhg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMlQwMjowNzo1NlrOHQxvhg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzM1NDI0Ng==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              if (end_stream) {\n          \n          \n            \n                env->DeleteGlobalRef(j_context);\n          \n          \n            \n              }", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1086#discussion_r487354246", "createdAt": "2020-09-12T02:07:56Z", "author": {"login": "goaway"}, "path": "library/common/jni/jni_interface.cc", "diffHunk": "@@ -133,6 +135,10 @@ static void* jvm_on_headers(const char* method, envoy_headers headers, bool end_\n                                          end_stream ? JNI_TRUE : JNI_FALSE);\n \n   env->DeleteLocalRef(jcls_JvmCallbackContext);\n+  if (end_stream) {\n+    env->DeleteGlobalRef(j_context);\n+  }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a148ed9a3d072c9ceef895653a0e1e76bf98e341"}, "originalPosition": 16}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 612, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}