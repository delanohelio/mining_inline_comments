{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEwNzgxNTIz", "number": 1147, "title": "examples: add AsyncDemoFilter to swift example app", "bodyText": "Description: Adds a filter to the swift example app that pauses the response and then asynchronously resumes it via callbacks.\nRisk Level: Low\nTesting: Local\nSigned-off-by: Mike Schore mike.schore@gmail.com", "createdAt": "2020-10-27T14:07:31Z", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1147", "merged": true, "mergeCommit": {"oid": "646630ec639c44f119b25e06d85341c6439557e4"}, "closed": true, "closedAt": "2020-10-27T21:32:11Z", "author": {"login": "goaway"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdWpfWPgH2gAyNTEwNzgxNTIzOjg4Y2UyOTg3YmVmNjkzYWI5ZGFkYWMyZGMwZDAyZDU4N2IzZDFmYTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdWus-yAFqTUxODEwMDU4MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "88ce2987bef693ab9dadac2dc0d02d587b3d1fa8", "author": {"user": {"login": "goaway", "name": "Mike Schore"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/88ce2987bef693ab9dadac2dc0d02d587b3d1fa8", "committedDate": "2020-10-27T14:03:55Z", "message": "examples: add AsyncDemoFilter to swift example app\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE3OTQ0ODEz", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1147#pullrequestreview-517944813", "createdAt": "2020-10-27T17:10:06Z", "commit": {"oid": "88ce2987bef693ab9dadac2dc0d02d587b3d1fa8"}, "state": "COMMENTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxNzoxMDowNlrOHpHTxA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxNzoxNzo1MFrOHpHoUA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjg3MzQxMg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            class AsyncDemoFilter: AsyncResponseFilter {\n          \n          \n            \n            final class AsyncDemoFilter: AsyncResponseFilter {", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1147#discussion_r512873412", "createdAt": "2020-10-27T17:10:06Z", "author": {"login": "rebello95"}, "path": "examples/swift/hello_world/AsyncDemoFilter.swift", "diffHunk": "@@ -0,0 +1,52 @@\n+import Envoy\n+import Foundation\n+\n+class AsyncDemoFilter: AsyncResponseFilter {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "88ce2987bef693ab9dadac2dc0d02d587b3d1fa8"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjg3MzkxNA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              private var internalCallbacks: ResponseFilterCallbacks?\n          \n          \n            \n              private lazy var callbacks: ResponseFilterCallbacks = {\n          \n          \n            \n                internalCallbacks! //swiftlint:disable:this force_unwrapping\n          \n          \n            \n              }()\n          \n          \n            \n              private var callbacks: ResponseFilterCallbacks!", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1147#discussion_r512873914", "createdAt": "2020-10-27T17:10:51Z", "author": {"login": "rebello95"}, "path": "examples/swift/hello_world/AsyncDemoFilter.swift", "diffHunk": "@@ -0,0 +1,52 @@\n+import Envoy\n+import Foundation\n+\n+class AsyncDemoFilter: AsyncResponseFilter {\n+  private var internalCallbacks: ResponseFilterCallbacks?\n+  private lazy var callbacks: ResponseFilterCallbacks = {\n+    internalCallbacks! //swiftlint:disable:this force_unwrapping\n+  }()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "88ce2987bef693ab9dadac2dc0d02d587b3d1fa8"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjg3NDMyMg==", "bodyText": "Might be nice to add inline comments to explain what it's doing (since these serve as demos for readers looking to use the library)", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1147#discussion_r512874322", "createdAt": "2020-10-27T17:11:25Z", "author": {"login": "rebello95"}, "path": "examples/swift/hello_world/AsyncDemoFilter.swift", "diffHunk": "@@ -0,0 +1,52 @@\n+import Envoy\n+import Foundation\n+\n+class AsyncDemoFilter: AsyncResponseFilter {\n+  private var internalCallbacks: ResponseFilterCallbacks?\n+  private lazy var callbacks: ResponseFilterCallbacks = {\n+    internalCallbacks! //swiftlint:disable:this force_unwrapping\n+  }()\n+\n+  func onResponseHeaders(_ headers: ResponseHeaders, endStream: Bool)\n+    -> FilterHeadersStatus<ResponseHeaders>\n+  {\n+    return .stopIteration\n+  }\n+\n+  func onResponseData(_ body: Data, endStream: Bool) -> FilterDataStatus<ResponseHeaders> {\n+    if endStream {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "88ce2987bef693ab9dadac2dc0d02d587b3d1fa8"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjg3NDc1Ng==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                self.internalCallbacks = callbacks\n          \n          \n            \n                self.callbacks = callbacks", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1147#discussion_r512874756", "createdAt": "2020-10-27T17:12:00Z", "author": {"login": "rebello95"}, "path": "examples/swift/hello_world/AsyncDemoFilter.swift", "diffHunk": "@@ -0,0 +1,52 @@\n+import Envoy\n+import Foundation\n+\n+class AsyncDemoFilter: AsyncResponseFilter {\n+  private var internalCallbacks: ResponseFilterCallbacks?\n+  private lazy var callbacks: ResponseFilterCallbacks = {\n+    internalCallbacks! //swiftlint:disable:this force_unwrapping\n+  }()\n+\n+  func onResponseHeaders(_ headers: ResponseHeaders, endStream: Bool)\n+    -> FilterHeadersStatus<ResponseHeaders>\n+  {\n+    return .stopIteration\n+  }\n+\n+  func onResponseData(_ body: Data, endStream: Bool) -> FilterDataStatus<ResponseHeaders> {\n+    if endStream {\n+      callbacks.resumeResponse()\n+    }\n+    return .stopIterationAndBuffer\n+  }\n+\n+  func onResponseTrailers(\n+    _ trailers: ResponseTrailers\n+  ) -> FilterTrailersStatus<ResponseHeaders, ResponseTrailers> {\n+    callbacks.resumeResponse()\n+    return .stopIteration\n+  }\n+\n+  func setResponseFilterCallbacks(_ callbacks: ResponseFilterCallbacks) {\n+    self.internalCallbacks = callbacks", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "88ce2987bef693ab9dadac2dc0d02d587b3d1fa8"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjg3NzUxOQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                builder.add(name: \"async-filter-demo\", value: \"1\")\n          \n          \n            \n                  .add(name: \"async-filter-demo\", value: \"1\")", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1147#discussion_r512877519", "createdAt": "2020-10-27T17:16:05Z", "author": {"login": "rebello95"}, "path": "examples/swift/hello_world/AsyncDemoFilter.swift", "diffHunk": "@@ -0,0 +1,52 @@\n+import Envoy\n+import Foundation\n+\n+class AsyncDemoFilter: AsyncResponseFilter {\n+  private var internalCallbacks: ResponseFilterCallbacks?\n+  private lazy var callbacks: ResponseFilterCallbacks = {\n+    internalCallbacks! //swiftlint:disable:this force_unwrapping\n+  }()\n+\n+  func onResponseHeaders(_ headers: ResponseHeaders, endStream: Bool)\n+    -> FilterHeadersStatus<ResponseHeaders>\n+  {\n+    return .stopIteration\n+  }\n+\n+  func onResponseData(_ body: Data, endStream: Bool) -> FilterDataStatus<ResponseHeaders> {\n+    if endStream {\n+      callbacks.resumeResponse()\n+    }\n+    return .stopIterationAndBuffer\n+  }\n+\n+  func onResponseTrailers(\n+    _ trailers: ResponseTrailers\n+  ) -> FilterTrailersStatus<ResponseHeaders, ResponseTrailers> {\n+    callbacks.resumeResponse()\n+    return .stopIteration\n+  }\n+\n+  func setResponseFilterCallbacks(_ callbacks: ResponseFilterCallbacks) {\n+    self.internalCallbacks = callbacks\n+  }\n+\n+  func onResumeResponse(\n+    headers: ResponseHeaders?,\n+    data: Data?,\n+    trailers: ResponseTrailers?,\n+    endStream: Bool\n+  ) -> FilterResumeStatus<ResponseHeaders, ResponseTrailers> {\n+    guard let headers = headers else {\n+      // Iteration stopped on headers, so headers must be present.\n+      fatalError(\"Filter behavior violation!\")\n+    }\n+    let builder = headers.toResponseHeadersBuilder()\n+    builder.add(name: \"async-filter-demo\", value: \"1\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "88ce2987bef693ab9dadac2dc0d02d587b3d1fa8"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjg3ODY3Mg==", "bodyText": "Would also add a docstring above", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1147#discussion_r512878672", "createdAt": "2020-10-27T17:17:50Z", "author": {"login": "rebello95"}, "path": "examples/swift/hello_world/AsyncDemoFilter.swift", "diffHunk": "@@ -0,0 +1,52 @@\n+import Envoy\n+import Foundation\n+\n+class AsyncDemoFilter: AsyncResponseFilter {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjg3MzQxMg=="}, "originalCommit": {"oid": "88ce2987bef693ab9dadac2dc0d02d587b3d1fa8"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6e8a21de9cf7f66ece9b41adc876f1189dceaf44", "author": {"user": {"login": "goaway", "name": "Mike Schore"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/6e8a21de9cf7f66ece9b41adc876f1189dceaf44", "committedDate": "2020-10-27T19:40:19Z", "message": "updates for comments\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4MDkzMjIz", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1147#pullrequestreview-518093223", "createdAt": "2020-10-27T19:58:11Z", "commit": {"oid": "6e8a21de9cf7f66ece9b41adc876f1189dceaf44"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa22ac22ee340f1fc28e01614fa9abbe02c92099", "author": {"user": {"login": "goaway", "name": "Mike Schore"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/aa22ac22ee340f1fc28e01614fa9abbe02c92099", "committedDate": "2020-10-27T20:06:55Z", "message": "typo\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4MTAwNTgx", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1147#pullrequestreview-518100581", "createdAt": "2020-10-27T20:08:20Z", "commit": {"oid": "aa22ac22ee340f1fc28e01614fa9abbe02c92099"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3874, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}