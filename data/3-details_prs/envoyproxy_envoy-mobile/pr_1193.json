{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMwNjIyOTQw", "number": 1193, "title": "config: add ability to register native filters", "bodyText": "Description: adding templating to register native filters.\nRisk Level: low - optional feature\nTesting: used in example apps\nDocs Changes: pending\nSigned-off-by: Jose Nino jnino@lyft.com", "createdAt": "2020-12-01T22:49:32Z", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1193", "merged": true, "mergeCommit": {"oid": "106df1de5317fbf22e750d39bcd0147b174a4675"}, "closed": true, "closedAt": "2020-12-04T17:18:37Z", "author": {"login": "junr03"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdiBDa1AH2gAyNTMwNjIyOTQwOmI2MzI4MzM4ODcwODk1ZWM2NzQxMjNhZTNiMGMwMjE1OTM3NDUzNjQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdiuRtNAH2gAyNTMwNjIyOTQwOjRhY2E5MWZmMGE1MWYzZDM2NmYzYWM4Zjk0ZjEwNzM1NzJlMDVlMmY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b6328338870895ec674123ae3b0c021593745364", "author": {"user": {"login": "junr03", "name": "Jose Ulises Nino Rivera"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/b6328338870895ec674123ae3b0c021593745364", "committedDate": "2020-12-01T21:44:18Z", "message": "config: add ability to register native filters\n\nSigned-off-by: Jose Nino <jnino@lyft.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f87dc124032b5f9ec77fd703ec63485b01e3b9bf", "author": {"user": {"login": "junr03", "name": "Jose Ulises Nino Rivera"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/f87dc124032b5f9ec77fd703ec63485b01e3b9bf", "committedDate": "2020-12-01T22:09:42Z", "message": "android building\n\nSigned-off-by: Jose Nino <jnino@lyft.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQyMzcyODUw", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1193#pullrequestreview-542372850", "createdAt": "2020-12-01T23:08:57Z", "commit": {"oid": "b6328338870895ec674123ae3b0c021593745364"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQyMzowODo1N1rOH9DjTw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQyMzowOToyMFrOH9DkAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzc4MzM3NQ==", "bodyText": "nativeplatformFilterTemplateYAML shouldn't this be nativeFilterTemplateYAML? Also should be documented above because I don't think this is immediately obvious as to what should be passed here (it's a bit of a \"magic\" string)", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1193#discussion_r533783375", "createdAt": "2020-12-01T23:08:57Z", "author": {"login": "rebello95"}, "path": "library/java/src/io/envoyproxy/envoymobile/engine/EnvoyConfiguration.java", "diffHunk": "@@ -60,15 +63,23 @@ public EnvoyConfiguration(String statsDomain, int connectTimeoutSeconds, int dns\n    * @throws ConfigurationException, when the template provided is not fully\n    *                                 resolved.\n    */\n-  String resolveTemplate(final String templateYAML, final String filterTemplateYAML) {\n+  String resolveTemplate(final String templateYAML, final String platformFilterTemplateYAML, final String nativeplatformFilterTemplateYAML) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b6328338870895ec674123ae3b0c021593745364"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzc4MzU1Mw==", "bodyText": "Can you actually elaborate on how this will be used directly? I.e., what will a consumer need to specify to make this work?", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1193#discussion_r533783553", "createdAt": "2020-12-01T23:09:20Z", "author": {"login": "rebello95"}, "path": "library/java/src/io/envoyproxy/envoymobile/engine/EnvoyConfiguration.java", "diffHunk": "@@ -60,15 +63,23 @@ public EnvoyConfiguration(String statsDomain, int connectTimeoutSeconds, int dns\n    * @throws ConfigurationException, when the template provided is not fully\n    *                                 resolved.\n    */\n-  String resolveTemplate(final String templateYAML, final String filterTemplateYAML) {\n+  String resolveTemplate(final String templateYAML, final String platformFilterTemplateYAML, final String nativeplatformFilterTemplateYAML) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzc4MzM3NQ=="}, "originalCommit": {"oid": "b6328338870895ec674123ae3b0c021593745364"}, "originalPosition": 38}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQyMzc0OTgw", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1193#pullrequestreview-542374980", "createdAt": "2020-12-01T23:13:08Z", "commit": {"oid": "b6328338870895ec674123ae3b0c021593745364"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQyMzoxMzowOFrOH9DqXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQyMzoxMzowOFrOH9DqXA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzc4NTE4MA==", "bodyText": "Doesn't this need an order? Two lists or a list of pairs might be a better serialization.", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1193#discussion_r533785180", "createdAt": "2020-12-01T23:13:08Z", "author": {"login": "goaway"}, "path": "library/java/src/io/envoyproxy/envoymobile/engine/EnvoyConfiguration.java", "diffHunk": "@@ -38,7 +40,7 @@\n   public EnvoyConfiguration(String statsDomain, int connectTimeoutSeconds, int dnsRefreshSeconds,\n                             int dnsFailureRefreshSecondsBase, int dnsFailureRefreshSecondsMax,\n                             List<EnvoyHTTPFilterFactory> httpFilterFactories, int statsFlushSeconds,\n-                            String appVersion, String appId, String virtualClusters) {\n+                            String appVersion, String appId, String virtualClusters, Map<String, String> nativeFilters) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b6328338870895ec674123ae3b0c021593745364"}, "originalPosition": 21}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b563cb93fbce017cb6f06947b31bab2ee8e83da4", "author": {"user": {"login": "junr03", "name": "Jose Ulises Nino Rivera"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/b563cb93fbce017cb6f06947b31bab2ee8e83da4", "committedDate": "2020-12-02T01:59:10Z", "message": "ios and comments\n\nSigned-off-by: Jose Nino <jnino@lyft.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQyNTQxNTE1", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1193#pullrequestreview-542541515", "createdAt": "2020-12-02T06:53:29Z", "commit": {"oid": "b563cb93fbce017cb6f06947b31bab2ee8e83da4"}, "state": "COMMENTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQwNjo1MzoyOVrOH9MwSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQwNzowNzoxMFrOH9NEeA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzkzNDE1NQ==", "bodyText": "nit: formatting is off", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1193#discussion_r533934155", "createdAt": "2020-12-02T06:53:29Z", "author": {"login": "rebello95"}, "path": "library/java/src/io/envoyproxy/envoymobile/engine/EnvoyConfiguration.java", "diffHunk": "@@ -36,11 +35,13 @@\n    * @param appVersion                   the App Version of the App using this Envoy Client.\n    * @param appId                        the App ID of the App using this Envoy Client.\n    * @param virtualClusters              the JSON list of virtual cluster configs.\n+   * @param nativeFilterChain                the configuration for native filters.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b563cb93fbce017cb6f06947b31bab2ee8e83da4"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzkzNDMyNQ==", "bodyText": "It'd be great if we could check in rst docs as well explaining how to use these", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1193#discussion_r533934325", "createdAt": "2020-12-02T06:54:00Z", "author": {"login": "rebello95"}, "path": "library/java/src/io/envoyproxy/envoymobile/engine/EnvoyConfiguration.java", "diffHunk": "@@ -51,31 +52,35 @@ public EnvoyConfiguration(String statsDomain, int connectTimeoutSeconds, int dns\n     this.appVersion = appVersion;\n     this.appId = appId;\n     this.virtualClusters = virtualClusters;\n-    this.nativeFilters = nativeFilters;\n+    this.nativeFilterChain = nativeFilterChain;\n   }\n \n   /**\n    * Resolves the provided configuration template using properties on this\n    * configuration.\n    *\n    * @param templateYAML the template configuration to resolve.\n+   * @param platformFilterTemplateYAML helper template to build platform http filters.\n+   * @param nativeFilterTemplateYAML helper template to build native http filters.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b563cb93fbce017cb6f06947b31bab2ee8e83da4"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzkzNDYyNQ==", "bodyText": "typedConfig seems like a bit of a misnomer throughout this PR since it's by definition untyped since it's a string.", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1193#discussion_r533934625", "createdAt": "2020-12-02T06:54:49Z", "author": {"login": "rebello95"}, "path": "library/java/src/io/envoyproxy/envoymobile/engine/EnvoyNativeFilterConfig.java", "diffHunk": "@@ -0,0 +1,18 @@\n+package io.envoyproxy.envoymobile.engine;\n+\n+/* Datatype used by the EnvoyConfiguration to create a native http filter chain. */\n+public class EnvoyNativeFilterConfig {\n+  public final String name;\n+  public final String typedConfig;\n+\n+  /**\n+   * Create a new instance of the configuration\n+   *\n+   * @param name        the name of the filter.\n+   * @param typedConfig the filter configuration.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b563cb93fbce017cb6f06947b31bab2ee8e83da4"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzkzNDc1Mg==", "bodyText": "Is the .class file deliberately being checked in below?", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1193#discussion_r533934752", "createdAt": "2020-12-02T06:55:07Z", "author": {"login": "rebello95"}, "path": "library/java/src/io/envoyproxy/envoymobile/engine/JniLibrary.java", "diffHunk": "@@ -210,3 +210,4 @@ protected static native int runEngine(long engine, String config, String logLeve\n    *         native filter configuration.\n    */\n   public static native String nativeFilterTemplateString();\n+}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b563cb93fbce017cb6f06947b31bab2ee8e83da4"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzkzODQ3NQ==", "bodyText": "nit: I think it'd be nice to list native/platform filters together in the parameter order", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1193#discussion_r533938475", "createdAt": "2020-12-02T07:04:56Z", "author": {"login": "rebello95"}, "path": "library/objective-c/EnvoyConfiguration.m", "diffHunk": "@@ -9,11 +9,12 @@ - (instancetype)initWithStatsDomain:(NSString *)statsDomain\n                   dnsRefreshSeconds:(UInt32)dnsRefreshSeconds\n        dnsFailureRefreshSecondsBase:(UInt32)dnsFailureRefreshSecondsBase\n         dnsFailureRefreshSecondsMax:(UInt32)dnsFailureRefreshSecondsMax\n-                        filterChain:(NSArray<EnvoyHTTPFilterFactory *> *)httpFilterFactories\n+                platformFilterChain:(NSArray<EnvoyHTTPFilterFactory *> *)httpFilterFactories\n                   statsFlushSeconds:(UInt32)statsFlushSeconds\n                          appVersion:(NSString *)appVersion\n                               appId:(NSString *)appId\n-                    virtualClusters:(NSString *)virtualClusters {\n+                    virtualClusters:(NSString *)virtualClusters\n+                  nativeFilterChain:(NSArray<EnvoyNativeFilterConfig *> *)nativeFilterChain {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b563cb93fbce017cb6f06947b31bab2ee8e83da4"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzkzODcyMQ==", "bodyText": "docs for these, especially since they're just strings?", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1193#discussion_r533938721", "createdAt": "2020-12-02T07:05:37Z", "author": {"login": "rebello95"}, "path": "library/objective-c/EnvoyEngine.h", "diffHunk": "@@ -218,6 +218,15 @@ extern const int kEnvoyFilterResumeStatusResumeIteration;\n \n @end\n \n+#pragma mark - EnvoyNativeFilterConfig\n+\n+@interface EnvoyNativeFilterConfig : NSObject\n+\n+@property (nonatomic, strong) NSString *name;\n+@property (nonatomic, strong) NSString *typedConfig;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b563cb93fbce017cb6f06947b31bab2ee8e83da4"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzkzOTMyMA==", "bodyText": "Why not put this in objective-c since that's where the type is defined and these are primitives? If you want to keep it here, it should be private extension", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1193#discussion_r533939320", "createdAt": "2020-12-02T07:07:10Z", "author": {"login": "rebello95"}, "path": "library/swift/src/EngineBuilder.swift", "diffHunk": "@@ -1,6 +1,14 @@\n @_implementationOnly import EnvoyEngine\n import Foundation\n \n+extension EnvoyNativeFilterConfig {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b563cb93fbce017cb6f06947b31bab2ee8e83da4"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6042da3107d834060064e69e2ad92590d979549f", "author": {"user": {"login": "junr03", "name": "Jose Ulises Nino Rivera"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/6042da3107d834060064e69e2ad92590d979549f", "committedDate": "2020-12-03T00:15:08Z", "message": "tests\n\nSigned-off-by: Jose Nino <jnino@lyft.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3f812db30573fa1368975e8231352cc8bc951d82", "author": {"user": {"login": "junr03", "name": "Jose Ulises Nino Rivera"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/3f812db30573fa1368975e8231352cc8bc951d82", "committedDate": "2020-12-03T00:47:37Z", "message": "fmt\n\nSigned-off-by: Jose Nino <jnino@lyft.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bfac3ec107b51c7214273a86e99bf6cdf930fad8", "author": {"user": {"login": "junr03", "name": "Jose Ulises Nino Rivera"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/bfac3ec107b51c7214273a86e99bf6cdf930fad8", "committedDate": "2020-12-03T00:52:54Z", "message": "fmt\n\nSigned-off-by: Jose Nino <jnino@lyft.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "820cbc557133e52caac9314270db700d66abb972", "author": {"user": {"login": "junr03", "name": "Jose Ulises Nino Rivera"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/820cbc557133e52caac9314270db700d66abb972", "committedDate": "2020-12-03T02:07:49Z", "message": "comments\n\nSigned-off-by: Jose Nino <jnino@lyft.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0MjQ1Njky", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1193#pullrequestreview-544245692", "createdAt": "2020-12-03T18:14:33Z", "commit": {"oid": "820cbc557133e52caac9314270db700d66abb972"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4c826557f0671cd5a1574c8692033a0f9c24624d", "author": {"user": {"login": "junr03", "name": "Jose Ulises Nino Rivera"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/4c826557f0671cd5a1574c8692033a0f9c24624d", "committedDate": "2020-12-04T00:45:11Z", "message": "Merge branch 'main' into register-native-filters\n\nSigned-off-by: Jose Nino <jnino@lyft.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a171888a2e20f161cee23ed03aa1ba9f0e0d31d8", "author": {"user": {"login": "junr03", "name": "Jose Ulises Nino Rivera"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/a171888a2e20f161cee23ed03aa1ba9f0e0d31d8", "committedDate": "2020-12-04T01:33:09Z", "message": "fixes from merge\n\nSigned-off-by: Jose Nino <jnino@lyft.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4aca91ff0a51f3d366f3ac8f94f1073572e05e2f", "author": {"user": {"login": "junr03", "name": "Jose Ulises Nino Rivera"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/4aca91ff0a51f3d366f3ac8f94f1073572e05e2f", "committedDate": "2020-12-04T02:25:38Z", "message": "fmt\n\nSigned-off-by: Jose Nino <jnino@lyft.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3923, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}