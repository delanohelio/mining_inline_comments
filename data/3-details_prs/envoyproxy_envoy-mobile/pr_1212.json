{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQyNTA0ODA1", "number": 1212, "title": "ios: split comma-delimited header values when creating platform representation", "bodyText": "Description: Splits list-formatted header value on creation of header maps.  Per RFC 7230, does not perform this parsing on \"set-cookie\" headers, and additionally skips it on \"www-authenticate\" and \"proxy-authenticate\", due to their potential to contain commas in contravention of the spec.\nRisk Level: Low\nTesting: Pending\nSigned-off-by: Mike Schore mike.schore@gmail.com", "createdAt": "2020-12-18T12:08:30Z", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1212", "merged": true, "mergeCommit": {"oid": "9574e21dcd32ce56f9634ee69c04d33d3ee26a13"}, "closed": true, "closedAt": "2020-12-18T22:21:03Z", "author": {"login": "goaway"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdnXJtNAH2gAyNTQyNTA0ODA1OmQ0ZjBlYjM2ZGZhOTE1YWI1OTFjMWEwYWQ4MjNlMDNhZjA5MjcyYjA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdndH-DAFqTU1NTc1MjAxMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d4f0eb36dfa915ab591c1a0ad823e03af09272b0", "author": {"user": {"login": "goaway", "name": "Mike Schore"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/d4f0eb36dfa915ab591c1a0ad823e03af09272b0", "committedDate": "2020-12-18T12:18:42Z", "message": "ios: split comma-delimited header values when creating platform representation\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "964dd66262bf2ef7ee059ef764fa3205aad14db7", "author": {"user": {"login": "goaway", "name": "Mike Schore"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/964dd66262bf2ef7ee059ef764fa3205aad14db7", "committedDate": "2020-12-18T12:00:53Z", "message": "ios: split comma-delimited header values when creating platform representation\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>"}, "afterCommit": {"oid": "d4f0eb36dfa915ab591c1a0ad823e03af09272b0", "author": {"user": {"login": "goaway", "name": "Mike Schore"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/d4f0eb36dfa915ab591c1a0ad823e03af09272b0", "committedDate": "2020-12-18T12:18:42Z", "message": "ios: split comma-delimited header values when creating platform representation\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU1NTE0MzA4", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1212#pullrequestreview-555514308", "createdAt": "2020-12-18T14:11:12Z", "commit": {"oid": "d4f0eb36dfa915ab591c1a0ad823e03af09272b0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQxNDoxMToxMlrOIIkTuQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQxNDoxMToxMlrOIIkTuQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTg1NDM5Mw==", "bodyText": "Is this necessary? I assume that envoy doesn't add white spaces, in which case we may more closely preserve the \"original\" content by not trimming", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1212#discussion_r545854393", "createdAt": "2020-12-18T14:11:12Z", "author": {"login": "rebello95"}, "path": "library/objective-c/EnvoyBridgeUtility.h", "diffHunk": "@@ -83,12 +83,27 @@ static inline EnvoyHeaders *to_ios_headers(envoy_headers headers) {\n     NSString *headerValue = [[NSString alloc] initWithBytes:header.value.bytes\n                                                      length:header.value.length\n                                                    encoding:NSUTF8StringEncoding];\n+    // Ensure list is present in dictionary value\n     NSMutableArray *headerValueList = headerDict[headerKey];\n     if (headerValueList == nil) {\n       headerValueList = [NSMutableArray new];\n       headerDict[headerKey] = headerValueList;\n     }\n-    [headerValueList addObject:headerValue];\n+\n+    // By convention, these headers disregard the RFC and contain commas single values.\n+    if (headerKey == @\"set-cookie\" ||\n+        headerKey == @\"www-authenticate\" ||\n+        headerKey == @\"proxy-authenticate\") {\n+      [headerValueList addObject:headerValue];\n+    } else {\n+      // Add trimmed, comma-separated values as individual members of the list.\n+      NSArray *newValueList = [headerValue componentsSeparatedByString:@\",\"];\n+      for (NSString *value in newValueList) {\n+        NSString *trimmedValue =\n+          [value stringByTrimmingCharactersInSet:[NSCharacterSet whitespaceCharacterSet]];", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d4f0eb36dfa915ab591c1a0ad823e03af09272b0"}, "originalPosition": 22}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3bd31498df220f0bd5c1e8452a2017272afcd99b", "author": {"user": {"login": "goaway", "name": "Mike Schore"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/3bd31498df220f0bd5c1e8452a2017272afcd99b", "committedDate": "2020-12-18T18:03:22Z", "message": "format\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2a293cb038ac0fbc967c7d23ab96a1373413b4af", "author": {"user": {"login": "goaway", "name": "Mike Schore"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/2a293cb038ac0fbc967c7d23ab96a1373413b4af", "committedDate": "2020-12-18T19:14:49Z", "message": "fix string comparison\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU1NzUyMDEw", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1212#pullrequestreview-555752010", "createdAt": "2020-12-18T19:16:14Z", "commit": {"oid": "2a293cb038ac0fbc967c7d23ab96a1373413b4af"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3948, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}