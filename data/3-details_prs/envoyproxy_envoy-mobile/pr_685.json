{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc0NTk3NTQx", "number": 685, "title": "dispatcher: update to use new internal header map types", "bodyText": "Description: Update to use new internal types in Envoy.\nRisk: Low\nTesting: Unit and CI\nSigned-off-by: Mike Schore mike.schore@gmail.com", "createdAt": "2020-02-12T23:43:51Z", "url": "https://github.com/envoyproxy/envoy-mobile/pull/685", "merged": true, "mergeCommit": {"oid": "4bafb8c3def1db049c64cebff8576b25912761b2"}, "closed": true, "closedAt": "2020-02-14T06:51:36Z", "author": {"login": "goaway"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcDvJRLgH2gAyMzc0NTk3NTQxOmZmZjQ3ZDU4OTZjYTdmMWVmYzQyOWZmMzAwY2E5YTIwNDhmZmFlMTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcEC3ZjAFqTM1ODYwNDgxOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "fff47d5896ca7f1efc429ff300ca9a2048ffae12", "author": {"user": {"login": "goaway", "name": "Mike Schore"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/fff47d5896ca7f1efc429ff300ca9a2048ffae12", "committedDate": "2020-02-12T23:43:31Z", "message": "dispatcher: update to use new internal header map types\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "20281666383030ace055b792a99653f59954b836", "author": {"user": {"login": "goaway", "name": "Mike Schore"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/20281666383030ace055b792a99653f59954b836", "committedDate": "2020-02-13T19:00:11Z", "message": "fix and add tests\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU4NDg1NjQw", "url": "https://github.com/envoyproxy/envoy-mobile/pull/685#pullrequestreview-358485640", "createdAt": "2020-02-13T19:21:00Z", "commit": {"oid": "20281666383030ace055b792a99653f59954b836"}, "state": "DISMISSED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xM1QxOToyMTowMFrOFpgceQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xM1QxOToyMTo1MVrOFpgeVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTA2NzUxMw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             * @return HeaderMapPtr, the HeaderMap 1:1 transformation of the headers param.\n          \n          \n            \n             * @return RequestHeaderMapPtr, the RequestHeaderMap 1:1 transformation of the headers param.", "url": "https://github.com/envoyproxy/envoy-mobile/pull/685#discussion_r379067513", "createdAt": "2020-02-13T19:21:00Z", "author": {"login": "rebello95"}, "path": "library/common/http/header_utility.h", "diffHunk": "@@ -17,12 +17,20 @@ namespace Utility {\n std::string convertToString(envoy_data s);\n \n /**\n- * Transform envoy_headers to HeaderMap.\n+ * Transform envoy_headers to RequestHeaderMap.\n+ * This function copies the content.\n+ * @param headers, the envoy_headers to transform.\n+ * @return HeaderMapPtr, the HeaderMap 1:1 transformation of the headers param.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "20281666383030ace055b792a99653f59954b836"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTA2NzczNA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             * @return HeaderMapPtr, the HeaderMap 1:1 transformation of the headers param.\n          \n          \n            \n             * @return RequestTrailerMapPtr, the RequestTrailerMap 1:1 transformation of the headers param.", "url": "https://github.com/envoyproxy/envoy-mobile/pull/685#discussion_r379067734", "createdAt": "2020-02-13T19:21:20Z", "author": {"login": "rebello95"}, "path": "library/common/http/header_utility.h", "diffHunk": "@@ -17,12 +17,20 @@ namespace Utility {\n std::string convertToString(envoy_data s);\n \n /**\n- * Transform envoy_headers to HeaderMap.\n+ * Transform envoy_headers to RequestHeaderMap.\n+ * This function copies the content.\n+ * @param headers, the envoy_headers to transform.\n+ * @return HeaderMapPtr, the HeaderMap 1:1 transformation of the headers param.\n+ */\n+RequestHeaderMapPtr toRequestHeaders(envoy_headers headers);\n+\n+/**\n+ * Transform envoy_headers to RequestHeaderMap.\n  * This function copies the content.\n  * @param headers, the envoy_headers to transform.\n  * @return HeaderMapPtr, the HeaderMap 1:1 transformation of the headers param.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "20281666383030ace055b792a99653f59954b836"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTA2Nzk5MA==", "bodyText": "nit: might also make sense to rename headers to trailers now that we have an explicit RequestTrailerMapPtr type", "url": "https://github.com/envoyproxy/envoy-mobile/pull/685#discussion_r379067990", "createdAt": "2020-02-13T19:21:51Z", "author": {"login": "rebello95"}, "path": "library/common/http/header_utility.h", "diffHunk": "@@ -17,12 +17,20 @@ namespace Utility {\n std::string convertToString(envoy_data s);\n \n /**\n- * Transform envoy_headers to HeaderMap.\n+ * Transform envoy_headers to RequestHeaderMap.\n+ * This function copies the content.\n+ * @param headers, the envoy_headers to transform.\n+ * @return HeaderMapPtr, the HeaderMap 1:1 transformation of the headers param.\n+ */\n+RequestHeaderMapPtr toRequestHeaders(envoy_headers headers);\n+\n+/**\n+ * Transform envoy_headers to RequestHeaderMap.\n  * This function copies the content.\n  * @param headers, the envoy_headers to transform.\n  * @return HeaderMapPtr, the HeaderMap 1:1 transformation of the headers param.\n  */\n-HeaderMapPtr toInternalHeaders(envoy_headers headers);\n+RequestTrailerMapPtr toRequestTrailers(envoy_headers headers);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "20281666383030ace055b792a99653f59954b836"}, "originalPosition": 19}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "91211d3acd75a2f53da9032e0697396e32a525b6", "author": {"user": {"login": "goaway", "name": "Mike Schore"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/91211d3acd75a2f53da9032e0697396e32a525b6", "committedDate": "2020-02-13T19:26:12Z", "message": "fix dispatcher tests\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3849bfb7877ca4f9fb18b30c8be4fbccf3455fa8", "author": {"user": {"login": "goaway", "name": "Mike Schore"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/3849bfb7877ca4f9fb18b30c8be4fbccf3455fa8", "committedDate": "2020-02-13T19:31:17Z", "message": "Apply suggestions from code review\r\n\r\nSigned-off-by: Mike Schore <mike.schore@gmail.com>\n\nCo-Authored-By: Michael Rebello <me@michaelrebello.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "de32c5f9db3986d5728fe33fd663c7560e3d4d27", "author": {"user": {"login": "goaway", "name": "Mike Schore"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/de32c5f9db3986d5728fe33fd663c7560e3d4d27", "committedDate": "2020-02-13T19:34:25Z", "message": "fixes and feedback\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a9f870e5495e1b40b8a0f8111b3eb013389f0f75", "author": {"user": {"login": "goaway", "name": "Mike Schore"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/a9f870e5495e1b40b8a0f8111b3eb013389f0f75", "committedDate": "2020-02-13T19:36:10Z", "message": "fix\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU4NTA1MzQ1", "url": "https://github.com/envoyproxy/envoy-mobile/pull/685#pullrequestreview-358505345", "createdAt": "2020-02-13T19:51:10Z", "commit": {"oid": "a9f870e5495e1b40b8a0f8111b3eb013389f0f75"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cd1ec533ea3097dd23ac90ca1e4a1678c91f3756", "author": {"user": {"login": "goaway", "name": "Mike Schore"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/cd1ec533ea3097dd23ac90ca1e4a1678c91f3756", "committedDate": "2020-02-13T21:58:09Z", "message": "fix integration test and format\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3788d981320e05d455de60b73acec9036d3be2dc", "author": {"user": {"login": "goaway", "name": "Mike Schore"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/3788d981320e05d455de60b73acec9036d3be2dc", "committedDate": "2020-02-13T22:02:58Z", "message": "format\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU4NjAxNDQ3", "url": "https://github.com/envoyproxy/envoy-mobile/pull/685#pullrequestreview-358601447", "createdAt": "2020-02-13T22:34:55Z", "commit": {"oid": "3788d981320e05d455de60b73acec9036d3be2dc"}, "state": "DISMISSED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xM1QyMjozNDo1NVrOFpl9Xw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xM1QyMjozNzo0MFrOFpmBUw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTE1Nzg1NQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             * Transform envoy_headers to RequestHeaderMap.\n          \n          \n            \n             * Transform envoy_headers to RequestTrailerMap.", "url": "https://github.com/envoyproxy/envoy-mobile/pull/685#discussion_r379157855", "createdAt": "2020-02-13T22:34:55Z", "author": {"login": "rebello95"}, "path": "library/common/http/header_utility.h", "diffHunk": "@@ -17,12 +17,20 @@ namespace Utility {\n std::string convertToString(envoy_data s);\n \n /**\n- * Transform envoy_headers to HeaderMap.\n+ * Transform envoy_headers to RequestHeaderMap.\n+ * This function copies the content.\n+ * @param headers, the envoy_headers to transform.\n+ * @return RequestHeaderMapPtr, the RequestHeaderMap 1:1 transformation of the headers param.\n+ */\n+RequestHeaderMapPtr toRequestHeaders(envoy_headers headers);\n+\n+/**\n+ * Transform envoy_headers to RequestHeaderMap.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3788d981320e05d455de60b73acec9036d3be2dc"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTE1Nzg4MQ==", "bodyText": "Thoughts?", "url": "https://github.com/envoyproxy/envoy-mobile/pull/685#discussion_r379157881", "createdAt": "2020-02-13T22:35:00Z", "author": {"login": "rebello95"}, "path": "library/common/http/header_utility.h", "diffHunk": "@@ -17,12 +17,20 @@ namespace Utility {\n std::string convertToString(envoy_data s);\n \n /**\n- * Transform envoy_headers to HeaderMap.\n+ * Transform envoy_headers to RequestHeaderMap.\n+ * This function copies the content.\n+ * @param headers, the envoy_headers to transform.\n+ * @return HeaderMapPtr, the HeaderMap 1:1 transformation of the headers param.\n+ */\n+RequestHeaderMapPtr toRequestHeaders(envoy_headers headers);\n+\n+/**\n+ * Transform envoy_headers to RequestHeaderMap.\n  * This function copies the content.\n  * @param headers, the envoy_headers to transform.\n  * @return HeaderMapPtr, the HeaderMap 1:1 transformation of the headers param.\n  */\n-HeaderMapPtr toInternalHeaders(envoy_headers headers);\n+RequestTrailerMapPtr toRequestTrailers(envoy_headers headers);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTA2Nzk5MA=="}, "originalCommit": {"oid": "20281666383030ace055b792a99653f59954b836"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTE1ODg2Nw==", "bodyText": "toInternalHeaders doesn't exist anymore", "url": "https://github.com/envoyproxy/envoy-mobile/pull/685#discussion_r379158867", "createdAt": "2020-02-13T22:37:40Z", "author": {"login": "rebello95"}, "path": "test/common/http/header_utility_test.cc", "diffHunk": "@@ -66,6 +75,47 @@ TEST(HeaderDataConstructorTest, FromCToCpp) {\n   delete sentinel;\n }\n \n+TEST(RequestTrailerDataConstructorTest, FromCToCpp) {\n+  // Backing strings for all the envoy_datas in the c_trailers.\n+  std::vector<std::pair<std::string, std::string>> trailers = {\n+      {\"processing-duration-ms\", \"25\"}, {\"response-compression-ratio\", \"0.61\"}};\n+\n+  envoy_header* header_array = new envoy_header[trailers.size()];\n+\n+  uint32_t* sentinel = new uint32_t;\n+  *sentinel = 0;\n+  for (size_t i = 0; i < trailers.size(); i++) {\n+    header_array[i] = {\n+        envoyTestString(trailers[i].first, sentinel),\n+        envoyTestString(trailers[i].second, sentinel),\n+    };\n+  }\n+\n+  envoy_headers c_trailers = {static_cast<envoy_header_size_t>(trailers.size()), header_array};\n+  // This copy is used for assertions given that envoy_trailers are released when toInternalHeaders", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3788d981320e05d455de60b73acec9036d3be2dc"}, "originalPosition": 59}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d5a4ec93d3bf8eb0b3d86177b70539eb1eca9e7c", "author": {"user": {"login": "goaway", "name": "Mike Schore"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/d5a4ec93d3bf8eb0b3d86177b70539eb1eca9e7c", "committedDate": "2020-02-13T22:38:12Z", "message": "update header\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4093bcbc40eedb7b990529c4d89577a03cf2b1d7", "author": {"user": {"login": "goaway", "name": "Mike Schore"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/4093bcbc40eedb7b990529c4d89577a03cf2b1d7", "committedDate": "2020-02-13T22:39:37Z", "message": "fix comments\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU4NjA0ODE5", "url": "https://github.com/envoyproxy/envoy-mobile/pull/685#pullrequestreview-358604819", "createdAt": "2020-02-13T22:42:06Z", "commit": {"oid": "4093bcbc40eedb7b990529c4d89577a03cf2b1d7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4284, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}