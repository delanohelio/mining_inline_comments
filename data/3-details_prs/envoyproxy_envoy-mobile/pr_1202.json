{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM0MDI2NzEx", "number": 1202, "title": "ios: add string accessor API", "bodyText": "Description: iOS parallel to #1188\nRisk Level: low\nTesting: example app. Pending test with assertion filter.\nDocs Changes: pending full API docs\nSigned-off-by: Jose Nino jnino@lyft.com", "createdAt": "2020-12-08T00:04:26Z", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1202", "merged": true, "mergeCommit": {"oid": "433cf98d6855a02976ab0177894d1d422ab11472"}, "closed": true, "closedAt": "2021-02-11T00:27:02Z", "author": {"login": "junr03"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdj-okwgH2gAyNTM0MDI2NzExOmY0ZTc3Zjk3MTE4ZDMwMDhhMGUwN2Q3MGQzYWQxYTEwNDg0OTViMGU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABd44pzIAH2gAyNTM0MDI2NzExOjJmYTM4ZTU0ZjQyMzI0ZDUzMDUzMGRjZDhlOTRhMmU3ZDJlYzQ1YWI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f4e77f97118d3008a0e07d70d3ad1a1048495b0e", "author": {"user": {"login": "junr03", "name": "Jose Ulises Nino Rivera"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/f4e77f97118d3008a0e07d70d3ad1a1048495b0e", "committedDate": "2020-12-08T00:03:01Z", "message": "ios: add string accessor API\n\nSigned-off-by: Jose Nino <jnino@lyft.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ2NjQzMTAz", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1202#pullrequestreview-546643103", "createdAt": "2020-12-08T00:05:54Z", "commit": {"oid": "f4e77f97118d3008a0e07d70d3ad1a1048495b0e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQwMDowNTo1NFrOIBAnrg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQwMDowNTo1NFrOIBAnrg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzkyOTY0Ng==", "bodyText": "@rebello95 do I need a swift protocol to be able to useEnvoyStringAccessor objc protocol on user defined accessors?", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1202#discussion_r537929646", "createdAt": "2020-12-08T00:05:54Z", "author": {"login": "junr03"}, "path": "examples/swift/hello_world/DemoStringAccessor.swift", "diffHunk": "@@ -0,0 +1,9 @@\n+import Envoy\n+import Foundation\n+\n+/// Example of a simple HTTP filter that adds a response header.\n+struct DemoStringAccessor: EnvoyStringAccessor {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f4e77f97118d3008a0e07d70d3ad1a1048495b0e"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ2NjUwNTYw", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1202#pullrequestreview-546650560", "createdAt": "2020-12-08T00:24:27Z", "commit": {"oid": "f4e77f97118d3008a0e07d70d3ad1a1048495b0e"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQwMDoyNDoyN1rOIBBD-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQwMDoyNToxN1rOIBBFcg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzkzNjg4OQ==", "bodyText": "Sorry can you elaborate? I'm not sure what you're asking", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1202#discussion_r537936889", "createdAt": "2020-12-08T00:24:27Z", "author": {"login": "rebello95"}, "path": "examples/swift/hello_world/DemoStringAccessor.swift", "diffHunk": "@@ -0,0 +1,9 @@\n+import Envoy\n+import Foundation\n+\n+/// Example of a simple HTTP filter that adds a response header.\n+struct DemoStringAccessor: EnvoyStringAccessor {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzkyOTY0Ng=="}, "originalCommit": {"oid": "f4e77f97118d3008a0e07d70d3ad1a1048495b0e"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzkzNzI2Ng==", "bodyText": "Have we considered registering a lambda/closure that returns a string instead? That'll probably be easier to interact with on the platform layer, since getString() is a little overly generic IMO", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1202#discussion_r537937266", "createdAt": "2020-12-08T00:25:17Z", "author": {"login": "rebello95"}, "path": "library/objective-c/EnvoyEngineImpl.m", "diffHunk": "@@ -261,6 +268,17 @@ - (int)registerFilterFactory:(EnvoyHTTPFilterFactory *)filterFactory {\n   return kEnvoySuccess;\n }\n \n+- (int)registerStringAccessor:(NSString *)name\n+               stringAccessor:(EnvoyStringAccessor *)stringAccessor {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f4e77f97118d3008a0e07d70d3ad1a1048495b0e"}, "originalPosition": 26}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "09e3750d0dad801df45849a5e59ec80c9eb36cb0", "author": {"user": {"login": "junr03", "name": "Jose Ulises Nino Rivera"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/09e3750d0dad801df45849a5e59ec80c9eb36cb0", "committedDate": "2020-12-17T22:49:27Z", "message": "Merge branch 'main' into ios-string-accessor\n\nSigned-off-by: Jose Nino <jnino@lyft.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a5e8a9a66e601447a2369718e78f1363ba4fc294", "author": {"user": {"login": "junr03", "name": "Jose Ulises Nino Rivera"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/a5e8a9a66e601447a2369718e78f1363ba4fc294", "committedDate": "2020-12-18T01:49:45Z", "message": "type trouble\n\nSigned-off-by: Jose Nino <jnino@lyft.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7db0f01d031ed55c2bd4e15195991a521acb68ee", "author": {"user": {"login": "junr03", "name": "Jose Ulises Nino Rivera"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/7db0f01d031ed55c2bd4e15195991a521acb68ee", "committedDate": "2020-12-19T00:41:49Z", "message": "updated\n\nSigned-off-by: Jose Nino <jnino@lyft.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a01d50feb5d75b591e42363f55e10b67c23f2004", "author": {"user": {"login": "junr03", "name": "Jose Ulises Nino Rivera"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/a01d50feb5d75b591e42363f55e10b67c23f2004", "committedDate": "2020-12-19T01:25:37Z", "message": "test\n\nSigned-off-by: Jose Nino <jnino@lyft.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU1OTAyODQx", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1202#pullrequestreview-555902841", "createdAt": "2020-12-19T01:30:56Z", "commit": {"oid": "a01d50feb5d75b591e42363f55e10b67c23f2004"}, "state": "DISMISSED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOVQwMTozMDo1N1rOII3oWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOVQwMTozMjozMFrOII3pLQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjE3MDk2OQ==", "bodyText": "You could use a for loop here like on line 313 above \ud83e\udd37\ud83c\udffd\u200d\u2642\ufe0f", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1202#discussion_r546170969", "createdAt": "2020-12-19T01:30:57Z", "author": {"login": "rebello95"}, "path": "library/objective-c/EnvoyEngineImpl.m", "diffHunk": "@@ -297,6 +314,10 @@ - (int)runWithConfig:(EnvoyConfiguration *)config\n     [self registerFilterFactory:filterFactory];\n   }\n \n+  [config.stringAccessors enumerateKeysAndObjectsUsingBlock:^(id name, id accessor, BOOL *stop) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a01d50feb5d75b591e42363f55e10b67c23f2004"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjE3MDk3OA==", "bodyText": "Same here", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1202#discussion_r546170978", "createdAt": "2020-12-19T01:31:01Z", "author": {"login": "rebello95"}, "path": "library/objective-c/EnvoyEngineImpl.m", "diffHunk": "@@ -313,6 +334,10 @@ - (int)runWithTemplate:(NSString *)yaml\n     [self registerFilterFactory:filterFactory];\n   }\n \n+  [config.stringAccessors enumerateKeysAndObjectsUsingBlock:^(id name, id accessor, BOOL *stop) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a01d50feb5d75b591e42363f55e10b67c23f2004"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjE3MTE0Mg==", "bodyText": "A better test might be doing XCTAssertEqual(\"hello\", config.stringAccessors. getEnvoyString())", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1202#discussion_r546171142", "createdAt": "2020-12-19T01:32:16Z", "author": {"login": "rebello95"}, "path": "library/swift/test/EngineBuilderTests.swift", "diffHunk": "@@ -199,6 +199,20 @@ final class EngineBuilderTests: XCTestCase {\n     self.waitForExpectations(timeout: 0.01)\n   }\n \n+  func testAddingStringAccessorToConfigurationWhenRunningEnvoy() throws {\n+    let expectation = self.expectation(description: \"Run called with expected data\")\n+    MockEnvoyEngine.onRunWithConfig = { config, _ in\n+      XCTAssertEqual(1, config.stringAccessors.count)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a01d50feb5d75b591e42363f55e10b67c23f2004"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjE3MTE4MQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  .addStringAccessor(name: \"name\", accessor: { return \"hello\"})\n          \n          \n            \n                  .addStringAccessor(name: \"name\", accessor: { \"hello\" })\n          \n      \n    \n    \n  \n\nThis is equivalent if you want", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1202#discussion_r546171181", "createdAt": "2020-12-19T01:32:30Z", "author": {"login": "rebello95"}, "path": "library/swift/test/EngineBuilderTests.swift", "diffHunk": "@@ -199,6 +199,20 @@ final class EngineBuilderTests: XCTestCase {\n     self.waitForExpectations(timeout: 0.01)\n   }\n \n+  func testAddingStringAccessorToConfigurationWhenRunningEnvoy() throws {\n+    let expectation = self.expectation(description: \"Run called with expected data\")\n+    MockEnvoyEngine.onRunWithConfig = { config, _ in\n+      XCTAssertEqual(1, config.stringAccessors.count)\n+      expectation.fulfill()\n+    }\n+\n+    _ = try EngineBuilder()\n+      .addEngineType(MockEnvoyEngine.self)\n+      .addStringAccessor(name: \"name\", accessor: { return \"hello\"})", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a01d50feb5d75b591e42363f55e10b67c23f2004"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b2d74405c81a5954b3d3d3e0dbe69a7eb9721256", "author": {"user": {"login": "junr03", "name": "Jose Ulises Nino Rivera"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/b2d74405c81a5954b3d3d3e0dbe69a7eb9721256", "committedDate": "2020-12-19T01:32:58Z", "message": "fmt\n\nSigned-off-by: Jose Nino <jnino@lyft.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "754f1913739cb6507e85b9458ae7d3609a84c34c", "author": {"user": {"login": "junr03", "name": "Jose Ulises Nino Rivera"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/754f1913739cb6507e85b9458ae7d3609a84c34c", "committedDate": "2021-01-08T19:36:25Z", "message": "comments\n\nSigned-off-by: Jose Nino <jnino@lyft.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "54ebd895b19e3530d81b1d46cd09701174018a6f", "author": {"user": {"login": "junr03", "name": "Jose Ulises Nino Rivera"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/54ebd895b19e3530d81b1d46cd09701174018a6f", "committedDate": "2021-01-08T19:36:54Z", "message": "Merge branch 'main' into ios-string-accessor\n\nSigned-off-by: Jose Nino <jnino@lyft.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ac0cecf40ff943fa3f16ed92f5c9579b08925ea4", "author": {"user": {"login": "junr03", "name": "Jose Ulises Nino Rivera"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/ac0cecf40ff943fa3f16ed92f5c9579b08925ea4", "committedDate": "2021-01-08T21:50:49Z", "message": "test\n\nSigned-off-by: Jose Nino <jnino@lyft.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY1Njc0OTU0", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1202#pullrequestreview-565674954", "createdAt": "2021-01-11T19:34:19Z", "commit": {"oid": "ac0cecf40ff943fa3f16ed92f5c9579b08925ea4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xMVQxOTozNDoyMFrOIRkMcQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xMVQxOTozNDoyMFrOIRkMcQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTI4OTcxMw==", "bodyText": "Is this true in the context of a string accessor? Seems like it should be deallocated after usage since this is creating new strings each time it's accessed?", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1202#discussion_r555289713", "createdAt": "2021-01-11T19:34:20Z", "author": {"login": "rebello95"}, "path": "library/objective-c/EnvoyEngineImpl.m", "diffHunk": "@@ -284,6 +291,16 @@ - (int)registerFilterFactory:(EnvoyHTTPFilterFactory *)filterFactory {\n   return kEnvoySuccess;\n }\n \n+- (int)registerStringAccessor:(NSString *)name accessor:(EnvoyStringAccessor *)accessor {\n+  // TODO(goaway): Everything here leaks, but it's all be tied to the life of the engine.\n+  // This will need to be updated for https://github.com/lyft/envoy-mobile/issues/332", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ac0cecf40ff943fa3f16ed92f5c9579b08925ea4"}, "originalPosition": 27}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY1NjgxMTIx", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1202#pullrequestreview-565681121", "createdAt": "2021-01-11T19:43:08Z", "commit": {"oid": "ac0cecf40ff943fa3f16ed92f5c9579b08925ea4"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "04e60ea1e447b06fd12c95e934b17f42847d346d", "author": {"user": {"login": "junr03", "name": "Jose Ulises Nino Rivera"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/04e60ea1e447b06fd12c95e934b17f42847d346d", "committedDate": "2021-01-21T17:25:44Z", "message": "Merge branch 'main' into ios-string-accessor\n\nSigned-off-by: Jose Nino <jnino@lyft.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0b0b5fa651bb2d18d9d0637c9df6aa64fbb11b9b", "author": {"user": {"login": "junr03", "name": "Jose Ulises Nino Rivera"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/0b0b5fa651bb2d18d9d0637c9df6aa64fbb11b9b", "committedDate": "2021-01-22T02:46:36Z", "message": "const\n\nSigned-off-by: Jose Nino <jnino@lyft.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3adeef04e0eb56e1bec743512359016bd012159b", "author": {"user": {"login": "junr03", "name": "Jose Ulises Nino Rivera"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/3adeef04e0eb56e1bec743512359016bd012159b", "committedDate": "2021-02-03T19:38:55Z", "message": "Merge branch 'main' into ios-string-accessor\n\nSigned-off-by: Jose Nino <jnino@lyft.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e304e96660c47ef8496946130b1f11c0df94d16a", "author": {"user": {"login": "junr03", "name": "Jose Ulises Nino Rivera"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/e304e96660c47ef8496946130b1f11c0df94d16a", "committedDate": "2021-02-10T19:40:26Z", "message": "Merge branch 'main' into ios-string-accessor\n\nSigned-off-by: Jose Nino <jnino@lyft.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8003e11fe9bd21754c4a030aaad89e85c0ba6e7b", "author": {"user": {"login": "junr03", "name": "Jose Ulises Nino Rivera"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/8003e11fe9bd21754c4a030aaad89e85c0ba6e7b", "committedDate": "2021-02-10T21:49:05Z", "message": "test\n\nSigned-off-by: Jose Nino <jnino@lyft.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2fa38e54f42324d530530dcd8e94a2e7d2ec45ab", "author": {"user": {"login": "junr03", "name": "Jose Ulises Nino Rivera"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/2fa38e54f42324d530530dcd8e94a2e7d2ec45ab", "committedDate": "2021-02-10T22:57:20Z", "message": "Revert \"test\"\n\nThis reverts commit 8003e11fe9bd21754c4a030aaad89e85c0ba6e7b.\n\nSigned-off-by: Jose Nino <jnino@lyft.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3938, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}