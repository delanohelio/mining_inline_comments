{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQyNzkyMTMz", "number": 1217, "title": "python: update headers from impl experience", "bodyText": "Description: This PR contains only the header changes from #1209 which were made while developing. The plan is:\n\nGet this PR merged\nSplit the concrete implementations of #1209 up by category (e.g. engine vs. stream vs. headers types)\nBe able to parallelize review process\n\nRisk Level: Low\nTesting: N/A, no behavior changes\nDocs Changes: N/A\nRelease Notes: N/A", "createdAt": "2020-12-18T21:56:50Z", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1217", "merged": true, "mergeCommit": {"oid": "0aab4348addc7f9156dc32ace6f9eb7c995404a9"}, "closed": true, "closedAt": "2021-01-06T13:10:01Z", "author": {"login": "crockeo"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABds6TiMAFqTU2MTIzMDE2OA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdtRaWuAFqTU2MjEyODc0Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYxMjMwMTY4", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1217#pullrequestreview-561230168", "createdAt": "2021-01-04T18:05:43Z", "commit": {"oid": "b6a6519bc45a3501c3e66ba170d7da120ed5987b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQxODowNTo0NFrOIN7jlw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQxODowNTo0NFrOIN7jlw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTQ3ODE2Nw==", "bodyText": "My inclination is not to introduce std::vector<uint8_t> as a buffer representation unless there's a good pythonic reason for doing so. Can we simply directly use envoy_data?", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1217#discussion_r551478167", "createdAt": "2021-01-04T18:05:44Z", "author": {"login": "goaway"}, "path": "library/cc/bridge_utility.h", "diffHunk": "@@ -0,0 +1,21 @@\n+#pragma once\n+\n+#include <string>\n+#include <vector>\n+\n+#include \"headers.h\"\n+#include \"library/common/types/c_types.h\"\n+\n+namespace Envoy {\n+namespace Platform {\n+\n+envoy_data buffer_as_envoy_data(const std::vector<uint8_t>& data);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b6a6519bc45a3501c3e66ba170d7da120ed5987b"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYxMjM2Nzky", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1217#pullrequestreview-561236792", "createdAt": "2021-01-04T18:16:22Z", "commit": {"oid": "b6a6519bc45a3501c3e66ba170d7da120ed5987b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQxODoxNjoyMlrOIN73yA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQxODoxNjoyMlrOIN73yA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTQ4MzMzNg==", "bodyText": "Maybe c_on_headers?", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1217#discussion_r551483336", "createdAt": "2021-01-04T18:16:22Z", "author": {"login": "goaway"}, "path": "library/cc/stream_callbacks.h", "diffHunk": "@@ -32,9 +36,21 @@ class EnvoyHttpCallbacksAdapter {\n public:\n   EnvoyHttpCallbacksAdapter(ExecutorSharedPtr executor, StreamCallbacksSharedPtr callbacks);\n \n+  envoy_http_callbacks as_envoy_http_callbacks();\n+\n private:\n+  static void* dispatch_on_headers(envoy_headers headers, bool end_stream, void* context);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b6a6519bc45a3501c3e66ba170d7da120ed5987b"}, "originalPosition": 45}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYxMjM4OTc0", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1217#pullrequestreview-561238974", "createdAt": "2021-01-04T18:19:46Z", "commit": {"oid": "b6a6519bc45a3501c3e66ba170d7da120ed5987b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQxODoxOTo0NlrOIN7-fQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQxODoxOTo0NlrOIN7-fQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTQ4NTA1Mw==", "bodyText": "Maybe RawHeaderMap?", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1217#discussion_r551485053", "createdAt": "2021-01-04T18:19:46Z", "author": {"login": "goaway"}, "path": "library/cc/headers.h", "diffHunk": "@@ -1,12 +1,13 @@\n #pragma once\n \n-// NOLINT(namespace-envoy)\n-\n #include <string>\n #include <vector>\n \n #include \"absl/container/flat_hash_map.h\"\n \n+namespace Envoy {\n+namespace Platform {\n+\n using RawHeaders = absl::flat_hash_map<std::string, std::vector<std::string>>;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b6a6519bc45a3501c3e66ba170d7da120ed5987b"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYxMjQ5ODA5", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1217#pullrequestreview-561249809", "createdAt": "2021-01-04T18:37:03Z", "commit": {"oid": "b6a6519bc45a3501c3e66ba170d7da120ed5987b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQxODozNzowNFrOIN8f6Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQxODozNzowNFrOIN8f6Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTQ5MzYwOQ==", "bodyText": "Envoy has a PURE macro we should use for this.", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1217#discussion_r551493609", "createdAt": "2021-01-04T18:37:04Z", "author": {"login": "goaway"}, "path": "library/cc/executor.h", "diffHunk": "@@ -1,15 +1,19 @@\n #pragma once\n \n-// NOLINT(namespace-envoy)\n-\n #include <functional>\n #include <memory>\n \n+namespace Envoy {\n+namespace Platform {\n+\n class Executor {\n public:\n-  virtual ~Executor();\n+  virtual ~Executor() {}\n \n   virtual void execute(std::function<void()> closure) = 0;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b6a6519bc45a3501c3e66ba170d7da120ed5987b"}, "originalPosition": 16}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYxMjUwMjky", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1217#pullrequestreview-561250292", "createdAt": "2021-01-04T18:37:53Z", "commit": {"oid": "b6a6519bc45a3501c3e66ba170d7da120ed5987b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQxODozNzo1M1rOIN8hfQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQxODozNzo1M1rOIN8hfQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTQ5NDAxMw==", "bodyText": "Use PURE macro (though it's commented out).", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1217#discussion_r551494013", "createdAt": "2021-01-04T18:37:53Z", "author": {"login": "goaway"}, "path": "library/cc/pulse_client.h", "diffHunk": "@@ -1,20 +1,20 @@\n #pragma once\n \n-// NOLINT(namespace-envoy)\n-\n #include <memory>\n \n+namespace Envoy {\n+namespace Platform {\n+\n // TODO(crockeo): although this is stubbed out since it's in the main directory, it depends on\n // objects defined under stats. this will not be fully stubbed until stats is stubbed\n \n-// #include \"stats/counter.h\"\n-// #include \"stats/element.h\"\n-// #include \"stats/gauge.h\"\n-\n class PulseClient {\n public:\n   // virtual Counter counter(Element element) = 0;\n   // virtual Gauge gauge(Element element) = 0;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b6a6519bc45a3501c3e66ba170d7da120ed5987b"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYyMDMzNDM5", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1217#pullrequestreview-562033439", "createdAt": "2021-01-05T18:33:31Z", "commit": {"oid": "b6a6519bc45a3501c3e66ba170d7da120ed5987b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNVQxODozMzozMVrOIOikLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNVQxODozMzozMVrOIOikLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjExNzI5NA==", "bodyText": "I'm still not certain that we need this. If callbacks in this context are std::function then they can have all the state embedded they need for dispatch. I'm not sure there's really a need for the new interface, and I'm a little bit hesitant to introduce one that bindings will come to rely on.", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1217#discussion_r552117294", "createdAt": "2021-01-05T18:33:31Z", "author": {"login": "goaway"}, "path": "library/cc/executor.h", "diffHunk": "@@ -1,15 +1,19 @@\n #pragma once\n \n-// NOLINT(namespace-envoy)\n-\n #include <functional>\n #include <memory>\n \n+namespace Envoy {\n+namespace Platform {\n+\n class Executor {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b6a6519bc45a3501c3e66ba170d7da120ed5987b"}, "originalPosition": 11}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "63dbe6c8877d2898fc1030eb4e24796e3a76a93f", "author": {"user": {"login": "crockeo", "name": "Cerek Hillen"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/63dbe6c8877d2898fc1030eb4e24796e3a76a93f", "committedDate": "2021-01-05T18:51:38Z", "message": "update headers from impl experience\n\nSigned-off-by: Cerek Hillen <chillen@lyft.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c3543c4db5f5ee414e7d506f058de1b7a265e6e", "author": {"user": {"login": "crockeo", "name": "Cerek Hillen"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/5c3543c4db5f5ee414e7d506f058de1b7a265e6e", "committedDate": "2021-01-05T18:51:38Z", "message": "easy comments\n\nSigned-off-by: Cerek Hillen <chillen@lyft.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8222d22a4dc06d6ea860b68469bf6bd2c9224baa", "author": {"user": {"login": "crockeo", "name": "Cerek Hillen"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/8222d22a4dc06d6ea860b68469bf6bd2c9224baa", "committedDate": "2021-01-05T18:51:38Z", "message": "move away from std::vector<uint8_t>\n\nSigned-off-by: Cerek Hillen <chillen@lyft.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c6b410a728b22610fde15afb43cffac6274651f", "author": {"user": {"login": "crockeo", "name": "Cerek Hillen"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/5c6b410a728b22610fde15afb43cffac6274651f", "committedDate": "2021-01-05T18:51:38Z", "message": "define shim functions so python sees bytes objects\n\nSigned-off-by: Cerek Hillen <chillen@lyft.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "81b2bd47ec4f2728e179e902b7f6a130ca3bd293", "author": {"user": {"login": "crockeo", "name": "Cerek Hillen"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/81b2bd47ec4f2728e179e902b7f6a130ca3bd293", "committedDate": "2021-01-05T18:39:19Z", "message": "define shim functions so python sees bytes objects\n\nSigned-off-by: Cerek Hillen <chillen@lyft.com>"}, "afterCommit": {"oid": "5c6b410a728b22610fde15afb43cffac6274651f", "author": {"user": {"login": "crockeo", "name": "Cerek Hillen"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/5c6b410a728b22610fde15afb43cffac6274651f", "committedDate": "2021-01-05T18:51:38Z", "message": "define shim functions so python sees bytes objects\n\nSigned-off-by: Cerek Hillen <chillen@lyft.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c900cc4d295a370ed15301a67b2f2e201bf590ed", "author": {"user": {"login": "crockeo", "name": "Cerek Hillen"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/c900cc4d295a370ed15301a67b2f2e201bf590ed", "committedDate": "2021-01-05T19:13:27Z", "message": "remove executor class\n\nSigned-off-by: Cerek Hillen <chillen@lyft.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "686241f194e72d7d541f2c693a84274802dc5692", "author": {"user": {"login": "crockeo", "name": "Cerek Hillen"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/686241f194e72d7d541f2c693a84274802dc5692", "committedDate": "2021-01-05T20:52:49Z", "message": "last 2 changes\n\nSigned-off-by: Cerek Hillen <chillen@lyft.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYyMTI4NzQ3", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1217#pullrequestreview-562128747", "createdAt": "2021-01-05T21:01:00Z", "commit": {"oid": "686241f194e72d7d541f2c693a84274802dc5692"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3961, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}