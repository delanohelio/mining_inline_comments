{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkwMTE1MDE5", "number": 756, "title": "config: add app metadata to node config", "bodyText": "Description: this PR adds app_version and app_id to the available fields in the node metadata for Envoy Mobile's config. It also adds Client Builder functions to allow the user to override these values. These values can be used to identify the clients making use of Envoy Mobile.\nNote that we have discussed making the information in the node metadata fully dynamic. However, that type of change bears some more thinking implementation wise. I am tracking this in #755.\nRisk Level: low, adds new information to the node metadata.\nTesting: added unit tests.\nDocs Changes: updated the client builder docs.\nSigned-off-by: Jose Nino jnino@lyft.com", "createdAt": "2020-03-17T22:41:38Z", "url": "https://github.com/envoyproxy/envoy-mobile/pull/756", "merged": true, "mergeCommit": {"oid": "b2286d4d4b1938e38b85eba14f911ad886b1648e"}, "closed": true, "closedAt": "2020-03-19T01:19:22Z", "author": {"login": "junr03"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcOqCrzAH2gAyMzkwMTE1MDE5OjNmNjM4NjE4MzRiNTg2NDcyNTgyYTcwZGU4MmY1MTE2NjA5NTg1YzU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcPBHy9AFqTM3NzM0Mzc4MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3f63861834b586472582a70de82f5116609585c5", "author": {"user": {"login": "junr03", "name": "Jose Ulises Nino Rivera"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/3f63861834b586472582a70de82f5116609585c5", "committedDate": "2020-03-17T21:59:58Z", "message": "config: add app metadata to node config\n\nSigned-off-by: Jose Nino <jnino@lyft.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7278af20f4204e4d492ef931aadc9ddea050018a", "author": {"user": {"login": "junr03", "name": "Jose Ulises Nino Rivera"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/7278af20f4204e4d492ef931aadc9ddea050018a", "committedDate": "2020-03-17T22:40:40Z", "message": "docs\n\nSigned-off-by: Jose Nino <jnino@lyft.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3MDcxMzkw", "url": "https://github.com/envoyproxy/envoy-mobile/pull/756#pullrequestreview-377071390", "createdAt": "2020-03-18T17:12:10Z", "commit": {"oid": "7278af20f4204e4d492ef931aadc9ddea050018a"}, "state": "COMMENTED", "comments": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxNzoxMjoxMVrOF4O8QA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxNzoxNToyOVrOF4PEHw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDUwOTM3Ng==", "bodyText": "These seem excessively long \ud83e\udd14 didn't know this was valid", "url": "https://github.com/envoyproxy/envoy-mobile/pull/756#discussion_r394509376", "createdAt": "2020-03-18T17:12:11Z", "author": {"login": "rebello95"}, "path": "docs/root/api/starting_envoy.rst", "diffHunk": "@@ -135,6 +133,36 @@ Note that the library automatically flushes stats on application backgrounding/t\n   // Swift\n   builder.addStatsFlushSeconds(5)\n \n+~~~~~~~~~~~~~~~~~~~~~~~~\n+``addAppVersion``\n+~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+Specify the version of the app using Envoy Mobile. This information is sent as identifying\n+information when flushing metrics.\n+\n+**Example**::\n+\n+  // Kotlin\n+  builder.addAppVersion(\"version\")\n+\n+  // Swift\n+  builder.addAppVersion(\"version\")\n+\n+~~~~~~~~~~~~~~~~~~~~~~~~", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7278af20f4204e4d492ef931aadc9ddea050018a"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDUxMDE3Mw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            information when flushing metrics.\n          \n          \n            \n            additional metadata when flushing stats.", "url": "https://github.com/envoyproxy/envoy-mobile/pull/756#discussion_r394510173", "createdAt": "2020-03-18T17:13:26Z", "author": {"login": "rebello95"}, "path": "docs/root/api/starting_envoy.rst", "diffHunk": "@@ -135,6 +133,36 @@ Note that the library automatically flushes stats on application backgrounding/t\n   // Swift\n   builder.addStatsFlushSeconds(5)\n \n+~~~~~~~~~~~~~~~~~~~~~~~~\n+``addAppVersion``\n+~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+Specify the version of the app using Envoy Mobile. This information is sent as identifying\n+information when flushing metrics.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7278af20f4204e4d492ef931aadc9ddea050018a"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDUxMDMxNw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              builder.addAppVersion(\"version\")\n          \n          \n            \n              builder.addAppVersion(\"v1.2.3\")", "url": "https://github.com/envoyproxy/envoy-mobile/pull/756#discussion_r394510317", "createdAt": "2020-03-18T17:13:38Z", "author": {"login": "rebello95"}, "path": "docs/root/api/starting_envoy.rst", "diffHunk": "@@ -135,6 +133,36 @@ Note that the library automatically flushes stats on application backgrounding/t\n   // Swift\n   builder.addStatsFlushSeconds(5)\n \n+~~~~~~~~~~~~~~~~~~~~~~~~\n+``addAppVersion``\n+~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+Specify the version of the app using Envoy Mobile. This information is sent as identifying\n+information when flushing metrics.\n+\n+**Example**::\n+\n+  // Kotlin\n+  builder.addAppVersion(\"version\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7278af20f4204e4d492ef931aadc9ddea050018a"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDUxMDM5Mw==", "bodyText": "I think it'd be nice to exemplify how this might be used", "url": "https://github.com/envoyproxy/envoy-mobile/pull/756#discussion_r394510393", "createdAt": "2020-03-18T17:13:48Z", "author": {"login": "rebello95"}, "path": "docs/root/api/starting_envoy.rst", "diffHunk": "@@ -135,6 +133,36 @@ Note that the library automatically flushes stats on application backgrounding/t\n   // Swift\n   builder.addStatsFlushSeconds(5)\n \n+~~~~~~~~~~~~~~~~~~~~~~~~\n+``addAppVersion``\n+~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+Specify the version of the app using Envoy Mobile. This information is sent as identifying\n+information when flushing metrics.\n+\n+**Example**::\n+\n+  // Kotlin\n+  builder.addAppVersion(\"version\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDUxMDMxNw=="}, "originalCommit": {"oid": "7278af20f4204e4d492ef931aadc9ddea050018a"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDUxMDQ0MQ==", "bodyText": "Same here", "url": "https://github.com/envoyproxy/envoy-mobile/pull/756#discussion_r394510441", "createdAt": "2020-03-18T17:13:52Z", "author": {"login": "rebello95"}, "path": "docs/root/api/starting_envoy.rst", "diffHunk": "@@ -135,6 +133,36 @@ Note that the library automatically flushes stats on application backgrounding/t\n   // Swift\n   builder.addStatsFlushSeconds(5)\n \n+~~~~~~~~~~~~~~~~~~~~~~~~\n+``addAppVersion``\n+~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+Specify the version of the app using Envoy Mobile. This information is sent as identifying\n+information when flushing metrics.\n+\n+**Example**::\n+\n+  // Kotlin\n+  builder.addAppVersion(\"version\")\n+\n+  // Swift\n+  builder.addAppVersion(\"version\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7278af20f4204e4d492ef931aadc9ddea050018a"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDUxMDcxNA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            information when flushing metrics.\n          \n          \n            \n            additional metadata when flushing stats.", "url": "https://github.com/envoyproxy/envoy-mobile/pull/756#discussion_r394510714", "createdAt": "2020-03-18T17:14:19Z", "author": {"login": "rebello95"}, "path": "docs/root/api/starting_envoy.rst", "diffHunk": "@@ -135,6 +133,36 @@ Note that the library automatically flushes stats on application backgrounding/t\n   // Swift\n   builder.addStatsFlushSeconds(5)\n \n+~~~~~~~~~~~~~~~~~~~~~~~~\n+``addAppVersion``\n+~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+Specify the version of the app using Envoy Mobile. This information is sent as identifying\n+information when flushing metrics.\n+\n+**Example**::\n+\n+  // Kotlin\n+  builder.addAppVersion(\"version\")\n+\n+  // Swift\n+  builder.addAppVersion(\"version\")\n+\n+~~~~~~~~~~~~~~~~~~~~~~~~\n+``addId``\n+~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+Specify the ID of the app using Envoy Mobile. This information is sent as identifying\n+information when flushing metrics.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7278af20f4204e4d492ef931aadc9ddea050018a"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDUxMDg3Mw==", "bodyText": "com.mydomain.myapp", "url": "https://github.com/envoyproxy/envoy-mobile/pull/756#discussion_r394510873", "createdAt": "2020-03-18T17:14:35Z", "author": {"login": "rebello95"}, "path": "docs/root/api/starting_envoy.rst", "diffHunk": "@@ -135,6 +133,36 @@ Note that the library automatically flushes stats on application backgrounding/t\n   // Swift\n   builder.addStatsFlushSeconds(5)\n \n+~~~~~~~~~~~~~~~~~~~~~~~~\n+``addAppVersion``\n+~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+Specify the version of the app using Envoy Mobile. This information is sent as identifying\n+information when flushing metrics.\n+\n+**Example**::\n+\n+  // Kotlin\n+  builder.addAppVersion(\"version\")\n+\n+  // Swift\n+  builder.addAppVersion(\"version\")\n+\n+~~~~~~~~~~~~~~~~~~~~~~~~\n+``addId``\n+~~~~~~~~~~~~~~~~~~~~~~~~\n+\n+Specify the ID of the app using Envoy Mobile. This information is sent as identifying\n+information when flushing metrics.\n+\n+**Example**::\n+\n+  // Kotlin\n+  builder.addId(\"id\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7278af20f4204e4d492ef931aadc9ddea050018a"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDUxMDk1Ng==", "bodyText": "nit: alphabetical order on these?", "url": "https://github.com/envoyproxy/envoy-mobile/pull/756#discussion_r394510956", "createdAt": "2020-03-18T17:14:45Z", "author": {"login": "rebello95"}, "path": "library/common/config_template.cc", "diffHunk": "@@ -172,4 +172,6 @@ stats_flush_interval: {{ stats_flush_interval_seconds }}s\n node:\n   metadata:\n     os: {{ device_os }}\n+    app_version : {{ app_version }}\n+    app_id : {{ app_id }}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7278af20f4204e4d492ef931aadc9ddea050018a"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDUxMTE3NQ==", "bodyText": "nit: lowercase app version/app ID", "url": "https://github.com/envoyproxy/envoy-mobile/pull/756#discussion_r394511175", "createdAt": "2020-03-18T17:15:08Z", "author": {"login": "rebello95"}, "path": "library/java/src/io/envoyproxy/envoymobile/engine/EnvoyConfiguration.java", "diffHunk": "@@ -19,16 +21,20 @@\n    * @param dnsFailureRefreshSecondsBase base rate in seconds to refresh DNS on failure.\n    * @param dnsFailureRefreshSecondsMax  max rate in seconds to refresh DNS on failure.\n    * @param statsFlushSeconds            interval at which to flush Envoy stats.\n+   * @param appVersion                   the App Version of the App using this Envoy Client.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7278af20f4204e4d492ef931aadc9ddea050018a"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDUxMTM5MQ==", "bodyText": "Let's use mock version strings like the docs comments above", "url": "https://github.com/envoyproxy/envoy-mobile/pull/756#discussion_r394511391", "createdAt": "2020-03-18T17:15:29Z", "author": {"login": "rebello95"}, "path": "library/java/test/io/envoyproxy/envoymobile/engine/EnvoyConfigurationTest.kt", "diffHunk": "@@ -31,12 +33,14 @@ class EnvoyConfigurationTest {\n     assertThat(resolvedTemplate).contains(\"max_interval: 456s\")\n     assertThat(resolvedTemplate).contains(\"stats_flush_interval: 567s\")\n     assertThat(resolvedTemplate).contains(\"os: Android\")\n+    assertThat(resolvedTemplate).contains(\"app_version: version\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7278af20f4204e4d492ef931aadc9ddea050018a"}, "originalPosition": 22}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "09c4e935ce30df8c642fe3317d50027205fb10f6", "author": {"user": {"login": "junr03", "name": "Jose Ulises Nino Rivera"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/09c4e935ce30df8c642fe3317d50027205fb10f6", "committedDate": "2020-03-18T22:59:13Z", "message": "comments\n\nSigned-off-by: Jose Nino <jnino@lyft.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3MzEzNjgz", "url": "https://github.com/envoyproxy/envoy-mobile/pull/756#pullrequestreview-377313683", "createdAt": "2020-03-18T23:44:11Z", "commit": {"oid": "09c4e935ce30df8c642fe3317d50027205fb10f6"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3MzI3MDEx", "url": "https://github.com/envoyproxy/envoy-mobile/pull/756#pullrequestreview-377327011", "createdAt": "2020-03-19T00:10:15Z", "commit": {"oid": "09c4e935ce30df8c642fe3317d50027205fb10f6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQwMDoxMDoxNVrOF4bJVw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQwMDoxMDoxNVrOF4bJVw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDcwOTMzNQ==", "bodyText": "Shouldn't this work?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        .replace(\"{{ app_version }}\", String.format(\"%s\", appVersion))\n          \n          \n            \n                        .replace(\"{{ app_id }}\", String.format(\"%s\", appId));\n          \n          \n            \n                        .replace(\"{{ app_version }}\", appVersion)\n          \n          \n            \n                        .replace(\"{{ app_id }}\", appId);", "url": "https://github.com/envoyproxy/envoy-mobile/pull/756#discussion_r394709335", "createdAt": "2020-03-19T00:10:15Z", "author": {"login": "buildbreaker"}, "path": "library/java/src/io/envoyproxy/envoymobile/engine/EnvoyConfiguration.java", "diffHunk": "@@ -50,7 +56,9 @@ String resolveTemplate(String templateYAML) {\n             .replace(\"{{ dns_failure_refresh_rate_seconds_max }}\",\n                      String.format(\"%s\", dnsFailureRefreshSecondsMax))\n             .replace(\"{{ stats_flush_interval_seconds }}\", String.format(\"%s\", statsFlushSeconds))\n-            .replace(\"{{ device_os }}\", \"Android\");\n+            .replace(\"{{ device_os }}\", \"Android\")\n+            .replace(\"{{ app_version }}\", String.format(\"%s\", appVersion))\n+            .replace(\"{{ app_id }}\", String.format(\"%s\", appId));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "09c4e935ce30df8c642fe3317d50027205fb10f6"}, "originalPosition": 38}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3MzMxNDY5", "url": "https://github.com/envoyproxy/envoy-mobile/pull/756#pullrequestreview-377331469", "createdAt": "2020-03-19T00:12:55Z", "commit": {"oid": "09c4e935ce30df8c642fe3317d50027205fb10f6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQwMDoxMjo1NVrOF4bMZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOVQwMDoxMjo1NVrOF4bMZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDcxMDExOQ==", "bodyText": "We should move forward with these changes but something that we will need to figure out when we revisit our ergononmics:\nThese properties leak the Android abstraction onto the EnvoyConfiguration :(\nIdeally, we should have a separate configuration for Android and Java libraries", "url": "https://github.com/envoyproxy/envoy-mobile/pull/756#discussion_r394710119", "createdAt": "2020-03-19T00:12:55Z", "author": {"login": "buildbreaker"}, "path": "library/java/src/io/envoyproxy/envoymobile/engine/EnvoyConfiguration.java", "diffHunk": "@@ -50,7 +56,9 @@ String resolveTemplate(String templateYAML) {\n             .replace(\"{{ dns_failure_refresh_rate_seconds_max }}\",\n                      String.format(\"%s\", dnsFailureRefreshSecondsMax))\n             .replace(\"{{ stats_flush_interval_seconds }}\", String.format(\"%s\", statsFlushSeconds))\n-            .replace(\"{{ device_os }}\", \"Android\");\n+            .replace(\"{{ device_os }}\", \"Android\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "09c4e935ce30df8c642fe3317d50027205fb10f6"}, "originalPosition": 36}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bad799cf24ff06e22bd806b864fb69f89503cde3", "author": {"user": {"login": "junr03", "name": "Jose Ulises Nino Rivera"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/bad799cf24ff06e22bd806b864fb69f89503cde3", "committedDate": "2020-03-19T00:43:13Z", "message": "comments\n\nSigned-off-by: Jose Nino <jnino@lyft.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3MzQzNzgw", "url": "https://github.com/envoyproxy/envoy-mobile/pull/756#pullrequestreview-377343780", "createdAt": "2020-03-19T00:53:22Z", "commit": {"oid": "bad799cf24ff06e22bd806b864fb69f89503cde3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4317, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}