{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA4MjU0NDE1", "number": 811, "title": "config: fix max concurrent retries circuit breaker", "bodyText": "Description: while investigating retry scenarios I noticed that some retries were not getting performed due to overflow. This PR actually increases the concurrency limit. More information can be found in the PR comments.\nRisk Level: med - this change actually allows higher retry concurrency.\nTesting: local testing\nSigned-off-by: Jose Nino jnino@lyft.com", "createdAt": "2020-04-23T23:41:56Z", "url": "https://github.com/envoyproxy/envoy-mobile/pull/811", "merged": true, "mergeCommit": {"oid": "d99337234d27c47f33bc0b1850677526183a30fe"}, "closed": true, "closedAt": "2020-04-27T20:00:41Z", "author": {"login": "junr03"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcalmQNgH2gAyNDA4MjU0NDE1OmIzMWVmMTdmMDFhNTkyMTVkODc2ODUwNjVhZDFhMWZjYmQxOGZiMmU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABca67KtAFqTQwMDMzNDc2Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b31ef17f01a59215d87685065ad1a1fcbd18fb2e", "author": {"user": {"login": "junr03", "name": "Jose Ulises Nino Rivera"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/b31ef17f01a59215d87685065ad1a1fcbd18fb2e", "committedDate": "2020-04-23T23:36:23Z", "message": "config: fix max concurrent retries circuit breaker\n\nSigned-off-by: Jose Nino <jnino@lyft.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5NTYwOTEw", "url": "https://github.com/envoyproxy/envoy-mobile/pull/811#pullrequestreview-399560910", "createdAt": "2020-04-24T00:14:31Z", "commit": {"oid": "b31ef17f01a59215d87685065ad1a1fcbd18fb2e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQwMDoxNDozMVrOGLBM9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQwMDoxNDozMVrOGLBM9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDIwNzIyMQ==", "bodyText": "Why not just add a min_retry_concurrency? See:\nhttps://www.envoyproxy.io/docs/envoy/latest/api-v2/api/v2/cluster/circuit_breaker.proto#cluster-circuitbreakers-thresholds-retrybudget", "url": "https://github.com/envoyproxy/envoy-mobile/pull/811#discussion_r414207221", "createdAt": "2020-04-24T00:14:31Z", "author": {"login": "tonya11en"}, "path": "library/common/config_template.cc", "diffHunk": "@@ -74,14 +74,12 @@ const char* config_template = R\"(\n       thresholds:\n         - priority: DEFAULT\n           # n.b: with mobile clients there are scenarios where all concurrent requests might be\n-          # retries (e.g., when the phone goes offline). Therefore, Envoy Mobile allows all concurrent\n-          # requests to be retries by setting the concurrent retry budget to 100%.\n+          # retries (e.g., when the phone goes offline). Therefore, Envoy Mobile allows for the same\n+          # amount of concurrency for retries as the default value for concurrency for requests.\n           # This configuration uses the default for max concurrent requests (1024) because there is\n           # no reasonable scenario where a mobile client should have even close to that many concurrent\n           # requests.\n-          retry_budget:\n-            budget_percent:\n-              value: 100\n+          max_retries: 1024", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b31ef17f01a59215d87685065ad1a1fcbd18fb2e"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwMTY4NDYy", "url": "https://github.com/envoyproxy/envoy-mobile/pull/811#pullrequestreview-400168462", "createdAt": "2020-04-24T18:13:12Z", "commit": {"oid": "b31ef17f01a59215d87685065ad1a1fcbd18fb2e"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c7a58a416d890fb48370aff00978be22c12e9ea3", "author": {"user": {"login": "junr03", "name": "Jose Ulises Nino Rivera"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/c7a58a416d890fb48370aff00978be22c12e9ea3", "committedDate": "2020-04-24T20:52:26Z", "message": "comments\n\nSigned-off-by: Jose Nino <jnino@lyft.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwMzM0NzYy", "url": "https://github.com/envoyproxy/envoy-mobile/pull/811#pullrequestreview-400334762", "createdAt": "2020-04-25T00:27:14Z", "commit": {"oid": "c7a58a416d890fb48370aff00978be22c12e9ea3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4195, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}