{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkxMjA2ODcy", "number": 1117, "title": "stats: add gauge methods to engine and interface layers", "bodyText": "Description: Adds methods to support stats type Gauge to the engine and interface layers.\nRisk Level: Medium\nTesting: Unit tests\nSigned-off-by: Jingwei Hao jingweih@lyft.com", "createdAt": "2020-09-22T21:32:40Z", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1117", "merged": true, "mergeCommit": {"oid": "b835b9113f6a28d6df84de8b46ea01812aca6b1f"}, "closed": true, "closedAt": "2020-09-27T04:43:52Z", "author": {"login": "jingwei99"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdLe4g8gH2gAyNDkxMjA2ODcyOmM1MmM4ZDdiMjU3M2I2YTNlNjg2YWEyOTBlYzg3NDEyNWRjMjFkZGY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdMc70CAH2gAyNDkxMjA2ODcyOjhhYTUyZTY2MDc3MGU1M2NkMGVkOTQyZDc4MjBjZjVjOTlhM2RiZTg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c52c8d7b2573b6a3e686aa290ec874125dc21ddf", "author": {"user": {"login": "jingwei99", "name": "Jingwei"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/c52c8d7b2573b6a3e686aa290ec874125dc21ddf", "committedDate": "2020-09-22T21:29:17Z", "message": "stats: add gauge methods to engine and interface layers\n\nSigned-off-by: Jingwei Hao <jingweih@lyft.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7621fb1c3c8d0a072a07cc87be29d5e7d12553e8", "author": {"user": {"login": "jingwei99", "name": "Jingwei"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/7621fb1c3c8d0a072a07cc87be29d5e7d12553e8", "committedDate": "2020-09-22T23:33:11Z", "message": "lint\n\nSigned-off-by: Jingwei Hao <jingweih@lyft.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkzOTI0Mjgw", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1117#pullrequestreview-493924280", "createdAt": "2020-09-23T00:02:08Z", "commit": {"oid": "7621fb1c3c8d0a072a07cc87be29d5e7d12553e8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QwMDowMjowOFrOHWQYQA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QwMDowMjowOFrOHWQYQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzA5OTA3Mg==", "bodyText": "moved to main_interface_test", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1117#discussion_r493099072", "createdAt": "2020-09-23T00:02:08Z", "author": {"login": "jingwei99"}, "path": "test/common/engine_test.cc", "diffHunk": "@@ -49,42 +49,4 @@ TEST_F(EngineTest, EarlyExit) {\n \n   start_stream(0, {});\n }\n-\n-// TODO: move to main_interface_test.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7621fb1c3c8d0a072a07cc87be29d5e7d12553e8"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1ODQ1OTY0", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1117#pullrequestreview-495845964", "createdAt": "2020-09-24T18:28:22Z", "commit": {"oid": "7621fb1c3c8d0a072a07cc87be29d5e7d12553e8"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxODoyODoyMlrOHXncXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxODozMDoyOVrOHXnkIQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDUyNTUzMw==", "bodyText": "thanks!", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1117#discussion_r494525533", "createdAt": "2020-09-24T18:28:22Z", "author": {"login": "junr03"}, "path": "test/common/engine_test.cc", "diffHunk": "@@ -49,42 +49,4 @@ TEST_F(EngineTest, EarlyExit) {\n \n   start_stream(0, {});\n }\n-\n-// TODO: move to main_interface_test.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzA5OTA3Mg=="}, "originalCommit": {"oid": "7621fb1c3c8d0a072a07cc87be29d5e7d12553e8"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDUyNjIyNg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            const std::string CONFIG =\n          \n          \n            \n            const std::string MINIMAL_NOOP_CONFIG =", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1117#discussion_r494526226", "createdAt": "2020-09-24T18:29:07Z", "author": {"login": "junr03"}, "path": "test/common/main_interface_test.cc", "diffHunk": "@@ -13,6 +13,26 @@ typedef struct {\n   absl::Notification on_exit;\n } engine_test_context;\n \n+// This config is the minimal envoy mobile config that allows for running the engine.\n+// There is nothing functional about the config, as the created stream is only used for\n+// send_metadata.\n+const std::string CONFIG =", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7621fb1c3c8d0a072a07cc87be29d5e7d12553e8"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDUyNjUxNA==", "bodyText": "do you mind updating the comment, as this is now used in more places?", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1117#discussion_r494526514", "createdAt": "2020-09-24T18:29:25Z", "author": {"login": "junr03"}, "path": "test/common/main_interface_test.cc", "diffHunk": "@@ -13,6 +13,26 @@ typedef struct {\n   absl::Notification on_exit;\n } engine_test_context;\n \n+// This config is the minimal envoy mobile config that allows for running the engine.\n+// There is nothing functional about the config, as the created stream is only used for\n+// send_metadata.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7621fb1c3c8d0a072a07cc87be29d5e7d12553e8"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDUyNjYzNA==", "bodyText": "Thanks! Great clean up", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1117#discussion_r494526634", "createdAt": "2020-09-24T18:29:33Z", "author": {"login": "junr03"}, "path": "test/common/main_interface_test.cc", "diffHunk": "@@ -13,6 +13,26 @@ typedef struct {\n   absl::Notification on_exit;\n } engine_test_context;\n \n+// This config is the minimal envoy mobile config that allows for running the engine.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7621fb1c3c8d0a072a07cc87be29d5e7d12553e8"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDUyNzUyMQ==", "bodyText": "There is nothing functional about the config, as the created stream is only used for send_metadata. This part of the comment (and similar parts in other deleted comments) could be left in the test itself explaining why the minimal config is being used.", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1117#discussion_r494527521", "createdAt": "2020-09-24T18:30:29Z", "author": {"login": "junr03"}, "path": "test/common/main_interface_test.cc", "diffHunk": "@@ -13,6 +13,26 @@ typedef struct {\n   absl::Notification on_exit;\n } engine_test_context;\n \n+// This config is the minimal envoy mobile config that allows for running the engine.\n+// There is nothing functional about the config, as the created stream is only used for\n+// send_metadata.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDUyNjUxNA=="}, "originalCommit": {"oid": "7621fb1c3c8d0a072a07cc87be29d5e7d12553e8"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b9b33a1613ca58539a681e0158a99628d52ea6de", "author": {"user": {"login": "jingwei99", "name": "Jingwei"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/b9b33a1613ca58539a681e0158a99628d52ea6de", "committedDate": "2020-09-24T20:31:38Z", "message": "address comments\n\nSigned-off-by: Jingwei Hao <jingweih@lyft.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d031c19053e364e893a8bee17e0ed3fd0fcc3ea8", "author": {"user": {"login": "jingwei99", "name": "Jingwei"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/d031c19053e364e893a8bee17e0ed3fd0fcc3ea8", "committedDate": "2020-09-24T20:55:21Z", "message": "precommit\n\nSigned-off-by: Jingwei Hao <jingweih@lyft.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1OTU0MTY5", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1117#pullrequestreview-495954169", "createdAt": "2020-09-24T21:11:27Z", "commit": {"oid": "d031c19053e364e893a8bee17e0ed3fd0fcc3ea8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQyMToxMToyN1rOHXsxvQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQyMToxMToyN1rOHXsxvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDYxMjkyNQ==", "bodyText": "I had originally been thinking we could group all stats-recording functions by prefixing them with record*. These could be called recordGuageSet, recordGuageAdd, recordGuageSub. recordCounter could be change to recordCounterInc or stay the same. What do you think?", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1117#discussion_r494612925", "createdAt": "2020-09-24T21:11:27Z", "author": {"login": "goaway"}, "path": "library/common/engine.h", "diffHunk": "@@ -39,10 +39,30 @@ class Engine {\n    * Increment a counter with a given string of elements and by the given count.\n    * @param elements, joined elements of the timeseries.\n    * @param count, amount to add to the counter.\n-   * @param envoy_status_t, the resulting status of the operation.\n    */\n   envoy_status_t recordCounter(const std::string& elements, uint64_t count);\n \n+  /**\n+   * Set a gauge of a given string of elements with the given value.\n+   * @param elements, joined elements of the timeseries.\n+   * @param value, value to set to the gauge.\n+   */\n+  envoy_status_t setGauge(const std::string& elements, uint64_t value);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d031c19053e364e893a8bee17e0ed3fd0fcc3ea8"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fd739c99bf072b7be0e68bd9018cf05a00da1b4d", "author": {"user": {"login": "jingwei99", "name": "Jingwei"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/fd739c99bf072b7be0e68bd9018cf05a00da1b4d", "committedDate": "2020-09-25T20:21:14Z", "message": "update method names\n\nSigned-off-by: Jingwei Hao <jingweih@lyft.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk2ODQ3Njg2", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1117#pullrequestreview-496847686", "createdAt": "2020-09-25T20:51:49Z", "commit": {"oid": "fd739c99bf072b7be0e68bd9018cf05a00da1b4d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8aa52e660770e53cd0ed942d7820cf5c99a3dbe8", "author": {"user": {"login": "jingwei99", "name": "Jingwei"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/8aa52e660770e53cd0ed942d7820cf5c99a3dbe8", "committedDate": "2020-09-25T21:47:00Z", "message": "Merge branch 'main' into gauge"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4049, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}