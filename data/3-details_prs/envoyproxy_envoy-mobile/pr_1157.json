{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEzMzQ3OTMz", "number": 1157, "title": "filters: add buffer demo filter to swift", "bodyText": "Signed-off-by: Mike Schore mike.schore@gmail.com", "createdAt": "2020-10-31T01:06:10Z", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1157", "merged": true, "mergeCommit": {"oid": "6ac28caedfa7d4157961bb913e999d5f1f9208e7"}, "closed": true, "closedAt": "2020-11-01T03:49:32Z", "author": {"login": "goaway"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdXzq_2gFqTUyMTExMTc5OA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdYBX2_gFqTUyMTE2NzI1OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxMTExNzk4", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1157#pullrequestreview-521111798", "createdAt": "2020-10-31T04:29:36Z", "commit": {"oid": "d4a5c504a362fc4afae394b1ac83188de2b0cee2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMVQwNDoyOTozN1rOHrk0wg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMVQwNDoyOTozN1rOHrk0wg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTQ1NDE0Ng==", "bodyText": "I think for requests that are headers and trailers (no body), this would crash because self.body is force unwrapped. Should we make body an optional in the declaration as var body: Data??", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1157#discussion_r515454146", "createdAt": "2020-10-31T04:29:37Z", "author": {"login": "rebello95"}, "path": "examples/swift/hello_world/BufferDemoFilter.swift", "diffHunk": "@@ -0,0 +1,41 @@\n+import Envoy\n+import Foundation\n+\n+/// Example of a more complex HTTP filter that pauses processing on the response filter chain,\n+/// buffers until the response is complete, then resumes filter iteration while setting a new\n+/// header.\n+final class BufferDemoFilter: ResponseFilter {\n+  private var headers: ResponseHeaders!\n+  private var body: Data!\n+\n+  func onResponseHeaders(_ headers: ResponseHeaders, endStream: Bool)\n+    -> FilterHeadersStatus<ResponseHeaders>\n+  {\n+    self.headers = headers\n+    return .stopIteration\n+  }\n+\n+  func onResponseData(_ data: Data, endStream: Bool) -> FilterDataStatus<ResponseHeaders> {\n+    // Since we request buffering, each invocation will include all data buffered so far.\n+    self.body = data\n+\n+    // If this is the end of the stream, resume processing of the (now fully-buffered) response.\n+    if endStream {\n+      let builder = self.headers.toResponseHeadersBuilder()\n+        .add(name: \"buffer-filter-demo\", value: \"1\")\n+      return .resumeIteration(headers: builder.build(), data: self.body)\n+    }\n+    return .stopIterationAndBuffer\n+  }\n+\n+  func onResponseTrailers(\n+    _ trailers: ResponseTrailers\n+  ) -> FilterTrailersStatus<ResponseHeaders, ResponseTrailers> {\n+    // Trailers imply end of stream; resume processing of the (now fully-buffered) response.\n+    return .resumeIteration(data: self.body, trailers: trailers)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d4a5c504a362fc4afae394b1ac83188de2b0cee2"}, "originalPosition": 35}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "daf31a78a6860fbe655eb5b25ac2b9af5cf4017c", "author": {"user": {"login": "goaway", "name": "Mike Schore"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/daf31a78a6860fbe655eb5b25ac2b9af5cf4017c", "committedDate": "2020-10-31T19:01:33Z", "message": "filters: add buffer demo filter to swift\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bc28ab2b90beb89dc9f092cbf8cf317cabbd881d", "author": {"user": {"login": "goaway", "name": "Mike Schore"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/bc28ab2b90beb89dc9f092cbf8cf317cabbd881d", "committedDate": "2020-10-31T19:01:33Z", "message": "swiftlint\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "121c3e7f714ca35835459fe83876daa8522023e0", "author": {"user": {"login": "goaway", "name": "Mike Schore"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/121c3e7f714ca35835459fe83876daa8522023e0", "committedDate": "2020-10-31T19:01:33Z", "message": "make body data optional\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5c7f94ce074b5f89c41134c9d4c3bc07cacc424b", "author": {"user": {"login": "goaway", "name": "Mike Schore"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/5c7f94ce074b5f89c41134c9d4c3bc07cacc424b", "committedDate": "2020-10-31T19:01:02Z", "message": "make body data optional\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>"}, "afterCommit": {"oid": "121c3e7f714ca35835459fe83876daa8522023e0", "author": {"user": {"login": "goaway", "name": "Mike Schore"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/121c3e7f714ca35835459fe83876daa8522023e0", "committedDate": "2020-10-31T19:01:33Z", "message": "make body data optional\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxMTY3MjU5", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1157#pullrequestreview-521167259", "createdAt": "2020-10-31T20:27:23Z", "commit": {"oid": "121c3e7f714ca35835459fe83876daa8522023e0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3892, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}