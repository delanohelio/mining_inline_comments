{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg1NzY4NjE2", "number": 1087, "title": "core/platform: add platform-level postinit callback wiring", "bodyText": "This PR adds a new set of onEngineRunning callbacks to the platform (Swift/Kotlin) interfaces.\nThe intent behind these callbacks is to allow platform consumers to observe when Envoy Mobile has finished setting itself up internally. When build() is called from an EnvoyEngineBuilder, internal library setup is not complete when the allocation returns. Instead, Envoy actually does additional setup before being called back with a \"post init\" step from the core Envoy layer indicating that it's ready to send requests. In practice, this doesn't have any direct effect on consumers since any requests sent into the library during this timeframe are queued for sending automatically once setup is complete.\nBased on my localized runs of the library, I noticed 800-1000ms between the start of allocation and the time at which Envoy Mobile has completed its setup. There is room for improvement here which will be looked to in the future.\nChanges:\n\nAdd the new interface to platform layers\nImplement the core wiring for this callback and pipe that all the way through JNI / Objective-C up to Kotlin/Swift\nUpdate sample apps to utilize this functionality\nAdd core unit test to validate the core callback completes\n\nSigned-off-by: Michael Rebello me@michaelrebello.com\nCo-authored-by: Alan Chiu achiu@lyft.com", "createdAt": "2020-09-12T05:42:56Z", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1087", "merged": true, "mergeCommit": {"oid": "eb95c50c1edb672916f9c07db30333c6624377b6"}, "closed": true, "closedAt": "2020-09-16T21:08:53Z", "author": {"login": "rebello95"}, "timelineItems": {"totalCount": 35, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdIDVu8gH2gAyNDg1NzY4NjE2OmE3YTAyOWJjM2Q5OGM2MmFhNDZlNTY3ZDc5OWIzZjExNGY2ZmE0MGU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdJi0Y-gFqTQ5MDAxNDM4Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a7a029bc3d98c62aa46e567d799b3f114f6fa40e", "author": {"user": {"login": "rebello95", "name": "Michael Rebello"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/a7a029bc3d98c62aa46e567d799b3f114f6fa40e", "committedDate": "2020-09-12T05:42:05Z", "message": "wip\n\nSigned-off-by: Michael Rebello <me@michaelrebello.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3MjA2MTM3", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1087#pullrequestreview-487206137", "createdAt": "2020-09-12T05:43:41Z", "commit": {"oid": "a7a029bc3d98c62aa46e567d799b3f114f6fa40e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMlQwNTo0Mzo0MVrOHQy1hg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMlQwNTo0Mzo0MVrOHQy1hg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzM3MjE2Ng==", "bodyText": "Envoy lints against using system time - I think I'll actually revisit this and avoid doing the timing within the library and simply make the closure void", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1087#discussion_r487372166", "createdAt": "2020-09-12T05:43:41Z", "author": {"login": "rebello95"}, "path": "library/common/engine.cc", "diffHunk": "@@ -51,14 +53,23 @@ envoy_status_t Engine::run(const std::string config, const std::string log_level\n     // When we improve synchronous failure handling and/or move to dynamic forwarding, we only need\n     // to wait until the dispatcher is running (and can drain by enqueueing a drain callback on it,\n     // as we did previously).\n+    int64_t start_time = std::chrono::duration_cast<std::chrono::milliseconds>(\n+                             std::chrono::system_clock::now().time_since_epoch())\n+                             .count();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a7a029bc3d98c62aa46e567d799b3f114f6fa40e"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "09fc98a42641c015b20719d120f28be20cc91631", "author": {"user": {"login": "rebello95", "name": "Michael Rebello"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/09fc98a42641c015b20719d120f28be20cc91631", "committedDate": "2020-09-14T18:00:18Z", "message": "wip\n\nSigned-off-by: Michael Rebello <me@michaelrebello.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2442d586b2d7202969729fc806704a79b7cd943c", "author": {"user": {"login": "rebello95", "name": "Michael Rebello"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/2442d586b2d7202969729fc806704a79b7cd943c", "committedDate": "2020-09-14T22:33:03Z", "message": "changes\n\nSigned-off-by: Michael Rebello <me@michaelrebello.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa4c3f56706586556b77cfd777f5c1f20c51dcb1", "author": {"user": {"login": "buildbreaker", "name": "Alan Chiu"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/aa4c3f56706586556b77cfd777f5c1f20c51dcb1", "committedDate": "2020-09-14T23:03:29Z", "message": "a stab at it\n\nSigned-off-by: Alan Chiu <achiu@lyft.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "73ba5f67afe0422f310dc791390606d7535b3635", "author": {"user": {"login": "rebello95", "name": "Michael Rebello"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/73ba5f67afe0422f310dc791390606d7535b3635", "committedDate": "2020-09-14T23:09:48Z", "message": "Merge remote-tracking branch 'origin/main' into postinit-callbacks\n\nSigned-off-by: Michael Rebello <me@michaelrebello.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "72e45b143c11f77aa43c56d7c3b7a8dd7ff64372", "author": {"user": {"login": "rebello95", "name": "Michael Rebello"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/72e45b143c11f77aa43c56d7c3b7a8dd7ff64372", "committedDate": "2020-09-14T23:11:29Z", "message": "fixup\n\nSigned-off-by: Michael Rebello <me@michaelrebello.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ef32d4b6252703ad3679876a5726077a6159f328", "author": {"user": {"login": "buildbreaker", "name": "Alan Chiu"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/ef32d4b6252703ad3679876a5726077a6159f328", "committedDate": "2020-09-14T23:30:11Z", "message": "more\n\nSigned-off-by: Alan Chiu <achiu@lyft.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ef098c9ca4fdefe93f5e5ecd668f79560b7f336f", "author": {"user": {"login": "rebello95", "name": "Michael Rebello"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/ef098c9ca4fdefe93f5e5ecd668f79560b7f336f", "committedDate": "2020-09-14T23:57:30Z", "message": "docs/finish ios\n\nSigned-off-by: Michael Rebello <me@michaelrebello.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8905c97ce4fb4b6f5afd0d34e7975417dd689a1c", "author": {"user": {"login": "rebello95", "name": "Michael Rebello"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/8905c97ce4fb4b6f5afd0d34e7975417dd689a1c", "committedDate": "2020-09-15T20:00:38Z", "message": "this works\n\nSigned-off-by: Michael Rebello <me@michaelrebello.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "07f2f8afd66c4c25e0baf7c261621b336ba056d9", "author": {"user": {"login": "rebello95", "name": "Michael Rebello"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/07f2f8afd66c4c25e0baf7c261621b336ba056d9", "committedDate": "2020-09-15T21:09:53Z", "message": "checkpoint\n\nSigned-off-by: Michael Rebello <me@michaelrebello.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b0bac6daa3d4774473638897ca562d7ce44827b", "author": {"user": {"login": "rebello95", "name": "Michael Rebello"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/9b0bac6daa3d4774473638897ca562d7ce44827b", "committedDate": "2020-09-15T21:55:43Z", "message": "kotlin wiring\n\nSigned-off-by: Michael Rebello <me@michaelrebello.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d2bfa3610cf51bc4a2409892ee23581fcec40500", "author": {"user": {"login": "rebello95", "name": "Michael Rebello"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/d2bfa3610cf51bc4a2409892ee23581fcec40500", "committedDate": "2020-09-15T22:08:24Z", "message": "examples\n\nSigned-off-by: Michael Rebello <me@michaelrebello.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bf9a738d954b3578d80c8d78a0fef69290ba9168", "author": {"user": {"login": "rebello95", "name": "Michael Rebello"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/bf9a738d954b3578d80c8d78a0fef69290ba9168", "committedDate": "2020-09-15T22:14:35Z", "message": "fixes & cleanup\n\nSigned-off-by: Michael Rebello <me@michaelrebello.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "814aa93053d2a93540c5658e2fff22da86052424", "author": {"user": {"login": "rebello95", "name": "Michael Rebello"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/814aa93053d2a93540c5658e2fff22da86052424", "committedDate": "2020-09-15T22:17:28Z", "message": "Merge remote-tracking branch 'origin/main' into postinit-callbacks\n\nSigned-off-by: Michael Rebello <me@michaelrebello.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bfd35e7bcdc658f01f878d22af084debcfdff734", "author": {"user": {"login": "rebello95", "name": "Michael Rebello"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/bfd35e7bcdc658f01f878d22af084debcfdff734", "committedDate": "2020-09-15T22:23:56Z", "message": "Update engine_test.cc\n\nSigned-off-by: Michael Rebello <me@michaelrebello.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "41c3e464d6b1c189dd9215286730e36376b618de", "author": {"user": {"login": "rebello95", "name": "Michael Rebello"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/41c3e464d6b1c189dd9215286730e36376b618de", "committedDate": "2020-09-15T22:30:28Z", "message": "Update EngineImpl.kt\n\nSigned-off-by: Michael Rebello <me@michaelrebello.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9c29889f14006129ce418a01ef299b922cd06f1e", "author": {"user": {"login": "rebello95", "name": "Michael Rebello"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/9c29889f14006129ce418a01ef299b922cd06f1e", "committedDate": "2020-09-15T22:58:22Z", "message": "add cpp test\n\nSigned-off-by: Michael Rebello <me@michaelrebello.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6cb967699f7c4584979288dcb0edf15bb9ee5f71", "author": {"user": {"login": "rebello95", "name": "Michael Rebello"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/6cb967699f7c4584979288dcb0edf15bb9ee5f71", "committedDate": "2020-09-15T23:04:01Z", "message": "switch ordering in cpp struct\n\nSigned-off-by: Michael Rebello <me@michaelrebello.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8e47e4d8df9b0c5b8056321b92c7c1bae81b121c", "author": {"user": {"login": "rebello95", "name": "Michael Rebello"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/8e47e4d8df9b0c5b8056321b92c7c1bae81b121c", "committedDate": "2020-09-15T23:47:24Z", "message": "Update MainActivity.java\n\nSigned-off-by: Michael Rebello <me@michaelrebello.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5MTk0ODc2", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1087#pullrequestreview-489194876", "createdAt": "2020-09-16T00:31:03Z", "commit": {"oid": "8e47e4d8df9b0c5b8056321b92c7c1bae81b121c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwMDozMTowM1rOHSb0Hw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwMDozMTowM1rOHSb0Hw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTA5MjEyNw==", "bodyText": "\ud83d\udcaf", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1087#discussion_r489092127", "createdAt": "2020-09-16T00:31:03Z", "author": {"login": "buildbreaker"}, "path": "library/proguard.txt", "diffHunk": "@@ -11,6 +11,10 @@\n     native <methods>;\n }\n \n+-keep, includedescriptorclasses class io.envoyproxy.envoymobile.engine.types.EnvoyEngineOnSetupComplete {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8e47e4d8df9b0c5b8056321b92c7c1bae81b121c"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d8a0bee55c45b103bacab37e290c338f8b1105ae", "author": {"user": {"login": "rebello95", "name": "Michael Rebello"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/d8a0bee55c45b103bacab37e290c338f8b1105ae", "committedDate": "2020-09-16T00:40:04Z", "message": "Update MainActivity.java\n\nSigned-off-by: Michael Rebello <me@michaelrebello.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5NDI3OTYx", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1087#pullrequestreview-489427961", "createdAt": "2020-09-16T09:10:46Z", "commit": {"oid": "d8a0bee55c45b103bacab37e290c338f8b1105ae"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwOToxMDo0NlrOHSnnxw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQwOToxMDo0NlrOHSnnxw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTI4NTU3NQ==", "bodyText": "What about onEngineRunning?\nThere's a separate, potentially interesting callback point where objects have been initialized, but the main run loop hasn't started and configuration hasn't yet been loaded. onEngineRunning is maybe a little bit more explicit about the juncture to which it refers.", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1087#discussion_r489285575", "createdAt": "2020-09-16T09:10:46Z", "author": {"login": "goaway"}, "path": "docs/root/api/starting_envoy.rst", "diffHunk": "@@ -184,6 +184,25 @@ This functionality is used for stat segmentation.\n   // Swift\n   builder.addVirtualClusters(\"[{\\\"name\\\":\\\"vcluster\\\",\\\"headers\\\":[{\\\"name\\\":\\\":path\\\",\\\"exact_match\\\":\\\"/v1/vcluster\\\"}]}]\")\n \n+~~~~~~~~~~~~~~~~~~~~~~\n+``setOnSetupComplete``\n+~~~~~~~~~~~~~~~~~~~~~~\n+\n+Specify a closure to be called once Envoy's engine finishes its async initialization/startup.\n+\n+When Envoy is instantiated, its initializer returns before all of its internal configuration\n+completes. This interface provides the ability to observe when Envoy has completed its setup and is\n+ready to start dispatching requests. Any requests sent through Envoy before this setup completes\n+will be queued automatically, and this function is typically used purely for observability.\n+\n+**Example**::\n+\n+  // Kotlin\n+  builder.setOnSetupComplete { /*do something*/ }\n+\n+  // Swift\n+  builder.setOnSetupComplete { /*do something*/ }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d8a0bee55c45b103bacab37e290c338f8b1105ae"}, "originalPosition": 21}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4391051fc57bee6321ee2a64764e5870e8ab8e5a", "author": {"user": {"login": "rebello95", "name": "Michael Rebello"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/4391051fc57bee6321ee2a64764e5870e8ab8e5a", "committedDate": "2020-09-16T16:32:14Z", "message": "s/onSetupComplete/onEngineRunning\n\nSigned-off-by: Michael Rebello <me@michaelrebello.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2998ec05f390d5f3b81765f6d0dd1ee222a5e836", "author": {"user": {"login": "rebello95", "name": "Michael Rebello"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/2998ec05f390d5f3b81765f6d0dd1ee222a5e836", "committedDate": "2020-09-16T16:32:43Z", "message": "s/on_setup_complete/on_engine_running\n\nSigned-off-by: Michael Rebello <me@michaelrebello.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ade1a0ea394e61274771457ca042aaaf309b692a", "author": {"user": {"login": "rebello95", "name": "Michael Rebello"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/ade1a0ea394e61274771457ca042aaaf309b692a", "committedDate": "2020-09-16T16:35:43Z", "message": "cleanup after rename\n\nSigned-off-by: Michael Rebello <me@michaelrebello.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ddd33fd8a4c0b2777065e5456d56642eb30e0074", "author": {"user": {"login": "rebello95", "name": "Michael Rebello"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/ddd33fd8a4c0b2777065e5456d56642eb30e0074", "committedDate": "2020-09-16T16:36:30Z", "message": "Merge remote-tracking branch 'origin/main' into postinit-callbacks\n\nSigned-off-by: Michael Rebello <me@michaelrebello.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "638ace67fbc45954538f6caf13bd9ba7d5087134", "author": {"user": {"login": "rebello95", "name": "Michael Rebello"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/638ace67fbc45954538f6caf13bd9ba7d5087134", "committedDate": "2020-09-16T16:37:13Z", "message": "fix again.\n\nSigned-off-by: Michael Rebello <me@michaelrebello.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4ce9b0d09f1749237b7dd3b9d147e4d14b1008e3", "author": {"user": {"login": "rebello95", "name": "Michael Rebello"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/4ce9b0d09f1749237b7dd3b9d147e4d14b1008e3", "committedDate": "2020-09-16T16:39:49Z", "message": "alphabetical.\n\nSigned-off-by: Michael Rebello <me@michaelrebello.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7c7fe54245e2d20fb69eaa87e7a29f88a0df8be5", "author": {"user": {"login": "rebello95", "name": "Michael Rebello"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/7c7fe54245e2d20fb69eaa87e7a29f88a0df8be5", "committedDate": "2020-09-16T16:41:11Z", "message": "Update engine_test.cc\n\nSigned-off-by: Michael Rebello <me@michaelrebello.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "604363f42735a6d5de2ffe4b5104a14b0b1c317f", "author": {"user": {"login": "rebello95", "name": "Michael Rebello"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/604363f42735a6d5de2ffe4b5104a14b0b1c317f", "committedDate": "2020-09-16T17:40:03Z", "message": "filename\n\nSigned-off-by: Michael Rebello <me@michaelrebello.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eb1a2908f6db308c9aea013d2d1c08fbd43a17a2", "author": {"user": {"login": "rebello95", "name": "Michael Rebello"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/eb1a2908f6db308c9aea013d2d1c08fbd43a17a2", "committedDate": "2020-09-16T17:55:41Z", "message": "linters\n\nSigned-off-by: Michael Rebello <me@michaelrebello.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5OTcxMjk4", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1087#pullrequestreview-489971298", "createdAt": "2020-09-16T19:51:06Z", "commit": {"oid": "eb1a2908f6db308c9aea013d2d1c08fbd43a17a2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkwMDExMzk2", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1087#pullrequestreview-490011396", "createdAt": "2020-09-16T20:52:09Z", "commit": {"oid": "eb1a2908f6db308c9aea013d2d1c08fbd43a17a2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQyMDo1MjowOVrOHTDx-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQyMDo1MjowOVrOHTDx-g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTc0NjkzOA==", "bodyText": "Can you put a comment here? This works only because the other current engine callback doesn't use the context, but if others get added and/or when we move to per-instance runs, this will need to be moved.", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1087#discussion_r489746938", "createdAt": "2020-09-16T20:52:09Z", "author": {"login": "goaway"}, "path": "library/common/jni/jni_interface.cc", "diffHunk": "@@ -30,6 +30,20 @@ extern \"C\" JNIEXPORT jlong JNICALL Java_io_envoyproxy_envoymobile_engine_JniLibr\n   return init_engine();\n }\n \n+static void jvm_on_engine_running(void* context) {\n+  __android_log_write(ANDROID_LOG_VERBOSE, \"[Envoy]\", \"jvm_on_engine_running\");\n+\n+  JNIEnv* env = get_env();\n+  jobject j_context = static_cast<jobject>(context);\n+  jclass jcls_JvmonEngineRunningContext = env->GetObjectClass(j_context);\n+  jmethodID jmid_onEngineRunning = env->GetMethodID(\n+      jcls_JvmonEngineRunningContext, \"invokeOnEngineRunning\", \"()Ljava/lang/Object;\");\n+  env->CallObjectMethod(j_context, jmid_onEngineRunning);\n+\n+  env->DeleteLocalRef(jcls_JvmonEngineRunningContext);\n+  env->DeleteGlobalRef(j_context);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eb1a2908f6db308c9aea013d2d1c08fbd43a17a2"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkwMDE0Mzgy", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1087#pullrequestreview-490014382", "createdAt": "2020-09-16T20:56:33Z", "commit": {"oid": "eb1a2908f6db308c9aea013d2d1c08fbd43a17a2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4022, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}