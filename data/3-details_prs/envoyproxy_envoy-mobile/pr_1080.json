{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgzNzAyNzgz", "number": 1080, "title": "filters: setup unit test coverage for PlatformBridgeFilter", "bodyText": "Description: Adds basic framework for unit coverage of the PlatformBridgeFilter.\nRisk Level: Low\nTesting: Local and CI\nSigned-off-by: Mike Schore mike.schore@gmail.com", "createdAt": "2020-09-10T11:18:45Z", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1080", "merged": true, "mergeCommit": {"oid": "4de98b1d25bf247eed43a8f65bfdea2aefe3e8fa"}, "closed": true, "closedAt": "2020-09-11T09:06:40Z", "author": {"login": "goaway"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdHe8X2AH2gAyNDgzNzAyNzgzOjlkNzQxYmM1ZGIyMDRlYjA4MDQwNGQ5ZTQ4ZGY3ZDQyZjg0ZDcwYTE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdHsmhKAH2gAyNDgzNzAyNzgzOjMzYmVlMGRjNzJiNDk4NjM4ZDgzNWYyODg1NTZmMjU5N2FmMWU2MjM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9d741bc5db204eb080404d9e48df7d42f84d70a1", "author": {"user": {"login": "goaway", "name": "Mike Schore"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/9d741bc5db204eb080404d9e48df7d42f84d70a1", "committedDate": "2020-09-10T11:17:48Z", "message": "filters: add basic unit test coverage to PlatformBridgeFilter\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2d0df6fde5c51d610e4895b1b49a2a76b9ba1536", "author": {"user": {"login": "goaway", "name": "Mike Schore"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/2d0df6fde5c51d610e4895b1b49a2a76b9ba1536", "committedDate": "2020-09-10T23:26:08Z", "message": "fix and pass test\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aed497557a38657ee1d3662d97cf30d43f11d42e", "author": {"user": {"login": "goaway", "name": "Mike Schore"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/aed497557a38657ee1d3662d97cf30d43f11d42e", "committedDate": "2020-09-10T23:28:12Z", "message": "format\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2NDE2NDU2", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1080#pullrequestreview-486416456", "createdAt": "2020-09-11T01:36:57Z", "commit": {"oid": "aed497557a38657ee1d3662d97cf30d43f11d42e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQwMTozNjo1N1rOHQLMzw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQwMTozNjo1N1rOHQLMzw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjcyMjc2Nw==", "bodyText": "nit: could we rename this to be invocations instead of just i?", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1080#discussion_r486722767", "createdAt": "2020-09-11T01:36:57Z", "author": {"login": "buildbreaker"}, "path": "test/common/extensions/filters/http/platform_bridge/platform_bridge_filter_test.cc", "diffHunk": "@@ -0,0 +1,88 @@\n+#include \"test/mocks/http/mocks.h\"\n+#include \"test/test_common/utility.h\"\n+\n+#include \"gtest/gtest.h\"\n+#include \"library/common/api/external.h\"\n+#include \"library/common/extensions/filters/http/platform_bridge/filter.h\"\n+#include \"library/common/extensions/filters/http/platform_bridge/filter.pb.h\"\n+\n+using testing::ByMove;\n+using testing::Return;\n+\n+namespace Envoy {\n+namespace Extensions {\n+namespace HttpFilters {\n+namespace PlatformBridge {\n+namespace {\n+\n+class PlatformBridgeFilterTest : public testing::Test {\n+public:\n+  void setUpFilter(std::string&& yaml, envoy_http_filter* platform_filter) {\n+    envoymobile::extensions::filters::http::platform_bridge::PlatformBridge config;\n+    TestUtility::loadFromYaml(yaml, config);\n+    Api::External::registerApi(config.platform_filter_name(), platform_filter);\n+\n+    config_ = std::make_shared<PlatformBridgeFilterConfig>(config);\n+    filter_ = std::make_unique<PlatformBridgeFilter>(config_);\n+    filter_->setDecoderFilterCallbacks(decoder_callbacks_);\n+    filter_->setEncoderFilterCallbacks(encoder_callbacks_);\n+  }\n+\n+  typedef struct {\n+    unsigned int init_filter_calls;\n+    unsigned int on_request_headers_calls;\n+    unsigned int on_request_data_calls;\n+    unsigned int on_request_trailers_calls;\n+    unsigned int on_response_headers_calls;\n+    unsigned int on_response_data_calls;\n+    unsigned int on_response_trailers_calls;\n+    unsigned int release_filter_calls;\n+  } filter_invocations;\n+\n+  PlatformBridgeFilterConfigSharedPtr config_{};\n+  std::unique_ptr<PlatformBridgeFilter> filter_{};\n+  NiceMock<Http::MockStreamDecoderFilterCallbacks> decoder_callbacks_;\n+  NiceMock<Http::MockStreamEncoderFilterCallbacks> encoder_callbacks_;\n+};\n+\n+TEST_F(PlatformBridgeFilterTest, BasicContinueOnRequestHeaders) {\n+  envoy_http_filter platform_filter;\n+  filter_invocations i = {0, 0, 0, 0, 0, 0, 0, 0};", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aed497557a38657ee1d3662d97cf30d43f11d42e"}, "originalPosition": 50}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2NDE2Njg4", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1080#pullrequestreview-486416688", "createdAt": "2020-09-11T01:37:50Z", "commit": {"oid": "aed497557a38657ee1d3662d97cf30d43f11d42e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "33bee0dc72b498638d835f288556f2597af1e623", "author": {"user": {"login": "goaway", "name": "Mike Schore"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/33bee0dc72b498638d835f288556f2597af1e623", "committedDate": "2020-09-11T03:12:36Z", "message": "rename variable\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4016, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}