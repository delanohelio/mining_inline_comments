{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI1MzkxOTg1", "number": 870, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QyMDo1NzozMVrOECUXCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QyMTowMzowOVrOECUhMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcwODY2MTg0OnYy", "diffSide": "RIGHT", "path": "bazel/envoy_mobile_repositories.bzl", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QyMDo1NzozMVrOGetFhA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QyMDo1NzozMVrOGetFhA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDg0OTE1Ng==", "bodyText": "nit: why are these in variables when others are not? I feel we should do one or the other for all?", "url": "https://github.com/envoyproxy/envoy-mobile/pull/870#discussion_r434849156", "createdAt": "2020-06-03T20:57:31Z", "author": {"login": "junr03"}, "path": "bazel/envoy_mobile_repositories.bzl", "diffHunk": "@@ -0,0 +1,127 @@\n+load(\"@bazel_tools//tools/build_defs/repo:http.bzl\", \"http_archive\", \"http_file\", \"http_jar\")\n+\n+def envoy_mobile_repositories():\n+    http_archive(\n+        name = \"google_bazel_common\",\n+        sha256 = \"d8c9586b24ce4a5513d972668f94b62eb7d705b92405d4bc102131f294751f1d\",\n+        strip_prefix = \"bazel-common-413b433b91f26dbe39cdbc20f742ad6555dd1e27\",\n+        urls = [\"https://github.com/google/bazel-common/archive/413b433b91f26dbe39cdbc20f742ad6555dd1e27.zip\"],\n+    )\n+\n+    upstream_envoy_overrides()\n+    swift_repos()\n+    kotlin_repos()\n+\n+def upstream_envoy_overrides():\n+    # Patch protobuf to prevent duplicate symbols: https://github.com/lyft/envoy-mobile/issues/617\n+    # More details: https://github.com/protocolbuffers/protobuf/issues/7046\n+    # TODO: Remove after https://github.com/bazelbuild/bazel/pull/10493 is merged to Bazel\n+    # Reverts:\n+    # - https://github.com/protocolbuffers/protobuf/commit/7b28278c7d4f4175e70aef2f89d304696eb85ae3\n+    # - https://github.com/protocolbuffers/protobuf/commit/a03d332aca5d33c5d4b2cd25037c9e37d57eff02\n+    http_archive(\n+        name = \"com_google_protobuf\",\n+        patch_args = [\"-p1\"],\n+        patches = [\n+            \"@envoy//bazel:protobuf.patch\",\n+            \"//bazel:protobuf.patch\",\n+        ],\n+        sha256 = \"d7cfd31620a352b2ee8c1ed883222a0d77e44346643458e062e86b1d069ace3e\",\n+        strip_prefix = \"protobuf-3.10.1\",\n+        urls = [\"https://github.com/protocolbuffers/protobuf/releases/download/v3.10.1/protobuf-all-3.10.1.tar.gz\"],\n+    )\n+\n+    # Patch upstream Abseil to prevent Foundation dependency from leaking into Android builds.\n+    # Workaround for https://github.com/abseil/abseil-cpp/issues/326.\n+    # TODO: Should be removed in https://github.com/lyft/envoy-mobile/issues/136 once rules_android\n+    # supports platform toolchains.\n+    http_archive(\n+        name = \"com_google_absl\",\n+        patches = [\"//bazel:abseil.patch\"],\n+        sha256 = \"14ee08e2089c2a9b6bf27e1d10abc5629c69c4d0bab4b78ec5b65a29ea1c2af7\",\n+        strip_prefix = \"abseil-cpp-cf3a1998e9d41709d4141e2f13375993cba1130e\",\n+        # 2020-03-05\n+        urls = [\"https://github.com/abseil/abseil-cpp/archive/cf3a1998e9d41709d4141e2f13375993cba1130e.tar.gz\"],\n+    )\n+\n+    # This should be kept in sync with Envoy itself, we just need to apply this patch\n+    # Remove this once https://boringssl-review.googlesource.com/c/boringssl/+/37804 is in master-with-bazel\n+    http_archive(\n+        name = \"boringssl\",\n+        patches = [\"//bazel:boringssl.patch\"],\n+        sha256 = \"36049e6cd09b353c83878cae0dd84e8b603ba1a40dcd74e44ebad101fc5c672d\",\n+        strip_prefix = \"boringssl-37b57ed537987f1b4c60c60fa1aba20f3a0f6d26\",\n+        urls = [\"https://github.com/google/boringssl/archive/37b57ed537987f1b4c60c60fa1aba20f3a0f6d26.tar.gz\"],\n+    )\n+\n+def swift_repos():\n+    http_file(\n+        name = \"xctestrunner\",\n+        executable = 1,\n+        sha256 = \"0338c71977106f1304a8056739db6f462a76f386a299052c1ed7f8fd463d01a8\",\n+        urls = [\"https://github.com/google/xctestrunner/releases/download/0.2.11/ios_test_runner.par\"],\n+    )\n+\n+    http_archive(\n+        name = \"build_bazel_rules_apple\",\n+        sha256 = \"ee9e6073aeb5a65c100cb9c44b0017c937706a4ae03176e14a7e78620a198079\",\n+        strip_prefix = \"rules_apple-5131f3d46794bf227d296c82f30c2499c9de3c5b\",\n+        url = \"https://github.com/bazelbuild/rules_apple/archive/5131f3d46794bf227d296c82f30c2499c9de3c5b.tar.gz\",\n+    )\n+\n+    http_archive(\n+        name = \"build_bazel_rules_swift\",\n+        sha256 = \"d0833bc6dad817a367936a5f902a0c11318160b5e80a20ece35fb85a5675c886\",\n+        strip_prefix = \"rules_swift-3eeeb53cebda55b349d64c9fc144e18c5f7c0eb8\",\n+        url = \"https://github.com/bazelbuild/rules_swift/archive/3eeeb53cebda55b349d64c9fc144e18c5f7c0eb8.tar.gz\",\n+    )\n+\n+def kotlin_repos():\n+    http_archive(\n+        name = \"rules_jvm_external\",\n+        sha256 = \"1bbf2e48d07686707dd85357e9a94da775e1dbd7c464272b3664283c9c716d26\",\n+        strip_prefix = \"rules_jvm_external-2.10\",\n+        url = \"https://github.com/bazelbuild/rules_jvm_external/archive/2.10.zip\",\n+    )\n+\n+    rules_kotlin_version = \"legacy-1.3.0-rc2\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7bbecf153ff7ccf00f3016fc73a21f4f26c70a72"}, "originalPosition": 87}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcwODY4MTI4OnYy", "diffSide": "RIGHT", "path": "bazel/envoy_mobile_repositories.bzl", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QyMTowMTo1NFrOGetRwA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QyMzoyNjowOVrOGew2QQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDg1MjI4OA==", "bodyText": "I am trying to understand the difference between the kotlin_repos and the the kotlin_dependencies (same for swift)", "url": "https://github.com/envoyproxy/envoy-mobile/pull/870#discussion_r434852288", "createdAt": "2020-06-03T21:01:54Z", "author": {"login": "junr03"}, "path": "bazel/envoy_mobile_repositories.bzl", "diffHunk": "@@ -0,0 +1,127 @@\n+load(\"@bazel_tools//tools/build_defs/repo:http.bzl\", \"http_archive\", \"http_file\", \"http_jar\")\n+\n+def envoy_mobile_repositories():\n+    http_archive(\n+        name = \"google_bazel_common\",\n+        sha256 = \"d8c9586b24ce4a5513d972668f94b62eb7d705b92405d4bc102131f294751f1d\",\n+        strip_prefix = \"bazel-common-413b433b91f26dbe39cdbc20f742ad6555dd1e27\",\n+        urls = [\"https://github.com/google/bazel-common/archive/413b433b91f26dbe39cdbc20f742ad6555dd1e27.zip\"],\n+    )\n+\n+    upstream_envoy_overrides()\n+    swift_repos()\n+    kotlin_repos()\n+\n+def upstream_envoy_overrides():\n+    # Patch protobuf to prevent duplicate symbols: https://github.com/lyft/envoy-mobile/issues/617\n+    # More details: https://github.com/protocolbuffers/protobuf/issues/7046\n+    # TODO: Remove after https://github.com/bazelbuild/bazel/pull/10493 is merged to Bazel\n+    # Reverts:\n+    # - https://github.com/protocolbuffers/protobuf/commit/7b28278c7d4f4175e70aef2f89d304696eb85ae3\n+    # - https://github.com/protocolbuffers/protobuf/commit/a03d332aca5d33c5d4b2cd25037c9e37d57eff02\n+    http_archive(\n+        name = \"com_google_protobuf\",\n+        patch_args = [\"-p1\"],\n+        patches = [\n+            \"@envoy//bazel:protobuf.patch\",\n+            \"//bazel:protobuf.patch\",\n+        ],\n+        sha256 = \"d7cfd31620a352b2ee8c1ed883222a0d77e44346643458e062e86b1d069ace3e\",\n+        strip_prefix = \"protobuf-3.10.1\",\n+        urls = [\"https://github.com/protocolbuffers/protobuf/releases/download/v3.10.1/protobuf-all-3.10.1.tar.gz\"],\n+    )\n+\n+    # Patch upstream Abseil to prevent Foundation dependency from leaking into Android builds.\n+    # Workaround for https://github.com/abseil/abseil-cpp/issues/326.\n+    # TODO: Should be removed in https://github.com/lyft/envoy-mobile/issues/136 once rules_android\n+    # supports platform toolchains.\n+    http_archive(\n+        name = \"com_google_absl\",\n+        patches = [\"//bazel:abseil.patch\"],\n+        sha256 = \"14ee08e2089c2a9b6bf27e1d10abc5629c69c4d0bab4b78ec5b65a29ea1c2af7\",\n+        strip_prefix = \"abseil-cpp-cf3a1998e9d41709d4141e2f13375993cba1130e\",\n+        # 2020-03-05\n+        urls = [\"https://github.com/abseil/abseil-cpp/archive/cf3a1998e9d41709d4141e2f13375993cba1130e.tar.gz\"],\n+    )\n+\n+    # This should be kept in sync with Envoy itself, we just need to apply this patch\n+    # Remove this once https://boringssl-review.googlesource.com/c/boringssl/+/37804 is in master-with-bazel\n+    http_archive(\n+        name = \"boringssl\",\n+        patches = [\"//bazel:boringssl.patch\"],\n+        sha256 = \"36049e6cd09b353c83878cae0dd84e8b603ba1a40dcd74e44ebad101fc5c672d\",\n+        strip_prefix = \"boringssl-37b57ed537987f1b4c60c60fa1aba20f3a0f6d26\",\n+        urls = [\"https://github.com/google/boringssl/archive/37b57ed537987f1b4c60c60fa1aba20f3a0f6d26.tar.gz\"],\n+    )\n+\n+def swift_repos():\n+    http_file(\n+        name = \"xctestrunner\",\n+        executable = 1,\n+        sha256 = \"0338c71977106f1304a8056739db6f462a76f386a299052c1ed7f8fd463d01a8\",\n+        urls = [\"https://github.com/google/xctestrunner/releases/download/0.2.11/ios_test_runner.par\"],\n+    )\n+\n+    http_archive(\n+        name = \"build_bazel_rules_apple\",\n+        sha256 = \"ee9e6073aeb5a65c100cb9c44b0017c937706a4ae03176e14a7e78620a198079\",\n+        strip_prefix = \"rules_apple-5131f3d46794bf227d296c82f30c2499c9de3c5b\",\n+        url = \"https://github.com/bazelbuild/rules_apple/archive/5131f3d46794bf227d296c82f30c2499c9de3c5b.tar.gz\",\n+    )\n+\n+    http_archive(\n+        name = \"build_bazel_rules_swift\",\n+        sha256 = \"d0833bc6dad817a367936a5f902a0c11318160b5e80a20ece35fb85a5675c886\",\n+        strip_prefix = \"rules_swift-3eeeb53cebda55b349d64c9fc144e18c5f7c0eb8\",\n+        url = \"https://github.com/bazelbuild/rules_swift/archive/3eeeb53cebda55b349d64c9fc144e18c5f7c0eb8.tar.gz\",\n+    )\n+\n+def kotlin_repos():\n+    http_archive(\n+        name = \"rules_jvm_external\",\n+        sha256 = \"1bbf2e48d07686707dd85357e9a94da775e1dbd7c464272b3664283c9c716d26\",\n+        strip_prefix = \"rules_jvm_external-2.10\",\n+        url = \"https://github.com/bazelbuild/rules_jvm_external/archive/2.10.zip\",\n+    )\n+\n+    rules_kotlin_version = \"legacy-1.3.0-rc2\"\n+\n+    rules_kotlin_sha = \"dc1c76f91228ddaf4f7ca4190b82d61939e95369f61dea715e8be28792072b1b\"\n+\n+    http_archive(\n+        name = \"io_bazel_rules_kotlin\",\n+        sha256 = rules_kotlin_sha,\n+        strip_prefix = \"rules_kotlin-%s\" % rules_kotlin_version,\n+        type = \"zip\",\n+        urls = [\"https://github.com/bazelbuild/rules_kotlin/archive/%s.zip\" % rules_kotlin_version],\n+    )\n+\n+    rules_detekt_version = \"0.3.0\"\n+\n+    rules_detekt_sha = \"b1b4c8a3228f880a169ab60a817619bc4cf254443196e7e108ece411cb9c580e\"\n+\n+    http_archive(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7bbecf153ff7ccf00f3016fc73a21f4f26c70a72"}, "originalPosition": 103}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDg5NDQwNQ==", "bodyText": "There's a few concepts here: http_archive, load(), and actually calling the initialization method.\nThe http_archive is needed to download the remote repository, to call the initialization methods in the repository, we have to call the load() function to import the initialization method.\nHere's the nuance of a WORKSPACE and a bzl file:\n\nload() methods have to be declared at the very top of every bzl file\nSome load() methods depend on other repositories which means we need to download these repositories first before we call load()\nload() cannot be called within a bzl method so when we load a specific bzl file, we essentially call all the load() methods defined for the bzl file\n\nThis means that in the WORKSPACE we have more freedom to define things in a specific fragile order but when we move these to a bzl file, it requires some thoughtful organization (I did my best!). It's also the reason we have so many different files to replace whatever we had in WORKSPACE", "url": "https://github.com/envoyproxy/envoy-mobile/pull/870#discussion_r434894405", "createdAt": "2020-06-03T22:33:39Z", "author": {"login": "buildbreaker"}, "path": "bazel/envoy_mobile_repositories.bzl", "diffHunk": "@@ -0,0 +1,127 @@\n+load(\"@bazel_tools//tools/build_defs/repo:http.bzl\", \"http_archive\", \"http_file\", \"http_jar\")\n+\n+def envoy_mobile_repositories():\n+    http_archive(\n+        name = \"google_bazel_common\",\n+        sha256 = \"d8c9586b24ce4a5513d972668f94b62eb7d705b92405d4bc102131f294751f1d\",\n+        strip_prefix = \"bazel-common-413b433b91f26dbe39cdbc20f742ad6555dd1e27\",\n+        urls = [\"https://github.com/google/bazel-common/archive/413b433b91f26dbe39cdbc20f742ad6555dd1e27.zip\"],\n+    )\n+\n+    upstream_envoy_overrides()\n+    swift_repos()\n+    kotlin_repos()\n+\n+def upstream_envoy_overrides():\n+    # Patch protobuf to prevent duplicate symbols: https://github.com/lyft/envoy-mobile/issues/617\n+    # More details: https://github.com/protocolbuffers/protobuf/issues/7046\n+    # TODO: Remove after https://github.com/bazelbuild/bazel/pull/10493 is merged to Bazel\n+    # Reverts:\n+    # - https://github.com/protocolbuffers/protobuf/commit/7b28278c7d4f4175e70aef2f89d304696eb85ae3\n+    # - https://github.com/protocolbuffers/protobuf/commit/a03d332aca5d33c5d4b2cd25037c9e37d57eff02\n+    http_archive(\n+        name = \"com_google_protobuf\",\n+        patch_args = [\"-p1\"],\n+        patches = [\n+            \"@envoy//bazel:protobuf.patch\",\n+            \"//bazel:protobuf.patch\",\n+        ],\n+        sha256 = \"d7cfd31620a352b2ee8c1ed883222a0d77e44346643458e062e86b1d069ace3e\",\n+        strip_prefix = \"protobuf-3.10.1\",\n+        urls = [\"https://github.com/protocolbuffers/protobuf/releases/download/v3.10.1/protobuf-all-3.10.1.tar.gz\"],\n+    )\n+\n+    # Patch upstream Abseil to prevent Foundation dependency from leaking into Android builds.\n+    # Workaround for https://github.com/abseil/abseil-cpp/issues/326.\n+    # TODO: Should be removed in https://github.com/lyft/envoy-mobile/issues/136 once rules_android\n+    # supports platform toolchains.\n+    http_archive(\n+        name = \"com_google_absl\",\n+        patches = [\"//bazel:abseil.patch\"],\n+        sha256 = \"14ee08e2089c2a9b6bf27e1d10abc5629c69c4d0bab4b78ec5b65a29ea1c2af7\",\n+        strip_prefix = \"abseil-cpp-cf3a1998e9d41709d4141e2f13375993cba1130e\",\n+        # 2020-03-05\n+        urls = [\"https://github.com/abseil/abseil-cpp/archive/cf3a1998e9d41709d4141e2f13375993cba1130e.tar.gz\"],\n+    )\n+\n+    # This should be kept in sync with Envoy itself, we just need to apply this patch\n+    # Remove this once https://boringssl-review.googlesource.com/c/boringssl/+/37804 is in master-with-bazel\n+    http_archive(\n+        name = \"boringssl\",\n+        patches = [\"//bazel:boringssl.patch\"],\n+        sha256 = \"36049e6cd09b353c83878cae0dd84e8b603ba1a40dcd74e44ebad101fc5c672d\",\n+        strip_prefix = \"boringssl-37b57ed537987f1b4c60c60fa1aba20f3a0f6d26\",\n+        urls = [\"https://github.com/google/boringssl/archive/37b57ed537987f1b4c60c60fa1aba20f3a0f6d26.tar.gz\"],\n+    )\n+\n+def swift_repos():\n+    http_file(\n+        name = \"xctestrunner\",\n+        executable = 1,\n+        sha256 = \"0338c71977106f1304a8056739db6f462a76f386a299052c1ed7f8fd463d01a8\",\n+        urls = [\"https://github.com/google/xctestrunner/releases/download/0.2.11/ios_test_runner.par\"],\n+    )\n+\n+    http_archive(\n+        name = \"build_bazel_rules_apple\",\n+        sha256 = \"ee9e6073aeb5a65c100cb9c44b0017c937706a4ae03176e14a7e78620a198079\",\n+        strip_prefix = \"rules_apple-5131f3d46794bf227d296c82f30c2499c9de3c5b\",\n+        url = \"https://github.com/bazelbuild/rules_apple/archive/5131f3d46794bf227d296c82f30c2499c9de3c5b.tar.gz\",\n+    )\n+\n+    http_archive(\n+        name = \"build_bazel_rules_swift\",\n+        sha256 = \"d0833bc6dad817a367936a5f902a0c11318160b5e80a20ece35fb85a5675c886\",\n+        strip_prefix = \"rules_swift-3eeeb53cebda55b349d64c9fc144e18c5f7c0eb8\",\n+        url = \"https://github.com/bazelbuild/rules_swift/archive/3eeeb53cebda55b349d64c9fc144e18c5f7c0eb8.tar.gz\",\n+    )\n+\n+def kotlin_repos():\n+    http_archive(\n+        name = \"rules_jvm_external\",\n+        sha256 = \"1bbf2e48d07686707dd85357e9a94da775e1dbd7c464272b3664283c9c716d26\",\n+        strip_prefix = \"rules_jvm_external-2.10\",\n+        url = \"https://github.com/bazelbuild/rules_jvm_external/archive/2.10.zip\",\n+    )\n+\n+    rules_kotlin_version = \"legacy-1.3.0-rc2\"\n+\n+    rules_kotlin_sha = \"dc1c76f91228ddaf4f7ca4190b82d61939e95369f61dea715e8be28792072b1b\"\n+\n+    http_archive(\n+        name = \"io_bazel_rules_kotlin\",\n+        sha256 = rules_kotlin_sha,\n+        strip_prefix = \"rules_kotlin-%s\" % rules_kotlin_version,\n+        type = \"zip\",\n+        urls = [\"https://github.com/bazelbuild/rules_kotlin/archive/%s.zip\" % rules_kotlin_version],\n+    )\n+\n+    rules_detekt_version = \"0.3.0\"\n+\n+    rules_detekt_sha = \"b1b4c8a3228f880a169ab60a817619bc4cf254443196e7e108ece411cb9c580e\"\n+\n+    http_archive(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDg1MjI4OA=="}, "originalCommit": {"oid": "7bbecf153ff7ccf00f3016fc73a21f4f26c70a72"}, "originalPosition": 103}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDkxMDc4NQ==", "bodyText": "This means that in the WORKSPACE we have more freedom to define things in a specific fragile order but when we move these to a bzl file, it requires some thoughtful organization\n\nAh this is the key point. I see! Thanks", "url": "https://github.com/envoyproxy/envoy-mobile/pull/870#discussion_r434910785", "createdAt": "2020-06-03T23:26:09Z", "author": {"login": "junr03"}, "path": "bazel/envoy_mobile_repositories.bzl", "diffHunk": "@@ -0,0 +1,127 @@\n+load(\"@bazel_tools//tools/build_defs/repo:http.bzl\", \"http_archive\", \"http_file\", \"http_jar\")\n+\n+def envoy_mobile_repositories():\n+    http_archive(\n+        name = \"google_bazel_common\",\n+        sha256 = \"d8c9586b24ce4a5513d972668f94b62eb7d705b92405d4bc102131f294751f1d\",\n+        strip_prefix = \"bazel-common-413b433b91f26dbe39cdbc20f742ad6555dd1e27\",\n+        urls = [\"https://github.com/google/bazel-common/archive/413b433b91f26dbe39cdbc20f742ad6555dd1e27.zip\"],\n+    )\n+\n+    upstream_envoy_overrides()\n+    swift_repos()\n+    kotlin_repos()\n+\n+def upstream_envoy_overrides():\n+    # Patch protobuf to prevent duplicate symbols: https://github.com/lyft/envoy-mobile/issues/617\n+    # More details: https://github.com/protocolbuffers/protobuf/issues/7046\n+    # TODO: Remove after https://github.com/bazelbuild/bazel/pull/10493 is merged to Bazel\n+    # Reverts:\n+    # - https://github.com/protocolbuffers/protobuf/commit/7b28278c7d4f4175e70aef2f89d304696eb85ae3\n+    # - https://github.com/protocolbuffers/protobuf/commit/a03d332aca5d33c5d4b2cd25037c9e37d57eff02\n+    http_archive(\n+        name = \"com_google_protobuf\",\n+        patch_args = [\"-p1\"],\n+        patches = [\n+            \"@envoy//bazel:protobuf.patch\",\n+            \"//bazel:protobuf.patch\",\n+        ],\n+        sha256 = \"d7cfd31620a352b2ee8c1ed883222a0d77e44346643458e062e86b1d069ace3e\",\n+        strip_prefix = \"protobuf-3.10.1\",\n+        urls = [\"https://github.com/protocolbuffers/protobuf/releases/download/v3.10.1/protobuf-all-3.10.1.tar.gz\"],\n+    )\n+\n+    # Patch upstream Abseil to prevent Foundation dependency from leaking into Android builds.\n+    # Workaround for https://github.com/abseil/abseil-cpp/issues/326.\n+    # TODO: Should be removed in https://github.com/lyft/envoy-mobile/issues/136 once rules_android\n+    # supports platform toolchains.\n+    http_archive(\n+        name = \"com_google_absl\",\n+        patches = [\"//bazel:abseil.patch\"],\n+        sha256 = \"14ee08e2089c2a9b6bf27e1d10abc5629c69c4d0bab4b78ec5b65a29ea1c2af7\",\n+        strip_prefix = \"abseil-cpp-cf3a1998e9d41709d4141e2f13375993cba1130e\",\n+        # 2020-03-05\n+        urls = [\"https://github.com/abseil/abseil-cpp/archive/cf3a1998e9d41709d4141e2f13375993cba1130e.tar.gz\"],\n+    )\n+\n+    # This should be kept in sync with Envoy itself, we just need to apply this patch\n+    # Remove this once https://boringssl-review.googlesource.com/c/boringssl/+/37804 is in master-with-bazel\n+    http_archive(\n+        name = \"boringssl\",\n+        patches = [\"//bazel:boringssl.patch\"],\n+        sha256 = \"36049e6cd09b353c83878cae0dd84e8b603ba1a40dcd74e44ebad101fc5c672d\",\n+        strip_prefix = \"boringssl-37b57ed537987f1b4c60c60fa1aba20f3a0f6d26\",\n+        urls = [\"https://github.com/google/boringssl/archive/37b57ed537987f1b4c60c60fa1aba20f3a0f6d26.tar.gz\"],\n+    )\n+\n+def swift_repos():\n+    http_file(\n+        name = \"xctestrunner\",\n+        executable = 1,\n+        sha256 = \"0338c71977106f1304a8056739db6f462a76f386a299052c1ed7f8fd463d01a8\",\n+        urls = [\"https://github.com/google/xctestrunner/releases/download/0.2.11/ios_test_runner.par\"],\n+    )\n+\n+    http_archive(\n+        name = \"build_bazel_rules_apple\",\n+        sha256 = \"ee9e6073aeb5a65c100cb9c44b0017c937706a4ae03176e14a7e78620a198079\",\n+        strip_prefix = \"rules_apple-5131f3d46794bf227d296c82f30c2499c9de3c5b\",\n+        url = \"https://github.com/bazelbuild/rules_apple/archive/5131f3d46794bf227d296c82f30c2499c9de3c5b.tar.gz\",\n+    )\n+\n+    http_archive(\n+        name = \"build_bazel_rules_swift\",\n+        sha256 = \"d0833bc6dad817a367936a5f902a0c11318160b5e80a20ece35fb85a5675c886\",\n+        strip_prefix = \"rules_swift-3eeeb53cebda55b349d64c9fc144e18c5f7c0eb8\",\n+        url = \"https://github.com/bazelbuild/rules_swift/archive/3eeeb53cebda55b349d64c9fc144e18c5f7c0eb8.tar.gz\",\n+    )\n+\n+def kotlin_repos():\n+    http_archive(\n+        name = \"rules_jvm_external\",\n+        sha256 = \"1bbf2e48d07686707dd85357e9a94da775e1dbd7c464272b3664283c9c716d26\",\n+        strip_prefix = \"rules_jvm_external-2.10\",\n+        url = \"https://github.com/bazelbuild/rules_jvm_external/archive/2.10.zip\",\n+    )\n+\n+    rules_kotlin_version = \"legacy-1.3.0-rc2\"\n+\n+    rules_kotlin_sha = \"dc1c76f91228ddaf4f7ca4190b82d61939e95369f61dea715e8be28792072b1b\"\n+\n+    http_archive(\n+        name = \"io_bazel_rules_kotlin\",\n+        sha256 = rules_kotlin_sha,\n+        strip_prefix = \"rules_kotlin-%s\" % rules_kotlin_version,\n+        type = \"zip\",\n+        urls = [\"https://github.com/bazelbuild/rules_kotlin/archive/%s.zip\" % rules_kotlin_version],\n+    )\n+\n+    rules_detekt_version = \"0.3.0\"\n+\n+    rules_detekt_sha = \"b1b4c8a3228f880a169ab60a817619bc4cf254443196e7e108ece411cb9c580e\"\n+\n+    http_archive(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDg1MjI4OA=="}, "originalCommit": {"oid": "7bbecf153ff7ccf00f3016fc73a21f4f26c70a72"}, "originalPosition": 103}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcwODY4Nzg0OnYy", "diffSide": "RIGHT", "path": "WORKSPACE", "isResolved": false, "comments": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QyMTowMzowOVrOGetVuA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQwMDozNDo1NFrOGex9PQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDg1MzMwNA==", "bodyText": "should we move this below all the upstream envoy rules?", "url": "https://github.com/envoyproxy/envoy-mobile/pull/870#discussion_r434853304", "createdAt": "2020-06-03T21:03:09Z", "author": {"login": "junr03"}, "path": "WORKSPACE", "diffHunk": "@@ -1,45 +1,5 @@\n-load(\"@bazel_tools//tools/build_defs/repo:http.bzl\", \"http_archive\", \"http_file\", \"http_jar\")\n-\n-# Patch protobuf to prevent duplicate symbols: https://github.com/lyft/envoy-mobile/issues/617\n-# More details: https://github.com/protocolbuffers/protobuf/issues/7046\n-# TODO: Remove after https://github.com/bazelbuild/bazel/pull/10493 is merged to Bazel\n-# Reverts:\n-# - https://github.com/protocolbuffers/protobuf/commit/7b28278c7d4f4175e70aef2f89d304696eb85ae3\n-# - https://github.com/protocolbuffers/protobuf/commit/a03d332aca5d33c5d4b2cd25037c9e37d57eff02\n-http_archive(\n-    name = \"com_google_protobuf\",\n-    patch_args = [\"-p1\"],\n-    patches = [\n-        \"@envoy//bazel:protobuf.patch\",\n-        \"//bazel:protobuf.patch\",\n-    ],\n-    sha256 = \"d7cfd31620a352b2ee8c1ed883222a0d77e44346643458e062e86b1d069ace3e\",\n-    strip_prefix = \"protobuf-3.10.1\",\n-    urls = [\"https://github.com/protocolbuffers/protobuf/releases/download/v3.10.1/protobuf-all-3.10.1.tar.gz\"],\n-)\n-\n-# Patch upstream Abseil to prevent Foundation dependency from leaking into Android builds.\n-# Workaround for https://github.com/abseil/abseil-cpp/issues/326.\n-# TODO: Should be removed in https://github.com/lyft/envoy-mobile/issues/136 once rules_android\n-# supports platform toolchains.\n-http_archive(\n-    name = \"com_google_absl\",\n-    patches = [\"//bazel:abseil.patch\"],\n-    sha256 = \"14ee08e2089c2a9b6bf27e1d10abc5629c69c4d0bab4b78ec5b65a29ea1c2af7\",\n-    strip_prefix = \"abseil-cpp-cf3a1998e9d41709d4141e2f13375993cba1130e\",\n-    # 2020-03-05\n-    urls = [\"https://github.com/abseil/abseil-cpp/archive/cf3a1998e9d41709d4141e2f13375993cba1130e.tar.gz\"],\n-)\n-\n-# This should be kept in sync with Envoy itself, we just need to apply this patch\n-# Remove this once https://boringssl-review.googlesource.com/c/boringssl/+/37804 is in master-with-bazel\n-http_archive(\n-    name = \"boringssl\",\n-    patches = [\"//bazel:boringssl.patch\"],\n-    sha256 = \"36049e6cd09b353c83878cae0dd84e8b603ba1a40dcd74e44ebad101fc5c672d\",\n-    strip_prefix = \"boringssl-37b57ed537987f1b4c60c60fa1aba20f3a0f6d26\",\n-    urls = [\"https://github.com/google/boringssl/archive/37b57ed537987f1b4c60c60fa1aba20f3a0f6d26.tar.gz\"],\n-)\n+load(\"//bazel:envoy_mobile_repositories.bzl\", \"envoy_mobile_repositories\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7bbecf153ff7ccf00f3016fc73a21f4f26c70a72"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDg2NDUxMQ==", "bodyText": "We have upstream envoy overrides here. We can do the non-overrides below the upstream envoy rules", "url": "https://github.com/envoyproxy/envoy-mobile/pull/870#discussion_r434864511", "createdAt": "2020-06-03T21:20:33Z", "author": {"login": "buildbreaker"}, "path": "WORKSPACE", "diffHunk": "@@ -1,45 +1,5 @@\n-load(\"@bazel_tools//tools/build_defs/repo:http.bzl\", \"http_archive\", \"http_file\", \"http_jar\")\n-\n-# Patch protobuf to prevent duplicate symbols: https://github.com/lyft/envoy-mobile/issues/617\n-# More details: https://github.com/protocolbuffers/protobuf/issues/7046\n-# TODO: Remove after https://github.com/bazelbuild/bazel/pull/10493 is merged to Bazel\n-# Reverts:\n-# - https://github.com/protocolbuffers/protobuf/commit/7b28278c7d4f4175e70aef2f89d304696eb85ae3\n-# - https://github.com/protocolbuffers/protobuf/commit/a03d332aca5d33c5d4b2cd25037c9e37d57eff02\n-http_archive(\n-    name = \"com_google_protobuf\",\n-    patch_args = [\"-p1\"],\n-    patches = [\n-        \"@envoy//bazel:protobuf.patch\",\n-        \"//bazel:protobuf.patch\",\n-    ],\n-    sha256 = \"d7cfd31620a352b2ee8c1ed883222a0d77e44346643458e062e86b1d069ace3e\",\n-    strip_prefix = \"protobuf-3.10.1\",\n-    urls = [\"https://github.com/protocolbuffers/protobuf/releases/download/v3.10.1/protobuf-all-3.10.1.tar.gz\"],\n-)\n-\n-# Patch upstream Abseil to prevent Foundation dependency from leaking into Android builds.\n-# Workaround for https://github.com/abseil/abseil-cpp/issues/326.\n-# TODO: Should be removed in https://github.com/lyft/envoy-mobile/issues/136 once rules_android\n-# supports platform toolchains.\n-http_archive(\n-    name = \"com_google_absl\",\n-    patches = [\"//bazel:abseil.patch\"],\n-    sha256 = \"14ee08e2089c2a9b6bf27e1d10abc5629c69c4d0bab4b78ec5b65a29ea1c2af7\",\n-    strip_prefix = \"abseil-cpp-cf3a1998e9d41709d4141e2f13375993cba1130e\",\n-    # 2020-03-05\n-    urls = [\"https://github.com/abseil/abseil-cpp/archive/cf3a1998e9d41709d4141e2f13375993cba1130e.tar.gz\"],\n-)\n-\n-# This should be kept in sync with Envoy itself, we just need to apply this patch\n-# Remove this once https://boringssl-review.googlesource.com/c/boringssl/+/37804 is in master-with-bazel\n-http_archive(\n-    name = \"boringssl\",\n-    patches = [\"//bazel:boringssl.patch\"],\n-    sha256 = \"36049e6cd09b353c83878cae0dd84e8b603ba1a40dcd74e44ebad101fc5c672d\",\n-    strip_prefix = \"boringssl-37b57ed537987f1b4c60c60fa1aba20f3a0f6d26\",\n-    urls = [\"https://github.com/google/boringssl/archive/37b57ed537987f1b4c60c60fa1aba20f3a0f6d26.tar.gz\"],\n-)\n+load(\"//bazel:envoy_mobile_repositories.bzl\", \"envoy_mobile_repositories\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDg1MzMwNA=="}, "originalCommit": {"oid": "7bbecf153ff7ccf00f3016fc73a21f4f26c70a72"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDg2OTI5MQ==", "bodyText": "oh so whoever declares first takes precedence?", "url": "https://github.com/envoyproxy/envoy-mobile/pull/870#discussion_r434869291", "createdAt": "2020-06-03T21:30:56Z", "author": {"login": "junr03"}, "path": "WORKSPACE", "diffHunk": "@@ -1,45 +1,5 @@\n-load(\"@bazel_tools//tools/build_defs/repo:http.bzl\", \"http_archive\", \"http_file\", \"http_jar\")\n-\n-# Patch protobuf to prevent duplicate symbols: https://github.com/lyft/envoy-mobile/issues/617\n-# More details: https://github.com/protocolbuffers/protobuf/issues/7046\n-# TODO: Remove after https://github.com/bazelbuild/bazel/pull/10493 is merged to Bazel\n-# Reverts:\n-# - https://github.com/protocolbuffers/protobuf/commit/7b28278c7d4f4175e70aef2f89d304696eb85ae3\n-# - https://github.com/protocolbuffers/protobuf/commit/a03d332aca5d33c5d4b2cd25037c9e37d57eff02\n-http_archive(\n-    name = \"com_google_protobuf\",\n-    patch_args = [\"-p1\"],\n-    patches = [\n-        \"@envoy//bazel:protobuf.patch\",\n-        \"//bazel:protobuf.patch\",\n-    ],\n-    sha256 = \"d7cfd31620a352b2ee8c1ed883222a0d77e44346643458e062e86b1d069ace3e\",\n-    strip_prefix = \"protobuf-3.10.1\",\n-    urls = [\"https://github.com/protocolbuffers/protobuf/releases/download/v3.10.1/protobuf-all-3.10.1.tar.gz\"],\n-)\n-\n-# Patch upstream Abseil to prevent Foundation dependency from leaking into Android builds.\n-# Workaround for https://github.com/abseil/abseil-cpp/issues/326.\n-# TODO: Should be removed in https://github.com/lyft/envoy-mobile/issues/136 once rules_android\n-# supports platform toolchains.\n-http_archive(\n-    name = \"com_google_absl\",\n-    patches = [\"//bazel:abseil.patch\"],\n-    sha256 = \"14ee08e2089c2a9b6bf27e1d10abc5629c69c4d0bab4b78ec5b65a29ea1c2af7\",\n-    strip_prefix = \"abseil-cpp-cf3a1998e9d41709d4141e2f13375993cba1130e\",\n-    # 2020-03-05\n-    urls = [\"https://github.com/abseil/abseil-cpp/archive/cf3a1998e9d41709d4141e2f13375993cba1130e.tar.gz\"],\n-)\n-\n-# This should be kept in sync with Envoy itself, we just need to apply this patch\n-# Remove this once https://boringssl-review.googlesource.com/c/boringssl/+/37804 is in master-with-bazel\n-http_archive(\n-    name = \"boringssl\",\n-    patches = [\"//bazel:boringssl.patch\"],\n-    sha256 = \"36049e6cd09b353c83878cae0dd84e8b603ba1a40dcd74e44ebad101fc5c672d\",\n-    strip_prefix = \"boringssl-37b57ed537987f1b4c60c60fa1aba20f3a0f6d26\",\n-    urls = [\"https://github.com/google/boringssl/archive/37b57ed537987f1b4c60c60fa1aba20f3a0f6d26.tar.gz\"],\n-)\n+load(\"//bazel:envoy_mobile_repositories.bzl\", \"envoy_mobile_repositories\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDg1MzMwNA=="}, "originalCommit": {"oid": "7bbecf153ff7ccf00f3016fc73a21f4f26c70a72"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDg5MjE3NQ==", "bodyText": "Yeah, whoever defines these first will take precedence because envoy has this macro which we leverage:  https://github.com/envoyproxy/envoy/blob/48a5b21d9483e7eddac79aeff7daac178d7b7462/api/bazel/envoy_http_archive.bzl#L4-L7", "url": "https://github.com/envoyproxy/envoy-mobile/pull/870#discussion_r434892175", "createdAt": "2020-06-03T22:27:07Z", "author": {"login": "buildbreaker"}, "path": "WORKSPACE", "diffHunk": "@@ -1,45 +1,5 @@\n-load(\"@bazel_tools//tools/build_defs/repo:http.bzl\", \"http_archive\", \"http_file\", \"http_jar\")\n-\n-# Patch protobuf to prevent duplicate symbols: https://github.com/lyft/envoy-mobile/issues/617\n-# More details: https://github.com/protocolbuffers/protobuf/issues/7046\n-# TODO: Remove after https://github.com/bazelbuild/bazel/pull/10493 is merged to Bazel\n-# Reverts:\n-# - https://github.com/protocolbuffers/protobuf/commit/7b28278c7d4f4175e70aef2f89d304696eb85ae3\n-# - https://github.com/protocolbuffers/protobuf/commit/a03d332aca5d33c5d4b2cd25037c9e37d57eff02\n-http_archive(\n-    name = \"com_google_protobuf\",\n-    patch_args = [\"-p1\"],\n-    patches = [\n-        \"@envoy//bazel:protobuf.patch\",\n-        \"//bazel:protobuf.patch\",\n-    ],\n-    sha256 = \"d7cfd31620a352b2ee8c1ed883222a0d77e44346643458e062e86b1d069ace3e\",\n-    strip_prefix = \"protobuf-3.10.1\",\n-    urls = [\"https://github.com/protocolbuffers/protobuf/releases/download/v3.10.1/protobuf-all-3.10.1.tar.gz\"],\n-)\n-\n-# Patch upstream Abseil to prevent Foundation dependency from leaking into Android builds.\n-# Workaround for https://github.com/abseil/abseil-cpp/issues/326.\n-# TODO: Should be removed in https://github.com/lyft/envoy-mobile/issues/136 once rules_android\n-# supports platform toolchains.\n-http_archive(\n-    name = \"com_google_absl\",\n-    patches = [\"//bazel:abseil.patch\"],\n-    sha256 = \"14ee08e2089c2a9b6bf27e1d10abc5629c69c4d0bab4b78ec5b65a29ea1c2af7\",\n-    strip_prefix = \"abseil-cpp-cf3a1998e9d41709d4141e2f13375993cba1130e\",\n-    # 2020-03-05\n-    urls = [\"https://github.com/abseil/abseil-cpp/archive/cf3a1998e9d41709d4141e2f13375993cba1130e.tar.gz\"],\n-)\n-\n-# This should be kept in sync with Envoy itself, we just need to apply this patch\n-# Remove this once https://boringssl-review.googlesource.com/c/boringssl/+/37804 is in master-with-bazel\n-http_archive(\n-    name = \"boringssl\",\n-    patches = [\"//bazel:boringssl.patch\"],\n-    sha256 = \"36049e6cd09b353c83878cae0dd84e8b603ba1a40dcd74e44ebad101fc5c672d\",\n-    strip_prefix = \"boringssl-37b57ed537987f1b4c60c60fa1aba20f3a0f6d26\",\n-    urls = [\"https://github.com/google/boringssl/archive/37b57ed537987f1b4c60c60fa1aba20f3a0f6d26.tar.gz\"],\n-)\n+load(\"//bazel:envoy_mobile_repositories.bzl\", \"envoy_mobile_repositories\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDg1MzMwNA=="}, "originalCommit": {"oid": "7bbecf153ff7ccf00f3016fc73a21f4f26c70a72"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDg5NzM0NQ==", "bodyText": "Would it be worth splitting out overrides and including them first-class here, just to make it super clear the reason behind the ordering?", "url": "https://github.com/envoyproxy/envoy-mobile/pull/870#discussion_r434897345", "createdAt": "2020-06-03T22:42:45Z", "author": {"login": "goaway"}, "path": "WORKSPACE", "diffHunk": "@@ -1,45 +1,5 @@\n-load(\"@bazel_tools//tools/build_defs/repo:http.bzl\", \"http_archive\", \"http_file\", \"http_jar\")\n-\n-# Patch protobuf to prevent duplicate symbols: https://github.com/lyft/envoy-mobile/issues/617\n-# More details: https://github.com/protocolbuffers/protobuf/issues/7046\n-# TODO: Remove after https://github.com/bazelbuild/bazel/pull/10493 is merged to Bazel\n-# Reverts:\n-# - https://github.com/protocolbuffers/protobuf/commit/7b28278c7d4f4175e70aef2f89d304696eb85ae3\n-# - https://github.com/protocolbuffers/protobuf/commit/a03d332aca5d33c5d4b2cd25037c9e37d57eff02\n-http_archive(\n-    name = \"com_google_protobuf\",\n-    patch_args = [\"-p1\"],\n-    patches = [\n-        \"@envoy//bazel:protobuf.patch\",\n-        \"//bazel:protobuf.patch\",\n-    ],\n-    sha256 = \"d7cfd31620a352b2ee8c1ed883222a0d77e44346643458e062e86b1d069ace3e\",\n-    strip_prefix = \"protobuf-3.10.1\",\n-    urls = [\"https://github.com/protocolbuffers/protobuf/releases/download/v3.10.1/protobuf-all-3.10.1.tar.gz\"],\n-)\n-\n-# Patch upstream Abseil to prevent Foundation dependency from leaking into Android builds.\n-# Workaround for https://github.com/abseil/abseil-cpp/issues/326.\n-# TODO: Should be removed in https://github.com/lyft/envoy-mobile/issues/136 once rules_android\n-# supports platform toolchains.\n-http_archive(\n-    name = \"com_google_absl\",\n-    patches = [\"//bazel:abseil.patch\"],\n-    sha256 = \"14ee08e2089c2a9b6bf27e1d10abc5629c69c4d0bab4b78ec5b65a29ea1c2af7\",\n-    strip_prefix = \"abseil-cpp-cf3a1998e9d41709d4141e2f13375993cba1130e\",\n-    # 2020-03-05\n-    urls = [\"https://github.com/abseil/abseil-cpp/archive/cf3a1998e9d41709d4141e2f13375993cba1130e.tar.gz\"],\n-)\n-\n-# This should be kept in sync with Envoy itself, we just need to apply this patch\n-# Remove this once https://boringssl-review.googlesource.com/c/boringssl/+/37804 is in master-with-bazel\n-http_archive(\n-    name = \"boringssl\",\n-    patches = [\"//bazel:boringssl.patch\"],\n-    sha256 = \"36049e6cd09b353c83878cae0dd84e8b603ba1a40dcd74e44ebad101fc5c672d\",\n-    strip_prefix = \"boringssl-37b57ed537987f1b4c60c60fa1aba20f3a0f6d26\",\n-    urls = [\"https://github.com/google/boringssl/archive/37b57ed537987f1b4c60c60fa1aba20f3a0f6d26.tar.gz\"],\n-)\n+load(\"//bazel:envoy_mobile_repositories.bzl\", \"envoy_mobile_repositories\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDg1MzMwNA=="}, "originalCommit": {"oid": "7bbecf153ff7ccf00f3016fc73a21f4f26c70a72"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDg5NzU4OA==", "bodyText": "i.e. have a separate envoy_mobile_overrides.bzl or similar", "url": "https://github.com/envoyproxy/envoy-mobile/pull/870#discussion_r434897588", "createdAt": "2020-06-03T22:43:28Z", "author": {"login": "goaway"}, "path": "WORKSPACE", "diffHunk": "@@ -1,45 +1,5 @@\n-load(\"@bazel_tools//tools/build_defs/repo:http.bzl\", \"http_archive\", \"http_file\", \"http_jar\")\n-\n-# Patch protobuf to prevent duplicate symbols: https://github.com/lyft/envoy-mobile/issues/617\n-# More details: https://github.com/protocolbuffers/protobuf/issues/7046\n-# TODO: Remove after https://github.com/bazelbuild/bazel/pull/10493 is merged to Bazel\n-# Reverts:\n-# - https://github.com/protocolbuffers/protobuf/commit/7b28278c7d4f4175e70aef2f89d304696eb85ae3\n-# - https://github.com/protocolbuffers/protobuf/commit/a03d332aca5d33c5d4b2cd25037c9e37d57eff02\n-http_archive(\n-    name = \"com_google_protobuf\",\n-    patch_args = [\"-p1\"],\n-    patches = [\n-        \"@envoy//bazel:protobuf.patch\",\n-        \"//bazel:protobuf.patch\",\n-    ],\n-    sha256 = \"d7cfd31620a352b2ee8c1ed883222a0d77e44346643458e062e86b1d069ace3e\",\n-    strip_prefix = \"protobuf-3.10.1\",\n-    urls = [\"https://github.com/protocolbuffers/protobuf/releases/download/v3.10.1/protobuf-all-3.10.1.tar.gz\"],\n-)\n-\n-# Patch upstream Abseil to prevent Foundation dependency from leaking into Android builds.\n-# Workaround for https://github.com/abseil/abseil-cpp/issues/326.\n-# TODO: Should be removed in https://github.com/lyft/envoy-mobile/issues/136 once rules_android\n-# supports platform toolchains.\n-http_archive(\n-    name = \"com_google_absl\",\n-    patches = [\"//bazel:abseil.patch\"],\n-    sha256 = \"14ee08e2089c2a9b6bf27e1d10abc5629c69c4d0bab4b78ec5b65a29ea1c2af7\",\n-    strip_prefix = \"abseil-cpp-cf3a1998e9d41709d4141e2f13375993cba1130e\",\n-    # 2020-03-05\n-    urls = [\"https://github.com/abseil/abseil-cpp/archive/cf3a1998e9d41709d4141e2f13375993cba1130e.tar.gz\"],\n-)\n-\n-# This should be kept in sync with Envoy itself, we just need to apply this patch\n-# Remove this once https://boringssl-review.googlesource.com/c/boringssl/+/37804 is in master-with-bazel\n-http_archive(\n-    name = \"boringssl\",\n-    patches = [\"//bazel:boringssl.patch\"],\n-    sha256 = \"36049e6cd09b353c83878cae0dd84e8b603ba1a40dcd74e44ebad101fc5c672d\",\n-    strip_prefix = \"boringssl-37b57ed537987f1b4c60c60fa1aba20f3a0f6d26\",\n-    urls = [\"https://github.com/google/boringssl/archive/37b57ed537987f1b4c60c60fa1aba20f3a0f6d26.tar.gz\"],\n-)\n+load(\"//bazel:envoy_mobile_repositories.bzl\", \"envoy_mobile_repositories\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDg1MzMwNA=="}, "originalCommit": {"oid": "7bbecf153ff7ccf00f3016fc73a21f4f26c70a72"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDkwNTUwOQ==", "bodyText": "There's an implicit rationale for having this declared up top (and group these declarations before envoy). These are dependencies which are not dependent on any envoy upstream dependencies. Having this up top here guarantees that if we add new dependencies, we know it's free from any upstream envoy dependencies\nWe can separate this out but I'm not entirely sure if an explicit call out is needed. How about we keep this for now and if we end up deciding to split it out, we can do it then? @goaway", "url": "https://github.com/envoyproxy/envoy-mobile/pull/870#discussion_r434905509", "createdAt": "2020-06-03T23:08:00Z", "author": {"login": "buildbreaker"}, "path": "WORKSPACE", "diffHunk": "@@ -1,45 +1,5 @@\n-load(\"@bazel_tools//tools/build_defs/repo:http.bzl\", \"http_archive\", \"http_file\", \"http_jar\")\n-\n-# Patch protobuf to prevent duplicate symbols: https://github.com/lyft/envoy-mobile/issues/617\n-# More details: https://github.com/protocolbuffers/protobuf/issues/7046\n-# TODO: Remove after https://github.com/bazelbuild/bazel/pull/10493 is merged to Bazel\n-# Reverts:\n-# - https://github.com/protocolbuffers/protobuf/commit/7b28278c7d4f4175e70aef2f89d304696eb85ae3\n-# - https://github.com/protocolbuffers/protobuf/commit/a03d332aca5d33c5d4b2cd25037c9e37d57eff02\n-http_archive(\n-    name = \"com_google_protobuf\",\n-    patch_args = [\"-p1\"],\n-    patches = [\n-        \"@envoy//bazel:protobuf.patch\",\n-        \"//bazel:protobuf.patch\",\n-    ],\n-    sha256 = \"d7cfd31620a352b2ee8c1ed883222a0d77e44346643458e062e86b1d069ace3e\",\n-    strip_prefix = \"protobuf-3.10.1\",\n-    urls = [\"https://github.com/protocolbuffers/protobuf/releases/download/v3.10.1/protobuf-all-3.10.1.tar.gz\"],\n-)\n-\n-# Patch upstream Abseil to prevent Foundation dependency from leaking into Android builds.\n-# Workaround for https://github.com/abseil/abseil-cpp/issues/326.\n-# TODO: Should be removed in https://github.com/lyft/envoy-mobile/issues/136 once rules_android\n-# supports platform toolchains.\n-http_archive(\n-    name = \"com_google_absl\",\n-    patches = [\"//bazel:abseil.patch\"],\n-    sha256 = \"14ee08e2089c2a9b6bf27e1d10abc5629c69c4d0bab4b78ec5b65a29ea1c2af7\",\n-    strip_prefix = \"abseil-cpp-cf3a1998e9d41709d4141e2f13375993cba1130e\",\n-    # 2020-03-05\n-    urls = [\"https://github.com/abseil/abseil-cpp/archive/cf3a1998e9d41709d4141e2f13375993cba1130e.tar.gz\"],\n-)\n-\n-# This should be kept in sync with Envoy itself, we just need to apply this patch\n-# Remove this once https://boringssl-review.googlesource.com/c/boringssl/+/37804 is in master-with-bazel\n-http_archive(\n-    name = \"boringssl\",\n-    patches = [\"//bazel:boringssl.patch\"],\n-    sha256 = \"36049e6cd09b353c83878cae0dd84e8b603ba1a40dcd74e44ebad101fc5c672d\",\n-    strip_prefix = \"boringssl-37b57ed537987f1b4c60c60fa1aba20f3a0f6d26\",\n-    urls = [\"https://github.com/google/boringssl/archive/37b57ed537987f1b4c60c60fa1aba20f3a0f6d26.tar.gz\"],\n-)\n+load(\"//bazel:envoy_mobile_repositories.bzl\", \"envoy_mobile_repositories\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDg1MzMwNA=="}, "originalCommit": {"oid": "7bbecf153ff7ccf00f3016fc73a21f4f26c70a72"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDkyODk1Nw==", "bodyText": "I'm going to merge this because I have other patches before we can depend on this from a separate repo. If you want this change, we can talk about it tomorrow @goaway", "url": "https://github.com/envoyproxy/envoy-mobile/pull/870#discussion_r434928957", "createdAt": "2020-06-04T00:34:54Z", "author": {"login": "buildbreaker"}, "path": "WORKSPACE", "diffHunk": "@@ -1,45 +1,5 @@\n-load(\"@bazel_tools//tools/build_defs/repo:http.bzl\", \"http_archive\", \"http_file\", \"http_jar\")\n-\n-# Patch protobuf to prevent duplicate symbols: https://github.com/lyft/envoy-mobile/issues/617\n-# More details: https://github.com/protocolbuffers/protobuf/issues/7046\n-# TODO: Remove after https://github.com/bazelbuild/bazel/pull/10493 is merged to Bazel\n-# Reverts:\n-# - https://github.com/protocolbuffers/protobuf/commit/7b28278c7d4f4175e70aef2f89d304696eb85ae3\n-# - https://github.com/protocolbuffers/protobuf/commit/a03d332aca5d33c5d4b2cd25037c9e37d57eff02\n-http_archive(\n-    name = \"com_google_protobuf\",\n-    patch_args = [\"-p1\"],\n-    patches = [\n-        \"@envoy//bazel:protobuf.patch\",\n-        \"//bazel:protobuf.patch\",\n-    ],\n-    sha256 = \"d7cfd31620a352b2ee8c1ed883222a0d77e44346643458e062e86b1d069ace3e\",\n-    strip_prefix = \"protobuf-3.10.1\",\n-    urls = [\"https://github.com/protocolbuffers/protobuf/releases/download/v3.10.1/protobuf-all-3.10.1.tar.gz\"],\n-)\n-\n-# Patch upstream Abseil to prevent Foundation dependency from leaking into Android builds.\n-# Workaround for https://github.com/abseil/abseil-cpp/issues/326.\n-# TODO: Should be removed in https://github.com/lyft/envoy-mobile/issues/136 once rules_android\n-# supports platform toolchains.\n-http_archive(\n-    name = \"com_google_absl\",\n-    patches = [\"//bazel:abseil.patch\"],\n-    sha256 = \"14ee08e2089c2a9b6bf27e1d10abc5629c69c4d0bab4b78ec5b65a29ea1c2af7\",\n-    strip_prefix = \"abseil-cpp-cf3a1998e9d41709d4141e2f13375993cba1130e\",\n-    # 2020-03-05\n-    urls = [\"https://github.com/abseil/abseil-cpp/archive/cf3a1998e9d41709d4141e2f13375993cba1130e.tar.gz\"],\n-)\n-\n-# This should be kept in sync with Envoy itself, we just need to apply this patch\n-# Remove this once https://boringssl-review.googlesource.com/c/boringssl/+/37804 is in master-with-bazel\n-http_archive(\n-    name = \"boringssl\",\n-    patches = [\"//bazel:boringssl.patch\"],\n-    sha256 = \"36049e6cd09b353c83878cae0dd84e8b603ba1a40dcd74e44ebad101fc5c672d\",\n-    strip_prefix = \"boringssl-37b57ed537987f1b4c60c60fa1aba20f3a0f6d26\",\n-    urls = [\"https://github.com/google/boringssl/archive/37b57ed537987f1b4c60c60fa1aba20f3a0f6d26.tar.gz\"],\n-)\n+load(\"//bazel:envoy_mobile_repositories.bzl\", \"envoy_mobile_repositories\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDg1MzMwNA=="}, "originalCommit": {"oid": "7bbecf153ff7ccf00f3016fc73a21f4f26c70a72"}, "originalPosition": 43}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 807, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}