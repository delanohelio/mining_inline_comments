{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTExNTEwMzAz", "number": 1151, "title": "filters: fix some missing JNI wiring", "bodyText": "Description: A miss at the JNI layer was causing optional pending entities attached to resume iteration return statuses to be dropped. Upcoming additional coverage for this will include new example app filters and integration tests.\nRisk Level: Low\nTesting: Local\nSigned-off-by: Mike Schore mike.schore@gmail.com", "createdAt": "2020-10-28T12:29:35Z", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1151", "merged": true, "mergeCommit": {"oid": "b09220f493c1ea4ae6400d3c4a327466333513a1"}, "closed": true, "closedAt": "2020-11-02T18:21:50Z", "author": {"login": "goaway"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdXD6ndAFqTUxOTA3MjE2MQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdYorWNAFqTUyMTg4MjE0NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE5MDcyMTYx", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1151#pullrequestreview-519072161", "createdAt": "2020-10-28T20:50:13Z", "commit": {"oid": "738d22c734d45cdd41d681dc5ec23b31dd3543ba"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQyMDo1MDoxM1rOHp84ig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQyMDo1MToxMlrOHp86fQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzc1MTE3OA==", "bodyText": "sorry, I am a bit decontextualized here. Why 3? Can we have a constant?", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1151#discussion_r513751178", "createdAt": "2020-10-28T20:50:13Z", "author": {"login": "junr03"}, "path": "library/common/jni/jni_interface.cc", "diffHunk": "@@ -259,10 +259,18 @@ static envoy_filter_data_status jvm_http_filter_on_request_data(envoy_data data,\n   JNIEnv* env = get_env();\n   jobjectArray result = static_cast<jobjectArray>(\n       jvm_on_data(\"onRequestData\", data, end_stream, const_cast<void*>(context)));\n+  jsize size = env->GetArrayLength(result);\n \n   jobject status = env->GetObjectArrayElement(result, 0);\n   jobject j_data = static_cast<jobjectArray>(env->GetObjectArrayElement(result, 1));\n \n+  envoy_headers* pending_headers = nullptr;\n+  if (size == 3) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "738d22c734d45cdd41d681dc5ec23b31dd3543ba"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzc1MTU4NA==", "bodyText": "Can we create static funcs for the repeated code in these functions?", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1151#discussion_r513751584", "createdAt": "2020-10-28T20:50:58Z", "author": {"login": "junr03"}, "path": "library/common/jni/jni_interface.cc", "diffHunk": "@@ -271,18 +279,27 @@ static envoy_filter_data_status jvm_http_filter_on_request_data(envoy_data data,\n   env->DeleteLocalRef(j_data);\n \n   return (envoy_filter_data_status){/*status*/ unboxed_status,\n-                                    /*data*/ native_data};\n+                                    /*data*/ native_data,\n+                                    /*pending_headers*/ pending_headers};\n }\n \n static envoy_filter_data_status jvm_http_filter_on_response_data(envoy_data data, bool end_stream,\n                                                                  const void* context) {\n   JNIEnv* env = get_env();\n   jobjectArray result = static_cast<jobjectArray>(\n       jvm_on_data(\"onResponseData\", data, end_stream, const_cast<void*>(context)));\n+  jsize size = env->GetArrayLength(result);\n \n   jobject status = env->GetObjectArrayElement(result, 0);\n   jobject j_data = static_cast<jobjectArray>(env->GetObjectArrayElement(result, 1));\n \n+  envoy_headers* pending_headers = nullptr;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "738d22c734d45cdd41d681dc5ec23b31dd3543ba"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzc1MTY3Nw==", "bodyText": "Same two comments as above", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1151#discussion_r513751677", "createdAt": "2020-10-28T20:51:12Z", "author": {"login": "junr03"}, "path": "library/common/jni/jni_interface.cc", "diffHunk": "@@ -328,39 +346,69 @@ static envoy_filter_trailers_status jvm_http_filter_on_request_trailers(envoy_he\n   JNIEnv* env = get_env();\n   jobjectArray result = static_cast<jobjectArray>(\n       jvm_on_trailers(\"onRequestTrailers\", trailers, const_cast<void*>(context)));\n+  jsize size = env->GetArrayLength(result);\n \n   jobject status = env->GetObjectArrayElement(result, 0);\n   jobjectArray j_trailers = static_cast<jobjectArray>(env->GetObjectArrayElement(result, 1));\n \n   int unboxed_status = unbox_integer(env, status);\n-  envoy_headers native_headers = to_native_headers(env, j_trailers);\n+  envoy_headers native_trailers = to_native_headers(env, j_trailers);\n+\n+  envoy_headers* pending_headers = nullptr;\n+  envoy_data* pending_data = nullptr;\n+  if (size == 4) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "738d22c734d45cdd41d681dc5ec23b31dd3543ba"}, "originalPosition": 73}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d53cd0e9ba9c93211cb75ec800f489fb553c7094", "author": {"user": {"login": "goaway", "name": "Mike Schore"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/d53cd0e9ba9c93211cb75ec800f489fb553c7094", "committedDate": "2020-10-31T19:02:57Z", "message": "filters: fix some missing JNI wiring\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ee899b5cc3a45e34ac8220f05ab7c9daf103e01c", "author": {"user": {"login": "goaway", "name": "Mike Schore"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/ee899b5cc3a45e34ac8220f05ab7c9daf103e01c", "committedDate": "2020-10-31T19:02:57Z", "message": "add comment; fix index\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bdf81036263f96eded08f48d7d3a29d40bcc8630", "author": {"user": {"login": "goaway", "name": "Mike Schore"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/bdf81036263f96eded08f48d7d3a29d40bcc8630", "committedDate": "2020-10-31T19:02:57Z", "message": "switch to different (maybe clearer?) check\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "644d53249144a828bce16a0053adfb41eed0b518", "author": {"user": {"login": "goaway", "name": "Mike Schore"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/644d53249144a828bce16a0053adfb41eed0b518", "committedDate": "2020-10-31T19:02:57Z", "message": "fix declaration ordering\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c09b1d86a267ff9e4ffd2b4646e2a7119fd6a81e", "author": {"user": {"login": "goaway", "name": "Mike Schore"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/c09b1d86a267ff9e4ffd2b4646e2a7119fd6a81e", "committedDate": "2020-10-31T10:44:00Z", "message": "switch to different (maybe clearer?) check\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>"}, "afterCommit": {"oid": "644d53249144a828bce16a0053adfb41eed0b518", "author": {"user": {"login": "goaway", "name": "Mike Schore"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/644d53249144a828bce16a0053adfb41eed0b518", "committedDate": "2020-10-31T19:02:57Z", "message": "fix declaration ordering\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxODQ0NzU1", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1151#pullrequestreview-521844755", "createdAt": "2020-11-02T17:24:36Z", "commit": {"oid": "644d53249144a828bce16a0053adfb41eed0b518"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxODgyMTQ1", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1151#pullrequestreview-521882145", "createdAt": "2020-11-02T18:14:58Z", "commit": {"oid": "644d53249144a828bce16a0053adfb41eed0b518"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3882, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}