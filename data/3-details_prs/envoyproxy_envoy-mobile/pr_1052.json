{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc0MzYyNzI3", "number": 1052, "title": "Introduce Counter protocol", "bodyText": "Description: Make StatsClient protocol's interface return Counter protocol (as opposed to Counter class) to make mocking of the StatsClient easier.\nUse case: in our Lyft application we need a way to mock StatsClient (protocol). An instance of the object conforming to this protocol can be created with the use of Envoy engine. In unit tests, we do not want to use Envoy engine and hence we need a way to create a custom object conforming to StatsClient protocol.\nTo implement a StatsClient protocol one needs to implements func counter(_ elements: [Element]) -> Counter method. In order to implement this method a developer needs to be able to initialize a new instance of Counter, it's currently not possible to do from outside of the module in which Counter is defined because:\n\nCounter does  not provide any public initializer.\nCounter cannot be subclassed since public classes don't allow for subclassing from outside of the module in which they are defined.\n\nRisk Level: Low, additive change\nTesting: No testing performed since it shouldn't influence the way framework works\nDocs Changes: No changes\nRelease Notes: No changes", "createdAt": "2020-08-26T23:59:49Z", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1052", "merged": true, "mergeCommit": {"oid": "d3eb6af406bb4ed1833018c1fe59b459b071bafb"}, "closed": true, "closedAt": "2020-08-27T21:55:51Z", "author": {"login": "Augustyniak"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdC05AmgH2gAyNDc0MzYyNzI3OjIyMmUwNjcxYzU3Yjk2OTgyYzdmY2IxNzQxYzBhNWJlNjRmZTA5MGQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdDHrNCAFqTQ3NzExMTYwNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "222e0671c57b96982c7fcb1741c0a5be64fe090d", "author": {"user": {"login": "Augustyniak", "name": "Rafa\u0142 Augustyniak"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/222e0671c57b96982c7fcb1741c0a5be64fe090d", "committedDate": "2020-08-27T00:02:25Z", "message": "Make class open to allow subclassing\n\nSigned-off-by: Rafal Augustyniak <raugustyniak@lyft.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "20dca5a5c039db1f5b231f1d2a3b03a9cc75cfc1", "author": {"user": {"login": "Augustyniak", "name": "Rafa\u0142 Augustyniak"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/20dca5a5c039db1f5b231f1d2a3b03a9cc75cfc1", "committedDate": "2020-08-27T00:02:25Z", "message": "Introduce Counter protocol\n\nSigned-off-by: Rafal Augustyniak <raugustyniak@lyft.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "178eb952d9a732f3c1272325b8cd9ce501b98415", "author": {"user": {"login": "Augustyniak", "name": "Rafa\u0142 Augustyniak"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/178eb952d9a732f3c1272325b8cd9ce501b98415", "committedDate": "2020-08-27T00:02:25Z", "message": "Add missing files\n\nSigned-off-by: Rafal Augustyniak <raugustyniak@lyft.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9207fee3937391a0da1f09b6c2fa53b0e2ea1e6f", "author": {"user": {"login": "Augustyniak", "name": "Rafa\u0142 Augustyniak"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/9207fee3937391a0da1f09b6c2fa53b0e2ea1e6f", "committedDate": "2020-08-27T00:00:19Z", "message": "Add missing files"}, "afterCommit": {"oid": "178eb952d9a732f3c1272325b8cd9ce501b98415", "author": {"user": {"login": "Augustyniak", "name": "Rafa\u0142 Augustyniak"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/178eb952d9a732f3c1272325b8cd9ce501b98415", "committedDate": "2020-08-27T00:02:25Z", "message": "Add missing files\n\nSigned-off-by: Rafal Augustyniak <raugustyniak@lyft.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "736792be9262f6d7defc4dbc12fcbcf09472b3a1", "author": {"user": {"login": "Augustyniak", "name": "Rafa\u0142 Augustyniak"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/736792be9262f6d7defc4dbc12fcbcf09472b3a1", "committedDate": "2020-08-27T00:06:11Z", "message": "fix\n\nSigned-off-by: Rafal Augustyniak <raugustyniak@lyft.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "37e9010add7a379b64cb1b5ab662b8f383605262", "author": {"user": {"login": "Augustyniak", "name": "Rafa\u0142 Augustyniak"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/37e9010add7a379b64cb1b5ab662b8f383605262", "committedDate": "2020-08-27T00:47:23Z", "message": "fix"}, "afterCommit": {"oid": "736792be9262f6d7defc4dbc12fcbcf09472b3a1", "author": {"user": {"login": "Augustyniak", "name": "Rafa\u0142 Augustyniak"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/736792be9262f6d7defc4dbc12fcbcf09472b3a1", "committedDate": "2020-08-27T00:06:11Z", "message": "fix\n\nSigned-off-by: Rafal Augustyniak <raugustyniak@lyft.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "11cd6f58d06e4b13ce8770ac3883005539e92a70", "author": {"user": {"login": "Augustyniak", "name": "Rafa\u0142 Augustyniak"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/11cd6f58d06e4b13ce8770ac3883005539e92a70", "committedDate": "2020-08-27T00:50:33Z", "message": "fix\n\nSigned-off-by: Rafal Augustyniak <raugustyniak@lyft.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bbe021bc928ea34d8a8acf1f0ef105123942a9f8", "author": {"user": {"login": "Augustyniak", "name": "Rafa\u0142 Augustyniak"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/bbe021bc928ea34d8a8acf1f0ef105123942a9f8", "committedDate": "2020-08-27T00:53:04Z", "message": "remove unnecessary import\n\nSigned-off-by: Rafal Augustyniak <raugustyniak@lyft.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8dd194801c9a385535eed4e6a1e3bc819637c17b", "author": {"user": {"login": "Augustyniak", "name": "Rafa\u0142 Augustyniak"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/8dd194801c9a385535eed4e6a1e3bc819637c17b", "committedDate": "2020-08-27T01:48:52Z", "message": "empty\n\nSigned-off-by: Rafal Augustyniak <raugustyniak@lyft.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d959fd406858e39779aed35046bd4cb59475c9e0", "author": {"user": {"login": "Augustyniak", "name": "Rafa\u0142 Augustyniak"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/d959fd406858e39779aed35046bd4cb59475c9e0", "committedDate": "2020-08-27T15:33:59Z", "message": "improve test\n\nSigned-off-by: Rafal Augustyniak <raugustyniak@lyft.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc3MDgwMjc0", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1052#pullrequestreview-477080274", "createdAt": "2020-08-27T21:04:55Z", "commit": {"oid": "d959fd406858e39779aed35046bd4cb59475c9e0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QyMTowNDo1NVrOHIhOAQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QyMTowNDo1NVrOHIhOAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODY5NDkxMw==", "bodyText": "no default value of an argument can be specified in Swift's protocol - that's why I need to have a method defined in an extension.", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1052#discussion_r478694913", "createdAt": "2020-08-27T21:04:55Z", "author": {"login": "Augustyniak"}, "path": "library/swift/src/stats/Counter.swift", "diffHunk": "@@ -1,24 +1,15 @@\n-@_implementationOnly import EnvoyEngine\n import Foundation\n \n /// A time series counter.\n-@objcMembers\n-public class Counter: NSObject {\n-  private let series: String\n-  private weak var engine: EnvoyEngine?\n-\n-  init(elements: [Element], engine: EnvoyEngine) {\n-    self.series = elements.map { $0.value }.joined(separator: \".\")\n-    self.engine = engine\n-    super.init()\n-  }\n-\n+@objc\n+public protocol Counter: AnyObject {\n   /// Increment the counter by the given count.\n-  public func increment(count: Int = 1) {\n-    guard let engine = self.engine else {\n-      return\n-    }\n+  func increment(count: Int)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d959fd406858e39779aed35046bd4cb59475c9e0"}, "originalPosition": 23}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc3MDg4NTg1", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1052#pullrequestreview-477088585", "createdAt": "2020-08-27T21:14:03Z", "commit": {"oid": "d959fd406858e39779aed35046bd4cb59475c9e0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QyMToxNDowNFrOHIhfvQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QyMToxNDowNFrOHIhfvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODY5OTQ1Mw==", "bodyText": "nit: on android we usually use I to prefix an interface (similar to swift protocol). if this was an android class, it would be named ICounter.\npersonally i don't have too strong of an opinion on this, but Counter definitely doesn't not intuitively suggest an interface.\nis there a similar naming convention for swift @Augustyniak? im guessing not, but would like to confirm.", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1052#discussion_r478699453", "createdAt": "2020-08-27T21:14:04Z", "author": {"login": "jingwei99"}, "path": "library/swift/src/stats/Counter.swift", "diffHunk": "@@ -1,24 +1,15 @@\n-@_implementationOnly import EnvoyEngine", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d959fd406858e39779aed35046bd4cb59475c9e0"}, "originalPosition": 1}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc3MTExMzM0", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1052#pullrequestreview-477111334", "createdAt": "2020-08-27T21:55:01Z", "commit": {"oid": "d959fd406858e39779aed35046bd4cb59475c9e0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc3MTExNjA1", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1052#pullrequestreview-477111605", "createdAt": "2020-08-27T21:55:32Z", "commit": {"oid": "d959fd406858e39779aed35046bd4cb59475c9e0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3991, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}