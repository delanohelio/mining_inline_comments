{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTExOTM2NzU5", "number": 1155, "title": "Revert \"Revert \"stats: update method names of counter\"", "bodyText": "Reverts #1153\nDescription: Update the method names of counters to follow the same convention as Gauge. This PR also added integration tests for counter and gauge to guard related changes from crashing on the platform side.\nRisk Level: Moderate\nTesting: Local and CI\nSigned-off-by: Jingwei Hao jingwei.hao@gmail.com", "createdAt": "2020-10-29T00:38:18Z", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1155", "merged": true, "mergeCommit": {"oid": "755118c80d82d6153a7ffc3a37a8505b8a36478b"}, "closed": true, "closedAt": "2020-11-12T02:45:46Z", "author": {"login": "jingwei99"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdbPbxXABqjM5ODA4MzA3MTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdbl5rugH2gAyNTExOTM2NzU5OjczMGU3NmNkNTZlYWU1MGNiZTg4OWZkNjhmMTBjNmI0YzgzODk1MDg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "12200336993d754f78b50851d2179bf857d94c0a", "author": {"user": {"login": "jingwei99", "name": "Jingwei"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/12200336993d754f78b50851d2179bf857d94c0a", "committedDate": "2020-10-29T00:37:57Z", "message": "Revert \"Revert \"stats: update method names of counter (#1134)\" (#1153)\"\n\nThis reverts commit d2eb9036b3e4b47e116c28b52c55597affe11b36."}, "afterCommit": {"oid": "00312ac179c74f36f1dd6610da775cc968d214c1", "author": {"user": {"login": "jingwei99", "name": "Jingwei"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/00312ac179c74f36f1dd6610da775cc968d214c1", "committedDate": "2020-11-10T20:31:04Z", "message": "stats: update method names of counter\n\nSigned-off-by: Jingwei Hao <jingwei.hao@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d609b390d3ea3446fa651aba1b59065803effb4f", "author": {"user": {"login": "jingwei99", "name": "Jingwei"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/d609b390d3ea3446fa651aba1b59065803effb4f", "committedDate": "2020-11-10T21:39:54Z", "message": "stats: update method names of counter\n\nSigned-off-by: Jingwei Hao <jingwei.hao@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "00312ac179c74f36f1dd6610da775cc968d214c1", "author": {"user": {"login": "jingwei99", "name": "Jingwei"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/00312ac179c74f36f1dd6610da775cc968d214c1", "committedDate": "2020-11-10T20:31:04Z", "message": "stats: update method names of counter\n\nSigned-off-by: Jingwei Hao <jingwei.hao@gmail.com>"}, "afterCommit": {"oid": "d609b390d3ea3446fa651aba1b59065803effb4f", "author": {"user": {"login": "jingwei99", "name": "Jingwei"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/d609b390d3ea3446fa651aba1b59065803effb4f", "committedDate": "2020-11-10T21:39:54Z", "message": "stats: update method names of counter\n\nSigned-off-by: Jingwei Hao <jingwei.hao@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c67d76434d82785012013b7a5875a059fe6c274e", "author": {"user": {"login": "jingwei99", "name": "Jingwei"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/c67d76434d82785012013b7a5875a059fe6c274e", "committedDate": "2020-11-10T22:06:18Z", "message": "lint precommit format\n\nSigned-off-by: Jingwei Hao <jingwei.hao@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3Njg0MDMz", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1155#pullrequestreview-527684033", "createdAt": "2020-11-10T23:15:35Z", "commit": {"oid": "c67d76434d82785012013b7a5875a059fe6c274e"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQyMzoxNTozNVrOHwzU4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQyMzoxNjo0NlrOHwzWtQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDkzNDYyNg==", "bodyText": "Maybe vary these numbers?", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1155#discussion_r520934626", "createdAt": "2020-11-10T23:15:35Z", "author": {"login": "rebello95"}, "path": "examples/java/hello_world/MainActivity.java", "diffHunk": "@@ -127,4 +131,19 @@ private void makeRequest() {\n         .start(Executors.newSingleThreadExecutor())\n         .sendHeaders(requestHeaders, true);\n   }\n+\n+  private void recordStats() {\n+    final Counter counter = engine.statsClient().counter(new Element(\"foo\"), new Element(\"bar\"),\n+                                                         new Element(\"counter\"));\n+\n+    final Gauge gauge =\n+        engine.statsClient().gauge(new Element(\"foo\"), new Element(\"bar\"), new Element(\"gauge\"));\n+\n+    counter.increment(1);\n+    counter.increment(5);\n+\n+    gauge.set(5);\n+    gauge.add(5);\n+    gauge.sub(5);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c67d76434d82785012013b7a5875a059fe6c274e"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDkzNDY4Mg==", "bodyText": "@buildbreaker is this file required?", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1155#discussion_r520934682", "createdAt": "2020-11-10T23:15:43Z", "author": {"login": "rebello95"}, "path": "examples/java/hello_world/hello_world.iml", "diffHunk": "@@ -0,0 +1,11 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c67d76434d82785012013b7a5875a059fe6c274e"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDkzNDkxOQ==", "bodyText": "Please spell out \"element\" (more idiomatic on iOS)", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1155#discussion_r520934919", "createdAt": "2020-11-10T23:16:19Z", "author": {"login": "rebello95"}, "path": "examples/objective-c/hello_world/ViewController.m", "diffHunk": "@@ -123,6 +126,20 @@ - (void)addResponseMessage:(NSString *)message\n   [self.tableView reloadData];\n }\n \n+- (void)sendStats {\n+  Element *eleFoo = [[Element alloc] initWithStringLiteral:@\"foo\"];", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c67d76434d82785012013b7a5875a059fe6c274e"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDkzNTA5Mw==", "bodyText": "Why are these different from Android?", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1155#discussion_r520935093", "createdAt": "2020-11-10T23:16:46Z", "author": {"login": "rebello95"}, "path": "examples/objective-c/hello_world/ViewController.m", "diffHunk": "@@ -123,6 +126,20 @@ - (void)addResponseMessage:(NSString *)message\n   [self.tableView reloadData];\n }\n \n+- (void)sendStats {\n+  Element *eleFoo = [[Element alloc] initWithStringLiteral:@\"foo\"];\n+  Element *eleBar = [[Element alloc] initWithStringLiteral:@\"bar\"];\n+  Element *eleCounter = [[Element alloc] initWithStringLiteral:@\"counter\"];\n+  Element *eleGauge = [[Element alloc] initWithStringLiteral:@\"gauge\"];\n+  id<Counter> counter = [self.statsClient counterWithElements:@[ eleFoo, eleBar, eleCounter ]];\n+  [counter incrementWithCount:1];\n+\n+  id<Gauge> gauge = [self.statsClient gaugeWithElements:@[ eleFoo, eleBar, eleGauge ]];\n+  [gauge setWithValue:1];\n+  [gauge addWithAmount:1];\n+  [gauge subWithAmount:1];", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c67d76434d82785012013b7a5875a059fe6c274e"}, "originalPosition": 46}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e3dc81aa74d8990bf1a783c053866f092a4c19a9", "author": {"user": {"login": "jingwei99", "name": "Jingwei"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/e3dc81aa74d8990bf1a783c053866f092a4c19a9", "committedDate": "2020-11-10T23:43:32Z", "message": "comments\n\nSigned-off-by: Jingwei Hao <jingwei.hao@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3Njk3NTk5", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1155#pullrequestreview-527697599", "createdAt": "2020-11-10T23:45:54Z", "commit": {"oid": "c145cc554496742ba1a4e2dfb1480e9eba7681ed"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "056289d4023644bdff2ccf1c32c4ce7db12b3505", "author": {"user": {"login": "jingwei99", "name": "Jingwei"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/056289d4023644bdff2ccf1c32c4ce7db12b3505", "committedDate": "2020-11-10T23:48:05Z", "message": "reset envoy version\n\nSigned-off-by: Jingwei Hao <jingwei.hao@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c145cc554496742ba1a4e2dfb1480e9eba7681ed", "author": {"user": {"login": "jingwei99", "name": "Jingwei"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/c145cc554496742ba1a4e2dfb1480e9eba7681ed", "committedDate": "2020-11-10T23:42:39Z", "message": "comments\n\nSigned-off-by: Jingwei Hao <jingwei.hao@gmail.com>"}, "afterCommit": {"oid": "056289d4023644bdff2ccf1c32c4ce7db12b3505", "author": {"user": {"login": "jingwei99", "name": "Jingwei"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/056289d4023644bdff2ccf1c32c4ce7db12b3505", "committedDate": "2020-11-10T23:48:05Z", "message": "reset envoy version\n\nSigned-off-by: Jingwei Hao <jingwei.hao@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3Nzc3MDcy", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1155#pullrequestreview-527777072", "createdAt": "2020-11-11T01:23:10Z", "commit": {"oid": "056289d4023644bdff2ccf1c32c4ce7db12b3505"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQwMToyMzoxMFrOHw2v-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQwMToyMzoxMFrOHw2v-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDk5MDcxNQ==", "bodyText": "I just noticed this - it looks like iOS is sending stats only once whereas Android is sending them with each request, is that correct? If so, these should be consistent", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1155#discussion_r520990715", "createdAt": "2020-11-11T01:23:10Z", "author": {"login": "rebello95"}, "path": "examples/objective-c/hello_world/ViewController.m", "diffHunk": "@@ -46,8 +47,10 @@ - (void)startEnvoy {\n     NSLog(@\"starting Envoy failed: %@\", error);\n   } else {\n     NSLog(@\"started Envoy, beginning requests...\");\n-    self.client = [engine streamClient];\n+    self.streamClient = [engine streamClient];\n+    self.statsClient = [engine statsClient];\n     [self startRequests];\n+    [self sendStats];", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "056289d4023644bdff2ccf1c32c4ce7db12b3505"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3cb62e388a836f6078f8b22377fc0ada07db5593", "author": {"user": {"login": "jingwei99", "name": "Jingwei"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/3cb62e388a836f6078f8b22377fc0ada07db5593", "committedDate": "2020-11-11T02:02:31Z", "message": "record stats for every request\n\nSigned-off-by: Jingwei Hao <jingwei.hao@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI4Mzk3ODEy", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1155#pullrequestreview-528397812", "createdAt": "2020-11-11T17:44:24Z", "commit": {"oid": "3cb62e388a836f6078f8b22377fc0ada07db5593"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bfbb9d4e4353fa6442c691cacb65d22309b5cebd", "author": {"user": {"login": "jingwei99", "name": "Jingwei"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/bfbb9d4e4353fa6442c691cacb65d22309b5cebd", "committedDate": "2020-11-11T19:41:28Z", "message": "Merge branch 'main' into revert-1153-revert-1134-rename_counter"}, "afterCommit": {"oid": "3cb62e388a836f6078f8b22377fc0ada07db5593", "author": {"user": {"login": "jingwei99", "name": "Jingwei"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/3cb62e388a836f6078f8b22377fc0ada07db5593", "committedDate": "2020-11-11T02:02:31Z", "message": "record stats for every request\n\nSigned-off-by: Jingwei Hao <jingwei.hao@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cda0a8b16d45004e6c16d6c0bc589434ce86759b", "author": {"user": {"login": "jingwei99", "name": "Jingwei"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/cda0a8b16d45004e6c16d6c0bc589434ce86759b", "committedDate": "2020-11-11T22:00:13Z", "message": "Merge branch 'main' into revert-1153-revert-1134-rename_counter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0d7f2918da8fa9a2d09b1d3c511bac976a68ca4b", "author": {"user": {"login": "jingwei99", "name": "Jingwei"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/0d7f2918da8fa9a2d09b1d3c511bac976a68ca4b", "committedDate": "2020-11-11T22:10:23Z", "message": "Merge branch 'main' into revert-1153-revert-1134-rename_counter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "730e76cd56eae50cbe889fd68f10c6b4c8389508", "author": {"user": {"login": "jingwei99", "name": "Jingwei"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/730e76cd56eae50cbe889fd68f10c6b4c8389508", "committedDate": "2020-11-11T22:42:41Z", "message": "Merge branch 'main' into revert-1153-revert-1134-rename_counter"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3887, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}