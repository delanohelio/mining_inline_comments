{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcxMDIzMzA4", "number": 659, "title": "ios/android: allow zero for total upstream timeouts", "bodyText": "We should allow zero to be specified for totalUpstreamTimeoutMS, which effectively disables the upstream timeout per Envoy's docs.\nThis can be useful for consumers who only want to timeout on a per-request basis (rather than timing out all retries in aggregate).\nSigned-off-by: Michael Rebello me@michaelrebello.com", "createdAt": "2020-02-04T19:58:28Z", "url": "https://github.com/envoyproxy/envoy-mobile/pull/659", "merged": true, "mergeCommit": {"oid": "b65fe924bd90df0bda50eebb9ac56f611b230bde"}, "closed": true, "closedAt": "2020-02-05T00:34:44Z", "author": {"login": "rebello95"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcBHHzgAH2gAyMzcxMDIzMzA4OmFiNTBmNjM2N2YwZDNjOTQwMTc1NzhjNmQ4MDdkNTMzOWFiMTA3M2E=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcBLE3ygFqTM1MzM5OTE0Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ab50f6367f0d3c94017578c6d807d5339ab1073a", "author": {"user": {"login": "rebello95", "name": "Michael Rebello"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/ab50f6367f0d3c94017578c6d807d5339ab1073a", "committedDate": "2020-02-04T19:57:52Z", "message": "ios/android: allow zero for total upstream timeouts\n\nWe should allow zero to be specified for `totalUpstreamTimeoutMS`, which effectively [disables the upstream timeout per Envoy's docs](https://www.envoyproxy.io/docs/envoy/latest/api-v2/api/v2/route/route_components.proto#envoy-api-field-route-routeaction-timeout).\n\nThis can be useful for consumers who only want to timeout on a per-request basis (rather than timing out all retries in aggregate).\n\nSigned-off-by: Michael Rebello <me@michaelrebello.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzMjYyNTk1", "url": "https://github.com/envoyproxy/envoy-mobile/pull/659#pullrequestreview-353262595", "createdAt": "2020-02-04T20:01:46Z", "commit": {"oid": "ab50f6367f0d3c94017578c6d807d5339ab1073a"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2816ba5f7ddaa936cabc69f7a894bdffc135f214", "author": {"user": {"login": "rebello95", "name": "Michael Rebello"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/2816ba5f7ddaa936cabc69f7a894bdffc135f214", "committedDate": "2020-02-04T20:19:02Z", "message": "optionality\n\nSigned-off-by: Michael Rebello <me@michaelrebello.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzMjc0OTUz", "url": "https://github.com/envoyproxy/envoy-mobile/pull/659#pullrequestreview-353274953", "createdAt": "2020-02-04T20:22:25Z", "commit": {"oid": "2816ba5f7ddaa936cabc69f7a894bdffc135f214"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQyMDoyMjoyNVrOFliN3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQyMDoyMjoyNVrOFliN3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDkwMjIzNg==", "bodyText": "you still need to check for totalUpstreamTimeoutMS = 0 here, right?", "url": "https://github.com/envoyproxy/envoy-mobile/pull/659#discussion_r374902236", "createdAt": "2020-02-04T20:22:25Z", "author": {"login": "Augustyniak"}, "path": "library/swift/src/RetryPolicy.swift", "diffHunk": "@@ -47,13 +47,15 @@ public final class RetryPolicy: NSObject {\n   ///                                     retries. Spans the point at which the entire downstream\n   ///                                     request has been processed and when the upstream\n   ///                                     response has been completely processed.\n-  ///                                     Zero may be specified to disable the upstream timeout.\n+  ///                                     Nil may be specified to disable the upstream timeout.\n   public init(maxRetryCount: UInt, retryOn: [RetryRule], perRetryTimeoutMS: UInt? = nil,\n-              totalUpstreamTimeoutMS: UInt = 15_000)\n+              totalUpstreamTimeoutMS: UInt? = 15_000)\n   {\n-    if let perRetryTimeoutMS = perRetryTimeoutMS {\n-      assert(perRetryTimeoutMS <= totalUpstreamTimeoutMS || totalUpstreamTimeoutMS == 0,\n-             \"Per-retry timeout must be <= total timeout if total timeout != 0\")\n+    if let perRetryTimeoutMS = perRetryTimeoutMS,\n+      let totalUpstreamTimeoutMS = totalUpstreamTimeoutMS\n+    {\n+      assert(perRetryTimeoutMS <= totalUpstreamTimeoutMS,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2816ba5f7ddaa936cabc69f7a894bdffc135f214"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzMjc2NjI3", "url": "https://github.com/envoyproxy/envoy-mobile/pull/659#pullrequestreview-353276627", "createdAt": "2020-02-04T20:25:14Z", "commit": {"oid": "2816ba5f7ddaa936cabc69f7a894bdffc135f214"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQyMDoyNToxNFrOFliS5Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQyMDoyNToxNFrOFliS5Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDkwMzUyNQ==", "bodyText": "let's add a test case for when per request timeout is equal to 0 (not nil) and per retry timeout is greater than 0.", "url": "https://github.com/envoyproxy/envoy-mobile/pull/659#discussion_r374903525", "createdAt": "2020-02-04T20:25:14Z", "author": {"login": "Augustyniak"}, "path": "library/swift/test/RetryPolicyMapperTests.swift", "diffHunk": "@@ -23,4 +23,9 @@ final class RetryPolicyMapperTests: XCTestCase {\n     let policy = RetryPolicy(maxRetryCount: 123, retryOn: RetryRule.allCases)\n     XCTAssertNil(policy.outboundHeaders()[\"x-envoy-upstream-rq-per-try-timeout-ms\"])\n   }\n+\n+  func testConvertingToHeadersWithoutUpstreamTimeoutIncludesZeroForTimeoutHeader() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2816ba5f7ddaa936cabc69f7a894bdffc135f214"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce1eceb39eda941d027a14347e70416798c8b672", "author": {"user": {"login": "rebello95", "name": "Michael Rebello"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/ce1eceb39eda941d027a14347e70416798c8b672", "committedDate": "2020-02-04T21:30:00Z", "message": "fixups\n\nSigned-off-by: Michael Rebello <me@michaelrebello.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2e5622c99a083f65e27d1c8c891886bf7b82072d", "author": {"user": {"login": "rebello95", "name": "Michael Rebello"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/2e5622c99a083f65e27d1c8c891886bf7b82072d", "committedDate": "2020-02-04T22:35:34Z", "message": "CR fixes\n\nSigned-off-by: Michael Rebello <me@michaelrebello.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9be03d6a30cbe803fb0acdf5c36ccd4ea16f8817", "author": {"user": {"login": "rebello95", "name": "Michael Rebello"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/9be03d6a30cbe803fb0acdf5c36ccd4ea16f8817", "committedDate": "2020-02-04T22:43:28Z", "message": "tweak docs\n\nSigned-off-by: Michael Rebello <me@michaelrebello.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d1020d012536c10cb44291dc3eb75398d0a8f2e5", "author": {"user": {"login": "rebello95", "name": "Michael Rebello"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/d1020d012536c10cb44291dc3eb75398d0a8f2e5", "committedDate": "2020-02-04T22:45:23Z", "message": "update assertion text\n\nSigned-off-by: Michael Rebello <me@michaelrebello.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzMzU5MDY0", "url": "https://github.com/envoyproxy/envoy-mobile/pull/659#pullrequestreview-353359064", "createdAt": "2020-02-04T22:50:05Z", "commit": {"oid": "d1020d012536c10cb44291dc3eb75398d0a8f2e5"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bae6f688aa37877e248fb697b262f787a67c1b7b", "author": {"user": {"login": "rebello95", "name": "Michael Rebello"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/bae6f688aa37877e248fb697b262f787a67c1b7b", "committedDate": "2020-02-04T22:51:58Z", "message": "fixup\n\nSigned-off-by: Michael Rebello <me@michaelrebello.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzMzYwMzA2", "url": "https://github.com/envoyproxy/envoy-mobile/pull/659#pullrequestreview-353360306", "createdAt": "2020-02-04T22:52:46Z", "commit": {"oid": "bae6f688aa37877e248fb697b262f787a67c1b7b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzMzk5MTQz", "url": "https://github.com/envoyproxy/envoy-mobile/pull/659#pullrequestreview-353399143", "createdAt": "2020-02-05T00:34:17Z", "commit": {"oid": "bae6f688aa37877e248fb697b262f787a67c1b7b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4269, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}