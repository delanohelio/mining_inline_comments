{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAyMjEzODc3", "number": 1129, "title": "filters: add core and iOS async filter callback support", "bodyText": "Signed-off-by: Mike Schore mike.schore@gmail.com", "createdAt": "2020-10-13T11:23:29Z", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1129", "merged": true, "mergeCommit": {"oid": "3007ebd4033d7e99dc747787c6619fff4606332f"}, "closed": true, "closedAt": "2020-10-21T00:35:04Z", "author": {"login": "goaway"}, "timelineItems": {"totalCount": 24, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdSLcpVgFqTUwNzY0MTg2OA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdUfxOugFqTUxMzE1MzE1Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3NjQxODY4", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1129#pullrequestreview-507641868", "createdAt": "2020-10-13T16:48:07Z", "commit": {"oid": "0ca1b9e8d4374e99f49c083eaceb5536015c3cb9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxNjo0ODowN1rOHgwX7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxNjo0ODowN1rOHgwX7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDEwOTAzNg==", "bodyText": "Should this be added as a dependency somewhere?", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1129#discussion_r504109036", "createdAt": "2020-10-13T16:48:07Z", "author": {"login": "rebello95"}, "path": "library/objective-c/BUILD", "diffHunk": "@@ -32,6 +31,15 @@ objc_library(\n     ],\n )\n \n+objc_library(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0ca1b9e8d4374e99f49c083eaceb5536015c3cb9"}, "originalPosition": 12}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0ca1b9e8d4374e99f49c083eaceb5536015c3cb9", "author": {"user": {"login": "goaway", "name": "Mike Schore"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/0ca1b9e8d4374e99f49c083eaceb5536015c3cb9", "committedDate": "2020-10-13T11:22:46Z", "message": "filters: add core and iOS async filter callback support\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>"}, "afterCommit": {"oid": "fcb99b0be9d338c8f674e3d643388caa6fc20ef0", "author": {"user": {"login": "goaway", "name": "Mike Schore"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/fcb99b0be9d338c8f674e3d643388caa6fc20ef0", "committedDate": "2020-10-13T18:22:29Z", "message": "filters: add core and iOS async filter callback support\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fcb99b0be9d338c8f674e3d643388caa6fc20ef0", "author": {"user": {"login": "goaway", "name": "Mike Schore"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/fcb99b0be9d338c8f674e3d643388caa6fc20ef0", "committedDate": "2020-10-13T18:22:29Z", "message": "filters: add core and iOS async filter callback support\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>"}, "afterCommit": {"oid": "b7b5f13115201bdc6616eff2f3193fad3b60acb9", "author": {"user": {"login": "goaway", "name": "Mike Schore"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/b7b5f13115201bdc6616eff2f3193fad3b60acb9", "committedDate": "2020-10-14T10:42:53Z", "message": "filters: add core and iOS async filter callback support\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b7b5f13115201bdc6616eff2f3193fad3b60acb9", "author": {"user": {"login": "goaway", "name": "Mike Schore"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/b7b5f13115201bdc6616eff2f3193fad3b60acb9", "committedDate": "2020-10-14T10:42:53Z", "message": "filters: add core and iOS async filter callback support\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>"}, "afterCommit": {"oid": "e4344f9f99459e53a63fddabf4e9b3686716ce7a", "author": {"user": {"login": "goaway", "name": "Mike Schore"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/e4344f9f99459e53a63fddabf4e9b3686716ce7a", "committedDate": "2020-10-14T14:12:50Z", "message": "filters: add core and iOS async filter callback support\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e4344f9f99459e53a63fddabf4e9b3686716ce7a", "author": {"user": {"login": "goaway", "name": "Mike Schore"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/e4344f9f99459e53a63fddabf4e9b3686716ce7a", "committedDate": "2020-10-14T14:12:50Z", "message": "filters: add core and iOS async filter callback support\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>"}, "afterCommit": {"oid": "62b3b91fd318b01e596ceb57e23666e4cb16559b", "author": {"user": {"login": "goaway", "name": "Mike Schore"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/62b3b91fd318b01e596ceb57e23666e4cb16559b", "committedDate": "2020-10-14T14:21:03Z", "message": "filters: add core and iOS async filter callback support\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "62b3b91fd318b01e596ceb57e23666e4cb16559b", "author": {"user": {"login": "goaway", "name": "Mike Schore"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/62b3b91fd318b01e596ceb57e23666e4cb16559b", "committedDate": "2020-10-14T14:21:03Z", "message": "filters: add core and iOS async filter callback support\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>"}, "afterCommit": {"oid": "d28dc55f2bf0773f8db55d745eb1b0bea26583d5", "author": {"user": {"login": "goaway", "name": "Mike Schore"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/d28dc55f2bf0773f8db55d745eb1b0bea26583d5", "committedDate": "2020-10-14T14:49:55Z", "message": "filters: add core and iOS async filter callback support\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d28dc55f2bf0773f8db55d745eb1b0bea26583d5", "author": {"user": {"login": "goaway", "name": "Mike Schore"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/d28dc55f2bf0773f8db55d745eb1b0bea26583d5", "committedDate": "2020-10-14T14:49:55Z", "message": "filters: add core and iOS async filter callback support\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>"}, "afterCommit": {"oid": "d2e0eecf3cc4c26cc075a1d7747319dd05d58bc3", "author": {"user": {"login": "goaway", "name": "Mike Schore"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/d2e0eecf3cc4c26cc075a1d7747319dd05d58bc3", "committedDate": "2020-10-14T17:56:44Z", "message": "filters: add core and iOS async filter callback support\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d2e0eecf3cc4c26cc075a1d7747319dd05d58bc3", "author": {"user": {"login": "goaway", "name": "Mike Schore"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/d2e0eecf3cc4c26cc075a1d7747319dd05d58bc3", "committedDate": "2020-10-14T17:56:44Z", "message": "filters: add core and iOS async filter callback support\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>"}, "afterCommit": {"oid": "660da5bdf1be282248818fe6d03f7f55e34484fa", "author": {"user": {"login": "goaway", "name": "Mike Schore"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/660da5bdf1be282248818fe6d03f7f55e34484fa", "committedDate": "2020-10-14T17:59:05Z", "message": "filters: add core and iOS async filter callback support\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA4NjY1NTc4", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1129#pullrequestreview-508665578", "createdAt": "2020-10-14T19:34:16Z", "commit": {"oid": "7a595ad45a084da39ff06749dc95b807b2c194d9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxOTozNDoxNlrOHhiFYQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxOTozNDoxNlrOHhiFYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDkyMzQ4OQ==", "bodyText": "I want to call out that there is a potential shutdown race here, but it all depends on timing (I guess, obviously). We don't retain the filter and so when Envoy is being torn down, it's possible the filter is torn down before the dispatcher, in which case everything is fine. If the inverse happens, however, then there's narrow window here where we could successfully acquire the filter and attempt to access the dispatcher, which is already gone.\nAs I shared when we discussed in person, there are a few solutions to this. We could allow the dispatcher itself to be shared and locked (this is seems ideal to me, since we would never have a garbage reference here or anywhere else we needed to call in from platform code on an arbitrary thread). We could lock the top-level engine object, but the downside is that all incoming calls would need access to it (and indeed, there's not an obvious reason a filter should have access to it, let alone a mechanism to make it available short of ugly hacks). And finally, we could take ownership of the dispatcher and have it be something passed into Envoy to ensure it was always valid. (There are other advantages to this last approach, and it might be desirable eventually regardless, but it would initially require non-trivial changes to Envoy.)", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1129#discussion_r504923489", "createdAt": "2020-10-14T19:34:16Z", "author": {"login": "goaway"}, "path": "library/common/extensions/filters/http/platform_bridge/filter.cc", "diffHunk": "@@ -325,7 +369,20 @@ PlatformBridgeFilter::encodeTrailers(Http::ResponseTrailerMap& trailers) {\n   return status;\n }\n \n+void PlatformBridgeFilter::resumeDecoding() {\n+  auto weak_self = weak_from_this();\n+  dispatcher_.post([weak_self]() -> void {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7a595ad45a084da39ff06749dc95b807b2c194d9"}, "originalPosition": 88}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5b3139c054771f8b9d39d0a999bb45195bfb0d26", "author": {"user": {"login": "goaway", "name": "Mike Schore"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/5b3139c054771f8b9d39d0a999bb45195bfb0d26", "committedDate": "2020-10-15T10:34:13Z", "message": "add dep\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>"}, "afterCommit": {"oid": "c27baef52adab4f73208f82036ad97140d0597dc", "author": {"user": {"login": "goaway", "name": "Mike Schore"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/c27baef52adab4f73208f82036ad97140d0597dc", "committedDate": "2020-10-15T11:31:55Z", "message": "resolve deps\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5ODI2OTc0", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1129#pullrequestreview-509826974", "createdAt": "2020-10-15T21:36:40Z", "commit": {"oid": "c27baef52adab4f73208f82036ad97140d0597dc"}, "state": "COMMENTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQyMTozNjo0MFrOHicLMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQyMTo1ODozMlrOHic-fg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTg3NTI1MQ==", "bodyText": "nit: I wonder if we should move the static helpers to their own utility file.", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1129#discussion_r505875251", "createdAt": "2020-10-15T21:36:40Z", "author": {"login": "junr03"}, "path": "library/common/extensions/filters/http/platform_bridge/filter.cc", "diffHunk": "@@ -17,14 +17,38 @@ namespace Extensions {\n namespace HttpFilters {\n namespace PlatformBridge {\n \n+static void envoy_filter_release_callbacks(const void* context) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c27baef52adab4f73208f82036ad97140d0597dc"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTg4MzY2MQ==", "bodyText": "we should have an inline comment about the ownership model", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1129#discussion_r505883661", "createdAt": "2020-10-15T21:49:08Z", "author": {"login": "junr03"}, "path": "library/common/extensions/filters/http/platform_bridge/filter.cc", "diffHunk": "@@ -44,6 +68,24 @@ PlatformBridgeFilter::PlatformBridgeFilter(PlatformBridgeFilterConfigSharedPtr c\n   ASSERT(platform_filter_.instance_context,\n          fmt::format(\"init_filter unsuccessful for {}\", filter_name_));\n   iteration_state_ = IterationState::Ongoing;\n+\n+  if (platform_filter_.set_request_callbacks) {\n+    platform_request_callbacks_.resume_iteration = envoy_filter_callback_resume_decoding;\n+    platform_request_callbacks_.release_callbacks = envoy_filter_release_callbacks;\n+    platform_request_callbacks_.callback_context =\n+        new PlatformBridgeFilterWeakPtr{weak_from_this()};", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c27baef52adab4f73208f82036ad97140d0597dc"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTg4NDMwMA==", "bodyText": "The absence of this assignment was a bug, right?", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1129#discussion_r505884300", "createdAt": "2020-10-15T21:50:03Z", "author": {"login": "junr03"}, "path": "library/common/extensions/filters/http/platform_bridge/filter.cc", "diffHunk": "@@ -172,6 +214,7 @@ Http::FilterDataStatus PlatformBridgeFilter::onData(Buffer::Instance& data, bool\n       data.drain(data.length());\n       data.addBufferFragment(*Buffer::BridgeFragment::createBridgeFragment(result.data));\n     }\n+    iteration_state_ = IterationState::Ongoing;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c27baef52adab4f73208f82036ad97140d0597dc"}, "originalPosition": 70}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTg4NjA2MA==", "bodyText": "nit: usually weak_this in the Envoy codebase", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1129#discussion_r505886060", "createdAt": "2020-10-15T21:52:39Z", "author": {"login": "junr03"}, "path": "library/common/extensions/filters/http/platform_bridge/filter.cc", "diffHunk": "@@ -325,7 +369,20 @@ PlatformBridgeFilter::encodeTrailers(Http::ResponseTrailerMap& trailers) {\n   return status;\n }\n \n+void PlatformBridgeFilter::resumeDecoding() {\n+  auto weak_self = weak_from_this();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c27baef52adab4f73208f82036ad97140d0597dc"}, "originalPosition": 87}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTg4NzE0NA==", "bodyText": "can we leave a todo in the code linking to an issue that we can track for any of the solutions you list?", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1129#discussion_r505887144", "createdAt": "2020-10-15T21:55:16Z", "author": {"login": "junr03"}, "path": "library/common/extensions/filters/http/platform_bridge/filter.cc", "diffHunk": "@@ -325,7 +369,20 @@ PlatformBridgeFilter::encodeTrailers(Http::ResponseTrailerMap& trailers) {\n   return status;\n }\n \n+void PlatformBridgeFilter::resumeDecoding() {\n+  auto weak_self = weak_from_this();\n+  dispatcher_.post([weak_self]() -> void {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDkyMzQ4OQ=="}, "originalCommit": {"oid": "7a595ad45a084da39ff06749dc95b807b2c194d9"}, "originalPosition": 88}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTg4NzY1MQ==", "bodyText": "In other parts of the filter we have assertions about invalid combination of actions vs filter state. I want to hear your thoughts about why here we have a no-op.", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1129#discussion_r505887651", "createdAt": "2020-10-15T21:56:33Z", "author": {"login": "junr03"}, "path": "library/common/extensions/filters/http/platform_bridge/filter.cc", "diffHunk": "@@ -325,7 +369,20 @@ PlatformBridgeFilter::encodeTrailers(Http::ResponseTrailerMap& trailers) {\n   return status;\n }\n \n+void PlatformBridgeFilter::resumeDecoding() {\n+  auto weak_self = weak_from_this();\n+  dispatcher_.post([weak_self]() -> void {\n+    if (auto self = weak_self.lock()) {\n+      self->onResumeDecoding();\n+    }\n+  });\n+}\n+\n void PlatformBridgeFilter::onResumeDecoding() {\n+  if (iteration_state_ == IterationState::Ongoing) {\n+    return;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c27baef52adab4f73208f82036ad97140d0597dc"}, "originalPosition": 97}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTg4ODM4Mg==", "bodyText": "Missing tests, right?", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1129#discussion_r505888382", "createdAt": "2020-10-15T21:58:32Z", "author": {"login": "junr03"}, "path": "test/common/extensions/filters/http/platform_bridge/platform_bridge_filter_test.cc", "diffHunk": "@@ -1,3 +1,4 @@\n+#include \"test/mocks/event/mocks.h\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c27baef52adab4f73208f82036ad97140d0597dc"}, "originalPosition": 1}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwNzI3ODkw", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1129#pullrequestreview-510727890", "createdAt": "2020-10-16T18:58:21Z", "commit": {"oid": "c27baef52adab4f73208f82036ad97140d0597dc"}, "state": "DISMISSED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxODo1ODoyMVrOHjMfQw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxODo1ODoyMVrOHjMfQw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjY2NjgxOQ==", "bodyText": "So multiple objc header files work now? If so, maybe we can (in a separate PR) look into splitting up the EnvoyEngine.h file?", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1129#discussion_r506666819", "createdAt": "2020-10-16T18:58:21Z", "author": {"login": "rebello95"}, "path": "library/objective-c/EnvoyHTTPFilterCallbacksImpl.h", "diffHunk": "@@ -0,0 +1,12 @@\n+#import <Foundation/Foundation.h>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c27baef52adab4f73208f82036ad97140d0597dc"}, "originalPosition": 1}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bf7fcddc4b1a038b23a60b296ef48da1f81be711", "author": {"user": {"login": "goaway", "name": "Mike Schore"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/bf7fcddc4b1a038b23a60b296ef48da1f81be711", "committedDate": "2020-10-19T07:28:39Z", "message": "filters: add core and iOS async filter callback support\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f23743bf3b0576386830b5eb153ef38e6599e0cb", "author": {"user": {"login": "goaway", "name": "Mike Schore"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/f23743bf3b0576386830b5eb153ef38e6599e0cb", "committedDate": "2020-10-19T07:28:39Z", "message": "format\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a2e2a2cbee7cd5c0ea3c8f8f63e6a0a676e9fc85", "author": {"user": {"login": "goaway", "name": "Mike Schore"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/a2e2a2cbee7cd5c0ea3c8f8f63e6a0a676e9fc85", "committedDate": "2020-10-19T07:28:39Z", "message": "resolve deps\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9541d8c3bb56aeef0c94635fd9ae843f1aeee212", "author": {"user": {"login": "goaway", "name": "Mike Schore"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/9541d8c3bb56aeef0c94635fd9ae843f1aeee212", "committedDate": "2020-10-19T07:28:39Z", "message": "comments and rebase\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1f660a1dde0e5152e19890d97d381e23649e81ff", "author": {"user": {"login": "goaway", "name": "Mike Schore"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/1f660a1dde0e5152e19890d97d381e23649e81ff", "committedDate": "2020-10-19T07:27:22Z", "message": "comments and rebase\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>"}, "afterCommit": {"oid": "9541d8c3bb56aeef0c94635fd9ae843f1aeee212", "author": {"user": {"login": "goaway", "name": "Mike Schore"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/9541d8c3bb56aeef0c94635fd9ae843f1aeee212", "committedDate": "2020-10-19T07:28:39Z", "message": "comments and rebase\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ae6047f64483c93c1c4aaab964da151f3087ba07", "author": {"user": {"login": "goaway", "name": "Mike Schore"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/ae6047f64483c93c1c4aaab964da151f3087ba07", "committedDate": "2020-10-19T08:26:12Z", "message": "additional coverage\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "42495bdbde87785f11377b4b9fc908bbf2770863", "author": {"user": {"login": "goaway", "name": "Mike Schore"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/42495bdbde87785f11377b4b9fc908bbf2770863", "committedDate": "2020-10-19T09:03:09Z", "message": "additional coverage\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "290d2792df935bba779369db01fffa254d6741be", "author": {"user": {"login": "goaway", "name": "Mike Schore"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/290d2792df935bba779369db01fffa254d6741be", "committedDate": "2020-10-19T09:05:15Z", "message": "format\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "76ae59f70b92b03de7e7296adc97bf13e1e3e48b", "author": {"user": {"login": "goaway", "name": "Mike Schore"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/76ae59f70b92b03de7e7296adc97bf13e1e3e48b", "committedDate": "2020-10-19T13:03:17Z", "message": "typo\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEzMDc2MjIw", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1129#pullrequestreview-513076220", "createdAt": "2020-10-20T19:46:23Z", "commit": {"oid": "76ae59f70b92b03de7e7296adc97bf13e1e3e48b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxOTo0NjoyM1rOHlOVvw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxOTo0NjoyM1rOHlOVvw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODc5NDMwMw==", "bodyText": "should the onResume callbacks below be made private now that we have the async triggers exposed?", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1129#discussion_r508794303", "createdAt": "2020-10-20T19:46:23Z", "author": {"login": "junr03"}, "path": "library/common/extensions/filters/http/platform_bridge/filter.h", "diffHunk": "@@ -46,9 +46,18 @@ enum class IterationState { Ongoing, Stopped };\n  * For more information on implementing platform filters, see the docs.\n  */\n class PlatformBridgeFilter final : public Http::PassThroughFilter,\n-                                   Logger::Loggable<Logger::Id::filter> {\n+                                   public Logger::Loggable<Logger::Id::filter>,\n+                                   public std::enable_shared_from_this<PlatformBridgeFilter> {\n public:\n-  PlatformBridgeFilter(PlatformBridgeFilterConfigSharedPtr config);\n+  PlatformBridgeFilter(PlatformBridgeFilterConfigSharedPtr config, Event::Dispatcher& dispatcher);\n+\n+  // Asynchronously trigger resumption of filter iteration, if applicable.\n+  // This is a no-op if filter iteration is already ongoing.\n+  void resumeDecoding();\n+\n+  // Asynchronously trigger resumption of filter iteration, if applicable.\n+  // This is a no-op if filter iteration is already ongoing.\n+  void resumeEncoding();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "76ae59f70b92b03de7e7296adc97bf13e1e3e48b"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8f1a79e8f47d4df7454b9ec0f00570d08f629e93", "author": {"user": {"login": "goaway", "name": "Mike Schore"}}, "url": "https://github.com/envoyproxy/envoy-mobile/commit/8f1a79e8f47d4df7454b9ec0f00570d08f629e93", "committedDate": "2020-10-20T20:31:50Z", "message": "update visibility of functions\n\nSigned-off-by: Mike Schore <mike.schore@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEzMTUzMTU3", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1129#pullrequestreview-513153157", "createdAt": "2020-10-20T21:36:33Z", "commit": {"oid": "8f1a79e8f47d4df7454b9ec0f00570d08f629e93"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4064, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}