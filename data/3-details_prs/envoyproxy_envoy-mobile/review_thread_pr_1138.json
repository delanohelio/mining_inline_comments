{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA2Njk0MzU5", "number": 1138, "reviewThreads": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxODo0MzoxOFrOEv7Xkw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxOTozODo0NVrOEv8nmg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE4NjkxMjE5OnYy", "diffSide": "RIGHT", "path": "library/java/src/io/envoyproxy/envoymobile/engine/EnvoyHTTPFilterCallbacksImpl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxODo0MzoxOFrOHlMITA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQyMDoxMToxOFrOHlPL3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODc1ODA5Mg==", "bodyText": "Do we need to add these to the proguard rules?", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1138#discussion_r508758092", "createdAt": "2020-10-20T18:43:18Z", "author": {"login": "buildbreaker"}, "path": "library/java/src/io/envoyproxy/envoymobile/engine/EnvoyHTTPFilterCallbacksImpl.java", "diffHunk": "@@ -0,0 +1,37 @@\n+package io.envoyproxy.envoymobile.engine;\n+\n+import io.envoyproxy.envoymobile.engine.EnvoyNativeResourceReleaser;\n+import io.envoyproxy.envoymobile.engine.EnvoyNativeResourceWrapper;\n+\n+final class EnvoyHTTPFilterCallbacksImpl\n+    implements EnvoyHTTPFilterCallbacks, EnvoyNativeResourceWrapper {\n+\n+  private static final EnvoyNativeResourceReleaser releaseCallbacks = (long handle) -> {\n+    callReleaseCallbacks(handle);\n+  };\n+\n+  private final long callbackHandle;\n+\n+  /**\n+   * @param callbackHandle, native handle for callback execution. This must be eventually passed to\n+                            `callReleaseCallbacks` to release underlying memory.\n+   */\n+  EnvoyHTTPFilterCallbacksImpl(long callbackHandle) { this.callbackHandle = callbackHandle; }\n+\n+  static EnvoyHTTPFilterCallbacksImpl create(long callbackHandle) {\n+    final EnvoyHTTPFilterCallbacksImpl object = new EnvoyHTTPFilterCallbacksImpl(callbackHandle);\n+    EnvoyNativeResourceRegistry.globalRegister(object, callbackHandle, releaseCallbacks);\n+    return object;\n+  }\n+\n+  public void resumeIteration() { callResumeIteration(callbackHandle, this); }\n+\n+  /**\n+   * @param callbackHandle, native handle for callback execution.\n+   * @param object, pass this object so that the JNI retains it, preventing it from potentially\n+   *                being concurrently garbage-collected while the native call is executing.\n+   */\n+  private native void callResumeIteration(long callbackHandle, EnvoyHTTPFilterCallbacksImpl object);\n+\n+  private static native void callReleaseCallbacks(long callbackHandle);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "54a1530db533470a24db502e112d2756d9cbeaaf"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODgwODE1Ng==", "bodyText": "Yes, good callout. Strictly-speaking not required in this PR, but might as well add them now to avoid missing it later.", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1138#discussion_r508808156", "createdAt": "2020-10-20T20:11:18Z", "author": {"login": "goaway"}, "path": "library/java/src/io/envoyproxy/envoymobile/engine/EnvoyHTTPFilterCallbacksImpl.java", "diffHunk": "@@ -0,0 +1,37 @@\n+package io.envoyproxy.envoymobile.engine;\n+\n+import io.envoyproxy.envoymobile.engine.EnvoyNativeResourceReleaser;\n+import io.envoyproxy.envoymobile.engine.EnvoyNativeResourceWrapper;\n+\n+final class EnvoyHTTPFilterCallbacksImpl\n+    implements EnvoyHTTPFilterCallbacks, EnvoyNativeResourceWrapper {\n+\n+  private static final EnvoyNativeResourceReleaser releaseCallbacks = (long handle) -> {\n+    callReleaseCallbacks(handle);\n+  };\n+\n+  private final long callbackHandle;\n+\n+  /**\n+   * @param callbackHandle, native handle for callback execution. This must be eventually passed to\n+                            `callReleaseCallbacks` to release underlying memory.\n+   */\n+  EnvoyHTTPFilterCallbacksImpl(long callbackHandle) { this.callbackHandle = callbackHandle; }\n+\n+  static EnvoyHTTPFilterCallbacksImpl create(long callbackHandle) {\n+    final EnvoyHTTPFilterCallbacksImpl object = new EnvoyHTTPFilterCallbacksImpl(callbackHandle);\n+    EnvoyNativeResourceRegistry.globalRegister(object, callbackHandle, releaseCallbacks);\n+    return object;\n+  }\n+\n+  public void resumeIteration() { callResumeIteration(callbackHandle, this); }\n+\n+  /**\n+   * @param callbackHandle, native handle for callback execution.\n+   * @param object, pass this object so that the JNI retains it, preventing it from potentially\n+   *                being concurrently garbage-collected while the native call is executing.\n+   */\n+  private native void callResumeIteration(long callbackHandle, EnvoyHTTPFilterCallbacksImpl object);\n+\n+  private static native void callReleaseCallbacks(long callbackHandle);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODc1ODA5Mg=="}, "originalCommit": {"oid": "54a1530db533470a24db502e112d2756d9cbeaaf"}, "originalPosition": 36}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE4NjkyMjMxOnYy", "diffSide": "RIGHT", "path": "library/java/src/io/envoyproxy/envoymobile/engine/EnvoyNativeMemoryRegistry.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxODo0NDo1NVrOHlMOwA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxODo0NDo1NVrOHlMOwA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODc1OTc0NA==", "bodyText": "I think this reads more easily:\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              private ReferenceQueue\n          \n          \n            \n                  refQueue; // References are automatically enqueued when the gc flags them as unreachable.\n          \n          \n            \n              private Collection refMaintainer; // Maintains references in the object graph while we wait for\n          \n          \n            \n                                                // them to be enqueued.\n          \n          \n            \n              // References are automatically enqueued when the gc flags them as unreachable.\n          \n          \n            \n              private ReferenceQueue refQueue; \n          \n          \n            \n              // Maintains references in the object graph while we wait for\n          \n          \n            \n              // them to be enqueued.\n          \n          \n            \n              private Collection refMaintainer;", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1138#discussion_r508759744", "createdAt": "2020-10-20T18:44:55Z", "author": {"login": "buildbreaker"}, "path": "library/java/src/io/envoyproxy/envoymobile/engine/EnvoyNativeMemoryRegistry.java", "diffHunk": "@@ -0,0 +1,58 @@\n+package io.envoyproxy.envoymobile.engine;\n+\n+import java.lang.ref.PhantomReference;\n+import java.lang.ref.ReferenceQueue;\n+\n+import io.envoyproxy.envoymobile.engine.EnvoyNativeResourceReleaser;\n+import io.envoyproxy.envoymobile.engine.EnvoyNativeResourceWrapper;\n+\n+/**\n+ * Central class to manage releasing native resources when wrapper objects are flagged as\n+ * unreachable by the garbage collector.\n+ */\n+public enum EnvoyNativeResourceRegistry {\n+  SINGLETON;\n+\n+  private ReferenceQueue\n+      refQueue; // References are automatically enqueued when the gc flags them as unreachable.\n+  private Collection refMaintainer; // Maintains references in the object graph while we wait for\n+                                    // them to be enqueued.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "54a1530db533470a24db502e112d2756d9cbeaaf"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE4NzEwNDYyOnYy", "diffSide": "RIGHT", "path": "library/java/src/io/envoyproxy/envoymobile/engine/EnvoyNativeResourceWrapper.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxOTozNToyN1rOHlN9xQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxOTozNToyN1rOHlN9xQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODc4ODE2NQ==", "bodyText": "Could we add a blurb on the responsibilities of this wrapper?", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1138#discussion_r508788165", "createdAt": "2020-10-20T19:35:27Z", "author": {"login": "buildbreaker"}, "path": "library/java/src/io/envoyproxy/envoymobile/engine/EnvoyNativeResourceWrapper.java", "diffHunk": "@@ -0,0 +1,3 @@\n+package io.envoyproxy.envoymobile.engine;\n+\n+interface EnvoyNativeResourceWrapper {}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "54a1530db533470a24db502e112d2756d9cbeaaf"}, "originalPosition": 3}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE4NzEwNjIyOnYy", "diffSide": "RIGHT", "path": "library/java/src/io/envoyproxy/envoymobile/engine/EnvoyNativeResourceRegistry.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxOTozNTo1N1rOHlN-vQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxOTozNTo1N1rOHlN-vQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODc4ODQxMw==", "bodyText": "docs for params", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1138#discussion_r508788413", "createdAt": "2020-10-20T19:35:57Z", "author": {"login": "buildbreaker"}, "path": "library/java/src/io/envoyproxy/envoymobile/engine/EnvoyNativeResourceRegistry.java", "diffHunk": "@@ -0,0 +1,72 @@\n+package io.envoyproxy.envoymobile.engine;\n+\n+import java.lang.ref.PhantomReference;\n+import java.lang.ref.ReferenceQueue;\n+import java.util.concurrent.ConcurrentHashMap;\n+import java.util.Set;\n+\n+import io.envoyproxy.envoymobile.engine.EnvoyNativeResourceReleaser;\n+import io.envoyproxy.envoymobile.engine.EnvoyNativeResourceWrapper;\n+\n+/**\n+ * Central class to manage releasing native resources when wrapper objects are flagged as\n+ * unreachable by the garbage collector.\n+ */\n+public enum EnvoyNativeResourceRegistry {\n+  SINGLETON;\n+\n+  private ReferenceQueue\n+      refQueue; // References are automatically enqueued when the gc flags them as unreachable.\n+  private Set refMaintainer; // Maintains references in the object graph while we wait for them to\n+                             // be enqueued.\n+  private RefQueueThread\n+      refQueueThread; // Blocks on the reference queue and calls the releaser of queued references.\n+\n+  private class RefQueueThread extends Thread {\n+    public void run() {\n+      EnvoyPhantomRef ref;\n+      while (true) {\n+        try {\n+          ref = (EnvoyPhantomRef)refQueue.remove();\n+        } catch (InterruptedException e) {\n+          continue;\n+        }\n+\n+        ref.releaseResource();\n+        refMaintainer.remove(ref);\n+      }\n+    }\n+  }\n+\n+  private class EnvoyPhantomRef extends PhantomReference<EnvoyNativeResourceWrapper> {\n+    private final EnvoyNativeResourceReleaser releaser;\n+    private final long nativeHandle;\n+\n+    EnvoyPhantomRef(EnvoyNativeResourceWrapper owner, long nativeHandle,\n+                    EnvoyNativeResourceReleaser releaser) {\n+      super(owner, refQueue);\n+      this.nativeHandle = nativeHandle;\n+      this.releaser = releaser;\n+      refQueueThread = new RefQueueThread();\n+      refMaintainer = new ConcurrentHashMap().newKeySet();\n+      refQueueThread.start();\n+    }\n+\n+    void releaseResource() { releaser.release(nativeHandle); }\n+  }\n+\n+  /**\n+   * Register an EnvoyNativeResourceWrapper to schedule cleanup of its native resources when the\n+   * Java object is flagged for collection by the garbage collector.\n+   */\n+  public void register(EnvoyNativeResourceWrapper owner, long nativeHandle,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "54a1530db533470a24db502e112d2756d9cbeaaf"}, "originalPosition": 62}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE4NzEwNjc0OnYy", "diffSide": "RIGHT", "path": "library/java/src/io/envoyproxy/envoymobile/engine/EnvoyNativeResourceRegistry.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxOTozNjowNVrOHlN_CQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxOTozNjowNVrOHlN_CQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODc4ODQ4OQ==", "bodyText": "Docs for params", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1138#discussion_r508788489", "createdAt": "2020-10-20T19:36:05Z", "author": {"login": "buildbreaker"}, "path": "library/java/src/io/envoyproxy/envoymobile/engine/EnvoyNativeResourceRegistry.java", "diffHunk": "@@ -0,0 +1,72 @@\n+package io.envoyproxy.envoymobile.engine;\n+\n+import java.lang.ref.PhantomReference;\n+import java.lang.ref.ReferenceQueue;\n+import java.util.concurrent.ConcurrentHashMap;\n+import java.util.Set;\n+\n+import io.envoyproxy.envoymobile.engine.EnvoyNativeResourceReleaser;\n+import io.envoyproxy.envoymobile.engine.EnvoyNativeResourceWrapper;\n+\n+/**\n+ * Central class to manage releasing native resources when wrapper objects are flagged as\n+ * unreachable by the garbage collector.\n+ */\n+public enum EnvoyNativeResourceRegistry {\n+  SINGLETON;\n+\n+  private ReferenceQueue\n+      refQueue; // References are automatically enqueued when the gc flags them as unreachable.\n+  private Set refMaintainer; // Maintains references in the object graph while we wait for them to\n+                             // be enqueued.\n+  private RefQueueThread\n+      refQueueThread; // Blocks on the reference queue and calls the releaser of queued references.\n+\n+  private class RefQueueThread extends Thread {\n+    public void run() {\n+      EnvoyPhantomRef ref;\n+      while (true) {\n+        try {\n+          ref = (EnvoyPhantomRef)refQueue.remove();\n+        } catch (InterruptedException e) {\n+          continue;\n+        }\n+\n+        ref.releaseResource();\n+        refMaintainer.remove(ref);\n+      }\n+    }\n+  }\n+\n+  private class EnvoyPhantomRef extends PhantomReference<EnvoyNativeResourceWrapper> {\n+    private final EnvoyNativeResourceReleaser releaser;\n+    private final long nativeHandle;\n+\n+    EnvoyPhantomRef(EnvoyNativeResourceWrapper owner, long nativeHandle,\n+                    EnvoyNativeResourceReleaser releaser) {\n+      super(owner, refQueue);\n+      this.nativeHandle = nativeHandle;\n+      this.releaser = releaser;\n+      refQueueThread = new RefQueueThread();\n+      refMaintainer = new ConcurrentHashMap().newKeySet();\n+      refQueueThread.start();\n+    }\n+\n+    void releaseResource() { releaser.release(nativeHandle); }\n+  }\n+\n+  /**\n+   * Register an EnvoyNativeResourceWrapper to schedule cleanup of its native resources when the\n+   * Java object is flagged for collection by the garbage collector.\n+   */\n+  public void register(EnvoyNativeResourceWrapper owner, long nativeHandle,\n+                       EnvoyNativeResourceReleaser releaser) {\n+    EnvoyPhantomRef ref = new EnvoyPhantomRef(owner, nativeHandle, releaser);\n+    refMaintainer.add(ref);\n+  }\n+\n+  public static void globalRegister(EnvoyNativeResourceWrapper owner, long nativeHandle,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "54a1530db533470a24db502e112d2756d9cbeaaf"}, "originalPosition": 68}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE4NzExNDk4OnYy", "diffSide": "RIGHT", "path": "library/java/src/io/envoyproxy/envoymobile/engine/EnvoyNativeResourceRegistry.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxOTozODowNVrOHlODwQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQyMDowNToxMlrOHlO_IQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODc4OTY5Nw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              private ReferenceQueue\n          \n          \n            \n                  refQueue; // References are automatically enqueued when the gc flags them as unreachable.\n          \n          \n            \n              private Set refMaintainer; // Maintains references in the object graph while we wait for them to\n          \n          \n            \n                                         // be enqueued.\n          \n          \n            \n              private RefQueueThread\n          \n          \n            \n                  refQueueThread; // Blocks on the reference queue and calls the releaser of queued references.\n          \n          \n            \n              // References are automatically enqueued when the gc flags them as unreachable.\n          \n          \n            \n              private ReferenceQueue refQueue;\n          \n          \n            \n            \n          \n          \n            \n              // Maintains references in the object graph while we wait for them to\n          \n          \n            \n              // be enqueued.\n          \n          \n            \n              private Set refMaintainer;\n          \n          \n            \n            \n          \n          \n            \n              // Blocks on the reference queue and calls the releaser of queued references.\n          \n          \n            \n              private RefQueueThread refQueueThread;", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1138#discussion_r508789697", "createdAt": "2020-10-20T19:38:05Z", "author": {"login": "buildbreaker"}, "path": "library/java/src/io/envoyproxy/envoymobile/engine/EnvoyNativeResourceRegistry.java", "diffHunk": "@@ -0,0 +1,72 @@\n+package io.envoyproxy.envoymobile.engine;\n+\n+import java.lang.ref.PhantomReference;\n+import java.lang.ref.ReferenceQueue;\n+import java.util.concurrent.ConcurrentHashMap;\n+import java.util.Set;\n+\n+import io.envoyproxy.envoymobile.engine.EnvoyNativeResourceReleaser;\n+import io.envoyproxy.envoymobile.engine.EnvoyNativeResourceWrapper;\n+\n+/**\n+ * Central class to manage releasing native resources when wrapper objects are flagged as\n+ * unreachable by the garbage collector.\n+ */\n+public enum EnvoyNativeResourceRegistry {\n+  SINGLETON;\n+\n+  private ReferenceQueue\n+      refQueue; // References are automatically enqueued when the gc flags them as unreachable.\n+  private Set refMaintainer; // Maintains references in the object graph while we wait for them to\n+                             // be enqueued.\n+  private RefQueueThread\n+      refQueueThread; // Blocks on the reference queue and calls the releaser of queued references.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "54a1530db533470a24db502e112d2756d9cbeaaf"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODgwNDg5Nw==", "bodyText": "The formatter did this; I didn't even notice. :p", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1138#discussion_r508804897", "createdAt": "2020-10-20T20:05:12Z", "author": {"login": "goaway"}, "path": "library/java/src/io/envoyproxy/envoymobile/engine/EnvoyNativeResourceRegistry.java", "diffHunk": "@@ -0,0 +1,72 @@\n+package io.envoyproxy.envoymobile.engine;\n+\n+import java.lang.ref.PhantomReference;\n+import java.lang.ref.ReferenceQueue;\n+import java.util.concurrent.ConcurrentHashMap;\n+import java.util.Set;\n+\n+import io.envoyproxy.envoymobile.engine.EnvoyNativeResourceReleaser;\n+import io.envoyproxy.envoymobile.engine.EnvoyNativeResourceWrapper;\n+\n+/**\n+ * Central class to manage releasing native resources when wrapper objects are flagged as\n+ * unreachable by the garbage collector.\n+ */\n+public enum EnvoyNativeResourceRegistry {\n+  SINGLETON;\n+\n+  private ReferenceQueue\n+      refQueue; // References are automatically enqueued when the gc flags them as unreachable.\n+  private Set refMaintainer; // Maintains references in the object graph while we wait for them to\n+                             // be enqueued.\n+  private RefQueueThread\n+      refQueueThread; // Blocks on the reference queue and calls the releaser of queued references.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODc4OTY5Nw=="}, "originalCommit": {"oid": "54a1530db533470a24db502e112d2756d9cbeaaf"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE4NzExNzA2OnYy", "diffSide": "RIGHT", "path": "library/java/src/io/envoyproxy/envoymobile/engine/EnvoyNativeResourceRegistry.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxOTozODo0NVrOHlOFCw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQyMzoxNTowOFrOHlUcFQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODc5MDAyNw==", "bodyText": "Is there a reason for this to be an enum?", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1138#discussion_r508790027", "createdAt": "2020-10-20T19:38:45Z", "author": {"login": "buildbreaker"}, "path": "library/java/src/io/envoyproxy/envoymobile/engine/EnvoyNativeResourceRegistry.java", "diffHunk": "@@ -0,0 +1,72 @@\n+package io.envoyproxy.envoymobile.engine;\n+\n+import java.lang.ref.PhantomReference;\n+import java.lang.ref.ReferenceQueue;\n+import java.util.concurrent.ConcurrentHashMap;\n+import java.util.Set;\n+\n+import io.envoyproxy.envoymobile.engine.EnvoyNativeResourceReleaser;\n+import io.envoyproxy.envoymobile.engine.EnvoyNativeResourceWrapper;\n+\n+/**\n+ * Central class to manage releasing native resources when wrapper objects are flagged as\n+ * unreachable by the garbage collector.\n+ */\n+public enum EnvoyNativeResourceRegistry {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "54a1530db533470a24db502e112d2756d9cbeaaf"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODgwNjYxMw==", "bodyText": "Just a trivial way to make this a singleton for now.", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1138#discussion_r508806613", "createdAt": "2020-10-20T20:08:22Z", "author": {"login": "goaway"}, "path": "library/java/src/io/envoyproxy/envoymobile/engine/EnvoyNativeResourceRegistry.java", "diffHunk": "@@ -0,0 +1,72 @@\n+package io.envoyproxy.envoymobile.engine;\n+\n+import java.lang.ref.PhantomReference;\n+import java.lang.ref.ReferenceQueue;\n+import java.util.concurrent.ConcurrentHashMap;\n+import java.util.Set;\n+\n+import io.envoyproxy.envoymobile.engine.EnvoyNativeResourceReleaser;\n+import io.envoyproxy.envoymobile.engine.EnvoyNativeResourceWrapper;\n+\n+/**\n+ * Central class to manage releasing native resources when wrapper objects are flagged as\n+ * unreachable by the garbage collector.\n+ */\n+public enum EnvoyNativeResourceRegistry {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODc5MDAyNw=="}, "originalCommit": {"oid": "54a1530db533470a24db502e112d2756d9cbeaaf"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODg5NDIyOQ==", "bodyText": "Alright", "url": "https://github.com/envoyproxy/envoy-mobile/pull/1138#discussion_r508894229", "createdAt": "2020-10-20T23:15:08Z", "author": {"login": "buildbreaker"}, "path": "library/java/src/io/envoyproxy/envoymobile/engine/EnvoyNativeResourceRegistry.java", "diffHunk": "@@ -0,0 +1,72 @@\n+package io.envoyproxy.envoymobile.engine;\n+\n+import java.lang.ref.PhantomReference;\n+import java.lang.ref.ReferenceQueue;\n+import java.util.concurrent.ConcurrentHashMap;\n+import java.util.Set;\n+\n+import io.envoyproxy.envoymobile.engine.EnvoyNativeResourceReleaser;\n+import io.envoyproxy.envoymobile.engine.EnvoyNativeResourceWrapper;\n+\n+/**\n+ * Central class to manage releasing native resources when wrapper objects are flagged as\n+ * unreachable by the garbage collector.\n+ */\n+public enum EnvoyNativeResourceRegistry {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODc5MDAyNw=="}, "originalCommit": {"oid": "54a1530db533470a24db502e112d2756d9cbeaaf"}, "originalPosition": 15}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 660, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}