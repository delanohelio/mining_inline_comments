{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE5Mzc2Mjkz", "number": 977, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNjoyMDo1OVrOE6GcKw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxOTowMDozNVrOE6K-qg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI5MzU4Mzc5OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/kohsuke/github/GHRelease.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNjoyMDo1OVrOH09bSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxODo0OToxM1rOH1EHdw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTI5NDQxMA==", "bodyText": "I left this in as I think this is a quite handy featuer to have (easily run queries to be up to date, if required). If you would rather see this removed please let me know. In that case, the test cases should also be revisitied to cover the same use case with just the new, cached behavior.", "url": "https://github.com/hub4j/github-api/pull/977#discussion_r525294410", "createdAt": "2020-11-17T16:20:59Z", "author": {"login": "skaldarnar"}, "path": "src/main/java/org/kohsuke/github/GHRelease.java", "diffHunk": "@@ -249,15 +251,44 @@ public GHAsset uploadAsset(String filename, InputStream stream, String contentTy\n     }\n \n     /**\n-     * Gets assets.\n+     * Get the cached assets.\n+     *\n+     * @return the assets\n+     *\n+     * @deprecated This should be the default behavior of {@link #getAssets()} in a future release. This method is\n+     *             introduced in addition to enable a transition to using cached asset information while keeping the\n+     *             existing logic in place for backwards compatibility.\n+     */\n+    @Deprecated\n+    @Preview\n+    public List<GHAsset> getCachedAssets() {\n+        return assets;\n+    }\n+\n+    /**\n+     * Re-fetch the assets of this release.\n      *\n      * @return the assets\n      * @throws IOException\n      *             the io exception\n+     * @deprecated The behavior of this method will change in a future release. It will then provide cached assets as\n+     *             provided by {@link #getCachedAssets()}. Use {@link #fetchAssets()} instead to fetch up-to-date\n+     *             information of assets.\n      */\n+    @Deprecated\n     public List<GHAsset> getAssets() throws IOException {\n-        Requester builder = owner.root.createRequest();\n+        return fetchAssets();\n+    }\n \n+    /**\n+     * Re-fetch the assets of this release.\n+     *\n+     * @return the assets\n+     * @throws IOException\n+     *             the io exception\n+     */\n+    public List<GHAsset> fetchAssets() throws IOException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "98b067937a62b91e58631d303ba56266a8baf74b"}, "originalPosition": 58}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTQwNDAyMw==", "bodyText": "This seems reasonable. But since we're fetching, let's return a PagedIterable for more flexibility. This also means it makes sense to use the list* verb like we do on all other methods that return PagedIterable.\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public List<GHAsset> fetchAssets() throws IOException {\n          \n          \n            \n                    public PagedIterable<GHAsset> listAssets() throws IOException {", "url": "https://github.com/hub4j/github-api/pull/977#discussion_r525404023", "createdAt": "2020-11-17T18:49:13Z", "author": {"login": "bitwiseman"}, "path": "src/main/java/org/kohsuke/github/GHRelease.java", "diffHunk": "@@ -249,15 +251,44 @@ public GHAsset uploadAsset(String filename, InputStream stream, String contentTy\n     }\n \n     /**\n-     * Gets assets.\n+     * Get the cached assets.\n+     *\n+     * @return the assets\n+     *\n+     * @deprecated This should be the default behavior of {@link #getAssets()} in a future release. This method is\n+     *             introduced in addition to enable a transition to using cached asset information while keeping the\n+     *             existing logic in place for backwards compatibility.\n+     */\n+    @Deprecated\n+    @Preview\n+    public List<GHAsset> getCachedAssets() {\n+        return assets;\n+    }\n+\n+    /**\n+     * Re-fetch the assets of this release.\n      *\n      * @return the assets\n      * @throws IOException\n      *             the io exception\n+     * @deprecated The behavior of this method will change in a future release. It will then provide cached assets as\n+     *             provided by {@link #getCachedAssets()}. Use {@link #fetchAssets()} instead to fetch up-to-date\n+     *             information of assets.\n      */\n+    @Deprecated\n     public List<GHAsset> getAssets() throws IOException {\n-        Requester builder = owner.root.createRequest();\n+        return fetchAssets();\n+    }\n \n+    /**\n+     * Re-fetch the assets of this release.\n+     *\n+     * @return the assets\n+     * @throws IOException\n+     *             the io exception\n+     */\n+    public List<GHAsset> fetchAssets() throws IOException {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTI5NDQxMA=="}, "originalCommit": {"oid": "98b067937a62b91e58631d303ba56266a8baf74b"}, "originalPosition": 58}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI5NDIyMjg0OnYy", "diffSide": "RIGHT", "path": "src/test/java/org/kohsuke/github/LifecycleTest.java", "isResolved": false, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxODozNToyNFrOH1Dk8Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQyMDo0NTowOFrOH2BcXA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTM5NTE4NQ==", "bodyText": "This seems strange.  If the asset was cached in the release before deletion, it should be there after was well - that cache shouldn't change.   Perhaps add an assert that the asset if present in getCachedAssets() before deletion?", "url": "https://github.com/hub4j/github-api/pull/977#discussion_r525395185", "createdAt": "2020-11-17T18:35:24Z", "author": {"login": "bitwiseman"}, "path": "src/test/java/org/kohsuke/github/LifecycleTest.java", "diffHunk": "@@ -45,18 +45,20 @@ public void testCreateRepository() throws IOException {\n \n     private void updateAsset(GHRelease release, GHAsset asset) throws IOException {\n         asset.setLabel(\"test label\");\n-        assertEquals(\"test label\", release.getAssets().get(0).getLabel());\n+        assertEquals(\"test label\", release.fetchAssets().get(0).getLabel());\n     }\n \n     private void deleteAsset(GHRelease release, GHAsset asset) throws IOException {\n         asset.delete();\n-        assertEquals(0, release.getAssets().size());\n+        assertEquals(0, release.getCachedAssets().size());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "98b067937a62b91e58631d303ba56266a8baf74b"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTU1MzMzNQ==", "bodyText": "The confusing part here might be that we're still dealing with the very first GHRelease from this test - even before we actually created an asset for it.\nI'll take another look at the tests and see if I can add something in addition to make this clearer", "url": "https://github.com/hub4j/github-api/pull/977#discussion_r525553335", "createdAt": "2020-11-17T22:00:39Z", "author": {"login": "skaldarnar"}, "path": "src/test/java/org/kohsuke/github/LifecycleTest.java", "diffHunk": "@@ -45,18 +45,20 @@ public void testCreateRepository() throws IOException {\n \n     private void updateAsset(GHRelease release, GHAsset asset) throws IOException {\n         asset.setLabel(\"test label\");\n-        assertEquals(\"test label\", release.getAssets().get(0).getLabel());\n+        assertEquals(\"test label\", release.fetchAssets().get(0).getLabel());\n     }\n \n     private void deleteAsset(GHRelease release, GHAsset asset) throws IOException {\n         asset.delete();\n-        assertEquals(0, release.getAssets().size());\n+        assertEquals(0, release.getCachedAssets().size());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTM5NTE4NQ=="}, "originalCommit": {"oid": "98b067937a62b91e58631d303ba56266a8baf74b"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTU4MjU0Mw==", "bodyText": "Ah, I get it now.", "url": "https://github.com/hub4j/github-api/pull/977#discussion_r525582543", "createdAt": "2020-11-17T23:00:33Z", "author": {"login": "bitwiseman"}, "path": "src/test/java/org/kohsuke/github/LifecycleTest.java", "diffHunk": "@@ -45,18 +45,20 @@ public void testCreateRepository() throws IOException {\n \n     private void updateAsset(GHRelease release, GHAsset asset) throws IOException {\n         asset.setLabel(\"test label\");\n-        assertEquals(\"test label\", release.getAssets().get(0).getLabel());\n+        assertEquals(\"test label\", release.fetchAssets().get(0).getLabel());\n     }\n \n     private void deleteAsset(GHRelease release, GHAsset asset) throws IOException {\n         asset.delete();\n-        assertEquals(0, release.getAssets().size());\n+        assertEquals(0, release.getCachedAssets().size());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTM5NTE4NQ=="}, "originalCommit": {"oid": "98b067937a62b91e58631d303ba56266a8baf74b"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQwMDgzMA==", "bodyText": "I tried to figure out how this whole wiremock setup works - and gave up \ud83d\ude15 To be able to add an assertion like the one you mentioned I'd need to re-fetch the intermediate state of the release, e.g.,\n// test that asset upload works\nGHAsset asset = uploadAsset(release);\n// get new \"snapshot\" of the release with cached asset\nGHRelease releaseWithAsset = repository.getReleases().get(0);\n// update the asset, check before and after with the new snapshot\nupdateAsset(releaseWithAsset, asset);\n// repeat same pattern for 'delete'\nHowever, it looks like the wiremocks do not account for additional calls to repository.getReleases().get(0) I suppose, at least they obviously don't return the new state of the release...\nIf I should change something in these tests I'd appreciate your help... \ud83d\ude44", "url": "https://github.com/hub4j/github-api/pull/977#discussion_r526400830", "createdAt": "2020-11-18T20:30:31Z", "author": {"login": "skaldarnar"}, "path": "src/test/java/org/kohsuke/github/LifecycleTest.java", "diffHunk": "@@ -45,18 +45,20 @@ public void testCreateRepository() throws IOException {\n \n     private void updateAsset(GHRelease release, GHAsset asset) throws IOException {\n         asset.setLabel(\"test label\");\n-        assertEquals(\"test label\", release.getAssets().get(0).getLabel());\n+        assertEquals(\"test label\", release.fetchAssets().get(0).getLabel());\n     }\n \n     private void deleteAsset(GHRelease release, GHAsset asset) throws IOException {\n         asset.delete();\n-        assertEquals(0, release.getAssets().size());\n+        assertEquals(0, release.getCachedAssets().size());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTM5NTE4NQ=="}, "originalCommit": {"oid": "98b067937a62b91e58631d303ba56266a8baf74b"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQwODU2NA==", "bodyText": "I need to make it easier to re-record tests, but in the meanwhile here's the instructions:\nhttps://github.com/hub4j/github-api/blob/master/CONTRIBUTING.md#generating-a-new-snapshot\nThe instructions could be better too.  \ud83d\ude22", "url": "https://github.com/hub4j/github-api/pull/977#discussion_r526408564", "createdAt": "2020-11-18T20:44:44Z", "author": {"login": "bitwiseman"}, "path": "src/test/java/org/kohsuke/github/LifecycleTest.java", "diffHunk": "@@ -45,18 +45,20 @@ public void testCreateRepository() throws IOException {\n \n     private void updateAsset(GHRelease release, GHAsset asset) throws IOException {\n         asset.setLabel(\"test label\");\n-        assertEquals(\"test label\", release.getAssets().get(0).getLabel());\n+        assertEquals(\"test label\", release.fetchAssets().get(0).getLabel());\n     }\n \n     private void deleteAsset(GHRelease release, GHAsset asset) throws IOException {\n         asset.delete();\n-        assertEquals(0, release.getAssets().size());\n+        assertEquals(0, release.getCachedAssets().size());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTM5NTE4NQ=="}, "originalCommit": {"oid": "98b067937a62b91e58631d303ba56266a8baf74b"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQwODc5Ng==", "bodyText": "But it is okay to leave this as it is.", "url": "https://github.com/hub4j/github-api/pull/977#discussion_r526408796", "createdAt": "2020-11-18T20:45:08Z", "author": {"login": "bitwiseman"}, "path": "src/test/java/org/kohsuke/github/LifecycleTest.java", "diffHunk": "@@ -45,18 +45,20 @@ public void testCreateRepository() throws IOException {\n \n     private void updateAsset(GHRelease release, GHAsset asset) throws IOException {\n         asset.setLabel(\"test label\");\n-        assertEquals(\"test label\", release.getAssets().get(0).getLabel());\n+        assertEquals(\"test label\", release.fetchAssets().get(0).getLabel());\n     }\n \n     private void deleteAsset(GHRelease release, GHAsset asset) throws IOException {\n         asset.delete();\n-        assertEquals(0, release.getAssets().size());\n+        assertEquals(0, release.getCachedAssets().size());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTM5NTE4NQ=="}, "originalCommit": {"oid": "98b067937a62b91e58631d303ba56266a8baf74b"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI5NDMxNDg3OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/kohsuke/github/GHRelease.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxODo1NzoyNVrOH1EcFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QyMDo1Njo1MFrOH1LJsw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTQwOTMwMA==", "bodyText": "API design question for you: Thinking about it a bit more, what do you think about using a bare property names for field access?  I don't think this needs changing for this change, but I'm thinking about what this should look like in v2.\n    public List<GHAsset> assets() {", "url": "https://github.com/hub4j/github-api/pull/977#discussion_r525409300", "createdAt": "2020-11-17T18:57:25Z", "author": {"login": "bitwiseman"}, "path": "src/main/java/org/kohsuke/github/GHRelease.java", "diffHunk": "@@ -249,15 +251,44 @@ public GHAsset uploadAsset(String filename, InputStream stream, String contentTy\n     }\n \n     /**\n-     * Gets assets.\n+     * Get the cached assets.\n+     *\n+     * @return the assets\n+     *\n+     * @deprecated This should be the default behavior of {@link #getAssets()} in a future release. This method is\n+     *             introduced in addition to enable a transition to using cached asset information while keeping the\n+     *             existing logic in place for backwards compatibility.\n+     */\n+    @Deprecated\n+    @Preview\n+    public List<GHAsset> getCachedAssets() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "98b067937a62b91e58631d303ba56266a8baf74b"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTUxOTI4Mw==", "bodyText": "I would really like this kind of simplified naming \ud83d\udc4d \ud83e\udd13", "url": "https://github.com/hub4j/github-api/pull/977#discussion_r525519283", "createdAt": "2020-11-17T20:56:50Z", "author": {"login": "skaldarnar"}, "path": "src/main/java/org/kohsuke/github/GHRelease.java", "diffHunk": "@@ -249,15 +251,44 @@ public GHAsset uploadAsset(String filename, InputStream stream, String contentTy\n     }\n \n     /**\n-     * Gets assets.\n+     * Get the cached assets.\n+     *\n+     * @return the assets\n+     *\n+     * @deprecated This should be the default behavior of {@link #getAssets()} in a future release. This method is\n+     *             introduced in addition to enable a transition to using cached asset information while keeping the\n+     *             existing logic in place for backwards compatibility.\n+     */\n+    @Deprecated\n+    @Preview\n+    public List<GHAsset> getCachedAssets() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTQwOTMwMA=="}, "originalCommit": {"oid": "98b067937a62b91e58631d303ba56266a8baf74b"}, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI5NDMxOTg1OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/kohsuke/github/GHRelease.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxODo1ODo0MFrOH1EfFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxODo1ODo0MFrOH1EfFA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTQxMDA2OA==", "bodyText": "Given we change the name and return type of fetchAssets():\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    return fetchAssets();\n          \n          \n            \n                    return listAssets().toList();", "url": "https://github.com/hub4j/github-api/pull/977#discussion_r525410068", "createdAt": "2020-11-17T18:58:40Z", "author": {"login": "bitwiseman"}, "path": "src/main/java/org/kohsuke/github/GHRelease.java", "diffHunk": "@@ -249,15 +251,44 @@ public GHAsset uploadAsset(String filename, InputStream stream, String contentTy\n     }\n \n     /**\n-     * Gets assets.\n+     * Get the cached assets.\n+     *\n+     * @return the assets\n+     *\n+     * @deprecated This should be the default behavior of {@link #getAssets()} in a future release. This method is\n+     *             introduced in addition to enable a transition to using cached asset information while keeping the\n+     *             existing logic in place for backwards compatibility.\n+     */\n+    @Deprecated\n+    @Preview\n+    public List<GHAsset> getCachedAssets() {\n+        return assets;\n+    }\n+\n+    /**\n+     * Re-fetch the assets of this release.\n      *\n      * @return the assets\n      * @throws IOException\n      *             the io exception\n+     * @deprecated The behavior of this method will change in a future release. It will then provide cached assets as\n+     *             provided by {@link #getCachedAssets()}. Use {@link #fetchAssets()} instead to fetch up-to-date\n+     *             information of assets.\n      */\n+    @Deprecated\n     public List<GHAsset> getAssets() throws IOException {\n-        Requester builder = owner.root.createRequest();\n+        return fetchAssets();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "98b067937a62b91e58631d303ba56266a8baf74b"}, "originalPosition": 48}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI5NDMyNzQ2OnYy", "diffSide": "RIGHT", "path": "src/test/java/org/kohsuke/github/LifecycleTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxOTowMDozNVrOH1EjvQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxOTowMDozNVrOH1EjvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTQxMTI2MQ==", "bodyText": "Keep the test pointing to the deprecated method since it wraps the new method and we want to show the behavior hasn't changed.\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    assertEquals(\"test label\", release.fetchAssets().get(0).getLabel());\n          \n          \n            \n                    assertEquals(\"test label\", release.getAssets().get(0).getLabel());", "url": "https://github.com/hub4j/github-api/pull/977#discussion_r525411261", "createdAt": "2020-11-17T19:00:35Z", "author": {"login": "bitwiseman"}, "path": "src/test/java/org/kohsuke/github/LifecycleTest.java", "diffHunk": "@@ -45,18 +45,20 @@ public void testCreateRepository() throws IOException {\n \n     private void updateAsset(GHRelease release, GHAsset asset) throws IOException {\n         asset.setLabel(\"test label\");\n-        assertEquals(\"test label\", release.getAssets().get(0).getLabel());\n+        assertEquals(\"test label\", release.fetchAssets().get(0).getLabel());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "98b067937a62b91e58631d303ba56266a8baf74b"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1771, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}