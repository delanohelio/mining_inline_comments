{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgyMjgxODI2", "number": 724, "title": "Add Builder/Creator/Updater for GHLabel", "bodyText": "Here's another possible way to address #589 .  This PR uses GHLabel as an example.\n@rmetzger @halkeye @PauloMigAlmeida @recena @res0nance - There's still a bunch to be done here (site currently fails due to missing JavaDocs for example), but if you look at the changes to the tests you can see what this new syntax will look like. My intent is to create a pattern that can be used consistently across the project. What do you think of this design?\nHighlights:\n\nSupport for batching changes.  Batching looks like this:\n\nlabel.update().someName(value).otherName(value).done()\n\nSupport for single changes.  They look like this:\n\nlabel.set().someName(value); \nlabel.set().otherName(value)\n\nSupport for dynamically controlled \"update-in-place\" vs \"update-to-new-instance\" behavior (not active or tested yet). As in #649, there are times people want/expect update-in-place and other times they don't. This design will allow for both, though for now it only does \"update-to-new-instance\".\nSignificant code reuse - the real win of this POC is that these differing scenarios do not each require wildly differing code paths.  Batch/single updating is provided by almost identical code paths.  In the case of GHLabel, new instance creation does too (though in other classes creation may diverge more).  \"update-in-place\" vs \"update-to-new-instance\" behavior actually identical except for one if-else in the the base class.  This means that we can get this added functionality without significant added complexity.\n\nTechnical notes:\n\nTried to add final to guarantee immutability but decided against it - While guaranteeing immutability via final fields sounds great, it results in a lot of extra code to make it work with Jackson in a way that the compiler doesn't choke on.", "createdAt": "2020-03-02T09:49:21Z", "url": "https://github.com/hub4j/github-api/pull/724", "merged": true, "mergeCommit": {"oid": "7a650132c52d40c50173268b3cee368c009b7637"}, "closed": true, "closedAt": "2020-03-25T18:56:42Z", "author": {"login": "bitwiseman"}, "timelineItems": {"totalCount": 34, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcJrAeLAFqTM2NzA4NTA5OA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcQ4IOIABqjMxNjEyNjI5MzI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY3MDg1MDk4", "url": "https://github.com/hub4j/github-api/pull/724#pullrequestreview-367085098", "createdAt": "2020-03-02T10:17:49Z", "commit": {"oid": "d59794b25f2db0889c3da09fe98a13d42e42181d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxMDoxNzo1MFrOFwaLVw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxMDoxNzo1MFrOFwaLVw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjMwNDg1NQ==", "bodyText": "Single Update", "url": "https://github.com/hub4j/github-api/pull/724#discussion_r386304855", "createdAt": "2020-03-02T10:17:50Z", "author": {"login": "bitwiseman"}, "path": "src/test/java/org/kohsuke/github/AppTest.java", "diffHunk": "@@ -784,44 +784,47 @@ public void testRepoLabel() throws IOException {\n         }\n         assertTrue(lst.size() > 5);\n         GHLabel e = r.getLabel(\"enhancement\");\n-        assertEquals(\"enhancement\", e.getName());\n-        assertNotNull(e.getUrl());\n-        assertTrue(Pattern.matches(\"[0-9a-fA-F]{6}\", e.getColor()));\n+        assertEquals(\"enhancement\", e.name());\n+        assertNotNull(e.url());\n+        assertTrue(Pattern.matches(\"[0-9a-fA-F]{6}\", e.color()));\n \n         GHLabel t = null;\n         GHLabel t2 = null;\n         try {// CRUD\n             t = r.createLabel(\"test\", \"123456\");\n             t2 = r.getLabel(\"test\");\n-            assertEquals(t.getName(), t2.getName());\n-            assertEquals(t.getColor(), \"123456\");\n-            assertEquals(t.getColor(), t2.getColor());\n-            assertEquals(t.getDescription(), \"\");\n-            assertEquals(t.getDescription(), t2.getDescription());\n-            assertEquals(t.getUrl(), t2.getUrl());\n-\n-            t.setColor(\"000000\");\n-\n-            // This is annoying behavior, but it is by design at this time.\n-            // Verifying so we can know when it is fixed.\n-            assertEquals(t.getColor(), \"123456\");\n+            assertEquals(t.name(), t2.name());\n+            assertEquals(t.color(), \"123456\");\n+            assertEquals(t.color(), t2.color());\n+            assertEquals(t.description(), \"\");\n+            assertEquals(t.description(), t2.description());\n+            assertEquals(t.url(), t2.url());\n+\n+            // update works on multiple changes in one call\n+            // t.setColor(\"\");\n+            t2 = t.update().color(\"000000\").description(\"It is dark!\").done();\n+\n+            // instances are immutable, but update returns a new updated instance.\n+            assertEquals(t.color(), \"123456\");\n+            assertEquals(t.description(), \"\");\n+            assertEquals(t2.color(), \"000000\");\n+            assertEquals(t2.description(), \"It is dark!\");\n \n             t = r.getLabel(\"test\");\n-            t.setDescription(\"this is also a test\");\n+            GHLabel t3 = t.set().description(\"this is also a test\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d59794b25f2db0889c3da09fe98a13d42e42181d"}, "originalPosition": 47}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY3MDg1MTk1", "url": "https://github.com/hub4j/github-api/pull/724#pullrequestreview-367085195", "createdAt": "2020-03-02T10:17:58Z", "commit": {"oid": "d59794b25f2db0889c3da09fe98a13d42e42181d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxMDoxNzo1OFrOFwaLnA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxMDoxNzo1OFrOFwaLnA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjMwNDkyNA==", "bodyText": "Batch update", "url": "https://github.com/hub4j/github-api/pull/724#discussion_r386304924", "createdAt": "2020-03-02T10:17:58Z", "author": {"login": "bitwiseman"}, "path": "src/test/java/org/kohsuke/github/AppTest.java", "diffHunk": "@@ -784,44 +784,47 @@ public void testRepoLabel() throws IOException {\n         }\n         assertTrue(lst.size() > 5);\n         GHLabel e = r.getLabel(\"enhancement\");\n-        assertEquals(\"enhancement\", e.getName());\n-        assertNotNull(e.getUrl());\n-        assertTrue(Pattern.matches(\"[0-9a-fA-F]{6}\", e.getColor()));\n+        assertEquals(\"enhancement\", e.name());\n+        assertNotNull(e.url());\n+        assertTrue(Pattern.matches(\"[0-9a-fA-F]{6}\", e.color()));\n \n         GHLabel t = null;\n         GHLabel t2 = null;\n         try {// CRUD\n             t = r.createLabel(\"test\", \"123456\");\n             t2 = r.getLabel(\"test\");\n-            assertEquals(t.getName(), t2.getName());\n-            assertEquals(t.getColor(), \"123456\");\n-            assertEquals(t.getColor(), t2.getColor());\n-            assertEquals(t.getDescription(), \"\");\n-            assertEquals(t.getDescription(), t2.getDescription());\n-            assertEquals(t.getUrl(), t2.getUrl());\n-\n-            t.setColor(\"000000\");\n-\n-            // This is annoying behavior, but it is by design at this time.\n-            // Verifying so we can know when it is fixed.\n-            assertEquals(t.getColor(), \"123456\");\n+            assertEquals(t.name(), t2.name());\n+            assertEquals(t.color(), \"123456\");\n+            assertEquals(t.color(), t2.color());\n+            assertEquals(t.description(), \"\");\n+            assertEquals(t.description(), t2.description());\n+            assertEquals(t.url(), t2.url());\n+\n+            // update works on multiple changes in one call\n+            // t.setColor(\"\");\n+            t2 = t.update().color(\"000000\").description(\"It is dark!\").done();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d59794b25f2db0889c3da09fe98a13d42e42181d"}, "originalPosition": 37}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY3MDg1ODA0", "url": "https://github.com/hub4j/github-api/pull/724#pullrequestreview-367085804", "createdAt": "2020-03-02T10:18:56Z", "commit": {"oid": "d59794b25f2db0889c3da09fe98a13d42e42181d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxMDoxODo1N1rOFwaNZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxMDoxODo1N1rOFwaNZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjMwNTM4Mw==", "bodyText": "Moved all the calls that create instances of GHLabel into that class.", "url": "https://github.com/hub4j/github-api/pull/724#discussion_r386305383", "createdAt": "2020-03-02T10:18:57Z", "author": {"login": "bitwiseman"}, "path": "src/main/java/org/kohsuke/github/GHRepository.java", "diffHunk": "@@ -1842,9 +1842,7 @@ public GHCommitStatus createCommitStatus(String sha1, GHCommitState state, Strin\n      *             the io exception\n      */\n     public PagedIterable<GHLabel> listLabels() throws IOException {\n-        return root.createRequest()\n-                .withUrlPath(getApiTailUrl(\"labels\"))\n-                .toIterable(GHLabel[].class, item -> item.wrapUp(this));\n+        return GHLabel.readAll(this);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d59794b25f2db0889c3da09fe98a13d42e42181d"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY3NTc0MTYx", "url": "https://github.com/hub4j/github-api/pull/724#pullrequestreview-367574161", "createdAt": "2020-03-02T22:24:16Z", "commit": {"oid": "38f087c401ec891c4d3118c5afc75116af3d24a6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQyMjoyNDoxN1rOFwxjWw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQyMjoyNDoxN1rOFwxjWw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjY4NzgzNQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        // instances are immutable, but update returns a new updated instance.\n          \n          \n            \n                        // instances behave as immutable by default. Update returns a new updated instance.", "url": "https://github.com/hub4j/github-api/pull/724#discussion_r386687835", "createdAt": "2020-03-02T22:24:17Z", "author": {"login": "bitwiseman"}, "path": "src/test/java/org/kohsuke/github/AppTest.java", "diffHunk": "@@ -800,16 +800,19 @@ public void testRepoLabel() throws IOException {\n             assertEquals(t.getDescription(), t2.getDescription());\n             assertEquals(t.getUrl(), t2.getUrl());\n \n-            t.setColor(\"000000\");\n+            // update works on multiple changes in one call\n+            // t.setColor(\"\");\n+            t2 = t.update().color(\"000000\").description(\"It is dark!\").done();\n \n-            // This is annoying behavior, but it is by design at this time.\n-            // Verifying so we can know when it is fixed.\n+            // instances are immutable, but update returns a new updated instance.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "38f087c401ec891c4d3118c5afc75116af3d24a6"}, "originalPosition": 11}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY3ODg4NDkz", "url": "https://github.com/hub4j/github-api/pull/724#pullrequestreview-367888493", "createdAt": "2020-03-03T11:06:48Z", "commit": {"oid": "cec3e67cfc4ee0b4d0d0c1a28c325113b5e5a229"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxMTowNjo0OVrOFxBc4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxMTowNjo0OVrOFxBc4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Njk0ODMyMQ==", "bodyText": "This threw me off the first time I read this code to realize that this is what ensures setters still make the REST API call instead of batching", "url": "https://github.com/hub4j/github-api/pull/724#discussion_r386948321", "createdAt": "2020-03-03T11:06:49Z", "author": {"login": "res0nance"}, "path": "src/main/java/org/kohsuke/github/AbstractBuilder.java", "diffHunk": "@@ -0,0 +1,106 @@\n+package org.kohsuke.github;\n+\n+import java.io.IOException;\n+\n+import javax.annotation.CheckForNull;\n+import javax.annotation.Nonnull;\n+\n+/**\n+ *\n+ * @param <R>\n+ *            Final return type for built by this builder returned when {@link #done()}} is called.\n+ * @param <S>\n+ *            Intermediate return type for this builder returned by calls to {@link #with(String, Object)}. If {@link S}\n+ *            the same as {@link R}, this builder will commit changes after each call to {@link #with(String, Object)}.\n+ */\n+abstract class AbstractBuilder<R, S> {\n+\n+    // TODO: Not sure how update-in-place behavior should be controlled, but\n+    // it certainly can be controlled dynamically down to the instance level or inherited for all children of some\n+    // connection.\n+    protected boolean updateInPlace;\n+    private final Class<R> returnType;\n+    private final Class<S> intermediateReturnType;\n+    protected final Requester requester;\n+\n+    @CheckForNull\n+    private final R baseInstance;\n+\n+    /**\n+     * Creates a builder.\n+     *\n+     * @param root\n+     *            the GitHub instance to connect to.\n+     * @param intermediateReturnType\n+     *            the intermediate return type returned by calls to {@link #with(String, Object)}.\n+     * @param builtReturnType\n+     *            the final return type for built by this builder returned when {@link #done()}} is called.\n+     * @param baseInstance\n+     *            optional instance on which to base this builder.\n+     */\n+    protected AbstractBuilder(@Nonnull GitHub root,\n+            @Nonnull Class<S> intermediateReturnType,\n+            @Nonnull Class<R> builtReturnType,\n+            @CheckForNull R baseInstance) {\n+        this.requester = root.createRequest();\n+        this.returnType = builtReturnType;\n+        this.intermediateReturnType = intermediateReturnType;\n+        this.baseInstance = baseInstance;\n+        this.updateInPlace = false;\n+    }\n+\n+    /**\n+     * Finishes an update, committing changes.\n+     *\n+     * This method may update-in-place or not. Either way it returns the resulting instance.\n+     *\n+     * @return an instance with updated current data\n+     * @throws IOException\n+     *             if there is an I/O Exception\n+     */\n+    @Nonnull\n+    public R done() throws IOException {\n+        R result;\n+        if (updateInPlace && baseInstance != null) {\n+            result = requester.fetchInto(baseInstance);\n+        } else {\n+            result = requester.fetch(returnType);\n+        }\n+        return result;\n+    }\n+\n+    /**\n+     * Applies a value to a name for this builder.\n+     *\n+     * The internals of this method look terrifying, but they they're actually basically safe due to previous comparison\n+     * of U and T determined by comparing class instances passed in during construction.\n+     *\n+     * If U is the same as T, this cause the builder to commit changes after the first value change and return a T from\n+     * done().\n+     *\n+     * If U is not the same as T, the builder will batch together multiple changes and let the user call done() when\n+     * they are ready.\n+     *\n+     * This little bit of roughness in this base class means all inheriting builders get to create Updater and Setter\n+     * classes from almost identical code. Creator can be implemented with significant code reuse as well.\n+     *\n+     * There is probably a cleaner way to implement this, but I'm not sure what it is right now.\n+     *\n+     * @param name\n+     *            the name of the field\n+     * @param value\n+     *            the value of the field\n+     * @return either a continuing builder or an updated data record\n+     * @throws IOException\n+     *             if an I/O error occurs\n+     */\n+    @Nonnull\n+    protected S with(@Nonnull String name, Object value) throws IOException {\n+        requester.with(name, value);\n+        if (returnType.equals(intermediateReturnType)) {\n+            return intermediateReturnType.cast(done());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cec3e67cfc4ee0b4d0d0c1a28c325113b5e5a229"}, "originalPosition": 101}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6ea9e4c1301832d26b314003a149390f1719b800", "author": {"user": {"login": "bitwiseman", "name": "Liam Newman"}}, "url": "https://github.com/hub4j/github-api/commit/6ea9e4c1301832d26b314003a149390f1719b800", "committedDate": "2020-03-04T04:34:15Z", "message": "Clarify behavior"}, "afterCommit": {"oid": "9111081d7ed0f1b8cc6a8933522c412e200497bd", "author": {"user": {"login": "bitwiseman", "name": "Liam Newman"}}, "url": "https://github.com/hub4j/github-api/commit/9111081d7ed0f1b8cc6a8933522c412e200497bd", "committedDate": "2020-03-04T06:10:34Z", "message": "Clarify behavior"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4NTI1NTQ3", "url": "https://github.com/hub4j/github-api/pull/724#pullrequestreview-368525547", "createdAt": "2020-03-04T06:13:05Z", "commit": {"oid": "d1205ff97144bd929364f834a380214da3a430d9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwNjoxMzowNVrOFxhD6A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwNjoxMzowNVrOFxhD6A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzQ2NjIxNg==", "bodyText": "Replaced wrapUp() with lateBind().\nUpdate: removed need for late bind.", "url": "https://github.com/hub4j/github-api/pull/724#discussion_r387466216", "createdAt": "2020-03-04T06:13:05Z", "author": {"login": "bitwiseman"}, "path": "src/main/java/org/kohsuke/github/GHLabel.java", "diffHunk": "@@ -48,41 +69,23 @@ public String getColor() {\n      *\n      * @return the description\n      */\n+    @Nonnull\n     public String getDescription() {\n         return description;\n     }\n \n-    GHLabel wrapUp(GHRepository repo) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d1205ff97144bd929364f834a380214da3a430d9"}, "originalPosition": 72}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY4NTI2NjAx", "url": "https://github.com/hub4j/github-api/pull/724#pullrequestreview-368526601", "createdAt": "2020-03-04T06:16:21Z", "commit": {"oid": "d1205ff97144bd929364f834a380214da3a430d9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwNjoxNjoyMlrOFxhHRw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQwNjoxNjoyMlrOFxhHRw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzQ2NzA3OQ==", "bodyText": "Any suggestions for a better method name than done()?   send()?  submit()?\nWe can't use commit() because it will almost surely collide with a git \"commit\" at least conceptually if not literally.", "url": "https://github.com/hub4j/github-api/pull/724#discussion_r387467079", "createdAt": "2020-03-04T06:16:22Z", "author": {"login": "bitwiseman"}, "path": "src/main/java/org/kohsuke/github/AbstractBuilder.java", "diffHunk": "@@ -0,0 +1,147 @@\n+package org.kohsuke.github;\n+\n+import java.io.IOException;\n+\n+import javax.annotation.CheckForNull;\n+import javax.annotation.Nonnull;\n+\n+/**\n+ * An abstract data object builder/updater.\n+ *\n+ * This class can be use to make a Builder that supports both batch and single property changes.\n+ * <p>\n+ * Batching looks like this:\n+ * \n+ * <pre>\n+ * update().someName(value).otherName(value).done()\n+ * </pre>\n+ * </p>\n+ * <p>\n+ * Single changee look like this:\n+ * \n+ * <pre>\n+ * set().someName(value);\n+ * set().otherName(value);\n+ * </pre>\n+ * </p>\n+ * <p>\n+ * If S is the same as R, {@link #with(String, Object)} will commit changes after the first value change and return a R\n+ * from {@link #done()}.\n+ * </p>\n+ * <p>\n+ * If S is not the same as R, {@link #with(String, Object)} will batch together multiple changes and let the user call\n+ * {@link #done()} when they are ready.\n+ *\n+ * @param <R>\n+ *            Final return type for built by this builder returned when {@link #done()}} is called.\n+ * @param <S>\n+ *            Intermediate return type for this builder returned by calls to {@link #with(String, Object)}. If {@link S}\n+ *            the same as {@link R}, this builder will commit changes after each call to {@link #with(String, Object)}.\n+ */\n+abstract class AbstractBuilder<R, S> {\n+\n+    @Nonnull\n+    private final Class<R> returnType;\n+\n+    @Nonnull\n+    private final Class<S> intermediateReturnType;\n+\n+    private final boolean commitChangesImmediately;\n+\n+    @CheckForNull\n+    private final R baseInstance;\n+\n+    @Nonnull\n+    protected final Requester requester;\n+\n+    // TODO: Not sure how update-in-place behavior should be controlled, but\n+    // it certainly can be controlled dynamically down to the instance level or inherited for all children of some\n+    // connection.\n+    protected boolean updateInPlace;\n+\n+    /**\n+     * Creates a builder.\n+     *\n+     * @param root\n+     *            the GitHub instance to connect to.\n+     * @param intermediateReturnType\n+     *            the intermediate return type returned by calls to {@link #with(String, Object)}. Must either be equal\n+     *            to {@code builtReturnType} or this instance must be castable to this class. If not, the constructor\n+     *            {@link IllegalArgumentException}\n+     * @param builtReturnType\n+     *            the final return type for built by this builder returned when {@link #done()}} is called.\n+     * @param baseInstance\n+     *            optional instance on which to base this builder.\n+     */\n+    protected AbstractBuilder(@Nonnull GitHub root,\n+            @Nonnull Class<S> intermediateReturnType,\n+            @Nonnull Class<R> builtReturnType,\n+            @CheckForNull R baseInstance) {\n+        this.requester = root.createRequest();\n+        this.returnType = builtReturnType;\n+        this.intermediateReturnType = intermediateReturnType;\n+        this.commitChangesImmediately = returnType.equals(intermediateReturnType);\n+        if (!commitChangesImmediately && intermediateReturnType.isInstance(this)) {\n+            throw new IllegalArgumentException(\n+                    \"Argument \\\"intermediateReturnType\\\": This instance must be castable to intermediateReturnType or intermediateReturnType must be equal to builtReturnType.\");\n+        }\n+\n+        this.baseInstance = baseInstance;\n+        this.updateInPlace = false;\n+\n+    }\n+\n+    /**\n+     * Finishes an update, committing changes.\n+     *\n+     * This method may update-in-place or not. Either way it returns the resulting instance.\n+     *\n+     * @return an instance with updated current data\n+     * @throws IOException\n+     *             if there is an I/O Exception\n+     */\n+    @Nonnull\n+    public R done() throws IOException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d1205ff97144bd929364f834a380214da3a430d9"}, "originalPosition": 104}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d1205ff97144bd929364f834a380214da3a430d9", "author": {"user": {"login": "bitwiseman", "name": "Liam Newman"}}, "url": "https://github.com/hub4j/github-api/commit/d1205ff97144bd929364f834a380214da3a430d9", "committedDate": "2020-03-04T06:11:22Z", "message": "Merge branch 'master' into task/builder-updater"}, "afterCommit": {"oid": "a92c2e687f44c1b46e115f69e4f0a654a37a87e5", "author": {"user": {"login": "bitwiseman", "name": "Liam Newman"}}, "url": "https://github.com/hub4j/github-api/commit/a92c2e687f44c1b46e115f69e4f0a654a37a87e5", "committedDate": "2020-03-04T06:26:18Z", "message": "Clarify behavior"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a92c2e687f44c1b46e115f69e4f0a654a37a87e5", "author": {"user": {"login": "bitwiseman", "name": "Liam Newman"}}, "url": "https://github.com/hub4j/github-api/commit/a92c2e687f44c1b46e115f69e4f0a654a37a87e5", "committedDate": "2020-03-04T06:26:18Z", "message": "Clarify behavior"}, "afterCommit": {"oid": "54914c86d45a7c04fc11c7e9b8d25b6c6eceff4b", "author": {"user": {"login": "bitwiseman", "name": "Liam Newman"}}, "url": "https://github.com/hub4j/github-api/commit/54914c86d45a7c04fc11c7e9b8d25b6c6eceff4b", "committedDate": "2020-03-04T06:27:04Z", "message": "Clarify behavior"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "53e9da9f821833538236885da64ae524a98f8cf1", "author": {"user": {"login": "bitwiseman", "name": "Liam Newman"}}, "url": "https://github.com/hub4j/github-api/commit/53e9da9f821833538236885da64ae524a98f8cf1", "committedDate": "2020-03-04T08:22:24Z", "message": "Merge branch 'master' into task/builder-updater"}, "afterCommit": {"oid": "0b46ce05df7e274fe52f284208a29c6fcbaf4b94", "author": {"user": {"login": "bitwiseman", "name": "Liam Newman"}}, "url": "https://github.com/hub4j/github-api/commit/0b46ce05df7e274fe52f284208a29c6fcbaf4b94", "committedDate": "2020-03-04T08:30:47Z", "message": "Clarify behavior"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5d4da2ebf39f637382d311c02a19974f38c27710", "author": {"user": {"login": "bitwiseman", "name": "Liam Newman"}}, "url": "https://github.com/hub4j/github-api/commit/5d4da2ebf39f637382d311c02a19974f38c27710", "committedDate": "2020-03-04T08:31:26Z", "message": "Merge branch 'master' into task/builder-updater"}, "afterCommit": {"oid": "208ffac5ddf2d320c79f5c42d5636fe786691413", "author": {"user": {"login": "bitwiseman", "name": "Liam Newman"}}, "url": "https://github.com/hub4j/github-api/commit/208ffac5ddf2d320c79f5c42d5636fe786691413", "committedDate": "2020-03-04T21:38:37Z", "message": "Remove Repository member from GHLabel\n\nIt turns out GHLabel instances do not need a reference to their repo, just to root."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7c1be13f51613f217304b09a11f1274c7a281bc7", "author": {"user": {"login": "bitwiseman", "name": "Liam Newman"}}, "url": "https://github.com/hub4j/github-api/commit/7c1be13f51613f217304b09a11f1274c7a281bc7", "committedDate": "2020-03-20T19:33:03Z", "message": "Merge branch 'master' into task/builder-updater"}, "afterCommit": {"oid": "fb50ade0bd733f94d485502e4be751c7c6ca376e", "author": {"user": {"login": "bitwiseman", "name": "Liam Newman"}}, "url": "https://github.com/hub4j/github-api/commit/fb50ade0bd733f94d485502e4be751c7c6ca376e", "committedDate": "2020-03-23T22:38:50Z", "message": "Re-record test for GHLabel"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2607d6a107b90360c6e782f10b399815e4921bc7", "author": {"user": {"login": "bitwiseman", "name": "Liam Newman"}}, "url": "https://github.com/hub4j/github-api/commit/2607d6a107b90360c6e782f10b399815e4921bc7", "committedDate": "2020-03-24T00:40:01Z", "message": "Make GHLabel example of proposed API design"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b7de4359fd8ed47ecdeb8cc28378b081e7daa4e8", "author": {"user": {"login": "bitwiseman", "name": "Liam Newman"}}, "url": "https://github.com/hub4j/github-api/commit/b7de4359fd8ed47ecdeb8cc28378b081e7daa4e8", "committedDate": "2020-03-24T00:40:01Z", "message": "Alternative proposal\n\nThe guts of this version are a bit ugly but they result reasonable API code without a ton of extra\ncode needed."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0cb237151777ce8aaa10838a959cdbadc2cbcd84", "author": {"user": {"login": "bitwiseman", "name": "Liam Newman"}}, "url": "https://github.com/hub4j/github-api/commit/0cb237151777ce8aaa10838a959cdbadc2cbcd84", "committedDate": "2020-03-24T00:40:01Z", "message": "Third alternative proposal\n\nThis removes the  from the fields.  Functionally the behavior is unchanged but\nit is no longer guaranteed at compile time.  This simplifies streamlines the code slightly,\nbut at the cost of only being able to assert immutability rather than know it.\n\nHowever, as we move to using this structure through more of the library, this is may be a better choice.\nThere are so many places where the GitHub API itself returns partial records or updates them dynamically.\nTrying to claim immutability where it doesn't exist is not great either."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "134222fd692f3b1f731b2f42d08ea1fc71354986", "author": {"user": {"login": "bitwiseman", "name": "Liam Newman"}}, "url": "https://github.com/hub4j/github-api/commit/134222fd692f3b1f731b2f42d08ea1fc71354986", "committedDate": "2020-03-24T00:40:01Z", "message": "Minor cleanups"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "98ef2cc640022464759bffa90971ff16dff9eb16", "author": {"user": {"login": "bitwiseman", "name": "Liam Newman"}}, "url": "https://github.com/hub4j/github-api/commit/98ef2cc640022464759bffa90971ff16dff9eb16", "committedDate": "2020-03-24T00:40:01Z", "message": "Update-in-place and safer single or batch calculation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f37e4bd76e4378b5f7e905813e0195bf2dea0393", "author": {"user": {"login": "bitwiseman", "name": "Liam Newman"}}, "url": "https://github.com/hub4j/github-api/commit/f37e4bd76e4378b5f7e905813e0195bf2dea0393", "committedDate": "2020-03-24T00:40:01Z", "message": "Private fields"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "64a82f478542ed641d585403c304cd9b1b88e63d", "author": {"user": {"login": "bitwiseman", "name": "Liam Newman"}}, "url": "https://github.com/hub4j/github-api/commit/64a82f478542ed641d585403c304cd9b1b88e63d", "committedDate": "2020-03-24T00:40:01Z", "message": "Clean up proposed API changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9f1d7323c7f14b670d6881ca2a1dede9f9718e14", "author": {"user": {"login": "bitwiseman", "name": "Liam Newman"}}, "url": "https://github.com/hub4j/github-api/commit/9f1d7323c7f14b670d6881ca2a1dede9f9718e14", "committedDate": "2020-03-24T00:40:01Z", "message": "Reverted getter changes to highlight the more important set/update changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "79a1bb3571cadc74ddaf42a93a6d7f3df1c1cffc", "author": {"user": {"login": "bitwiseman", "name": "Liam Newman"}}, "url": "https://github.com/hub4j/github-api/commit/79a1bb3571cadc74ddaf42a93a6d7f3df1c1cffc", "committedDate": "2020-03-24T00:40:01Z", "message": "Update src/test/java/org/kohsuke/github/AppTest.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "863ad0f48691a8a42a9c425c29624e11cc66c042", "author": {"user": {"login": "bitwiseman", "name": "Liam Newman"}}, "url": "https://github.com/hub4j/github-api/commit/863ad0f48691a8a42a9c425c29624e11cc66c042", "committedDate": "2020-03-24T00:40:01Z", "message": "Clarify behavior"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "09ec89bc2e060d9addac48d51746d01b693211f9", "author": {"user": {"login": "bitwiseman", "name": "Liam Newman"}}, "url": "https://github.com/hub4j/github-api/commit/09ec89bc2e060d9addac48d51746d01b693211f9", "committedDate": "2020-03-24T00:40:01Z", "message": "Remove Repository member from GHLabel\n\nIt turns out GHLabel instances do not need a reference to their repo, just to root."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fcb8d03a0f923e594d39ffd7c9a69919612bc297", "author": {"user": {"login": "bitwiseman", "name": "Liam Newman"}}, "url": "https://github.com/hub4j/github-api/commit/fcb8d03a0f923e594d39ffd7c9a69919612bc297", "committedDate": "2020-03-24T00:40:01Z", "message": "Ensure that Description is part of GHLabel comparision"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b8180314d89fb1ccc9082f74f20b48313cf27be9", "author": {"user": {"login": "bitwiseman", "name": "Liam Newman"}}, "url": "https://github.com/hub4j/github-api/commit/b8180314d89fb1ccc9082f74f20b48313cf27be9", "committedDate": "2020-03-24T00:40:01Z", "message": "Change to Preview for new builder pattern"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b15e0d4c458bd55bcfe26b4c99b71fd55676ad85", "author": {"user": {"login": "bitwiseman", "name": "Liam Newman"}}, "url": "https://github.com/hub4j/github-api/commit/b15e0d4c458bd55bcfe26b4c99b71fd55676ad85", "committedDate": "2020-03-24T00:40:01Z", "message": "Cleanup and tweaks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2ab4eafee938d1113f34bddb158a11ec0992b532", "author": {"user": {"login": "bitwiseman", "name": "Liam Newman"}}, "url": "https://github.com/hub4j/github-api/commit/2ab4eafee938d1113f34bddb158a11ec0992b532", "committedDate": "2020-03-24T00:40:01Z", "message": "Tweaks and cleanup"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d19c385a441099530d8314038a1aa4e4515dfb03", "author": {"user": {"login": "bitwiseman", "name": "Liam Newman"}}, "url": "https://github.com/hub4j/github-api/commit/d19c385a441099530d8314038a1aa4e4515dfb03", "committedDate": "2020-03-23T22:50:07Z", "message": "Merge branch 'master' into task/builder-updater"}, "afterCommit": {"oid": "0625940c7d8f46dc362e698f6f3bff036390cc4e", "author": {"user": {"login": "bitwiseman", "name": "Liam Newman"}}, "url": "https://github.com/hub4j/github-api/commit/0625940c7d8f46dc362e698f6f3bff036390cc4e", "committedDate": "2020-03-24T00:40:01Z", "message": "Re-record test for GHLabel"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0625940c7d8f46dc362e698f6f3bff036390cc4e", "author": {"user": {"login": "bitwiseman", "name": "Liam Newman"}}, "url": "https://github.com/hub4j/github-api/commit/0625940c7d8f46dc362e698f6f3bff036390cc4e", "committedDate": "2020-03-24T00:40:01Z", "message": "Re-record test for GHLabel"}, "afterCommit": {"oid": "2df06735029ca7e6e2b14e7e2de036ca1c7c73ce", "author": {"user": {"login": "bitwiseman", "name": "Liam Newman"}}, "url": "https://github.com/hub4j/github-api/commit/2df06735029ca7e6e2b14e7e2de036ca1c7c73ce", "committedDate": "2020-03-24T00:45:59Z", "message": "Re-record test for GHLabel"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2df06735029ca7e6e2b14e7e2de036ca1c7c73ce", "author": {"user": {"login": "bitwiseman", "name": "Liam Newman"}}, "url": "https://github.com/hub4j/github-api/commit/2df06735029ca7e6e2b14e7e2de036ca1c7c73ce", "committedDate": "2020-03-24T00:45:59Z", "message": "Re-record test for GHLabel"}, "afterCommit": {"oid": "29019d4620676dd4d54b886ed532c6f5dcb812fb", "author": {"user": {"login": "bitwiseman", "name": "Liam Newman"}}, "url": "https://github.com/hub4j/github-api/commit/29019d4620676dd4d54b886ed532c6f5dcb812fb", "committedDate": "2020-03-24T16:38:12Z", "message": "Re-record test for GHLabel"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "29019d4620676dd4d54b886ed532c6f5dcb812fb", "author": {"user": {"login": "bitwiseman", "name": "Liam Newman"}}, "url": "https://github.com/hub4j/github-api/commit/29019d4620676dd4d54b886ed532c6f5dcb812fb", "committedDate": "2020-03-24T16:38:12Z", "message": "Re-record test for GHLabel"}, "afterCommit": {"oid": "b823d688e2832b4dcd44bfcb837f904547118ca0", "author": {"user": {"login": "bitwiseman", "name": "Liam Newman"}}, "url": "https://github.com/hub4j/github-api/commit/b823d688e2832b4dcd44bfcb837f904547118ca0", "committedDate": "2020-03-24T18:10:53Z", "message": "Re-record test for GHLabel"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "772272ff36f48424c99115970b481a33f5c49ae0", "author": {"user": {"login": "bitwiseman", "name": "Liam Newman"}}, "url": "https://github.com/hub4j/github-api/commit/772272ff36f48424c99115970b481a33f5c49ae0", "committedDate": "2020-03-24T19:32:13Z", "message": "Re-record test for GHLabel"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b823d688e2832b4dcd44bfcb837f904547118ca0", "author": {"user": {"login": "bitwiseman", "name": "Liam Newman"}}, "url": "https://github.com/hub4j/github-api/commit/b823d688e2832b4dcd44bfcb837f904547118ca0", "committedDate": "2020-03-24T18:10:53Z", "message": "Re-record test for GHLabel"}, "afterCommit": {"oid": "772272ff36f48424c99115970b481a33f5c49ae0", "author": {"user": {"login": "bitwiseman", "name": "Liam Newman"}}, "url": "https://github.com/hub4j/github-api/commit/772272ff36f48424c99115970b481a33f5c49ae0", "committedDate": "2020-03-24T19:32:13Z", "message": "Re-record test for GHLabel"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1695, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}