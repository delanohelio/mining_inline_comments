{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQwNjQzNjE3", "number": 1001, "title": "Implement static typing for previews and clean up usage declarations", "bodyText": "Description\nThis PR introduces the following changes:\n\nRefactor the Previews const class into an enum to prevent string constants from being used at @Preview use sites.\nUpdates existing usages of @Preview to include references to Previews enum constants.\n\nThings to consider\n\nThe PR would introduce a breaking change to consumers that rely directly on the older strings constants.\n\nThey would be able to remediate this by updating their usage from Previews.ANTMAN -> Previews.ANTMAN.mediaType()\n\n\nOne of the main goals of this PR is to improve transparency to consumers on not just which APIs are previews but what previews exactly they depend on. Allowing consumers to make more informed decisions on their usage.\nWe are still not requiring a media type to always be included at use sites be it seems like @Preview is also being used to denote sdk specific beta APIs in some cases. I suggest, when appropriate we migrate those usages to use a new annotation as to not conflate the two 'Preview' use cases. Something along the lines of @Hub4jBetaApi or @SdkBetaApi. After that we should have no issue making preview media types a hard requirement.\n\nBefore submitting a PR:\nWe love getting PRs, but we hate asking people for the same basic changes every time.\n\n Push your changes to a branch other than master. Create your PR from that branch.\n Add JavaDocs and other comments\n Write tests that run and pass in CI. See CONTRIBUTING.md for details on how to capture snapshot data.\n Run mvn clean compile locally. This may reformat your code, commit those changes.\n Run mvn -D enable-ci clean install site locally. If this command doesn't succeed, your change will not pass CI.\n\nWhen creating a PR:\n\n Fill in the \"Description\" above.\n Enable \"Allow edits from maintainers\".", "createdAt": "2020-12-15T19:53:51Z", "url": "https://github.com/hub4j/github-api/pull/1001", "merged": true, "mergeCommit": {"oid": "e3e495bfb1e27b04bd8c227eaf7845c84d5f5229"}, "closed": true, "closedAt": "2020-12-15T23:39:07Z", "author": {"login": "marcoferrer"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdmfpvCAH2gAyNTQwNjQzNjE3Ojc5YjQ5YTQ2OWMxMjMzMzU1ODU5NTNkZTFmNTdlMTA2OTA5MjQ1YjQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdmi059gFqTU1MzA3NTA4MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "79b49a469c123335585953de1f57e106909245b4", "author": {"user": {"login": "marcoferrer", "name": "Marco Ferrer"}}, "url": "https://github.com/hub4j/github-api/commit/79b49a469c123335585953de1f57e106909245b4", "committedDate": "2020-12-15T19:39:00Z", "message": "Clean up preview declarations"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUyODE5NDg1", "url": "https://github.com/hub4j/github-api/pull/1001#pullrequestreview-552819485", "createdAt": "2020-12-15T19:57:01Z", "commit": {"oid": "79b49a469c123335585953de1f57e106909245b4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxOTo1NzowMlrOIGdeFQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxOTo1NzowMlrOIGdeFQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzY0NTIwNQ==", "bodyText": "This was a product of the formater", "url": "https://github.com/hub4j/github-api/pull/1001#discussion_r543645205", "createdAt": "2020-12-15T19:57:02Z", "author": {"login": "marcoferrer"}, "path": "src/main/java/org/kohsuke/github/GHRepository.java", "diffHunk": "@@ -2959,10 +2959,14 @@ void populate() throws IOException {\n             // There is bug in Push event payloads that returns the wrong url.\n             // All other occurrences of \"url\" take the form \"https://api.github.com/...\".\n             // For Push event repository records, they take the form \"https://github.com/{fullName}\".\n-            root.createRequest().withPreview(BAPTISE).setRawUrlPath(url.toString()).fetchInto(this).wrap(root);\n+            root.createRequest().withPreview(BAPTISTE).setRawUrlPath(url.toString()).fetchInto(this).wrap(root);\n         } catch (HttpException e) {\n             if (e.getCause() instanceof JsonParseException) {\n-                root.createRequest().withPreview(BAPTISE).withUrlPath(\"/repos/\" + full_name).fetchInto(this).wrap(root);\n+                root.createRequest()\n+                        .withPreview(BAPTISTE)\n+                        .withUrlPath(\"/repos/\" + full_name)\n+                        .fetchInto(this)\n+                        .wrap(root);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "79b49a469c123335585953de1f57e106909245b4"}, "originalPosition": 49}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUyODIwMzY5", "url": "https://github.com/hub4j/github-api/pull/1001#pullrequestreview-552820369", "createdAt": "2020-12-15T19:58:12Z", "commit": {"oid": "79b49a469c123335585953de1f57e106909245b4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxOTo1ODoxMlrOIGdgsw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxOTo1ODoxMlrOIGdgsw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzY0NTg3NQ==", "bodyText": "This overload of the withPreview method was defined to prevent us from having to update every usage of the method after Previews was converted to an enum. This was an attempt at minimizing noise in the PR", "url": "https://github.com/hub4j/github-api/pull/1001#discussion_r543645875", "createdAt": "2020-12-15T19:58:12Z", "author": {"login": "marcoferrer"}, "path": "src/main/java/org/kohsuke/github/GitHubRequest.java", "diffHunk": "@@ -437,6 +437,10 @@ public B withPreview(String name) {\n             return withHeader(\"Accept\", name);\n         }\n \n+        public B withPreview(Previews preview) {\n+            return withPreview(preview.mediaType());\n+        }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "79b49a469c123335585953de1f57e106909245b4"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUyODIxMzUw", "url": "https://github.com/hub4j/github-api/pull/1001#pullrequestreview-552821350", "createdAt": "2020-12-15T19:59:31Z", "commit": {"oid": "79b49a469c123335585953de1f57e106909245b4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxOTo1OTozMVrOIGdj5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxOTo1OTozMVrOIGdj5w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzY0NjY5NQ==", "bodyText": "Typo fixed throughout the codebase", "url": "https://github.com/hub4j/github-api/pull/1001#discussion_r543646695", "createdAt": "2020-12-15T19:59:31Z", "author": {"login": "marcoferrer"}, "path": "src/main/java/org/kohsuke/github/Previews.java", "diffHunk": "@@ -7,121 +7,133 @@\n  *\n  * @author Kohsuke Kawaguchi\n  */\n-class Previews {\n+enum Previews {\n+\n     /**\n      * Check-runs and check-suites\n      *\n      * @see <a href=\"https://developer.github.com/v3/previews/#check-runs-and-check-suites-api\">GitHub API Previews</a>\n      */\n-    static final String ANTIOPE = \"application/vnd.github.antiope-preview+json\";\n+    ANTIOPE(\"application/vnd.github.antiope-preview+json\"),\n \n     /**\n      * Enhanced Deployments\n      *\n      * @see <a href=\"https://developer.github.com/v3/previews/#enhanced-deployments\">GitHub API Previews</a>\n      */\n-    static final String ANT_MAN = \"application/vnd.github.ant-man-preview+json\";\n+    ANT_MAN(\"application/vnd.github.ant-man-preview+json\"),\n \n     /**\n      * Create repository from template repository\n      *\n      * @see <a href=\"https://developer.github.com/v3/previews/#create-and-use-repository-templates\">GitHub API\n      *      Previews</a>\n      */\n-    static final String BAPTISE = \"application/vnd.github.baptiste-preview+json\";\n+    BAPTISTE(\"application/vnd.github.baptiste-preview+json\"),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "79b49a469c123335585953de1f57e106909245b4"}, "originalPosition": 30}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e007284d2fa4b717e3864412d73189a778205dce", "author": {"user": {"login": "bitwiseman", "name": "Liam Newman"}}, "url": "https://github.com/hub4j/github-api/commit/e007284d2fa4b717e3864412d73189a778205dce", "committedDate": "2020-12-15T23:20:30Z", "message": "Merge branch 'master' into preview-enum-and-cleanup"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUzMDc1MDgw", "url": "https://github.com/hub4j/github-api/pull/1001#pullrequestreview-553075080", "createdAt": "2020-12-15T23:20:55Z", "commit": {"oid": "e007284d2fa4b717e3864412d73189a778205dce"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1599, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}