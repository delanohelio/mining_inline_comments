{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIwNzAwODI1", "number": 5925, "title": "Fix #5923: Prevent native date converter errors", "bodyText": "@christophs78 Not sure if this is the best way to fix it but.\n\n\nUsed our new CalendarUtils.now(cal) method instead of LocalDateTime.now() so it calculates NOW in the calendar's timezone.\n\n\nI basically eat the conversion exception and log it and fall back to built in conversion.", "createdAt": "2020-05-20T11:53:40Z", "url": "https://github.com/primefaces/primefaces/pull/5925", "merged": true, "mergeCommit": {"oid": "8383d344cdb47fca3a6dcf373a01141fad4faa40"}, "closed": true, "closedAt": "2020-05-22T11:27:46Z", "author": {"login": "melloware"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcjHtcMAH2gAyNDIwNzAwODI1OmM5YmMwMzk5YjIzY2Y3MDAwNGVhMTRjODk5NzM3ZjI5NjljNmYyMzY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcjjmRrgH2gAyNDIwNzAwODI1OjVkZjhmMTRiMTA0M2UzYThlZGM1MTE5NWFjODRlZmIzMTc1MjAyYTY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c9bc0399b23cf70004ea14c899737f2969c6f236", "author": {"user": {"login": "melloware", "name": "Melloware"}}, "url": "https://github.com/primefaces/primefaces/commit/c9bc0399b23cf70004ea14c899737f2969c6f236", "committedDate": "2020-05-20T11:52:24Z", "message": "Fix #5923: Prevent native date converter errors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5158e6e3730493d6ac42f7b09e68ec91b889de49", "author": {"user": {"login": "melloware", "name": "Melloware"}}, "url": "https://github.com/primefaces/primefaces/commit/5158e6e3730493d6ac42f7b09e68ec91b889de49", "committedDate": "2020-05-20T12:06:10Z", "message": "Fix #5923: Prevent native date converter errors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "24b7ca4b04f362df61d70d0d3dd4a2be11cccede", "author": {"user": {"login": "melloware", "name": "Melloware"}}, "url": "https://github.com/primefaces/primefaces/commit/24b7ca4b04f362df61d70d0d3dd4a2be11cccede", "committedDate": "2020-05-20T16:32:15Z", "message": "Fix #5923: Prevent native date converter errors"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE1NTY5MTQ0", "url": "https://github.com/primefaces/primefaces/pull/5925#pullrequestreview-415569144", "createdAt": "2020-05-20T17:40:20Z", "commit": {"oid": "24b7ca4b04f362df61d70d0d3dd4a2be11cccede"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxNzo0MDoyMFrOGYWykQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxNzo0MDoyMFrOGYWykQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODE5MjQwMQ==", "bodyText": "LocalTime?", "url": "https://github.com/primefaces/primefaces/pull/5925#discussion_r428192401", "createdAt": "2020-05-20T17:40:20Z", "author": {"login": "christophs78"}, "path": "src/main/java/org/primefaces/util/CalendarUtils.java", "diffHunk": "@@ -532,4 +533,26 @@ public static Temporal now(UICalendar uicalendar) {\n         ZoneId zone = calculateZoneId(uicalendar.getTimeZone());\n         return hasTime ? LocalDateTime.now(zone) : LocalDate.now(zone);\n     }\n+\n+    /**\n+     * Calculates NOW based on the calendar's current timezone or will default to system timezone if none set.\n+     *\n+     * @param uicalendar the base calendar to calculate NOW for\n+     * @return an Object representing either a Date or Temporal\n+     */\n+    public static Object now(UICalendar uicalendar, Class<?> dateType) {\n+        Temporal now = now(uicalendar);\n+        if (dateType.isAssignableFrom(java.util.Date.class)) {\n+            ZoneId zone = calculateZoneId(uicalendar.getTimeZone());\n+            java.util.Date date;\n+            if (now instanceof LocalDate) {\n+                date = java.util.Date.from(((LocalDate) now).atStartOfDay(zone).toInstant());\n+            }\n+            else {\n+                date = java.util.Date.from(((LocalDateTime) now).atZone(zone).toInstant());\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "24b7ca4b04f362df61d70d0d3dd4a2be11cccede"}, "originalPosition": 67}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE1NTcwMDQ4", "url": "https://github.com/primefaces/primefaces/pull/5925#pullrequestreview-415570048", "createdAt": "2020-05-20T17:41:32Z", "commit": {"oid": "24b7ca4b04f362df61d70d0d3dd4a2be11cccede"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxNzo0MTozMlrOGYW1bw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxNzo0MTozMlrOGYW1bw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODE5MzEzNQ==", "bodyText": "we should remove the  \"if it fails ....\"", "url": "https://github.com/primefaces/primefaces/pull/5925#discussion_r428193135", "createdAt": "2020-05-20T17:41:32Z", "author": {"login": "christophs78"}, "path": "src/main/java/org/primefaces/util/CalendarUtils.java", "diffHunk": "@@ -235,7 +236,7 @@ public static final String getValueAsString(FacesContext context, UICalendar cal\n     }\n \n     public static final String getValue(FacesContext context, UICalendar calendar, Object value, String pattern) {\n-        //first ask the converter\n+      //first ask the converter, if it fails fall back to built-in conversion", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "24b7ca4b04f362df61d70d0d3dd4a2be11cccede"}, "originalPosition": 42}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e4ef6d112004d1d56144e0697403d532c57ea227", "author": {"user": {"login": "melloware", "name": "Melloware"}}, "url": "https://github.com/primefaces/primefaces/commit/e4ef6d112004d1d56144e0697403d532c57ea227", "committedDate": "2020-05-20T17:55:35Z", "message": "Fix #5923: Prevent native date converter errors"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE1NTkxODM3", "url": "https://github.com/primefaces/primefaces/pull/5925#pullrequestreview-415591837", "createdAt": "2020-05-20T18:11:13Z", "commit": {"oid": "e4ef6d112004d1d56144e0697403d532c57ea227"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxODoxMToxM1rOGYX6Uw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxODoxMToxM1rOGYX6Uw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODIxMDc3MQ==", "bodyText": "One last thing. :-)\nhasTime = date and time\ntimeOnly = time\n(I know this is a bit confusing.)\n--> if (timeOnly) {", "url": "https://github.com/primefaces/primefaces/pull/5925#discussion_r428210771", "createdAt": "2020-05-20T18:11:13Z", "author": {"login": "christophs78"}, "path": "src/main/java/org/primefaces/util/CalendarUtils.java", "diffHunk": "@@ -530,7 +530,11 @@ public static LocalDateTime toLocalDateTime(ZoneId zoneId, String isoDateString)\n      */\n     public static Temporal now(UICalendar uicalendar) {\n         boolean hasTime = uicalendar.hasTime();\n+        boolean timeOnly = uicalendar.isTimeOnly();\n         ZoneId zone = calculateZoneId(uicalendar.getTimeZone());\n+        if (hasTime && timeOnly) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e4ef6d112004d1d56144e0697403d532c57ea227"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b952ab05d915b3408764d729c8cfb81704ac408", "author": {"user": {"login": "melloware", "name": "Melloware"}}, "url": "https://github.com/primefaces/primefaces/commit/4b952ab05d915b3408764d729c8cfb81704ac408", "committedDate": "2020-05-20T19:03:39Z", "message": "Fix #5923: Prevent native date converter errors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f486b169548f791897e3e15006313f4f6216e4e9", "author": {"user": {"login": "melloware", "name": "Melloware"}}, "url": "https://github.com/primefaces/primefaces/commit/f486b169548f791897e3e15006313f4f6216e4e9", "committedDate": "2020-05-21T14:11:34Z", "message": "Fix #5923: Prevent native date converter errors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "25b19c67712b17766f3f6a61a7e116fe0c542db5", "author": {"user": {"login": "melloware", "name": "Melloware"}}, "url": "https://github.com/primefaces/primefaces/commit/25b19c67712b17766f3f6a61a7e116fe0c542db5", "committedDate": "2020-05-21T20:20:45Z", "message": "Fix #5923: Prevent native date converter errors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5df8f14b1043e3a8edc51195ac84efb3175202a6", "author": {"user": {"login": "melloware", "name": "Melloware"}}, "url": "https://github.com/primefaces/primefaces/commit/5df8f14b1043e3a8edc51195ac84efb3175202a6", "committedDate": "2020-05-21T20:21:55Z", "message": "Fix #5923: Prevent native date converter errors"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2832, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}