{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA1MjU1Mjg3", "number": 6417, "title": "#6355: DatePicker: merged Ajax requests", "bodyText": "Fix #6355\nSee also https://github.com/primefaces/primefaces-showcase/pull/210", "createdAt": "2020-10-17T09:58:18Z", "url": "https://github.com/primefaces/primefaces/pull/6417", "merged": true, "mergeCommit": {"oid": "7301af1b129c955cc8e32471f86258a785803e9e"}, "closed": true, "closedAt": "2020-10-18T10:38:44Z", "author": {"login": "jepsar"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdTX1tugH2gAyNTA1MjU1Mjg3OjMzNGQxYjNhNDRlYWFlZDJlZWVlMDZjYmU0ZjE1ZGJkYzNjODU4YTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdThebdAH2gAyNTA1MjU1Mjg3OmFhM2JkNzhkYTVlMzU2YWJlNTVmYTg1ZTQ0ZTA2ZjEwYmYyMzhlZGI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "334d1b3a44eaaed2eeee06cbe4f15dbdc3c858a4", "author": {"user": {"login": "jepsar", "name": "Jasper de Vries"}}, "url": "https://github.com/primefaces/primefaces/commit/334d1b3a44eaaed2eeee06cbe4f15dbdc3c858a4", "committedDate": "2020-10-17T09:48:17Z", "message": "DatePicker merged Ajax requests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwOTgyNTkx", "url": "https://github.com/primefaces/primefaces/pull/6417#pullrequestreview-510982591", "createdAt": "2020-10-17T12:34:39Z", "commit": {"oid": "334d1b3a44eaaed2eeee06cbe4f15dbdc3c858a4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xN1QxMjozNDozOVrOHjdGFw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xN1QxMjozNDozOVrOHjdGFw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjkzODkwMw==", "bodyText": "I think it might be becaue you are missing:\nsource: _self.id,\n                    process: _self.id,\n                    update: _self.id,\n                    formId: _self.cfg.formId,", "url": "https://github.com/primefaces/primefaces/pull/6417#discussion_r506938903", "createdAt": "2020-10-17T12:34:39Z", "author": {"login": "melloware"}, "path": "src/main/resources/META-INF/resources/primefaces/datepicker/1-datepicker.js", "diffHunk": "@@ -278,64 +278,58 @@ PrimeFaces.widget.DatePicker = PrimeFaces.widget.BaseWidget.extend({\n         var _self = this;\n         this.cfg.onViewDateChange = function(event, date) {\n             _self.viewDateOption = date;\n-\n-            if(_self.hasBehavior('viewChange')) {\n-                _self.fireViewChangeEvent(date.getFullYear(), date.getMonth());\n-            }\n-            if (_self.cfg.lazyModel) {\n-                var options = {\n-                    source: _self.id,\n-                    process: _self.id,\n-                    update: _self.id,\n-                    formId: _self.cfg.formId,\n-                    params: [\n-                        {name: _self.id + '_year', value: date.getFullYear()},\n-                        {name: _self.id + '_month', value: date.getMonth()}\n-                    ],\n-                    onsuccess: function(responseXML, status, xhr) {\n-                        PrimeFaces.ajax.Response.handle(responseXML, status, xhr, {\n-                            widget: _self,\n-                            handle: function(content) {\n-                                var dateMetadata = JSON.parse(content).dateMetadata;\n-                                var disabledDates = [];\n-                                for (date in dateMetadata) {\n-                                    if (dateMetadata[date].disabled) {\n-                                        disabledDates.push(date);\n-                                    }\n-                                }\n-                                _self.setDisabledDates(disabledDates);\n-                            }\n-                        });\n-\n-                        return true;\n-                    }\n-                };\n-                PrimeFaces.ajax.Request.handle(options);\n-            }\n+            _self.fireViewChangeEvent(date);\n         };\n     },\n \n     /**\n      * Triggers the event for when the date picker changed to a different month or year page.\n      * @private\n-     * @param {number} year The year to which the date picker changed.\n-     * @param {number} month The year to which the date picker changed, starting with `0` for `Janurary`.\n+     * @param {Date} date The date to which the date picker changed.\n      */\n-    fireViewChangeEvent: function(year, month) {\n-        if(this.cfg.behaviors) {\n+    fireViewChangeEvent: function(date) {\n+        var _self = this, fired = false;\n+        var options = {\n+            params: [\n+                {name: this.id + '_year', value: date.getFullYear()},\n+                {name: this.id + '_month', value: date.getMonth()}\n+            ]", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "334d1b3a44eaaed2eeee06cbe4f15dbdc3c858a4"}, "originalPosition": 57}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d7e8544f340f4399b0a879f1c486a22496408e11", "author": {"user": {"login": "jepsar", "name": "Jasper de Vries"}}, "url": "https://github.com/primefaces/primefaces/commit/d7e8544f340f4399b0a879f1c486a22496408e11", "committedDate": "2020-10-17T13:04:37Z", "message": "Added update on viewChange handler"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwOTg1OTU0", "url": "https://github.com/primefaces/primefaces/pull/6417#pullrequestreview-510985954", "createdAt": "2020-10-17T13:29:00Z", "commit": {"oid": "d7e8544f340f4399b0a879f1c486a22496408e11"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xN1QxMzoyOTowMFrOHjdXuQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xN1QxMzoyOTowMFrOHjdXuQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjk0MzQxNw==", "bodyText": "Not sure if you need to add process too?", "url": "https://github.com/primefaces/primefaces/pull/6417#discussion_r506943417", "createdAt": "2020-10-17T13:29:00Z", "author": {"login": "melloware"}, "path": "src/main/resources/META-INF/resources/primefaces/datepicker/1-datepicker.js", "diffHunk": "@@ -318,6 +318,7 @@ PrimeFaces.widget.DatePicker = PrimeFaces.widget.BaseWidget.extend({\n             var viewChangeBehavior = this.cfg.behaviors['viewChange'];\n \n             if(viewChangeBehavior) {\n+                options.update = (options.update||'') +' '+ this.id;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d7e8544f340f4399b0a879f1c486a22496408e11"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "797f878c89dfc0d7be534e0747ca97a4f35968a0", "author": {"user": {"login": "jepsar", "name": "Jasper de Vries"}}, "url": "https://github.com/primefaces/primefaces/commit/797f878c89dfc0d7be534e0747ca97a4f35968a0", "committedDate": "2020-10-17T16:56:34Z", "message": "Improved viewChange handler"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExMDAwNTcx", "url": "https://github.com/primefaces/primefaces/pull/6417#pullrequestreview-511000571", "createdAt": "2020-10-17T17:08:45Z", "commit": {"oid": "797f878c89dfc0d7be534e0747ca97a4f35968a0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xN1QxNzowODo0NVrOHjelug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xN1QxNzowODo0NVrOHjelug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjk2MzM4Ng==", "bodyText": "Please add spaces before/after || and +", "url": "https://github.com/primefaces/primefaces/pull/6417#discussion_r506963386", "createdAt": "2020-10-17T17:08:45Z", "author": {"login": "tandraschko"}, "path": "src/main/resources/META-INF/resources/primefaces/datepicker/1-datepicker.js", "diffHunk": "@@ -278,63 +278,55 @@ PrimeFaces.widget.DatePicker = PrimeFaces.widget.BaseWidget.extend({\n         var _self = this;\n         this.cfg.onViewDateChange = function(event, date) {\n             _self.viewDateOption = date;\n-\n-            if(_self.hasBehavior('viewChange')) {\n-                _self.fireViewChangeEvent(date.getFullYear(), date.getMonth());\n-            }\n-            if (_self.cfg.lazyModel) {\n-                var options = {\n-                    source: _self.id,\n-                    process: _self.id,\n-                    update: _self.id,\n-                    formId: _self.cfg.formId,\n-                    params: [\n-                        {name: _self.id + '_year', value: date.getFullYear()},\n-                        {name: _self.id + '_month', value: date.getMonth()}\n-                    ],\n-                    onsuccess: function(responseXML, status, xhr) {\n-                        PrimeFaces.ajax.Response.handle(responseXML, status, xhr, {\n-                            widget: _self,\n-                            handle: function(content) {\n-                                var dateMetadata = JSON.parse(content).dateMetadata;\n-                                var disabledDates = [];\n-                                for (date in dateMetadata) {\n-                                    if (dateMetadata[date].disabled) {\n-                                        disabledDates.push(date);\n-                                    }\n-                                }\n-                                _self.setDisabledDates(disabledDates);\n-                            }\n-                        });\n-\n-                        return true;\n-                    }\n-                };\n-                PrimeFaces.ajax.Request.handle(options);\n-            }\n+            _self.fireViewChangeEvent(date);\n         };\n     },\n \n     /**\n      * Triggers the event for when the date picker changed to a different month or year page.\n      * @private\n-     * @param {number} year The year to which the date picker changed.\n-     * @param {number} month The year to which the date picker changed, starting with `0` for `Janurary`.\n+     * @param {Date} date The date to which the date picker changed.\n      */\n-    fireViewChangeEvent: function(year, month) {\n-        if(this.cfg.behaviors) {\n-            var viewChangeBehavior = this.cfg.behaviors['viewChange'];\n-\n-            if(viewChangeBehavior) {\n-                var ext = {\n-                        params: [\n-                            {name: this.id + '_month', value: month},\n-                            {name: this.id + '_year', value: year}\n-                        ]\n-                };\n+    fireViewChangeEvent: function(date) {\n+        var _self = this;\n+        var lazy = this.cfg.lazyModel;\n+        var options = {\n+            params: [\n+                {name: this.id + '_year', value: date.getFullYear()},\n+                {name: this.id + '_month', value: date.getMonth()}\n+            ]\n+        }\n+        if (lazy) {\n+            options.onsuccess = function(responseXML, status, xhr) {\n+                PrimeFaces.ajax.Response.handle(responseXML, status, xhr, {\n+                    widget: _self,\n+                    handle: function(content) {\n+                        var dateMetadata = JSON.parse(content).dateMetadata;\n+                        var disabledDates = [];\n+                        for (date in dateMetadata) {\n+                            if (dateMetadata[date].disabled) {\n+                                disabledDates.push(date);\n+                            }\n+                        }\n+                        _self.setDisabledDates(disabledDates);\n+                    }\n+                });\n+                return true;\n+            };\n+        }\n \n-                viewChangeBehavior.call(this, ext);\n+        if (this.hasBehavior('viewChange')) {\n+            if (lazy) {\n+                options.update = (options.update||'') +' '+ this.id;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "797f878c89dfc0d7be534e0747ca97a4f35968a0"}, "originalPosition": 91}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExMDAwNjU5", "url": "https://github.com/primefaces/primefaces/pull/6417#pullrequestreview-511000659", "createdAt": "2020-10-17T17:09:59Z", "commit": {"oid": "797f878c89dfc0d7be534e0747ca97a4f35968a0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xN1QxNzoxMDowMFrOHjemMg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xN1QxNzoxMDowMFrOHjemMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjk2MzUwNg==", "bodyText": "isRequestSource && eventName == viewChange && lazy=true\nthen you also dont need to the _year+_month null check next", "url": "https://github.com/primefaces/primefaces/pull/6417#discussion_r506963506", "createdAt": "2020-10-17T17:10:00Z", "author": {"login": "tandraschko"}, "path": "src/main/java/org/primefaces/component/datepicker/DatePickerRenderer.java", "diffHunk": "@@ -41,21 +41,25 @@\n import org.primefaces.component.calendar.BaseCalendarRenderer;\n import org.primefaces.expression.SearchExpressionFacade;\n import org.primefaces.expression.SearchExpressionUtils;\n+import org.primefaces.model.datepicker.DateMetadata;\n+import org.primefaces.model.datepicker.DateMetadataModel;\n import org.primefaces.model.datepicker.LazyDateMetadataModel;\n import org.primefaces.util.CalendarUtils;\n import org.primefaces.util.ComponentUtils;\n import org.primefaces.util.WidgetBuilder;\n-import org.primefaces.model.datepicker.DateMetadata;\n-import org.primefaces.model.datepicker.DateMetadataModel;\n \n public class DatePickerRenderer extends BaseCalendarRenderer {\n \n     @Override\n     public void encodeEnd(FacesContext context, UIComponent component) throws IOException {\n         DatePicker datePicker = (DatePicker) component;\n \n-        if (context.getExternalContext().getRequestParameterMap().containsKey(datePicker.getClientId(context))) {\n-            encodeDateMetadata(context, datePicker);\n+        if (ComponentUtils.isRequestSource(datePicker, context)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "797f878c89dfc0d7be534e0747ca97a4f35968a0"}, "originalPosition": 21}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "650a8b2688e9c4d5de50eaffc22c3c99944656c4", "author": {"user": {"login": "jepsar", "name": "Jasper de Vries"}}, "url": "https://github.com/primefaces/primefaces/commit/650a8b2688e9c4d5de50eaffc22c3c99944656c4", "committedDate": "2020-10-17T17:33:32Z", "message": "Remarks Thomas"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "51ffaa871d6971f05dbdf0ced721567afe481720", "author": {"user": {"login": "jepsar", "name": "Jasper de Vries"}}, "url": "https://github.com/primefaces/primefaces/commit/51ffaa871d6971f05dbdf0ced721567afe481720", "committedDate": "2020-10-17T17:42:51Z", "message": "Performance"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2d97e8096eea26c7306815d4777acb8b0b7e4674", "author": {"user": {"login": "jepsar", "name": "Jasper de Vries"}}, "url": "https://github.com/primefaces/primefaces/commit/2d97e8096eea26c7306815d4777acb8b0b7e4674", "committedDate": "2020-10-17T17:54:51Z", "message": "Only encode metadata for lazy model"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa3bd78da5e356abe55fa85e44e06f10bf238edb", "author": {"user": {"login": "jepsar", "name": "Jasper de Vries"}}, "url": "https://github.com/primefaces/primefaces/commit/aa3bd78da5e356abe55fa85e44e06f10bf238edb", "committedDate": "2020-10-17T21:01:54Z", "message": "super.encodeEnd for other events"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2810, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}