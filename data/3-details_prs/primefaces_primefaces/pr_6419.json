{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA1MzUxMzI5", "number": 6419, "title": "#6418: SelectOneMenu: performance-optimization", "bodyText": "optimizing SelectOneMenuRenderer#encodeSelectItems especially helps for dynamic=\"true\"\nOnly doing encodeHiddenSelect on server and move encodePanelContent to the client results in way smaller HTML we need to send from server to client. And on client we have less DOM until the users enters SelectOneMenu.", "createdAt": "2020-10-17T21:42:34Z", "url": "https://github.com/primefaces/primefaces/pull/6419", "merged": true, "mergeCommit": {"oid": "c12701ac5f2c5170ffc5de989ceec789199dcdfe"}, "closed": true, "closedAt": "2020-10-20T17:30:05Z", "author": {"login": "christophs78"}, "timelineItems": {"totalCount": 23, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdTgEyJgH2gAyNTA1MzUxMzI5OjRiYTFmNWJjZTc4NTlmYTgxZGFkOGMwMzZhYTE2YzIyOGQxMTQwMWE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdUcO3bAFqTUxMjk3MTU3Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4ba1f5bce7859fa81dad8c036aa16c228d11401a", "author": {"user": {"login": "christophs78", "name": "Christoph Stra\u00dfer"}}, "url": "https://github.com/primefaces/primefaces/commit/4ba1f5bce7859fa81dad8c036aa16c228d11401a", "committedDate": "2020-10-17T19:23:59Z", "message": "#6418: SelectOneMenu: performance-optimization"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "36024f2842bd0a6418015c4106ffc90d70fbb42d", "author": {"user": {"login": "christophs78", "name": "Christoph Stra\u00dfer"}}, "url": "https://github.com/primefaces/primefaces/commit/36024f2842bd0a6418015c4106ffc90d70fbb42d", "committedDate": "2020-10-17T20:25:08Z", "message": "#6418: SelectOneMenu: performance-optimization"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7a41b061cf6c4efe1b82f24647ac789bd5b9c78b", "author": {"user": {"login": "christophs78", "name": "Christoph Stra\u00dfer"}}, "url": "https://github.com/primefaces/primefaces/commit/7a41b061cf6c4efe1b82f24647ac789bd5b9c78b", "committedDate": "2020-10-17T21:35:02Z", "message": "#6418: SelectOneMenu: performance-optimization\n\nclient-side PanelContent (WIP)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "15d1046d439ed2d1ac0df8da49dd209d8668fbac", "author": {"user": {"login": "christophs78", "name": "Christoph Stra\u00dfer"}}, "url": "https://github.com/primefaces/primefaces/commit/15d1046d439ed2d1ac0df8da49dd209d8668fbac", "committedDate": "2020-10-17T21:45:19Z", "message": "#6418: SelectOneMenu: JsDoc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "843d594ee13a93bf8091fefa41f66e0db31ce2e6", "author": {"user": {"login": "christophs78", "name": "Christoph Stra\u00dfer"}}, "url": "https://github.com/primefaces/primefaces/commit/843d594ee13a93bf8091fefa41f66e0db31ce2e6", "committedDate": "2020-10-17T21:52:24Z", "message": "#6418: SelectOneMenu: add TODOs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0fba6715dc86a5d007832fea10a20f5cb4a6986f", "author": {"user": {"login": "christophs78", "name": "Christoph Stra\u00dfer"}}, "url": "https://github.com/primefaces/primefaces/commit/0fba6715dc86a5d007832fea10a20f5cb4a6986f", "committedDate": "2020-10-17T22:12:31Z", "message": "#6418: SelectOneMenu: performance-optimization\n\ngood night :-)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f3f014aea3b25a0f54aa558db6eaa9de7720e0d2", "author": {"user": {"login": "christophs78", "name": "Christoph Stra\u00dfer"}}, "url": "https://github.com/primefaces/primefaces/commit/f3f014aea3b25a0f54aa558db6eaa9de7720e0d2", "committedDate": "2020-10-18T09:15:09Z", "message": "#6418: SelectOneMenu: SelectItemGroup & Refactoring"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3fc8cfe79e00ffb72f97881633965eec3f0a7566", "author": {"user": {"login": "christophs78", "name": "Christoph Stra\u00dfer"}}, "url": "https://github.com/primefaces/primefaces/commit/3fc8cfe79e00ffb72f97881633965eec3f0a7566", "committedDate": "2020-10-18T09:18:14Z", "message": "#6418: SelectOneMenu: JsDoc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fca25bfae91bd81e5187982eca379a4e5f895f9a", "author": {"user": {"login": "christophs78", "name": "Christoph Stra\u00dfer"}}, "url": "https://github.com/primefaces/primefaces/commit/fca25bfae91bd81e5187982eca379a4e5f895f9a", "committedDate": "2020-10-18T12:31:18Z", "message": "#6418: SelectOneMenu: Refactoring, disabled, label, escape"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0be57ff4b39be738312e5d2c8217900860865178", "author": {"user": {"login": "christophs78", "name": "Christoph Stra\u00dfer"}}, "url": "https://github.com/primefaces/primefaces/commit/0be57ff4b39be738312e5d2c8217900860865178", "committedDate": "2020-10-18T12:34:52Z", "message": "#6418: SelectOneMenu: JsDoc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "51d39fea320467362d179d07226f9afe22436300", "author": {"user": {"login": "christophs78", "name": "Christoph Stra\u00dfer"}}, "url": "https://github.com/primefaces/primefaces/commit/51d39fea320467362d179d07226f9afe22436300", "committedDate": "2020-10-18T12:37:47Z", "message": "#6418: SelectOneMenu: JsDoc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1cebb3cf7e87513ae984ac82ff97567c3db4667a", "author": {"user": {"login": "christophs78", "name": "Christoph Stra\u00dfer"}}, "url": "https://github.com/primefaces/primefaces/commit/1cebb3cf7e87513ae984ac82ff97567c3db4667a", "committedDate": "2020-10-18T18:24:32Z", "message": "#6418: SelectOneMenu: escape"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "90b90a31e4cb0331f7181d9f614d4c86ab903c8c", "author": {"user": {"login": "christophs78", "name": "Christoph Stra\u00dfer"}}, "url": "https://github.com/primefaces/primefaces/commit/90b90a31e4cb0331f7181d9f614d4c86ab903c8c", "committedDate": "2020-10-18T18:38:34Z", "message": "#6418: SelectOneMenu: escape"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bbe1110991c5a79e74609875195f017724d36581", "author": {"user": {"login": "christophs78", "name": "Christoph Stra\u00dfer"}}, "url": "https://github.com/primefaces/primefaces/commit/bbe1110991c5a79e74609875195f017724d36581", "committedDate": "2020-10-18T18:58:39Z", "message": "#6418: SelectOneMenu: escape"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8705b9bd56e6ad1bc4eea6a2daf75c15daf0c315", "author": {"user": {"login": "christophs78", "name": "Christoph Stra\u00dfer"}}, "url": "https://github.com/primefaces/primefaces/commit/8705b9bd56e6ad1bc4eea6a2daf75c15daf0c315", "committedDate": "2020-10-19T16:41:34Z", "message": "#6418: SelectOneMenu: Refactoring"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "56cef307e532da3b9dac9cec287be5ae876b17ee", "author": {"user": {"login": "christophs78", "name": "Christoph Stra\u00dfer"}}, "url": "https://github.com/primefaces/primefaces/commit/56cef307e532da3b9dac9cec287be5ae876b17ee", "committedDate": "2020-10-19T16:44:20Z", "message": "#6418: SelectOneMenu: Cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "259b26db4cf27fb6f57b233c01695efbfda00eb0", "author": {"user": {"login": "christophs78", "name": "Christoph Stra\u00dfer"}}, "url": "https://github.com/primefaces/primefaces/commit/259b26db4cf27fb6f57b233c01695efbfda00eb0", "committedDate": "2020-10-19T17:09:27Z", "message": "#6418: SelectOneMenu: isNoSelectionOption"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b8587e4aedc6f84fca9741ddfc17d96f7c10cba9", "author": {"user": {"login": "christophs78", "name": "Christoph Stra\u00dfer"}}, "url": "https://github.com/primefaces/primefaces/commit/b8587e4aedc6f84fca9741ddfc17d96f7c10cba9", "committedDate": "2020-10-19T17:20:18Z", "message": "#6418: SelectOneMenu: escape"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEyNjE3NzU3", "url": "https://github.com/primefaces/primefaces/pull/6419#pullrequestreview-512617757", "createdAt": "2020-10-20T11:46:05Z", "commit": {"oid": "b8587e4aedc6f84fca9741ddfc17d96f7c10cba9"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxMTo0NjowNVrOHk4ShQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxMTo0NjoyNVrOHk4TJQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODQzMzAyOQ==", "bodyText": "I think its safe to get rid of these loggers and system.nanotime calls?", "url": "https://github.com/primefaces/primefaces/pull/6419#discussion_r508433029", "createdAt": "2020-10-20T11:46:05Z", "author": {"login": "melloware"}, "path": "src/main/java/org/primefaces/component/selectonemenu/SelectOneMenuRenderer.java", "diffHunk": "@@ -143,10 +152,17 @@ protected void encodeMarkup(FacesContext context, SelectOneMenu menu) throws IOE\n         }\n         renderARIACombobox(context, menu);\n \n+        long t1 = System.nanoTime();\n         encodeInput(context, menu, clientId, selectItems, values, submittedValues, converter);\n+        long t2 = System.nanoTime();\n         encodeLabel(context, menu, selectItems);\n         encodeMenuIcon(context, menu, valid);\n+        long t3 = System.nanoTime();\n         encodePanel(context, menu, selectItems);\n+        long t4 = System.nanoTime();\n+\n+        LOGGER.log(Level.INFO, \"SelectOneMenuRenderer#encodeInput \" + ((t2 - t1) / 1000000));\n+        LOGGER.log(Level.INFO, \"SelectOneMenuRenderer#encodePanel \" + ((t4 - t3) / 1000000));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b8587e4aedc6f84fca9741ddfc17d96f7c10cba9"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODQzMzE4OQ==", "bodyText": "Remove LOGGER and System.nanoTime calls?", "url": "https://github.com/primefaces/primefaces/pull/6419#discussion_r508433189", "createdAt": "2020-10-20T11:46:25Z", "author": {"login": "melloware"}, "path": "src/main/java/org/primefaces/component/selectonemenu/SelectOneMenuRenderer.java", "diffHunk": "@@ -105,8 +108,14 @@ public void encodeEnd(FacesContext context, UIComponent component) throws IOExce\n             Object values = getValues(menu);\n             Object submittedValues = getSubmittedValues(menu);\n \n+            long t1 = System.nanoTime();\n             encodeHiddenSelect(context, menu, clientId, selectItems, values, submittedValues, converter);\n+            long t2 = System.nanoTime();\n             encodePanelContent(context, menu, selectItems);\n+            long t3 = System.nanoTime();\n+\n+            LOGGER.log(Level.INFO, \"SelectOneMenuRenderer#encodeHiddenSelect \" + ((t2 - t1) / 1000000));\n+            LOGGER.log(Level.INFO, \"SelectOneMenuRenderer#encodePanelContent \" + ((t3 - t2) / 1000000));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b8587e4aedc6f84fca9741ddfc17d96f7c10cba9"}, "originalPosition": 32}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "81478852a82dc7a713cb1097831786b18af108d8", "author": {"user": {"login": "christophs78", "name": "Christoph Stra\u00dfer"}}, "url": "https://github.com/primefaces/primefaces/commit/81478852a82dc7a713cb1097831786b18af108d8", "committedDate": "2020-10-20T16:56:58Z", "message": "#6418: SelectOneMenu: Cleanup"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEyOTUyMzA1", "url": "https://github.com/primefaces/primefaces/pull/6419#pullrequestreview-512952305", "createdAt": "2020-10-20T17:05:34Z", "commit": {"oid": "81478852a82dc7a713cb1097831786b18af108d8"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxNzowNTozNFrOHlIWCw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxNzowNjowN1rOHlIXQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODY5NjA3NQ==", "bodyText": "can't you just do:\n this.cfg.renderPanelContentOnClient = this.cfg.renderPanelContentOnClient === true;", "url": "https://github.com/primefaces/primefaces/pull/6419#discussion_r508696075", "createdAt": "2020-10-20T17:05:34Z", "author": {"login": "melloware"}, "path": "src/main/resources/META-INF/resources/primefaces/forms/forms.selectonemenu.js", "diffHunk": "@@ -94,16 +95,17 @@ PrimeFaces.widget.SelectOneMenu = PrimeFaces.widget.DeferredWidget.extend({\n         this.panel = $(this.panelId);\n         this.disabled = this.jq.hasClass('ui-state-disabled');\n         this.itemsWrapper = this.panel.children('.ui-selectonemenu-items-wrapper');\n-        this.options = this.input.children('option');\n+        this.options = this.input.find('option');\n         this.cfg.effect = this.cfg.effect||'fade';\n \n         this.cfg.effectSpeed = this.cfg.effectSpeed||'normal';\n         this.cfg.autoWidth = this.cfg.autoWidth === false ? false : true;\n         this.cfg.dynamic = this.cfg.dynamic === true ? true : false;\n         this.cfg.appendTo = this.getAppendTo();\n+        this.cfg.renderPanelContentOnClient = this.cfg.renderPanelContentOnClient === true ? true : false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "81478852a82dc7a713cb1097831786b18af108d8"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODY5NjM4NQ==", "bodyText": "This is ES6 syntax is it not?  I think you will have to write it as traditional ES5 javascript.", "url": "https://github.com/primefaces/primefaces/pull/6419#discussion_r508696385", "createdAt": "2020-10-20T17:06:07Z", "author": {"login": "melloware"}, "path": "src/main/resources/META-INF/resources/primefaces/forms/forms.selectonemenu.js", "diffHunk": "@@ -1298,10 +1303,105 @@ PrimeFaces.widget.SelectOneMenu = PrimeFaces.widget.DeferredWidget.extend({\n             }, 10);\n         }\n         else {\n+            this.renderPanelContentFromHiddenSelect(true);\n+\n             handleMethod.call(this, event);\n         }\n     },\n \n+    /**\n+     * Renders panel content based on hidden select.\n+     * @param {boolean} initContentsAndBindItemEvents Call initContents and bindItemEvents after rendering?\n+     * @private\n+     */\n+    renderPanelContentFromHiddenSelect: function(initContentsAndBindItemEvents) {\n+         if (this.cfg.renderPanelContentOnClient && this.itemsWrapper.children().length === 0) {\n+             var panelContent = '<ul id=\"' + this.jqId + '_items\" class=\"ui-selectonemenu-items ui-selectonemenu-list ui-widget-content ui-widget ui-corner-all ui-helper-reset\" role=\"listbox\">';\n+             panelContent += this.renderSelectItems(this.input);\n+             panelContent += '</ul>';\n+\n+             this.itemsWrapper.append(panelContent);\n+\n+             if (initContentsAndBindItemEvents) {\n+                 this.initContents();\n+                 this.bindItemEvents();\n+             }\n+         }\n+    },\n+\n+    /**\n+     * Renders Panel-HTML-code for SelectItems.\n+     * @private\n+     * @param {JQuery} parentItem An parentItem (select, optgroup) for which to render HTML-code.\n+     * @return {string} Rendered HTML-code.\n+     */\n+    renderSelectItems: function(parentItem) {\n+        var content = \"\";\n+\n+        var opts = parentItem.children(\"option, optgroup\");\n+\n+        opts.each((i, opt) => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "81478852a82dc7a713cb1097831786b18af108d8"}, "originalPosition": 79}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c644c266b845de0763ad87f3caa8ccbeb432874c", "author": {"user": {"login": "christophs78", "name": "Christoph Stra\u00dfer"}}, "url": "https://github.com/primefaces/primefaces/commit/c644c266b845de0763ad87f3caa8ccbeb432874c", "committedDate": "2020-10-20T17:25:31Z", "message": "#6418: SelectOneMenu: Refactoring"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEyOTcxNTc2", "url": "https://github.com/primefaces/primefaces/pull/6419#pullrequestreview-512971576", "createdAt": "2020-10-20T17:29:18Z", "commit": {"oid": "c644c266b845de0763ad87f3caa8ccbeb432874c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2813, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}