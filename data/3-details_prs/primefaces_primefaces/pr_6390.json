{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk3NzExNDcw", "number": 6390, "title": "Fix #5438 - DataTable: cleanup sorting", "bodyText": "Remove:\n\nDataTable#sortMeta (replaced by DataTable#sortBy)\nDataTable#sortField (replaced by UIColumn#field)\nDataTable#sortOrder (replaced by UIColumn#sortOrder)\nDataTable#sortFunction (replaced by UIColumn#sortFunction)\nDataTable#expandableRowGroups (replaced by HeaderRow#expandable)\nDataTable#nullSortOrder (replaced by UIColumn#nullSortOrder)\nDataTable#caseSensitiveSort (replaced by UIColumn#caseSensitiveSort)\n\nUpdate\n\nDataTable#sortMode: default value \"multiple\"\nDataTable#allowUnsorting\" default value \"false\"\nDataTable#sortBy: expects a single or a collection of SortMeta (default sorting can either be configured through markup or programmatically)\n\nAdd\n\nColumn#sortPriority: defines in which order columns sorter should apply initially\nColumn#sortOrder\nColumn#nullSortOrder\nColumn#caseSensitiveSort\n#6372\n\nBreaking changes\n\nDataTable#sortBy: no longer expect a Map, but a single or a collection of SortMeta (use SortMeta#builder) UIColumn#field or UIColumn#sortBy must be set to enable default sorting.\nAs it is possible from now on to configure default sorted columns on a single sort mode datatable. Users will be expected to implement only one method LazyDataModel#load(int first, int pageSize, Map<String, SortMeta> sortBy, Map<String, FilterMeta> filterBy)", "createdAt": "2020-10-05T09:15:02Z", "url": "https://github.com/primefaces/primefaces/pull/6390", "merged": true, "mergeCommit": {"oid": "99a3fdd74cb9cbe845c5fe9da11a892f0f6a7486"}, "closed": true, "closedAt": "2020-11-06T15:18:20Z", "author": {"login": "Rapster"}, "timelineItems": {"totalCount": 33, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdQhamsgFqTUwNDc2MzM2Ng==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdY8XwOAH2gAyNDk3NzExNDcwOjcwMjkyMWFmMWFhZTJkZDBjODFkZDBmN2EyZjZkNGZlNzQ5MGE5NmI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA0NzYzMzY2", "url": "https://github.com/primefaces/primefaces/pull/6390#pullrequestreview-504763366", "createdAt": "2020-10-08T13:09:14Z", "commit": {"oid": "b025401fc9dcc808ce29f92630fdc69de11cf6a1"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQxMzowOToxNFrOHeduFw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQxMzowOToxNFrOHeduFw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTcwNjI2Mw==", "bodyText": "Not sure why it imported List when java.util.* was above it?", "url": "https://github.com/primefaces/primefaces/pull/6390#discussion_r501706263", "createdAt": "2020-10-08T13:09:14Z", "author": {"login": "melloware"}, "path": "src/main/java/org/primefaces/component/datatable/DataTable.java", "diffHunk": "@@ -25,11 +25,13 @@\n \n import java.lang.reflect.Array;\n import java.util.*;\n+import java.util.List;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b025401fc9dcc808ce29f92630fdc69de11cf6a1"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1MDY3MTY1", "url": "https://github.com/primefaces/primefaces/pull/6390#pullrequestreview-505067165", "createdAt": "2020-10-08T18:43:55Z", "commit": {"oid": "041a7744191e9d12bd1731d8f761f25f71c1e4de"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2MDkxMjIw", "url": "https://github.com/primefaces/primefaces/pull/6390#pullrequestreview-506091220", "createdAt": "2020-10-10T11:41:01Z", "commit": {"oid": "3795097f43ec2fb898790c7bb37183e10b865968"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMFQxMTo0MTowMlrOHffWMA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMFQxMTo0MTowMlrOHffWMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjc4MTQ4OA==", "bodyText": "Would it be theoretically possible to add there some kind of backward-compatibility? (Convert PF<=8  sortBy into SortMeta and write warning to log.)\nI don\u00b4t want to say this is a good idea. Just thinking about it.", "url": "https://github.com/primefaces/primefaces/pull/6390#discussion_r502781488", "createdAt": "2020-10-10T11:41:02Z", "author": {"login": "christophs78"}, "path": "src/main/java/org/primefaces/component/datatable/DataTable.java", "diffHunk": "@@ -1547,50 +1411,134 @@ public void resetMultiViewState() {\n     }\n \n     public String getGroupedColumnIndexes() {\n-        List<UIColumn> columns = getColumns();\n-        int size = columns.size();\n-        boolean hasIndex = false;\n-        if (size > 0) {\n-            StringBuilder sb = new StringBuilder();\n-            sb.append(\"[\");\n-            for (int i = 0; i < size; i++) {\n-                UIColumn column = columns.get(i);\n-                if (column.isGroupRow()) {\n-                    if (hasIndex) {\n-                        sb.append(\",\");\n-                    }\n+        return IntStream.range(0, columns.size())\n+                .filter(i -> columns.get(i).isGroupRow())\n+                .mapToObj(Objects::toString)\n+                .collect(Collectors.joining(\",\", \"[\", \"]\"));\n+    }\n \n-                    sb.append(i);\n-                    hasIndex = true;\n-                }\n+    public String getSortMetaAsString() {\n+        return getSortByAsMap().keySet().stream()\n+                .collect(Collectors.joining(\"','\", \"['\", \"']\"));\n+    }\n+\n+    public static ValueExpression createValueExprFromVarField(FacesContext context, String var, String field) {\n+        if (LangUtils.isValueBlank(var) || LangUtils.isValueBlank(field)) {\n+            throw new FacesException(\"var and field must be non null\");\n+        }\n+\n+        return context.getApplication().getExpressionFactory()\n+                .createValueExpression(context.getELContext(), \"#{\" + var + \".\" + field + \"}\", String.class);\n+    }\n+\n+    protected Map<String, SortMeta> initSortBy(Object sortByTmp) {\n+        Map<String, SortMeta> sortMeta = new HashMap<>();\n+        boolean sorted = false;\n+\n+        HeaderRow headerRow = getHeaderRow();\n+        if (headerRow != null) {\n+            SortMeta s = SortMeta.of(getFacesContext(), getVar(), headerRow);\n+            sortMeta.put(s.getColumnKey(), s);\n+            sorted = true;\n+        }\n+\n+        for (UIColumn column : getColumns()) {\n+            if (column instanceof DynamicColumn) {\n+                ((DynamicColumn) column).applyStatelessModel();\n+            }\n+\n+            if (!column.isSortable()) {\n+                continue;\n+            }\n+\n+            SortMeta s = SortMeta.of(getFacesContext(), getVar(), column);\n+            if (s == null) {\n+                continue;\n             }\n-            sb.append(\"]\");\n \n-            return sb.toString();\n+            sortMeta.put(s.getColumnKey(), s);\n+            sorted |= s.isActive();\n         }\n-        return null;\n+\n+        setDefaultSort(sorted);\n+\n+        // merge internal sortBy with user sortBy\n+        if (sortByTmp != null) {\n+            Collection<SortMeta> sortBy;\n+            if (sortByTmp instanceof SortMeta) {\n+                sortBy = Collections.singletonList((SortMeta) sortByTmp);\n+            }\n+            else if (!(sortByTmp instanceof Collection)) {\n+                throw new FacesException(\"DataTable#sortBy expects a single or a collection of SortMeta\");\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3795097f43ec2fb898790c7bb37183e10b865968"}, "originalPosition": 390}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "01e0ff5f04ec06e9e5195626575a0e9c592f6e2b", "author": {"user": {"login": "Rapster", "name": "S\u00e9bastien Lepage"}}, "url": "https://github.com/primefaces/primefaces/commit/01e0ff5f04ec06e9e5195626575a0e9c592f6e2b", "committedDate": "2020-10-31T15:46:12Z", "message": "New fix version of 5438"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6e8b5aa9c1d82be4c08c8a814ad7c68613db53dd", "author": {"user": {"login": "Rapster", "name": "S\u00e9bastien Lepage"}}, "url": "https://github.com/primefaces/primefaces/commit/6e8b5aa9c1d82be4c08c8a814ad7c68613db53dd", "committedDate": "2020-10-31T15:46:15Z", "message": "cosmetics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce1d4907649e626ee88ef0f4bae98cdbe89e7434", "author": {"user": {"login": "Rapster", "name": "S\u00e9bastien Lepage"}}, "url": "https://github.com/primefaces/primefaces/commit/ce1d4907649e626ee88ef0f4bae98cdbe89e7434", "committedDate": "2020-10-31T15:46:17Z", "message": "cosmetics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "729d0447e8e86285c20d921edef1c7440b7056e7", "author": {"user": {"login": "Rapster", "name": "S\u00e9bastien Lepage"}}, "url": "https://github.com/primefaces/primefaces/commit/729d0447e8e86285c20d921edef1c7440b7056e7", "committedDate": "2020-10-31T15:46:18Z", "message": "cosmetics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4000862da52bafa23f570ddd859eb2a7b7e0a7c4", "author": {"user": {"login": "Rapster", "name": "S\u00e9bastien Lepage"}}, "url": "https://github.com/primefaces/primefaces/commit/4000862da52bafa23f570ddd859eb2a7b7e0a7c4", "committedDate": "2020-10-31T15:46:22Z", "message": "reintroducing sorty"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fe58dacc9d287dcd0972de7390e26a52bae82163", "author": {"user": {"login": "Rapster", "name": "S\u00e9bastien Lepage"}}, "url": "https://github.com/primefaces/primefaces/commit/fe58dacc9d287dcd0972de7390e26a52bae82163", "committedDate": "2020-10-31T15:46:24Z", "message": "renaming stuff"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b5b9ba9942b45d3d283ed0f71bd293f5d3a860b1", "author": {"user": {"login": "Rapster", "name": "S\u00e9bastien Lepage"}}, "url": "https://github.com/primefaces/primefaces/commit/b5b9ba9942b45d3d283ed0f71bd293f5d3a860b1", "committedDate": "2020-10-31T15:46:25Z", "message": "cosmetics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bb1386d1bd35b73d78dad932dbc18d1c49056335", "author": {"user": {"login": "Rapster", "name": "S\u00e9bastien Lepage"}}, "url": "https://github.com/primefaces/primefaces/commit/bb1386d1bd35b73d78dad932dbc18d1c49056335", "committedDate": "2020-10-31T15:46:27Z", "message": "clean up"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5a7cb01ee11cbe7f787210168d828241e27b68bf", "author": {"user": {"login": "Rapster", "name": "S\u00e9bastien Lepage"}}, "url": "https://github.com/primefaces/primefaces/commit/5a7cb01ee11cbe7f787210168d828241e27b68bf", "committedDate": "2020-10-31T15:46:29Z", "message": "cosmetics & perf"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5525736d8b617ca4a2243c236e1e14e481c83f5b", "author": {"user": {"login": "Rapster", "name": "S\u00e9bastien Lepage"}}, "url": "https://github.com/primefaces/primefaces/commit/5525736d8b617ca4a2243c236e1e14e481c83f5b", "committedDate": "2020-10-31T15:46:30Z", "message": "cosmetics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4fefaa5587c4db703ad5282a7d66a6acec979732", "author": {"user": {"login": "Rapster", "name": "S\u00e9bastien Lepage"}}, "url": "https://github.com/primefaces/primefaces/commit/4fefaa5587c4db703ad5282a7d66a6acec979732", "committedDate": "2020-10-31T15:46:32Z", "message": "cosmetics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fcf88f6a7c6619d6ddc33ce28cfce0ee22748340", "author": {"user": {"login": "Rapster", "name": "S\u00e9bastien Lepage"}}, "url": "https://github.com/primefaces/primefaces/commit/fcf88f6a7c6619d6ddc33ce28cfce0ee22748340", "committedDate": "2020-10-31T15:46:33Z", "message": "cosmetics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "142fd56b908113edd1fc6f2344aeace54e7b366e", "author": {"user": {"login": "Rapster", "name": "S\u00e9bastien Lepage"}}, "url": "https://github.com/primefaces/primefaces/commit/142fd56b908113edd1fc6f2344aeace54e7b366e", "committedDate": "2020-10-31T15:46:34Z", "message": "cosmetics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a3dc717d19b7696a08c928769cc1dd04269dbba4", "author": {"user": {"login": "Rapster", "name": "S\u00e9bastien Lepage"}}, "url": "https://github.com/primefaces/primefaces/commit/a3dc717d19b7696a08c928769cc1dd04269dbba4", "committedDate": "2020-10-31T15:46:35Z", "message": "typo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0972e988b8ed5e930e879661155a847023c17219", "author": {"user": {"login": "Rapster", "name": "S\u00e9bastien Lepage"}}, "url": "https://github.com/primefaces/primefaces/commit/0972e988b8ed5e930e879661155a847023c17219", "committedDate": "2020-10-31T15:46:37Z", "message": "cosmetics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a711221d6813e31a42748ba35daffb428130992d", "author": {"user": {"login": "Rapster", "name": "S\u00e9bastien Lepage"}}, "url": "https://github.com/primefaces/primefaces/commit/a711221d6813e31a42748ba35daffb428130992d", "committedDate": "2020-10-31T15:46:38Z", "message": "cosmetics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dc422824cfc57ce48b70c7522c3c1fe6ca25a2f5", "author": {"user": {"login": "Rapster", "name": "S\u00e9bastien Lepage"}}, "url": "https://github.com/primefaces/primefaces/commit/dc422824cfc57ce48b70c7522c3c1fe6ca25a2f5", "committedDate": "2020-10-31T15:46:40Z", "message": "Fix #3347 - DataTable: Pass nulls to the sortFunction or make the nullSortOrder column-specific"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a6adee961f03fc6062966b85099e223aee613327", "author": {"user": {"login": "Rapster", "name": "S\u00e9bastien Lepage"}}, "url": "https://github.com/primefaces/primefaces/commit/a6adee961f03fc6062966b85099e223aee613327", "committedDate": "2020-10-31T15:46:41Z", "message": "fix test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb96b121436f66bcac900ca476f44a07fb8e96c1", "author": {"user": {"login": "Rapster", "name": "S\u00e9bastien Lepage"}}, "url": "https://github.com/primefaces/primefaces/commit/fb96b121436f66bcac900ca476f44a07fb8e96c1", "committedDate": "2020-10-31T15:46:42Z", "message": "update taglib"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0c19b870949a2735f47f91c2da0827d1e1ade3fb", "author": {"user": {"login": "Rapster", "name": "S\u00e9bastien Lepage"}}, "url": "https://github.com/primefaces/primefaces/commit/0c19b870949a2735f47f91c2da0827d1e1ade3fb", "committedDate": "2020-10-31T15:46:43Z", "message": "cosmetics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4d898cc926f77867a851da17802937dbfe723304", "author": {"user": {"login": "Rapster", "name": "S\u00e9bastien Lepage"}}, "url": "https://github.com/primefaces/primefaces/commit/4d898cc926f77867a851da17802937dbfe723304", "committedDate": "2020-10-31T15:46:44Z", "message": "cosmetics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ee640c427f9c048227d55da2c6dc89348e25cab1", "author": {"user": {"login": "Rapster", "name": "S\u00e9bastien Lepage"}}, "url": "https://github.com/primefaces/primefaces/commit/ee640c427f9c048227d55da2c6dc89348e25cab1", "committedDate": "2020-10-31T15:46:45Z", "message": "update taglib"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9a59584f9cb548f59243e2883dc0c647093146c2", "author": {"user": {"login": "Rapster", "name": "S\u00e9bastien Lepage"}}, "url": "https://github.com/primefaces/primefaces/commit/9a59584f9cb548f59243e2883dc0c647093146c2", "committedDate": "2020-10-31T15:46:47Z", "message": "Move DataTable#caseSensitiveSort to UIColumn"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5263491bcbb4c77f18eb400407368941d77fde91", "author": {"user": {"login": "Rapster", "name": "S\u00e9bastien Lepage"}}, "url": "https://github.com/primefaces/primefaces/commit/5263491bcbb4c77f18eb400407368941d77fde91", "committedDate": "2020-10-31T15:46:49Z", "message": "update taglib"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a01cfdf40790c35f9d3a2003c6a675b344c344ea", "author": {"user": {"login": "Rapster", "name": "S\u00e9bastien Lepage"}}, "url": "https://github.com/primefaces/primefaces/commit/a01cfdf40790c35f9d3a2003c6a675b344c344ea", "committedDate": "2020-10-31T15:46:51Z", "message": "docs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c7b64e83973963ba365140af6a599bef2b42bf35", "author": {"user": {"login": "Rapster", "name": "S\u00e9bastien Lepage"}}, "url": "https://github.com/primefaces/primefaces/commit/c7b64e83973963ba365140af6a599bef2b42bf35", "committedDate": "2020-10-31T17:41:31Z", "message": "docs"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "01bab98c72807e310b6f6fa52555c3d6d4483aa1", "author": {"user": {"login": "Rapster", "name": "S\u00e9bastien Lepage"}}, "url": "https://github.com/primefaces/primefaces/commit/01bab98c72807e310b6f6fa52555c3d6d4483aa1", "committedDate": "2020-10-31T15:28:06Z", "message": "docs"}, "afterCommit": {"oid": "c7b64e83973963ba365140af6a599bef2b42bf35", "author": {"user": {"login": "Rapster", "name": "S\u00e9bastien Lepage"}}, "url": "https://github.com/primefaces/primefaces/commit/c7b64e83973963ba365140af6a599bef2b42bf35", "committedDate": "2020-10-31T17:41:31Z", "message": "docs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1cdad1647e1840ed2d33941836263356cd896082", "author": {"user": {"login": "Rapster", "name": "S\u00e9bastien Lepage"}}, "url": "https://github.com/primefaces/primefaces/commit/1cdad1647e1840ed2d33941836263356cd896082", "committedDate": "2020-10-31T18:59:23Z", "message": "fix typo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7ccf1c32950ee51735a8bc6f30a6413abf12ede4", "author": {"user": {"login": "Rapster", "name": "S\u00e9bastien Lepage"}}, "url": "https://github.com/primefaces/primefaces/commit/7ccf1c32950ee51735a8bc6f30a6413abf12ede4", "committedDate": "2020-11-02T00:16:36Z", "message": "Update DataTableHandler.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "702921af1aae2dd0c81dd0f7a2f6d4fe7490a96b", "author": {"user": {"login": "Rapster", "name": "S\u00e9bastien Lepage"}}, "url": "https://github.com/primefaces/primefaces/commit/702921af1aae2dd0c81dd0f7a2f6d4fe7490a96b", "committedDate": "2020-11-03T17:11:40Z", "message": "docs"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2800, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}