{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkxNTU2MTI5", "number": 5715, "title": "Fix #5713: DatePicker Add showWeek and weekCalculator", "bodyText": "Changes as of 2020-03-23:\n\nonly a single default implementation is used for all possible start of week (options.locale.firstDay / options.locale.firstDayOfWeek)\nadditionally this implementation is based on the locale option firstDayWeekOffset which will be guessed based on start of week if not provided.\nit will fix #1052\n\n\nweekCalculator internally defaults to one of three different implemetation.\n\nstart of week = monday: calculateWeekNumber_iso8601 (like the jQuery based calendar)\nstart of week = sunday: calculateWeekNumber_sundayFirst\nstart of week = saturday: calculateWeekNumber_saturdayFirst\n\njQuery based calendar calculated wrong week numbers for sow=sunday|saturday", "createdAt": "2020-03-20T14:16:55Z", "url": "https://github.com/primefaces/primefaces/pull/5715", "merged": true, "mergeCommit": {"oid": "57209f522e4162bf19f9760cf2b9d50b4ded1e41"}, "closed": true, "closedAt": "2020-05-29T16:33:43Z", "author": {"login": "fanste"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcPhYrTAFqTM3ODUyOTU1Nw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcQiaMNgFqTM3OTY5NTc4MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4NTI5NTU3", "url": "https://github.com/primefaces/primefaces/pull/5715#pullrequestreview-378529557", "createdAt": "2020-03-20T14:26:56Z", "commit": null, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQxNDoyNjo1N1rOF5V6qA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQxNDoyODozNlrOF5V_IA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTY3MjIzMg==", "bodyText": "Brace indent issue. on line 118", "url": "https://github.com/primefaces/primefaces/pull/5715#discussion_r395672232", "createdAt": "2020-03-20T14:26:57Z", "author": {"login": "melloware"}, "path": "src/main/resources/META-INF/resources/primefaces/datepicker/0-datepicker.js", "diffHunk": "@@ -109,6 +111,22 @@\n                 $.extend(this.options.locale, this.options.userLocale);\n             }\n \n+            if(this.options.showWeek && !this.options.weekCalculator) {\n+                var sundayIndex = this.getSundayIndex();\n+                if(sundayIndex == 0) {\n+                    this.options.weekCalculator = this.calculateWeekNumber_sundayFirst;\n+            \t}\n+                else if(sundayIndex == 1) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTY3MzM3Ng==", "bodyText": "Feel like there has to be a way to refactor the above 3 methods as there is a lot of duplicate code expecially around yearStart and WeekNo.", "url": "https://github.com/primefaces/primefaces/pull/5715#discussion_r395673376", "createdAt": "2020-03-20T14:28:36Z", "author": {"login": "melloware"}, "path": "src/main/resources/META-INF/resources/primefaces/datepicker/0-datepicker.js", "diffHunk": "@@ -1292,9 +1319,42 @@\n             return dayNamesHtml;\n         },\n \n+        calculateWeekNumber_iso8601: function(d) {\n+        \td = new Date(Date.UTC(d.year, d.month, d.day));\n+            d.setUTCDate(d.getUTCDate() + 4 - (d.getUTCDay()||7));\n+            var yearStart = new Date(Date.UTC(d.getUTCFullYear(),0,1));\n+            var weekNo = Math.ceil(( ( (d - yearStart) / 86400000) + 1)/7);\n+            return weekNo;\n+        },\n+\n+        calculateWeekNumber_sundayFirst: function (d) {\n+            d = new Date(Date.UTC(d.year, d.month, d.day));\n+            d.setUTCDate(d.getUTCDate() + 3 - d.getUTCDay());\n+            var yearStart = new Date(Date.UTC(d.getUTCFullYear(),0,1));\n+            var weekNo = Math.ceil(( ( (d - yearStart) / 86400000) + 1)/7);\n+            return weekNo;\n+        },\n+\n+        calculateWeekNumber_saturdayFirst: function (d) {\n+        \td = new Date(Date.UTC(d.year, d.month, d.day));\n+            d.setUTCDate(d.getUTCDate() - ((d.getUTCDay() + 6) % 7));\n+            var yearStart = new Date(Date.UTC(d.getUTCFullYear(),0,1));\n+            var weekNo = Math.ceil(( ( (d - yearStart) / 86400000) + 1)/7);\n+            return weekNo;\n+        },\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 75}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c0411b22d4d21144257c5cffa7d7f556fd4bfdd", "author": {"user": {"login": "fanste", "name": null}}, "url": "https://github.com/primefaces/primefaces/commit/5c0411b22d4d21144257c5cffa7d7f556fd4bfdd", "committedDate": "2020-03-20T14:33:54Z", "message": "Fix primefaces#5713: Add showWeek and weekCalculator"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e9ff082a203fb9752c372f574af041e9297aee2d", "author": {"user": {"login": "fanste", "name": null}}, "url": "https://github.com/primefaces/primefaces/commit/e9ff082a203fb9752c372f574af041e9297aee2d", "committedDate": "2020-03-20T14:33:55Z", "message": "Fix primefaces#5713: Update documentation for 9.0"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "e9ff082a203fb9752c372f574af041e9297aee2d", "author": {"user": {"login": "fanste", "name": null}}, "url": "https://github.com/primefaces/primefaces/commit/e9ff082a203fb9752c372f574af041e9297aee2d", "committedDate": "2020-03-20T14:33:55Z", "message": "Fix primefaces#5713: Update documentation for 9.0"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7f1146b3b351a0e89201edec75cda5cb844922ea", "author": {"user": {"login": "fanste", "name": null}}, "url": "https://github.com/primefaces/primefaces/commit/7f1146b3b351a0e89201edec75cda5cb844922ea", "committedDate": "2020-03-20T14:47:44Z", "message": "Refactor calculateWeekNumber_X"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "7f1146b3b351a0e89201edec75cda5cb844922ea", "author": {"user": {"login": "fanste", "name": null}}, "url": "https://github.com/primefaces/primefaces/commit/7f1146b3b351a0e89201edec75cda5cb844922ea", "committedDate": "2020-03-20T14:47:44Z", "message": "Refactor calculateWeekNumber_X"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4NTY1NDk2", "url": "https://github.com/primefaces/primefaces/pull/5715#pullrequestreview-378565496", "createdAt": "2020-03-20T15:07:59Z", "commit": {"oid": "7f1146b3b351a0e89201edec75cda5cb844922ea"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4NTcyMTYz", "url": "https://github.com/primefaces/primefaces/pull/5715#pullrequestreview-378572163", "createdAt": "2020-03-20T15:15:39Z", "commit": {"oid": "7f1146b3b351a0e89201edec75cda5cb844922ea"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQxNToxNTozOVrOF5X7zQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQxNToxNTozOVrOF5X7zQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTcwNTI5Mw==", "bodyText": "Why not put this method right below the 3 methods using it?", "url": "https://github.com/primefaces/primefaces/pull/5715#discussion_r395705293", "createdAt": "2020-03-20T15:15:39Z", "author": {"login": "melloware"}, "path": "src/main/resources/META-INF/resources/primefaces/datepicker/0-datepicker.js", "diffHunk": "@@ -17,6 +17,12 @@\n     }\n }(function ($) {\n \n+    function calculateWeekNumber(d) {\n+        var yearStart = new Date(Date.UTC(d.getUTCFullYear(),0,1));\n+        var weekNo = Math.ceil(( ( (d - yearStart) / 86400000) + 1)/7);\n+        return weekNo;\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7f1146b3b351a0e89201edec75cda5cb844922ea"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4NjY2OTEw", "url": "https://github.com/primefaces/primefaces/pull/5715#pullrequestreview-378666910", "createdAt": "2020-03-20T17:11:52Z", "commit": {"oid": "7f1146b3b351a0e89201edec75cda5cb844922ea"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4OTAyODQz", "url": "https://github.com/primefaces/primefaces/pull/5715#pullrequestreview-378902843", "createdAt": "2020-03-21T08:39:24Z", "commit": {"oid": "7f1146b3b351a0e89201edec75cda5cb844922ea"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMVQwODozOToyNVrOF5oWww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMVQwODozOToyNVrOF5oWww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTk3NDMzOQ==", "bodyText": "please add ui-state-disabled", "url": "https://github.com/primefaces/primefaces/pull/5715#discussion_r395974339", "createdAt": "2020-03-21T08:39:25Z", "author": {"login": "christophs78"}, "path": "src/main/resources/META-INF/resources/primefaces/datepicker/0-datepicker.js", "diffHunk": "@@ -1293,9 +1326,36 @@\n             return dayNamesHtml;\n         },\n \n+        calculateWeekNumber_iso8601: function(d) {\n+            d = new Date(Date.UTC(d.year, d.month, d.day));\n+            d.setUTCDate(d.getUTCDate() + 4 - (d.getUTCDay()||7));\n+            return calculateWeekNumber(d);\n+        },\n+\n+        calculateWeekNumber_sundayFirst: function (d) {\n+            d = new Date(Date.UTC(d.year, d.month, d.day));\n+            d.setUTCDate(d.getUTCDate() + 3 - d.getUTCDay());\n+            return calculateWeekNumber(d);\n+        },\n+\n+        calculateWeekNumber_saturdayFirst: function (d) {\n+            d = new Date(Date.UTC(d.year, d.month, d.day));\n+            d.setUTCDate(d.getUTCDate() - ((d.getUTCDay() + 6) % 7));\n+            return calculateWeekNumber(d);\n+        },\n+\n         renderWeek: function (weekDates) {\n             var weekHtml = '';\n \n+            if(this.options.showWeek) {\n+                var date = weekDates[0],\n+                    cellClass = date.otherMonth && !this.options.showOtherMonths ? ' ui-datepicker-other-month-hidden' : '';\n+\n+                weekHtml += '<td class=\"ui-datepicker-week-col' + cellClass + '\">' + ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7f1146b3b351a0e89201edec75cda5cb844922ea"}, "originalPosition": 90}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a27d03bc0cb5478ddb6b9056ac2bfdeef834d2e1", "author": {"user": {"login": "fanste", "name": null}}, "url": "https://github.com/primefaces/primefaces/commit/a27d03bc0cb5478ddb6b9056ac2bfdeef834d2e1", "committedDate": "2020-03-23T08:13:18Z", "message": "Add new datepicker attributes to taglib"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5MzI5MjYx", "url": "https://github.com/primefaces/primefaces/pull/5715#pullrequestreview-379329261", "createdAt": "2020-03-23T11:08:58Z", "commit": {"oid": "5c0411b22d4d21144257c5cffa7d7f556fd4bfdd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxMTowODo1OFrOF6Anqw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxMTowODo1OFrOF6Anqw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjM3MTg4Mw==", "bodyText": "I think you can remove this if statement. Users can calculate week numbers using a custom weekCalculator function;\nfunction myWeekCalculator(date) {\n    ...\n    return weekNo;\n}\n\n<p:datePicker weekCalculator=\"myWeekCalculator\"", "url": "https://github.com/primefaces/primefaces/pull/5715#discussion_r396371883", "createdAt": "2020-03-23T11:08:58Z", "author": {"login": "mertsincan"}, "path": "src/main/resources/META-INF/resources/primefaces/datepicker/0-datepicker.js", "diffHunk": "@@ -110,6 +112,22 @@\n                 $.extend(this.options.locale, this.options.userLocale);\n             }\n \n+            if(this.options.showWeek && !this.options.weekCalculator) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5c0411b22d4d21144257c5cffa7d7f556fd4bfdd"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "52f097a28c29090cc34a6eda13ba991c079a7ed1", "author": {"user": {"login": "fanste", "name": null}}, "url": "https://github.com/primefaces/primefaces/commit/52f097a28c29090cc34a6eda13ba991c079a7ed1", "committedDate": "2020-03-23T14:21:08Z", "message": "Refactor calculation to really fix non-ISO8601 calendar views\n\nThe code is based on the logic implemented in moment.js"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5NjI4Njgy", "url": "https://github.com/primefaces/primefaces/pull/5715#pullrequestreview-379628682", "createdAt": "2020-03-23T16:59:01Z", "commit": {"oid": "52f097a28c29090cc34a6eda13ba991c079a7ed1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5Njk1Nzgx", "url": "https://github.com/primefaces/primefaces/pull/5715#pullrequestreview-379695781", "createdAt": "2020-03-23T18:14:15Z", "commit": {"oid": "52f097a28c29090cc34a6eda13ba991c079a7ed1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2877, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}