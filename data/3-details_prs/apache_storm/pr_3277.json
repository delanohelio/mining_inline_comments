{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI2MDk1MDc0", "number": 3277, "title": "STORM-3641 upgrade metrics API for JCQueue", "bodyText": "What is the purpose of the change\nSwitch JCQueue metrics to us the new v2 API.\nHow was the change tested\nRan word count with metrics logging enabled.", "createdAt": "2020-06-01T16:42:14Z", "url": "https://github.com/apache/storm/pull/3277", "merged": true, "mergeCommit": {"oid": "df2e8d6e774eb3f9aadd440384208a918304dfe0"}, "closed": true, "closedAt": "2020-06-03T14:26:48Z", "author": {"login": "agresch"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcnZSACgFqTQyMjg1NDg0Mg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcnaXnHgFqTQyMzAwOTIyNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyODU0ODQy", "url": "https://github.com/apache/storm/pull/3277#pullrequestreview-422854842", "createdAt": "2020-06-02T16:29:48Z", "commit": {"oid": "7d27685d540b954b767b4c52f01531d272384a23"}, "state": "APPROVED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxNjoyOTo0OFrOGd6EyA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQxNjozOTowNFrOGd6cGw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDAxMzM4NA==", "bodyText": "can be simplified with Collections.singletonList(-1)", "url": "https://github.com/apache/storm/pull/3277#discussion_r434013384", "createdAt": "2020-06-02T16:29:48Z", "author": {"login": "Ethanlm"}, "path": "storm-client/src/jvm/org/apache/storm/daemon/worker/WorkerTransfer.java", "diffHunk": "@@ -65,8 +67,10 @@\n                                                + Config.TOPOLOGY_TRANSFER_BUFFER_SIZE + \":\" + xferQueueSz);\n         }\n \n+        List<Integer> taskIds = new ArrayList<>();\n+        taskIds.add(-1);\n         this.transferQueue = new JCQueue(\"worker-transfer-queue\", xferQueueSz, 0, xferBatchSz, backPressureWaitStrategy,\n-            workerState.getTopologyId(), Constants.SYSTEM_COMPONENT_ID, -1, workerState.getPort(),\n+            workerState.getTopologyId(), Constants.SYSTEM_COMPONENT_ID, taskIds, workerState.getPort(),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7d27685d540b954b767b4c52f01531d272384a23"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDAxNDUyOQ==", "bodyText": "Can be simplified with Collections.singletonList(100)", "url": "https://github.com/apache/storm/pull/3277#discussion_r434014529", "createdAt": "2020-06-02T16:31:38Z", "author": {"login": "Ethanlm"}, "path": "examples/storm-perf/src/main/java/org/apache/storm/perf/queuetest/JCQueuePerfTest.java", "diffHunk": "@@ -45,11 +47,17 @@ public static void main(String[] args) throws Exception {\n \n     }\n \n+    private static List<Integer> getTaskIds() {\n+        List<Integer> taskIds = new ArrayList<>();\n+        taskIds.add(1000);\n+        return taskIds;\n+    }\n+\n     private static void ackingProducerSimulation() {\n         WaitStrategyPark ws = new WaitStrategyPark(100);\n         StormMetricRegistry registry = new StormMetricRegistry();\n-        JCQueue spoutQ = new JCQueue(\"spoutQ\", 1024, 0, 100, ws, \"test\", \"test\", 1000, 1000, registry);\n-        JCQueue ackQ = new JCQueue(\"ackQ\", 1024, 0, 100, ws, \"test\", \"test\", 1000, 1000, registry);\n+        JCQueue spoutQ = new JCQueue(\"spoutQ\", 1024, 0, 100, ws, \"test\", \"test\", getTaskIds(), 1000, registry);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7d27685d540b954b767b4c52f01531d272384a23"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDAxOTI0NA==", "bodyText": "can be simplified with Collections.singletonList(1000)", "url": "https://github.com/apache/storm/pull/3277#discussion_r434019244", "createdAt": "2020-06-02T16:38:54Z", "author": {"login": "Ethanlm"}, "path": "storm-client/test/jvm/org/apache/storm/utils/JCQueueBackpressureTest.java", "diffHunk": "@@ -18,11 +18,16 @@\n import org.junit.Assert;\n import org.junit.Test;\n \n+import java.util.ArrayList;\n+import java.util.List;\n+\n \n public class JCQueueBackpressureTest {\n     \n     private static JCQueue createQueue(String name, int queueSize) {\n-        return new JCQueue(name, queueSize, 0, 1, new WaitStrategyPark(0), \"test\", \"test\", 1000, 1000, new StormMetricRegistry());\n+        List<Integer> taskIds = new ArrayList<>();\n+        taskIds.add(1000);\n+        return new JCQueue(name, queueSize, 0, 1, new WaitStrategyPark(0), \"test\", \"test\", taskIds, 1000, new StormMetricRegistry());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7d27685d540b954b767b4c52f01531d272384a23"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDAxOTM1NQ==", "bodyText": "here too", "url": "https://github.com/apache/storm/pull/3277#discussion_r434019355", "createdAt": "2020-06-02T16:39:04Z", "author": {"login": "Ethanlm"}, "path": "storm-client/test/jvm/org/apache/storm/utils/JCQueueTest.java", "diffHunk": "@@ -157,7 +159,9 @@ private JCQueue createQueue(String name, int queueSize) {\n     }\n \n     private JCQueue createQueue(String name, int batchSize, int queueSize) {\n-        return new JCQueue(name, queueSize, 0, batchSize, waitStrategy, \"test\", \"test\", 1000, 1000, new StormMetricRegistry());\n+        List<Integer> taskIds = new ArrayList<>();\n+        taskIds.add(1000);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7d27685d540b954b767b4c52f01531d272384a23"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e3852a24eb994e3acc63551c99766e2fdd91bcdf", "author": {"user": null}, "url": "https://github.com/apache/storm/commit/e3852a24eb994e3acc63551c99766e2fdd91bcdf", "committedDate": "2020-06-02T19:46:41Z", "message": "STORM-3641 upgrade metrics API for JCQueue"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7d27685d540b954b767b4c52f01531d272384a23", "author": {"user": null}, "url": "https://github.com/apache/storm/commit/7d27685d540b954b767b4c52f01531d272384a23", "committedDate": "2020-06-01T19:06:14Z", "message": "STORM-3641 fix JCQueuePerfTest"}, "afterCommit": {"oid": "e3852a24eb994e3acc63551c99766e2fdd91bcdf", "author": {"user": null}, "url": "https://github.com/apache/storm/commit/e3852a24eb994e3acc63551c99766e2fdd91bcdf", "committedDate": "2020-06-02T19:46:41Z", "message": "STORM-3641 upgrade metrics API for JCQueue"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzMDA5MjI1", "url": "https://github.com/apache/storm/pull/3277#pullrequestreview-423009225", "createdAt": "2020-06-02T19:52:27Z", "commit": {"oid": "e3852a24eb994e3acc63551c99766e2fdd91bcdf"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4589, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}