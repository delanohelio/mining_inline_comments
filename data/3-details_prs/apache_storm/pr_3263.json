{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEzMTQ0MzI0", "number": 3263, "title": "STORM-3627 allow using short metric names for V2 metrics tick", "bodyText": "What is the purpose of the change\nSome metrics reporters using the metrics tick already report metric dimensions such as hostname and topology.  For such cases, adding these to the V2 metric name prevents useful metric aggregation.  This PR allows disabling reporting of the extended metric name for the metrics tick.\nHow was the change tested\nLaunched topology with -c topology.enable.v2.metrics.tick=true -c topology.metrics.use.shortname=true/false and validated short/long name for metrics was reported.", "createdAt": "2020-05-04T19:37:31Z", "url": "https://github.com/apache/storm/pull/3263", "merged": true, "mergeCommit": {"oid": "69e69d40d5c700465b49f4c23312f974fb2ca1f6"}, "closed": true, "closedAt": "2020-05-13T16:53:27Z", "author": {"login": "agresch"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABceE0YtgFqTQwNTI5MDM1Mg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcg6f09gBqjMzMzI2MTA2MzU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1MjkwMzUy", "url": "https://github.com/apache/storm/pull/3263#pullrequestreview-405290352", "createdAt": "2020-05-04T19:40:39Z", "commit": {"oid": "7124e32f453cb755ab7b9dfccc03b968c233ea3e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxOTo0MDozOVrOGQPU_A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxOTo0MDozOVrOGQPU_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTY4MTUzMg==", "bodyText": "We don't really need this config.\nThe taskIdMapping is only used for v2.metrics.tick. We save short name in the taskIdMapping to conform with V1 method of sending metrics.\nMetrics register at codehale metricRegistry should just use the long time.", "url": "https://github.com/apache/storm/pull/3263#discussion_r419681532", "createdAt": "2020-05-04T19:40:39Z", "author": {"login": "Ethanlm"}, "path": "storm-client/src/jvm/org/apache/storm/Config.java", "diffHunk": "@@ -277,6 +277,12 @@\n     @IsBoolean\n     public static final String TOPOLOGY_ENABLE_V2_METRICS_TICK = \"topology.enable.v2.metrics.tick\";\n \n+    /**\n+     * This config allows V2 metrics reporting through the metrics tick to use short names.\n+     */\n+    @IsBoolean\n+    public static final String TOPOLOGY_METRICS_USE_SHORTNAME = \"topology.metrics.use.shortname\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7124e32f453cb755ab7b9dfccc03b968c233ea3e"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwMzgwMDk3", "url": "https://github.com/apache/storm/pull/3263#pullrequestreview-410380097", "createdAt": "2020-05-12T20:03:21Z", "commit": {"oid": "4f6f59edabd70d7030fc15ce242690ce251c777a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQyMDowMzoyMVrOGUW5Ew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQyMDowMzoyMVrOGUW5Ew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzk5OTc2Mw==", "bodyText": "I am trying to understand why we have storm.worker and storm.topology prefix. Do we need there prefix on shortnames?", "url": "https://github.com/apache/storm/pull/3263#discussion_r423999763", "createdAt": "2020-05-12T20:03:21Z", "author": {"login": "Ethanlm"}, "path": "storm-client/src/jvm/org/apache/storm/metrics2/StormMetricRegistry.java", "diffHunk": "@@ -250,11 +254,14 @@ private String metricName(String name, String stormId, String componentId, Integ\n         sb.append(workerPort);\n         sb.append(\"-\");\n         sb.append(name);\n-        return sb.toString();\n+        String longName = sb.toString();\n+        String shortName = WORKER_METRIC_PREFIX + name;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4f6f59edabd70d7030fc15ce242690ce251c777a"}, "originalPosition": 184}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwNDUyNzU3", "url": "https://github.com/apache/storm/pull/3263#pullrequestreview-410452757", "createdAt": "2020-05-12T21:58:27Z", "commit": {"oid": "4f6f59edabd70d7030fc15ce242690ce251c777a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExMDMxNTM5", "url": "https://github.com/apache/storm/pull/3263#pullrequestreview-411031539", "createdAt": "2020-05-13T15:16:31Z", "commit": {"oid": "875f9a98f5d25a6fa3615a5848943832e21c1e90"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a3378c09fb0bf35ee20ddc1dd5a33ace8b576eda", "author": {"user": null}, "url": "https://github.com/apache/storm/commit/a3378c09fb0bf35ee20ddc1dd5a33ace8b576eda", "committedDate": "2020-05-13T15:20:23Z", "message": "STORM-3627 allow using short metric names for V2 metrics tick"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "875f9a98f5d25a6fa3615a5848943832e21c1e90", "author": {"user": null}, "url": "https://github.com/apache/storm/commit/875f9a98f5d25a6fa3615a5848943832e21c1e90", "committedDate": "2020-05-13T14:42:11Z", "message": "STORM-3627 remove prefix from metric short name"}, "afterCommit": {"oid": "a3378c09fb0bf35ee20ddc1dd5a33ace8b576eda", "author": {"user": null}, "url": "https://github.com/apache/storm/commit/a3378c09fb0bf35ee20ddc1dd5a33ace8b576eda", "committedDate": "2020-05-13T15:20:23Z", "message": "STORM-3627 allow using short metric names for V2 metrics tick"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4568, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}