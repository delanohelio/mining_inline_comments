{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYzODM2OTU5", "number": 3195, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xN1QyMToyMTozNFrODY8QdQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xN1QyMToyMjowN1rODY8Q2Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI3NDc5NjY5OnYy", "diffSide": "RIGHT", "path": "storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xN1QyMToyMTozNFrOFfFkIg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xN1QyMToyMTozNFrOFfFkIg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE0MTM0Ng==", "bodyText": "Nit: Java doc is missing @param topology topoConf", "url": "https://github.com/apache/storm/pull/3195#discussion_r368141346", "createdAt": "2020-01-17T21:21:34Z", "author": {"login": "Ethanlm"}, "path": "storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java", "diffHunk": "@@ -4242,20 +4231,30 @@ public TopologyPageInfo getTopologyPageInfo(String topoId, String window, boolea\n     }\n \n     /**\n-     * Add placeholder AggStats allowing topology page to show components before AggStats are populated.\n+     * If aggStats are not populated, compute common and component(spout) agg and create placeholder stat.\n+     * This allow the topology page to show component spec even the topo is not scheduled.\n+     * Otherwise, just fetch data from current topoPageInfo.\n      *\n      * @param topoPageInfo topology page info holding spout AggStats\n      * @param topology     storm topology used to get spout names\n      */\n-    private void maybeAddPlaceholderSpoutAggStats(TopologyPageInfo topoPageInfo, StormTopology topology) {\n+    private void addSpoutAggStats(TopologyPageInfo topoPageInfo, StormTopology topology, Map<String, Object> topoConf) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1f4dd374cb7a5ea5804d4d5a4fe1d95a70b0e1f4"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI3NDc5NzY5OnYy", "diffSide": "RIGHT", "path": "storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xN1QyMToyMjowN1rOFfFkyg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xN1QyMjowMDo0NlrOFfGWcA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE0MTUxNA==", "bodyText": "nit: missing javadoc @param topoConf", "url": "https://github.com/apache/storm/pull/3195#discussion_r368141514", "createdAt": "2020-01-17T21:22:07Z", "author": {"login": "Ethanlm"}, "path": "storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java", "diffHunk": "@@ -4264,23 +4263,35 @@ private void maybeAddPlaceholderSpoutAggStats(TopologyPageInfo topoPageInfo, Sto\n                 SpecificAggregateStats specificStats = new SpecificAggregateStats();\n                 specificStats.set_spout(spoutAggStats);\n                 placeholderComponentStats.set_specific_stats(specificStats);\n-\n-                topoPageInfo.get_id_to_spout_agg_stats().put(entry.getKey(), placeholderComponentStats);\n+                topoPageInfo.get_id_to_spout_agg_stats().put(spoutName, placeholderComponentStats);\n+            }\n+        } else {\n+            for (Entry<String, ComponentAggregateStats> entry : topoPageInfo.get_id_to_spout_agg_stats().entrySet()) {\n+                CommonAggregateStats commonStats = entry.getValue().get_common_stats();\n+                setResourcesDefaultIfNotSet(spoutResources, entry.getKey(), topoConf);\n+                commonStats.set_resources_map(spoutResources.get(entry.getKey()).toNormalizedMap());\n             }\n         }\n     }\n \n     /**\n-     * Add placeholder AggStats allowing topology page to show components before AggStats are populated.\n+     * If aggStats are not populated, compute common and component(bolt) agg and create placeholder stat.\n+     * This allow the topology page to show component spec even the topo is not scheduled.\n+     * Otherwise, just fetch data from current topoPageInfo.\n      *\n      * @param topoPageInfo  topology page info holding bolt AggStats\n      * @param topology      storm topology used to get bolt names\n      * @param includeSys    whether to show system bolts\n      */\n-    private void maybeAddPlaceholderBoltAggStats(TopologyPageInfo topoPageInfo, StormTopology topology, boolean includeSys) {\n+    private void addBoltAggStats(TopologyPageInfo topoPageInfo, StormTopology topology,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1f4dd374cb7a5ea5804d4d5a4fe1d95a70b0e1f4"}, "originalPosition": 87}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE1NDIyNA==", "bodyText": "Corrected both and force-push.", "url": "https://github.com/apache/storm/pull/3195#discussion_r368154224", "createdAt": "2020-01-17T22:00:46Z", "author": {"login": "RuiLi8080"}, "path": "storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java", "diffHunk": "@@ -4264,23 +4263,35 @@ private void maybeAddPlaceholderSpoutAggStats(TopologyPageInfo topoPageInfo, Sto\n                 SpecificAggregateStats specificStats = new SpecificAggregateStats();\n                 specificStats.set_spout(spoutAggStats);\n                 placeholderComponentStats.set_specific_stats(specificStats);\n-\n-                topoPageInfo.get_id_to_spout_agg_stats().put(entry.getKey(), placeholderComponentStats);\n+                topoPageInfo.get_id_to_spout_agg_stats().put(spoutName, placeholderComponentStats);\n+            }\n+        } else {\n+            for (Entry<String, ComponentAggregateStats> entry : topoPageInfo.get_id_to_spout_agg_stats().entrySet()) {\n+                CommonAggregateStats commonStats = entry.getValue().get_common_stats();\n+                setResourcesDefaultIfNotSet(spoutResources, entry.getKey(), topoConf);\n+                commonStats.set_resources_map(spoutResources.get(entry.getKey()).toNormalizedMap());\n             }\n         }\n     }\n \n     /**\n-     * Add placeholder AggStats allowing topology page to show components before AggStats are populated.\n+     * If aggStats are not populated, compute common and component(bolt) agg and create placeholder stat.\n+     * This allow the topology page to show component spec even the topo is not scheduled.\n+     * Otherwise, just fetch data from current topoPageInfo.\n      *\n      * @param topoPageInfo  topology page info holding bolt AggStats\n      * @param topology      storm topology used to get bolt names\n      * @param includeSys    whether to show system bolts\n      */\n-    private void maybeAddPlaceholderBoltAggStats(TopologyPageInfo topoPageInfo, StormTopology topology, boolean includeSys) {\n+    private void addBoltAggStats(TopologyPageInfo topoPageInfo, StormTopology topology,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE0MTUxNA=="}, "originalCommit": {"oid": "1f4dd374cb7a5ea5804d4d5a4fe1d95a70b0e1f4"}, "originalPosition": 87}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4348, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}