{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMzNzkzMjY0", "number": 3287, "title": "[STORM-3271] enable supervisors to launch a worker inside a docker container", "bodyText": "What is the purpose of the change\nWith this new functionality, a supervisor can launch a worker process inside a docker container for better security and portability.\nHow was the change tested\n\nTested by submitting a topology, and validated the basic functions like launching, killing, cleaning up, profiling works\nValidated the worker process is isolated inside a container with mostly read-only filesystem, and its own pid namespace\nValidated cpu bindings and cpu throttling work as expected.\nValidated the cpu and memory metrics work as expected.", "createdAt": "2020-06-12T17:02:45Z", "url": "https://github.com/apache/storm/pull/3287", "merged": true, "mergeCommit": {"oid": "935f74c6abd705c1ce9833ee88e092df097c17a5"}, "closed": true, "closedAt": "2020-10-01T19:23:46Z", "author": {"login": "Ethanlm"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcqoNDtABqjM0Mzk3MTY4MjY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdKH7lrAFqTQ5MTYwMTg4Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e10e239e9318ded927d6d79cd209e2487a89d7af", "author": {"user": {"login": "Ethanlm", "name": "Meng (Ethan) Li "}}, "url": "https://github.com/apache/storm/commit/e10e239e9318ded927d6d79cd209e2487a89d7af", "committedDate": "2020-06-12T16:59:26Z", "message": "[STORM-3271] enable supervisors to launch a worker inside a docker container"}, "afterCommit": {"oid": "a8b91271e0dab185b096ac6c1f14acdcb1d65af3", "author": {"user": {"login": "Ethanlm", "name": "Meng (Ethan) Li "}}, "url": "https://github.com/apache/storm/commit/a8b91271e0dab185b096ac6c1f14acdcb1d65af3", "committedDate": "2020-06-12T19:41:04Z", "message": "[STORM-3271] enable supervisors to launch a worker inside a docker container"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a8b91271e0dab185b096ac6c1f14acdcb1d65af3", "author": {"user": {"login": "Ethanlm", "name": "Meng (Ethan) Li "}}, "url": "https://github.com/apache/storm/commit/a8b91271e0dab185b096ac6c1f14acdcb1d65af3", "committedDate": "2020-06-12T19:41:04Z", "message": "[STORM-3271] enable supervisors to launch a worker inside a docker container"}, "afterCommit": {"oid": "1841f582b164d7f6af623df8f0743cfe53b32055", "author": {"user": {"login": "Ethanlm", "name": "Meng (Ethan) Li "}}, "url": "https://github.com/apache/storm/commit/1841f582b164d7f6af623df8f0743cfe53b32055", "committedDate": "2020-06-12T19:58:47Z", "message": "[STORM-3271] enable supervisors to launch a worker inside a docker container"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f70036fa856198a3dc38147933b1974959668d70", "author": {"user": {"login": "Ethanlm", "name": "Meng (Ethan) Li "}}, "url": "https://github.com/apache/storm/commit/f70036fa856198a3dc38147933b1974959668d70", "committedDate": "2020-06-12T20:16:50Z", "message": "[STORM-3271] enable supervisors to launch a worker inside a docker container"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1841f582b164d7f6af623df8f0743cfe53b32055", "author": {"user": {"login": "Ethanlm", "name": "Meng (Ethan) Li "}}, "url": "https://github.com/apache/storm/commit/1841f582b164d7f6af623df8f0743cfe53b32055", "committedDate": "2020-06-12T19:58:47Z", "message": "[STORM-3271] enable supervisors to launch a worker inside a docker container"}, "afterCommit": {"oid": "f70036fa856198a3dc38147933b1974959668d70", "author": {"user": {"login": "Ethanlm", "name": "Meng (Ethan) Li "}}, "url": "https://github.com/apache/storm/commit/f70036fa856198a3dc38147933b1974959668d70", "committedDate": "2020-06-12T20:16:50Z", "message": "[STORM-3271] enable supervisors to launch a worker inside a docker container"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyMDM2MzY1", "url": "https://github.com/apache/storm/pull/3287#pullrequestreview-442036365", "createdAt": "2020-07-02T21:45:17Z", "commit": {"oid": "f70036fa856198a3dc38147933b1974959668d70"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQyMTo0NToxN1rOGsd4OA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQyMTo0NToxN1rOGsd4OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTI4MDA1Ng==", "bodyText": "Do we need to override this method? Looks like the parent DockerCommand.getCommandWithArguments is doing the same thing.", "url": "https://github.com/apache/storm/pull/3287#discussion_r449280056", "createdAt": "2020-07-02T21:45:17Z", "author": {"login": "kishorvpatil"}, "path": "storm-server/src/main/java/org/apache/storm/container/docker/DockerPsCommand.java", "diffHunk": "@@ -0,0 +1,52 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.storm.container.docker;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import org.apache.commons.lang.StringUtils;\n+\n+public class DockerPsCommand extends DockerCommand {\n+    private static final String PS_COMMAND = \"ps\";\n+\n+    public DockerPsCommand() {\n+        super(PS_COMMAND);\n+    }\n+\n+    public DockerPsCommand withQuietOption() {\n+        super.addCommandArguments(\"--quiet=true\");\n+        return this;\n+    }\n+\n+    public DockerPsCommand withNameFilter(String containerName) {\n+        super.addCommandArguments(\"--filter=name=\" + containerName);\n+        return this;\n+    }\n+\n+    /**\n+     * Get the full command.\n+     * @return the full command.\n+     */\n+    @Override\n+    public String getCommandWithArguments() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f70036fa856198a3dc38147933b1974959668d70"}, "originalPosition": 47}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eebd2eda0a80137632e8dc45e83cab0f0102d645", "author": {"user": {"login": "Ethanlm", "name": "Meng (Ethan) Li "}}, "url": "https://github.com/apache/storm/commit/eebd2eda0a80137632e8dc45e83cab0f0102d645", "committedDate": "2020-07-06T19:06:51Z", "message": "[STORM-3271] remove redundant method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "755ca1d8b5c327f94db851359cbf45f8bdc61316", "author": {"user": {"login": "Ethanlm", "name": "Meng (Ethan) Li "}}, "url": "https://github.com/apache/storm/commit/755ca1d8b5c327f94db851359cbf45f8bdc61316", "committedDate": "2020-07-06T20:21:07Z", "message": "[STORM-3271] adjust docs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "38d332d33eb7605ac2d413e7d4cceb8112736d0d", "author": {"user": {"login": "Ethanlm", "name": "Meng (Ethan) Li "}}, "url": "https://github.com/apache/storm/commit/38d332d33eb7605ac2d413e7d4cceb8112736d0d", "committedDate": "2020-07-06T20:29:55Z", "message": "[STORM-3271-docker] adjust docs for worker-launcher"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQzOTYyMTY1", "url": "https://github.com/apache/storm/pull/3287#pullrequestreview-443962165", "createdAt": "2020-07-07T14:43:37Z", "commit": {"oid": "38d332d33eb7605ac2d413e7d4cceb8112736d0d"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNDo0MzozN1rOGuB8Mg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNDo1NzoyMFrOGuClZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDkxOTQ3NA==", "bodyText": "\"This has only been tested\" maybe?", "url": "https://github.com/apache/storm/pull/3287#discussion_r450919474", "createdAt": "2020-07-07T14:43:37Z", "author": {"login": "agresch"}, "path": "docs/Docker-support.md", "diffHunk": "@@ -0,0 +1,135 @@\n+---\n+title: Docker Support\n+layout: documentation\n+documentation: true\n+---\n+\n+# Docker Support\n+\n+This page describes how storm supervisor launches the worker in a docker container. \n+\n+Note: This is only tested on RHEL7.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "38d332d33eb7605ac2d413e7d4cceb8112736d0d"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDkxOTk2Nw==", "bodyText": "\"This feature is mostly\"...?", "url": "https://github.com/apache/storm/pull/3287#discussion_r450919967", "createdAt": "2020-07-07T14:44:18Z", "author": {"login": "agresch"}, "path": "docs/Docker-support.md", "diffHunk": "@@ -0,0 +1,135 @@\n+---\n+title: Docker Support\n+layout: documentation\n+documentation: true\n+---\n+\n+# Docker Support\n+\n+This page describes how storm supervisor launches the worker in a docker container. \n+\n+Note: This is only tested on RHEL7.\n+\n+## Motivation\n+\n+This is mostly about security and portability. With workers running inside of docker containers, we isolate running user code from each other and from the hosted machine so that the whole system is less vulnerable to attack. ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "38d332d33eb7605ac2d413e7d4cceb8112736d0d"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDkyMDU2NA==", "bodyText": "I think this first sentence (easy to understand) is irrelevant.  I would drop it.  Nice that it is easy though!", "url": "https://github.com/apache/storm/pull/3287#discussion_r450920564", "createdAt": "2020-07-07T14:45:02Z", "author": {"login": "agresch"}, "path": "docs/Docker-support.md", "diffHunk": "@@ -0,0 +1,135 @@\n+---\n+title: Docker Support\n+layout: documentation\n+documentation: true\n+---\n+\n+# Docker Support\n+\n+This page describes how storm supervisor launches the worker in a docker container. \n+\n+Note: This is only tested on RHEL7.\n+\n+## Motivation\n+\n+This is mostly about security and portability. With workers running inside of docker containers, we isolate running user code from each other and from the hosted machine so that the whole system is less vulnerable to attack. \n+It also allows users to run their topologies on different os versions using different docker images.\n+\n+## Implementation\n+\n+The implementation is pretty easy to understand. Essentially, `DockerManager` composes a docker-run command and uses `worker-launcher` executable to execute the command ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "38d332d33eb7605ac2d413e7d4cceb8112736d0d"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDkzMDAyMA==", "bodyText": "this looks like it should be added to writeScript() below", "url": "https://github.com/apache/storm/pull/3287#discussion_r450930020", "createdAt": "2020-07-07T14:57:20Z", "author": {"login": "agresch"}, "path": "storm-server/src/main/java/org/apache/storm/utils/ServerUtils.java", "diffHunk": "@@ -290,10 +290,24 @@ public static String scriptFilePath(String dir) {\n      * @param dir         the directory under which the script is to be written\n      * @param command     the command the script is to execute\n      * @param environment optional environment variables to set before running the script's command. May be  null.\n+     * @param umask umask to be set. It can be null.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "38d332d33eb7605ac2d413e7d4cceb8112736d0d"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f1c688c08632370c648dd972de3ec1c03d7ea9cb", "author": {"user": {"login": "Ethanlm", "name": "Meng (Ethan) Li "}}, "url": "https://github.com/apache/storm/commit/f1c688c08632370c648dd972de3ec1c03d7ea9cb", "committedDate": "2020-07-07T16:44:53Z", "message": "[STORM-3271] update docs and javadocs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwMTQ3Nzky", "url": "https://github.com/apache/storm/pull/3287#pullrequestreview-450147792", "createdAt": "2020-07-16T19:21:21Z", "commit": {"oid": "f1c688c08632370c648dd972de3ec1c03d7ea9cb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxNjAxODg2", "url": "https://github.com/apache/storm/pull/3287#pullrequestreview-491601886", "createdAt": "2020-09-18T16:10:54Z", "commit": {"oid": "f1c688c08632370c648dd972de3ec1c03d7ea9cb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4603, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}