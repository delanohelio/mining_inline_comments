{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM4NTI5MDMy", "number": 3291, "title": "STORM-3655: Worker should die if its assignment has changed", "bodyText": "What is the purpose of the change\nThe assignment change should lead to worker suicide. This is specially critical if Supervisor is down for some reason\nHow was the change tested\n\nLauncher WordCountTopology, wait for worker to start\nStop the supervisor\nRe-balance topology so worker is assigned to next supervisor\nWorker should kill itself with worker.log entries similar to below.\n\n2020-06-22 06:55:40.527 o.a.s.d.w.WorkerState refresh-connections-timer [INFO] Found conflicting assignments. We shouldn't be alive! Assigned: [[-1, -1]], Current: [[-1, -1], [14, 14], [12, 12], [10, 10], [8, 8], [6, 6], [4, 4], [2, 2], [7, 7], [5, 5], [3, 3], [1, 1], [13, 13], [11, 11], [9, 9]]\n2020-06-22 06:55:40.529 o.a.s.u.Utils refresh-connections-timer [ERROR] Halting process: Worker died\njava.lang.RuntimeException: Halting process: Worker died\n        at org.apache.storm.utils.Utils.exitProcess(Utils.java:518) ~[storm-client-2.3.0.y.jar:2.3.0.y]\n        at org.apache.storm.daemon.worker.WorkerState.suicideIfLocalAssignmentsChanged(WorkerState.java:390) ~[storm-client-2.3.0.y.jar:2.3.0.y]\n        at org.apache.storm.daemon.worker.WorkerState.refreshConnections(WorkerState.java:421) ~[storm-client-2.3.0.y.jar:2.3.0.y]\n        at org.apache.storm.StormTimer$1.run(StormTimer.java:110) [storm-client-2.3.0.y.jar:2.3.0.y]\n        at org.apache.storm.StormTimer$StormTimerTask.run(StormTimer.java:226) [storm-client-2.3.0.y.jar:2.3.0.y]\n2020-06-22 06:55:40.552 o.a.s.d.w.Worker Thread-32 [INFO] Shutting down worker fwc2-1-1592662435 44c0bd8e-bd3c-4317-b09f-1f0deb3f2a7c 6700", "createdAt": "2020-06-23T12:12:16Z", "url": "https://github.com/apache/storm/pull/3291", "merged": true, "mergeCommit": {"oid": "4fdfc0e919c70352c85ebe652dc50a929077d853"}, "closed": true, "closedAt": "2020-07-01T13:53:20Z", "author": {"login": "kishorvpatil"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcwCIidgFqTQzOTIxNTg2Mg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcwE-WNAFqTQzOTM3OTIzMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5MjE1ODYy", "url": "https://github.com/apache/storm/pull/3291#pullrequestreview-439215862", "createdAt": "2020-06-29T14:43:15Z", "commit": {"oid": "c29be627f1e4e63021f5ccc27052892dabbfe68b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQxNDo0MzoxNlrOGqURvg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQxNDo0MzoxNlrOGqURvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzAyNTU5OA==", "bodyText": "We can place this as earlier as possible in this refreshConnections method.", "url": "https://github.com/apache/storm/pull/3291#discussion_r447025598", "createdAt": "2020-06-29T14:43:16Z", "author": {"login": "Ethanlm"}, "path": "storm-client/src/jvm/org/apache/storm/daemon/worker/WorkerState.java", "diffHunk": "@@ -401,6 +418,7 @@ public void refreshConnections() {\n             }\n         }\n \n+        suicideIfLocalAssignmentsChanged(assignment);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c29be627f1e4e63021f5ccc27052892dabbfe68b"}, "originalPosition": 46}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "07362f566132ff9392f2d320ed6aa4e78509258d", "author": {"user": {"login": "kishorvpatil", "name": "Kishor Patil"}}, "url": "https://github.com/apache/storm/commit/07362f566132ff9392f2d320ed6aa4e78509258d", "committedDate": "2020-06-29T18:00:22Z", "message": "STORM-3655: Worker should die if its assignment has changed"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c29be627f1e4e63021f5ccc27052892dabbfe68b", "author": {"user": {"login": "kishorvpatil", "name": "Kishor Patil"}}, "url": "https://github.com/apache/storm/commit/c29be627f1e4e63021f5ccc27052892dabbfe68b", "committedDate": "2020-06-23T12:05:20Z", "message": "STORM-3655: Worker should die if its assignment has changed"}, "afterCommit": {"oid": "07362f566132ff9392f2d320ed6aa4e78509258d", "author": {"user": {"login": "kishorvpatil", "name": "Kishor Patil"}}, "url": "https://github.com/apache/storm/commit/07362f566132ff9392f2d320ed6aa4e78509258d", "committedDate": "2020-06-29T18:00:22Z", "message": "STORM-3655: Worker should die if its assignment has changed"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5Mzc5MjMz", "url": "https://github.com/apache/storm/pull/3291#pullrequestreview-439379233", "createdAt": "2020-06-29T18:02:10Z", "commit": {"oid": "07362f566132ff9392f2d320ed6aa4e78509258d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4609, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}