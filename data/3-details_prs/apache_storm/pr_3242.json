{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk3MjA0MDg2", "number": 3242, "title": "STORM-3614 switch SystemBolt metrics to V2 API", "bodyText": "metrics-jvm metric sets contain all the GC/memory/thread info we were providing with some additional data.  Replaced these metrics with their implementations.", "createdAt": "2020-04-01T20:02:07Z", "url": "https://github.com/apache/storm/pull/3242", "merged": true, "mergeCommit": {"oid": "4e126034356968a89e976e7011b9dec9917dd6ed"}, "closed": true, "closedAt": "2020-04-08T14:28:27Z", "author": {"login": "agresch"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcTuv9wABqjMxOTI5NjcyNjE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcVZ19BgBqjMyMTE2MjI1Njc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "65b89c76a178fbb94f9b94ac5ebbd1d41c5470c5", "author": {"user": null}, "url": "https://github.com/apache/storm/commit/65b89c76a178fbb94f9b94ac5ebbd1d41c5470c5", "committedDate": "2020-04-01T19:58:18Z", "message": "STORM-3614 switch SystemBolt metrics to V2 API"}, "afterCommit": {"oid": "6f58af7fa88571e5ce41f17029cfd08d96a8074b", "author": {"user": null}, "url": "https://github.com/apache/storm/commit/6f58af7fa88571e5ce41f17029cfd08d96a8074b", "committedDate": "2020-04-02T16:18:18Z", "message": "STORM-3614 switch SystemBolt metrics to V2 API"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6f58af7fa88571e5ce41f17029cfd08d96a8074b", "author": {"user": null}, "url": "https://github.com/apache/storm/commit/6f58af7fa88571e5ce41f17029cfd08d96a8074b", "committedDate": "2020-04-02T16:18:18Z", "message": "STORM-3614 switch SystemBolt metrics to V2 API"}, "afterCommit": {"oid": "e0494db16dbce7626802f650e1163f776f09fda1", "author": {"user": null}, "url": "https://github.com/apache/storm/commit/e0494db16dbce7626802f650e1163f776f09fda1", "committedDate": "2020-04-02T19:10:51Z", "message": "STORM-3614 switch SystemBolt metrics to V2 API"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e0494db16dbce7626802f650e1163f776f09fda1", "author": {"user": null}, "url": "https://github.com/apache/storm/commit/e0494db16dbce7626802f650e1163f776f09fda1", "committedDate": "2020-04-02T19:10:51Z", "message": "STORM-3614 switch SystemBolt metrics to V2 API"}, "afterCommit": {"oid": "7a59a901595f8146fa85e94330bc33c24b655608", "author": {"user": null}, "url": "https://github.com/apache/storm/commit/7a59a901595f8146fa85e94330bc33c24b655608", "committedDate": "2020-04-02T19:41:54Z", "message": "STORM-3614 switch SystemBolt metrics to V2 API"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7a59a901595f8146fa85e94330bc33c24b655608", "author": {"user": null}, "url": "https://github.com/apache/storm/commit/7a59a901595f8146fa85e94330bc33c24b655608", "committedDate": "2020-04-02T19:41:54Z", "message": "STORM-3614 switch SystemBolt metrics to V2 API"}, "afterCommit": {"oid": "7aa3f3d8ef74703eb59fe132deadb69c2b44c2fc", "author": {"user": null}, "url": "https://github.com/apache/storm/commit/7aa3f3d8ef74703eb59fe132deadb69c2b44c2fc", "committedDate": "2020-04-02T20:09:14Z", "message": "STORM-3614 switch SystemBolt metrics to V2 API"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2Nzc4ODAw", "url": "https://github.com/apache/storm/pull/3242#pullrequestreview-386778800", "createdAt": "2020-04-02T21:10:50Z", "commit": {"oid": "7aa3f3d8ef74703eb59fe132deadb69c2b44c2fc"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQyMToxMDo1MFrOF_8p4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQyMTozMTozMVrOF_9Pow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjU5ODM2OA==", "bodyText": "Will there be any possible conflicts since it's pulling in two different major versions of dropwizard.metrics?\nEven though they are for different artifacts, I am worried about transitive dependencies", "url": "https://github.com/apache/storm/pull/3242#discussion_r402598368", "createdAt": "2020-04-02T21:10:50Z", "author": {"login": "Ethanlm"}, "path": "pom.xml", "diffHunk": "@@ -295,6 +295,7 @@\n         <log4j.version>2.11.2</log4j.version>\n         <slf4j.version>1.7.26</slf4j.version>\n         <metrics.version>3.2.6</metrics.version>\n+        <metrics.jvm.version>4.0.7</metrics.jvm.version>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7aa3f3d8ef74703eb59fe132deadb69c2b44c2fc"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjYwODAzNQ==", "bodyText": "Do we want to add some unit tests in java code?", "url": "https://github.com/apache/storm/pull/3242#discussion_r402608035", "createdAt": "2020-04-02T21:31:31Z", "author": {"login": "Ethanlm"}, "path": "storm-core/test/clj/org/apache/storm/metrics_test.clj", "diffHunk": "@@ -376,26 +376,5 @@\n       (assert-metric-running-sum! \"mybolt\" \"__ack-count/myspout:default\" 2 4 cluster)\n       (assert-metric-running-sum! \"mybolt\" \"__execute-count/myspout:default\" 3 4 cluster))))\n \n-(deftest test-system-bolt", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7aa3f3d8ef74703eb59fe132deadb69c2b44c2fc"}, "originalPosition": 4}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7aa3f3d8ef74703eb59fe132deadb69c2b44c2fc", "author": {"user": null}, "url": "https://github.com/apache/storm/commit/7aa3f3d8ef74703eb59fe132deadb69c2b44c2fc", "committedDate": "2020-04-02T20:09:14Z", "message": "STORM-3614 switch SystemBolt metrics to V2 API"}, "afterCommit": {"oid": "6d8052e5f5442147716f8b6c2b783c7f58481fc8", "author": {"user": null}, "url": "https://github.com/apache/storm/commit/6d8052e5f5442147716f8b6c2b783c7f58481fc8", "committedDate": "2020-04-06T20:24:41Z", "message": "STORM-3614 switch SystemBolt metrics to V2 API"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5MTMzNzA4", "url": "https://github.com/apache/storm/pull/3242#pullrequestreview-389133708", "createdAt": "2020-04-07T13:48:33Z", "commit": {"oid": "6d8052e5f5442147716f8b6c2b783c7f58481fc8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QxMzo0ODozNFrOGCEb8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QxMzo0ODozNFrOGCEb8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDgyMzAyNA==", "bodyText": "These metrics are no longer from ManagementFactory right?", "url": "https://github.com/apache/storm/pull/3242#discussion_r404823024", "createdAt": "2020-04-07T13:48:34Z", "author": {"login": "Ethanlm"}, "path": "docs/Metrics.md", "diffHunk": "@@ -299,29 +299,28 @@ The value is a map where the key is a NodeInfo class for the downstream worker i\n \n ##### JVM Memory\n \n-JVM memory usage is reported through `memory/nonHeap` for off heap memory and `memory/heap` for on heap memory.  These values come from the [MemoryUsage](https://docs.oracle.com/javase/8/docs/api/index.html?java/lang/management/MemoryUsage.html) mxbean.  Each of the metrics are reported as a map with the following keys, and values returned by the corresponding java code.\n+JVM memory usage is reported through `memory.non-heap` for off heap memory, `memory.heap` for on heap memory and `memory.total` for combined values.  These values come from the [MemoryUsage](https://docs.oracle.com/javase/8/docs/api/index.html?java/lang/management/MemoryUsage.html) mxbean.  Each of the metrics are reported as a map with the following keys, and values returned by the corresponding java code.\n \n | Key | Corresponding Code |\n |--------|--------------------|\n-| `maxBytes` | `memUsage.getMax()` |\n-| `committedBytes` | `memUsage.getCommitted()` |\n-| `initBytes` | `memUsage.getInit()` |\n-| `usedBytes` | `memUsage.getUsed()` |\n-| `virtualFreeBytes` | `memUsage.getMax() - memUsage.getUsed()` |\n-| `unusedBytes` | `memUsage.getCommitted() - memUsage.getUsed()` |\n+| `max` | `memUsage.getMax()` |\n+| `committed` | `memUsage.getCommitted()` |\n+| `init` | `memUsage.getInit()` |\n+| `used` | `memUsage.getUsed()` |\n+| `usage` | `Ratio.of(memUsage.getUsed(), memUsage.getMax())` |\n \n ##### JVM Garbage Collection\n \n-The exact GC metric name depends on the garbage collector that your worker uses.  The data is all collected from `ManagementFactory.getGarbageCollectorMXBeans()` and the name of the metrics is `\"GC/\"` followed by the name of the returned bean with white space removed.  The reported metrics are just\n+The exact GC metric name depends on the garbage collector that your worker uses.  The data is all collected from `ManagementFactory.getGarbageCollectorMXBeans()` and the name of the metrics is `\"GC\"` followed by the name of the returned bean with white space removed.  The reported metrics are just", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6d8052e5f5442147716f8b6c2b783c7f58481fc8"}, "originalPosition": 24}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6d8052e5f5442147716f8b6c2b783c7f58481fc8", "author": {"user": null}, "url": "https://github.com/apache/storm/commit/6d8052e5f5442147716f8b6c2b783c7f58481fc8", "committedDate": "2020-04-06T20:24:41Z", "message": "STORM-3614 switch SystemBolt metrics to V2 API"}, "afterCommit": {"oid": "444df67ab5a1fd801d2c043bedcd08ae735ebb48", "author": {"user": null}, "url": "https://github.com/apache/storm/commit/444df67ab5a1fd801d2c043bedcd08ae735ebb48", "committedDate": "2020-04-07T16:48:52Z", "message": "STORM-3614 switch SystemBolt metrics to V2 API"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5Mzk0NDEw", "url": "https://github.com/apache/storm/pull/3242#pullrequestreview-389394410", "createdAt": "2020-04-07T18:45:53Z", "commit": {"oid": "444df67ab5a1fd801d2c043bedcd08ae735ebb48"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a34e0cb54f4712a8f10fd2c082ee105c38f24ca7", "author": {"user": null}, "url": "https://github.com/apache/storm/commit/a34e0cb54f4712a8f10fd2c082ee105c38f24ca7", "committedDate": "2020-04-07T21:04:40Z", "message": "STORM-3614 switch SystemBolt metrics to V2 API"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "444df67ab5a1fd801d2c043bedcd08ae735ebb48", "author": {"user": null}, "url": "https://github.com/apache/storm/commit/444df67ab5a1fd801d2c043bedcd08ae735ebb48", "committedDate": "2020-04-07T16:48:52Z", "message": "STORM-3614 switch SystemBolt metrics to V2 API"}, "afterCommit": {"oid": "a34e0cb54f4712a8f10fd2c082ee105c38f24ca7", "author": {"user": null}, "url": "https://github.com/apache/storm/commit/a34e0cb54f4712a8f10fd2c082ee105c38f24ca7", "committedDate": "2020-04-07T21:04:40Z", "message": "STORM-3614 switch SystemBolt metrics to V2 API"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4544, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}