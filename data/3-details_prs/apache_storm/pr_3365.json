{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQzNzAxODEx", "number": 3365, "title": "STORM-3727 handle long values for SUPERVISOR_SLOTS_PORTS", "bodyText": "What is the purpose of the change\nApparently it is possible for supervisorConf.getOrDefault(DaemonConfig.SUPERVISOR_SLOTS_PORTS) to return a list of Long values, which caused a ClassCastException.\nHow was the change tested\nBuilt storm-server jar.", "createdAt": "2020-12-21T20:16:40Z", "url": "https://github.com/apache/storm/pull/3365", "merged": true, "mergeCommit": {"oid": "ba7f969a3a046c5a312a394026d5d9dd755e04a0"}, "closed": true, "closedAt": "2021-01-05T17:32:41Z", "author": {"login": "agresch"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdobw1bgH2gAyNTQzNzAxODExOjJjYTFiYjQwYjlhY2QzZGNiNGViNGNmNmZjNmU4NGUzNGMxZWMzZTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdtOQ3NgFqTU2MTk4MDk5Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2ca1bb40b9acd3dcb4eb4cf6fc6e84e34c1ec3e4", "author": {"user": null}, "url": "https://github.com/apache/storm/commit/2ca1bb40b9acd3dcb4eb4cf6fc6e84e34c1ec3e4", "committedDate": "2020-12-21T20:14:59Z", "message": "STORM-3727 handle long values for SUPERVISOR_SLOTS_PORTS"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU2NjQ5MDc5", "url": "https://github.com/apache/storm/pull/3365#pullrequestreview-556649079", "createdAt": "2020-12-21T20:37:27Z", "commit": {"oid": "2ca1bb40b9acd3dcb4eb4cf6fc6e84e34c1ec3e4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU2NjgzMzUz", "url": "https://github.com/apache/storm/pull/3365#pullrequestreview-556683353", "createdAt": "2020-12-21T21:44:08Z", "commit": {"oid": "2ca1bb40b9acd3dcb4eb4cf6fc6e84e34c1ec3e4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQyMTo0NDowOVrOIJm2uA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQyMTo0NDowOVrOIJm2uA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njk0NDY5Ng==", "bodyText": "This would may involve rounding or truncation which isn't really what we wanted.\nA port by definition is no larger than 65535. So logically it will be Integers.\nThere is an Integer check here \n  \n    \n      storm/storm-server/src/main/java/org/apache/storm/DaemonConfig.java\n    \n    \n        Lines 742 to 743\n      in\n      6e37072\n    \n    \n    \n    \n\n        \n          \n           @IsListEntryCustom(entryValidatorClasses = { ConfigValidation.IntegerValidator.class, ConfigValidation.PositiveNumberValidator.class }) \n        \n\n        \n          \n           public static final String SUPERVISOR_SLOTS_PORTS = \"supervisor.slots.ports\"; \n        \n    \n  \n\n. Not sure why it was not properly enforced.", "url": "https://github.com/apache/storm/pull/3365#discussion_r546944696", "createdAt": "2020-12-21T21:44:09Z", "author": {"login": "Ethanlm"}, "path": "storm-server/src/main/java/org/apache/storm/daemon/supervisor/SupervisorUtils.java", "diffHunk": "@@ -92,8 +92,13 @@ public static String getNumaIdForPort(Integer port, Map<String, Object> supervis\n     }\n \n     public static List<Integer> getSlotsPorts(Map<String, Object> supervisorConf) {\n-        List<Integer> slotsPorts = (List<Integer>) supervisorConf.getOrDefault(DaemonConfig.SUPERVISOR_SLOTS_PORTS,\n+        List<Integer> slotsPorts = new ArrayList<>();\n+        List<Number> ports = (List<Number>) supervisorConf.getOrDefault(DaemonConfig.SUPERVISOR_SLOTS_PORTS,\n                 new ArrayList<>());\n+        for (Number port : ports) {\n+            slotsPorts.add(port.intValue());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ca1bb40b9acd3dcb4eb4cf6fc6e84e34c1ec3e4"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU2NzQwMzIz", "url": "https://github.com/apache/storm/pull/3365#pullrequestreview-556740323", "createdAt": "2020-12-22T00:12:06Z", "commit": {"oid": "2ca1bb40b9acd3dcb4eb4cf6fc6e84e34c1ec3e4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU4NjY4MTM2", "url": "https://github.com/apache/storm/pull/3365#pullrequestreview-558668136", "createdAt": "2020-12-24T15:36:57Z", "commit": {"oid": "2ca1bb40b9acd3dcb4eb4cf6fc6e84e34c1ec3e4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYxOTgwOTk3", "url": "https://github.com/apache/storm/pull/3365#pullrequestreview-561980997", "createdAt": "2021-01-05T17:20:55Z", "commit": {"oid": "2ca1bb40b9acd3dcb4eb4cf6fc6e84e34c1ec3e4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4965, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}