{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE3NjA4Nzgy", "number": 3348, "title": "[STORM-3711] Fix ARM CI with wrong usage of \"arm64-graviton2\" resources", "bodyText": "In # /pull/3344, we have enabled ARM CI with all Storm\nmodules enabled and switched to use the \"arm64-graviton2\" resources, but\nI have made a mistak that the ARM CI actually still run on x86 than\nARM even the CI job shows the label \"arm64-graviton2\", details can be\nfound in the CI job logs[1]. Because the \"arm64-graviton2\" requires\nexplicit virt: [lxd|vm] tag, see[2].\nAddtionally, we have skip the increasing swap space statement in\nintergration test because it will raise error on ARM. And we only\nenabled openjdk11 for ARM jobs because the jdk8 is unsupported, see[3].\n[1] https://travis-ci.org/github/apache/storm/jobs/741780900\n[2] https://docs.travis-ci.com/user/multi-cpu-architectures#testing-on-multiple-cpu-architectures\n[3] https://travis-ci.com/github/liusheng/storm/jobs/430934514", "createdAt": "2020-11-09T09:12:19Z", "url": "https://github.com/apache/storm/pull/3348", "merged": true, "mergeCommit": {"oid": "6b3922f8a2ee41d24538213626555d460a3d5415"}, "closed": true, "closedAt": "2020-12-17T02:39:17Z", "author": {"login": "liusheng"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdd_oRpgBqjQwMTQ5MDY2MzY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdm6QLFgFqTU1NDIzODU0NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b04a2d542a2af35e54d60f395d6c60a389cf0a7b", "author": {"user": {"login": "liusheng", "name": "Liu sheng"}}, "url": "https://github.com/apache/storm/commit/b04a2d542a2af35e54d60f395d6c60a389cf0a7b", "committedDate": "2020-11-09T08:37:56Z", "message": "Fix ARM CI with wrong usage of \"arm64-graviton2\" resources\n\nIn # apache/storm/pull/3344, we have enabled ARM CI with all Storm\nmodules enabled and switched to use the \"arm64-graviton2\" resources, but\nI have made a mistak that the ARM CI actually still run on x86 than\nARM even the CI job shows the label \"arm64-graviton2\", details can be\nfound in the CI job logs[1]. Because the \"arm64-graviton2\" requires\nexplicit virt: [lxd|vm] tag, see[2].\n\nAddtionally, we have skip the increasing swap space statement in\nintergration test because it will raise error on ARM. And we only\nenabled openjdk11 for ARM jobs because the jdk8 is unsupported, see[3].\n\n[1] https://travis-ci.org/github/apache/storm/jobs/741780900\n[2] https://docs.travis-ci.com/user/multi-cpu-architectures#testing-on-multiple-cpu-architectures\n[3] https://travis-ci.com/github/liusheng/storm/jobs/430934514"}, "afterCommit": {"oid": "b1452deebeb042a611a7e0bbde5b01ddda0ff1f1", "author": {"user": {"login": "liusheng", "name": "Liu sheng"}}, "url": "https://github.com/apache/storm/commit/b1452deebeb042a611a7e0bbde5b01ddda0ff1f1", "committedDate": "2020-11-19T09:48:38Z", "message": "Fix the integration tests job failure"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ4MzEzNjI3", "url": "https://github.com/apache/storm/pull/3348#pullrequestreview-548313627", "createdAt": "2020-12-09T15:39:04Z", "commit": {"oid": "b1452deebeb042a611a7e0bbde5b01ddda0ff1f1"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxNTozOTowNFrOICbF1Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxNTo0ODowNFrOICbluQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTQxMTkyNQ==", "bodyText": "The default dist configured above we use is trusty. Should we upgrade the default dist to focal? (it can be a separate work)", "url": "https://github.com/apache/storm/pull/3348#discussion_r539411925", "createdAt": "2020-12-09T15:39:04Z", "author": {"login": "Ethanlm"}, "path": ".travis.yml", "diffHunk": "@@ -41,6 +40,48 @@ matrix:\n   include:\n     - arch: s390x\n       jdk: openjdk11\n+    - dist: focal", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b1452deebeb042a611a7e0bbde5b01ddda0ff1f1"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTQxNDc3NA==", "bodyText": "Is it possible to use arm64 directly?\nhttps://docs.travis-ci.com/user/reference/overview/#linux-travisyml-examples", "url": "https://github.com/apache/storm/pull/3348#discussion_r539414774", "createdAt": "2020-12-09T15:42:15Z", "author": {"login": "Ethanlm"}, "path": ".travis.yml", "diffHunk": "@@ -41,6 +40,48 @@ matrix:\n   include:\n     - arch: s390x\n       jdk: openjdk11\n+    - dist: focal\n+      group: edge\n+      arch: arm64-graviton2", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b1452deebeb042a611a7e0bbde5b01ddda0ff1f1"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTQyMDA4OQ==", "bodyText": "What does group mean here?", "url": "https://github.com/apache/storm/pull/3348#discussion_r539420089", "createdAt": "2020-12-09T15:48:04Z", "author": {"login": "Ethanlm"}, "path": ".travis.yml", "diffHunk": "@@ -41,6 +40,48 @@ matrix:\n   include:\n     - arch: s390x\n       jdk: openjdk11\n+    - dist: focal\n+      group: edge", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b1452deebeb042a611a7e0bbde5b01ddda0ff1f1"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4338557ef6a5eb0da083508eec0b05ba5518f5cc", "author": {"user": {"login": "liusheng", "name": "Liu sheng"}}, "url": "https://github.com/apache/storm/commit/4338557ef6a5eb0da083508eec0b05ba5518f5cc", "committedDate": "2020-12-15T07:06:15Z", "message": "Fix ARM CI with wrong usage of \"arm64-graviton2\" resources\n\nIn # apache/storm/pull/3344, we have enabled ARM CI with all Storm\nmodules enabled and switched to use the \"arm64-graviton2\" resources, but\nI have made a mistak that the ARM CI actually still run on x86 than\nARM even the CI job shows the label \"arm64-graviton2\", details can be\nfound in the CI job logs[1]. Because the \"arm64-graviton2\" requires\nexplicit virt: [lxd|vm] tag, see[2].\n\nAddtionally, we have skip the increasing swap space statement in\nintergration test because it will raise error on ARM. And we only\nenabled openjdk11 for ARM jobs because the jdk8 is unsupported, see[3].\n\n[1] https://travis-ci.org/github/apache/storm/jobs/741780900\n[2] https://docs.travis-ci.com/user/multi-cpu-architectures#testing-on-multiple-cpu-architectures\n[3] https://travis-ci.com/github/liusheng/storm/jobs/430934514"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5e8b544e4cb7b18d260d9ba87aff9ff6d1d73b1b", "author": {"user": {"login": "liusheng", "name": "Liu sheng"}}, "url": "https://github.com/apache/storm/commit/5e8b544e4cb7b18d260d9ba87aff9ff6d1d73b1b", "committedDate": "2020-12-15T07:06:15Z", "message": "Fix the integration tests job failure"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9446eb2b6cdc6c443e87246cf56991f17d4767f1", "author": {"user": {"login": "liusheng", "name": "Liu sheng"}}, "url": "https://github.com/apache/storm/commit/9446eb2b6cdc6c443e87246cf56991f17d4767f1", "committedDate": "2020-12-15T07:09:06Z", "message": "Switch to use Ubuntu Xenial for running x86 and ARM64 CI"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6eb42826f42b3ad108515316b9a4cd68a9aa615b", "author": {"user": {"login": "liusheng", "name": "Liu sheng"}}, "url": "https://github.com/apache/storm/commit/6eb42826f42b3ad108515316b9a4cd68a9aa615b", "committedDate": "2020-12-10T01:28:28Z", "message": "Merge remote-tracking branch 'upstream/master' into fix-arm-ci"}, "afterCommit": {"oid": "9446eb2b6cdc6c443e87246cf56991f17d4767f1", "author": {"user": {"login": "liusheng", "name": "Liu sheng"}}, "url": "https://github.com/apache/storm/commit/9446eb2b6cdc6c443e87246cf56991f17d4767f1", "committedDate": "2020-12-15T07:09:06Z", "message": "Switch to use Ubuntu Xenial for running x86 and ARM64 CI"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUyNTg3OTE4", "url": "https://github.com/apache/storm/pull/3348#pullrequestreview-552587918", "createdAt": "2020-12-15T15:37:27Z", "commit": {"oid": "9446eb2b6cdc6c443e87246cf56991f17d4767f1"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxNTozNzoyN1rOIGRs1w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxNTozNzozOFrOIGRtfA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzQ1MjM3NQ==", "bodyText": "Is this change still needed after the change to arm64 and xenial", "url": "https://github.com/apache/storm/pull/3348#discussion_r543452375", "createdAt": "2020-12-15T15:37:27Z", "author": {"login": "Ethanlm"}, "path": "integration-test/run-it.sh", "diffHunk": "@@ -36,10 +36,13 @@ then\n   chmod o+rx /home/travis\n fi\n list_storm_processes || true\n-# increasing swap space so we can run lots of workers\n-sudo dd if=/dev/zero of=/swapfile.img bs=4096 count=1M\n-sudo mkswap /swapfile.img\n-sudo swapon /swapfile.img\n+if [ \"$(uname -m)\" != aarch64 ]; then", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9446eb2b6cdc6c443e87246cf56991f17d4767f1"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzQ1MjU0MA==", "bodyText": "Is this change still needed after the change to arm64 and xenial", "url": "https://github.com/apache/storm/pull/3348#discussion_r543452540", "createdAt": "2020-12-15T15:37:38Z", "author": {"login": "Ethanlm"}, "path": "integration-test/run-it.sh", "diffHunk": "@@ -101,3 +104,7 @@ for i in {1..20} ; do\n done\n list_storm_processes\n mvn test -DfailIfNoTests=false -DskipTests=false -Dstorm.version=${STORM_VERSION} -Dui.url=http://localhost:8744\n+\n+# Kill all storm processes after tests running, otherwise the Travis CI(ARM) will still wait and then fail by\n+# timeout error even though all the tests passed\n+sudo pkill -9 -u storm", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9446eb2b6cdc6c443e87246cf56991f17d4767f1"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU0MjM4NTQ1", "url": "https://github.com/apache/storm/pull/3348#pullrequestreview-554238545", "createdAt": "2020-12-17T02:38:31Z", "commit": {"oid": "9446eb2b6cdc6c443e87246cf56991f17d4767f1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4945, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}