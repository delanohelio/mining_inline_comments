{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ3MjE5NDQ3", "number": 3306, "title": "STORM-3671: Add TopologySummary methods to Nimbus", "bodyText": "What is the purpose of the change\nThe getClusterInfo method is being invoked where mostly a single call to get TopologySummary by Name or by Id should suffice.\n\nAdded methods to nimbus\nAdded implementation with mostly refactoring getClusternfoImpl\nAdded modified UI and CLI commands\n\nHow was the change tested\n\nLaunched UI and walked through all pages.\nmanually tested CLI commands.", "createdAt": "2020-07-10T04:40:42Z", "url": "https://github.com/apache/storm/pull/3306", "merged": true, "mergeCommit": {"oid": "f1c161949db066c35839116070892b86b8bd7e67"}, "closed": true, "closedAt": "2020-10-01T15:57:32Z", "author": {"login": "kishorvpatil"}, "timelineItems": {"totalCount": 26, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABczj2bkgBqjM1MzM5NTMyNDQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdKGum6gFqTQ5MTUzNDI0Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8b681c48c6dc4719507bba948f9b3ff7fe753290", "author": {"user": {"login": "kishorvpatil", "name": "Kishor Patil"}}, "url": "https://github.com/apache/storm/commit/8b681c48c6dc4719507bba948f9b3ff7fe753290", "committedDate": "2020-07-10T04:46:21Z", "message": "Merge branch 'master' of github.com:apache/storm into STORM-3671"}, "afterCommit": {"oid": "b45ddf14b3759679169162103aef155ccbc42e86", "author": {"user": {"login": "kishorvpatil", "name": "Kishor Patil"}}, "url": "https://github.com/apache/storm/commit/b45ddf14b3759679169162103aef155ccbc42e86", "committedDate": "2020-07-10T13:36:05Z", "message": "MINOR: Avoid fragmented resources on supervisor creation in nimbus (#3271)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "00033f6e8c27b7a3374ccc0f360feebbaf3b6daa", "author": {"user": {"login": "kishorvpatil", "name": "Kishor Patil"}}, "url": "https://github.com/apache/storm/commit/00033f6e8c27b7a3374ccc0f360feebbaf3b6daa", "committedDate": "2020-07-13T17:18:43Z", "message": "STORM-3671: Add TopologySummary methods to Nimbus"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4a5a3fb8bf289b06614062618cbd619f5a11fd7c", "author": {"user": {"login": "kishorvpatil", "name": "Kishor Patil"}}, "url": "https://github.com/apache/storm/commit/4a5a3fb8bf289b06614062618cbd619f5a11fd7c", "committedDate": "2020-07-13T17:19:12Z", "message": "MINOR: Avoid fragmented resources on supervisor creation in nimbus (#3271)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a58e447f53327479c29ab881ecd6a8393e4d739d", "author": {"user": {"login": "kishorvpatil", "name": "Kishor Patil"}}, "url": "https://github.com/apache/storm/commit/a58e447f53327479c29ab881ecd6a8393e4d739d", "committedDate": "2020-07-13T17:52:33Z", "message": "STORM-3671: Use getTopologySummary instead of getClusterInfo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6bfb4e8561717cd60fc969c570c6ede7b67a70dd", "author": {"user": {"login": "kishorvpatil", "name": "Kishor Patil"}}, "url": "https://github.com/apache/storm/commit/6bfb4e8561717cd60fc969c570c6ede7b67a70dd", "committedDate": "2020-07-13T17:52:44Z", "message": "STORM-3671: Add getTopologyInfoByName to Nimbus interface"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cc086aa73961840450bc2c32b2569b8a48c986e9", "author": {"user": {"login": "kishorvpatil", "name": "Kishor Patil"}}, "url": "https://github.com/apache/storm/commit/cc086aa73961840450bc2c32b2569b8a48c986e9", "committedDate": "2020-07-10T22:19:15Z", "message": "STORM-3671: Add getTopologyInfoByName to Nimbus interface"}, "afterCommit": {"oid": "6bfb4e8561717cd60fc969c570c6ede7b67a70dd", "author": {"user": {"login": "kishorvpatil", "name": "Kishor Patil"}}, "url": "https://github.com/apache/storm/commit/6bfb4e8561717cd60fc969c570c6ede7b67a70dd", "committedDate": "2020-07-13T17:52:44Z", "message": "STORM-3671: Add getTopologyInfoByName to Nimbus interface"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2NTM5NTU5", "url": "https://github.com/apache/storm/pull/3306#pullrequestreview-446539559", "createdAt": "2020-07-10T16:32:50Z", "commit": {"oid": "37929b40d227bdb792f8eb50154c459b1994a80b"}, "state": "COMMENTED", "comments": {"totalCount": 25, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQxNjozMjo1MFrOGv935g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxNjoxMjoyMlrOGyFPyw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjk0OTk5MA==", "bodyText": "suggest to import java.util.List and then use List directly\nsuggest to change to getTopologySummaries\ncan delete AuthorizationException", "url": "https://github.com/apache/storm/pull/3306#discussion_r452949990", "createdAt": "2020-07-10T16:32:50Z", "author": {"login": "Ethanlm"}, "path": "storm-client/src/jvm/org/apache/storm/ILocalCluster.java", "diffHunk": "@@ -135,6 +137,12 @@ ILocalTopology submitTopologyWithOpts(String topologyName, Map<String, Object> c\n      */\n     ClusterSummary getClusterInfo() throws TException;\n \n+    java.util.List<TopologySummary> getTopologySummaryInfo() throws AuthorizationException, TException;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "37929b40d227bdb792f8eb50154c459b1994a80b"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjk1MDQ4MA==", "bodyText": "String should be good enough.\ncan delete AuthorizationException, since it extends TException", "url": "https://github.com/apache/storm/pull/3306#discussion_r452950480", "createdAt": "2020-07-10T16:33:45Z", "author": {"login": "Ethanlm"}, "path": "storm-client/src/jvm/org/apache/storm/ILocalCluster.java", "diffHunk": "@@ -135,6 +137,12 @@ ILocalTopology submitTopologyWithOpts(String topologyName, Map<String, Object> c\n      */\n     ClusterSummary getClusterInfo() throws TException;\n \n+    java.util.List<TopologySummary> getTopologySummaryInfo() throws AuthorizationException, TException;\n+\n+    TopologySummary getTopologySummaryByName(java.lang.String name) throws AuthorizationException, TException;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "37929b40d227bdb792f8eb50154c459b1994a80b"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjk1MDUxNQ==", "bodyText": "String should be good enough.\ncan delete AuthorizationException , since it extends TException", "url": "https://github.com/apache/storm/pull/3306#discussion_r452950515", "createdAt": "2020-07-10T16:33:49Z", "author": {"login": "Ethanlm"}, "path": "storm-client/src/jvm/org/apache/storm/ILocalCluster.java", "diffHunk": "@@ -135,6 +137,12 @@ ILocalTopology submitTopologyWithOpts(String topologyName, Map<String, Object> c\n      */\n     ClusterSummary getClusterInfo() throws TException;\n \n+    java.util.List<TopologySummary> getTopologySummaryInfo() throws AuthorizationException, TException;\n+\n+    TopologySummary getTopologySummaryByName(java.lang.String name) throws AuthorizationException, TException;\n+\n+    TopologySummary getTopologySummaryById(java.lang.String id) throws AuthorizationException, TException;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "37929b40d227bdb792f8eb50154c459b1994a80b"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTA5NzE3MQ==", "bodyText": "I beliefve this is no longer needed, since if getTopologySummaryByName fails, getTopologySummaryByName will throw TException or RuntimeException.\nIf this is not the case, then other places where we invoke getTopologySummaryByName should also deal with the result=null.", "url": "https://github.com/apache/storm/pull/3306#discussion_r455097171", "createdAt": "2020-07-15T14:30:36Z", "author": {"login": "Ethanlm"}, "path": "examples/storm-starter/src/jvm/org/apache/storm/starter/InOrderDeliveryTest.java", "diffHunk": "@@ -40,16 +40,11 @@\n public class InOrderDeliveryTest {\n \n     public static void printMetrics(Nimbus.Iface client, String name) throws Exception {\n-        ClusterSummary summary = client.getClusterInfo();\n-        String id = null;\n-        for (TopologySummary ts : summary.get_topologies()) {\n-            if (name.equals(ts.get_name())) {\n-                id = ts.get_id();\n-            }\n-        }\n-        if (id == null) {\n+        TopologySummary ts = client.getTopologySummaryByName(name);\n+        if (ts == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6bfb4e8561717cd60fc969c570c6ede7b67a70dd"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTA5NzYyNA==", "bodyText": "This doesn't look right.", "url": "https://github.com/apache/storm/pull/3306#discussion_r455097624", "createdAt": "2020-07-15T14:31:06Z", "author": {"login": "Ethanlm"}, "path": "integration-test/src/test/java/org/apache/storm/st/wrapper/StormCluster.java", "diffHunk": "@@ -108,7 +108,7 @@ public TopologySummary getOneActive() throws TException {\n     }\n \n     public TopologyInfo getInfo(TopologySummary topologySummary) throws TException {\n-        return client.getTopologyInfo(topologySummary.get_id());\n+        return client.getTopologyInfoByName(topologySummary.get_id());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6bfb4e8561717cd60fc969c570c6ede7b67a70dd"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTExNDU3Nw==", "bodyText": "Will topologyInfo ever be null?", "url": "https://github.com/apache/storm/pull/3306#discussion_r455114577", "createdAt": "2020-07-15T14:53:05Z", "author": {"login": "Ethanlm"}, "path": "storm-core/src/jvm/org/apache/storm/command/GetErrors.java", "diffHunk": "@@ -42,15 +42,10 @@ public static void main(String[] args) throws Exception {\n             public void run(Nimbus.Iface client) throws Exception {\n                 GetInfoOptions opts = new GetInfoOptions();\n                 opts.set_num_err_choice(NumErrorsChoice.ONE);\n-                String topologyId = Utils.getTopologyId(name, client);\n-\n-                TopologyInfo topologyInfo = null;\n-                if (topologyId != null) {\n-                    topologyInfo = client.getTopologyInfoWithOpts(topologyId, opts);\n-                }\n+                TopologyInfo topologyInfo = client.getTopologyInfoByNameWithOpts(name, opts);\n \n                 Map<String, Object> outputMap = new HashMap<>();\n-                if (topologyId == null || topologyInfo == null) {\n+                if (topologyInfo == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6bfb4e8561717cd60fc969c570c6ede7b67a70dd"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTExNjA3MA==", "bodyText": "AuthorizationException can be removed", "url": "https://github.com/apache/storm/pull/3306#discussion_r455116070", "createdAt": "2020-07-15T14:54:28Z", "author": {"login": "Ethanlm"}, "path": "storm-server/src/main/java/org/apache/storm/LocalCluster.java", "diffHunk": "@@ -572,11 +573,43 @@ public ClusterSummary getClusterInfo() throws TException {\n         return getNimbus().getClusterInfo();\n     }\n \n+    @Override\n+    public List<TopologySummary> getTopologySummaries() throws AuthorizationException, TException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6bfb4e8561717cd60fc969c570c6ede7b67a70dd"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTExNjE5NQ==", "bodyText": "AuthorizationException can be removed", "url": "https://github.com/apache/storm/pull/3306#discussion_r455116195", "createdAt": "2020-07-15T14:54:34Z", "author": {"login": "Ethanlm"}, "path": "storm-server/src/main/java/org/apache/storm/LocalCluster.java", "diffHunk": "@@ -572,11 +573,43 @@ public ClusterSummary getClusterInfo() throws TException {\n         return getNimbus().getClusterInfo();\n     }\n \n+    @Override\n+    public List<TopologySummary> getTopologySummaries() throws AuthorizationException, TException {\n+        return getNimbus().getTopologySummaries();\n+    }\n+\n+    @Override\n+    public TopologySummary getTopologySummaryByName(String name) throws AuthorizationException, TException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6bfb4e8561717cd60fc969c570c6ede7b67a70dd"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTExNjI5NA==", "bodyText": "AuthorizationException can be removed", "url": "https://github.com/apache/storm/pull/3306#discussion_r455116294", "createdAt": "2020-07-15T14:54:39Z", "author": {"login": "Ethanlm"}, "path": "storm-server/src/main/java/org/apache/storm/LocalCluster.java", "diffHunk": "@@ -572,11 +573,43 @@ public ClusterSummary getClusterInfo() throws TException {\n         return getNimbus().getClusterInfo();\n     }\n \n+    @Override\n+    public List<TopologySummary> getTopologySummaries() throws AuthorizationException, TException {\n+        return getNimbus().getTopologySummaries();\n+    }\n+\n+    @Override\n+    public TopologySummary getTopologySummaryByName(String name) throws AuthorizationException, TException {\n+        return getNimbus().getTopologySummaryByName(name);\n+    }\n+\n+    @Override\n+    public TopologySummary getTopologySummaryById(String id) throws AuthorizationException, TException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6bfb4e8561717cd60fc969c570c6ede7b67a70dd"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTExNjU4OQ==", "bodyText": "NotAliveException, AuthorizationException can be removed", "url": "https://github.com/apache/storm/pull/3306#discussion_r455116589", "createdAt": "2020-07-15T14:54:54Z", "author": {"login": "Ethanlm"}, "path": "storm-server/src/main/java/org/apache/storm/LocalCluster.java", "diffHunk": "@@ -572,11 +573,43 @@ public ClusterSummary getClusterInfo() throws TException {\n         return getNimbus().getClusterInfo();\n     }\n \n+    @Override\n+    public List<TopologySummary> getTopologySummaries() throws AuthorizationException, TException {\n+        return getNimbus().getTopologySummaries();\n+    }\n+\n+    @Override\n+    public TopologySummary getTopologySummaryByName(String name) throws AuthorizationException, TException {\n+        return getNimbus().getTopologySummaryByName(name);\n+    }\n+\n+    @Override\n+    public TopologySummary getTopologySummaryById(String id) throws AuthorizationException, TException {\n+        return getNimbus().getTopologySummaryById(id);\n+    }\n+\n     @Override\n     public TopologyInfo getTopologyInfo(String id) throws TException {\n         return getNimbus().getTopologyInfo(id);\n     }\n \n+    @Override\n+    public TopologyInfo getTopologyInfoByName(String name) throws TException {\n+        return getNimbus().getTopologyInfoByName(name);\n+    }\n+\n+    @Override\n+    public TopologyInfo getTopologyInfoWithOpts(String id, GetInfoOptions options) throws NotAliveException, AuthorizationException,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6bfb4e8561717cd60fc969c570c6ede7b67a70dd"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTExNjY3Mg==", "bodyText": "NotAliveException, AuthorizationException can be removed", "url": "https://github.com/apache/storm/pull/3306#discussion_r455116672", "createdAt": "2020-07-15T14:54:58Z", "author": {"login": "Ethanlm"}, "path": "storm-server/src/main/java/org/apache/storm/LocalCluster.java", "diffHunk": "@@ -572,11 +573,43 @@ public ClusterSummary getClusterInfo() throws TException {\n         return getNimbus().getClusterInfo();\n     }\n \n+    @Override\n+    public List<TopologySummary> getTopologySummaries() throws AuthorizationException, TException {\n+        return getNimbus().getTopologySummaries();\n+    }\n+\n+    @Override\n+    public TopologySummary getTopologySummaryByName(String name) throws AuthorizationException, TException {\n+        return getNimbus().getTopologySummaryByName(name);\n+    }\n+\n+    @Override\n+    public TopologySummary getTopologySummaryById(String id) throws AuthorizationException, TException {\n+        return getNimbus().getTopologySummaryById(id);\n+    }\n+\n     @Override\n     public TopologyInfo getTopologyInfo(String id) throws TException {\n         return getNimbus().getTopologyInfo(id);\n     }\n \n+    @Override\n+    public TopologyInfo getTopologyInfoByName(String name) throws TException {\n+        return getNimbus().getTopologyInfoByName(name);\n+    }\n+\n+    @Override\n+    public TopologyInfo getTopologyInfoWithOpts(String id, GetInfoOptions options) throws NotAliveException, AuthorizationException,\n+        TException {\n+        return nimbus.getTopologyInfoWithOpts(id, options);\n+    }\n+\n+    @Override\n+    public TopologyInfo getTopologyInfoByNameWithOpts(String name, GetInfoOptions options) throws NotAliveException, AuthorizationException,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6bfb4e8561717cd60fc969c570c6ede7b67a70dd"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTEyMTgzMg==", "bodyText": "I noticed that there is syntax change here. Before the change, getTopologyId returns null when it couldn't get the summary. But with the change, it will throw exceptions when there is no such topology with this name. Is there any impact here?", "url": "https://github.com/apache/storm/pull/3306#discussion_r455121832", "createdAt": "2020-07-15T15:01:12Z", "author": {"login": "Ethanlm"}, "path": "storm-client/src/jvm/org/apache/storm/utils/Utils.java", "diffHunk": "@@ -1188,28 +1188,18 @@ static boolean isValidConf(Map<String, Object> orig, Map<String, Object> deser)\n \n     public static TopologyInfo getTopologyInfo(String name, String asUser, Map<String, Object> topoConf) {\n         try (NimbusClient client = NimbusClient.getConfiguredClientAs(topoConf, asUser)) {\n-            String topologyId = getTopologyId(name, client.getClient());\n-            if (null != topologyId) {\n-                return client.getClient().getTopologyInfo(topologyId);\n-            }\n-            return null;\n+            return client.getClient().getTopologyInfoByName(name);\n         } catch (Exception e) {\n             throw new RuntimeException(e);\n         }\n     }\n \n     public static String getTopologyId(String name, Nimbus.Iface client) {\n         try {\n-            ClusterSummary summary = client.getClusterInfo();\n-            for (TopologySummary s : summary.get_topologies()) {\n-                if (s.get_name().equals(name)) {\n-                    return s.get_id();\n-                }\n-            }\n+            return client.getTopologySummaryByName(name).get_id();\n         } catch (Exception e) {\n             throw new RuntimeException(e);\n         }\n-        return null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6bfb4e8561717cd60fc969c570c6ede7b67a70dd"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTEyMzA1Mw==", "bodyText": "Will it ever be null? Looks to me getTopologySummaryByName throws exception if it can't find the topo", "url": "https://github.com/apache/storm/pull/3306#discussion_r455123053", "createdAt": "2020-07-15T15:02:50Z", "author": {"login": "Ethanlm"}, "path": "storm-server/src/test/java/org/apache/storm/TestRebalance.java", "diffHunk": "@@ -151,28 +151,22 @@ public void waitTopologyScheduled(String topoName, ILocalCluster cluster, int re\n \n     public boolean checkTopologyScheduled(String topoName, ILocalCluster cluster) throws TException {\n         if (checkTopologyUp(topoName, cluster)) {\n-            ClusterSummary sum = cluster.getClusterInfo();\n-            for (TopologySummary topoSum : sum.get_topologies()) {\n-                if (topoSum.get_name().equals(topoName)) {\n-                    String status = topoSum.get_status();\n-                    String sched_status = topoSum.get_sched_status();\n-                    if (status.equals(\"ACTIVE\") && (sched_status != null && !sched_status.equals(\"\"))) {\n-                        return true;\n-                    }\n-                }\n+            TopologySummary topoSum = cluster.getTopologySummaryByName(topoName);\n+            String status = topoSum.get_status();\n+            String sched_status = topoSum.get_sched_status();\n+            if (status.equals(\"ACTIVE\") && (sched_status != null && !sched_status.equals(\"\"))) {\n+                return true;\n             }\n         }\n         return false;\n     }\n \n     public boolean checkTopologyUp(String topoName, ILocalCluster cluster) throws TException {\n         ClusterSummary sum = cluster.getClusterInfo();\n-\n-        for (TopologySummary topoSum : sum.get_topologies()) {\n-            if (topoSum.get_name().equals(topoName)) {\n+        TopologySummary topoSum = cluster.getTopologySummaryByName(topoName);\n+            if (topoSum != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6bfb4e8561717cd60fc969c570c6ede7b67a70dd"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTEyNDg3OA==", "bodyText": "Why will the returned topologySummary.get_name != topoName?", "url": "https://github.com/apache/storm/pull/3306#discussion_r455124878", "createdAt": "2020-07-15T15:05:28Z", "author": {"login": "Ethanlm"}, "path": "storm-server/src/test/java/org/apache/storm/TestRebalance.java", "diffHunk": "@@ -43,11 +44,10 @@\n     private static final Logger LOG = LoggerFactory.getLogger(TestRebalance.class);\n \n     public static String topoNameToId(String topoName, ILocalCluster cluster) throws TException {\n-        for (TopologySummary topoSum : cluster.getClusterInfo().get_topologies()) {\n+        TopologySummary topoSum = cluster.getTopologySummaryByName(topoName);\n             if (topoSum.get_name().equals(topoName)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6bfb4e8561717cd60fc969c570c6ede7b67a70dd"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTE0MzcyMQ==", "bodyText": "We need to update docs/ClusterMetrics.md too", "url": "https://github.com/apache/storm/pull/3306#discussion_r455143721", "createdAt": "2020-07-15T15:32:17Z", "author": {"login": "Ethanlm"}, "path": "storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java", "diffHunk": "@@ -502,11 +507,16 @@ public Nimbus(Map<String, Object> conf, INimbus inimbus, IStormClusterState stor\n         this.getTopologyCalls = metricsRegistry.registerMeter(\"nimbus:num-getTopology-calls\");\n         this.getUserTopologyCalls = metricsRegistry.registerMeter(\"nimbus:num-getUserTopology-calls\");\n         this.getClusterInfoCalls = metricsRegistry.registerMeter(\"nimbus:num-getClusterInfo-calls\");\n+        this.getTopologySummariesCalls = metricsRegistry.registerMeter(\"nimbus:num-getTopologySummaries-calls\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6bfb4e8561717cd60fc969c570c6ede7b67a70dd"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTE1OTE4MQ==", "bodyText": "AuthorizationException is not needed", "url": "https://github.com/apache/storm/pull/3306#discussion_r455159181", "createdAt": "2020-07-15T15:57:08Z", "author": {"login": "Ethanlm"}, "path": "storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java", "diffHunk": "@@ -2968,16 +2978,14 @@ private SupervisorSummary makeSupervisorSummary(String supervisorId, SupervisorI\n         return ret;\n     }\n \n-    private ClusterSummary getClusterInfoImpl() throws Exception {\n+    private ClusterSummary getClusterInfoImpl() throws Exception, AuthorizationException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6bfb4e8561717cd60fc969c570c6ede7b67a70dd"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTE2MDcyNQ==", "bodyText": "This might should be getTopologyInfoByNameWithOptsImpl?", "url": "https://github.com/apache/storm/pull/3306#discussion_r455160725", "createdAt": "2020-07-15T15:59:36Z", "author": {"login": "Ethanlm"}, "path": "storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java", "diffHunk": "@@ -4056,6 +4077,45 @@ public TopologyInfo getTopologyInfo(String id) throws NotAliveException, Authori\n         }\n     }\n \n+    @Override\n+    public TopologyInfo getTopologyInfoByName(String name) throws NotAliveException, AuthorizationException, TException {\n+        try {\n+            getTopologyInfoByNameCalls.mark();\n+            GetInfoOptions options = new GetInfoOptions();\n+            options.set_num_err_choice(NumErrorsChoice.ALL);\n+\n+            return getTopologyInfoByNameImpl(name, options);\n+        } catch (Exception e) {\n+            LOG.warn(\"get topology info exception. (topology name={})\", name, e);\n+            if (e instanceof TException) {\n+                throw (TException) e;\n+            }\n+            throw new RuntimeException(e);\n+        }\n+    }\n+\n+    private TopologyInfo getTopologyInfoByNameImpl(String name, GetInfoOptions options) throws", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6bfb4e8561717cd60fc969c570c6ede7b67a70dd"}, "originalPosition": 216}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTE2MTk4Ng==", "bodyText": "base can be null if this topology doesn't exist. Then there will be NullPointerException in getTopologySummary(id, base) . Is this intended?", "url": "https://github.com/apache/storm/pull/3306#discussion_r455161986", "createdAt": "2020-07-15T16:01:40Z", "author": {"login": "Ethanlm"}, "path": "storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java", "diffHunk": "@@ -4654,6 +4714,55 @@ public ClusterSummary getClusterInfo() throws AuthorizationException, TException\n         }\n     }\n \n+    @Override\n+    public List<TopologySummary> getTopologySummaries() throws AuthorizationException, TException {\n+        try {\n+            getTopologySummariesCalls.mark();\n+            checkAuthorization(null, null, \"getTopologySummaries\");\n+            return getTopologySummariesImpl();\n+        } catch (Exception e) {\n+            LOG.warn(\"Get TopologySummary info exception.\", e);\n+            if (e instanceof TException) {\n+                throw (TException) e;\n+            }\n+            throw new RuntimeException(e);\n+        }\n+    }\n+\n+    @Override\n+    public TopologySummary getTopologySummaryByName(String name) throws AuthorizationException, TException {\n+        try {\n+            getTopologySummaryByNameCalls.mark();\n+            checkAuthorization(null, null, \"getTopologySummaries\");\n+            IStormClusterState state = stormClusterState;\n+            String topoId = state.getTopoId(name).orElseThrow(() -> new WrappedNotAliveException(name + \" is not alive\"));\n+            return getTopologySummary(topoId, state.topologyBases().get(topoId));\n+        } catch (Exception e) {\n+            LOG.warn(\"Get TopologySummaryByName info exception.\", e);\n+            if (e instanceof TException) {\n+                throw (TException) e;\n+            }\n+            throw new RuntimeException(e);\n+        }\n+    }\n+\n+    @Override\n+    public TopologySummary getTopologySummaryById(String id) throws AuthorizationException, TException {\n+        try {\n+            getTopologySummaryByIdCalls.mark();\n+            IStormClusterState state = stormClusterState;\n+            StormBase base = state.topologyBases().get(id);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6bfb4e8561717cd60fc969c570c6ede7b67a70dd"}, "originalPosition": 300}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTE2NDUzNg==", "bodyText": "Why is this getTopology while getTopologySummaryByName uses getTopologySummaries\nShould we have getTopologySummaryByName for getTopologySummaryByName method and getTopologySummaryById for getTopologySummaryById method?", "url": "https://github.com/apache/storm/pull/3306#discussion_r455164536", "createdAt": "2020-07-15T16:06:08Z", "author": {"login": "Ethanlm"}, "path": "storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java", "diffHunk": "@@ -4654,6 +4714,55 @@ public ClusterSummary getClusterInfo() throws AuthorizationException, TException\n         }\n     }\n \n+    @Override\n+    public List<TopologySummary> getTopologySummaries() throws AuthorizationException, TException {\n+        try {\n+            getTopologySummariesCalls.mark();\n+            checkAuthorization(null, null, \"getTopologySummaries\");\n+            return getTopologySummariesImpl();\n+        } catch (Exception e) {\n+            LOG.warn(\"Get TopologySummary info exception.\", e);\n+            if (e instanceof TException) {\n+                throw (TException) e;\n+            }\n+            throw new RuntimeException(e);\n+        }\n+    }\n+\n+    @Override\n+    public TopologySummary getTopologySummaryByName(String name) throws AuthorizationException, TException {\n+        try {\n+            getTopologySummaryByNameCalls.mark();\n+            checkAuthorization(null, null, \"getTopologySummaries\");\n+            IStormClusterState state = stormClusterState;\n+            String topoId = state.getTopoId(name).orElseThrow(() -> new WrappedNotAliveException(name + \" is not alive\"));\n+            return getTopologySummary(topoId, state.topologyBases().get(topoId));\n+        } catch (Exception e) {\n+            LOG.warn(\"Get TopologySummaryByName info exception.\", e);\n+            if (e instanceof TException) {\n+                throw (TException) e;\n+            }\n+            throw new RuntimeException(e);\n+        }\n+    }\n+\n+    @Override\n+    public TopologySummary getTopologySummaryById(String id) throws AuthorizationException, TException {\n+        try {\n+            getTopologySummaryByIdCalls.mark();\n+            IStormClusterState state = stormClusterState;\n+            StormBase base = state.topologyBases().get(id);\n+            checkAuthorization(null, null, \"getTopology\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6bfb4e8561717cd60fc969c570c6ede7b67a70dd"}, "originalPosition": 301}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTE2NzEzNg==", "bodyText": "Looks like we don't need NotAliveException, AuthorizationException", "url": "https://github.com/apache/storm/pull/3306#discussion_r455167136", "createdAt": "2020-07-15T16:10:52Z", "author": {"login": "Ethanlm"}, "path": "storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java", "diffHunk": "@@ -4056,6 +4077,45 @@ public TopologyInfo getTopologyInfo(String id) throws NotAliveException, Authori\n         }\n     }\n \n+    @Override\n+    public TopologyInfo getTopologyInfoByName(String name) throws NotAliveException, AuthorizationException, TException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6bfb4e8561717cd60fc969c570c6ede7b67a70dd"}, "originalPosition": 200}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTE2NzMzNw==", "bodyText": "looks like we don't need NotAliveException, AuthorizationException", "url": "https://github.com/apache/storm/pull/3306#discussion_r455167337", "createdAt": "2020-07-15T16:11:11Z", "author": {"login": "Ethanlm"}, "path": "storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java", "diffHunk": "@@ -4056,6 +4077,45 @@ public TopologyInfo getTopologyInfo(String id) throws NotAliveException, Authori\n         }\n     }\n \n+    @Override\n+    public TopologyInfo getTopologyInfoByName(String name) throws NotAliveException, AuthorizationException, TException {\n+        try {\n+            getTopologyInfoByNameCalls.mark();\n+            GetInfoOptions options = new GetInfoOptions();\n+            options.set_num_err_choice(NumErrorsChoice.ALL);\n+\n+            return getTopologyInfoByNameImpl(name, options);\n+        } catch (Exception e) {\n+            LOG.warn(\"get topology info exception. (topology name={})\", name, e);\n+            if (e instanceof TException) {\n+                throw (TException) e;\n+            }\n+            throw new RuntimeException(e);\n+        }\n+    }\n+\n+    private TopologyInfo getTopologyInfoByNameImpl(String name, GetInfoOptions options) throws\n+        NotAliveException, AuthorizationException, TException {\n+        IStormClusterState state = stormClusterState;\n+        String id = state.getTopoId(name).orElseThrow(() -> new WrappedNotAliveException(name + \" is not alive\"));\n+        return getTopologyInfoWithOpts(id, options);\n+    }\n+\n+    @Override\n+    public TopologyInfo getTopologyInfoByNameWithOpts(String name, GetInfoOptions options) throws\n+        NotAliveException, AuthorizationException, TException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6bfb4e8561717cd60fc969c570c6ede7b67a70dd"}, "originalPosition": 225}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTE2NzU4Ng==", "bodyText": "looks like we don't need AuthorizationException", "url": "https://github.com/apache/storm/pull/3306#discussion_r455167586", "createdAt": "2020-07-15T16:11:38Z", "author": {"login": "Ethanlm"}, "path": "storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java", "diffHunk": "@@ -4654,6 +4714,55 @@ public ClusterSummary getClusterInfo() throws AuthorizationException, TException\n         }\n     }\n \n+    @Override\n+    public List<TopologySummary> getTopologySummaries() throws AuthorizationException, TException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6bfb4e8561717cd60fc969c570c6ede7b67a70dd"}, "originalPosition": 264}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTE2NzYxNg==", "bodyText": "looks like we don't need AuthorizationException", "url": "https://github.com/apache/storm/pull/3306#discussion_r455167616", "createdAt": "2020-07-15T16:11:42Z", "author": {"login": "Ethanlm"}, "path": "storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java", "diffHunk": "@@ -4654,6 +4714,55 @@ public ClusterSummary getClusterInfo() throws AuthorizationException, TException\n         }\n     }\n \n+    @Override\n+    public List<TopologySummary> getTopologySummaries() throws AuthorizationException, TException {\n+        try {\n+            getTopologySummariesCalls.mark();\n+            checkAuthorization(null, null, \"getTopologySummaries\");\n+            return getTopologySummariesImpl();\n+        } catch (Exception e) {\n+            LOG.warn(\"Get TopologySummary info exception.\", e);\n+            if (e instanceof TException) {\n+                throw (TException) e;\n+            }\n+            throw new RuntimeException(e);\n+        }\n+    }\n+\n+    @Override\n+    public TopologySummary getTopologySummaryByName(String name) throws AuthorizationException, TException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6bfb4e8561717cd60fc969c570c6ede7b67a70dd"}, "originalPosition": 279}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTE2NzY1Mw==", "bodyText": "looks like we don't need AuthorizationException", "url": "https://github.com/apache/storm/pull/3306#discussion_r455167653", "createdAt": "2020-07-15T16:11:46Z", "author": {"login": "Ethanlm"}, "path": "storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java", "diffHunk": "@@ -4654,6 +4714,55 @@ public ClusterSummary getClusterInfo() throws AuthorizationException, TException\n         }\n     }\n \n+    @Override\n+    public List<TopologySummary> getTopologySummaries() throws AuthorizationException, TException {\n+        try {\n+            getTopologySummariesCalls.mark();\n+            checkAuthorization(null, null, \"getTopologySummaries\");\n+            return getTopologySummariesImpl();\n+        } catch (Exception e) {\n+            LOG.warn(\"Get TopologySummary info exception.\", e);\n+            if (e instanceof TException) {\n+                throw (TException) e;\n+            }\n+            throw new RuntimeException(e);\n+        }\n+    }\n+\n+    @Override\n+    public TopologySummary getTopologySummaryByName(String name) throws AuthorizationException, TException {\n+        try {\n+            getTopologySummaryByNameCalls.mark();\n+            checkAuthorization(null, null, \"getTopologySummaries\");\n+            IStormClusterState state = stormClusterState;\n+            String topoId = state.getTopoId(name).orElseThrow(() -> new WrappedNotAliveException(name + \" is not alive\"));\n+            return getTopologySummary(topoId, state.topologyBases().get(topoId));\n+        } catch (Exception e) {\n+            LOG.warn(\"Get TopologySummaryByName info exception.\", e);\n+            if (e instanceof TException) {\n+                throw (TException) e;\n+            }\n+            throw new RuntimeException(e);\n+        }\n+    }\n+\n+    @Override\n+    public TopologySummary getTopologySummaryById(String id) throws AuthorizationException, TException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6bfb4e8561717cd60fc969c570c6ede7b67a70dd"}, "originalPosition": 296}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTE2Nzk0Nw==", "bodyText": "I think this is better to be getTopologySummary (without ById) since other functions don't have ById when it is getting information by id, e.g. getTopologyInfo, getTopologyPageInfo, getTopologyConf, getTopology, etc", "url": "https://github.com/apache/storm/pull/3306#discussion_r455167947", "createdAt": "2020-07-15T16:12:22Z", "author": {"login": "Ethanlm"}, "path": "storm-client/src/storm.thrift", "diffHunk": "@@ -777,9 +777,14 @@ service Nimbus {\n   string getNimbusConf() throws (1: AuthorizationException aze);\n   // stats functions\n   ClusterSummary getClusterInfo() throws (1: AuthorizationException aze);\n+  list<TopologySummary> getTopologySummaries() throws (1: AuthorizationException aze);\n+  TopologySummary getTopologySummaryByName(1: string name) throws (1: AuthorizationException aze);\n+  TopologySummary getTopologySummaryById(1: string id) throws (1: AuthorizationException aze);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6bfb4e8561717cd60fc969c570c6ede7b67a70dd"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b60256a144da2d6f20cff3e36e27a990486a4272", "author": {"user": {"login": "kishorvpatil", "name": "Kishor Patil"}}, "url": "https://github.com/apache/storm/commit/b60256a144da2d6f20cff3e36e27a990486a4272", "committedDate": "2020-07-15T19:50:14Z", "message": "STORM-3671: Modify function arg to Auth check and refactoring"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "878feee52ad7f30ae928d0a22dda505c391ab4d9", "author": {"user": {"login": "kishorvpatil", "name": "Kishor Patil"}}, "url": "https://github.com/apache/storm/commit/878feee52ad7f30ae928d0a22dda505c391ab4d9", "committedDate": "2020-07-15T19:51:50Z", "message": "Merge branch 'master' of github.com:apache/storm into STORM-3671"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d3f94e540a9aa9dd1307c8324a83379b89cd5731", "author": {"user": {"login": "kishorvpatil", "name": "Kishor Patil"}}, "url": "https://github.com/apache/storm/commit/d3f94e540a9aa9dd1307c8324a83379b89cd5731", "committedDate": "2020-07-16T19:32:00Z", "message": "STORM-3671: Update getTopologySummary nimbus interface"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1b9acedd26ac0d2e962dabf3e650c958608fa91b", "author": {"user": {"login": "kishorvpatil", "name": "Kishor Patil"}}, "url": "https://github.com/apache/storm/commit/1b9acedd26ac0d2e962dabf3e650c958608fa91b", "committedDate": "2020-07-16T20:40:30Z", "message": "STORM-3671: Remove AuthorizationException from signature"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5f76f6f1cfd1f656499026752f9f88554351c3fd", "author": {"user": {"login": "kishorvpatil", "name": "Kishor Patil"}}, "url": "https://github.com/apache/storm/commit/5f76f6f1cfd1f656499026752f9f88554351c3fd", "committedDate": "2020-07-16T21:04:35Z", "message": "revert changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwOTM5MzY5", "url": "https://github.com/apache/storm/pull/3306#pullrequestreview-450939369", "createdAt": "2020-07-17T20:30:01Z", "commit": {"oid": "5f76f6f1cfd1f656499026752f9f88554351c3fd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QyMDozMDowMVrOGzgT8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QyMDozMDowMVrOGzgT8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjY1OTk1NQ==", "bodyText": "getTopologyInfoByName and getTopologyInfoByNameWithOpts need here?", "url": "https://github.com/apache/storm/pull/3306#discussion_r456659955", "createdAt": "2020-07-17T20:30:01Z", "author": {"login": "bipinprasad"}, "path": "storm-client/src/jvm/org/apache/storm/security/auth/authorizer/SimpleACLAuthorizer.java", "diffHunk": "@@ -40,6 +40,11 @@\n         \"fileUpload\",\n         \"getNimbusConf\",\n         \"getClusterInfo\",\n+        \"getLeader\",\n+        \"isTopologyNameAllowed\",\n+        \"getTopologySummaries\",\n+        \"getTopologySummaryByName\",\n+        \"getTopologySummary\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5f76f6f1cfd1f656499026752f9f88554351c3fd"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7107cb402130025a013bc38ffd97b0bf0dd001f3", "author": {"user": {"login": "kishorvpatil", "name": "Kishor Patil"}}, "url": "https://github.com/apache/storm/commit/7107cb402130025a013bc38ffd97b0bf0dd001f3", "committedDate": "2020-07-21T19:09:10Z", "message": "Addressing review comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "58166f82dbff73acfa4a1ec6b2f53079465b6aa8", "author": {"user": {"login": "kishorvpatil", "name": "Kishor Patil"}}, "url": "https://github.com/apache/storm/commit/58166f82dbff73acfa4a1ec6b2f53079465b6aa8", "committedDate": "2020-07-29T16:30:28Z", "message": "Remove unnecessary null check"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3NzU2NTY5", "url": "https://github.com/apache/storm/pull/3306#pullrequestreview-457756569", "createdAt": "2020-07-29T17:53:40Z", "commit": {"oid": "58166f82dbff73acfa4a1ec6b2f53079465b6aa8"}, "state": "COMMENTED", "comments": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxNzo1Mzo0MFrOG5Do1Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQwNDo1NTozNFrOG-BYkg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjQ4MTYyMQ==", "bodyText": "This comment is a little confusing to me. Does it mean \"to choose number of Errors in TopologyInfo\"?", "url": "https://github.com/apache/storm/pull/3306#discussion_r462481621", "createdAt": "2020-07-29T17:53:40Z", "author": {"login": "Ethanlm"}, "path": "storm-client/src/jvm/org/apache/storm/ILocalCluster.java", "diffHunk": "@@ -144,6 +154,35 @@ ILocalTopology submitTopologyWithOpts(String topologyName, Map<String, Object> c\n      */\n     TopologyInfo getTopologyInfo(String id) throws TException;\n \n+    /**\n+     * Get the state of a topology.\n+     *\n+     * @param name the name of the topology (not the id)\n+     * @return the state of a topology\n+     * @throws TException on any error from nimbus\n+     */\n+    TopologyInfo getTopologyInfoByName(String name) throws TException;\n+\n+    /**\n+     * Get the state of a topology.\n+     *\n+     * @param id the id of the topology (not the name)\n+     * @param options This is GetInfoOptions to choose Error(s) in on TopologyInfo.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "58166f82dbff73acfa4a1ec6b2f53079465b6aa8"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY3NzY3Nw==", "bodyText": "Can we use TopologyInfo info = client.getTopologyInfoByName(name); here directly?\ninstead of\nTopologySummary ts = client.getTopologySummaryByName(name);\nString id = ts.get_id();\nTopologyInfo info = client.getTopologyInfo(id);\n\nhere", "url": "https://github.com/apache/storm/pull/3306#discussion_r467677677", "createdAt": "2020-08-10T03:58:13Z", "author": {"login": "Ethanlm"}, "path": "examples/storm-starter/src/jvm/org/apache/storm/starter/InOrderDeliveryTest.java", "diffHunk": "@@ -40,16 +40,8 @@\n public class InOrderDeliveryTest {\n \n     public static void printMetrics(Nimbus.Iface client, String name) throws Exception {\n-        ClusterSummary summary = client.getClusterInfo();\n-        String id = null;\n-        for (TopologySummary ts : summary.get_topologies()) {\n-            if (name.equals(ts.get_name())) {\n-                id = ts.get_id();\n-            }\n-        }\n-        if (id == null) {\n-            throw new Exception(\"Could not find a topology named \" + name);\n-        }\n+        TopologySummary ts = client.getTopologySummaryByName(name);\n+        String id = ts.get_id();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "58166f82dbff73acfa4a1ec6b2f53079465b6aa8"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY4MDQ4Mg==", "bodyText": "I noticed that there is syntax change here. Before the change, getTopologyId returns null when it couldn't get the summary. But with the change, it will throw exceptions when there is no such topology with this name. Is there any impact here?\n\nThis change has some impact on backward compatibility since the syntax is changed here. The caller of this method might reply on the returned result == null to know if the topology is alive or not.\nFor example:\nhttps://github.com/apache/storm/blob/master/storm-core/src/jvm/org/apache/storm/command/SetLogLevel.java#L58-L59\nUser code might do this too. Maybe Utils. getTopologyId should return null if the topology is not alive / does not exist.", "url": "https://github.com/apache/storm/pull/3306#discussion_r467680482", "createdAt": "2020-08-10T04:14:55Z", "author": {"login": "Ethanlm"}, "path": "storm-client/src/jvm/org/apache/storm/utils/Utils.java", "diffHunk": "@@ -1188,28 +1188,18 @@ static boolean isValidConf(Map<String, Object> orig, Map<String, Object> deser)\n \n     public static TopologyInfo getTopologyInfo(String name, String asUser, Map<String, Object> topoConf) {\n         try (NimbusClient client = NimbusClient.getConfiguredClientAs(topoConf, asUser)) {\n-            String topologyId = getTopologyId(name, client.getClient());\n-            if (null != topologyId) {\n-                return client.getClient().getTopologyInfo(topologyId);\n-            }\n-            return null;\n+            return client.getClient().getTopologyInfoByName(name);\n         } catch (Exception e) {\n             throw new RuntimeException(e);\n         }\n     }\n \n     public static String getTopologyId(String name, Nimbus.Iface client) {\n         try {\n-            ClusterSummary summary = client.getClusterInfo();\n-            for (TopologySummary s : summary.get_topologies()) {\n-                if (s.get_name().equals(name)) {\n-                    return s.get_id();\n-                }\n-            }\n+            return client.getTopologySummaryByName(name).get_id();\n         } catch (Exception e) {\n             throw new RuntimeException(e);\n         }\n-        return null;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTEyMTgzMg=="}, "originalCommit": {"oid": "6bfb4e8561717cd60fc969c570c6ede7b67a70dd"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY4MjIxNw==", "bodyText": "Will topologyInfo ever be null?\n\nWith the implementation in this PR, getTopologyInfoByNameWithOpts will throw an WrappedNotAliveException (an TException) if the topology is not alive. So the result will never be null. We need a different check here.", "url": "https://github.com/apache/storm/pull/3306#discussion_r467682217", "createdAt": "2020-08-10T04:25:13Z", "author": {"login": "Ethanlm"}, "path": "storm-core/src/jvm/org/apache/storm/command/GetErrors.java", "diffHunk": "@@ -42,15 +42,10 @@ public static void main(String[] args) throws Exception {\n             public void run(Nimbus.Iface client) throws Exception {\n                 GetInfoOptions opts = new GetInfoOptions();\n                 opts.set_num_err_choice(NumErrorsChoice.ONE);\n-                String topologyId = Utils.getTopologyId(name, client);\n-\n-                TopologyInfo topologyInfo = null;\n-                if (topologyId != null) {\n-                    topologyInfo = client.getTopologyInfoWithOpts(topologyId, opts);\n-                }\n+                TopologyInfo topologyInfo = client.getTopologyInfoByNameWithOpts(name, opts);\n \n                 Map<String, Object> outputMap = new HashMap<>();\n-                if (topologyId == null || topologyInfo == null) {\n+                if (topologyInfo == null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTExNDU3Nw=="}, "originalCommit": {"oid": "6bfb4e8561717cd60fc969c570c6ede7b67a70dd"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY4NTEzMA==", "bodyText": "Why will the returned topologySummary.get_name != topoName?\n\nI believe this line can be removed", "url": "https://github.com/apache/storm/pull/3306#discussion_r467685130", "createdAt": "2020-08-10T04:41:51Z", "author": {"login": "Ethanlm"}, "path": "storm-server/src/test/java/org/apache/storm/TestRebalance.java", "diffHunk": "@@ -43,11 +44,10 @@\n     private static final Logger LOG = LoggerFactory.getLogger(TestRebalance.class);\n \n     public static String topoNameToId(String topoName, ILocalCluster cluster) throws TException {\n-        for (TopologySummary topoSum : cluster.getClusterInfo().get_topologies()) {\n+        TopologySummary topoSum = cluster.getTopologySummaryByName(topoName);\n             if (topoSum.get_name().equals(topoName)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTEyNDg3OA=="}, "originalCommit": {"oid": "6bfb4e8561717cd60fc969c570c6ede7b67a70dd"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY4NTQ0MQ==", "bodyText": "Will it ever be null? Looks to me getTopologySummaryByName throws exception if it can't find the topo\n\nCurrent implementation in the PR will throw exception if the topology can't be find (when calling getTopologySummaryByName). So we need to try-catch block to determine if this topology is up or not, instead of checking topoSum!=null.", "url": "https://github.com/apache/storm/pull/3306#discussion_r467685441", "createdAt": "2020-08-10T04:43:34Z", "author": {"login": "Ethanlm"}, "path": "storm-server/src/test/java/org/apache/storm/TestRebalance.java", "diffHunk": "@@ -151,28 +151,22 @@ public void waitTopologyScheduled(String topoName, ILocalCluster cluster, int re\n \n     public boolean checkTopologyScheduled(String topoName, ILocalCluster cluster) throws TException {\n         if (checkTopologyUp(topoName, cluster)) {\n-            ClusterSummary sum = cluster.getClusterInfo();\n-            for (TopologySummary topoSum : sum.get_topologies()) {\n-                if (topoSum.get_name().equals(topoName)) {\n-                    String status = topoSum.get_status();\n-                    String sched_status = topoSum.get_sched_status();\n-                    if (status.equals(\"ACTIVE\") && (sched_status != null && !sched_status.equals(\"\"))) {\n-                        return true;\n-                    }\n-                }\n+            TopologySummary topoSum = cluster.getTopologySummaryByName(topoName);\n+            String status = topoSum.get_status();\n+            String sched_status = topoSum.get_sched_status();\n+            if (status.equals(\"ACTIVE\") && (sched_status != null && !sched_status.equals(\"\"))) {\n+                return true;\n             }\n         }\n         return false;\n     }\n \n     public boolean checkTopologyUp(String topoName, ILocalCluster cluster) throws TException {\n         ClusterSummary sum = cluster.getClusterInfo();\n-\n-        for (TopologySummary topoSum : sum.get_topologies()) {\n-            if (topoSum.get_name().equals(topoName)) {\n+        TopologySummary topoSum = cluster.getTopologySummaryByName(topoName);\n+            if (topoSum != null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTEyMzA1Mw=="}, "originalCommit": {"oid": "6bfb4e8561717cd60fc969c570c6ede7b67a70dd"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY4NjI2Mw==", "bodyText": "AuthorizationException is not needed", "url": "https://github.com/apache/storm/pull/3306#discussion_r467686263", "createdAt": "2020-08-10T04:48:10Z", "author": {"login": "Ethanlm"}, "path": "storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java", "diffHunk": "@@ -2968,16 +2978,14 @@ private SupervisorSummary makeSupervisorSummary(String supervisorId, SupervisorI\n         return ret;\n     }\n \n-    private ClusterSummary getClusterInfoImpl() throws Exception {\n+    private ClusterSummary getClusterInfoImpl() throws Exception, AuthorizationException {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTE1OTE4MQ=="}, "originalCommit": {"oid": "6bfb4e8561717cd60fc969c570c6ede7b67a70dd"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY4NzU3MA==", "bodyText": "base can be null if this topology doesn't exist. Then there will be NullPointerException in getTopologySummary(id, base) . Is this intended?\n\nWe need to check base==null here", "url": "https://github.com/apache/storm/pull/3306#discussion_r467687570", "createdAt": "2020-08-10T04:55:34Z", "author": {"login": "Ethanlm"}, "path": "storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java", "diffHunk": "@@ -4654,6 +4714,55 @@ public ClusterSummary getClusterInfo() throws AuthorizationException, TException\n         }\n     }\n \n+    @Override\n+    public List<TopologySummary> getTopologySummaries() throws AuthorizationException, TException {\n+        try {\n+            getTopologySummariesCalls.mark();\n+            checkAuthorization(null, null, \"getTopologySummaries\");\n+            return getTopologySummariesImpl();\n+        } catch (Exception e) {\n+            LOG.warn(\"Get TopologySummary info exception.\", e);\n+            if (e instanceof TException) {\n+                throw (TException) e;\n+            }\n+            throw new RuntimeException(e);\n+        }\n+    }\n+\n+    @Override\n+    public TopologySummary getTopologySummaryByName(String name) throws AuthorizationException, TException {\n+        try {\n+            getTopologySummaryByNameCalls.mark();\n+            checkAuthorization(null, null, \"getTopologySummaries\");\n+            IStormClusterState state = stormClusterState;\n+            String topoId = state.getTopoId(name).orElseThrow(() -> new WrappedNotAliveException(name + \" is not alive\"));\n+            return getTopologySummary(topoId, state.topologyBases().get(topoId));\n+        } catch (Exception e) {\n+            LOG.warn(\"Get TopologySummaryByName info exception.\", e);\n+            if (e instanceof TException) {\n+                throw (TException) e;\n+            }\n+            throw new RuntimeException(e);\n+        }\n+    }\n+\n+    @Override\n+    public TopologySummary getTopologySummaryById(String id) throws AuthorizationException, TException {\n+        try {\n+            getTopologySummaryByIdCalls.mark();\n+            IStormClusterState state = stormClusterState;\n+            StormBase base = state.topologyBases().get(id);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTE2MTk4Ng=="}, "originalCommit": {"oid": "6bfb4e8561717cd60fc969c570c6ede7b67a70dd"}, "originalPosition": 300}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b2fa3388b4aedb1616b7bcafdd216261ef7d3116", "author": {"user": {"login": "kishorvpatil", "name": "Kishor Patil"}}, "url": "https://github.com/apache/storm/commit/b2fa3388b4aedb1616b7bcafdd216261ef7d3116", "committedDate": "2020-08-14T14:27:19Z", "message": "Addressing code review comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f575728292ded4b79250b60b1e61d40be47b919d", "author": {"user": {"login": "kishorvpatil", "name": "Kishor Patil"}}, "url": "https://github.com/apache/storm/commit/f575728292ded4b79250b60b1e61d40be47b919d", "committedDate": "2020-08-31T23:09:23Z", "message": "Merge branch 'master' of github.com:apache/storm into STORM-3671"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e4d595c07ee57aa27ac241ed2643edf05fed4fa4", "author": {"user": {"login": "kishorvpatil", "name": "Kishor Patil"}}, "url": "https://github.com/apache/storm/commit/e4d595c07ee57aa27ac241ed2643edf05fed4fa4", "committedDate": "2020-09-14T21:38:12Z", "message": "Addressing NotAliveExceptions."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "782604fc76f80984398d5157915b3b296f20fbc8", "author": {"user": {"login": "kishorvpatil", "name": "Kishor Patil"}}, "url": "https://github.com/apache/storm/commit/782604fc76f80984398d5157915b3b296f20fbc8", "committedDate": "2020-09-14T21:38:26Z", "message": "Merge branch 'master' of github.com:apache/storm into STORM-3671"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "05000797308bf2c753f4bb8ae1beddee5d982b07", "author": {"user": {"login": "kishorvpatil", "name": "Kishor Patil"}}, "url": "https://github.com/apache/storm/commit/05000797308bf2c753f4bb8ae1beddee5d982b07", "committedDate": "2020-08-14T14:51:09Z", "message": "Merge branch 'master' of github.com:apache/storm into STORM-3671"}, "afterCommit": {"oid": "782604fc76f80984398d5157915b3b296f20fbc8", "author": {"user": {"login": "kishorvpatil", "name": "Kishor Patil"}}, "url": "https://github.com/apache/storm/commit/782604fc76f80984398d5157915b3b296f20fbc8", "committedDate": "2020-09-14T21:38:26Z", "message": "Merge branch 'master' of github.com:apache/storm into STORM-3671"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg4OTUwMDg5", "url": "https://github.com/apache/storm/pull/3306#pullrequestreview-488950089", "createdAt": "2020-09-15T18:24:36Z", "commit": {"oid": "782604fc76f80984398d5157915b3b296f20fbc8"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxODoyNDozNlrOHSOinw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxODo0MjozMFrOHSPJGw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg3NDY1NQ==", "bodyText": "getLeader was added due to a bug below I guess?", "url": "https://github.com/apache/storm/pull/3306#discussion_r488874655", "createdAt": "2020-09-15T18:24:36Z", "author": {"login": "agresch"}, "path": "storm-client/src/jvm/org/apache/storm/security/auth/authorizer/SimpleACLAuthorizer.java", "diffHunk": "@@ -40,6 +40,11 @@\n         \"fileUpload\",\n         \"getNimbusConf\",\n         \"getClusterInfo\",\n+        \"getLeader\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "782604fc76f80984398d5157915b3b296f20fbc8"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg3NzM2OA==", "bodyText": "should these have return types?", "url": "https://github.com/apache/storm/pull/3306#discussion_r488877368", "createdAt": "2020-09-15T18:29:17Z", "author": {"login": "agresch"}, "path": "storm-client/src/py/storm/Nimbus-remote", "diffHunk": "@@ -75,9 +75,14 @@ if len(sys.argv) <= 1 or sys.argv[1] == '--help':\n     print('  string downloadChunk(string id)')\n     print('  string getNimbusConf()')\n     print('  ClusterSummary getClusterInfo()')\n+    print('   getTopologySummaries()')", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "782604fc76f80984398d5157915b3b296f20fbc8"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg3OTQzNA==", "bodyText": "combine these two lines", "url": "https://github.com/apache/storm/pull/3306#discussion_r488879434", "createdAt": "2020-09-15T18:33:04Z", "author": {"login": "agresch"}, "path": "storm-core/src/jvm/org/apache/storm/command/GetErrors.java", "diffHunk": "@@ -42,21 +43,17 @@ public static void main(String[] args) throws Exception {\n             public void run(Nimbus.Iface client) throws Exception {\n                 GetInfoOptions opts = new GetInfoOptions();\n                 opts.set_num_err_choice(NumErrorsChoice.ONE);\n-                String topologyId = Utils.getTopologyId(name, client);\n-\n-                TopologyInfo topologyInfo = null;\n-                if (topologyId != null) {\n-                    topologyInfo = client.getTopologyInfoWithOpts(topologyId, opts);\n-                }\n-\n-                Map<String, Object> outputMap = new HashMap<>();\n-                if (topologyId == null || topologyInfo == null) {\n-                    outputMap.put(\"Failure\", \"No topologies running with name \" + name);\n-                } else {\n+                TopologyInfo topologyInfo;\n+                Map<String, Object> outputMap = null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "782604fc76f80984398d5157915b3b296f20fbc8"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg4NDUwNw==", "bodyText": "why change this exception?", "url": "https://github.com/apache/storm/pull/3306#discussion_r488884507", "createdAt": "2020-09-15T18:42:30Z", "author": {"login": "agresch"}, "path": "storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java", "diffHunk": "@@ -4747,7 +4866,7 @@ public boolean isTopologyNameAllowed(String name) throws AuthorizationException,\n                 for (StormBase base : ownerToBasesEntry.getValue()) {\n                     try {\n                         String topoId = state.getTopoId(base.get_name())\n-                                             .orElseThrow(() -> new WrappedNotAliveException(base.get_name() + \" is not alive\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "782604fc76f80984398d5157915b3b296f20fbc8"}, "originalPosition": 488}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5ODkxMjYw", "url": "https://github.com/apache/storm/pull/3306#pullrequestreview-489891260", "createdAt": "2020-09-16T18:12:57Z", "commit": {"oid": "782604fc76f80984398d5157915b3b296f20fbc8"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxODoxMjo1N1rOHS8k1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQxODoxNDozNFrOHS8n8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTYyODg4Ng==", "bodyText": "We should catch NotAliveException and return null if it happens\nThis is to keep the syntax consistent with original implementation", "url": "https://github.com/apache/storm/pull/3306#discussion_r489628886", "createdAt": "2020-09-16T18:12:57Z", "author": {"login": "Ethanlm"}, "path": "storm-client/src/jvm/org/apache/storm/utils/Utils.java", "diffHunk": "@@ -1190,23 +1190,17 @@ static boolean isValidConf(Map<String, Object> orig, Map<String, Object> deser)\n \n     public static TopologyInfo getTopologyInfo(String name, String asUser, Map<String, Object> topoConf) {\n         try (NimbusClient client = NimbusClient.getConfiguredClientAs(topoConf, asUser)) {\n-            String topologyId = getTopologyId(name, client.getClient());\n-            if (null != topologyId) {\n-                return client.getClient().getTopologyInfo(topologyId);\n-            }\n-            return null;\n+            return client.getClient().getTopologyInfoByName(name);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "782604fc76f80984398d5157915b3b296f20fbc8"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTYyODkxNg==", "bodyText": "We should catch NotAliveException and return null if it happens\nThis is to keep the syntax consistent with original implementation", "url": "https://github.com/apache/storm/pull/3306#discussion_r489628916", "createdAt": "2020-09-16T18:13:02Z", "author": {"login": "Ethanlm"}, "path": "storm-client/src/jvm/org/apache/storm/utils/Utils.java", "diffHunk": "@@ -1190,23 +1190,17 @@ static boolean isValidConf(Map<String, Object> orig, Map<String, Object> deser)\n \n     public static TopologyInfo getTopologyInfo(String name, String asUser, Map<String, Object> topoConf) {\n         try (NimbusClient client = NimbusClient.getConfiguredClientAs(topoConf, asUser)) {\n-            String topologyId = getTopologyId(name, client.getClient());\n-            if (null != topologyId) {\n-                return client.getClient().getTopologyInfo(topologyId);\n-            }\n-            return null;\n+            return client.getClient().getTopologyInfoByName(name);\n         } catch (Exception e) {\n             throw new RuntimeException(e);\n         }\n     }\n \n     public static String getTopologyId(String name, Nimbus.Iface client) {\n         try {\n-            ClusterSummary summary = client.getClusterInfo();\n-            for (TopologySummary s : summary.get_topologies()) {\n-                if (s.get_name().equals(name)) {\n-                    return s.get_id();\n-                }\n+            TopologySummary topologySummary = client.getTopologySummaryByName(name);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "782604fc76f80984398d5157915b3b296f20fbc8"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTYyOTY4Mw==", "bodyText": "should we catch NotAliveException and return null if happened?", "url": "https://github.com/apache/storm/pull/3306#discussion_r489629683", "createdAt": "2020-09-16T18:14:34Z", "author": {"login": "Ethanlm"}, "path": "storm-server/src/test/java/org/apache/storm/TestRebalance.java", "diffHunk": "@@ -43,10 +44,9 @@\n     private static final Logger LOG = LoggerFactory.getLogger(TestRebalance.class);\n \n     public static String topoNameToId(String topoName, ILocalCluster cluster) throws TException {\n-        for (TopologySummary topoSum : cluster.getClusterInfo().get_topologies()) {\n-            if (topoSum.get_name().equals(topoName)) {\n-                return topoSum.get_id();\n-            }\n+        TopologySummary topoSum = cluster.getTopologySummaryByName(topoName);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "782604fc76f80984398d5157915b3b296f20fbc8"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9217205d9b68319331b800064414bed0cb79debe", "author": {"user": {"login": "kishorvpatil", "name": "Kishor Patil"}}, "url": "https://github.com/apache/storm/commit/9217205d9b68319331b800064414bed0cb79debe", "committedDate": "2020-09-18T14:30:04Z", "message": "Switching back to use WrappedNotAliveException"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "38e76f34dab1f2a3250873d4fbc1b1e373dc1c95", "author": {"user": {"login": "kishorvpatil", "name": "Kishor Patil"}}, "url": "https://github.com/apache/storm/commit/38e76f34dab1f2a3250873d4fbc1b1e373dc1c95", "committedDate": "2020-09-18T14:35:41Z", "message": "Merge branch 'master' of github.com:apache/storm into STORM-3671"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkxNTM0MjQ2", "url": "https://github.com/apache/storm/pull/3306#pullrequestreview-491534246", "createdAt": "2020-09-18T14:46:49Z", "commit": {"oid": "38e76f34dab1f2a3250873d4fbc1b1e373dc1c95"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4635, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}