{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE1MDQ3OTY1", "number": 3265, "title": "[STORM-2687] Add network proximity needs based executor sorting method", "bodyText": "What is the purpose of the change\nThis change provides an option to schedule executors based on network-proximity based topological order.\nThis is a re-work from @Ethanlm's previous PR #2623\nThis PR only provides this new sorting algorithm as a configurable option. Per Ethan's previous plan, we will remove this config and integrate this sorting method to our current default method as a follow-up once we decide to completely replace current executors sorting method with this new algorithm.\nHow was the change tested\nA simple wordcount test:", "createdAt": "2020-05-08T05:06:21Z", "url": "https://github.com/apache/storm/pull/3265", "merged": true, "mergeCommit": {"oid": "013654d9cb415c4119d2bdf753351f5af5394fad"}, "closed": true, "closedAt": "2020-06-02T15:25:51Z", "author": {"login": "RuiLi8080"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcfKFwEAH2gAyNDE1MDQ3OTY1OmZkN2VjZjM1ZDAyOTk4NzUwMTk3NmEzNDg4NDA2Yzk1NmNjZTM3NGI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcnWisUAFqTQyMjc5MTA4NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "fd7ecf35d029987501976a3488406c956cce374b", "author": {"user": null}, "url": "https://github.com/apache/storm/commit/fd7ecf35d029987501976a3488406c956cce374b", "committedDate": "2020-05-08T04:23:04Z", "message": "[STORM-2687] Add network proximity needs based executor sorting method"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4Mjk4NDY0", "url": "https://github.com/apache/storm/pull/3265#pullrequestreview-408298464", "createdAt": "2020-05-08T14:56:00Z", "commit": {"oid": "fd7ecf35d029987501976a3488406c956cce374b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxNDo1NjowMFrOGSogfA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOFQxNDo1NjowMFrOGSogfA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjE5MTIyOA==", "bodyText": "I think this would be good to add to defaults.yaml so users will see the value for their topology in the ui.  It might be nice to have schedule somewhere in the name, I think users might remember/see it more likely then.  Possibly topology.schedule.executors.by.proximity.needs?", "url": "https://github.com/apache/storm/pull/3265#discussion_r422191228", "createdAt": "2020-05-08T14:56:00Z", "author": {"login": "agresch"}, "path": "storm-client/src/jvm/org/apache/storm/Config.java", "diffHunk": "@@ -312,6 +312,13 @@\n     // the topology.\n     public static final String TOPOLOGY_SCHEDULER_STRATEGY = \"topology.scheduler.strategy\";\n \n+    /**\n+     * When DefaultResourceAwareStrategy or GenericResourceAwareStrategy is used,\n+     * it will arrange unassigned executors based a particular order.\n+     * If this config is set to true, the arrangement will be made by network proximity needs.\n+     */\n+    public static final String TOPOLOGY_RAS_ORDER_EXECUTORS_BY_PROXIMITY_NEEDS = \"topology.ras.order.executors.by.proximity.needs\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fd7ecf35d029987501976a3488406c956cce374b"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "06b3097560793f49536f572ac53993584f327938", "author": {"user": {"login": "RuiLi8080", "name": "Rui Li"}}, "url": "https://github.com/apache/storm/commit/06b3097560793f49536f572ac53993584f327938", "committedDate": "2020-05-08T16:43:06Z", "message": "address comments"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c15997947cb5ae21d73bacfeea5eb4dc9e62de0f", "author": {"user": {"login": "RuiLi8080", "name": "Rui Li"}}, "url": "https://github.com/apache/storm/commit/c15997947cb5ae21d73bacfeea5eb4dc9e62de0f", "committedDate": "2020-05-08T15:57:48Z", "message": "address comments"}, "afterCommit": {"oid": "06b3097560793f49536f572ac53993584f327938", "author": {"user": {"login": "RuiLi8080", "name": "Rui Li"}}, "url": "https://github.com/apache/storm/commit/06b3097560793f49536f572ac53993584f327938", "committedDate": "2020-05-08T16:43:06Z", "message": "address comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwMzgyNTk3", "url": "https://github.com/apache/storm/pull/3265#pullrequestreview-410382597", "createdAt": "2020-05-12T20:06:58Z", "commit": {"oid": "06b3097560793f49536f572ac53993584f327938"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQyMDowNzozM1rOGUXB5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQyMDoyMTozOFrOGXGORA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDAwMjAyMw==", "bodyText": "maybe a little more explanation on what it really is will help users", "url": "https://github.com/apache/storm/pull/3265#discussion_r424002023", "createdAt": "2020-05-12T20:07:33Z", "author": {"login": "Ethanlm"}, "path": "storm-client/src/jvm/org/apache/storm/Config.java", "diffHunk": "@@ -312,6 +312,13 @@\n     // the topology.\n     public static final String TOPOLOGY_SCHEDULER_STRATEGY = \"topology.scheduler.strategy\";\n \n+    /**\n+     * When DefaultResourceAwareStrategy or GenericResourceAwareStrategy is used,\n+     * it will arrange unassigned executors based a particular order.\n+     * If this config is set to true, the arrangement will be made by network proximity needs.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "06b3097560793f49536f572ac53993584f327938"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjg2OTU1Mw==", "bodyText": "We can use ObjectReader.getBoolean()", "url": "https://github.com/apache/storm/pull/3265#discussion_r426869553", "createdAt": "2020-05-18T20:15:31Z", "author": {"login": "Ethanlm"}, "path": "storm-server/src/main/java/org/apache/storm/scheduler/resource/strategies/scheduling/BaseResourceAwareStrategy.java", "diffHunk": "@@ -511,6 +514,18 @@ protected String nodeToRack(RasNode node) {\n         return sortedComponents;\n     }\n \n+    protected List<ExecutorDetails> orderExecutors(\n+        TopologyDetails td, Collection<ExecutorDetails> unassignedExecutors) {\n+        Boolean orderByProximity = (Boolean) td.getConf()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "06b3097560793f49536f572ac53993584f327938"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjg3MjM4OA==", "bodyText": "Maybe topology.ras.order.executors.by.proximity.needs has more accurate meaning. This only changes how the unassigned executors are sorted. How they are scheduled still depend on some other things too", "url": "https://github.com/apache/storm/pull/3265#discussion_r426872388", "createdAt": "2020-05-18T20:21:38Z", "author": {"login": "Ethanlm"}, "path": "storm-client/src/jvm/org/apache/storm/Config.java", "diffHunk": "@@ -312,6 +312,13 @@\n     // the topology.\n     public static final String TOPOLOGY_SCHEDULER_STRATEGY = \"topology.scheduler.strategy\";\n \n+    /**\n+     * When DefaultResourceAwareStrategy or GenericResourceAwareStrategy is used,\n+     * it will arrange unassigned executors based a particular order.\n+     * If this config is set to true, the arrangement will be made by network proximity needs.\n+     */\n+    public static final String TOPOLOGY_RAS_SCHEDULE_EXECUTORS_BY_PROXIMITY_NEEDS = \"topology.ras.schedule.executors.by.proximity.needs\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "06b3097560793f49536f572ac53993584f327938"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7312eff13d0b71094fc9f94e6dc8499d26fe4344", "author": {"user": {"login": "RuiLi8080", "name": "Rui Li"}}, "url": "https://github.com/apache/storm/commit/7312eff13d0b71094fc9f94e6dc8499d26fe4344", "committedDate": "2020-05-27T15:43:18Z", "message": "addressed comments"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9cc18eaefe91a558d62e7c9ac895a705db58b44f", "author": {"user": {"login": "RuiLi8080", "name": "Rui Li"}}, "url": "https://github.com/apache/storm/commit/9cc18eaefe91a558d62e7c9ac895a705db58b44f", "committedDate": "2020-05-21T18:27:04Z", "message": "addressed comments"}, "afterCommit": {"oid": "7312eff13d0b71094fc9f94e6dc8499d26fe4344", "author": {"user": {"login": "RuiLi8080", "name": "Rui Li"}}, "url": "https://github.com/apache/storm/commit/7312eff13d0b71094fc9f94e6dc8499d26fe4344", "committedDate": "2020-05-27T15:43:18Z", "message": "addressed comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c79edc1719cdf7b86f63d956a9a378f4d05cddb2", "author": {"user": {"login": "RuiLi8080", "name": "Rui Li"}}, "url": "https://github.com/apache/storm/commit/c79edc1719cdf7b86f63d956a9a378f4d05cddb2", "committedDate": "2020-06-01T21:51:35Z", "message": "address comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyNzkxMDg0", "url": "https://github.com/apache/storm/pull/3265#pullrequestreview-422791084", "createdAt": "2020-06-02T15:24:56Z", "commit": {"oid": "c79edc1719cdf7b86f63d956a9a378f4d05cddb2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4572, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}