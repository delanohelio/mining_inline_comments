{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM5MzIwODU0", "number": 3294, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxODowMzozNlrOEI3icQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxODowMzozNlrOEI3icQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3NzM0MDAxOnYy", "diffSide": "RIGHT", "path": "storm-client/src/jvm/org/apache/storm/daemon/worker/Worker.java", "isResolved": false, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxODowMzozNlrOGpF58g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNDozOToyNlrOGpjaoA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTc0MTU1NA==", "bodyText": "It is better to not hardcode it. We can use SYSTEM_COMPONENT_ID, SYSTEM_TASK_ID. And it looks like it doesn't make much sense to have streamId here.", "url": "https://github.com/apache/storm/pull/3294#discussion_r445741554", "createdAt": "2020-06-25T18:03:36Z", "author": {"login": "Ethanlm"}, "path": "storm-client/src/jvm/org/apache/storm/daemon/worker/Worker.java", "diffHunk": "@@ -196,6 +198,8 @@ private Object loadWorker(IStateStorage stateStorage, IStormClusterState stormCl\n         throws Exception {\n         workerState = new WorkerState(conf, context, topologyId, assignmentId, supervisorIfaceSupplier, port, workerId,\n                                       topologyConf, stateStorage, stormClusterState, autoCreds, metricRegistry);\n+        this.heatbeatMeter = metricRegistry.meter(\"doHeartbeat-calls\", workerState.getWorkerTopologyContext(),\n+                \"__system\", -1, \"default\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "330775c03478b7ca5b03a502bfe643d784ee863f"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTc0OTU0Mg==", "bodyText": "Would you prefer I pass in \"\" for streamId?  Or are you indicating we should have a metric name convention that allows skipping inclusion of stream?", "url": "https://github.com/apache/storm/pull/3294#discussion_r445749542", "createdAt": "2020-06-25T18:18:01Z", "author": {"login": "agresch"}, "path": "storm-client/src/jvm/org/apache/storm/daemon/worker/Worker.java", "diffHunk": "@@ -196,6 +198,8 @@ private Object loadWorker(IStateStorage stateStorage, IStormClusterState stormCl\n         throws Exception {\n         workerState = new WorkerState(conf, context, topologyId, assignmentId, supervisorIfaceSupplier, port, workerId,\n                                       topologyConf, stateStorage, stormClusterState, autoCreds, metricRegistry);\n+        this.heatbeatMeter = metricRegistry.meter(\"doHeartbeat-calls\", workerState.getWorkerTopologyContext(),\n+                \"__system\", -1, \"default\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTc0MTU1NA=="}, "originalCommit": {"oid": "330775c03478b7ca5b03a502bfe643d784ee863f"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTc1MTc0MA==", "bodyText": "I see there is already a metricName function https://github.com/apache/storm/blob/master/storm-client/src/jvm/org/apache/storm/metrics2/StormMetricRegistry.java#L244 which doesn't take streamId", "url": "https://github.com/apache/storm/pull/3294#discussion_r445751740", "createdAt": "2020-06-25T18:22:14Z", "author": {"login": "Ethanlm"}, "path": "storm-client/src/jvm/org/apache/storm/daemon/worker/Worker.java", "diffHunk": "@@ -196,6 +198,8 @@ private Object loadWorker(IStateStorage stateStorage, IStormClusterState stormCl\n         throws Exception {\n         workerState = new WorkerState(conf, context, topologyId, assignmentId, supervisorIfaceSupplier, port, workerId,\n                                       topologyConf, stateStorage, stormClusterState, autoCreds, metricRegistry);\n+        this.heatbeatMeter = metricRegistry.meter(\"doHeartbeat-calls\", workerState.getWorkerTopologyContext(),\n+                \"__system\", -1, \"default\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTc0MTU1NA=="}, "originalCommit": {"oid": "330775c03478b7ca5b03a502bfe643d784ee863f"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTc1MjY3Mw==", "bodyText": "Also I feel like the metrics should have the key before the value, for example, we now have\nxx.<compId>.<taskId>.yy.\nI think it should be xx.componentId.<compId>.taskId.<taskId>.yy so the values are more readable. But this is a separate issue.", "url": "https://github.com/apache/storm/pull/3294#discussion_r445752673", "createdAt": "2020-06-25T18:23:52Z", "author": {"login": "Ethanlm"}, "path": "storm-client/src/jvm/org/apache/storm/daemon/worker/Worker.java", "diffHunk": "@@ -196,6 +198,8 @@ private Object loadWorker(IStateStorage stateStorage, IStormClusterState stormCl\n         throws Exception {\n         workerState = new WorkerState(conf, context, topologyId, assignmentId, supervisorIfaceSupplier, port, workerId,\n                                       topologyConf, stateStorage, stormClusterState, autoCreds, metricRegistry);\n+        this.heatbeatMeter = metricRegistry.meter(\"doHeartbeat-calls\", workerState.getWorkerTopologyContext(),\n+                \"__system\", -1, \"default\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTc0MTU1NA=="}, "originalCommit": {"oid": "330775c03478b7ca5b03a502bfe643d784ee863f"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjIyNTA1Ng==", "bodyText": "@Ethanlm - updated", "url": "https://github.com/apache/storm/pull/3294#discussion_r446225056", "createdAt": "2020-06-26T14:39:26Z", "author": {"login": "agresch"}, "path": "storm-client/src/jvm/org/apache/storm/daemon/worker/Worker.java", "diffHunk": "@@ -196,6 +198,8 @@ private Object loadWorker(IStateStorage stateStorage, IStormClusterState stormCl\n         throws Exception {\n         workerState = new WorkerState(conf, context, topologyId, assignmentId, supervisorIfaceSupplier, port, workerId,\n                                       topologyConf, stateStorage, stormClusterState, autoCreds, metricRegistry);\n+        this.heatbeatMeter = metricRegistry.meter(\"doHeartbeat-calls\", workerState.getWorkerTopologyContext(),\n+                \"__system\", -1, \"default\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTc0MTU1NA=="}, "originalCommit": {"oid": "330775c03478b7ca5b03a502bfe643d784ee863f"}, "originalPosition": 21}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4323, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}