{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAxMDc3ODE4", "number": 3247, "title": "[STORM-3619] Add null check for topology name", "bodyText": "https://issues.apache.org/jira/browse/STORM-3619\nWith this change,  submitting a topology with a null name will fail with clear message\nException in thread \"main\" java.lang.IllegalArgumentException: Topology name 'null' is not valid. It can't be null and it must match ^[^/.:\\\\]+$", "createdAt": "2020-04-08T20:59:36Z", "url": "https://github.com/apache/storm/pull/3247", "merged": true, "mergeCommit": {"oid": "ae5b70ff9d512431bb9e85aaa0883564c61fa917"}, "closed": true, "closedAt": "2020-04-09T20:32:45Z", "author": {"login": "Ethanlm"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcVuWHigH2gAyNDAxMDc3ODE4OmJlNjMyNjljYzMzODA3OGM0YmZiM2Q4OGYyNzMyZGNhZTY3MmFhYjg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcV-siPgFqTM5MDkyNjc2NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "be63269cc338078c4bfb3d88f2732dcae672aab8", "author": {"user": {"login": "Ethanlm", "name": "Meng (Ethan) Li "}}, "url": "https://github.com/apache/storm/commit/be63269cc338078c4bfb3d88f2732dcae672aab8", "committedDate": "2020-04-08T20:58:17Z", "message": "[STORM-3619] Add null check for topology name"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwMzI5MjE0", "url": "https://github.com/apache/storm/pull/3247#pullrequestreview-390329214", "createdAt": "2020-04-08T21:01:54Z", "commit": {"oid": "be63269cc338078c4bfb3d88f2732dcae672aab8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQyMTowMTo1NFrOGDA17g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQyMTowMTo1NFrOGDA17g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTgxMjcxOA==", "bodyText": "Changing the name here because it calls client.getClient().isTopologyNameAllowed and it doesn't only check the existence of the topology name.", "url": "https://github.com/apache/storm/pull/3247#discussion_r405812718", "createdAt": "2020-04-08T21:01:54Z", "author": {"login": "Ethanlm"}, "path": "storm-client/src/jvm/org/apache/storm/StormSubmitter.java", "diffHunk": "@@ -435,7 +436,7 @@ public void onCompleted(String srcFile, String targetFile, long totalBytes) {\n         });\n     }\n \n-    private static boolean topologyNameExists(String name, NimbusClient client) {\n+    private static boolean isTopologyNameAllowed(String name, NimbusClient client) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "be63269cc338078c4bfb3d88f2732dcae672aab8"}, "originalPosition": 30}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwMzMxNjQy", "url": "https://github.com/apache/storm/pull/3247#pullrequestreview-390331642", "createdAt": "2020-04-08T21:05:47Z", "commit": {"oid": "be63269cc338078c4bfb3d88f2732dcae672aab8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQyMTowNTo0OFrOGDA9fA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQyMTowNTo0OFrOGDA9fA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTgxNDY1Mg==", "bodyText": "Copied TOPOLOGY_NAME_REGEX from storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java. We should have a consistent check for topology name.\nTOPOLOGY_KEY_PATTERN was originally only used for blob key. See #2703", "url": "https://github.com/apache/storm/pull/3247#discussion_r405814652", "createdAt": "2020-04-08T21:05:48Z", "author": {"login": "Ethanlm"}, "path": "storm-client/src/jvm/org/apache/storm/utils/Utils.java", "diffHunk": "@@ -122,7 +122,9 @@\n     // tests by subclassing.\n     private static Utils _instance = new Utils();\n     private static String memoizedLocalHostnameString = null;\n-    public static final Pattern TOPOLOGY_KEY_PATTERN = Pattern.compile(\"^[\\\\w \\\\t\\\\._-]+$\", Pattern.UNICODE_CHARACTER_CLASS);\n+    public static final Pattern BLOB_KEY_PATTERN =\n+            Pattern.compile(\"^[\\\\w \\\\t\\\\._-]+$\", Pattern.UNICODE_CHARACTER_CLASS);\n+    private static final Pattern TOPOLOGY_NAME_REGEX = Pattern.compile(\"^[^/.:\\\\\\\\]+$\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "be63269cc338078c4bfb3d88f2732dcae672aab8"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwMzMyMDUy", "url": "https://github.com/apache/storm/pull/3247#pullrequestreview-390332052", "createdAt": "2020-04-08T21:06:28Z", "commit": {"oid": "be63269cc338078c4bfb3d88f2732dcae672aab8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQyMTowNjoyOFrOGDA-pw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQyMTowNjoyOFrOGDA-pw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTgxNDk1MQ==", "bodyText": "why was this removed?", "url": "https://github.com/apache/storm/pull/3247#discussion_r405814951", "createdAt": "2020-04-08T21:06:28Z", "author": {"login": "agresch"}, "path": "storm-client/src/jvm/org/apache/storm/StormSubmitter.java", "diffHunk": "@@ -248,11 +252,8 @@ public static void submitTopologyAs(String name, Map<String, Object> topoConf, S\n         try {\n             String serConf = JSONValue.toJSONString(topoConf);\n             try (NimbusClient client = NimbusClient.getConfiguredClientAs(conf, asUser)) {\n-                if (topologyNameExists(name, client)) {\n-                    throw new RuntimeException(\"Topology with name `\" + name + \"` already exists on cluster\");\n-                }\n-                if (!Utils.isValidKey(name)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "be63269cc338078c4bfb3d88f2732dcae672aab8"}, "originalPosition": 18}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwMzUwMzgw", "url": "https://github.com/apache/storm/pull/3247#pullrequestreview-390350380", "createdAt": "2020-04-08T21:37:19Z", "commit": {"oid": "be63269cc338078c4bfb3d88f2732dcae672aab8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwOTI2NzY1", "url": "https://github.com/apache/storm/pull/3247#pullrequestreview-390926765", "createdAt": "2020-04-09T16:01:15Z", "commit": {"oid": "be63269cc338078c4bfb3d88f2732dcae672aab8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4552, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}