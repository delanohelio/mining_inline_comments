{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM5MjgxNjg2", "number": 3293, "title": "[STORM-3657] set storm.messaging.netty.authentication to topoConf OR daemonConf", "bodyText": "What is the purpose of the change\nIn most of times of conf merging, we simply prefer topo conf over daemon conf. But as for netty authentication, we believe we want to set it true either cluster or topo owner want it.\nWe did notice some strange cases where we set this setting true in cluster side while user set it false when submitting topology. And when host-ip mapping changed, netty server of the worker with false setting receive message from other topology with true setting. The ControlMessage received at StormServerHandler can not be processed properly since false setting only expects List<TaskMessage>.\nIn the future, we should probably handle config better in storm since it would be weird for some config to be different between server and topo.\nHow was the change tested\nTested with setting server side to true and submit a WordCount topo with false -c setting.\nstorm jar storm-starter-2.3.0-SNAPSHOT.jar org.apache.storm.starter.WordCountTopology -c topology.debug=true -c storm.messaging.netty.authentication=false wc2\nAdditional log:\n2020-06-24 00:57:25.737 o.a.s.d.n.Nimbus pool-29-thread-47 [INFO] Topo conf: false, nimbus conf: true, Enforce netty auth: true", "createdAt": "2020-06-24T15:24:45Z", "url": "https://github.com/apache/storm/pull/3293", "merged": true, "mergeCommit": {"oid": "f10cfd48ec2d30127acb101eff14ba8f9fa616de"}, "closed": true, "closedAt": "2020-06-29T14:53:04Z", "author": {"login": "RuiLi8080"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcubYiNAH2gAyNDM5MjgxNjg2OjAwZGMxMjg0NDdmZTAyMjZmMzQ5NmExMGVmZjlhOGJmMmI4Y2EzMTY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcwCNzYAFqTQzOTIyMTc0MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "00dc128447fe0226f3496a10eff9a8bf2b8ca316", "author": {"user": {"login": "RuiLi8080", "name": "Rui Li"}}, "url": "https://github.com/apache/storm/commit/00dc128447fe0226f3496a10eff9a8bf2b8ca316", "committedDate": "2020-06-24T15:00:50Z", "message": "[STORM-3657] set storm.messaging.netty.authentication to topoConf OR daemonConf"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2NzYyNzc3", "url": "https://github.com/apache/storm/pull/3293#pullrequestreview-436762777", "createdAt": "2020-06-24T15:29:32Z", "commit": {"oid": "00dc128447fe0226f3496a10eff9a8bf2b8ca316"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2OTg0MDUz", "url": "https://github.com/apache/storm/pull/3293#pullrequestreview-436984053", "createdAt": "2020-06-24T20:31:07Z", "commit": {"oid": "00dc128447fe0226f3496a10eff9a8bf2b8ca316"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3NzIyMzcx", "url": "https://github.com/apache/storm/pull/3293#pullrequestreview-437722371", "createdAt": "2020-06-25T17:46:52Z", "commit": {"oid": "00dc128447fe0226f3496a10eff9a8bf2b8ca316"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxNzo0Njo1MlrOGpFUww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxNzo1Nzo0OFrOGpFsyg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTczMjAzNQ==", "bodyText": "storm.messaging.netty.authentication is guaranteed to be set because it is in defaults.yaml. We don't want to have default value in different places.", "url": "https://github.com/apache/storm/pull/3293#discussion_r445732035", "createdAt": "2020-06-25T17:46:52Z", "author": {"login": "Ethanlm"}, "path": "storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java", "diffHunk": "@@ -3165,6 +3163,16 @@ public void submitTopologyWithOpts(String topoName, String uploadedJarLocation,\n                 topoConf.remove(Config.TOPOLOGY_CLASSPATH_BEGINNING);\n             }\n \n+            // storm.messaging.netty.authentication is about inter-worker communication\n+            // enforce netty authentication when either topo or daemon set it to true\n+            boolean enforceNettyAuth = (Boolean) topoConf.getOrDefault(Config.STORM_MESSAGING_NETTY_AUTHENTICATION, false)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "00dc128447fe0226f3496a10eff9a8bf2b8ca316"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTczODE4Ng==", "bodyText": "I feel https://github.com/apache/storm/blob/master/storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java#L1098 is a better place for this.", "url": "https://github.com/apache/storm/pull/3293#discussion_r445738186", "createdAt": "2020-06-25T17:57:48Z", "author": {"login": "Ethanlm"}, "path": "storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java", "diffHunk": "@@ -3165,6 +3163,16 @@ public void submitTopologyWithOpts(String topoName, String uploadedJarLocation,\n                 topoConf.remove(Config.TOPOLOGY_CLASSPATH_BEGINNING);\n             }\n \n+            // storm.messaging.netty.authentication is about inter-worker communication", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "00dc128447fe0226f3496a10eff9a8bf2b8ca316"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3734b1164313483ae6c61878c42f6610d0f77448", "author": {"user": {"login": "RuiLi8080", "name": "Rui Li"}}, "url": "https://github.com/apache/storm/commit/3734b1164313483ae6c61878c42f6610d0f77448", "committedDate": "2020-06-29T06:06:02Z", "message": "address comment"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c8a2765fa1e5191bde755dcab08b289f488ee619", "author": {"user": {"login": "RuiLi8080", "name": "Rui Li"}}, "url": "https://github.com/apache/storm/commit/c8a2765fa1e5191bde755dcab08b289f488ee619", "committedDate": "2020-06-26T15:29:20Z", "message": "address comment"}, "afterCommit": {"oid": "3734b1164313483ae6c61878c42f6610d0f77448", "author": {"user": {"login": "RuiLi8080", "name": "Rui Li"}}, "url": "https://github.com/apache/storm/commit/3734b1164313483ae6c61878c42f6610d0f77448", "committedDate": "2020-06-29T06:06:02Z", "message": "address comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5MjIxNzQx", "url": "https://github.com/apache/storm/pull/3293#pullrequestreview-439221741", "createdAt": "2020-06-29T14:49:20Z", "commit": {"oid": "3734b1164313483ae6c61878c42f6610d0f77448"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4612, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}