{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkyMzI0NDA1", "number": 1842, "title": "Task/generic sql backend", "bodyText": "Fixes #1836\nThis PR contains two features described below.\n\nUnified SQL backend for SQL sinks.\nAdd a lazy singleton to manage connection pools for SQL sinks (MySQL, Postgres, Postgis). With this change all instances of each sink will have access to the connection pool so the connection time now will be shorter.", "createdAt": "2020-03-23T11:23:55Z", "url": "https://github.com/telefonicaid/fiware-cygnus/pull/1842", "merged": true, "mergeCommit": {"oid": "873d11a1c24b3cb4d9d76ce90d4b8a463ba68a60"}, "closed": true, "closedAt": "2020-03-24T11:23:46Z", "author": {"login": "IvanHdzC"}, "timelineItems": {"totalCount": 22, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcPPtKTgH2gAyMzkyMzI0NDA1OmNiNzNlZDc5Y2I3YTM5ODFjOTk5NjE4MzViMGVhOTExZGRlNmQwNDc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcQxD29AFqTM4MDIxMjY5MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "cb73ed79cb7a3981c99961835b0ea911dde6d047", "author": {"user": {"login": "IvanHdzC", "name": "Ivan Hernandez"}}, "url": "https://github.com/telefonicaid/fiware-cygnus/commit/cb73ed79cb7a3981c99961835b0ea911dde6d047", "committedDate": "2020-03-19T17:52:51Z", "message": "add generic SQLBackend"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e7ff5ee27bfdaa92d0b373a370658abef3ad716c", "author": {"user": {"login": "IvanHdzC", "name": "Ivan Hernandez"}}, "url": "https://github.com/telefonicaid/fiware-cygnus/commit/e7ff5ee27bfdaa92d0b373a370658abef3ad716c", "committedDate": "2020-03-19T18:01:49Z", "message": "add generic SQLBackend tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a05cec76b6c26e7ae6c5090a3019d5d544882847", "author": {"user": {"login": "IvanHdzC", "name": "Ivan Hernandez"}}, "url": "https://github.com/telefonicaid/fiware-cygnus/commit/a05cec76b6c26e7ae6c5090a3019d5d544882847", "committedDate": "2020-03-19T18:02:42Z", "message": "add generic sql backend to MySQL sink"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "df076f2d6ea3c05317ecd4b0ff6ddf262944f81c", "author": {"user": {"login": "IvanHdzC", "name": "Ivan Hernandez"}}, "url": "https://github.com/telefonicaid/fiware-cygnus/commit/df076f2d6ea3c05317ecd4b0ff6ddf262944f81c", "committedDate": "2020-03-20T11:08:42Z", "message": "add lazy singleton implementation for mysql backend"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0923c5c5e587f29edf04e7ddc1744cfef73d8261", "author": {"user": {"login": "IvanHdzC", "name": "Ivan Hernandez"}}, "url": "https://github.com/telefonicaid/fiware-cygnus/commit/0923c5c5e587f29edf04e7ddc1744cfef73d8261", "committedDate": "2020-03-20T12:09:36Z", "message": "edit sql backend to match postgresql"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "56b793557ab600e2916d9a6889237a6f48daec38", "author": {"user": {"login": "IvanHdzC", "name": "Ivan Hernandez"}}, "url": "https://github.com/telefonicaid/fiware-cygnus/commit/56b793557ab600e2916d9a6889237a6f48daec38", "committedDate": "2020-03-20T12:09:59Z", "message": "add generic sql backend for posgresql sink"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8c6c2b887755e6dc968f6d63f1d12a671d05edb3", "author": {"user": {"login": "IvanHdzC", "name": "Ivan Hernandez"}}, "url": "https://github.com/telefonicaid/fiware-cygnus/commit/8c6c2b887755e6dc968f6d63f1d12a671d05edb3", "committedDate": "2020-03-20T12:15:49Z", "message": "add generic sql backend for posgis sink"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e187a041f7c9e5bee4edaab6abcaaf2fe6f19316", "author": {"user": {"login": "IvanHdzC", "name": "Ivan Hernandez"}}, "url": "https://github.com/telefonicaid/fiware-cygnus/commit/e187a041f7c9e5bee4edaab6abcaaf2fe6f19316", "committedDate": "2020-03-20T12:21:48Z", "message": "code cleanning"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "28f68e35a74c96ed88a29fc77e809035a361bbc3", "author": {"user": {"login": "IvanHdzC", "name": "Ivan Hernandez"}}, "url": "https://github.com/telefonicaid/fiware-cygnus/commit/28f68e35a74c96ed88a29fc77e809035a361bbc3", "committedDate": "2020-03-20T12:50:53Z", "message": "docs update and remove classes and files from previous backends"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a8e37d178ca22cb91e272da27fcef067c7e5f36f", "author": {"user": {"login": "IvanHdzC", "name": "Ivan Hernandez"}}, "url": "https://github.com/telefonicaid/fiware-cygnus/commit/a8e37d178ca22cb91e272da27fcef067c7e5f36f", "committedDate": "2020-03-23T09:31:23Z", "message": "fix on default postgres database on generic sql backend"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5MzQzMTM5", "url": "https://github.com/telefonicaid/fiware-cygnus/pull/1842#pullrequestreview-379343139", "createdAt": "2020-03-23T11:29:26Z", "commit": {"oid": "a8e37d178ca22cb91e272da27fcef067c7e5f36f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxMToyOToyNlrOF6BT8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxMToyOToyNlrOF6BT8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjM4MzIxOA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            [cygnus-common][PostgreSQL, MySQL] SQL generic backend (#1806)\n          \n          \n            \n            [cygnus-common][PostgreSQL, MySQL] Refactor code to use a SQL generic backend for all SQL-based sinks (#1806)", "url": "https://github.com/telefonicaid/fiware-cygnus/pull/1842#discussion_r396383218", "createdAt": "2020-03-23T11:29:26Z", "author": {"login": "fgalan"}, "path": "CHANGES_NEXT_RELEASE", "diffHunk": "@@ -5,3 +5,5 @@\n [cygnus-ngsi][PostgisSink] Enable postgis functions without native types flag on.\n [cygnus-ngsi][RestHandler] Add a not null validation for ngsiVersion header of request.\n [cygnus-ngsi][HDFSSink] Separate files by property periodicity (#1830)\n+[cygnus-common][PostgreSQL, MySQL] SQL generic backend (#1806)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a8e37d178ca22cb91e272da27fcef067c7e5f36f"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7c4888e56c26be86326505a85e1a652b708952f0", "author": {"user": {"login": "IvanHdzC", "name": "Ivan Hernandez"}}, "url": "https://github.com/telefonicaid/fiware-cygnus/commit/7c4888e56c26be86326505a85e1a652b708952f0", "committedDate": "2020-03-23T11:29:52Z", "message": "Update CHANGES_NEXT_RELEASE\n\nCo-Authored-By: Ferm\u00edn Gal\u00e1n M\u00e1rquez <fgalan@users.noreply.github.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5MzQ0NjI0", "url": "https://github.com/telefonicaid/fiware-cygnus/pull/1842#pullrequestreview-379344624", "createdAt": "2020-03-23T11:31:44Z", "commit": {"oid": "a8e37d178ca22cb91e272da27fcef067c7e5f36f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxMTozMTo0NFrOF6BYkw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxMTozMTo0NFrOF6BYkw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjM4NDQwMw==", "bodyText": "Is there any ToC or index document in which this new documentation file should be linked?\nIn addition, maybe (not sure) it should be added to mkdocs.yml file.", "url": "https://github.com/telefonicaid/fiware-cygnus/pull/1842#discussion_r396384403", "createdAt": "2020-03-23T11:31:44Z", "author": {"login": "fgalan"}, "path": "doc/cygnus-common/backends_catalogue/sql_backend.md", "diffHunk": "@@ -0,0 +1,16 @@\n+# SQL backend", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a8e37d178ca22cb91e272da27fcef067c7e5f36f"}, "originalPosition": 1}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5MzQ2NjE1", "url": "https://github.com/telefonicaid/fiware-cygnus/pull/1842#pullrequestreview-379346615", "createdAt": "2020-03-23T11:34:47Z", "commit": {"oid": "a8e37d178ca22cb91e272da27fcef067c7e5f36f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxMTozNDo0N1rOF6Bexg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxMTozNDo0N1rOF6Bexg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjM4NTk5MA==", "bodyText": "I guess all logs in SQLBackend should include instance name", "url": "https://github.com/telefonicaid/fiware-cygnus/pull/1842#discussion_r396385990", "createdAt": "2020-03-23T11:34:47Z", "author": {"login": "AlvaroVega"}, "path": "cygnus-common/src/main/java/com/telefonica/iot/cygnus/backends/sql/SQLBackend.java", "diffHunk": "@@ -75,196 +67,207 @@ public void close(){\n     } // close\n \n     /**\n-     * Sets the MySQL driver. It is protected since it is only used by the\n+     * Sets the SQL driver. It is protected since it is only used by the\n      * tests.\n-     * \n-     * @param driver\n-     *            The MySQL driver to be set.\n+     *\n+     * @param driver The SQL driver to be set.\n      */\n-    protected void setDriver(MySQLDriver driver) {\n+    public void setDriver(SQLBackend.SQLDriver driver) {\n         this.driver = driver;\n     } // setDriver\n \n-    protected MySQLDriver getDriver() {\n+    public SQLBackend.SQLDriver getDriver() {\n         return driver;\n     } // getDriver\n \n-    @Override\n-    public void createDatabase(String dbName) throws CygnusRuntimeError, CygnusPersistenceError {\n-        if (cache.isCachedDb(dbName)) {\n-            LOGGER.debug(\"'\" + dbName + \"' is cached, thus it is not created\");\n+    public void createDestination(String destination) throws CygnusRuntimeError, CygnusPersistenceError {\n+        if (cache.isCachedDestination(destination)) {\n+            LOGGER.debug(\"'\" + destination + \"' is cached, thus it is not created\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a8e37d178ca22cb91e272da27fcef067c7e5f36f"}, "originalPosition": 124}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ebc6ca07cf1689097947dbabb4d7819fcb16a704", "author": {"user": {"login": "IvanHdzC", "name": "Ivan Hernandez"}}, "url": "https://github.com/telefonicaid/fiware-cygnus/commit/ebc6ca07cf1689097947dbabb4d7819fcb16a704", "committedDate": "2020-03-23T12:05:49Z", "message": "update mkdocs"}, "afterCommit": {"oid": "63fc1b6f12965957ccaa23266a3e282beba68613", "author": {"user": {"login": "IvanHdzC", "name": "Ivan Hernandez"}}, "url": "https://github.com/telefonicaid/fiware-cygnus/commit/63fc1b6f12965957ccaa23266a3e282beba68613", "committedDate": "2020-03-23T14:03:09Z", "message": "update mkdocs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f880887ecdb4c3d54ae9b1bcc0e3fd2037202cbb", "author": {"user": {"login": "IvanHdzC", "name": "Ivan Hernandez"}}, "url": "https://github.com/telefonicaid/fiware-cygnus/commit/f880887ecdb4c3d54ae9b1bcc0e3fd2037202cbb", "committedDate": "2020-03-23T14:05:23Z", "message": "update mkdocs"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "63fc1b6f12965957ccaa23266a3e282beba68613", "author": {"user": {"login": "IvanHdzC", "name": "Ivan Hernandez"}}, "url": "https://github.com/telefonicaid/fiware-cygnus/commit/63fc1b6f12965957ccaa23266a3e282beba68613", "committedDate": "2020-03-23T14:03:09Z", "message": "update mkdocs"}, "afterCommit": {"oid": "f880887ecdb4c3d54ae9b1bcc0e3fd2037202cbb", "author": {"user": {"login": "IvanHdzC", "name": "Ivan Hernandez"}}, "url": "https://github.com/telefonicaid/fiware-cygnus/commit/f880887ecdb4c3d54ae9b1bcc0e3fd2037202cbb", "committedDate": "2020-03-23T14:05:23Z", "message": "update mkdocs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "adb4518e1f1d47ec28b72bd74b6374771d821b7e", "author": {"user": {"login": "IvanHdzC", "name": "Ivan Hernandez"}}, "url": "https://github.com/telefonicaid/fiware-cygnus/commit/adb4518e1f1d47ec28b72bd74b6374771d821b7e", "committedDate": "2020-03-23T14:16:45Z", "message": "add SQLBackend interface"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5NDkyODM1", "url": "https://github.com/telefonicaid/fiware-cygnus/pull/1842#pullrequestreview-379492835", "createdAt": "2020-03-23T14:39:41Z", "commit": {"oid": "adb4518e1f1d47ec28b72bd74b6374771d821b7e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "73fcd169075d36e70b889d53fbf82c37dbb1bcba", "author": {"user": {"login": "IvanHdzC", "name": "Ivan Hernandez"}}, "url": "https://github.com/telefonicaid/fiware-cygnus/commit/73fcd169075d36e70b889d53fbf82c37dbb1bcba", "committedDate": "2020-03-24T10:56:26Z", "message": "add sql instance name to logs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "060383356b7fb0ef07be9e868c0bae69d3a883f9", "author": {"user": {"login": "IvanHdzC", "name": "Ivan Hernandez"}}, "url": "https://github.com/telefonicaid/fiware-cygnus/commit/060383356b7fb0ef07be9e868c0bae69d3a883f9", "committedDate": "2020-03-24T11:16:41Z", "message": "Merge branch 'master' into task/generic_SQL_backend"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwMjEyNjkx", "url": "https://github.com/telefonicaid/fiware-cygnus/pull/1842#pullrequestreview-380212691", "createdAt": "2020-03-24T11:18:26Z", "commit": {"oid": "060383356b7fb0ef07be9e868c0bae69d3a883f9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3820, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}