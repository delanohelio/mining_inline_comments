{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk2OTUzNzEz", "number": 1850, "title": "20200401 New CKAN DataModel", "bodyText": "", "createdAt": "2020-04-01T12:08:41Z", "url": "https://github.com/telefonicaid/fiware-cygnus/pull/1850", "merged": true, "mergeCommit": {"oid": "e50a8a74478f3c4171eeae61ce86fac9cefdfc33"}, "closed": true, "closedAt": "2020-05-22T11:41:06Z", "author": {"login": "VicenteLT"}, "timelineItems": {"totalCount": 37, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcTWfYhAH2gAyMzk2OTUzNzEzOmRkNjFiYmRlZjllMTIyZDZlMTQzZDE1ZjlkOGU0OTdmOTY5N2ZkY2U=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcjwQPkgFqTQxNjgyODg3MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "dd61bbdef9e122d6e143d15f9d8e497f9697fdce", "author": {"user": null}, "url": "https://github.com/telefonicaid/fiware-cygnus/commit/dd61bbdef9e122d6e143d15f9d8e497f9697fdce", "committedDate": "2020-04-01T12:02:50Z", "message": "20200401 New CKAN DataModel"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b2f08615bebf5bedb4681eee5414cf35043e5791", "author": {"user": null}, "url": "https://github.com/telefonicaid/fiware-cygnus/commit/b2f08615bebf5bedb4681eee5414cf35043e5791", "committedDate": "2020-04-01T12:11:58Z", "message": "20200401 New CKAN DataModel Tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg1NTY4NTY2", "url": "https://github.com/telefonicaid/fiware-cygnus/pull/1850#pullrequestreview-385568566", "createdAt": "2020-04-01T13:11:10Z", "commit": {"oid": "b2f08615bebf5bedb4681eee5414cf35043e5791"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQxMzoxMToxMFrOF-_3pg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQxMzoxMToxMFrOF-_3pg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTYwMjQ3MA==", "bodyText": "The goal for this task is to use the entity id as orgName, pkgName and resName.\nPerhaps It isn't necessary to store again the entityId on the sink, because it's already stored into the corresponding objects inside the generic aggregator.\ndo you agree @VicenteLT?", "url": "https://github.com/telefonicaid/fiware-cygnus/pull/1850#discussion_r401602470", "createdAt": "2020-04-01T13:11:10Z", "author": {"login": "IvanHdzC"}, "path": "cygnus-ngsi/src/main/java/com/telefonica/iot/cygnus/sinks/NGSICKANSink.java", "diffHunk": "@@ -349,6 +362,7 @@ private void persistAggregation(NGSIGenericAggregator aggregator, String service\n                 aggregation += \",\" + jsonObject;\n             }\n         }\n+        entityId=aggregator.getEntityId();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b2f08615bebf5bedb4681eee5414cf35043e5791"}, "originalPosition": 65}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2fec1dcc982f4a027fa828b46e243d19ebf12873", "author": {"user": null}, "url": "https://github.com/telefonicaid/fiware-cygnus/commit/2fec1dcc982f4a027fa828b46e243d19ebf12873", "committedDate": "2020-04-01T17:02:17Z", "message": "20200401 New CKAN DataModel - Remove entityId"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2MTc4OTYx", "url": "https://github.com/telefonicaid/fiware-cygnus/pull/1850#pullrequestreview-386178961", "createdAt": "2020-04-02T07:45:40Z", "commit": {"oid": "2fec1dcc982f4a027fa828b46e243d19ebf12873"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQwNzo0NTo0MFrOF_fFpg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQwNzo0NTo0MFrOF_fFpg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjExMzk1OA==", "bodyText": "remove this lines", "url": "https://github.com/telefonicaid/fiware-cygnus/pull/1850#discussion_r402113958", "createdAt": "2020-04-02T07:45:40Z", "author": {"login": "IvanHdzC"}, "path": "cygnus-ngsi/src/main/java/com/telefonica/iot/cygnus/aggregation/NGSIGenericAggregator.java", "diffHunk": "@@ -393,6 +394,24 @@ public void setEntityType(String entityType) {\n     } //setEntityType\n \n     /**\n+     * Gets the entityId", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2fec1dcc982f4a027fa828b46e243d19ebf12873"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2MTc5MDcz", "url": "https://github.com/telefonicaid/fiware-cygnus/pull/1850#pullrequestreview-386179073", "createdAt": "2020-04-02T07:45:49Z", "commit": {"oid": "2fec1dcc982f4a027fa828b46e243d19ebf12873"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQwNzo0NTo0OVrOF_fF_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQwNzo0NTo0OVrOF_fF_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjExNDA0Ng==", "bodyText": "remove this line", "url": "https://github.com/telefonicaid/fiware-cygnus/pull/1850#discussion_r402114046", "createdAt": "2020-04-02T07:45:49Z", "author": {"login": "IvanHdzC"}, "path": "cygnus-ngsi/src/main/java/com/telefonica/iot/cygnus/sinks/NGSICKANSink.java", "diffHunk": "@@ -349,6 +346,7 @@ private void persistAggregation(NGSIGenericAggregator aggregator, String service\n                 aggregation += \",\" + jsonObject;\n             }\n         }\n+        //entityId=aggregator.getEntityId();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2fec1dcc982f4a027fa828b46e243d19ebf12873"}, "originalPosition": 65}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b179bd50cd3a0408217c4d5d0878910cc8530ce1", "author": {"user": null}, "url": "https://github.com/telefonicaid/fiware-cygnus/commit/b179bd50cd3a0408217c4d5d0878910cc8530ce1", "committedDate": "2020-04-02T08:59:37Z", "message": "20200402 New CKAN DataModel - Remove entityId from GenericAggregator"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "097cfc576625ab25cde9f08b66696f277716fd36", "author": {"user": null}, "url": "https://github.com/telefonicaid/fiware-cygnus/commit/097cfc576625ab25cde9f08b66696f277716fd36", "committedDate": "2020-04-02T12:40:38Z", "message": "20200402 New CKAN DataModel - Update documentation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2NDQ0NDA1", "url": "https://github.com/telefonicaid/fiware-cygnus/pull/1850#pullrequestreview-386444405", "createdAt": "2020-04-02T13:49:46Z", "commit": {"oid": "097cfc576625ab25cde9f08b66696f277716fd36"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxMzo0OTo0NlrOF_sJTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxMzo0OTo0NlrOF_sJTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjMyNzg4NA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            | data\\_model | no | dm-by-entity | dm-by-entity-id | <i>dm-by-entity</i>, even if not configured. ||\n          \n          \n            \n            | data\\_model | no | dm-by-entity | <i>dm-by-entity-id</i>, <i>dm-by-entity</i> ||", "url": "https://github.com/telefonicaid/fiware-cygnus/pull/1850#discussion_r402327884", "createdAt": "2020-04-02T13:49:46Z", "author": {"login": "IvanHdzC"}, "path": "doc/cygnus-ngsi/flume_extensions_catalogue/ngsi_ckan_sink.md", "diffHunk": "@@ -325,7 +351,7 @@ NOTE: `curl` is a Unix command allowing for interacting with REST APIs such as t\n | enable\\_encoding\u00a0| no | false | <i>true</i> or <i>false</i>, <i>true</i> applies the new encoding, <i>false</i> applies the old encoding. ||\n | enable\\_grouping | no | false | <i>true</i> or <i>false</i>. Check this [link](./ngsi_grouping_interceptor.md) for more details. ||\n | enable\\_name\\_mappings | no | false | <i>true</i> or <i>false</i>. Check this [link](./ngsi_name_mappings_interceptor.md) for more details. ||\n-| data\\_model | no | dm-by-entity |  Always <i>dm-by-entity</i>, even if not configured. ||\n+| data\\_model | no | dm-by-entity | dm-by-entity-id | <i>dm-by-entity</i>, even if not configured. ||", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "097cfc576625ab25cde9f08b66696f277716fd36"}, "originalPosition": 71}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aad6fe1d70613f27b5bae4ab36969c8fa512c61c", "author": {"user": null}, "url": "https://github.com/telefonicaid/fiware-cygnus/commit/aad6fe1d70613f27b5bae4ab36969c8fa512c61c", "committedDate": "2020-04-02T15:00:25Z", "message": "20200402 New CKAN DataModel - Update documentacion 1.1"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2NTUwODQx", "url": "https://github.com/telefonicaid/fiware-cygnus/pull/1850#pullrequestreview-386550841", "createdAt": "2020-04-02T15:38:49Z", "commit": {"oid": "aad6fe1d70613f27b5bae4ab36969c8fa512c61c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2Njk4NDY0", "url": "https://github.com/telefonicaid/fiware-cygnus/pull/1850#pullrequestreview-386698464", "createdAt": "2020-04-02T18:41:28Z", "commit": {"oid": "aad6fe1d70613f27b5bae4ab36969c8fa512c61c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxODo0MToyOFrOF_4nHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxODo0MToyOFrOF_4nHA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjUzMjEyNA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                /*entityId\n          \n          \n            \n                /**\n          \n      \n    \n    \n  \n\nSeems to be a typo", "url": "https://github.com/telefonicaid/fiware-cygnus/pull/1850#discussion_r402532124", "createdAt": "2020-04-02T18:41:28Z", "author": {"login": "fgalan"}, "path": "cygnus-ngsi/src/main/java/com/telefonica/iot/cygnus/sinks/NGSICKANSink.java", "diffHunk": "@@ -66,7 +67,7 @@\n     private String ckanViewer;\n     private CKANBackend persistenceBackend;\n \n-    /**\n+    /*entityId", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aad6fe1d70613f27b5bae4ab36969c8fa512c61c"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2NzAwMzU3", "url": "https://github.com/telefonicaid/fiware-cygnus/pull/1850#pullrequestreview-386700357", "createdAt": "2020-04-02T18:44:07Z", "commit": {"oid": "aad6fe1d70613f27b5bae4ab36969c8fa512c61c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxODo0NDowN1rOF_4tJw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxODo0NDowN1rOF_4tJw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjUzMzY3MQ==", "bodyText": "Block seems to be missindented\n\nMabye some spaces vs. tab issue?", "url": "https://github.com/telefonicaid/fiware-cygnus/pull/1850#discussion_r402533671", "createdAt": "2020-04-02T18:44:07Z", "author": {"login": "fgalan"}, "path": "cygnus-ngsi/src/main/java/com/telefonica/iot/cygnus/sinks/NGSICKANSink.java", "diffHunk": "@@ -442,22 +450,27 @@ public String buildPkgName(String fiwareService, String fiwareServicePath) throw\n      * @return Resource name\n      * @throws CygnusBadConfiguration\n      */\n-    public String buildResName(String entity) throws CygnusBadConfiguration {\n+    public String buildResName(String entity, String entityId) throws CygnusBadConfiguration {\n         String resName;\n-        \n-        if (enableEncoding) {\n-            resName = NGSICharsets.encodeCKAN(entity);\n-        } else {\n-            resName = NGSIUtils.encode(entity, false, true).toLowerCase(Locale.ENGLISH);\n-        } // if else\n+        switch(dataModel) {\n+            case DMBYENTITYID:\n+            \tresName=entityId;\n+                break;\n+        default:\n+            if (enableEncoding) {\n+                resName = NGSICharsets.encodeCKAN(entity);\n+            } else {\n+                resName = NGSIUtils.encode(entity, false, true).toLowerCase(Locale.ENGLISH);\n+            } // if else", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aad6fe1d70613f27b5bae4ab36969c8fa512c61c"}, "originalPosition": 171}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2NzAxMTgx", "url": "https://github.com/telefonicaid/fiware-cygnus/pull/1850#pullrequestreview-386701181", "createdAt": "2020-04-02T18:45:21Z", "commit": {"oid": "aad6fe1d70613f27b5bae4ab36969c8fa512c61c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxODo0NToyMVrOF_4v5Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxODo0NToyMVrOF_4v5Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjUzNDM3Mw==", "bodyText": "Missidentent block:\n\nMaybe some \"spaces vs. tabs\" issue?", "url": "https://github.com/telefonicaid/fiware-cygnus/pull/1850#discussion_r402534373", "createdAt": "2020-04-02T18:45:21Z", "author": {"login": "fgalan"}, "path": "cygnus-ngsi/src/main/java/com/telefonica/iot/cygnus/sinks/NGSISink.java", "diffHunk": "@@ -871,6 +874,37 @@ private void accumulateByEntityType(NGSIEvent event) {\n             batch.addEvent(destination, event);\n         } // accumulateByEntityType\n \n+        private void accumulateByEntityId(NGSIEvent event) {\n+        \tMap<String, String> headers = event.getHeaders();\n+            ContextElement originalCE = event.getOriginalCE();\n+            ContextElement mappedCE = event.getMappedCE();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aad6fe1d70613f27b5bae4ab36969c8fa512c61c"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2NzAzMDEx", "url": "https://github.com/telefonicaid/fiware-cygnus/pull/1850#pullrequestreview-386703011", "createdAt": "2020-04-02T18:47:57Z", "commit": {"oid": "aad6fe1d70613f27b5bae4ab36969c8fa512c61c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxODo0Nzo1N1rOF_41mg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxODo0Nzo1N1rOF_41mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjUzNTgzNA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            The resiurce name depends on the configured data model (see the [Configuration](#section2.1) section for more details):\n          \n          \n            \n            The resource name depends on the configured data model (see the [Configuration](#section2.1) section for more details):", "url": "https://github.com/telefonicaid/fiware-cygnus/pull/1850#discussion_r402535834", "createdAt": "2020-04-02T18:47:57Z", "author": {"login": "fgalan"}, "path": "doc/cygnus-ngsi/flume_extensions_catalogue/ngsi_ckan_sink.md", "diffHunk": "@@ -50,32 +50,58 @@ This is done at the cygnus-ngsi Http listeners (in Flume jergon, sources) thanks\n [Top](#top)\n \n #### <a name=\"section1.2.1\"></a>Organizations naming conventions\n-An organization named as the notified `fiware-service` header value (or, in absence of such a header, the defaulted value for the FIWARE service) is created (if not existing yet).\n+* Data model by entity (`data_model=dm-by-entity`). An organization named as the notified `fiware-service` header value (or, in absence of such a header, the defaulted value for the FIWARE service) is created (if not existing yet).\n+Since based in [PostgreSQL only accepts] \n+https://www.postgresql.org/docs/current/static/sql-syntax-lexical.html#SQL-SYNTAX-IDENTIFIERS), it must be said only alphanumeric characters and the underscore (`_`) are accepted. The hyphen ('-') is also accepted. This leads to certain [encoding](#section2.3.3) is applied depending on the `enable_encoding` configuration parameter.\n+Nevertheless, different than PostgreSQL, [organization lengths](http://docs.ckan.org/en/latest/api/#ckan.logic.action.create.organization_create) may be up to 100 characters (minimum, 2 characters).\n \n-Since based in [PostgreSQL only accepts](https://www.postgresql.org/docs/current/static/sql-syntax-lexical.html#SQL-SYNTAX-IDENTIFIERS), it must be said only alphanumeric characters and the underscore (`_`) are accepted. The hyphen ('-') is also accepted. This leads to certain [encoding](#section2.3.3) is applied depending on the `enable_encoding` configuration parameter.\n \n-Nevertheless, different than PostgreSQL, [organization lengths](http://docs.ckan.org/en/latest/api/#ckan.logic.action.create.organization_create) may be up to 100 characters (minimum, 2 characters).\n+* Data model by entity id (`data_model=dm-by-entity-id`). The organization name will take the value of the notified header `fiware-service` without encoding.\n+\n+The following table summarizes the organization name composition:\n+\n+| FIWARE service path | `dm-by-entity` | `dm-by-entity-id` |\n+|---|---|---|\n+| `/` | `<fiware-service>` | `<fiware-service>` | \n \n [Top](#top)\n \n #### <a name=\"section1.2.2\"></a>Packages/datasets naming conventions\n-A package/dataset named as the concatenation of the notified `fiware-service` and `fiware-servicePath` header values (or, in absence of such headers, the defaulted value for the FIWARE service and service path) is created (if not existing yet) in the above organization.\n+* Data model by entity (`data_model=dm-by-entity`). A package/dataset named as the concatenation of the notified `fiware-service` and `fiware-servicePath` header values (or, in absence of such headers, the defaulted value for the FIWARE service and service path) is created (if not existing yet) in the above organization.\n+Since based in [PostgreSQL only accepts](https://www.postgresql.org/docs/current/static/sql-syntax-lexical.html#SQL-SYNTAX-IDENTIFIERS), it must be said only alphanumeric characters and the underscore (`_`) are accepted. The hyphen ('-') is also accepted. This leads to  certain [encoding](#section2.3.3) is applied depending on the `enable_encoding` configuration parameter\n+Nevertheless, different than PostgreSQL, [dataset lengths](http://docs.ckan.org/en/latest/api/#ckan.logic.action.create.package_create) may be up to 100 characters (minimum, 2 characters).\n \n-Since based in [PostgreSQL only accepts](https://www.postgresql.org/docs/current/static/sql-syntax-lexical.html#SQL-SYNTAX-IDENTIFIERS), it must be said only alphanumeric characters and the underscore (`_`) are accepted. The hyphen ('-') is also accepted. This leads to  certain [encoding](#section2.3.3) is applied depending on the `enable_encoding` configuration parameter.\n \n-Nevertheless, different than PostgreSQL, [dataset lengths](http://docs.ckan.org/en/latest/api/#ckan.logic.action.create.package_create) may be up to 100 characters (minimum, 2 characters).\n+* Data model by entity id (`data_model=dm-by-entity-id`). A package/dataset name always take the entity ID. Such a name is already given in the NGSIEvent values, see the [Configuration](#section2.1) section for more details) within the the `NGSIEvent`.\n+\n+The following table summarizes the package name composition:\n+\n+| FIWARE service path | `dm-by-entity` | `dm-by-entity-id` |\n+|---|---|---|\n+| `/` | `<fiware-service>_<fiware-servicePath>` | `<entityId>` | \n \n [Top](#top)\n \n #### <a name=\"section1.2.3\"></a>Resources naming conventions\n-CKAN resources follow a single data model (see the [Configuration](#section2.1) section for more details), i.e. per entity. Thus, a resource name always take the concatenation of the entity ID and type. Such a name is already given in the `notified_entities`/`grouped_entities` header values (depending on using or not the grouping rules, see the [Configuration](#section2.1) section for more details) within the `NGSIEvent`.\n+The resiurce name depends on the configured data model (see the [Configuration](#section2.1) section for more details):", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aad6fe1d70613f27b5bae4ab36969c8fa512c61c"}, "originalPosition": 44}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2NzA1MTIw", "url": "https://github.com/telefonicaid/fiware-cygnus/pull/1850#pullrequestreview-386705120", "createdAt": "2020-04-02T18:50:50Z", "commit": {"oid": "aad6fe1d70613f27b5bae4ab36969c8fa512c61c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxODo1MDo1MFrOF_48cA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxODo1MDo1MFrOF_48cA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjUzNzU4NA==", "bodyText": "According to \" Data model by entity (data_model=dm-by-entity). A resource name always take the concatenation of the entity ID and type\", is the second one (<entityType>) correct? Shouldn't include the entity id concatened in some way?", "url": "https://github.com/telefonicaid/fiware-cygnus/pull/1850#discussion_r402537584", "createdAt": "2020-04-02T18:50:50Z", "author": {"login": "fgalan"}, "path": "doc/cygnus-ngsi/flume_extensions_catalogue/ngsi_ckan_sink.md", "diffHunk": "@@ -50,32 +50,58 @@ This is done at the cygnus-ngsi Http listeners (in Flume jergon, sources) thanks\n [Top](#top)\n \n #### <a name=\"section1.2.1\"></a>Organizations naming conventions\n-An organization named as the notified `fiware-service` header value (or, in absence of such a header, the defaulted value for the FIWARE service) is created (if not existing yet).\n+* Data model by entity (`data_model=dm-by-entity`). An organization named as the notified `fiware-service` header value (or, in absence of such a header, the defaulted value for the FIWARE service) is created (if not existing yet).\n+Since based in [PostgreSQL only accepts] \n+https://www.postgresql.org/docs/current/static/sql-syntax-lexical.html#SQL-SYNTAX-IDENTIFIERS), it must be said only alphanumeric characters and the underscore (`_`) are accepted. The hyphen ('-') is also accepted. This leads to certain [encoding](#section2.3.3) is applied depending on the `enable_encoding` configuration parameter.\n+Nevertheless, different than PostgreSQL, [organization lengths](http://docs.ckan.org/en/latest/api/#ckan.logic.action.create.organization_create) may be up to 100 characters (minimum, 2 characters).\n \n-Since based in [PostgreSQL only accepts](https://www.postgresql.org/docs/current/static/sql-syntax-lexical.html#SQL-SYNTAX-IDENTIFIERS), it must be said only alphanumeric characters and the underscore (`_`) are accepted. The hyphen ('-') is also accepted. This leads to certain [encoding](#section2.3.3) is applied depending on the `enable_encoding` configuration parameter.\n \n-Nevertheless, different than PostgreSQL, [organization lengths](http://docs.ckan.org/en/latest/api/#ckan.logic.action.create.organization_create) may be up to 100 characters (minimum, 2 characters).\n+* Data model by entity id (`data_model=dm-by-entity-id`). The organization name will take the value of the notified header `fiware-service` without encoding.\n+\n+The following table summarizes the organization name composition:\n+\n+| FIWARE service path | `dm-by-entity` | `dm-by-entity-id` |\n+|---|---|---|\n+| `/` | `<fiware-service>` | `<fiware-service>` | \n \n [Top](#top)\n \n #### <a name=\"section1.2.2\"></a>Packages/datasets naming conventions\n-A package/dataset named as the concatenation of the notified `fiware-service` and `fiware-servicePath` header values (or, in absence of such headers, the defaulted value for the FIWARE service and service path) is created (if not existing yet) in the above organization.\n+* Data model by entity (`data_model=dm-by-entity`). A package/dataset named as the concatenation of the notified `fiware-service` and `fiware-servicePath` header values (or, in absence of such headers, the defaulted value for the FIWARE service and service path) is created (if not existing yet) in the above organization.\n+Since based in [PostgreSQL only accepts](https://www.postgresql.org/docs/current/static/sql-syntax-lexical.html#SQL-SYNTAX-IDENTIFIERS), it must be said only alphanumeric characters and the underscore (`_`) are accepted. The hyphen ('-') is also accepted. This leads to  certain [encoding](#section2.3.3) is applied depending on the `enable_encoding` configuration parameter\n+Nevertheless, different than PostgreSQL, [dataset lengths](http://docs.ckan.org/en/latest/api/#ckan.logic.action.create.package_create) may be up to 100 characters (minimum, 2 characters).\n \n-Since based in [PostgreSQL only accepts](https://www.postgresql.org/docs/current/static/sql-syntax-lexical.html#SQL-SYNTAX-IDENTIFIERS), it must be said only alphanumeric characters and the underscore (`_`) are accepted. The hyphen ('-') is also accepted. This leads to  certain [encoding](#section2.3.3) is applied depending on the `enable_encoding` configuration parameter.\n \n-Nevertheless, different than PostgreSQL, [dataset lengths](http://docs.ckan.org/en/latest/api/#ckan.logic.action.create.package_create) may be up to 100 characters (minimum, 2 characters).\n+* Data model by entity id (`data_model=dm-by-entity-id`). A package/dataset name always take the entity ID. Such a name is already given in the NGSIEvent values, see the [Configuration](#section2.1) section for more details) within the the `NGSIEvent`.\n+\n+The following table summarizes the package name composition:\n+\n+| FIWARE service path | `dm-by-entity` | `dm-by-entity-id` |\n+|---|---|---|\n+| `/` | `<fiware-service>_<fiware-servicePath>` | `<entityId>` | \n \n [Top](#top)\n \n #### <a name=\"section1.2.3\"></a>Resources naming conventions\n-CKAN resources follow a single data model (see the [Configuration](#section2.1) section for more details), i.e. per entity. Thus, a resource name always take the concatenation of the entity ID and type. Such a name is already given in the `notified_entities`/`grouped_entities` header values (depending on using or not the grouping rules, see the [Configuration](#section2.1) section for more details) within the `NGSIEvent`.\n+The resiurce name depends on the configured data model (see the [Configuration](#section2.1) section for more details):\n+\n+* Data model by entity (`data_model=dm-by-entity`). A resource name always take the concatenation of the entity ID and type. Such a name is already given in the `notified_entities`/`grouped_entities` header values (depending on using or not the grouping rules, see the [Configuration](#section2.1) section for more details) within the `NGSIEvent`.\n+\n+\n+* Data model by entity id (`data_model=dm-by-entity-id`). A resource name always take the entity ID. Such a name is already given in the NGSIEvent values, see the [Configuration](#section2.1) section for more details) within the the `NGSIEvent`. \n \n It must be noticed a CKAN Datastore (and a viewer) is also created and associated to the resource above. This datastore, which in the end is a PostgreSQL table, will hold the persisted data.\n \n Since based in [PostgreSQL](https://www.postgresql.org/docs/current/static/sql-syntax-lexical.html#SQL-SYNTAX-IDENTIFIERS), it must be said only alphanumeric characters and the underscore (`_`) are accepted. The hyphen ('-') is also accepted. This leads to  certain [encoding](#section2.3.3) is applied depending on the `enable_encoding` configuration parameter.\n \n Despite there is no real limit on the resource names, Cygnus will keep limiting their lengths up to 100 characters (minimum, 2 characters), accordingly to what's done with organization and package names.\n \n+The following table summarizes the resource name composition:\n+\n+| FIWARE service path | `dm-by-entity` | `dm-by-entity-id` |\n+|---|---|---|\n+| `/` | `<entityType>` | `<entityId>` |", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aad6fe1d70613f27b5bae4ab36969c8fa512c61c"}, "originalPosition": 61}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2NzExNzkx", "url": "https://github.com/telefonicaid/fiware-cygnus/pull/1850#pullrequestreview-386711791", "createdAt": "2020-04-02T18:59:39Z", "commit": {"oid": "aad6fe1d70613f27b5bae4ab36969c8fa512c61c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxODo1OTozOVrOF_5RnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxODo1OTozOVrOF_5RnQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjU0MzAwNQ==", "bodyText": "Previously to this PR, dm-by-entity was the only mode supported, wasn't it? Or, in other words, this PR has added the possibility of using dm-by-entity-id.\nIs my understanding correct?", "url": "https://github.com/telefonicaid/fiware-cygnus/pull/1850#discussion_r402543005", "createdAt": "2020-04-02T18:59:39Z", "author": {"login": "fgalan"}, "path": "doc/cygnus-ngsi/flume_extensions_catalogue/ngsi_ckan_sink.md", "diffHunk": "@@ -325,7 +351,7 @@ NOTE: `curl` is a Unix command allowing for interacting with REST APIs such as t\n | enable\\_encoding\u00a0| no | false | <i>true</i> or <i>false</i>, <i>true</i> applies the new encoding, <i>false</i> applies the old encoding. ||\n | enable\\_grouping | no | false | <i>true</i> or <i>false</i>. Check this [link](./ngsi_grouping_interceptor.md) for more details. ||\n | enable\\_name\\_mappings | no | false | <i>true</i> or <i>false</i>. Check this [link](./ngsi_name_mappings_interceptor.md) for more details. ||\n-| data\\_model | no | dm-by-entity |  Always <i>dm-by-entity</i>, even if not configured. ||\n+| data\\_model | no | dm-by-entity | <i>dm-by-entity-id</i>, <i>dm-by-entity</i> ||", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aad6fe1d70613f27b5bae4ab36969c8fa512c61c"}, "originalPosition": 71}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2NzE0OTk3", "url": "https://github.com/telefonicaid/fiware-cygnus/pull/1850#pullrequestreview-386714997", "createdAt": "2020-04-02T19:04:17Z", "commit": {"oid": "aad6fe1d70613f27b5bae4ab36969c8fa512c61c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxOTowNDoxN1rOF_5b0w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxOTowNDoxN1rOF_5b0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjU0NTYxOQ==", "bodyText": "As far as I understand (according to https://github.com/telefonicaid/fiware-cygnus/pull/1850/files#diff-7d759ac06f173f8e331ae811fbf231c7R354) CKAN sink support two modes: dm-by-entity-id and dm-by-entity. I see the following pattern in this PR (in several places):\n        switch(dataModel) {\n            case DMBYENTITYID:\n                // Code for processing the dm-by-entity-id case\n                break;\n            default:\n                // Code for processing the dm-by-entity\n                break;\n\nHowever, I'd suggest a more extensible and robuts approach:\n        switch(dataModel) {\n            case DMBYENTITYID:\n                // Code for processing the dm-by-entity-id case\n                break;\n            case DMBYENTITY:\n                // Code for processing the dm-by-entity\n                break;\n            default:\n                // Deal with the error of trying to use an unsupported mode (log, etc.)\n                break;", "url": "https://github.com/telefonicaid/fiware-cygnus/pull/1850#discussion_r402545619", "createdAt": "2020-04-02T19:04:17Z", "author": {"login": "fgalan"}, "path": "cygnus-ngsi/src/main/java/com/telefonica/iot/cygnus/sinks/NGSICKANSink.java", "diffHunk": "@@ -409,29 +411,35 @@ public String buildOrgName(String fiwareService) throws CygnusBadConfiguration {\n      * @return Package name\n      * @throws CygnusBadConfiguration\n      */\n-    public String buildPkgName(String fiwareService, String fiwareServicePath) throws CygnusBadConfiguration {\n+    public String buildPkgName(String fiwareService, String fiwareServicePath, String entityId) throws CygnusBadConfiguration {\n         String pkgName;\n         \n-        if (enableEncoding) {\n-            pkgName = NGSICharsets.encodeCKAN(fiwareService)\n-                    + CommonConstants.CONCATENATOR\n-                    + NGSICharsets.encodeCKAN(fiwareServicePath);\n-        } else {\n-            if (fiwareServicePath.equals(\"/\")) {\n-                pkgName = NGSIUtils.encode(fiwareService, false, true).toLowerCase(Locale.ENGLISH);\n-            } else {\n-                pkgName = (NGSIUtils.encode(fiwareService, false, true)\n-                        + NGSIUtils.encode(fiwareServicePath, false, true)).toLowerCase(Locale.ENGLISH);\n-            } // if else\n-        } // if else\n-\n-        if (pkgName.length() > NGSIConstants.CKAN_MAX_NAME_LEN) {\n-            throw new CygnusBadConfiguration(\"Building package name '\" + pkgName + \"' and its length is \"\n-                    + \"greater than \" + NGSIConstants.CKAN_MAX_NAME_LEN);\n-        } else if (pkgName.length() < NGSIConstants.CKAN_MIN_NAME_LEN) {\n-            throw new CygnusBadConfiguration(\"Building package name '\" + pkgName + \"' and its length is \"\n-                    + \"lower than \" + NGSIConstants.CKAN_MIN_NAME_LEN);\n-        } // if else if\n+        switch(dataModel) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aad6fe1d70613f27b5bae4ab36969c8fa512c61c"}, "originalPosition": 120}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2NzE2Mzk4", "url": "https://github.com/telefonicaid/fiware-cygnus/pull/1850#pullrequestreview-386716398", "createdAt": "2020-04-02T19:06:19Z", "commit": {"oid": "aad6fe1d70613f27b5bae4ab36969c8fa512c61c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxOTowNjoxOVrOF_5gOQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxOTowNjoxOVrOF_5gOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjU0Njc0NQ==", "bodyText": "Maybe is a na\u00efve question :) but... where is the code that translate the string \"dm-by-entity-id\" to DMBYENTITYID ? Is some kind of generic uppercase + dash removal function?", "url": "https://github.com/telefonicaid/fiware-cygnus/pull/1850#discussion_r402546745", "createdAt": "2020-04-02T19:06:19Z", "author": {"login": "fgalan"}, "path": "cygnus-common/src/main/java/com/telefonica/iot/cygnus/sinks/Enums.java", "diffHunk": "@@ -14,6 +14,6 @@\n     /**\n      * Available data models for all the sinks.\n      */\n-    public enum DataModel { DMBYSERVICE, DMBYSERVICEPATH, DMBYENTITY, DMBYENTITYTYPE, DMBYATTRIBUTE }\n+    public enum DataModel { DMBYSERVICE, DMBYSERVICEPATH, DMBYENTITY, DMBYENTITYTYPE, DMBYATTRIBUTE, DMBYENTITYID }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aad6fe1d70613f27b5bae4ab36969c8fa512c61c"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3MzQzMjUz", "url": "https://github.com/telefonicaid/fiware-cygnus/pull/1850#pullrequestreview-387343253", "createdAt": "2020-04-03T15:08:57Z", "commit": {"oid": "aad6fe1d70613f27b5bae4ab36969c8fa512c61c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxNTowODo1N1rOGAZqtg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxNTowODo1N1rOGAZqtg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzA3MzcxOA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            [cygnus-ngsi] New datamodel for CKAN (subservice -> org, entityId -> dataset, entityId -> resource) (#1792)\n          \n          \n            \n            [cygnus-ngsi] New datamodel for CKAN (dm-by-entity-id) implementing mapping: subservice -> org, entityId -> dataset, entityId -> resource (#1792)\n          \n      \n    \n    \n  \n\nMaybe this way is more precise...", "url": "https://github.com/telefonicaid/fiware-cygnus/pull/1850#discussion_r403073718", "createdAt": "2020-04-03T15:08:57Z", "author": {"login": "fgalan"}, "path": "CHANGES_NEXT_RELEASE", "diffHunk": "@@ -12,3 +12,4 @@\n [cygnus-ngsi][Elasticsearch] Fix a bug that non-Latin characters such as Japanese are garbled. (#1839)\n [cygnus-ngsi][MongoSink]Fix on mongo collection name asignation. (#1845)\n [cygnus-ngsi][MongoSink]Fix on mongo recvTime Date format.\n+[cygnus-ngsi] New datamodel for CKAN (subservice -> org, entityId -> dataset, entityId -> resource) (#1792)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aad6fe1d70613f27b5bae4ab36969c8fa512c61c"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8a42a4f89d88cdca418e4826ec96eb7c77471259", "author": {"user": {"login": "IvanHdzC", "name": "Ivan Hernandez"}}, "url": "https://github.com/telefonicaid/fiware-cygnus/commit/8a42a4f89d88cdca418e4826ec96eb7c77471259", "committedDate": "2020-05-21T14:41:28Z", "message": "Update CHANGES_NEXT_RELEASE\n\nCo-authored-by: Ferm\u00edn Gal\u00e1n M\u00e1rquez <fgalan@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0ab256e454a652c3ec81c53c46be1cc41a9a0830", "author": {"user": {"login": "IvanHdzC", "name": "Ivan Hernandez"}}, "url": "https://github.com/telefonicaid/fiware-cygnus/commit/0ab256e454a652c3ec81c53c46be1cc41a9a0830", "committedDate": "2020-05-21T14:54:03Z", "message": "Fix Typo\n\nCo-authored-by: Ferm\u00edn Gal\u00e1n M\u00e1rquez <fgalan@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1651f0dbeb116b8222d7fe9df90bd4d603b17b5e", "author": {"user": {"login": "IvanHdzC", "name": "Ivan Hernandez"}}, "url": "https://github.com/telefonicaid/fiware-cygnus/commit/1651f0dbeb116b8222d7fe9df90bd4d603b17b5e", "committedDate": "2020-05-21T15:03:54Z", "message": "edit switch cases to add a new default behaviour"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db4c369038e851be614e0c5e15585f31d3a1303a", "author": {"user": {"login": "IvanHdzC", "name": "Ivan Hernandez"}}, "url": "https://github.com/telefonicaid/fiware-cygnus/commit/db4c369038e851be614e0c5e15585f31d3a1303a", "committedDate": "2020-05-21T15:06:11Z", "message": "Fix Typo\n\nCo-authored-by: Ferm\u00edn Gal\u00e1n M\u00e1rquez <fgalan@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "72fd80eef59c95ee8ade44adb2e4751144649009", "author": {"user": {"login": "IvanHdzC", "name": "Ivan Hernandez"}}, "url": "https://github.com/telefonicaid/fiware-cygnus/commit/72fd80eef59c95ee8ade44adb2e4751144649009", "committedDate": "2020-05-21T15:12:14Z", "message": "Fix indentation issue"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "83e580235e2d7418961ce226505d1224b9f91432", "author": {"user": {"login": "IvanHdzC", "name": "Ivan Hernandez"}}, "url": "https://github.com/telefonicaid/fiware-cygnus/commit/83e580235e2d7418961ce226505d1224b9f91432", "committedDate": "2020-05-21T15:33:52Z", "message": "Merge branch 'master' into feature/1792_fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "082929db96fee32ecdbab83c04a0393ad0962ba2", "author": {"user": {"login": "IvanHdzC", "name": "Ivan Hernandez"}}, "url": "https://github.com/telefonicaid/fiware-cygnus/commit/082929db96fee32ecdbab83c04a0393ad0962ba2", "committedDate": "2020-05-21T16:21:53Z", "message": "update docs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE2MzAyODkx", "url": "https://github.com/telefonicaid/fiware-cygnus/pull/1850#pullrequestreview-416302891", "createdAt": "2020-05-21T16:29:10Z", "commit": {"oid": "082929db96fee32ecdbab83c04a0393ad0962ba2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "63406ac96c73f988af1a78c91881848251c22a66", "author": {"user": {"login": "IvanHdzC", "name": "Ivan Hernandez"}}, "url": "https://github.com/telefonicaid/fiware-cygnus/commit/63406ac96c73f988af1a78c91881848251c22a66", "committedDate": "2020-05-22T08:55:50Z", "message": "update doc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1ed14fea42ed73cb07423237d67dea78af326afe", "author": {"user": {"login": "IvanHdzC", "name": "Ivan Hernandez"}}, "url": "https://github.com/telefonicaid/fiware-cygnus/commit/1ed14fea42ed73cb07423237d67dea78af326afe", "committedDate": "2020-05-22T08:58:20Z", "message": "add FIXME notes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE2NzU3Mzcy", "url": "https://github.com/telefonicaid/fiware-cygnus/pull/1850#pullrequestreview-416757372", "createdAt": "2020-05-22T09:00:40Z", "commit": {"oid": "1ed14fea42ed73cb07423237d67dea78af326afe"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQwOTowMDo0MFrOGZP7eA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQwOTowMDo0MFrOGZP7eA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTEyODU2OA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            * Data model by entity id (`data_model=dm-by-entity-id`). The organization name will take the value of the notified header `fiware-service` without encoding.\n          \n          \n            \n            * Data model by entity id (`data_model=dm-by-entity-id`). The organization name will take the value of the notified header `fiware-service`. Note that in this case, encoding is never applied (this is current marked as \"debt\" in the source code with a FIXME mark).", "url": "https://github.com/telefonicaid/fiware-cygnus/pull/1850#discussion_r429128568", "createdAt": "2020-05-22T09:00:40Z", "author": {"login": "fgalan"}, "path": "doc/cygnus-ngsi/flume_extensions_catalogue/ngsi_ckan_sink.md", "diffHunk": "@@ -50,32 +50,58 @@ This is done at the cygnus-ngsi Http listeners (in Flume jergon, sources) thanks\n [Top](#top)\n \n #### <a name=\"section1.2.1\"></a>Organizations naming conventions\n-An organization named as the notified `fiware-service` header value (or, in absence of such a header, the defaulted value for the FIWARE service) is created (if not existing yet).\n+* Data model by entity (`data_model=dm-by-entity`). An organization named as the notified `fiware-service` header value (or, in absence of such a header, the defaulted value for the FIWARE service) is created (if not existing yet).\n+Since based in [PostgreSQL only accepts] \n+https://www.postgresql.org/docs/current/static/sql-syntax-lexical.html#SQL-SYNTAX-IDENTIFIERS), it must be said only alphanumeric characters and the underscore (`_`) are accepted. The hyphen ('-') is also accepted. This leads to certain [encoding](#section2.3.3) is applied depending on the `enable_encoding` configuration parameter.\n+Nevertheless, different than PostgreSQL, [organization lengths](http://docs.ckan.org/en/latest/api/#ckan.logic.action.create.organization_create) may be up to 100 characters (minimum, 2 characters).\n \n-Since based in [PostgreSQL only accepts](https://www.postgresql.org/docs/current/static/sql-syntax-lexical.html#SQL-SYNTAX-IDENTIFIERS), it must be said only alphanumeric characters and the underscore (`_`) are accepted. The hyphen ('-') is also accepted. This leads to certain [encoding](#section2.3.3) is applied depending on the `enable_encoding` configuration parameter.\n \n-Nevertheless, different than PostgreSQL, [organization lengths](http://docs.ckan.org/en/latest/api/#ckan.logic.action.create.organization_create) may be up to 100 characters (minimum, 2 characters).\n+* Data model by entity id (`data_model=dm-by-entity-id`). The organization name will take the value of the notified header `fiware-service` without encoding.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ed14fea42ed73cb07423237d67dea78af326afe"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE2NzU3NjM0", "url": "https://github.com/telefonicaid/fiware-cygnus/pull/1850#pullrequestreview-416757634", "createdAt": "2020-05-22T09:01:07Z", "commit": {"oid": "1ed14fea42ed73cb07423237d67dea78af326afe"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQwOTowMTowN1rOGZP8Tg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQwOTowMTowN1rOGZP8Tg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTEyODc4Mg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            * Data model by entity id (`data_model=dm-by-entity-id`). A package/dataset name always take the entity ID. Such a name is already given in the NGSIEvent values, see the [Configuration](#section2.1) section for more details) within the the `NGSIEvent`.\n          \n          \n            \n            * Data model by entity id (`data_model=dm-by-entity-id`). A package/dataset name always take the entity ID. Such a name is already given in the NGSIEvent values, see the [Configuration](#section2.1) section for more details) within the the `NGSIEvent`. Note that in this case, encoding is never applied (this is current marked as \"debt\" in the source code with a FIXME mark).", "url": "https://github.com/telefonicaid/fiware-cygnus/pull/1850#discussion_r429128782", "createdAt": "2020-05-22T09:01:07Z", "author": {"login": "fgalan"}, "path": "doc/cygnus-ngsi/flume_extensions_catalogue/ngsi_ckan_sink.md", "diffHunk": "@@ -50,32 +50,58 @@ This is done at the cygnus-ngsi Http listeners (in Flume jergon, sources) thanks\n [Top](#top)\n \n #### <a name=\"section1.2.1\"></a>Organizations naming conventions\n-An organization named as the notified `fiware-service` header value (or, in absence of such a header, the defaulted value for the FIWARE service) is created (if not existing yet).\n+* Data model by entity (`data_model=dm-by-entity`). An organization named as the notified `fiware-service` header value (or, in absence of such a header, the defaulted value for the FIWARE service) is created (if not existing yet).\n+Since based in [PostgreSQL only accepts] \n+https://www.postgresql.org/docs/current/static/sql-syntax-lexical.html#SQL-SYNTAX-IDENTIFIERS), it must be said only alphanumeric characters and the underscore (`_`) are accepted. The hyphen ('-') is also accepted. This leads to certain [encoding](#section2.3.3) is applied depending on the `enable_encoding` configuration parameter.\n+Nevertheless, different than PostgreSQL, [organization lengths](http://docs.ckan.org/en/latest/api/#ckan.logic.action.create.organization_create) may be up to 100 characters (minimum, 2 characters).\n \n-Since based in [PostgreSQL only accepts](https://www.postgresql.org/docs/current/static/sql-syntax-lexical.html#SQL-SYNTAX-IDENTIFIERS), it must be said only alphanumeric characters and the underscore (`_`) are accepted. The hyphen ('-') is also accepted. This leads to certain [encoding](#section2.3.3) is applied depending on the `enable_encoding` configuration parameter.\n \n-Nevertheless, different than PostgreSQL, [organization lengths](http://docs.ckan.org/en/latest/api/#ckan.logic.action.create.organization_create) may be up to 100 characters (minimum, 2 characters).\n+* Data model by entity id (`data_model=dm-by-entity-id`). The organization name will take the value of the notified header `fiware-service` without encoding.\n+\n+The following table summarizes the organization name composition:\n+\n+| `dm-by-entity` | `dm-by-entity-id` |\n+|---|---|\n+| `<fiware-service>` | `<fiware-service>` | \n \n [Top](#top)\n \n #### <a name=\"section1.2.2\"></a>Packages/datasets naming conventions\n-A package/dataset named as the concatenation of the notified `fiware-service` and `fiware-servicePath` header values (or, in absence of such headers, the defaulted value for the FIWARE service and service path) is created (if not existing yet) in the above organization.\n+* Data model by entity (`data_model=dm-by-entity`). A package/dataset named as the concatenation of the notified `fiware-service` and `fiware-servicePath` header values (or, in absence of such headers, the defaulted value for the FIWARE service and service path) is created (if not existing yet) in the above organization.\n+Since based in [PostgreSQL only accepts](https://www.postgresql.org/docs/current/static/sql-syntax-lexical.html#SQL-SYNTAX-IDENTIFIERS), it must be said only alphanumeric characters and the underscore (`_`) are accepted. The hyphen ('-') is also accepted. This leads to  certain [encoding](#section2.3.3) is applied depending on the `enable_encoding` configuration parameter\n+Nevertheless, different than PostgreSQL, [dataset lengths](http://docs.ckan.org/en/latest/api/#ckan.logic.action.create.package_create) may be up to 100 characters (minimum, 2 characters).\n \n-Since based in [PostgreSQL only accepts](https://www.postgresql.org/docs/current/static/sql-syntax-lexical.html#SQL-SYNTAX-IDENTIFIERS), it must be said only alphanumeric characters and the underscore (`_`) are accepted. The hyphen ('-') is also accepted. This leads to  certain [encoding](#section2.3.3) is applied depending on the `enable_encoding` configuration parameter.\n \n-Nevertheless, different than PostgreSQL, [dataset lengths](http://docs.ckan.org/en/latest/api/#ckan.logic.action.create.package_create) may be up to 100 characters (minimum, 2 characters).\n+* Data model by entity id (`data_model=dm-by-entity-id`). A package/dataset name always take the entity ID. Such a name is already given in the NGSIEvent values, see the [Configuration](#section2.1) section for more details) within the the `NGSIEvent`.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ed14fea42ed73cb07423237d67dea78af326afe"}, "originalPosition": 32}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE2NzU3Nzg4", "url": "https://github.com/telefonicaid/fiware-cygnus/pull/1850#pullrequestreview-416757788", "createdAt": "2020-05-22T09:01:23Z", "commit": {"oid": "1ed14fea42ed73cb07423237d67dea78af326afe"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQwOTowMToyM1rOGZP81Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQwOTowMToyM1rOGZP81Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTEyODkxNw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            * Data model by entity id (`data_model=dm-by-entity-id`). A resource name always take the entity ID. Such a name is already given in the NGSIEvent values, see the [Configuration](#section2.1) section for more details) within the the `NGSIEvent`. \n          \n          \n            \n            * Data model by entity id (`data_model=dm-by-entity-id`). A resource name always take the entity ID. Such a name is already given in the NGSIEvent values, see the [Configuration](#section2.1) section for more details) within the the `NGSIEvent`. Note that in this case, encoding is never applied (this is current marked as \"debt\" in the source code with a FIXME mark).", "url": "https://github.com/telefonicaid/fiware-cygnus/pull/1850#discussion_r429128917", "createdAt": "2020-05-22T09:01:23Z", "author": {"login": "fgalan"}, "path": "doc/cygnus-ngsi/flume_extensions_catalogue/ngsi_ckan_sink.md", "diffHunk": "@@ -50,32 +50,58 @@ This is done at the cygnus-ngsi Http listeners (in Flume jergon, sources) thanks\n [Top](#top)\n \n #### <a name=\"section1.2.1\"></a>Organizations naming conventions\n-An organization named as the notified `fiware-service` header value (or, in absence of such a header, the defaulted value for the FIWARE service) is created (if not existing yet).\n+* Data model by entity (`data_model=dm-by-entity`). An organization named as the notified `fiware-service` header value (or, in absence of such a header, the defaulted value for the FIWARE service) is created (if not existing yet).\n+Since based in [PostgreSQL only accepts] \n+https://www.postgresql.org/docs/current/static/sql-syntax-lexical.html#SQL-SYNTAX-IDENTIFIERS), it must be said only alphanumeric characters and the underscore (`_`) are accepted. The hyphen ('-') is also accepted. This leads to certain [encoding](#section2.3.3) is applied depending on the `enable_encoding` configuration parameter.\n+Nevertheless, different than PostgreSQL, [organization lengths](http://docs.ckan.org/en/latest/api/#ckan.logic.action.create.organization_create) may be up to 100 characters (minimum, 2 characters).\n \n-Since based in [PostgreSQL only accepts](https://www.postgresql.org/docs/current/static/sql-syntax-lexical.html#SQL-SYNTAX-IDENTIFIERS), it must be said only alphanumeric characters and the underscore (`_`) are accepted. The hyphen ('-') is also accepted. This leads to certain [encoding](#section2.3.3) is applied depending on the `enable_encoding` configuration parameter.\n \n-Nevertheless, different than PostgreSQL, [organization lengths](http://docs.ckan.org/en/latest/api/#ckan.logic.action.create.organization_create) may be up to 100 characters (minimum, 2 characters).\n+* Data model by entity id (`data_model=dm-by-entity-id`). The organization name will take the value of the notified header `fiware-service` without encoding.\n+\n+The following table summarizes the organization name composition:\n+\n+| `dm-by-entity` | `dm-by-entity-id` |\n+|---|---|\n+| `<fiware-service>` | `<fiware-service>` | \n \n [Top](#top)\n \n #### <a name=\"section1.2.2\"></a>Packages/datasets naming conventions\n-A package/dataset named as the concatenation of the notified `fiware-service` and `fiware-servicePath` header values (or, in absence of such headers, the defaulted value for the FIWARE service and service path) is created (if not existing yet) in the above organization.\n+* Data model by entity (`data_model=dm-by-entity`). A package/dataset named as the concatenation of the notified `fiware-service` and `fiware-servicePath` header values (or, in absence of such headers, the defaulted value for the FIWARE service and service path) is created (if not existing yet) in the above organization.\n+Since based in [PostgreSQL only accepts](https://www.postgresql.org/docs/current/static/sql-syntax-lexical.html#SQL-SYNTAX-IDENTIFIERS), it must be said only alphanumeric characters and the underscore (`_`) are accepted. The hyphen ('-') is also accepted. This leads to  certain [encoding](#section2.3.3) is applied depending on the `enable_encoding` configuration parameter\n+Nevertheless, different than PostgreSQL, [dataset lengths](http://docs.ckan.org/en/latest/api/#ckan.logic.action.create.package_create) may be up to 100 characters (minimum, 2 characters).\n \n-Since based in [PostgreSQL only accepts](https://www.postgresql.org/docs/current/static/sql-syntax-lexical.html#SQL-SYNTAX-IDENTIFIERS), it must be said only alphanumeric characters and the underscore (`_`) are accepted. The hyphen ('-') is also accepted. This leads to  certain [encoding](#section2.3.3) is applied depending on the `enable_encoding` configuration parameter.\n \n-Nevertheless, different than PostgreSQL, [dataset lengths](http://docs.ckan.org/en/latest/api/#ckan.logic.action.create.package_create) may be up to 100 characters (minimum, 2 characters).\n+* Data model by entity id (`data_model=dm-by-entity-id`). A package/dataset name always take the entity ID. Such a name is already given in the NGSIEvent values, see the [Configuration](#section2.1) section for more details) within the the `NGSIEvent`.\n+\n+The following table summarizes the package name composition:\n+\n+| `dm-by-entity` | `dm-by-entity-id` |\n+|---|---|\n+| `<fiware-service>_<fiware-servicePath>` | `<entityId>` | \n \n [Top](#top)\n \n #### <a name=\"section1.2.3\"></a>Resources naming conventions\n-CKAN resources follow a single data model (see the [Configuration](#section2.1) section for more details), i.e. per entity. Thus, a resource name always take the concatenation of the entity ID and type. Such a name is already given in the `notified_entities`/`grouped_entities` header values (depending on using or not the grouping rules, see the [Configuration](#section2.1) section for more details) within the `NGSIEvent`.\n+The resource name depends on the configured data model (see the [Configuration](#section2.1) section for more details):\n+\n+* Data model by entity (`data_model=dm-by-entity`). A resource name always take the concatenation of the entity ID and type. Such a name is already given in the `notified_entities`/`grouped_entities` header values (depending on using or not the grouping rules, see the [Configuration](#section2.1) section for more details) within the `NGSIEvent`.\n+\n+\n+* Data model by entity id (`data_model=dm-by-entity-id`). A resource name always take the entity ID. Such a name is already given in the NGSIEvent values, see the [Configuration](#section2.1) section for more details) within the the `NGSIEvent`. ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ed14fea42ed73cb07423237d67dea78af326afe"}, "originalPosition": 49}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a0373a8a5c2a17ab17f1703e953bb9b9598ddbed", "author": {"user": {"login": "IvanHdzC", "name": "Ivan Hernandez"}}, "url": "https://github.com/telefonicaid/fiware-cygnus/commit/a0373a8a5c2a17ab17f1703e953bb9b9598ddbed", "committedDate": "2020-05-22T09:04:54Z", "message": "Update doc/cygnus-ngsi/flume_extensions_catalogue/ngsi_ckan_sink.md\n\nCo-authored-by: Ferm\u00edn Gal\u00e1n M\u00e1rquez <fgalan@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4a57860810552aee2b19859af7f21d61baa8f3ba", "author": {"user": {"login": "IvanHdzC", "name": "Ivan Hernandez"}}, "url": "https://github.com/telefonicaid/fiware-cygnus/commit/4a57860810552aee2b19859af7f21d61baa8f3ba", "committedDate": "2020-05-22T09:05:03Z", "message": "Update doc/cygnus-ngsi/flume_extensions_catalogue/ngsi_ckan_sink.md\n\nCo-authored-by: Ferm\u00edn Gal\u00e1n M\u00e1rquez <fgalan@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "176c8767ac28365ce902adf995661353e21ac7f7", "author": {"user": {"login": "IvanHdzC", "name": "Ivan Hernandez"}}, "url": "https://github.com/telefonicaid/fiware-cygnus/commit/176c8767ac28365ce902adf995661353e21ac7f7", "committedDate": "2020-05-22T09:05:13Z", "message": "Update doc/cygnus-ngsi/flume_extensions_catalogue/ngsi_ckan_sink.md\n\nCo-authored-by: Ferm\u00edn Gal\u00e1n M\u00e1rquez <fgalan@users.noreply.github.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE2ODI4ODcw", "url": "https://github.com/telefonicaid/fiware-cygnus/pull/1850#pullrequestreview-416828870", "createdAt": "2020-05-22T11:06:37Z", "commit": {"oid": "176c8767ac28365ce902adf995661353e21ac7f7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3822, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}