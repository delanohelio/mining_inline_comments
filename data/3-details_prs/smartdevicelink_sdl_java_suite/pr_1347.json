{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE3NDE4MzM0", "number": 1347, "title": "Bugfix/issue_1343 foreground permissions exception", "bodyText": "Fixes #1343\nThis PR is [ready] for review.\nRisk\nThis PR makes [no] API changes.\nTesting Plan\n\n I have verified that I have not introduced new warnings in this PR (or explain why below)\n I have run the unit tests with this PR\n I have tested this PR against Core and verified behavior (if applicable, if not applicable, explain why below).\n I have tested Android, Java SE, and Java EE\n\nTest Steps\n\nComment out FOREGROUND_SERVICE permissions\nTry to run the app connecting to TDK through Bluetooth\nEnsure app is able to run without crashing\n\nSummary\nThis PR will ensure that permissions are checked before calling startForeground and catch exceptions thrown by startForeground\nCLA\n\n I have signed the CLA", "createdAt": "2020-05-13T14:53:38Z", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1347", "merged": true, "mergeCommit": {"oid": "39446ccbf5df7fffaa7d6b13f723d31e80a14f36"}, "closed": true, "closedAt": "2020-05-19T18:22:25Z", "author": {"login": "RHenigan"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcg58RkgH2gAyNDE3NDE4MzM0OmVmYTk0MTZkZjMxM2QzNzI1NDZiMDQ0MDgxNWQ5OTgzMTcxYjMzZDI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABci4rqegFqTQxNDcxMDEyMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "efa9416df313d372546b0440815d9983171b33d2", "author": {"user": {"login": "RHenigan", "name": "Robert Henigan"}}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/efa9416df313d372546b0440815d9983171b33d2", "committedDate": "2020-05-13T14:42:05Z", "message": "Check permissions before trying to startForeground"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3584f04e8d85ebacb9c7012ea22abf642c828d46", "author": {"user": {"login": "RHenigan", "name": "Robert Henigan"}}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/3584f04e8d85ebacb9c7012ea22abf642c828d46", "committedDate": "2020-05-13T15:00:51Z", "message": "Remove output.json file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b60db1cbfa0a8eb6e7e27927bd55bf610e4a546", "author": {"user": {"login": "RHenigan", "name": "Robert Henigan"}}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/5b60db1cbfa0a8eb6e7e27927bd55bf610e4a546", "committedDate": "2020-05-13T19:35:37Z", "message": "Establish safeStartForeground in AndroidTools"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "919bf5923aa1550148620803e2006d357a3710de", "author": {"user": {"login": "RHenigan", "name": "Robert Henigan"}}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/919bf5923aa1550148620803e2006d357a3710de", "committedDate": "2020-05-13T19:51:03Z", "message": "Implement AndroidTools.safeStartForegroundService"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2607bdd8e6aae1043512429572ae61461232c7e1", "author": {"user": {"login": "RHenigan", "name": "Robert Henigan"}}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/2607bdd8e6aae1043512429572ae61461232c7e1", "committedDate": "2020-05-14T17:11:21Z", "message": "Bring safestart back to SdlRouterService"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzNzkyMTQz", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1347#pullrequestreview-413792143", "createdAt": "2020-05-18T17:19:57Z", "commit": {"oid": "2607bdd8e6aae1043512429572ae61461232c7e1"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxNzoxOTo1N1rOGXAmxQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxODo1MzowMVrOGXDlQw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc4MDM1Nw==", "bodyText": "unused import", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1347#discussion_r426780357", "createdAt": "2020-05-18T17:19:57Z", "author": {"login": "bilal-alsharifi"}, "path": "android/hello_sdl_android/src/main/java/com/sdl/hellosdlandroid/SdlReceiver.java", "diffHunk": "@@ -1,12 +1,15 @@\n package com.sdl.hellosdlandroid;\n \n+import android.Manifest;\n import android.content.Context;\n import android.content.Intent;\n import android.os.Build;\n import android.util.Log;\n \n import com.smartdevicelink.transport.SdlBroadcastReceiver;\n import com.smartdevicelink.transport.SdlRouterService;\n+import com.smartdevicelink.util.AndroidTools;\n+import com.smartdevicelink.util.DebugTool;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2607bdd8e6aae1043512429572ae61461232c7e1"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc4NTY4OA==", "bodyText": "Can we remove that change if it only changes the location of the method in the same file? to make it easier to track the actual changes.", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1347#discussion_r426785688", "createdAt": "2020-05-18T17:29:34Z", "author": {"login": "bilal-alsharifi"}, "path": "android/sdl_android/src/main/java/com/smartdevicelink/transport/SdlRouterService.java", "diffHunk": "@@ -1484,37 +1484,14 @@ private void enterForeground(String content, long chronometerLength, boolean ong\n \t\t\t\t}\n \t\t\t\treturn;\n \t\t\t}\n-\t\t\tsafeStartForeground(FOREGROUND_SERVICE_ID, notification);\n+\n+\t\t\tsafeStartForeground(FOREGROUND_SERVICE_ID, builder.build());\n \t\t\tisForeground = true;\n \n \t\t}\n  \n     }\n \n-\t/**", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2607bdd8e6aae1043512429572ae61461232c7e1"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc4ODI1Mg==", "bodyText": "Is there a reason for changing the param from notification to builder.build()? as the notification will already be built at this point.", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1347#discussion_r426788252", "createdAt": "2020-05-18T17:34:19Z", "author": {"login": "bilal-alsharifi"}, "path": "android/sdl_android/src/main/java/com/smartdevicelink/transport/SdlRouterService.java", "diffHunk": "@@ -1484,37 +1484,14 @@ private void enterForeground(String content, long chronometerLength, boolean ong\n \t\t\t\t}\n \t\t\t\treturn;\n \t\t\t}\n-\t\t\tsafeStartForeground(FOREGROUND_SERVICE_ID, notification);\n+\n+\t\t\tsafeStartForeground(FOREGROUND_SERVICE_ID, builder.build());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2607bdd8e6aae1043512429572ae61461232c7e1"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc5MzEwNg==", "bodyText": "unused import", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1347#discussion_r426793106", "createdAt": "2020-05-18T17:43:39Z", "author": {"login": "bilal-alsharifi"}, "path": "android/hello_sdl_android/src/main/java/com/sdl/hellosdlandroid/SdlService.java", "diffHunk": "@@ -6,6 +6,7 @@\n import android.app.NotificationManager;\n import android.app.Service;\n import android.content.Context;\n+import android.content.ContextWrapper;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2607bdd8e6aae1043512429572ae61461232c7e1"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjc5NDU0OQ==", "bodyText": "unused import", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1347#discussion_r426794549", "createdAt": "2020-05-18T17:46:14Z", "author": {"login": "bilal-alsharifi"}, "path": "android/sdl_android/src/main/java/com/smartdevicelink/util/AndroidTools.java", "diffHunk": "@@ -44,6 +47,8 @@\n import android.graphics.Bitmap;\n import android.graphics.BitmapFactory;\n import android.os.BatteryManager;\n+import android.os.Build;\n+import android.support.v4.app.NotificationCompat;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2607bdd8e6aae1043512429572ae61461232c7e1"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjgwNDY1MQ==", "bodyText": "unused import", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1347#discussion_r426804651", "createdAt": "2020-05-18T18:04:56Z", "author": {"login": "bilal-alsharifi"}, "path": "android/sdl_android/src/main/java/com/smartdevicelink/util/AndroidTools.java", "diffHunk": "@@ -57,7 +62,12 @@\n import java.util.HashMap;\n import java.util.List;\n \n+import static com.smartdevicelink.transport.TransportConstants.SDL_NOTIFICATION_CHANNEL_ID;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2607bdd8e6aae1043512429572ae61461232c7e1"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjgwNDc0Ng==", "bodyText": "unused variable", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1347#discussion_r426804746", "createdAt": "2020-05-18T18:05:06Z", "author": {"login": "bilal-alsharifi"}, "path": "android/sdl_android/src/main/java/com/smartdevicelink/util/AndroidTools.java", "diffHunk": "@@ -57,7 +62,12 @@\n import java.util.HashMap;\n import java.util.List;\n \n+import static com.smartdevicelink.transport.TransportConstants.SDL_NOTIFICATION_CHANNEL_ID;\n+\n public class AndroidTools {\n+\n+\tpublic static final String SDL_NOTIFICATION_CHANNEL_ID \t\t\t\t\t\t= \"sdl_notification_channel\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2607bdd8e6aae1043512429572ae61461232c7e1"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjgxNzk0Ng==", "bodyText": "We should reuse the static function\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\tint permission = context.checkPermission(Manifest.permission.FOREGROUND_SERVICE, android.os.Process.myPid(), android.os.Process.myUid());\n          \n          \n            \n            \t\t\tif (permission != -1) {\n          \n          \n            \n            \t\t\t\tAndroidTools.safeStartForegroundService(context, bindingIntent);\n          \n          \n            \n            \t\t\t} else {\n          \n          \n            \n            \t\t\t\tDebugTool.logError(\"Foreground Permissions Not Enabled: will not start foreground permissions\");\n          \n          \n            \n            \t\t\t}\n          \n          \n            \n            \t\t\tAndroidTools.safeStartForegroundService(context, bindingIntent);", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1347#discussion_r426817946", "createdAt": "2020-05-18T18:30:53Z", "author": {"login": "bilal-alsharifi"}, "path": "android/sdl_android/src/main/java/com/smartdevicelink/transport/SdlRouterStatusProvider.java", "diffHunk": "@@ -134,8 +136,12 @@ private boolean bindToService(){\n \t\t}else {\n \t\t\tbindingIntent.putExtra(FOREGROUND_EXTRA, true);\n \t\t\tSdlBroadcastReceiver.setForegroundExceptionHandler(); //Prevent ANR in case the OS takes too long to start the service\n-\t\t\tcontext.startForegroundService(bindingIntent);\n-\n+\t\t\tint permission = context.checkPermission(Manifest.permission.FOREGROUND_SERVICE, android.os.Process.myPid(), android.os.Process.myUid());\n+\t\t\tif (permission != -1) {\n+\t\t\t\tAndroidTools.safeStartForegroundService(context, bindingIntent);\n+\t\t\t} else {\n+\t\t\t\tDebugTool.logError(\"Foreground Permissions Not Enabled: will not start foreground permissions\");\n+\t\t\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2607bdd8e6aae1043512429572ae61461232c7e1"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjgxOTEyNQ==", "bodyText": "This function is not needed and should be removed as it already exists in the RS class. Adding new public APIs should always be avoided when possible.", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1347#discussion_r426819125", "createdAt": "2020-05-18T18:33:16Z", "author": {"login": "bilal-alsharifi"}, "path": "android/sdl_android/src/main/java/com/smartdevicelink/util/AndroidTools.java", "diffHunk": "@@ -191,4 +201,60 @@ public static Bitmap downloadImage(String urlStr) throws IOException {\n \t\tbis.close();\n \t\treturn result;\n \t}\n+\n+\t/**\n+\t * This is a wrapper around the startForeground method. In the case that the notification\n+\t * is null, or a notification was unable to be created we will still attempt to call the\n+\t * startForeground method in hopes that Android will not throw the System Exception. In the\n+\t * event that the user is on Android 28+ it will check the FOREGROUND_SERVICE permissions\n+\t * before trying to call startForeground.\n+\t * @param service a service instance\n+\t * @param context a context instance\n+\t * @param id notification channel id\n+\t * @param notification the notification to display when in the foreground\n+\t */\n+\tpublic static void safeStartForeground(Service service, Context context, int id, Notification notification){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2607bdd8e6aae1043512429572ae61461232c7e1"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjgyMDQyMQ==", "bodyText": "This change should be reverted back as the flow will not reach this phase if the permission is not added && the Android version is P or above. Also, the AndroidTools import should be removed.", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1347#discussion_r426820421", "createdAt": "2020-05-18T18:35:57Z", "author": {"login": "bilal-alsharifi"}, "path": "android/hello_sdl_android/src/main/java/com/sdl/hellosdlandroid/SdlService.java", "diffHunk": "@@ -105,7 +107,11 @@ public void enterForeground() {\n \t\t\t\t\t\t.setContentTitle(\"Connected through SDL\")\n \t\t\t\t\t\t.setSmallIcon(R.drawable.ic_sdl)\n \t\t\t\t\t\t.build();\n-\t\t\t\tstartForeground(FOREGROUND_SERVICE_ID, serviceNotification);\n+\t\t\t\ttry {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2607bdd8e6aae1043512429572ae61461232c7e1"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjgyOTEyMw==", "bodyText": "This needs some modifications:\n\nIt should check the permission when Android >= P (currently it checks if Android < P)\nIt should still throw the exception in debug mode to let developers know that they are missing the permission\nAdd RequiresApi annotation as the method should only be used for Android O and above\n\n@RequiresApi(api = Build.VERSION_CODES.O)\npublic static ComponentName safeStartForegroundService(Context context, Intent intent) {\n    if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.P) {\n        boolean inDebugMode = (0 != (context.getApplicationInfo().flags & ApplicationInfo.FLAG_DEBUGGABLE));\n        boolean permissionGranted = PackageManager.PERMISSION_GRANTED == context.checkPermission(Manifest.permission.FOREGROUND_SERVICE, android.os.Process.myPid(), android.os.Process.myUid());\n        if (inDebugMode || permissionGranted) {\n            return context.startForegroundService(intent);\n        } else {\n            DebugTool.logError(\"App missing FOREGROUND_SERVICE Permissions\");\n        }\n    } else if (Build.VERSION.SDK_INT == Build.VERSION_CODES.O) {\n        return context.startForegroundService(intent);\n    } else if (Build.VERSION.SDK_INT < Build.VERSION_CODES.O) {\n        DebugTool.logError(\"startForegroundService() call requires Android Oreo or newer\");\n    }\n    return null;\n}", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1347#discussion_r426829123", "createdAt": "2020-05-18T18:53:01Z", "author": {"login": "bilal-alsharifi"}, "path": "android/sdl_android/src/main/java/com/smartdevicelink/util/AndroidTools.java", "diffHunk": "@@ -191,4 +201,60 @@ public static Bitmap downloadImage(String urlStr) throws IOException {\n \t\tbis.close();\n \t\treturn result;\n \t}\n+\n+\t/**\n+\t * This is a wrapper around the startForeground method. In the case that the notification\n+\t * is null, or a notification was unable to be created we will still attempt to call the\n+\t * startForeground method in hopes that Android will not throw the System Exception. In the\n+\t * event that the user is on Android 28+ it will check the FOREGROUND_SERVICE permissions\n+\t * before trying to call startForeground.\n+\t * @param service a service instance\n+\t * @param context a context instance\n+\t * @param id notification channel id\n+\t * @param notification the notification to display when in the foreground\n+\t */\n+\tpublic static void safeStartForeground(Service service, Context context, int id, Notification notification){\n+\t\tint permission = PackageManager.PERMISSION_GRANTED;\n+\t\tif (Build.VERSION.SDK_INT < Build.VERSION_CODES.P) {\n+\t\t\tpermission = context.checkPermission(Manifest.permission.FOREGROUND_SERVICE, android.os.Process.myPid(), android.os.Process.myUid());\n+\t\t}\n+\t\ttry{\n+\t\t\tif (permission != PackageManager.PERMISSION_DENIED) {\n+\t\t\t\tservice.startForeground(id, notification);\n+\t\t\t\tDebugTool.logInfo(\"Entered the foreground - \" + System.currentTimeMillis());\n+\t\t\t} else {\n+\t\t\t\tDebugTool.logError(\"App missing FOREGROUND_SERVICE Permissions\");\n+\t\t\t}\n+\t\t}catch (Exception e){\n+\t\t\tDebugTool.logError(\"Unable to start service in foreground\", e);\n+\t\t}\n+\t}\n+\n+\t/**\n+\t * This is a wrapper around the startForegroundService method. In the\n+\t * event that the user is on Android 28+ it will check the FOREGROUND_SERVICE permissions\n+\t * before trying to call startForegroundService.\n+\t * @param context a context instance\n+\t * @param intent the foreground service intent\n+\t * @return a ComponentName, an identifier for the started service, will return null is service\n+\t * was unable to start\n+\t */\n+\tpublic static ComponentName safeStartForegroundService(Context context, Intent intent){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2607bdd8e6aae1043512429572ae61461232c7e1"}, "originalPosition": 74}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "527a7c86c4b0227dce18b0018f89d3e9049e9d90", "author": {"user": {"login": "RHenigan", "name": "Robert Henigan"}}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/527a7c86c4b0227dce18b0018f89d3e9049e9d90", "committedDate": "2020-05-18T21:15:13Z", "message": "Feedback fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d8d3bfc7559e123048e532bbe937fcd0518a22e2", "author": {"user": {"login": "RHenigan", "name": "Robert Henigan"}}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/d8d3bfc7559e123048e532bbe937fcd0518a22e2", "committedDate": "2020-05-19T14:10:39Z", "message": "safeStartforeground does not need permission check"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0Njg2MDkz", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1347#pullrequestreview-414686093", "createdAt": "2020-05-19T17:50:30Z", "commit": {"oid": "d8d3bfc7559e123048e532bbe937fcd0518a22e2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxNzo1MDozMFrOGXr4BA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxNzo1MDozMFrOGXr4BA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzQ4OTI4NA==", "bodyText": "I have just learned that there are two versions of Android O (VERSION_CODES.O= 26 & VERSION_CODES.O_MR1 = 27) and they both don't require the foreground permission. So I updated the code accordingly\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t} else if (Build.VERSION.SDK_INT == Build.VERSION_CODES.O) {\n          \n          \n            \n            \t\t\treturn context.startForegroundService(intent);\n          \n          \n            \n            \t\t} else if (Build.VERSION.SDK_INT < Build.VERSION_CODES.O) {\n          \n          \n            \n            \t\t\tDebugTool.logError(\"startForegroundService() call requires Android Oreo or newer\");\n          \n          \n            \n            \t\t}\n          \n          \n            \n            \t\t} else if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.O) {\n          \n          \n            \n            \t\t\treturn context.startForegroundService(intent);\n          \n          \n            \n            \t\t}", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1347#discussion_r427489284", "createdAt": "2020-05-19T17:50:30Z", "author": {"login": "bilal-alsharifi"}, "path": "android/sdl_android/src/main/java/com/smartdevicelink/util/AndroidTools.java", "diffHunk": "@@ -191,4 +196,31 @@ public static Bitmap downloadImage(String urlStr) throws IOException {\n \t\tbis.close();\n \t\treturn result;\n \t}\n+\n+\t/**\n+\t * This is a wrapper around the startForegroundService method. In the\n+\t * event that the user is on Android 28+ it will check the FOREGROUND_SERVICE permissions\n+\t * before trying to call startForegroundService.\n+\t * @param context a context instance\n+\t * @param intent the foreground service intent\n+\t * @return a ComponentName, an identifier for the started service, will return null is service\n+\t * was unable to start\n+\t */\n+\t@RequiresApi(api = Build.VERSION_CODES.O)\n+\tpublic static ComponentName safeStartForegroundService(Context context, Intent intent) {\n+\t\tif (Build.VERSION.SDK_INT >= Build.VERSION_CODES.P) {\n+\t\t\tboolean inDebugMode = (0 != (context.getApplicationInfo().flags & ApplicationInfo.FLAG_DEBUGGABLE));\n+\t\t\tboolean permissionGranted = PackageManager.PERMISSION_GRANTED == context.checkPermission(Manifest.permission.FOREGROUND_SERVICE, android.os.Process.myPid(), android.os.Process.myUid());\n+\t\t\tif (inDebugMode || permissionGranted) {\n+\t\t\t\treturn context.startForegroundService(intent);\n+\t\t\t} else {\n+\t\t\t\tDebugTool.logError(\"App missing FOREGROUND_SERVICE Permissions\");\n+\t\t\t}\n+\t\t} else if (Build.VERSION.SDK_INT == Build.VERSION_CODES.O) {\n+\t\t\treturn context.startForegroundService(intent);\n+\t\t} else if (Build.VERSION.SDK_INT < Build.VERSION_CODES.O) {\n+\t\t\tDebugTool.logError(\"startForegroundService() call requires Android Oreo or newer\");\n+\t\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d8d3bfc7559e123048e532bbe937fcd0518a22e2"}, "originalPosition": 58}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a88586083a9fdc41038ec0c0b86202331621e43f", "author": {"user": {"login": "RHenigan", "name": "Robert Henigan"}}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/a88586083a9fdc41038ec0c0b86202331621e43f", "committedDate": "2020-05-19T17:58:48Z", "message": "Update android/sdl_android/src/main/java/com/smartdevicelink/util/AndroidTools.java\n\nCo-authored-by: Bilal Alsharifi <599206+bilal-alsharifi@users.noreply.github.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0Njk5MTE5", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1347#pullrequestreview-414699119", "createdAt": "2020-05-19T18:07:10Z", "commit": {"oid": "a88586083a9fdc41038ec0c0b86202331621e43f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxODowNzoxMVrOGXsg6w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxODowNzoxMVrOGXsg6w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzQ5OTc1NQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\t\tDebugTool.logError(\"App missing FOREGROUND_SERVICE Permissions\");\n          \n          \n            \n            \t\t\t\tDebugTool.logError(\"App is missing FOREGROUND_SERVICE Permission. Sdl will not work.\");", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1347#discussion_r427499755", "createdAt": "2020-05-19T18:07:11Z", "author": {"login": "bilal-alsharifi"}, "path": "android/sdl_android/src/main/java/com/smartdevicelink/util/AndroidTools.java", "diffHunk": "@@ -191,4 +196,29 @@ public static Bitmap downloadImage(String urlStr) throws IOException {\n \t\tbis.close();\n \t\treturn result;\n \t}\n+\n+\t/**\n+\t * This is a wrapper around the startForegroundService method. In the\n+\t * event that the user is on Android 28+ it will check the FOREGROUND_SERVICE permissions\n+\t * before trying to call startForegroundService.\n+\t * @param context a context instance\n+\t * @param intent the foreground service intent\n+\t * @return a ComponentName, an identifier for the started service, will return null is service\n+\t * was unable to start\n+\t */\n+\t@RequiresApi(api = Build.VERSION_CODES.O)\n+\tpublic static ComponentName safeStartForegroundService(Context context, Intent intent) {\n+\t\tif (Build.VERSION.SDK_INT >= Build.VERSION_CODES.P) {\n+\t\t\tboolean inDebugMode = (0 != (context.getApplicationInfo().flags & ApplicationInfo.FLAG_DEBUGGABLE));\n+\t\t\tboolean permissionGranted = PackageManager.PERMISSION_GRANTED == context.checkPermission(Manifest.permission.FOREGROUND_SERVICE, android.os.Process.myPid(), android.os.Process.myUid());\n+\t\t\tif (inDebugMode || permissionGranted) {\n+\t\t\t\treturn context.startForegroundService(intent);\n+\t\t\t} else {\n+\t\t\t\tDebugTool.logError(\"App missing FOREGROUND_SERVICE Permissions\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a88586083a9fdc41038ec0c0b86202331621e43f"}, "originalPosition": 52}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6274f16950bcc52e234083d70ac00c804c4366ae", "author": {"user": {"login": "RHenigan", "name": "Robert Henigan"}}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/6274f16950bcc52e234083d70ac00c804c4366ae", "committedDate": "2020-05-19T18:08:55Z", "message": "Update android/sdl_android/src/main/java/com/smartdevicelink/util/AndroidTools.java\n\nCo-authored-by: Bilal Alsharifi <599206+bilal-alsharifi@users.noreply.github.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0NzEwMTIy", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1347#pullrequestreview-414710122", "createdAt": "2020-05-19T18:21:53Z", "commit": {"oid": "6274f16950bcc52e234083d70ac00c804c4366ae"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2156, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}