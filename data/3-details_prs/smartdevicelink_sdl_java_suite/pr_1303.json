{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg0NDg2ODI3", "number": 1303, "title": "Add overwrite property", "bodyText": "Fixes #1302\nThis PR is ready for review.\nRisk\nThis PR makes minor API changes.\nTesting Plan\n\n I have verified that I have not introduced new warnings in this PR (or explain why below)\n I have run the unit tests with this PR\n I have tested this PR against Core and verified behavior (if applicable, if not applicable, explain why below).\n I have tested Android, Java SE, and Java EE\n\nUnit Tests\nAdded unit test to test file not overwriting itself in BaseFileManager.uploadfiles as well as BaseFileManager.uploadFiles\nCore Tests\nTested using manticore.\nSummary\nAdded overwrite property to SdlFile in Android and JavaSE, added logic to baseFileManager.java to handle the overwrite property when uploading files.\nOverwrite property is always set to true, in next major release to align with IOS we need to change it to false\nTo test I recommend after uploading one file to set the SdlFIle's overwrite property to false and upload it the second time in the completion listener's onComplete of the first upload to verify that the file has uploaded before it tries to upload it again. Ex:\n\t\tSdlFile livio = new SdlFile(\"livio\", FileType.GRAPHIC_PNG, R.drawable.sdl, false);\n\n\t\tsdlManager.getFileManager().uploadFile(livio, new CompletionListener() {\n\t\t\t@Override\n\t\t\tpublic void onComplete(boolean success) {\n\t\t\t\tSdlFile livio2 = new SdlFile(\"livio\", FileType.GRAPHIC_PNG, R.drawable.sdl, false);\n\t\t\t\tlivio2.setOverwrite(false);\n\t\t\t\tsdlManager.getFileManager().uploadFile(livio2, new CompletionListener() {\n\t\t\t\t\t@Override\n\t\t\t\t\tpublic void onComplete(boolean success) {\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\nEnhancements\n\nAdded overwrite property to SdlFile\n\nCLA\n\n I have signed the CLA", "createdAt": "2020-03-05T20:34:02Z", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1303", "merged": true, "mergeCommit": {"oid": "f8a9b3229795ad1abff756261a177cff3308dfb1"}, "closed": true, "closedAt": "2020-03-11T20:01:11Z", "author": {"login": "JulianKast"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcKdUt4AH2gAyMzg0NDg2ODI3OmU5ZmEyOTI1YzNlNGI2OWE1NDE5NjM3ZWEyM2I4NTk3ZDczZmYyNzY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcMsvaZgFqTM3MzA4NDc4Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e9fa2925c3e4b69a5419637ea23b8597d73ff276", "author": {"user": null}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/e9fa2925c3e4b69a5419637ea23b8597d73ff276", "committedDate": "2020-03-04T20:55:12Z", "message": "Added overwrite property to SdlFile"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d925025ac9ce71fc5d602ee2c8063044b1aafe57", "author": {"user": null}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/d925025ac9ce71fc5d602ee2c8063044b1aafe57", "committedDate": "2020-03-04T20:59:13Z", "message": "Added a call  in SdlArtwork default constructor to call Super empty constructor to set overwrite property"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0c97f663f71df092ebdd749bebdc5ca6aeab9799", "author": {"user": null}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/0c97f663f71df092ebdd749bebdc5ca6aeab9799", "committedDate": "2020-03-04T21:03:12Z", "message": "Added logic to check overwrite property for uploadFile in baseFileManager"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "032c400e5cc4d4ccbbbafc330b3b6d76f2a5789a", "author": {"user": null}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/032c400e5cc4d4ccbbbafc330b3b6d76f2a5789a", "committedDate": "2020-03-04T21:14:33Z", "message": "Fixed formatting in BaseFileManager uploadFile"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d8e4b5283d41ec38fb0cc87445ffa58a1f3c96bd", "author": {"user": null}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/d8e4b5283d41ec38fb0cc87445ffa58a1f3c96bd", "committedDate": "2020-03-04T21:25:05Z", "message": "Added overWrite property check in baseFileManager uploadFiles"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "823c495fb4a1c85ac533575a0f3bef0dc8e4e19e", "author": {"user": null}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/823c495fb4a1c85ac533575a0f3bef0dc8e4e19e", "committedDate": "2020-03-05T14:35:22Z", "message": "added overwrite property to SdlFile in javaSE"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "091fab86d9c7f7f4f3c9999d0b8e6b5ca511007f", "author": {"user": null}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/091fab86d9c7f7f4f3c9999d0b8e6b5ca511007f", "committedDate": "2020-03-05T15:25:07Z", "message": "Since overwrite is set to true by default, I removed it form constructors and added it to the top of the classes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8c27a093540f838348978bb4d9a42aed916594ed", "author": {"user": null}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/8c27a093540f838348978bb4d9a42aed916594ed", "committedDate": "2020-03-05T20:01:22Z", "message": "fixed spelling"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "448c66c152412f9dfd6c90b8fcbcf7b5528bb18b", "author": {"user": null}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/448c66c152412f9dfd6c90b8fcbcf7b5528bb18b", "committedDate": "2020-03-05T21:11:40Z", "message": "Added testOverwriteFileProperty() to FileManagerTest.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "738af48f45a92ac568a075a8ef44a4e31a68f11d", "author": {"user": null}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/738af48f45a92ac568a075a8ef44a4e31a68f11d", "committedDate": "2020-03-05T22:01:43Z", "message": "Added testOverWriteFilePropertyListFiles to FileManagerTest"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxOTM1MTc0", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1303#pullrequestreview-371935174", "createdAt": "2020-03-10T13:11:27Z", "commit": {"oid": "738af48f45a92ac568a075a8ef44a4e31a68f11d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQxMzoxMToyN1rOF0OE5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQxNTowMzozNlrOF0TCWw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDMwMDkwMw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public boolean isOverwrite() {\n          \n          \n            \n                public boolean getOverwrite() {", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1303#discussion_r390300903", "createdAt": "2020-03-10T13:11:27Z", "author": {"login": "bilal-alsharifi"}, "path": "javaSE/src/main/java/com/smartdevicelink/managers/file/filetypes/SdlFile.java", "diffHunk": "@@ -185,4 +187,20 @@ public void setStaticIcon(boolean staticIcon) {\n     public boolean isStaticIcon() {\n         return isStaticIcon;\n     }\n+\n+    /**\n+     * Gets the overwrite property for an SdlFile by default its set to true\n+     * @return a boolean value that indicates if a file can be overwritten.\n+     */\n+    public boolean isOverwrite() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "738af48f45a92ac568a075a8ef44a4e31a68f11d"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDMwMTA5Nw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public boolean isOverwrite() {\n          \n          \n            \n                public boolean getOverwrite() {", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1303#discussion_r390301097", "createdAt": "2020-03-10T13:11:44Z", "author": {"login": "bilal-alsharifi"}, "path": "android/sdl_android/src/main/java/com/smartdevicelink/managers/file/filetypes/SdlFile.java", "diffHunk": "@@ -219,4 +221,20 @@ public void setStaticIcon(boolean staticIcon) {\n     public boolean isStaticIcon() {\n         return isStaticIcon;\n     }\n+\n+    /**\n+     * Gets the overwrite property for an SdlFile by default its set to true\n+     * @return a boolean value that indicates if a file can be overwritten.\n+     */\n+    public boolean isOverwrite() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "738af48f45a92ac568a075a8ef44a4e31a68f11d"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDM3OTA1NA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\t\tLog.w(TAG, \"Files that have already uploaded and have an Overwrite property set to false will not be re-Upload\");\n          \n          \n            \n            \t\t\t\tLog.w(TAG, String.format(\"%s has already been uploaded and the overwrite property is set to false. It will not be uploaded again\", file.getName()));", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1303#discussion_r390379054", "createdAt": "2020-03-10T14:59:32Z", "author": {"login": "bilal-alsharifi"}, "path": "base/src/main/java/com/smartdevicelink/managers/file/BaseFileManager.java", "diffHunk": "@@ -392,13 +402,23 @@ public void uploadFiles(@NonNull List<? extends SdlFile> files, final MultipleFi\n \t\t}\n \t\tfinal List<PutFile> putFileRequests = new ArrayList<>();\n \t\tfor (SdlFile file : files) {\n-\t\t\tif (!file.isStaticIcon()) {\n-\t\t\t\tputFileRequests.add(createPutFile(file));\n+\t\t\tif (file.isStaticIcon()) {\n+\t\t\t\tLog.w(TAG, \"Static icons don't need to be uploaded\");\n+\t\t\t\tcontinue;\n \t\t\t}\n+\t\t\t// In sdl_ios: HAX: [#827](https://github.com/smartdevicelink/sdl_ios/issues/827) Older versions of Core had a bug where list files would cache incorrectly.\n+\t\t\t// This led to attempted uploads failing due to the system thinking they were already there when they were not.\n+\t\t\tif (!file.isPersistent() && !hasUploadedFile(file)) {\n+\t\t\t\tfile.setOverwrite(true);\n+\t\t\t}\n+\t\t\tif (!file.isOverwrite() && hasUploadedFile(file)) {\n+\t\t\t\tLog.w(TAG, \"Files that have already uploaded and have an Overwrite property set to false will not be re-Upload\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "738af48f45a92ac568a075a8ef44a4e31a68f11d"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDM3OTI3MQ==", "bodyText": "it is better to print the name to know which file exactly is not being uploaded.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\t\tLog.w(TAG, \"Static icons don't need to be uploaded\");\n          \n          \n            \n            \t\t\t\tLog.w(TAG, String.format(\"%s is a static icon and doesn't need to be uploaded\", file.getName()));", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1303#discussion_r390379271", "createdAt": "2020-03-10T14:59:52Z", "author": {"login": "bilal-alsharifi"}, "path": "base/src/main/java/com/smartdevicelink/managers/file/BaseFileManager.java", "diffHunk": "@@ -392,13 +402,23 @@ public void uploadFiles(@NonNull List<? extends SdlFile> files, final MultipleFi\n \t\t}\n \t\tfinal List<PutFile> putFileRequests = new ArrayList<>();\n \t\tfor (SdlFile file : files) {\n-\t\t\tif (!file.isStaticIcon()) {\n-\t\t\t\tputFileRequests.add(createPutFile(file));\n+\t\t\tif (file.isStaticIcon()) {\n+\t\t\t\tLog.w(TAG, \"Static icons don't need to be uploaded\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "738af48f45a92ac568a075a8ef44a4e31a68f11d"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDM4MDU5OQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\tLog.w(TAG, \"Files that have already uploaded and have an Overwrite property set to false will not be re-Upload\");\n          \n          \n            \n            \t\t\tLog.w(TAG, String.format(\"%s has already been uploaded and the overwrite property is set to false. It will not be uploaded again\", file.getName()));", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1303#discussion_r390380599", "createdAt": "2020-03-10T15:01:32Z", "author": {"login": "bilal-alsharifi"}, "path": "base/src/main/java/com/smartdevicelink/managers/file/BaseFileManager.java", "diffHunk": "@@ -329,6 +329,16 @@ public void uploadFile(@NonNull final SdlFile file, final CompletionListener lis\n \t\t\tlistener.onComplete(true);\n \t\t\treturn;\n \t\t}\n+\t\t// In sdl_ios: HAX: [#827](https://github.com/smartdevicelink/sdl_ios/issues/827) Older versions of Core had a bug where list files would cache incorrectly.\n+\t\t// This led to attempted uploads failing due to the system thinking they were already there when they were not.\n+\t\tif (!file.isPersistent() && !hasUploadedFile(file)) {\n+\t\t\tfile.setOverwrite(true);\n+\t\t}\n+\t\tif (!file.isOverwrite() && hasUploadedFile(file)) {\n+\t\t\tLog.w(TAG, \"Files that have already uploaded and have an Overwrite property set to false will not be re-Upload\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "738af48f45a92ac568a075a8ef44a4e31a68f11d"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDM4MjE3MQ==", "bodyText": "Can we also update the static icon warning message to show the file name?", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1303#discussion_r390382171", "createdAt": "2020-03-10T15:03:36Z", "author": {"login": "bilal-alsharifi"}, "path": "base/src/main/java/com/smartdevicelink/managers/file/BaseFileManager.java", "diffHunk": "@@ -329,6 +329,16 @@ public void uploadFile(@NonNull final SdlFile file, final CompletionListener lis\n \t\t\tlistener.onComplete(true);\n \t\t\treturn;\n \t\t}\n+\t\t// In sdl_ios: HAX: [#827](https://github.com/smartdevicelink/sdl_ios/issues/827) Older versions of Core had a bug where list files would cache incorrectly.\n+\t\t// This led to attempted uploads failing due to the system thinking they were already there when they were not.\n+\t\tif (!file.isPersistent() && !hasUploadedFile(file)) {\n+\t\t\tfile.setOverwrite(true);\n+\t\t}\n+\t\tif (!file.isOverwrite() && hasUploadedFile(file)) {\n+\t\t\tLog.w(TAG, \"Files that have already uploaded and have an Overwrite property set to false will not be re-Upload\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDM4MDU5OQ=="}, "originalCommit": {"oid": "738af48f45a92ac568a075a8ef44a4e31a68f11d"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "21450c41b8bcbf95d826a2aa8687bd195e85862d", "author": {"user": null}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/21450c41b8bcbf95d826a2aa8687bd195e85862d", "committedDate": "2020-03-10T16:27:19Z", "message": "Merge branch 'develop' into add_Overwrite_Property"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyMjMwNTA5", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1303#pullrequestreview-372230509", "createdAt": "2020-03-10T18:48:56Z", "commit": {"oid": "21450c41b8bcbf95d826a2aa8687bd195e85862d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQxODo0ODo1NlrOF0ceQA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQxODo0ODo1NlrOF0ceQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDUzNjc2OA==", "bodyText": "In java suite, this not necessary since we are covering that case in hasUploadedFile(). So that if statement can be removed. This also applies to uploadFiles()", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1303#discussion_r390536768", "createdAt": "2020-03-10T18:48:56Z", "author": {"login": "bilal-alsharifi"}, "path": "base/src/main/java/com/smartdevicelink/managers/file/BaseFileManager.java", "diffHunk": "@@ -329,6 +329,16 @@ public void uploadFile(@NonNull final SdlFile file, final CompletionListener lis\n \t\t\tlistener.onComplete(true);\n \t\t\treturn;\n \t\t}\n+\t\t// In sdl_ios: HAX: [#827](https://github.com/smartdevicelink/sdl_ios/issues/827) Older versions of Core had a bug where list files would cache incorrectly.\n+\t\t// This led to attempted uploads failing due to the system thinking they were already there when they were not.\n+\t\tif (!file.isPersistent() && !hasUploadedFile(file)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21450c41b8bcbf95d826a2aa8687bd195e85862d"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c4d6e48ac37a40e70f0b47da0671046da63b259c", "author": {"user": null}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/c4d6e48ac37a40e70f0b47da0671046da63b259c", "committedDate": "2020-03-11T14:05:24Z", "message": "Removed unnecessary if statements in uploadFile and uploadFiles"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e9752831bf093f5acd759a59a3d76af092660d09", "author": {"user": null}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/e9752831bf093f5acd759a59a3d76af092660d09", "committedDate": "2020-03-11T14:10:10Z", "message": "ReFormatted Log.w statements for uploading static icons and Overwrite property in uploadFiles and uploadFile"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b0fd97f39056370e4b9d8bd47bb488e2f6da1794", "author": {"user": null}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/b0fd97f39056370e4b9d8bd47bb488e2f6da1794", "committedDate": "2020-03-11T14:12:27Z", "message": "changed isOverwrite to getOverwrite in sdlFIle in both projects and BaseFileManager"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczMDg0Nzgz", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1303#pullrequestreview-373084783", "createdAt": "2020-03-11T20:00:47Z", "commit": {"oid": "b0fd97f39056370e4b9d8bd47bb488e2f6da1794"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2131, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}