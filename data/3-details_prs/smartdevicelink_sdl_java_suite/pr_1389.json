{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM3ODU0Njk0", "number": 1389, "title": "[SDL 0292] implement VirtualDisplayEncoder improvement for stable frame rate", "bodyText": "Fixes #1361\nThis PR is ready for review.\nRisk\nThis PR makes minor API changes.\nTesting Plan\n\n I have verified that I have not introduced new warnings in this PR (or explain why below)\n I have run the unit tests with this PR\n I have tested this PR against Core and verified behavior (if applicable, if not applicable, explain why below).\n I have tested Android, (but not with Java SE, and Java EE)\n\nUnit Tests\nThis PR includes an unit test for Grafika part\nCore Tests\nI have run my SDL VPM app to make sure VPM runs with consistent frame rate.\nCore version / branch / commit hash / module tested against: Core 6.1 + preferredFPS integrated (see sdl_core PR at smartdevicelink/sdl_core#3437)\nHMI name / version / branch / commit hash / module tested against: our own HMI with VPM capability\nSummary\nThis implements [SDL 0292] Improve VirtualDisplayEncoder for stable frame rate.\nChangelog\nBreaking Changes\n\nN/A\n\nEnhancements\n\nThis PR improve the VPM quality.\n\nBug Fixes\n\nissue #1361\n\nTasks Remaining:\n\nN/A\n\nCLA\n\n I have signed the CLA", "createdAt": "2020-06-22T10:49:17Z", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1389", "merged": true, "mergeCommit": {"oid": "4ee9071bda600f9cc119a3c7c85cd850d75af482"}, "closed": true, "closedAt": "2021-01-21T15:13:59Z", "author": {"login": "shiniwat"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcqfDNkAH2gAyNDM3ODU0Njk0OjFhZmZmZGIxMGZlZTM2OTBlYzAwYTZhYzI0MWU4ZjM5ZjJmYTBiNWM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdyWCHKAFqTU3MzQzMDgzOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1afffdb10fee3690ec00a6ac241e8f39f2fa0b5c", "author": {"user": {"login": "shiniwat", "name": "Shinichi Watanabe"}}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/1afffdb10fee3690ec00a6ac241e8f39f2fa0b5c", "committedDate": "2020-06-12T09:01:28Z", "message": "[SDL-0274] issue-1268: implementing add preferred FPS to VideoStreamingCapability."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8dd4bb8fbe91b223c7eb3fd755c4a19f4645c275", "author": {"user": {"login": "shiniwat", "name": "Shinichi Watanabe"}}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/8dd4bb8fbe91b223c7eb3fd755c4a19f4645c275", "committedDate": "2020-06-19T10:25:03Z", "message": "SDL-0292: initial commit for implementing VirtualDisplayEncoder improvement for stable frame rate."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6ce74f0039f169a7211787a2cc848ba55f036982", "author": {"user": {"login": "shiniwat", "name": "Shinichi Watanabe"}}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/6ce74f0039f169a7211787a2cc848ba55f036982", "committedDate": "2020-06-22T10:29:00Z", "message": "Add OffscreenSurfaceTest (for unit testing)."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b66814bd198a630c27050e337e118d8e150b3343", "author": {"user": {"login": "shiniwat", "name": "Shinichi Watanabe"}}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/b66814bd198a630c27050e337e118d8e150b3343", "committedDate": "2020-07-03T09:56:01Z", "message": "Merge remote-tracking branch 'upstream/develop' into feature/issue-1361"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "20b95ce2ada65190232101b64301c772edd3b163", "author": {"user": {"login": "shiniwat", "name": "Shinichi Watanabe"}}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/20b95ce2ada65190232101b64301c772edd3b163", "committedDate": "2020-07-03T10:58:37Z", "message": "Refactorred OffscreenSurfaceTest, as AndroidtestCase2 no longer exists in current develop branch."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "edc3586655862c2a6735f38585be08c68a65e6fe", "author": {"user": {"login": "shiniwat", "name": "Shinichi Watanabe"}}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/edc3586655862c2a6735f38585be08c68a65e6fe", "committedDate": "2020-08-21T07:12:32Z", "message": "Merge remote-tracking branch 'upstream/develop' into feature/issue-1361"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8e522c5de346b3f3c593e05bd0b3c20a1aadd9f3", "author": {"user": {"login": "shiniwat", "name": "Shinichi Watanabe"}}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/8e522c5de346b3f3c593e05bd0b3c20a1aadd9f3", "committedDate": "2020-08-25T09:26:02Z", "message": "Fix the test failure in OffscreenSurfaceTest aftter merging 4.12.0."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgwMDYzNTYy", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1389#pullrequestreview-480063562", "createdAt": "2020-09-01T19:45:57Z", "commit": {"oid": "8e522c5de346b3f3c593e05bd0b3c20a1aadd9f3"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQxOTo0NTo1N1rOHLFtZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQxOTo0ODowN1rOHLFxtA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTM4OTkyNA==", "bodyText": "This would be considered a breaking change, can you please keep the old method and deprecate it and then add in your new method", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1389#discussion_r481389924", "createdAt": "2020-09-01T19:45:57Z", "author": {"login": "RHenigan"}, "path": "android/sdl_android/src/main/java/com/smartdevicelink/encoder/VirtualDisplayEncoder.java", "diffHunk": "@@ -107,8 +126,8 @@ public VideoStreamingParameters getStreamingParams(){\n     }\n \n     @SuppressWarnings(\"unused\")\n-    public void setStreamingParams(int displayDensity, ImageResolution resolution, int frameRate, int bitrate, int interval, VideoStreamingFormat format) {\n-        this.streamingParams = new VideoStreamingParameters(displayDensity, frameRate, bitrate, interval, resolution, format);\n+    public void setStreamingParams(int displayDensity, ImageResolution resolution, int frameRate, int bitrate, int interval, VideoStreamingFormat format, boolean stableFrameRate) {\n+        this.streamingParams = new VideoStreamingParameters(displayDensity, frameRate, bitrate, interval, resolution, format, stableFrameRate);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8e522c5de346b3f3c593e05bd0b3c20a1aadd9f3"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTM5MTAyOA==", "bodyText": "This would be considered a breaking change, can you please keep the old constructor and deprecate it and then add in your new constructor.\nin the old constructor you can default the stableFrameRate value to be true", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1389#discussion_r481391028", "createdAt": "2020-09-01T19:48:07Z", "author": {"login": "RHenigan"}, "path": "base/src/main/java/com/smartdevicelink/streaming/video/VideoStreamingParameters.java", "diffHunk": "@@ -75,16 +76,18 @@ public VideoStreamingParameters(){\n \t    format = new VideoStreamingFormat();\n \t    format.setProtocol(DEFAULT_PROTOCOL);\n \t    format.setCodec(DEFAULT_CODEC);\n+\t    stableFrameRate = true;\n     }\n \n     public VideoStreamingParameters(int displayDensity, int frameRate, int bitrate, int interval,\n-                                    ImageResolution resolution, VideoStreamingFormat format){\n+                                    ImageResolution resolution, VideoStreamingFormat format, boolean stableFrameRate){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8e522c5de346b3f3c593e05bd0b3c20a1aadd9f3"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a4f25398780ef4ef94e930baa54857534f2cbf0a", "author": {"user": {"login": "shiniwat", "name": "Shinichi Watanabe"}}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/a4f25398780ef4ef94e930baa54857534f2cbf0a", "committedDate": "2020-09-02T05:57:12Z", "message": "Restored the old constructor of VideoStreamParameters for backward compatibility, which is suggested during the code review at https://github.com/smartdevicelink/sdl_java_suite/pull/1389."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0aeb8da0119132f4b316c9d1983bbcfa9baba79f", "author": {"user": {"login": "shiniwat", "name": "Shinichi Watanabe"}}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/0aeb8da0119132f4b316c9d1983bbcfa9baba79f", "committedDate": "2020-09-16T06:18:18Z", "message": "Merge remote-tracking branch 'upstream/develop' into feature/issue-1361"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkwMDE1OTIz", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1389#pullrequestreview-490015923", "createdAt": "2020-09-16T20:58:59Z", "commit": {"oid": "0aeb8da0119132f4b316c9d1983bbcfa9baba79f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQyMDo1OTowMFrOHTD_yg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNlQyMDo1OTowMFrOHTD_yg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTc1MDQ3NA==", "bodyText": "As part of the updates for 5.0 we have updated the RPCStructs setters to be chainable, please update this method with a return this; and update the method signature\nPlease see issue #1421", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1389#discussion_r489750474", "createdAt": "2020-09-16T20:59:00Z", "author": {"login": "RHenigan"}, "path": "base/src/main/java/com/smartdevicelink/proxy/rpc/VideoStreamingCapability.java", "diffHunk": "@@ -145,7 +146,22 @@ public Double getScale() {\n \t * @param scale the scaling factor the app should use to change the size of the projecting view.\n \t */\n \tpublic VideoStreamingCapability setScale( Double scale) {\n-        setValue(KEY_SCALE, scale);\n-        return this;\n-    }\n+\t\tsetValue(KEY_SCALE, scale);\n+\t\treturn this;\n+\t}\n+\n+\t/**\n+\t * @return the preferred frame rate per second (FPS) specified by head unit.\n+\t */\n+\tpublic Integer getPreferredFPS() {\n+\t\treturn getInteger(KEY_PREFERRED_FPS);\n+\t}\n+\n+\t/**\n+\t * @param preferredFPS preferred frame rate per second\n+\t */\n+\tpublic void setPreferredFPS(Integer preferredFPS) {\n+\t\tsetValue(KEY_PREFERRED_FPS, preferredFPS);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0aeb8da0119132f4b316c9d1983bbcfa9baba79f"}, "originalPosition": 30}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "240aa2085a15ea00f179705d37c9054b8ccd5751", "author": {"user": {"login": "shiniwat", "name": "Shinichi Watanabe"}}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/240aa2085a15ea00f179705d37c9054b8ccd5751", "committedDate": "2020-09-16T23:30:51Z", "message": "Update setPreferredFPS in VideoStreamingCapability as requested in PR review."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e9453d0863256bfdf6ccaf8b45296019760f0398", "author": {"user": {"login": "shiniwat", "name": "Shinichi Watanabe"}}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/e9453d0863256bfdf6ccaf8b45296019760f0398", "committedDate": "2020-09-22T11:13:30Z", "message": "Merge remote-tracking branch 'upstream/develop' into feature/issue-1361"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "16ed070754fecd4aa2fa318eba9c325180bff570", "author": {"user": {"login": "shiniwat", "name": "Shinichi Watanabe"}}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/16ed070754fecd4aa2fa318eba9c325180bff570", "committedDate": "2020-09-22T12:14:48Z", "message": "Fix a merge error in VideStreamingParameters."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3c276eb8821f0e7df7da6b53a8afa67b798ece5b", "author": {"user": {"login": "shiniwat", "name": "Shinichi Watanabe"}}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/3c276eb8821f0e7df7da6b53a8afa67b798ece5b", "committedDate": "2020-12-04T05:19:00Z", "message": "Merge remote-tracking branch 'upstream/develop' into feature/issue-1361"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3adc0eaf12c453ad4ca4bf2adcff92408bf4350d", "author": {"user": {"login": "shiniwat", "name": "Shinichi Watanabe"}}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/3adc0eaf12c453ad4ca4bf2adcff92408bf4350d", "committedDate": "2020-12-04T10:15:48Z", "message": "Implementing SDL 0323: Align VideoStreamingParameters with VideoStreamingCapability."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "37427ef09bf819d3d80586d8112d52aece006733", "author": {"user": {"login": "shiniwat", "name": "Shinichi Watanabe"}}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/37427ef09bf819d3d80586d8112d52aece006733", "committedDate": "2020-12-07T08:05:51Z", "message": "Revert \"Implementing SDL 0323: Align VideoStreamingParameters with VideoStreamingCapability.\"\n\nThis reverts commit 3adc0eaf12c453ad4ca4bf2adcff92408bf4350d."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTczNDMwODM4", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1389#pullrequestreview-573430838", "createdAt": "2021-01-21T15:13:40Z", "commit": {"oid": "37427ef09bf819d3d80586d8112d52aece006733"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2185, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}