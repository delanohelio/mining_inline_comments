{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMzNzQyMzE4", "number": 1383, "title": "[SDL 0306] Use Taskmaster To Handle Queuing Operations in Managers", "bodyText": "Fixes #1368\nThis PR is ready for review.\nRisk\nThis PR makes no API changes.\nTesting Plan\n\n I have verified that I have not introduced new warnings in this PR (or explain why below)\n I have run the unit tests with this PR\n I have tested this PR against Core and verified behavior (if applicable, if not applicable, explain why below).\n I have tested Android, Java SE, and Java EE\n\nUnit Tests\nUnit tests have been updated to test the new SoftButtonManager logic\nCore Tests\nAll the public APIs in ChoiceSetManager & SoftButtonManager should be re-tested to make sure they still work as expected. The guides are a good place to see a list of the smoke tests that can be done. This page explains more about the SoftButtonManager.  These two pages 1 & 2 explain more about ChoiceSetManager.\nCore version / branch / commit hash / module tested against: 6.1.0\nHMI name / version / branch / commit hash / module tested against: Generic HMI 0.8.0\nSummary\nThis PR adds the new Taskmaster dependency to the project to use it for managing tasks and queues. It also includes updating the ChoiceSetManager & SoftButtonManager to use queues in order to simplify their logic.\nCLA\n\n I have signed the CLA", "createdAt": "2020-06-12T15:19:10Z", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1383", "merged": true, "mergeCommit": {"oid": "d147f78974bfc4634cdaf9442456da2c6be65235"}, "closed": true, "closedAt": "2020-06-25T21:04:22Z", "author": {"login": "bilal-alsharifi"}, "timelineItems": {"totalCount": 21, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcqkXVJAH2gAyNDMzNzQyMzE4OmYyNDZmMjJlMTZhYWI5Yjk1Y2QwYTNmZDBhZjA4NGU3YTFmYzZmY2I=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcu1IXJAFqTQzNzg1NTE2Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f246f22e16aab9b95cd0a3fd0af084e7a1fc6fcb", "author": {"user": {"login": "bilal-alsharifi", "name": "Bilal Alsharifi"}}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/f246f22e16aab9b95cd0a3fd0af084e7a1fc6fcb", "committedDate": "2020-06-12T15:12:58Z", "message": "Add Taskmaster dependency"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1b15fb34eceec0b7715477c23f9073824638719c", "author": {"user": {"login": "bilal-alsharifi", "name": "Bilal Alsharifi"}}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/1b15fb34eceec0b7715477c23f9073824638719c", "committedDate": "2020-06-12T15:17:21Z", "message": "Update ChoiceSetManager to use Taskmaster"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fe0b4dd829c6f2c1598102638f877b1da8595276", "author": {"user": {"login": "bilal-alsharifi", "name": "Bilal Alsharifi"}}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/fe0b4dd829c6f2c1598102638f877b1da8595276", "committedDate": "2020-06-12T17:46:19Z", "message": "Fix unit tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d2b2b13cbc4e0d9892fd41b5a25a9e8e49f74e1", "author": {"user": {"login": "bilal-alsharifi", "name": "Bilal Alsharifi"}}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/9d2b2b13cbc4e0d9892fd41b5a25a9e8e49f74e1", "committedDate": "2020-06-15T19:56:55Z", "message": "Remove calling run() in onExecute()"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a915ec357cf31f457639b2da9ac46a4bcdc26f08", "author": {"user": {"login": "bilal-alsharifi", "name": "Bilal Alsharifi"}}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/a915ec357cf31f457639b2da9ac46a4bcdc26f08", "committedDate": "2020-06-15T20:56:21Z", "message": "Add Taskmaster to javaEE"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a0220a1978cf5dff2d8374b4e8f20cf8be7c4e32", "author": {"user": {"login": "bilal-alsharifi", "name": "Bilal Alsharifi"}}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/a0220a1978cf5dff2d8374b4e8f20cf8be7c4e32", "committedDate": "2020-06-17T14:46:44Z", "message": "Refactor SoftButtonState & SoftButtonObject"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "efc3385f7d836e4d87e4117cbbb991a5f100cdce", "author": {"user": {"login": "bilal-alsharifi", "name": "Bilal Alsharifi"}}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/efc3385f7d836e4d87e4117cbbb991a5f100cdce", "committedDate": "2020-06-17T15:03:44Z", "message": "Fix an issue in SoftButtonState tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa57a6ea0df39be036f4b328366c41349ce435fe", "author": {"user": {"login": "bilal-alsharifi", "name": "Bilal Alsharifi"}}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/aa57a6ea0df39be036f4b328366c41349ce435fe", "committedDate": "2020-06-17T15:12:43Z", "message": "Update ScreenManager.commit()"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c6b963b39dc70dc7716f92f162f2975569c6bad6", "author": {"user": {"login": "bilal-alsharifi", "name": "Bilal Alsharifi"}}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/c6b963b39dc70dc7716f92f162f2975569c6bad6", "committedDate": "2020-06-17T15:58:28Z", "message": "Rename operationQueue to transactionQueue"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a17e6aa2cb1c606ebd2d2d9e1660250010612f93", "author": {"user": {"login": "bilal-alsharifi", "name": "Bilal Alsharifi"}}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/a17e6aa2cb1c606ebd2d2d9e1660250010612f93", "committedDate": "2020-06-17T19:33:09Z", "message": "Update SoftButtonObject.hashCode()"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0626034061f290c46a89399e0e1a616fe990f5cb", "author": {"user": {"login": "bilal-alsharifi", "name": "Bilal Alsharifi"}}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/0626034061f290c46a89399e0e1a616fe990f5cb", "committedDate": "2020-06-17T20:57:30Z", "message": "Update Taskmaster to 0.3.0"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "98964c9d2d49cbde88b0aa8b148b4fbff7b95977", "author": {"user": {"login": "bilal-alsharifi", "name": "Bilal Alsharifi"}}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/98964c9d2d49cbde88b0aa8b148b4fbff7b95977", "committedDate": "2020-06-18T18:08:33Z", "message": "Add SoftButtonManager operations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "61afaf40d93e4e17aae66929a61d53fddd12340e", "author": {"user": {"login": "bilal-alsharifi", "name": "Bilal Alsharifi"}}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/61afaf40d93e4e17aae66929a61d53fddd12340e", "committedDate": "2020-06-18T21:47:45Z", "message": "Fix an issue in uploading imges for other states"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f18454b4442997d2b77688e87b59f0b0365faf02", "author": {"user": {"login": "bilal-alsharifi", "name": "Bilal Alsharifi"}}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/f18454b4442997d2b77688e87b59f0b0365faf02", "committedDate": "2020-06-19T20:33:13Z", "message": "Merge branch 'develop' into feature/use_taskmaster"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9e382aa8f4400934407a88b2bd5fb7e37bad2b2d", "author": {"user": {"login": "bilal-alsharifi", "name": "Bilal Alsharifi"}}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/9e382aa8f4400934407a88b2bd5fb7e37bad2b2d", "committedDate": "2020-06-22T19:09:00Z", "message": "Fix SoftButtonManager unit tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fdccce599b335862bfe4e65619b9ea135f852c97", "author": {"user": {"login": "bilal-alsharifi", "name": "Bilal Alsharifi"}}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/fdccce599b335862bfe4e65619b9ea135f852c97", "committedDate": "2020-06-22T19:20:35Z", "message": "Test that the soft button listeners got called correctly"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8e45380d4f50bbca5a1bbac36d56e2cbbcd35276", "author": {"user": {"login": "bilal-alsharifi", "name": "Bilal Alsharifi"}}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/8e45380d4f50bbca5a1bbac36d56e2cbbcd35276", "committedDate": "2020-06-23T15:14:13Z", "message": "Fix potential NPE"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0ec281aa5cc383e3ef8d54703c0ea91df9a5e3d9", "author": {"user": {"login": "bilal-alsharifi", "name": "Bilal Alsharifi"}}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/0ec281aa5cc383e3ef8d54703c0ea91df9a5e3d9", "committedDate": "2020-06-23T21:19:41Z", "message": "Update SoftButtonManagerTests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3NzkwNTU0", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1383#pullrequestreview-437790554", "createdAt": "2020-06-25T19:21:22Z", "commit": {"oid": "0ec281aa5cc383e3ef8d54703c0ea91df9a5e3d9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxOToyMToyM1rOGpInIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQxOToyMToyM1rOGpInIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTc4NTg4OA==", "bodyText": "Can we remove this space", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1383#discussion_r445785888", "createdAt": "2020-06-25T19:21:23Z", "author": {"login": "RHenigan"}, "path": "base/src/main/java/com/smartdevicelink/managers/screen/BaseSoftButtonManager.java", "diffHunk": "@@ -76,101 +69,106 @@\n  */\n abstract class BaseSoftButtonManager extends BaseSubManager {\n \n-    private static final String TAG = \"SoftButtonManager\";\n-    private WeakReference<FileManager> fileManager;\n-    WindowCapability defaultMainWindowCapability;\n+    private final WeakReference<FileManager> fileManager;\n+    SoftButtonCapabilities softButtonCapabilities;\n     private CopyOnWriteArrayList<SoftButtonObject> softButtonObjects;\n     private HMILevel currentHMILevel;\n-    private Show inProgressShowRPC;\n-    private CompletionListener inProgressListener, queuedUpdateListener, cachedListener;\n-    private boolean hasQueuedUpdate, batchUpdates, waitingOnHMILevelUpdateToSetButtons;\n     private final OnSystemCapabilityListener onDisplayCapabilityListener;\n     private final OnRPCNotificationListener onHMIStatusListener, onButtonPressListener, onButtonEventListener;\n+    private Queue transactionQueue;\n+    private final List<Task> batchQueue;\n+    private boolean batchUpdates;\n     private final SoftButtonObject.UpdateListener updateListener;\n \n     /**\n      * HAX: This is necessary due to a Ford Sync 3 bug that doesn't like Show requests without a main field being set (it will accept them, but with a GENERIC_ERROR, and 10-15 seconds late...)\n      */\n     private String currentMainField1;\n \n-\n     /**\n      * Creates a new instance of the SoftButtonManager\n      * @param internalInterface an instance of the ISdl interface that can be used for common SDL operations (sendRpc, addRpcListener, etc)\n-     * @param fileManager an instance of the FileManager so that button graphics can be sent\n+     * @param fileManager       an instance of the FileManager so that button graphics can be sent", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0ec281aa5cc383e3ef8d54703c0ea91df9a5e3d9"}, "originalPosition": 76}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "82ea818b5941a5321ef71815611f271d731a67f9", "author": {"user": {"login": "bilal-alsharifi", "name": "Bilal Alsharifi"}}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/82ea818b5941a5321ef71815611f271d731a67f9", "committedDate": "2020-06-25T20:27:21Z", "message": "Fix spacing issue"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3ODU1MTYy", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1383#pullrequestreview-437855162", "createdAt": "2020-06-25T21:00:42Z", "commit": {"oid": "82ea818b5941a5321ef71815611f271d731a67f9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2179, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}