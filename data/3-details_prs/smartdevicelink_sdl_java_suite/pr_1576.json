{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMzNTE4MTM3", "number": 1576, "title": "Implement SDL 0323: Align video streaming parameters with VideoStreamingCapability", "bodyText": "Fixes #1569\nThis PR is ready for review.\nRisk\nThis PR makes no API changes.\nTesting Plan\n\n I have verified that I have not introduced new warnings in this PR (or explain why below)\n I have run the unit tests with this PR\n I have tested this PR against Core and verified behavior (if applicable, if not applicable, explain why below).\n I have tested Android, Java SE, and Java EE\n\nUnit Tests\nThis PR does not include additional Unit Tests.\nCore Tests\nBased on SDL 0274 enabled Core and HMI, verified that video streaming works correctly.\nCore version / branch / commit hash / module tested against: Core feature/issue-3243 branch; commit #3934b0d8804fc658ccca96f5ce558b9987255f4e.\nHMI name / version / branch / commit hash / module tested against: Xevo custom HMI\nSummary\nImplement SDL 0323: Align vide streaming parameters with VideoStreamingCapability\nChangelog\nBreaking Changes\n\nNo breaking changes.\n\nEnhancements\n\nThis implements issue #1569.\n\nBug Fixes\n\nNo bug fixes.\n\nTasks Remaining:\nNone\nCLA\n\n I have signed the CLA", "createdAt": "2020-12-07T09:18:33Z", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1576", "merged": true, "mergeCommit": {"oid": "4add79ec1888cc517ff2010d56d795d8b9a27884"}, "closed": true, "closedAt": "2021-01-28T16:06:45Z", "author": {"login": "shiniwat"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdtxFn1gH2gAyNTMzNTE4MTM3OjdmYjM1MTVjODIyMzdkMDkzZjc3NzliNjdkMDFhMDhmZmQyZDdmNzI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABd0m9q5gFqTU3ODQ4OTg0Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7fb3515c82237d093f7779b67d01a08ffd2d7f72", "author": {"user": {"login": "shiniwat", "name": "Shinichi Watanabe"}}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/7fb3515c82237d093f7779b67d01a08ffd2d7f72", "committedDate": "2021-01-07T09:55:19Z", "message": "Add missing stableFrameRate for default ctor.\nAlso removed some debug noise."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1e2b92302aaeca638c61ed66ce1b6c36639086d5", "author": {"user": {"login": "shiniwat", "name": "Shinichi Watanabe"}}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/1e2b92302aaeca638c61ed66ce1b6c36639086d5", "committedDate": "2021-01-07T13:19:18Z", "message": "Fix a potential case where VideoFormat is unexpectedly overridden by VideoStreamingParameter#update."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYzNzczNjAx", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1576#pullrequestreview-563773601", "createdAt": "2021-01-07T19:41:42Z", "commit": {"oid": "1e2b92302aaeca638c61ed66ce1b6c36639086d5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wN1QxOTo0MTo0MlrOIP5wQw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wN1QxOTo0MTo0MlrOIP5wQw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzU0NTc5NQ==", "bodyText": "Hello @shiniwat, This would be a breaking change, please deprecate the old constructor and assign this.stableFrameRate = true and then create the new constructor with stableFrameRate as a parameter", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1576#discussion_r553545795", "createdAt": "2021-01-07T19:41:42Z", "author": {"login": "RHenigan"}, "path": "base/src/main/java/com/smartdevicelink/streaming/video/VideoStreamingParameters.java", "diffHunk": "@@ -78,16 +79,28 @@ public VideoStreamingParameters() {\n         format = new VideoStreamingFormat();\n         format.setProtocol(DEFAULT_PROTOCOL);\n         format.setCodec(DEFAULT_CODEC);\n+        stableFrameRate = true;\n     }\n \n+    /**\n+     * new constructor of VideoStreamingParameters, which now has stableFrameRate param.\n+     * @param displayDensity\n+     * @param frameRate\n+     * @param bitrate\n+     * @param interval\n+     * @param resolution\n+     * @param format\n+     * @param stableFrameRate\n+     */\n     public VideoStreamingParameters(int displayDensity, int frameRate, int bitrate, int interval,\n-                                    ImageResolution resolution, VideoStreamingFormat format) {\n-        this.displayDensity = displayDensity;\n-        this.frameRate = frameRate;\n-        this.bitrate = bitrate;\n-        this.interval = interval;\n-        this.resolution = resolution;\n-        this.format = format;\n+                                    ImageResolution resolution, VideoStreamingFormat format, boolean stableFrameRate){\n+\t    this.displayDensity = displayDensity;\n+\t    this.frameRate = frameRate;\n+\t    this.bitrate = bitrate;\n+\t    this.interval = interval;\n+\t    this.resolution = resolution;\n+\t    this.format = format;\n+\t    this.stableFrameRate = stableFrameRate;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1e2b92302aaeca638c61ed66ce1b6c36639086d5"}, "originalPosition": 40}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b1ff6d4776534b470612ed7a69960e25afec838", "author": {"user": {"login": "shiniwat", "name": "Shinichi Watanabe"}}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/4b1ff6d4776534b470612ed7a69960e25afec838", "committedDate": "2021-01-08T02:15:42Z", "message": "Remove unused VideoStreamingParameter ctor, and mark existing one deprecated as per code review at https://github.com/smartdevicelink/sdl_java_suite/pull/1576."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "19e10a2e4d06710670bc2590f3b8874656a4dce8", "author": {"user": {"login": "shiniwat", "name": "Shinichi Watanabe"}}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/19e10a2e4d06710670bc2590f3b8874656a4dce8", "committedDate": "2021-01-15T08:49:58Z", "message": "Update rpc_spec submodule for SDL 0274 reviewed at https://github.com/smartdevicelink/rpc_spec/pull/229."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTczNDA5ODk2", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1576#pullrequestreview-573409896", "createdAt": "2021-01-21T14:54:21Z", "commit": {"oid": "19e10a2e4d06710670bc2590f3b8874656a4dce8"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d37b8e546d50f9a07248b7f041f9bc8d9411a8c0", "author": {"user": {"login": "shiniwat", "name": "Shinichi Watanabe"}}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/d37b8e546d50f9a07248b7f041f9bc8d9411a8c0", "committedDate": "2021-01-22T09:58:53Z", "message": "Merge remote-tracking branch 'upstream/integration/stable_frame_rate' into feature/issue-1569"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTc0NDYyNTgx", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1576#pullrequestreview-574462581", "createdAt": "2021-01-22T17:21:55Z", "commit": {"oid": "d37b8e546d50f9a07248b7f041f9bc8d9411a8c0"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yMlQxNzoyMTo1NVrOIYtoqQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yMlQxNzoyNjoyOFrOIYtzwg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2Mjc4NDQyNQ==", "bodyText": "Hello @shiniwat, even though this method is currently unused I believe it should be kept because it will replace the deprecated method above it when that method is eventually removed.", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1576#discussion_r562784425", "createdAt": "2021-01-22T17:21:55Z", "author": {"login": "RHenigan"}, "path": "android/sdl_android/src/main/java/com/smartdevicelink/encoder/VirtualDisplayEncoder.java", "diffHunk": "@@ -130,11 +130,6 @@ public void setStreamingParams(int displayDensity, ImageResolution resolution, i\n         this.streamingParams = new VideoStreamingParameters(displayDensity, frameRate, bitrate, interval, resolution, format);\n     }\n \n-    @SuppressWarnings(\"unused\")\n-    public void setStreamingParams(int displayDensity, ImageResolution resolution, int frameRate, int bitrate, int interval, VideoStreamingFormat format, boolean stableFrameRate) {\n-        this.streamingParams = new VideoStreamingParameters(displayDensity, frameRate, bitrate, interval, resolution, format, stableFrameRate);\n-    }\n-", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d37b8e546d50f9a07248b7f041f9bc8d9411a8c0"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2Mjc4NzI2Ng==", "bodyText": "Hello @shiniwat, I thank you for deprecating the old constructor but I eblieve we still need to include the new constructor so we should have both of the constructors listed here (The deprecated constructor will assign true for stableFrameRate)\n@Deprecated\npublic VideoStreamingParameters(int displayDensity, int frameRate, int bitrate, int interval,\n                                    ImageResolution resolution, VideoStreamingFormat format) {}\n\npublic VideoStreamingParameters(int displayDensity, int frameRate, int bitrate, int interval,\n                                    ImageResolution resolution, VideoStreamingFormat format, boolean stableFrameRate) {}", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1576#discussion_r562787266", "createdAt": "2021-01-22T17:26:28Z", "author": {"login": "RHenigan"}, "path": "base/src/main/java/com/smartdevicelink/streaming/video/VideoStreamingParameters.java", "diffHunk": "@@ -103,15 +92,16 @@ public VideoStreamingParameters(int displayDensity, int frameRate, int bitrate,\n      * @param format\n      * @param stableFrameRate\n      */\n+    @Deprecated\n     public VideoStreamingParameters(int displayDensity, int frameRate, int bitrate, int interval,\n-                                    ImageResolution resolution, VideoStreamingFormat format, boolean stableFrameRate){\n+                                    ImageResolution resolution, VideoStreamingFormat format){\n \t    this.displayDensity = displayDensity;\n \t    this.frameRate = frameRate;\n \t    this.bitrate = bitrate;\n \t    this.interval = interval;\n \t    this.resolution = resolution;\n \t    this.format = format;\n-\t    this.stableFrameRate = stableFrameRate;\n+\t    this.stableFrameRate = true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d37b8e546d50f9a07248b7f041f9bc8d9411a8c0"}, "originalPosition": 35}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c82f344526bfb12ed74741516be972cf8fcd7173", "author": {"user": {"login": "shiniwat", "name": "Shinichi Watanabe"}}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/c82f344526bfb12ed74741516be972cf8fcd7173", "committedDate": "2021-01-25T00:08:28Z", "message": "Update PR as per review comment at https://github.com/smartdevicelink/sdl_java_suite/pull/1576#pullrequestreview-574462581."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "65b3011735c1d78bb4af355ec06fc0afb61bc41f", "author": {"user": {"login": "shiniwat", "name": "Shinichi Watanabe"}}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/65b3011735c1d78bb4af355ec06fc0afb61bc41f", "committedDate": "2021-01-25T22:45:20Z", "message": "Revert \"Update rpc_spec submodule for SDL 0274 reviewed at https://github.com/smartdevicelink/rpc_spec/pull/229.\"\n\nThis reverts commit 19e10a2e4d06710670bc2590f3b8874656a4dce8."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTc2NzMxNDY4", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1576#pullrequestreview-576731468", "createdAt": "2021-01-26T20:24:55Z", "commit": {"oid": "65b3011735c1d78bb4af355ec06fc0afb61bc41f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d1eb83ff3bbeb6bc30c5277c4859edd31b08656", "author": {"user": {"login": "shiniwat", "name": "Shinichi Watanabe"}}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/1d1eb83ff3bbeb6bc30c5277c4859edd31b08656", "committedDate": "2021-01-27T01:45:34Z", "message": "Update VideoStreamingParameters#update, as per review at https://github.com/smartdevicelink/sdl_java_suite/pull/1576."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTc3NjQ5MTQ4", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1576#pullrequestreview-577649148", "createdAt": "2021-01-27T18:42:51Z", "commit": {"oid": "1d1eb83ff3bbeb6bc30c5277c4859edd31b08656"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yN1QxODo0Mjo1MVrOIbWQyA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yN1QxODo0Mjo1MVrOIbWQyA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTU0NzIwOA==", "bodyText": "Hello @shiniwat, while testing I noticed an issue with taking the min bitrate. The sdl_hmi systemCapabilities that I was using had the max int value (2147483647), once we multiple by 1000 the int overflows and turns negative resulting in -1000 being the min value.\nSince the max value for the bitRate per the rpc_spec is 2147483647 I think we should cap the maxBitRate we receive from capabilities to ensure it does not overflow and then we can still use the min value between the parameters and the capabilities\nint maxBitrate = Math.min(Integer.MAX_VALUE/1000, capability.getMaxBitrate());\nthis.bitrate = Math.min(this.bitrate, maxBitrate * 1000);", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1576#discussion_r565547208", "createdAt": "2021-01-27T18:42:51Z", "author": {"login": "RHenigan"}, "path": "base/src/main/java/com/smartdevicelink/streaming/video/VideoStreamingParameters.java", "diffHunk": "@@ -168,9 +178,12 @@ public void update(VideoStreamingParameters params) {\n      */\n     public void update(VideoStreamingCapability capability, String vehicleMake) {\n         if (capability.getMaxBitrate() != null) {\n-            this.bitrate = capability.getMaxBitrate() * 1000;\n+            // Taking lower value as per SDL 0323 :\n+            // https://github.com/smartdevicelink/sdl_evolution/blob/master/proposals/0323-align-VideoStreamingParameter-with-capability.md\n+            this.bitrate = Math.min(this.bitrate, capability.getMaxBitrate() * 1000);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1d1eb83ff3bbeb6bc30c5277c4859edd31b08656"}, "originalPosition": 66}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9c6136a7c52ab66a5dfde0e536a4a292fa8312da", "author": {"user": {"login": "shiniwat", "name": "Shinichi Watanabe"}}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/9c6136a7c52ab66a5dfde0e536a4a292fa8312da", "committedDate": "2021-01-28T12:26:14Z", "message": "Fix the potential integer overflow case when taking lower value of bitrate."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4fa997a00c141dad4d1975910f8d7f93cac9dfc7", "author": {"user": {"login": "shiniwat", "name": "Shinichi Watanabe"}}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/4fa997a00c141dad4d1975910f8d7f93cac9dfc7", "committedDate": "2021-01-28T12:36:53Z", "message": "Refix the possible overflow case in capability's max bitrate."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTc4NDg5ODQ2", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1576#pullrequestreview-578489846", "createdAt": "2021-01-28T16:05:03Z", "commit": {"oid": "4fa997a00c141dad4d1975910f8d7f93cac9dfc7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2023, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}