{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY0MTkxNDUy", "number": 1435, "title": "Add Reason Param to Protocol NAK Base", "bodyText": "Fixes #1379\nThis PR is ready for review.\nRisk\nThis PR makes [minor] API changes.\nTesting Plan\n\n I have verified that I have not introduced new warnings in this PR (or explain why below)\n I have run the unit tests with this PR\n I have tested this PR against Core and verified behavior (if applicable, if not applicable, explain why below).\n I have tested Android, Java SE, and Java EE\n\nCore Tests\n\n\nAdd logging to SdlProtocolBase.handleProtocolSessionNAKed() and SdlProtocolBase.handleServiceEndedNAK()\nString reasonParams = (String) packet.getTag(reason);\nDebugTool.logError(TAG, \"REASON: \" + reasonParams);\n\n\nFollow NAK Reproduction Steps Document and test against Core PR. To make these steps easier to test RPC Services I added startService and stopService methods to SdlManager and LifeCycleManager, this way services could be easily started from SdlService. For AudioStreaming and VideoStreaming tests I used the TestSuite.\n\n\nSdlManager:\n public void startServiceTest() {\n        lifecycleManager.startSessionTest();\n    }\n\n    public void stopServiceTest() {\n        lifecycleManager.stopSessionTest();\n    }\n\nBaseLifecycleManager:\n    public void startSessionTest() {\n        session.startService(SessionType.RPC, true);\n    }\n    public void stopSessionTest() {\n        session.endService(SessionType.RPC);\n    }\n\n*For testing end service you will have to comment out closing the transportManager otherwise you will not observe the response from core:\n    public void endSession(byte sessionID) {\n        SdlPacket header = SdlPacketFactory.createEndSession(SessionType.RPC, sessionID, -15, (byte)protocolVersion.getMajor(), hashID);\n        handlePacketToSend(header);\n//        synchronized (TRANSPORT_MANAGER_LOCK) {\n//            if (transportManager != null) {\n//                transportManager.close(sessionID);\n//            }\n//        }\n    } // end-method\n\n\nObserve logs to verify packets are coming through with the reason tag with correct reason messages as per the testing document\n\nCore version / branch / commit hash / module tested against: smartdevicelink/sdl_core#3462\nHMI name / version / branch / commit hash / module tested against: [INSERT]\nSummary\nThis PR adds a new reason protocol spec parameter available on all NAKs\nCLA\n\n I have signed the CLA", "createdAt": "2020-08-06T18:22:57Z", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1435", "merged": true, "mergeCommit": {"oid": "571c91aaa56cd61a4998410f015ae9e838218a18"}, "closed": true, "closedAt": "2020-09-03T19:21:35Z", "author": {"login": "RHenigan"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc8T_31AH2gAyNDY0MTkxNDUyOmUxOGZhYTg3ODAwODRkYjJmN2FlYjAyYzNmYjIyODZmZDY3YzZhYjk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdFVqNZAFqTQ4MjEzNDk0NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e18faa8780084db2f7aeb02c3fb2286fd67c6ab9", "author": {"user": {"login": "RHenigan", "name": "Robert Henigan"}}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/e18faa8780084db2f7aeb02c3fb2286fd67c6ab9", "committedDate": "2020-08-06T18:19:30Z", "message": "Add Reason Param to Protocol NAK Base"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec68a6d4445785b80365ae058262d76e49f808f2", "author": {"user": {"login": "RHenigan", "name": "Robert Henigan"}}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/ec68a6d4445785b80365ae058262d76e49f808f2", "committedDate": "2020-08-26T18:48:37Z", "message": "Merge branch 'develop' into feature/0308_ReasonParamToProtocolNAKs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5997af206c7e12b41468778fc961098e9a27f1ad", "author": {"user": {"login": "RHenigan", "name": "Robert Henigan"}}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/5997af206c7e12b41468778fc961098e9a27f1ad", "committedDate": "2020-08-28T17:32:56Z", "message": "Update Max Protocol Version"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgwMDg0NjMz", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1435#pullrequestreview-480084633", "createdAt": "2020-09-01T20:18:33Z", "commit": {"oid": "5997af206c7e12b41468778fc961098e9a27f1ad"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQyMDoxODozM1rOHLGurw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQyMDozODo0N1rOHLHW5Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTQwNjYzOQ==", "bodyText": "RegisterSecondaryTransportNAK already has a reason so it should be removed from that specific NAK as it exists in the base class now.", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1435#discussion_r481406639", "createdAt": "2020-09-01T20:18:33Z", "author": {"login": "bilal-alsharifi"}, "path": "base/src/main/java/com/smartdevicelink/protocol/enums/ControlFrameTags.java", "diffHunk": "@@ -44,6 +44,7 @@\n \tprivate static class NAKBase{\n \t\t/** An array of rejected parameters related to the corresponding request*/\n \t\tpublic static final String REJECTED_PARAMS = \"rejectedParams\";\n+\t\tpublic static final String REASON = \"reason\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5997af206c7e12b41468778fc961098e9a27f1ad"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTQxNjkzMw==", "bodyText": "The reason value for all NAKs messages should be printed as a warning similar to how we do it here:\n\n  \n    \n      sdl_java_suite/base/src/main/java/com/smartdevicelink/protocol/SdlProtocolBase.java\n    \n    \n         Line 1428\n      in\n      7f12aef\n    \n    \n    \n    \n\n        \n          \n           String reason = (String) packet.getTag(ControlFrameTags.RPC.RegisterSecondaryTransportNAK.REASON);", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1435#discussion_r481416933", "createdAt": "2020-09-01T20:38:47Z", "author": {"login": "bilal-alsharifi"}, "path": "base/src/main/java/com/smartdevicelink/protocol/enums/ControlFrameTags.java", "diffHunk": "@@ -44,6 +44,7 @@\n \tprivate static class NAKBase{\n \t\t/** An array of rejected parameters related to the corresponding request*/\n \t\tpublic static final String REJECTED_PARAMS = \"rejectedParams\";\n+\t\tpublic static final String REASON = \"reason\";\n \t}\n ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5997af206c7e12b41468778fc961098e9a27f1ad"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4007e253b4958a89cfd5f7d4c7904d45a81fa78e", "author": {"user": {"login": "RHenigan", "name": "Robert Henigan"}}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/4007e253b4958a89cfd5f7d4c7904d45a81fa78e", "committedDate": "2020-09-01T21:05:51Z", "message": "Add logging and remove redundent reason"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgyMTM0OTQ1", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1435#pullrequestreview-482134945", "createdAt": "2020-09-03T19:20:58Z", "commit": {"oid": "4007e253b4958a89cfd5f7d4c7904d45a81fa78e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2072, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}