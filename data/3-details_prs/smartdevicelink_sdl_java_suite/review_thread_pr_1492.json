{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgzMTQ5NDEz", "number": 1492, "reviewThreads": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxNzo0MToyN1rOEjs4yg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQyMDowNzoxN1rOEjwaDQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA1ODcxMDUwOnYy", "diffSide": "RIGHT", "path": "base/src/main/java/com/smartdevicelink/managers/screen/BaseTextAndGraphicManager.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxNzo0MToyN1rOHSNEww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxNzo0MToyN1rOHSNEww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg1MDYyNw==", "bodyText": "Shouldnt this be newScreenData?\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\tthis.softButtonManager.get().setCurrentMainField1(currentScreenData.getTextField1());\n          \n          \n            \n            \t\t\tthis.softButtonManager.get().setCurrentMainField1(newScreenData.getTextField1());", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1492#discussion_r488850627", "createdAt": "2020-09-15T17:41:27Z", "author": {"login": "bilal-alsharifi"}, "path": "base/src/main/java/com/smartdevicelink/managers/screen/BaseTextAndGraphicManager.java", "diffHunk": "@@ -191,47 +192,74 @@ private synchronized void sdlUpdate(final CompletionListener listener) {\n \t\t}\n \n \t\t// Task can be READY, about to start and popped of the queue, so we have to cancel it, to prevent it from starting\n-\t\tif (updateOperation != null && updateOperation.getState() == Task.READY) {\n+\t\tif (updateOperation != null && updateOperation.getState() == Task.READY && supersedePreviousOperations) {\n \t\t\tupdateOperation.cancelTask();\n \t\t\tif (currentOperationListener != null) {\n \t\t\t\tcurrentOperationListener.onComplete(false);\n \t\t\t}\n \t\t}\n \n \t\t// If Task is IN_PROGRESS, it\u2019s not on the queue, we need to mark it as cancelled. The task will return at some point when it checks its status and call the listener back\n-\t\tif (updateOperation != null && updateOperation.getState() == Task.IN_PROGRESS) {\n+\t\tif (updateOperation != null && updateOperation.getState() == Task.IN_PROGRESS && supersedePreviousOperations) {\n \t\t\tupdateOperation.cancelTask();\n \t\t}\n \n \t\tcurrentOperationListener = listener;\n \n \t\tCurrentScreenDataUpdatedListener currentScreenDataUpdateListener = new CurrentScreenDataUpdatedListener() {\n \t\t\t@Override\n-\t\t\tpublic void onUpdate(Show show) {\n-\t\t\t\tupdatePendingOperationsWithNewScreenData(show);\n-\t\t\t\tcurrentScreenData = show;\n+\t\t\tpublic void onUpdate(TextsAndGraphicsState newScreenData) {\n+\t\t\t\tif(newScreenData != null) {\n+\t\t\t\t\t// Update our current screen data\n+\t\t\t\t\tcurrentScreenData = newScreenData;\n+\t\t\t\t\tupdatePendingOperationsWithNewScreenData(newScreenData);\n+\t\t\t\t}\n+\t\t\t}\n+\n+\t\t\t@Override\n+\t\t\tpublic void onError() {\n+\t\t\t\t// Invalidate data that's different from our current screen data\n+\t\t\t\tresetFieldsToCurrentScreenData();\n \t\t\t}\n \t\t};\n \n \t\tupdateOperation = new TextAndGraphicUpdateOperation(internalInterface, fileManager.get(), defaultMainWindowCapability, currentScreenData, currentState(), currentOperationListener, currentScreenDataUpdateListener);\n \t\ttransactionQueue.add(updateOperation, false);\n \t}\n \n+\tvoid resetFieldsToCurrentScreenData() {\n+\t\ttextField1 = currentScreenData.getTextField1();\n+\t\ttextField2 = currentScreenData.getTextField2();\n+\t\ttextField3 = currentScreenData.getTextField3();\n+\t\ttextField4 = currentScreenData.getTextField4();\n+\t\tmediaTrackTextField = currentScreenData.getMediaTrackTextField();\n+\t\ttitle = currentScreenData.getTitle();\n+\t\ttextAlignment = currentScreenData.getTextAlignment();\n+\t\ttextField1Type = currentScreenData.getTextField1Type();\n+\t\ttextField2Type = currentScreenData.getTextField2Type();\n+\t\ttextField3Type = currentScreenData.getTextField3Type();\n+\t\ttextField4Type = currentScreenData.getTextField4Type();\n+\t\tprimaryGraphic = currentScreenData.getPrimaryGraphic();\n+\t\tsecondaryGraphic = currentScreenData.getSecondaryGraphic();\n+\t\ttemplateConfiguration = currentScreenData.getTemplateConfiguration();\n+\t}\n+\n \t//Updates pending task with current screen data\n-\tvoid updatePendingOperationsWithNewScreenData(Show newScreenData) {\n+\tvoid updatePendingOperationsWithNewScreenData(TextsAndGraphicsState newScreenData) {\n \t\tfor (Task task : transactionQueue.getTasksAsList()) {\n \t\t\tif (!(task instanceof TextAndGraphicUpdateOperation)) {\n \t\t\t\tcontinue;\n \t\t\t}\n \t\t\t((TextAndGraphicUpdateOperation) task).setCurrentScreenData(newScreenData);\n \t\t}\n-\t\tif (this.softButtonManager.get() != null && newScreenData.getMainField1() != null) {\n-\t\t\tthis.softButtonManager.get().setCurrentMainField1(currentScreenData.getMainField1());\n+\t\tif (this.softButtonManager.get() != null && newScreenData.getTextField1() != null) {\n+\t\t\tthis.softButtonManager.get().setCurrentMainField1(currentScreenData.getTextField1());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9037faac9656f0b21685de1c1b4329b0d3b898e8"}, "originalPosition": 126}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA1ODcyNzE3OnYy", "diffSide": "RIGHT", "path": "base/src/main/java/com/smartdevicelink/managers/screen/BaseScreenManager.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxNzo0NTo1OFrOHSNPPA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxNzo0NTo1OFrOHSNPPA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg1MzMwOA==", "bodyText": "Shouldn't templateConfiguration have @nonnull annotation?", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1492#discussion_r488853308", "createdAt": "2020-09-15T17:45:58Z", "author": {"login": "bilal-alsharifi"}, "path": "base/src/main/java/com/smartdevicelink/managers/screen/BaseScreenManager.java", "diffHunk": "@@ -377,6 +378,21 @@ public String getTitle(){\n \t\treturn this.textAndGraphicManager.getTitle();\n \t}\n \n+\t/**\n+\t * Change the current layout to a new layout and optionally update the layout's night and day color schemes. The values set for the text, graphics,\n+\t * buttons and template title persist between layout changes. To update the text, graphics, buttons and template title at the same time as the template,\n+\t * batch all the updates between `beginUpdates` and `endUpdates`. If the layout update fails while batching, then the updated text, graphics, buttons or template title will also not be updated.\n+\t *\n+\t * If you are connected on a < v6.0 connection and batching the update, the layout will be updated, then the text and graphics will be updated.\n+\t * If you are connected on a >= v6.0 connection, the layout will be updated at the same time that the text and graphics are updated.\n+\t *\n+\t * @param templateConfiguration The new configuration of the template, including the layout and color scheme.\n+\t * @param listener A listener that will be called when the layout change finished.\n+\t */\n+\tpublic void changeLayout(TemplateConfiguration templateConfiguration, CompletionListener listener) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9037faac9656f0b21685de1c1b4329b0d3b898e8"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA1ODk0MDk0OnYy", "diffSide": "RIGHT", "path": "base/src/main/java/com/smartdevicelink/managers/screen/TextAndGraphicUpdateOperation.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxODo0ODoxM1rOHSPVzQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxODo0ODoxM1rOHSPVzQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg4Nzc1Nw==", "bodyText": "internalInterface.get() could be null. This applies to all usages of internalInterface in this class", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1492#discussion_r488887757", "createdAt": "2020-09-15T18:48:13Z", "author": {"login": "bilal-alsharifi"}, "path": "base/src/main/java/com/smartdevicelink/managers/screen/TextAndGraphicUpdateOperation.java", "diffHunk": "@@ -60,16 +64,40 @@ private void start() {\n             return;\n         }\n \n-        // Build a show with everything from `self.newState`, we'll pull things out later if we can.\n-        Show fullShow = new Show();\n+        fullShow = new Show();\n         fullShow.setAlignment(updatedState.getTextAlignment());\n         fullShow = assembleShowText(fullShow);\n         fullShow = assembleShowImages(fullShow);\n+        fullShow = assembleLayout(fullShow);\n+\n+\n+        if (internalInterface.get().getSdlMsgVersion().getMajorVersion() >= 6) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9037faac9656f0b21685de1c1b4329b0d3b898e8"}, "originalPosition": 42}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA1ODk4MjUzOnYy", "diffSide": "RIGHT", "path": "base/src/main/java/com/smartdevicelink/managers/screen/TextAndGraphicUpdateOperation.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxODo1NTozOFrOHSPwmQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxOToxOTo1OFrOHSQqhQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg5NDYxNw==", "bodyText": "Can we use < instead of using >= then !?\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (!(internalInterface.get().getSdlMsgVersion().getMajorVersion() >= 6) || !shouldUpdateTemplateConfig()) {\n          \n          \n            \n                    if (internalInterface.get().getSdlMsgVersion().getMajorVersion() < 6 || !shouldUpdateTemplateConfig()) {", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1492#discussion_r488894617", "createdAt": "2020-09-15T18:55:38Z", "author": {"login": "bilal-alsharifi"}, "path": "base/src/main/java/com/smartdevicelink/managers/screen/TextAndGraphicUpdateOperation.java", "diffHunk": "@@ -452,42 +501,59 @@ private Show setBlankTextFields(Show newShow) {\n         return newShow;\n     }\n \n+    Show assembleLayout(Show show) {\n+        if (!(internalInterface.get().getSdlMsgVersion().getMajorVersion() >= 6) || !shouldUpdateTemplateConfig()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9037faac9656f0b21685de1c1b4329b0d3b898e8"}, "originalPosition": 166}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODkwOTQ0NQ==", "bodyText": "I see that we keep doing that same check in mutiple places. I suggested adding a new private method and reuse it instead of compareing the version every time to make the code easier to read:\nprivate boolean showRPCSupportsTemplateConfiguration() {\n    if (internalInterface.get() == null || internalInterface.get().getSdlMsgVersion() == null) {\n        return false;\n    }\n    return internalInterface.get().getSdlMsgVersion().getMajorVersion() >= 6;\n}", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1492#discussion_r488909445", "createdAt": "2020-09-15T19:19:58Z", "author": {"login": "bilal-alsharifi"}, "path": "base/src/main/java/com/smartdevicelink/managers/screen/TextAndGraphicUpdateOperation.java", "diffHunk": "@@ -452,42 +501,59 @@ private Show setBlankTextFields(Show newShow) {\n         return newShow;\n     }\n \n+    Show assembleLayout(Show show) {\n+        if (!(internalInterface.get().getSdlMsgVersion().getMajorVersion() >= 6) || !shouldUpdateTemplateConfig()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg5NDYxNw=="}, "originalCommit": {"oid": "9037faac9656f0b21685de1c1b4329b0d3b898e8"}, "originalPosition": 166}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA1OTA1MTk5OnYy", "diffSide": "RIGHT", "path": "base/src/main/java/com/smartdevicelink/managers/screen/TextAndGraphicUpdateOperation.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxOToxMzoyMVrOHSQciA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxOToxMzoyMVrOHSQciA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODkwNTg2NA==", "bodyText": "Do we need to set TemplateConfiguration if the head unit doesn't support it? the head unit will ignore it but why send it if is not going to be used? I suggest adding a condition to only do newShow.setTemplateConfiguration it when the head unit supports it.", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1492#discussion_r488905864", "createdAt": "2020-09-15T19:13:21Z", "author": {"login": "bilal-alsharifi"}, "path": "base/src/main/java/com/smartdevicelink/managers/screen/TextAndGraphicUpdateOperation.java", "diffHunk": "@@ -437,7 +486,7 @@ Show extractTextFromShow(Show show) {\n         newShow.setTemplateTitle(show.getTemplateTitle());\n         newShow.setMetadataTags(show.getMetadataTags());\n         newShow.setAlignment(show.getAlignment());\n-\n+        newShow.setTemplateConfiguration(show.getTemplateConfiguration());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9037faac9656f0b21685de1c1b4329b0d3b898e8"}, "originalPosition": 157}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA1OTExMzQyOnYy", "diffSide": "RIGHT", "path": "base/src/main/java/com/smartdevicelink/managers/screen/TextAndGraphicUpdateOperation.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxOToyNzowOFrOHSRBkw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQyMToyNDoxMVrOHSVD_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODkxNTM0Nw==", "bodyText": "I think the listner should be called whether there is a sucess or not. Also a message should be printed on failure :\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            if(response.getSuccess()){\n          \n          \n            \n                                updateCurrentScreenDataFromSetDisplayLayout(setLayout);\n          \n          \n            \n                                listener.onComplete(true);\n          \n          \n            \n                            }\n          \n          \n            \n                            else {\n          \n          \n            \n                                currentScreenDataUpdateListener.onError();\n          \n          \n            \n                            }\n          \n          \n            \n                            if(response.getSuccess()){\n          \n          \n            \n                                updateCurrentScreenDataFromSetDisplayLayout(setLayout);\n          \n          \n            \n                            }\n          \n          \n            \n                            else {\n          \n          \n            \n                                DebugTool.logInfo(TAG, \"Text and Graphic SetDisplayLayout failed\");\n          \n          \n            \n                                currentScreenDataUpdateListener.onError();\n          \n          \n            \n                            }\n          \n          \n            \n                            listener.onComplete(response.getSuccess());", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1492#discussion_r488915347", "createdAt": "2020-09-15T19:27:08Z", "author": {"login": "bilal-alsharifi"}, "path": "base/src/main/java/com/smartdevicelink/managers/screen/TextAndGraphicUpdateOperation.java", "diffHunk": "@@ -122,6 +154,23 @@ public void onResponse(int correlationId, RPCResponse response) {\n         internalInterface.get().sendRPC(show);\n     }\n \n+    private void sendSetDisplayLayoutWithTemplateConfiguration(TemplateConfiguration configuration, final CompletionListener listener){\n+        setLayout = new SetDisplayLayout().setDisplayLayout(configuration.getTemplate()).setDayColorScheme(configuration.getDayColorScheme()).setNightColorScheme(configuration.getNightColorScheme());\n+        setLayout.setOnRPCResponseListener(new OnRPCResponseListener() {\n+            @Override\n+            public void onResponse(int correlationId, RPCResponse response) {\n+                if(response.getSuccess()){\n+                    updateCurrentScreenDataFromSetDisplayLayout(setLayout);\n+                    listener.onComplete(true);\n+                }\n+                else {\n+                    currentScreenDataUpdateListener.onError();\n+                }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9037faac9656f0b21685de1c1b4329b0d3b898e8"}, "originalPosition": 125}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODk4MTUwMQ==", "bodyText": "Your right that was an error.", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1492#discussion_r488981501", "createdAt": "2020-09-15T21:24:11Z", "author": {"login": "JulianKast"}, "path": "base/src/main/java/com/smartdevicelink/managers/screen/TextAndGraphicUpdateOperation.java", "diffHunk": "@@ -122,6 +154,23 @@ public void onResponse(int correlationId, RPCResponse response) {\n         internalInterface.get().sendRPC(show);\n     }\n \n+    private void sendSetDisplayLayoutWithTemplateConfiguration(TemplateConfiguration configuration, final CompletionListener listener){\n+        setLayout = new SetDisplayLayout().setDisplayLayout(configuration.getTemplate()).setDayColorScheme(configuration.getDayColorScheme()).setNightColorScheme(configuration.getNightColorScheme());\n+        setLayout.setOnRPCResponseListener(new OnRPCResponseListener() {\n+            @Override\n+            public void onResponse(int correlationId, RPCResponse response) {\n+                if(response.getSuccess()){\n+                    updateCurrentScreenDataFromSetDisplayLayout(setLayout);\n+                    listener.onComplete(true);\n+                }\n+                else {\n+                    currentScreenDataUpdateListener.onError();\n+                }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODkxNTM0Nw=="}, "originalCommit": {"oid": "9037faac9656f0b21685de1c1b4329b0d3b898e8"}, "originalPosition": 125}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA1OTEzMjA0OnYy", "diffSide": "RIGHT", "path": "base/src/main/java/com/smartdevicelink/managers/screen/TextAndGraphicUpdateOperation.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxOTozMDoxOVrOHSRMjA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxOTozMDoxOVrOHSRMjA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODkxODE1Ng==", "bodyText": "Can this var be local instead of global?", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1492#discussion_r488918156", "createdAt": "2020-09-15T19:30:19Z", "author": {"login": "bilal-alsharifi"}, "path": "base/src/main/java/com/smartdevicelink/managers/screen/TextAndGraphicUpdateOperation.java", "diffHunk": "@@ -32,13 +34,15 @@\n     private final WeakReference<ISdl> internalInterface;\n     private final WeakReference<FileManager> fileManager;\n     WindowCapability defaultMainWindowCapability;\n-    private Show currentScreenData;\n+    private TextsAndGraphicsState currentScreenData;\n     private final TextsAndGraphicsState updatedState;\n-    private final CompletionListener listener;\n     private final TextAndGraphicManager.CurrentScreenDataUpdatedListener currentScreenDataUpdateListener;\n+    private final CompletionListener listener;\n+    private Show fullShow;\n+    private SetDisplayLayout setLayout;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9037faac9656f0b21685de1c1b4329b0d3b898e8"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA1OTE3NjU0OnYy", "diffSide": "RIGHT", "path": "base/src/main/java/com/smartdevicelink/managers/screen/TextAndGraphicUpdateOperation.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxOTozODoxMlrOHSRn4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQyMToyNzoyMFrOHSVJtA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODkyNTE1NA==", "bodyText": "I am not sure why numberOfLines should be 4 if shouldUpdateTemplateConfig() is true?", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1492#discussion_r488925154", "createdAt": "2020-09-15T19:38:12Z", "author": {"login": "bilal-alsharifi"}, "path": "base/src/main/java/com/smartdevicelink/managers/screen/TextAndGraphicUpdateOperation.java", "diffHunk": "@@ -221,7 +270,7 @@ Show assembleShowText(Show show) {\n             return show;\n         }\n \n-        int numberOfLines = defaultMainWindowCapability != null ? ManagerUtility.WindowCapabilityUtility.getMaxNumberOfMainFieldLines(defaultMainWindowCapability) : 4;\n+        int numberOfLines = defaultMainWindowCapability == null || shouldUpdateTemplateConfig() ? 4 : ManagerUtility.WindowCapabilityUtility.getMaxNumberOfMainFieldLines(defaultMainWindowCapability);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9037faac9656f0b21685de1c1b4329b0d3b898e8"}, "originalPosition": 139}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODk4Mjk2NA==", "bodyText": "We are just sending everything if shouldUpdateTemplateConfig is true because we don't know the capabilities of the new template at this time, when the capabilities change in the TextAndGraphicsManager it will send another update and correct anything that could be wrong", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1492#discussion_r488982964", "createdAt": "2020-09-15T21:27:20Z", "author": {"login": "JulianKast"}, "path": "base/src/main/java/com/smartdevicelink/managers/screen/TextAndGraphicUpdateOperation.java", "diffHunk": "@@ -221,7 +270,7 @@ Show assembleShowText(Show show) {\n             return show;\n         }\n \n-        int numberOfLines = defaultMainWindowCapability != null ? ManagerUtility.WindowCapabilityUtility.getMaxNumberOfMainFieldLines(defaultMainWindowCapability) : 4;\n+        int numberOfLines = defaultMainWindowCapability == null || shouldUpdateTemplateConfig() ? 4 : ManagerUtility.WindowCapabilityUtility.getMaxNumberOfMainFieldLines(defaultMainWindowCapability);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODkyNTE1NA=="}, "originalCommit": {"oid": "9037faac9656f0b21685de1c1b4329b0d3b898e8"}, "originalPosition": 139}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA1OTE5ODYyOnYy", "diffSide": "RIGHT", "path": "base/src/main/java/com/smartdevicelink/managers/screen/TextAndGraphicUpdateOperation.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxOTo0MjoyMVrOHSR1tg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQyMjowMzo1OVrOHSW23Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODkyODY5NA==", "bodyText": "Why we are getting the values from updatedState instead of Show? as the method name is updateCurrentScreenDataFromShow", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1492#discussion_r488928694", "createdAt": "2020-09-15T19:42:21Z", "author": {"login": "bilal-alsharifi"}, "path": "base/src/main/java/com/smartdevicelink/managers/screen/TextAndGraphicUpdateOperation.java", "diffHunk": "@@ -452,42 +501,59 @@ private Show setBlankTextFields(Show newShow) {\n         return newShow;\n     }\n \n+    Show assembleLayout(Show show) {\n+        if (!(internalInterface.get().getSdlMsgVersion().getMajorVersion() >= 6) || !shouldUpdateTemplateConfig()) {\n+            return show;\n+        }\n+        show.setTemplateConfiguration(updatedState.getTemplateConfiguration());\n+        return show;\n+    }\n+\n+    private void updateCurrentScreenDataFromSetDisplayLayout(SetDisplayLayout setDisplayLayout) {\n+        currentScreenData.setTemplateConfiguration(new TemplateConfiguration().setTemplate(setDisplayLayout.getDisplayLayout()).setDayColorScheme(setDisplayLayout.getDayColorScheme()).setNightColorScheme(setDisplayLayout.getNightColorScheme()));\n+        if(currentScreenDataUpdateListener != null){\n+            currentScreenDataUpdateListener.onUpdate(currentScreenData);\n+        }\n+    }\n+\n     private void updateCurrentScreenDataFromShow(Show show) {\n         if (show == null) {\n             DebugTool.logError(TAG, \"can not updateCurrentScreenDataFromShow from null show\");\n             return;\n         }\n-\n-        // If the items are null, they were not updated, so we can't just set it directly\n         if (show.getMainField1() != null) {\n-            currentScreenData.setMainField1(show.getMainField1());\n+            currentScreenData.setTextField1(updatedState.getTextField1());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9037faac9656f0b21685de1c1b4329b0d3b898e8"}, "originalPosition": 189}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTAxMDkwOQ==", "bodyText": "we can not set an sdlArtWork object from a show, so if at this point the show has a value, it was updated on the screen, so we check the show, then transfer the value form the updateState to currentScreenData. We did this because in TextAndGraphicsManager if an update fails we want to reset the values to what is displaying on screen, so when a user does sdlManager.getTextField1, it's getting the value that's on screen.", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1492#discussion_r489010909", "createdAt": "2020-09-15T22:03:59Z", "author": {"login": "JulianKast"}, "path": "base/src/main/java/com/smartdevicelink/managers/screen/TextAndGraphicUpdateOperation.java", "diffHunk": "@@ -452,42 +501,59 @@ private Show setBlankTextFields(Show newShow) {\n         return newShow;\n     }\n \n+    Show assembleLayout(Show show) {\n+        if (!(internalInterface.get().getSdlMsgVersion().getMajorVersion() >= 6) || !shouldUpdateTemplateConfig()) {\n+            return show;\n+        }\n+        show.setTemplateConfiguration(updatedState.getTemplateConfiguration());\n+        return show;\n+    }\n+\n+    private void updateCurrentScreenDataFromSetDisplayLayout(SetDisplayLayout setDisplayLayout) {\n+        currentScreenData.setTemplateConfiguration(new TemplateConfiguration().setTemplate(setDisplayLayout.getDisplayLayout()).setDayColorScheme(setDisplayLayout.getDayColorScheme()).setNightColorScheme(setDisplayLayout.getNightColorScheme()));\n+        if(currentScreenDataUpdateListener != null){\n+            currentScreenDataUpdateListener.onUpdate(currentScreenData);\n+        }\n+    }\n+\n     private void updateCurrentScreenDataFromShow(Show show) {\n         if (show == null) {\n             DebugTool.logError(TAG, \"can not updateCurrentScreenDataFromShow from null show\");\n             return;\n         }\n-\n-        // If the items are null, they were not updated, so we can't just set it directly\n         if (show.getMainField1() != null) {\n-            currentScreenData.setMainField1(show.getMainField1());\n+            currentScreenData.setTextField1(updatedState.getTextField1());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODkyODY5NA=="}, "originalCommit": {"oid": "9037faac9656f0b21685de1c1b4329b0d3b898e8"}, "originalPosition": 189}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA1OTIxMTMyOnYy", "diffSide": "RIGHT", "path": "base/src/main/java/com/smartdevicelink/managers/screen/TextAndGraphicUpdateOperation.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxOTo0NTozOVrOHSR9ow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQyMjowNTowNlrOHSW6kA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODkzMDcyMw==", "bodyText": "I am not sure why we added shouldUpdateTemplateConfig() to shouldUpdatePrimaryImage() & shouldUpdateSecondaryImage() & shouldUpdateMediaTrackField() & shouldUpdateTitleField()", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1492#discussion_r488930723", "createdAt": "2020-09-15T19:45:39Z", "author": {"login": "bilal-alsharifi"}, "path": "base/src/main/java/com/smartdevicelink/managers/screen/TextAndGraphicUpdateOperation.java", "diffHunk": "@@ -555,8 +621,8 @@ private boolean sdlArtworkNeedsUpload(SdlArtwork artwork) {\n      * @return true if primaryGraphic should be updated, false if not\n      */\n     private boolean shouldUpdatePrimaryImage() {\n-        boolean templateSupportsPrimaryArtwork = templateSupportsImageField(ImageFieldName.graphic);\n-        String currentScreenDataPrimaryGraphicName = (currentScreenData != null && currentScreenData.getGraphic() != null) ? currentScreenData.getGraphic().getValue() : null;\n+        boolean templateSupportsPrimaryArtwork = templateSupportsImageField(ImageFieldName.graphic) || shouldUpdateTemplateConfig();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9037faac9656f0b21685de1c1b4329b0d3b898e8"}, "originalPosition": 240}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTAxMTg1Ng==", "bodyText": "We are just sending everything if shouldUpdateTemplateConfig is true because we don't know the capabilities of the new template at this time, when the capabilities change in the TextAndGraphicsManager it will send another update and correct anything that could be wrong", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1492#discussion_r489011856", "createdAt": "2020-09-15T22:05:06Z", "author": {"login": "JulianKast"}, "path": "base/src/main/java/com/smartdevicelink/managers/screen/TextAndGraphicUpdateOperation.java", "diffHunk": "@@ -555,8 +621,8 @@ private boolean sdlArtworkNeedsUpload(SdlArtwork artwork) {\n      * @return true if primaryGraphic should be updated, false if not\n      */\n     private boolean shouldUpdatePrimaryImage() {\n-        boolean templateSupportsPrimaryArtwork = templateSupportsImageField(ImageFieldName.graphic);\n-        String currentScreenDataPrimaryGraphicName = (currentScreenData != null && currentScreenData.getGraphic() != null) ? currentScreenData.getGraphic().getValue() : null;\n+        boolean templateSupportsPrimaryArtwork = templateSupportsImageField(ImageFieldName.graphic) || shouldUpdateTemplateConfig();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODkzMDcyMw=="}, "originalCommit": {"oid": "9037faac9656f0b21685de1c1b4329b0d3b898e8"}, "originalPosition": 240}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA1OTI2NDc0OnYy", "diffSide": "RIGHT", "path": "base/src/main/java/com/smartdevicelink/managers/screen/BaseScreenManager.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQyMDowMDoxOFrOHSSdjA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQyMjoxMDo1MFrOHSXM0A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODkzODg5Mg==", "bodyText": "While testing, I noticed that the listener doesn't get called if the developer is using the batching mode", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1492#discussion_r488938892", "createdAt": "2020-09-15T20:00:18Z", "author": {"login": "bilal-alsharifi"}, "path": "base/src/main/java/com/smartdevicelink/managers/screen/BaseScreenManager.java", "diffHunk": "@@ -377,6 +378,21 @@ public String getTitle(){\n \t\treturn this.textAndGraphicManager.getTitle();\n \t}\n \n+\t/**\n+\t * Change the current layout to a new layout and optionally update the layout's night and day color schemes. The values set for the text, graphics,\n+\t * buttons and template title persist between layout changes. To update the text, graphics, buttons and template title at the same time as the template,\n+\t * batch all the updates between `beginUpdates` and `endUpdates`. If the layout update fails while batching, then the updated text, graphics, buttons or template title will also not be updated.\n+\t *\n+\t * If you are connected on a < v6.0 connection and batching the update, the layout will be updated, then the text and graphics will be updated.\n+\t * If you are connected on a >= v6.0 connection, the layout will be updated at the same time that the text and graphics are updated.\n+\t *\n+\t * @param templateConfiguration The new configuration of the template, including the layout and color scheme.\n+\t * @param listener A listener that will be called when the layout change finished.\n+\t */\n+\tpublic void changeLayout(TemplateConfiguration templateConfiguration, CompletionListener listener) {\n+\t\ttextAndGraphicManager.changeLayout(templateConfiguration, listener);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9037faac9656f0b21685de1c1b4329b0d3b898e8"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTAxNjUyOA==", "bodyText": "we did this because if it's batched and that batched update gets overridden, it will return false for the changeLayout. This is keeping in line with how the TextAndGraphicsManager works with overriding updates.", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1492#discussion_r489016528", "createdAt": "2020-09-15T22:10:50Z", "author": {"login": "JulianKast"}, "path": "base/src/main/java/com/smartdevicelink/managers/screen/BaseScreenManager.java", "diffHunk": "@@ -377,6 +378,21 @@ public String getTitle(){\n \t\treturn this.textAndGraphicManager.getTitle();\n \t}\n \n+\t/**\n+\t * Change the current layout to a new layout and optionally update the layout's night and day color schemes. The values set for the text, graphics,\n+\t * buttons and template title persist between layout changes. To update the text, graphics, buttons and template title at the same time as the template,\n+\t * batch all the updates between `beginUpdates` and `endUpdates`. If the layout update fails while batching, then the updated text, graphics, buttons or template title will also not be updated.\n+\t *\n+\t * If you are connected on a < v6.0 connection and batching the update, the layout will be updated, then the text and graphics will be updated.\n+\t * If you are connected on a >= v6.0 connection, the layout will be updated at the same time that the text and graphics are updated.\n+\t *\n+\t * @param templateConfiguration The new configuration of the template, including the layout and color scheme.\n+\t * @param listener A listener that will be called when the layout change finished.\n+\t */\n+\tpublic void changeLayout(TemplateConfiguration templateConfiguration, CompletionListener listener) {\n+\t\ttextAndGraphicManager.changeLayout(templateConfiguration, listener);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODkzODg5Mg=="}, "originalCommit": {"oid": "9037faac9656f0b21685de1c1b4329b0d3b898e8"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA1OTI4NzE3OnYy", "diffSide": "RIGHT", "path": "base/src/main/java/com/smartdevicelink/managers/screen/BaseTextAndGraphicManager.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQyMDowNzoxN1rOHSSrZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQyMDowNzoxN1rOHSSrZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODk0MjQzNg==", "bodyText": "In my testing on Core 6+, I noticed that, if I change only colors and keep the template the same, the update fails with success = false.", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1492#discussion_r488942436", "createdAt": "2020-09-15T20:07:17Z", "author": {"login": "bilal-alsharifi"}, "path": "base/src/main/java/com/smartdevicelink/managers/screen/BaseTextAndGraphicManager.java", "diffHunk": "@@ -444,12 +472,30 @@ SdlArtwork getPrimaryGraphic() {\n \tvoid setSecondaryGraphic(SdlArtwork secondaryGraphic) {\n \t\tthis.secondaryGraphic = secondaryGraphic;\n \t\tif (!batchingUpdates) {\n-\t\t\tsdlUpdate(null);\n+\t\t\tsdlUpdate(true, null);\n \t\t} else {\n \t\t\tisDirty = true;\n \t\t}\n \t}\n \n+\tvoid changeLayout(TemplateConfiguration templateConfiguration, CompletionListener listener) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9037faac9656f0b21685de1c1b4329b0d3b898e8"}, "originalPosition": 268}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4293, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}