{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc2MjIxNjk4", "number": 1277, "reviewThreads": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxNTozMTowNVrODhHL9A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxNjoxOTo1NlrODh7zag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2MDQ3MzQ4OnYy", "diffSide": "RIGHT", "path": "base/src/main/java/com/smartdevicelink/proxy/SystemCapabilityManager.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxNTozMTowNlrOFrsXMA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQyMDoyNjoyNVrOFr2akw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTM1OTkyMA==", "bodyText": "It doesn't appear that you usually use tabs to align these param comments (e.g. above retrieveCapability()). I think this should be consistent. There really should be a project style guide where the correct style for this stuff can be noted.", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1277#discussion_r381359920", "createdAt": "2020-02-19T15:31:06Z", "author": {"login": "joeljfischer"}, "path": "base/src/main/java/com/smartdevicelink/proxy/SystemCapabilityManager.java", "diffHunk": "@@ -335,11 +335,11 @@ public void onReceived(RPCMessage message) {\n \t * Sets a capability in the cached map. This should only be done when an RPC is received and contains updates to the capability\n \t * that is being cached in the SystemCapabilityManager.\n \t * @param systemCapabilityType the system capability type that will be set\n-\t * @param capability the value of the capability that will be set\n+\t * @param capability           the value of the capability that will be set", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f6a10d835cb5253a9af1f8f54b21ee9a85a081fa"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTUyNDYyNw==", "bodyText": "Yes, you are right, we don't usually do that. I used Android Studio Reformatter tool to reformat this method. It looks like the tool adds spaces to align the params. I will remove that for consistency.", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1277#discussion_r381524627", "createdAt": "2020-02-19T20:26:25Z", "author": {"login": "bilal-alsharifi"}, "path": "base/src/main/java/com/smartdevicelink/proxy/SystemCapabilityManager.java", "diffHunk": "@@ -335,11 +335,11 @@ public void onReceived(RPCMessage message) {\n \t * Sets a capability in the cached map. This should only be done when an RPC is received and contains updates to the capability\n \t * that is being cached in the SystemCapabilityManager.\n \t * @param systemCapabilityType the system capability type that will be set\n-\t * @param capability the value of the capability that will be set\n+\t * @param capability           the value of the capability that will be set", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTM1OTkyMA=="}, "originalCommit": {"oid": "f6a10d835cb5253a9af1f8f54b21ee9a85a081fa"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2MDQ3NDQ5OnYy", "diffSide": "RIGHT", "path": "base/src/main/java/com/smartdevicelink/proxy/SystemCapabilityManager.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxNTozNjoyOFrOFrsX6Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxNTozNjoyOFrOFrsX6Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTM2MDEwNQ==", "bodyText": "I think that currently iOS always calls with a cached value even if the value is null. This may be a point to be aligned.", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1277#discussion_r381360105", "createdAt": "2020-02-19T15:36:28Z", "author": {"login": "joeljfischer"}, "path": "base/src/main/java/com/smartdevicelink/proxy/SystemCapabilityManager.java", "diffHunk": "@@ -450,16 +450,17 @@ private boolean isSubscribedToSystemCapability(SystemCapabilityType systemCapabi\n \t */\n \tprivate Object getCapabilityPrivate(final SystemCapabilityType systemCapabilityType, final OnSystemCapabilityListener scListener, final Boolean subscribe, final boolean forceUpdate) {\n \t\tObject cachedCapability = cachedSystemCapabilities.get(systemCapabilityType);\n-\t\tOnSystemCapabilityListener listener = scListener;\n \n-\t\tif (!forceUpdate && cachedCapability != null && listener != null) {\n-\t\t\tlistener.onCapabilityRetrieved(cachedCapability);\n-\t\t\tlistener = null;\n+\t\tboolean shouldUpdateSystemCapabilitySubscription = (subscribe != null) && (subscribe != isSubscribedToSystemCapability(systemCapabilityType)) && supportsSubscriptions();\n+\t\tboolean shouldSendGetCapabilityRequest = forceUpdate || (cachedCapability == null) || shouldUpdateSystemCapabilitySubscription;\n+\t\tboolean shouldCallListenerWithCachedValue = (cachedCapability != null) && (scListener != null) && !shouldSendGetCapabilityRequest;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f6a10d835cb5253a9af1f8f54b21ee9a85a081fa"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2MDUyNTk1OnYy", "diffSide": "RIGHT", "path": "base/src/main/java/com/smartdevicelink/proxy/SystemCapabilityManager.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxNTo1OTozNlrOFrs4uQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQxNjozODo1NFrOFsat9g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTM2ODUwNQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\t\t\t// If the listener is not included in the onSystemCapabilityListeners map, then notify it\n          \n          \n            \n            \t\t\t\t\t// If the listener is not included in the onSystemCapabilityListeners map (if it's used from getSystemCapability with a force update), then notify it", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1277#discussion_r381368505", "createdAt": "2020-02-19T15:59:36Z", "author": {"login": "joeljfischer"}, "path": "base/src/main/java/com/smartdevicelink/proxy/SystemCapabilityManager.java", "diffHunk": "@@ -549,18 +550,27 @@ private void retrieveCapability(final SystemCapabilityType systemCapabilityType,\n \t\t}\n \t\tfinal GetSystemCapability request = new GetSystemCapability();\n \t\trequest.setSystemCapabilityType(systemCapabilityType);\n-\t\trequest.setSubscribe((subscribe != null) ? subscribe : isSubscribedToSystemCapability(systemCapabilityType)); // If subscribe is null, then don't change the current subscription status\n+\t\t// If subscribe is null, then don't change the current subscription status\n+\t\tfinal boolean shouldSubscribe = ((subscribe != null) ? subscribe : isSubscribedToSystemCapability(systemCapabilityType)) && supportsSubscriptions();\n+\t\trequest.setSubscribe(shouldSubscribe);\n \t\trequest.setOnRPCResponseListener(new OnRPCResponseListener() {\n \t\t\t@Override\n \t\t\tpublic void onResponse(int correlationId, RPCResponse response) {\n \t\t\t\tif (response.getSuccess()) {\n \t\t\t\t\tObject retrievedCapability = ((GetSystemCapabilityResponse) response).getSystemCapability().getCapabilityForType(systemCapabilityType);\n-\t\t\t\t\tcachedSystemCapabilities.put(systemCapabilityType, retrievedCapability);\n+\t\t\t\t\tsetCapability(systemCapabilityType, retrievedCapability);\n+\t\t\t\t\t// If the listener is not included in the onSystemCapabilityListeners map, then notify it", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f6a10d835cb5253a9af1f8f54b21ee9a85a081fa"}, "originalPosition": 71}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjExOTQxNA==", "bodyText": "Forcing an update is not the only case that triggers this logic. If forceUpdate=false, and the cap is not cashed, when we call GetCapablity(), this logic will be triggered. But you are right the comment is a little vague. I will update the comment.", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1277#discussion_r382119414", "createdAt": "2020-02-20T16:38:54Z", "author": {"login": "bilal-alsharifi"}, "path": "base/src/main/java/com/smartdevicelink/proxy/SystemCapabilityManager.java", "diffHunk": "@@ -549,18 +550,27 @@ private void retrieveCapability(final SystemCapabilityType systemCapabilityType,\n \t\t}\n \t\tfinal GetSystemCapability request = new GetSystemCapability();\n \t\trequest.setSystemCapabilityType(systemCapabilityType);\n-\t\trequest.setSubscribe((subscribe != null) ? subscribe : isSubscribedToSystemCapability(systemCapabilityType)); // If subscribe is null, then don't change the current subscription status\n+\t\t// If subscribe is null, then don't change the current subscription status\n+\t\tfinal boolean shouldSubscribe = ((subscribe != null) ? subscribe : isSubscribedToSystemCapability(systemCapabilityType)) && supportsSubscriptions();\n+\t\trequest.setSubscribe(shouldSubscribe);\n \t\trequest.setOnRPCResponseListener(new OnRPCResponseListener() {\n \t\t\t@Override\n \t\t\tpublic void onResponse(int correlationId, RPCResponse response) {\n \t\t\t\tif (response.getSuccess()) {\n \t\t\t\t\tObject retrievedCapability = ((GetSystemCapabilityResponse) response).getSystemCapability().getCapabilityForType(systemCapabilityType);\n-\t\t\t\t\tcachedSystemCapabilities.put(systemCapabilityType, retrievedCapability);\n+\t\t\t\t\tsetCapability(systemCapabilityType, retrievedCapability);\n+\t\t\t\t\t// If the listener is not included in the onSystemCapabilityListeners map, then notify it", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTM2ODUwNQ=="}, "originalCommit": {"oid": "f6a10d835cb5253a9af1f8f54b21ee9a85a081fa"}, "originalPosition": 71}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2MDUzNjE2OnYy", "diffSide": "RIGHT", "path": "base/src/main/java/com/smartdevicelink/proxy/SystemCapabilityManager.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxNjowMTo0NlrOFrs_CA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxNjowMTo0NlrOFrs_CA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTM3MDEyMA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\t\t\t\t\tboolean listenerAlreadyNotified = notifiedListeners != null && notifiedListeners.contains(scListener);\n          \n          \n            \n            \t\t\t\t\t\t\tboolean listenerAlreadyNotified = (notifiedListeners != null) && notifiedListeners.contains(scListener);", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1277#discussion_r381370120", "createdAt": "2020-02-19T16:01:46Z", "author": {"login": "joeljfischer"}, "path": "base/src/main/java/com/smartdevicelink/proxy/SystemCapabilityManager.java", "diffHunk": "@@ -549,18 +550,27 @@ private void retrieveCapability(final SystemCapabilityType systemCapabilityType,\n \t\t}\n \t\tfinal GetSystemCapability request = new GetSystemCapability();\n \t\trequest.setSystemCapabilityType(systemCapabilityType);\n-\t\trequest.setSubscribe((subscribe != null) ? subscribe : isSubscribedToSystemCapability(systemCapabilityType)); // If subscribe is null, then don't change the current subscription status\n+\t\t// If subscribe is null, then don't change the current subscription status\n+\t\tfinal boolean shouldSubscribe = ((subscribe != null) ? subscribe : isSubscribedToSystemCapability(systemCapabilityType)) && supportsSubscriptions();\n+\t\trequest.setSubscribe(shouldSubscribe);\n \t\trequest.setOnRPCResponseListener(new OnRPCResponseListener() {\n \t\t\t@Override\n \t\t\tpublic void onResponse(int correlationId, RPCResponse response) {\n \t\t\t\tif (response.getSuccess()) {\n \t\t\t\t\tObject retrievedCapability = ((GetSystemCapabilityResponse) response).getSystemCapability().getCapabilityForType(systemCapabilityType);\n-\t\t\t\t\tcachedSystemCapabilities.put(systemCapabilityType, retrievedCapability);\n+\t\t\t\t\tsetCapability(systemCapabilityType, retrievedCapability);\n+\t\t\t\t\t// If the listener is not included in the onSystemCapabilityListeners map, then notify it\n \t\t\t\t\tif (scListener != null) {\n-\t\t\t\t\t\tscListener.onCapabilityRetrieved(retrievedCapability);\n+\t\t\t\t\t\tsynchronized (LISTENER_LOCK) {\n+\t\t\t\t\t\t\tCopyOnWriteArrayList<OnSystemCapabilityListener> notifiedListeners = onSystemCapabilityListeners.get(systemCapabilityType);\n+\t\t\t\t\t\t\tboolean listenerAlreadyNotified = notifiedListeners != null && notifiedListeners.contains(scListener);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f6a10d835cb5253a9af1f8f54b21ee9a85a081fa"}, "originalPosition": 76}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2MDYwNzE1OnYy", "diffSide": "RIGHT", "path": "android/sdl_android/src/androidTest/java/com/smartdevicelink/test/proxy/SystemCapabilityManagerTests.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxNjoxNzowMFrOFrtqqA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQyMTo1MzoyMVrOFr5AXg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTM4MTI4OA==", "bodyText": "Based on the change to retrieveCapability() I believe this should not send subscribe=true, right?\nfinal boolean shouldSubscribe = ((subscribe != null) ? subscribe : isSubscribedToSystemCapability(systemCapabilityType)) && supportsSubscriptions();\nrequest.setSubscribe(shouldSubscribe);", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1277#discussion_r381381288", "createdAt": "2020-02-19T16:17:00Z", "author": {"login": "joeljfischer"}, "path": "android/sdl_android/src/androidTest/java/com/smartdevicelink/test/proxy/SystemCapabilityManagerTests.java", "diffHunk": "@@ -490,6 +490,94 @@ public void testAddOnSystemCapabilityListenerWithSubscriptionsNotSupportedAndCap\n \t\tverify(internalInterface, times(1)).sendRPC(any(GetSystemCapability.class));\n \t}\n \n+\tpublic void testAddOnSystemCapabilityListenerThenGetCapability() {\n+\t\tSdlMsgVersion sdlMsgVersion = new SdlMsgVersion(5, 0); // This version doesn't support capability subscriptions\n+\t\tsdlMsgVersion.setPatchVersion(0);\n+\t\tISdl internalInterface = mock(ISdl.class);\n+\t\twhen(internalInterface.getSdlMsgVersion()).thenReturn(sdlMsgVersion);\n+\t\tSystemCapabilityManager scm = new SystemCapabilityManager(internalInterface);\n+\t\tscm.setCapability(SystemCapabilityType.VIDEO_STREAMING, videoStreamingCapability);\n+\n+\n+\t\t// Add listener1\n+\t\t// When the first listener is added, GetSystemCapability request should go out with subscribe=true", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f6a10d835cb5253a9af1f8f54b21ee9a85a081fa"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTU2NzA3MA==", "bodyText": "Ah, you are right, the test actually asserts that subscribe=false as you mentioned. The comment is wrong. I will update it.", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1277#discussion_r381567070", "createdAt": "2020-02-19T21:53:21Z", "author": {"login": "bilal-alsharifi"}, "path": "android/sdl_android/src/androidTest/java/com/smartdevicelink/test/proxy/SystemCapabilityManagerTests.java", "diffHunk": "@@ -490,6 +490,94 @@ public void testAddOnSystemCapabilityListenerWithSubscriptionsNotSupportedAndCap\n \t\tverify(internalInterface, times(1)).sendRPC(any(GetSystemCapability.class));\n \t}\n \n+\tpublic void testAddOnSystemCapabilityListenerThenGetCapability() {\n+\t\tSdlMsgVersion sdlMsgVersion = new SdlMsgVersion(5, 0); // This version doesn't support capability subscriptions\n+\t\tsdlMsgVersion.setPatchVersion(0);\n+\t\tISdl internalInterface = mock(ISdl.class);\n+\t\twhen(internalInterface.getSdlMsgVersion()).thenReturn(sdlMsgVersion);\n+\t\tSystemCapabilityManager scm = new SystemCapabilityManager(internalInterface);\n+\t\tscm.setCapability(SystemCapabilityType.VIDEO_STREAMING, videoStreamingCapability);\n+\n+\n+\t\t// Add listener1\n+\t\t// When the first listener is added, GetSystemCapability request should go out with subscribe=true", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTM4MTI4OA=="}, "originalCommit": {"oid": "f6a10d835cb5253a9af1f8f54b21ee9a85a081fa"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2MDY0NDkxOnYy", "diffSide": "RIGHT", "path": "base/src/main/java/com/smartdevicelink/proxy/SystemCapabilityManager.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxNjoyNToyMlrOFruB0A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxNjoyNToyMlrOFruB0A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTM4NzIxNg==", "bodyText": "Currently, iOS calls the listener with a cached value of nil. This may be a point of alignment needed.\nWhy does it not call with the cached value if we are sending a GetCapability request? Should the && before !shouldSendGetCapabilityRequest be an ||?", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1277#discussion_r381387216", "createdAt": "2020-02-19T16:25:22Z", "author": {"login": "joeljfischer"}, "path": "base/src/main/java/com/smartdevicelink/proxy/SystemCapabilityManager.java", "diffHunk": "@@ -450,16 +450,17 @@ private boolean isSubscribedToSystemCapability(SystemCapabilityType systemCapabi\n \t */\n \tprivate Object getCapabilityPrivate(final SystemCapabilityType systemCapabilityType, final OnSystemCapabilityListener scListener, final Boolean subscribe, final boolean forceUpdate) {\n \t\tObject cachedCapability = cachedSystemCapabilities.get(systemCapabilityType);\n-\t\tOnSystemCapabilityListener listener = scListener;\n \n-\t\tif (!forceUpdate && cachedCapability != null && listener != null) {\n-\t\t\tlistener.onCapabilityRetrieved(cachedCapability);\n-\t\t\tlistener = null;\n+\t\tboolean shouldUpdateSystemCapabilitySubscription = (subscribe != null) && (subscribe != isSubscribedToSystemCapability(systemCapabilityType)) && supportsSubscriptions();\n+\t\tboolean shouldSendGetCapabilityRequest = forceUpdate || (cachedCapability == null) || shouldUpdateSystemCapabilitySubscription;\n+\t\tboolean shouldCallListenerWithCachedValue = (cachedCapability != null) && (scListener != null) && !shouldSendGetCapabilityRequest;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f6a10d835cb5253a9af1f8f54b21ee9a85a081fa"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2MDY2NjQ5OnYy", "diffSide": "RIGHT", "path": "base/src/main/java/com/smartdevicelink/proxy/SystemCapabilityManager.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxNjozMDoxNVrOFruPIg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxNjozMDoxNVrOFruPIg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTM5MDYyNg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\tfinal boolean shouldSubscribe = ((subscribe != null) ? subscribe : isSubscribedToSystemCapability(systemCapabilityType)) && supportsSubscriptions();\n          \n          \n            \n            \t\tfinal boolean shouldSubscribe = ((subscribe != null) ? subscribe : (isSubscribedToSystemCapability(systemCapabilityType)) && supportsSubscriptions());\n          \n      \n    \n    \n  \n\nI think the name of this is a bit misleading, because if it's false, it shouldUnsubscribe(). I almost think you need an enum with values subscribe, unsubscribe, and keepCurrentState. Or at least the documentation needs to be improved here.\nI also need clarification on a point here. If subscribe is false and we are currently subscribed, and we support subscriptions, then shouldSubscribe will be true, right? And that's the opposite of what we want, since we want to unsubscribe?", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1277#discussion_r381390626", "createdAt": "2020-02-19T16:30:15Z", "author": {"login": "joeljfischer"}, "path": "base/src/main/java/com/smartdevicelink/proxy/SystemCapabilityManager.java", "diffHunk": "@@ -549,18 +550,27 @@ private void retrieveCapability(final SystemCapabilityType systemCapabilityType,\n \t\t}\n \t\tfinal GetSystemCapability request = new GetSystemCapability();\n \t\trequest.setSystemCapabilityType(systemCapabilityType);\n-\t\trequest.setSubscribe((subscribe != null) ? subscribe : isSubscribedToSystemCapability(systemCapabilityType)); // If subscribe is null, then don't change the current subscription status\n+\t\t// If subscribe is null, then don't change the current subscription status\n+\t\tfinal boolean shouldSubscribe = ((subscribe != null) ? subscribe : isSubscribedToSystemCapability(systemCapabilityType)) && supportsSubscriptions();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f6a10d835cb5253a9af1f8f54b21ee9a85a081fa"}, "originalPosition": 62}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2ODY2MTQ1OnYy", "diffSide": "RIGHT", "path": "base/src/main/java/com/smartdevicelink/proxy/SystemCapabilityManager.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxNDoyMDo1NFrOFs4ZnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxNzoyMDoxNFrOFs-hLw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjYwNTcyNQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t- if subscribe is true and the HU supports subscriptions, then shouldSubscribe = true\n          \n          \n            \n            \t\t- if subscribe is true, then shouldSubscribe = true\n          \n      \n    \n    \n  \n\nThis doesn't appear to be true, it's if subscribe == true, then shouldSubscribe = true.", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1277#discussion_r382605725", "createdAt": "2020-02-21T14:20:54Z", "author": {"login": "joeljfischer"}, "path": "base/src/main/java/com/smartdevicelink/proxy/SystemCapabilityManager.java", "diffHunk": "@@ -550,7 +551,13 @@ private void retrieveCapability(final SystemCapabilityType systemCapabilityType,\n \t\t}\n \t\tfinal GetSystemCapability request = new GetSystemCapability();\n \t\trequest.setSystemCapabilityType(systemCapabilityType);\n-\t\t// If subscribe is null, then don't change the current subscription status\n+\n+\t\t/*\n+\t\tThe subscription flag in the request should be set based on multiple variables:\n+\t\t- if subscribe is null (no change), shouldSubscribe = current subscription status\n+\t\t- if subscribe is false, then shouldSubscribe = false\n+\t\t- if subscribe is true and the HU supports subscriptions, then shouldSubscribe = true", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "11189a63e71bddae0d7fea388b0e98db47e5ec2d"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjY4NTM5Mw==", "bodyText": "But if the HU doesn't support subscriptions, shouldSubscribe will be false right? even if subscribe = true? because we are doing && supportsSubscriptions()", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1277#discussion_r382685393", "createdAt": "2020-02-21T16:40:20Z", "author": {"login": "bilal-alsharifi"}, "path": "base/src/main/java/com/smartdevicelink/proxy/SystemCapabilityManager.java", "diffHunk": "@@ -550,7 +551,13 @@ private void retrieveCapability(final SystemCapabilityType systemCapabilityType,\n \t\t}\n \t\tfinal GetSystemCapability request = new GetSystemCapability();\n \t\trequest.setSystemCapabilityType(systemCapabilityType);\n-\t\t// If subscribe is null, then don't change the current subscription status\n+\n+\t\t/*\n+\t\tThe subscription flag in the request should be set based on multiple variables:\n+\t\t- if subscribe is null (no change), shouldSubscribe = current subscription status\n+\t\t- if subscribe is false, then shouldSubscribe = false\n+\t\t- if subscribe is true and the HU supports subscriptions, then shouldSubscribe = true", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjYwNTcyNQ=="}, "originalCommit": {"oid": "11189a63e71bddae0d7fea388b0e98db47e5ec2d"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjY4OTIwNQ==", "bodyText": "Based on the current code, I don't think that's true.\nif (subscribe != null) {\n    return subscribe;\n} else {\n    return isSubscribedToSystemCapability(systemCapabilityType)) && supportsSubscriptions();\n}\nSo if subscribe == true, then it will always return true.", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1277#discussion_r382689205", "createdAt": "2020-02-21T16:47:09Z", "author": {"login": "joeljfischer"}, "path": "base/src/main/java/com/smartdevicelink/proxy/SystemCapabilityManager.java", "diffHunk": "@@ -550,7 +551,13 @@ private void retrieveCapability(final SystemCapabilityType systemCapabilityType,\n \t\t}\n \t\tfinal GetSystemCapability request = new GetSystemCapability();\n \t\trequest.setSystemCapabilityType(systemCapabilityType);\n-\t\t// If subscribe is null, then don't change the current subscription status\n+\n+\t\t/*\n+\t\tThe subscription flag in the request should be set based on multiple variables:\n+\t\t- if subscribe is null (no change), shouldSubscribe = current subscription status\n+\t\t- if subscribe is false, then shouldSubscribe = false\n+\t\t- if subscribe is true and the HU supports subscriptions, then shouldSubscribe = true", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjYwNTcyNQ=="}, "originalCommit": {"oid": "11189a63e71bddae0d7fea388b0e98db47e5ec2d"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjcwNTk2Nw==", "bodyText": "It is actually confusing. I will simplify the condition a bit.", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1277#discussion_r382705967", "createdAt": "2020-02-21T17:20:14Z", "author": {"login": "bilal-alsharifi"}, "path": "base/src/main/java/com/smartdevicelink/proxy/SystemCapabilityManager.java", "diffHunk": "@@ -550,7 +551,13 @@ private void retrieveCapability(final SystemCapabilityType systemCapabilityType,\n \t\t}\n \t\tfinal GetSystemCapability request = new GetSystemCapability();\n \t\trequest.setSystemCapabilityType(systemCapabilityType);\n-\t\t// If subscribe is null, then don't change the current subscription status\n+\n+\t\t/*\n+\t\tThe subscription flag in the request should be set based on multiple variables:\n+\t\t- if subscribe is null (no change), shouldSubscribe = current subscription status\n+\t\t- if subscribe is false, then shouldSubscribe = false\n+\t\t- if subscribe is true and the HU supports subscriptions, then shouldSubscribe = true", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjYwNTcyNQ=="}, "originalCommit": {"oid": "11189a63e71bddae0d7fea388b0e98db47e5ec2d"}, "originalPosition": 45}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2ODY2MjgwOnYy", "diffSide": "RIGHT", "path": "base/src/main/java/com/smartdevicelink/proxy/SystemCapabilityManager.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxNDoyMToyMVrOFs4aeg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxNDoyMToyMVrOFs4aeg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjYwNTk0Ng==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t- if subscribe is null (no change), shouldSubscribe = current subscription status\n          \n          \n            \n            \t\t- if subscribe is null (no change), shouldSubscribe = current subscription status, or false if the HU does not support subscriptions", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1277#discussion_r382605946", "createdAt": "2020-02-21T14:21:21Z", "author": {"login": "joeljfischer"}, "path": "base/src/main/java/com/smartdevicelink/proxy/SystemCapabilityManager.java", "diffHunk": "@@ -550,7 +551,13 @@ private void retrieveCapability(final SystemCapabilityType systemCapabilityType,\n \t\t}\n \t\tfinal GetSystemCapability request = new GetSystemCapability();\n \t\trequest.setSystemCapabilityType(systemCapabilityType);\n-\t\t// If subscribe is null, then don't change the current subscription status\n+\n+\t\t/*\n+\t\tThe subscription flag in the request should be set based on multiple variables:\n+\t\t- if subscribe is null (no change), shouldSubscribe = current subscription status", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "11189a63e71bddae0d7fea388b0e98db47e5ec2d"}, "originalPosition": 43}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2OTA5NDE4OnYy", "diffSide": "RIGHT", "path": "android/sdl_android/src/androidTest/java/com/smartdevicelink/test/proxy/SystemCapabilityManagerTests.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxNjoxOTo1NlrOFs8kYA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxNjozNTowOVrOFs9F9A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjY3NDAxNg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \tpublic void testAddOnSystemCapabilityListenerThenGetCapability() {\n          \n          \n            \n            \tpublic void testAddOnSystemCapabilityListenerThenGetCapabilityWhenSubscriptionsAreNotSupported() {\n          \n      \n    \n    \n  \n\nYou may also want to consider underscores to define conditions, like:\ntestAddOnSystemCapabilityListener_thenGetCapability_whenSubscriptionsAreNotSupported()", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1277#discussion_r382674016", "createdAt": "2020-02-21T16:19:56Z", "author": {"login": "joeljfischer"}, "path": "android/sdl_android/src/androidTest/java/com/smartdevicelink/test/proxy/SystemCapabilityManagerTests.java", "diffHunk": "@@ -490,6 +490,129 @@ public void testAddOnSystemCapabilityListenerWithSubscriptionsNotSupportedAndCap\n \t\tverify(internalInterface, times(1)).sendRPC(any(GetSystemCapability.class));\n \t}\n \n+\tpublic void testAddOnSystemCapabilityListenerThenGetCapability() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "11189a63e71bddae0d7fea388b0e98db47e5ec2d"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjY4MjYxMg==", "bodyText": "The use of underscores in java is not very common. Except for naming const variables. I prefer the first suggested name as it complies more with Java naming conventions.", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1277#discussion_r382682612", "createdAt": "2020-02-21T16:35:09Z", "author": {"login": "bilal-alsharifi"}, "path": "android/sdl_android/src/androidTest/java/com/smartdevicelink/test/proxy/SystemCapabilityManagerTests.java", "diffHunk": "@@ -490,6 +490,129 @@ public void testAddOnSystemCapabilityListenerWithSubscriptionsNotSupportedAndCap\n \t\tverify(internalInterface, times(1)).sendRPC(any(GetSystemCapability.class));\n \t}\n \n+\tpublic void testAddOnSystemCapabilityListenerThenGetCapability() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjY3NDAxNg=="}, "originalCommit": {"oid": "11189a63e71bddae0d7fea388b0e98db47e5ec2d"}, "originalPosition": 13}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4345, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}