{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMzNTE4MTM3", "number": 1576, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wN1QxOTo0MTo0MlrOFMRFWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yN1QxODo0Mjo1MVrOFTuLEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ4NDA3MTI5OnYy", "diffSide": "RIGHT", "path": "base/src/main/java/com/smartdevicelink/streaming/video/VideoStreamingParameters.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wN1QxOTo0MTo0MlrOIP5wQw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wOFQwMjoyMDoxNVrOIQDWkg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzU0NTc5NQ==", "bodyText": "Hello @shiniwat, This would be a breaking change, please deprecate the old constructor and assign this.stableFrameRate = true and then create the new constructor with stableFrameRate as a parameter", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1576#discussion_r553545795", "createdAt": "2021-01-07T19:41:42Z", "author": {"login": "RHenigan"}, "path": "base/src/main/java/com/smartdevicelink/streaming/video/VideoStreamingParameters.java", "diffHunk": "@@ -78,16 +79,28 @@ public VideoStreamingParameters() {\n         format = new VideoStreamingFormat();\n         format.setProtocol(DEFAULT_PROTOCOL);\n         format.setCodec(DEFAULT_CODEC);\n+        stableFrameRate = true;\n     }\n \n+    /**\n+     * new constructor of VideoStreamingParameters, which now has stableFrameRate param.\n+     * @param displayDensity\n+     * @param frameRate\n+     * @param bitrate\n+     * @param interval\n+     * @param resolution\n+     * @param format\n+     * @param stableFrameRate\n+     */\n     public VideoStreamingParameters(int displayDensity, int frameRate, int bitrate, int interval,\n-                                    ImageResolution resolution, VideoStreamingFormat format) {\n-        this.displayDensity = displayDensity;\n-        this.frameRate = frameRate;\n-        this.bitrate = bitrate;\n-        this.interval = interval;\n-        this.resolution = resolution;\n-        this.format = format;\n+                                    ImageResolution resolution, VideoStreamingFormat format, boolean stableFrameRate){\n+\t    this.displayDensity = displayDensity;\n+\t    this.frameRate = frameRate;\n+\t    this.bitrate = bitrate;\n+\t    this.interval = interval;\n+\t    this.resolution = resolution;\n+\t    this.format = format;\n+\t    this.stableFrameRate = stableFrameRate;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1e2b92302aaeca638c61ed66ce1b6c36639086d5"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzcwMzA1OA==", "bodyText": "Thanks for the review. The ctor has been updated as you suggested.", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1576#discussion_r553703058", "createdAt": "2021-01-08T02:20:15Z", "author": {"login": "shiniwat"}, "path": "base/src/main/java/com/smartdevicelink/streaming/video/VideoStreamingParameters.java", "diffHunk": "@@ -78,16 +79,28 @@ public VideoStreamingParameters() {\n         format = new VideoStreamingFormat();\n         format.setProtocol(DEFAULT_PROTOCOL);\n         format.setCodec(DEFAULT_CODEC);\n+        stableFrameRate = true;\n     }\n \n+    /**\n+     * new constructor of VideoStreamingParameters, which now has stableFrameRate param.\n+     * @param displayDensity\n+     * @param frameRate\n+     * @param bitrate\n+     * @param interval\n+     * @param resolution\n+     * @param format\n+     * @param stableFrameRate\n+     */\n     public VideoStreamingParameters(int displayDensity, int frameRate, int bitrate, int interval,\n-                                    ImageResolution resolution, VideoStreamingFormat format) {\n-        this.displayDensity = displayDensity;\n-        this.frameRate = frameRate;\n-        this.bitrate = bitrate;\n-        this.interval = interval;\n-        this.resolution = resolution;\n-        this.format = format;\n+                                    ImageResolution resolution, VideoStreamingFormat format, boolean stableFrameRate){\n+\t    this.displayDensity = displayDensity;\n+\t    this.frameRate = frameRate;\n+\t    this.bitrate = bitrate;\n+\t    this.interval = interval;\n+\t    this.resolution = resolution;\n+\t    this.format = format;\n+\t    this.stableFrameRate = stableFrameRate;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzU0NTc5NQ=="}, "originalCommit": {"oid": "1e2b92302aaeca638c61ed66ce1b6c36639086d5"}, "originalPosition": 40}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzU0NDAyMjI2OnYy", "diffSide": "LEFT", "path": "android/sdl_android/src/main/java/com/smartdevicelink/encoder/VirtualDisplayEncoder.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yMlQxNzoyMTo1NVrOIYtoqQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yNVQwMDoxMTowMFrOIZTpvw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2Mjc4NDQyNQ==", "bodyText": "Hello @shiniwat, even though this method is currently unused I believe it should be kept because it will replace the deprecated method above it when that method is eventually removed.", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1576#discussion_r562784425", "createdAt": "2021-01-22T17:21:55Z", "author": {"login": "RHenigan"}, "path": "android/sdl_android/src/main/java/com/smartdevicelink/encoder/VirtualDisplayEncoder.java", "diffHunk": "@@ -130,11 +130,6 @@ public void setStreamingParams(int displayDensity, ImageResolution resolution, i\n         this.streamingParams = new VideoStreamingParameters(displayDensity, frameRate, bitrate, interval, resolution, format);\n     }\n \n-    @SuppressWarnings(\"unused\")\n-    public void setStreamingParams(int displayDensity, ImageResolution resolution, int frameRate, int bitrate, int interval, VideoStreamingFormat format, boolean stableFrameRate) {\n-        this.streamingParams = new VideoStreamingParameters(displayDensity, frameRate, bitrate, interval, resolution, format, stableFrameRate);\n-    }\n-", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d37b8e546d50f9a07248b7f041f9bc8d9411a8c0"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MzQwNzI5NQ==", "bodyText": "Understood. I have restored setStreamingPrams back accordingly.", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1576#discussion_r563407295", "createdAt": "2021-01-25T00:11:00Z", "author": {"login": "shiniwat"}, "path": "android/sdl_android/src/main/java/com/smartdevicelink/encoder/VirtualDisplayEncoder.java", "diffHunk": "@@ -130,11 +130,6 @@ public void setStreamingParams(int displayDensity, ImageResolution resolution, i\n         this.streamingParams = new VideoStreamingParameters(displayDensity, frameRate, bitrate, interval, resolution, format);\n     }\n \n-    @SuppressWarnings(\"unused\")\n-    public void setStreamingParams(int displayDensity, ImageResolution resolution, int frameRate, int bitrate, int interval, VideoStreamingFormat format, boolean stableFrameRate) {\n-        this.streamingParams = new VideoStreamingParameters(displayDensity, frameRate, bitrate, interval, resolution, format, stableFrameRate);\n-    }\n-", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2Mjc4NDQyNQ=="}, "originalCommit": {"oid": "d37b8e546d50f9a07248b7f041f9bc8d9411a8c0"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzU0NDA0MDMwOnYy", "diffSide": "RIGHT", "path": "base/src/main/java/com/smartdevicelink/streaming/video/VideoStreamingParameters.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yMlQxNzoyNjoyOFrOIYtzwg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yNVQwMDoxMjo0OVrOIZTqew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2Mjc4NzI2Ng==", "bodyText": "Hello @shiniwat, I thank you for deprecating the old constructor but I eblieve we still need to include the new constructor so we should have both of the constructors listed here (The deprecated constructor will assign true for stableFrameRate)\n@Deprecated\npublic VideoStreamingParameters(int displayDensity, int frameRate, int bitrate, int interval,\n                                    ImageResolution resolution, VideoStreamingFormat format) {}\n\npublic VideoStreamingParameters(int displayDensity, int frameRate, int bitrate, int interval,\n                                    ImageResolution resolution, VideoStreamingFormat format, boolean stableFrameRate) {}", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1576#discussion_r562787266", "createdAt": "2021-01-22T17:26:28Z", "author": {"login": "RHenigan"}, "path": "base/src/main/java/com/smartdevicelink/streaming/video/VideoStreamingParameters.java", "diffHunk": "@@ -103,15 +92,16 @@ public VideoStreamingParameters(int displayDensity, int frameRate, int bitrate,\n      * @param format\n      * @param stableFrameRate\n      */\n+    @Deprecated\n     public VideoStreamingParameters(int displayDensity, int frameRate, int bitrate, int interval,\n-                                    ImageResolution resolution, VideoStreamingFormat format, boolean stableFrameRate){\n+                                    ImageResolution resolution, VideoStreamingFormat format){\n \t    this.displayDensity = displayDensity;\n \t    this.frameRate = frameRate;\n \t    this.bitrate = bitrate;\n \t    this.interval = interval;\n \t    this.resolution = resolution;\n \t    this.format = format;\n-\t    this.stableFrameRate = stableFrameRate;\n+\t    this.stableFrameRate = true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d37b8e546d50f9a07248b7f041f9bc8d9411a8c0"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MzQwNzQ4Mw==", "bodyText": "Understood. I have restored the constructor, and updated the method comments accordingly.", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1576#discussion_r563407483", "createdAt": "2021-01-25T00:12:49Z", "author": {"login": "shiniwat"}, "path": "base/src/main/java/com/smartdevicelink/streaming/video/VideoStreamingParameters.java", "diffHunk": "@@ -103,15 +92,16 @@ public VideoStreamingParameters(int displayDensity, int frameRate, int bitrate,\n      * @param format\n      * @param stableFrameRate\n      */\n+    @Deprecated\n     public VideoStreamingParameters(int displayDensity, int frameRate, int bitrate, int interval,\n-                                    ImageResolution resolution, VideoStreamingFormat format, boolean stableFrameRate){\n+                                    ImageResolution resolution, VideoStreamingFormat format){\n \t    this.displayDensity = displayDensity;\n \t    this.frameRate = frameRate;\n \t    this.bitrate = bitrate;\n \t    this.interval = interval;\n \t    this.resolution = resolution;\n \t    this.format = format;\n-\t    this.stableFrameRate = stableFrameRate;\n+\t    this.stableFrameRate = true;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2Mjc4NzI2Ng=="}, "originalCommit": {"oid": "d37b8e546d50f9a07248b7f041f9bc8d9411a8c0"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzU2MjIzNzYxOnYy", "diffSide": "RIGHT", "path": "base/src/main/java/com/smartdevicelink/streaming/video/VideoStreamingParameters.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yN1QxODo0Mjo1MVrOIbWQyA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yOFQxMjo0NjoyNlrOIb1-SA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTU0NzIwOA==", "bodyText": "Hello @shiniwat, while testing I noticed an issue with taking the min bitrate. The sdl_hmi systemCapabilities that I was using had the max int value (2147483647), once we multiple by 1000 the int overflows and turns negative resulting in -1000 being the min value.\nSince the max value for the bitRate per the rpc_spec is 2147483647 I think we should cap the maxBitRate we receive from capabilities to ensure it does not overflow and then we can still use the min value between the parameters and the capabilities\nint maxBitrate = Math.min(Integer.MAX_VALUE/1000, capability.getMaxBitrate());\nthis.bitrate = Math.min(this.bitrate, maxBitrate * 1000);", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1576#discussion_r565547208", "createdAt": "2021-01-27T18:42:51Z", "author": {"login": "RHenigan"}, "path": "base/src/main/java/com/smartdevicelink/streaming/video/VideoStreamingParameters.java", "diffHunk": "@@ -168,9 +178,12 @@ public void update(VideoStreamingParameters params) {\n      */\n     public void update(VideoStreamingCapability capability, String vehicleMake) {\n         if (capability.getMaxBitrate() != null) {\n-            this.bitrate = capability.getMaxBitrate() * 1000;\n+            // Taking lower value as per SDL 0323 :\n+            // https://github.com/smartdevicelink/sdl_evolution/blob/master/proposals/0323-align-VideoStreamingParameter-with-capability.md\n+            this.bitrate = Math.min(this.bitrate, capability.getMaxBitrate() * 1000);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1d1eb83ff3bbeb6bc30c5277c4859edd31b08656"}, "originalPosition": 66}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjA2Njc2MA==", "bodyText": "@RHenigan, this is good catch! I have updated as you suggested. Thanks.", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1576#discussion_r566066760", "createdAt": "2021-01-28T12:46:26Z", "author": {"login": "shiniwat"}, "path": "base/src/main/java/com/smartdevicelink/streaming/video/VideoStreamingParameters.java", "diffHunk": "@@ -168,9 +178,12 @@ public void update(VideoStreamingParameters params) {\n      */\n     public void update(VideoStreamingCapability capability, String vehicleMake) {\n         if (capability.getMaxBitrate() != null) {\n-            this.bitrate = capability.getMaxBitrate() * 1000;\n+            // Taking lower value as per SDL 0323 :\n+            // https://github.com/smartdevicelink/sdl_evolution/blob/master/proposals/0323-align-VideoStreamingParameter-with-capability.md\n+            this.bitrate = Math.min(this.bitrate, capability.getMaxBitrate() * 1000);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTU0NzIwOA=="}, "originalCommit": {"oid": "1d1eb83ff3bbeb6bc30c5277c4859edd31b08656"}, "originalPosition": 66}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4213, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}