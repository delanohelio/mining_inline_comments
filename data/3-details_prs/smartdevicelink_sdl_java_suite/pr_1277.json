{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc2MjIxNjk4", "number": 1277, "title": "Update SCM to notify listeners if fresh copy of capability is received", "bodyText": "Fixes #1275\nThis PR is ready for review.\nRisk\nThis PR makes no API changes.\nTesting Plan\n\n I have verified that I have not introduced new warnings in this PR (or explain why below)\n I have run the unit tests with this PR\n I have tested this PR against Core and verified behavior (if applicable, if not applicable, explain why below).\n I have tested Android\n\nUnit Tests\nAdded more unit tests to test the fix\nCore Tests\n\nUse SCM.addOnSystemCapabilityListener() to add a listener for NAVIGATION capability for example\nMake sure the listener is called\nCall SCM.getCapability(SystemCapabilityType.NAVIGATION, ..., true)\nConfirm the listener that was added in step 1  is called again\n\nSummary\nThis PR fixes an issue with addOnSystemCapabilityListener() method that causes the listeners not to be triggered if a fresh copy of the capability is received when the developer calls getCapability() and sets forceUpdate to true\nCLA\n\n I have signed the CLA", "createdAt": "2020-02-17T16:20:40Z", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1277", "merged": true, "mergeCommit": {"oid": "4ccf293b03d96eb0f85caba3d100b4d49e11f49e"}, "closed": true, "closedAt": "2020-02-21T18:50:41Z", "author": {"login": "bilal-alsharifi"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcFPtgVgH2gAyMzc2MjIxNjk4Ojk2ZmQ4OTUyMmJhYWU0NGQ2NGI1NDE5MDlkNjAzZGMzOTdiMTc5N2M=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcGjcNXgFqTM2MjgwNDgyMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "96fd89522baae44d64b541909d603dc397b1797c", "author": {"user": {"login": "bilal-alsharifi", "name": "Bilal Alsharifi"}}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/96fd89522baae44d64b541909d603dc397b1797c", "committedDate": "2020-02-17T16:13:59Z", "message": "Notify listeners when fresh copy of capability is received"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fc779d67ae1400bfa04d30bcd7faaec6361628ba", "author": {"user": {"login": "bilal-alsharifi", "name": "Bilal Alsharifi"}}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/fc779d67ae1400bfa04d30bcd7faaec6361628ba", "committedDate": "2020-02-17T16:21:43Z", "message": "Add more SCM unit tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "43aa6dbcb5ad817fe5f494655c5badd4ab9e9d11", "author": {"user": {"login": "bilal-alsharifi", "name": "Bilal Alsharifi"}}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/43aa6dbcb5ad817fe5f494655c5badd4ab9e9d11", "committedDate": "2020-02-17T16:37:04Z", "message": "Fix an issue in SCM unit tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f6a10d835cb5253a9af1f8f54b21ee9a85a081fa", "author": {"user": {"login": "bilal-alsharifi", "name": "Bilal Alsharifi"}}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/f6a10d835cb5253a9af1f8f54b21ee9a85a081fa", "committedDate": "2020-02-17T16:47:19Z", "message": "Reformat code in setCapability() method"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYxMTk4NzI2", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1277#pullrequestreview-361198726", "createdAt": "2020-02-19T15:31:05Z", "commit": {"oid": "f6a10d835cb5253a9af1f8f54b21ee9a85a081fa"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxNTozMTowNlrOFrsXMA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxNjozMDoxNVrOFruPIg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTM1OTkyMA==", "bodyText": "It doesn't appear that you usually use tabs to align these param comments (e.g. above retrieveCapability()). I think this should be consistent. There really should be a project style guide where the correct style for this stuff can be noted.", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1277#discussion_r381359920", "createdAt": "2020-02-19T15:31:06Z", "author": {"login": "joeljfischer"}, "path": "base/src/main/java/com/smartdevicelink/proxy/SystemCapabilityManager.java", "diffHunk": "@@ -335,11 +335,11 @@ public void onReceived(RPCMessage message) {\n \t * Sets a capability in the cached map. This should only be done when an RPC is received and contains updates to the capability\n \t * that is being cached in the SystemCapabilityManager.\n \t * @param systemCapabilityType the system capability type that will be set\n-\t * @param capability the value of the capability that will be set\n+\t * @param capability           the value of the capability that will be set", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f6a10d835cb5253a9af1f8f54b21ee9a85a081fa"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTM2MDEwNQ==", "bodyText": "I think that currently iOS always calls with a cached value even if the value is null. This may be a point to be aligned.", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1277#discussion_r381360105", "createdAt": "2020-02-19T15:36:28Z", "author": {"login": "joeljfischer"}, "path": "base/src/main/java/com/smartdevicelink/proxy/SystemCapabilityManager.java", "diffHunk": "@@ -450,16 +450,17 @@ private boolean isSubscribedToSystemCapability(SystemCapabilityType systemCapabi\n \t */\n \tprivate Object getCapabilityPrivate(final SystemCapabilityType systemCapabilityType, final OnSystemCapabilityListener scListener, final Boolean subscribe, final boolean forceUpdate) {\n \t\tObject cachedCapability = cachedSystemCapabilities.get(systemCapabilityType);\n-\t\tOnSystemCapabilityListener listener = scListener;\n \n-\t\tif (!forceUpdate && cachedCapability != null && listener != null) {\n-\t\t\tlistener.onCapabilityRetrieved(cachedCapability);\n-\t\t\tlistener = null;\n+\t\tboolean shouldUpdateSystemCapabilitySubscription = (subscribe != null) && (subscribe != isSubscribedToSystemCapability(systemCapabilityType)) && supportsSubscriptions();\n+\t\tboolean shouldSendGetCapabilityRequest = forceUpdate || (cachedCapability == null) || shouldUpdateSystemCapabilitySubscription;\n+\t\tboolean shouldCallListenerWithCachedValue = (cachedCapability != null) && (scListener != null) && !shouldSendGetCapabilityRequest;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f6a10d835cb5253a9af1f8f54b21ee9a85a081fa"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTM2ODUwNQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\t\t\t// If the listener is not included in the onSystemCapabilityListeners map, then notify it\n          \n          \n            \n            \t\t\t\t\t// If the listener is not included in the onSystemCapabilityListeners map (if it's used from getSystemCapability with a force update), then notify it", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1277#discussion_r381368505", "createdAt": "2020-02-19T15:59:36Z", "author": {"login": "joeljfischer"}, "path": "base/src/main/java/com/smartdevicelink/proxy/SystemCapabilityManager.java", "diffHunk": "@@ -549,18 +550,27 @@ private void retrieveCapability(final SystemCapabilityType systemCapabilityType,\n \t\t}\n \t\tfinal GetSystemCapability request = new GetSystemCapability();\n \t\trequest.setSystemCapabilityType(systemCapabilityType);\n-\t\trequest.setSubscribe((subscribe != null) ? subscribe : isSubscribedToSystemCapability(systemCapabilityType)); // If subscribe is null, then don't change the current subscription status\n+\t\t// If subscribe is null, then don't change the current subscription status\n+\t\tfinal boolean shouldSubscribe = ((subscribe != null) ? subscribe : isSubscribedToSystemCapability(systemCapabilityType)) && supportsSubscriptions();\n+\t\trequest.setSubscribe(shouldSubscribe);\n \t\trequest.setOnRPCResponseListener(new OnRPCResponseListener() {\n \t\t\t@Override\n \t\t\tpublic void onResponse(int correlationId, RPCResponse response) {\n \t\t\t\tif (response.getSuccess()) {\n \t\t\t\t\tObject retrievedCapability = ((GetSystemCapabilityResponse) response).getSystemCapability().getCapabilityForType(systemCapabilityType);\n-\t\t\t\t\tcachedSystemCapabilities.put(systemCapabilityType, retrievedCapability);\n+\t\t\t\t\tsetCapability(systemCapabilityType, retrievedCapability);\n+\t\t\t\t\t// If the listener is not included in the onSystemCapabilityListeners map, then notify it", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f6a10d835cb5253a9af1f8f54b21ee9a85a081fa"}, "originalPosition": 71}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTM3MDEyMA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\t\t\t\t\tboolean listenerAlreadyNotified = notifiedListeners != null && notifiedListeners.contains(scListener);\n          \n          \n            \n            \t\t\t\t\t\t\tboolean listenerAlreadyNotified = (notifiedListeners != null) && notifiedListeners.contains(scListener);", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1277#discussion_r381370120", "createdAt": "2020-02-19T16:01:46Z", "author": {"login": "joeljfischer"}, "path": "base/src/main/java/com/smartdevicelink/proxy/SystemCapabilityManager.java", "diffHunk": "@@ -549,18 +550,27 @@ private void retrieveCapability(final SystemCapabilityType systemCapabilityType,\n \t\t}\n \t\tfinal GetSystemCapability request = new GetSystemCapability();\n \t\trequest.setSystemCapabilityType(systemCapabilityType);\n-\t\trequest.setSubscribe((subscribe != null) ? subscribe : isSubscribedToSystemCapability(systemCapabilityType)); // If subscribe is null, then don't change the current subscription status\n+\t\t// If subscribe is null, then don't change the current subscription status\n+\t\tfinal boolean shouldSubscribe = ((subscribe != null) ? subscribe : isSubscribedToSystemCapability(systemCapabilityType)) && supportsSubscriptions();\n+\t\trequest.setSubscribe(shouldSubscribe);\n \t\trequest.setOnRPCResponseListener(new OnRPCResponseListener() {\n \t\t\t@Override\n \t\t\tpublic void onResponse(int correlationId, RPCResponse response) {\n \t\t\t\tif (response.getSuccess()) {\n \t\t\t\t\tObject retrievedCapability = ((GetSystemCapabilityResponse) response).getSystemCapability().getCapabilityForType(systemCapabilityType);\n-\t\t\t\t\tcachedSystemCapabilities.put(systemCapabilityType, retrievedCapability);\n+\t\t\t\t\tsetCapability(systemCapabilityType, retrievedCapability);\n+\t\t\t\t\t// If the listener is not included in the onSystemCapabilityListeners map, then notify it\n \t\t\t\t\tif (scListener != null) {\n-\t\t\t\t\t\tscListener.onCapabilityRetrieved(retrievedCapability);\n+\t\t\t\t\t\tsynchronized (LISTENER_LOCK) {\n+\t\t\t\t\t\t\tCopyOnWriteArrayList<OnSystemCapabilityListener> notifiedListeners = onSystemCapabilityListeners.get(systemCapabilityType);\n+\t\t\t\t\t\t\tboolean listenerAlreadyNotified = notifiedListeners != null && notifiedListeners.contains(scListener);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f6a10d835cb5253a9af1f8f54b21ee9a85a081fa"}, "originalPosition": 76}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTM4MTI4OA==", "bodyText": "Based on the change to retrieveCapability() I believe this should not send subscribe=true, right?\nfinal boolean shouldSubscribe = ((subscribe != null) ? subscribe : isSubscribedToSystemCapability(systemCapabilityType)) && supportsSubscriptions();\nrequest.setSubscribe(shouldSubscribe);", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1277#discussion_r381381288", "createdAt": "2020-02-19T16:17:00Z", "author": {"login": "joeljfischer"}, "path": "android/sdl_android/src/androidTest/java/com/smartdevicelink/test/proxy/SystemCapabilityManagerTests.java", "diffHunk": "@@ -490,6 +490,94 @@ public void testAddOnSystemCapabilityListenerWithSubscriptionsNotSupportedAndCap\n \t\tverify(internalInterface, times(1)).sendRPC(any(GetSystemCapability.class));\n \t}\n \n+\tpublic void testAddOnSystemCapabilityListenerThenGetCapability() {\n+\t\tSdlMsgVersion sdlMsgVersion = new SdlMsgVersion(5, 0); // This version doesn't support capability subscriptions\n+\t\tsdlMsgVersion.setPatchVersion(0);\n+\t\tISdl internalInterface = mock(ISdl.class);\n+\t\twhen(internalInterface.getSdlMsgVersion()).thenReturn(sdlMsgVersion);\n+\t\tSystemCapabilityManager scm = new SystemCapabilityManager(internalInterface);\n+\t\tscm.setCapability(SystemCapabilityType.VIDEO_STREAMING, videoStreamingCapability);\n+\n+\n+\t\t// Add listener1\n+\t\t// When the first listener is added, GetSystemCapability request should go out with subscribe=true", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f6a10d835cb5253a9af1f8f54b21ee9a85a081fa"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTM4NzIxNg==", "bodyText": "Currently, iOS calls the listener with a cached value of nil. This may be a point of alignment needed.\nWhy does it not call with the cached value if we are sending a GetCapability request? Should the && before !shouldSendGetCapabilityRequest be an ||?", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1277#discussion_r381387216", "createdAt": "2020-02-19T16:25:22Z", "author": {"login": "joeljfischer"}, "path": "base/src/main/java/com/smartdevicelink/proxy/SystemCapabilityManager.java", "diffHunk": "@@ -450,16 +450,17 @@ private boolean isSubscribedToSystemCapability(SystemCapabilityType systemCapabi\n \t */\n \tprivate Object getCapabilityPrivate(final SystemCapabilityType systemCapabilityType, final OnSystemCapabilityListener scListener, final Boolean subscribe, final boolean forceUpdate) {\n \t\tObject cachedCapability = cachedSystemCapabilities.get(systemCapabilityType);\n-\t\tOnSystemCapabilityListener listener = scListener;\n \n-\t\tif (!forceUpdate && cachedCapability != null && listener != null) {\n-\t\t\tlistener.onCapabilityRetrieved(cachedCapability);\n-\t\t\tlistener = null;\n+\t\tboolean shouldUpdateSystemCapabilitySubscription = (subscribe != null) && (subscribe != isSubscribedToSystemCapability(systemCapabilityType)) && supportsSubscriptions();\n+\t\tboolean shouldSendGetCapabilityRequest = forceUpdate || (cachedCapability == null) || shouldUpdateSystemCapabilitySubscription;\n+\t\tboolean shouldCallListenerWithCachedValue = (cachedCapability != null) && (scListener != null) && !shouldSendGetCapabilityRequest;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f6a10d835cb5253a9af1f8f54b21ee9a85a081fa"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTM5MDYyNg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\tfinal boolean shouldSubscribe = ((subscribe != null) ? subscribe : isSubscribedToSystemCapability(systemCapabilityType)) && supportsSubscriptions();\n          \n          \n            \n            \t\tfinal boolean shouldSubscribe = ((subscribe != null) ? subscribe : (isSubscribedToSystemCapability(systemCapabilityType)) && supportsSubscriptions());\n          \n      \n    \n    \n  \n\nI think the name of this is a bit misleading, because if it's false, it shouldUnsubscribe(). I almost think you need an enum with values subscribe, unsubscribe, and keepCurrentState. Or at least the documentation needs to be improved here.\nI also need clarification on a point here. If subscribe is false and we are currently subscribed, and we support subscriptions, then shouldSubscribe will be true, right? And that's the opposite of what we want, since we want to unsubscribe?", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1277#discussion_r381390626", "createdAt": "2020-02-19T16:30:15Z", "author": {"login": "joeljfischer"}, "path": "base/src/main/java/com/smartdevicelink/proxy/SystemCapabilityManager.java", "diffHunk": "@@ -549,18 +550,27 @@ private void retrieveCapability(final SystemCapabilityType systemCapabilityType,\n \t\t}\n \t\tfinal GetSystemCapability request = new GetSystemCapability();\n \t\trequest.setSystemCapabilityType(systemCapabilityType);\n-\t\trequest.setSubscribe((subscribe != null) ? subscribe : isSubscribedToSystemCapability(systemCapabilityType)); // If subscribe is null, then don't change the current subscription status\n+\t\t// If subscribe is null, then don't change the current subscription status\n+\t\tfinal boolean shouldSubscribe = ((subscribe != null) ? subscribe : isSubscribedToSystemCapability(systemCapabilityType)) && supportsSubscriptions();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f6a10d835cb5253a9af1f8f54b21ee9a85a081fa"}, "originalPosition": 62}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9ec33af2d4c5eef78ea1c6c4b3defaf801af6815", "author": {"user": {"login": "bilal-alsharifi", "name": "Bilal Alsharifi"}}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/9ec33af2d4c5eef78ea1c6c4b3defaf801af6815", "committedDate": "2020-02-19T20:32:52Z", "message": "Update formatting in SCM"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b239e724604fceb93581aa4bae1bb35bf83880c4", "author": {"user": {"login": "bilal-alsharifi", "name": "Bilal Alsharifi"}}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/b239e724604fceb93581aa4bae1bb35bf83880c4", "committedDate": "2020-02-19T21:44:32Z", "message": "Update comments in retrieveCapability()"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5fa55cf180a3a2e444770dbf4818d6a01d53913c", "author": {"user": {"login": "bilal-alsharifi", "name": "Bilal Alsharifi"}}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/5fa55cf180a3a2e444770dbf4818d6a01d53913c", "committedDate": "2020-02-19T21:54:14Z", "message": "Update comments in SystemCapabilityManagerTests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "adfd59364bbeaea67c1e6990e4e13549cc33b7d9", "author": {"user": {"login": "bilal-alsharifi", "name": "Bilal Alsharifi"}}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/adfd59364bbeaea67c1e6990e4e13549cc33b7d9", "committedDate": "2020-02-20T16:43:47Z", "message": "Update comments in SCM"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "49d20093f838fcc119e1210668281baf33e0d621", "author": {"user": {"login": "bilal-alsharifi", "name": "Bilal Alsharifi"}}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/49d20093f838fcc119e1210668281baf33e0d621", "committedDate": "2020-02-20T19:34:59Z", "message": "Prevent sending GetSystemCapability for DISPLAYS"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "079d9197e733a3a27dde2ed4543c1f51b5f4e2b7", "author": {"user": {"login": "bilal-alsharifi", "name": "Bilal Alsharifi"}}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/079d9197e733a3a27dde2ed4543c1f51b5f4e2b7", "committedDate": "2020-02-20T19:36:34Z", "message": "Add more unit tests for DISPLAYS capability"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "11189a63e71bddae0d7fea388b0e98db47e5ec2d", "author": {"user": {"login": "bilal-alsharifi", "name": "Bilal Alsharifi"}}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/11189a63e71bddae0d7fea388b0e98db47e5ec2d", "committedDate": "2020-02-20T19:38:09Z", "message": "Update comments in SystemCapabilityManagerTests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyNjYwNjgw", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1277#pullrequestreview-362660680", "createdAt": "2020-02-21T14:20:54Z", "commit": {"oid": "11189a63e71bddae0d7fea388b0e98db47e5ec2d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxNDoyMDo1NFrOFs4ZnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxNjoxOTo1NlrOFs8kYA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjYwNTcyNQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t- if subscribe is true and the HU supports subscriptions, then shouldSubscribe = true\n          \n          \n            \n            \t\t- if subscribe is true, then shouldSubscribe = true\n          \n      \n    \n    \n  \n\nThis doesn't appear to be true, it's if subscribe == true, then shouldSubscribe = true.", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1277#discussion_r382605725", "createdAt": "2020-02-21T14:20:54Z", "author": {"login": "joeljfischer"}, "path": "base/src/main/java/com/smartdevicelink/proxy/SystemCapabilityManager.java", "diffHunk": "@@ -550,7 +551,13 @@ private void retrieveCapability(final SystemCapabilityType systemCapabilityType,\n \t\t}\n \t\tfinal GetSystemCapability request = new GetSystemCapability();\n \t\trequest.setSystemCapabilityType(systemCapabilityType);\n-\t\t// If subscribe is null, then don't change the current subscription status\n+\n+\t\t/*\n+\t\tThe subscription flag in the request should be set based on multiple variables:\n+\t\t- if subscribe is null (no change), shouldSubscribe = current subscription status\n+\t\t- if subscribe is false, then shouldSubscribe = false\n+\t\t- if subscribe is true and the HU supports subscriptions, then shouldSubscribe = true", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "11189a63e71bddae0d7fea388b0e98db47e5ec2d"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjYwNTk0Ng==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t- if subscribe is null (no change), shouldSubscribe = current subscription status\n          \n          \n            \n            \t\t- if subscribe is null (no change), shouldSubscribe = current subscription status, or false if the HU does not support subscriptions", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1277#discussion_r382605946", "createdAt": "2020-02-21T14:21:21Z", "author": {"login": "joeljfischer"}, "path": "base/src/main/java/com/smartdevicelink/proxy/SystemCapabilityManager.java", "diffHunk": "@@ -550,7 +551,13 @@ private void retrieveCapability(final SystemCapabilityType systemCapabilityType,\n \t\t}\n \t\tfinal GetSystemCapability request = new GetSystemCapability();\n \t\trequest.setSystemCapabilityType(systemCapabilityType);\n-\t\t// If subscribe is null, then don't change the current subscription status\n+\n+\t\t/*\n+\t\tThe subscription flag in the request should be set based on multiple variables:\n+\t\t- if subscribe is null (no change), shouldSubscribe = current subscription status", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "11189a63e71bddae0d7fea388b0e98db47e5ec2d"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjY3NDAxNg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \tpublic void testAddOnSystemCapabilityListenerThenGetCapability() {\n          \n          \n            \n            \tpublic void testAddOnSystemCapabilityListenerThenGetCapabilityWhenSubscriptionsAreNotSupported() {\n          \n      \n    \n    \n  \n\nYou may also want to consider underscores to define conditions, like:\ntestAddOnSystemCapabilityListener_thenGetCapability_whenSubscriptionsAreNotSupported()", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1277#discussion_r382674016", "createdAt": "2020-02-21T16:19:56Z", "author": {"login": "joeljfischer"}, "path": "android/sdl_android/src/androidTest/java/com/smartdevicelink/test/proxy/SystemCapabilityManagerTests.java", "diffHunk": "@@ -490,6 +490,129 @@ public void testAddOnSystemCapabilityListenerWithSubscriptionsNotSupportedAndCap\n \t\tverify(internalInterface, times(1)).sendRPC(any(GetSystemCapability.class));\n \t}\n \n+\tpublic void testAddOnSystemCapabilityListenerThenGetCapability() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "11189a63e71bddae0d7fea388b0e98db47e5ec2d"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "029db4ec08e179c44fa169713e6076878358f8a0", "author": {"user": {"login": "bilal-alsharifi", "name": "Bilal Alsharifi"}}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/029db4ec08e179c44fa169713e6076878358f8a0", "committedDate": "2020-02-21T16:35:13Z", "message": "Update android/sdl_android/src/androidTest/java/com/smartdevicelink/test/proxy/SystemCapabilityManagerTests.java\n\nCo-Authored-By: Joel Fischer <joeljfischer@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "df73517365f5e3ec8123f1dcb9859054d1f8a967", "author": {"user": {"login": "bilal-alsharifi", "name": "Bilal Alsharifi"}}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/df73517365f5e3ec8123f1dcb9859054d1f8a967", "committedDate": "2020-02-21T16:36:33Z", "message": "Update base/src/main/java/com/smartdevicelink/proxy/SystemCapabilityManager.java\n\nCo-Authored-By: Joel Fischer <joeljfischer@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b1edc68edee81e1c718381f4c25a788ab915bff8", "author": {"user": {"login": "bilal-alsharifi", "name": "Bilal Alsharifi"}}, "url": "https://github.com/smartdevicelink/sdl_java_suite/commit/b1edc68edee81e1c718381f4c25a788ab915bff8", "committedDate": "2020-02-21T17:20:55Z", "message": "Simplify ternary condition in SCM"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyODA0ODIy", "url": "https://github.com/smartdevicelink/sdl_java_suite/pull/1277#pullrequestreview-362804822", "createdAt": "2020-02-21T17:47:07Z", "commit": {"oid": "b1edc68edee81e1c718381f4c25a788ab915bff8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2127, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}