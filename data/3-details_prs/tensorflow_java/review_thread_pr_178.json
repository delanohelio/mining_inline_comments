{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ2MzI5MTU2", "number": 178, "reviewThreads": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQxNjowNDowNFrOFJzvaw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wN1QwMjo0OTo0NVrOFL-aqg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ1ODI5MjI3OnYy", "diffSide": "RIGHT", "path": "tensorflow-core/tensorflow-core-api/src/main/java/org/tensorflow/op/core/Init.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQxNjowNDowNFrOIMSnQg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMFQxNjowMjowOFrOIMwMTg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTc1ODc4Ng==", "bodyText": "Why leave the exception in there if it's not triggered?", "url": "https://github.com/tensorflow/java/pull/178#discussion_r549758786", "createdAt": "2020-12-29T16:04:04Z", "author": {"login": "Craigacp"}, "path": "tensorflow-core/tensorflow-core-api/src/main/java/org/tensorflow/op/core/Init.java", "diffHunk": "@@ -89,16 +89,18 @@ public static Init create(Scope scope) {\n    *\n    * <p>Registered initializers are then grouped as a single unit of computation by adding\n    * and executing an {@link org.tensorflow.op.core.Init#create(Scope) init} operation from a graph\n-   * session.\n+   * session.  No-ops if the session is eager.\n    *\n    * @param scope\n    * @param initializer\n-   * @throws IllegalArgumentException if the execution environment in scope is not a graph\n    * @see org.tensorflow.op.core.Init#create(Scope) init\n    */\n   @Endpoint(name = \"initAdd\")\n   public static void add(Scope scope, Op initializer) {\n     ExecutionEnvironment exEnv = scope.env();\n+    if(exEnv.isEager()){\n+      return;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d1f54b316291217f7de3da6fb0da3214cb48c19"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTg3OTMxNg==", "bodyText": "Because in theory you could have a non-eager execution environment that isn't Graph.  Is there any possibility of that being a thing?", "url": "https://github.com/tensorflow/java/pull/178#discussion_r549879316", "createdAt": "2020-12-29T22:53:18Z", "author": {"login": "rnett"}, "path": "tensorflow-core/tensorflow-core-api/src/main/java/org/tensorflow/op/core/Init.java", "diffHunk": "@@ -89,16 +89,18 @@ public static Init create(Scope scope) {\n    *\n    * <p>Registered initializers are then grouped as a single unit of computation by adding\n    * and executing an {@link org.tensorflow.op.core.Init#create(Scope) init} operation from a graph\n-   * session.\n+   * session.  No-ops if the session is eager.\n    *\n    * @param scope\n    * @param initializer\n-   * @throws IllegalArgumentException if the execution environment in scope is not a graph\n    * @see org.tensorflow.op.core.Init#create(Scope) init\n    */\n   @Endpoint(name = \"initAdd\")\n   public static void add(Scope scope, Op initializer) {\n     ExecutionEnvironment exEnv = scope.env();\n+    if(exEnv.isEager()){\n+      return;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTc1ODc4Ng=="}, "originalCommit": {"oid": "2d1f54b316291217f7de3da6fb0da3214cb48c19"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDI0MzQwNg==", "bodyText": "Not to my knowledge. There are a lot of other things that assume either eager or graph execution and that would blow up if there was a third type. At the very least the exception error message should be fixed to note that this op succeeds on graph and eager sessions.", "url": "https://github.com/tensorflow/java/pull/178#discussion_r550243406", "createdAt": "2020-12-30T16:02:08Z", "author": {"login": "Craigacp"}, "path": "tensorflow-core/tensorflow-core-api/src/main/java/org/tensorflow/op/core/Init.java", "diffHunk": "@@ -89,16 +89,18 @@ public static Init create(Scope scope) {\n    *\n    * <p>Registered initializers are then grouped as a single unit of computation by adding\n    * and executing an {@link org.tensorflow.op.core.Init#create(Scope) init} operation from a graph\n-   * session.\n+   * session.  No-ops if the session is eager.\n    *\n    * @param scope\n    * @param initializer\n-   * @throws IllegalArgumentException if the execution environment in scope is not a graph\n    * @see org.tensorflow.op.core.Init#create(Scope) init\n    */\n   @Endpoint(name = \"initAdd\")\n   public static void add(Scope scope, Op initializer) {\n     ExecutionEnvironment exEnv = scope.env();\n+    if(exEnv.isEager()){\n+      return;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTc1ODc4Ng=="}, "originalCommit": {"oid": "2d1f54b316291217f7de3da6fb0da3214cb48c19"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ2NTM3MDExOnYy", "diffSide": "RIGHT", "path": "tensorflow-core/tensorflow-core-api/src/main/java/org/tensorflow/op/core/Init.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wMVQxNTozODowNlrOINQ5rQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wMVQxNTozODowNlrOINQ5rQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDc3OTMwOQ==", "bodyText": "I think pretty much all over the code, while we \"might\" have to support later a third execution environment type, we kind of assume that there is only to. So I would only simplify this method with:\nif (exEnv.isGraph()) {\n   Graph graph = (Graph) exEnv;\n   graph.addInitializer(initializer);\n}", "url": "https://github.com/tensorflow/java/pull/178#discussion_r550779309", "createdAt": "2021-01-01T15:38:06Z", "author": {"login": "karllessard"}, "path": "tensorflow-core/tensorflow-core-api/src/main/java/org/tensorflow/op/core/Init.java", "diffHunk": "@@ -89,18 +89,20 @@ public static Init create(Scope scope) {\n    *\n    * <p>Registered initializers are then grouped as a single unit of computation by adding\n    * and executing an {@link org.tensorflow.op.core.Init#create(Scope) init} operation from a graph\n-   * session.\n+   * session.  No-ops if the session is eager.\n    *\n    * @param scope\n    * @param initializer\n-   * @throws IllegalArgumentException if the execution environment in scope is not a graph\n    * @see org.tensorflow.op.core.Init#create(Scope) init\n    */\n   @Endpoint(name = \"initAdd\")\n   public static void add(Scope scope, Op initializer) {\n     ExecutionEnvironment exEnv = scope.env();\n+    if(exEnv.isEager()){\n+      return;\n+    }\n     if (!(exEnv instanceof Graph)) {\n-      throw new IllegalArgumentException(\"initAdd is only supported on Graph sessions.\");\n+      throw new IllegalArgumentException(\"initAdd is only supported on Graph or eager sessions.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "304dc00c8b3d2eebdb266aab7ae67fd029582a5f"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ2Njg4MDU4OnYy", "diffSide": "RIGHT", "path": "tensorflow-core/tensorflow-core-api/src/main/java/org/tensorflow/Session.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wM1QwMjo0Mzo0OVrOINbI-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wM1QwNDozOToxNlrOINbpPg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDk0NzA2Nw==", "bodyText": "This should be called addInitialization, and I'm not sure it's a great idea to do this in a runner with other things, so it might want to be a package-private method only visible through the runInit method, then fix the docs for runInit so it doesn't reference a private method.", "url": "https://github.com/tensorflow/java/pull/178#discussion_r550947067", "createdAt": "2021-01-03T02:43:49Z", "author": {"login": "Craigacp"}, "path": "tensorflow-core/tensorflow-core-api/src/main/java/org/tensorflow/Session.java", "diffHunk": "@@ -293,6 +293,16 @@ public Runner addTarget(Op op) {\n       return addTarget(op.op());\n     }\n \n+    /**\n+     * Make {@link #run} execute the graph's initializers.\n+     *\n+     * @return this session runner\n+     */\n+    public Runner doInitialization(){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8dfc44942a8cb0908b835a685af281a1db97c4c0"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDk1NTMyNg==", "bodyText": "I'll just remove it if we don't want it public, I wasn't using it in runInit", "url": "https://github.com/tensorflow/java/pull/178#discussion_r550955326", "createdAt": "2021-01-03T04:39:16Z", "author": {"login": "rnett"}, "path": "tensorflow-core/tensorflow-core-api/src/main/java/org/tensorflow/Session.java", "diffHunk": "@@ -293,6 +293,16 @@ public Runner addTarget(Op op) {\n       return addTarget(op.op());\n     }\n \n+    /**\n+     * Make {@link #run} execute the graph's initializers.\n+     *\n+     * @return this session runner\n+     */\n+    public Runner doInitialization(){", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDk0NzA2Nw=="}, "originalCommit": {"oid": "8dfc44942a8cb0908b835a685af281a1db97c4c0"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ2Njg4MjExOnYy", "diffSide": "RIGHT", "path": "tensorflow-core/tensorflow-core-api/src/main/java/org/tensorflow/op/core/Init.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wM1QwMjo0NTo1NlrOINbJmw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wM1QwMjo0NTo1NlrOINbJmw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDk0NzIyNw==", "bodyText": "\"This is a no-op if executed in an eager session\"", "url": "https://github.com/tensorflow/java/pull/178#discussion_r550947227", "createdAt": "2021-01-03T02:45:56Z", "author": {"login": "Craigacp"}, "path": "tensorflow-core/tensorflow-core-api/src/main/java/org/tensorflow/op/core/Init.java", "diffHunk": "@@ -89,21 +89,19 @@ public static Init create(Scope scope) {\n    *\n    * <p>Registered initializers are then grouped as a single unit of computation by adding\n    * and executing an {@link org.tensorflow.op.core.Init#create(Scope) init} operation from a graph\n-   * session.\n+   * session.  No-ops if the session is eager.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8dfc44942a8cb0908b835a685af281a1db97c4c0"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ2Njg4Mjc5OnYy", "diffSide": "RIGHT", "path": "tensorflow-core/tensorflow-core-api/src/gen/annotations/org/tensorflow/op/Ops.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wM1QwMjo0NjozNlrOINbJ4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wM1QwMjo0NjozNlrOINbJ4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDk0NzI5OA==", "bodyText": "\"This is a no-op if executed in an eager session\"", "url": "https://github.com/tensorflow/java/pull/178#discussion_r550947298", "createdAt": "2021-01-03T02:46:36Z", "author": {"login": "Craigacp"}, "path": "tensorflow-core/tensorflow-core-api/src/gen/annotations/org/tensorflow/op/Ops.java", "diffHunk": "@@ -2755,11 +2755,10 @@ public Init init() {\n    *\n    *  <p>Registered initializers are then grouped as a single unit of computation by adding\n    *  and executing an {@link org.tensorflow.op.core.Init#create(Scope) init} operation from a graph\n-   *  session.\n+   *  session.  No-ops if the session is eager.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8dfc44942a8cb0908b835a685af281a1db97c4c0"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ4MTAxMTk5OnYy", "diffSide": "RIGHT", "path": "tensorflow-core/tensorflow-core-api/src/main/java/org/tensorflow/Session.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wN1QwMjo0OTowM1rOIPdTmw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wN1QwMjo0OTowM1rOIPdTmw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzA3OTcwNw==", "bodyText": "In fact, it is more a replacement for session.run(Ops.create(session.graph).init())", "url": "https://github.com/tensorflow/java/pull/178#discussion_r553079707", "createdAt": "2021-01-07T02:49:03Z", "author": {"login": "karllessard"}, "path": "tensorflow-core/tensorflow-core-api/src/main/java/org/tensorflow/Session.java", "diffHunk": "@@ -490,6 +490,19 @@ public void run(Op op) {\n     runner().addTarget(op.op()).run();\n   }\n \n+\n+  /**\n+   * Execute the graph's initializers.\n+   *\n+   * <p>This method is equivalent to {@code session.runner().addTarget(Ops.create(session.graph()).init()).run()}.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b83b1bbbbdad54b11e56099880ebae27ae67b458"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ4MTAxMjkwOnYy", "diffSide": "RIGHT", "path": "tensorflow-core/tensorflow-core-api/src/main/java/org/tensorflow/op/core/Init.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wN1QwMjo0OTo0NVrOIPdULg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wN1QwMjo0OTo0NVrOIPdULg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzA3OTg1NA==", "bodyText": "Nit: there is a missing space after if", "url": "https://github.com/tensorflow/java/pull/178#discussion_r553079854", "createdAt": "2021-01-07T02:49:45Z", "author": {"login": "karllessard"}, "path": "tensorflow-core/tensorflow-core-api/src/main/java/org/tensorflow/op/core/Init.java", "diffHunk": "@@ -89,21 +89,19 @@ public static Init create(Scope scope) {\n    *\n    * <p>Registered initializers are then grouped as a single unit of computation by adding\n    * and executing an {@link org.tensorflow.op.core.Init#create(Scope) init} operation from a graph\n-   * session.\n+   * session.  This is a no-op if executed in an eager session.\n    *\n    * @param scope\n    * @param initializer\n-   * @throws IllegalArgumentException if the execution environment in scope is not a graph\n    * @see org.tensorflow.op.core.Init#create(Scope) init\n    */\n   @Endpoint(name = \"initAdd\")\n   public static void add(Scope scope, Op initializer) {\n     ExecutionEnvironment exEnv = scope.env();\n-    if (!(exEnv instanceof Graph)) {\n-      throw new IllegalArgumentException(\"initAdd is only supported on Graph sessions.\");\n+\n+    if(exEnv.isGraph()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b83b1bbbbdad54b11e56099880ebae27ae67b458"}, "originalPosition": 18}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1666, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}