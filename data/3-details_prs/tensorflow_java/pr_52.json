{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE1ODAxMjg1", "number": 52, "title": "Add functionality to map over dataset elements in both graph and eager mode.", "bodyText": "While we can't use the MapDataset op very easily in Java, using the DatasetIterator abstraction, we can map over dataset elements using a lambda.\nIn Graph mode, we apply the lambda once to add new operands to the graph as the targets for each session.run(). In Eager mode, the function is applied to each returned dataset element during iteration.\nEach Dataset element is represented as a list of components: List<Operand<?>>.\nIn this PR, I added 3 utility functions to map over such elements:\n\n\nDatasetIterator.map(Bifunction<Ops, List<Operand<?>>, List<Operand<?>> mapper) to map an element-level transform to each returned element.\n\n\nDatasetIterator.mapOneComponent(int index, BiFunction<Ops, Operand<?>, Operand<?>> mapper) to map a component-level transform to a single component of each returned element.\n\n\nDatasetIterator.mapAllComponents(BiFunction<Ops, Operand<?>, Operand<?>>) to map a single component-level transform to all components of each returned element.\n\n\nThis PR also adds wrappers and static creation methods for using the TFRecordDataset and TextLineDataset ops.", "createdAt": "2020-05-10T23:51:38Z", "url": "https://github.com/tensorflow/java/pull/52", "merged": true, "mergeCommit": {"oid": "b6049c5005f8ef3d2632da1bb29449c8ead5e9f8"}, "closed": true, "closedAt": "2020-05-19T04:29:06Z", "author": {"login": "dhruvrajan"}, "timelineItems": {"totalCount": 24, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcgEBzfgBqjMzMjA4MjQyODA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcisxE0AFqTQxNDA5MzE3MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a53336e39f3623f7e81bb1967ab4ff41c167c40d", "author": {"user": {"login": "dhruvrajan", "name": "Dhruv Rajan"}}, "url": "https://github.com/tensorflow/java/commit/a53336e39f3623f7e81bb1967ab4ff41c167c40d", "committedDate": "2020-05-10T23:45:29Z", "message": "Add functionality to map over dataset elements in both graph and eager mode."}, "afterCommit": {"oid": "1e841e4ca57be6a0a3423a4232364b6e26a7e1b3", "author": {"user": {"login": "dhruvrajan", "name": "Dhruv Rajan"}}, "url": "https://github.com/tensorflow/java/commit/1e841e4ca57be6a0a3423a4232364b6e26a7e1b3", "committedDate": "2020-05-10T23:52:22Z", "message": "Add functionality to map over dataset elements in both graph and eager mode."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4Nzk1NDg5", "url": "https://github.com/tensorflow/java/pull/52#pullrequestreview-408795489", "createdAt": "2020-05-10T23:58:13Z", "commit": {"oid": "1e841e4ca57be6a0a3423a4232364b6e26a7e1b3"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMFQyMzo1ODoxM1rOGTIx2g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQwMDowNToyNVrOGTI08w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjcxOTk2Mg==", "bodyText": "You should check your copyright setting.", "url": "https://github.com/tensorflow/java/pull/52#discussion_r422719962", "createdAt": "2020-05-10T23:58:13Z", "author": {"login": "Craigacp"}, "path": "tensorflow-framework/src/main/java/org/tensorflow/framework/data/Dataset.java", "diffHunk": "@@ -1,5 +1,5 @@\n /*\r\n- * Copyright 2020 The TensorFlow Authors. All rights reserved.\r\n+ * Copyright (c) 2020, Oracle and/or its affiliates. All rights reserved.\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1e841e4ca57be6a0a3423a4232364b6e26a7e1b3"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjcxOTk4Mw==", "bodyText": "No star imports", "url": "https://github.com/tensorflow/java/pull/52#discussion_r422719983", "createdAt": "2020-05-10T23:58:22Z", "author": {"login": "Craigacp"}, "path": "tensorflow-framework/src/main/java/org/tensorflow/framework/data/Dataset.java", "diffHunk": "@@ -17,10 +17,8 @@\n \r\n import org.tensorflow.DataType;\r\n import org.tensorflow.Operand;\r\n-import org.tensorflow.framework.data.impl.BatchDataset;\r\n-import org.tensorflow.framework.data.impl.SkipDataset;\r\n-import org.tensorflow.framework.data.impl.TakeDataset;\r\n-import org.tensorflow.framework.data.impl.TensorSliceDataset;\r\n+import org.tensorflow.Output;\r\n+import org.tensorflow.framework.data.impl.*;\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1e841e4ca57be6a0a3423a4232364b6e26a7e1b3"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjcyMDAzMA==", "bodyText": "Copyright", "url": "https://github.com/tensorflow/java/pull/52#discussion_r422720030", "createdAt": "2020-05-10T23:58:43Z", "author": {"login": "Craigacp"}, "path": "tensorflow-framework/src/main/java/org/tensorflow/framework/data/DatasetIterator.java", "diffHunk": "@@ -1,5 +1,5 @@\n /*\n- * Copyright 2020 The TensorFlow Authors. All rights reserved.\n+ * Copyright (c) 2020, Oracle and/or its affiliates. All rights reserved.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1e841e4ca57be6a0a3423a4232364b6e26a7e1b3"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjcyMDA4Ng==", "bodyText": "These seem to have gone back to a Python convention for the variable names rather than a Java one?", "url": "https://github.com/tensorflow/java/pull/52#discussion_r422720086", "createdAt": "2020-05-10T23:59:35Z", "author": {"login": "Craigacp"}, "path": "tensorflow-framework/src/main/java/org/tensorflow/framework/data/DatasetIterator.java", "diffHunk": "@@ -76,37 +82,37 @@\n  *\n  * <pre>{@code\n  * // Create input tensors\n- * Operand<?> features = tf.constant( ... );\n- * Operand<?> labels = tf.constant( ... );\n+ * Operand<?> XTensor = tf.constant( ... );\n+ * Operand<?> yTensor = tf.constant( ... );\n  *\n  * int BATCH_SIZE = ...\n  *\n  * Dataset dataset = Dataset\n- *         .fromTensorSlices(features, labels)\n+ *         .fromTensorSlices(XTensor, yTensor)\n  *         .batch(BATCH_SIZE);\n  * DatasetIterator iterator = dataset.makeIterator();\n  *\n  * Optimizer optimizer = ... // create an optimizer\n  *\n  * for (List<Operand<?>> components : dataset) {\n- *     Operand<?> featureBatch = components.get(0);\n- *     Operand<?> labelBatch = components.get(1);\n+ *     Operand<?> XBatch = components.get(0);\n+ *     Operand<?> yBatch = components.get(1);\n  *\n- *     loss = computeModelLoss(featureBatch, labelBatch);\n+ *     loss = computeModelLoss(X, y);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1e841e4ca57be6a0a3423a4232364b6e26a7e1b3"}, "originalPosition": 87}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjcyMDE3MA==", "bodyText": "Typo: \"componenet\"", "url": "https://github.com/tensorflow/java/pull/52#discussion_r422720170", "createdAt": "2020-05-11T00:00:18Z", "author": {"login": "Craigacp"}, "path": "tensorflow-framework/src/main/java/org/tensorflow/framework/data/DatasetIterator.java", "diffHunk": "@@ -119,7 +125,7 @@\n    * @param outputShapes A list of `Shape` objects corresponding to the shapes of each componenet of", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1e841e4ca57be6a0a3423a4232364b6e26a7e1b3"}, "originalPosition": 110}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjcyMDMyMg==", "bodyText": "Copyright", "url": "https://github.com/tensorflow/java/pull/52#discussion_r422720322", "createdAt": "2020-05-11T00:01:39Z", "author": {"login": "Craigacp"}, "path": "tensorflow-framework/src/main/java/org/tensorflow/framework/data/impl/BatchDataset.java", "diffHunk": "@@ -1,5 +1,5 @@\n /*\n- * Copyright 2020 The TensorFlow Authors. All rights reserved.\n+ * Copyright (c) 2020, Oracle and/or its affiliates. All rights reserved.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1e841e4ca57be6a0a3423a4232364b6e26a7e1b3"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjcyMDM0Mg==", "bodyText": "Copyright", "url": "https://github.com/tensorflow/java/pull/52#discussion_r422720342", "createdAt": "2020-05-11T00:01:47Z", "author": {"login": "Craigacp"}, "path": "tensorflow-framework/src/main/java/org/tensorflow/framework/data/DatasetOptional.java", "diffHunk": "@@ -1,5 +1,5 @@\n /*\n- * Copyright 2020 The TensorFlow Authors. All rights reserved.\n+ * Copyright (c) 2020, Oracle and/or its affiliates. All rights reserved.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1e841e4ca57be6a0a3423a4232364b6e26a7e1b3"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjcyMDQxMA==", "bodyText": "Missing copyright and license.", "url": "https://github.com/tensorflow/java/pull/52#discussion_r422720410", "createdAt": "2020-05-11T00:02:34Z", "author": {"login": "Craigacp"}, "path": "tensorflow-framework/src/main/java/org/tensorflow/framework/data/impl/MapIterator.java", "diffHunk": "@@ -0,0 +1,32 @@\n+package org.tensorflow.framework.data.impl;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1e841e4ca57be6a0a3423a4232364b6e26a7e1b3"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjcyMDUzMQ==", "bodyText": "Where does tf come from here?", "url": "https://github.com/tensorflow/java/pull/52#discussion_r422720531", "createdAt": "2020-05-11T00:03:27Z", "author": {"login": "Craigacp"}, "path": "tensorflow-framework/src/main/java/org/tensorflow/framework/data/impl/MapIterator.java", "diffHunk": "@@ -0,0 +1,32 @@\n+package org.tensorflow.framework.data.impl;\n+\n+import org.tensorflow.DataType;\n+import org.tensorflow.Operand;\n+import org.tensorflow.framework.data.DatasetIterator;\n+import org.tensorflow.framework.data.DatasetOptional;\n+import org.tensorflow.op.Ops;\n+\n+import java.util.List;\n+import java.util.function.BiFunction;\n+\n+public class MapIterator extends DatasetIterator {\n+  private final BiFunction<Ops, List<Operand<?>>, List<Operand<?>>> mapper;\n+\n+  public MapIterator(\n+      DatasetIterator source,\n+      BiFunction<Ops, List<Operand<?>>, List<Operand<?>>> mapper) {\n+    super(source);\n+    this.mapper = mapper;\n+  }\n+\n+  @Override\n+  public List<Operand<?>> getNext() {\n+    return mapper.apply(tf, super.getNext());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1e841e4ca57be6a0a3423a4232364b6e26a7e1b3"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjcyMDU2Ng==", "bodyText": "Copyright", "url": "https://github.com/tensorflow/java/pull/52#discussion_r422720566", "createdAt": "2020-05-11T00:03:44Z", "author": {"login": "Craigacp"}, "path": "tensorflow-framework/src/main/java/org/tensorflow/framework/data/impl/SkipDataset.java", "diffHunk": "@@ -1,5 +1,5 @@\n /*\n- * Copyright 2020 The TensorFlow Authors. All rights reserved.\n+ * Copyright (c) 2020, Oracle and/or its affiliates. All rights reserved.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1e841e4ca57be6a0a3423a4232364b6e26a7e1b3"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjcyMDY0MQ==", "bodyText": "Copyright", "url": "https://github.com/tensorflow/java/pull/52#discussion_r422720641", "createdAt": "2020-05-11T00:04:28Z", "author": {"login": "Craigacp"}, "path": "tensorflow-framework/src/main/java/org/tensorflow/framework/data/impl/TakeDataset.java", "diffHunk": "@@ -1,5 +1,5 @@\n /*\n- * Copyright 2020 The TensorFlow Authors. All rights reserved.\n+ * Copyright (c) 2020, Oracle and/or its affiliates. All rights reserved.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1e841e4ca57be6a0a3423a4232364b6e26a7e1b3"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjcyMDY1Ng==", "bodyText": "Missing copyright and license", "url": "https://github.com/tensorflow/java/pull/52#discussion_r422720656", "createdAt": "2020-05-11T00:04:35Z", "author": {"login": "Craigacp"}, "path": "tensorflow-framework/src/main/java/org/tensorflow/framework/data/impl/TFRecordDataset.java", "diffHunk": "@@ -0,0 +1,29 @@\n+package org.tensorflow.framework.data.impl;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1e841e4ca57be6a0a3423a4232364b6e26a7e1b3"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjcyMDY4MQ==", "bodyText": "Copyright", "url": "https://github.com/tensorflow/java/pull/52#discussion_r422720681", "createdAt": "2020-05-11T00:04:49Z", "author": {"login": "Craigacp"}, "path": "tensorflow-framework/src/main/java/org/tensorflow/framework/data/impl/TensorSliceDataset.java", "diffHunk": "@@ -1,5 +1,5 @@\n /*\n- * Copyright 2020 The TensorFlow Authors. All rights reserved.\n+ * Copyright (c) 2020, Oracle and/or its affiliates. All rights reserved.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1e841e4ca57be6a0a3423a4232364b6e26a7e1b3"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjcyMDY5Nw==", "bodyText": "Missing copyright and license", "url": "https://github.com/tensorflow/java/pull/52#discussion_r422720697", "createdAt": "2020-05-11T00:04:58Z", "author": {"login": "Craigacp"}, "path": "tensorflow-framework/src/main/java/org/tensorflow/framework/data/impl/TextLineDataset.java", "diffHunk": "@@ -0,0 +1,29 @@\n+package org.tensorflow.framework.data.impl;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1e841e4ca57be6a0a3423a4232364b6e26a7e1b3"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjcyMDczMg==", "bodyText": "No star imports", "url": "https://github.com/tensorflow/java/pull/52#discussion_r422720732", "createdAt": "2020-05-11T00:05:18Z", "author": {"login": "Craigacp"}, "path": "tensorflow-framework/src/test/java/org/tensorflow/framework/data/MapDatasetTest.java", "diffHunk": "@@ -0,0 +1,113 @@\n+package org.tensorflow.framework.data;\n+\n+import org.tensorflow.*;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1e841e4ca57be6a0a3423a4232364b6e26a7e1b3"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjcyMDc1NQ==", "bodyText": "Missing copyright and license", "url": "https://github.com/tensorflow/java/pull/52#discussion_r422720755", "createdAt": "2020-05-11T00:05:25Z", "author": {"login": "Craigacp"}, "path": "tensorflow-framework/src/test/java/org/tensorflow/framework/data/MapDatasetTest.java", "diffHunk": "@@ -0,0 +1,113 @@\n+package org.tensorflow.framework.data;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1e841e4ca57be6a0a3423a4232364b6e26a7e1b3"}, "originalPosition": 1}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cde9eb8a5206ce16d4bb84a4ac3895c0380147a7", "author": {"user": {"login": "dhruvrajan", "name": "Dhruv Rajan"}}, "url": "https://github.com/tensorflow/java/commit/cde9eb8a5206ce16d4bb84a4ac3895c0380147a7", "committedDate": "2020-05-11T00:00:54Z", "message": "fix copyright comments"}, "afterCommit": {"oid": "93663589e3291ff8f68c358059a3944d90ee9152", "author": {"user": {"login": "dhruvrajan", "name": "Dhruv Rajan"}}, "url": "https://github.com/tensorflow/java/commit/93663589e3291ff8f68c358059a3944d90ee9152", "committedDate": "2020-05-11T00:09:02Z", "message": "fix copyright comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4Nzk2ODI4", "url": "https://github.com/tensorflow/java/pull/52#pullrequestreview-408796828", "createdAt": "2020-05-11T00:11:09Z", "commit": {"oid": "93663589e3291ff8f68c358059a3944d90ee9152"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQwMDoxMToxMFrOGTI3xA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQwMDoxMToxMFrOGTI3xA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjcyMTQ3Ng==", "bodyText": "Random g. Do you use vim perchance?", "url": "https://github.com/tensorflow/java/pull/52#discussion_r422721476", "createdAt": "2020-05-11T00:11:10Z", "author": {"login": "Craigacp"}, "path": "tensorflow-framework/src/test/java/org/tensorflow/framework/data/TakeDatasetTest.java", "diffHunk": "@@ -11,7 +25,7 @@\n import java.util.List;\n \n import static org.junit.Assert.assertEquals;\n-\n+g", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "93663589e3291ff8f68c358059a3944d90ee9152"}, "originalPosition": 29}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "93663589e3291ff8f68c358059a3944d90ee9152", "author": {"user": {"login": "dhruvrajan", "name": "Dhruv Rajan"}}, "url": "https://github.com/tensorflow/java/commit/93663589e3291ff8f68c358059a3944d90ee9152", "committedDate": "2020-05-11T00:09:02Z", "message": "fix copyright comments"}, "afterCommit": {"oid": "59be22d79b4ef2a941510c764820e4469d11a5ad", "author": {"user": {"login": "dhruvrajan", "name": "Dhruv Rajan"}}, "url": "https://github.com/tensorflow/java/commit/59be22d79b4ef2a941510c764820e4469d11a5ad", "committedDate": "2020-05-11T00:12:06Z", "message": "fix copyright comments"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "59be22d79b4ef2a941510c764820e4469d11a5ad", "author": {"user": {"login": "dhruvrajan", "name": "Dhruv Rajan"}}, "url": "https://github.com/tensorflow/java/commit/59be22d79b4ef2a941510c764820e4469d11a5ad", "committedDate": "2020-05-11T00:12:06Z", "message": "fix copyright comments"}, "afterCommit": {"oid": "2ccf9a3f0e2d7a72537022f8b067f9f03279120a", "author": {"user": {"login": "dhruvrajan", "name": "Dhruv Rajan"}}, "url": "https://github.com/tensorflow/java/commit/2ccf9a3f0e2d7a72537022f8b067f9f03279120a", "committedDate": "2020-05-11T00:13:13Z", "message": "fix copyright comments"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2ccf9a3f0e2d7a72537022f8b067f9f03279120a", "author": {"user": {"login": "dhruvrajan", "name": "Dhruv Rajan"}}, "url": "https://github.com/tensorflow/java/commit/2ccf9a3f0e2d7a72537022f8b067f9f03279120a", "committedDate": "2020-05-11T00:13:13Z", "message": "fix copyright comments"}, "afterCommit": {"oid": "28b49abe00732e6438cb54263c9eeda7546c4a0c", "author": {"user": {"login": "dhruvrajan", "name": "Dhruv Rajan"}}, "url": "https://github.com/tensorflow/java/commit/28b49abe00732e6438cb54263c9eeda7546c4a0c", "committedDate": "2020-05-11T00:14:40Z", "message": "fix copyright comments"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "28b49abe00732e6438cb54263c9eeda7546c4a0c", "author": {"user": {"login": "dhruvrajan", "name": "Dhruv Rajan"}}, "url": "https://github.com/tensorflow/java/commit/28b49abe00732e6438cb54263c9eeda7546c4a0c", "committedDate": "2020-05-11T00:14:40Z", "message": "fix copyright comments"}, "afterCommit": {"oid": "66319d89b265f143154133e5e1e6e9989cd0d3a8", "author": {"user": {"login": "dhruvrajan", "name": "Dhruv Rajan"}}, "url": "https://github.com/tensorflow/java/commit/66319d89b265f143154133e5e1e6e9989cd0d3a8", "committedDate": "2020-05-11T00:16:52Z", "message": "fix copyright comments"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "243496568fcc399b7a3cf5539c6a9cb85580d18a", "author": {"user": {"login": "dhruvrajan", "name": "Dhruv Rajan"}}, "url": "https://github.com/tensorflow/java/commit/243496568fcc399b7a3cf5539c6a9cb85580d18a", "committedDate": "2020-05-11T06:31:28Z", "message": "use captured Ops object for dataset map"}, "afterCommit": {"oid": "2aff47af0cf267d03366ec3ea12d65fbc19d5c1a", "author": {"user": {"login": "dhruvrajan", "name": "Dhruv Rajan"}}, "url": "https://github.com/tensorflow/java/commit/2aff47af0cf267d03366ec3ea12d65fbc19d5c1a", "committedDate": "2020-05-11T06:33:42Z", "message": "use captured Ops object for dataset map"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2aff47af0cf267d03366ec3ea12d65fbc19d5c1a", "author": {"user": {"login": "dhruvrajan", "name": "Dhruv Rajan"}}, "url": "https://github.com/tensorflow/java/commit/2aff47af0cf267d03366ec3ea12d65fbc19d5c1a", "committedDate": "2020-05-11T06:33:42Z", "message": "use captured Ops object for dataset map"}, "afterCommit": {"oid": "9934179919462768e01f9b32714a69e20188a460", "author": {"user": {"login": "dhruvrajan", "name": "Dhruv Rajan"}}, "url": "https://github.com/tensorflow/java/commit/9934179919462768e01f9b32714a69e20188a460", "committedDate": "2020-05-11T06:55:03Z", "message": "use captured Ops object for dataset map"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExNDM5NDYx", "url": "https://github.com/tensorflow/java/pull/52#pullrequestreview-411439461", "createdAt": "2020-05-14T03:24:15Z", "commit": {"oid": "9934179919462768e01f9b32714a69e20188a460"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQwMzoyNDoxNVrOGVKveA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQwMzo1NjoyNFrOGVLMtA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDg0OTI3Mg==", "bodyText": "While streams are more convenient syntactically, they are not as performant as a good ol' iteration so since we are writing a framework, maybe we should opt for the fastest path?", "url": "https://github.com/tensorflow/java/pull/52#discussion_r424849272", "createdAt": "2020-05-14T03:24:15Z", "author": {"login": "karllessard"}, "path": "tensorflow-framework/src/main/java/org/tensorflow/framework/data/DatasetIterator.java", "diffHunk": "@@ -235,6 +248,69 @@ public static DatasetIterator fromStructure(\n     return new DatasetIterator(tf, iteratorResource, outputTypes, outputShapes);\n   }\n \n+  /**\n+   * Returns a new DatasetIterator which maps a function across all elements from this iterator, on\n+   * a single component of each element.\n+   *\n+   * <p>For example, suppose each element is a `List<Operand<?>>` with 2 components: (features,\n+   * labels).\n+   *\n+   * <p>Calling `iterator.mapOneComponent(0, features -> tf.math.mul(features,\n+   * tf.constant(2)))` will map the function over the `features` component of each element,\n+   * multiplying each by 2.\n+   *\n+   * @param index The index of the component to transform.\n+   * @param mapper The function to apply to the target component.\n+   * @return A new DatasetIterator applying `mapper` to the component at the chosen index.\n+   */\n+  public DatasetIterator mapOneComponent(int index, Function<Operand<?>, Operand<?>> mapper) {\n+    return map(\n+        outputs -> {\n+          List<Operand<?>> newComponents = new ArrayList<>(outputs);\n+          newComponents.set(index, mapper.apply(outputs.get(index)));\n+          return newComponents;\n+        });\n+  }\n+\n+  /**\n+   * Returns a new DatasetIterator which maps a function across all elements from this iterator, on\n+   * all components of each element.\n+   *\n+   * <p>For example, suppose each element is a `List<Operand<?>>` with 2 components: (features,\n+   * labels).\n+   *\n+   * <p>Calling `iterator.mapAllComponents(component -> tf.math.mul(component,\n+   * tf.constant(2)))` will map the function over the both the `features` and `labels` components of\n+   * each element, multiplying them all by 2\n+   *\n+   * @param mapper The function to apply to each component\n+   * @return A new DatasetIterator applying `mapper` to all components of each element.\n+   */\n+  public DatasetIterator mapAllComponents(Function<Operand<?>, Operand<?>> mapper) {\n+    return map(outputs -> outputs.stream().map(mapper::apply).collect(Collectors.toList()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9934179919462768e01f9b32714a69e20188a460"}, "originalPosition": 148}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDg1Njc1Ng==", "bodyText": "Maybe just a little preference to pass explicitly the Ops parameter instead of getting it from the source dataset, otherwise it sounds like the Ops instance is \"owned\" by the source while we simply want to share it across object creation.\nBTW, it looks like this constructor could be package-private? And I think it's the case for other classes in the dataset framework, might worth going through them and protect those we can so we enforce the usage of the factory methods instead.", "url": "https://github.com/tensorflow/java/pull/52#discussion_r424856756", "createdAt": "2020-05-14T03:56:24Z", "author": {"login": "karllessard"}, "path": "tensorflow-framework/src/main/java/org/tensorflow/framework/data/impl/MapOptional.java", "diffHunk": "@@ -0,0 +1,42 @@\n+/*\n+ * Copyright 2020 The TensorFlow Authors. All rights reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.tensorflow.framework.data.impl;\n+\n+import org.tensorflow.DataType;\n+import org.tensorflow.Operand;\n+import org.tensorflow.framework.data.DatasetOptional;\n+import org.tensorflow.tools.Shape;\n+\n+import java.util.List;\n+import java.util.function.Function;\n+\n+public class MapOptional extends DatasetOptional {\n+  private final Function<List<Operand<?>>, List<Operand<?>>> mapper;\n+\n+  public MapOptional(\n+      DatasetOptional source,\n+      Function<List<Operand<?>>, List<Operand<?>>> mapper,\n+      List<DataType<?>> outputTypes,\n+      List<Shape> outputShapes) {\n+    super(source.getOpsInstance(), source.getOptionalVariant(), outputTypes, outputShapes);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9934179919462768e01f9b32714a69e20188a460"}, "originalPosition": 34}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bc0a82c5dbb64a398acd0c4220707ffb41ca88c1", "author": {"user": {"login": "dhruvrajan", "name": "Dhruv Rajan"}}, "url": "https://github.com/tensorflow/java/commit/bc0a82c5dbb64a398acd0c4220707ffb41ca88c1", "committedDate": "2020-05-16T04:29:36Z", "message": "refactor method and constructor access"}, "afterCommit": {"oid": "0a49745b06e4fd00fb569488b7fecf66da75f710", "author": {"user": {"login": "dhruvrajan", "name": "Dhruv Rajan"}}, "url": "https://github.com/tensorflow/java/commit/0a49745b06e4fd00fb569488b7fecf66da75f710", "committedDate": "2020-05-16T04:37:36Z", "message": "refactor method and constructor access"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd70c9d557066ebb76b90c64382d6bf062f776fb", "author": {"user": {"login": "dhruvrajan", "name": "Dhruv Rajan"}}, "url": "https://github.com/tensorflow/java/commit/bd70c9d557066ebb76b90c64382d6bf062f776fb", "committedDate": "2020-05-16T04:49:19Z", "message": "Add functionality to map over dataset elements in both graph and eager mode."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "37ed42228e8f5843a5b9168f882eb45e83ad9c67", "author": {"user": {"login": "dhruvrajan", "name": "Dhruv Rajan"}}, "url": "https://github.com/tensorflow/java/commit/37ed42228e8f5843a5b9168f882eb45e83ad9c67", "committedDate": "2020-05-16T04:49:19Z", "message": "fix copyright comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6c86d38e2d232453c9bbd5606a9c890a2db132e2", "author": {"user": {"login": "dhruvrajan", "name": "Dhruv Rajan"}}, "url": "https://github.com/tensorflow/java/commit/6c86d38e2d232453c9bbd5606a9c890a2db132e2", "committedDate": "2020-05-16T04:49:19Z", "message": "use captured Ops object for dataset map"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f2eb8cbda4a9d74256d44f863695a28fe1ae8ee0", "author": {"user": {"login": "dhruvrajan", "name": "Dhruv Rajan"}}, "url": "https://github.com/tensorflow/java/commit/f2eb8cbda4a9d74256d44f863695a28fe1ae8ee0", "committedDate": "2020-05-16T04:49:19Z", "message": "refactor method and constructor access"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0a49745b06e4fd00fb569488b7fecf66da75f710", "author": {"user": {"login": "dhruvrajan", "name": "Dhruv Rajan"}}, "url": "https://github.com/tensorflow/java/commit/0a49745b06e4fd00fb569488b7fecf66da75f710", "committedDate": "2020-05-16T04:37:36Z", "message": "refactor method and constructor access"}, "afterCommit": {"oid": "48cb21ede359ec9685571a9d5fc6c9c0f90d8084", "author": {"user": {"login": "dhruvrajan", "name": "Dhruv Rajan"}}, "url": "https://github.com/tensorflow/java/commit/48cb21ede359ec9685571a9d5fc6c9c0f90d8084", "committedDate": "2020-05-17T00:09:01Z", "message": "move map methods to Dataset class"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "48cb21ede359ec9685571a9d5fc6c9c0f90d8084", "author": {"user": {"login": "dhruvrajan", "name": "Dhruv Rajan"}}, "url": "https://github.com/tensorflow/java/commit/48cb21ede359ec9685571a9d5fc6c9c0f90d8084", "committedDate": "2020-05-17T00:09:01Z", "message": "move map methods to Dataset class"}, "afterCommit": {"oid": "3aca9ed97b682d8a98aaf801a6f8ca7bd56927fe", "author": {"user": {"login": "dhruvrajan", "name": "Dhruv Rajan"}}, "url": "https://github.com/tensorflow/java/commit/3aca9ed97b682d8a98aaf801a6f8ca7bd56927fe", "committedDate": "2020-05-17T00:13:05Z", "message": "move map methods to Dataset class"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3aca9ed97b682d8a98aaf801a6f8ca7bd56927fe", "author": {"user": {"login": "dhruvrajan", "name": "Dhruv Rajan"}}, "url": "https://github.com/tensorflow/java/commit/3aca9ed97b682d8a98aaf801a6f8ca7bd56927fe", "committedDate": "2020-05-17T00:13:05Z", "message": "move map methods to Dataset class"}, "afterCommit": {"oid": "57ec8ea9d61c59191cab95716e1483d6e1c2073b", "author": {"user": {"login": "dhruvrajan", "name": "Dhruv Rajan"}}, "url": "https://github.com/tensorflow/java/commit/57ec8ea9d61c59191cab95716e1483d6e1c2073b", "committedDate": "2020-05-17T00:19:14Z", "message": "move map methods to Dataset class"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "57ec8ea9d61c59191cab95716e1483d6e1c2073b", "author": {"user": {"login": "dhruvrajan", "name": "Dhruv Rajan"}}, "url": "https://github.com/tensorflow/java/commit/57ec8ea9d61c59191cab95716e1483d6e1c2073b", "committedDate": "2020-05-17T00:19:14Z", "message": "move map methods to Dataset class"}, "afterCommit": {"oid": "9ca40747021b1b401cb3f4a63aaac800562549d5", "author": {"user": {"login": "dhruvrajan", "name": "Dhruv Rajan"}}, "url": "https://github.com/tensorflow/java/commit/9ca40747021b1b401cb3f4a63aaac800562549d5", "committedDate": "2020-05-17T00:57:03Z", "message": "move map methods to Dataset class"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0MDU3NjQy", "url": "https://github.com/tensorflow/java/pull/52#pullrequestreview-414057642", "createdAt": "2020-05-19T02:25:11Z", "commit": {"oid": "9ca40747021b1b401cb3f4a63aaac800562549d5"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQwMjoyNToxMVrOGXNl7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQwMjozMDoxOVrOGXNrQg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjk5MzEzNQ==", "bodyText": "Update the return type to Dataset instead of DatasetIterator (same for other methods below)", "url": "https://github.com/tensorflow/java/pull/52#discussion_r426993135", "createdAt": "2020-05-19T02:25:11Z", "author": {"login": "karllessard"}, "path": "tensorflow-framework/src/main/java/org/tensorflow/framework/data/Dataset.java", "diffHunk": "@@ -107,6 +123,72 @@ public final Dataset take(long count) {\n         tf, this.getVariant(), tf.constant(count), this.getOutputTypes(), this.getOutputShapes());\r\n   }\r\n \r\n+  /**\r\n+   * Returns a new Dataset which maps a function across all elements from this iterator, on a single\r\n+   * component of each element.\r\n+   *\r\n+   * <p>For example, suppose each element is a `List<Operand<?>>` with 2 components: (features,\r\n+   * labels).\r\n+   *\r\n+   * <p>Calling `iterator.mapOneComponent(0, features -> tf.math.mul(features, tf.constant(2)))`\r\n+   * will map the function over the `features` component of each element, multiplying each by 2.\r\n+   *\r\n+   * @param index The index of the component to transform.\r\n+   * @param mapper The function to apply to the target component.\r\n+   * @return A new DatasetIterator applying `mapper` to the component at the chosen index.\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9ca40747021b1b401cb3f4a63aaac800562549d5"}, "originalPosition": 84}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjk5MzMwOA==", "bodyText": "update to dataset.mapOneComponent (idem for other methods below).\nBy the way in Java, you want to use {@code ...} for code snippets in your Javadoc instead of backquotes.", "url": "https://github.com/tensorflow/java/pull/52#discussion_r426993308", "createdAt": "2020-05-19T02:25:46Z", "author": {"login": "karllessard"}, "path": "tensorflow-framework/src/main/java/org/tensorflow/framework/data/Dataset.java", "diffHunk": "@@ -107,6 +123,72 @@ public final Dataset take(long count) {\n         tf, this.getVariant(), tf.constant(count), this.getOutputTypes(), this.getOutputShapes());\r\n   }\r\n \r\n+  /**\r\n+   * Returns a new Dataset which maps a function across all elements from this iterator, on a single\r\n+   * component of each element.\r\n+   *\r\n+   * <p>For example, suppose each element is a `List<Operand<?>>` with 2 components: (features,\r\n+   * labels).\r\n+   *\r\n+   * <p>Calling `iterator.mapOneComponent(0, features -> tf.math.mul(features, tf.constant(2)))`\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9ca40747021b1b401cb3f4a63aaac800562549d5"}, "originalPosition": 79}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjk5NDE0Mg==", "bodyText": "again instead of triple backquotes ``` (which should help with Javadoc, did it?, you should go with a block like this:\n<pre>{@code\nyour \nmultiline \ncode\nhere\n}</pre>", "url": "https://github.com/tensorflow/java/pull/52#discussion_r426994142", "createdAt": "2020-05-19T02:29:05Z", "author": {"login": "karllessard"}, "path": "tensorflow-framework/src/main/java/org/tensorflow/framework/data/Dataset.java", "diffHunk": "@@ -107,6 +123,72 @@ public final Dataset take(long count) {\n         tf, this.getVariant(), tf.constant(count), this.getOutputTypes(), this.getOutputShapes());\r\n   }\r\n \r\n+  /**\r\n+   * Returns a new Dataset which maps a function across all elements from this iterator, on a single\r\n+   * component of each element.\r\n+   *\r\n+   * <p>For example, suppose each element is a `List<Operand<?>>` with 2 components: (features,\r\n+   * labels).\r\n+   *\r\n+   * <p>Calling `iterator.mapOneComponent(0, features -> tf.math.mul(features, tf.constant(2)))`\r\n+   * will map the function over the `features` component of each element, multiplying each by 2.\r\n+   *\r\n+   * @param index The index of the component to transform.\r\n+   * @param mapper The function to apply to the target component.\r\n+   * @return A new DatasetIterator applying `mapper` to the component at the chosen index.\r\n+   */\r\n+  public Dataset mapOneComponent(int index, Function<Operand<?>, Operand<?>> mapper) {\r\n+    return map(\r\n+        outputs -> {\r\n+          List<Operand<?>> newComponents = new ArrayList<>(outputs);\r\n+          newComponents.set(index, mapper.apply(outputs.get(index)));\r\n+          return newComponents;\r\n+        });\r\n+  }\r\n+\r\n+  /**\r\n+   * Returns a new Dataset which maps a function across all elements from this iterator, on all\r\n+   * components of each element.\r\n+   *\r\n+   * <p>For example, suppose each element is a `List<Operand<?>>` with 2 components: (features,\r\n+   * labels).\r\n+   *\r\n+   * <p>Calling `iterator.mapAllComponents(component -> tf.math.mul(component, tf.constant(2)))`\r\n+   * will map the function over the both the `features` and `labels` components of each element,\r\n+   * multiplying them all by 2\r\n+   *\r\n+   * @param mapper The function to apply to each component\r\n+   * @return A new DatasetIterator applying `mapper` to all components of each element.\r\n+   */\r\n+  public Dataset mapAllComponents(Function<Operand<?>, Operand<?>> mapper) {\r\n+    return map(\r\n+        outputs -> {\r\n+          List<Operand<?>> mappedOutputs = new ArrayList<>();\r\n+          outputs.forEach(o -> mappedOutputs.add(mapper.apply(o)));\r\n+          return mappedOutputs;\r\n+        });\r\n+  }\r\n+\r\n+  /**\r\n+   * Returns a new Dataset which maps a function over all elements returned by this iterator.\r\n+   *\r\n+   * <p>For example, suppose each element is a `List<Operand<?>>` with 2 components: (features,\r\n+   * labels).\r\n+   *\r\n+   * <p>Calling ``` iterator.map(components -> { Operand<?> features = components.get(0); Operand<?>\r\n+   * labels = components.get(1);\r\n+   *\r\n+   * <p>return Arrays.asList( tf.math.mul(features, tf.constant(2)), tf.math.mul(labels,\r\n+   * tf.constant(5)) ); }) ``` will map the function over the `features` and `labels` components,\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9ca40747021b1b401cb3f4a63aaac800562549d5"}, "originalPosition": 128}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjk5NDQ5OA==", "bodyText": "missing copyrights", "url": "https://github.com/tensorflow/java/pull/52#discussion_r426994498", "createdAt": "2020-05-19T02:30:19Z", "author": {"login": "karllessard"}, "path": "tensorflow-framework/src/main/java/org/tensorflow/framework/data/impl/MapDataset.java", "diffHunk": "@@ -0,0 +1,28 @@\n+package org.tensorflow.framework.data.impl;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9ca40747021b1b401cb3f4a63aaac800562549d5"}, "originalPosition": 1}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "efc4b350591329629ad5a3cd1909a75dc63c9f78", "author": {"user": {"login": "dhruvrajan", "name": "Dhruv Rajan"}}, "url": "https://github.com/tensorflow/java/commit/efc4b350591329629ad5a3cd1909a75dc63c9f78", "committedDate": "2020-05-19T04:22:23Z", "message": "move map methods to Dataset class"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9ca40747021b1b401cb3f4a63aaac800562549d5", "author": {"user": {"login": "dhruvrajan", "name": "Dhruv Rajan"}}, "url": "https://github.com/tensorflow/java/commit/9ca40747021b1b401cb3f4a63aaac800562549d5", "committedDate": "2020-05-17T00:57:03Z", "message": "move map methods to Dataset class"}, "afterCommit": {"oid": "efc4b350591329629ad5a3cd1909a75dc63c9f78", "author": {"user": {"login": "dhruvrajan", "name": "Dhruv Rajan"}}, "url": "https://github.com/tensorflow/java/commit/efc4b350591329629ad5a3cd1909a75dc63c9f78", "committedDate": "2020-05-19T04:22:23Z", "message": "move map methods to Dataset class"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0MDkzMTcw", "url": "https://github.com/tensorflow/java/pull/52#pullrequestreview-414093170", "createdAt": "2020-05-19T04:28:56Z", "commit": {"oid": "efc4b350591329629ad5a3cd1909a75dc63c9f78"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3442, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}