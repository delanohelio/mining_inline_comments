{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ2MzI5MTU2", "number": 178, "title": "Initialization imprvements", "bodyText": "Makes three simple improvements to initialization:\n\nMakes Ops.initAdd no-op in eager mode, since the op has already been ran.\nAdds a runInit() method to Session that runs the graph's initializers.\nAdds a doInitialization() method to Session.Runner to add the initializers as targets.\n\nThere's no changes that conflict w/ the type refactor, so I'll just wait till it's merged and rebase onto master.", "createdAt": "2020-12-29T05:17:31Z", "url": "https://github.com/tensorflow/java/pull/178", "merged": true, "mergeCommit": {"oid": "0fc54c8c5c250cd4a2536aec4e62fff90bb0c3f4"}, "closed": true, "closedAt": "2021-01-07T05:28:13Z", "author": {"login": "rnett"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdq89_SAFqTU1OTU5NzM4NQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdttQgVgFqTU2MzIxODc4OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU5NTk3Mzg1", "url": "https://github.com/tensorflow/java/pull/178#pullrequestreview-559597385", "createdAt": "2020-12-29T16:04:04Z", "commit": {"oid": "2d1f54b316291217f7de3da6fb0da3214cb48c19"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQxNjowNDowNFrOIMSnQg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQxNjowNDowNFrOIMSnQg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTc1ODc4Ng==", "bodyText": "Why leave the exception in there if it's not triggered?", "url": "https://github.com/tensorflow/java/pull/178#discussion_r549758786", "createdAt": "2020-12-29T16:04:04Z", "author": {"login": "Craigacp"}, "path": "tensorflow-core/tensorflow-core-api/src/main/java/org/tensorflow/op/core/Init.java", "diffHunk": "@@ -89,16 +89,18 @@ public static Init create(Scope scope) {\n    *\n    * <p>Registered initializers are then grouped as a single unit of computation by adding\n    * and executing an {@link org.tensorflow.op.core.Init#create(Scope) init} operation from a graph\n-   * session.\n+   * session.  No-ops if the session is eager.\n    *\n    * @param scope\n    * @param initializer\n-   * @throws IllegalArgumentException if the execution environment in scope is not a graph\n    * @see org.tensorflow.op.core.Init#create(Scope) init\n    */\n   @Endpoint(name = \"initAdd\")\n   public static void add(Scope scope, Op initializer) {\n     ExecutionEnvironment exEnv = scope.env();\n+    if(exEnv.isEager()){\n+      return;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d1f54b316291217f7de3da6fb0da3214cb48c19"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e449b7a9016ada4320b59e999c5cc80e44fefe54", "author": {"user": {"login": "rnett", "name": "Ryan Nett"}}, "url": "https://github.com/tensorflow/java/commit/e449b7a9016ada4320b59e999c5cc80e44fefe54", "committedDate": "2020-12-30T23:01:07Z", "message": "No-op on initAdd in eager mode\n\nSigned-off-by: Ryan Nett <rnett@calpoly.edu>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cbfe6ebb1a25b2a1436a3680cd9d624712a0f9f0", "author": {"user": {"login": "rnett", "name": "Ryan Nett"}}, "url": "https://github.com/tensorflow/java/commit/cbfe6ebb1a25b2a1436a3680cd9d624712a0f9f0", "committedDate": "2020-12-30T23:01:07Z", "message": "runInit() method in session\n\nSigned-off-by: Ryan Nett <rnett@calpoly.edu>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "72067411a8b570b3e3ec7049a1527d2e076f28b5", "author": {"user": {"login": "rnett", "name": "Ryan Nett"}}, "url": "https://github.com/tensorflow/java/commit/72067411a8b570b3e3ec7049a1527d2e076f28b5", "committedDate": "2020-12-30T23:01:07Z", "message": "add doInitialization() to Runner\n\nSigned-off-by: Ryan Nett <rnett@calpoly.edu>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "304dc00c8b3d2eebdb266aab7ae67fd029582a5f", "author": {"user": {"login": "rnett", "name": "Ryan Nett"}}, "url": "https://github.com/tensorflow/java/commit/304dc00c8b3d2eebdb266aab7ae67fd029582a5f", "committedDate": "2020-12-30T23:01:53Z", "message": "fix javadoc\n\nSigned-off-by: Ryan Nett <rnett@calpoly.edu>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2d1f54b316291217f7de3da6fb0da3214cb48c19", "author": {"user": {"login": "rnett", "name": "Ryan Nett"}}, "url": "https://github.com/tensorflow/java/commit/2d1f54b316291217f7de3da6fb0da3214cb48c19", "committedDate": "2020-12-29T05:17:37Z", "message": "add doInitialization() to Runner\n\nSigned-off-by: Ryan Nett <rnett@calpoly.edu>"}, "afterCommit": {"oid": "304dc00c8b3d2eebdb266aab7ae67fd029582a5f", "author": {"user": {"login": "rnett", "name": "Ryan Nett"}}, "url": "https://github.com/tensorflow/java/commit/304dc00c8b3d2eebdb266aab7ae67fd029582a5f", "committedDate": "2020-12-30T23:01:53Z", "message": "fix javadoc\n\nSigned-off-by: Ryan Nett <rnett@calpoly.edu>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYwNTkyNDEy", "url": "https://github.com/tensorflow/java/pull/178#pullrequestreview-560592412", "createdAt": "2021-01-01T15:38:06Z", "commit": {"oid": "304dc00c8b3d2eebdb266aab7ae67fd029582a5f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wMVQxNTozODowNlrOINQ5rQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wMVQxNTozODowNlrOINQ5rQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDc3OTMwOQ==", "bodyText": "I think pretty much all over the code, while we \"might\" have to support later a third execution environment type, we kind of assume that there is only to. So I would only simplify this method with:\nif (exEnv.isGraph()) {\n   Graph graph = (Graph) exEnv;\n   graph.addInitializer(initializer);\n}", "url": "https://github.com/tensorflow/java/pull/178#discussion_r550779309", "createdAt": "2021-01-01T15:38:06Z", "author": {"login": "karllessard"}, "path": "tensorflow-core/tensorflow-core-api/src/main/java/org/tensorflow/op/core/Init.java", "diffHunk": "@@ -89,18 +89,20 @@ public static Init create(Scope scope) {\n    *\n    * <p>Registered initializers are then grouped as a single unit of computation by adding\n    * and executing an {@link org.tensorflow.op.core.Init#create(Scope) init} operation from a graph\n-   * session.\n+   * session.  No-ops if the session is eager.\n    *\n    * @param scope\n    * @param initializer\n-   * @throws IllegalArgumentException if the execution environment in scope is not a graph\n    * @see org.tensorflow.op.core.Init#create(Scope) init\n    */\n   @Endpoint(name = \"initAdd\")\n   public static void add(Scope scope, Op initializer) {\n     ExecutionEnvironment exEnv = scope.env();\n+    if(exEnv.isEager()){\n+      return;\n+    }\n     if (!(exEnv instanceof Graph)) {\n-      throw new IllegalArgumentException(\"initAdd is only supported on Graph sessions.\");\n+      throw new IllegalArgumentException(\"initAdd is only supported on Graph or eager sessions.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "304dc00c8b3d2eebdb266aab7ae67fd029582a5f"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8dfc44942a8cb0908b835a685af281a1db97c4c0", "author": {"user": {"login": "rnett", "name": "Ryan Nett"}}, "url": "https://github.com/tensorflow/java/commit/8dfc44942a8cb0908b835a685af281a1db97c4c0", "committedDate": "2021-01-01T23:37:16Z", "message": "assume only graph or eager environments\n\nSigned-off-by: Ryan Nett <rnett@calpoly.edu>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYwNjY1ODg1", "url": "https://github.com/tensorflow/java/pull/178#pullrequestreview-560665885", "createdAt": "2021-01-03T02:43:49Z", "commit": {"oid": "8dfc44942a8cb0908b835a685af281a1db97c4c0"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wM1QwMjo0Mzo0OVrOINbI-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wM1QwMjo0NjozNlrOINbJ4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDk0NzA2Nw==", "bodyText": "This should be called addInitialization, and I'm not sure it's a great idea to do this in a runner with other things, so it might want to be a package-private method only visible through the runInit method, then fix the docs for runInit so it doesn't reference a private method.", "url": "https://github.com/tensorflow/java/pull/178#discussion_r550947067", "createdAt": "2021-01-03T02:43:49Z", "author": {"login": "Craigacp"}, "path": "tensorflow-core/tensorflow-core-api/src/main/java/org/tensorflow/Session.java", "diffHunk": "@@ -293,6 +293,16 @@ public Runner addTarget(Op op) {\n       return addTarget(op.op());\n     }\n \n+    /**\n+     * Make {@link #run} execute the graph's initializers.\n+     *\n+     * @return this session runner\n+     */\n+    public Runner doInitialization(){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8dfc44942a8cb0908b835a685af281a1db97c4c0"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDk0NzIyNw==", "bodyText": "\"This is a no-op if executed in an eager session\"", "url": "https://github.com/tensorflow/java/pull/178#discussion_r550947227", "createdAt": "2021-01-03T02:45:56Z", "author": {"login": "Craigacp"}, "path": "tensorflow-core/tensorflow-core-api/src/main/java/org/tensorflow/op/core/Init.java", "diffHunk": "@@ -89,21 +89,19 @@ public static Init create(Scope scope) {\n    *\n    * <p>Registered initializers are then grouped as a single unit of computation by adding\n    * and executing an {@link org.tensorflow.op.core.Init#create(Scope) init} operation from a graph\n-   * session.\n+   * session.  No-ops if the session is eager.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8dfc44942a8cb0908b835a685af281a1db97c4c0"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDk0NzI5OA==", "bodyText": "\"This is a no-op if executed in an eager session\"", "url": "https://github.com/tensorflow/java/pull/178#discussion_r550947298", "createdAt": "2021-01-03T02:46:36Z", "author": {"login": "Craigacp"}, "path": "tensorflow-core/tensorflow-core-api/src/gen/annotations/org/tensorflow/op/Ops.java", "diffHunk": "@@ -2755,11 +2755,10 @@ public Init init() {\n    *\n    *  <p>Registered initializers are then grouped as a single unit of computation by adding\n    *  and executing an {@link org.tensorflow.op.core.Init#create(Scope) init} operation from a graph\n-   *  session.\n+   *  session.  No-ops if the session is eager.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8dfc44942a8cb0908b835a685af281a1db97c4c0"}, "originalPosition": 28}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b83b1bbbbdad54b11e56099880ebae27ae67b458", "author": {"user": {"login": "rnett", "name": "Ryan Nett"}}, "url": "https://github.com/tensorflow/java/commit/b83b1bbbbdad54b11e56099880ebae27ae67b458", "committedDate": "2021-01-03T04:40:30Z", "message": "Remove doInit(), update javadocs\n\nSigned-off-by: Ryan Nett <rnett@calpoly.edu>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYzMTc3MjUw", "url": "https://github.com/tensorflow/java/pull/178#pullrequestreview-563177250", "createdAt": "2021-01-07T02:49:03Z", "commit": {"oid": "b83b1bbbbdad54b11e56099880ebae27ae67b458"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wN1QwMjo0OTowM1rOIPdTmw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wN1QwMjo0OTowM1rOIPdTmw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzA3OTcwNw==", "bodyText": "In fact, it is more a replacement for session.run(Ops.create(session.graph).init())", "url": "https://github.com/tensorflow/java/pull/178#discussion_r553079707", "createdAt": "2021-01-07T02:49:03Z", "author": {"login": "karllessard"}, "path": "tensorflow-core/tensorflow-core-api/src/main/java/org/tensorflow/Session.java", "diffHunk": "@@ -490,6 +490,19 @@ public void run(Op op) {\n     runner().addTarget(op.op()).run();\n   }\n \n+\n+  /**\n+   * Execute the graph's initializers.\n+   *\n+   * <p>This method is equivalent to {@code session.runner().addTarget(Ops.create(session.graph()).init()).run()}.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b83b1bbbbdad54b11e56099880ebae27ae67b458"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYzMTc3NDU3", "url": "https://github.com/tensorflow/java/pull/178#pullrequestreview-563177457", "createdAt": "2021-01-07T02:49:45Z", "commit": {"oid": "b83b1bbbbdad54b11e56099880ebae27ae67b458"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wN1QwMjo0OTo0NVrOIPdULg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wN1QwMjo0OTo0NVrOIPdULg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzA3OTg1NA==", "bodyText": "Nit: there is a missing space after if", "url": "https://github.com/tensorflow/java/pull/178#discussion_r553079854", "createdAt": "2021-01-07T02:49:45Z", "author": {"login": "karllessard"}, "path": "tensorflow-core/tensorflow-core-api/src/main/java/org/tensorflow/op/core/Init.java", "diffHunk": "@@ -89,21 +89,19 @@ public static Init create(Scope scope) {\n    *\n    * <p>Registered initializers are then grouped as a single unit of computation by adding\n    * and executing an {@link org.tensorflow.op.core.Init#create(Scope) init} operation from a graph\n-   * session.\n+   * session.  This is a no-op if executed in an eager session.\n    *\n    * @param scope\n    * @param initializer\n-   * @throws IllegalArgumentException if the execution environment in scope is not a graph\n    * @see org.tensorflow.op.core.Init#create(Scope) init\n    */\n   @Endpoint(name = \"initAdd\")\n   public static void add(Scope scope, Op initializer) {\n     ExecutionEnvironment exEnv = scope.env();\n-    if (!(exEnv instanceof Graph)) {\n-      throw new IllegalArgumentException(\"initAdd is only supported on Graph sessions.\");\n+\n+    if(exEnv.isGraph()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b83b1bbbbdad54b11e56099880ebae27ae67b458"}, "originalPosition": 18}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYzMTc4MjQ4", "url": "https://github.com/tensorflow/java/pull/178#pullrequestreview-563178248", "createdAt": "2021-01-07T02:52:30Z", "commit": {"oid": "b83b1bbbbdad54b11e56099880ebae27ae67b458"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a3fa53b27724a4a7c65082fd9723e1c389de6579", "author": {"user": {"login": "rnett", "name": "Ryan Nett"}}, "url": "https://github.com/tensorflow/java/commit/a3fa53b27724a4a7c65082fd9723e1c389de6579", "committedDate": "2021-01-07T03:31:23Z", "message": "small fixes\n\nSigned-off-by: Ryan Nett <rnett@calpoly.edu>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYzMjE4Nzg4", "url": "https://github.com/tensorflow/java/pull/178#pullrequestreview-563218788", "createdAt": "2021-01-07T05:27:35Z", "commit": {"oid": "a3fa53b27724a4a7c65082fd9723e1c389de6579"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3475, "cost": 1, "resetAt": "2021-11-02T12:20:56Z"}}}