{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYyOTY1NTY0", "number": 963, "title": "Add record and playback test", "bodyText": "", "createdAt": "2020-01-15T05:36:39Z", "url": "https://github.com/Azure/azure-libraries-for-java/pull/963", "merged": true, "mergeCommit": {"oid": "d7ee158685410612a9c018fc0c547b7fa5725c82"}, "closed": true, "closedAt": "2020-02-05T02:55:05Z", "author": {"login": "ChenTanyi"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb6ezihgH2gAyMzYyOTY1NTY0Ojk3MDYxNzgzNTUwNWJjOTdmNWRmZTM3NGI2MDQzYzhhNTYxZDNlZjc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcBMes0AH2gAyMzYyOTY1NTY0OjI1YWM2ZTZiODRmOGQwN2QzNGM0M2NiZDFkODUwMDc2YzU3NTNlNTE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "970617835505bc97f5dfe374b6043c8a561d3ef7", "author": {"user": {"login": "ChenTanyi", "name": "Tanyi Chen"}}, "url": "https://github.com/Azure/azure-libraries-for-java/commit/970617835505bc97f5dfe374b6043c8a561d3ef7", "committedDate": "2020-01-15T05:35:59Z", "message": "feat: add record and playback test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2ac5bab5fff36ab65afb8d2097c49eeda8c91ea5", "author": {"user": {"login": "ChenTanyi", "name": "Tanyi Chen"}}, "url": "https://github.com/Azure/azure-libraries-for-java/commit/2ac5bab5fff36ab65afb8d2097c49eeda8c91ea5", "committedDate": "2020-01-15T05:47:33Z", "message": "Merge branch 'vnext' into vnext_testframework"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQzMDAzOTQx", "url": "https://github.com/Azure/azure-libraries-for-java/pull/963#pullrequestreview-343003941", "createdAt": "2020-01-15T06:08:43Z", "commit": {"oid": "2ac5bab5fff36ab65afb8d2097c49eeda8c91ea5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQwNjowODo0NFrOFduHZg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQwNjowODo0NFrOFduHZg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjcwODU4Mg==", "bodyText": "Need a bit more discussion on this interface, whether need to group into withCredential?", "url": "https://github.com/Azure/azure-libraries-for-java/pull/963#discussion_r366708582", "createdAt": "2020-01-15T06:08:44Z", "author": {"login": "weidongxu-microsoft"}, "path": "azure-mgmt-resources/src/main/java/com/azure/management/RestClientBuilder.java", "diffHunk": "@@ -144,6 +148,11 @@ public RestClientBuilder withConfiguration(Configuration configuration) {\n         return this;\r\n     }\r\n \r\n+    public RestClientBuilder withClientId(String clientId) {\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ac5bab5fff36ab65afb8d2097c49eeda8c91ea5"}, "originalPosition": 37}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQzMDA5MDc5", "url": "https://github.com/Azure/azure-libraries-for-java/pull/963#pullrequestreview-343009079", "createdAt": "2020-01-15T06:29:02Z", "commit": {"oid": "2ac5bab5fff36ab65afb8d2097c49eeda8c91ea5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a7e28004c91665f3c73f9a29e2b48769a267d262", "author": {"user": {"login": "ChenTanyi", "name": "Tanyi Chen"}}, "url": "https://github.com/Azure/azure-libraries-for-java/commit/a7e28004c91665f3c73f9a29e2b48769a267d262", "committedDate": "2020-01-15T06:39:12Z", "message": "Rename CachedHttpResponse to RecordedHttpResponse and close original response"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQzMjkxNDcz", "url": "https://github.com/Azure/azure-libraries-for-java/pull/963#pullrequestreview-343291473", "createdAt": "2020-01-15T15:13:44Z", "commit": {"oid": "a7e28004c91665f3c73f9a29e2b48769a267d262"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQxNToxMzo0NFrOFd7pBg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQxNToxMzo0NFrOFd7pBg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjkzMDE4Mg==", "bodyText": "The second part should be factor out and make it clear of the meaning.", "url": "https://github.com/Azure/azure-libraries-for-java/pull/963#discussion_r366930182", "createdAt": "2020-01-15T15:13:44Z", "author": {"login": "yaohaizh"}, "path": "azure-mgmt-resources/src/main/java/com/azure/management/RestClientBuilder.java", "diffHunk": "@@ -66,7 +69,8 @@ public RestClient buildClient() {\n         // Closest to API goes first, closest to wire goes last.\r\n         final List<HttpPipelinePolicy> policies = new ArrayList<>();\r\n         // TODO: Add UserAgent\r\n-        // TODO Add credential policy\r\n+        // policies.add(new UserAgentPolicy(\"test\", this.getClass().getPackage().getName(), this.getClass().getPackage().getImplementationVersion(), Configuration.getGlobalConfiguration()));\r\n+        policies.add(new BearerTokenAuthenticationPolicy(this.credential, (this.clientId == null ? \"\" : this.clientId) + \"/.default\"));\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a7e28004c91665f3c73f9a29e2b48769a267d262"}, "originalPosition": 29}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "84fa3b19aab80f862d17a45caebd54a0ae76d59c", "author": {"user": {"login": "ChenTanyi", "name": "Tanyi Chen"}}, "url": "https://github.com/Azure/azure-libraries-for-java/commit/84fa3b19aab80f862d17a45caebd54a0ae76d59c", "committedDate": "2020-01-20T06:02:01Z", "message": "Merge branch 'vnext' into vnext_testframework"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e8144575fe2e7935f5cdf563c76860ab8937b11d", "author": {"user": {"login": "ChenTanyi", "name": "Tanyi Chen"}}, "url": "https://github.com/Azure/azure-libraries-for-java/commit/e8144575fe2e7935f5cdf563c76860ab8937b11d", "committedDate": "2020-01-20T06:21:52Z", "message": "feat: use scopes in rest client"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "750833305c32930f07b7d3c4934791a398413cde", "author": {"user": {"login": "ChenTanyi", "name": "Tanyi Chen"}}, "url": "https://github.com/Azure/azure-libraries-for-java/commit/750833305c32930f07b7d3c4934791a398413cde", "committedDate": "2020-01-20T08:23:02Z", "message": "Merge branch 'vnext' into vnext_testframework"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "52d892637388f25a0e0234e08956af7a9af84098", "author": {"user": {"login": "ChenTanyi", "name": "Tanyi Chen"}}, "url": "https://github.com/Azure/azure-libraries-for-java/commit/52d892637388f25a0e0234e08956af7a9af84098", "committedDate": "2020-01-21T06:19:31Z", "message": "fix: do not read body when content-length is 0"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "01f79a119fb8a766a90d4b438be99fbf7e8494ac", "author": {"user": {"login": "ChenTanyi", "name": "Tanyi Chen"}}, "url": "https://github.com/Azure/azure-libraries-for-java/commit/01f79a119fb8a766a90d4b438be99fbf7e8494ac", "committedDate": "2020-02-04T07:15:33Z", "message": "Merge branch 'vnext' into vnext_testframework"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "47df65ab9bf0a6deb57b3f15016b48a329da2cd6", "author": {"user": {"login": "ChenTanyi", "name": "Tanyi Chen"}}, "url": "https://github.com/Azure/azure-libraries-for-java/commit/47df65ab9bf0a6deb57b3f15016b48a329da2cd6", "committedDate": "2020-02-04T08:05:35Z", "message": "fix compile error and make localhost pass authetication policy"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyODA5Mjc0", "url": "https://github.com/Azure/azure-libraries-for-java/pull/963#pullrequestreview-352809274", "createdAt": "2020-02-04T08:57:29Z", "commit": {"oid": "47df65ab9bf0a6deb57b3f15016b48a329da2cd6"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQwODo1NzoyOVrOFlMTFw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQwODo1ODozOFrOFlMVbg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDU0MzEyNw==", "bodyText": "just int?", "url": "https://github.com/Azure/azure-libraries-for-java/pull/963#discussion_r374543127", "createdAt": "2020-02-04T08:57:29Z", "author": {"login": "weidongxu-microsoft"}, "path": "azure-mgmt-resources/src/test/java/com/azure/management/resources/core/InterceptorManager.java", "diffHunk": "@@ -37,7 +36,8 @@\n public class InterceptorManager {\n \n     private final static String RECORD_FOLDER = \"session-records/\";\n-    private static final String BODY_LOGGING = \"x-ms-body-logging\";\n+    private final static String BODY_LOGGING = \"x-ms-body-logging\";\n+    private final static Integer HTTP_TEMPORARY_REDIRECT = 307; // HTTP Status Code", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "47df65ab9bf0a6deb57b3f15016b48a329da2cd6"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDU0MzcyNg==", "bodyText": "Try see if we can have another solution? It seems not reasonable to change product code because of test reason.", "url": "https://github.com/Azure/azure-libraries-for-java/pull/963#discussion_r374543726", "createdAt": "2020-02-04T08:58:38Z", "author": {"login": "weidongxu-microsoft"}, "path": "azure-mgmt-resources/src/main/java/com/azure/management/BearerTokenAuthenticationPolicy.java", "diffHunk": "@@ -72,7 +72,8 @@ private String getDefaultScopeFromRequest(HttpRequest request) {\n \n     @Override\n     public Mono<HttpResponse> process(HttpPipelineCallContext context, HttpPipelineNextPolicy next) {\n-        if (\"http\".equals(context.getHttpRequest().getUrl().getProtocol().toLowerCase())) {\n+        if (\"http\".equals(context.getHttpRequest().getUrl().getProtocol().toLowerCase()) &&\n+            !\"localhost\".equals(context.getHttpRequest().getUrl().getHost().toLowerCase().split(\":\")[0])) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "47df65ab9bf0a6deb57b3f15016b48a329da2cd6"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "089ed89944439ad8d9021ba2d36cd7584afaf6ab", "author": {"user": {"login": "ChenTanyi", "name": "Tanyi Chen"}}, "url": "https://github.com/Azure/azure-libraries-for-java/commit/089ed89944439ad8d9021ba2d36cd7584afaf6ab", "committedDate": "2020-02-04T09:32:47Z", "message": "fix: use int instead of Integer for http status code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "25ac6e6b84f8d07d34c43cbd1d850076c5753e51", "author": {"user": {"login": "ChenTanyi", "name": "Tanyi Chen"}}, "url": "https://github.com/Azure/azure-libraries-for-java/commit/25ac6e6b84f8d07d34c43cbd1d850076c5753e51", "committedDate": "2020-02-05T02:12:24Z", "message": "fix: use credential to check if need to skip authentication"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1463, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}