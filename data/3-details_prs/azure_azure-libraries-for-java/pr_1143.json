{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkzNDA5NDU2", "number": 1143, "title": "feat: deprecate getAccessProfile api", "bodyText": "per AKS team's ask, deprecate getAccessProfile API, instead of using ListClusterAdminCredentials / ListClusterUserCredentials\nFrom: Ruchika Gupta <rucgupt@microsoft.com>\nSent: Wednesday, March 18, 2020 7:17\nTo: Tanyi Chen <Tanyi.Chen@microsoft.com>\nCc: Jorge Palma <Jorge.Palma@microsoft.com>\nSubject: Update azure-libraries-for-net repo to not use AKS GetAccessProfile API \n \nHi Tanyi,\n \nI\u2019m Ruchika, an engineer on Azure Kubernetes Service team. I got your contact from the azure-libraries-for-net github repo releases, please redirect me if you\u2019re not the right contact. \n \nWe are in the process to deprecate GetAccessProfile API and are reaching out to partners using this API. We noticed that this repo is using GetAccessProfile API to set the cluster user and cluster admin kubeconfigs https://github.com/Azure/azure-libraries-for-net/blob/12bf18bf4c6012791f357eb582fd4ae4a2f442f9/src/ResourceManagement/ContainerService/KubernetesClusterImpl.cs#L129-L148. \n \nWe are recommending to use ListClusterAdminCredentials / ListClusterUserCredentials API instead. Can you help make that change? Or please add someone who can help change it?\n \nThanks,\nRuchika", "createdAt": "2020-03-25T06:32:45Z", "url": "https://github.com/Azure/azure-libraries-for-java/pull/1143", "merged": true, "mergeCommit": {"oid": "dea658743df837f3f6f92bd79f5619ca41a4af80"}, "closed": true, "closedAt": "2020-03-26T06:57:44Z", "author": {"login": "ChenTanyi"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcRBWuHgH2gAyMzkzNDA5NDU2OjhiNjFkMWE3OGVlZDE5Mzg4YmZiYzI2OGU3MzE2NzZkM2Q4ZWZkZTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcRTJXKgH2gAyMzkzNDA5NDU2Ojc1N2NmM2Y4NTJiNzAyNWM4ZWMyYWY0NjBkNmM3YjhkYTc2ZTI3YTY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8b61d1a78eed19388bfbc268e731676d3d8efde3", "author": {"user": {"login": "ChenTanyi", "name": "Tanyi Chen"}}, "url": "https://github.com/Azure/azure-libraries-for-java/commit/8b61d1a78eed19388bfbc268e731676d3d8efde3", "committedDate": "2020-03-25T06:17:31Z", "message": "feat: deprecate getAccessProfile api"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "378b6c870d8bc6120a06d3c031b572b98ef58980", "author": {"user": {"login": "ChenTanyi", "name": "Tanyi Chen"}}, "url": "https://github.com/Azure/azure-libraries-for-java/commit/378b6c870d8bc6120a06d3c031b572b98ef58980", "committedDate": "2020-03-25T06:51:00Z", "message": "fix: remove unused import"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwODkyNDQw", "url": "https://github.com/Azure/azure-libraries-for-java/pull/1143#pullrequestreview-380892440", "createdAt": "2020-03-25T06:53:59Z", "commit": {"oid": "378b6c870d8bc6120a06d3c031b572b98ef58980"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQwNjo1Mzo1OVrOF7OBWg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQwNjo1Mzo1OVrOF7OBWg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzY0MDAyNg==", "bodyText": "Usually use isEmpty()", "url": "https://github.com/Azure/azure-libraries-for-java/pull/1143#discussion_r397640026", "createdAt": "2020-03-25T06:53:59Z", "author": {"login": "weidongxu-microsoft"}, "path": "azure-mgmt-containerservice/src/main/java/com/microsoft/azure/management/containerservice/implementation/KubernetesClustersImpl.java", "diffHunk": "@@ -157,51 +156,45 @@ public void call(TreeSet<String> kubernetesVersions, OrchestratorVersionProfileL\n \n     @Override\n     public byte[] getAdminKubeConfigContent(String resourceGroupName, String kubernetesClusterName) {\n-        ManagedClusterAccessProfileInner profileInner = this.manager().inner().managedClusters().getAccessProfile(resourceGroupName, kubernetesClusterName, KubernetesClusterAccessProfileRole.ADMIN.toString());\n-        if (profileInner == null) {\n-            return new byte[0];\n-        } else {\n-            return profileInner.kubeConfig();\n-        }\n+        return this.getAdminKubeConfigContentAsync(resourceGroupName, kubernetesClusterName).toBlocking().last();\n     }\n \n     @Override\n     public Observable<byte[]> getAdminKubeConfigContentAsync(String resourceGroupName, String kubernetesClusterName) {\n         return this.manager().inner().managedClusters()\n-            .getAccessProfileAsync(resourceGroupName, kubernetesClusterName, KubernetesClusterAccessProfileRole.ADMIN.toString())\n-            .map(new Func1<ManagedClusterAccessProfileInner, byte[]>() {\n+            .listClusterAdminCredentialsAsync(resourceGroupName, kubernetesClusterName)\n+            .map(new Func1<CredentialResultsInner, byte[]>() {\n                 @Override\n-                public byte[] call(ManagedClusterAccessProfileInner profileInner) {\n-                    if (profileInner == null) {\n+                public byte[] call(CredentialResultsInner credentialInner) {\n+                    if (credentialInner == null\n+                            || credentialInner.kubeconfigs() == null\n+                            || credentialInner.kubeconfigs().size() == 0) {\n                         return new byte[0];\n                     } else {\n-                        return profileInner.kubeConfig();\n+                        return credentialInner.kubeconfigs().get(0).value();\n                     }\n                 }\n             });\n     }\n \n     @Override\n     public byte[] getUserKubeConfigContent(String resourceGroupName, String kubernetesClusterName) {\n-        ManagedClusterAccessProfileInner profileInner = this.manager().inner().managedClusters().getAccessProfile(resourceGroupName, kubernetesClusterName, KubernetesClusterAccessProfileRole.USER.toString());\n-        if (profileInner == null) {\n-            return new byte[0];\n-        } else {\n-            return profileInner.kubeConfig();\n-        }\n+        return this.getUserKubeConfigContentAsync(resourceGroupName, kubernetesClusterName).toBlocking().last();\n     }\n \n     @Override\n     public Observable<byte[]> getUserKubeConfigContentAsync(String resourceGroupName, String kubernetesClusterName) {\n         return this.manager().inner().managedClusters()\n-            .getAccessProfileAsync(resourceGroupName, kubernetesClusterName, KubernetesClusterAccessProfileRole.USER.toString())\n-            .map(new Func1<ManagedClusterAccessProfileInner, byte[]>() {\n+            .listClusterUserCredentialsAsync(resourceGroupName, kubernetesClusterName)\n+            .map(new Func1<CredentialResultsInner, byte[]>() {\n                 @Override\n-                public byte[] call(ManagedClusterAccessProfileInner profileInner) {\n-                    if (profileInner == null) {\n+                public byte[] call(CredentialResultsInner credentialInner) {\n+                    if (credentialInner == null\n+                        || credentialInner.kubeconfigs() == null\n+                        || credentialInner.kubeconfigs().size() == 0) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "378b6c870d8bc6120a06d3c031b572b98ef58980"}, "originalPosition": 68}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1e0795fc1890a7d2b6b5ba5786dd18c22603c52b", "author": {"user": {"login": "ChenTanyi", "name": "Tanyi Chen"}}, "url": "https://github.com/Azure/azure-libraries-for-java/commit/1e0795fc1890a7d2b6b5ba5786dd18c22603c52b", "committedDate": "2020-03-25T06:57:32Z", "message": "fix: change size == 0 -> empty"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwODk5NzAy", "url": "https://github.com/Azure/azure-libraries-for-java/pull/1143#pullrequestreview-380899702", "createdAt": "2020-03-25T07:13:25Z", "commit": {"oid": "1e0795fc1890a7d2b6b5ba5786dd18c22603c52b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxMTM4MTYx", "url": "https://github.com/Azure/azure-libraries-for-java/pull/1143#pullrequestreview-381138161", "createdAt": "2020-03-25T13:20:37Z", "commit": {"oid": "1e0795fc1890a7d2b6b5ba5786dd18c22603c52b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "757cf3f852b7025c8ec2af460d6c7b8da76e27a6", "author": {"user": {"login": "ChenTanyi", "name": "Tanyi Chen"}}, "url": "https://github.com/Azure/azure-libraries-for-java/commit/757cf3f852b7025c8ec2af460d6c7b8da76e27a6", "committedDate": "2020-03-26T03:01:13Z", "message": "fix: aks test and update session record"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1432, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}