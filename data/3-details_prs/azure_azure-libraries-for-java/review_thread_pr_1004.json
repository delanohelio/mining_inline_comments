{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcxMjMwNTM0", "number": 1004, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQwODowNzoxNlrODdPb6Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQwODoxMDowMlrODdPeTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxOTg4MjAxOnYy", "diffSide": "RIGHT", "path": "azure-mgmt-resources/src/test/java/com/azure/management/resources/core/ResourceGroupTaggingPolicy.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQwODowNzoxNlrOFluuig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQwODowNzoxNlrOFluuig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTEwNzIxMA==", "bodyText": "Do not use exception as flow control.", "url": "https://github.com/Azure/azure-libraries-for-java/pull/1004#discussion_r375107210", "createdAt": "2020-02-05T08:07:16Z", "author": {"login": "weidongxu-microsoft"}, "path": "azure-mgmt-resources/src/test/java/com/azure/management/resources/core/ResourceGroupTaggingPolicy.java", "diffHunk": "@@ -0,0 +1,88 @@\n+\n+\n+/**\n+ * Copyright (c) Microsoft Corporation. All rights reserved.\n+ * Licensed under the MIT License. See License.txt in the project root for\n+ * license information.\n+ */\n+\n+package com.azure.management.resources.core;\n+\n+\n+import com.azure.core.http.HttpPipelineCallContext;\n+import com.azure.core.http.HttpPipelineNextPolicy;\n+import com.azure.core.http.HttpRequest;\n+import com.azure.core.http.HttpResponse;\n+import com.azure.core.http.policy.HttpPipelinePolicy;\n+import com.azure.core.management.serializer.AzureJacksonAdapter;\n+import com.azure.core.util.serializer.SerializerEncoding;\n+import com.azure.management.resources.models.ResourceGroupInner;\n+import reactor.core.publisher.Mono;\n+\n+import java.io.IOException;\n+import java.nio.charset.StandardCharsets;\n+import java.time.Instant;\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+/**\n+ * Http Pipeline Policy for tagging resource groups created in tests.\n+ */\n+public class ResourceGroupTaggingPolicy implements HttpPipelinePolicy {\n+//    private static final String LOGGING_CONTEXT = \"com.microsoft.azure.management.resources.ResourceGroups createOrUpdate\";\n+    private static final String CALLER_METHOD = \"com.azure.management.resources.models.ResourceGroupsInner$ResourceGroupsService.createOrUpdate\";\n+    private AzureJacksonAdapter adapter = new AzureJacksonAdapter();\n+\n+    @Override\n+    public Mono<HttpResponse> process(HttpPipelineCallContext context, HttpPipelineNextPolicy next) {\n+        if (\"PUT\".equals(context.getHttpRequest().getHttpMethod().name()) &&\n+                context.getHttpRequest().getUrl().toString().contains(\"/resourcegroups/\") &&\n+                CALLER_METHOD.equals(context.getData(\"caller-method\").orElse(\"\").toString())) {\n+            return context.getHttpRequest().copy().getBody().flatMap(\n+                byteBuffer -> {\n+                    byte[] body = new byte[byteBuffer.remaining()];\n+                    byteBuffer.get(body);\n+                    String bodyStr = new String(body, StandardCharsets.UTF_8);\n+\n+                    ResourceGroupInner resourceGroupInner;\n+                    try {\n+                        resourceGroupInner = adapter.deserialize(bodyStr, ResourceGroupInner.class, SerializerEncoding.JSON);\n+                        if (resourceGroupInner == null) {\n+                            throw new IOException();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b72f3a57b03d2fe1151127e0d0f6db68d79c38c9"}, "originalPosition": 51}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxOTg4Mjg0OnYy", "diffSide": "RIGHT", "path": "azure-mgmt-resources/src/test/java/com/azure/management/resources/core/ResourceGroupTaggingPolicy.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQwODowNzozN1rOFluvBg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQwODowNzozN1rOFluvBg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTEwNzMzNA==", "bodyText": "Clean up a bit.", "url": "https://github.com/Azure/azure-libraries-for-java/pull/1004#discussion_r375107334", "createdAt": "2020-02-05T08:07:37Z", "author": {"login": "weidongxu-microsoft"}, "path": "azure-mgmt-resources/src/test/java/com/azure/management/resources/core/ResourceGroupTaggingPolicy.java", "diffHunk": "@@ -0,0 +1,88 @@\n+\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b72f3a57b03d2fe1151127e0d0f6db68d79c38c9"}, "originalPosition": 2}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxOTg4ODEyOnYy", "diffSide": "RIGHT", "path": "azure-mgmt-resources/src/test/java/com/azure/management/resources/core/ResourceGroupTaggingPolicy.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQwODoxMDowMlrOFluyQw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQwODoxNTozN1rOFlu6Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTEwODE2Mw==", "bodyText": "Will it overwrite users with same name?", "url": "https://github.com/Azure/azure-libraries-for-java/pull/1004#discussion_r375108163", "createdAt": "2020-02-05T08:10:02Z", "author": {"login": "weidongxu-microsoft"}, "path": "azure-mgmt-resources/src/test/java/com/azure/management/resources/core/ResourceGroupTaggingPolicy.java", "diffHunk": "@@ -0,0 +1,88 @@\n+\n+\n+/**\n+ * Copyright (c) Microsoft Corporation. All rights reserved.\n+ * Licensed under the MIT License. See License.txt in the project root for\n+ * license information.\n+ */\n+\n+package com.azure.management.resources.core;\n+\n+\n+import com.azure.core.http.HttpPipelineCallContext;\n+import com.azure.core.http.HttpPipelineNextPolicy;\n+import com.azure.core.http.HttpRequest;\n+import com.azure.core.http.HttpResponse;\n+import com.azure.core.http.policy.HttpPipelinePolicy;\n+import com.azure.core.management.serializer.AzureJacksonAdapter;\n+import com.azure.core.util.serializer.SerializerEncoding;\n+import com.azure.management.resources.models.ResourceGroupInner;\n+import reactor.core.publisher.Mono;\n+\n+import java.io.IOException;\n+import java.nio.charset.StandardCharsets;\n+import java.time.Instant;\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+/**\n+ * Http Pipeline Policy for tagging resource groups created in tests.\n+ */\n+public class ResourceGroupTaggingPolicy implements HttpPipelinePolicy {\n+//    private static final String LOGGING_CONTEXT = \"com.microsoft.azure.management.resources.ResourceGroups createOrUpdate\";\n+    private static final String CALLER_METHOD = \"com.azure.management.resources.models.ResourceGroupsInner$ResourceGroupsService.createOrUpdate\";\n+    private AzureJacksonAdapter adapter = new AzureJacksonAdapter();\n+\n+    @Override\n+    public Mono<HttpResponse> process(HttpPipelineCallContext context, HttpPipelineNextPolicy next) {\n+        if (\"PUT\".equals(context.getHttpRequest().getHttpMethod().name()) &&\n+                context.getHttpRequest().getUrl().toString().contains(\"/resourcegroups/\") &&\n+                CALLER_METHOD.equals(context.getData(\"caller-method\").orElse(\"\").toString())) {\n+            return context.getHttpRequest().copy().getBody().flatMap(\n+                byteBuffer -> {\n+                    byte[] body = new byte[byteBuffer.remaining()];\n+                    byteBuffer.get(body);\n+                    String bodyStr = new String(body, StandardCharsets.UTF_8);\n+\n+                    ResourceGroupInner resourceGroupInner;\n+                    try {\n+                        resourceGroupInner = adapter.deserialize(bodyStr, ResourceGroupInner.class, SerializerEncoding.JSON);\n+                        if (resourceGroupInner == null) {\n+                            throw new IOException();\n+                        }\n+                    } catch (IOException e) {\n+                        return Mono.error(new RuntimeException(\"Failed to deserialize \" + bodyStr));\n+                    }\n+\n+                    Map<String, String> tags = resourceGroupInner.getTags();\n+                    if (tags == null) {\n+                        tags = new HashMap<>();\n+                    }\n+                    tags.put(\"product\", \"javasdk\");\n+                    tags.put(\"cause\", \"automation\");\n+                    tags.put(\"date\", Instant.now().toString());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b72f3a57b03d2fe1151127e0d0f6db68d79c38c9"}, "originalPosition": 63}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTExMDE5OA==", "bodyText": "Yes, so it is only used at unit test.", "url": "https://github.com/Azure/azure-libraries-for-java/pull/1004#discussion_r375110198", "createdAt": "2020-02-05T08:15:37Z", "author": {"login": "ChenTanyi"}, "path": "azure-mgmt-resources/src/test/java/com/azure/management/resources/core/ResourceGroupTaggingPolicy.java", "diffHunk": "@@ -0,0 +1,88 @@\n+\n+\n+/**\n+ * Copyright (c) Microsoft Corporation. All rights reserved.\n+ * Licensed under the MIT License. See License.txt in the project root for\n+ * license information.\n+ */\n+\n+package com.azure.management.resources.core;\n+\n+\n+import com.azure.core.http.HttpPipelineCallContext;\n+import com.azure.core.http.HttpPipelineNextPolicy;\n+import com.azure.core.http.HttpRequest;\n+import com.azure.core.http.HttpResponse;\n+import com.azure.core.http.policy.HttpPipelinePolicy;\n+import com.azure.core.management.serializer.AzureJacksonAdapter;\n+import com.azure.core.util.serializer.SerializerEncoding;\n+import com.azure.management.resources.models.ResourceGroupInner;\n+import reactor.core.publisher.Mono;\n+\n+import java.io.IOException;\n+import java.nio.charset.StandardCharsets;\n+import java.time.Instant;\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+/**\n+ * Http Pipeline Policy for tagging resource groups created in tests.\n+ */\n+public class ResourceGroupTaggingPolicy implements HttpPipelinePolicy {\n+//    private static final String LOGGING_CONTEXT = \"com.microsoft.azure.management.resources.ResourceGroups createOrUpdate\";\n+    private static final String CALLER_METHOD = \"com.azure.management.resources.models.ResourceGroupsInner$ResourceGroupsService.createOrUpdate\";\n+    private AzureJacksonAdapter adapter = new AzureJacksonAdapter();\n+\n+    @Override\n+    public Mono<HttpResponse> process(HttpPipelineCallContext context, HttpPipelineNextPolicy next) {\n+        if (\"PUT\".equals(context.getHttpRequest().getHttpMethod().name()) &&\n+                context.getHttpRequest().getUrl().toString().contains(\"/resourcegroups/\") &&\n+                CALLER_METHOD.equals(context.getData(\"caller-method\").orElse(\"\").toString())) {\n+            return context.getHttpRequest().copy().getBody().flatMap(\n+                byteBuffer -> {\n+                    byte[] body = new byte[byteBuffer.remaining()];\n+                    byteBuffer.get(body);\n+                    String bodyStr = new String(body, StandardCharsets.UTF_8);\n+\n+                    ResourceGroupInner resourceGroupInner;\n+                    try {\n+                        resourceGroupInner = adapter.deserialize(bodyStr, ResourceGroupInner.class, SerializerEncoding.JSON);\n+                        if (resourceGroupInner == null) {\n+                            throw new IOException();\n+                        }\n+                    } catch (IOException e) {\n+                        return Mono.error(new RuntimeException(\"Failed to deserialize \" + bodyStr));\n+                    }\n+\n+                    Map<String, String> tags = resourceGroupInner.getTags();\n+                    if (tags == null) {\n+                        tags = new HashMap<>();\n+                    }\n+                    tags.put(\"product\", \"javasdk\");\n+                    tags.put(\"cause\", \"automation\");\n+                    tags.put(\"date\", Instant.now().toString());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTEwODE2Mw=="}, "originalCommit": {"oid": "b72f3a57b03d2fe1151127e0d0f6db68d79c38c9"}, "originalPosition": 63}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2585, "cost": 1, "resetAt": "2021-11-12T11:18:39Z"}}}