{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI1NzY0NDcx", "number": 1199, "title": "Compute: update to package-2019-12 and support simulate eviction", "bodyText": "", "createdAt": "2020-06-01T05:37:43Z", "url": "https://github.com/Azure/azure-libraries-for-java/pull/1199", "merged": true, "mergeCommit": {"oid": "e786bea402628f266df5bd5def6adb2402345a6c"}, "closed": true, "closedAt": "2020-06-11T06:29:15Z", "author": {"login": "xseeseesee"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABclmq7tAH2gAyNDI1NzY0NDcxOjQwZjczMTljMzU2YWZlMTlkYjFiZTI1MzFmZGNiYzM4YWQxNGM4MDQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcqDsGRgH2gAyNDI1NzY0NDcxOjhhNGUwZWZhMzExNjg4YmQ5YmZkZTVjMTY2ZmUwMjA0NWM1YTIzZGE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "40f7319c356afe19db1be2531fdcbc38ad14c804", "author": {"user": {"login": "xseeseesee", "name": null}}, "url": "https://github.com/Azure/azure-libraries-for-java/commit/40f7319c356afe19db1be2531fdcbc38ad14c804", "committedDate": "2020-05-28T05:04:34Z", "message": "update compute version"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e4a34bee46c3b5a8e5ae4927dca0e14bc43aba65", "author": {"user": {"login": "xseeseesee", "name": null}}, "url": "https://github.com/Azure/azure-libraries-for-java/commit/e4a34bee46c3b5a8e5ae4927dca0e14bc43aba65", "committedDate": "2020-05-28T05:24:33Z", "message": "generate package-2019-12"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b5aaf22dc388315e442ae5d020e2b5bbe948255", "author": {"user": {"login": "xseeseesee", "name": null}}, "url": "https://github.com/Azure/azure-libraries-for-java/commit/5b5aaf22dc388315e442ae5d020e2b5bbe948255", "committedDate": "2020-05-28T06:15:19Z", "message": "fix compile error"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f8811f1f57311427f9e68b3ead0bcbba5987b04e", "author": {"user": {"login": "xseeseesee", "name": null}}, "url": "https://github.com/Azure/azure-libraries-for-java/commit/f8811f1f57311427f9e68b3ead0bcbba5987b04e", "committedDate": "2020-05-28T08:59:45Z", "message": "support simulate eviction in vm and vmss"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e21bdb939f748cc8b37a2908220fe53193892fd4", "author": {"user": {"login": "xseeseesee", "name": null}}, "url": "https://github.com/Azure/azure-libraries-for-java/commit/e21bdb939f748cc8b37a2908220fe53193892fd4", "committedDate": "2020-05-29T05:41:24Z", "message": "manual fix for json serialization"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "714ff5e75dea4329507ed02ac593a29b0c9a40ef", "author": {"user": {"login": "xseeseesee", "name": null}}, "url": "https://github.com/Azure/azure-libraries-for-java/commit/714ff5e75dea4329507ed02ac593a29b0c9a40ef", "committedDate": "2020-05-29T05:43:17Z", "message": "update session records"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "51792fbbf2db7e99b449743edf21655f4581479f", "author": {"user": {"login": "xseeseesee", "name": null}}, "url": "https://github.com/Azure/azure-libraries-for-java/commit/51792fbbf2db7e99b449743edf21655f4581479f", "committedDate": "2020-06-01T05:21:39Z", "message": "update session records"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxNjA1NDcx", "url": "https://github.com/Azure/azure-libraries-for-java/pull/1199#pullrequestreview-421605471", "createdAt": "2020-06-01T05:46:03Z", "commit": {"oid": "5b5aaf22dc388315e442ae5d020e2b5bbe948255"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQwNTo0NjowNFrOGc_X4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQwNTo0NjowNFrOGc_X4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzA1MTYxNg==", "bodyText": "What does this function do?", "url": "https://github.com/Azure/azure-libraries-for-java/pull/1199#discussion_r433051616", "createdAt": "2020-06-01T05:46:04Z", "author": {"login": "ChenTanyi"}, "path": "azure-mgmt-compute/src/main/java/com/microsoft/azure/management/compute/implementation/ProximityPlacementGroupImpl.java", "diffHunk": "@@ -69,12 +69,12 @@ public ProximityPlacementGroupInner inner() {\n     }\n \n \n-    private List<String> getStringListFromSubResourceList(List<SubResource> subList) {\n+    private List<String> getStringListFromSubResourceList(List<SubResourceWithColocationStatus> subList) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5b5aaf22dc388315e442ae5d020e2b5bbe948255"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fc1dc6ea64f7ed48a39f85eb607304a401d0b0d8", "author": {"user": {"login": "xseeseesee", "name": null}}, "url": "https://github.com/Azure/azure-libraries-for-java/commit/fc1dc6ea64f7ed48a39f85eb607304a401d0b0d8", "committedDate": "2020-06-01T05:51:23Z", "message": "update session records"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxNjA4OTA2", "url": "https://github.com/Azure/azure-libraries-for-java/pull/1199#pullrequestreview-421608906", "createdAt": "2020-06-01T05:57:42Z", "commit": {"oid": "fc1dc6ea64f7ed48a39f85eb607304a401d0b0d8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e86681ca9b5c78eeb7ece50b301a12c2a0d9e8d4", "author": {"user": {"login": "xseeseesee", "name": null}}, "url": "https://github.com/Azure/azure-libraries-for-java/commit/e86681ca9b5c78eeb7ece50b301a12c2a0d9e8d4", "committedDate": "2020-06-02T04:01:12Z", "message": "update session records"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "febfe79079aac28529fb8c1698e395b6266b73ff", "author": {"user": {"login": "xseeseesee", "name": null}}, "url": "https://github.com/Azure/azure-libraries-for-java/commit/febfe79079aac28529fb8c1698e395b6266b73ff", "committedDate": "2020-06-02T04:52:22Z", "message": "manual fix error"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ba08aa0fdd06e9fa080eee1b68f891fa05a84168", "author": {"user": {"login": "xseeseesee", "name": null}}, "url": "https://github.com/Azure/azure-libraries-for-java/commit/ba08aa0fdd06e9fa080eee1b68f891fa05a84168", "committedDate": "2020-06-02T05:08:11Z", "message": "manual fix checkstyle error"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "161a5c26a5a63de16f58edca99afc82d957808b8", "author": {"user": {"login": "xseeseesee", "name": null}}, "url": "https://github.com/Azure/azure-libraries-for-java/commit/161a5c26a5a63de16f58edca99afc82d957808b8", "committedDate": "2020-06-02T11:37:40Z", "message": "add tests for simulate eviction"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzMTQyNjI4", "url": "https://github.com/Azure/azure-libraries-for-java/pull/1199#pullrequestreview-423142628", "createdAt": "2020-06-03T00:28:24Z", "commit": {"oid": "161a5c26a5a63de16f58edca99afc82d957808b8"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QwMDoyODoyNFrOGeIOyQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QwMDoyOToxMVrOGeIPhw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDI0NTMyMQ==", "bodyText": "Assert if the vm state is deallocated. When it is deallocated, vm entity will still be there.", "url": "https://github.com/Azure/azure-libraries-for-java/pull/1199#discussion_r434245321", "createdAt": "2020-06-03T00:28:24Z", "author": {"login": "sandeepkv93"}, "path": "azure-mgmt-compute/src/test/java/com/microsoft/azure/management/compute/VirtualMachineOperationsTests.java", "diffHunk": "@@ -702,6 +702,40 @@ public void canRunScriptOnVM() {\n         Assert.assertTrue(runResult.value().size() > 0);\n     }\n \n+    @Test\n+    public void canPerformSimulateEvictionOnSpotVirtualMachine() {\n+        VirtualMachine virtualMachine = computeManager.virtualMachines()\n+                .define(VMNAME)\n+                .withRegion(REGION)\n+                .withNewResourceGroup(RG_NAME)\n+                .withNewPrimaryNetwork(\"10.0.0.0/28\")\n+                .withPrimaryPrivateIPAddressDynamic()\n+                .withoutPrimaryPublicIPAddress()\n+                .withPopularLinuxImage(KnownLinuxVirtualMachineImage.UBUNTU_SERVER_16_04_LTS)\n+                .withRootUsername(\"firstuser\")\n+                .withRootPassword(\"afh123RVS!\")\n+                .withSpotPriority(VirtualMachineEvictionPolicyTypes.DEALLOCATE)\n+                .withSize(VirtualMachineSizeTypes.STANDARD_D2_V3)\n+                .create();\n+\n+        Assert.assertNotNull(virtualMachine.osDiskStorageAccountType());\n+        Assert.assertTrue(virtualMachine.osDiskSize() > 0);\n+        Disk disk = computeManager.disks().getById(virtualMachine.osDiskId());\n+        Assert.assertNotNull(disk);\n+        Assert.assertEquals(DiskState.ATTACHED, disk.inner().diskState());\n+\n+        // call simulate eviction\n+        virtualMachine.simulateEviction();\n+        SdkContext.sleep(30 * 60 * 1000);\n+\n+        virtualMachine = computeManager.virtualMachines().getById(virtualMachine.id());\n+        Assert.assertNotNull(virtualMachine);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "161a5c26a5a63de16f58edca99afc82d957808b8"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDI0NTUxMQ==", "bodyText": "Same as Single VM. Check the vm state of each VM.", "url": "https://github.com/Azure/azure-libraries-for-java/pull/1199#discussion_r434245511", "createdAt": "2020-06-03T00:29:11Z", "author": {"login": "sandeepkv93"}, "path": "azure-mgmt-compute/src/test/java/com/microsoft/azure/management/compute/VirtualMachineScaleSetOperationsTests.java", "diffHunk": "@@ -1143,6 +1144,56 @@ public void canCreateLowPriorityVMSSInstance() throws Exception {\n         Assert.assertEquals(vmss.billingProfile().maxPrice(), (Double)2000.0);\n     }\n \n+    @Test\n+    public void canPerformSimulateEvictionOnSpotVMSSInstance() {\n+        final String vmssName = generateRandomResourceName(\"vmss\", 10);\n+\n+        ResourceGroup resourceGroup = this.resourceManager.resourceGroups()\n+                .define(RG_NAME)\n+                .withRegion(REGION)\n+                .create();\n+\n+        Network network = this.networkManager\n+                .networks()\n+                .define(\"vmssvnet\")\n+                .withRegion(REGION)\n+                .withExistingResourceGroup(resourceGroup)\n+                .withAddressSpace(\"10.0.0.0/28\")\n+                .withSubnet(\"subnet1\", \"10.0.0.0/28\")\n+                .create();\n+\n+        VirtualMachineScaleSet vmss = computeManager.virtualMachineScaleSets()\n+                .define(vmssName)\n+                .withRegion(REGION)\n+                .withExistingResourceGroup(RG_NAME)\n+                .withSku(VirtualMachineScaleSetSkuTypes.STANDARD_D3_V2)\n+                .withExistingPrimaryNetworkSubnet(network, \"subnet1\")\n+                .withoutPrimaryInternetFacingLoadBalancer()\n+                .withoutPrimaryInternalLoadBalancer()\n+                .withPopularLinuxImage(KnownLinuxVirtualMachineImage.UBUNTU_SERVER_16_04_LTS)\n+                .withRootUsername(\"jvuser\")\n+                .withRootPassword(\"123OData!@#123\")\n+                .withSpotPriorityVirtualMachine(VirtualMachineEvictionPolicyTypes.DEALLOCATE)\n+                .create();\n+\n+        PagedList<VirtualMachineScaleSetVM> vmInstances = vmss.virtualMachines().list();\n+        for (VirtualMachineScaleSetVM instance: vmInstances) {\n+            Assert.assertTrue(instance.osDiskSizeInGB() > 0);\n+            //Disk disk = computeManager.disks().getById(instance.osDiskId());\n+            //Assert.assertEquals(DiskState.ATTACHED, disk.inner().diskState());\n+            // call simulate eviction\n+            vmss.virtualMachines().simulateEviction(instance.instanceId());\n+        }\n+\n+        SdkContext.sleep(30 * 60 * 1000);\n+\n+        for (VirtualMachineScaleSetVM instance: vmInstances) {\n+            instance.refresh();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "161a5c26a5a63de16f58edca99afc82d957808b8"}, "originalPosition": 56}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzMjIzNzY3", "url": "https://github.com/Azure/azure-libraries-for-java/pull/1199#pullrequestreview-423223767", "createdAt": "2020-06-03T05:15:57Z", "commit": {"oid": "161a5c26a5a63de16f58edca99afc82d957808b8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8a4e0efa311688bd9bfde5c166fe02045c5a23da", "author": {"user": {"login": "xseeseesee", "name": null}}, "url": "https://github.com/Azure/azure-libraries-for-java/commit/8a4e0efa311688bd9bfde5c166fe02045c5a23da", "committedDate": "2020-06-11T01:08:47Z", "message": "support delete eviction policy"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1452, "cost": 1, "resetAt": "2021-11-01T11:59:11Z"}}}