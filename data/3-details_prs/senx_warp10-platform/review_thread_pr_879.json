{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI4MjY4NzIz", "number": 879, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QxNTo0MTo0NlrOE-CanA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QxNTo1NTo1OVrOE-CsLQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMzNDg2NzQ4OnYy", "diffSide": "RIGHT", "path": "warp10/src/main/java/io/warp10/script/ext/token/TOKENDUMP.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QxNTo0MTo0NlrOH7CdkA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QxNTo0MTo0NlrOH7CdkA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTY2ODM2OA==", "bodyText": "Thus customKeys == multikey. You could replace every use of customKeys by multikey.", "url": "https://github.com/senx/warp10-platform/pull/879#discussion_r531668368", "createdAt": "2020-11-27T15:41:46Z", "author": {"login": "ftence"}, "path": "warp10/src/main/java/io/warp10/script/ext/token/TOKENDUMP.java", "diffHunk": "@@ -102,6 +104,7 @@ public Object apply(WarpScriptStack stack) throws WarpScriptException {\n \n       AESKey = (byte[]) top;\n \n+      customKeys = true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e3616d6ab99821c1a7f464e064d32c59e4c7f6b3"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMzNDg2ODE2OnYy", "diffSide": "RIGHT", "path": "warp10/src/main/java/io/warp10/script/ext/token/TOKENDUMP.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QxNTo0MjowMFrOH7CeBg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QxNTo0MjowMFrOH7CeBg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTY2ODQ4Ng==", "bodyText": "Update copyright notice.", "url": "https://github.com/senx/warp10-platform/pull/879#discussion_r531668486", "createdAt": "2020-11-27T15:42:00Z", "author": {"login": "ftence"}, "path": "warp10/src/main/java/io/warp10/script/ext/token/TOKENDUMP.java", "diffHunk": "@@ -85,6 +85,8 @@ public Object apply(WarpScriptStack stack) throws WarpScriptException {\n \n     Object top = null;\n \n+    boolean customKeys = false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e3616d6ab99821c1a7f464e064d32c59e4c7f6b3"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMzNDkxMjQ1OnYy", "diffSide": "RIGHT", "path": "warp10/src/main/java/io/warp10/script/ext/token/TOKENDUMP.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QxNTo1NTo1OVrOH7C37A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QxNTo1NTo1OVrOH7C37A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTY3NTExNg==", "bodyText": "In case customKeys and thus multikey, decoder is always null so you can replace this block with\nlong[] lkey = SipHashInline.getKey(SipHashKey);\nQuasarTokenDecoder dec = new QuasarTokenDecoder(lkey[0], lkey[1], AESKey);", "url": "https://github.com/senx/warp10-platform/pull/879#discussion_r531675116", "createdAt": "2020-11-27T15:55:59Z", "author": {"login": "ftence"}, "path": "warp10/src/main/java/io/warp10/script/ext/token/TOKENDUMP.java", "diffHunk": "@@ -131,22 +134,34 @@ public Object apply(WarpScriptStack stack) throws WarpScriptException {\n     ReadToken rtoken = null;\n     WriteToken wtoken = null;\n \n-    byte[] token = OrderPreservingBase64.decode(tokenstr.getBytes(StandardCharsets.UTF_8));\n+    if (!customKeys) {\n+      try {\n+        rtoken = Tokens.extractReadToken(tokenstr);\n+      } catch (WarpScriptException wse) {\n+        try {\n+          wtoken = Tokens.extractWriteToken(tokenstr);\n+        } catch (Exception e) {\n+          throw new WarpScriptException(getName() + \" invalid token.\", e);\n+        }\n+      }\n+    } else {\n+      byte[] token = OrderPreservingBase64.decode(tokenstr.getBytes(StandardCharsets.UTF_8));\n \n-    QuasarTokenDecoder dec = decoder;\n+      QuasarTokenDecoder dec = decoder;\n \n-    if (null == dec) {\n-      long[] lkey = SipHashInline.getKey(SipHashKey);\n-      dec = new QuasarTokenDecoder(lkey[0], lkey[1], AESKey);\n-    }\n+      if (null == dec) {\n+        long[] lkey = SipHashInline.getKey(SipHashKey);\n+        dec = new QuasarTokenDecoder(lkey[0], lkey[1], AESKey);\n+      }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e3616d6ab99821c1a7f464e064d32c59e4c7f6b3"}, "originalPosition": 45}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1193, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}