{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcyMTUyNzYz", "number": 658, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxMzo0NTozMVrODeztxg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxMzo0NTo1OFrODezuhw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzNjMxMTc0OnYy", "diffSide": "RIGHT", "path": "warp10/src/main/java/io/warp10/script/functions/TOGEOHASH.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxMzo0NTozMVrOFoJcmA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxMzo0NTozMVrOFoJcmA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzY0MjEzNg==", "bodyText": "Add else cause to throw an error for incorrect type.", "url": "https://github.com/senx/warp10-platform/pull/658#discussion_r377642136", "createdAt": "2020-02-11T13:45:31Z", "author": {"login": "ftence"}, "path": "warp10/src/main/java/io/warp10/script/functions/TOGEOHASH.java", "diffHunk": "@@ -36,17 +41,27 @@ public TOGEOHASH(String name) {\n   @Override\n   public Object apply(WarpScriptStack stack) throws WarpScriptException {\n     \n-    Object lon = stack.pop();\n-    Object lat = stack.pop();\n+    Object top = stack.pop();\n     \n-    if (!(lon instanceof Number) && !(lat instanceof Number)) {\n-      throw new WarpScriptException(getName() + \" expects a latitude and a longitude on the stack.\");\n+    if (top instanceof GeoXPShape) {\n+      List<String> geohashes = new ArrayList<String>(GeoHashHelper.fromGeoCells(GeoXPLib.getCells((GeoXPShape) top), false));\n+      stack.push(geohashes);      \n+    } else if (top instanceof Long) {\n+      String geohash = GeoHashHelper.fromHHCode(((Long) top).longValue(), 32);      \n+      stack.push(geohash);            \n+    } else if (top instanceof Double) {\n+      Object lon = (Double) top;\n+      Object lat = stack.pop();\n+      \n+      if (!(lat instanceof Double)) {\n+        throw new WarpScriptException(getName() + \" expects a latitude and a longitude on the stack.\");\n+      }\n+      \n+      long geoxppoint = GeoXPLib.toGeoXPPoint(((Number) lat).doubleValue(), ((Number) lon).doubleValue());\n+      String geohash = GeoHashHelper.fromHHCode(geoxppoint, 32);\n+      \n+      stack.push(geohash);      \n     }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5fd0cc14713f819e8d76f8f7d40bbe6ec9307896"}, "originalPosition": 41}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzNjMxMzY3OnYy", "diffSide": "RIGHT", "path": "warp10/src/main/java/io/warp10/script/functions/TOGEOHASH.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxMzo0NTo1OFrOFoJdtQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxMzo0NTo1OFrOFoJdtQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzY0MjQyMQ==", "bodyText": "Useless cast to Double.", "url": "https://github.com/senx/warp10-platform/pull/658#discussion_r377642421", "createdAt": "2020-02-11T13:45:58Z", "author": {"login": "ftence"}, "path": "warp10/src/main/java/io/warp10/script/functions/TOGEOHASH.java", "diffHunk": "@@ -36,17 +41,27 @@ public TOGEOHASH(String name) {\n   @Override\n   public Object apply(WarpScriptStack stack) throws WarpScriptException {\n     \n-    Object lon = stack.pop();\n-    Object lat = stack.pop();\n+    Object top = stack.pop();\n     \n-    if (!(lon instanceof Number) && !(lat instanceof Number)) {\n-      throw new WarpScriptException(getName() + \" expects a latitude and a longitude on the stack.\");\n+    if (top instanceof GeoXPShape) {\n+      List<String> geohashes = new ArrayList<String>(GeoHashHelper.fromGeoCells(GeoXPLib.getCells((GeoXPShape) top), false));\n+      stack.push(geohashes);      \n+    } else if (top instanceof Long) {\n+      String geohash = GeoHashHelper.fromHHCode(((Long) top).longValue(), 32);      \n+      stack.push(geohash);            \n+    } else if (top instanceof Double) {\n+      Object lon = (Double) top;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5fd0cc14713f819e8d76f8f7d40bbe6ec9307896"}, "originalPosition": 30}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1295, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}