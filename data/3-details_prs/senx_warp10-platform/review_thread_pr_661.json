{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzczMTQ0NzE4", "number": 661, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQyMjoxMTowMVrODfWbJg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQyMjoxMTowMVrODfWbJg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM0MTk5ODQ2OnYy", "diffSide": "RIGHT", "path": "warp10/src/main/java/io/warp10/script/functions/TYPEOF.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQyMjoxMTowMVrOFpAZ6g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQyMjoxMTowMVrOFpAZ6g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODU0MjU3MA==", "bodyText": "It would be better to use neither parens nor spaces.\nX-Local-Anonymous-Class?", "url": "https://github.com/senx/warp10-platform/pull/661#discussion_r378542570", "createdAt": "2020-02-12T22:11:01Z", "author": {"login": "hbs"}, "path": "warp10/src/main/java/io/warp10/script/functions/TYPEOF.java", "diffHunk": "@@ -97,57 +108,72 @@ public static String typeof(Object o) {\n \n   public static String typeof(Class c) {\n     if (String.class.isAssignableFrom(c)) {\n-      return (TYPE_STRING);\n+      return TYPE_STRING;\n     } else if (Long.class.isAssignableFrom(c) || Integer.class.isAssignableFrom(c) || Short.class.isAssignableFrom(c) || Byte.class.isAssignableFrom(c) || BigInteger.class.isAssignableFrom(c)) {\n-      return (TYPE_LONG);\n+      return TYPE_LONG;\n     } else if (Double.class.isAssignableFrom(c) || Float.class.isAssignableFrom(c) || BigDecimal.class.isAssignableFrom(c)) {\n-      return (TYPE_DOUBLE);\n+      return TYPE_DOUBLE;\n     } else if (Boolean.class.isAssignableFrom(c)) {\n-      return (TYPE_BOOLEAN);\n+      return TYPE_BOOLEAN;\n     } else if (Vector.class.isAssignableFrom(c)) {  // place before List. Vector implements List.\n-      return (TYPE_VECTOR);\n+      return TYPE_VECTOR;\n     } else if (List.class.isAssignableFrom(c)) {\n-      return (TYPE_LIST);\n+      return TYPE_LIST;\n     } else if (Map.class.isAssignableFrom(c)) {\n-      return (TYPE_MAP);\n+      return TYPE_MAP;\n     } else if (Macro.class.isAssignableFrom(c)) {\n-      return (TYPE_MACRO);\n-    } else if (WarpScriptMapperFunction.class.isAssignableFrom(c)) {\n-      return (TYPE_MAPPER);\n-    } else if (WarpScriptReducerFunction.class.isAssignableFrom(c)) {\n-      return (TYPE_REDUCER);\n+      return TYPE_MACRO;\n+    } else if (WarpScriptAggregatorFunction.class.isAssignableFrom(c)) {\n+      return TYPE_AGGREGATOR;\n+    } else if (WarpScriptFillerFunction.class.isAssignableFrom(c)) {\n+      return TYPE_FILLER;\n+    } else if (WarpScriptFilterFunction.class.isAssignableFrom(c)) {\n+      return TYPE_FILTER;\n+    } else if (WarpScriptNAryFunction.class.isAssignableFrom(c)) {\n+      return TYPE_OPERATOR;\n     } else if (GeoTimeSerie.class.isAssignableFrom(c)) {\n-      return (TYPE_GTS);\n+      return TYPE_GTS;\n+    } else if (GTSEncoder.class.isAssignableFrom(c)) {\n+      return TYPE_GTSENCODER;\n     } else if (byte[].class.isAssignableFrom(c)) {\n-      return (TYPE_BYTES);\n+      return TYPE_BYTES;\n     } else if (PGraphics.class.isAssignableFrom(c)) {\n-      return (TYPE_PGRAPHICSIMAGE);\n+      return TYPE_PGRAPHICSIMAGE;\n     } else if (PImage.class.isAssignableFrom(c)) {\n-      return (TYPE_PIMAGE);\n+      return TYPE_PIMAGE;\n     } else if (PFont.class.isAssignableFrom(c)) {\n-      return (TYPE_PFONT);\n+      return TYPE_PFONT;\n     } else if (PShape.class.isAssignableFrom(c)) {\n-      return (TYPE_PSHAPE);\n+      return TYPE_PSHAPE;\n     } else if (GeoXPLib.GeoXPShape.class.isAssignableFrom(c)) {\n-      return (TYPE_GEOSHAPE);\n+      return TYPE_GEOSHAPE;\n     } else if (Set.class.isAssignableFrom(c)) {\n-      return (TYPE_SET);\n+      return TYPE_SET;\n     } else if (BitSet.class.isAssignableFrom(c)) {\n-      return (TYPE_BITSET);\n+      return TYPE_BITSET;\n     } else if (ArrayRealVector.class.isAssignableFrom(c)) {\n-      return (TYPE_REALVECTOR);\n+      return TYPE_REALVECTOR;\n     } else if (RealMatrix.class.isAssignableFrom(c)) {\n-      return (TYPE_REALMATRIX);\n+      return TYPE_REALMATRIX;\n     } else if (AtomicLong.class.isAssignableFrom(c)) {\n-      return (TYPE_COUNTER);\n+      return TYPE_COUNTER;\n     } else if (Typeofable.class.isAssignableFrom(c)) {\n       try {\n-        return (((Typeofable) c.newInstance()).typeof());\n-      } catch(Exception e) {\n-        return (\"X-\" + c.getSimpleName().toUpperCase());\n+        return \"X-\" + ((Typeofable) c.getDeclaredConstructor().newInstance()).typeof();\n+      } catch (Exception e) {\n+        return defaultType(c);\n       }\n     } else {\n-      return (c.getSimpleName().toUpperCase());\n+      return defaultType(c);\n+    }\n+  }\n+\n+  private static String defaultType(Class c) {\n+    String canonicalName = c.getCanonicalName();\n+    if (null == canonicalName) {\n+      return \"X-(Local/Anonymous Class)\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "41165e4022d32e3ac7076346f6043b38e12a6a2e"}, "originalPosition": 168}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1302, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}