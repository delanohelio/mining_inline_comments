{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE4NjA2NDYz", "number": 871, "title": "More detailed error messages for /update", "bodyText": "More descriptive parse errors, including precise index of the error.\nUpdated http status codes:\n500 error for general server-side error\n400 for bad input/request\n403 for bad token\n429 for exceeded throttling limits", "createdAt": "2020-11-10T16:21:48Z", "url": "https://github.com/senx/warp10-platform/pull/871", "merged": true, "mergeCommit": {"oid": "57bbf18a4907f032f813505cc7fee009f846186e"}, "closed": true, "closedAt": "2020-11-17T13:35:04Z", "author": {"login": "ftence"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdbL0AWgH2gAyNTE4NjA2NDYzOjdiNjhlOGNkMGEzZmJiZWRlNzE4MWE2OGFjMzA4Y2EyMTNlNzYyYmM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABddXD7ogH2gAyNTE4NjA2NDYzOmE0MzNhNWQxNTQ3NGVlMWQxM2Y1MjlkNDYwOTY5YWM3Nzc1YWM5MTc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7b68e8cd0a3fbbede7181a68ac308ca213e762bc", "author": {"user": {"login": "ftence", "name": "Fabien Tenc\u00e9"}}, "url": "https://github.com/senx/warp10-platform/commit/7b68e8cd0a3fbbede7181a68ac308ca213e762bc", "committedDate": "2020-11-10T16:18:57Z", "message": "More detailled error messages for /update"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwOTc3MDQy", "url": "https://github.com/senx/warp10-platform/pull/871#pullrequestreview-530977042", "createdAt": "2020-11-16T07:35:28Z", "commit": {"oid": "7b68e8cd0a3fbbede7181a68ac308ca213e762bc"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQwNzozNToyOVrOHzq5jw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQwNzo0Mzo1NFrOHzrG-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzk0MjI4Nw==", "bodyText": "The actual incorrect line is no longer shown.", "url": "https://github.com/senx/warp10-platform/pull/871#discussion_r523942287", "createdAt": "2020-11-16T07:35:29Z", "author": {"login": "hbs"}, "path": "warp10/src/main/java/io/warp10/continuum/gts/GTSHelper.java", "diffHunk": "@@ -2535,14 +2543,22 @@ public static GTSEncoder parse(GTSEncoder encoder, String str, Map<String,String\n     idx2 = UnsafeString.indexOf(str, ' ', idx);\n     \n     if (-1 == idx2){\n-      throw new ParseException(str, idx);\n+      if(0 == tsoffset) {\n+        throw new ParseException(\"Missing GTS name, labels and value.\", idx);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7b68e8cd0a3fbbede7181a68ac308ca213e762bc"}, "originalPosition": 71}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzk0MjkxMg==", "bodyText": "Ditto, dropping the invalid line.", "url": "https://github.com/senx/warp10-platform/pull/871#discussion_r523942912", "createdAt": "2020-11-16T07:37:03Z", "author": {"login": "hbs"}, "path": "warp10/src/main/java/io/warp10/continuum/gts/GTSHelper.java", "diffHunk": "@@ -2574,7 +2590,7 @@ public static GTSEncoder parse(GTSEncoder encoder, String str, Map<String,String\n       // No class+labels, assume same class+labels as those in encoder, except\n       // if encoder is null in which case we throw a parse exception\n       if (null == encoder) {\n-        throw new ParseException(str, idx);\n+        throw new ParseException(\"Missing or invalid GTS name and labels.\", idx);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7b68e8cd0a3fbbede7181a68ac308ca213e762bc"}, "originalPosition": 95}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzk0MzAxOA==", "bodyText": "Invalid line no longer shown.", "url": "https://github.com/senx/warp10-platform/pull/871#discussion_r523943018", "createdAt": "2020-11-16T07:37:19Z", "author": {"login": "hbs"}, "path": "warp10/src/main/java/io/warp10/continuum/gts/GTSHelper.java", "diffHunk": "@@ -2591,14 +2607,20 @@ public static GTSEncoder parse(GTSEncoder encoder, String str, Map<String,String\n       idx2 = UnsafeString.indexOf(str, '}', idx);\n       \n       if (-1 == idx2){\n-        throw new ParseException(str, idx);\n+        throw new ParseException(\"Missing end of labels '}'.\", str.length() - 1);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7b68e8cd0a3fbbede7181a68ac308ca213e762bc"}, "originalPosition": 104}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzk0NTcyMQ==", "bodyText": "Now that we have a mechanism to control the error message size I think it would be a good idea to include the invalid line whenever possible, it makes the diagnosis of the issue way easier.", "url": "https://github.com/senx/warp10-platform/pull/871#discussion_r523945721", "createdAt": "2020-11-16T07:43:54Z", "author": {"login": "hbs"}, "path": "warp10/src/main/java/io/warp10/continuum/gts/GTSHelper.java", "diffHunk": "@@ -2591,14 +2607,20 @@ public static GTSEncoder parse(GTSEncoder encoder, String str, Map<String,String\n       idx2 = UnsafeString.indexOf(str, '}', idx);\n       \n       if (-1 == idx2){\n-        throw new ParseException(str, idx);\n+        throw new ParseException(\"Missing end of labels '}'.\", str.length() - 1);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzk0MzAxOA=="}, "originalCommit": {"oid": "7b68e8cd0a3fbbede7181a68ac308ca213e762bc"}, "originalPosition": 104}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a433a5d15474ee1d13f529d460969ac7775ac917", "author": {"user": {"login": "ftence", "name": "Fabien Tenc\u00e9"}}, "url": "https://github.com/senx/warp10-platform/commit/a433a5d15474ee1d13f529d460969ac7775ac917", "committedDate": "2020-11-17T10:33:09Z", "message": "Catch and nicely format ParseExceptions thrown by GTSHelper.parse"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3257, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}