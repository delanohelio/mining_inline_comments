{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzczMTg3MDUy", "number": 663, "title": "GEO.UNION and GEO.INTESERCTION to take a list of shapes.", "bodyText": "", "createdAt": "2020-02-10T15:08:46Z", "url": "https://github.com/senx/warp10-platform/pull/663", "merged": true, "mergeCommit": {"oid": "1afd931e375195970bd793660409a19afa3d1422"}, "closed": true, "closedAt": "2020-02-11T10:08:15Z", "author": {"login": "ftence"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcC-kC8gH2gAyMzczMTg3MDUyOjkyMDMzMzg2YjZjMmNhODM2MzIxOTY5ZWJiNWRlODIyNWM1ZmExNjE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcDO2FYAH2gAyMzczMTg3MDUyOjUzOTA4ZDQ5MjA0ZTJjMzJlZjQ4NTAzMzg0MWE4NTQxODVlYWEwM2U=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "92033386b6c2ca836321969ebb5de8225c5fa161", "author": {"user": {"login": "ftence", "name": "Fabien Tenc\u00e9"}}, "url": "https://github.com/senx/warp10-platform/commit/92033386b6c2ca836321969ebb5de8225c5fa161", "committedDate": "2020-02-10T15:07:25Z", "message": "GEO.UNION and GEO.INTESERCTION to take a list of shapes."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU2NTE1NDM3", "url": "https://github.com/senx/warp10-platform/pull/663#pullrequestreview-356515437", "createdAt": "2020-02-11T09:39:46Z", "commit": {"oid": "92033386b6c2ca836321969ebb5de8225c5fa161"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQwOTozOTo0NlrOFoCSbw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQwOTo0MDozMlrOFoCT-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzUyNDg0Nw==", "bodyText": "simply cast element", "url": "https://github.com/senx/warp10-platform/pull/663#discussion_r377524847", "createdAt": "2020-02-11T09:39:46Z", "author": {"login": "hbs"}, "path": "warp10/src/main/java/io/warp10/script/functions/GeoIntersection.java", "diffHunk": "@@ -35,19 +37,40 @@ public GeoIntersection(String name) {\n   \n   @Override\n   public Object apply(WarpScriptStack stack) throws WarpScriptException {\n-    Object a = stack.pop();\n-    Object b = stack.pop();\n-    \n-    if (!(a instanceof GeoXPShape) || !(b instanceof GeoXPShape)) {\n-      throw new WarpScriptException(getName() + \" expects two GeoShape instances as the top 2 elements of the stack.\");\n+    Object top = stack.pop();\n+\n+    if (top instanceof List) {\n+      List list = (List) top;\n+      if (list.isEmpty()) {\n+        stack.push(GeoXPLib.fromCells(new long[] {}, false));\n+      } else {\n+        Object element = list.get(0);\n+        if (!(element instanceof GeoXPShape)) {\n+          throw new WarpScriptException(getName() + \" expects two GeoShape instances as the top 2 elements of the stack or a list of GeoShape instances.\");\n+        }\n+        GeoXPShape shape = (GeoXPShape) element;\n+        for (int i = 1; i < list.size(); i++) {\n+          element = list.get(i);\n+          if (!(element instanceof GeoXPShape)) {\n+            throw new WarpScriptException(getName() + \" expects two GeoShape instances as the top 2 elements of the stack or a list of GeoShape instances.\");\n+          }\n+          shape = GeoXPLib.intersection(shape, (GeoXPShape) list.get(i));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "92033386b6c2ca836321969ebb5de8225c5fa161"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzUyNTI0Mw==", "bodyText": "simply cast element", "url": "https://github.com/senx/warp10-platform/pull/663#discussion_r377525243", "createdAt": "2020-02-11T09:40:32Z", "author": {"login": "hbs"}, "path": "warp10/src/main/java/io/warp10/script/functions/GeoUnion.java", "diffHunk": "@@ -16,38 +16,60 @@\n \n package io.warp10.script.functions;\n \n+import com.geoxp.GeoXPLib;\n+import com.geoxp.GeoXPLib.GeoXPShape;\n import io.warp10.script.NamedWarpScriptFunction;\n-import io.warp10.script.WarpScriptStackFunction;\n import io.warp10.script.WarpScriptException;\n import io.warp10.script.WarpScriptStack;\n+import io.warp10.script.WarpScriptStackFunction;\n \n-import com.geoxp.GeoXPLib;\n-import com.geoxp.GeoXPLib.GeoXPShape;\n+import java.util.List;\n \n /**\n  * Computes the union of two GeoXPShape\n  */\n public class GeoUnion extends NamedWarpScriptFunction implements WarpScriptStackFunction {\n-  \n+\n   public GeoUnion(String name) {\n     super(name);\n   }\n-  \n+\n   @Override\n   public Object apply(WarpScriptStack stack) throws WarpScriptException {\n-    Object a = stack.pop();\n-    Object b = stack.pop();\n-    \n-    if (!(a instanceof GeoXPShape) || !(b instanceof GeoXPShape)) {\n-      throw new WarpScriptException(getName() + \" expects two GeoShape instances as the top 2 elements of the stack.\");\n+    Object top = stack.pop();\n+\n+    if (top instanceof List) {\n+      List list = (List) top;\n+      if (list.isEmpty()) {\n+        stack.push(GeoXPLib.fromCells(new long[] {}, false));\n+      } else {\n+        Object element = list.get(0);\n+        if (!(element instanceof GeoXPShape)) {\n+          throw new WarpScriptException(getName() + \" expects two GeoShape instances as the top 2 elements of the stack or a list of GeoShape instances.\");\n+        }\n+        GeoXPShape shape = (GeoXPShape) element;\n+        for (int i = 1; i < list.size(); i++) {\n+          element = list.get(i);\n+          if (!(element instanceof GeoXPShape)) {\n+            throw new WarpScriptException(getName() + \" expects two GeoShape instances as the top 2 elements of the stack or a list of GeoShape instances.\");\n+          }\n+          shape = GeoXPLib.union(shape, (GeoXPShape) list.get(i));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "92033386b6c2ca836321969ebb5de8225c5fa161"}, "originalPosition": 51}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "53908d49204e2c32ef485033841a854185eaa03e", "author": {"user": {"login": "ftence", "name": "Fabien Tenc\u00e9"}}, "url": "https://github.com/senx/warp10-platform/commit/53908d49204e2c32ef485033841a854185eaa03e", "committedDate": "2020-02-11T10:05:36Z", "message": "Use already existing var instead of getting the value again in the list"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3428, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}