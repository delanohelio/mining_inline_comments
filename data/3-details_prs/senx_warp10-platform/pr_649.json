{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY4NTc4Mzcz", "number": 649, "title": "Expose producer owner", "bodyText": "Add configuration to expose producer and owner labels for Geo Time Series retrieved from the Warp 10 Storage Engine.", "createdAt": "2020-01-29T14:12:17Z", "url": "https://github.com/senx/warp10-platform/pull/649", "merged": true, "mergeCommit": {"oid": "ce34a850409289317c01d9b92e391b7a0c684ac1"}, "closed": true, "closedAt": "2020-02-07T11:42:08Z", "author": {"login": "hbs"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb_Gj4lgH2gAyMzY4NTc4MzczOjdmZmMzNjAwNGEyY2EwMTIzNWI5MTA5ZmNkY2I3OWQ3OWMzYTM4YWY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcB8wVJAFqTM1NTA2MjQ1Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7ffc36004a2ca01235b9109fcdcb79d79c3a38af", "author": {"user": {"login": "hbs", "name": "Mathias Herberts"}}, "url": "https://github.com/senx/warp10-platform/commit/7ffc36004a2ca01235b9109fcdcb79d79c3a38af", "committedDate": "2020-01-29T14:10:47Z", "message": "Added configuration to expose owner and producer labels"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUwNDkwNjc5", "url": "https://github.com/senx/warp10-platform/pull/649#pullrequestreview-350490679", "createdAt": "2020-01-29T23:13:41Z", "commit": {"oid": "7ffc36004a2ca01235b9109fcdcb79d79c3a38af"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "609cc6ea61dd36758847f76d49600b51bc85ffe8", "author": {"user": {"login": "hbs", "name": "Mathias Herberts"}}, "url": "https://github.com/senx/warp10-platform/commit/609cc6ea61dd36758847f76d49600b51bc85ffe8", "committedDate": "2020-01-30T07:31:46Z", "message": "Fixed copyright notice"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "baacddf26400f01f519ef4478f478270b5392e6e", "author": {"user": {"login": "hbs", "name": "Mathias Herberts"}}, "url": "https://github.com/senx/warp10-platform/commit/baacddf26400f01f519ef4478f478270b5392e6e", "committedDate": "2020-01-30T14:55:17Z", "message": "Added support for .expose token attribute."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzNzM4MjI3", "url": "https://github.com/senx/warp10-platform/pull/649#pullrequestreview-353738227", "createdAt": "2020-02-05T14:04:55Z", "commit": {"oid": "baacddf26400f01f519ef4478f478270b5392e6e"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQxNDowNDo1NVrOFl41-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQxNTowNjowOFrOFl7JzA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTI3Mjk1NQ==", "bodyText": "expose could be replace with true as this is on attributes, not labels.", "url": "https://github.com/senx/warp10-platform/pull/649#discussion_r375272955", "createdAt": "2020-02-05T14:04:55Z", "author": {"login": "ftence"}, "path": "warp10/src/main/java/io/warp10/continuum/egress/EgressFetchHandler.java", "diffHunk": "@@ -1153,7 +1155,7 @@ private static void textDump(PrintWriter pw, GTSDecoderIterator iter, long now,\n               meta.setAttributes(new TreeMap<String,String>(meta.getAttributes()));\n             }\n             \n-            GTSHelper.labelsToString(sb, meta.getAttributes());\n+            GTSHelper.labelsToString(sb, meta.getAttributes(), expose);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "baacddf26400f01f519ef4478f478270b5392e6e"}, "originalPosition": 100}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTI3NzA1Ng==", "bodyText": "Do or do not, there is no try.", "url": "https://github.com/senx/warp10-platform/pull/649#discussion_r375277056", "createdAt": "2020-02-05T14:12:27Z", "author": {"login": "ftence"}, "path": "warp10/src/main/java/io/warp10/continuum/ThrottlingManager.java", "diffHunk": "@@ -259,7 +259,8 @@ public static void checkMADS(Metadata metadata, String producer, String owner, S\n         labels.put(SensisionConstants.SENSISION_LABEL_PRODUCER, producer);\n         StringBuilder sb = new StringBuilder();\n         sb.append(\"Geo Time Series \");\n-        GTSHelper.metadataToString(sb, metadata.getName(), metadata.getLabels());\n+        // Do not ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "baacddf26400f01f519ef4478f478270b5392e6e"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTI3OTcwMA==", "bodyText": "Is that related to this PR?", "url": "https://github.com/senx/warp10-platform/pull/649#discussion_r375279700", "createdAt": "2020-02-05T14:17:17Z", "author": {"login": "ftence"}, "path": "warp10/src/main/java/io/warp10/script/functions/INFO.java", "diffHunk": "@@ -44,7 +44,11 @@ public Object apply(WarpScriptStack stack) throws WarpScriptException {\n     \n     if (Boolean.TRUE.equals(stack.getAttribute(WarpScriptStack.ATTRIBUTE_INFOMODE))) {\n       // Push the documentation back on the stack\n-      stack.push(top);\n+      // Perform a SNAPSHOT and an EVAL so we clone the info map\n+      StringBuilder sb = new StringBuilder();\n+      SNAPSHOT.addElement(sb, top);\n+      stack.execMulti(sb.toString());\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "baacddf26400f01f519ef4478f478270b5392e6e"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTMwODEwMg==", "bodyText": "Better to avoid searching for the key twice.", "url": "https://github.com/senx/warp10-platform/pull/649#discussion_r375308102", "createdAt": "2020-02-05T15:01:57Z", "author": {"login": "ftence"}, "path": "warp10/src/main/java/io/warp10/standalone/StandalonePlasmaHandler.java", "diffHunk": "@@ -509,12 +542,20 @@ private synchronized void listSubscriptions(Session session) throws IOException\n       for (BigInteger id: this.subscriptions.get(session)) {\n         sb.setLength(0);\n         sb.append(\"SUB \");\n-        GTSHelper.metadataToString(sb, metadatas.get(id).getName(), metadatas.get(id).getLabels());\n+        GTSHelper.metadataToString(sb, metadatas.get(id).getName(), metadatas.get(id).getLabels(), getExposeOwnerProducer(session));\n         session.getRemote().sendString(sb.toString());\n       }\n     }\n   }\n   \n+  private synchronized int getSubscriptionCount(Session session) {\n+    if (this.subscriptions.containsKey(session)) {\n+      return this.subscriptions.get(session).size();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "baacddf26400f01f519ef4478f478270b5392e6e"}, "originalPosition": 83}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTMxMDc5Ng==", "bodyText": "Replace true by expose?", "url": "https://github.com/senx/warp10-platform/pull/649#discussion_r375310796", "createdAt": "2020-02-05T15:06:08Z", "author": {"login": "ftence"}, "path": "warp10/src/main/java/io/warp10/standalone/StandalonePlasmaHandler.java", "diffHunk": "@@ -800,6 +849,18 @@ protected void dispatch(GTSEncoder encoder) throws IOException {\n     return ids;\n   }\n   \n+  private boolean getExposeOwnerProducer(Session session) {\n+    return this.exposeOwnerProducer.getOrDefault(session, false);  \n+  }\n+  \n+  private synchronized void setExposeOwnerProducer(Session session, boolean expose) {\n+    if (true) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "baacddf26400f01f519ef4478f478270b5392e6e"}, "originalPosition": 163}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c4b02834e443393fb62de8b58d40170c6899b76b", "author": {"user": {"login": "hbs", "name": "Mathias Herberts"}}, "url": "https://github.com/senx/warp10-platform/commit/c4b02834e443393fb62de8b58d40170c6899b76b", "committedDate": "2020-02-06T15:25:36Z", "message": "Addressed PR comments by @ftence"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1147ccbf14a70a601cb4d4ff56829a3c3b0623a9", "author": {"user": {"login": "hbs", "name": "Mathias Herberts"}}, "url": "https://github.com/senx/warp10-platform/commit/1147ccbf14a70a601cb4d4ff56829a3c3b0623a9", "committedDate": "2020-02-06T15:26:02Z", "message": "Merge branch 'master' of github.com:senx/warp10-platform into expose-producer-owner"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1MDYyNDUz", "url": "https://github.com/senx/warp10-platform/pull/649#pullrequestreview-355062453", "createdAt": "2020-02-07T10:27:06Z", "commit": {"oid": "1147ccbf14a70a601cb4d4ff56829a3c3b0623a9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3410, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}