{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA2OTEwODEx", "number": 862, "title": "Metadata ordering", "bodyText": "Internal modifications so classes are scanned in the order of their classId, thus returning results in lexicographic order of classId+labelsId.", "createdAt": "2020-10-20T15:38:32Z", "url": "https://github.com/senx/warp10-platform/pull/862", "merged": true, "mergeCommit": {"oid": "f4358a4fc2f2e53ee57c1661d0f3dd1777159aa6"}, "closed": true, "closedAt": "2020-11-04T15:16:07Z", "author": {"login": "hbs"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdTsQqQgH2gAyNTA2OTEwODExOjAwYmI4ZjVmOWMwNDdkYjYyMmYyNTQxY2E4MmVhMzJhZTVkZjM5Y2E=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdZPRhBgFqTUyMzQ1Njc1Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "00bb8f5f9c047db622f2541ca82ea32ae5df39ca", "author": {"user": {"login": "hbs", "name": "Mathias Herberts"}}, "url": "https://github.com/senx/warp10-platform/commit/00bb8f5f9c047db622f2541ca82ea32ae5df39ca", "committedDate": "2020-10-18T09:35:49Z", "message": "Ordered metadata by classid/labelid"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dd2c416b805207e0a95c01294a051a24fbaaa173", "author": {"user": {"login": "hbs", "name": "Mathias Herberts"}}, "url": "https://github.com/senx/warp10-platform/commit/dd2c416b805207e0a95c01294a051a24fbaaa173", "committedDate": "2020-10-19T09:05:18Z", "message": "Made per owner class list ordered by lexicographic classid. Made use of ID_COMPARATOR."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "68d900dca0810a7dd53b694b74bf01ef55618574", "author": {"user": {"login": "hbs", "name": "Mathias Herberts"}}, "url": "https://github.com/senx/warp10-platform/commit/68d900dca0810a7dd53b694b74bf01ef55618574", "committedDate": "2020-10-19T14:58:35Z", "message": "Added flag to control parallel scanners in order to preserve GTS order."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyNTE4MjA3", "url": "https://github.com/senx/warp10-platform/pull/862#pullrequestreview-522518207", "createdAt": "2020-11-03T13:57:27Z", "commit": {"oid": "68d900dca0810a7dd53b694b74bf01ef55618574"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QxMzo1NzoyOFrOHsv4XQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QxNDowNTo0MlrOHswO2A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjY4Mzg2OQ==", "bodyText": "Is there a reason this constructor is not given ID_COMPARATOR?", "url": "https://github.com/senx/warp10-platform/pull/862#discussion_r516683869", "createdAt": "2020-11-03T13:57:28Z", "author": {"login": "ftence"}, "path": "warp10/src/main/java/io/warp10/continuum/store/Directory.java", "diffHunk": "@@ -1885,15 +1885,15 @@ public void run() {\n \n               String owner = metadata.getLabels().get(Constants.OWNER_LABEL);\n               \n-              synchronized(directory.classesPerOwner) {\n-                Set<String> classes = directory.classesPerOwner.get(owner);\n+              synchronized(directory.classesPerOwner) {                \n+                Map<Long, String> classes = directory.classesPerOwner.get(owner);\n                 \n-                if (null == classes) {\n-                  classes = new HashSet<String>();\n+                if (null == classes) {                  \n+                  classes = new ConcurrentSkipListMap<Long, String>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "68d900dca0810a7dd53b694b74bf01ef55618574"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjY4NzkxNA==", "bodyText": "Update copyright notice.", "url": "https://github.com/senx/warp10-platform/pull/862#discussion_r516687914", "createdAt": "2020-11-03T14:03:13Z", "author": {"login": "ftence"}, "path": "warp10/src/main/java/io/warp10/continuum/DirectoryUtil.java", "diffHunk": "@@ -126,7 +126,7 @@ private static long computeHash(long k0, long k1, long timestamp, List<String> c\n   public static DirectoryStatsResponse stats(DirectoryStatsRequest request,\n                                              StandaloneDirectoryClient.ShardFilter filter,\n                                              Map<String, Map<Long, Metadata>> metadatas,\n-                                             Map<String, Set<String>> classesPerOwner,\n+                                             Map<String, Map<Long, String>> classesPerOwner,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "68d900dca0810a7dd53b694b74bf01ef55618574"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjY4ODI3NA==", "bodyText": "Unused.", "url": "https://github.com/senx/warp10-platform/pull/862#discussion_r516688274", "createdAt": "2020-11-03T14:03:47Z", "author": {"login": "ftence"}, "path": "warp10/src/main/java/io/warp10/standalone/StandaloneDirectoryClient.java", "diffHunk": "@@ -43,6 +45,8 @@\n import java.util.regex.Pattern;\n \n import io.warp10.continuum.DirectoryUtil;\n+import io.warp10.continuum.MetadataUtils;\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "68d900dca0810a7dd53b694b74bf01ef55618574"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjY4ODM2Ng==", "bodyText": "Unused.", "url": "https://github.com/senx/warp10-platform/pull/862#discussion_r516688366", "createdAt": "2020-11-03T14:03:56Z", "author": {"login": "ftence"}, "path": "warp10/src/main/java/io/warp10/standalone/StandaloneDirectoryClient.java", "diffHunk": "@@ -67,6 +71,7 @@\n import io.warp10.continuum.Configuration;\n import io.warp10.continuum.egress.ThriftDirectoryClient;\n import io.warp10.continuum.gts.GTSHelper;\n+import io.warp10.continuum.gts.MetadataIdComparator;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "68d900dca0810a7dd53b694b74bf01ef55618574"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjY4OTYyNA==", "bodyText": "Unused.", "url": "https://github.com/senx/warp10-platform/pull/862#discussion_r516689624", "createdAt": "2020-11-03T14:05:42Z", "author": {"login": "ftence"}, "path": "warp10/src/main/java/io/warp10/standalone/StandaloneDirectoryClient.java", "diffHunk": "@@ -110,11 +115,27 @@\n   private long LIMIT_CLASS_CARDINALITY = 100;\n   private long LIMIT_LABELS_CARDINALITY = 100;\n   \n+  private static final int CACHE_SIZE = 1000000;\n+  ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "68d900dca0810a7dd53b694b74bf01ef55618574"}, "originalPosition": 38}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ebda9fd560c0ff48a6ec9f670ba446733095ff5e", "author": {"user": {"login": "hbs", "name": "Mathias Herberts"}}, "url": "https://github.com/senx/warp10-platform/commit/ebda9fd560c0ff48a6ec9f670ba446733095ff5e", "committedDate": "2020-11-04T12:35:18Z", "message": "Addressed PR comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cda4b6aba6ddaaf6310d5ecb68451073974e33d5", "author": {"user": {"login": "hbs", "name": "Mathias Herberts"}}, "url": "https://github.com/senx/warp10-platform/commit/cda4b6aba6ddaaf6310d5ecb68451073974e33d5", "committedDate": "2020-11-04T12:36:49Z", "message": "Resolved conflicts"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIzNDU2NzUy", "url": "https://github.com/senx/warp10-platform/pull/862#pullrequestreview-523456752", "createdAt": "2020-11-04T15:13:03Z", "commit": {"oid": "cda4b6aba6ddaaf6310d5ecb68451073974e33d5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3242, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}