{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYwMjM1MTg0", "number": 811, "title": "Make REMOVE work on GTS using point index", "bodyText": "", "createdAt": "2020-07-31T15:12:21Z", "url": "https://github.com/senx/warp10-platform/pull/811", "merged": true, "mergeCommit": {"oid": "3c1b6aa8f0c6eb32870458fc226cefd8f4e9bb3e"}, "closed": true, "closedAt": "2020-08-03T09:08:37Z", "author": {"login": "ftence"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc6VtlOgH2gAyNDYwMjM1MTg0OmIzZTM1ZWVkZjMyYzY4MWQ5YzJiMmNmYzcwYWFkZDI3ZmFjODgyNDg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc7OMY4gH2gAyNDYwMjM1MTg0OmYyZmFhNDhiMWQzYzliNmRhNTcyMDViMzBlODhkYWYxMDY3NGRmOWY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b3e35eedf32c681d9c2b2cfc70aadd27fac88248", "author": {"user": {"login": "ftence", "name": "Fabien Tenc\u00e9"}}, "url": "https://github.com/senx/warp10-platform/commit/b3e35eedf32c681d9c2b2cfc70aadd27fac88248", "committedDate": "2020-07-31T15:11:29Z", "message": "Make REMOVE work on GTS using point index"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU5MjUzNzMy", "url": "https://github.com/senx/warp10-platform/pull/811#pullrequestreview-459253732", "createdAt": "2020-07-31T15:14:06Z", "commit": {"oid": "b3e35eedf32c681d9c2b2cfc70aadd27fac88248"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQxNToxNDowNlrOG6MNLQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQxNToxNDowNlrOG6MNLQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzY3MDU3Mw==", "bodyText": "Update copyright notice", "url": "https://github.com/senx/warp10-platform/pull/811#discussion_r463670573", "createdAt": "2020-07-31T15:14:06Z", "author": {"login": "hbs"}, "path": "warp10/src/main/java/io/warp10/script/functions/REMOVE.java", "diffHunk": "@@ -16,6 +16,8 @@\n \n package io.warp10.script.functions;\n \n+import io.warp10.continuum.gts.GTSHelper;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b3e35eedf32c681d9c2b2cfc70aadd27fac88248"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f7d80d723ecf1e4c916cbad8f862bb339c901669", "author": {"user": {"login": "ftence", "name": "Fabien Tenc\u00e9"}}, "url": "https://github.com/senx/warp10-platform/commit/f7d80d723ecf1e4c916cbad8f862bb339c901669", "committedDate": "2020-08-03T08:26:24Z", "message": "Update copyright notice and comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU5ODQ0ODky", "url": "https://github.com/senx/warp10-platform/pull/811#pullrequestreview-459844892", "createdAt": "2020-08-03T08:34:50Z", "commit": {"oid": "f7d80d723ecf1e4c916cbad8f862bb339c901669"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QwODozNDo1MFrOG6w0fQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QwODozNDo1MFrOG6w0fQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDI3MDQ2MQ==", "bodyText": "Shouldn't REMOVE behave similarly on a GTS as it does on a list or map? i.e. leave on the stack the data point tuple it just removed? With [ 0 NaN NaN NaN NULL ] if the datapoint did not exist?", "url": "https://github.com/senx/warp10-platform/pull/811#discussion_r464270461", "createdAt": "2020-08-03T08:34:50Z", "author": {"login": "hbs"}, "path": "warp10/src/main/java/io/warp10/script/functions/REMOVE.java", "diffHunk": "@@ -67,8 +69,33 @@ public Object apply(WarpScriptStack stack) throws WarpScriptException {\n       \n       stack.push(coll);\n       stack.push(o);\n+    } else if (coll instanceof GeoTimeSerie) {\n+      if (!(key instanceof Long) && !(key instanceof Integer)) {\n+        throw new WarpScriptException(getName() + \" expects an integer as key.\");\n+      }\n+      int idx = ((Number) key).intValue();\n+\n+      GeoTimeSerie gts = (GeoTimeSerie) coll;\n+\n+      int n = GTSHelper.nvalues(gts);\n+\n+      if (idx < 0) {\n+        idx += n;\n+      }\n+\n+      GeoTimeSerie pruned = gts.cloneEmpty(n);\n+\n+      for (int i = 0; i < n; i++) {\n+        if (i == idx) {\n+          continue;\n+        }\n+\n+        GTSHelper.setValue(pruned, GTSHelper.tickAtIndex(gts, i), GTSHelper.locationAtIndex(gts, i), GTSHelper.elevationAtIndex(gts, i), GTSHelper.valueAtIndex(gts, i), false);\n+      }\n+\n+      stack.push(pruned);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f7d80d723ecf1e4c916cbad8f862bb339c901669"}, "originalPosition": 53}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f2faa48b1d3c9b6da57205b30e88daf10674df9f", "author": {"user": {"login": "ftence", "name": "Fabien Tenc\u00e9"}}, "url": "https://github.com/senx/warp10-platform/commit/f2faa48b1d3c9b6da57205b30e88daf10674df9f", "committedDate": "2020-08-03T08:59:49Z", "message": "Also push removed point and some optimization"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3190, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}