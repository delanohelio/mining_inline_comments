{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM3NDE0MDIx", "number": 777, "reviewThreads": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QxNDoyODoyNVrOELRGVw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QxMjoyNjo0MlrOERbQDw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwMjQ5OTQzOnYy", "diffSide": "RIGHT", "path": "warp10/src/main/java/io/warp10/continuum/Tokens.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QxNDoyODoyNVrOGsyDeA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QxNDoyODoyNVrOGsyDeA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTYxMDYxNg==", "bodyText": "This isn't needed because labels will be overridden by rtoken.getLabels().\nYou can remove this line and modify labels = rtoken.getLabels(); below to Map<String, String> labels = rtoken.getLabels();", "url": "https://github.com/senx/warp10-platform/pull/777#discussion_r449610616", "createdAt": "2020-07-03T14:28:25Z", "author": {"login": "ftence"}, "path": "warp10/src/main/java/io/warp10/continuum/Tokens.java", "diffHunk": "@@ -345,11 +346,11 @@ public static void enableCheckAttributes() {\n    */\n   public static Map<String,String> labelSelectorsFromReadToken(ReadToken rtoken) {\n     \n-    Map<String,String> labelSelectors = new HashMap<String,String>();\n+    Map<String,String> labelSelectors = new LinkedHashMap<String,String>();\n     \n     List<String> owners = new ArrayList<String>();\n     List<String> producers = new ArrayList<String>();\n-    Map<String, String> labels = new HashMap<String, String>();\n+    Map<String, String> labels = new LinkedHashMap<String, String>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bac1b37dad8f131029215e15be238968ce8deb99"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwMjYxNjg2OnYy", "diffSide": "RIGHT", "path": "warp10/src/main/java/io/warp10/continuum/gts/GTSHelper.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QxNToxMTozM1rOGszJJw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QxNToxMTozM1rOGszJJw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTYyODQ1NQ==", "bodyText": "In that case, I think it'd be nicer if parseLabelsSelectors explicitly returns a LinkedHashMap.", "url": "https://github.com/senx/warp10-platform/pull/777#discussion_r449628455", "createdAt": "2020-07-03T15:11:33Z", "author": {"login": "ftence"}, "path": "warp10/src/main/java/io/warp10/continuum/gts/GTSHelper.java", "diffHunk": "@@ -3604,7 +3604,7 @@ public static void fillGTSIds(byte[] bytes, int offset, long classId, long label\n     // Loop over the tokens\n     //\n     \n-    Map<String,String> result = new HashMap<String,String>(tokens.length);\n+    Map<String,String> result = new LinkedHashMap<String,String>(tokens.length);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bac1b37dad8f131029215e15be238968ce8deb99"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwMjYzMDgyOnYy", "diffSide": "RIGHT", "path": "etc/conf.templates/distributed/00-warp.conf.template", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QxNToxNzowNVrOGszRag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QxNToxNzowNVrOGszRag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTYzMDU3MA==", "bodyText": "As it applies only to WarpScript and not on /fetch or /find, it should be in the warpscript conf file.", "url": "https://github.com/senx/warp10-platform/pull/777#discussion_r449630570", "createdAt": "2020-07-03T15:17:05Z", "author": {"login": "ftence"}, "path": "etc/conf.templates/distributed/00-warp.conf.template", "diffHunk": "@@ -137,6 +137,13 @@ warp.components =\n // Maximum length of labels (names + values) - Defaults to 2048\n //\n #warp.labels.maxsize = 2048\n+\n+//\n+// Default priority order for matching labels when doing a FIND/FETCH.\n+// Comma separated list of label names.\n+// Defaults to .producer,.app,.owner\n+//\n+#warp.labels.priority =", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bac1b37dad8f131029215e15be238968ce8deb99"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwMjYzMTQwOnYy", "diffSide": "RIGHT", "path": "etc/conf.templates/standalone/00-warp.conf.template", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QxNToxNzoxNlrOGszRvQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QxNToxNzoxNlrOGszRvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTYzMDY1Mw==", "bodyText": "Ditto.", "url": "https://github.com/senx/warp10-platform/pull/777#discussion_r449630653", "createdAt": "2020-07-03T15:17:16Z", "author": {"login": "ftence"}, "path": "etc/conf.templates/standalone/00-warp.conf.template", "diffHunk": "@@ -219,6 +219,13 @@ plasma.frontend.websocket.maxmessagesize = 1048576\n //\n #warp.labels.maxsize = 2048\n  \n+//\n+// Default priority order for matching labels when doing a FIND/FETCH.\n+// Comma separated list of label names.\n+// Defaults to .producer,.app,.owner\n+//\n+#warp.labels.priority =\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bac1b37dad8f131029215e15be238968ce8deb99"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwMjYzMjM2OnYy", "diffSide": "RIGHT", "path": "warp10/src/main/java/io/warp10/continuum/Configuration.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QxNToxNzo0MlrOGszSSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QxMTo1MDowMFrOG2HDMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTYzMDc5NQ==", "bodyText": "Ditto.", "url": "https://github.com/senx/warp10-platform/pull/777#discussion_r449630795", "createdAt": "2020-07-03T15:17:42Z", "author": {"login": "ftence"}, "path": "warp10/src/main/java/io/warp10/continuum/Configuration.java", "diffHunk": "@@ -1674,6 +1674,13 @@\n    */\n   public static final String WARP_LABELS_MAXSIZE = \"warp.labels.maxsize\";\n   \n+  /**\n+   * Default priority order for matching labels when doing a FIND/FETCH.\n+   * Comma separated list of label names.\n+   * Defaults to .producer,.app,.owner\n+   */\n+  public static final String WARP_LABELS_PRIORITY = \"warp.labels.priority\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bac1b37dad8f131029215e15be238968ce8deb99"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDkyMTQwMg==", "bodyText": "Ditto what? This is in Configuration.java, not in an actual configuration file.", "url": "https://github.com/senx/warp10-platform/pull/777#discussion_r450921402", "createdAt": "2020-07-07T14:46:03Z", "author": {"login": "hbs"}, "path": "warp10/src/main/java/io/warp10/continuum/Configuration.java", "diffHunk": "@@ -1674,6 +1674,13 @@\n    */\n   public static final String WARP_LABELS_MAXSIZE = \"warp.labels.maxsize\";\n   \n+  /**\n+   * Default priority order for matching labels when doing a FIND/FETCH.\n+   * Comma separated list of label names.\n+   * Defaults to .producer,.app,.owner\n+   */\n+  public static final String WARP_LABELS_PRIORITY = \"warp.labels.priority\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTYzMDc5NQ=="}, "originalCommit": {"oid": "bac1b37dad8f131029215e15be238968ce8deb99"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTM5MTc5Mg==", "bodyText": "Sorry that was not clear.\nAs this conf should be moved to the warpscript conf file, the key must also start with warpscript.", "url": "https://github.com/senx/warp10-platform/pull/777#discussion_r459391792", "createdAt": "2020-07-23T11:50:00Z", "author": {"login": "ftence"}, "path": "warp10/src/main/java/io/warp10/continuum/Configuration.java", "diffHunk": "@@ -1674,6 +1674,13 @@\n    */\n   public static final String WARP_LABELS_MAXSIZE = \"warp.labels.maxsize\";\n   \n+  /**\n+   * Default priority order for matching labels when doing a FIND/FETCH.\n+   * Comma separated list of label names.\n+   * Defaults to .producer,.app,.owner\n+   */\n+  public static final String WARP_LABELS_PRIORITY = \"warp.labels.priority\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTYzMDc5NQ=="}, "originalCommit": {"oid": "bac1b37dad8f131029215e15be238968ce8deb99"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwNTg0NTk3OnYy", "diffSide": "RIGHT", "path": "warp10/src/main/java/io/warp10/script/functions/FETCH.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQwODoxODozMFrOGtNXqA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQwODoxODozMFrOGtNXqA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDA1ODE1Mg==", "bodyText": "Unneeded cast.", "url": "https://github.com/senx/warp10-platform/pull/777#discussion_r450058152", "createdAt": "2020-07-06T08:18:30Z", "author": {"login": "ftence"}, "path": "warp10/src/main/java/io/warp10/script/functions/FETCH.java", "diffHunk": "@@ -335,16 +338,62 @@ public Object apply(WarpScriptStack stack) throws WarpScriptException {\n           labelSelectors.remove(Constants.OWNER_LABEL);\n           labelSelectors.remove(Constants.APPLICATION_LABEL);\n           labelSelectors.putAll(Tokens.labelSelectorsFromReadToken(rtoken));\n-          lblsSels.add((Map<String,String>) labelSelectors);\n+          \n+          // Re-order the labels\n+          List<String> order = null;\n+          if (params.containsKey(PARAM_LABELS_PRIORITY)) {\n+            order = (List<String>) params.get(PARAM_LABELS_PRIORITY);\n+          } else {\n+            order = FIND.DEFAULT_LABELS_PRIORITY;\n+          }\n+          Map<String,String> ordered = new LinkedHashMap<String,String>(labelSelectors.size());\n+          for (String label: order) {\n+            if (labelSelectors.containsKey(label)) {\n+              ordered.put(label, labelSelectors.get(label));\n+            }\n+          }\n+          for (Entry<String,String> entry: labelSelectors.entrySet()) {\n+            if (order.contains(entry.getKey())) {\n+              continue;\n+            }\n+            ordered.put(entry.getKey(), entry.getValue());\n+          }\n+\n+          lblsSels.add((Map<String,String>) ordered);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bac1b37dad8f131029215e15be238968ce8deb99"}, "originalPosition": 55}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwNTg1NzIzOnYy", "diffSide": "RIGHT", "path": "warp10/src/main/java/io/warp10/script/functions/FETCH.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQwODoyMTozNlrOGtNebw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQwODoyMTozNlrOGtNebw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDA1OTg4Nw==", "bodyText": "Why don't you use FIND.DEFAULT_LABELS_PRIORITY?", "url": "https://github.com/senx/warp10-platform/pull/777#discussion_r450059887", "createdAt": "2020-07-06T08:21:36Z", "author": {"login": "ftence"}, "path": "warp10/src/main/java/io/warp10/script/functions/FETCH.java", "diffHunk": "@@ -335,16 +338,62 @@ public Object apply(WarpScriptStack stack) throws WarpScriptException {\n           labelSelectors.remove(Constants.OWNER_LABEL);\n           labelSelectors.remove(Constants.APPLICATION_LABEL);\n           labelSelectors.putAll(Tokens.labelSelectorsFromReadToken(rtoken));\n-          lblsSels.add((Map<String,String>) labelSelectors);\n+          \n+          // Re-order the labels\n+          List<String> order = null;\n+          if (params.containsKey(PARAM_LABELS_PRIORITY)) {\n+            order = (List<String>) params.get(PARAM_LABELS_PRIORITY);\n+          } else {\n+            order = FIND.DEFAULT_LABELS_PRIORITY;\n+          }\n+          Map<String,String> ordered = new LinkedHashMap<String,String>(labelSelectors.size());\n+          for (String label: order) {\n+            if (labelSelectors.containsKey(label)) {\n+              ordered.put(label, labelSelectors.get(label));\n+            }\n+          }\n+          for (Entry<String,String> entry: labelSelectors.entrySet()) {\n+            if (order.contains(entry.getKey())) {\n+              continue;\n+            }\n+            ordered.put(entry.getKey(), entry.getValue());\n+          }\n+\n+          lblsSels.add((Map<String,String>) ordered);\n         }\n       } else {\n+        clsSels.add(params.get(PARAM_CLASS).toString());\n+\n         Map<String,String> labelSelectors = (Map<String,String>) params.get(PARAM_LABELS);\n         labelSelectors.remove(Constants.PRODUCER_LABEL);\n         labelSelectors.remove(Constants.OWNER_LABEL);\n         labelSelectors.remove(Constants.APPLICATION_LABEL);\n         labelSelectors.putAll(Tokens.labelSelectorsFromReadToken(rtoken));\n-        clsSels.add(params.get(PARAM_CLASS).toString());\n-        lblsSels.add(labelSelectors);\n+\n+        // Re-order the labels\n+        List<String> order = null;\n+        if (params.containsKey(PARAM_LABELS_PRIORITY)) {\n+          order = (List<String>) params.get(PARAM_LABELS_PRIORITY);\n+        } else {\n+          order = new ArrayList<String>(3);\n+          order.add(Constants.PRODUCER_LABEL);\n+          order.add(Constants.APPLICATION_LABEL);\n+          order.add(Constants.OWNER_LABEL);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bac1b37dad8f131029215e15be238968ce8deb99"}, "originalPosition": 76}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwNzI2MDg2OnYy", "diffSide": "RIGHT", "path": "warp10/src/main/java/io/warp10/script/functions/FIND.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxNDo1MzoxNlrOGtaxvA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxNDo1MzoxNlrOGtaxvA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDI3NzgyMA==", "bodyText": "labelSelectors can be null, and labelSelectors.size() raises a null pointer exception\nCode :\n{\n  'token' 'DataLakeR'\n  'selectors' [ 'class{v=x}' ]\n} FIND", "url": "https://github.com/senx/warp10-platform/pull/777#discussion_r450277820", "createdAt": "2020-07-06T14:53:16Z", "author": {"login": "pi-r-p"}, "path": "warp10/src/main/java/io/warp10/script/functions/FIND.java", "diffHunk": "@@ -319,12 +373,28 @@ public Object apply(WarpScriptStack stack) throws WarpScriptException {\n         // Fix labels\n         \n         if (drequest.isSetLabelsSelectors()) {\n-          for (Map<String,String> sel: drequest.getLabelsSelectors()) {\n+          for (int i = 0; i < drequest.getLabelsSelectorsSize(); i++) {\n+            Map<String,String> sel = drequest.getLabelsSelectors().get(i);\n             sel.remove(Constants.PRODUCER_LABEL);\n             sel.remove(Constants.OWNER_LABEL);\n             sel.remove(Constants.APPLICATION_LABEL);\n             sel.putAll(Tokens.labelSelectorsFromReadToken(rtoken));\n-          }          \n+\n+            // Re-order the labels\n+            Map<String,String> ordered = new LinkedHashMap<String,String>(labelSelectors.size());\n+            for (String label: order) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bac1b37dad8f131029215e15be238968ce8deb99"}, "originalPosition": 137}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwNzQzMDg1OnYy", "diffSide": "RIGHT", "path": "warp10/src/main/java/io/warp10/continuum/Tokens.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxNTozMjoxMVrOGtcZ6A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxNTozMjoxMVrOGtcZ6A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDMwNDQ4OA==", "bodyText": "In that case, I think it'd be nicer if labelSelectorsFromReadToken explicitly returns a LinkedHashMap.", "url": "https://github.com/senx/warp10-platform/pull/777#discussion_r450304488", "createdAt": "2020-07-06T15:32:11Z", "author": {"login": "ftence"}, "path": "warp10/src/main/java/io/warp10/continuum/Tokens.java", "diffHunk": "@@ -345,11 +346,11 @@ public static void enableCheckAttributes() {\n    */\n   public static Map<String,String> labelSelectorsFromReadToken(ReadToken rtoken) {\n     \n-    Map<String,String> labelSelectors = new HashMap<String,String>();\n+    Map<String,String> labelSelectors = new LinkedHashMap<String,String>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bac1b37dad8f131029215e15be238968ce8deb99"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0NjU4ODI4OnYy", "diffSide": "RIGHT", "path": "warp10/src/main/java/io/warp10/script/functions/FIND.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QwOTo1MDozNFrOGzM1ow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QwOTo1MDozNFrOGzM1ow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjM0MDg5OQ==", "bodyText": "There is still a NPE here, order is null when using selectors.\n{\n  'token' 'DataLakeR'\n  'selectors' [ 'pourrissage{vm=' $label + '}' + ]\n} FIND", "url": "https://github.com/senx/warp10-platform/pull/777#discussion_r456340899", "createdAt": "2020-07-17T09:50:34Z", "author": {"login": "pi-r-p"}, "path": "warp10/src/main/java/io/warp10/script/functions/FIND.java", "diffHunk": "@@ -381,7 +381,7 @@ public Object apply(WarpScriptStack stack) throws WarpScriptException {\n             sel.putAll(Tokens.labelSelectorsFromReadToken(rtoken));\n \n             // Re-order the labels\n-            Map<String,String> ordered = new LinkedHashMap<String,String>(labelSelectors.size());\n+            Map<String,String> ordered = new LinkedHashMap<String,String>(null != labelSelectors ? labelSelectors.size() : 1);\n             for (String label: order) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "32ef8e5f0c4dd54fa889e905d583d8b418c09e92"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg2Njk3OTQzOnYy", "diffSide": "RIGHT", "path": "etc/conf.templates/distributed/00-warp.conf.template", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QxMTo1NzoxM1rOG2HQMA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QxMTo1NzoxM1rOG2HQMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTM5NTEyMA==", "bodyText": "Unnecessary change.", "url": "https://github.com/senx/warp10-platform/pull/777#discussion_r459395120", "createdAt": "2020-07-23T11:57:13Z", "author": {"login": "ftence"}, "path": "etc/conf.templates/distributed/00-warp.conf.template", "diffHunk": "@@ -137,7 +137,7 @@ warp.components =\n // Maximum length of labels (names + values) - Defaults to 2048\n //\n #warp.labels.maxsize = 2048\n-  \n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0452a6d4bb574aeb37879fc19708e94aa4791c56"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg2Njk3OTU3OnYy", "diffSide": "RIGHT", "path": "etc/conf.templates/distributed/00-warp.conf.template", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QxMTo1NzoxNlrOG2HQQQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QxMTo1NzoxNlrOG2HQQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTM5NTEzNw==", "bodyText": "Unnecessary change.", "url": "https://github.com/senx/warp10-platform/pull/777#discussion_r459395137", "createdAt": "2020-07-23T11:57:16Z", "author": {"login": "ftence"}, "path": "etc/conf.templates/distributed/00-warp.conf.template", "diffHunk": "@@ -1,5 +1,5 @@\n //\n-//   Copyright 2019  SenX S.A.S.\n+//   Copyright 2019-2020  SenX S.A.S.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0452a6d4bb574aeb37879fc19708e94aa4791c56"}, "originalPosition": 3}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg2Njk4MTQyOnYy", "diffSide": "RIGHT", "path": "etc/conf.templates/distributed/20-warpscript.conf.template", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QxMTo1Nzo0OVrOG2HRRA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QwOTowNjowOFrOG3Z-bw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTM5NTM5Ng==", "bodyText": "Change warp to warpscript and update copyright date.", "url": "https://github.com/senx/warp10-platform/pull/777#discussion_r459395396", "createdAt": "2020-07-23T11:57:49Z", "author": {"login": "ftence"}, "path": "etc/conf.templates/distributed/20-warpscript.conf.template", "diffHunk": "@@ -222,3 +222,10 @@ warpscript.mobius.pool = 16\n // allow C style block comments. /**** valid block comment ****/\n //\n warpscript.comments.loose = true\n+\n+//\n+// Default priority order for matching labels when doing a FIND/FETCH.\n+// Comma separated list of label names.\n+// Defaults to .producer,.app,.owner\n+//\n+#warp.labels.priority =", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0452a6d4bb574aeb37879fc19708e94aa4791c56"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTQ1MzIyMQ==", "bodyText": "the feature is not limited to WarpScript since it is also applies via the /fetch endpoint, so it is a general Warp config. Maybe we should move it back in another file.", "url": "https://github.com/senx/warp10-platform/pull/777#discussion_r459453221", "createdAt": "2020-07-23T13:35:37Z", "author": {"login": "hbs"}, "path": "etc/conf.templates/distributed/20-warpscript.conf.template", "diffHunk": "@@ -222,3 +222,10 @@ warpscript.mobius.pool = 16\n // allow C style block comments. /**** valid block comment ****/\n //\n warpscript.comments.loose = true\n+\n+//\n+// Default priority order for matching labels when doing a FIND/FETCH.\n+// Comma separated list of label names.\n+// Defaults to .producer,.app,.owner\n+//\n+#warp.labels.priority =", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTM5NTM5Ng=="}, "originalCommit": {"oid": "0452a6d4bb574aeb37879fc19708e94aa4791c56"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDc1MDQ0Nw==", "bodyText": "Are you sure?\nConfiguration.WARP_LABELS_PRIORITY is only used to build FIND.DEFAULT_LABELS_PRIORITY which is only used in FIND.apply and FETCH.apply, but not in EgressFetchHandler.\nSo it seems to me this is only a WarpScript configuration key.", "url": "https://github.com/senx/warp10-platform/pull/777#discussion_r460750447", "createdAt": "2020-07-27T09:06:08Z", "author": {"login": "ftence"}, "path": "etc/conf.templates/distributed/20-warpscript.conf.template", "diffHunk": "@@ -222,3 +222,10 @@ warpscript.mobius.pool = 16\n // allow C style block comments. /**** valid block comment ****/\n //\n warpscript.comments.loose = true\n+\n+//\n+// Default priority order for matching labels when doing a FIND/FETCH.\n+// Comma separated list of label names.\n+// Defaults to .producer,.app,.owner\n+//\n+#warp.labels.priority =", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTM5NTM5Ng=="}, "originalCommit": {"oid": "0452a6d4bb574aeb37879fc19708e94aa4791c56"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg2Njk4MjQwOnYy", "diffSide": "RIGHT", "path": "etc/conf.templates/standalone/00-warp.conf.template", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QxMTo1ODowNlrOG2HR2g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QxMTo1ODowNlrOG2HR2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTM5NTU0Ng==", "bodyText": "Unnecessary change.", "url": "https://github.com/senx/warp10-platform/pull/777#discussion_r459395546", "createdAt": "2020-07-23T11:58:06Z", "author": {"login": "ftence"}, "path": "etc/conf.templates/standalone/00-warp.conf.template", "diffHunk": "@@ -1,5 +1,5 @@\n //\n-//   Copyright 2019  SenX S.A.S.\n+//   Copyright 2019-2020  SenX S.A.S.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0452a6d4bb574aeb37879fc19708e94aa4791c56"}, "originalPosition": 3}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg2Njk4MjkyOnYy", "diffSide": "RIGHT", "path": "etc/conf.templates/standalone/20-warpscript.conf.template", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QxMTo1ODoxOVrOG2HSLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QxMTo1ODoxOVrOG2HSLg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTM5NTYzMA==", "bodyText": "Change warp to warpscript and update copyright date.", "url": "https://github.com/senx/warp10-platform/pull/777#discussion_r459395630", "createdAt": "2020-07-23T11:58:19Z", "author": {"login": "ftence"}, "path": "etc/conf.templates/standalone/20-warpscript.conf.template", "diffHunk": "@@ -220,3 +220,10 @@ warpscript.runner.bootstrap.period = 120000\n // allow C style block comments. /**** valid block comment ****/\n //\n warpscript.comments.loose = true\n+\n+//\n+// Default priority order for matching labels when doing a FIND/FETCH.\n+// Comma separated list of label names.\n+// Defaults to .producer,.app,.owner\n+//\n+#warp.labels.priority =", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0452a6d4bb574aeb37879fc19708e94aa4791c56"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg2NzA3NzI3OnYy", "diffSide": "RIGHT", "path": "warp10/src/main/java/io/warp10/script/functions/FIND.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QxMjoyNjo0MlrOG2IKlw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QxMjoyNjo0MlrOG2IKlw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTQxMDA3MQ==", "bodyText": "I think it should be Map<String,String> ordered = new LinkedHashMap<String,String>(sel.size());.", "url": "https://github.com/senx/warp10-platform/pull/777#discussion_r459410071", "createdAt": "2020-07-23T12:26:42Z", "author": {"login": "ftence"}, "path": "warp10/src/main/java/io/warp10/script/functions/FIND.java", "diffHunk": "@@ -317,14 +368,30 @@ public Object apply(WarpScriptStack stack) throws WarpScriptException {\n         drequest.setLabelsSelectors(lblsSels);\n       } else {\n         // Fix labels\n-        \n+\n         if (drequest.isSetLabelsSelectors()) {\n-          for (Map<String,String> sel: drequest.getLabelsSelectors()) {\n+          for (int i = 0; i < drequest.getLabelsSelectorsSize(); i++) {\n+            Map<String,String> sel = drequest.getLabelsSelectors().get(i);\n             sel.remove(Constants.PRODUCER_LABEL);\n             sel.remove(Constants.OWNER_LABEL);\n             sel.remove(Constants.APPLICATION_LABEL);\n             sel.putAll(Tokens.labelSelectorsFromReadToken(rtoken));\n-          }          \n+\n+            // Re-order the labels\n+            Map<String,String> ordered = new LinkedHashMap<String,String>(null != labelSelectors ? labelSelectors.size() : 1);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0452a6d4bb574aeb37879fc19708e94aa4791c56"}, "originalPosition": 136}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1265, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}