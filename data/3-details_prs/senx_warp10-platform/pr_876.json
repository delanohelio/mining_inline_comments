{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI0MDk0NTM2", "number": 876, "title": "ALMOSTEQ (~=): Make conditions on parameters less strict", "bodyText": "One of the operand had to be a double, which is not required by the code. Removed that.\nBe careful: the comparison with lambda was strict, which is not what users could expect. For instance, 1 1 0 ~= would return false. Changed that also.", "createdAt": "2020-11-19T16:54:27Z", "url": "https://github.com/senx/warp10-platform/pull/876", "merged": true, "mergeCommit": {"oid": "0af67316121d78257caffdafc2052849566b998f"}, "closed": true, "closedAt": "2020-12-02T15:52:54Z", "author": {"login": "ftence"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdeFopQgH2gAyNTI0MDk0NTM2OmQ3M2ZkMzU5NTFmMTU1MjU5N2FmNmVjZmUyYjBjMjM1YzMxMzU0Nzg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdiMcnxgH2gAyNTI0MDk0NTM2Ojk2OGNlZDEzMmU5YTU2NjMxNGU5YmM4NDU5YWJhZjI1ZGJlOTExZDc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d73fd35951f1552597af6ecfe2b0c235c3135478", "author": {"user": {"login": "ftence", "name": "Fabien Tenc\u00e9"}}, "url": "https://github.com/senx/warp10-platform/commit/d73fd35951f1552597af6ecfe2b0c235c3135478", "committedDate": "2020-11-19T16:48:53Z", "message": "Make conditions on parameters less strict"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQwMTk4NDU4", "url": "https://github.com/senx/warp10-platform/pull/876#pullrequestreview-540198458", "createdAt": "2020-11-27T21:47:50Z", "commit": {"oid": "d73fd35951f1552597af6ecfe2b0c235c3135478"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QyMTo0Nzo1MFrOH7KESg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yN1QyMTo0Nzo1MFrOH7KESg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTc5Mjk3MA==", "bodyText": "Why use Math.abs for computing values of op1 and op2?", "url": "https://github.com/senx/warp10-platform/pull/876#discussion_r531792970", "createdAt": "2020-11-27T21:47:50Z", "author": {"login": "hbs"}, "path": "warp10/src/main/java/io/warp10/script/functions/ALMOSTEQ.java", "diffHunk": "@@ -40,26 +39,22 @@ public ALMOSTEQ(String name) {\n   @Override\n   public Object apply(WarpScriptStack stack) throws WarpScriptException {\n     Object lambdaParam = stack.pop();\n-    Object op2 = stack.pop();\n-    Object op1 = stack.pop();\n-    \n-    double lambda;\n+    Object op2Param = stack.pop();\n+    Object op1Param = stack.pop();\n \n-    if (lambdaParam instanceof Number) {\n-      lambda = Math.abs(((Number) lambdaParam).doubleValue());\n-    } else {\n-      throw new WarpScriptException(getName() + \" needs three parameters on the stack: 'lambda' (a numeric type) and two operands.\");  \n+    // All operands need to be numeric.\n+    if  (!(lambdaParam instanceof Number) || !(op2Param instanceof Number)  || !(op1Param instanceof Number)) {\n+      throw new WarpScriptException(getName() + \" only accepts numeric parameters.\");\n     }\n \n-    // At least one of the operands must be a Double and both operands need to be numeric types\n-    if  (!(op2 instanceof Number)  || !(op1 instanceof Number) || !(op2 instanceof Double || op1 instanceof Double)) {\n-      throw new WarpScriptException(getName() + \" can only operate on numeric types and at least one of them must be a Double.\");  \n-    }\n-    \n-    if (Double.isNaN(((Number) op1).doubleValue()) || Double.isNaN(((Number) op2).doubleValue())) {\n-      stack.push(Double.isNaN(((Number) op1).doubleValue()) && Double.isNaN(((Number) op2).doubleValue()));\n+    double lambda = Math.abs(((Number) lambdaParam).doubleValue());\n+    double op1 = Math.abs(((Number) op1Param).doubleValue());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d73fd35951f1552597af6ecfe2b0c235c3135478"}, "originalPosition": 49}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "968ced132e9a566314e9bc8459abaf25dbe911d7", "author": {"user": {"login": "ftence", "name": "Fabien Tenc\u00e9"}}, "url": "https://github.com/senx/warp10-platform/commit/968ced132e9a566314e9bc8459abaf25dbe911d7", "committedDate": "2020-12-02T11:00:47Z", "message": "Remove wrongly added Math.abs on ops"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3263, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}