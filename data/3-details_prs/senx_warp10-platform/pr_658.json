{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcyMTUyNzYz", "number": 658, "title": "Initial commit of GEO.GEOHASHES", "bodyText": "Converts a list of geohashes into a GEOSHAPE", "createdAt": "2020-02-06T22:56:09Z", "url": "https://github.com/senx/warp10-platform/pull/658", "merged": true, "mergeCommit": {"oid": "cc79c567b982c971a6354ccc4c6481c0211a7688"}, "closed": true, "closedAt": "2020-02-12T11:23:56Z", "author": {"login": "hbs"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcBy3MogH2gAyMzcyMTUyNzYzOjgwODBlMzRlMGE2NTg3MDE4YmMwMmJlNDVjMTk4MGViMDY4ZTZmNjE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcDkjxzgH2gAyMzcyMTUyNzYzOjVkZTFjZDE3YjljMWFmNjc4MmQ2Y2VmZGIwOWNmNDExNzUyMmZiMTI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8080e34e0a6587018bc02be45c1980eb068e6f61", "author": {"user": {"login": "hbs", "name": "Mathias Herberts"}}, "url": "https://github.com/senx/warp10-platform/commit/8080e34e0a6587018bc02be45c1980eb068e6f61", "committedDate": "2020-02-06T22:55:33Z", "message": "Initial commit of GEO.GEOHASHES"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "771943e9b959694aa0be08b01b414a5c01c1f4c6", "author": {"user": {"login": "hbs", "name": "Mathias Herberts"}}, "url": "https://github.com/senx/warp10-platform/commit/771943e9b959694aa0be08b01b414a5c01c1f4c6", "committedDate": "2020-02-06T23:12:29Z", "message": "Fixed handling of non aligned bit length"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c41b3df94484f6bdc3db8b7f92a3dff2efb64130", "author": {"user": {"login": "hbs", "name": "Mathias Herberts"}}, "url": "https://github.com/senx/warp10-platform/commit/c41b3df94484f6bdc3db8b7f92a3dff2efb64130", "committedDate": "2020-02-06T23:18:10Z", "message": "Fixed typo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "666646fbb77e89e11de93accc73915c3381b0f79", "author": {"user": {"login": "hbs", "name": "Mathias Herberts"}}, "url": "https://github.com/senx/warp10-platform/commit/666646fbb77e89e11de93accc73915c3381b0f79", "committedDate": "2020-02-07T07:01:33Z", "message": "Bumped GeoXPLib to 1.0.0-rc19 and refactored GEOGEOHASHES"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1OTE5OTQz", "url": "https://github.com/senx/warp10-platform/pull/658#pullrequestreview-355919943", "createdAt": "2020-02-10T13:06:47Z", "commit": {"oid": "666646fbb77e89e11de93accc73915c3381b0f79"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "23c9ea94f0a02648c37a9941b6bd32593e5debfa", "author": {"user": {"login": "hbs", "name": "Mathias Herberts"}}, "url": "https://github.com/senx/warp10-platform/commit/23c9ea94f0a02648c37a9941b6bd32593e5debfa", "committedDate": "2020-02-11T10:30:53Z", "message": "Renamed GEOGEOHASHES"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5fd0cc14713f819e8d76f8f7d40bbe6ec9307896", "author": {"user": {"login": "hbs", "name": "Mathias Herberts"}}, "url": "https://github.com/senx/warp10-platform/commit/5fd0cc14713f819e8d76f8f7d40bbe6ec9307896", "committedDate": "2020-02-11T10:31:31Z", "message": "Refactored GEOHASH-> and ->GEOHASH to handle GEOSHAPE instances"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a79b9b814b9490bdc7a2c92e6c2da9197c0d13de", "author": {"user": {"login": "hbs", "name": "Mathias Herberts"}}, "url": "https://github.com/senx/warp10-platform/commit/a79b9b814b9490bdc7a2c92e6c2da9197c0d13de", "committedDate": "2020-02-11T14:18:05Z", "message": "Forced optimization of GeoHashes."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU2NjY1ODA1", "url": "https://github.com/senx/warp10-platform/pull/658#pullrequestreview-356665805", "createdAt": "2020-02-11T13:45:31Z", "commit": {"oid": "5fd0cc14713f819e8d76f8f7d40bbe6ec9307896"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxMzo0NTozMVrOFoJcmA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQxMzo0NTo1OFrOFoJdtQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzY0MjEzNg==", "bodyText": "Add else cause to throw an error for incorrect type.", "url": "https://github.com/senx/warp10-platform/pull/658#discussion_r377642136", "createdAt": "2020-02-11T13:45:31Z", "author": {"login": "ftence"}, "path": "warp10/src/main/java/io/warp10/script/functions/TOGEOHASH.java", "diffHunk": "@@ -36,17 +41,27 @@ public TOGEOHASH(String name) {\n   @Override\n   public Object apply(WarpScriptStack stack) throws WarpScriptException {\n     \n-    Object lon = stack.pop();\n-    Object lat = stack.pop();\n+    Object top = stack.pop();\n     \n-    if (!(lon instanceof Number) && !(lat instanceof Number)) {\n-      throw new WarpScriptException(getName() + \" expects a latitude and a longitude on the stack.\");\n+    if (top instanceof GeoXPShape) {\n+      List<String> geohashes = new ArrayList<String>(GeoHashHelper.fromGeoCells(GeoXPLib.getCells((GeoXPShape) top), false));\n+      stack.push(geohashes);      \n+    } else if (top instanceof Long) {\n+      String geohash = GeoHashHelper.fromHHCode(((Long) top).longValue(), 32);      \n+      stack.push(geohash);            \n+    } else if (top instanceof Double) {\n+      Object lon = (Double) top;\n+      Object lat = stack.pop();\n+      \n+      if (!(lat instanceof Double)) {\n+        throw new WarpScriptException(getName() + \" expects a latitude and a longitude on the stack.\");\n+      }\n+      \n+      long geoxppoint = GeoXPLib.toGeoXPPoint(((Number) lat).doubleValue(), ((Number) lon).doubleValue());\n+      String geohash = GeoHashHelper.fromHHCode(geoxppoint, 32);\n+      \n+      stack.push(geohash);      \n     }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5fd0cc14713f819e8d76f8f7d40bbe6ec9307896"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzY0MjQyMQ==", "bodyText": "Useless cast to Double.", "url": "https://github.com/senx/warp10-platform/pull/658#discussion_r377642421", "createdAt": "2020-02-11T13:45:58Z", "author": {"login": "ftence"}, "path": "warp10/src/main/java/io/warp10/script/functions/TOGEOHASH.java", "diffHunk": "@@ -36,17 +41,27 @@ public TOGEOHASH(String name) {\n   @Override\n   public Object apply(WarpScriptStack stack) throws WarpScriptException {\n     \n-    Object lon = stack.pop();\n-    Object lat = stack.pop();\n+    Object top = stack.pop();\n     \n-    if (!(lon instanceof Number) && !(lat instanceof Number)) {\n-      throw new WarpScriptException(getName() + \" expects a latitude and a longitude on the stack.\");\n+    if (top instanceof GeoXPShape) {\n+      List<String> geohashes = new ArrayList<String>(GeoHashHelper.fromGeoCells(GeoXPLib.getCells((GeoXPShape) top), false));\n+      stack.push(geohashes);      \n+    } else if (top instanceof Long) {\n+      String geohash = GeoHashHelper.fromHHCode(((Long) top).longValue(), 32);      \n+      stack.push(geohash);            \n+    } else if (top instanceof Double) {\n+      Object lon = (Double) top;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5fd0cc14713f819e8d76f8f7d40bbe6ec9307896"}, "originalPosition": 30}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e1920ce18a62edd94ae43651a9bd54e1320d5892", "author": {"user": {"login": "hbs", "name": "Mathias Herberts"}}, "url": "https://github.com/senx/warp10-platform/commit/e1920ce18a62edd94ae43651a9bd54e1320d5892", "committedDate": "2020-02-11T14:27:53Z", "message": "Addressed PR comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "868a3ccba57b2b389ebaace2ec51b4cad0b35899", "author": {"user": {"login": "hbs", "name": "Mathias Herberts"}}, "url": "https://github.com/senx/warp10-platform/commit/868a3ccba57b2b389ebaace2ec51b4cad0b35899", "committedDate": "2020-02-11T14:29:33Z", "message": "Bumped GeoXPLib to 1.0.0-rc21 to have GeoHash syntax checks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "69e3cd0556fff75f108380d6309828b40487a2b7", "author": {"user": {"login": "hbs", "name": "Mathias Herberts"}}, "url": "https://github.com/senx/warp10-platform/commit/69e3cd0556fff75f108380d6309828b40487a2b7", "committedDate": "2020-02-11T14:30:55Z", "message": "Fixed merge conflict"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "00b0445002f1280effe5bb0255292a9f38d9f2db", "author": {"user": {"login": "hbs", "name": "Mathias Herberts"}}, "url": "https://github.com/senx/warp10-platform/commit/00b0445002f1280effe5bb0255292a9f38d9f2db", "committedDate": "2020-02-12T08:35:36Z", "message": "Bumped GeoXPLib to 1.0.0-rc22"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU3MzA2Njgw", "url": "https://github.com/senx/warp10-platform/pull/658#pullrequestreview-357306680", "createdAt": "2020-02-12T09:39:16Z", "commit": {"oid": "00b0445002f1280effe5bb0255292a9f38d9f2db"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5de1cd17b9c1af6782d6cefdb09cf4117522fb12", "author": {"user": {"login": "hbs", "name": "Mathias Herberts"}}, "url": "https://github.com/senx/warp10-platform/commit/5de1cd17b9c1af6782d6cefdb09cf4117522fb12", "committedDate": "2020-02-12T11:23:31Z", "message": "Fixed merge conflict"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3416, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}