{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA2NzM0NTc1", "number": 741, "title": "Merge OpAND and OpOR", "bodyText": "Also remove null != namespace which was always true.", "createdAt": "2020-04-21T15:05:35Z", "url": "https://github.com/senx/warp10-platform/pull/741", "merged": true, "mergeCommit": {"oid": "8b2143bd78debff8a9ee33089dee38e5394f1d99"}, "closed": true, "closedAt": "2020-04-22T15:09:47Z", "author": {"login": "ftence"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcZ1CU_AH2gAyNDA2NzM0NTc1OjA4ODQyMDg0NzYyNTVlNTliNDFlM2I1OGU5OGE4YzdiNDk0ZWE5MzE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcaJvvKAFqTM5ODI5MjAwNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0884208476255e59b41e3b58e98a8c7b494ea931", "author": {"user": {"login": "ftence", "name": "Fabien Tenc\u00e9"}}, "url": "https://github.com/senx/warp10-platform/commit/0884208476255e59b41e3b58e98a8c7b494ea931", "committedDate": "2020-04-21T15:01:42Z", "message": "Merge OpAND and OpOR"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "37b5ef84da19389c39cb59b3e787fa322ad6eb48", "author": {"user": {"login": "ftence", "name": "Fabien Tenc\u00e9"}}, "url": "https://github.com/senx/warp10-platform/commit/37b5ef84da19389c39cb59b3e787fa322ad6eb48", "committedDate": "2020-04-21T15:03:54Z", "message": "Add doc"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3NDQ4NTkw", "url": "https://github.com/senx/warp10-platform/pull/741#pullrequestreview-397448590", "createdAt": "2020-04-21T15:30:47Z", "commit": {"oid": "37b5ef84da19389c39cb59b3e787fa322ad6eb48"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQwNzowMTowMFrOGJmiSA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQwNzowMTowMFrOGJmiSA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjcyMTczNg==", "bodyText": "This comment should be modified.", "url": "https://github.com/senx/warp10-platform/pull/741#discussion_r412721736", "createdAt": "2020-04-22T07:01:00Z", "author": {"login": "hbs"}, "path": "warp10/src/main/java/io/warp10/script/op/OpBoolean.java", "diffHunk": "@@ -21,55 +21,50 @@\n import io.warp10.script.WarpScriptNAryFunction;\n import io.warp10.script.WarpScriptException;\n \n-import java.util.Map;\n-\n /**\n  * OR values from multiple time series. The elevation and location are cleared.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "37b5ef84da19389c39cb59b3e787fa322ad6eb48"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3ODk2MzYw", "url": "https://github.com/senx/warp10-platform/pull/741#pullrequestreview-397896360", "createdAt": "2020-04-22T07:01:40Z", "commit": {"oid": "37b5ef84da19389c39cb59b3e787fa322ad6eb48"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQwNzowMTo0MFrOGJmkCg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQwNzowMTo0MFrOGJmkCg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjcyMjE4Ng==", "bodyText": "This deserves an explanatory comment", "url": "https://github.com/senx/warp10-platform/pull/741#discussion_r412722186", "createdAt": "2020-04-22T07:01:40Z", "author": {"login": "hbs"}, "path": "warp10/src/main/java/io/warp10/script/op/OpBoolean.java", "diffHunk": "@@ -21,55 +21,50 @@\n import io.warp10.script.WarpScriptNAryFunction;\n import io.warp10.script.WarpScriptException;\n \n-import java.util.Map;\n-\n /**\n  * OR values from multiple time series. The elevation and location are cleared.\n  */\n-public class OpOR extends NamedWarpScriptFunction implements WarpScriptNAryFunction {\n-  \n+public class OpBoolean extends NamedWarpScriptFunction implements WarpScriptNAryFunction {\n+\n+  /**\n+   * Does this apply an \"or\" (true) or an \"and\" (false).\n+   */\n+  private final Boolean or;\n+\n   /**\n    * Should we ignore nulls (false) or forbid them (true)\n    */\n   private final boolean forbidNulls;\n   \n-  public OpOR(String name, boolean forbidNulls) {\n+  public OpBoolean(String name, boolean applyOr, boolean forbidNulls) {\n     super(name);\n+    this.or = applyOr;\n     this.forbidNulls = forbidNulls;\n   }\n   \n   @Override\n   public Object apply(Object[] args) throws WarpScriptException {\n     long tick = (long) args[0];\n-    String[] names = (String[]) args[1];\n-    Map<String,String>[] labels = (Map<String,String>[]) args[2];\n-    long[] ticks = (long[]) args[3];\n-    long[] locations = (long[]) args[4];\n-    long[] elevations = (long[]) args[5];\n     Object[] values = (Object[]) args[6];\n     \n-    boolean or = false;\n-    \n     long location = GeoTimeSerie.NO_LOCATION;\n     long elevation = GeoTimeSerie.NO_ELEVATION;\n-    \n-    for (int i = 0; i < values.length; i++) {      \n+\n+    for (Object value: values) {\n       // If one of the values is 'null' (absent), return null as the value\n-      if (null == values[i]) {\n+      if (null == value) {\n         if (this.forbidNulls) {\n-          return new Object[] { tick, location, elevation, null };\n+          return new Object[] {tick, location, elevation, null};\n         } else {\n           continue;\n         }\n-      }      \n-      \n-      or = or || Boolean.TRUE.equals(values[i]);\n-      \n-      if (or) {\n-        return new Object[] { tick, location, elevation, true };\n+      }\n+\n+      if (this.or.equals(value)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "37b5ef84da19389c39cb59b3e787fa322ad6eb48"}, "originalPosition": 72}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3cb6a5901926cbad18be56e3a9e3fb400c8ae5c4", "author": {"user": {"login": "ftence", "name": "Fabien Tenc\u00e9"}}, "url": "https://github.com/senx/warp10-platform/commit/3cb6a5901926cbad18be56e3a9e3fb400c8ae5c4", "committedDate": "2020-04-22T13:23:26Z", "message": "Add and fix comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4MjkxODI1", "url": "https://github.com/senx/warp10-platform/pull/741#pullrequestreview-398291825", "createdAt": "2020-04-22T15:09:13Z", "commit": {"oid": "3cb6a5901926cbad18be56e3a9e3fb400c8ae5c4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxNTowOToxM1rOGJ7o8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxNTowOToxM1rOGJ7o8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzA2NzUwNA==", "bodyText": "Please refrain from using Python syntax for boolean constants", "url": "https://github.com/senx/warp10-platform/pull/741#discussion_r413067504", "createdAt": "2020-04-22T15:09:13Z", "author": {"login": "hbs"}, "path": "warp10/src/main/java/io/warp10/script/op/OpBoolean.java", "diffHunk": "@@ -21,55 +21,59 @@\n import io.warp10.script.WarpScriptNAryFunction;\n import io.warp10.script.WarpScriptException;\n \n-import java.util.Map;\n-\n /**\n- * OR values from multiple time series. The elevation and location are cleared.\n+ * OR or AND values from multiple time series. The elevation and location are cleared.\n  */\n-public class OpOR extends NamedWarpScriptFunction implements WarpScriptNAryFunction {\n-  \n+public class OpBoolean extends NamedWarpScriptFunction implements WarpScriptNAryFunction {\n+\n+  /**\n+   * Does this apply an \"or\" (true) or an \"and\" (false).\n+   */\n+  private final Boolean or;\n+\n   /**\n    * Should we ignore nulls (false) or forbid them (true)\n    */\n   private final boolean forbidNulls;\n-  \n-  public OpOR(String name, boolean forbidNulls) {\n+\n+  /**\n+   * Build a boolean operator applying either OR or AND.\n+   * @param name Name given to this function\n+   * @param applyOr Whether to apply \"or\" (true) or an \"and\" (false).\n+   * @param forbidNulls Whether to ignore nulls (false) or forbid them (true).\n+   */\n+  public OpBoolean(String name, boolean applyOr, boolean forbidNulls) {\n     super(name);\n+    this.or = applyOr;\n     this.forbidNulls = forbidNulls;\n   }\n   \n   @Override\n   public Object apply(Object[] args) throws WarpScriptException {\n     long tick = (long) args[0];\n-    String[] names = (String[]) args[1];\n-    Map<String,String>[] labels = (Map<String,String>[]) args[2];\n-    long[] ticks = (long[]) args[3];\n-    long[] locations = (long[]) args[4];\n-    long[] elevations = (long[]) args[5];\n     Object[] values = (Object[]) args[6];\n     \n-    boolean or = false;\n-    \n     long location = GeoTimeSerie.NO_LOCATION;\n     long elevation = GeoTimeSerie.NO_ELEVATION;\n-    \n-    for (int i = 0; i < values.length; i++) {      \n+\n+    for (Object value: values) {\n       // If one of the values is 'null' (absent), return null as the value\n-      if (null == values[i]) {\n+      if (null == value) {\n         if (this.forbidNulls) {\n-          return new Object[] { tick, location, elevation, null };\n+          return new Object[] {tick, location, elevation, null};\n         } else {\n           continue;\n         }\n-      }      \n-      \n-      or = or || Boolean.TRUE.equals(values[i]);\n-      \n-      if (or) {\n-        return new Object[] { tick, location, elevation, true };\n+      }\n+\n+      // If this function applies an OR, this can stop as soon as it encounters a True value and the result will be True.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3cb6a5901926cbad18be56e3a9e3fb400c8ae5c4"}, "originalPosition": 80}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4MjkyMDA0", "url": "https://github.com/senx/warp10-platform/pull/741#pullrequestreview-398292004", "createdAt": "2020-04-22T15:09:24Z", "commit": {"oid": "3cb6a5901926cbad18be56e3a9e3fb400c8ae5c4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxNTowOToyNFrOGJ7prA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxNTowOToyNFrOGJ7prA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzA2NzY5Mg==", "bodyText": "Unrelated to PR", "url": "https://github.com/senx/warp10-platform/pull/741#discussion_r413067692", "createdAt": "2020-04-22T15:09:24Z", "author": {"login": "hbs"}, "path": "warp10/src/main/java/io/warp10/script/WarpScriptLib.java", "diffHunk": "@@ -2507,7 +2506,7 @@ public static void registerExtensions() {\n         wse.register();\n         \n         String namespace = props.getProperty(Configuration.CONFIG_WARPSCRIPT_NAMESPACE_PREFIX + wse.getClass().getName(), \"\").trim(); \n-        if (null != namespace && !\"\".equals(namespace)) {\n+        if (!\"\".equals(namespace)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3cb6a5901926cbad18be56e3a9e3fb400c8ae5c4"}, "originalPosition": 38}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3323, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}