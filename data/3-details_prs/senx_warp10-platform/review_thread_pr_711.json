{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk2Mzk4ODEy", "number": 711, "reviewThreads": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQxNjoxOToyNlrODtL68w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQxNjoyNTo1OVrODtMFlw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ4NzA3ODI3OnYy", "diffSide": "RIGHT", "path": "warp10/src/main/java/io/warp10/script/binary/ADD.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQxNjoxOToyNlrOF-dxGQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQxOTozMTozOFrOF-lBhw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTA0MzczNw==", "bodyText": "There should be a test in applyBinaryOp that the operator is non null, as is the op.op() call will fail with an NPE.", "url": "https://github.com/senx/warp10-platform/pull/711#discussion_r401043737", "createdAt": "2020-03-31T16:19:26Z", "author": {"login": "hbs"}, "path": "warp10/src/main/java/io/warp10/script/binary/ADD.java", "diffHunk": "@@ -137,13 +137,16 @@ public Object op(GeoTimeSerie gtsa, GeoTimeSerie gtsb, int idxa, int idxb) {\n           };\n           break;\n         default:\n-          // both inputs are empty, return an empty gts.\n-          stack.push(new GeoTimeSerie());\n-          return stack;\n+          // Leave op to null.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c79ced1a708519f757a0affac24cb1a8f5b95b27"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTE2MjYzMQ==", "bodyText": "I agree this would be nicer, but this won't lead to a NPE because the default means both GTSs are empty and applyBinaryOp won't apply op at all.", "url": "https://github.com/senx/warp10-platform/pull/711#discussion_r401162631", "createdAt": "2020-03-31T19:31:38Z", "author": {"login": "ftence"}, "path": "warp10/src/main/java/io/warp10/script/binary/ADD.java", "diffHunk": "@@ -137,13 +137,16 @@ public Object op(GeoTimeSerie gtsa, GeoTimeSerie gtsb, int idxa, int idxb) {\n           };\n           break;\n         default:\n-          // both inputs are empty, return an empty gts.\n-          stack.push(new GeoTimeSerie());\n-          return stack;\n+          // Leave op to null.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTA0MzczNw=="}, "originalCommit": {"oid": "c79ced1a708519f757a0affac24cb1a8f5b95b27"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ4NzEwMDU4OnYy", "diffSide": "RIGHT", "path": "warp10/src/main/java/io/warp10/script/binary/SUB.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQxNjoyNDo0NVrOF-d_bQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQyMToyMzoxOVrOF-owLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTA0NzQwNQ==", "bodyText": "avoiding the function call op.doubleValue() would probably be more efficient, at least before inlining/JIT kicks in.", "url": "https://github.com/senx/warp10-platform/pull/711#discussion_r401047405", "createdAt": "2020-03-31T16:24:45Z", "author": {"login": "hbs"}, "path": "warp10/src/main/java/io/warp10/script/binary/SUB.java", "diffHunk": "@@ -171,19 +164,31 @@ public Object apply(WarpScriptStack stack) throws WarpScriptException {\n       if (!(gts.getType() == TYPE.LONG || gts.getType() == TYPE.DOUBLE)) {\n         throw new WarpScriptException(typeCheckErrorMsg);\n       }\n-      \n-      double op = op1gts ? ((Number) op2).doubleValue() : ((Number) op1).doubleValue();\n-      \n-      for (int i = 0; i < n; i++) {\n-       double value;\n-       if (op1gts) {\n-         value = ((Number) GTSHelper.valueAtIndex(gts, i)).doubleValue() - op;\n-       } else {\n-         value = op - ((Number) GTSHelper.valueAtIndex(gts, i)).doubleValue();\n-       }\n-       GTSHelper.setValue(result, GTSHelper.tickAtIndex(gts, i), GTSHelper.locationAtIndex(gts, i), GTSHelper.elevationAtIndex(gts, i), value, false);\n-      }      \n \n+\n+      Number op = op1gts ? (Number) op2 : (Number) op1;\n+\n+      if (op instanceof Double || gts.getType() == TYPE.DOUBLE) {\n+        for (int i = 0; i < n; i++) {\n+          double value;\n+          if (op1gts) {\n+            value = ((Number) GTSHelper.valueAtIndex(gts, i)).doubleValue() - op.doubleValue();\n+          } else {\n+            value = op.doubleValue() - ((Number) GTSHelper.valueAtIndex(gts, i)).doubleValue();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c79ced1a708519f757a0affac24cb1a8f5b95b27"}, "originalPosition": 86}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTE2MDM5MQ==", "bodyText": "Call to op.doubleValue() is mandatory because all we know is that it is a Number in the case gts.getType() == TYPE.DOUBLE.", "url": "https://github.com/senx/warp10-platform/pull/711#discussion_r401160391", "createdAt": "2020-03-31T19:27:46Z", "author": {"login": "ftence"}, "path": "warp10/src/main/java/io/warp10/script/binary/SUB.java", "diffHunk": "@@ -171,19 +164,31 @@ public Object apply(WarpScriptStack stack) throws WarpScriptException {\n       if (!(gts.getType() == TYPE.LONG || gts.getType() == TYPE.DOUBLE)) {\n         throw new WarpScriptException(typeCheckErrorMsg);\n       }\n-      \n-      double op = op1gts ? ((Number) op2).doubleValue() : ((Number) op1).doubleValue();\n-      \n-      for (int i = 0; i < n; i++) {\n-       double value;\n-       if (op1gts) {\n-         value = ((Number) GTSHelper.valueAtIndex(gts, i)).doubleValue() - op;\n-       } else {\n-         value = op - ((Number) GTSHelper.valueAtIndex(gts, i)).doubleValue();\n-       }\n-       GTSHelper.setValue(result, GTSHelper.tickAtIndex(gts, i), GTSHelper.locationAtIndex(gts, i), GTSHelper.elevationAtIndex(gts, i), value, false);\n-      }      \n \n+\n+      Number op = op1gts ? (Number) op2 : (Number) op1;\n+\n+      if (op instanceof Double || gts.getType() == TYPE.DOUBLE) {\n+        for (int i = 0; i < n; i++) {\n+          double value;\n+          if (op1gts) {\n+            value = ((Number) GTSHelper.valueAtIndex(gts, i)).doubleValue() - op.doubleValue();\n+          } else {\n+            value = op.doubleValue() - ((Number) GTSHelper.valueAtIndex(gts, i)).doubleValue();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTA0NzQwNQ=="}, "originalCommit": {"oid": "c79ced1a708519f757a0affac24cb1a8f5b95b27"}, "originalPosition": 86}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTIyMzcyNA==", "bodyText": "yes but you don't have to do it in the loop!", "url": "https://github.com/senx/warp10-platform/pull/711#discussion_r401223724", "createdAt": "2020-03-31T21:23:19Z", "author": {"login": "hbs"}, "path": "warp10/src/main/java/io/warp10/script/binary/SUB.java", "diffHunk": "@@ -171,19 +164,31 @@ public Object apply(WarpScriptStack stack) throws WarpScriptException {\n       if (!(gts.getType() == TYPE.LONG || gts.getType() == TYPE.DOUBLE)) {\n         throw new WarpScriptException(typeCheckErrorMsg);\n       }\n-      \n-      double op = op1gts ? ((Number) op2).doubleValue() : ((Number) op1).doubleValue();\n-      \n-      for (int i = 0; i < n; i++) {\n-       double value;\n-       if (op1gts) {\n-         value = ((Number) GTSHelper.valueAtIndex(gts, i)).doubleValue() - op;\n-       } else {\n-         value = op - ((Number) GTSHelper.valueAtIndex(gts, i)).doubleValue();\n-       }\n-       GTSHelper.setValue(result, GTSHelper.tickAtIndex(gts, i), GTSHelper.locationAtIndex(gts, i), GTSHelper.elevationAtIndex(gts, i), value, false);\n-      }      \n \n+\n+      Number op = op1gts ? (Number) op2 : (Number) op1;\n+\n+      if (op instanceof Double || gts.getType() == TYPE.DOUBLE) {\n+        for (int i = 0; i < n; i++) {\n+          double value;\n+          if (op1gts) {\n+            value = ((Number) GTSHelper.valueAtIndex(gts, i)).doubleValue() - op.doubleValue();\n+          } else {\n+            value = op.doubleValue() - ((Number) GTSHelper.valueAtIndex(gts, i)).doubleValue();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTA0NzQwNQ=="}, "originalCommit": {"oid": "c79ced1a708519f757a0affac24cb1a8f5b95b27"}, "originalPosition": 86}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ4NzEwMDg0OnYy", "diffSide": "RIGHT", "path": "warp10/src/main/java/io/warp10/script/binary/SUB.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQxNjoyNDo1MVrOF-d_lw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQyMToyMzozMlrOF-owkw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTA0NzQ0Nw==", "bodyText": "ditto", "url": "https://github.com/senx/warp10-platform/pull/711#discussion_r401047447", "createdAt": "2020-03-31T16:24:51Z", "author": {"login": "hbs"}, "path": "warp10/src/main/java/io/warp10/script/binary/SUB.java", "diffHunk": "@@ -171,19 +164,31 @@ public Object apply(WarpScriptStack stack) throws WarpScriptException {\n       if (!(gts.getType() == TYPE.LONG || gts.getType() == TYPE.DOUBLE)) {\n         throw new WarpScriptException(typeCheckErrorMsg);\n       }\n-      \n-      double op = op1gts ? ((Number) op2).doubleValue() : ((Number) op1).doubleValue();\n-      \n-      for (int i = 0; i < n; i++) {\n-       double value;\n-       if (op1gts) {\n-         value = ((Number) GTSHelper.valueAtIndex(gts, i)).doubleValue() - op;\n-       } else {\n-         value = op - ((Number) GTSHelper.valueAtIndex(gts, i)).doubleValue();\n-       }\n-       GTSHelper.setValue(result, GTSHelper.tickAtIndex(gts, i), GTSHelper.locationAtIndex(gts, i), GTSHelper.elevationAtIndex(gts, i), value, false);\n-      }      \n \n+\n+      Number op = op1gts ? (Number) op2 : (Number) op1;\n+\n+      if (op instanceof Double || gts.getType() == TYPE.DOUBLE) {\n+        for (int i = 0; i < n; i++) {\n+          double value;\n+          if (op1gts) {\n+            value = ((Number) GTSHelper.valueAtIndex(gts, i)).doubleValue() - op.doubleValue();\n+          } else {\n+            value = op.doubleValue() - ((Number) GTSHelper.valueAtIndex(gts, i)).doubleValue();\n+          }\n+          GTSHelper.setValue(result, GTSHelper.tickAtIndex(gts, i), GTSHelper.locationAtIndex(gts, i), GTSHelper.elevationAtIndex(gts, i), value, false);\n+        }\n+      } else {\n+        for (int i = 0; i < n; i++) {\n+          long value;\n+          if (op1gts) {\n+            value = ((Number) GTSHelper.valueAtIndex(gts, i)).longValue() - op.longValue();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c79ced1a708519f757a0affac24cb1a8f5b95b27"}, "originalPosition": 94}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTE2MTIxMg==", "bodyText": "Same idea as previous comment, this time because if op is not a Double, it may be a Long or an AtomicLong.", "url": "https://github.com/senx/warp10-platform/pull/711#discussion_r401161212", "createdAt": "2020-03-31T19:29:01Z", "author": {"login": "ftence"}, "path": "warp10/src/main/java/io/warp10/script/binary/SUB.java", "diffHunk": "@@ -171,19 +164,31 @@ public Object apply(WarpScriptStack stack) throws WarpScriptException {\n       if (!(gts.getType() == TYPE.LONG || gts.getType() == TYPE.DOUBLE)) {\n         throw new WarpScriptException(typeCheckErrorMsg);\n       }\n-      \n-      double op = op1gts ? ((Number) op2).doubleValue() : ((Number) op1).doubleValue();\n-      \n-      for (int i = 0; i < n; i++) {\n-       double value;\n-       if (op1gts) {\n-         value = ((Number) GTSHelper.valueAtIndex(gts, i)).doubleValue() - op;\n-       } else {\n-         value = op - ((Number) GTSHelper.valueAtIndex(gts, i)).doubleValue();\n-       }\n-       GTSHelper.setValue(result, GTSHelper.tickAtIndex(gts, i), GTSHelper.locationAtIndex(gts, i), GTSHelper.elevationAtIndex(gts, i), value, false);\n-      }      \n \n+\n+      Number op = op1gts ? (Number) op2 : (Number) op1;\n+\n+      if (op instanceof Double || gts.getType() == TYPE.DOUBLE) {\n+        for (int i = 0; i < n; i++) {\n+          double value;\n+          if (op1gts) {\n+            value = ((Number) GTSHelper.valueAtIndex(gts, i)).doubleValue() - op.doubleValue();\n+          } else {\n+            value = op.doubleValue() - ((Number) GTSHelper.valueAtIndex(gts, i)).doubleValue();\n+          }\n+          GTSHelper.setValue(result, GTSHelper.tickAtIndex(gts, i), GTSHelper.locationAtIndex(gts, i), GTSHelper.elevationAtIndex(gts, i), value, false);\n+        }\n+      } else {\n+        for (int i = 0; i < n; i++) {\n+          long value;\n+          if (op1gts) {\n+            value = ((Number) GTSHelper.valueAtIndex(gts, i)).longValue() - op.longValue();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTA0NzQ0Nw=="}, "originalCommit": {"oid": "c79ced1a708519f757a0affac24cb1a8f5b95b27"}, "originalPosition": 94}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTIyMzgyNw==", "bodyText": "get it out of the loop!", "url": "https://github.com/senx/warp10-platform/pull/711#discussion_r401223827", "createdAt": "2020-03-31T21:23:32Z", "author": {"login": "hbs"}, "path": "warp10/src/main/java/io/warp10/script/binary/SUB.java", "diffHunk": "@@ -171,19 +164,31 @@ public Object apply(WarpScriptStack stack) throws WarpScriptException {\n       if (!(gts.getType() == TYPE.LONG || gts.getType() == TYPE.DOUBLE)) {\n         throw new WarpScriptException(typeCheckErrorMsg);\n       }\n-      \n-      double op = op1gts ? ((Number) op2).doubleValue() : ((Number) op1).doubleValue();\n-      \n-      for (int i = 0; i < n; i++) {\n-       double value;\n-       if (op1gts) {\n-         value = ((Number) GTSHelper.valueAtIndex(gts, i)).doubleValue() - op;\n-       } else {\n-         value = op - ((Number) GTSHelper.valueAtIndex(gts, i)).doubleValue();\n-       }\n-       GTSHelper.setValue(result, GTSHelper.tickAtIndex(gts, i), GTSHelper.locationAtIndex(gts, i), GTSHelper.elevationAtIndex(gts, i), value, false);\n-      }      \n \n+\n+      Number op = op1gts ? (Number) op2 : (Number) op1;\n+\n+      if (op instanceof Double || gts.getType() == TYPE.DOUBLE) {\n+        for (int i = 0; i < n; i++) {\n+          double value;\n+          if (op1gts) {\n+            value = ((Number) GTSHelper.valueAtIndex(gts, i)).doubleValue() - op.doubleValue();\n+          } else {\n+            value = op.doubleValue() - ((Number) GTSHelper.valueAtIndex(gts, i)).doubleValue();\n+          }\n+          GTSHelper.setValue(result, GTSHelper.tickAtIndex(gts, i), GTSHelper.locationAtIndex(gts, i), GTSHelper.elevationAtIndex(gts, i), value, false);\n+        }\n+      } else {\n+        for (int i = 0; i < n; i++) {\n+          long value;\n+          if (op1gts) {\n+            value = ((Number) GTSHelper.valueAtIndex(gts, i)).longValue() - op.longValue();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTA0NzQ0Nw=="}, "originalCommit": {"oid": "c79ced1a708519f757a0affac24cb1a8f5b95b27"}, "originalPosition": 94}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ4NzEwMzM4OnYy", "diffSide": "RIGHT", "path": "warp10/src/main/java/io/warp10/script/binary/DIV.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQxNjoyNToyOFrOF-eBKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQyMToyMzo0M1rOF-ow4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTA0Nzg1MA==", "bodyText": "avoid function call op.doubleValue()", "url": "https://github.com/senx/warp10-platform/pull/711#discussion_r401047850", "createdAt": "2020-03-31T16:25:28Z", "author": {"login": "hbs"}, "path": "warp10/src/main/java/io/warp10/script/binary/DIV.java", "diffHunk": "@@ -168,19 +161,30 @@ public Object apply(WarpScriptStack stack) throws WarpScriptException {\n       if (!(gts.getType() == TYPE.LONG || gts.getType() == TYPE.DOUBLE)) {\n         throw new WarpScriptException(typeCheckErrorMsg);\n       }\n-      \n-      double op = op1gts ? ((Number) op2).doubleValue() : ((Number) op1).doubleValue();\n-      \n-      for (int i = 0; i < n; i++) {\n-       double value;\n-       if (op1gts) {\n-         value = ((Number) GTSHelper.valueAtIndex(gts, i)).doubleValue() / op;\n-       } else {\n-         value = op / ((Number) GTSHelper.valueAtIndex(gts, i)).doubleValue();\n-       }\n-       GTSHelper.setValue(result, GTSHelper.tickAtIndex(gts, i), GTSHelper.locationAtIndex(gts, i), GTSHelper.elevationAtIndex(gts, i), value, false);\n-      }      \n \n+      Number op = op1gts ? (Number) op2 : (Number) op1;\n+\n+      if (op instanceof Double || gts.getType() == TYPE.DOUBLE) {\n+        for (int i = 0; i < n; i++) {\n+          double value;\n+          if (op1gts) {\n+            value = ((Number) GTSHelper.valueAtIndex(gts, i)).doubleValue() / op.doubleValue();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c79ced1a708519f757a0affac24cb1a8f5b95b27"}, "originalPosition": 83}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTE2MTQxNg==", "bodyText": "Ditto.", "url": "https://github.com/senx/warp10-platform/pull/711#discussion_r401161416", "createdAt": "2020-03-31T19:29:23Z", "author": {"login": "ftence"}, "path": "warp10/src/main/java/io/warp10/script/binary/DIV.java", "diffHunk": "@@ -168,19 +161,30 @@ public Object apply(WarpScriptStack stack) throws WarpScriptException {\n       if (!(gts.getType() == TYPE.LONG || gts.getType() == TYPE.DOUBLE)) {\n         throw new WarpScriptException(typeCheckErrorMsg);\n       }\n-      \n-      double op = op1gts ? ((Number) op2).doubleValue() : ((Number) op1).doubleValue();\n-      \n-      for (int i = 0; i < n; i++) {\n-       double value;\n-       if (op1gts) {\n-         value = ((Number) GTSHelper.valueAtIndex(gts, i)).doubleValue() / op;\n-       } else {\n-         value = op / ((Number) GTSHelper.valueAtIndex(gts, i)).doubleValue();\n-       }\n-       GTSHelper.setValue(result, GTSHelper.tickAtIndex(gts, i), GTSHelper.locationAtIndex(gts, i), GTSHelper.elevationAtIndex(gts, i), value, false);\n-      }      \n \n+      Number op = op1gts ? (Number) op2 : (Number) op1;\n+\n+      if (op instanceof Double || gts.getType() == TYPE.DOUBLE) {\n+        for (int i = 0; i < n; i++) {\n+          double value;\n+          if (op1gts) {\n+            value = ((Number) GTSHelper.valueAtIndex(gts, i)).doubleValue() / op.doubleValue();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTA0Nzg1MA=="}, "originalCommit": {"oid": "c79ced1a708519f757a0affac24cb1a8f5b95b27"}, "originalPosition": 83}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTIyMzkwNw==", "bodyText": "get it out of the LOOP!", "url": "https://github.com/senx/warp10-platform/pull/711#discussion_r401223907", "createdAt": "2020-03-31T21:23:43Z", "author": {"login": "hbs"}, "path": "warp10/src/main/java/io/warp10/script/binary/DIV.java", "diffHunk": "@@ -168,19 +161,30 @@ public Object apply(WarpScriptStack stack) throws WarpScriptException {\n       if (!(gts.getType() == TYPE.LONG || gts.getType() == TYPE.DOUBLE)) {\n         throw new WarpScriptException(typeCheckErrorMsg);\n       }\n-      \n-      double op = op1gts ? ((Number) op2).doubleValue() : ((Number) op1).doubleValue();\n-      \n-      for (int i = 0; i < n; i++) {\n-       double value;\n-       if (op1gts) {\n-         value = ((Number) GTSHelper.valueAtIndex(gts, i)).doubleValue() / op;\n-       } else {\n-         value = op / ((Number) GTSHelper.valueAtIndex(gts, i)).doubleValue();\n-       }\n-       GTSHelper.setValue(result, GTSHelper.tickAtIndex(gts, i), GTSHelper.locationAtIndex(gts, i), GTSHelper.elevationAtIndex(gts, i), value, false);\n-      }      \n \n+      Number op = op1gts ? (Number) op2 : (Number) op1;\n+\n+      if (op instanceof Double || gts.getType() == TYPE.DOUBLE) {\n+        for (int i = 0; i < n; i++) {\n+          double value;\n+          if (op1gts) {\n+            value = ((Number) GTSHelper.valueAtIndex(gts, i)).doubleValue() / op.doubleValue();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTA0Nzg1MA=="}, "originalCommit": {"oid": "c79ced1a708519f757a0affac24cb1a8f5b95b27"}, "originalPosition": 83}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ4NzEwMzgzOnYy", "diffSide": "RIGHT", "path": "warp10/src/main/java/io/warp10/script/binary/DIV.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQxNjoyNTozNlrOF-eBgQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQyMToyMzo1MlrOF-oxJA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTA0NzkzNw==", "bodyText": "avoid op.longValue()", "url": "https://github.com/senx/warp10-platform/pull/711#discussion_r401047937", "createdAt": "2020-03-31T16:25:36Z", "author": {"login": "hbs"}, "path": "warp10/src/main/java/io/warp10/script/binary/DIV.java", "diffHunk": "@@ -168,19 +161,30 @@ public Object apply(WarpScriptStack stack) throws WarpScriptException {\n       if (!(gts.getType() == TYPE.LONG || gts.getType() == TYPE.DOUBLE)) {\n         throw new WarpScriptException(typeCheckErrorMsg);\n       }\n-      \n-      double op = op1gts ? ((Number) op2).doubleValue() : ((Number) op1).doubleValue();\n-      \n-      for (int i = 0; i < n; i++) {\n-       double value;\n-       if (op1gts) {\n-         value = ((Number) GTSHelper.valueAtIndex(gts, i)).doubleValue() / op;\n-       } else {\n-         value = op / ((Number) GTSHelper.valueAtIndex(gts, i)).doubleValue();\n-       }\n-       GTSHelper.setValue(result, GTSHelper.tickAtIndex(gts, i), GTSHelper.locationAtIndex(gts, i), GTSHelper.elevationAtIndex(gts, i), value, false);\n-      }      \n \n+      Number op = op1gts ? (Number) op2 : (Number) op1;\n+\n+      if (op instanceof Double || gts.getType() == TYPE.DOUBLE) {\n+        for (int i = 0; i < n; i++) {\n+          double value;\n+          if (op1gts) {\n+            value = ((Number) GTSHelper.valueAtIndex(gts, i)).doubleValue() / op.doubleValue();\n+          } else {\n+            value = op.doubleValue() / ((Number) GTSHelper.valueAtIndex(gts, i)).doubleValue();\n+          }\n+          GTSHelper.setValue(result, GTSHelper.tickAtIndex(gts, i), GTSHelper.locationAtIndex(gts, i), GTSHelper.elevationAtIndex(gts, i), value, false);\n+        }\n+      } else {\n+        for (int i = 0; i < n; i++) {\n+          long value;\n+          if (op1gts) {\n+            value = ((Number) GTSHelper.valueAtIndex(gts, i)).longValue() / op.longValue();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c79ced1a708519f757a0affac24cb1a8f5b95b27"}, "originalPosition": 93}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTE2MTQ0NA==", "bodyText": "Ditto.", "url": "https://github.com/senx/warp10-platform/pull/711#discussion_r401161444", "createdAt": "2020-03-31T19:29:27Z", "author": {"login": "ftence"}, "path": "warp10/src/main/java/io/warp10/script/binary/DIV.java", "diffHunk": "@@ -168,19 +161,30 @@ public Object apply(WarpScriptStack stack) throws WarpScriptException {\n       if (!(gts.getType() == TYPE.LONG || gts.getType() == TYPE.DOUBLE)) {\n         throw new WarpScriptException(typeCheckErrorMsg);\n       }\n-      \n-      double op = op1gts ? ((Number) op2).doubleValue() : ((Number) op1).doubleValue();\n-      \n-      for (int i = 0; i < n; i++) {\n-       double value;\n-       if (op1gts) {\n-         value = ((Number) GTSHelper.valueAtIndex(gts, i)).doubleValue() / op;\n-       } else {\n-         value = op / ((Number) GTSHelper.valueAtIndex(gts, i)).doubleValue();\n-       }\n-       GTSHelper.setValue(result, GTSHelper.tickAtIndex(gts, i), GTSHelper.locationAtIndex(gts, i), GTSHelper.elevationAtIndex(gts, i), value, false);\n-      }      \n \n+      Number op = op1gts ? (Number) op2 : (Number) op1;\n+\n+      if (op instanceof Double || gts.getType() == TYPE.DOUBLE) {\n+        for (int i = 0; i < n; i++) {\n+          double value;\n+          if (op1gts) {\n+            value = ((Number) GTSHelper.valueAtIndex(gts, i)).doubleValue() / op.doubleValue();\n+          } else {\n+            value = op.doubleValue() / ((Number) GTSHelper.valueAtIndex(gts, i)).doubleValue();\n+          }\n+          GTSHelper.setValue(result, GTSHelper.tickAtIndex(gts, i), GTSHelper.locationAtIndex(gts, i), GTSHelper.elevationAtIndex(gts, i), value, false);\n+        }\n+      } else {\n+        for (int i = 0; i < n; i++) {\n+          long value;\n+          if (op1gts) {\n+            value = ((Number) GTSHelper.valueAtIndex(gts, i)).longValue() / op.longValue();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTA0NzkzNw=="}, "originalCommit": {"oid": "c79ced1a708519f757a0affac24cb1a8f5b95b27"}, "originalPosition": 93}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTIyMzk3Mg==", "bodyText": "GET IT OUT OF THE LOOP!", "url": "https://github.com/senx/warp10-platform/pull/711#discussion_r401223972", "createdAt": "2020-03-31T21:23:52Z", "author": {"login": "hbs"}, "path": "warp10/src/main/java/io/warp10/script/binary/DIV.java", "diffHunk": "@@ -168,19 +161,30 @@ public Object apply(WarpScriptStack stack) throws WarpScriptException {\n       if (!(gts.getType() == TYPE.LONG || gts.getType() == TYPE.DOUBLE)) {\n         throw new WarpScriptException(typeCheckErrorMsg);\n       }\n-      \n-      double op = op1gts ? ((Number) op2).doubleValue() : ((Number) op1).doubleValue();\n-      \n-      for (int i = 0; i < n; i++) {\n-       double value;\n-       if (op1gts) {\n-         value = ((Number) GTSHelper.valueAtIndex(gts, i)).doubleValue() / op;\n-       } else {\n-         value = op / ((Number) GTSHelper.valueAtIndex(gts, i)).doubleValue();\n-       }\n-       GTSHelper.setValue(result, GTSHelper.tickAtIndex(gts, i), GTSHelper.locationAtIndex(gts, i), GTSHelper.elevationAtIndex(gts, i), value, false);\n-      }      \n \n+      Number op = op1gts ? (Number) op2 : (Number) op1;\n+\n+      if (op instanceof Double || gts.getType() == TYPE.DOUBLE) {\n+        for (int i = 0; i < n; i++) {\n+          double value;\n+          if (op1gts) {\n+            value = ((Number) GTSHelper.valueAtIndex(gts, i)).doubleValue() / op.doubleValue();\n+          } else {\n+            value = op.doubleValue() / ((Number) GTSHelper.valueAtIndex(gts, i)).doubleValue();\n+          }\n+          GTSHelper.setValue(result, GTSHelper.tickAtIndex(gts, i), GTSHelper.locationAtIndex(gts, i), GTSHelper.elevationAtIndex(gts, i), value, false);\n+        }\n+      } else {\n+        for (int i = 0; i < n; i++) {\n+          long value;\n+          if (op1gts) {\n+            value = ((Number) GTSHelper.valueAtIndex(gts, i)).longValue() / op.longValue();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTA0NzkzNw=="}, "originalCommit": {"oid": "c79ced1a708519f757a0affac24cb1a8f5b95b27"}, "originalPosition": 93}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ4NzEwNDgyOnYy", "diffSide": "RIGHT", "path": "warp10/src/main/java/io/warp10/script/binary/MUL.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQxNjoyNTo1MFrOF-eCJQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQyMToyNDowM1rOF-oxlw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTA0ODEwMQ==", "bodyText": "avoid op.doubleValue()", "url": "https://github.com/senx/warp10-platform/pull/711#discussion_r401048101", "createdAt": "2020-03-31T16:25:50Z", "author": {"login": "hbs"}, "path": "warp10/src/main/java/io/warp10/script/binary/MUL.java", "diffHunk": "@@ -177,13 +170,20 @@ public Object apply(WarpScriptStack stack) throws WarpScriptException {\n       if (!(gts.getType() == TYPE.LONG || gts.getType() == TYPE.DOUBLE)) {\n         throw new WarpScriptException(typeCheckErrorMsg);\n       }\n-      \n-      double op = op1gts ? ((Number) op2).doubleValue() : ((Number) op1).doubleValue();\n-      \n-      for (int i = 0; i < n; i++) {\n-        double value = ((Number) GTSHelper.valueAtIndex(gts, i)).doubleValue() * op;\n-        GTSHelper.setValue(result, GTSHelper.tickAtIndex(gts, i), GTSHelper.locationAtIndex(gts, i), GTSHelper.elevationAtIndex(gts, i), value, false);\n-      }      \n+\n+      Number op = op1gts ? (Number) op2 : (Number) op1;\n+\n+      if (op instanceof Double || gts.getType() == TYPE.DOUBLE) {\n+        for (int i = 0; i < n; i++) {\n+          double value = ((Number) GTSHelper.valueAtIndex(gts, i)).doubleValue() * op.doubleValue();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c79ced1a708519f757a0affac24cb1a8f5b95b27"}, "originalPosition": 76}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTE2MTQ5OQ==", "bodyText": "Ditto.", "url": "https://github.com/senx/warp10-platform/pull/711#discussion_r401161499", "createdAt": "2020-03-31T19:29:32Z", "author": {"login": "ftence"}, "path": "warp10/src/main/java/io/warp10/script/binary/MUL.java", "diffHunk": "@@ -177,13 +170,20 @@ public Object apply(WarpScriptStack stack) throws WarpScriptException {\n       if (!(gts.getType() == TYPE.LONG || gts.getType() == TYPE.DOUBLE)) {\n         throw new WarpScriptException(typeCheckErrorMsg);\n       }\n-      \n-      double op = op1gts ? ((Number) op2).doubleValue() : ((Number) op1).doubleValue();\n-      \n-      for (int i = 0; i < n; i++) {\n-        double value = ((Number) GTSHelper.valueAtIndex(gts, i)).doubleValue() * op;\n-        GTSHelper.setValue(result, GTSHelper.tickAtIndex(gts, i), GTSHelper.locationAtIndex(gts, i), GTSHelper.elevationAtIndex(gts, i), value, false);\n-      }      \n+\n+      Number op = op1gts ? (Number) op2 : (Number) op1;\n+\n+      if (op instanceof Double || gts.getType() == TYPE.DOUBLE) {\n+        for (int i = 0; i < n; i++) {\n+          double value = ((Number) GTSHelper.valueAtIndex(gts, i)).doubleValue() * op.doubleValue();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTA0ODEwMQ=="}, "originalCommit": {"oid": "c79ced1a708519f757a0affac24cb1a8f5b95b27"}, "originalPosition": 76}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTIyNDA4Nw==", "bodyText": "GET IT OUT OF THE LOOP!!!!!", "url": "https://github.com/senx/warp10-platform/pull/711#discussion_r401224087", "createdAt": "2020-03-31T21:24:03Z", "author": {"login": "hbs"}, "path": "warp10/src/main/java/io/warp10/script/binary/MUL.java", "diffHunk": "@@ -177,13 +170,20 @@ public Object apply(WarpScriptStack stack) throws WarpScriptException {\n       if (!(gts.getType() == TYPE.LONG || gts.getType() == TYPE.DOUBLE)) {\n         throw new WarpScriptException(typeCheckErrorMsg);\n       }\n-      \n-      double op = op1gts ? ((Number) op2).doubleValue() : ((Number) op1).doubleValue();\n-      \n-      for (int i = 0; i < n; i++) {\n-        double value = ((Number) GTSHelper.valueAtIndex(gts, i)).doubleValue() * op;\n-        GTSHelper.setValue(result, GTSHelper.tickAtIndex(gts, i), GTSHelper.locationAtIndex(gts, i), GTSHelper.elevationAtIndex(gts, i), value, false);\n-      }      \n+\n+      Number op = op1gts ? (Number) op2 : (Number) op1;\n+\n+      if (op instanceof Double || gts.getType() == TYPE.DOUBLE) {\n+        for (int i = 0; i < n; i++) {\n+          double value = ((Number) GTSHelper.valueAtIndex(gts, i)).doubleValue() * op.doubleValue();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTA0ODEwMQ=="}, "originalCommit": {"oid": "c79ced1a708519f757a0affac24cb1a8f5b95b27"}, "originalPosition": 76}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ4NzEwNTUxOnYy", "diffSide": "RIGHT", "path": "warp10/src/main/java/io/warp10/script/binary/MUL.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQxNjoyNTo1OVrOF-eCjw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQyMToyNDoxOFrOF-oyGg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTA0ODIwNw==", "bodyText": "avoid op.longValue()", "url": "https://github.com/senx/warp10-platform/pull/711#discussion_r401048207", "createdAt": "2020-03-31T16:25:59Z", "author": {"login": "hbs"}, "path": "warp10/src/main/java/io/warp10/script/binary/MUL.java", "diffHunk": "@@ -177,13 +170,20 @@ public Object apply(WarpScriptStack stack) throws WarpScriptException {\n       if (!(gts.getType() == TYPE.LONG || gts.getType() == TYPE.DOUBLE)) {\n         throw new WarpScriptException(typeCheckErrorMsg);\n       }\n-      \n-      double op = op1gts ? ((Number) op2).doubleValue() : ((Number) op1).doubleValue();\n-      \n-      for (int i = 0; i < n; i++) {\n-        double value = ((Number) GTSHelper.valueAtIndex(gts, i)).doubleValue() * op;\n-        GTSHelper.setValue(result, GTSHelper.tickAtIndex(gts, i), GTSHelper.locationAtIndex(gts, i), GTSHelper.elevationAtIndex(gts, i), value, false);\n-      }      \n+\n+      Number op = op1gts ? (Number) op2 : (Number) op1;\n+\n+      if (op instanceof Double || gts.getType() == TYPE.DOUBLE) {\n+        for (int i = 0; i < n; i++) {\n+          double value = ((Number) GTSHelper.valueAtIndex(gts, i)).doubleValue() * op.doubleValue();\n+          GTSHelper.setValue(result, GTSHelper.tickAtIndex(gts, i), GTSHelper.locationAtIndex(gts, i), GTSHelper.elevationAtIndex(gts, i), value, false);\n+        }\n+      } else {\n+        for (int i = 0; i < n; i++) {\n+          long value = ((Number) GTSHelper.valueAtIndex(gts, i)).longValue() * op.longValue();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c79ced1a708519f757a0affac24cb1a8f5b95b27"}, "originalPosition": 81}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTE2MTUzNQ==", "bodyText": "Ditto.", "url": "https://github.com/senx/warp10-platform/pull/711#discussion_r401161535", "createdAt": "2020-03-31T19:29:35Z", "author": {"login": "ftence"}, "path": "warp10/src/main/java/io/warp10/script/binary/MUL.java", "diffHunk": "@@ -177,13 +170,20 @@ public Object apply(WarpScriptStack stack) throws WarpScriptException {\n       if (!(gts.getType() == TYPE.LONG || gts.getType() == TYPE.DOUBLE)) {\n         throw new WarpScriptException(typeCheckErrorMsg);\n       }\n-      \n-      double op = op1gts ? ((Number) op2).doubleValue() : ((Number) op1).doubleValue();\n-      \n-      for (int i = 0; i < n; i++) {\n-        double value = ((Number) GTSHelper.valueAtIndex(gts, i)).doubleValue() * op;\n-        GTSHelper.setValue(result, GTSHelper.tickAtIndex(gts, i), GTSHelper.locationAtIndex(gts, i), GTSHelper.elevationAtIndex(gts, i), value, false);\n-      }      \n+\n+      Number op = op1gts ? (Number) op2 : (Number) op1;\n+\n+      if (op instanceof Double || gts.getType() == TYPE.DOUBLE) {\n+        for (int i = 0; i < n; i++) {\n+          double value = ((Number) GTSHelper.valueAtIndex(gts, i)).doubleValue() * op.doubleValue();\n+          GTSHelper.setValue(result, GTSHelper.tickAtIndex(gts, i), GTSHelper.locationAtIndex(gts, i), GTSHelper.elevationAtIndex(gts, i), value, false);\n+        }\n+      } else {\n+        for (int i = 0; i < n; i++) {\n+          long value = ((Number) GTSHelper.valueAtIndex(gts, i)).longValue() * op.longValue();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTA0ODIwNw=="}, "originalCommit": {"oid": "c79ced1a708519f757a0affac24cb1a8f5b95b27"}, "originalPosition": 81}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTIyNDIxOA==", "bodyText": "GET THIS FREAKING STATEMENT OUT OF THE LOOP!!!! ;-)", "url": "https://github.com/senx/warp10-platform/pull/711#discussion_r401224218", "createdAt": "2020-03-31T21:24:18Z", "author": {"login": "hbs"}, "path": "warp10/src/main/java/io/warp10/script/binary/MUL.java", "diffHunk": "@@ -177,13 +170,20 @@ public Object apply(WarpScriptStack stack) throws WarpScriptException {\n       if (!(gts.getType() == TYPE.LONG || gts.getType() == TYPE.DOUBLE)) {\n         throw new WarpScriptException(typeCheckErrorMsg);\n       }\n-      \n-      double op = op1gts ? ((Number) op2).doubleValue() : ((Number) op1).doubleValue();\n-      \n-      for (int i = 0; i < n; i++) {\n-        double value = ((Number) GTSHelper.valueAtIndex(gts, i)).doubleValue() * op;\n-        GTSHelper.setValue(result, GTSHelper.tickAtIndex(gts, i), GTSHelper.locationAtIndex(gts, i), GTSHelper.elevationAtIndex(gts, i), value, false);\n-      }      \n+\n+      Number op = op1gts ? (Number) op2 : (Number) op1;\n+\n+      if (op instanceof Double || gts.getType() == TYPE.DOUBLE) {\n+        for (int i = 0; i < n; i++) {\n+          double value = ((Number) GTSHelper.valueAtIndex(gts, i)).doubleValue() * op.doubleValue();\n+          GTSHelper.setValue(result, GTSHelper.tickAtIndex(gts, i), GTSHelper.locationAtIndex(gts, i), GTSHelper.elevationAtIndex(gts, i), value, false);\n+        }\n+      } else {\n+        for (int i = 0; i < n; i++) {\n+          long value = ((Number) GTSHelper.valueAtIndex(gts, i)).longValue() * op.longValue();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTA0ODIwNw=="}, "originalCommit": {"oid": "c79ced1a708519f757a0affac24cb1a8f5b95b27"}, "originalPosition": 81}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1214, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}