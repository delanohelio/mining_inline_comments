{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEyMTM0MjAw", "number": 751, "title": "Added support for configuring default accelerator strategies", "bodyText": "", "createdAt": "2020-05-01T13:38:04Z", "url": "https://github.com/senx/warp10-platform/pull/751", "merged": true, "mergeCommit": {"oid": "72096842f568b1d3aecfeb24a5f4ce4952aea4b6"}, "closed": true, "closedAt": "2020-05-06T15:19:16Z", "author": {"login": "hbs"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcdB06RgH2gAyNDEyMTM0MjAwOjgzMDIwMTM5ZDA0YzE5YWIwMjkxZmI4N2QyZDUyMGMzNDE0MjZhMmI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABceqEZ3AFqTQwNjcwNjM0Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "83020139d04c19ab0291fb87d2d520c341426a2b", "author": {"user": {"login": "hbs", "name": "Mathias Herberts"}}, "url": "https://github.com/senx/warp10-platform/commit/83020139d04c19ab0291fb87d2d520c341426a2b", "committedDate": "2020-05-01T13:37:35Z", "message": "Added support for configuring default accelerator strategies"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1NTg4OTUz", "url": "https://github.com/senx/warp10-platform/pull/751#pullrequestreview-405588953", "createdAt": "2020-05-05T08:32:56Z", "commit": {"oid": "83020139d04c19ab0291fb87d2d520c341426a2b"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQwODozMjo1NlrOGQffdg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQwOToxNjo1NVrOGQg_8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTk0NjM1OA==", "bodyText": "This is not consistent with the other assignments where the value of the parameter is not checked.\nEither check the value everywhere or do not check here.", "url": "https://github.com/senx/warp10-platform/pull/751#discussion_r419946358", "createdAt": "2020-05-05T08:32:56Z", "author": {"login": "ftence"}, "path": "warp10/src/main/java/io/warp10/continuum/egress/EgressFetchHandler.java", "diffHunk": "@@ -215,8 +215,35 @@ public void handle(String target, Request baseRequest, HttpServletRequest req, H\n         postBoundaryParam = req.getParameter(Constants.HTTP_PARAM_POSTBOUNDARY);\n       }\n           \n-      boolean nocache = null != req.getParameter(StandaloneAcceleratedStoreClient.NOCACHE);\n-      boolean nopersist = null != req.getParameter(StandaloneAcceleratedStoreClient.NOPERSIST);\n+      boolean nocache = StandaloneAcceleratedStoreClient.getDefaultReadNocache();\n+      boolean forcedNocache = false;\n+      boolean nopersist = StandaloneAcceleratedStoreClient.getDefaultReadNopersist();\n+      boolean forcedNopersist = false;\n+      \n+      if (null != req.getParameter(StandaloneAcceleratedStoreClient.NOCACHE)) {\n+        forcedNocache = true;\n+        nocache = true;\n+      }\n+      if (null != req.getParameter(StandaloneAcceleratedStoreClient.CACHE)) {\n+        if (forcedNocache) {\n+          resp.sendError(HttpServletResponse.SC_INTERNAL_SERVER_ERROR, \"Cannot specify both '\" + StandaloneAcceleratedStoreClient.NOCACHE + \"' and '\" + StandaloneAcceleratedStoreClient.CACHE + \"'.\");;\n+          return;\n+        }\n+        forcedNocache = true;\n+        nocache = false;\n+      }\n+      if (null != req.getParameter(StandaloneAcceleratedStoreClient.NOPERSIST)) {\n+        forcedNopersist = true;\n+        nopersist = !\"false\".equals(req.getParameter(StandaloneAcceleratedStoreClient.NOPERSIST));      ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "83020139d04c19ab0291fb87d2d520c341426a2b"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTk2MTM0OA==", "bodyText": "You should merge the 4 ifs to only have 2 ifs, removing in the process the forced* variables.\nAlso getting the default values is unnecessary.", "url": "https://github.com/senx/warp10-platform/pull/751#discussion_r419961348", "createdAt": "2020-05-05T08:59:19Z", "author": {"login": "ftence"}, "path": "warp10/src/main/java/io/warp10/script/functions/DELETE.java", "diffHunk": "@@ -160,17 +160,35 @@ public Object apply(WarpScriptStack stack) throws WarpScriptException {\n       qsurl.append(\"=\");\n       qsurl.append(WarpURLEncoder.encode(selector, StandardCharsets.UTF_8));\n \n-      boolean nocache = Boolean.TRUE.equals(stack.getAttribute(StandaloneAcceleratedStoreClient.ATTR_NOCACHE));\n-      boolean nopersist = Boolean.TRUE.equals(stack.getAttribute(StandaloneAcceleratedStoreClient.ATTR_NOPERSIST));\n+      boolean forcedNocache = false;\n+      boolean forcedNopersist = false;\n+      boolean nocache = StandaloneAcceleratedStoreClient.getDefaultDeleteNocache();\n+      if (null != stack.getAttribute(StandaloneAcceleratedStoreClient.ATTR_NOCACHE)) {\n+        forcedNocache = true;\n+        nocache = Boolean.TRUE.equals(stack.getAttribute(StandaloneAcceleratedStoreClient.ATTR_NOCACHE));\n+      }\n+      boolean nopersist = StandaloneAcceleratedStoreClient.getDefaultDeleteNopersist();\n+      if (null != stack.getAttribute(StandaloneAcceleratedStoreClient.ATTR_NOPERSIST)) {\n+        forcedNopersist = true;\n+        nopersist = Boolean.TRUE.equals(stack.getAttribute(StandaloneAcceleratedStoreClient.ATTR_NOPERSIST));\n+      }\n \n-      if (nocache) {\n+      if (forcedNocache) {\n         qsurl.append(\"&\");\n-        qsurl.append(StandaloneAcceleratedStoreClient.NOCACHE);\n+        if (nocache) {\n+          qsurl.append(StandaloneAcceleratedStoreClient.NOCACHE);\n+        } else {\n+          qsurl.append(StandaloneAcceleratedStoreClient.CACHE);\n+        }\n       }\n       \n-      if (nopersist) {\n+      if (forcedNopersist) {\n         qsurl.append(\"&\");\n-        qsurl.append(StandaloneAcceleratedStoreClient.NOPERSIST);\n+        if (nopersist) {\n+          qsurl.append(StandaloneAcceleratedStoreClient.NOPERSIST);\n+        } else {\n+          qsurl.append(StandaloneAcceleratedStoreClient.PERSIST);\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "83020139d04c19ab0291fb87d2d520c341426a2b"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTk2NDU1Mg==", "bodyText": "Merge ifs, see comment for DELETE.", "url": "https://github.com/senx/warp10-platform/pull/751#discussion_r419964552", "createdAt": "2020-05-05T09:05:05Z", "author": {"login": "ftence"}, "path": "warp10/src/main/java/io/warp10/script/functions/UPDATE.java", "diffHunk": "@@ -183,15 +183,33 @@ public Object apply(WarpScriptStack stack) throws WarpScriptException {\n       conn.setRequestProperty(Constants.getHeader(Configuration.HTTP_HEADER_UPDATE_TOKENX), token);\n       conn.setRequestProperty(\"Content-Type\", \"application/gzip\");\n       \n-      boolean nocache = Boolean.TRUE.equals(stack.getAttribute(StandaloneAcceleratedStoreClient.ATTR_NOCACHE));\n-      boolean nopersist = Boolean.TRUE.equals(stack.getAttribute(StandaloneAcceleratedStoreClient.ATTR_NOPERSIST));\n+      boolean nocache = StandaloneAcceleratedStoreClient.getDefaultWriteNocache();\n+      boolean forcedNocache = false;\n+      if (null != stack.getAttribute(StandaloneAcceleratedStoreClient.ATTR_NOCACHE)) {\n+        forcedNocache = true;\n+        nocache = Boolean.TRUE.equals(stack.getAttribute(StandaloneAcceleratedStoreClient.ATTR_NOCACHE));\n+      }\n+      boolean nopersist = StandaloneAcceleratedStoreClient.getDefaultWriteNopersist();\n+      boolean forcedNopersist = false;\n+      if (null != stack.getAttribute(StandaloneAcceleratedStoreClient.ATTR_NOPERSIST)) {\n+        forcedNopersist = true;\n+        nopersist = Boolean.TRUE.equals(stack.getAttribute(StandaloneAcceleratedStoreClient.ATTR_NOPERSIST));        \n+      }\n       \n       String accel = \"\";\n-      if (nocache) {\n-        accel = accel + StandaloneAcceleratedStoreClient.NOCACHE + \" \";\n+      if (forcedNocache) {\n+        if (nocache) {\n+          accel = accel + StandaloneAcceleratedStoreClient.NOCACHE + \" \";\n+        } else {\n+          accel = accel + StandaloneAcceleratedStoreClient.CACHE + \" \";          \n+        }\n       }\n-      if (nopersist) {\n-        accel = accel + StandaloneAcceleratedStoreClient.NOPERSIST;\n+      if (forcedNopersist) {\n+        if (nopersist) {\n+          accel = accel + StandaloneAcceleratedStoreClient.NOPERSIST;\n+        } else {\n+          accel = accel + StandaloneAcceleratedStoreClient.PERSIST;          \n+        }        ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "83020139d04c19ab0291fb87d2d520c341426a2b"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTk2ODEyNw==", "bodyText": "Can thrown NPE if the configuration is not set and expecting default.", "url": "https://github.com/senx/warp10-platform/pull/751#discussion_r419968127", "createdAt": "2020-05-05T09:11:32Z", "author": {"login": "ftence"}, "path": "warp10/src/main/java/io/warp10/standalone/StandaloneAcceleratedStoreClient.java", "diffHunk": "@@ -95,6 +104,44 @@ public StandaloneAcceleratedStoreClient(DirectoryClient dir, StoreClient persist\n       throw new RuntimeException(StandaloneAcceleratedStoreClient.class.getName() + \" can only be instantiated once.\");\n     }\n             \n+    //\n+    // Extract strategies from configuration\n+    //\n+    \n+    String defaultStrategy = WarpConfig.getProperty(Configuration.ACCELERATOR_DEFAULT_WRITE);\n+    if (defaultStrategy.contains(NOCACHE)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "83020139d04c19ab0291fb87d2d520c341426a2b"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTk2ODIxNw==", "bodyText": "Ditto.", "url": "https://github.com/senx/warp10-platform/pull/751#discussion_r419968217", "createdAt": "2020-05-05T09:11:42Z", "author": {"login": "ftence"}, "path": "warp10/src/main/java/io/warp10/standalone/StandaloneAcceleratedStoreClient.java", "diffHunk": "@@ -95,6 +104,44 @@ public StandaloneAcceleratedStoreClient(DirectoryClient dir, StoreClient persist\n       throw new RuntimeException(StandaloneAcceleratedStoreClient.class.getName() + \" can only be instantiated once.\");\n     }\n             \n+    //\n+    // Extract strategies from configuration\n+    //\n+    \n+    String defaultStrategy = WarpConfig.getProperty(Configuration.ACCELERATOR_DEFAULT_WRITE);\n+    if (defaultStrategy.contains(NOCACHE)) {\n+      defaultWriteNocache = true;\n+    } else if (defaultStrategy.contains(CACHE)) {\n+      defaultWriteNocache = false;\n+    }\n+    if (defaultStrategy.contains(NOPERSIST)) {\n+      defaultWriteNopersist = true;\n+    } else if (defaultStrategy.contains(PERSIST)) {\n+      defaultWriteNopersist = false;\n+    }\n+    defaultStrategy = WarpConfig.getProperty(Configuration.ACCELERATOR_DEFAULT_DELETE);\n+    if (defaultStrategy.contains(NOCACHE)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "83020139d04c19ab0291fb87d2d520c341426a2b"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTk2ODI4Ng==", "bodyText": "Ditto.", "url": "https://github.com/senx/warp10-platform/pull/751#discussion_r419968286", "createdAt": "2020-05-05T09:11:49Z", "author": {"login": "ftence"}, "path": "warp10/src/main/java/io/warp10/standalone/StandaloneAcceleratedStoreClient.java", "diffHunk": "@@ -95,6 +104,44 @@ public StandaloneAcceleratedStoreClient(DirectoryClient dir, StoreClient persist\n       throw new RuntimeException(StandaloneAcceleratedStoreClient.class.getName() + \" can only be instantiated once.\");\n     }\n             \n+    //\n+    // Extract strategies from configuration\n+    //\n+    \n+    String defaultStrategy = WarpConfig.getProperty(Configuration.ACCELERATOR_DEFAULT_WRITE);\n+    if (defaultStrategy.contains(NOCACHE)) {\n+      defaultWriteNocache = true;\n+    } else if (defaultStrategy.contains(CACHE)) {\n+      defaultWriteNocache = false;\n+    }\n+    if (defaultStrategy.contains(NOPERSIST)) {\n+      defaultWriteNopersist = true;\n+    } else if (defaultStrategy.contains(PERSIST)) {\n+      defaultWriteNopersist = false;\n+    }\n+    defaultStrategy = WarpConfig.getProperty(Configuration.ACCELERATOR_DEFAULT_DELETE);\n+    if (defaultStrategy.contains(NOCACHE)) {\n+      defaultDeleteNocache = true;\n+    } else if (defaultStrategy.contains(CACHE)) {\n+      defaultDeleteNocache = false;\n+    }\n+    if (defaultStrategy.contains(NOPERSIST)) {\n+      defaultDeleteNopersist = true;\n+    } else if (defaultStrategy.contains(PERSIST)) {\n+      defaultDeleteNopersist = false;\n+    }\n+    defaultStrategy = WarpConfig.getProperty(Configuration.ACCELERATOR_DEFAULT_READ);\n+    if (defaultStrategy.contains(NOCACHE)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "83020139d04c19ab0291fb87d2d520c341426a2b"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTk3MTA1Nw==", "bodyText": "Same remark as for EgressFetchHandler, either check for value of not.", "url": "https://github.com/senx/warp10-platform/pull/751#discussion_r419971057", "createdAt": "2020-05-05T09:16:55Z", "author": {"login": "ftence"}, "path": "warp10/src/main/java/io/warp10/standalone/StandaloneDeleteHandler.java", "diffHunk": "@@ -296,8 +296,35 @@ public void handle(String target, Request baseRequest, HttpServletRequest reques\n     // Extract nocache/nopersist\n     //\n     \n-    boolean nocache = null != request.getParameter(StandaloneAcceleratedStoreClient.NOCACHE);\n-    boolean nopersist = null != request.getParameter(StandaloneAcceleratedStoreClient.NOPERSIST);\n+    boolean nocache = StandaloneAcceleratedStoreClient.getDefaultDeleteNocache();\n+    boolean forcedNocache = false;\n+    boolean nopersist = StandaloneAcceleratedStoreClient.getDefaultDeleteNopersist();\n+    boolean forcedNopersist = false;\n+    \n+    if (null != request.getParameter(StandaloneAcceleratedStoreClient.NOCACHE)) {\n+      forcedNocache = true;\n+      nocache = true;\n+    }\n+    if (null != request.getParameter(StandaloneAcceleratedStoreClient.CACHE)) {\n+      if (forcedNocache) {\n+        response.sendError(HttpServletResponse.SC_INTERNAL_SERVER_ERROR, \"Cannot specify both '\" + StandaloneAcceleratedStoreClient.NOCACHE + \"' and '\" + StandaloneAcceleratedStoreClient.CACHE + \"'.\");;\n+        return;\n+      }\n+      forcedNocache = true;\n+      nocache = false;\n+    }\n+    if (null != request.getParameter(StandaloneAcceleratedStoreClient.NOPERSIST)) {\n+      forcedNopersist = true;\n+      nopersist = !\"false\".equals(request.getParameter(StandaloneAcceleratedStoreClient.NOPERSIST));      ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "83020139d04c19ab0291fb87d2d520c341426a2b"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4dac47241a0bdb230d8bd58bf7b17bfe571308b5", "author": {"user": {"login": "hbs", "name": "Mathias Herberts"}}, "url": "https://github.com/senx/warp10-platform/commit/4dac47241a0bdb230d8bd58bf7b17bfe571308b5", "committedDate": "2020-05-05T11:11:23Z", "message": "Merge branch 'master' into accelerator.default"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "679a16a39c683e77dde83246cad5aeb0a0ae46a2", "author": {"user": {"login": "hbs", "name": "Mathias Herberts"}}, "url": "https://github.com/senx/warp10-platform/commit/679a16a39c683e77dde83246cad5aeb0a0ae46a2", "committedDate": "2020-05-05T11:21:42Z", "message": "Addressed PR comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1NzczMDk5", "url": "https://github.com/senx/warp10-platform/pull/751#pullrequestreview-405773099", "createdAt": "2020-05-05T13:13:08Z", "commit": {"oid": "679a16a39c683e77dde83246cad5aeb0a0ae46a2"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxMzoxMzowOFrOGQot3w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxMzoxNjozN1rOGQo3QA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDA5NzUwMw==", "bodyText": "forcedNopersist = true;", "url": "https://github.com/senx/warp10-platform/pull/751#discussion_r420097503", "createdAt": "2020-05-05T13:13:08Z", "author": {"login": "ftence"}, "path": "warp10/src/main/java/io/warp10/standalone/StandaloneIngressHandler.java", "diffHunk": "@@ -357,20 +361,30 @@ public void handle(String target, Request baseRequest, HttpServletRequest reques\n         \n         if (dr.getAttributesSize() > 0) {\n           if (null != dr.getAttributes().get(StandaloneAcceleratedStoreClient.ATTR_NOCACHE)) {\n-            nocache = true;\n-          } else {\n-            nocache = false;\n+            forcedNocache = true;\n+            nocache = !\"false\".equals(dr.getAttributes().get(StandaloneAcceleratedStoreClient.ATTR_NOCACHE));\n           }\n           if (null != dr.getAttributes().get(StandaloneAcceleratedStoreClient.ATTR_NOPERSIST)) {\n-            nopersist = true;\n-          } else {\n-            nopersist = false;\n+            forcedNopersist = true;\n+            nopersist = !\"false\".equals(dr.getAttributes().get(StandaloneAcceleratedStoreClient.ATTR_NOPERSIST));\n           }\n         }\n       } else {        \n         if (null != request.getHeader(StandaloneAcceleratedStoreClient.ACCELERATOR_HEADER)) {\n-          nocache = request.getHeader(StandaloneAcceleratedStoreClient.ACCELERATOR_HEADER).contains(StandaloneAcceleratedStoreClient.NOCACHE);\n-          nopersist = request.getHeader(StandaloneAcceleratedStoreClient.ACCELERATOR_HEADER).contains(StandaloneAcceleratedStoreClient.NOPERSIST);                \n+          if (request.getHeader(StandaloneAcceleratedStoreClient.ACCELERATOR_HEADER).contains(StandaloneAcceleratedStoreClient.NOCACHE)) {\n+            nocache = true;\n+            forcedNocache = true;\n+          } else if (request.getHeader(StandaloneAcceleratedStoreClient.ACCELERATOR_HEADER).contains(StandaloneAcceleratedStoreClient.CACHE)) {\n+            nocache = false;\n+            forcedNocache = true;\n+          }\n+          if (request.getHeader(StandaloneAcceleratedStoreClient.ACCELERATOR_HEADER).contains(StandaloneAcceleratedStoreClient.NOPERSIST)) {\n+            nopersist = true;\n+            forcedNopersist = true;\n+          } else if (request.getHeader(StandaloneAcceleratedStoreClient.ACCELERATOR_HEADER).contains(StandaloneAcceleratedStoreClient.PERSIST)) {\n+            nopersist = false;\n+            forcedNopersist = false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "679a16a39c683e77dde83246cad5aeb0a0ae46a2"}, "originalPosition": 49}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDA5OTU2OA==", "bodyText": "Default not used, can be initialized to false.", "url": "https://github.com/senx/warp10-platform/pull/751#discussion_r420099568", "createdAt": "2020-05-05T13:16:06Z", "author": {"login": "ftence"}, "path": "warp10/src/main/java/io/warp10/script/functions/UPDATE.java", "diffHunk": "@@ -183,19 +183,32 @@ public Object apply(WarpScriptStack stack) throws WarpScriptException {\n       conn.setRequestProperty(Constants.getHeader(Configuration.HTTP_HEADER_UPDATE_TOKENX), token);\n       conn.setRequestProperty(\"Content-Type\", \"application/gzip\");\n       \n-      boolean nocache = Boolean.TRUE.equals(stack.getAttribute(StandaloneAcceleratedStoreClient.ATTR_NOCACHE));\n-      boolean nopersist = Boolean.TRUE.equals(stack.getAttribute(StandaloneAcceleratedStoreClient.ATTR_NOPERSIST));\n-      \n       String accel = \"\";\n-      if (nocache) {\n-        accel = accel + StandaloneAcceleratedStoreClient.NOCACHE + \" \";\n+\n+      boolean nocache = StandaloneAcceleratedStoreClient.getDefaultWriteNocache();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "679a16a39c683e77dde83246cad5aeb0a0ae46a2"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDA5OTYxNQ==", "bodyText": "Default not used, can be initialized to false.", "url": "https://github.com/senx/warp10-platform/pull/751#discussion_r420099615", "createdAt": "2020-05-05T13:16:10Z", "author": {"login": "ftence"}, "path": "warp10/src/main/java/io/warp10/script/functions/UPDATE.java", "diffHunk": "@@ -183,19 +183,32 @@ public Object apply(WarpScriptStack stack) throws WarpScriptException {\n       conn.setRequestProperty(Constants.getHeader(Configuration.HTTP_HEADER_UPDATE_TOKENX), token);\n       conn.setRequestProperty(\"Content-Type\", \"application/gzip\");\n       \n-      boolean nocache = Boolean.TRUE.equals(stack.getAttribute(StandaloneAcceleratedStoreClient.ATTR_NOCACHE));\n-      boolean nopersist = Boolean.TRUE.equals(stack.getAttribute(StandaloneAcceleratedStoreClient.ATTR_NOPERSIST));\n-      \n       String accel = \"\";\n-      if (nocache) {\n-        accel = accel + StandaloneAcceleratedStoreClient.NOCACHE + \" \";\n+\n+      boolean nocache = StandaloneAcceleratedStoreClient.getDefaultWriteNocache();\n+      if (null != stack.getAttribute(StandaloneAcceleratedStoreClient.ATTR_NOCACHE)) {\n+        nocache = Boolean.TRUE.equals(stack.getAttribute(StandaloneAcceleratedStoreClient.ATTR_NOCACHE));\n+        if (nocache) {\n+          accel = accel + StandaloneAcceleratedStoreClient.NOCACHE + \" \";\n+        } else {\n+          accel = accel + StandaloneAcceleratedStoreClient.CACHE + \" \";          \n+        }\n       }\n-      if (nopersist) {\n-        accel = accel + StandaloneAcceleratedStoreClient.NOPERSIST;\n+\n+      boolean nopersist = StandaloneAcceleratedStoreClient.getDefaultWriteNopersist();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "679a16a39c683e77dde83246cad5aeb0a0ae46a2"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDA5OTg3MA==", "bodyText": "Default not used, can be initialized to false.", "url": "https://github.com/senx/warp10-platform/pull/751#discussion_r420099870", "createdAt": "2020-05-05T13:16:33Z", "author": {"login": "ftence"}, "path": "warp10/src/main/java/io/warp10/script/functions/DELETE.java", "diffHunk": "@@ -160,17 +160,26 @@ public Object apply(WarpScriptStack stack) throws WarpScriptException {\n       qsurl.append(\"=\");\n       qsurl.append(WarpURLEncoder.encode(selector, StandardCharsets.UTF_8));\n \n-      boolean nocache = Boolean.TRUE.equals(stack.getAttribute(StandaloneAcceleratedStoreClient.ATTR_NOCACHE));\n-      boolean nopersist = Boolean.TRUE.equals(stack.getAttribute(StandaloneAcceleratedStoreClient.ATTR_NOPERSIST));\n-\n-      if (nocache) {\n+      boolean nocache = StandaloneAcceleratedStoreClient.getDefaultDeleteNocache();\n+      if (null != stack.getAttribute(StandaloneAcceleratedStoreClient.ATTR_NOCACHE)) {\n+        nocache = Boolean.TRUE.equals(stack.getAttribute(StandaloneAcceleratedStoreClient.ATTR_NOCACHE));\n         qsurl.append(\"&\");\n-        qsurl.append(StandaloneAcceleratedStoreClient.NOCACHE);\n+        if (nocache) {\n+          qsurl.append(StandaloneAcceleratedStoreClient.NOCACHE);\n+        } else {\n+          qsurl.append(StandaloneAcceleratedStoreClient.CACHE);\n+        }\n       }\n-      \n-      if (nopersist) {\n+\n+      boolean nopersist = StandaloneAcceleratedStoreClient.getDefaultDeleteNopersist();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "679a16a39c683e77dde83246cad5aeb0a0ae46a2"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDA5OTkwNA==", "bodyText": "Default not used, can be initialized to false.", "url": "https://github.com/senx/warp10-platform/pull/751#discussion_r420099904", "createdAt": "2020-05-05T13:16:37Z", "author": {"login": "ftence"}, "path": "warp10/src/main/java/io/warp10/script/functions/DELETE.java", "diffHunk": "@@ -160,17 +160,26 @@ public Object apply(WarpScriptStack stack) throws WarpScriptException {\n       qsurl.append(\"=\");\n       qsurl.append(WarpURLEncoder.encode(selector, StandardCharsets.UTF_8));\n \n-      boolean nocache = Boolean.TRUE.equals(stack.getAttribute(StandaloneAcceleratedStoreClient.ATTR_NOCACHE));\n-      boolean nopersist = Boolean.TRUE.equals(stack.getAttribute(StandaloneAcceleratedStoreClient.ATTR_NOPERSIST));\n-\n-      if (nocache) {\n+      boolean nocache = StandaloneAcceleratedStoreClient.getDefaultDeleteNocache();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "679a16a39c683e77dde83246cad5aeb0a0ae46a2"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1NzkwMTQ0", "url": "https://github.com/senx/warp10-platform/pull/751#pullrequestreview-405790144", "createdAt": "2020-05-05T13:31:56Z", "commit": {"oid": "679a16a39c683e77dde83246cad5aeb0a0ae46a2"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxMzozMTo1NlrOGQph9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNVQxMzozMzowM1rOGQplAA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDExMDgzNw==", "bodyText": "In DELETE, FETCH and UPDATE, the test is Boolean.TRUE.equals so for coherency it should be \"true\".equals and switch if/else.", "url": "https://github.com/senx/warp10-platform/pull/751#discussion_r420110837", "createdAt": "2020-05-05T13:31:56Z", "author": {"login": "ftence"}, "path": "warp10/src/main/java/io/warp10/continuum/ingress/DatalogForwarder.java", "diffHunk": "@@ -267,10 +267,18 @@ private boolean doUpdate(DatalogAction action) {\n           if (action.request.getAttributesSize() > 0) {\n             String accel = \"\";\n             if (null != action.request.getAttributes().get(StandaloneAcceleratedStoreClient.ATTR_NOCACHE)) {\n-              accel += StandaloneAcceleratedStoreClient.NOCACHE + \" \";\n+              if (\"false\".equals(action.request.getAttributes().get(StandaloneAcceleratedStoreClient.ATTR_NOCACHE))) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "679a16a39c683e77dde83246cad5aeb0a0ae46a2"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDExMDkxMQ==", "bodyText": "In DELETE, FETCH and UPDATE, the test is Boolean.TRUE.equals so for coherency it should be \"true\".equals and switch if/else.", "url": "https://github.com/senx/warp10-platform/pull/751#discussion_r420110911", "createdAt": "2020-05-05T13:32:02Z", "author": {"login": "ftence"}, "path": "warp10/src/main/java/io/warp10/continuum/ingress/DatalogForwarder.java", "diffHunk": "@@ -267,10 +267,18 @@ private boolean doUpdate(DatalogAction action) {\n           if (action.request.getAttributesSize() > 0) {\n             String accel = \"\";\n             if (null != action.request.getAttributes().get(StandaloneAcceleratedStoreClient.ATTR_NOCACHE)) {\n-              accel += StandaloneAcceleratedStoreClient.NOCACHE + \" \";\n+              if (\"false\".equals(action.request.getAttributes().get(StandaloneAcceleratedStoreClient.ATTR_NOCACHE))) {\n+                accel += StandaloneAcceleratedStoreClient.CACHE + \" \";                \n+              } else {\n+                accel += StandaloneAcceleratedStoreClient.NOCACHE + \" \";\n+              }\n             }\n             if (null != action.request.getAttributes().get(StandaloneAcceleratedStoreClient.ATTR_NOPERSIST)) {\n-              accel += StandaloneAcceleratedStoreClient.NOPERSIST;              \n+              if (\"false\".equals(action.request.getAttributes().get(StandaloneAcceleratedStoreClient.ATTR_NOPERSIST))) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "679a16a39c683e77dde83246cad5aeb0a0ae46a2"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDExMTUwNg==", "bodyText": "In DELETE, FETCH and UPDATE, the test is Boolean.TRUE.equals so for coherency it should be \"true\".equals.", "url": "https://github.com/senx/warp10-platform/pull/751#discussion_r420111506", "createdAt": "2020-05-05T13:32:54Z", "author": {"login": "ftence"}, "path": "warp10/src/main/java/io/warp10/standalone/StandaloneIngressHandler.java", "diffHunk": "@@ -357,20 +361,30 @@ public void handle(String target, Request baseRequest, HttpServletRequest reques\n         \n         if (dr.getAttributesSize() > 0) {\n           if (null != dr.getAttributes().get(StandaloneAcceleratedStoreClient.ATTR_NOCACHE)) {\n-            nocache = true;\n-          } else {\n-            nocache = false;\n+            forcedNocache = true;\n+            nocache = !\"false\".equals(dr.getAttributes().get(StandaloneAcceleratedStoreClient.ATTR_NOCACHE));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "679a16a39c683e77dde83246cad5aeb0a0ae46a2"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDExMTYxNg==", "bodyText": "In DELETE, FETCH and UPDATE, the test is Boolean.TRUE.equals so for coherency it should be \"true\".equals.", "url": "https://github.com/senx/warp10-platform/pull/751#discussion_r420111616", "createdAt": "2020-05-05T13:33:03Z", "author": {"login": "ftence"}, "path": "warp10/src/main/java/io/warp10/standalone/StandaloneIngressHandler.java", "diffHunk": "@@ -357,20 +361,30 @@ public void handle(String target, Request baseRequest, HttpServletRequest reques\n         \n         if (dr.getAttributesSize() > 0) {\n           if (null != dr.getAttributes().get(StandaloneAcceleratedStoreClient.ATTR_NOCACHE)) {\n-            nocache = true;\n-          } else {\n-            nocache = false;\n+            forcedNocache = true;\n+            nocache = !\"false\".equals(dr.getAttributes().get(StandaloneAcceleratedStoreClient.ATTR_NOCACHE));\n           }\n           if (null != dr.getAttributes().get(StandaloneAcceleratedStoreClient.ATTR_NOPERSIST)) {\n-            nopersist = true;\n-          } else {\n-            nopersist = false;\n+            forcedNopersist = true;\n+            nopersist = !\"false\".equals(dr.getAttributes().get(StandaloneAcceleratedStoreClient.ATTR_NOPERSIST));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "679a16a39c683e77dde83246cad5aeb0a0ae46a2"}, "originalPosition": 30}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "680225833d77c7bf0dd9b3342f7a2f118dcacc5a", "author": {"user": {"login": "hbs", "name": "Mathias Herberts"}}, "url": "https://github.com/senx/warp10-platform/commit/680225833d77c7bf0dd9b3342f7a2f118dcacc5a", "committedDate": "2020-05-05T16:37:24Z", "message": "Merge branch 'master' of github.com:senx/warp10-platform into accelerator.default"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c6ccea062bab645bc0ebcf5b5bebd97f2ee51d69", "author": {"user": {"login": "hbs", "name": "Mathias Herberts"}}, "url": "https://github.com/senx/warp10-platform/commit/c6ccea062bab645bc0ebcf5b5bebd97f2ee51d69", "committedDate": "2020-05-05T19:18:04Z", "message": "Addressed PR comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a63906cc69c9547fe3319929c24e7a80fd540566", "author": {"user": {"login": "hbs", "name": "Mathias Herberts"}}, "url": "https://github.com/senx/warp10-platform/commit/a63906cc69c9547fe3319929c24e7a80fd540566", "committedDate": "2020-05-06T06:35:27Z", "message": "Added explanatory comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "237915d8e5b46852e08baf3cad4871817ba62f2f", "author": {"user": {"login": "hbs", "name": "Mathias Herberts"}}, "url": "https://github.com/senx/warp10-platform/commit/237915d8e5b46852e08baf3cad4871817ba62f2f", "committedDate": "2020-05-06T08:34:16Z", "message": "Added defaults reporting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3b0ca0130a66791241045fe9233b1b6fa0775012", "author": {"user": {"login": "hbs", "name": "Mathias Herberts"}}, "url": "https://github.com/senx/warp10-platform/commit/3b0ca0130a66791241045fe9233b1b6fa0775012", "committedDate": "2020-05-06T15:03:22Z", "message": "Removed unused attribute"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2NzA2MzQy", "url": "https://github.com/senx/warp10-platform/pull/751#pullrequestreview-406706342", "createdAt": "2020-05-06T15:04:38Z", "commit": {"oid": "3b0ca0130a66791241045fe9233b1b6fa0775012"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3333, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}