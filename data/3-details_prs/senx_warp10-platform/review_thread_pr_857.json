{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAwNDYyMDQy", "number": 857, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxMzo1Mjo1MVrOEspFRg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwOTo0NzoxN1rOEs9Sgg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE1MjQ1ODk0OnYy", "diffSide": "RIGHT", "path": "warp10/src/main/thrift/io_warp10_continuum_store_thrift_data.thrift", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxMzo1Mjo1MVrOHf_tAQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxMzo1Mjo1MVrOHf_tAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzMxMTYxNw==", "bodyText": "Typo: cell(s)", "url": "https://github.com/senx/warp10-platform/pull/857#discussion_r503311617", "createdAt": "2020-10-12T13:52:51Z", "author": {"login": "ftence"}, "path": "warp10/src/main/thrift/io_warp10_continuum_store_thrift_data.thrift", "diffHunk": "@@ -514,4 +514,8 @@ struct FetchRequest {\n    * Size of the post boundary in number of data points.\n    */\n   12: optional i64 postBoundary = 0,\n+  /**\n+   * Flag indicating we want to return the HBase celle TTL instead of the value", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "551d6c7b184d9874baa236fb282d165fb4c8fc19"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE1NTc2MTAwOnYy", "diffSide": "RIGHT", "path": "warp10/src/main/java/io/warp10/continuum/store/MultiScanGTSDecoderIterator.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwOTo0NToxM1rOHgecgg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwOTo0NToxM1rOHgecgg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzgxNTI5OA==", "bodyText": "This will break the whole decoding loop and should be removed.", "url": "https://github.com/senx/warp10-platform/pull/857#discussion_r503815298", "createdAt": "2020-10-13T09:45:13Z", "author": {"login": "ftence"}, "path": "warp10/src/main/java/io/warp10/continuum/store/MultiScanGTSDecoderIterator.java", "diffHunk": "@@ -448,9 +454,23 @@ public GTSDecoder next() {\n                     continue;\n                   }                               \n                 }\n-                                \n+\n                 if (writeTimestamp) {\n                   encoder.addValue(timestamp, decoder.getLocation(), decoder.getElevation(), cell.getTimestamp() * Constants.TIME_UNITS_PER_MS);\n+                } else if (fetchTTL) {\n+                  boolean hasTTL = false;\n+                  Tag tag = Tag.getTag(cell.getTagsArray(), cell.getTagsOffset(), cell.getTagsLength(), TagType.TTL_TAG_TYPE);\n+                  if (null != tag) {\n+                    if (Bytes.SIZEOF_LONG == tag.getTagLength()) {\n+                      long ttl = Bytes.toLong(tag.getBuffer(), tag.getTagOffset(), tag.getTagLength());\n+                      encoder.addValue(timestamp, decoder.getLocation(), decoder.getElevation(), ttl * Constants.TIME_UNITS_PER_MS);\n+                      hasTTL = true;\n+                    }\n+                    break;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "68d0ba92c5790f6a815f671fe65e159ccf31ca53"}, "originalPosition": 50}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE1NTc2NDIyOnYy", "diffSide": "RIGHT", "path": "warp10/src/main/java/io/warp10/continuum/store/MultiScanGTSDecoderIterator.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwOTo0NjowMFrOHgeedg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwOTo0NjowMFrOHgeedg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzgxNTc5OA==", "bodyText": "Not needed anymore since you use Tag.getTag and null != tag.", "url": "https://github.com/senx/warp10-platform/pull/857#discussion_r503815798", "createdAt": "2020-10-13T09:46:00Z", "author": {"login": "ftence"}, "path": "warp10/src/main/java/io/warp10/continuum/store/MultiScanGTSDecoderIterator.java", "diffHunk": "@@ -448,9 +454,23 @@ public GTSDecoder next() {\n                     continue;\n                   }                               \n                 }\n-                                \n+\n                 if (writeTimestamp) {\n                   encoder.addValue(timestamp, decoder.getLocation(), decoder.getElevation(), cell.getTimestamp() * Constants.TIME_UNITS_PER_MS);\n+                } else if (fetchTTL) {\n+                  boolean hasTTL = false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "68d0ba92c5790f6a815f671fe65e159ccf31ca53"}, "originalPosition": 42}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE1NTc2NTkwOnYy", "diffSide": "RIGHT", "path": "warp10/src/main/java/io/warp10/continuum/store/MultiScanGTSDecoderIterator.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwOTo0NjoyNFrOHgefhg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwOTo0NjoyNFrOHgefhg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzgxNjA3MA==", "bodyText": "Should be in else of if (null != tag).", "url": "https://github.com/senx/warp10-platform/pull/857#discussion_r503816070", "createdAt": "2020-10-13T09:46:24Z", "author": {"login": "ftence"}, "path": "warp10/src/main/java/io/warp10/continuum/store/MultiScanGTSDecoderIterator.java", "diffHunk": "@@ -448,9 +454,23 @@ public GTSDecoder next() {\n                     continue;\n                   }                               \n                 }\n-                                \n+\n                 if (writeTimestamp) {\n                   encoder.addValue(timestamp, decoder.getLocation(), decoder.getElevation(), cell.getTimestamp() * Constants.TIME_UNITS_PER_MS);\n+                } else if (fetchTTL) {\n+                  boolean hasTTL = false;\n+                  Tag tag = Tag.getTag(cell.getTagsArray(), cell.getTagsOffset(), cell.getTagsLength(), TagType.TTL_TAG_TYPE);\n+                  if (null != tag) {\n+                    if (Bytes.SIZEOF_LONG == tag.getTagLength()) {\n+                      long ttl = Bytes.toLong(tag.getBuffer(), tag.getTagOffset(), tag.getTagLength());\n+                      encoder.addValue(timestamp, decoder.getLocation(), decoder.getElevation(), ttl * Constants.TIME_UNITS_PER_MS);\n+                      hasTTL = true;\n+                    }\n+                    break;\n+                  }\n+                  if (!hasTTL) {\n+                    encoder.addValue(timestamp, decoder.getLocation(), decoder.getElevation(), Long.MAX_VALUE);\n+                  }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "68d0ba92c5790f6a815f671fe65e159ccf31ca53"}, "originalPosition": 54}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE1NTc2OTYyOnYy", "diffSide": "RIGHT", "path": "warp10/src/main/java/io/warp10/continuum/store/SlicedRowFilterGTSDecoderIterator.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwOTo0NzoxN1rOHgeh4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwOTo0NzoxN1rOHgeh4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzgxNjY3Mg==", "bodyText": "Same 3 comments as above.", "url": "https://github.com/senx/warp10-platform/pull/857#discussion_r503816672", "createdAt": "2020-10-13T09:47:17Z", "author": {"login": "ftence"}, "path": "warp10/src/main/java/io/warp10/continuum/store/SlicedRowFilterGTSDecoderIterator.java", "diffHunk": "@@ -413,6 +418,20 @@ public GTSDecoder next() {\n               try {\n                 if (writeTimestamp) {\n                   encoder.addValue(timestamp, decoder.getLocation(), decoder.getElevation(), cell.getTimestamp() * Constants.TIME_UNITS_PER_MS);\n+                } else if (fetchTTL) {\n+                  boolean hasTTL = false;\n+                  Tag tag = Tag.getTag(cell.getTagsArray(), cell.getTagsOffset(), cell.getTagsLength(), TagType.TTL_TAG_TYPE);\n+                  if (null != tag) {\n+                    if (Bytes.SIZEOF_LONG == tag.getTagLength()) {\n+                      long ttl = Bytes.toLong(tag.getBuffer(), tag.getTagOffset(), tag.getTagLength());\n+                      encoder.addValue(timestamp, decoder.getLocation(), decoder.getElevation(), ttl * Constants.TIME_UNITS_PER_MS);\n+                      hasTTL = true;\n+                    }\n+                    break;\n+                  }\n+                  if (!hasTTL) {\n+                    encoder.addValue(timestamp, decoder.getLocation(), decoder.getElevation(), Long.MAX_VALUE);\n+                  }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "68d0ba92c5790f6a815f671fe65e159ccf31ca53"}, "originalPosition": 44}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1172, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}