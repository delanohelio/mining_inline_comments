{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAwNDYyMDQy", "number": 857, "title": "Added support for fetching HBase cell TTLs.", "bodyText": "", "createdAt": "2020-10-09T09:22:54Z", "url": "https://github.com/senx/warp10-platform/pull/857", "merged": true, "mergeCommit": {"oid": "515955662b4e5ccdc86b8b6417c7a52d087d39cb"}, "closed": true, "closedAt": "2020-10-13T14:12:53Z", "author": {"login": "hbs"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdQyrFOAH2gAyNTAwNDYyMDQyOjU1MWQ2YzdiMTg0ZDk4NzRiYWEyMzZmYjI4MmQxNjVmYjRjOGZjMTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdSJLNuAFqTUwNzQ3NzE4MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "551d6c7b184d9874baa236fb282d165fb4c8fc19", "author": {"user": {"login": "hbs", "name": "Mathias Herberts"}}, "url": "https://github.com/senx/warp10-platform/commit/551d6c7b184d9874baa236fb282d165fb4c8fc19", "committedDate": "2020-10-09T09:22:20Z", "message": "Added support for fetching HBase cell TTLs."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b85ba7585354c1a93145a000b4e4ba8760cfdc26", "author": {"user": {"login": "hbs", "name": "Mathias Herberts"}}, "url": "https://github.com/senx/warp10-platform/commit/b85ba7585354c1a93145a000b4e4ba8760cfdc26", "committedDate": "2020-10-12T15:55:15Z", "message": "Changed the way the TTL is accessed"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA2NjM5NTQy", "url": "https://github.com/senx/warp10-platform/pull/857#pullrequestreview-506639542", "createdAt": "2020-10-12T13:52:51Z", "commit": {"oid": "551d6c7b184d9874baa236fb282d165fb4c8fc19"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxMzo1Mjo1MVrOHf_tAQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQxMzo1Mjo1MVrOHf_tAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzMxMTYxNw==", "bodyText": "Typo: cell(s)", "url": "https://github.com/senx/warp10-platform/pull/857#discussion_r503311617", "createdAt": "2020-10-12T13:52:51Z", "author": {"login": "ftence"}, "path": "warp10/src/main/thrift/io_warp10_continuum_store_thrift_data.thrift", "diffHunk": "@@ -514,4 +514,8 @@ struct FetchRequest {\n    * Size of the post boundary in number of data points.\n    */\n   12: optional i64 postBoundary = 0,\n+  /**\n+   * Flag indicating we want to return the HBase celle TTL instead of the value", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "551d6c7b184d9874baa236fb282d165fb4c8fc19"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c07cd7efced7821cab8e8307c58a625d0b10617", "author": {"user": {"login": "hbs", "name": "Mathias Herberts"}}, "url": "https://github.com/senx/warp10-platform/commit/1c07cd7efced7821cab8e8307c58a625d0b10617", "committedDate": "2020-10-12T19:12:09Z", "message": "Fixed typo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "68d0ba92c5790f6a815f671fe65e159ccf31ca53", "author": {"user": {"login": "hbs", "name": "Mathias Herberts"}}, "url": "https://github.com/senx/warp10-platform/commit/68d0ba92c5790f6a815f671fe65e159ccf31ca53", "committedDate": "2020-10-12T19:48:27Z", "message": "Added explanation and warning in Javadoc for TTL field of FetchRequest."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3MjU2OTMz", "url": "https://github.com/senx/warp10-platform/pull/857#pullrequestreview-507256933", "createdAt": "2020-10-13T09:45:13Z", "commit": {"oid": "68d0ba92c5790f6a815f671fe65e159ccf31ca53"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwOTo0NToxM1rOHgecgg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QwOTo0NzoxN1rOHgeh4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzgxNTI5OA==", "bodyText": "This will break the whole decoding loop and should be removed.", "url": "https://github.com/senx/warp10-platform/pull/857#discussion_r503815298", "createdAt": "2020-10-13T09:45:13Z", "author": {"login": "ftence"}, "path": "warp10/src/main/java/io/warp10/continuum/store/MultiScanGTSDecoderIterator.java", "diffHunk": "@@ -448,9 +454,23 @@ public GTSDecoder next() {\n                     continue;\n                   }                               \n                 }\n-                                \n+\n                 if (writeTimestamp) {\n                   encoder.addValue(timestamp, decoder.getLocation(), decoder.getElevation(), cell.getTimestamp() * Constants.TIME_UNITS_PER_MS);\n+                } else if (fetchTTL) {\n+                  boolean hasTTL = false;\n+                  Tag tag = Tag.getTag(cell.getTagsArray(), cell.getTagsOffset(), cell.getTagsLength(), TagType.TTL_TAG_TYPE);\n+                  if (null != tag) {\n+                    if (Bytes.SIZEOF_LONG == tag.getTagLength()) {\n+                      long ttl = Bytes.toLong(tag.getBuffer(), tag.getTagOffset(), tag.getTagLength());\n+                      encoder.addValue(timestamp, decoder.getLocation(), decoder.getElevation(), ttl * Constants.TIME_UNITS_PER_MS);\n+                      hasTTL = true;\n+                    }\n+                    break;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "68d0ba92c5790f6a815f671fe65e159ccf31ca53"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzgxNTc5OA==", "bodyText": "Not needed anymore since you use Tag.getTag and null != tag.", "url": "https://github.com/senx/warp10-platform/pull/857#discussion_r503815798", "createdAt": "2020-10-13T09:46:00Z", "author": {"login": "ftence"}, "path": "warp10/src/main/java/io/warp10/continuum/store/MultiScanGTSDecoderIterator.java", "diffHunk": "@@ -448,9 +454,23 @@ public GTSDecoder next() {\n                     continue;\n                   }                               \n                 }\n-                                \n+\n                 if (writeTimestamp) {\n                   encoder.addValue(timestamp, decoder.getLocation(), decoder.getElevation(), cell.getTimestamp() * Constants.TIME_UNITS_PER_MS);\n+                } else if (fetchTTL) {\n+                  boolean hasTTL = false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "68d0ba92c5790f6a815f671fe65e159ccf31ca53"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzgxNjA3MA==", "bodyText": "Should be in else of if (null != tag).", "url": "https://github.com/senx/warp10-platform/pull/857#discussion_r503816070", "createdAt": "2020-10-13T09:46:24Z", "author": {"login": "ftence"}, "path": "warp10/src/main/java/io/warp10/continuum/store/MultiScanGTSDecoderIterator.java", "diffHunk": "@@ -448,9 +454,23 @@ public GTSDecoder next() {\n                     continue;\n                   }                               \n                 }\n-                                \n+\n                 if (writeTimestamp) {\n                   encoder.addValue(timestamp, decoder.getLocation(), decoder.getElevation(), cell.getTimestamp() * Constants.TIME_UNITS_PER_MS);\n+                } else if (fetchTTL) {\n+                  boolean hasTTL = false;\n+                  Tag tag = Tag.getTag(cell.getTagsArray(), cell.getTagsOffset(), cell.getTagsLength(), TagType.TTL_TAG_TYPE);\n+                  if (null != tag) {\n+                    if (Bytes.SIZEOF_LONG == tag.getTagLength()) {\n+                      long ttl = Bytes.toLong(tag.getBuffer(), tag.getTagOffset(), tag.getTagLength());\n+                      encoder.addValue(timestamp, decoder.getLocation(), decoder.getElevation(), ttl * Constants.TIME_UNITS_PER_MS);\n+                      hasTTL = true;\n+                    }\n+                    break;\n+                  }\n+                  if (!hasTTL) {\n+                    encoder.addValue(timestamp, decoder.getLocation(), decoder.getElevation(), Long.MAX_VALUE);\n+                  }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "68d0ba92c5790f6a815f671fe65e159ccf31ca53"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzgxNjY3Mg==", "bodyText": "Same 3 comments as above.", "url": "https://github.com/senx/warp10-platform/pull/857#discussion_r503816672", "createdAt": "2020-10-13T09:47:17Z", "author": {"login": "ftence"}, "path": "warp10/src/main/java/io/warp10/continuum/store/SlicedRowFilterGTSDecoderIterator.java", "diffHunk": "@@ -413,6 +418,20 @@ public GTSDecoder next() {\n               try {\n                 if (writeTimestamp) {\n                   encoder.addValue(timestamp, decoder.getLocation(), decoder.getElevation(), cell.getTimestamp() * Constants.TIME_UNITS_PER_MS);\n+                } else if (fetchTTL) {\n+                  boolean hasTTL = false;\n+                  Tag tag = Tag.getTag(cell.getTagsArray(), cell.getTagsOffset(), cell.getTagsLength(), TagType.TTL_TAG_TYPE);\n+                  if (null != tag) {\n+                    if (Bytes.SIZEOF_LONG == tag.getTagLength()) {\n+                      long ttl = Bytes.toLong(tag.getBuffer(), tag.getTagOffset(), tag.getTagLength());\n+                      encoder.addValue(timestamp, decoder.getLocation(), decoder.getElevation(), ttl * Constants.TIME_UNITS_PER_MS);\n+                      hasTTL = true;\n+                    }\n+                    break;\n+                  }\n+                  if (!hasTTL) {\n+                    encoder.addValue(timestamp, decoder.getLocation(), decoder.getElevation(), Long.MAX_VALUE);\n+                  }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "68d0ba92c5790f6a815f671fe65e159ccf31ca53"}, "originalPosition": 44}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aab710c7c8534a2f52edc3564a35903184b9af30", "author": {"user": {"login": "hbs", "name": "Mathias Herberts"}}, "url": "https://github.com/senx/warp10-platform/commit/aab710c7c8534a2f52edc3564a35903184b9af30", "committedDate": "2020-10-13T13:15:09Z", "message": "Addressed PR comments."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3NDc3MTgx", "url": "https://github.com/senx/warp10-platform/pull/857#pullrequestreview-507477181", "createdAt": "2020-10-13T14:09:16Z", "commit": {"oid": "aab710c7c8534a2f52edc3564a35903184b9af30"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3235, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}