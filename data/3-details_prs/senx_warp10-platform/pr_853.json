{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk0MDM3MjUx", "number": 853, "title": "Add a limit parameter to SPLIT", "bodyText": "Performance is the same when used without limit.\nWith limit, the performance can be increased, for instance:\nUUID '-' 2 SPLIT 0 GET // Faster\nUUID '-'   SPLIT 0 GET // Slower", "createdAt": "2020-09-28T10:16:01Z", "url": "https://github.com/senx/warp10-platform/pull/853", "merged": true, "mergeCommit": {"oid": "b93b460536e284b1e059848ba1b97d7ffedd89ec"}, "closed": true, "closedAt": "2020-09-30T21:03:27Z", "author": {"login": "ftence"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdNQw2EgH2gAyNDk0MDM3MjUxOmExYTA0NDJmN2RkYzQyZGRiZTYzOTY4ZGYwOTdjMzRkMDU5MDUzM2I=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdNTHRBgH2gAyNDk0MDM3MjUxOjYxZGNhNjY1OWVjOWU3MTdlYWY5M2UzYWVhZDczYmY1ZDdjYWY1NTc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a1a0442f7ddc42ddbe63968df097c34d0590533b", "author": {"user": {"login": "ftence", "name": "Fabien Tenc\u00e9"}}, "url": "https://github.com/senx/warp10-platform/commit/a1a0442f7ddc42ddbe63968df097c34d0590533b", "committedDate": "2020-09-28T10:10:05Z", "message": "Add a limit parameter to SPLIT"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3Mzc2Nzg5", "url": "https://github.com/senx/warp10-platform/pull/853#pullrequestreview-497376789", "createdAt": "2020-09-28T10:19:56Z", "commit": {"oid": "a1a0442f7ddc42ddbe63968df097c34d0590533b"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxMDoxOTo1NlrOHY3ayQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxMDoxOTo1NlrOHY3ayQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTgzNTg0OQ==", "bodyText": "-1 == index", "url": "https://github.com/senx/warp10-platform/pull/853#discussion_r495835849", "createdAt": "2020-09-28T10:19:56Z", "author": {"login": "hbs"}, "path": "warp10/src/main/java/io/warp10/script/functions/SPLIT.java", "diffHunk": "@@ -16,56 +16,94 @@\n \n package io.warp10.script.functions;\n \n-import io.warp10.continuum.gts.UnsafeString;\n import io.warp10.script.NamedWarpScriptFunction;\n-import io.warp10.script.WarpScriptStackFunction;\n import io.warp10.script.WarpScriptException;\n import io.warp10.script.WarpScriptStack;\n+import io.warp10.script.WarpScriptStackFunction;\n \n-import java.net.URLDecoder;\n import java.util.ArrayList;\n import java.util.List;\n \n /**\n- * Split a String in segments given a delimiter\n+ * Split a String in segments given a delimiter.\n+ * <p>\n+ * The limit parameter controls the number of times the pattern is applied and therefore affects the length of the\n+ * resulting array. If the limit n is greater than zero then the pattern will be applied at most n - 1 times, the\n+ * array's length will be no greater than n, and the array's last entry will contain all input beyond the last matched\n+ * delimiter.\n  */\n public class SPLIT extends NamedWarpScriptFunction implements WarpScriptStackFunction {\n-  \n+\n   public SPLIT(String name) {\n     super(name);\n   }\n-  \n+\n   @Override\n   public Object apply(WarpScriptStack stack) throws WarpScriptException {\n     Object o = stack.pop();\n-    \n+\n+    int limit = Integer.MAX_VALUE;\n+\n+    if (o instanceof Long) {\n+      limit = Math.toIntExact((Long) o);\n+\n+      if (limit <= 0) {\n+        throw new WarpScriptException(getName() + \" expects the limit to be a strictly positive integer.\");\n+      }\n+\n+      o = stack.pop();\n+    }\n+\n     if (!(o instanceof String)) {\n       throw new WarpScriptException(getName() + \" expects a string delimiter of length 1.\");\n     }\n-    \n+\n     if (1 != o.toString().length()) {\n       throw new WarpScriptException(getName() + \" expects a string delimiter of length 1.\");\n     }\n \n     char delimiter = o.toString().charAt(0);\n-    \n+\n     o = stack.pop();\n \n     if (!(o instanceof String)) {\n       throw new WarpScriptException(getName() + \" operates on a String.\");\n     }\n \n+    stack.push(split(o.toString(), delimiter, limit));\n \n-    String[] tokens = UnsafeString.split(o.toString(), delimiter);\n-    \n-    List<String> ltokens = new ArrayList<String>();\n-    \n-    for (String token: tokens) {\n-      ltokens.add(token);\n-    }\n-    \n-    stack.push(ltokens);\n-    \n     return stack;\n   }\n+\n+  /**\n+   * Split a string using a delimiter and returning a List of \"limit\" maximum length.\n+   * @param input The String instance to be split.\n+   * @param delim The delimiter to use for the split.\n+   * @param limit The returned List maximum size. For limit <= 0 the List contains the input.\n+   * @return A List of splits.\n+   */\n+  public static List<String> split(String input, char delim, int limit) {\n+    ArrayList<String> l = new ArrayList<String>();\n+    int offset = 0;\n+    int splits = 1;\n+\n+    while (splits < limit) {\n+      int index = input.indexOf(delim, offset);\n+      if (index == -1) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a1a0442f7ddc42ddbe63968df097c34d0590533b"}, "originalPosition": 96}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d0571e663d689493147817747bd5534f66c87e9a", "author": {"user": {"login": "ftence", "name": "Fabien Tenc\u00e9"}}, "url": "https://github.com/senx/warp10-platform/commit/d0571e663d689493147817747bd5534f66c87e9a", "committedDate": "2020-09-28T10:31:44Z", "message": "Yoda condition"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3NDI5MTM5", "url": "https://github.com/senx/warp10-platform/pull/853#pullrequestreview-497429139", "createdAt": "2020-09-28T11:41:47Z", "commit": {"oid": "d0571e663d689493147817747bd5534f66c87e9a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxMTo0MTo0N1rOHY54Vw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxMTo0MTo1MFrOHY54Yw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTg3NjE4Mw==", "bodyText": "Could use (String) o since you checked that o was indeed an instance of String.", "url": "https://github.com/senx/warp10-platform/pull/853#discussion_r495876183", "createdAt": "2020-09-28T11:41:47Z", "author": {"login": "hbs"}, "path": "warp10/src/main/java/io/warp10/script/functions/SPLIT.java", "diffHunk": "@@ -16,56 +16,94 @@\n \n package io.warp10.script.functions;\n \n-import io.warp10.continuum.gts.UnsafeString;\n import io.warp10.script.NamedWarpScriptFunction;\n-import io.warp10.script.WarpScriptStackFunction;\n import io.warp10.script.WarpScriptException;\n import io.warp10.script.WarpScriptStack;\n+import io.warp10.script.WarpScriptStackFunction;\n \n-import java.net.URLDecoder;\n import java.util.ArrayList;\n import java.util.List;\n \n /**\n- * Split a String in segments given a delimiter\n+ * Split a String in segments given a delimiter.\n+ * <p>\n+ * The limit parameter controls the number of times the pattern is applied and therefore affects the length of the\n+ * resulting array. If the limit n is greater than zero then the pattern will be applied at most n - 1 times, the\n+ * array's length will be no greater than n, and the array's last entry will contain all input beyond the last matched\n+ * delimiter.\n  */\n public class SPLIT extends NamedWarpScriptFunction implements WarpScriptStackFunction {\n-  \n+\n   public SPLIT(String name) {\n     super(name);\n   }\n-  \n+\n   @Override\n   public Object apply(WarpScriptStack stack) throws WarpScriptException {\n     Object o = stack.pop();\n-    \n+\n+    int limit = Integer.MAX_VALUE;\n+\n+    if (o instanceof Long) {\n+      limit = Math.toIntExact((Long) o);\n+\n+      if (limit <= 0) {\n+        throw new WarpScriptException(getName() + \" expects the limit to be a strictly positive integer.\");\n+      }\n+\n+      o = stack.pop();\n+    }\n+\n     if (!(o instanceof String)) {\n       throw new WarpScriptException(getName() + \" expects a string delimiter of length 1.\");\n     }\n-    \n+\n     if (1 != o.toString().length()) {\n       throw new WarpScriptException(getName() + \" expects a string delimiter of length 1.\");\n     }\n \n     char delimiter = o.toString().charAt(0);\n-    \n+\n     o = stack.pop();\n \n     if (!(o instanceof String)) {\n       throw new WarpScriptException(getName() + \" operates on a String.\");\n     }\n \n+    stack.push(split(o.toString(), delimiter, limit));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d0571e663d689493147817747bd5534f66c87e9a"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTg3NjE5NQ==", "bodyText": "Can use (String) o", "url": "https://github.com/senx/warp10-platform/pull/853#discussion_r495876195", "createdAt": "2020-09-28T11:41:50Z", "author": {"login": "hbs"}, "path": "warp10/src/main/java/io/warp10/script/functions/SPLIT.java", "diffHunk": "@@ -16,56 +16,94 @@\n \n package io.warp10.script.functions;\n \n-import io.warp10.continuum.gts.UnsafeString;\n import io.warp10.script.NamedWarpScriptFunction;\n-import io.warp10.script.WarpScriptStackFunction;\n import io.warp10.script.WarpScriptException;\n import io.warp10.script.WarpScriptStack;\n+import io.warp10.script.WarpScriptStackFunction;\n \n-import java.net.URLDecoder;\n import java.util.ArrayList;\n import java.util.List;\n \n /**\n- * Split a String in segments given a delimiter\n+ * Split a String in segments given a delimiter.\n+ * <p>\n+ * The limit parameter controls the number of times the pattern is applied and therefore affects the length of the\n+ * resulting array. If the limit n is greater than zero then the pattern will be applied at most n - 1 times, the\n+ * array's length will be no greater than n, and the array's last entry will contain all input beyond the last matched\n+ * delimiter.\n  */\n public class SPLIT extends NamedWarpScriptFunction implements WarpScriptStackFunction {\n-  \n+\n   public SPLIT(String name) {\n     super(name);\n   }\n-  \n+\n   @Override\n   public Object apply(WarpScriptStack stack) throws WarpScriptException {\n     Object o = stack.pop();\n-    \n+\n+    int limit = Integer.MAX_VALUE;\n+\n+    if (o instanceof Long) {\n+      limit = Math.toIntExact((Long) o);\n+\n+      if (limit <= 0) {\n+        throw new WarpScriptException(getName() + \" expects the limit to be a strictly positive integer.\");\n+      }\n+\n+      o = stack.pop();\n+    }\n+\n     if (!(o instanceof String)) {\n       throw new WarpScriptException(getName() + \" expects a string delimiter of length 1.\");\n     }\n-    \n+\n     if (1 != o.toString().length()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d0571e663d689493147817747bd5534f66c87e9a"}, "originalPosition": 54}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "61dca6659ec9e717eaf93e3aead73bf5d7caf557", "author": {"user": {"login": "ftence", "name": "Fabien Tenc\u00e9"}}, "url": "https://github.com/senx/warp10-platform/commit/61dca6659ec9e717eaf93e3aead73bf5d7caf557", "committedDate": "2020-09-28T12:54:23Z", "message": "Swap toString() to String cast"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3229, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}