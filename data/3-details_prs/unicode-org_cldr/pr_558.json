{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ2ODg3NzM0", "number": 558, "title": "CLDR-13857 use singleton to get CLDR directory", "bodyText": "Optimize CLDRConfig.getCldrBaseDirectory()\nChecklist\n\n Issue filed: https://unicode-org.atlassian.net/browse/CLDR-13857\n Updated PR title and link in previous line to include Issue number", "createdAt": "2020-07-09T14:13:06Z", "url": "https://github.com/unicode-org/cldr/pull/558", "merged": true, "mergeCommit": {"oid": "4f8367392a6853b89c52af5ba865d07958601690"}, "closed": true, "closedAt": "2020-07-10T21:50:49Z", "author": {"login": "AlintaLu"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABczPhhwgH2gAyNDQ2ODg3NzM0OjQ2MGE4YzFhODYwNWJhNmMwMDI0NDk2MTI0NDgxNDRhNTM4Nzg1NWE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABczqQ7DgFqTQ0NjcwMjkwNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "460a8c1a8605ba6c002449612448144a5387855a", "author": {"user": {"login": "AlintaLu", "name": "Yiqing Lu"}}, "url": "https://github.com/unicode-org/cldr/commit/460a8c1a8605ba6c002449612448144a5387855a", "committedDate": "2020-07-09T14:01:25Z", "message": "CLDR-13857 use singleton to get cldr directory"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1NzEyNDg2", "url": "https://github.com/unicode-org/cldr/pull/558#pullrequestreview-445712486", "createdAt": "2020-07-09T15:10:26Z", "commit": {"oid": "460a8c1a8605ba6c002449612448144a5387855a"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2MTA3NDcz", "url": "https://github.com/unicode-org/cldr/pull/558#pullrequestreview-446107473", "createdAt": "2020-07-10T04:00:11Z", "commit": {"oid": "460a8c1a8605ba6c002449612448144a5387855a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQwNDowMDoxMVrOGvpHyw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQwNDowMDozNlrOGvpILQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjYwOTk5NQ==", "bodyText": "good work here, using the getInstance to allow the class to be static.", "url": "https://github.com/unicode-org/cldr/pull/558#discussion_r452609995", "createdAt": "2020-07-10T04:00:11Z", "author": {"login": "macchiati"}, "path": "tools/java/org/unicode/cldr/util/CLDRConfig.java", "diffHunk": "@@ -533,15 +533,37 @@ public int getProperty(String k, int defVal) {\n         }\n     }\n \n-    public File getCldrBaseDirectory() {\n-        String dir = getProperty(\"CLDR_DIR\", null);\n-        if (dir != null) {\n-            return new File(dir);\n-        } else {\n-            return null;\n+    static class FileWrapper {\n+        private File cldrDir = null;\n+        private FileWrapper() {\n+            String dir = getInstance().getProperty(\"CLDR_DIR\", null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "460a8c1a8605ba6c002449612448144a5387855a"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjYxMDA5Mw==", "bodyText": "I think these can be replaced by the following, avoiding the need for the test and synchronization (which is part of the reason for using the Singleton model).\n    private static FileWrapper fileWrapperInstance = new FileWrapper();\n    private static FileWrapper getFileWrapperInstance() {\n        return fileWrapperInstance;\n    }", "url": "https://github.com/unicode-org/cldr/pull/558#discussion_r452610093", "createdAt": "2020-07-10T04:00:36Z", "author": {"login": "macchiati"}, "path": "tools/java/org/unicode/cldr/util/CLDRConfig.java", "diffHunk": "@@ -533,15 +533,37 @@ public int getProperty(String k, int defVal) {\n         }\n     }\n \n-    public File getCldrBaseDirectory() {\n-        String dir = getProperty(\"CLDR_DIR\", null);\n-        if (dir != null) {\n-            return new File(dir);\n-        } else {\n-            return null;\n+    static class FileWrapper {\n+        private File cldrDir = null;\n+        private FileWrapper() {\n+            String dir = getInstance().getProperty(\"CLDR_DIR\", null);\n+            if (dir != null) {\n+                cldrDir = new File(dir);\n+            } else {\n+                cldrDir = null;\n+            }\n+        }\n+        public File getCldrDir() {\n+            return this.cldrDir;\n+        }\n+        // singleton\n+        private static FileWrapper fileWrapperInstance = null;\n+        public static FileWrapper getFileWrapperInstance() {\n+            if (fileWrapperInstance == null) {\n+                synchronized(FileWrapper.class) {\n+                    if (fileWrapperInstance == null) {\n+                        fileWrapperInstance = new FileWrapper();\n+                    }\n+                }\n+            }\n+            return fileWrapperInstance;\n         }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "460a8c1a8605ba6c002449612448144a5387855a"}, "originalPosition": 34}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a0d05cb7b9a6c1f480324962f388511536701488", "author": {"user": {"login": "AlintaLu", "name": "Yiqing Lu"}}, "url": "https://github.com/unicode-org/cldr/commit/a0d05cb7b9a6c1f480324962f388511536701488", "committedDate": "2020-07-10T14:34:29Z", "message": "CLDR-13857 Change to a more effective singleton implementation in FileWrapper"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2NzAyOTA1", "url": "https://github.com/unicode-org/cldr/pull/558#pullrequestreview-446702905", "createdAt": "2020-07-10T21:10:43Z", "commit": {"oid": "a0d05cb7b9a6c1f480324962f388511536701488"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1989, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}