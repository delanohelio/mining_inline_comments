{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU5Nzk1MDc4", "number": 601, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQyMjowNzowOFrOEUN6fQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQyMjowNzowOFrOEUN6fQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg5NjM0OTQxOnYy", "diffSide": "RIGHT", "path": ".github/workflows/ant.yml", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQyMjowNzowOFrOG6YLmQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxNzoxMzoyMFrOG7BvpA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzg2Njc3Nw==", "bodyText": "Note: this workflow is configured to execute on push events only on the master branch (which is what gets triggered when merging a PR).  Which makes sense, as it does for certain other things (ex: we have our API docs re-generate only on merges to master).\nThe comment \"Only on push\" kinda of obfuscates that fact, so maybe reword?", "url": "https://github.com/unicode-org/cldr/pull/601#discussion_r463866777", "createdAt": "2020-07-31T22:07:08Z", "author": {"login": "echeran"}, "path": ".github/workflows/ant.yml", "diffHunk": "@@ -60,10 +57,105 @@ jobs:\n       with:\n         name: cldr-apps\n         path: tools/cldr-apps/cldr-apps.war\n+  surveytest:\n+    needs: build\n+    runs-on: ubuntu-latest\n+    steps:\n+    - uses: actions/checkout@v2\n+      with:\n+        lfs: true # important!\n+    - name: Set up JDK 1.8\n+      uses: actions/setup-java@v1\n+      with:\n+        java-version: 1.8\n+    - name: Download cldr.jar\n+      uses: actions/download-artifact@v2\n+      with:\n+        name: cldr-tools\n+        path: tools/java/dist/for-build\n+    - name: Download cldr-apps.war\n+      uses: actions/download-artifact@v2\n+      with:\n+        name: cldr-apps\n+        path: tools/java/dist/for-build\n+    # Cache for Tomcat tarball (load on cache hit, else store at end of job)\n+    - name: Cache for Tomcat tarball\n+      id: cache-tomcat\n+      uses: actions/cache@v2\n+      with:\n+        path: tomcat-tarball\n+        key: ${{ runner.os }}-tomcat-tarball\n+    - name: Download Tomcat # only on cache miss\n+      if: steps.cache-tomcat.outputs.cache-hit != 'true'\n+      run: 'mkdir -p ./tomcat-tarball && cd ./tomcat-tarball && wget -O - \"https://www.apache.org/dyn/mirrors/mirrors.cgi?action=download&filename=tomcat/tomcat-8/v8.5.57/bin/apache-tomcat-8.5.57.tar.gz\" | tar xfpz - ; cd .. '\n+    - name: Alias Tomcat directory\n+      run: ln -svf tomcat-tarball/apache-tomcat-* tomcat\n+    - name: Survey Tool Check\n+      run: ant -noinput -DCLDR_TOOLS=$(pwd)/tools/java -DCATALINA_HOME=$(pwd)/tomcat -f tools/cldr-apps/build.xml check\n+  test:\n+    needs: build\n+    runs-on: ubuntu-latest\n+    steps:\n+    - uses: actions/checkout@v2\n+      with:\n+        lfs: true # important!\n+    - name: Set up JDK 1.8\n+      uses: actions/setup-java@v1\n+      with:\n+        java-version: 1.8\n+    - name: Download cldr.jar\n+      uses: actions/download-artifact@v2\n+      with:\n+        name: cldr-tools\n+        path: tools/java/dist/for-build\n+    - name: Debug\n+      run: find tools/java/dist/for-build -ls\n+    - name: Build tools/cldr-unittest\n+      run: ant -noinput -f tools/cldr-unittest/build.xml -DCLDR_DIR=$(pwd) tests\n     # Now run tests\n     - name: CLDR Unit Test\n       run: ant -noinput unittest -f tools/cldr-unittest/build.xml -DCLDR_DIR=$(pwd)\n     - name: CLDR Data Check\n       run: ant -noinput datacheck -f tools/cldr-unittest/build.xml -DCLDR_DIR=$(pwd)\n-    - name: Survey Tool Check\n-      run: ant -noinput -DCLDR_TOOLS=$(pwd)/tools/java -DCATALINA_HOME=$(pwd)/tomcat -f tools/cldr-apps/build.xml check\n+  deploy:\n+    needs:\n+      - build\n+      - surveytest\n+      - test\n+    runs-on: ubuntu-latest\n+    steps:\n+    - name: Download cldr-apps.war\n+      uses: actions/download-artifact@v2\n+      with:\n+        name: cldr-apps\n+    - name: Deploy to cldr-ref (experimental)\n+      # Only on push.\n+      if: ${{ github.event_name == 'push' }}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "70038bd12a2a60d29f221fe22e5a84c2d993f7a7"}, "originalPosition": 105}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzg5NjIwOA==", "bodyText": "@echeran the point is that PRs don't cause a deployment, only a merge. The workflow is triggered on pr OR push ( https://github.com/unicode-org/cldr/pull/601/files/70038bd12a2a60d29f221fe22e5a84c2d993f7a7#diff-42c4d583ae6d708ccce679a6fd657ed6L19 )", "url": "https://github.com/unicode-org/cldr/pull/601#discussion_r463896208", "createdAt": "2020-08-01T00:29:30Z", "author": {"login": "srl295"}, "path": ".github/workflows/ant.yml", "diffHunk": "@@ -60,10 +57,105 @@ jobs:\n       with:\n         name: cldr-apps\n         path: tools/cldr-apps/cldr-apps.war\n+  surveytest:\n+    needs: build\n+    runs-on: ubuntu-latest\n+    steps:\n+    - uses: actions/checkout@v2\n+      with:\n+        lfs: true # important!\n+    - name: Set up JDK 1.8\n+      uses: actions/setup-java@v1\n+      with:\n+        java-version: 1.8\n+    - name: Download cldr.jar\n+      uses: actions/download-artifact@v2\n+      with:\n+        name: cldr-tools\n+        path: tools/java/dist/for-build\n+    - name: Download cldr-apps.war\n+      uses: actions/download-artifact@v2\n+      with:\n+        name: cldr-apps\n+        path: tools/java/dist/for-build\n+    # Cache for Tomcat tarball (load on cache hit, else store at end of job)\n+    - name: Cache for Tomcat tarball\n+      id: cache-tomcat\n+      uses: actions/cache@v2\n+      with:\n+        path: tomcat-tarball\n+        key: ${{ runner.os }}-tomcat-tarball\n+    - name: Download Tomcat # only on cache miss\n+      if: steps.cache-tomcat.outputs.cache-hit != 'true'\n+      run: 'mkdir -p ./tomcat-tarball && cd ./tomcat-tarball && wget -O - \"https://www.apache.org/dyn/mirrors/mirrors.cgi?action=download&filename=tomcat/tomcat-8/v8.5.57/bin/apache-tomcat-8.5.57.tar.gz\" | tar xfpz - ; cd .. '\n+    - name: Alias Tomcat directory\n+      run: ln -svf tomcat-tarball/apache-tomcat-* tomcat\n+    - name: Survey Tool Check\n+      run: ant -noinput -DCLDR_TOOLS=$(pwd)/tools/java -DCATALINA_HOME=$(pwd)/tomcat -f tools/cldr-apps/build.xml check\n+  test:\n+    needs: build\n+    runs-on: ubuntu-latest\n+    steps:\n+    - uses: actions/checkout@v2\n+      with:\n+        lfs: true # important!\n+    - name: Set up JDK 1.8\n+      uses: actions/setup-java@v1\n+      with:\n+        java-version: 1.8\n+    - name: Download cldr.jar\n+      uses: actions/download-artifact@v2\n+      with:\n+        name: cldr-tools\n+        path: tools/java/dist/for-build\n+    - name: Debug\n+      run: find tools/java/dist/for-build -ls\n+    - name: Build tools/cldr-unittest\n+      run: ant -noinput -f tools/cldr-unittest/build.xml -DCLDR_DIR=$(pwd) tests\n     # Now run tests\n     - name: CLDR Unit Test\n       run: ant -noinput unittest -f tools/cldr-unittest/build.xml -DCLDR_DIR=$(pwd)\n     - name: CLDR Data Check\n       run: ant -noinput datacheck -f tools/cldr-unittest/build.xml -DCLDR_DIR=$(pwd)\n-    - name: Survey Tool Check\n-      run: ant -noinput -DCLDR_TOOLS=$(pwd)/tools/java -DCATALINA_HOME=$(pwd)/tomcat -f tools/cldr-apps/build.xml check\n+  deploy:\n+    needs:\n+      - build\n+      - surveytest\n+      - test\n+    runs-on: ubuntu-latest\n+    steps:\n+    - name: Download cldr-apps.war\n+      uses: actions/download-artifact@v2\n+      with:\n+        name: cldr-apps\n+    - name: Deploy to cldr-ref (experimental)\n+      # Only on push.\n+      if: ${{ github.event_name == 'push' }}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzg2Njc3Nw=="}, "originalCommit": {"oid": "70038bd12a2a60d29f221fe22e5a84c2d993f7a7"}, "originalPosition": 105}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDU0Nzc0OA==", "bodyText": "@echeran updated the wording of the comment.  As noted above, this workflow is triggered on a PR before merge, not just after merge.", "url": "https://github.com/unicode-org/cldr/pull/601#discussion_r464547748", "createdAt": "2020-08-03T17:13:20Z", "author": {"login": "srl295"}, "path": ".github/workflows/ant.yml", "diffHunk": "@@ -60,10 +57,105 @@ jobs:\n       with:\n         name: cldr-apps\n         path: tools/cldr-apps/cldr-apps.war\n+  surveytest:\n+    needs: build\n+    runs-on: ubuntu-latest\n+    steps:\n+    - uses: actions/checkout@v2\n+      with:\n+        lfs: true # important!\n+    - name: Set up JDK 1.8\n+      uses: actions/setup-java@v1\n+      with:\n+        java-version: 1.8\n+    - name: Download cldr.jar\n+      uses: actions/download-artifact@v2\n+      with:\n+        name: cldr-tools\n+        path: tools/java/dist/for-build\n+    - name: Download cldr-apps.war\n+      uses: actions/download-artifact@v2\n+      with:\n+        name: cldr-apps\n+        path: tools/java/dist/for-build\n+    # Cache for Tomcat tarball (load on cache hit, else store at end of job)\n+    - name: Cache for Tomcat tarball\n+      id: cache-tomcat\n+      uses: actions/cache@v2\n+      with:\n+        path: tomcat-tarball\n+        key: ${{ runner.os }}-tomcat-tarball\n+    - name: Download Tomcat # only on cache miss\n+      if: steps.cache-tomcat.outputs.cache-hit != 'true'\n+      run: 'mkdir -p ./tomcat-tarball && cd ./tomcat-tarball && wget -O - \"https://www.apache.org/dyn/mirrors/mirrors.cgi?action=download&filename=tomcat/tomcat-8/v8.5.57/bin/apache-tomcat-8.5.57.tar.gz\" | tar xfpz - ; cd .. '\n+    - name: Alias Tomcat directory\n+      run: ln -svf tomcat-tarball/apache-tomcat-* tomcat\n+    - name: Survey Tool Check\n+      run: ant -noinput -DCLDR_TOOLS=$(pwd)/tools/java -DCATALINA_HOME=$(pwd)/tomcat -f tools/cldr-apps/build.xml check\n+  test:\n+    needs: build\n+    runs-on: ubuntu-latest\n+    steps:\n+    - uses: actions/checkout@v2\n+      with:\n+        lfs: true # important!\n+    - name: Set up JDK 1.8\n+      uses: actions/setup-java@v1\n+      with:\n+        java-version: 1.8\n+    - name: Download cldr.jar\n+      uses: actions/download-artifact@v2\n+      with:\n+        name: cldr-tools\n+        path: tools/java/dist/for-build\n+    - name: Debug\n+      run: find tools/java/dist/for-build -ls\n+    - name: Build tools/cldr-unittest\n+      run: ant -noinput -f tools/cldr-unittest/build.xml -DCLDR_DIR=$(pwd) tests\n     # Now run tests\n     - name: CLDR Unit Test\n       run: ant -noinput unittest -f tools/cldr-unittest/build.xml -DCLDR_DIR=$(pwd)\n     - name: CLDR Data Check\n       run: ant -noinput datacheck -f tools/cldr-unittest/build.xml -DCLDR_DIR=$(pwd)\n-    - name: Survey Tool Check\n-      run: ant -noinput -DCLDR_TOOLS=$(pwd)/tools/java -DCATALINA_HOME=$(pwd)/tomcat -f tools/cldr-apps/build.xml check\n+  deploy:\n+    needs:\n+      - build\n+      - surveytest\n+      - test\n+    runs-on: ubuntu-latest\n+    steps:\n+    - name: Download cldr-apps.war\n+      uses: actions/download-artifact@v2\n+      with:\n+        name: cldr-apps\n+    - name: Deploy to cldr-ref (experimental)\n+      # Only on push.\n+      if: ${{ github.event_name == 'push' }}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzg2Njc3Nw=="}, "originalCommit": {"oid": "70038bd12a2a60d29f221fe22e5a84c2d993f7a7"}, "originalPosition": 105}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 438, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}