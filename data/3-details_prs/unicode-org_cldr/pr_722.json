{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkwNjIyNTk2", "number": 722, "title": "CLDR-8753 reduce duplicate Collation construction", "bodyText": "CLDR-8753\nDid not measure this, but should cut down on Collator creation in a couple of hot spots.", "createdAt": "2020-09-22T00:12:24Z", "url": "https://github.com/unicode-org/cldr/pull/722", "merged": true, "mergeCommit": {"oid": "e757a3bdbe4c9dc1a31fa5334f5616458f0b27b5"}, "closed": true, "closedAt": "2020-09-23T00:02:11Z", "author": {"login": "srl295"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdLMoCuAFqTQ5MzA2MTIxNA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdLgQvbgFqTQ5MzkwNDY0NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkzMDYxMjE0", "url": "https://github.com/unicode-org/cldr/pull/722#pullrequestreview-493061214", "createdAt": "2020-09-22T00:13:00Z", "commit": {"oid": "63c5b7a8c26882d847e7331a4941565017745b64"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQwMDoxMzowMFrOHVmksQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQwMDoxMzowMFrOHVmksQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjQxNDEyOQ==", "bodyText": "this class is used in many other spots!", "url": "https://github.com/unicode-org/cldr/pull/722#discussion_r492414129", "createdAt": "2020-09-22T00:13:00Z", "author": {"login": "srl295"}, "path": "tools/java/org/unicode/cldr/util/MapComparator.java", "diffHunk": "@@ -24,9 +24,17 @@\n import com.ibm.icu.util.ULocale;\n \n public class MapComparator<K> implements Comparator<K>, Freezable<MapComparator<K>> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "63c5b7a8c26882d847e7331a4941565017745b64"}, "originalPosition": 3}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkzMDYxMzIx", "url": "https://github.com/unicode-org/cldr/pull/722#pullrequestreview-493061321", "createdAt": "2020-09-22T00:13:24Z", "commit": {"oid": "63c5b7a8c26882d847e7331a4941565017745b64"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQwMDoxMzoyNVrOHVmlEw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQwMDoxMzoyNVrOHVmlEw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjQxNDIyNw==", "bodyText": "this is an Emoji-aware English collator, rather than the default (!!) collator.", "url": "https://github.com/unicode-org/cldr/pull/722#discussion_r492414227", "createdAt": "2020-09-22T00:13:25Z", "author": {"login": "srl295"}, "path": "tools/java/org/unicode/cldr/util/VettingViewer.java", "diffHunk": "@@ -1005,7 +1004,7 @@ void computeOne(int n) {\n     private void writeSummaryTable(Appendable output, String header, Level desiredLevel,\n         EnumSet<Choice> choices, T organization) throws IOException {\n \n-        Map<String, String> sortedNames = new TreeMap<>(Collator.getInstance());\n+        Map<String, String> sortedNames = new TreeMap<>(CLDRConfig.getInstance().getCollator());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "63c5b7a8c26882d847e7331a4941565017745b64"}, "originalPosition": 13}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "63c5b7a8c26882d847e7331a4941565017745b64", "author": {"user": {"login": "srl295", "name": "Steven R. Loomis"}}, "url": "https://github.com/unicode-org/cldr/commit/63c5b7a8c26882d847e7331a4941565017745b64", "committedDate": "2020-09-22T00:05:24Z", "message": "CLDR-8753 reduce duplicate Collation construction"}, "afterCommit": {"oid": "e313eb25050af3422fe7bbea2338e03ecd8a5786", "author": {"user": {"login": "srl295", "name": "Steven R. Loomis"}}, "url": "https://github.com/unicode-org/cldr/commit/e313eb25050af3422fe7bbea2338e03ecd8a5786", "committedDate": "2020-09-22T01:07:32Z", "message": "CLDR-8753 reduce duplicate Collation construction\n\n- need to use String.valueOf(...) in some cases."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkzMDc1MDMy", "url": "https://github.com/unicode-org/cldr/pull/722#pullrequestreview-493075032", "createdAt": "2020-09-22T01:08:40Z", "commit": {"oid": "e313eb25050af3422fe7bbea2338e03ecd8a5786"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQwMTowODo0MFrOHVnXpg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQwMTowODo0MFrOHVnXpg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjQyNzE3NA==", "bodyText": "I did end up retaining this, just to call String.valueOf\u2026", "url": "https://github.com/unicode-org/cldr/pull/722#discussion_r492427174", "createdAt": "2020-09-22T01:08:40Z", "author": {"login": "srl295"}, "path": "tools/java/org/unicode/cldr/util/VoteResolver.java", "diffHunk": "@@ -683,12 +683,15 @@ public T getOrgVoteRaw(Organization orgOfUser) {\n      */\n     private boolean usingKeywordAnnotationVoting = false;\n \n-    private final Comparator<T> ucaCollator = new Comparator<T>() {\n-        Collator col = Collator.getInstance(ULocale.ENGLISH);\n+    private static final Collator englishCollator = Collator.getInstance(ULocale.ENGLISH).freeze();\n \n+    /**\n+     * Used for comparing objects of type T\n+     */\n+    private final Comparator<T> objectCollator = new Comparator<T>() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e313eb25050af3422fe7bbea2338e03ecd8a5786"}, "originalPosition": 11}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkzMDk2NTkz", "url": "https://github.com/unicode-org/cldr/pull/722#pullrequestreview-493096593", "createdAt": "2020-09-22T02:44:44Z", "commit": {"oid": "e313eb25050af3422fe7bbea2338e03ecd8a5786"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQwMjo0NDo0NFrOHVolbQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQwMjo0NDo0NFrOHVolbQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjQ0NzA4NQ==", "bodyText": "If we are sure this will be called at least ones by all users of MapComparator, this is fine. Otherwise would be good to use the Singleton thread-safe pattern (see other ticket).", "url": "https://github.com/unicode-org/cldr/pull/722#discussion_r492447085", "createdAt": "2020-09-22T02:44:44Z", "author": {"login": "macchiati"}, "path": "tools/java/org/unicode/cldr/util/MapComparator.java", "diffHunk": "@@ -24,9 +24,17 @@\n import com.ibm.icu.util.ULocale;\n \n public class MapComparator<K> implements Comparator<K>, Freezable<MapComparator<K>> {\n-    private RuleBasedCollator uca = (RuleBasedCollator) Collator.getInstance(ULocale.ROOT);\n-    {\n-        uca.setNumericCollation(true);\n+    // initialize this once\n+    private static final Collator uca = getUCA();\n+\n+    /**\n+     * This does not change, so we can create one and freeze it.\n+     * @return\n+     */\n+    private static Collator getUCA() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e313eb25050af3422fe7bbea2338e03ecd8a5786"}, "originalPosition": 14}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e313eb25050af3422fe7bbea2338e03ecd8a5786", "author": {"user": {"login": "srl295", "name": "Steven R. Loomis"}}, "url": "https://github.com/unicode-org/cldr/commit/e313eb25050af3422fe7bbea2338e03ecd8a5786", "committedDate": "2020-09-22T01:07:32Z", "message": "CLDR-8753 reduce duplicate Collation construction\n\n- need to use String.valueOf(...) in some cases."}, "afterCommit": {"oid": "9bb2bd4b61cb53d689a03b27376a3f0f43691811", "author": {"user": {"login": "srl295", "name": "Steven R. Loomis"}}, "url": "https://github.com/unicode-org/cldr/commit/9bb2bd4b61cb53d689a03b27376a3f0f43691811", "committedDate": "2020-09-22T15:56:29Z", "message": "CLDR-14184 further updates to statistics page\n\n- turn x axis label to reduce crowding\n- improve spacing along y axis\n- improve wording in legend"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7a54ae9149dfac4f53ffa3b4135cd3b1818d8b2f", "author": {"user": {"login": "srl295", "name": "Steven R. Loomis"}}, "url": "https://github.com/unicode-org/cldr/commit/7a54ae9149dfac4f53ffa3b4135cd3b1818d8b2f", "committedDate": "2020-09-22T15:57:23Z", "message": "CLDR-8753 reduce duplicate Collation construction\n\n- need to use String.valueOf(...) in some cases.\n- use Bill Pugh (CLDR-14180) singleton for MapComparator"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9bb2bd4b61cb53d689a03b27376a3f0f43691811", "author": {"user": {"login": "srl295", "name": "Steven R. Loomis"}}, "url": "https://github.com/unicode-org/cldr/commit/9bb2bd4b61cb53d689a03b27376a3f0f43691811", "committedDate": "2020-09-22T15:56:29Z", "message": "CLDR-14184 further updates to statistics page\n\n- turn x axis label to reduce crowding\n- improve spacing along y axis\n- improve wording in legend"}, "afterCommit": {"oid": "7a54ae9149dfac4f53ffa3b4135cd3b1818d8b2f", "author": {"user": {"login": "srl295", "name": "Steven R. Loomis"}}, "url": "https://github.com/unicode-org/cldr/commit/7a54ae9149dfac4f53ffa3b4135cd3b1818d8b2f", "committedDate": "2020-09-22T15:57:23Z", "message": "CLDR-8753 reduce duplicate Collation construction\n\n- need to use String.valueOf(...) in some cases.\n- use Bill Pugh (CLDR-14180) singleton for MapComparator"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkzOTA0NjQ1", "url": "https://github.com/unicode-org/cldr/pull/722#pullrequestreview-493904645", "createdAt": "2020-09-22T23:05:39Z", "commit": {"oid": "7a54ae9149dfac4f53ffa3b4135cd3b1818d8b2f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1956, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}