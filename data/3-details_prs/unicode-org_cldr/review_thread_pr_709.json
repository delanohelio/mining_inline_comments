{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg3NDI0Nzkz", "number": 709, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxNzoxNjowNFrOEjsLBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxNzoyNjozOVrOEjseEw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA1ODU5MzM1OnYy", "diffSide": "RIGHT", "path": "tools/java/org/unicode/cldr/util/CLDRConfig.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxNzoxNjowNFrOHSL1Xg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxOTowNToxM1rOHVekDA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODgzMDMwMg==", "bodyText": "The name of this is very obscure. It appears that this calls get(key) which calls getProperty() \u2014 which does have a meaningful name. The get() methods should be renamed to getProperty()", "url": "https://github.com/unicode-org/cldr/pull/709#discussion_r488830302", "createdAt": "2020-09-15T17:16:04Z", "author": {"login": "macchiati"}, "path": "tools/java/org/unicode/cldr/util/CLDRConfig.java", "diffHunk": "@@ -794,4 +794,23 @@ public static VersionInfo getVersion(int... versionInput) {\n         return VersionInfo.getInstance(version[0], version[1], version[2],\n             version[3]);\n     }\n+\n+    /**\n+     * Get a config value as an integer.\n+     * @param key key name\n+     * @param defaultValue default value\n+     * @return the value, or defaultValue if missing or unparseable.\n+     * @see CLDRConfig#get(Object)\n+     */\n+    public int get(String key, int defaultValue) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "889cf42b05815614e386264e86b48308d329b7e4"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjI3NzUyMw==", "bodyText": "So this is actually inherited from the fact that it extends Properties which extends Hashtable.\nBut I will change this to `getProperty() which is clearer.", "url": "https://github.com/unicode-org/cldr/pull/709#discussion_r492277523", "createdAt": "2020-09-21T18:55:15Z", "author": {"login": "srl295"}, "path": "tools/java/org/unicode/cldr/util/CLDRConfig.java", "diffHunk": "@@ -794,4 +794,23 @@ public static VersionInfo getVersion(int... versionInput) {\n         return VersionInfo.getInstance(version[0], version[1], version[2],\n             version[3]);\n     }\n+\n+    /**\n+     * Get a config value as an integer.\n+     * @param key key name\n+     * @param defaultValue default value\n+     * @return the value, or defaultValue if missing or unparseable.\n+     * @see CLDRConfig#get(Object)\n+     */\n+    public int get(String key, int defaultValue) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODgzMDMwMg=="}, "originalCommit": {"oid": "889cf42b05815614e386264e86b48308d329b7e4"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjI3OTQ4Mw==", "bodyText": "It's worse than that, I actually already added a getProperty(String, Integer) some (years) ago.  Deleted the duplicate implementation and changing code to use that...", "url": "https://github.com/unicode-org/cldr/pull/709#discussion_r492279483", "createdAt": "2020-09-21T18:58:47Z", "author": {"login": "srl295"}, "path": "tools/java/org/unicode/cldr/util/CLDRConfig.java", "diffHunk": "@@ -794,4 +794,23 @@ public static VersionInfo getVersion(int... versionInput) {\n         return VersionInfo.getInstance(version[0], version[1], version[2],\n             version[3]);\n     }\n+\n+    /**\n+     * Get a config value as an integer.\n+     * @param key key name\n+     * @param defaultValue default value\n+     * @return the value, or defaultValue if missing or unparseable.\n+     * @see CLDRConfig#get(Object)\n+     */\n+    public int get(String key, int defaultValue) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODgzMDMwMg=="}, "originalCommit": {"oid": "889cf42b05815614e386264e86b48308d329b7e4"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjI4Mjg5Mg==", "bodyText": "Done", "url": "https://github.com/unicode-org/cldr/pull/709#discussion_r492282892", "createdAt": "2020-09-21T19:05:13Z", "author": {"login": "srl295"}, "path": "tools/java/org/unicode/cldr/util/CLDRConfig.java", "diffHunk": "@@ -794,4 +794,23 @@ public static VersionInfo getVersion(int... versionInput) {\n         return VersionInfo.getInstance(version[0], version[1], version[2],\n             version[3]);\n     }\n+\n+    /**\n+     * Get a config value as an integer.\n+     * @param key key name\n+     * @param defaultValue default value\n+     * @return the value, or defaultValue if missing or unparseable.\n+     * @see CLDRConfig#get(Object)\n+     */\n+    public int get(String key, int defaultValue) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODgzMDMwMg=="}, "originalCommit": {"oid": "889cf42b05815614e386264e86b48308d329b7e4"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA1ODYwNTEzOnYy", "diffSide": "RIGHT", "path": "tools/java/org/unicode/cldr/util/VettingViewer.java", "isResolved": false, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxNzoxOToyMFrOHSL8ug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQyMjo0NDo1M1rOHVk8_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODgzMjE4Ng==", "bodyText": "It seems like it would be simpler and more understandable to use parallel streams. Or is there a problem with that?", "url": "https://github.com/unicode-org/cldr/pull/709#discussion_r488832186", "createdAt": "2020-09-15T17:19:20Z", "author": {"login": "macchiati"}, "path": "tools/java/org/unicode/cldr/util/VettingViewer.java", "diffHunk": "@@ -805,6 +807,161 @@ public void generateSummaryHtmlErrorTables(Appendable output, EnumSet<Choice> ch\n \n     }\n \n+    private class WriteContext {\n+\n+        private List<String> names = new ArrayList<>();\n+        private List<String> locales = new ArrayList<>();\n+        private StringBuffer[] outputs;\n+        private EnumSet<Choice> choices;\n+        private EnumSet<Choice> thingsThatRequireOldFile;\n+        private EnumSet<Choice> ourChoicesThatRequireOldFile;\n+        private T organization;\n+        private VettingViewer<T>.FileInfo totals;\n+        private Map<String, VettingViewer<T>.FileInfo> localeNameToFileInfo;\n+        private String header;\n+        private int configParallel; // parallelism. 0 means \"let Java decide\"\n+        private int configChunkSize; // Number of locales to process at once, minimum 1\n+\n+        @SuppressWarnings(\"unchecked\")\n+        public WriteContext(Set<Entry<String, String>> entrySet, EnumSet<Choice> choices, T organization, FileInfo totals, Map<String, VettingViewer<T>.FileInfo> localeNameToFileInfo, String header) {\n+            for(Entry<String, String> e : entrySet) {\n+                names.add(e.getKey());\n+                locales.add(e.getValue());\n+            }\n+            int count = names.size();\n+            this.outputs = new StringBuffer[count];\n+            for(int i=0;i<count;i++) {\n+                outputs[i] = new StringBuffer();\n+            }\n+            if(DEBUG_THREADS) System.err.println(\"Initted \" + this.outputs.length + \" outputs\");\n+\n+            // other data\n+            this.choices = choices;\n+\n+            thingsThatRequireOldFile = EnumSet.of(Choice.englishChanged, Choice.missingCoverage, Choice.changedOldValue);\n+            ourChoicesThatRequireOldFile = choices.clone();\n+            ourChoicesThatRequireOldFile.retainAll(thingsThatRequireOldFile);\n+\n+            this.organization = organization;\n+            this.totals = totals;\n+            this.localeNameToFileInfo = localeNameToFileInfo;\n+            this.header = header;\n+\n+            if(DEBUG_THREADS) System.err.println(\"writeContext for \" + organization.toString() + \" booted with \" + count + \" locales\");\n+\n+            // setup env\n+            CLDRConfig config = CLDRConfig.getInstance();\n+\n+            this.configParallel = Math.max(config.get(\"CLDR_VETTINGVIEWER_PARALLEL\", 0), 0);\n+            if(this.configParallel < 1) {\n+                this.configParallel = java.lang.Runtime.getRuntime().availableProcessors(); // matches ForkJoinPool() behavior\n+            }\n+            this.configChunkSize = Math.max(config.get(\"CLDR_VETTINGVIEWER_CHUNKSIZE\", 1), 1);\n+            System.err.println(\"vv: CLDR_VETTINGVIEWER_PARALLEL=\"+configParallel+\", CLDR_VETTINGVIEWER_CHUNKSIZE=\"+configChunkSize);\n+        }\n+\n+        public void append(Appendable output) throws IOException {\n+            // all done, append all\n+            char lastChar = ' ';\n+\n+            for(int n=0;n<outputs.length;n++) {\n+              final String name = names.get(n);\n+              if(DEBUG_THREADS) System.err.println(\"Appending \" + name + \" - \" + outputs[n].length());\n+              output.append(outputs[n]);\n+\n+              char nextChar = name.charAt(0);\n+              if (lastChar != nextChar) {\n+                  output.append(this.header);\n+                  lastChar = nextChar;\n+              }\n+            }\n+        }\n+\n+        public int size() {\n+            return names.size();\n+        }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "889cf42b05815614e386264e86b48308d329b7e4"}, "originalPosition": 127}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTY0MTMzOQ==", "bodyText": "They are parallel streams? And then they are appended together at the end, including header-inclusion logic.", "url": "https://github.com/unicode-org/cldr/pull/709#discussion_r491641339", "createdAt": "2020-09-20T01:58:20Z", "author": {"login": "srl295"}, "path": "tools/java/org/unicode/cldr/util/VettingViewer.java", "diffHunk": "@@ -805,6 +807,161 @@ public void generateSummaryHtmlErrorTables(Appendable output, EnumSet<Choice> ch\n \n     }\n \n+    private class WriteContext {\n+\n+        private List<String> names = new ArrayList<>();\n+        private List<String> locales = new ArrayList<>();\n+        private StringBuffer[] outputs;\n+        private EnumSet<Choice> choices;\n+        private EnumSet<Choice> thingsThatRequireOldFile;\n+        private EnumSet<Choice> ourChoicesThatRequireOldFile;\n+        private T organization;\n+        private VettingViewer<T>.FileInfo totals;\n+        private Map<String, VettingViewer<T>.FileInfo> localeNameToFileInfo;\n+        private String header;\n+        private int configParallel; // parallelism. 0 means \"let Java decide\"\n+        private int configChunkSize; // Number of locales to process at once, minimum 1\n+\n+        @SuppressWarnings(\"unchecked\")\n+        public WriteContext(Set<Entry<String, String>> entrySet, EnumSet<Choice> choices, T organization, FileInfo totals, Map<String, VettingViewer<T>.FileInfo> localeNameToFileInfo, String header) {\n+            for(Entry<String, String> e : entrySet) {\n+                names.add(e.getKey());\n+                locales.add(e.getValue());\n+            }\n+            int count = names.size();\n+            this.outputs = new StringBuffer[count];\n+            for(int i=0;i<count;i++) {\n+                outputs[i] = new StringBuffer();\n+            }\n+            if(DEBUG_THREADS) System.err.println(\"Initted \" + this.outputs.length + \" outputs\");\n+\n+            // other data\n+            this.choices = choices;\n+\n+            thingsThatRequireOldFile = EnumSet.of(Choice.englishChanged, Choice.missingCoverage, Choice.changedOldValue);\n+            ourChoicesThatRequireOldFile = choices.clone();\n+            ourChoicesThatRequireOldFile.retainAll(thingsThatRequireOldFile);\n+\n+            this.organization = organization;\n+            this.totals = totals;\n+            this.localeNameToFileInfo = localeNameToFileInfo;\n+            this.header = header;\n+\n+            if(DEBUG_THREADS) System.err.println(\"writeContext for \" + organization.toString() + \" booted with \" + count + \" locales\");\n+\n+            // setup env\n+            CLDRConfig config = CLDRConfig.getInstance();\n+\n+            this.configParallel = Math.max(config.get(\"CLDR_VETTINGVIEWER_PARALLEL\", 0), 0);\n+            if(this.configParallel < 1) {\n+                this.configParallel = java.lang.Runtime.getRuntime().availableProcessors(); // matches ForkJoinPool() behavior\n+            }\n+            this.configChunkSize = Math.max(config.get(\"CLDR_VETTINGVIEWER_CHUNKSIZE\", 1), 1);\n+            System.err.println(\"vv: CLDR_VETTINGVIEWER_PARALLEL=\"+configParallel+\", CLDR_VETTINGVIEWER_CHUNKSIZE=\"+configChunkSize);\n+        }\n+\n+        public void append(Appendable output) throws IOException {\n+            // all done, append all\n+            char lastChar = ' ';\n+\n+            for(int n=0;n<outputs.length;n++) {\n+              final String name = names.get(n);\n+              if(DEBUG_THREADS) System.err.println(\"Appending \" + name + \" - \" + outputs[n].length());\n+              output.append(outputs[n]);\n+\n+              char nextChar = name.charAt(0);\n+              if (lastChar != nextChar) {\n+                  output.append(this.header);\n+                  lastChar = nextChar;\n+              }\n+            }\n+        }\n+\n+        public int size() {\n+            return names.size();\n+        }\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODgzMjE4Ng=="}, "originalCommit": {"oid": "889cf42b05815614e386264e86b48308d329b7e4"}, "originalPosition": 127}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjI4MjcwMw==", "bodyText": "streams outputs[0\u2026n] are written in parallel by separate threads, using the ForkJoin mechanism's algorithms for efficient scheduling.  Then, all of the streams are written one after another to the requested output.", "url": "https://github.com/unicode-org/cldr/pull/709#discussion_r492282703", "createdAt": "2020-09-21T19:04:50Z", "author": {"login": "srl295"}, "path": "tools/java/org/unicode/cldr/util/VettingViewer.java", "diffHunk": "@@ -805,6 +807,161 @@ public void generateSummaryHtmlErrorTables(Appendable output, EnumSet<Choice> ch\n \n     }\n \n+    private class WriteContext {\n+\n+        private List<String> names = new ArrayList<>();\n+        private List<String> locales = new ArrayList<>();\n+        private StringBuffer[] outputs;\n+        private EnumSet<Choice> choices;\n+        private EnumSet<Choice> thingsThatRequireOldFile;\n+        private EnumSet<Choice> ourChoicesThatRequireOldFile;\n+        private T organization;\n+        private VettingViewer<T>.FileInfo totals;\n+        private Map<String, VettingViewer<T>.FileInfo> localeNameToFileInfo;\n+        private String header;\n+        private int configParallel; // parallelism. 0 means \"let Java decide\"\n+        private int configChunkSize; // Number of locales to process at once, minimum 1\n+\n+        @SuppressWarnings(\"unchecked\")\n+        public WriteContext(Set<Entry<String, String>> entrySet, EnumSet<Choice> choices, T organization, FileInfo totals, Map<String, VettingViewer<T>.FileInfo> localeNameToFileInfo, String header) {\n+            for(Entry<String, String> e : entrySet) {\n+                names.add(e.getKey());\n+                locales.add(e.getValue());\n+            }\n+            int count = names.size();\n+            this.outputs = new StringBuffer[count];\n+            for(int i=0;i<count;i++) {\n+                outputs[i] = new StringBuffer();\n+            }\n+            if(DEBUG_THREADS) System.err.println(\"Initted \" + this.outputs.length + \" outputs\");\n+\n+            // other data\n+            this.choices = choices;\n+\n+            thingsThatRequireOldFile = EnumSet.of(Choice.englishChanged, Choice.missingCoverage, Choice.changedOldValue);\n+            ourChoicesThatRequireOldFile = choices.clone();\n+            ourChoicesThatRequireOldFile.retainAll(thingsThatRequireOldFile);\n+\n+            this.organization = organization;\n+            this.totals = totals;\n+            this.localeNameToFileInfo = localeNameToFileInfo;\n+            this.header = header;\n+\n+            if(DEBUG_THREADS) System.err.println(\"writeContext for \" + organization.toString() + \" booted with \" + count + \" locales\");\n+\n+            // setup env\n+            CLDRConfig config = CLDRConfig.getInstance();\n+\n+            this.configParallel = Math.max(config.get(\"CLDR_VETTINGVIEWER_PARALLEL\", 0), 0);\n+            if(this.configParallel < 1) {\n+                this.configParallel = java.lang.Runtime.getRuntime().availableProcessors(); // matches ForkJoinPool() behavior\n+            }\n+            this.configChunkSize = Math.max(config.get(\"CLDR_VETTINGVIEWER_CHUNKSIZE\", 1), 1);\n+            System.err.println(\"vv: CLDR_VETTINGVIEWER_PARALLEL=\"+configParallel+\", CLDR_VETTINGVIEWER_CHUNKSIZE=\"+configChunkSize);\n+        }\n+\n+        public void append(Appendable output) throws IOException {\n+            // all done, append all\n+            char lastChar = ' ';\n+\n+            for(int n=0;n<outputs.length;n++) {\n+              final String name = names.get(n);\n+              if(DEBUG_THREADS) System.err.println(\"Appending \" + name + \" - \" + outputs[n].length());\n+              output.append(outputs[n]);\n+\n+              char nextChar = name.charAt(0);\n+              if (lastChar != nextChar) {\n+                  output.append(this.header);\n+                  lastChar = nextChar;\n+              }\n+            }\n+        }\n+\n+        public int size() {\n+            return names.size();\n+        }\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODgzMjE4Ng=="}, "originalCommit": {"oid": "889cf42b05815614e386264e86b48308d329b7e4"}, "originalPosition": 127}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjM2ODE0MA==", "bodyText": "Here is a tutorial on them. https://docs.oracle.com/javase/tutorial/collections/streams/parallelism.html\nThere are a few instances in the unitTests, but we haven't changed older code.", "url": "https://github.com/unicode-org/cldr/pull/709#discussion_r492368140", "createdAt": "2020-09-21T21:55:43Z", "author": {"login": "macchiati"}, "path": "tools/java/org/unicode/cldr/util/VettingViewer.java", "diffHunk": "@@ -805,6 +807,161 @@ public void generateSummaryHtmlErrorTables(Appendable output, EnumSet<Choice> ch\n \n     }\n \n+    private class WriteContext {\n+\n+        private List<String> names = new ArrayList<>();\n+        private List<String> locales = new ArrayList<>();\n+        private StringBuffer[] outputs;\n+        private EnumSet<Choice> choices;\n+        private EnumSet<Choice> thingsThatRequireOldFile;\n+        private EnumSet<Choice> ourChoicesThatRequireOldFile;\n+        private T organization;\n+        private VettingViewer<T>.FileInfo totals;\n+        private Map<String, VettingViewer<T>.FileInfo> localeNameToFileInfo;\n+        private String header;\n+        private int configParallel; // parallelism. 0 means \"let Java decide\"\n+        private int configChunkSize; // Number of locales to process at once, minimum 1\n+\n+        @SuppressWarnings(\"unchecked\")\n+        public WriteContext(Set<Entry<String, String>> entrySet, EnumSet<Choice> choices, T organization, FileInfo totals, Map<String, VettingViewer<T>.FileInfo> localeNameToFileInfo, String header) {\n+            for(Entry<String, String> e : entrySet) {\n+                names.add(e.getKey());\n+                locales.add(e.getValue());\n+            }\n+            int count = names.size();\n+            this.outputs = new StringBuffer[count];\n+            for(int i=0;i<count;i++) {\n+                outputs[i] = new StringBuffer();\n+            }\n+            if(DEBUG_THREADS) System.err.println(\"Initted \" + this.outputs.length + \" outputs\");\n+\n+            // other data\n+            this.choices = choices;\n+\n+            thingsThatRequireOldFile = EnumSet.of(Choice.englishChanged, Choice.missingCoverage, Choice.changedOldValue);\n+            ourChoicesThatRequireOldFile = choices.clone();\n+            ourChoicesThatRequireOldFile.retainAll(thingsThatRequireOldFile);\n+\n+            this.organization = organization;\n+            this.totals = totals;\n+            this.localeNameToFileInfo = localeNameToFileInfo;\n+            this.header = header;\n+\n+            if(DEBUG_THREADS) System.err.println(\"writeContext for \" + organization.toString() + \" booted with \" + count + \" locales\");\n+\n+            // setup env\n+            CLDRConfig config = CLDRConfig.getInstance();\n+\n+            this.configParallel = Math.max(config.get(\"CLDR_VETTINGVIEWER_PARALLEL\", 0), 0);\n+            if(this.configParallel < 1) {\n+                this.configParallel = java.lang.Runtime.getRuntime().availableProcessors(); // matches ForkJoinPool() behavior\n+            }\n+            this.configChunkSize = Math.max(config.get(\"CLDR_VETTINGVIEWER_CHUNKSIZE\", 1), 1);\n+            System.err.println(\"vv: CLDR_VETTINGVIEWER_PARALLEL=\"+configParallel+\", CLDR_VETTINGVIEWER_CHUNKSIZE=\"+configChunkSize);\n+        }\n+\n+        public void append(Appendable output) throws IOException {\n+            // all done, append all\n+            char lastChar = ' ';\n+\n+            for(int n=0;n<outputs.length;n++) {\n+              final String name = names.get(n);\n+              if(DEBUG_THREADS) System.err.println(\"Appending \" + name + \" - \" + outputs[n].length());\n+              output.append(outputs[n]);\n+\n+              char nextChar = name.charAt(0);\n+              if (lastChar != nextChar) {\n+                  output.append(this.header);\n+                  lastChar = nextChar;\n+              }\n+            }\n+        }\n+\n+        public int size() {\n+            return names.size();\n+        }\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODgzMjE4Ng=="}, "originalCommit": {"oid": "889cf42b05815614e386264e86b48308d329b7e4"}, "originalPosition": 127}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjM4NzU4Mw==", "bodyText": "OK, that's a different use of 'parallel stream' but, I think it's worth looking into.", "url": "https://github.com/unicode-org/cldr/pull/709#discussion_r492387583", "createdAt": "2020-09-21T22:44:53Z", "author": {"login": "srl295"}, "path": "tools/java/org/unicode/cldr/util/VettingViewer.java", "diffHunk": "@@ -805,6 +807,161 @@ public void generateSummaryHtmlErrorTables(Appendable output, EnumSet<Choice> ch\n \n     }\n \n+    private class WriteContext {\n+\n+        private List<String> names = new ArrayList<>();\n+        private List<String> locales = new ArrayList<>();\n+        private StringBuffer[] outputs;\n+        private EnumSet<Choice> choices;\n+        private EnumSet<Choice> thingsThatRequireOldFile;\n+        private EnumSet<Choice> ourChoicesThatRequireOldFile;\n+        private T organization;\n+        private VettingViewer<T>.FileInfo totals;\n+        private Map<String, VettingViewer<T>.FileInfo> localeNameToFileInfo;\n+        private String header;\n+        private int configParallel; // parallelism. 0 means \"let Java decide\"\n+        private int configChunkSize; // Number of locales to process at once, minimum 1\n+\n+        @SuppressWarnings(\"unchecked\")\n+        public WriteContext(Set<Entry<String, String>> entrySet, EnumSet<Choice> choices, T organization, FileInfo totals, Map<String, VettingViewer<T>.FileInfo> localeNameToFileInfo, String header) {\n+            for(Entry<String, String> e : entrySet) {\n+                names.add(e.getKey());\n+                locales.add(e.getValue());\n+            }\n+            int count = names.size();\n+            this.outputs = new StringBuffer[count];\n+            for(int i=0;i<count;i++) {\n+                outputs[i] = new StringBuffer();\n+            }\n+            if(DEBUG_THREADS) System.err.println(\"Initted \" + this.outputs.length + \" outputs\");\n+\n+            // other data\n+            this.choices = choices;\n+\n+            thingsThatRequireOldFile = EnumSet.of(Choice.englishChanged, Choice.missingCoverage, Choice.changedOldValue);\n+            ourChoicesThatRequireOldFile = choices.clone();\n+            ourChoicesThatRequireOldFile.retainAll(thingsThatRequireOldFile);\n+\n+            this.organization = organization;\n+            this.totals = totals;\n+            this.localeNameToFileInfo = localeNameToFileInfo;\n+            this.header = header;\n+\n+            if(DEBUG_THREADS) System.err.println(\"writeContext for \" + organization.toString() + \" booted with \" + count + \" locales\");\n+\n+            // setup env\n+            CLDRConfig config = CLDRConfig.getInstance();\n+\n+            this.configParallel = Math.max(config.get(\"CLDR_VETTINGVIEWER_PARALLEL\", 0), 0);\n+            if(this.configParallel < 1) {\n+                this.configParallel = java.lang.Runtime.getRuntime().availableProcessors(); // matches ForkJoinPool() behavior\n+            }\n+            this.configChunkSize = Math.max(config.get(\"CLDR_VETTINGVIEWER_CHUNKSIZE\", 1), 1);\n+            System.err.println(\"vv: CLDR_VETTINGVIEWER_PARALLEL=\"+configParallel+\", CLDR_VETTINGVIEWER_CHUNKSIZE=\"+configChunkSize);\n+        }\n+\n+        public void append(Appendable output) throws IOException {\n+            // all done, append all\n+            char lastChar = ' ';\n+\n+            for(int n=0;n<outputs.length;n++) {\n+              final String name = names.get(n);\n+              if(DEBUG_THREADS) System.err.println(\"Appending \" + name + \" - \" + outputs[n].length());\n+              output.append(outputs[n]);\n+\n+              char nextChar = name.charAt(0);\n+              if (lastChar != nextChar) {\n+                  output.append(this.header);\n+                  lastChar = nextChar;\n+              }\n+            }\n+        }\n+\n+        public int size() {\n+            return names.size();\n+        }\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODgzMjE4Ng=="}, "originalCommit": {"oid": "889cf42b05815614e386264e86b48308d329b7e4"}, "originalPosition": 127}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA1ODYzNDYxOnYy", "diffSide": "RIGHT", "path": "tools/java/org/unicode/cldr/util/VettingViewer.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxNzoyNDo0NlrOHSMRiw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxNzoyNDo0NlrOHSMRiw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODgzNzUxNQ==", "bodyText": "This name is misleading. It is appending this to output, rather than the reverse, so should be appendto.", "url": "https://github.com/unicode-org/cldr/pull/709#discussion_r488837515", "createdAt": "2020-09-15T17:24:46Z", "author": {"login": "macchiati"}, "path": "tools/java/org/unicode/cldr/util/VettingViewer.java", "diffHunk": "@@ -805,6 +807,161 @@ public void generateSummaryHtmlErrorTables(Appendable output, EnumSet<Choice> ch\n \n     }\n \n+    private class WriteContext {\n+\n+        private List<String> names = new ArrayList<>();\n+        private List<String> locales = new ArrayList<>();\n+        private StringBuffer[] outputs;\n+        private EnumSet<Choice> choices;\n+        private EnumSet<Choice> thingsThatRequireOldFile;\n+        private EnumSet<Choice> ourChoicesThatRequireOldFile;\n+        private T organization;\n+        private VettingViewer<T>.FileInfo totals;\n+        private Map<String, VettingViewer<T>.FileInfo> localeNameToFileInfo;\n+        private String header;\n+        private int configParallel; // parallelism. 0 means \"let Java decide\"\n+        private int configChunkSize; // Number of locales to process at once, minimum 1\n+\n+        @SuppressWarnings(\"unchecked\")\n+        public WriteContext(Set<Entry<String, String>> entrySet, EnumSet<Choice> choices, T organization, FileInfo totals, Map<String, VettingViewer<T>.FileInfo> localeNameToFileInfo, String header) {\n+            for(Entry<String, String> e : entrySet) {\n+                names.add(e.getKey());\n+                locales.add(e.getValue());\n+            }\n+            int count = names.size();\n+            this.outputs = new StringBuffer[count];\n+            for(int i=0;i<count;i++) {\n+                outputs[i] = new StringBuffer();\n+            }\n+            if(DEBUG_THREADS) System.err.println(\"Initted \" + this.outputs.length + \" outputs\");\n+\n+            // other data\n+            this.choices = choices;\n+\n+            thingsThatRequireOldFile = EnumSet.of(Choice.englishChanged, Choice.missingCoverage, Choice.changedOldValue);\n+            ourChoicesThatRequireOldFile = choices.clone();\n+            ourChoicesThatRequireOldFile.retainAll(thingsThatRequireOldFile);\n+\n+            this.organization = organization;\n+            this.totals = totals;\n+            this.localeNameToFileInfo = localeNameToFileInfo;\n+            this.header = header;\n+\n+            if(DEBUG_THREADS) System.err.println(\"writeContext for \" + organization.toString() + \" booted with \" + count + \" locales\");\n+\n+            // setup env\n+            CLDRConfig config = CLDRConfig.getInstance();\n+\n+            this.configParallel = Math.max(config.get(\"CLDR_VETTINGVIEWER_PARALLEL\", 0), 0);\n+            if(this.configParallel < 1) {\n+                this.configParallel = java.lang.Runtime.getRuntime().availableProcessors(); // matches ForkJoinPool() behavior\n+            }\n+            this.configChunkSize = Math.max(config.get(\"CLDR_VETTINGVIEWER_CHUNKSIZE\", 1), 1);\n+            System.err.println(\"vv: CLDR_VETTINGVIEWER_PARALLEL=\"+configParallel+\", CLDR_VETTINGVIEWER_CHUNKSIZE=\"+configChunkSize);\n+        }\n+\n+        public void append(Appendable output) throws IOException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "889cf42b05815614e386264e86b48308d329b7e4"}, "originalPosition": 107}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA1ODY0MjExOnYy", "diffSide": "RIGHT", "path": "tools/java/org/unicode/cldr/util/VettingViewer.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxNzoyNjozOVrOHSMWcQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQxNzoyNjozOVrOHSMWcQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODgzODc2OQ==", "bodyText": "I'm guessing these are localeNames and localeIds\nI know our code has lots of bad names, but for new code we should be clearer.", "url": "https://github.com/unicode-org/cldr/pull/709#discussion_r488838769", "createdAt": "2020-09-15T17:26:39Z", "author": {"login": "macchiati"}, "path": "tools/java/org/unicode/cldr/util/VettingViewer.java", "diffHunk": "@@ -805,6 +807,161 @@ public void generateSummaryHtmlErrorTables(Appendable output, EnumSet<Choice> ch\n \n     }\n \n+    private class WriteContext {\n+\n+        private List<String> names = new ArrayList<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "889cf42b05815614e386264e86b48308d329b7e4"}, "originalPosition": 56}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 381, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}