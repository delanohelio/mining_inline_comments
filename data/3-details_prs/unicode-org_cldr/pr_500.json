{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI2Mjk2NjM1", "number": 500, "title": "CLDR-13654 units: add consistency examples and checks, and ability to generate compound names to that end.", "bodyText": "Checklist\n\n Issue filed: https://unicode-org.atlassian.net/browse/CLDR-13654\n Updated PR title and link in previous line to include Issue number", "createdAt": "2020-06-02T01:28:07Z", "url": "https://github.com/unicode-org/cldr/pull/500", "merged": true, "mergeCommit": {"oid": "e0533d409dabc078fb4f6dc947f96d408354a6da"}, "closed": true, "closedAt": "2020-06-09T03:32:31Z", "author": {"login": "macchiati"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcoVZZcABqjM0MTIxODMzOTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcpb8t6AFqTQyNjc1MzYyNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "76879b853d70827abd56fb4b2d282201b6e89179", "author": {"user": {"login": "macchiati", "name": "Mark Davis"}}, "url": "https://github.com/unicode-org/cldr/commit/76879b853d70827abd56fb4b2d282201b6e89179", "committedDate": "2020-06-05T16:37:30Z", "message": "Merge branch 'master' into CLDR-13654-Enhance-examples-for-units"}, "afterCommit": {"oid": "090c5ba71c31ba37f61b194a80177bc6cc6d8c36", "author": {"user": {"login": "macchiati", "name": "Mark Davis"}}, "url": "https://github.com/unicode-org/cldr/commit/090c5ba71c31ba37f61b194a80177bc6cc6d8c36", "committedDate": "2020-06-05T16:38:46Z", "message": "CLDR-13654 Add examples and checks\n\nSee #500"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "090c5ba71c31ba37f61b194a80177bc6cc6d8c36", "author": {"user": {"login": "macchiati", "name": "Mark Davis"}}, "url": "https://github.com/unicode-org/cldr/commit/090c5ba71c31ba37f61b194a80177bc6cc6d8c36", "committedDate": "2020-06-05T16:38:46Z", "message": "CLDR-13654 Add examples and checks\n\nSee #500"}, "afterCommit": {"oid": "1a25e7509bb6a6cc8c5f52aec8bac0cb7203f56c", "author": {"user": {"login": "macchiati", "name": "Mark Davis"}}, "url": "https://github.com/unicode-org/cldr/commit/1a25e7509bb6a6cc8c5f52aec8bac0cb7203f56c", "committedDate": "2020-06-05T22:44:08Z", "message": "CLDR-13654 merging changes from master\n\n# Conflicts:\n#\ttools/java/org/unicode/cldr/test/CheckUnits.java\n#\ttools/java/org/unicode/cldr/util/CLDRFile.java\n#\ttools/java/org/unicode/cldr/util/GrammarInfo.java\n#\ttools/java/org/unicode/cldr/util/UnitConverter.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "51dacbf87ba8b578de2ed28fd6f3aa7d6517927d", "author": {"user": {"login": "macchiati", "name": "Mark Davis"}}, "url": "https://github.com/unicode-org/cldr/commit/51dacbf87ba8b578de2ed28fd6f3aa7d6517927d", "committedDate": "2020-06-07T01:01:09Z", "message": "CLDR-13654 units: add consistency examples and checks, and ability to generate compound names to that end.\n\nSee #500"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "81b8240041dc2818289d40c2b72762fbefb5c548", "author": {"user": {"login": "macchiati", "name": "Mark Davis"}}, "url": "https://github.com/unicode-org/cldr/commit/81b8240041dc2818289d40c2b72762fbefb5c548", "committedDate": "2020-06-07T00:58:42Z", "message": "CLDR-13654 Adjustments for code formatting; cleaned up code; fixed problems with tests."}, "afterCommit": {"oid": "51dacbf87ba8b578de2ed28fd6f3aa7d6517927d", "author": {"user": {"login": "macchiati", "name": "Mark Davis"}}, "url": "https://github.com/unicode-org/cldr/commit/51dacbf87ba8b578de2ed28fd6f3aa7d6517927d", "committedDate": "2020-06-07T01:01:09Z", "message": "CLDR-13654 units: add consistency examples and checks, and ability to generate compound names to that end.\n\nSee #500"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "77b7bc2e7f588bd162b2960e06e51c5a2d207d0d", "author": {"user": {"login": "macchiati", "name": "Mark Davis"}}, "url": "https://github.com/unicode-org/cldr/commit/77b7bc2e7f588bd162b2960e06e51c5a2d207d0d", "committedDate": "2020-06-07T04:06:45Z", "message": "CLDR-13654 Skip unusual pattern in Ewe"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2NjgyOTUw", "url": "https://github.com/unicode-org/cldr/pull/500#pullrequestreview-426682950", "createdAt": "2020-06-08T23:12:27Z", "commit": {"oid": "77b7bc2e7f588bd162b2960e06e51c5a2d207d0d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQyMzoxMjoyN1rOGgzdjw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQyMzoxMjoyN1rOGgzdjw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzA1MDc2Nw==", "bodyText": "There are units that do not follow those 3 types, for example in Korean:\n    <unit type=\"concentr-milligram-per-deciliter\">\n        <displayName>\ub370\uc2dc\ub9ac\ud130\ub2f9 \ubc00\ub9ac\uadf8\ub7a8</displayName>\n        <unitPattern count=\"other\">\ub370\uc2dc\ub9ac\ud130\ub2f9 {0}\ubc00\ub9ac\uadf8\ub7a8</unitPattern>\n    </unit>\n\nWill that be an issue here (since it is for per patterns)?", "url": "https://github.com/unicode-org/cldr/pull/500#discussion_r437050767", "createdAt": "2020-06-08T23:12:27Z", "author": {"login": "pedberg-icu"}, "path": "tools/java/org/unicode/cldr/util/UnitConverter.java", "diffHunk": "@@ -646,6 +727,175 @@ public String toString() {\n             }\n             return builder.toString();\n         }\n+\n+        public String toString(LocaleStringProvider resolvedFile, String width, String _pluralCategory, String caseVariant, Multimap<UnitPathType, String> partsUsed, boolean maximal) {\n+            if (partsUsed != null) {\n+                partsUsed.clear();\n+            }\n+            String result = null;\n+            String numerator = null;\n+            String timesPattern = null;\n+            boolean before = false;\n+            String placeholderPattern = null;\n+            Output<Integer> deprefix = new Output<>();\n+            Matcher placeholderMatcher = PLACEHOLDER.matcher(\"\");\n+            PluralInfo pluralInfo = CLDRConfig.getInstance().getSupplementalDataInfo().getPlurals(resolvedFile.getLocaleID());\n+            PluralRules pluralRules = pluralInfo.getPluralRules();\n+            String singularPluralCategory = pluralRules.select(1d);\n+            final ULocale locale = new ULocale(resolvedFile.getLocaleID());\n+            String fullPerPattern = null;\n+            int negCount = 0;\n+\n+            for (int i = 1; i >= 0; --i) { // two passes, numerator then den.\n+                boolean positivePass = i > 0;\n+                if (!positivePass) {\n+                    switch(locale.toString()) {\n+                    case \"de\": caseVariant = \"accusative\"; break; // German pro rule\n+                    }\n+                    numerator = result; // from now on, result ::= denominator\n+                    result = null;\n+                }\n+\n+                Map<String, Integer> target = positivePass ? numUnitsToPowers : denUnitsToPowers;\n+                int unitsLeft = target.size();\n+                for (Entry<String, Integer> entry : target.entrySet()) {\n+                    String possiblyPrefixedUnit = entry.getKey();\n+                    String unit = stripPrefixInt(possiblyPrefixedUnit, deprefix);\n+                    String genderVariant = UnitPathType.gender.getTrans(resolvedFile, \"long\", unit, null, null, null, partsUsed);\n+\n+                    int power = entry.getValue();\n+                    unitsLeft--;\n+                    String pluralCategory = unitsLeft == 0 && positivePass ? _pluralCategory : singularPluralCategory;\n+\n+                    if (!positivePass) {\n+                        if (maximal && 0 == negCount++) { // special case exact match for per form, and no previous result\n+                            if (true) {\n+                                throw new UnsupportedOperationException(\"not yet implemented fully\");\n+                            }\n+                            String fullUnit;\n+                            switch(power) {\n+                            case 1: fullUnit = unit; break;\n+                            case 2: fullUnit = \"square-\" + unit; break;\n+                            case 3: fullUnit = \"cubic-\" + unit; break;\n+                            default: throw new IllegalArgumentException(\"powers > 3 not supported\");\n+                            }\n+                            fullPerPattern = UnitPathType.perUnit.getTrans(resolvedFile, width, fullUnit, _pluralCategory, caseVariant, genderVariant, partsUsed);\n+                            // if there is a special form, we'll use it\n+                            if (fullPerPattern != null) {\n+                                continue;\n+                            }\n+                        }\n+                    }\n+\n+                    // handle prefix, like kilo-\n+                    String prefixPattern = null;\n+                    if (deprefix.value != 1) {\n+                        prefixPattern = UnitPathType.prefix.getTrans(resolvedFile, width, \"10p\" + deprefix.value, _pluralCategory, caseVariant, genderVariant, partsUsed);\n+                    }\n+\n+                    // get the core pattern. Detect and remove the the placeholder (and surrounding spaces)\n+                    String unitPattern = UnitPathType.unit.getTrans(resolvedFile, width, unit, pluralCategory, caseVariant, genderVariant, partsUsed);\n+                    if (unitPattern == null) {\n+                        return null; // unavailable\n+                    }\n+                    // we are set up for 2 kinds of placeholder patterns for units. {0}\\s?stuff or stuff\\s?{0}, or nothing(Eg Arabic)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "77b7bc2e7f588bd162b2960e06e51c5a2d207d0d"}, "originalPosition": 296}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2NzUzNjI2", "url": "https://github.com/unicode-org/cldr/pull/500#pullrequestreview-426753626", "createdAt": "2020-06-09T02:50:44Z", "commit": {"oid": "77b7bc2e7f588bd162b2960e06e51c5a2d207d0d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2080, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}