{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ3MjEzOTUw", "number": 559, "reviewThreads": {"totalCount": 21, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQyMzo0NzozMFrOENcenw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQwMDozMDo1NlrOEODaSw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyNTMzNTM1OnYy", "diffSide": "RIGHT", "path": "tools/cldr-unittest/src/org/unicode/cldr/unittest/TestCoverageLevel.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQyMzo0NzozMFrOGwIe8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQyMzo0NzozMFrOGwIe8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzEyMzgyNg==", "bodyText": "Some changes are just Eclipse fixing formatting. Recommend Hide whitespace differences in Gear menu.", "url": "https://github.com/unicode-org/cldr/pull/559#discussion_r453123826", "createdAt": "2020-07-10T23:47:30Z", "author": {"login": "macchiati"}, "path": "tools/cldr-unittest/src/org/unicode/cldr/unittest/TestCoverageLevel.java", "diffHunk": "@@ -88,7 +93,7 @@ public void oldTestInvariantPaths() {\n         SupplementalDataInfo sdi = SupplementalDataInfo\n             .getInstance(CLDRPaths.DEFAULT_SUPPLEMENTAL_DIRECTORY);\n \n-        Set<String> allPaths = new HashSet<String>();\n+        Set<String> allPaths = new HashSet<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "17ecb09422c589e97d52c58c01a48f187804deb8"}, "originalPosition": 36}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyNTMzNjQ1OnYy", "diffSide": "RIGHT", "path": "tools/cldr-unittest/src/org/unicode/cldr/unittest/TestCoverageLevel.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQyMzo0ODoxMVrOGwIfgw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQyMzo0ODoxMVrOGwIfgw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzEyMzk3MQ==", "bodyText": "Add some explicit tests for logical groups, to make sure we have all and only the right paths.", "url": "https://github.com/unicode-org/cldr/pull/559#discussion_r453123971", "createdAt": "2020-07-10T23:48:11Z", "author": {"login": "macchiati"}, "path": "tools/cldr-unittest/src/org/unicode/cldr/unittest/TestCoverageLevel.java", "diffHunk": "@@ -664,4 +669,55 @@ private void checkBreakingLogicalGrouping(String localeId) {\n             ++count;\n         }\n     }\n+\n+    public void testLogicalGroupingSamples() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "17ecb09422c589e97d52c58c01a48f187804deb8"}, "originalPosition": 118}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyNTMzNjc4OnYy", "diffSide": "RIGHT", "path": "tools/cldr-unittest/src/org/unicode/cldr/unittest/TestCoverageLevel.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQyMzo0ODoyNlrOGwIfqw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQyMzo0ODoyNlrOGwIfqw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzEyNDAxMQ==", "bodyText": "Utility for comparison", "url": "https://github.com/unicode-org/cldr/pull/559#discussion_r453124011", "createdAt": "2020-07-10T23:48:26Z", "author": {"login": "macchiati"}, "path": "tools/cldr-unittest/src/org/unicode/cldr/unittest/TestCoverageLevel.java", "diffHunk": "@@ -664,4 +669,55 @@ private void checkBreakingLogicalGrouping(String localeId) {\n             ++count;\n         }\n     }\n+\n+    public void testLogicalGroupingSamples() {\n+        System.out.println(GrammarInfo.SEED_LOCALES);\n+        String[][] test = {\n+            {\"de\",\n+                \"//ldml/units/unitLength[@type=\\\"long\\\"]/unit[@type=\\\"area-square-kilometer\\\"]/unitPattern[@count=\\\"one\\\"][@case=\\\"accusative\\\"]\",\n+                \"//ldml/units/unitLength[@type=\\\"long\\\"]/unit[@type=\\\"area-square-kilometer\\\"]/unitPattern[@count=\\\"one\\\"][@case=\\\"dative\\\"]\",\n+                \"//ldml/units/unitLength[@type=\\\"long\\\"]/unit[@type=\\\"area-square-kilometer\\\"]/unitPattern[@count=\\\"one\\\"][@case=\\\"genitive\\\"]\",\n+                \"//ldml/units/unitLength[@type=\\\"long\\\"]/unit[@type=\\\"area-square-kilometer\\\"]/unitPattern[@count=\\\"one\\\"]\",\n+                \"//ldml/units/unitLength[@type=\\\"long\\\"]/unit[@type=\\\"area-square-kilometer\\\"]/unitPattern[@count=\\\"other\\\"][@case=\\\"accusative\\\"]\",\n+                \"//ldml/units/unitLength[@type=\\\"long\\\"]/unit[@type=\\\"area-square-kilometer\\\"]/unitPattern[@count=\\\"other\\\"][@case=\\\"dative\\\"]\",\n+                \"//ldml/units/unitLength[@type=\\\"long\\\"]/unit[@type=\\\"area-square-kilometer\\\"]/unitPattern[@count=\\\"other\\\"][@case=\\\"genitive\\\"]\",\n+                \"//ldml/units/unitLength[@type=\\\"long\\\"]/unit[@type=\\\"area-square-kilometer\\\"]/unitPattern[@count=\\\"other\\\"]\",\n+            },\n+            {\"fr\",\n+                \"//ldml/units/unitLength[@type=\\\"long\\\"]/compoundUnit[@type=\\\"power2\\\"]/compoundUnitPattern1[@count=\\\"one\\\"]\",\n+                \"//ldml/units/unitLength[@type=\\\"long\\\"]/compoundUnit[@type=\\\"power2\\\"]/compoundUnitPattern1[@count=\\\"one\\\"][@gender=\\\"feminine\\\"]\",\n+                \"//ldml/units/unitLength[@type=\\\"long\\\"]/compoundUnit[@type=\\\"power2\\\"]/compoundUnitPattern1[@count=\\\"other\\\"]\",\n+                \"//ldml/units/unitLength[@type=\\\"long\\\"]/compoundUnit[@type=\\\"power2\\\"]/compoundUnitPattern1[@count=\\\"other\\\"][@gender=\\\"feminine\\\"]\",\n+            }\n+        };\n+        for (String[] row : test) {\n+            String locale = row[0];\n+            CLDRFile cldrFile = testInfo.getCldrFactory().make(locale, true);\n+            List<String> paths = Arrays.asList(row);\n+            paths = paths.subList(1, paths.size());\n+            Set<String> expected = new TreeSet<>(paths);\n+            Set<Multimap<String, String>> seen = new LinkedHashSet<>();\n+            for (String path : expected) {\n+                Set<String> grouping = new TreeSet<>(LogicalGrouping.getPaths(cldrFile, path));\n+                final Multimap<String, String> deltaValue = delta(expected, grouping);\n+                if (seen.add(deltaValue)) {\n+                    assertEquals(\"Logical group for \" + path, ImmutableListMultimap.of(), deltaValue);\n+                }\n+            }\n+        }\n+    }\n+\n+    private Multimap<String,String> delta(Set<String> expected, Set<String> grouping) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "17ecb09422c589e97d52c58c01a48f187804deb8"}, "originalPosition": 155}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyNTMzNzA2OnYy", "diffSide": "RIGHT", "path": "tools/java/org/unicode/cldr/test/CheckCLDR.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQyMzo0ODo0MlrOGwIf3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQyMzo0ODo0MlrOGwIf3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzEyNDA2MQ==", "bodyText": "New subtype, used for warnings.", "url": "https://github.com/unicode-org/cldr/pull/559#discussion_r453124061", "createdAt": "2020-07-10T23:48:42Z", "author": {"login": "macchiati"}, "path": "tools/java/org/unicode/cldr/test/CheckCLDR.java", "diffHunk": "@@ -717,7 +717,7 @@ public CheckCLDR setCldrFileToCheck(CLDRFile cldrFileToCheck, Options options,\n             invalidPlaceHolder, asciiQuotesNotAllowed, badMinimumGroupingDigits, inconsistentPeriods,\n             inheritanceMarkerNotAllowed, invalidDurationUnitPattern, invalidDelimiter, illegalCharactersInPattern,\n             badParseLenient, tooManyValues, invalidSymbol, invalidGenderCode,\n-            mismatchedUnitComponent, longPowerWithSubscripts\n+            mismatchedUnitComponent, longPowerWithSubscripts, largerDifferences", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "17ecb09422c589e97d52c58c01a48f187804deb8"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyNTMzODAzOnYy", "diffSide": "RIGHT", "path": "tools/java/org/unicode/cldr/test/CheckLogicalGroupings.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQyMzo0OTozM1rOGwIgdQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQyMzo0OTozM1rOGwIgdQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzEyNDIxMw==", "bodyText": "add new test for count, count+case, and count+case+gender. Produces warning.", "url": "https://github.com/unicode-org/cldr/pull/559#discussion_r453124213", "createdAt": "2020-07-10T23:49:33Z", "author": {"login": "macchiati"}, "path": "tools/java/org/unicode/cldr/test/CheckLogicalGroupings.java", "diffHunk": "@@ -88,10 +103,33 @@ public CheckCLDR handleCheck(String path, String fullPath, String value, Options\n             return this;\n         }\n \n-        Set<String> paths = LogicalGrouping.getPaths(getCldrFileToCheck(), path);\n+        Output<PathType> pathType = new Output<>();\n+        Set<String> paths = LogicalGrouping.getPaths(getCldrFileToCheck(), path, pathType);\n         if (paths == null || paths.size() < 2) return this; // skip if not part of a logical grouping\n \n-        // TODO\n+        // check the edit distances for count, gender, case", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "17ecb09422c589e97d52c58c01a48f187804deb8"}, "originalPosition": 50}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyNTMzOTAyOnYy", "diffSide": "RIGHT", "path": "tools/java/org/unicode/cldr/test/CheckLogicalGroupings.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQyMzo1MDowMVrOGwIg8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQyMzo1MDowMVrOGwIg8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzEyNDMzNg==", "bodyText": "Utility for making sure we can see invisible differences.", "url": "https://github.com/unicode-org/cldr/pull/559#discussion_r453124336", "createdAt": "2020-07-10T23:50:01Z", "author": {"login": "macchiati"}, "path": "tools/java/org/unicode/cldr/test/CheckLogicalGroupings.java", "diffHunk": "@@ -205,4 +244,108 @@ public CheckCLDR handleCheck(String path, String fullPath, String value, Options\n         }\n         return this;\n     }\n+\n+    static final Transliterator SHOW_INVISIBLES = Transliterator.createFromRules(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "17ecb09422c589e97d52c58c01a48f187804deb8"}, "originalPosition": 89}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyNTMzOTY2OnYy", "diffSide": "RIGHT", "path": "tools/java/org/unicode/cldr/test/CheckLogicalGroupings.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQyMzo1MDozMVrOGwIhSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQyMzo1MDozMVrOGwIhSg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzEyNDQyNg==", "bodyText": "Get the maximum difference among members of a logical group.", "url": "https://github.com/unicode-org/cldr/pull/559#discussion_r453124426", "createdAt": "2020-07-10T23:50:31Z", "author": {"login": "macchiati"}, "path": "tools/java/org/unicode/cldr/test/CheckLogicalGroupings.java", "diffHunk": "@@ -205,4 +244,108 @@ public CheckCLDR handleCheck(String path, String fullPath, String value, Options\n         }\n         return this;\n     }\n+\n+    static final Transliterator SHOW_INVISIBLES = Transliterator.createFromRules(\n+        \"show\",\n+        \"([[:C:][:Z:][:whitespace:][:Default_Ignorable_Code_Point:]-[\\\\u0020]]) > &hex/perl($1);\",\n+        Transliterator.FORWARD);\n+\n+    public static String showInvisibles(String value) {\n+        return SHOW_INVISIBLES.transform(value);\n+    }\n+\n+    public static String showInvisibles(int codePoint) {\n+        return showInvisibles(With.fromCodePoint(codePoint));\n+    }\n+\n+    public static String showInvisibles(Multiset<?> codePointCounts) {\n+        StringBuilder b = new StringBuilder().append('{');\n+        for (Entry<?> entry : codePointCounts.entrySet()) {\n+            if (b.length() > 1) {\n+                b.append(\", \");\n+            }\n+            Object element = entry.getElement();\n+            b.append(element instanceof Integer ? showInvisibles((int) element) : showInvisibles(element.toString()));\n+            if (entry.getCount() > 1) {\n+                b.append('\u2a31').append(entry.getCount());\n+            }\n+        }\n+        return b.append('}').toString();\n+    }\n+\n+    private int getMaxDistance(String path, String value, Set<String> paths, Multiset<String> values) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "17ecb09422c589e97d52c58c01a48f187804deb8"}, "originalPosition": 117}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyNTM0MDgwOnYy", "diffSide": "RIGHT", "path": "tools/java/org/unicode/cldr/test/CheckLogicalGroupings.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQyMzo1MTozMVrOGwIh-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQyMzo1MTozMVrOGwIh-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzEyNDYwMQ==", "bodyText": "Fingerprint is a measure of a value's characters. Currently just a Multiset with counts for characters; later it could be more sophisticated.", "url": "https://github.com/unicode-org/cldr/pull/559#discussion_r453124601", "createdAt": "2020-07-10T23:51:31Z", "author": {"login": "macchiati"}, "path": "tools/java/org/unicode/cldr/test/CheckLogicalGroupings.java", "diffHunk": "@@ -205,4 +244,108 @@ public CheckCLDR handleCheck(String path, String fullPath, String value, Options\n         }\n         return this;\n     }\n+\n+    static final Transliterator SHOW_INVISIBLES = Transliterator.createFromRules(\n+        \"show\",\n+        \"([[:C:][:Z:][:whitespace:][:Default_Ignorable_Code_Point:]-[\\\\u0020]]) > &hex/perl($1);\",\n+        Transliterator.FORWARD);\n+\n+    public static String showInvisibles(String value) {\n+        return SHOW_INVISIBLES.transform(value);\n+    }\n+\n+    public static String showInvisibles(int codePoint) {\n+        return showInvisibles(With.fromCodePoint(codePoint));\n+    }\n+\n+    public static String showInvisibles(Multiset<?> codePointCounts) {\n+        StringBuilder b = new StringBuilder().append('{');\n+        for (Entry<?> entry : codePointCounts.entrySet()) {\n+            if (b.length() > 1) {\n+                b.append(\", \");\n+            }\n+            Object element = entry.getElement();\n+            b.append(element instanceof Integer ? showInvisibles((int) element) : showInvisibles(element.toString()));\n+            if (entry.getCount() > 1) {\n+                b.append('\u2a31').append(entry.getCount());\n+            }\n+        }\n+        return b.append('}').toString();\n+    }\n+\n+    private int getMaxDistance(String path, String value, Set<String> paths, Multiset<String> values) {\n+        values.clear();\n+        final CLDRFile cldrFileToCheck = getCldrFileToCheck();\n+        Set<Fingerprint> fingerprints = new HashSet<>();\n+        for (String path1 : paths) {\n+            final String pathValue = cleanSpaces(path.contentEquals(path1) ? value : cldrFileToCheck.getWinningValue(path1));\n+            values.add(pathValue);\n+            fingerprints.add(Fingerprint.make(pathValue));\n+        }\n+        return Fingerprint.maxDistanceBetween(fingerprints);\n+    }\n+\n+    private static final UnicodeMap<String> OTHER_SPACES = new UnicodeMap<String>().putAll(new UnicodeSet(\"[[:Z:][:S:][:whitespace:]]\"), \" \").freeze();\n+    public static String cleanSpaces(String pathValue) {\n+        return OTHER_SPACES.transform(pathValue);\n+    }\n+\n+    // Later\n+    private static ConcurrentHashMap<String, Fingerprint> FINGERPRINT_CACHE = new ConcurrentHashMap<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "17ecb09422c589e97d52c58c01a48f187804deb8"}, "originalPosition": 135}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyNTM0MTQ0OnYy", "diffSide": "RIGHT", "path": "tools/java/org/unicode/cldr/test/ConsoleCheckCLDR.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQyMzo1MjowNlrOGwIiVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQyMzo1MjowNlrOGwIiVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzEyNDY5Mw==", "bodyText": "Use a path link so we can link directly from a spreadsheet view.", "url": "https://github.com/unicode-org/cldr/pull/559#discussion_r453124693", "createdAt": "2020-07-10T23:52:06Z", "author": {"login": "macchiati"}, "path": "tools/java/org/unicode/cldr/test/ConsoleCheckCLDR.java", "diffHunk": "@@ -1558,7 +1562,7 @@ private static void showValue(CLDRFile cldrFile, String prettyPath, String local\n                     + \"\\t\u3010\" + example + \"\u3011\"\n                     + \"\\t\u2045\" + subType + \"\u2046\"\n                     + \"\\t\u276e\" + statusString + \"\u276f\"\n-                    + \"\\t\" + fullPath\n+                    + \"\\t\" + pathLink", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "17ecb09422c589e97d52c58c01a48f187804deb8"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyNTM0MzE5OnYy", "diffSide": "RIGHT", "path": "tools/java/org/unicode/cldr/util/CLDRFile.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQyMzo1Mzo0MFrOGwIjWg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQyMzo1Mzo0MFrOGwIjWg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzEyNDk1NA==", "bodyText": "Nothing but some immaterial formatting diffs.", "url": "https://github.com/unicode-org/cldr/pull/559#discussion_r453124954", "createdAt": "2020-07-10T23:53:40Z", "author": {"login": "macchiati"}, "path": "tools/java/org/unicode/cldr/util/CLDRFile.java", "diffHunk": "@@ -3889,20 +3888,23 @@ public LocaleStringProvider makeOverridingStringProvider(Map<String, String> pat\n     }\n \n     public class OverridingStringProvider implements LocaleStringProvider {\n-        private final Map<String,String> pathAndValueOverrides;\n+        private final Map<String, String> pathAndValueOverrides;\n \n         public OverridingStringProvider(Map<String, String> pathAndValueOverrides) {\n             this.pathAndValueOverrides = pathAndValueOverrides;\n         }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "17ecb09422c589e97d52c58c01a48f187804deb8"}, "originalPosition": 56}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyNTM0MzkyOnYy", "diffSide": "RIGHT", "path": "tools/java/org/unicode/cldr/util/GrammarInfo.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQyMzo1NDoyMlrOGwIjwg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQyMzo1NDoyMlrOGwIjwg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzEyNTA1OA==", "bodyText": "Add check so it is safe to pass in null. Makes caller code simpler.", "url": "https://github.com/unicode-org/cldr/pull/559#discussion_r453125058", "createdAt": "2020-07-10T23:54:22Z", "author": {"login": "macchiati"}, "path": "tools/java/org/unicode/cldr/util/GrammarInfo.java", "diffHunk": "@@ -52,7 +52,7 @@ public CharSequence getSymbol() {\n             return symbol;\n         }\n         public String getDefault(Collection<String> values) {\n-            return this == grammaticalGender && !values.contains(\"neuter\") ? \"masculine\" : defaultValue;\n+            return this == grammaticalGender && values != null && !values.contains(\"neuter\") ? \"masculine\" : defaultValue;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "17ecb09422c589e97d52c58c01a48f187804deb8"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyNTM0NDU5OnYy", "diffSide": "RIGHT", "path": "tools/java/org/unicode/cldr/util/LogicalGrouping.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQyMzo1NDo1MlrOGwIkGw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQyMzo1NDo1MlrOGwIkGw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzEyNTE0Nw==", "bodyText": "Optional parameter to return the type", "url": "https://github.com/unicode-org/cldr/pull/559#discussion_r453125147", "createdAt": "2020-07-10T23:54:52Z", "author": {"login": "macchiati"}, "path": "tools/java/org/unicode/cldr/util/LogicalGrouping.java", "diffHunk": "@@ -96,7 +99,7 @@\n      *\n      * Reference: https://unicode.org/cldr/trac/ticket/11854\n      */\n-    public static Set<String> getPaths(CLDRFile cldrFile, String path) {\n+    public static Set<String> getPaths(CLDRFile cldrFile, String path, Output<PathType> pathTypeOut) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "17ecb09422c589e97d52c58c01a48f187804deb8"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyNTM0NTg5OnYy", "diffSide": "RIGHT", "path": "tools/java/org/unicode/cldr/util/LogicalGrouping.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQyMzo1NTozOFrOGwIkuw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQyMzo1NTozOFrOGwIkuw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzEyNTMwNw==", "bodyText": "extract method so we can call elsewhere.", "url": "https://github.com/unicode-org/cldr/pull/559#discussion_r453125307", "createdAt": "2020-07-10T23:55:38Z", "author": {"login": "macchiati"}, "path": "tools/java/org/unicode/cldr/util/LogicalGrouping.java", "diffHunk": "@@ -364,51 +373,90 @@ void addPaths(Set<String> set, CLDRFile cldrFile, String path, XPathParts parts)\n             @Override\n             @SuppressWarnings(\"unused\")\n             void addPaths(Set<String> set, CLDRFile cldrFile, String path, XPathParts parts) {\n-                PluralInfo pluralInfo = getPluralInfo(cldrFile);\n-                Set<Count> pluralTypes = pluralInfo.getCounts();\n-                String lastElement = parts.getElement(-1);\n-                for (Count count : pluralTypes) {\n-                    parts.setAttribute(lastElement, \"count\", count.toString());\n-                    set.add(parts.toString());\n-                }\n+                addCaseOnly(set, cldrFile, parts);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "17ecb09422c589e97d52c58c01a48f187804deb8"}, "originalPosition": 76}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyNTM0NjcyOnYy", "diffSide": "RIGHT", "path": "tools/java/org/unicode/cldr/util/LogicalGrouping.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQyMzo1NjoxOFrOGwIlNA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQyMzo1NjoxOFrOGwIlNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzEyNTQyOA==", "bodyText": "Tweak the code to match what rawExtraPaths does.", "url": "https://github.com/unicode-org/cldr/pull/559#discussion_r453125428", "createdAt": "2020-07-10T23:56:18Z", "author": {"login": "macchiati"}, "path": "tools/java/org/unicode/cldr/util/LogicalGrouping.java", "diffHunk": "@@ -364,51 +373,90 @@ void addPaths(Set<String> set, CLDRFile cldrFile, String path, XPathParts parts)\n             @Override\n             @SuppressWarnings(\"unused\")\n             void addPaths(Set<String> set, CLDRFile cldrFile, String path, XPathParts parts) {\n-                PluralInfo pluralInfo = getPluralInfo(cldrFile);\n-                Set<Count> pluralTypes = pluralInfo.getCounts();\n-                String lastElement = parts.getElement(-1);\n-                for (Count count : pluralTypes) {\n-                    parts.setAttribute(lastElement, \"count\", count.toString());\n-                    set.add(parts.toString());\n-                }\n+                addCaseOnly(set, cldrFile, parts);\n             }\n         },\n-        CASE {\n+        COUNT_CASE {\n             @Override\n             @SuppressWarnings(\"unused\")\n             void addPaths(Set<String> set, CLDRFile cldrFile, String path, XPathParts parts) {\n+                if (!GrammarInfo.SEED_LOCALES.contains(cldrFile.getLocaleID())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "17ecb09422c589e97d52c58c01a48f187804deb8"}, "originalPosition": 84}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyNTM0NzAwOnYy", "diffSide": "RIGHT", "path": "tools/java/org/unicode/cldr/util/LogicalGrouping.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQyMzo1NjozM1rOGwIlaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQyMzo1NjozM1rOGwIlaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzEyNTQ4MA==", "bodyText": "Similar tweak to code.", "url": "https://github.com/unicode-org/cldr/pull/559#discussion_r453125480", "createdAt": "2020-07-10T23:56:33Z", "author": {"login": "macchiati"}, "path": "tools/java/org/unicode/cldr/util/LogicalGrouping.java", "diffHunk": "@@ -364,51 +373,90 @@ void addPaths(Set<String> set, CLDRFile cldrFile, String path, XPathParts parts)\n             @Override\n             @SuppressWarnings(\"unused\")\n             void addPaths(Set<String> set, CLDRFile cldrFile, String path, XPathParts parts) {\n-                PluralInfo pluralInfo = getPluralInfo(cldrFile);\n-                Set<Count> pluralTypes = pluralInfo.getCounts();\n-                String lastElement = parts.getElement(-1);\n-                for (Count count : pluralTypes) {\n-                    parts.setAttribute(lastElement, \"count\", count.toString());\n-                    set.add(parts.toString());\n-                }\n+                addCaseOnly(set, cldrFile, parts);\n             }\n         },\n-        CASE {\n+        COUNT_CASE {\n             @Override\n             @SuppressWarnings(\"unused\")\n             void addPaths(Set<String> set, CLDRFile cldrFile, String path, XPathParts parts) {\n+                if (!GrammarInfo.SEED_LOCALES.contains(cldrFile.getLocaleID())) {\n+                    addCaseOnly(set, cldrFile, parts);\n+                    return;\n+                }\n                 GrammarInfo grammarInfo = supplementalData.getGrammarInfo(cldrFile.getLocaleID());\n-                //Collection<String> genders = grammarInfo.get(GrammaticalTarget.nominal, GrammaticalFeature.grammaticalGender, GrammaticalScope.units);\n-\n-                if (grammarInfo != null) {\n-                    Collection<String> rawCases = grammarInfo.get(GrammaticalTarget.nominal, GrammaticalFeature.grammaticalCase, GrammaticalScope.units);\n-                    for (String case1 : rawCases) {\n-                        parts.setAttribute(-1, \"case\", case1);\n-                        set.add(parts.toString());\n-                    }\n+                if (grammarInfo == null\n+                    || (parts.getElement(3).equals(\"unitLength\")\n+                        && GrammarInfo.SPECIAL_TRANSLATION_UNITS.contains(parts.getAttributeValue(3, \"type\")))) {\n+                    addCaseOnly(set, cldrFile, parts);\n+                    return;\n                 }\n+                Set<Count> pluralTypes = getPluralInfo(cldrFile).getCounts();\n+                Collection<String> rawCases = grammarInfo.get(GrammaticalTarget.nominal, GrammaticalFeature.grammaticalCase, GrammaticalScope.units);\n+                setGrammarAttributes(set, parts, pluralTypes, rawCases, null);\n+\n             }\n         },\n-        GENDER {\n+        COUNT_CASE_GENDER {\n             @Override\n             @SuppressWarnings(\"unused\")\n             void addPaths(Set<String> set, CLDRFile cldrFile, String path, XPathParts parts) {\n+                if (!GrammarInfo.SEED_LOCALES.contains(cldrFile.getLocaleID())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "17ecb09422c589e97d52c58c01a48f187804deb8"}, "originalPosition": 114}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyNTM0NzY2OnYy", "diffSide": "RIGHT", "path": "tools/java/org/unicode/cldr/util/LogicalGrouping.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQyMzo1NzowMVrOGwIlxg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQyMzo1NzowMVrOGwIlxg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzEyNTU3NA==", "bodyText": "Make sure we consider plurals, case, and gender equally.", "url": "https://github.com/unicode-org/cldr/pull/559#discussion_r453125574", "createdAt": "2020-07-10T23:57:01Z", "author": {"login": "macchiati"}, "path": "tools/java/org/unicode/cldr/util/LogicalGrouping.java", "diffHunk": "@@ -364,51 +373,90 @@ void addPaths(Set<String> set, CLDRFile cldrFile, String path, XPathParts parts)\n             @Override\n             @SuppressWarnings(\"unused\")\n             void addPaths(Set<String> set, CLDRFile cldrFile, String path, XPathParts parts) {\n-                PluralInfo pluralInfo = getPluralInfo(cldrFile);\n-                Set<Count> pluralTypes = pluralInfo.getCounts();\n-                String lastElement = parts.getElement(-1);\n-                for (Count count : pluralTypes) {\n-                    parts.setAttribute(lastElement, \"count\", count.toString());\n-                    set.add(parts.toString());\n-                }\n+                addCaseOnly(set, cldrFile, parts);\n             }\n         },\n-        CASE {\n+        COUNT_CASE {\n             @Override\n             @SuppressWarnings(\"unused\")\n             void addPaths(Set<String> set, CLDRFile cldrFile, String path, XPathParts parts) {\n+                if (!GrammarInfo.SEED_LOCALES.contains(cldrFile.getLocaleID())) {\n+                    addCaseOnly(set, cldrFile, parts);\n+                    return;\n+                }\n                 GrammarInfo grammarInfo = supplementalData.getGrammarInfo(cldrFile.getLocaleID());\n-                //Collection<String> genders = grammarInfo.get(GrammaticalTarget.nominal, GrammaticalFeature.grammaticalGender, GrammaticalScope.units);\n-\n-                if (grammarInfo != null) {\n-                    Collection<String> rawCases = grammarInfo.get(GrammaticalTarget.nominal, GrammaticalFeature.grammaticalCase, GrammaticalScope.units);\n-                    for (String case1 : rawCases) {\n-                        parts.setAttribute(-1, \"case\", case1);\n-                        set.add(parts.toString());\n-                    }\n+                if (grammarInfo == null\n+                    || (parts.getElement(3).equals(\"unitLength\")\n+                        && GrammarInfo.SPECIAL_TRANSLATION_UNITS.contains(parts.getAttributeValue(3, \"type\")))) {\n+                    addCaseOnly(set, cldrFile, parts);\n+                    return;\n                 }\n+                Set<Count> pluralTypes = getPluralInfo(cldrFile).getCounts();\n+                Collection<String> rawCases = grammarInfo.get(GrammaticalTarget.nominal, GrammaticalFeature.grammaticalCase, GrammaticalScope.units);\n+                setGrammarAttributes(set, parts, pluralTypes, rawCases, null);\n+\n             }\n         },\n-        GENDER {\n+        COUNT_CASE_GENDER {\n             @Override\n             @SuppressWarnings(\"unused\")\n             void addPaths(Set<String> set, CLDRFile cldrFile, String path, XPathParts parts) {\n+                if (!GrammarInfo.SEED_LOCALES.contains(cldrFile.getLocaleID())) {\n+                    addCaseOnly(set, cldrFile, parts);\n+                    return;\n+                }\n                 GrammarInfo grammarInfo = supplementalData.getGrammarInfo(cldrFile.getLocaleID());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "17ecb09422c589e97d52c58c01a48f187804deb8"}, "originalPosition": 118}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyNTM0ODI3OnYy", "diffSide": "RIGHT", "path": "tools/java/org/unicode/cldr/util/LogicalGrouping.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQyMzo1NzoyMFrOGwImDw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQyMzo1NzoyMFrOGwImDw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzEyNTY0Nw==", "bodyText": "Refactored code for just case.", "url": "https://github.com/unicode-org/cldr/pull/559#discussion_r453125647", "createdAt": "2020-07-10T23:57:20Z", "author": {"login": "macchiati"}, "path": "tools/java/org/unicode/cldr/util/LogicalGrouping.java", "diffHunk": "@@ -364,51 +373,90 @@ void addPaths(Set<String> set, CLDRFile cldrFile, String path, XPathParts parts)\n             @Override\n             @SuppressWarnings(\"unused\")\n             void addPaths(Set<String> set, CLDRFile cldrFile, String path, XPathParts parts) {\n-                PluralInfo pluralInfo = getPluralInfo(cldrFile);\n-                Set<Count> pluralTypes = pluralInfo.getCounts();\n-                String lastElement = parts.getElement(-1);\n-                for (Count count : pluralTypes) {\n-                    parts.setAttribute(lastElement, \"count\", count.toString());\n-                    set.add(parts.toString());\n-                }\n+                addCaseOnly(set, cldrFile, parts);\n             }\n         },\n-        CASE {\n+        COUNT_CASE {\n             @Override\n             @SuppressWarnings(\"unused\")\n             void addPaths(Set<String> set, CLDRFile cldrFile, String path, XPathParts parts) {\n+                if (!GrammarInfo.SEED_LOCALES.contains(cldrFile.getLocaleID())) {\n+                    addCaseOnly(set, cldrFile, parts);\n+                    return;\n+                }\n                 GrammarInfo grammarInfo = supplementalData.getGrammarInfo(cldrFile.getLocaleID());\n-                //Collection<String> genders = grammarInfo.get(GrammaticalTarget.nominal, GrammaticalFeature.grammaticalGender, GrammaticalScope.units);\n-\n-                if (grammarInfo != null) {\n-                    Collection<String> rawCases = grammarInfo.get(GrammaticalTarget.nominal, GrammaticalFeature.grammaticalCase, GrammaticalScope.units);\n-                    for (String case1 : rawCases) {\n-                        parts.setAttribute(-1, \"case\", case1);\n-                        set.add(parts.toString());\n-                    }\n+                if (grammarInfo == null\n+                    || (parts.getElement(3).equals(\"unitLength\")\n+                        && GrammarInfo.SPECIAL_TRANSLATION_UNITS.contains(parts.getAttributeValue(3, \"type\")))) {\n+                    addCaseOnly(set, cldrFile, parts);\n+                    return;\n                 }\n+                Set<Count> pluralTypes = getPluralInfo(cldrFile).getCounts();\n+                Collection<String> rawCases = grammarInfo.get(GrammaticalTarget.nominal, GrammaticalFeature.grammaticalCase, GrammaticalScope.units);\n+                setGrammarAttributes(set, parts, pluralTypes, rawCases, null);\n+\n             }\n         },\n-        GENDER {\n+        COUNT_CASE_GENDER {\n             @Override\n             @SuppressWarnings(\"unused\")\n             void addPaths(Set<String> set, CLDRFile cldrFile, String path, XPathParts parts) {\n+                if (!GrammarInfo.SEED_LOCALES.contains(cldrFile.getLocaleID())) {\n+                    addCaseOnly(set, cldrFile, parts);\n+                    return;\n+                }\n                 GrammarInfo grammarInfo = supplementalData.getGrammarInfo(cldrFile.getLocaleID());\n-\n-                if (grammarInfo != null) {\n-                    Collection<String> genders = grammarInfo.get(GrammaticalTarget.nominal, GrammaticalFeature.grammaticalGender, GrammaticalScope.units);\n-                    for (String gender : genders) {\n-                        parts.setAttribute(-1, \"gender\", gender);\n-                        set.add(parts.toString());\n-                    }\n+                if (grammarInfo == null) {\n+                    addCaseOnly(set, cldrFile, parts);\n+                    return;\n                 }\n+                Set<Count> pluralTypes = getPluralInfo(cldrFile).getCounts();\n+                Collection<String> rawCases = grammarInfo.get(GrammaticalTarget.nominal, GrammaticalFeature.grammaticalCase, GrammaticalScope.units);\n+                Collection<String> rawGenders = grammarInfo.get(GrammaticalTarget.nominal, GrammaticalFeature.grammaticalGender, GrammaticalScope.units);\n+                setGrammarAttributes(set, parts, pluralTypes, rawCases, rawGenders);\n             }\n         }\n \n         ;\n \n         abstract void addPaths(Set<String> set, CLDRFile cldrFile, String path, XPathParts parts);\n \n+        public void addCaseOnly(Set<String> set, CLDRFile cldrFile, XPathParts parts) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "17ecb09422c589e97d52c58c01a48f187804deb8"}, "originalPosition": 141}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyNTM0ODc5OnYy", "diffSide": "RIGHT", "path": "tools/java/org/unicode/cldr/util/LogicalGrouping.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQyMzo1Nzo0NFrOGwImXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQyMzo1Nzo0NFrOGwImXA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzEyNTcyNA==", "bodyText": "refactored code to do all the grammatical features right.", "url": "https://github.com/unicode-org/cldr/pull/559#discussion_r453125724", "createdAt": "2020-07-10T23:57:44Z", "author": {"login": "macchiati"}, "path": "tools/java/org/unicode/cldr/util/LogicalGrouping.java", "diffHunk": "@@ -364,51 +373,90 @@ void addPaths(Set<String> set, CLDRFile cldrFile, String path, XPathParts parts)\n             @Override\n             @SuppressWarnings(\"unused\")\n             void addPaths(Set<String> set, CLDRFile cldrFile, String path, XPathParts parts) {\n-                PluralInfo pluralInfo = getPluralInfo(cldrFile);\n-                Set<Count> pluralTypes = pluralInfo.getCounts();\n-                String lastElement = parts.getElement(-1);\n-                for (Count count : pluralTypes) {\n-                    parts.setAttribute(lastElement, \"count\", count.toString());\n-                    set.add(parts.toString());\n-                }\n+                addCaseOnly(set, cldrFile, parts);\n             }\n         },\n-        CASE {\n+        COUNT_CASE {\n             @Override\n             @SuppressWarnings(\"unused\")\n             void addPaths(Set<String> set, CLDRFile cldrFile, String path, XPathParts parts) {\n+                if (!GrammarInfo.SEED_LOCALES.contains(cldrFile.getLocaleID())) {\n+                    addCaseOnly(set, cldrFile, parts);\n+                    return;\n+                }\n                 GrammarInfo grammarInfo = supplementalData.getGrammarInfo(cldrFile.getLocaleID());\n-                //Collection<String> genders = grammarInfo.get(GrammaticalTarget.nominal, GrammaticalFeature.grammaticalGender, GrammaticalScope.units);\n-\n-                if (grammarInfo != null) {\n-                    Collection<String> rawCases = grammarInfo.get(GrammaticalTarget.nominal, GrammaticalFeature.grammaticalCase, GrammaticalScope.units);\n-                    for (String case1 : rawCases) {\n-                        parts.setAttribute(-1, \"case\", case1);\n-                        set.add(parts.toString());\n-                    }\n+                if (grammarInfo == null\n+                    || (parts.getElement(3).equals(\"unitLength\")\n+                        && GrammarInfo.SPECIAL_TRANSLATION_UNITS.contains(parts.getAttributeValue(3, \"type\")))) {\n+                    addCaseOnly(set, cldrFile, parts);\n+                    return;\n                 }\n+                Set<Count> pluralTypes = getPluralInfo(cldrFile).getCounts();\n+                Collection<String> rawCases = grammarInfo.get(GrammaticalTarget.nominal, GrammaticalFeature.grammaticalCase, GrammaticalScope.units);\n+                setGrammarAttributes(set, parts, pluralTypes, rawCases, null);\n+\n             }\n         },\n-        GENDER {\n+        COUNT_CASE_GENDER {\n             @Override\n             @SuppressWarnings(\"unused\")\n             void addPaths(Set<String> set, CLDRFile cldrFile, String path, XPathParts parts) {\n+                if (!GrammarInfo.SEED_LOCALES.contains(cldrFile.getLocaleID())) {\n+                    addCaseOnly(set, cldrFile, parts);\n+                    return;\n+                }\n                 GrammarInfo grammarInfo = supplementalData.getGrammarInfo(cldrFile.getLocaleID());\n-\n-                if (grammarInfo != null) {\n-                    Collection<String> genders = grammarInfo.get(GrammaticalTarget.nominal, GrammaticalFeature.grammaticalGender, GrammaticalScope.units);\n-                    for (String gender : genders) {\n-                        parts.setAttribute(-1, \"gender\", gender);\n-                        set.add(parts.toString());\n-                    }\n+                if (grammarInfo == null) {\n+                    addCaseOnly(set, cldrFile, parts);\n+                    return;\n                 }\n+                Set<Count> pluralTypes = getPluralInfo(cldrFile).getCounts();\n+                Collection<String> rawCases = grammarInfo.get(GrammaticalTarget.nominal, GrammaticalFeature.grammaticalCase, GrammaticalScope.units);\n+                Collection<String> rawGenders = grammarInfo.get(GrammaticalTarget.nominal, GrammaticalFeature.grammaticalGender, GrammaticalScope.units);\n+                setGrammarAttributes(set, parts, pluralTypes, rawCases, rawGenders);\n             }\n         }\n \n         ;\n \n         abstract void addPaths(Set<String> set, CLDRFile cldrFile, String path, XPathParts parts);\n \n+        public void addCaseOnly(Set<String> set, CLDRFile cldrFile, XPathParts parts) {\n+            Set<Count> pluralTypes = getPluralInfo(cldrFile).getCounts();\n+            for (Count count : pluralTypes) {\n+                parts.setAttribute(-1, \"count\", count.toString());\n+                set.add(parts.toString());\n+            }\n+        }\n+\n+        public void setGrammarAttributes(Set<String> set, XPathParts parts, Set<Count> pluralTypes, Collection<String> rawCases, Collection<String> rawGenders) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "17ecb09422c589e97d52c58c01a48f187804deb8"}, "originalPosition": 149}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyNTM0OTUyOnYy", "diffSide": "RIGHT", "path": "tools/java/org/unicode/cldr/util/LogicalGrouping.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQyMzo1ODoyNVrOGwImxw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQyMzo1ODoyNVrOGwImxw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzEyNTgzMQ==", "bodyText": "Be more specific about handling the two kinds of unit lengths", "url": "https://github.com/unicode-org/cldr/pull/559#discussion_r453125831", "createdAt": "2020-07-10T23:58:25Z", "author": {"login": "macchiati"}, "path": "tools/java/org/unicode/cldr/util/LogicalGrouping.java", "diffHunk": "@@ -460,11 +508,13 @@ private static PathType getPathTypeFromPath(String path) {\n             if (path.indexOf(\"/decimalFormatLength\") > 0) {\n                 return PathType.DECIMAL_FORMAT_LENGTH;\n             }\n-            if (path.indexOf(\"[@gender=\") > 0) {\n-                return PathType.GENDER;\n-            }\n-            if (path.indexOf(\"[@case=\") > 0) {\n-                return PathType.CASE;\n+            if (path.indexOf(\"/unitLength[@type=\\\"long\\\"]\") > 0) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "17ecb09422c589e97d52c58c01a48f187804deb8"}, "originalPosition": 207}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyNTM1MDQ0OnYy", "diffSide": "RIGHT", "path": "tools/java/org/unicode/cldr/util/PathHeader.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQyMzo1OToxM1rOGwInUw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQyMzo1OToxM1rOGwInUw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzEyNTk3MQ==", "bodyText": "This was a needless throw of an error. Null should just mean use default.", "url": "https://github.com/unicode-org/cldr/pull/559#discussion_r453125971", "createdAt": "2020-07-10T23:59:13Z", "author": {"login": "macchiati"}, "path": "tools/java/org/unicode/cldr/util/PathHeader.java", "diffHunk": "@@ -426,16 +426,15 @@ private PathHeader(SectionId sectionId, PageId pageId, String header,\n     }\n \n     /**\n-     * Return a factory for use in creating the headers. This should be cached.\n-     * The calls are thread-safe. The englishFile sets a static for now; after\n-     * the first time, null can be passed.\n+     * Return a factory for use in creating the headers. This is cached after first use.\n+     * The calls are thread-safe. Null gets the default (CLDRConfig) english file.\n      *\n      * @param englishFile\n      */\n     public static Factory getFactory(CLDRFile englishFile) {\n         if (factorySingleton == null) {\n             if (englishFile == null) {\n-                throw new IllegalArgumentException(\"English CLDRFile must not be null\");\n+                englishFile = CLDRConfig.getInstance().getEnglish();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "17ecb09422c589e97d52c58c01a48f187804deb8"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzMTcxNDAzOnYy", "diffSide": "RIGHT", "path": "tools/java/org/unicode/cldr/test/CheckCLDR.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQwMDozMDo1N1rOGw_jAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQwMDozMDo1N1rOGw_jAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDAyNTk4Nw==", "bodyText": "This line changed in order to get rid of merge conflicts.", "url": "https://github.com/unicode-org/cldr/pull/559#discussion_r454025987", "createdAt": "2020-07-14T00:30:57Z", "author": {"login": "macchiati"}, "path": "tools/java/org/unicode/cldr/test/CheckCLDR.java", "diffHunk": "@@ -717,7 +717,7 @@ public CheckCLDR setCldrFileToCheck(CLDRFile cldrFileToCheck, Options options,\n             invalidPlaceHolder, asciiQuotesNotAllowed, badMinimumGroupingDigits, inconsistentPeriods,\n             inheritanceMarkerNotAllowed, invalidDurationUnitPattern, invalidDelimiter, illegalCharactersInPattern,\n             badParseLenient, tooManyValues, invalidSymbol, invalidGenderCode,\n-            mismatchedUnitComponent, longPowerWithSubscripts, gapsInPlaceholderNumbers, duplicatePlaceholders\n+            mismatchedUnitComponent, longPowerWithSubscripts, gapsInPlaceholderNumbers, duplicatePlaceholders, largerDifferences", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bbb975c0d31c75054a387a6c0db0143f67088d94"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 415, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}