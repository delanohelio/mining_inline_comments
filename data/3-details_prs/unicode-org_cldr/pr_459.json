{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE1NzYzNTM0", "number": 459, "title": "CLDR-13750 Refactoring collection utilities (part 2, addAll and asMap)", "bodyText": "Mostly automatic via IntelliJ and inlining of methods for addAll(), but some changes needed since it\u2019s better to say:\niterable.forEach(thing::add)\nthan:\niterator.forEachRemaining(thing::add)\nwhere possible (and the original utilities class took iterators rather than iterables).\nThe asMap() changes were manual since there were so few.\nChecklist\n\n Issue filed: https://unicode-org.atlassian.net/browse/CLDR-13750\n Updated PR title and link in previous line to include Issue number", "createdAt": "2020-05-10T18:47:17Z", "url": "https://github.com/unicode-org/cldr/pull/459", "merged": true, "mergeCommit": {"oid": "4cadb6183843d506ff2a08ce28eb8c7b6ce91744"}, "closed": true, "closedAt": "2020-05-28T05:25:48Z", "author": {"login": "hagbard"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcldHweAH2gAyNDE1NzYzNTM0OjNjODE1ZTkxNjMzNzVjNWY3YzJhMzIxNGI3NTFhZTIzOTdmZTcyZjQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcljJi5gFqTQxOTcwODUzOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3c815e9163375c5f7c2a3214b751ae2397fe72f4", "author": {"user": {"login": "hagbard", "name": "David Beaumont"}}, "url": "https://github.com/unicode-org/cldr/commit/3c815e9163375c5f7c2a3214b751ae2397fe72f4", "committedDate": "2020-05-27T17:57:00Z", "message": "CLDR-13750 Refactoring collection utilities (part 2)"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9251081df1aa4484a08d3b8b7601af47dc53a64b", "author": {"user": {"login": "hagbard", "name": "David Beaumont"}}, "url": "https://github.com/unicode-org/cldr/commit/9251081df1aa4484a08d3b8b7601af47dc53a64b", "committedDate": "2020-05-10T18:42:05Z", "message": "CLDR-13750 Refactoring collection utilities (part 2)"}, "afterCommit": {"oid": "3c815e9163375c5f7c2a3214b751ae2397fe72f4", "author": {"user": {"login": "hagbard", "name": "David Beaumont"}}, "url": "https://github.com/unicode-org/cldr/commit/3c815e9163375c5f7c2a3214b751ae2397fe72f4", "committedDate": "2020-05-27T17:57:00Z", "message": "CLDR-13750 Refactoring collection utilities (part 2)"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE5NDk0NjQ0", "url": "https://github.com/unicode-org/cldr/pull/459#pullrequestreview-419494644", "createdAt": "2020-05-27T18:22:37Z", "commit": {"oid": "3c815e9163375c5f7c2a3214b751ae2397fe72f4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxODoyMjozN1rOGbXpKw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxODoyMjozN1rOGbXpKw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTM1MjEwNw==", "bodyText": "most changes are just this sort of thing.\noccasionally you'll see \"forEachRemaining()\" which is what you have to do if there's no iterable available, only an iterator.", "url": "https://github.com/unicode-org/cldr/pull/459#discussion_r431352107", "createdAt": "2020-05-27T18:22:37Z", "author": {"login": "hagbard"}, "path": "tools/cldr-unittest/src/org/unicode/cldr/unittest/TestCldrFactory.java", "diffHunk": "@@ -138,8 +137,8 @@ private String getUncontainedPath(CLDRFile subset, CLDRFile superset) {\n     private String differentPathValue(CLDRFile a, CLDRFile b) {\n         int debugCount = 0;\n         Set<String> paths = new TreeSet<>();\n-        CollectionUtilities.addAll(a.iterator(), paths);\n-        CollectionUtilities.addAll(b.iterator(), paths);\n+        a.forEach(paths::add);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3c815e9163375c5f7c2a3214b751ae2397fe72f4"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE5NDk1NDMz", "url": "https://github.com/unicode-org/cldr/pull/459#pullrequestreview-419495433", "createdAt": "2020-05-27T18:23:43Z", "commit": {"oid": "3c815e9163375c5f7c2a3214b751ae2397fe72f4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxODoyMzo0M1rOGbXriQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxODoyMzo0M1rOGbXriQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTM1MjcxMw==", "bodyText": "Cases like this have to be unpacked so you make the container and then add to it, rather than passing it into the utility method.", "url": "https://github.com/unicode-org/cldr/pull/459#discussion_r431352713", "createdAt": "2020-05-27T18:23:43Z", "author": {"login": "hagbard"}, "path": "tools/cldr-unittest/src/org/unicode/cldr/unittest/TestPaths.java", "diffHunk": "@@ -46,11 +45,10 @@ public static void main(String[] args) {\n     }\n \n     public void VerifyEnglishVsRoot() {\n-        Set<String> rootPaths = CollectionUtilities.addAll(testInfo\n-            .getRoot().iterator(),\n-            new HashSet<String>());\n-        Set<String> englishPaths = CollectionUtilities.addAll(testInfo\n-            .getEnglish().iterator(), new HashSet<String>());\n+        HashSet<String> rootPaths = new HashSet<String>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3c815e9163375c5f7c2a3214b751ae2397fe72f4"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE5NDk2MjA2", "url": "https://github.com/unicode-org/cldr/pull/459#pullrequestreview-419496206", "createdAt": "2020-05-27T18:24:44Z", "commit": {"oid": "3c815e9163375c5f7c2a3214b751ae2397fe72f4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxODoyNDo0NFrOGbXuCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxODoyNDo0NFrOGbXuCA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTM1MzM1Mg==", "bodyText": "These are the \"asMap()\" changes which were manual (but still mostly just search & replace).", "url": "https://github.com/unicode-org/cldr/pull/459#discussion_r431353352", "createdAt": "2020-05-27T18:24:44Z", "author": {"login": "hagbard"}, "path": "tools/java/org/unicode/cldr/tool/CountItems.java", "diffHunk": "@@ -85,35 +85,36 @@\n         + \" America/Los_Angeles America/Phoenix America/Denver America/Chicago America/Indianapolis\"\n         + \" America/New_York\";\n \n-    static final Map<String, String> country_map = CollectionUtilities.asMap(new String[][] {\n-        { \"AQ\", \"http://www.worldtimezone.com/time-antarctica24.php\" },\n-        { \"AR\", \"http://www.worldtimezone.com/time-south-america24.php\" },\n-        { \"AU\", \"http://www.worldtimezone.com/time-australia24.php\" },\n-        { \"BR\", \"http://www.worldtimezone.com/time-south-america24.php\" },\n-        { \"CA\", \"http://www.worldtimezone.com/time-canada24.php\" },\n-        { \"CD\", \"http://www.worldtimezone.com/time-africa24.php\" },\n-        { \"CL\", \"http://www.worldtimezone.com/time-south-america24.php\" },\n-        { \"CN\", \"http://www.worldtimezone.com/time-cis24.php\" },\n-        { \"EC\", \"http://www.worldtimezone.com/time-south-america24.php\" },\n-        { \"ES\", \"http://www.worldtimezone.com/time-europe24.php\" },\n-        { \"FM\", \"http://www.worldtimezone.com/time-oceania24.php\" },\n-        { \"GL\", \"http://www.worldtimezone.com/index24.php\" },\n-        { \"ID\", \"http://www.worldtimezone.com/time-asia24.php\" },\n-        { \"KI\", \"http://www.worldtimezone.com/time-oceania24.php\" },\n-        { \"KZ\", \"http://www.worldtimezone.com/time-cis24.php\" },\n-        { \"MH\", \"http://www.worldtimezone.com/time-oceania24.php\" },\n-        { \"MN\", \"http://www.worldtimezone.com/time-cis24.php\" },\n-        { \"MX\", \"http://www.worldtimezone.com/index24.php\" },\n-        { \"MY\", \"http://www.worldtimezone.com/time-asia24.php\" },\n-        { \"NZ\", \"http://www.worldtimezone.com/time-oceania24.php\" },\n-        { \"PF\", \"http://www.worldtimezone.com/time-oceania24.php\" },\n-        { \"PT\", \"http://www.worldtimezone.com/time-europe24.php\" },\n-        { \"RU\", \"http://www.worldtimezone.com/time-russia24.php\" },\n-        { \"SJ\", \"http://www.worldtimezone.com/index24.php\" },\n-        { \"UA\", \"http://www.worldtimezone.com/time-cis24.php\" },\n-        { \"UM\", \"http://www.worldtimezone.com/time-oceania24.php\" },\n-        { \"US\", \"http://www.worldtimezone.com/time-usa24.php\" },\n-        { \"UZ\", \"http://www.worldtimezone.com/time-cis24.php\" }, });\n+    static final ImmutableMap<String, String> country_map = ImmutableMap.<String, String>builder()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3c815e9163375c5f7c2a3214b751ae2397fe72f4"}, "originalPosition": 42}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE5NDk2NjE4", "url": "https://github.com/unicode-org/cldr/pull/459#pullrequestreview-419496618", "createdAt": "2020-05-27T18:25:17Z", "commit": {"oid": "3c815e9163375c5f7c2a3214b751ae2397fe72f4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxODoyNToxN1rOGbXvYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxODoyNToxN1rOGbXvYw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTM1MzY5OQ==", "bodyText": "An example of where only an iterator is available.", "url": "https://github.com/unicode-org/cldr/pull/459#discussion_r431353699", "createdAt": "2020-05-27T18:25:17Z", "author": {"login": "hagbard"}, "path": "tools/java/org/unicode/cldr/tool/GenerateCasingChart.java", "diffHunk": "@@ -101,7 +100,7 @@ public static void main(String[] args) {\n             Level level = CLDRConfig.getInstance().getStandardCodes().getLocaleCoverageLevel(\"cldr\", locale);\n             boolean hasCasedLetters = changesUpper.containsSome(exemplars);\n             Set<String> items = new LinkedHashSet<>();\n-            CollectionUtilities.addAll(cldrFile.iterator(\"//ldml/contextTransforms\"), items);\n+            cldrFile.iterator(\"//ldml/contextTransforms\").forEachRemaining(items::add);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3c815e9163375c5f7c2a3214b751ae2397fe72f4"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE5NDk3NDY2", "url": "https://github.com/unicode-org/cldr/pull/459#pullrequestreview-419497466", "createdAt": "2020-05-27T18:26:29Z", "commit": {"oid": "3c815e9163375c5f7c2a3214b751ae2397fe72f4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxODoyNjoyOVrOGbXyAQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QxODoyNjoyOVrOGbXyAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTM1NDM2OQ==", "bodyText": "I could split these onto one-per-line, but left them like this so it's easier to see nothing important changed since lines line up in the diff.", "url": "https://github.com/unicode-org/cldr/pull/459#discussion_r431354369", "createdAt": "2020-05-27T18:26:29Z", "author": {"login": "hagbard"}, "path": "tools/java/org/unicode/cldr/tool/GenerateEnums.java", "diffHunk": "@@ -570,15 +570,14 @@ private void checkDuplicates(Map m) {\n     Set<String> corrigendum = new TreeSet<String>(Arrays.asList(new String[] { \"QE\", \"833\",\n         \"830\", \"172\" })); // 003, 419\n \n-    private Map extraNames = CollectionUtilities.asMap(new String[][] {\n-        { \"BU\", \"Burma\" }, { \"TP\", \"East Timor\" }, { \"YU\", \"Yugoslavia\" },\n-        { \"ZR\", \"Zaire\" }, { \"CD\", \"Congo (Kinshasa, Democratic Republic)\" },\n-        { \"CI\", \"Ivory Coast (Cote d'Ivoire)\" },\n-        { \"FM\", \"Micronesia (Federated States)\" },\n-        { \"TL\", \"East Timor (Timor-Leste)\" },\n-        // {\"155\",\"Western Europe\"},\n-\n-    });\n+    private ImmutableMap<String, String> extraNames = ImmutableMap.<String, String>builder()\n+        .put(\"BU\", \"Burma\").put(\"TP\", \"East Timor\").put(\"YU\", \"Yugoslavia\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3c815e9163375c5f7c2a3214b751ae2397fe72f4"}, "originalPosition": 23}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE5NzA4NTM5", "url": "https://github.com/unicode-org/cldr/pull/459#pullrequestreview-419708539", "createdAt": "2020-05-28T00:58:23Z", "commit": {"oid": "3c815e9163375c5f7c2a3214b751ae2397fe72f4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2058, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}