{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU5Nzk1MDc4", "number": 601, "title": "CLDR-13948 deploy to cldr-smoke2 on merge", "bodyText": "CLDR-13948\n\nrestructure the 'ant' workflow, for parallel building\non push to master, deploy to cldr-ref.\n\n(This is on the main fork because of secrets, so i could try out deployment. )", "createdAt": "2020-07-31T05:26:19Z", "url": "https://github.com/unicode-org/cldr/pull/601", "merged": true, "mergeCommit": {"oid": "8fb7d4ca291265d86d0c4a01e32cce6b04bdc223"}, "closed": true, "closedAt": "2020-08-27T13:14:40Z", "author": {"login": "srl295"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc6NXFOABqjM2MDY5MzA3MTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdC2aGeAFqTQ3NjMzMDAyMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cb941df9867b53cf852c38c86a23a8ee865b8a8b", "author": {"user": {"login": "srl295", "name": "Steven R. Loomis"}}, "url": "https://github.com/unicode-org/cldr/commit/cb941df9867b53cf852c38c86a23a8ee865b8a8b", "committedDate": "2020-07-31T05:24:02Z", "message": "CLDR-13948 deploy TEST"}, "afterCommit": {"oid": "08d35e11e28280e7f91e76821787b5765f2153d5", "author": {"user": {"login": "srl295", "name": "Steven R. Loomis"}}, "url": "https://github.com/unicode-org/cldr/commit/08d35e11e28280e7f91e76821787b5765f2153d5", "committedDate": "2020-07-31T05:26:51Z", "message": "CLDR-13948 deploy TEST"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6a3ef0ab0b8dccfb0c9b994eda0147b0f2976cea", "author": {"user": {"login": "srl295", "name": "Steven R. Loomis"}}, "url": "https://github.com/unicode-org/cldr/commit/6a3ef0ab0b8dccfb0c9b994eda0147b0f2976cea", "committedDate": "2020-07-31T19:36:57Z", "message": "wip iterate on deploy"}, "afterCommit": {"oid": "9e418af3f7bd900af6fd92e55379021b5ec9d63c", "author": {"user": {"login": "srl295", "name": "Steven R. Loomis"}}, "url": "https://github.com/unicode-org/cldr/commit/9e418af3f7bd900af6fd92e55379021b5ec9d63c", "committedDate": "2020-07-31T19:47:18Z", "message": "CLDR-13948 deploy to cldr-ref on push\n\n- restructure build\n- on merge, update cldr-ref"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9e418af3f7bd900af6fd92e55379021b5ec9d63c", "author": {"user": {"login": "srl295", "name": "Steven R. Loomis"}}, "url": "https://github.com/unicode-org/cldr/commit/9e418af3f7bd900af6fd92e55379021b5ec9d63c", "committedDate": "2020-07-31T19:47:18Z", "message": "CLDR-13948 deploy to cldr-ref on push\n\n- restructure build\n- on merge, update cldr-ref"}, "afterCommit": {"oid": "70038bd12a2a60d29f221fe22e5a84c2d993f7a7", "author": {"user": {"login": "srl295", "name": "Steven R. Loomis"}}, "url": "https://github.com/unicode-org/cldr/commit/70038bd12a2a60d29f221fe22e5a84c2d993f7a7", "committedDate": "2020-07-31T19:51:11Z", "message": "CLDR-13948 deploy to cldr-ref on push\n\n- restructure build\n- on merge, update cldr-ref"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU5NTAxNTEw", "url": "https://github.com/unicode-org/cldr/pull/601#pullrequestreview-459501510", "createdAt": "2020-07-31T22:07:08Z", "commit": {"oid": "70038bd12a2a60d29f221fe22e5a84c2d993f7a7"}, "state": "DISMISSED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQyMjowNzowOFrOG6YLmQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQyMjowNzowOFrOG6YLmQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzg2Njc3Nw==", "bodyText": "Note: this workflow is configured to execute on push events only on the master branch (which is what gets triggered when merging a PR).  Which makes sense, as it does for certain other things (ex: we have our API docs re-generate only on merges to master).\nThe comment \"Only on push\" kinda of obfuscates that fact, so maybe reword?", "url": "https://github.com/unicode-org/cldr/pull/601#discussion_r463866777", "createdAt": "2020-07-31T22:07:08Z", "author": {"login": "echeran"}, "path": ".github/workflows/ant.yml", "diffHunk": "@@ -60,10 +57,105 @@ jobs:\n       with:\n         name: cldr-apps\n         path: tools/cldr-apps/cldr-apps.war\n+  surveytest:\n+    needs: build\n+    runs-on: ubuntu-latest\n+    steps:\n+    - uses: actions/checkout@v2\n+      with:\n+        lfs: true # important!\n+    - name: Set up JDK 1.8\n+      uses: actions/setup-java@v1\n+      with:\n+        java-version: 1.8\n+    - name: Download cldr.jar\n+      uses: actions/download-artifact@v2\n+      with:\n+        name: cldr-tools\n+        path: tools/java/dist/for-build\n+    - name: Download cldr-apps.war\n+      uses: actions/download-artifact@v2\n+      with:\n+        name: cldr-apps\n+        path: tools/java/dist/for-build\n+    # Cache for Tomcat tarball (load on cache hit, else store at end of job)\n+    - name: Cache for Tomcat tarball\n+      id: cache-tomcat\n+      uses: actions/cache@v2\n+      with:\n+        path: tomcat-tarball\n+        key: ${{ runner.os }}-tomcat-tarball\n+    - name: Download Tomcat # only on cache miss\n+      if: steps.cache-tomcat.outputs.cache-hit != 'true'\n+      run: 'mkdir -p ./tomcat-tarball && cd ./tomcat-tarball && wget -O - \"https://www.apache.org/dyn/mirrors/mirrors.cgi?action=download&filename=tomcat/tomcat-8/v8.5.57/bin/apache-tomcat-8.5.57.tar.gz\" | tar xfpz - ; cd .. '\n+    - name: Alias Tomcat directory\n+      run: ln -svf tomcat-tarball/apache-tomcat-* tomcat\n+    - name: Survey Tool Check\n+      run: ant -noinput -DCLDR_TOOLS=$(pwd)/tools/java -DCATALINA_HOME=$(pwd)/tomcat -f tools/cldr-apps/build.xml check\n+  test:\n+    needs: build\n+    runs-on: ubuntu-latest\n+    steps:\n+    - uses: actions/checkout@v2\n+      with:\n+        lfs: true # important!\n+    - name: Set up JDK 1.8\n+      uses: actions/setup-java@v1\n+      with:\n+        java-version: 1.8\n+    - name: Download cldr.jar\n+      uses: actions/download-artifact@v2\n+      with:\n+        name: cldr-tools\n+        path: tools/java/dist/for-build\n+    - name: Debug\n+      run: find tools/java/dist/for-build -ls\n+    - name: Build tools/cldr-unittest\n+      run: ant -noinput -f tools/cldr-unittest/build.xml -DCLDR_DIR=$(pwd) tests\n     # Now run tests\n     - name: CLDR Unit Test\n       run: ant -noinput unittest -f tools/cldr-unittest/build.xml -DCLDR_DIR=$(pwd)\n     - name: CLDR Data Check\n       run: ant -noinput datacheck -f tools/cldr-unittest/build.xml -DCLDR_DIR=$(pwd)\n-    - name: Survey Tool Check\n-      run: ant -noinput -DCLDR_TOOLS=$(pwd)/tools/java -DCATALINA_HOME=$(pwd)/tomcat -f tools/cldr-apps/build.xml check\n+  deploy:\n+    needs:\n+      - build\n+      - surveytest\n+      - test\n+    runs-on: ubuntu-latest\n+    steps:\n+    - name: Download cldr-apps.war\n+      uses: actions/download-artifact@v2\n+      with:\n+        name: cldr-apps\n+    - name: Deploy to cldr-ref (experimental)\n+      # Only on push.\n+      if: ${{ github.event_name == 'push' }}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "70038bd12a2a60d29f221fe22e5a84c2d993f7a7"}, "originalPosition": 105}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "70038bd12a2a60d29f221fe22e5a84c2d993f7a7", "author": {"user": {"login": "srl295", "name": "Steven R. Loomis"}}, "url": "https://github.com/unicode-org/cldr/commit/70038bd12a2a60d29f221fe22e5a84c2d993f7a7", "committedDate": "2020-07-31T19:51:11Z", "message": "CLDR-13948 deploy to cldr-ref on push\n\n- restructure build\n- on merge, update cldr-ref"}, "afterCommit": {"oid": "7238b7a6e8dfeb7ace7df4bac5e31c1527ca18c7", "author": {"user": {"login": "srl295", "name": "Steven R. Loomis"}}, "url": "https://github.com/unicode-org/cldr/commit/7238b7a6e8dfeb7ace7df4bac5e31c1527ca18c7", "committedDate": "2020-08-03T17:12:43Z", "message": "CLDR-13948 deploy to cldr-ref on push\n\n- restructure build\n- on merge, update cldr-ref"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "457c5bee40c797bf64af8b452e496cfd514cd8f0", "author": {"user": {"login": "srl295", "name": "Steven R. Loomis"}}, "url": "https://github.com/unicode-org/cldr/commit/457c5bee40c797bf64af8b452e496cfd514cd8f0", "committedDate": "2020-08-19T13:57:10Z", "message": "updated for cldr-smoke2"}, "afterCommit": {"oid": "af57d71bb7b4d5a4863bef8035a0e52a7203f06f", "author": {"user": {"login": "srl295", "name": "Steven R. Loomis"}}, "url": "https://github.com/unicode-org/cldr/commit/af57d71bb7b4d5a4863bef8035a0e52a7203f06f", "committedDate": "2020-08-19T13:58:03Z", "message": "CLDR-13948 deploy to cldr-smoke2 on push\n\n- restructure build\n- on merge, update cldr-smoke2"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "af57d71bb7b4d5a4863bef8035a0e52a7203f06f", "author": {"user": {"login": "srl295", "name": "Steven R. Loomis"}}, "url": "https://github.com/unicode-org/cldr/commit/af57d71bb7b4d5a4863bef8035a0e52a7203f06f", "committedDate": "2020-08-19T13:58:03Z", "message": "CLDR-13948 deploy to cldr-smoke2 on push\n\n- restructure build\n- on merge, update cldr-smoke2"}, "afterCommit": {"oid": "06786fb365adc00423657dce185a5352f08de171", "author": {"user": {"login": "srl295", "name": "Steven R. Loomis"}}, "url": "https://github.com/unicode-org/cldr/commit/06786fb365adc00423657dce185a5352f08de171", "committedDate": "2020-08-19T13:59:41Z", "message": "CLDR-13948 deploy to cldr-smoke2 on push\n\n- restructure build\n- on merge, update cldr-smoke2\n\nTEST"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "06786fb365adc00423657dce185a5352f08de171", "author": {"user": {"login": "srl295", "name": "Steven R. Loomis"}}, "url": "https://github.com/unicode-org/cldr/commit/06786fb365adc00423657dce185a5352f08de171", "committedDate": "2020-08-19T13:59:41Z", "message": "CLDR-13948 deploy to cldr-smoke2 on push\n\n- restructure build\n- on merge, update cldr-smoke2\n\nTEST"}, "afterCommit": {"oid": "9435ee855755d900c633017f1b4fed99000868db", "author": {"user": {"login": "srl295", "name": "Steven R. Loomis"}}, "url": "https://github.com/unicode-org/cldr/commit/9435ee855755d900c633017f1b4fed99000868db", "committedDate": "2020-08-19T14:00:37Z", "message": "CLDR-13948 deploy to cldr-smoke2 on push\n\n- restructure build\n- on merge, update cldr-smoke2\n\nTEST"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d52f94aac728d312e67bf03a795f68aec1033d95", "author": {"user": {"login": "srl295", "name": "Steven R. Loomis"}}, "url": "https://github.com/unicode-org/cldr/commit/d52f94aac728d312e67bf03a795f68aec1033d95", "committedDate": "2020-08-19T14:27:19Z", "message": "CLDR-13948 deploy to cldr-smoke2 on push\n\n- restructure build\n- on merge, update cldr-smoke2"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9435ee855755d900c633017f1b4fed99000868db", "author": {"user": {"login": "srl295", "name": "Steven R. Loomis"}}, "url": "https://github.com/unicode-org/cldr/commit/9435ee855755d900c633017f1b4fed99000868db", "committedDate": "2020-08-19T14:00:37Z", "message": "CLDR-13948 deploy to cldr-smoke2 on push\n\n- restructure build\n- on merge, update cldr-smoke2\n\nTEST"}, "afterCommit": {"oid": "d52f94aac728d312e67bf03a795f68aec1033d95", "author": {"user": {"login": "srl295", "name": "Steven R. Loomis"}}, "url": "https://github.com/unicode-org/cldr/commit/d52f94aac728d312e67bf03a795f68aec1033d95", "committedDate": "2020-08-19T14:27:19Z", "message": "CLDR-13948 deploy to cldr-smoke2 on push\n\n- restructure build\n- on merge, update cldr-smoke2"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDczNzQ1ODQw", "url": "https://github.com/unicode-org/cldr/pull/601#pullrequestreview-473745840", "createdAt": "2020-08-24T18:15:50Z", "commit": {"oid": "d52f94aac728d312e67bf03a795f68aec1033d95"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc2MzMwMDIz", "url": "https://github.com/unicode-org/cldr/pull/601#pullrequestreview-476330023", "createdAt": "2020-08-27T01:48:28Z", "commit": {"oid": "d52f94aac728d312e67bf03a795f68aec1033d95"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2024, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}