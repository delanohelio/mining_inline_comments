{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMzOTQ2MzUx", "number": 870, "title": "CLDR-14057 Survey Tool CLDR_PHASE=FINAL_TESTING should not allow vetters to vote", "bodyText": "-New function SurveyMain.isPhaseFinalTesting called by userCanModifyLocaleWhy and manage.jsp\n-New message ModifyDenial.DENY_PHASE_FINAL_TESTING\n-Clean up formatting of enum ModifyDenial\n-Fix compiler warnings about static SurveyMain.QUERY_DO and SurveyMain.getNewVersion\n-Fix compiler warning about UserRegistry.writeUserFile, call out.close before return\n-Remove superfluously duplicated CLDR_PHASE setting in cldr-properties.j2\n-Delete some dead code\n\nChecklist\n\n Issue filed: https://unicode-org.atlassian.net/browse/CLDR-14057\n Updated PR title and link in previous line to include Issue number", "createdAt": "2020-12-07T21:03:05Z", "url": "https://github.com/unicode-org/cldr/pull/870", "merged": true, "mergeCommit": {"oid": "b0433f9db91c1dd0215831015e50522602fc9fdc"}, "closed": true, "closedAt": "2020-12-08T17:06:19Z", "author": {"login": "btangmu"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdj8Bz6AH2gAyNTMzOTQ2MzUxOmY3MzkxYzAxZGUyNjJjODYxYmEwOWUxNDA5Yzc1OTZjMTUwMzhlMDE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdkAYe3gFqTU0NjY4OTI3NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f7391c01de262c861ba09e1409c7596c15038e01", "author": {"user": {"login": "btangmu", "name": "Tom Bishop"}}, "url": "https://github.com/unicode-org/cldr/commit/f7391c01de262c861ba09e1409c7596c15038e01", "committedDate": "2020-12-07T21:00:52Z", "message": "CLDR-14057 Survey Tool CLDR_PHASE=FINAL_TESTING should not allow vetters to vote\n\n-New function SurveyMain.isPhaseFinalTesting called by userCanModifyLocaleWhy and manage.jsp\n\n-New message ModifyDenial.DENY_PHASE_FINAL_TESTING\n\n-Clean up formatting of enum ModifyDenial\n\n-Fix compiler warnings about static SurveyMain.QUERY_DO and SurveyMain.getNewVersion\n\n-Fix compiler warning about UserRegistry.writeUserFile, call out.close before return\n\n-Remove superfluously duplicated CLDR_PHASE setting in cldr-properties.j2\n\n-Delete some dead code"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ2NTM1NTcy", "url": "https://github.com/unicode-org/cldr/pull/870#pullrequestreview-546535572", "createdAt": "2020-12-07T21:05:37Z", "commit": {"oid": "f7391c01de262c861ba09e1409c7596c15038e01"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QyMTowNTozN1rOIA6qww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QyMTowNTozN1rOIA6qww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzgzMjEzMQ==", "bodyText": "DENY_PHASE_FINAL_TESTING is new; the rest is just reformatted", "url": "https://github.com/unicode-org/cldr/pull/870#discussion_r537832131", "createdAt": "2020-12-07T21:05:37Z", "author": {"login": "btangmu"}, "path": "tools/cldr-apps/src/main/java/org/unicode/cldr/web/UserRegistry.java", "diffHunk": "@@ -1760,10 +1760,15 @@ static boolean localeMatchesLocaleList(String localeList, CLDRLocale locale) {\n     }\n \n     public enum ModifyDenial {\n-        DENY_NULL_USER(\"No user specified\"), DENY_LOCALE_READONLY(\"Locale is read-only\"), DENY_PHASE_READONLY(\n-            \"SurveyTool is in read-only mode\"), DENY_ALIASLOCALE(\"Locale is an alias\"), DENY_DEFAULTCONTENT(\n-                \"Locale is the Default Content for another locale\"), DENY_PHASE_CLOSED(\"SurveyTool is in 'closed' phase\"), DENY_NO_RIGHTS(\n-                    \"User does not have any voting rights\"), DENY_LOCALE_LIST(\"User does not have rights to vote for this locale\");\n+        DENY_NULL_USER(\"No user specified\"),\n+        DENY_LOCALE_READONLY(\"Locale is read-only\"),\n+        DENY_PHASE_READONLY(\"SurveyTool is in read-only mode\"),\n+        DENY_ALIASLOCALE(\"Locale is an alias\"),\n+        DENY_DEFAULTCONTENT(\"Locale is the Default Content for another locale\"),\n+        DENY_PHASE_CLOSED(\"SurveyTool is in 'closed' phase\"),\n+        DENY_NO_RIGHTS(\"User does not have any voting rights\"),\n+        DENY_LOCALE_LIST(\"User does not have rights to vote for this locale\"),\n+        DENY_PHASE_FINAL_TESTING(\"SurveyTool is in the 'final testing' phase\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f7391c01de262c861ba09e1409c7596c15038e01"}, "originalPosition": 16}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ2NTM2MjM4", "url": "https://github.com/unicode-org/cldr/pull/870#pullrequestreview-546536238", "createdAt": "2020-12-07T21:06:31Z", "commit": {"oid": "f7391c01de262c861ba09e1409c7596c15038e01"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QyMTowNjozMVrOIA6s5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QyMTowNjozMVrOIA6s5w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzgzMjY3OQ==", "bodyText": "This fixes a compiler warning -- unrelated to this ticket but same file and too small for its own ticket", "url": "https://github.com/unicode-org/cldr/pull/870#discussion_r537832679", "createdAt": "2020-12-07T21:06:31Z", "author": {"login": "btangmu"}, "path": "tools/cldr-apps/src/main/java/org/unicode/cldr/web/UserRegistry.java", "diffHunk": "@@ -2453,6 +2461,7 @@ int writeUserFile(SurveyMain sm, String ourDate, boolean obscured, File outFile)\n                 rs = ps.executeQuery();\n                 if (rs == null) {\n                     out.println(\"\\t<!-- No results -->\");\n+                    out.close();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f7391c01de262c861ba09e1409c7596c15038e01"}, "originalPosition": 34}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ2NTM3MTIx", "url": "https://github.com/unicode-org/cldr/pull/870#pullrequestreview-546537121", "createdAt": "2020-12-07T21:07:46Z", "commit": {"oid": "f7391c01de262c861ba09e1409c7596c15038e01"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QyMTowNzo0NlrOIA6v4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QyMTowNzo0NlrOIA6v4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzgzMzQ0Mg==", "bodyText": "This is the most essential addition. The other changes in this file fix compiler warnings or delete dead (\"if false\") code", "url": "https://github.com/unicode-org/cldr/pull/870#discussion_r537833442", "createdAt": "2020-12-07T21:07:46Z", "author": {"login": "btangmu"}, "path": "tools/cldr-apps/src/main/webapp/WEB-INF/tmpl/manage.jsp", "diffHunk": "@@ -55,9 +52,11 @@ String helpName = subCtx.getString(\"helpName\");\n                 subCtx.println(\"<br> (Note: in the Vetting phase, you may not submit new data.) \");\n             } else if(SurveyMain.isPhaseClosed() && !UserRegistry.userIsTC(subCtx.session.user)) {\n                 subCtx.println(\"<br>(SurveyTool is closed to vetting and data submissions.)\");\n+            } else if (SurveyMain.isPhaseFinalTesting() && !UserRegistry.userIsTC(subCtx.session.user)) {\n+                subCtx.println(\"(SurveyTool is in the Final Testing phase; you may not vote.)\");\n             }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f7391c01de262c861ba09e1409c7596c15038e01"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ2NTM3NjE1", "url": "https://github.com/unicode-org/cldr/pull/870#pullrequestreview-546537615", "createdAt": "2020-12-07T21:08:28Z", "commit": {"oid": "f7391c01de262c861ba09e1409c7596c15038e01"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QyMTowODoyOFrOIA6xYA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QyMTowODoyOFrOIA6xYA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzgzMzgyNA==", "bodyText": "Somehow this template had \"CLDR_PHASE=BETA\" twice but only needs it once", "url": "https://github.com/unicode-org/cldr/pull/870#discussion_r537833824", "createdAt": "2020-12-07T21:08:28Z", "author": {"login": "btangmu"}, "path": "tools/scripts/ansible/templates/cldr-properties.j2", "diffHunk": "@@ -22,9 +22,6 @@ CLDR_OLDVERSION={{ surveytooldeploy.oldversion }}\n ## 'new'  version\n CLDR_NEWVERSION={{ surveytooldeploy.newversion }}\n \n-## Current SurveyTool phase \n-CLDR_PHASE=BETA\n-\n ## CLDR trunk. Default value shown", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f7391c01de262c861ba09e1409c7596c15038e01"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ2Njg5Mjc0", "url": "https://github.com/unicode-org/cldr/pull/870#pullrequestreview-546689274", "createdAt": "2020-12-08T02:05:15Z", "commit": {"oid": "f7391c01de262c861ba09e1409c7596c15038e01"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1827, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}