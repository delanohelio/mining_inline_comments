{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk1NzY5MjIz", "number": 747, "title": "CLDR-14205 Manual trigger for commit checker", "bodyText": "CLDR-14205\n\nnew ansible playbook for commit checker setup\nupdate ansible-lint task to run all playbooks\nupdate ansible-lint to lint yaml also\nnew workflow commit-checker (manually run)", "createdAt": "2020-09-30T20:28:24Z", "url": "https://github.com/unicode-org/cldr/pull/747", "merged": true, "mergeCommit": {"oid": "cd6ad4a7c233538343c474c14b372a21f8ef89f6"}, "closed": true, "closedAt": "2020-10-07T17:21:53Z", "author": {"login": "srl295"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdOC30KgBqjM4MjYzNDA4MDM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdQP4yzAFqTUwNDA3OTA5OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "240eef3461c1d939b0387c01cfff2256a0b669e6", "author": {"user": {"login": "srl295", "name": "Steven R. Loomis"}}, "url": "https://github.com/unicode-org/cldr/commit/240eef3461c1d939b0387c01cfff2256a0b669e6", "committedDate": "2020-09-30T20:25:27Z", "message": "CLDR-14205 Manual trigger for commit checker\n\n- new ansible playbook for commit checker setup\n- update ansible-lint task to run all playbooks\n- update ansible-lint to lint yaml also\n- new workflow commit-checker (manually run)"}, "afterCommit": {"oid": "5d488a5df0c05671ce85207d92c5b0b91a290b38", "author": {"user": {"login": "srl295", "name": "Steven R. Loomis"}}, "url": "https://github.com/unicode-org/cldr/commit/5d488a5df0c05671ce85207d92c5b0b91a290b38", "committedDate": "2020-09-30T20:32:37Z", "message": "CLDR-14205 Manual trigger for commit checker\n\n- new ansible playbook for commit checker setup\n- update ansible-lint task to run all playbooks\n- update ansible-lint to lint yaml also\n- new workflow commit-checker (manually run)"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAwMzQ2NzY2", "url": "https://github.com/unicode-org/cldr/pull/747#pullrequestreview-500346766", "createdAt": "2020-10-01T13:29:09Z", "commit": {"oid": "5d488a5df0c05671ce85207d92c5b0b91a290b38"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxMzoyOTowOVrOHbKbSQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxMzoyOTowOVrOHbKbSQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODI0NDQyNQ==", "bodyText": "When we switch the DNS and cldr-smoke2 becomes cldr-smoke, code like this will need updating, likewise for st2 and st ...", "url": "https://github.com/unicode-org/cldr/pull/747#discussion_r498244425", "createdAt": "2020-10-01T13:29:09Z", "author": {"login": "btangmu"}, "path": ".github/workflows/commit-checker.yml", "diffHunk": "@@ -0,0 +1,90 @@\n+# Manually run: commit checker\n+\n+name: commit-checker\n+\n+# Triggered on push to master,\n+# or PR against master.\n+on:\n+  workflow_dispatch:\n+    inputs:\n+      end-ref:\n+        description: CLDR Commit to check\n+        required: true\n+        default: 'master'\n+      fix-version:\n+        description: Fix Version (e.g. 38)\n+        default: 38 # TODO: remove, for testing only\n+        required: true\n+      last-version:\n+        description: Last Version (e.g. 37)\n+        default: 37 # TODO: remove, for testing only\n+        required: true\n+      tool-repository:\n+        description: Commit Checker ICU repo\n+        required: true\n+        default: 'srl295/icu' # TODO: remove use next, for testing only\n+        #default: 'unicode-org/icu'\n+      tool-ref:\n+        description: Commit Checker ICU ref\n+        required: true\n+        default: 'cldr-commit-checker' # TODO: remove, use next, for testing only\n+        # default: 'master'\n+jobs:\n+  build:\n+    name: Run Checker\n+    runs-on: ubuntu-latest\n+    steps:\n+      - name: clone CLDR\n+        uses: actions/checkout@v2.3.3\n+        with:\n+          ref: ${{ github.event.inputs.end-ref }}\n+          lfs: false # not needed here\n+          path: cldr\n+          fetch-depth: 0 # expensive, but needed for checker\n+      - name: clone ICU for tools\n+        uses: actions/checkout@v2.3.3\n+        with:\n+          repository: ${{ github.event.inputs.tool-repository }}\n+          ref: ${{ github.event.inputs.tool-ref }}\n+          lfs: false # not needed here\n+          path: icu\n+      #- name: Prepare Check\n+      - name: Run Check and Publish\n+        run: |\n+          END_HASH=$(cd ${GITHUB_WORKSPACE}/cldr ; git rev-parse --short HEAD )\n+          REPORT=\"CLDR-Report-\"$(date +\"%Y-%m-%d\")-v38-${END_HASH}\n+          echo $REPORT\n+          cd icu/tools/commit-checker\n+          command -v pipenv >/dev/null 2>/dev/null || sudo pip3 install pipenv\n+          pipenv install\n+          pipenv run python3 check.py \\\n+          --jira-query \"project=CLDR AND fixVersion=${FV}\" \\\n+          --repo-root ${GITHUB_WORKSPACE}/cldr \\\n+          --github-url https://github.com/unicode-org/cldr \\\n+          --rev-range \"release-${LV}..${END_REF}\" > ${GITHUB_WORKSPACE}/${REPORT}.md\n+          cd ${GITHUB_WORKSPACE}\n+          wc -l ${REPORT}.md\n+          npx markdown-to-html --flavor gfm --title ${REPORT} ${REPORT}.md -c unicode-org/cldr README.md --stylesheet github-markdown.css > ${REPORT}.html\n+          echo \"${RSA_KEY_CCC}\" > ${HOME}/.key && chmod go= ${HOME}/.key\n+          echo \"${CCC_KNOWNHOSTS}\" > ${HOME}/.knownhosts && chmod go= ${HOME}/.knownhosts\n+          ln ${REPORT}.md CLDR_REPORT.md # use a fixed name for the publish step\n+          scp -o UserKnownHostsFile=${HOME}/.knownhosts -i ${HOME}/.key -P ${CCC_PORT} ${REPORT}.md ${REPORT}.html ${CCC_USER}@${CCC_HOST}:public_html/\n+          echo \"Now go to https://cldr-smoke2.unicode.org/cldrcc/${REPORT}.html\"\n+        env:\n+          END_REF: ${{ github.event.inputs.end-ref }}\n+          FV: ${{ github.event.inputs.fix-version }}\n+          LV: ${{ github.event.inputs.last-version }}\n+          # the RSA key for connecting\n+          RSA_KEY_CCC: ${{ secrets.RSA_KEY_CCC }}\n+          # the SSH port\n+          CCC_USER: ${{ secrets.CCC_USER }}\n+          CCC_PORT: 22\n+          # the SSH host\n+          CCC_HOST: cldr-smoke2.unicode.org", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5d488a5df0c05671ce85207d92c5b0b91a290b38"}, "originalPosition": 83}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAwMzU0NjA4", "url": "https://github.com/unicode-org/cldr/pull/747#pullrequestreview-500354608", "createdAt": "2020-10-01T13:37:06Z", "commit": {"oid": "5d488a5df0c05671ce85207d92c5b0b91a290b38"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxMzozNzowNlrOHbKxXg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxMzozNzowNlrOHbKxXg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODI1MDA3OA==", "bodyText": "When can/should these defaults be changed or removed?", "url": "https://github.com/unicode-org/cldr/pull/747#discussion_r498250078", "createdAt": "2020-10-01T13:37:06Z", "author": {"login": "btangmu"}, "path": ".github/workflows/commit-checker.yml", "diffHunk": "@@ -0,0 +1,90 @@\n+# Manually run: commit checker\n+\n+name: commit-checker\n+\n+# Triggered on push to master,\n+# or PR against master.\n+on:\n+  workflow_dispatch:\n+    inputs:\n+      end-ref:\n+        description: CLDR Commit to check\n+        required: true\n+        default: 'master'\n+      fix-version:\n+        description: Fix Version (e.g. 38)\n+        default: 38 # TODO: remove, for testing only", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5d488a5df0c05671ce85207d92c5b0b91a290b38"}, "originalPosition": 16}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5d488a5df0c05671ce85207d92c5b0b91a290b38", "author": {"user": {"login": "srl295", "name": "Steven R. Loomis"}}, "url": "https://github.com/unicode-org/cldr/commit/5d488a5df0c05671ce85207d92c5b0b91a290b38", "committedDate": "2020-09-30T20:32:37Z", "message": "CLDR-14205 Manual trigger for commit checker\n\n- new ansible playbook for commit checker setup\n- update ansible-lint task to run all playbooks\n- update ansible-lint to lint yaml also\n- new workflow commit-checker (manually run)"}, "afterCommit": {"oid": "eb25155ecee1e0c2b5315cb6d08e5db6389f4c39", "author": {"user": {"login": "srl295", "name": "Steven R. Loomis"}}, "url": "https://github.com/unicode-org/cldr/commit/eb25155ecee1e0c2b5315cb6d08e5db6389f4c39", "committedDate": "2020-10-07T13:08:24Z", "message": "CLDR-14205 Manual trigger for commit checker\n\n- new ansible playbook for commit checker setup\n- update ansible-lint task to run all playbooks\n- update ansible-lint to lint yaml also\n- new workflow commit-checker (manually run)"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "eb25155ecee1e0c2b5315cb6d08e5db6389f4c39", "author": {"user": {"login": "srl295", "name": "Steven R. Loomis"}}, "url": "https://github.com/unicode-org/cldr/commit/eb25155ecee1e0c2b5315cb6d08e5db6389f4c39", "committedDate": "2020-10-07T13:08:24Z", "message": "CLDR-14205 Manual trigger for commit checker\n\n- new ansible playbook for commit checker setup\n- update ansible-lint task to run all playbooks\n- update ansible-lint to lint yaml also\n- new workflow commit-checker (manually run)"}, "afterCommit": {"oid": "2074ff0f8abd19ad22df5e172b207476efb77595", "author": {"user": {"login": "srl295", "name": "Steven R. Loomis"}}, "url": "https://github.com/unicode-org/cldr/commit/2074ff0f8abd19ad22df5e172b207476efb77595", "committedDate": "2020-10-07T13:26:42Z", "message": "CLDR-14205 Manual trigger for commit checker\n\n- new ansible playbook for commit checker setup\n- update ansible-lint task to run all playbooks\n- update ansible-lint to lint yaml also\n- new workflow commit-checker (manually run)\n- also fix a linting issue in the redact playbook [CLDR-14216]"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAzODc4NTc2", "url": "https://github.com/unicode-org/cldr/pull/747#pullrequestreview-503878576", "createdAt": "2020-10-07T13:28:55Z", "commit": {"oid": "2074ff0f8abd19ad22df5e172b207476efb77595"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QxMzoyODo1NVrOHdzWyg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QxMzoyODo1NVrOHdzWyg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTAxMjE3MA==", "bodyText": "@btangmu https://ansible-lint.readthedocs.io/en/latest/default_rules.html#commands-should-not-change-things-if-nothing-needs-doing normally ansible (it seems) wants to only change state to a fixed status. I think our usage of this playbook is fine, but we need to quell the linter warning.", "url": "https://github.com/unicode-org/cldr/pull/747#discussion_r501012170", "createdAt": "2020-10-07T13:28:55Z", "author": {"login": "srl295"}, "path": "tools/scripts/ansible/redact-db-playbook.yml", "diffHunk": "@@ -54,7 +54,8 @@\n         group: cldradmin\n         mode: '0640'\n     - name: fetch and unzip db\n-      command: bash /home/cldradmin/fetch-db.sh", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2074ff0f8abd19ad22df5e172b207476efb77595"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAzOTc2Mzg3", "url": "https://github.com/unicode-org/cldr/pull/747#pullrequestreview-503976387", "createdAt": "2020-10-07T15:00:34Z", "commit": {"oid": "2074ff0f8abd19ad22df5e172b207476efb77595"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5ba4f274c3c2c54ff4636865f39043f06b7292a8", "author": {"user": {"login": "srl295", "name": "Steven R. Loomis"}}, "url": "https://github.com/unicode-org/cldr/commit/5ba4f274c3c2c54ff4636865f39043f06b7292a8", "committedDate": "2020-10-07T16:40:45Z", "message": "CLDR-14205 Manual trigger for commit checker\n\n- new ansible playbook for commit checker setup\n- update ansible-lint task to run all playbooks\n- update ansible-lint to lint yaml also\n- new workflow commit-checker (manually run)\n- also fix a linting issue in the redact playbook [CLDR-14216]"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2074ff0f8abd19ad22df5e172b207476efb77595", "author": {"user": {"login": "srl295", "name": "Steven R. Loomis"}}, "url": "https://github.com/unicode-org/cldr/commit/2074ff0f8abd19ad22df5e172b207476efb77595", "committedDate": "2020-10-07T13:26:42Z", "message": "CLDR-14205 Manual trigger for commit checker\n\n- new ansible playbook for commit checker setup\n- update ansible-lint task to run all playbooks\n- update ansible-lint to lint yaml also\n- new workflow commit-checker (manually run)\n- also fix a linting issue in the redact playbook [CLDR-14216]"}, "afterCommit": {"oid": "5ba4f274c3c2c54ff4636865f39043f06b7292a8", "author": {"user": {"login": "srl295", "name": "Steven R. Loomis"}}, "url": "https://github.com/unicode-org/cldr/commit/5ba4f274c3c2c54ff4636865f39043f06b7292a8", "committedDate": "2020-10-07T16:40:45Z", "message": "CLDR-14205 Manual trigger for commit checker\n\n- new ansible playbook for commit checker setup\n- update ansible-lint task to run all playbooks\n- update ansible-lint to lint yaml also\n- new workflow commit-checker (manually run)\n- also fix a linting issue in the redact playbook [CLDR-14216]"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA0MDc5MDk4", "url": "https://github.com/unicode-org/cldr/pull/747#pullrequestreview-504079098", "createdAt": "2020-10-07T16:50:38Z", "commit": {"oid": "5ba4f274c3c2c54ff4636865f39043f06b7292a8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1865, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}