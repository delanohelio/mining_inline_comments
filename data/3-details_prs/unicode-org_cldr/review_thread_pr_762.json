{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk4MTQ1MDAx", "number": 762, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQyMzowOToxMVrOEqgtVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQyMzowOToxMVrOEqgtVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzEzMDExNTQwOnYy", "diffSide": "RIGHT", "path": "tools/scripts/ansible/redact-db-playbook.yml", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQyMzowOToxMVrOHcwrgQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxNDoyMTozOVrOHdJfxQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTkxOTc0NQ==", "bodyText": "good, so this one is a little different than other playbooks in that it is meant to be run only when redact is needed. Sounds good.  It's not included in setup playbook, for example.", "url": "https://github.com/unicode-org/cldr/pull/762#discussion_r499919745", "createdAt": "2020-10-05T23:09:11Z", "author": {"login": "srl295"}, "path": "tools/scripts/ansible/redact-db-playbook.yml", "diffHunk": "@@ -0,0 +1,73 @@\n+- hosts: redactdb\n+  vars_files:\n+    - vars/main.yml\n+    - local-vars/local.yml\n+  tasks:\n+    - name: set up /home/cldradmin/.ssh/config to fetch db backup\n+      template:\n+        src: templates/cldrbackup/config.j2\n+        dest: /home/cldradmin/.ssh/config\n+        owner: cldradmin\n+        group: cldradmin\n+        mode: '0640'\n+    - name: set up /home/cldradmin/.ssh/id_rsa\n+      no_log: true\n+      copy:\n+        src: local-vars/cldrbackup/id_rsa\n+        dest: /home/cldradmin/.ssh/id_rsa\n+        owner: cldradmin\n+        group: cldradmin\n+        mode: '0600'\n+    - name: set up /home/cldradmin/.ssh/id_rsa.pub\n+      copy:\n+        src: local-vars/cldrbackup/id_rsa.pub\n+        dest: /home/cldradmin/.ssh/id_rsa.pub\n+        owner: cldradmin\n+        group: cldradmin\n+        mode: '0640'\n+    - name: set up /home/cldradmin/.ssh/known_hosts\n+      copy:\n+        src: local-vars/cldrbackup/known_hosts\n+        dest: /home/cldradmin/.ssh/known_hosts\n+        owner: cldradmin\n+        group: cldradmin\n+        mode: '0640'\n+    - name: set up /home/cldradmin/redact-db.sql\n+      copy:\n+        src: templates/cldrbackup/redact-db.sql\n+        dest: /home/cldradmin/redact-db.sql\n+        owner: cldradmin\n+        group: cldradmin\n+        mode: '0640'\n+    - name: set up /home/cldradmin/fetch-db.sh\n+      template:\n+        src: templates/cldrbackup/fetch_db_sh.j2\n+        dest: /home/cldradmin/fetch-db.sh\n+        owner: cldradmin\n+        group: cldradmin\n+        mode: '0640'\n+    - name: set up /home/cldradmin/redact-db.sh\n+      template:\n+        src: templates/cldrbackup/redact_db_sh.j2\n+        dest: /home/cldradmin/redact-db.sh\n+        owner: cldradmin\n+        group: cldradmin\n+        mode: '0640'\n+    - name: fetch and unzip db\n+      command: bash /home/cldradmin/fetch-db.sh\n+      become: yes\n+      become_user: cldradmin\n+    - name: stop tomcat\n+      become: true\n+      service:\n+        name: tomcat8\n+        state: stopped\n+    - name: redact db\n+      command: bash /home/cldradmin/redact-db.sh", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a8b7d19b95ed4723ada5c862b316c26cd291bd6f"}, "originalPosition": 66}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDI5MTE1MA==", "bodyText": "Right. Running redact-db-playbook.yml is a manual operation that combines configuration with performing an actual redaction. Everything is in Ansible. In the long run we might use a cron job and/or a button like https://github.com/unicode-org/cldr/actions?query=workflow%3Aproduction for the redaction itself. Configuration  without immediately doing the redaction itself should be enabled and probably included in setup-playbook.yml. What do you think?", "url": "https://github.com/unicode-org/cldr/pull/762#discussion_r500291150", "createdAt": "2020-10-06T13:45:18Z", "author": {"login": "btangmu"}, "path": "tools/scripts/ansible/redact-db-playbook.yml", "diffHunk": "@@ -0,0 +1,73 @@\n+- hosts: redactdb\n+  vars_files:\n+    - vars/main.yml\n+    - local-vars/local.yml\n+  tasks:\n+    - name: set up /home/cldradmin/.ssh/config to fetch db backup\n+      template:\n+        src: templates/cldrbackup/config.j2\n+        dest: /home/cldradmin/.ssh/config\n+        owner: cldradmin\n+        group: cldradmin\n+        mode: '0640'\n+    - name: set up /home/cldradmin/.ssh/id_rsa\n+      no_log: true\n+      copy:\n+        src: local-vars/cldrbackup/id_rsa\n+        dest: /home/cldradmin/.ssh/id_rsa\n+        owner: cldradmin\n+        group: cldradmin\n+        mode: '0600'\n+    - name: set up /home/cldradmin/.ssh/id_rsa.pub\n+      copy:\n+        src: local-vars/cldrbackup/id_rsa.pub\n+        dest: /home/cldradmin/.ssh/id_rsa.pub\n+        owner: cldradmin\n+        group: cldradmin\n+        mode: '0640'\n+    - name: set up /home/cldradmin/.ssh/known_hosts\n+      copy:\n+        src: local-vars/cldrbackup/known_hosts\n+        dest: /home/cldradmin/.ssh/known_hosts\n+        owner: cldradmin\n+        group: cldradmin\n+        mode: '0640'\n+    - name: set up /home/cldradmin/redact-db.sql\n+      copy:\n+        src: templates/cldrbackup/redact-db.sql\n+        dest: /home/cldradmin/redact-db.sql\n+        owner: cldradmin\n+        group: cldradmin\n+        mode: '0640'\n+    - name: set up /home/cldradmin/fetch-db.sh\n+      template:\n+        src: templates/cldrbackup/fetch_db_sh.j2\n+        dest: /home/cldradmin/fetch-db.sh\n+        owner: cldradmin\n+        group: cldradmin\n+        mode: '0640'\n+    - name: set up /home/cldradmin/redact-db.sh\n+      template:\n+        src: templates/cldrbackup/redact_db_sh.j2\n+        dest: /home/cldradmin/redact-db.sh\n+        owner: cldradmin\n+        group: cldradmin\n+        mode: '0640'\n+    - name: fetch and unzip db\n+      command: bash /home/cldradmin/fetch-db.sh\n+      become: yes\n+      become_user: cldradmin\n+    - name: stop tomcat\n+      become: true\n+      service:\n+        name: tomcat8\n+        state: stopped\n+    - name: redact db\n+      command: bash /home/cldradmin/redact-db.sh", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTkxOTc0NQ=="}, "originalCommit": {"oid": "a8b7d19b95ed4723ada5c862b316c26cd291bd6f"}, "originalPosition": 66}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDMyNjM0MQ==", "bodyText": "Configuration without immediately doing the redaction itself should be enabled and probably included in setup-playbook.yml.\n\nI think this is fine how it is for now, because we might adjust the parameters in between redaction.\nIf we were automating the redaction, then yes it would move to setup-playbook.", "url": "https://github.com/unicode-org/cldr/pull/762#discussion_r500326341", "createdAt": "2020-10-06T14:21:39Z", "author": {"login": "srl295"}, "path": "tools/scripts/ansible/redact-db-playbook.yml", "diffHunk": "@@ -0,0 +1,73 @@\n+- hosts: redactdb\n+  vars_files:\n+    - vars/main.yml\n+    - local-vars/local.yml\n+  tasks:\n+    - name: set up /home/cldradmin/.ssh/config to fetch db backup\n+      template:\n+        src: templates/cldrbackup/config.j2\n+        dest: /home/cldradmin/.ssh/config\n+        owner: cldradmin\n+        group: cldradmin\n+        mode: '0640'\n+    - name: set up /home/cldradmin/.ssh/id_rsa\n+      no_log: true\n+      copy:\n+        src: local-vars/cldrbackup/id_rsa\n+        dest: /home/cldradmin/.ssh/id_rsa\n+        owner: cldradmin\n+        group: cldradmin\n+        mode: '0600'\n+    - name: set up /home/cldradmin/.ssh/id_rsa.pub\n+      copy:\n+        src: local-vars/cldrbackup/id_rsa.pub\n+        dest: /home/cldradmin/.ssh/id_rsa.pub\n+        owner: cldradmin\n+        group: cldradmin\n+        mode: '0640'\n+    - name: set up /home/cldradmin/.ssh/known_hosts\n+      copy:\n+        src: local-vars/cldrbackup/known_hosts\n+        dest: /home/cldradmin/.ssh/known_hosts\n+        owner: cldradmin\n+        group: cldradmin\n+        mode: '0640'\n+    - name: set up /home/cldradmin/redact-db.sql\n+      copy:\n+        src: templates/cldrbackup/redact-db.sql\n+        dest: /home/cldradmin/redact-db.sql\n+        owner: cldradmin\n+        group: cldradmin\n+        mode: '0640'\n+    - name: set up /home/cldradmin/fetch-db.sh\n+      template:\n+        src: templates/cldrbackup/fetch_db_sh.j2\n+        dest: /home/cldradmin/fetch-db.sh\n+        owner: cldradmin\n+        group: cldradmin\n+        mode: '0640'\n+    - name: set up /home/cldradmin/redact-db.sh\n+      template:\n+        src: templates/cldrbackup/redact_db_sh.j2\n+        dest: /home/cldradmin/redact-db.sh\n+        owner: cldradmin\n+        group: cldradmin\n+        mode: '0640'\n+    - name: fetch and unzip db\n+      command: bash /home/cldradmin/fetch-db.sh\n+      become: yes\n+      become_user: cldradmin\n+    - name: stop tomcat\n+      become: true\n+      service:\n+        name: tomcat8\n+        state: stopped\n+    - name: redact db\n+      command: bash /home/cldradmin/redact-db.sh", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTkxOTc0NQ=="}, "originalCommit": {"oid": "a8b7d19b95ed4723ada5c862b316c26cd291bd6f"}, "originalPosition": 66}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 314, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}