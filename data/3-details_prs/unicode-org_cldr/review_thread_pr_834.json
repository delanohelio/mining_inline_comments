{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE2OTMyMTk2", "number": 834, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxOTowNDozN1rOE3Xz6Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxNToyNTo1NVrOE3wIzw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI2NDk3MjU3OnYy", "diffSide": "RIGHT", "path": "tools/java/src/main/java/org/unicode/cldr/json/Ldml2JsonConverter.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxOTowNDozN1rOHwrhoQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxOTowNDozN1rOHwrhoQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDgwNjgxNw==", "bodyText": "This block could be a subroutine. convertCldrItems is about 246 lines currently, way more than one screenful", "url": "https://github.com/unicode-org/cldr/pull/834#discussion_r520806817", "createdAt": "2020-11-10T19:04:37Z", "author": {"login": "btangmu"}, "path": "tools/java/src/main/java/org/unicode/cldr/json/Ldml2JsonConverter.java", "diffHunk": "@@ -546,23 +547,16 @@ private int convertCldrItems(AtomicInteger readCount, int totalCount,\n                             throw new IllegalArgumentException(\"empty xpath in \" + filename + \" section \" + js.packageName + \"/\" + js.section);\n                         }\n                         if (type == RunType.rbnf) {\n-                            item.setValue(item.getValue().replace('\u2192', '>'));\n-                            item.setValue(item.getValue().replace('\u2190', '<'));\n-                            if (item.getFullPath().contains(\"@value\")) {\n-                                int indexStart = item.getFullPath().indexOf(\"@value\") + 8;\n-                                int indexEnd = item.getFullPath().indexOf(\"]\", indexStart) - 1;\n-                                if (indexStart >= 0 && indexEnd >= 0 && indexEnd > indexStart) {\n-                                    String sub = item.getFullPath().substring(indexStart, indexEnd);\n-                                    /* System.out.println(\"sub: \" + sub);\n-                                    System.out.println(\"full: \" + item.getFullPath());\n-                                    System.out.println(\"val: \" + item.getValue());*/\n-                                    item.setFullPath(item.getFullPath().replace(sub, item.getValue()));\n-                                    item.setFullPath(item.getFullPath().replaceAll(\"@value\", \"@\" + sub));\n-                                    //System.out.println(\"modifyfull: \" + item.getFullPath());\n-                                    item.setValue(\"\");\n-                                }\n+                            XPathParts xpp = XPathParts.getFrozenInstance(item.getFullPath());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed508745560722e042c030b133f24b82d8f87616"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI2NDk4MTY5OnYy", "diffSide": "RIGHT", "path": "tools/java/src/main/java/org/unicode/cldr/json/Ldml2JsonConverter.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxOTowNzoyMlrOHwrnZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxOTowNzo0MFrOHwroBQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDgwODI5Mw==", "bodyText": "Delete rather than comment out? Recent best practice for \"clean code\" is \"no commented-out code\"", "url": "https://github.com/unicode-org/cldr/pull/834#discussion_r520808293", "createdAt": "2020-11-10T19:07:22Z", "author": {"login": "btangmu"}, "path": "tools/java/src/main/java/org/unicode/cldr/json/Ldml2JsonConverter.java", "diffHunk": "@@ -973,7 +967,7 @@ private void resolveArrayItems(JsonWriter out,\n         ArrayList<CldrNode> nodesForLastItem,\n         ArrayList<CldrItem> arrayItems)\n         throws IOException, ParseException {\n-        boolean rbnfFlag = false;\n+//        boolean rbnfFlag = false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed508745560722e042c030b133f24b82d8f87616"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDgwODQ1Mw==", "bodyText": "Same below", "url": "https://github.com/unicode-org/cldr/pull/834#discussion_r520808453", "createdAt": "2020-11-10T19:07:40Z", "author": {"login": "btangmu"}, "path": "tools/java/src/main/java/org/unicode/cldr/json/Ldml2JsonConverter.java", "diffHunk": "@@ -973,7 +967,7 @@ private void resolveArrayItems(JsonWriter out,\n         ArrayList<CldrNode> nodesForLastItem,\n         ArrayList<CldrItem> arrayItems)\n         throws IOException, ParseException {\n-        boolean rbnfFlag = false;\n+//        boolean rbnfFlag = false;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDgwODI5Mw=="}, "originalCommit": {"oid": "ed508745560722e042c030b133f24b82d8f87616"}, "originalPosition": 46}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI2NDk4Njc1OnYy", "diffSide": "RIGHT", "path": "tools/java/src/main/java/org/unicode/cldr/json/Ldml2JsonConverter.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxOTowODo1OFrOHwrqlw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxOTowODo1OFrOHwrqlw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDgwOTExMQ==", "bodyText": "Subroutine? outputArrayItem is over 100 lines", "url": "https://github.com/unicode-org/cldr/pull/834#discussion_r520809111", "createdAt": "2020-11-10T19:08:58Z", "author": {"login": "btangmu"}, "path": "tools/java/src/main/java/org/unicode/cldr/json/Ldml2JsonConverter.java", "diffHunk": "@@ -1274,10 +1268,17 @@ private void outputArrayItem(JsonWriter out, CldrItem item,\n             } else {\n                 if (!objName.equals(\"rbnfrule\")) {\n                     out.beginObject();\n-                }\n-                writeLeafNode(out, objName, attrAsValueMap, value, nodesNum, cldrNode.getName());\n-                if (!objName.equals(\"rbnfrule\")) {\n+                    writeLeafNode(out, objName, attrAsValueMap, value, nodesNum, cldrNode.getName());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed508745560722e042c030b133f24b82d8f87616"}, "originalPosition": 105}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI2ODk1ODIzOnYy", "diffSide": "RIGHT", "path": "tools/java/src/main/java/org/unicode/cldr/json/Ldml2JsonConverter.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxNToyNTo1NVrOHxR66A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMVQxNjoyMDo0OVrOHxUQUA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTQzNTg4MA==", "bodyText": "@btangmu I completely missed that there are two \"if(type == RunType.rbnf)\" conditionals right after another. Will fix.", "url": "https://github.com/unicode-org/cldr/pull/834#discussion_r521435880", "createdAt": "2020-11-11T15:25:55Z", "author": {"login": "srl295"}, "path": "tools/java/src/main/java/org/unicode/cldr/json/Ldml2JsonConverter.java", "diffHunk": "@@ -546,23 +547,16 @@ private int convertCldrItems(AtomicInteger readCount, int totalCount,\n                             throw new IllegalArgumentException(\"empty xpath in \" + filename + \" section \" + js.packageName + \"/\" + js.section);\n                         }\n                         if (type == RunType.rbnf) {\n-                            item.setValue(item.getValue().replace('\u2192', '>'));\n-                            item.setValue(item.getValue().replace('\u2190', '<'));\n-                            if (item.getFullPath().contains(\"@value\")) {\n-                                int indexStart = item.getFullPath().indexOf(\"@value\") + 8;\n-                                int indexEnd = item.getFullPath().indexOf(\"]\", indexStart) - 1;\n-                                if (indexStart >= 0 && indexEnd >= 0 && indexEnd > indexStart) {\n-                                    String sub = item.getFullPath().substring(indexStart, indexEnd);\n-                                    /* System.out.println(\"sub: \" + sub);\n-                                    System.out.println(\"full: \" + item.getFullPath());\n-                                    System.out.println(\"val: \" + item.getValue());*/\n-                                    item.setFullPath(item.getFullPath().replace(sub, item.getValue()));\n-                                    item.setFullPath(item.getFullPath().replaceAll(\"@value\", \"@\" + sub));\n-                                    //System.out.println(\"modifyfull: \" + item.getFullPath());\n-                                    item.setValue(\"\");\n-                                }\n+                            XPathParts xpp = XPathParts.getFrozenInstance(item.getFullPath());\n+                            final String sub = xpp.findAttributeValue(\"rbnfrule\", \"value\");\n+                            if(sub != null){\n+                                xpp = xpp.cloneAsThawed();\n+                                final String value = item.getValue();\n+                                xpp.removeAttribute(-1, \"value\");\n+                                xpp.addAttribute(sub, value);\n+                                item.setFullPath(xpp.toString());\n+                                item.setValue(\"\");\n                             }\n-\n                         }\n                         // ADJUST ACCESS=PRIVATE/PUBLIC BASED ON ICU RULE -- START\n                         if (type == RunType.rbnf) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed508745560722e042c030b133f24b82d8f87616"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTQ3NDEyOA==", "bodyText": "I missed that too", "url": "https://github.com/unicode-org/cldr/pull/834#discussion_r521474128", "createdAt": "2020-11-11T16:20:49Z", "author": {"login": "btangmu"}, "path": "tools/java/src/main/java/org/unicode/cldr/json/Ldml2JsonConverter.java", "diffHunk": "@@ -546,23 +547,16 @@ private int convertCldrItems(AtomicInteger readCount, int totalCount,\n                             throw new IllegalArgumentException(\"empty xpath in \" + filename + \" section \" + js.packageName + \"/\" + js.section);\n                         }\n                         if (type == RunType.rbnf) {\n-                            item.setValue(item.getValue().replace('\u2192', '>'));\n-                            item.setValue(item.getValue().replace('\u2190', '<'));\n-                            if (item.getFullPath().contains(\"@value\")) {\n-                                int indexStart = item.getFullPath().indexOf(\"@value\") + 8;\n-                                int indexEnd = item.getFullPath().indexOf(\"]\", indexStart) - 1;\n-                                if (indexStart >= 0 && indexEnd >= 0 && indexEnd > indexStart) {\n-                                    String sub = item.getFullPath().substring(indexStart, indexEnd);\n-                                    /* System.out.println(\"sub: \" + sub);\n-                                    System.out.println(\"full: \" + item.getFullPath());\n-                                    System.out.println(\"val: \" + item.getValue());*/\n-                                    item.setFullPath(item.getFullPath().replace(sub, item.getValue()));\n-                                    item.setFullPath(item.getFullPath().replaceAll(\"@value\", \"@\" + sub));\n-                                    //System.out.println(\"modifyfull: \" + item.getFullPath());\n-                                    item.setValue(\"\");\n-                                }\n+                            XPathParts xpp = XPathParts.getFrozenInstance(item.getFullPath());\n+                            final String sub = xpp.findAttributeValue(\"rbnfrule\", \"value\");\n+                            if(sub != null){\n+                                xpp = xpp.cloneAsThawed();\n+                                final String value = item.getValue();\n+                                xpp.removeAttribute(-1, \"value\");\n+                                xpp.addAttribute(sub, value);\n+                                item.setFullPath(xpp.toString());\n+                                item.setValue(\"\");\n                             }\n-\n                         }\n                         // ADJUST ACCESS=PRIVATE/PUBLIC BASED ON ICU RULE -- START\n                         if (type == RunType.rbnf) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTQzNTg4MA=="}, "originalCommit": {"oid": "ed508745560722e042c030b133f24b82d8f87616"}, "originalPosition": 40}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 259, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}