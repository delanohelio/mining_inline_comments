{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ3OTEyNDQ1", "number": 560, "title": "CLDR-13947 Revamp checking for placeholders, add tests", "bodyText": "Checklist\n\n Issue filed: https://unicode-org.atlassian.net/browse/CLDR-13947\n Updated PR title and link in previous line to include Issue number", "createdAt": "2020-07-12T15:06:27Z", "url": "https://github.com/unicode-org/cldr/pull/560", "merged": true, "mergeCommit": {"oid": "2fe9b0f0b743920f71c2f8aaf0f34d7a1b12d717"}, "closed": true, "closedAt": "2020-07-13T14:51:54Z", "author": {"login": "macchiati"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc0OPXgAH2gAyNDQ3OTEyNDQ1OmZiNWY4YWVlMDhhNjVhOGUwYThjMzAzNDVhYTNkMzJmZWRmOGMwOTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc0ioa8AFqTQ0NzI3NzgzOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "fb5f8aee08a65a8e0a8c30345aa3d32fedf8c099", "author": {"user": {"login": "macchiati", "name": "Mark Davis"}}, "url": "https://github.com/unicode-org/cldr/commit/fb5f8aee08a65a8e0a8c30345aa3d32fedf8c099", "committedDate": "2020-07-12T15:05:36Z", "message": "CLDR-13947 Revamp checking for placeholders, add tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5a3bf19e78038916461d2ed493111fea5633fa23", "author": {"user": {"login": "macchiati", "name": "Mark Davis"}}, "url": "https://github.com/unicode-org/cldr/commit/5a3bf19e78038916461d2ed493111fea5633fa23", "committedDate": "2020-07-13T04:19:27Z", "message": "CLDR-13947 Cleaned up tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bc9cf4dc50fa172243045f8b8fc249ed163e2b75", "author": {"user": {"login": "macchiati", "name": "Mark Davis"}}, "url": "https://github.com/unicode-org/cldr/commit/bc9cf4dc50fa172243045f8b8fc249ed163e2b75", "committedDate": "2020-07-13T05:13:58Z", "message": "CLDR-13947 fix test to allow multiple errors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "95f68b9f433fde222121b6dcc0eab5a571fd8a5c", "author": {"user": {"login": "macchiati", "name": "Mark Davis"}}, "url": "https://github.com/unicode-org/cldr/commit/95f68b9f433fde222121b6dcc0eab5a571fd8a5c", "committedDate": "2020-07-13T13:56:50Z", "message": "CLDR-13947 work around problem in ICU plural rules"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ3MjgyMzIy", "url": "https://github.com/unicode-org/cldr/pull/560#pullrequestreview-447282322", "createdAt": "2020-07-13T14:04:29Z", "commit": {"oid": "95f68b9f433fde222121b6dcc0eab5a571fd8a5c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ3Mjc3ODM5", "url": "https://github.com/unicode-org/cldr/pull/560#pullrequestreview-447277839", "createdAt": "2020-07-13T13:59:31Z", "commit": {"oid": "95f68b9f433fde222121b6dcc0eab5a571fd8a5c"}, "state": "COMMENTED", "comments": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxMzo1OTozMlrOGwp21Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxNDo1MDo0NFrOGwsErA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzY3MDYxMw==", "bodyText": "Fix missing placeholder in de", "url": "https://github.com/unicode-org/cldr/pull/560#discussion_r453670613", "createdAt": "2020-07-13T13:59:32Z", "author": {"login": "macchiati"}, "path": "common/main/de.xml", "diffHunk": "@@ -8493,7 +8493,7 @@ Warnings: All cp values have U+FE0F characters removed. See /annotationsDerived/\n \t\t\t</unit>\n \t\t\t<unit type=\"force-pound-force\">\n \t\t\t\t<displayName>\u2191\u2191\u2191</displayName>\n-\t\t\t\t<unitPattern count=\"one\">Pound-force</unitPattern>\n+\t\t\t\t<unitPattern count=\"one\" draft=\"provisional\">{0} Pound-force</unitPattern>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "95f68b9f433fde222121b6dcc0eab5a571fd8a5c"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzcwNDE5OQ==", "bodyText": "Add specific test cases to check each option.", "url": "https://github.com/unicode-org/cldr/pull/560#discussion_r453704199", "createdAt": "2020-07-13T14:47:06Z", "author": {"login": "macchiati"}, "path": "tools/cldr-unittest/src/org/unicode/cldr/unittest/TestCheckCLDR.java", "diffHunk": "@@ -181,11 +180,77 @@ public void TestTestCache() {\n \n     private static final boolean DEBUG = true;\n \n+    public void testPlaceholderSamples() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "95f68b9f433fde222121b6dcc0eab5a571fd8a5c"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzcwNDYzMw==", "bodyText": "Revamp the old testing code, since it is not find-grained enough to be accurate.", "url": "https://github.com/unicode-org/cldr/pull/560#discussion_r453704633", "createdAt": "2020-07-13T14:47:43Z", "author": {"login": "macchiati"}, "path": "tools/cldr-unittest/src/org/unicode/cldr/unittest/TestCheckCLDR.java", "diffHunk": "@@ -215,79 +280,43 @@ public void checkPlaceholders(CLDRFile cldrFileToTest) {\n             String path = pathHeader.getOriginalPath();\n             String value = cldrFileToTest.getStringValue(path);\n             if (value == null) {\n-                value = \"?\";\n+                continue;\n             }\n             boolean containsMessagePattern = messagePlaceholder.reset(value)\n                 .find();\n             final Map<String, PlaceholderInfo> placeholderInfo = patternPlaceholders\n                 .get(path);\n             final PlaceholderStatus placeholderStatus = patternPlaceholders\n                 .getStatus(path);\n-            if (containsMessagePattern && placeholderStatus == PlaceholderStatus.DISALLOWED", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "95f68b9f433fde222121b6dcc0eab5a571fd8a5c"}, "originalPosition": 99}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzcwNDk4Nw==", "bodyText": "Add utility for creating test factory.", "url": "https://github.com/unicode-org/cldr/pull/560#discussion_r453704987", "createdAt": "2020-07-13T14:48:13Z", "author": {"login": "macchiati"}, "path": "tools/cldr-unittest/src/org/unicode/cldr/unittest/TestCheckCLDR.java", "diffHunk": "@@ -504,6 +529,15 @@ public void TestCheckNewRootFailure() {\n         }\n     }\n \n+    public TestFactory makeTestFactory(CLDRFile root, XMLSource localeSource) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "95f68b9f433fde222121b6dcc0eab5a571fd8a5c"}, "originalPosition": 207}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzcwNTUzMg==", "bodyText": "Revamp test code to be more precise.", "url": "https://github.com/unicode-org/cldr/pull/560#discussion_r453705532", "createdAt": "2020-07-13T14:48:57Z", "author": {"login": "macchiati"}, "path": "tools/java/org/unicode/cldr/test/CheckForExemplars.java", "diffHunk": "@@ -463,88 +469,88 @@ public CheckCLDR handleCheck(String path, String fullPath, String value,\n     }\n \n     private String checkAndReplacePlaceholders(String path, String value, List<CheckStatus> result) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "95f68b9f433fde222121b6dcc0eab5a571fd8a5c"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzcwNjE4Mw==", "bodyText": "Broaden the search so that we don't miss cases like {10}.", "url": "https://github.com/unicode-org/cldr/pull/560#discussion_r453706183", "createdAt": "2020-07-13T14:49:49Z", "author": {"login": "macchiati"}, "path": "tools/java/org/unicode/cldr/test/ExampleGenerator.java", "diffHunk": "@@ -2008,8 +2008,8 @@ private String removeEmptyRuns(String input) {\n             .replace(backgroundEndSymbol + backgroundStartSymbol, \"\");\n     }\n \n-    public static final Pattern PARAMETER = PatternCache.get(\"(\\\\{[0-9]\\\\})\");\n-    public static final Pattern PARAMETER_SKIP0 = PatternCache.get(\"(\\\\{[1-9]\\\\})\");\n+    public static final Pattern PARAMETER = PatternCache.get(\"(\\\\{(?:0|[1-9][0-9]*)\\\\})\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "95f68b9f433fde222121b6dcc0eab5a571fd8a5c"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzcwNjYyMQ==", "bodyText": "Drop Optional, which was not used. Fix explanations.", "url": "https://github.com/unicode-org/cldr/pull/560#discussion_r453706621", "createdAt": "2020-07-13T14:50:22Z", "author": {"login": "macchiati"}, "path": "tools/java/org/unicode/cldr/util/PatternPlaceholders.java", "diffHunk": "@@ -5,27 +5,40 @@\n import java.util.Map;\n import java.util.Map.Entry;\n \n+import org.unicode.cldr.test.CheckCLDR.CheckStatus.Subtype;\n import org.unicode.cldr.tool.GenerateXMB;\n import org.unicode.cldr.util.RegexLookup.Merger;\n \n+import com.google.common.collect.ImmutableMap;\n+import com.google.common.collect.ImmutableSet;\n import com.ibm.icu.text.Transform;\n \n public class PatternPlaceholders {\n \n     public enum PlaceholderStatus {\n-        DISALLOWED(\"No placeholders allowed.\"), //\n-        OPTIONAL(\"Zero or one placeholder allowed.\"), //\n-        MULTIPLE(\"Zero or more placeholders allowed.\"), //\n-        LOCALE_DEPENDENT( \"Varies by locale.\"),\n-        REQUIRED(\"Placeholder required\");\n+        DISALLOWED(\"No placeholders allowed.\"),//", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "95f68b9f433fde222121b6dcc0eab5a571fd8a5c"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzcwNjkyNA==", "bodyText": "drop optional, since it is not used.", "url": "https://github.com/unicode-org/cldr/pull/560#discussion_r453706924", "createdAt": "2020-07-13T14:50:44Z", "author": {"login": "macchiati"}, "path": "tools/java/org/unicode/cldr/util/data/Placeholders.txt", "diffHunk": "@@ -1,10 +1,9 @@\n #Remember to quote any [ character!\n # The default is DISALLOWED for anything not in this file.\n-# The default for everything in this file is REQUIRED.\n-# That default is overridden if the line has as the X parameter: locale, optional, or multiple.\n-#\toptional: there may or may not be a placeholder.\n-#\tlocale: there is a count= or ordinal=, so the value is subject to the locale.\n-#\tmultiple: there may be one or more placeholders (normally only in minimalPairs)\n+# The default for everything in this file is REQUIRED, meaning that the number of placeholders has to match the number in the final field.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "95f68b9f433fde222121b6dcc0eab5a571fd8a5c"}, "originalPosition": 8}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1994, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}