{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQwOTUyNDYz", "number": 681, "title": "CXF-8099: mask sensitive logging elements", "bodyText": "Added an option to mask sensible XML and JSON elements in logging", "createdAt": "2020-06-27T19:30:03Z", "url": "https://github.com/apache/cxf/pull/681", "merged": true, "mergeCommit": {"oid": "b3b7e59b35a3ca85200e7603b85a2fc84b65b2bf"}, "closed": true, "closedAt": "2020-07-23T22:24:53Z", "author": {"login": "ashakirin"}, "timelineItems": {"totalCount": 21, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcvc9vTAH2gAyNDQwOTUyNDYzOjY4NzBiMDQwNDUyMDMyYzU1N2VjNmE5M2FmNzE3MTM5NzM3ODAxZmQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc3jFZEgH2gAyNDQwOTUyNDYzOmYzMzdmMjU1YmE0MWFjNjA3ZjU1OGMwZDM2YjNmOGRiMmY4ZmJhODk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6870b040452032c557ec6a93af717139737801fd", "author": {"user": {"login": "ashakirin-talend", "name": null}}, "url": "https://github.com/apache/cxf/commit/6870b040452032c557ec6a93af717139737801fd", "committedDate": "2020-06-27T19:25:18Z", "message": "CXF-8099: mask sensitive logging elements"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4NzE5ODY0", "url": "https://github.com/apache/cxf/pull/681#pullrequestreview-438719864", "createdAt": "2020-06-27T19:33:22Z", "commit": {"oid": "6870b040452032c557ec6a93af717139737801fd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yN1QxOTozMzoyMlrOGp319Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yN1QxOTozMzoyMlrOGp319Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjU1OTczMw==", "bodyText": "maybe a bit overkill for the actual usage? IMHO it would be great to drop or reuse cxf utils.", "url": "https://github.com/apache/cxf/pull/681#discussion_r446559733", "createdAt": "2020-06-27T19:33:22Z", "author": {"login": "rmannibucau"}, "path": "rt/features/logging/pom.xml", "diffHunk": "@@ -38,6 +38,10 @@\n             <groupId>org.slf4j</groupId>\n             <artifactId>slf4j-api</artifactId>\n         </dependency>\n+        <dependency>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6870b040452032c557ec6a93af717139737801fd"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5ODcyNzc4", "url": "https://github.com/apache/cxf/pull/681#pullrequestreview-439872778", "createdAt": "2020-06-30T10:14:24Z", "commit": {"oid": "6870b040452032c557ec6a93af717139737801fd"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQxMDoxNDoyNFrOGq1qJw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQxMDoxNTowM1rOGq1rqA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzU3MjUxOQ==", "bodyText": "Could we find a way to do this matching in the constructor so it doesn't have to be done every time the expression is evaluated?", "url": "https://github.com/apache/cxf/pull/681#discussion_r447572519", "createdAt": "2020-06-30T10:14:24Z", "author": {"login": "coheigea"}, "path": "rt/features/logging/src/main/java/org/apache/cxf/ext/logging/MaskSensitiveHelper.java", "diffHunk": "@@ -0,0 +1,74 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements. See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership. The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.cxf.ext.logging;\n+\n+import java.util.List;\n+\n+import org.apache.commons.lang3.StringUtils;\n+import org.apache.cxf.message.Message;\n+\n+import static org.apache.commons.lang3.ObjectUtils.isEmpty;\n+\n+public class MaskSensitiveHelper {\n+    private static final String ELEMENT_NAME_TEMPLATE = \"-ELEMENT_NAME-\";\n+    private static final String MATCH_PATTERN_XML = \"<-ELEMENT_NAME->(.*?)</-ELEMENT_NAME->\";\n+    private static final String MATCH_PATTERN_JSON = \"\\\"-ELEMENT_NAME-\\\"[ \\\\t]*:[ \\\\t]*\\\"(.*?)\\\"\";\n+    private static final String REPLACEMENT_PATTERN_XML = \"<-ELEMENT_NAME->XXX</-ELEMENT_NAME->\";\n+    private static final String REPLACEMENT_PATTERN_JSON = \"\\\"-ELEMENT_NAME-\\\": \\\"XXX\\\"\";\n+\n+    private static final String XML_CONTENT = \"xml\";\n+    private static final String HTML_CONTENT = \"html\";\n+    private static final String JSON_CONTENT = \"json\";\n+\n+    final List<String> sensitiveElementNames;\n+\n+    public MaskSensitiveHelper(final List<String> sensitiveElementNames) {\n+        this.sensitiveElementNames = sensitiveElementNames;\n+    }\n+\n+    public String maskSensitiveElements(\n+            final Message message,\n+            final String originalLogString) {\n+        if (isEmpty(sensitiveElementNames)) {\n+            return originalLogString;\n+        }\n+        String contentType = (String) message.get(Message.CONTENT_TYPE);\n+        if (StringUtils.containsIgnoreCase(contentType, XML_CONTENT)\n+                || StringUtils.containsIgnoreCase(contentType, HTML_CONTENT)) {\n+            return applyExpression(originalLogString, MATCH_PATTERN_XML, REPLACEMENT_PATTERN_XML);\n+        } else if (StringUtils.containsIgnoreCase(contentType, JSON_CONTENT)) {\n+            return applyExpression(originalLogString, MATCH_PATTERN_JSON, REPLACEMENT_PATTERN_JSON);\n+        } else {\n+            return originalLogString;\n+        }\n+    }\n+\n+    private String applyExpression(\n+            final String originalLogString,\n+            final String matchPatternTemplate,\n+            final String replacementTemplate) {\n+        String resultString = originalLogString;\n+        for (final String elementName : sensitiveElementNames) {\n+            final String matchPattern = matchPatternTemplate.replaceAll(ELEMENT_NAME_TEMPLATE, elementName);\n+            final String replacement = replacementTemplate.replaceAll(ELEMENT_NAME_TEMPLATE, elementName);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6870b040452032c557ec6a93af717139737801fd"}, "originalPosition": 69}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzU3MjkwNA==", "bodyText": "MaskSensitiveHelper is thread-safe, so it would be more performant only to create it once when sensitiveElementNames are set?", "url": "https://github.com/apache/cxf/pull/681#discussion_r447572904", "createdAt": "2020-06-30T10:15:03Z", "author": {"login": "coheigea"}, "path": "rt/features/logging/src/main/java/org/apache/cxf/ext/logging/AbstractLoggingInterceptor.java", "diffHunk": "@@ -102,8 +110,12 @@ public void createExchangeId(Message message) {\n         }\n     }\n \n-    protected String transform(final String originalLogString) {\n+    protected String transform(final Message message, final String originalLogString) {\n         return originalLogString;\n     }\n \n+    protected String maskSensitiveElements(final Message message, String originalLogString) {\n+        return (new MaskSensitiveHelper(sensitiveElementNames))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6870b040452032c557ec6a93af717139737801fd"}, "originalPosition": 48}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dfa0f44090a54abe45235554066acbde96f43877", "author": {"user": {"login": "ashakirin-talend", "name": null}}, "url": "https://github.com/apache/cxf/commit/dfa0f44090a54abe45235554066acbde96f43877", "committedDate": "2020-07-03T23:03:43Z", "message": "CXF-8099: improvements regarding PR comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6cf4ea9cc1340af99a3774e43c4064e58cc4e66b", "author": {"user": {"login": "ashakirin-talend", "name": null}}, "url": "https://github.com/apache/cxf/commit/6cf4ea9cc1340af99a3774e43c4064e58cc4e66b", "committedDate": "2020-07-06T00:00:17Z", "message": "CXF-8099: introduced sensitive headers"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ0MDIyMTQ0", "url": "https://github.com/apache/cxf/pull/681#pullrequestreview-444022144", "createdAt": "2020-07-07T15:46:58Z", "commit": {"oid": "6cf4ea9cc1340af99a3774e43c4064e58cc4e66b"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNTo0Njo1OFrOGuEvcg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wN1QxNTo0NzoxM1rOGuEwEw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDk2NTM2Mg==", "bodyText": "Maybe rename to HTTPHeaders or ProtocolHeaders to make the meaning clear (as opposed to say SOAP headers)", "url": "https://github.com/apache/cxf/pull/681#discussion_r450965362", "createdAt": "2020-07-07T15:46:58Z", "author": {"login": "coheigea"}, "path": "rt/features/logging/src/main/java/org/apache/cxf/ext/logging/AbstractLoggingInterceptor.java", "diffHunk": "@@ -73,6 +78,14 @@ public long getInMemThreshold() {\n         return threshold;\n     }\n \n+    public void addSensitiveElementNames(final List<String> sensitiveElementNames) {\n+        maskSensitiveHelper.addSensitiveElementNames(sensitiveElementNames);\n+    }\n+\n+    public void addSensitiveHeaders(final List<String> sensitiveHeaders) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6cf4ea9cc1340af99a3774e43c4064e58cc4e66b"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDk2NTUyMw==", "bodyText": "Why Optional here when maskSensitiveHelper is declared as final?", "url": "https://github.com/apache/cxf/pull/681#discussion_r450965523", "createdAt": "2020-07-07T15:47:13Z", "author": {"login": "coheigea"}, "path": "rt/features/logging/src/main/java/org/apache/cxf/ext/logging/AbstractLoggingInterceptor.java", "diffHunk": "@@ -102,8 +115,13 @@ public void createExchangeId(Message message) {\n         }\n     }\n \n-    protected String transform(final String originalLogString) {\n+    protected String transform(final Message message, final String originalLogString) {\n         return originalLogString;\n     }\n \n+    protected String maskSensitiveElements(final Message message, String originalLogString) {\n+        return Optional.of(maskSensitiveHelper)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6cf4ea9cc1340af99a3774e43c4064e58cc4e66b"}, "originalPosition": 53}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b96ba8a47348db9bf1ad3487ef6d1e9b88858cef", "author": {"user": {"login": "ashakirin-talend", "name": null}}, "url": "https://github.com/apache/cxf/commit/b96ba8a47348db9bf1ad3487ef6d1e9b88858cef", "committedDate": "2020-07-07T23:07:19Z", "message": "CXF-8099: introduced sensitive headers"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1869eebce5088f8a4bebd447f6b932d53e302eff", "author": {"user": {"login": "ashakirin-talend", "name": null}}, "url": "https://github.com/apache/cxf/commit/1869eebce5088f8a4bebd447f6b932d53e302eff", "committedDate": "2020-07-08T16:35:26Z", "message": "CXF-8099: added header masks to inbound interceptor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a99ff2c787ae6fa56a51113a13a6d20ae6b8e65c", "author": {"user": {"login": "ashakirin-talend", "name": null}}, "url": "https://github.com/apache/cxf/commit/a99ff2c787ae6fa56a51113a13a6d20ae6b8e65c", "committedDate": "2020-07-09T22:54:36Z", "message": "CXF-8099: updated method names, removed unused optional"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b8f66bb7c77125560d8d4091ac77258d79401613", "author": {"user": {"login": "ashakirin-talend", "name": null}}, "url": "https://github.com/apache/cxf/commit/b8f66bb7c77125560d8d4091ac77258d79401613", "committedDate": "2020-07-09T23:02:15Z", "message": "Merge branch 'master' into feature/CXF-8099_mask_sensitive_logging_elements\n\n# Conflicts:\n#\trt/features/logging/src/main/java/org/apache/cxf/ext/logging/AbstractLoggingInterceptor.java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ3MDUzMDM3", "url": "https://github.com/apache/cxf/pull/681#pullrequestreview-447053037", "createdAt": "2020-07-13T08:51:17Z", "commit": {"oid": "b8f66bb7c77125560d8d4091ac77258d79401613"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QwODo1MToxN1rOGwfFgQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QwOTo0NzozOFrOGwhOWg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzQ5NDE0NQ==", "bodyText": "It's probably more performant to use an entrySet here instead:\nheaderMap.entrySet().forEach(entry -> {\nmaskedHeaderMap.put(entry.getKey(), sensitiveHeaderMap.containsKey(entry.getKey())\n? MASKED_HEADER_VALUE : entry.getValue());\n});", "url": "https://github.com/apache/cxf/pull/681#discussion_r453494145", "createdAt": "2020-07-13T08:51:17Z", "author": {"login": "coheigea"}, "path": "rt/features/logging/src/main/java/org/apache/cxf/ext/logging/event/DefaultLogEventMapper.java", "diffHunk": "@@ -95,6 +97,17 @@ public LogEvent map(Message message) {\n         return event;\n     }\n \n+    private Map<String, String> maskHeaders(\n+            final Map<String, String> headerMap,\n+            final Map<String, Boolean> sensitiveHeaderMap) {\n+        final Map<String, String> maskedHeaderMap = new HashMap<>();\n+        headerMap.keySet().forEach(key -> {\n+            maskedHeaderMap.put(key, sensitiveHeaderMap.containsKey(key)\n+                    ? MASKED_HEADER_VALUE : headerMap.get(key));\n+        });", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b8f66bb7c77125560d8d4091ac77258d79401613"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzQ5ODgzMw==", "bodyText": "Do we need to use a map here, as the boolean value isn't actually used anywhere that I can see?", "url": "https://github.com/apache/cxf/pull/681#discussion_r453498833", "createdAt": "2020-07-13T08:58:41Z", "author": {"login": "coheigea"}, "path": "rt/features/logging/src/main/java/org/apache/cxf/ext/logging/AbstractLoggingInterceptor.java", "diffHunk": "@@ -73,6 +82,15 @@ public long getInMemThreshold() {\n         return threshold;\n     }\n \n+    public void addSensitiveElementNames(final List<String> sensitiveElementNames) {\n+        maskSensitiveHelper.addSensitiveElementNames(sensitiveElementNames);\n+    }\n+\n+    public void addSensitiveProtocolHeaderNames(final List<String> sensitiveProtocolHeaderNames) {\n+        sensitiveProtocolHeaderMap = sensitiveProtocolHeaderNames.stream()\n+                .collect(Collectors.toMap(Function.identity(), name -> Boolean.TRUE));\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b8f66bb7c77125560d8d4091ac77258d79401613"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzUyOTE3OA==", "bodyText": "Could we move this template replacement into the constructor? Maybe create a map of matchPattern -> replacement and iterate over this instead of sensitiveNames?", "url": "https://github.com/apache/cxf/pull/681#discussion_r453529178", "createdAt": "2020-07-13T09:47:38Z", "author": {"login": "coheigea"}, "path": "rt/features/logging/src/main/java/org/apache/cxf/ext/logging/MaskSensitiveHelper.java", "diffHunk": "@@ -0,0 +1,79 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements. See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership. The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.cxf.ext.logging;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Optional;\n+\n+import org.apache.cxf.message.Message;\n+\n+public class MaskSensitiveHelper {\n+    private static final String ELEMENT_NAME_TEMPLATE = \"-ELEMENT_NAME-\";\n+    private static final String MATCH_PATTERN_XML = \"<-ELEMENT_NAME->(.*?)</-ELEMENT_NAME->\";\n+    private static final String MATCH_PATTERN_JSON = \"\\\"-ELEMENT_NAME-\\\"[ \\\\t]*:[ \\\\t]*\\\"(.*?)\\\"\";\n+    private static final String REPLACEMENT_PATTERN_XML = \"<-ELEMENT_NAME->XXX</-ELEMENT_NAME->\";\n+    private static final String REPLACEMENT_PATTERN_JSON = \"\\\"-ELEMENT_NAME-\\\": \\\"XXX\\\"\";\n+\n+    private static final String XML_CONTENT = \"xml\";\n+    private static final String HTML_CONTENT = \"html\";\n+    private static final String JSON_CONTENT = \"json\";\n+\n+    final List<String> sensitiveElementNames = new ArrayList<>();\n+\n+    public void addSensitiveElementNames(final List<String> inSensitiveElementNames) {\n+        this.sensitiveElementNames.addAll(inSensitiveElementNames);\n+    }\n+\n+    public String maskSensitiveElements(\n+            final Message message,\n+            final String originalLogString) {\n+        if (sensitiveElementNames.isEmpty() || message == null) {\n+            return originalLogString;\n+        }\n+        final String contentType = (String) message.get(Message.CONTENT_TYPE);\n+        if (contentType.toLowerCase().contains(XML_CONTENT)\n+                || contentType.toLowerCase().contains(HTML_CONTENT)) {\n+            return applyMasks(originalLogString, MATCH_PATTERN_XML, REPLACEMENT_PATTERN_XML);\n+        } else if (contentType.toLowerCase().contains(JSON_CONTENT)) {\n+            return applyMasks(originalLogString, MATCH_PATTERN_JSON, REPLACEMENT_PATTERN_JSON);\n+        }\n+        return originalLogString;\n+    }\n+\n+    private String applyMasks(String originalLogString, String matchElementPattern, String replacementElementPattern) {\n+        return Optional.ofNullable(originalLogString)\n+                .map(s -> applyExpression(s, matchElementPattern, replacementElementPattern, sensitiveElementNames))\n+                .orElse(originalLogString);\n+    }\n+\n+    private String applyExpression(\n+            final String originalLogString,\n+            final String matchPatternTemplate,\n+            final String replacementTemplate,\n+            final List<String> sensitiveNames) {\n+        String resultString = originalLogString;\n+        for (final String sensitiveName : sensitiveNames) {\n+            final String matchPattern = matchPatternTemplate.replaceAll(ELEMENT_NAME_TEMPLATE, sensitiveName);\n+            final String replacement = replacementTemplate.replaceAll(ELEMENT_NAME_TEMPLATE, sensitiveName);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b8f66bb7c77125560d8d4091ac77258d79401613"}, "originalPosition": 74}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ3MTE4OTQz", "url": "https://github.com/apache/cxf/pull/681#pullrequestreview-447118943", "createdAt": "2020-07-13T10:15:20Z", "commit": {"oid": "b8f66bb7c77125560d8d4091ac77258d79401613"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxMDoxNToyMFrOGwiOHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxMDoxNToyMFrOGwiOHw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzU0NTUwMw==", "bodyText": "Could we also return here if originalLogString is null + remove the Optional.ofNullable in applyMasks below?", "url": "https://github.com/apache/cxf/pull/681#discussion_r453545503", "createdAt": "2020-07-13T10:15:20Z", "author": {"login": "coheigea"}, "path": "rt/features/logging/src/main/java/org/apache/cxf/ext/logging/MaskSensitiveHelper.java", "diffHunk": "@@ -0,0 +1,79 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements. See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership. The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.cxf.ext.logging;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Optional;\n+\n+import org.apache.cxf.message.Message;\n+\n+public class MaskSensitiveHelper {\n+    private static final String ELEMENT_NAME_TEMPLATE = \"-ELEMENT_NAME-\";\n+    private static final String MATCH_PATTERN_XML = \"<-ELEMENT_NAME->(.*?)</-ELEMENT_NAME->\";\n+    private static final String MATCH_PATTERN_JSON = \"\\\"-ELEMENT_NAME-\\\"[ \\\\t]*:[ \\\\t]*\\\"(.*?)\\\"\";\n+    private static final String REPLACEMENT_PATTERN_XML = \"<-ELEMENT_NAME->XXX</-ELEMENT_NAME->\";\n+    private static final String REPLACEMENT_PATTERN_JSON = \"\\\"-ELEMENT_NAME-\\\": \\\"XXX\\\"\";\n+\n+    private static final String XML_CONTENT = \"xml\";\n+    private static final String HTML_CONTENT = \"html\";\n+    private static final String JSON_CONTENT = \"json\";\n+\n+    final List<String> sensitiveElementNames = new ArrayList<>();\n+\n+    public void addSensitiveElementNames(final List<String> inSensitiveElementNames) {\n+        this.sensitiveElementNames.addAll(inSensitiveElementNames);\n+    }\n+\n+    public String maskSensitiveElements(\n+            final Message message,\n+            final String originalLogString) {\n+        if (sensitiveElementNames.isEmpty() || message == null) {\n+            return originalLogString;\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b8f66bb7c77125560d8d4091ac77258d79401613"}, "originalPosition": 49}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7abbb406d5bc03f6c3ca239a00c8cdb343a8d8ef", "author": {"user": {"login": "ashakirin-talend", "name": null}}, "url": "https://github.com/apache/cxf/commit/7abbb406d5bc03f6c3ca239a00c8cdb343a8d8ef", "committedDate": "2020-07-15T09:52:11Z", "message": "CXF-8099: changed incoming type: Set instead List"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "132a28c581dae7866c6e800d586d8b5d7fabff2c", "author": {"user": {"login": "ashakirin-talend", "name": null}}, "url": "https://github.com/apache/cxf/commit/132a28c581dae7866c6e800d586d8b5d7fabff2c", "committedDate": "2020-07-16T22:40:36Z", "message": "CXF-8099: improved null check"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "218fec091a7626adc6dba9e25454c2b080576ea6", "author": {"user": {"login": "ashakirin-talend", "name": null}}, "url": "https://github.com/apache/cxf/commit/218fec091a7626adc6dba9e25454c2b080576ea6", "committedDate": "2020-07-18T21:30:39Z", "message": "CXF-8099: names refactoring"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ed504c80c0d40f709566b0b485e4bce7affff504", "author": {"user": {"login": "ashakirin-talend", "name": null}}, "url": "https://github.com/apache/cxf/commit/ed504c80c0d40f709566b0b485e4bce7affff504", "committedDate": "2020-07-20T22:29:06Z", "message": "CXF-8099: added precompiled patterns"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "61e030492e4b384d9eca71711ef70e9f0fc812ba", "author": {"user": {"login": "ashakirin-talend", "name": null}}, "url": "https://github.com/apache/cxf/commit/61e030492e4b384d9eca71711ef70e9f0fc812ba", "committedDate": "2020-07-20T22:38:12Z", "message": "CXF-8099: parameters renaming"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "edce9a39c0d0c87e1691e0fcf5d357623d0ae2b3", "author": {"user": {"login": "ashakirin-talend", "name": null}}, "url": "https://github.com/apache/cxf/commit/edce9a39c0d0c87e1691e0fcf5d357623d0ae2b3", "committedDate": "2020-07-21T23:30:47Z", "message": "CXF-8099: refactored header replacing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c4e2f95250b7c456ecd97c75e158311bdf4e2709", "author": {"user": {"login": "ashakirin-talend", "name": null}}, "url": "https://github.com/apache/cxf/commit/c4e2f95250b7c456ecd97c75e158311bdf4e2709", "committedDate": "2020-07-21T23:36:06Z", "message": "CXF-8099: refactored header replacing"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUzMDU1ODc3", "url": "https://github.com/apache/cxf/pull/681#pullrequestreview-453055877", "createdAt": "2020-07-22T07:20:47Z", "commit": {"oid": "c4e2f95250b7c456ecd97c75e158311bdf4e2709"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f337f255ba41ac607f558c0d36b3f8db2f8fba89", "author": {"user": {"login": "ashakirin-talend", "name": null}}, "url": "https://github.com/apache/cxf/commit/f337f255ba41ac607f558c0d36b3f8db2f8fba89", "committedDate": "2020-07-22T23:04:29Z", "message": "Merge branch 'master' into feature/CXF-8099_mask_sensitive_logging_elements"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2102, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}