{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc2NTMxMzU2", "number": 642, "title": "[CXF-8213] Add Micrometer metric support for JAX-WS", "bodyText": "", "createdAt": "2020-02-18T10:19:57Z", "url": "https://github.com/apache/cxf/pull/642", "merged": true, "mergeCommit": {"oid": "2e3631a3a7ddb4551c12ef67aef04ce90d635fe1"}, "closed": true, "closedAt": "2020-10-21T21:52:19Z", "author": {"login": "shark300"}, "timelineItems": {"totalCount": 55, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcFfSf9ABqjMwNDY1MzI4ODY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdU0NpAgFqTUxNDE5ODAzMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "21fbbb91773fd62bdd5e261e3be779a876b34be9", "author": {"user": {"login": "shark300", "name": null}}, "url": "https://github.com/apache/cxf/commit/21fbbb91773fd62bdd5e261e3be779a876b34be9", "committedDate": "2020-02-18T10:14:58Z", "message": "[CXF-6738] Add Micrometer metric support for JAX-WS"}, "afterCommit": {"oid": "e2876433507313934050c3de682a1c1c74240cf2", "author": {"user": {"login": "shark300", "name": null}}, "url": "https://github.com/apache/cxf/commit/e2876433507313934050c3de682a1c1c74240cf2", "committedDate": "2020-02-18T10:22:36Z", "message": "[CXF-8213] Add Micrometer metric support for JAX-WS"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e2876433507313934050c3de682a1c1c74240cf2", "author": {"user": {"login": "shark300", "name": null}}, "url": "https://github.com/apache/cxf/commit/e2876433507313934050c3de682a1c1c74240cf2", "committedDate": "2020-02-18T10:22:36Z", "message": "[CXF-8213] Add Micrometer metric support for JAX-WS"}, "afterCommit": {"oid": "7bdd03c03b234f2c2b47d2ba37ae8f9408426219", "author": {"user": {"login": "shark300", "name": null}}, "url": "https://github.com/apache/cxf/commit/7bdd03c03b234f2c2b47d2ba37ae8f9408426219", "committedDate": "2020-02-18T10:32:05Z", "message": "[CXF-8213] Add Micrometer metric support for JAX-WS"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7bdd03c03b234f2c2b47d2ba37ae8f9408426219", "author": {"user": {"login": "shark300", "name": null}}, "url": "https://github.com/apache/cxf/commit/7bdd03c03b234f2c2b47d2ba37ae8f9408426219", "committedDate": "2020-02-18T10:32:05Z", "message": "[CXF-8213] Add Micrometer metric support for JAX-WS"}, "afterCommit": {"oid": "87e1de62b340f4c30cd6e803e087ce86677801ff", "author": {"user": {"login": "shark300", "name": null}}, "url": "https://github.com/apache/cxf/commit/87e1de62b340f4c30cd6e803e087ce86677801ff", "committedDate": "2020-02-18T10:44:51Z", "message": "[CXF-8213] Add Micrometer metric support for JAX-WS"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d88558a1acdcab7171d9d119ba099abf08192af2", "author": {"user": null}, "url": "https://github.com/apache/cxf/commit/d88558a1acdcab7171d9d119ba099abf08192af2", "committedDate": "2020-02-18T11:12:26Z", "message": "[CXF-8213] Added Spring sample"}, "afterCommit": {"oid": "7d0d060f14037a1a8a9005e7d9417ad7a68d673e", "author": {"user": {"login": "shark300", "name": null}}, "url": "https://github.com/apache/cxf/commit/7d0d060f14037a1a8a9005e7d9417ad7a68d673e", "committedDate": "2020-02-18T11:15:46Z", "message": "[CXF-8213] Added Spring sample"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7d0d060f14037a1a8a9005e7d9417ad7a68d673e", "author": {"user": {"login": "shark300", "name": null}}, "url": "https://github.com/apache/cxf/commit/7d0d060f14037a1a8a9005e7d9417ad7a68d673e", "committedDate": "2020-02-18T11:15:46Z", "message": "[CXF-8213] Added Spring sample"}, "afterCommit": {"oid": "b2de75f9028ad1528311fe0ab03ee1e181de7f84", "author": {"user": {"login": "shark300", "name": null}}, "url": "https://github.com/apache/cxf/commit/b2de75f9028ad1528311fe0ab03ee1e181de7f84", "committedDate": "2020-02-20T06:29:04Z", "message": "[CXF-8213] Add Micrometer metric support for JAX-WS"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "664d881cf9e891b4e62bce6684622d44197ff44d", "author": {"user": {"login": "coheigea", "name": "Colm O hEigeartaigh"}}, "url": "https://github.com/apache/cxf/commit/664d881cf9e891b4e62bce6684622d44197ff44d", "committedDate": "2020-02-20T06:33:12Z", "message": "Log error in the AllowAllHostnameVerifier"}, "afterCommit": {"oid": "53ccd8b26356d4c1b59d74b8b90bca4b9dc389d9", "author": {"user": {"login": "shark300", "name": null}}, "url": "https://github.com/apache/cxf/commit/53ccd8b26356d4c1b59d74b8b90bca4b9dc389d9", "committedDate": "2020-02-20T06:38:49Z", "message": "[CXF-8213] Add Micrometer metric support for JAX-WS"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "53ccd8b26356d4c1b59d74b8b90bca4b9dc389d9", "author": {"user": {"login": "shark300", "name": null}}, "url": "https://github.com/apache/cxf/commit/53ccd8b26356d4c1b59d74b8b90bca4b9dc389d9", "committedDate": "2020-02-20T06:38:49Z", "message": "[CXF-8213] Add Micrometer metric support for JAX-WS"}, "afterCommit": {"oid": "423e0954b712d3352120389f6b201452d300a91a", "author": {"user": {"login": "shark300", "name": null}}, "url": "https://github.com/apache/cxf/commit/423e0954b712d3352120389f6b201452d300a91a", "committedDate": "2020-02-20T06:41:44Z", "message": "[CXF-8213] Add Micrometer metric support for JAX-WS"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "423e0954b712d3352120389f6b201452d300a91a", "author": {"user": {"login": "shark300", "name": null}}, "url": "https://github.com/apache/cxf/commit/423e0954b712d3352120389f6b201452d300a91a", "committedDate": "2020-02-20T06:41:44Z", "message": "[CXF-8213] Add Micrometer metric support for JAX-WS"}, "afterCommit": {"oid": "1f73c7563a82daccea29d15da6ee7fc72865c578", "author": {"user": {"login": "shark300", "name": null}}, "url": "https://github.com/apache/cxf/commit/1f73c7563a82daccea29d15da6ee7fc72865c578", "committedDate": "2020-02-20T06:47:01Z", "message": "[CXF-8213] Add Micrometer metric support for JAX-WS"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1f73c7563a82daccea29d15da6ee7fc72865c578", "author": {"user": {"login": "shark300", "name": null}}, "url": "https://github.com/apache/cxf/commit/1f73c7563a82daccea29d15da6ee7fc72865c578", "committedDate": "2020-02-20T06:47:01Z", "message": "[CXF-8213] Add Micrometer metric support for JAX-WS"}, "afterCommit": {"oid": "351ad2f9dc188dff75ba5401f6ec4dc18691c9fe", "author": {"user": {"login": "shark300", "name": null}}, "url": "https://github.com/apache/cxf/commit/351ad2f9dc188dff75ba5401f6ec4dc18691c9fe", "committedDate": "2020-02-21T06:33:26Z", "message": "[CXF-8213] Add Micrometer metric support for JAX-WS"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYzMTQ1ODI0", "url": "https://github.com/apache/cxf/pull/642#pullrequestreview-363145824", "createdAt": "2020-02-24T02:00:34Z", "commit": {"oid": "1f73c7563a82daccea29d15da6ee7fc72865c578"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQwMjowNDo1NFrOFtUZ0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQwMjowNDo1NFrOFtUZ0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzA2NDUyOQ==", "bodyText": "I think this dependency is not need, or there are reasons to include it?", "url": "https://github.com/apache/cxf/pull/642#discussion_r383064529", "createdAt": "2020-02-24T02:04:54Z", "author": {"login": "reta"}, "path": "integration/spring-boot/autoconfigure/pom.xml", "diffHunk": "@@ -74,6 +74,16 @@\n             <artifactId>spring-boot-autoconfigure-processor</artifactId>\n             <optional>true</optional>\n         </dependency>\n+        <dependency>\n+            <groupId>org.springframework.boot</groupId>\n+            <artifactId>spring-boot-starter-web</artifactId>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "351ad2f9dc188dff75ba5401f6ec4dc18691c9fe"}, "originalPosition": 24}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYzMTQ2OTU0", "url": "https://github.com/apache/cxf/pull/642#pullrequestreview-363146954", "createdAt": "2020-02-24T02:10:45Z", "commit": {"oid": "351ad2f9dc188dff75ba5401f6ec4dc18691c9fe"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQwMjoxMDo0NVrOFtUcSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQwMjoxMDo0NVrOFtUcSg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzA2NTE2Mg==", "bodyText": "We should probably better use cxf.management.metrics (or just cxf.metrics) in order to not conflict / confuse with Spring Boot Actuator bundled properties.", "url": "https://github.com/apache/cxf/pull/642#discussion_r383065162", "createdAt": "2020-02-24T02:10:45Z", "author": {"login": "reta"}, "path": "integration/spring-boot/autoconfigure/src/main/java/org/apache/cxf/spring/boot/autoconfigure/MetricsProperties.java", "diffHunk": "@@ -0,0 +1,86 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements. See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership. The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.cxf.spring.boot.autoconfigure;\n+\n+import org.springframework.boot.context.properties.ConfigurationProperties;\n+\n+@ConfigurationProperties(\"management.metrics\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "351ad2f9dc188dff75ba5401f6ec4dc18691c9fe"}, "originalPosition": 24}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYzMTQ3NDA4", "url": "https://github.com/apache/cxf/pull/642#pullrequestreview-363147408", "createdAt": "2020-02-24T02:14:25Z", "commit": {"oid": "351ad2f9dc188dff75ba5401f6ec4dc18691c9fe"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQwMjoxNDoyNVrOFtUeBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQwMjoxNDoyNVrOFtUeBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzA2NTYwNA==", "bodyText": "@AutoConfigureAfter(MetricsAutoConfiguration.class) should be sufficient, no?", "url": "https://github.com/apache/cxf/pull/642#discussion_r383065604", "createdAt": "2020-02-24T02:14:25Z", "author": {"login": "reta"}, "path": "integration/spring-boot/autoconfigure/src/main/java/org/apache/cxf/spring/boot/autoconfigure/micrometer/MicrometerMetricsAutoConfiguration.java", "diffHunk": "@@ -0,0 +1,121 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements. See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership. The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.cxf.spring.boot.autoconfigure.micrometer;\n+\n+import org.apache.cxf.metrics.MetricsFeature;\n+import org.apache.cxf.metrics.MetricsProvider;\n+import org.apache.cxf.metrics.micrometer.MicrometerMetricsProperties;\n+import org.apache.cxf.metrics.micrometer.MicrometerMetricsProvider;\n+import org.apache.cxf.metrics.micrometer.provider.TagsProvider;\n+import org.apache.cxf.metrics.micrometer.provider.TimedAnnotationProvider;\n+import org.apache.cxf.metrics.micrometer.provider.DefaultExceptionClassProvider;\n+import org.apache.cxf.metrics.micrometer.provider.ExceptionClassProvider;\n+import org.apache.cxf.metrics.micrometer.provider.jaxws.DefaultJaxwsFaultCodeProvider;\n+import org.apache.cxf.metrics.micrometer.provider.jaxws.JaxwsFaultCodeProvider;\n+import org.apache.cxf.metrics.micrometer.provider.jaxws.JaxwsTags;\n+import org.apache.cxf.metrics.micrometer.provider.jaxws.JaxwsTagsProvider;\n+import org.apache.cxf.spring.boot.autoconfigure.MetricsProperties;\n+import org.apache.cxf.spring.boot.autoconfigure.micrometer.provider.jaxws.SpringBasedTimedAnnotationProvider;\n+import org.springframework.boot.actuate.autoconfigure.metrics.MetricsAutoConfiguration;\n+import org.springframework.boot.actuate.autoconfigure.metrics.OnlyOnceLoggingDenyMeterFilter;\n+import org.springframework.boot.actuate.autoconfigure.metrics.export.simple.SimpleMetricsExportAutoConfiguration;\n+import org.springframework.boot.autoconfigure.AutoConfigureAfter;\n+import org.springframework.boot.autoconfigure.condition.ConditionalOnBean;\n+import org.springframework.boot.autoconfigure.condition.ConditionalOnClass;\n+import org.springframework.boot.autoconfigure.condition.ConditionalOnMissingBean;\n+import org.springframework.boot.autoconfigure.condition.ConditionalOnWebApplication;\n+import org.springframework.boot.context.properties.EnableConfigurationProperties;\n+import org.springframework.context.annotation.Bean;\n+import org.springframework.context.annotation.Configuration;\n+import org.springframework.core.annotation.Order;\n+import org.springframework.web.servlet.DispatcherServlet;\n+\n+import io.micrometer.core.instrument.MeterRegistry;\n+import io.micrometer.core.instrument.config.MeterFilter;\n+\n+@Configuration\n+@AutoConfigureAfter({MetricsAutoConfiguration.class, SimpleMetricsExportAutoConfiguration.class})", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "351ad2f9dc188dff75ba5401f6ec4dc18691c9fe"}, "originalPosition": 54}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYzMTQ4NzQ4", "url": "https://github.com/apache/cxf/pull/642#pullrequestreview-363148748", "createdAt": "2020-02-24T02:25:16Z", "commit": {"oid": "351ad2f9dc188dff75ba5401f6ec4dc18691c9fe"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQwMjoyNToxNlrOFtUjCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQwMjoyNToxNlrOFtUjCA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzA2Njg4OA==", "bodyText": "So we need basically 2 conditions here:\n\nThe metrics module is added (MetricsProvider.class should be present)\nThe JAX-WS frontend module is added (may me JaxWsServerFactoryBean.class should be present)\n\nWhat do you think?", "url": "https://github.com/apache/cxf/pull/642#discussion_r383066888", "createdAt": "2020-02-24T02:25:16Z", "author": {"login": "reta"}, "path": "integration/spring-boot/autoconfigure/src/main/java/org/apache/cxf/spring/boot/autoconfigure/micrometer/MicrometerMetricsAutoConfiguration.java", "diffHunk": "@@ -0,0 +1,121 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements. See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership. The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.cxf.spring.boot.autoconfigure.micrometer;\n+\n+import org.apache.cxf.metrics.MetricsFeature;\n+import org.apache.cxf.metrics.MetricsProvider;\n+import org.apache.cxf.metrics.micrometer.MicrometerMetricsProperties;\n+import org.apache.cxf.metrics.micrometer.MicrometerMetricsProvider;\n+import org.apache.cxf.metrics.micrometer.provider.TagsProvider;\n+import org.apache.cxf.metrics.micrometer.provider.TimedAnnotationProvider;\n+import org.apache.cxf.metrics.micrometer.provider.DefaultExceptionClassProvider;\n+import org.apache.cxf.metrics.micrometer.provider.ExceptionClassProvider;\n+import org.apache.cxf.metrics.micrometer.provider.jaxws.DefaultJaxwsFaultCodeProvider;\n+import org.apache.cxf.metrics.micrometer.provider.jaxws.JaxwsFaultCodeProvider;\n+import org.apache.cxf.metrics.micrometer.provider.jaxws.JaxwsTags;\n+import org.apache.cxf.metrics.micrometer.provider.jaxws.JaxwsTagsProvider;\n+import org.apache.cxf.spring.boot.autoconfigure.MetricsProperties;\n+import org.apache.cxf.spring.boot.autoconfigure.micrometer.provider.jaxws.SpringBasedTimedAnnotationProvider;\n+import org.springframework.boot.actuate.autoconfigure.metrics.MetricsAutoConfiguration;\n+import org.springframework.boot.actuate.autoconfigure.metrics.OnlyOnceLoggingDenyMeterFilter;\n+import org.springframework.boot.actuate.autoconfigure.metrics.export.simple.SimpleMetricsExportAutoConfiguration;\n+import org.springframework.boot.autoconfigure.AutoConfigureAfter;\n+import org.springframework.boot.autoconfigure.condition.ConditionalOnBean;\n+import org.springframework.boot.autoconfigure.condition.ConditionalOnClass;\n+import org.springframework.boot.autoconfigure.condition.ConditionalOnMissingBean;\n+import org.springframework.boot.autoconfigure.condition.ConditionalOnWebApplication;\n+import org.springframework.boot.context.properties.EnableConfigurationProperties;\n+import org.springframework.context.annotation.Bean;\n+import org.springframework.context.annotation.Configuration;\n+import org.springframework.core.annotation.Order;\n+import org.springframework.web.servlet.DispatcherServlet;\n+\n+import io.micrometer.core.instrument.MeterRegistry;\n+import io.micrometer.core.instrument.config.MeterFilter;\n+\n+@Configuration\n+@AutoConfigureAfter({MetricsAutoConfiguration.class, SimpleMetricsExportAutoConfiguration.class})\n+@ConditionalOnWebApplication(type = ConditionalOnWebApplication.Type.SERVLET)\n+@ConditionalOnClass({DispatcherServlet.class, MetricsFeature.class})", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "351ad2f9dc188dff75ba5401f6ec4dc18691c9fe"}, "originalPosition": 56}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9e973ca13c025bb075761f19aecad8ec582f0bc6", "author": {"user": {"login": "shark300", "name": null}}, "url": "https://github.com/apache/cxf/commit/9e973ca13c025bb075761f19aecad8ec582f0bc6", "committedDate": "2020-02-29T19:10:37Z", "message": "[CXF-8213] Add Micrometer metric support for JAX-WS"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "460e4d225e02992beb8e3c306cb0f48a8b379885", "author": {"user": {"login": "shark300", "name": null}}, "url": "https://github.com/apache/cxf/commit/460e4d225e02992beb8e3c306cb0f48a8b379885", "committedDate": "2020-02-29T19:10:38Z", "message": "[CXF-8213] Fixed review comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aceb3e52d954e4bf9ff5fd668a6ba64bfd011709", "author": {"user": {"login": "shark300", "name": null}}, "url": "https://github.com/apache/cxf/commit/aceb3e52d954e4bf9ff5fd668a6ba64bfd011709", "committedDate": "2020-02-29T19:10:39Z", "message": "[CXF-8213] Fixed review comments"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "26c180de50cd1d91a7346bee9722dbdf843f0542", "author": {"user": {"login": "shark300", "name": null}}, "url": "https://github.com/apache/cxf/commit/26c180de50cd1d91a7346bee9722dbdf843f0542", "committedDate": "2020-02-29T17:03:32Z", "message": "[CXF-8213] Fixed review comments"}, "afterCommit": {"oid": "aceb3e52d954e4bf9ff5fd668a6ba64bfd011709", "author": {"user": {"login": "shark300", "name": null}}, "url": "https://github.com/apache/cxf/commit/aceb3e52d954e4bf9ff5fd668a6ba64bfd011709", "committedDate": "2020-02-29T19:10:39Z", "message": "[CXF-8213] Fixed review comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ceb20fc64c394c08c61e7f93d7d73a6722cf0170", "author": {"user": null}, "url": "https://github.com/apache/cxf/commit/ceb20fc64c394c08c61e7f93d7d73a6722cf0170", "committedDate": "2020-03-03T21:26:31Z", "message": "[CXF-8213] Fixed review comments"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "444b6151c976581f068bdd0859be44d6f2a59cce", "author": {"user": null}, "url": "https://github.com/apache/cxf/commit/444b6151c976581f068bdd0859be44d6f2a59cce", "committedDate": "2020-03-03T19:56:54Z", "message": "[CXF-8213] Fixed review comments"}, "afterCommit": {"oid": "ceb20fc64c394c08c61e7f93d7d73a6722cf0170", "author": {"user": null}, "url": "https://github.com/apache/cxf/commit/ceb20fc64c394c08c61e7f93d7d73a6722cf0170", "committedDate": "2020-03-03T21:26:31Z", "message": "[CXF-8213] Fixed review comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "86c1fc2e6d4a562814af01a1bd8daecd4e00eff4", "author": {"user": null}, "url": "https://github.com/apache/cxf/commit/86c1fc2e6d4a562814af01a1bd8daecd4e00eff4", "committedDate": "2020-03-27T12:28:51Z", "message": "Merge remote-tracking branch 'remotes/origin/master' into CXF-8213\n\n# Conflicts:\n#\tsystests/spring-boot/pom.xml"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ba1c6154418912a877b83c399bf57cfaaed97a35", "author": {"user": null}, "url": "https://github.com/apache/cxf/commit/ba1c6154418912a877b83c399bf57cfaaed97a35", "committedDate": "2020-04-11T06:40:42Z", "message": "Merge remote-tracking branch 'remotes/origin/master' into CXF-8213\n\n# Conflicts:\n#\tintegration/spring-boot/starter-jaxws/pom.xml"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkxODc0NzEw", "url": "https://github.com/apache/cxf/pull/642#pullrequestreview-391874710", "createdAt": "2020-04-12T16:38:00Z", "commit": {"oid": "ba1c6154418912a877b83c399bf57cfaaed97a35"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMlQxNjozODowMFrOGEW4rQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMlQxNjozODowMFrOGEW4rQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzIyMjQ0NQ==", "bodyText": "I think we could strip jaxws package, this provider does is really JAX-WS related, only depends on cxf-core, right?", "url": "https://github.com/apache/cxf/pull/642#discussion_r407222445", "createdAt": "2020-04-12T16:38:00Z", "author": {"login": "reta"}, "path": "integration/spring-boot/autoconfigure/src/main/java/org/apache/cxf/spring/boot/autoconfigure/micrometer/provider/jaxws/SpringBasedTimedAnnotationProvider.java", "diffHunk": "@@ -0,0 +1,97 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements. See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership. The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.cxf.spring.boot.autoconfigure.micrometer.provider.jaxws;\n+\n+import java.lang.reflect.AnnotatedElement;\n+import java.lang.reflect.Method;\n+import java.util.Objects;\n+import java.util.Set;\n+import java.util.concurrent.ConcurrentHashMap;\n+\n+import org.apache.cxf.message.Exchange;\n+import org.apache.cxf.metrics.micrometer.provider.TimedAnnotationProvider;\n+import org.apache.cxf.service.Service;\n+import org.apache.cxf.service.invoker.MethodDispatcher;\n+import org.apache.cxf.service.model.BindingOperationInfo;\n+import org.springframework.core.annotation.MergedAnnotationCollectors;\n+import org.springframework.core.annotation.MergedAnnotations;\n+\n+import io.micrometer.core.annotation.Timed;\n+\n+public class SpringBasedTimedAnnotationProvider implements TimedAnnotationProvider {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ba1c6154418912a877b83c399bf57cfaaed97a35"}, "originalPosition": 38}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkxODc1MzYx", "url": "https://github.com/apache/cxf/pull/642#pullrequestreview-391875361", "createdAt": "2020-04-12T16:45:31Z", "commit": {"oid": "ba1c6154418912a877b83c399bf57cfaaed97a35"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMlQxNjo0NTozMVrOGEW8UQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMlQxNjo0NTozMVrOGEW8UQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzIyMzM3Nw==", "bodyText": "What is the purpose of this annotation?", "url": "https://github.com/apache/cxf/pull/642#discussion_r407223377", "createdAt": "2020-04-12T16:45:31Z", "author": {"login": "reta"}, "path": "integration/spring-boot/autoconfigure/src/test/java/org/apache/cxf/spring/boot/autoconfigure/micrometer/provider/jaxws/CustomTimed.java", "diffHunk": "@@ -0,0 +1,40 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements. See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership. The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.cxf.spring.boot.autoconfigure.micrometer.provider.jaxws;\n+\n+import java.lang.annotation.ElementType;\n+import java.lang.annotation.Inherited;\n+import java.lang.annotation.Retention;\n+import java.lang.annotation.RetentionPolicy;\n+import java.lang.annotation.Target;\n+\n+import org.springframework.core.annotation.AliasFor;\n+\n+import io.micrometer.core.annotation.Timed;\n+\n+@Target({ElementType.ANNOTATION_TYPE, ElementType.TYPE, ElementType.METHOD})\n+@Retention(RetentionPolicy.RUNTIME)\n+@Inherited\n+@Timed\n+public @interface CustomTimed {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ba1c6154418912a877b83c399bf57cfaaed97a35"}, "originalPosition": 35}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "56eccd15b48a09df9ae9751d6cba28fdbaf461d4", "author": {"user": null}, "url": "https://github.com/apache/cxf/commit/56eccd15b48a09df9ae9751d6cba28fdbaf461d4", "committedDate": "2020-04-12T17:39:04Z", "message": "[CXF-8213] Fixed review comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkxODgwOTI5", "url": "https://github.com/apache/cxf/pull/642#pullrequestreview-391880929", "createdAt": "2020-04-12T17:52:25Z", "commit": {"oid": "ba1c6154418912a877b83c399bf57cfaaed97a35"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMlQxNzo1MjoyNVrOGEXbvg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMlQxNzo1MjoyNVrOGEXbvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzIzMTQyMg==", "bodyText": "I would suggest to remove ExceptionClassProvider  and JaxwsFaultCodeProvider altogether and replace them with something like TagsCustomizer.\ninterface TagsCustomizer() {\n    Iterable<Tag> getAdditionalTags(Exchange ex);\n}\n\nThere could many of them (fe, could be one for JAX-WS and one for JAX-RS) and MicrometerMetricsContext could apply the available customizers before emitting the final set of tags.\nSupplier<Iterable<Tag>> tags = () -> this.tagsProvider.getTags(ex) + <all tags from customizers>\n\nWhat do you think?", "url": "https://github.com/apache/cxf/pull/642#discussion_r407231422", "createdAt": "2020-04-12T17:52:25Z", "author": {"login": "reta"}, "path": "integration/spring-boot/autoconfigure/src/main/java/org/apache/cxf/spring/boot/autoconfigure/micrometer/MicrometerMetricsAutoConfiguration.java", "diffHunk": "@@ -0,0 +1,121 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements. See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership. The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.cxf.spring.boot.autoconfigure.micrometer;\n+\n+import org.apache.cxf.jaxws.JaxWsServerFactoryBean;\n+import org.apache.cxf.metrics.MetricsProvider;\n+import org.apache.cxf.metrics.micrometer.MicrometerMetricsProperties;\n+import org.apache.cxf.metrics.micrometer.MicrometerMetricsProvider;\n+import org.apache.cxf.metrics.micrometer.provider.TagsProvider;\n+import org.apache.cxf.metrics.micrometer.provider.TimedAnnotationProvider;\n+import org.apache.cxf.metrics.micrometer.provider.DefaultExceptionClassProvider;\n+import org.apache.cxf.metrics.micrometer.provider.ExceptionClassProvider;\n+import org.apache.cxf.metrics.micrometer.provider.jaxws.DefaultJaxwsFaultCodeProvider;\n+import org.apache.cxf.metrics.micrometer.provider.jaxws.JaxwsFaultCodeProvider;\n+import org.apache.cxf.metrics.micrometer.provider.jaxws.JaxwsTags;\n+import org.apache.cxf.metrics.micrometer.provider.jaxws.JaxwsTagsProvider;\n+import org.apache.cxf.spring.boot.autoconfigure.CxfProperties;\n+import org.apache.cxf.spring.boot.autoconfigure.CxfProperties.Metrics.Server;\n+import org.apache.cxf.spring.boot.autoconfigure.micrometer.provider.jaxws.SpringBasedTimedAnnotationProvider;\n+import org.springframework.boot.actuate.autoconfigure.metrics.MetricsAutoConfiguration;\n+import org.springframework.boot.actuate.autoconfigure.metrics.OnlyOnceLoggingDenyMeterFilter;\n+import org.springframework.boot.actuate.autoconfigure.metrics.export.simple.SimpleMetricsExportAutoConfiguration;\n+import org.springframework.boot.autoconfigure.AutoConfigureAfter;\n+import org.springframework.boot.autoconfigure.condition.ConditionalOnBean;\n+import org.springframework.boot.autoconfigure.condition.ConditionalOnClass;\n+import org.springframework.boot.autoconfigure.condition.ConditionalOnMissingBean;\n+import org.springframework.boot.autoconfigure.condition.ConditionalOnWebApplication;\n+import org.springframework.boot.context.properties.EnableConfigurationProperties;\n+import org.springframework.context.annotation.Bean;\n+import org.springframework.context.annotation.Configuration;\n+import org.springframework.core.annotation.Order;\n+\n+import io.micrometer.core.instrument.MeterRegistry;\n+import io.micrometer.core.instrument.config.MeterFilter;\n+\n+@Configuration\n+@AutoConfigureAfter({MetricsAutoConfiguration.class, SimpleMetricsExportAutoConfiguration.class})\n+@ConditionalOnWebApplication(type = ConditionalOnWebApplication.Type.SERVLET)\n+@ConditionalOnClass({JaxWsServerFactoryBean.class, MetricsProvider.class})\n+@ConditionalOnBean({MeterRegistry.class})\n+@EnableConfigurationProperties(CxfProperties.class)\n+public class MicrometerMetricsAutoConfiguration {\n+\n+    private final CxfProperties properties;\n+\n+    public MicrometerMetricsAutoConfiguration(CxfProperties properties) {\n+        this.properties = properties;\n+    }\n+\n+    @Bean\n+    public TimedAnnotationProvider timedAnnotationProvider() {\n+        return new SpringBasedTimedAnnotationProvider();\n+    }\n+\n+    @Bean\n+    public JaxwsTags jaxwsTags() {\n+        return new JaxwsTags();\n+    }\n+\n+    @Bean\n+    @ConditionalOnMissingBean(ExceptionClassProvider.class)\n+    public ExceptionClassProvider exceptionClassProvider() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ba1c6154418912a877b83c399bf57cfaaed97a35"}, "originalPosition": 79}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkxODgxNjY2", "url": "https://github.com/apache/cxf/pull/642#pullrequestreview-391881666", "createdAt": "2020-04-12T18:01:43Z", "commit": {"oid": "56eccd15b48a09df9ae9751d6cba28fdbaf461d4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMlQxODowMTo0M1rOGEXf5A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMlQxODowMTo0M1rOGEXf5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzIzMjQ4NA==", "bodyText": "This should be optional dependency, correct? (not everyone would need actuator)", "url": "https://github.com/apache/cxf/pull/642#discussion_r407232484", "createdAt": "2020-04-12T18:01:43Z", "author": {"login": "reta"}, "path": "integration/spring-boot/starter-jaxws/pom.xml", "diffHunk": "@@ -54,6 +55,10 @@\n                 </exclusion>\n             </exclusions>\n         </dependency>\n+        <dependency>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "56eccd15b48a09df9ae9751d6cba28fdbaf461d4"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkxODgxNjg1", "url": "https://github.com/apache/cxf/pull/642#pullrequestreview-391881685", "createdAt": "2020-04-12T18:02:00Z", "commit": {"oid": "56eccd15b48a09df9ae9751d6cba28fdbaf461d4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMlQxODowMjowMFrOGEXf9w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMlQxODowMjowMFrOGEXf9w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzIzMjUwMw==", "bodyText": "This should be optional dependency as well", "url": "https://github.com/apache/cxf/pull/642#discussion_r407232503", "createdAt": "2020-04-12T18:02:00Z", "author": {"login": "reta"}, "path": "integration/spring-boot/starter-jaxws/pom.xml", "diffHunk": "@@ -69,6 +74,11 @@\n             <artifactId>cxf-rt-frontend-jaxws</artifactId>\n             <version>${project.version}</version>\n         </dependency>\n+        <dependency>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "56eccd15b48a09df9ae9751d6cba28fdbaf461d4"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkxODgyMzM0", "url": "https://github.com/apache/cxf/pull/642#pullrequestreview-391882334", "createdAt": "2020-04-12T18:10:21Z", "commit": {"oid": "56eccd15b48a09df9ae9751d6cba28fdbaf461d4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMlQxODoxMDoyMVrOGEXjrg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMlQxODoxMDoyMVrOGEXjrg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzIzMzQ1NA==", "bodyText": "We could split this class into 2,  StandardTags (under org.apache.cxf.metrics.micrometer.provider package) and JaxwsTags with JAX-WS specifics, like FaultCode, etc. Along with customizers we could rely on StandardTags only in the MicrometerMetricsContext where JAX-WS specific tags are going to be injected by customizers.", "url": "https://github.com/apache/cxf/pull/642#discussion_r407233454", "createdAt": "2020-04-12T18:10:21Z", "author": {"login": "reta"}, "path": "rt/features/metrics/src/main/java/org/apache/cxf/metrics/micrometer/provider/jaxws/JaxwsTags.java", "diffHunk": "@@ -0,0 +1,140 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements. See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership. The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.cxf.metrics.micrometer.provider.jaxws;\n+\n+import java.util.NoSuchElementException;\n+import java.util.Optional;\n+\n+import javax.xml.namespace.QName;\n+\n+import org.apache.cxf.common.util.StringUtils;\n+import org.apache.cxf.message.Exchange;\n+import org.apache.cxf.message.Message;\n+import org.apache.cxf.service.model.BindingOperationInfo;\n+\n+import io.micrometer.core.instrument.Tag;\n+\n+import static java.util.Optional.ofNullable;\n+\n+public class JaxwsTags {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "56eccd15b48a09df9ae9751d6cba28fdbaf461d4"}, "originalPosition": 36}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2249d3c8ae9b953bc1e18b9e37f00c9f8d04a6ac", "author": {"user": null}, "url": "https://github.com/apache/cxf/commit/2249d3c8ae9b953bc1e18b9e37f00c9f8d04a6ac", "committedDate": "2020-04-12T19:16:39Z", "message": "[CXF-8213] Fixed review comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkxODk2MzAz", "url": "https://github.com/apache/cxf/pull/642#pullrequestreview-391896303", "createdAt": "2020-04-12T21:25:49Z", "commit": {"oid": "2249d3c8ae9b953bc1e18b9e37f00c9f8d04a6ac"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMlQyMToyNTo1MFrOGEY0ZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xMlQyMToyNTo1MFrOGEY0ZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzI1NDExNw==", "bodyText": "If we apply the idea with customizers (to replace narrow scoped ExceptionClassProvider and JaxwsFaultCodeProvider), we could rename this class to StandardTagsProvider and keep it independent from JAX-WS.", "url": "https://github.com/apache/cxf/pull/642#discussion_r407254117", "createdAt": "2020-04-12T21:25:50Z", "author": {"login": "reta"}, "path": "rt/features/metrics/src/main/java/org/apache/cxf/metrics/micrometer/provider/jaxws/JaxwsTagsProvider.java", "diffHunk": "@@ -0,0 +1,62 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements. See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership. The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.cxf.metrics.micrometer.provider.jaxws;\n+\n+import org.apache.cxf.message.Exchange;\n+import org.apache.cxf.message.Message;\n+import org.apache.cxf.metrics.micrometer.provider.ExceptionClassProvider;\n+import org.apache.cxf.metrics.micrometer.provider.TagsProvider;\n+\n+import io.micrometer.core.instrument.Tag;\n+import io.micrometer.core.instrument.Tags;\n+\n+import static java.util.Optional.ofNullable;\n+\n+public class JaxwsTagsProvider implements TagsProvider {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2249d3c8ae9b953bc1e18b9e37f00c9f8d04a6ac"}, "originalPosition": 32}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "329aa6a30acc8e150eb593913df58a5bc66fa08d", "author": {"user": null}, "url": "https://github.com/apache/cxf/commit/329aa6a30acc8e150eb593913df58a5bc66fa08d", "committedDate": "2020-10-12T11:52:03Z", "message": "Merge branch 'master' into CXF-8213\n\n# Conflicts:\n#\tparent/pom.xml\n#\tsystests/spring-boot/pom.xml"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e94569d748be2a31fe52538439b4deae7691c047", "author": {"user": null}, "url": "https://github.com/apache/cxf/commit/e94569d748be2a31fe52538439b4deae7691c047", "committedDate": "2020-10-12T14:20:40Z", "message": "[CXF-8213] Fixed compile error"}, "afterCommit": {"oid": "29f87a8a0ec4ab8fe4f788a4b1049717132f6bdd", "author": {"user": null}, "url": "https://github.com/apache/cxf/commit/29f87a8a0ec4ab8fe4f788a4b1049717132f6bdd", "committedDate": "2020-10-12T16:45:29Z", "message": "[CXF-8213] Fixed compile error"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c1e5c17283caf53cea7457ccd32748a6ca220de3", "author": {"user": null}, "url": "https://github.com/apache/cxf/commit/c1e5c17283caf53cea7457ccd32748a6ca220de3", "committedDate": "2020-10-13T14:54:30Z", "message": "[CXF-8213] Fixed compile error"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "29f87a8a0ec4ab8fe4f788a4b1049717132f6bdd", "author": {"user": null}, "url": "https://github.com/apache/cxf/commit/29f87a8a0ec4ab8fe4f788a4b1049717132f6bdd", "committedDate": "2020-10-12T16:45:29Z", "message": "[CXF-8213] Fixed compile error"}, "afterCommit": {"oid": "c1e5c17283caf53cea7457ccd32748a6ca220de3", "author": {"user": null}, "url": "https://github.com/apache/cxf/commit/c1e5c17283caf53cea7457ccd32748a6ca220de3", "committedDate": "2020-10-13T14:54:30Z", "message": "[CXF-8213] Fixed compile error"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c22cd6596686c898f66b1e8d5a80b2c8d62499ec", "author": {"user": null}, "url": "https://github.com/apache/cxf/commit/c22cd6596686c898f66b1e8d5a80b2c8d62499ec", "committedDate": "2020-10-15T10:28:58Z", "message": "[CXF-8213] Fixed failing test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "29225cc6d2e09b7dea1ca9d3a0116c3276905943", "author": {"user": null}, "url": "https://github.com/apache/cxf/commit/29225cc6d2e09b7dea1ca9d3a0116c3276905943", "committedDate": "2020-10-15T14:59:35Z", "message": "[CXF-8213] Fixed review comments"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8c3c3d14f28bd759a55735a4427da10de0f88c6b", "author": {"user": null}, "url": "https://github.com/apache/cxf/commit/8c3c3d14f28bd759a55735a4427da10de0f88c6b", "committedDate": "2020-10-15T19:36:07Z", "message": "[CXF-8213] Fixed review comments"}, "afterCommit": {"oid": "297c6b44af966debf3908ad82c7d5143321efbeb", "author": {"user": null}, "url": "https://github.com/apache/cxf/commit/297c6b44af966debf3908ad82c7d5143321efbeb", "committedDate": "2020-10-15T19:45:56Z", "message": "[CXF-8213] Fixed review comments"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "297c6b44af966debf3908ad82c7d5143321efbeb", "author": {"user": null}, "url": "https://github.com/apache/cxf/commit/297c6b44af966debf3908ad82c7d5143321efbeb", "committedDate": "2020-10-15T19:45:56Z", "message": "[CXF-8213] Fixed review comments"}, "afterCommit": {"oid": "3525fc1e4747cd90811168d9b88a4ccb11014097", "author": {"user": null}, "url": "https://github.com/apache/cxf/commit/3525fc1e4747cd90811168d9b88a4ccb11014097", "committedDate": "2020-10-15T23:07:30Z", "message": "[CXF-8213] Fixed review comments"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3525fc1e4747cd90811168d9b88a4ccb11014097", "author": {"user": null}, "url": "https://github.com/apache/cxf/commit/3525fc1e4747cd90811168d9b88a4ccb11014097", "committedDate": "2020-10-15T23:07:30Z", "message": "[CXF-8213] Fixed review comments"}, "afterCommit": {"oid": "b2135b774be2f5ad175c0f88de6c9cfc7502634f", "author": {"user": null}, "url": "https://github.com/apache/cxf/commit/b2135b774be2f5ad175c0f88de6c9cfc7502634f", "committedDate": "2020-10-15T23:29:58Z", "message": "[CXF-8213] Fixed review comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3f352a7ec081ddb38d0c034fe5fb1a641cac1a4b", "author": {"user": null}, "url": "https://github.com/apache/cxf/commit/3f352a7ec081ddb38d0c034fe5fb1a641cac1a4b", "committedDate": "2020-10-15T23:39:30Z", "message": "[CXF-8213] Fixed review comments"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b2135b774be2f5ad175c0f88de6c9cfc7502634f", "author": {"user": null}, "url": "https://github.com/apache/cxf/commit/b2135b774be2f5ad175c0f88de6c9cfc7502634f", "committedDate": "2020-10-15T23:29:58Z", "message": "[CXF-8213] Fixed review comments"}, "afterCommit": {"oid": "3f352a7ec081ddb38d0c034fe5fb1a641cac1a4b", "author": {"user": null}, "url": "https://github.com/apache/cxf/commit/3f352a7ec081ddb38d0c034fe5fb1a641cac1a4b", "committedDate": "2020-10-15T23:39:30Z", "message": "[CXF-8213] Fixed review comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwOTk3MDc4", "url": "https://github.com/apache/cxf/pull/642#pullrequestreview-510997078", "createdAt": "2020-10-17T16:19:59Z", "commit": {"oid": "3f352a7ec081ddb38d0c034fe5fb1a641cac1a4b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xN1QxNjoxOTo1OVrOHjeT2g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xN1QxNjoxOTo1OVrOHjeT2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjk1ODgxMA==", "bodyText": "Bringing whole Guava for using Iterables seems too much, could you please rewrite it using standard library? Fe:\n            return () -> Stream.concat(\n                    StreamSupport.stream(defaultTags.spliterator(), false), \n                    StreamSupport.stream(additionalTags.spliterator(), false))\n                .iterator();", "url": "https://github.com/apache/cxf/pull/642#discussion_r506958810", "createdAt": "2020-10-17T16:19:59Z", "author": {"login": "reta"}, "path": "rt/features/metrics/src/main/java/org/apache/cxf/metrics/micrometer/MicrometerMetricsContext.java", "diffHunk": "@@ -0,0 +1,138 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements. See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership. The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.cxf.metrics.micrometer;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Set;\n+import java.util.function.Supplier;\n+\n+import com.google.common.collect.Iterables;\n+\n+import org.apache.cxf.message.Exchange;\n+import org.apache.cxf.message.Message;\n+import org.apache.cxf.metrics.MetricsContext;\n+import org.apache.cxf.metrics.micrometer.provider.TagsCustomizer;\n+import org.apache.cxf.metrics.micrometer.provider.TagsProvider;\n+import org.apache.cxf.metrics.micrometer.provider.TimedAnnotationProvider;\n+\n+import io.micrometer.core.annotation.Timed;\n+import io.micrometer.core.instrument.MeterRegistry;\n+import io.micrometer.core.instrument.Tag;\n+import io.micrometer.core.instrument.Timer;\n+\n+public class MicrometerMetricsContext implements MetricsContext {\n+\n+    private final MeterRegistry registry;\n+    private final TagsProvider tagsProvider;\n+    private final TimedAnnotationProvider timedAnnotationProvider;\n+    private final List<TagsCustomizer> tagsCustomizers;\n+\n+    private final String metricName;\n+    private final boolean autoTimeRequests;\n+\n+    public MicrometerMetricsContext(MeterRegistry registry, TagsProvider tagsProvider,\n+                                    TimedAnnotationProvider timedAnnotationProvider,\n+                                    List<TagsCustomizer> tagsCustomizers, String metricName, boolean autoTimeRequests) {\n+        this.registry = registry;\n+        this.tagsProvider = tagsProvider;\n+        this.timedAnnotationProvider = timedAnnotationProvider;\n+        this.tagsCustomizers = tagsCustomizers;\n+        this.metricName = metricName;\n+        this.autoTimeRequests = autoTimeRequests;\n+    }\n+\n+    @Override\n+    public void start(Exchange ex) {\n+        Message request = ex.getInMessage();\n+        TimingContext timingContext = TimingContext.get(request);\n+        if (timingContext == null) {\n+            startAndAttachTimingContext(request);\n+        }\n+    }\n+\n+    @Override\n+    public void stop(long timeInNS, long inSize, long outSize, Exchange ex) {\n+        Message request = ex.getInMessage();\n+        TimingContext timingContext = TimingContext.get(request);\n+        if (timingContext == null) {\n+            timingContext = startAndAttachTimingContext(request);\n+        }\n+        record(timingContext, ex);\n+    }\n+\n+    private TimingContext startAndAttachTimingContext(Message request) {\n+        Timer.Sample timerSample = Timer.start(this.registry);\n+        TimingContext timingContext = new TimingContext(timerSample);\n+        timingContext.attachTo(request);\n+        return timingContext;\n+    }\n+\n+    private void record(TimingContext timingContext, Exchange ex) {\n+        Set<Timed> annotations = timedAnnotationProvider.getTimedAnnotations(ex);\n+        Timer.Sample timerSample = timingContext.getTimerSample();\n+        Supplier<Iterable<Tag>> tags = () -> {\n+            Iterable<Tag> defaultTags = this.tagsProvider.getTags(ex);\n+            List<Tag> additionalTags = new ArrayList<>();\n+            tagsCustomizers\n+                    .forEach(tagsCustomizer -> tagsCustomizer.getAdditionalTags(ex).forEach(additionalTags::add));\n+            return Iterables.concat(defaultTags, additionalTags);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f352a7ec081ddb38d0c034fe5fb1a641cac1a4b"}, "originalPosition": 96}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwOTk3MTE1", "url": "https://github.com/apache/cxf/pull/642#pullrequestreview-510997115", "createdAt": "2020-10-17T16:20:33Z", "commit": {"oid": "3f352a7ec081ddb38d0c034fe5fb1a641cac1a4b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xN1QxNjoyMDozM1rOHjeUDQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xN1QxNjoyMDozM1rOHjeUDQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjk1ODg2MQ==", "bodyText": "Please remove this dependency, not need really (see please the suggested alternative)", "url": "https://github.com/apache/cxf/pull/642#discussion_r506958861", "createdAt": "2020-10-17T16:20:33Z", "author": {"login": "reta"}, "path": "rt/features/metrics/pom.xml", "diffHunk": "@@ -34,14 +34,33 @@\n             <optional>true</optional>\n         </dependency>\n \n+        <dependency>\n+            <groupId>io.micrometer</groupId>\n+            <artifactId>micrometer-core</artifactId>\n+            <optional>true</optional>\n+        </dependency>\n+\n+        <dependency>\n+            <groupId>com.google.guava</groupId>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f352a7ec081ddb38d0c034fe5fb1a641cac1a4b"}, "originalPosition": 11}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwOTk4NzE0", "url": "https://github.com/apache/cxf/pull/642#pullrequestreview-510998714", "createdAt": "2020-10-17T16:43:07Z", "commit": {"oid": "3f352a7ec081ddb38d0c034fe5fb1a641cac1a4b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xN1QxNjo0MzowN1rOHjecPQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xN1QxNjo0MzowN1rOHjecPQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjk2MDk1Nw==", "bodyText": "The flow with nullable timingContext concerns a bit. It should not happen, but assuming it does, we are going to record effectively zeroed samples (since start and stop time would be mostly equal), which basically would screw / mess the metric. I would suggest to skip the record call in this case, or if we could, provide our own sample (since we know the time it took, timeInNS), what do you think?", "url": "https://github.com/apache/cxf/pull/642#discussion_r506960957", "createdAt": "2020-10-17T16:43:07Z", "author": {"login": "reta"}, "path": "rt/features/metrics/src/main/java/org/apache/cxf/metrics/micrometer/MicrometerMetricsContext.java", "diffHunk": "@@ -0,0 +1,138 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements. See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership. The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.cxf.metrics.micrometer;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Set;\n+import java.util.function.Supplier;\n+\n+import com.google.common.collect.Iterables;\n+\n+import org.apache.cxf.message.Exchange;\n+import org.apache.cxf.message.Message;\n+import org.apache.cxf.metrics.MetricsContext;\n+import org.apache.cxf.metrics.micrometer.provider.TagsCustomizer;\n+import org.apache.cxf.metrics.micrometer.provider.TagsProvider;\n+import org.apache.cxf.metrics.micrometer.provider.TimedAnnotationProvider;\n+\n+import io.micrometer.core.annotation.Timed;\n+import io.micrometer.core.instrument.MeterRegistry;\n+import io.micrometer.core.instrument.Tag;\n+import io.micrometer.core.instrument.Timer;\n+\n+public class MicrometerMetricsContext implements MetricsContext {\n+\n+    private final MeterRegistry registry;\n+    private final TagsProvider tagsProvider;\n+    private final TimedAnnotationProvider timedAnnotationProvider;\n+    private final List<TagsCustomizer> tagsCustomizers;\n+\n+    private final String metricName;\n+    private final boolean autoTimeRequests;\n+\n+    public MicrometerMetricsContext(MeterRegistry registry, TagsProvider tagsProvider,\n+                                    TimedAnnotationProvider timedAnnotationProvider,\n+                                    List<TagsCustomizer> tagsCustomizers, String metricName, boolean autoTimeRequests) {\n+        this.registry = registry;\n+        this.tagsProvider = tagsProvider;\n+        this.timedAnnotationProvider = timedAnnotationProvider;\n+        this.tagsCustomizers = tagsCustomizers;\n+        this.metricName = metricName;\n+        this.autoTimeRequests = autoTimeRequests;\n+    }\n+\n+    @Override\n+    public void start(Exchange ex) {\n+        Message request = ex.getInMessage();\n+        TimingContext timingContext = TimingContext.get(request);\n+        if (timingContext == null) {\n+            startAndAttachTimingContext(request);\n+        }\n+    }\n+\n+    @Override\n+    public void stop(long timeInNS, long inSize, long outSize, Exchange ex) {\n+        Message request = ex.getInMessage();\n+        TimingContext timingContext = TimingContext.get(request);\n+        if (timingContext == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f352a7ec081ddb38d0c034fe5fb1a641cac1a4b"}, "originalPosition": 75}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1403917c32efede2c8b38d0d3deb5d09b1b51c32", "author": {"user": null}, "url": "https://github.com/apache/cxf/commit/1403917c32efede2c8b38d0d3deb5d09b1b51c32", "committedDate": "2020-10-17T17:52:03Z", "message": "[CXF-8213] Remove Guava from Metrics feature"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6ece6396ad7a12acc9b835c3d9c18f8e574a5901", "author": {"user": null}, "url": "https://github.com/apache/cxf/commit/6ece6396ad7a12acc9b835c3d9c18f8e574a5901", "committedDate": "2020-10-17T20:33:03Z", "message": "[CXF-8213] Fixed review comments"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5995a03ba497d22bbd1fb82bbb6923468ea4606a", "author": {"user": null}, "url": "https://github.com/apache/cxf/commit/5995a03ba497d22bbd1fb82bbb6923468ea4606a", "committedDate": "2020-10-17T20:10:19Z", "message": "[CXF-8213] Fixed review comments"}, "afterCommit": {"oid": "6ece6396ad7a12acc9b835c3d9c18f8e574a5901", "author": {"user": null}, "url": "https://github.com/apache/cxf/commit/6ece6396ad7a12acc9b835c3d9c18f8e574a5901", "committedDate": "2020-10-17T20:33:03Z", "message": "[CXF-8213] Fixed review comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExMTgxNzE1", "url": "https://github.com/apache/cxf/pull/642#pullrequestreview-511181715", "createdAt": "2020-10-18T20:42:13Z", "commit": {"oid": "6ece6396ad7a12acc9b835c3d9c18f8e574a5901"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOFQyMDo0MjoxM1rOHjtsrg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOFQyMDo0MjoxM1rOHjtsrg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzIxMDkyNg==", "bodyText": "The spring-boot-starter-actuator is missed, sample project fails on startup (no registry):\n        <dependency>\n            <groupId>org.springframework.boot</groupId>\n            <artifactId>spring-boot-starter-actuator</artifactId>\n        </dependency>", "url": "https://github.com/apache/cxf/pull/642#discussion_r507210926", "createdAt": "2020-10-18T20:42:13Z", "author": {"login": "reta"}, "path": "distribution/src/main/release/samples/jaxws_spring_boot/pom.xml", "diffHunk": "@@ -34,6 +35,15 @@\n                 </exclusion>\n             </exclusions>\n         </dependency>\n+        <dependency>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6ece6396ad7a12acc9b835c3d9c18f8e574a5901"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExMjAwNDIz", "url": "https://github.com/apache/cxf/pull/642#pullrequestreview-511200423", "createdAt": "2020-10-18T20:59:31Z", "commit": {"oid": "6ece6396ad7a12acc9b835c3d9c18f8e574a5901"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOFQyMDo1OTozMVrOHjt0AQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOFQyMDo1OTozMVrOHjt0AQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzIxMjgwMQ==", "bodyText": "I think we could strip soap from the bean name, may be name it as metricsMaxAllowedServerUriTagsFilter", "url": "https://github.com/apache/cxf/pull/642#discussion_r507212801", "createdAt": "2020-10-18T20:59:31Z", "author": {"login": "reta"}, "path": "integration/spring-boot/autoconfigure/src/main/java/org/apache/cxf/spring/boot/autoconfigure/micrometer/MicrometerMetricsAutoConfiguration.java", "diffHunk": "@@ -0,0 +1,144 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements. See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership. The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.cxf.spring.boot.autoconfigure.micrometer;\n+\n+import java.util.List;\n+\n+import org.apache.cxf.jaxws.JaxWsServerFactoryBean;\n+import org.apache.cxf.metrics.MetricsProvider;\n+import org.apache.cxf.metrics.micrometer.MicrometerMetricsProperties;\n+import org.apache.cxf.metrics.micrometer.MicrometerMetricsProvider;\n+import org.apache.cxf.metrics.micrometer.provider.DefaultExceptionClassProvider;\n+import org.apache.cxf.metrics.micrometer.provider.ExceptionClassProvider;\n+import org.apache.cxf.metrics.micrometer.provider.StandardTags;\n+import org.apache.cxf.metrics.micrometer.provider.StandardTagsProvider;\n+import org.apache.cxf.metrics.micrometer.provider.TagsCustomizer;\n+import org.apache.cxf.metrics.micrometer.provider.TagsProvider;\n+import org.apache.cxf.metrics.micrometer.provider.TimedAnnotationProvider;\n+import org.apache.cxf.metrics.micrometer.provider.jaxws.JaxwsFaultCodeProvider;\n+import org.apache.cxf.metrics.micrometer.provider.jaxws.JaxwsFaultCodeTagsCustomizer;\n+import org.apache.cxf.metrics.micrometer.provider.jaxws.JaxwsOperationTagsCustomizer;\n+import org.apache.cxf.metrics.micrometer.provider.jaxws.JaxwsTags;\n+import org.apache.cxf.spring.boot.autoconfigure.CxfProperties;\n+import org.apache.cxf.spring.boot.autoconfigure.CxfProperties.Metrics.Server;\n+import org.apache.cxf.spring.boot.autoconfigure.micrometer.provider.SpringBasedTimedAnnotationProvider;\n+import org.springframework.boot.actuate.autoconfigure.metrics.MetricsAutoConfiguration;\n+import org.springframework.boot.actuate.autoconfigure.metrics.OnlyOnceLoggingDenyMeterFilter;\n+import org.springframework.boot.actuate.autoconfigure.metrics.export.simple.SimpleMetricsExportAutoConfiguration;\n+import org.springframework.boot.autoconfigure.AutoConfigureAfter;\n+import org.springframework.boot.autoconfigure.condition.ConditionalOnBean;\n+import org.springframework.boot.autoconfigure.condition.ConditionalOnClass;\n+import org.springframework.boot.autoconfigure.condition.ConditionalOnMissingBean;\n+import org.springframework.boot.autoconfigure.condition.ConditionalOnWebApplication;\n+import org.springframework.boot.context.properties.EnableConfigurationProperties;\n+import org.springframework.context.annotation.Bean;\n+import org.springframework.context.annotation.Configuration;\n+import org.springframework.core.annotation.Order;\n+\n+import io.micrometer.core.instrument.MeterRegistry;\n+import io.micrometer.core.instrument.config.MeterFilter;\n+\n+@Configuration\n+@AutoConfigureAfter({MetricsAutoConfiguration.class, SimpleMetricsExportAutoConfiguration.class})\n+@ConditionalOnWebApplication(type = ConditionalOnWebApplication.Type.SERVLET)\n+@ConditionalOnClass({JaxWsServerFactoryBean.class, MetricsProvider.class})\n+@ConditionalOnBean({MeterRegistry.class})\n+@EnableConfigurationProperties(CxfProperties.class)\n+public class MicrometerMetricsAutoConfiguration {\n+\n+    private final CxfProperties properties;\n+\n+    public MicrometerMetricsAutoConfiguration(CxfProperties properties) {\n+        this.properties = properties;\n+    }\n+\n+    @Bean\n+    public TimedAnnotationProvider timedAnnotationProvider() {\n+        return new SpringBasedTimedAnnotationProvider();\n+    }\n+\n+    @Bean\n+    public JaxwsTags jaxwsTags() {\n+        return new JaxwsTags();\n+    }\n+\n+    @Bean\n+    @ConditionalOnMissingBean(ExceptionClassProvider.class)\n+    public ExceptionClassProvider exceptionClassProvider() {\n+        return new DefaultExceptionClassProvider();\n+    }\n+\n+    @Bean\n+    @ConditionalOnMissingBean(JaxwsFaultCodeProvider.class)\n+    public JaxwsFaultCodeProvider jaxwsFaultCodeProvider() {\n+        return new JaxwsFaultCodeProvider();\n+    }\n+\n+    @Bean\n+    @ConditionalOnMissingBean(JaxwsFaultCodeTagsCustomizer.class)\n+    public JaxwsFaultCodeTagsCustomizer jaxwsFaultCodeTagsCustomizer(JaxwsTags jaxwsTags,\n+                                                                     JaxwsFaultCodeProvider jaxwsFaultCodeProvider) {\n+        return new JaxwsFaultCodeTagsCustomizer(jaxwsTags, jaxwsFaultCodeProvider);\n+    }\n+\n+    @Bean\n+    @ConditionalOnMissingBean(JaxwsOperationTagsCustomizer.class)\n+    public JaxwsOperationTagsCustomizer jaxwsOperationTagsCustomizer(JaxwsTags jaxwsTags) {\n+        return new JaxwsOperationTagsCustomizer(jaxwsTags);\n+    }\n+\n+    @Bean\n+    @ConditionalOnMissingBean(StandardTags.class)\n+    public StandardTags standardTags() {\n+        return new StandardTags();\n+    }\n+\n+    @Bean\n+    @ConditionalOnMissingBean(TagsProvider.class)\n+    public TagsProvider tagsProvider(ExceptionClassProvider exceptionClassProvider, StandardTags standardTags) {\n+        return new StandardTagsProvider(exceptionClassProvider, standardTags);\n+    }\n+\n+    @Bean\n+    @ConditionalOnMissingBean(MetricsProvider.class)\n+    public MetricsProvider metricsProvider(TagsProvider tagsProvider,\n+                                           List<TagsCustomizer> tagsCustomizers,\n+                                           TimedAnnotationProvider timedAnnotationProvider,\n+                                           MeterRegistry registry) {\n+        MicrometerMetricsProperties micrometerMetricsProperties = new MicrometerMetricsProperties();\n+\n+        Server server = this.properties.getMetrics().getServer();\n+        micrometerMetricsProperties.setAutoTimeRequests(server.isAutoTimeRequests());\n+        micrometerMetricsProperties.setRequestsMetricName(server.getRequestsMetricName());\n+\n+        return new MicrometerMetricsProvider(registry, tagsProvider, tagsCustomizers, timedAnnotationProvider,\n+                micrometerMetricsProperties);\n+    }\n+\n+    @Bean\n+    @Order(0)\n+    public MeterFilter metricsSoapServerUriTagFilter() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6ece6396ad7a12acc9b835c3d9c18f8e574a5901"}, "originalPosition": 137}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0fd4d9271f7543383ec5314110c0bca8423d5699", "author": {"user": null}, "url": "https://github.com/apache/cxf/commit/0fd4d9271f7543383ec5314110c0bca8423d5699", "committedDate": "2020-10-19T21:05:09Z", "message": "[CXF-8213] Fixed review comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEzMjE0NjY5", "url": "https://github.com/apache/cxf/pull/642#pullrequestreview-513214669", "createdAt": "2020-10-20T23:54:27Z", "commit": {"oid": "0fd4d9271f7543383ec5314110c0bca8423d5699"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQyMzo1NDoyN1rOHlVNRA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQyMzo1NDoyN1rOHlVNRA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODkwNjgyMA==", "bodyText": "Sorry, a few issues I have run into with this method.\n\nThe computeIfAbsent is known to introduce unnecessary locking on JDK8 in case when entry already exists (see please https://bugs.openjdk.java.net/browse/JDK-8161372). Since we are going to call getTimedAnnotations for each invocation, it is better to avoid these kind if issues if possible.\nWe allocate the empty sets every time for each method that does not have @Timed annotation, we could use Collections.emptySet() singleton instead.\n\nThe suggested modifications are below, hope they make sense (the same would apply to DefaultTimedAnnotationProvider)\n    public Set<Timed> getTimedAnnotations(Exchange ex) {\n        HandlerMethod handlerMethod = new HandlerMethod(ex);\n\n        final Set<Timed> exists = timedAnnotationCache.get(handlerMethod);\n        if (exists  != null) {\n            return exists;\n        }\n\n       return timedAnnotationCache.computeIfAbsent(handlerMethod, method -> {\n            Set<Timed> timed = findTimedAnnotations(method.getMethod());\n            if (timed.isEmpty()) {\n                timed = findTimedAnnotations(method.getBeanType());\n            }\n            return timed.isEmpty() ? Collections.emptySet() : timed;;\n        });\n    }\n\n\nPS: I am fine doing these changes myself after merge as well, please let me know your preferences.", "url": "https://github.com/apache/cxf/pull/642#discussion_r508906820", "createdAt": "2020-10-20T23:54:27Z", "author": {"login": "reta"}, "path": "integration/spring-boot/autoconfigure/src/main/java/org/apache/cxf/spring/boot/autoconfigure/micrometer/provider/SpringBasedTimedAnnotationProvider.java", "diffHunk": "@@ -0,0 +1,97 @@\n+/**\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements. See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership. The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.cxf.spring.boot.autoconfigure.micrometer.provider;\n+\n+import java.lang.reflect.AnnotatedElement;\n+import java.lang.reflect.Method;\n+import java.util.Objects;\n+import java.util.Set;\n+import java.util.concurrent.ConcurrentHashMap;\n+\n+import org.apache.cxf.message.Exchange;\n+import org.apache.cxf.metrics.micrometer.provider.TimedAnnotationProvider;\n+import org.apache.cxf.service.Service;\n+import org.apache.cxf.service.invoker.MethodDispatcher;\n+import org.apache.cxf.service.model.BindingOperationInfo;\n+import org.springframework.core.annotation.MergedAnnotationCollectors;\n+import org.springframework.core.annotation.MergedAnnotations;\n+\n+import io.micrometer.core.annotation.Timed;\n+\n+public class SpringBasedTimedAnnotationProvider implements TimedAnnotationProvider {\n+\n+    private ConcurrentHashMap<HandlerMethod, Set<Timed>> timedAnnotationCache = new ConcurrentHashMap<>();\n+\n+    @Override\n+    public Set<Timed> getTimedAnnotations(Exchange ex) {\n+        HandlerMethod handlerMethod = new HandlerMethod(ex);\n+        return timedAnnotationCache.computeIfAbsent(handlerMethod, method -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0fd4d9271f7543383ec5314110c0bca8423d5699"}, "originalPosition": 45}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e8ec739c59fb6de37912f50aa067ea0679e96884", "author": {"user": null}, "url": "https://github.com/apache/cxf/commit/e8ec739c59fb6de37912f50aa067ea0679e96884", "committedDate": "2020-10-21T15:58:34Z", "message": "Merge remote-tracking branch 'remotes/origin/master' into CXF-8213"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5f25efad95a7bf1bc7aa53762f50fb99b4a704b0", "author": {"user": null}, "url": "https://github.com/apache/cxf/commit/5f25efad95a7bf1bc7aa53762f50fb99b4a704b0", "committedDate": "2020-10-21T16:19:04Z", "message": "[CXF-8213] Fixed Checkstyle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d69e338f7d444981651069f6008cbf87617d03c7", "author": {"user": null}, "url": "https://github.com/apache/cxf/commit/d69e338f7d444981651069f6008cbf87617d03c7", "committedDate": "2020-10-21T16:41:08Z", "message": "[CXF-8213] Fixed performance issues"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE0MTk4MDMw", "url": "https://github.com/apache/cxf/pull/642#pullrequestreview-514198030", "createdAt": "2020-10-21T21:25:41Z", "commit": {"oid": "d69e338f7d444981651069f6008cbf87617d03c7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2198, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}