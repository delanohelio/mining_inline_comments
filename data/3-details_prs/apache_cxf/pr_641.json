{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc2MTA0OTI3", "number": 641, "title": "Prevent RMI registry rebind", "bodyText": "Similar to #640, but also allow different port numbers for the server and registry, if desired.", "createdAt": "2020-02-17T12:14:17Z", "url": "https://github.com/apache/cxf/pull/641", "merged": true, "mergeCommit": {"oid": "543de65106515538ecaef8b57c554e88a7bda0d1"}, "closed": true, "closedAt": "2020-02-20T10:25:12Z", "author": {"login": "jgallimore"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcEN2S5gH2gAyMzc2MTA0OTI3OjYyNWEzNGIzMGRiOTk1Yzg0Mjk1OWFhNTVjMmM0MmYwYzljMWUwYjU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcGIhIBgFqTM2MTc4NzY2OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "625a34b30db995c842959aa55c2c42f0c9c1e0b5", "author": {"user": {"login": "jgallimore", "name": "Jonathan Gallimore"}}, "url": "https://github.com/apache/cxf/commit/625a34b30db995c842959aa55c2c42f0c9c1e0b5", "committedDate": "2020-02-14T11:29:51Z", "message": "Prevent registry rebind"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "71bb6d696fce4615356d8b48343771327c2d795f", "author": {"user": {"login": "jgallimore", "name": "Jonathan Gallimore"}}, "url": "https://github.com/apache/cxf/commit/71bb6d696fce4615356d8b48343771327c2d795f", "committedDate": "2020-02-14T11:44:41Z", "message": "Merge remote-tracking branch 'apache/master' into rmi-reg"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "19713a7681db1dae7073d2ab0e0fde1a0dd2b70f", "author": {"user": {"login": "jgallimore", "name": "Jonathan Gallimore"}}, "url": "https://github.com/apache/cxf/commit/19713a7681db1dae7073d2ab0e0fde1a0dd2b70f", "committedDate": "2020-02-17T11:57:15Z", "message": "Add the RMI server when not running threaded"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "57b744a5a9d33cc7831bbe310e1b068672ae83f1", "author": {"user": {"login": "jgallimore", "name": "Jonathan Gallimore"}}, "url": "https://github.com/apache/cxf/commit/57b744a5a9d33cc7831bbe310e1b068672ae83f1", "committedDate": "2020-02-17T12:12:26Z", "message": "Merge remote-tracking branch 'apache/master' into rmi-reg"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e502467138d4bc96a4b05c74e3308ee6f821cd52", "author": {"user": {"login": "coheigea", "name": "Colm O hEigeartaigh"}}, "url": "https://github.com/apache/cxf/commit/e502467138d4bc96a4b05c74e3308ee6f821cd52", "committedDate": "2020-02-18T15:49:51Z", "message": "Update MBServerConnectorFactory.java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwNDY0Mjg0", "url": "https://github.com/apache/cxf/pull/641#pullrequestreview-360464284", "createdAt": "2020-02-18T16:03:43Z", "commit": {"oid": "e502467138d4bc96a4b05c74e3308ee6f821cd52"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwNTI4MjEy", "url": "https://github.com/apache/cxf/pull/641#pullrequestreview-360528212", "createdAt": "2020-02-18T17:23:23Z", "commit": {"oid": "e502467138d4bc96a4b05c74e3308ee6f821cd52"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxNzoyMzoyNFrOFrLcKA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQxNzoyMzoyNFrOFrLcKA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDgyMDUyMA==", "bodyText": "I'm just wondering what happens if we define a URL that doesn't end with jmxrmi....shouldn't we take the lookup name from the serviceUrl?", "url": "https://github.com/apache/cxf/pull/641#discussion_r380820520", "createdAt": "2020-02-18T17:23:24Z", "author": {"login": "coheigea"}, "path": "rt/management/src/main/java/org/apache/cxf/management/jmx/MBServerConnectorFactory.java", "diffHunk": "@@ -169,18 +174,71 @@ public void run() {\n         } else {\n              // Start the connector server in the same thread.\n             connectorServer.start();\n+            remoteServerStub = rmiServer.toStub();\n         }\n \n         if (LOG.isLoggable(Level.INFO)) {\n             LOG.info(\"JMX connector server started: \" + connectorServer);\n         }\n     }\n \n+    static int getRegistryPort(final String url) {\n+        int serverStart = url.indexOf(\"/jndi/rmi://\");\n+        final String serverPart = url.substring(serverStart + 12);\n+        int portStart = serverPart.indexOf(':') + 1;\n+\n+        int portEnd;\n+        int port = 0;\n+        if (portStart > 0) {\n+            portEnd = indexNotOfNumber(serverPart, portStart);\n+            if (portEnd > portStart) {\n+                final String portString = serverPart.substring(portStart, portEnd);\n+                port = Integer.parseInt(portString);\n+            }\n+        }\n+        return port;\n+    }\n+\n     public void destroy() throws IOException {\n         connectorServer.stop();\n         if (LOG.isLoggable(Level.INFO)) {\n             LOG.info(\"JMX connector server stopped: \" + connectorServer);\n         }\n     }\n \n+    /*\n+     * Better to use the internal API than re-invent the wheel.\n+     */\n+    @SuppressWarnings(\"restriction\")\n+    private class JmxRegistry extends sun.rmi.registry.RegistryImpl {\n+        static final String LOOKUP_NAME = \"jmxrmi\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e502467138d4bc96a4b05c74e3308ee6f821cd52"}, "originalPosition": 129}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "14c6283ea57c5670c26552e63ed98420c6f9e3f0", "author": {"user": {"login": "jgallimore", "name": "Jonathan Gallimore"}}, "url": "https://github.com/apache/cxf/commit/14c6283ea57c5670c26552e63ed98420c6f9e3f0", "committedDate": "2020-02-18T17:27:17Z", "message": "Add compiler option for Java 11. Will look to see if there's a way to avoid the use of sun.rmi.registry altogether"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9c386fa25063baeefbb83d4792ab742bc604a5c9", "author": {"user": {"login": "jgallimore", "name": "Jonathan Gallimore"}}, "url": "https://github.com/apache/cxf/commit/9c386fa25063baeefbb83d4792ab742bc604a5c9", "committedDate": "2020-02-18T17:28:10Z", "message": "Merge branch 'rmi-reg' of github.com:jgallimore/cxf into rmi-reg"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6497cbe9da35a6e747330fdd5b675b4f6e1ba45d", "author": {"user": {"login": "jgallimore", "name": "Jonathan Gallimore"}}, "url": "https://github.com/apache/cxf/commit/6497cbe9da35a6e747330fdd5b675b4f6e1ba45d", "committedDate": "2020-02-18T20:18:28Z", "message": "Identify the lookup name from the JMX URL"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYxMDQ2Mjkz", "url": "https://github.com/apache/cxf/pull/641#pullrequestreview-361046293", "createdAt": "2020-02-19T11:46:26Z", "commit": {"oid": "6497cbe9da35a6e747330fdd5b675b4f6e1ba45d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYxMTcwMDUy", "url": "https://github.com/apache/cxf/pull/641#pullrequestreview-361170052", "createdAt": "2020-02-19T14:45:45Z", "commit": {"oid": "6497cbe9da35a6e747330fdd5b675b4f6e1ba45d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxNDo0NTo0NlrOFrq8dQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxNDo0NTo0NlrOFrq8dQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTMzNjY5Mw==", "bodyText": "Could we make this protected? And add a test for it?", "url": "https://github.com/apache/cxf/pull/641#discussion_r381336693", "createdAt": "2020-02-19T14:45:46Z", "author": {"login": "coheigea"}, "path": "rt/management/src/main/java/org/apache/cxf/management/jmx/MBServerConnectorFactory.java", "diffHunk": "@@ -169,18 +176,85 @@ public void run() {\n         } else {\n              // Start the connector server in the same thread.\n             connectorServer.start();\n+            remoteServerStub = rmiServer.toStub();\n         }\n \n         if (LOG.isLoggable(Level.INFO)) {\n             LOG.info(\"JMX connector server started: \" + connectorServer);\n         }\n     }\n \n+    static int getRegistryPort(final String url) {\n+        int serverStart = url.indexOf(\"/jndi/rmi://\");\n+        final String serverPart = url.substring(serverStart + 12);\n+        int portStart = serverPart.indexOf(':') + 1;\n+\n+        int portEnd;\n+        int port = 0;\n+        if (portStart > 0) {\n+            portEnd = indexNotOfNumber(serverPart, portStart);\n+            if (portEnd > portStart) {\n+                final String portString = serverPart.substring(portStart, portEnd);\n+                port = Integer.parseInt(portString);\n+            }\n+        }\n+        return port;\n+    }\n+\n+    public static String getBindingName(final JMXServiceURL jmxServiceURL) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6497cbe9da35a6e747330fdd5b675b4f6e1ba45d"}, "originalPosition": 119}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "96d2a1962ff8483c622b8efbd526408a825fb9a5", "author": {"user": {"login": "jgallimore", "name": "Jonathan Gallimore"}}, "url": "https://github.com/apache/cxf/commit/96d2a1962ff8483c622b8efbd526408a825fb9a5", "committedDate": "2020-02-19T15:38:16Z", "message": "Adding unit test for getBindingName()"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e010f835853c5a2a1f9c4628cf1ffac546d6f3f0", "author": {"user": {"login": "jgallimore", "name": "Jonathan Gallimore"}}, "url": "https://github.com/apache/cxf/commit/e010f835853c5a2a1f9c4628cf1ffac546d6f3f0", "committedDate": "2020-02-19T16:41:55Z", "message": "Merge remote-tracking branch 'apache/master' into rmi-reg"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYxNjkxOTM3", "url": "https://github.com/apache/cxf/pull/641#pullrequestreview-361691937", "createdAt": "2020-02-20T07:56:19Z", "commit": {"oid": "e010f835853c5a2a1f9c4628cf1ffac546d6f3f0"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa5f56c2028466580710f4e5877363aa5c23c246", "author": {"user": {"login": "jgallimore", "name": "Jonathan Gallimore"}}, "url": "https://github.com/apache/cxf/commit/aa5f56c2028466580710f4e5877363aa5c23c246", "committedDate": "2020-02-20T08:22:00Z", "message": "Re-instating test removed by mistake"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYxNzg3NjY5", "url": "https://github.com/apache/cxf/pull/641#pullrequestreview-361787669", "createdAt": "2020-02-20T10:25:03Z", "commit": {"oid": "aa5f56c2028466580710f4e5877363aa5c23c246"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2194, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}