{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcxOTMwNTI2", "number": 12097, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQxNTo0Mzo1OFrODdut2w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQxNTo0Mzo1OFrODdut2w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyNTAwNjk5OnYy", "diffSide": "RIGHT", "path": "searchlib/src/vespa/searchlib/tensor/hnsw_index_base.cpp", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQxNTo0Mzo1OFrOFmf5Qg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQxNTo0Mzo1OFrOFmf5Qg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTkxMjc3MA==", "bodyText": "If this is always invoked from the writer thread, it's technically sufficient to use a load_relaxed() here since the changes to these structures shall always be visible to that thread anyway. But acquire loads are almost free on x86-64 anyway, so it's hardly something to prematurely optimize for.", "url": "https://github.com/vespa-engine/vespa/pull/12097#discussion_r375912770", "createdAt": "2020-02-06T15:43:58Z", "author": {"login": "vekterli"}, "path": "searchlib/src/vespa/searchlib/tensor/hnsw_index_base.cpp", "diffHunk": "@@ -65,18 +64,16 @@ HnswIndexBase::get_link_array(uint32_t docid, uint32_t level) const\n {\n     auto levels = get_level_array(docid);\n     assert(level < levels.size());\n-    return _links.get(levels[level]);\n+    return _links.get(levels[level].load_acquire());\n }\n \n void\n HnswIndexBase::set_link_array(uint32_t docid, uint32_t level, const LinkArrayRef& links)\n {\n     auto links_ref = _links.add(links);\n-    // TODO: Add memory barrier?\n-    auto node_ref = _node_refs[docid];\n+    auto node_ref = _node_refs[docid].load_acquire();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "97129033202dadaf43615a8b55c35f284979fa65"}, "originalPosition": 44}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2523, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}