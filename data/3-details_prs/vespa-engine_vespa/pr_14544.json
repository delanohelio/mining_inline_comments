{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkyNjYyMDA1", "number": 14544, "title": "Jonmv/more doc api parameters", "bodyText": "@bratseth please review.\nI realised after doing all this that the interface MessageBusSession lets you set route and trace level, and the MessageBusAsyncSession obviously implements this. If the DocumentAccess is supposed to be the \"starting point of the document API\", however, then this is not reachable. You end up having to use the concrete implementation. Setting route and trace level on the whole session is also less flexible, and requires in practice a separate session whenever any of these are to be set \u2014\u00a0or a session per route/tracelevel.\nTo make fieldSet, route and traceLevel available to the users of the document API, I think they should be parameters to each operation, and reflected in the Response. This PR does that, but it's quite a bit of code to achieve this, cluttering APIs somewhat \u2014\u00a0in particular the Response hierarchy.\nSoooo ... PTAL :)", "createdAt": "2020-09-24T19:44:24Z", "url": "https://github.com/vespa-engine/vespa/pull/14544", "merged": true, "mergeCommit": {"oid": "113045894aa7a1fe7b5e0f6b6074fe08f5ec25e1"}, "closed": true, "closedAt": "2020-09-25T07:23:31Z", "author": {"login": "jonmv"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdMGd_hgH2gAyNDkyNjYyMDA1OmJlYTQ5ZmU1YmQzZjRkMDJiMDAzNjE3ZGM4YTdiNDA5MWVjM2E2MzI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdMQkN7AH2gAyNDkyNjYyMDA1OjVjNGNmZTE4YTYyZGI3MGYyNWU2NmIwMDQ1OWUxMWY1NzNiMDViMTY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "bea49fe5bd3f4d02b003617dc8a7b4091ec3a632", "author": {"user": {"login": "jonmv", "name": "Jon Marius Venstad"}}, "url": "https://github.com/vespa-engine/vespa/commit/bea49fe5bd3f4d02b003617dc8a7b4091ec3a632", "committedDate": "2020-09-24T19:36:31Z", "message": "Add DocumentOperationParameters to document session API"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ba878c027385ac2db61dd849d39705c704786f62", "author": {"user": {"login": "jonmv", "name": "Jon Marius Venstad"}}, "url": "https://github.com/vespa-engine/vespa/commit/ba878c027385ac2db61dd849d39705c704786f62", "committedDate": "2020-09-24T19:36:38Z", "message": "Use trace level from parameters, and pass on to Response"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7d280adf22a83d5446153820a42258d352418269", "author": {"user": {"login": "jonmv", "name": "Jon Marius Venstad"}}, "url": "https://github.com/vespa-engine/vespa/commit/7d280adf22a83d5446153820a42258d352418269", "committedDate": "2020-09-24T19:38:03Z", "message": "Use NOT_FOUND in DocumentResponse as well \u2014 as success"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0001e35d02bd576355507d78a44e08514dcc7f0c", "author": {"user": {"login": "jonmv", "name": "Jon Marius Venstad"}}, "url": "https://github.com/vespa-engine/vespa/commit/0001e35d02bd576355507d78a44e08514dcc7f0c", "committedDate": "2020-09-24T19:38:11Z", "message": "Remove _probably_ irrelevant case handling"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "08bca580ba37998cc826629e0a11532c51e35131", "author": {"user": {"login": "jonmv", "name": "Jon Marius Venstad"}}, "url": "https://github.com/vespa-engine/vespa/commit/08bca580ba37998cc826629e0a11532c51e35131", "committedDate": "2020-09-24T19:38:29Z", "message": "Update abi spec"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk2MTYxNTkx", "url": "https://github.com/vespa-engine/vespa/pull/14544#pullrequestreview-496161591", "createdAt": "2020-09-25T07:07:54Z", "commit": {"oid": "bea49fe5bd3f4d02b003617dc8a7b4091ec3a632"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQwNzowNzo1NFrOHX3lvg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQwNzowOTozOVrOHX3olQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDc5MDA3OA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * call will cause one or more {@link DocumentIdResponse} objects to apprear within the timeout time of this session.\n          \n          \n            \n                 * call will cause one or more {@link DocumentIdResponse} objects to appear within the timeout time of this session.", "url": "https://github.com/vespa-engine/vespa/pull/14544#discussion_r494790078", "createdAt": "2020-09-25T07:07:54Z", "author": {"login": "bratseth"}, "path": "documentapi/src/main/java/com/yahoo/documentapi/AsyncSession.java", "diffHunk": "@@ -158,6 +194,23 @@ default Result get(DocumentId id, DocumentProtocol.Priority priority) {\n      * @throws UnsupportedOperationException if this access implementation does not support removal\n      */\n     default Result remove(DocumentId id, DocumentProtocol.Priority priority) {\n+        return remove(id, parameters().withPriority(priority));\n+    }\n+\n+    /**\n+     * <p>Removes a document if it is present. This method returns immediately.</p>\n+     *\n+     * <p>If this result is a success, this\n+     * call will cause one or more {@link DocumentIdResponse} objects to apprear within the timeout time of this session.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bea49fe5bd3f4d02b003617dc8a7b4091ec3a632"}, "originalPosition": 94}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDc5MDUyNg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            /** Optional parameters for a document operation. Immutable class. */\n          \n          \n            \n            /** \n          \n          \n            \n             * Optional parameters for a document operation. Immutable class.\n          \n          \n            \n             *\n          \n          \n            \n             * @author jonmv \n          \n          \n            \n             */", "url": "https://github.com/vespa-engine/vespa/pull/14544#discussion_r494790526", "createdAt": "2020-09-25T07:09:02Z", "author": {"login": "bratseth"}, "path": "documentapi/src/main/java/com/yahoo/documentapi/DocumentOperationParameters.java", "diffHunk": "@@ -0,0 +1,66 @@\n+package com.yahoo.documentapi;\n+\n+import com.yahoo.document.fieldset.FieldSet;\n+import com.yahoo.document.fieldset.FieldSetRepo;\n+import com.yahoo.documentapi.messagebus.protocol.DocumentProtocol;\n+\n+import java.util.Optional;\n+import java.util.OptionalInt;\n+\n+import static java.util.Objects.requireNonNull;\n+\n+/** Optional parameters for a document operation. Immutable class. */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bea49fe5bd3f4d02b003617dc8a7b4091ec3a632"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDc5MDgwNQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            package com.yahoo.documentapi;\n          \n          \n            \n            // Copyright Verizon Media. Licensed under the terms of the Apache 2.0 license. See LICENSE in the project root.\n          \n          \n            \n            package com.yahoo.documentapi;", "url": "https://github.com/vespa-engine/vespa/pull/14544#discussion_r494790805", "createdAt": "2020-09-25T07:09:39Z", "author": {"login": "bratseth"}, "path": "documentapi/src/main/java/com/yahoo/documentapi/DocumentOperationParameters.java", "diffHunk": "@@ -0,0 +1,66 @@\n+package com.yahoo.documentapi;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bea49fe5bd3f4d02b003617dc8a7b4091ec3a632"}, "originalPosition": 1}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f52458bedbbd2856eb6170aecebe008f097b7b5b", "author": {"user": {"login": "jonmv", "name": "Jon Marius Venstad"}}, "url": "https://github.com/vespa-engine/vespa/commit/f52458bedbbd2856eb6170aecebe008f097b7b5b", "committedDate": "2020-09-25T07:22:02Z", "message": "Fix javadoc typo\n\nCo-authored-by: Jon Bratseth <bratseth@oath.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db2797a271390eb12be83910402cbc7c540f78f0", "author": {"user": {"login": "jonmv", "name": "Jon Marius Venstad"}}, "url": "https://github.com/vespa-engine/vespa/commit/db2797a271390eb12be83910402cbc7c540f78f0", "committedDate": "2020-09-25T07:22:12Z", "message": "Fix javadoc header\n\nCo-authored-by: Jon Bratseth <bratseth@oath.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c4cfe18a62db70f25e66b00459e11f573b05b16", "author": {"user": {"login": "jonmv", "name": "Jon Marius Venstad"}}, "url": "https://github.com/vespa-engine/vespa/commit/5c4cfe18a62db70f25e66b00459e11f573b05b16", "committedDate": "2020-09-25T07:22:22Z", "message": "Add copyright header\n\nCo-authored-by: Jon Bratseth <bratseth@oath.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4212, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}