{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM0NDgyNDk5", "number": 13586, "title": "Use foreach_key_range for attribute iterator termwise evaluation", "bodyText": "when inner iterator is a btree iterator.\n@geirst : please review", "createdAt": "2020-06-15T11:41:56Z", "url": "https://github.com/vespa-engine/vespa/pull/13586", "merged": true, "mergeCommit": {"oid": "c967eb26948e0444664322d22f7994fed71ff191"}, "closed": true, "closedAt": "2020-06-15T14:07:17Z", "author": {"login": "toregge"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcrfF-2gH2gAyNDM0NDgyNDk5OmQyYmQ0OThiNGQ4OWFmZDdiMTcwNjAyNTQ5Y2QxNjVhYmI4NDNlMDk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcrhOC3AFqTQzMDY3NzkzMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d2bd498b4d89afd7b170602549cd165abb843e09", "author": {"user": null}, "url": "https://github.com/vespa-engine/vespa/commit/d2bd498b4d89afd7b170602549cd165abb843e09", "committedDate": "2020-06-15T11:38:25Z", "message": "Use foreach_key_range for attribute iterator termwise evaluation\nwhen inner iterator is a btree iterator."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwNjMzNTc5", "url": "https://github.com/vespa-engine/vespa/pull/13586#pullrequestreview-430633579", "createdAt": "2020-06-15T13:17:45Z", "commit": {"oid": "d2bd498b4d89afd7b170602549cd165abb843e09"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxMzoxNzo0NVrOGjxvGA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxMzoxODo0MFrOGjxxUw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDE2ODIxNg==", "bodyText": "This looks like the same code as on lines 142 - 148. Consider refactor into common function.", "url": "https://github.com/vespa-engine/vespa/pull/13586#discussion_r440168216", "createdAt": "2020-06-15T13:17:45Z", "author": {"login": "geirst"}, "path": "searchlib/src/vespa/searchlib/attribute/attributeiterators.hpp", "diffHunk": "@@ -143,8 +191,18 @@ template <typename PL>\n std::unique_ptr<BitVector>\n FilterAttributePostingListIteratorT<PL>::get_hits(uint32_t begin_id) {\n     BitVector::UP result(BitVector::create(begin_id, getEndId()));\n-    for (; _iterator.valid() && _iterator.getKey() < getEndId(); ++_iterator) {\n-        result->setBit(_iterator.getKey());\n+    if constexpr (is_tree_iterator_v<PL>) {\n+        auto end_itr = _iterator;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d2bd498b4d89afd7b170602549cd165abb843e09"}, "originalPosition": 83}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDE2ODc4Nw==", "bodyText": "This looks like the same code as on lines 163 - 173. Consider refactor into common function.", "url": "https://github.com/vespa-engine/vespa/pull/13586#discussion_r440168787", "createdAt": "2020-06-15T13:18:40Z", "author": {"login": "geirst"}, "path": "searchlib/src/vespa/searchlib/attribute/attributeiterators.hpp", "diffHunk": "@@ -154,9 +212,23 @@ template <typename PL>\n void\n FilterAttributePostingListIteratorT<PL>::or_hits_into(BitVector & result, uint32_t begin_id) {\n     (void) begin_id;\n-    for (; _iterator.valid() && _iterator.getKey() < getEndId(); ++_iterator) {\n-        if ( ! result.testBit(_iterator.getKey()) ) {\n-            result.setBit(_iterator.getKey());\n+    if constexpr (is_tree_iterator_v<PL>) {\n+        auto end_itr = _iterator;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d2bd498b4d89afd7b170602549cd165abb843e09"}, "originalPosition": 105}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e04034b9dc7dd3b03ed609395e341c6de560302b", "author": {"user": null}, "url": "https://github.com/vespa-engine/vespa/commit/e04034b9dc7dd3b03ed609395e341c6de560302b", "committedDate": "2020-06-15T13:46:52Z", "message": "Factor out common code."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwNjc3OTMz", "url": "https://github.com/vespa-engine/vespa/pull/13586#pullrequestreview-430677933", "createdAt": "2020-06-15T14:07:02Z", "commit": {"oid": "e04034b9dc7dd3b03ed609395e341c6de560302b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3639, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}