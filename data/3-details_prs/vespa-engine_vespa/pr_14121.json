{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcxMjc2Njgy", "number": 14121, "title": "Move exception handling to where we can give proper feedback to the u\u2026", "bodyText": "\u2026ser.\n@havardpe PR\nThis improves #14117", "createdAt": "2020-08-20T22:40:27Z", "url": "https://github.com/vespa-engine/vespa/pull/14121", "merged": true, "mergeCommit": {"oid": "22f949aa336533ae2e7791ae820920690e56f9ab"}, "closed": true, "closedAt": "2020-08-21T09:45:29Z", "author": {"login": "baldersheim"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdA37rgAH2gAyNDcxMjc2NjgyOjZjNjIwM2U0N2JjY2E1MzA5ZjA4NjVjN2U2YzAyODU1YzYyMjRhMWM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdBBnzAAH2gAyNDcxMjc2NjgyOjhhYTExNWJiZDRjZTU3ZDAzOTFjMjFmNGVkMTg1NGU3OGI4NmNmN2U=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6c6203e47bcca5309f0865c7e6c02855c6224a1c", "author": {"user": {"login": "baldersheim", "name": "Henning Baldersheim"}}, "url": "https://github.com/vespa-engine/vespa/commit/6c6203e47bcca5309f0865c7e6c02855c6224a1c", "committedDate": "2020-08-20T22:27:12Z", "message": "Move exception handling to where we can give proper feedback to the user."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcyMjg5MTA0", "url": "https://github.com/vespa-engine/vespa/pull/14121#pullrequestreview-472289104", "createdAt": "2020-08-21T08:08:11Z", "commit": {"oid": "6c6203e47bcca5309f0865c7e6c02855c6224a1c"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQwODowODoxMVrOHEhTYA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQwODowOTo0MlrOHEhYZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDUwMTk4NA==", "bodyText": "consider start using the vespalib::make_string_short::fmt function", "url": "https://github.com/vespa-engine/vespa/pull/14121#discussion_r474501984", "createdAt": "2020-08-21T08:08:11Z", "author": {"login": "havardpe"}, "path": "storage/src/vespa/storage/persistence/persistencethread.cpp", "diffHunk": "@@ -8,13 +8,16 @@\n #include <vespa/storage/common/bucketoperationlogger.h>\n #include <vespa/document/fieldset/fieldsetrepo.h>\n #include <vespa/document/update/documentupdate.h>\n+#include <vespa/document/base/exceptions.h>\n #include <vespa/vespalib/util/exceptions.h>\n #include <vespa/vespalib/util/isequencedtaskexecutor.h>\n #include <vespa/vespalib/stllike/hash_map.hpp>\n \n #include <vespa/log/log.h>\n LOG_SETUP(\".persistence.thread\");\n \n+using vespalib::make_string;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6c6203e47bcca5309f0865c7e6c02855c6224a1c"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDUwMzI2OQ==", "bodyText": "this sounds like the field is not found in the field set, when the field is already in the field set, but not found in the document.", "url": "https://github.com/vespa-engine/vespa/pull/14121#discussion_r474503269", "createdAt": "2020-08-21T08:09:42Z", "author": {"login": "havardpe"}, "path": "storage/src/vespa/storage/persistence/persistencethread.cpp", "diffHunk": "@@ -277,6 +280,22 @@ spi::ReadConsistency api_read_consistency_to_spi(api::InternalReadConsistency co\n     }\n }\n \n+document::FieldSet::SP\n+getFieldSet(const document::FieldSetRepo & repo, vespalib::stringref name, MessageTracker & tracker) {\n+    try {\n+        return repo.getFieldSet(name);\n+    } catch (document::FieldNotFoundException & e) {\n+        tracker.fail(storage::api::ReturnCode::ILLEGAL_PARAMETERS,\n+                     make_string(\"Field %s not found in fieldset %s\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6c6203e47bcca5309f0865c7e6c02855c6224a1c"}, "originalPosition": 27}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8aa115bbd4ce57d0391c21f4ed1854e78b86cf7e", "author": {"user": {"login": "baldersheim", "name": "Henning Baldersheim"}}, "url": "https://github.com/vespa-engine/vespa/commit/8aa115bbd4ce57d0391c21f4ed1854e78b86cf7e", "committedDate": "2020-08-21T09:44:32Z", "message": "Improve error message, and use 'using' to simplify code."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4438, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}