{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc2MTgwMDY4", "number": 12225, "title": "Use enable_shared_from_this to simplify interface and keep the detail\u2026", "bodyText": "\u2026s local.\n@havardpe PR", "createdAt": "2020-02-17T14:55:52Z", "url": "https://github.com/vespa-engine/vespa/pull/12225", "merged": true, "mergeCommit": {"oid": "5c105fa6ffe3ed27c633e48f17206d2b31307936"}, "closed": true, "closedAt": "2020-02-22T21:49:02Z", "author": {"login": "baldersheim"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcFOfiGgH2gAyMzc2MTgwMDY4OmM0YTAxZTZjM2I4NWViMThlY2UxYzRiNWQ5ZjMzN2IwOGJhM2I3NmQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcG7P3CgH2gAyMzc2MTgwMDY4OmZiNzUxYjY3NDY5YWY1MTYzNzM4NzRhNDRjMzA3ZmExYWYyYzZhODM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c4a01e6c3b85eb18ece1c4b5d9f337b08ba3b76d", "author": {"user": {"login": "baldersheim", "name": "Henning Baldersheim"}}, "url": "https://github.com/vespa-engine/vespa/commit/c4a01e6c3b85eb18ece1c4b5d9f337b08ba3b76d", "committedDate": "2020-02-17T14:48:49Z", "message": "Use enable_shared_from_this to simplify interface and keep the details local."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyNTI3NTYx", "url": "https://github.com/vespa-engine/vespa/pull/12225#pullrequestreview-362527561", "createdAt": "2020-02-21T10:17:58Z", "commit": {"oid": "c4a01e6c3b85eb18ece1c4b5d9f337b08ba3b76d"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxMDoxNzo1OFrOFsyEtA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxMDoyMjowN1rOFsyM1Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjUwMjA2OA==", "bodyText": "I do not like this const-cast. Maybe this function should not be const (since it is allowed to change the object state).", "url": "https://github.com/vespa-engine/vespa/pull/12225#discussion_r382502068", "createdAt": "2020-02-21T10:17:58Z", "author": {"login": "havardpe"}, "path": "searchcore/src/vespa/searchcore/proton/server/searchview.cpp", "diffHunk": "@@ -161,8 +161,9 @@ SearchView::getDocsumsInternal(const DocsumRequest & req)\n }\n \n std::unique_ptr<SearchReply>\n-SearchView::match(const ISearchHandler::SP &self, const SearchRequest &req, ThreadBundle &threadBundle) const {\n-    return _matchView->match(self, req, threadBundle);\n+SearchView::match(const SearchRequest &req, ThreadBundle &threadBundle) const {\n+    ISearchHandler::SP self = const_cast<SearchView *>(this)->shared_from_this();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4a01e6c3b85eb18ece1c4b5d9f337b08ba3b76d"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjUwNDE0OQ==", "bodyText": "A class inheriting from enable_shared_from_this should pass itself as template parameter.\nAlso consider making the constructors private and replace them with static create functions returning shared pointers to ensure that objects are actually owned by shared pointers.", "url": "https://github.com/vespa-engine/vespa/pull/12225#discussion_r382504149", "createdAt": "2020-02-21T10:22:07Z", "author": {"login": "havardpe"}, "path": "searchcore/src/vespa/searchcore/proton/server/searchview.h", "diffHunk": "@@ -8,7 +8,7 @@\n \n namespace proton {\n \n-class SearchView : public ISearchHandler\n+class SearchView : public ISearchHandler, public std::enable_shared_from_this<ISearchHandler>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4a01e6c3b85eb18ece1c4b5d9f337b08ba3b76d"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6a31d94bcc91fad03a8f4058edc9139d29c58118", "author": {"user": {"login": "baldersheim", "name": "Henning Baldersheim"}}, "url": "https://github.com/vespa-engine/vespa/commit/6a31d94bcc91fad03a8f4058edc9139d29c58118", "committedDate": "2020-02-21T17:53:37Z", "message": "Only expose shared_ptr"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb751b67469af516373874a44c307fa1af2c6a83", "author": {"user": {"login": "baldersheim", "name": "Henning Baldersheim"}}, "url": "https://github.com/vespa-engine/vespa/commit/fb751b67469af516373874a44c307fa1af2c6a83", "committedDate": "2020-02-22T21:31:21Z", "message": "Allow passing const SearchView"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2887, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}