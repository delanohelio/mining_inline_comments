{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg5MTU2NTQ5", "number": 12576, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxMToxMToyOVrODoSRSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxMToyMjo1NlrODoSZkQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzNTY4OTcwOnYy", "diffSide": "RIGHT", "path": "config-provisioning/src/main/java/com/yahoo/config/provision/HostSpec.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxMToxMToyOVrOF2vYRQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxMToxMToyOVrOF2vYRQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjk0MzY4NQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    this.dockerImageRepo = Objects.requireNonNull(dockerImageRepo, \"Version cannot be null but can be empty\");;\n          \n          \n            \n                    this.dockerImageRepo = Objects.requireNonNull(dockerImageRepo, \"Docker image repo cannot be null but can be empty\");", "url": "https://github.com/vespa-engine/vespa/pull/12576#discussion_r392943685", "createdAt": "2020-03-16T11:11:29Z", "author": {"login": "freva"}, "path": "config-provisioning/src/main/java/com/yahoo/config/provision/HostSpec.java", "diffHunk": "@@ -77,6 +88,7 @@ public HostSpec(String hostname, List<String> aliases, Optional<Flavor> flavor,\n         this.version = Objects.requireNonNull(version, \"Version cannot be null but can be empty\");;\n         this.networkPorts = Objects.requireNonNull(networkPorts, \"Network ports cannot be null but can be empty\");;\n         this.requestedResources = Objects.requireNonNull(requestedResources, \"RequestedResources cannot be null\");\n+        this.dockerImageRepo = Objects.requireNonNull(dockerImageRepo, \"Version cannot be null but can be empty\");;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b9e3a131b79342f2887d1581333569c09c518ff"}, "originalPosition": 63}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzNTcwNTIyOnYy", "diffSide": "RIGHT", "path": "node-repository/src/main/java/com/yahoo/vespa/hosted/provision/provisioning/InfraDeployerImpl.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxMToyMDoxNlrOF2vj6g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxMjoyMzo1M1rOF2xh8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjk0NjY2Ng==", "bodyText": "Does this apply here? We are potentially allocating new nodes here, which do not have any docker image associated with them. Unless you mean the docker image from https://github.com/vespa-engine/vespa/blob/master/node-repository/src/main/java/com/yahoo/vespa/hosted/provision/provisioning/DockerImages.java\n?", "url": "https://github.com/vespa-engine/vespa/pull/12576#discussion_r392946666", "createdAt": "2020-03-16T11:20:16Z", "author": {"login": "freva"}, "path": "node-repository/src/main/java/com/yahoo/vespa/hosted/provision/provisioning/InfraDeployerImpl.java", "diffHunk": "@@ -88,7 +88,7 @@ public void prepare() {\n                 Version targetVersion = infrastructureVersions.getTargetVersionFor(nodeType);\n                 hostSpecs = provisioner.prepare(\n                         application.getApplicationId(),\n-                        application.getClusterSpecWithVersion(targetVersion),\n+                        application.getClusterSpecWithVersion(targetVersion, Optional.empty()), // TODO: Use dockerImageRepo from zk", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b9e3a131b79342f2887d1581333569c09c518ff"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjk3ODkyOA==", "bodyText": "No, probably not. I'll just remove it for now.", "url": "https://github.com/vespa-engine/vespa/pull/12576#discussion_r392978928", "createdAt": "2020-03-16T12:23:53Z", "author": {"login": "hmusum"}, "path": "node-repository/src/main/java/com/yahoo/vespa/hosted/provision/provisioning/InfraDeployerImpl.java", "diffHunk": "@@ -88,7 +88,7 @@ public void prepare() {\n                 Version targetVersion = infrastructureVersions.getTargetVersionFor(nodeType);\n                 hostSpecs = provisioner.prepare(\n                         application.getApplicationId(),\n-                        application.getClusterSpecWithVersion(targetVersion),\n+                        application.getClusterSpecWithVersion(targetVersion, Optional.empty()), // TODO: Use dockerImageRepo from zk", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjk0NjY2Ng=="}, "originalCommit": {"oid": "2b9e3a131b79342f2887d1581333569c09c518ff"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzNTcxMDg5OnYy", "diffSide": "RIGHT", "path": "config-provisioning/src/test/java/com/yahoo/config/provision/serialization/AllocatedHostsSerializerTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxMToyMjo1NlrOF2vn6Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxMToyMjo1NlrOF2vn6Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjk0NzY4OQ==", "bodyText": "I think you can just compare the Optionals directly\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        assertEquals(expectedHost.dockerImageRepo().orElse(\"\"), deserializedHost.dockerImageRepo().orElse(\"\"));\n          \n          \n            \n                        assertEquals(expectedHost.dockerImageRepo(), deserializedHost.dockerImageRepo());", "url": "https://github.com/vespa-engine/vespa/pull/12576#discussion_r392947689", "createdAt": "2020-03-16T11:22:56Z", "author": {"login": "freva"}, "path": "config-provisioning/src/test/java/com/yahoo/config/provision/serialization/AllocatedHostsSerializerTest.java", "diffHunk": "@@ -72,6 +73,7 @@ private void assertAllocatedHosts(AllocatedHosts expectedHosts, NodeFlavors conf\n             assertEquals(expectedHost.networkPorts(), deserializedHost.networkPorts());\n             assertEquals(expectedHost.aliases(), deserializedHost.aliases());\n             assertEquals(expectedHost.requestedResources(), deserializedHost.requestedResources());\n+            assertEquals(expectedHost.dockerImageRepo().orElse(\"\"), deserializedHost.dockerImageRepo().orElse(\"\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2b9e3a131b79342f2887d1581333569c09c518ff"}, "originalPosition": 14}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2265, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}