{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ2NzYwMzk1", "number": 13848, "title": "Arnej/cleanup parse item and simple query stack", "bodyText": "I confirm that this contribution is made under the terms of the license found in the root directory of this repository's source tree and that I have the authority necessary to make this contribution on behalf of its copyright owner.\n@toregge please review\n@geirst FYI", "createdAt": "2020-07-09T10:10:58Z", "url": "https://github.com/vespa-engine/vespa/pull/13848", "merged": true, "mergeCommit": {"oid": "36f1f82001f4a1b973dfbd6bb28cf57315219420"}, "closed": true, "closedAt": "2020-07-09T17:17:50Z", "author": {"login": "arnej27959"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABczMAQxAH2gAyNDQ2NzYwMzk1Ojg4MDk5YmVjMzI0ODFiODNiNDFmMzk2NmMyYTg4ZWJmNDAzNGYxZmU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABczPVUggFqTQ0NTYzMzA0NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "88099bec32481b83b41f3966c2a88ebf4034f1fe", "author": {"user": {"login": "arnej27959", "name": "Arne H Juul"}}, "url": "https://github.com/vespa-engine/vespa/commit/88099bec32481b83b41f3966c2a88ebf4034f1fe", "committedDate": "2020-07-09T09:55:22Z", "message": "clean up various issues with ParseItem class\n\n* SimpleQueryStack only used for one unit test, move it there\n* Actual instances of ParseItem also only used for same unit test.\n  Split out the object representation into a separate\n  SimpleQueryStackItem class in the unit test directory.\n* give location ITEM_LOCATION_TERM instead of overloading NUMTERM\n* ParseItem::ITEM_PAREN never used for anything, remove it\n* add comment for removal of PAREN enum in prelude/query/Item.java\n* refactor flag handling with one method per flag"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "69c84f46fae6c13b01b085738882e16bc7f11024", "author": {"user": {"login": "arnej27959", "name": "Arne H Juul"}}, "url": "https://github.com/vespa-engine/vespa/commit/69c84f46fae6c13b01b085738882e16bc7f11024", "committedDate": "2020-07-09T10:10:08Z", "message": "GC unused code"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1NTEzMjQ5", "url": "https://github.com/vespa-engine/vespa/pull/13848#pullrequestreview-445513249", "createdAt": "2020-07-09T11:04:58Z", "commit": {"oid": "69c84f46fae6c13b01b085738882e16bc7f11024"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxMTowNDo1OFrOGvMVLQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxMTowNDo1OFrOGvMVLQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjEzODI4NQ==", "bodyText": "Need to update abi\n[ERROR] Class com.yahoo.prelude.query.Item$ItemType: Extra field public static final enum com.yahoo.prelude.query.Item$ItemType LOCATION_TERM", "url": "https://github.com/vespa-engine/vespa/pull/13848#discussion_r452138285", "createdAt": "2020-07-09T11:04:58Z", "author": {"login": "baldersheim"}, "path": "container-search/src/main/java/com/yahoo/prelude/query/Item.java", "diffHunk": "@@ -60,7 +60,8 @@\n         PREDICATE_QUERY(23),\n         REGEXP(24),\n         WORD_ALTERNATIVES(25),\n-        NEAREST_NEIGHBOR(26);\n+        NEAREST_NEIGHBOR(26),\n+        LOCATION_TERM(27);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "69c84f46fae6c13b01b085738882e16bc7f11024"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1NDk5NTky", "url": "https://github.com/vespa-engine/vespa/pull/13848#pullrequestreview-445499592", "createdAt": "2020-07-09T10:42:56Z", "commit": {"oid": "69c84f46fae6c13b01b085738882e16bc7f11024"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxMDo0Mjo1NlrOGvLsJQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxMTowMDoyMlrOGvMM0A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjEyNzc4MQ==", "bodyText": "Please fix comment above.", "url": "https://github.com/vespa-engine/vespa/pull/13848#discussion_r452127781", "createdAt": "2020-07-09T10:42:56Z", "author": {"login": "toregge"}, "path": "searchsummary/src/tests/extractkeywords/simplequerystackitem.h", "diffHunk": "@@ -0,0 +1,148 @@\n+// Copyright 2017 Yahoo Holdings. Licensed under the terms of the Apache 2.0 license. See LICENSE in the project root.\n+\n+#pragma once\n+\n+#include <vespa/searchlib/query/weight.h>\n+#include <vespa/searchlib/util/rawbuf.h>\n+#include <vespa/vespalib/stllike/string.h>\n+#include <vespa/searchlib/parsequery/parse.h>\n+\n+namespace search {\n+\n+/**\n+ * An item on the simple query stack.\n+ *\n+ * An object of this class represents a single item\n+ * on the simple query stack. It has a type, which corresponds\n+ * to the different query stack execution operations. It also\n+ * provides an arity, and the string values indexName and term, to\n+ * accomodate the different needs of the operations.\n+ */\n+class SimpleQueryStackItem : public ParseItem\n+{\n+private:\n+    SimpleQueryStackItem(const SimpleQueryStackItem &) = delete;\n+    SimpleQueryStackItem& operator=(const SimpleQueryStackItem &) = delete;\n+    SimpleQueryStackItem();\n+public:\n+    /** Pointer to next item in a linked list. */\n+    SimpleQueryStackItem *_next;\n+\n+private:\n+    query::Weight _weight;\n+    uint32_t      _uniqueId;\n+    uint32_t      _arg1;\n+    double        _arg2;\n+    double        _arg3;\n+    uint8_t       _type;\n+    uint8_t       _flags;\n+\n+public:\n+    /** Extra information on each item (creator id) coded in bits 12-19 of _type */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "69c84f46fae6c13b01b085738882e16bc7f11024"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjEyOTg3Mw==", "bodyText": "Please fix comment above.", "url": "https://github.com/vespa-engine/vespa/pull/13848#discussion_r452129873", "createdAt": "2020-07-09T10:47:22Z", "author": {"login": "toregge"}, "path": "searchsummary/src/tests/extractkeywords/simplequerystackitem.h", "diffHunk": "@@ -0,0 +1,148 @@\n+// Copyright 2017 Yahoo Holdings. Licensed under the terms of the Apache 2.0 license. See LICENSE in the project root.\n+\n+#pragma once\n+\n+#include <vespa/searchlib/query/weight.h>\n+#include <vespa/searchlib/util/rawbuf.h>\n+#include <vespa/vespalib/stllike/string.h>\n+#include <vespa/searchlib/parsequery/parse.h>\n+\n+namespace search {\n+\n+/**\n+ * An item on the simple query stack.\n+ *\n+ * An object of this class represents a single item\n+ * on the simple query stack. It has a type, which corresponds\n+ * to the different query stack execution operations. It also\n+ * provides an arity, and the string values indexName and term, to\n+ * accomodate the different needs of the operations.\n+ */\n+class SimpleQueryStackItem : public ParseItem\n+{\n+private:\n+    SimpleQueryStackItem(const SimpleQueryStackItem &) = delete;\n+    SimpleQueryStackItem& operator=(const SimpleQueryStackItem &) = delete;\n+    SimpleQueryStackItem();\n+public:\n+    /** Pointer to next item in a linked list. */\n+    SimpleQueryStackItem *_next;\n+\n+private:\n+    query::Weight _weight;\n+    uint32_t      _uniqueId;\n+    uint32_t      _arg1;\n+    double        _arg2;\n+    double        _arg3;\n+    uint8_t       _type;\n+    uint8_t       _flags;\n+\n+public:\n+    /** Extra information on each item (creator id) coded in bits 12-19 of _type */\n+    static inline ItemCreator GetCreator(uint8_t type) { return static_cast<ItemCreator>((type >> 3) & 0x01); }\n+    /** The old item type now uses only the lower 12 bits in a backward compatible way) */\n+    static inline ItemType GetType(uint8_t type) { return static_cast<ItemType>(type & 0x1F); }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "69c84f46fae6c13b01b085738882e16bc7f11024"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjEzNjE0NA==", "bodyText": "Please fix argument name above, it should be flags instead of type.", "url": "https://github.com/vespa-engine/vespa/pull/13848#discussion_r452136144", "createdAt": "2020-07-09T11:00:22Z", "author": {"login": "toregge"}, "path": "searchsummary/src/tests/extractkeywords/simplequerystackitem.h", "diffHunk": "@@ -0,0 +1,148 @@\n+// Copyright 2017 Yahoo Holdings. Licensed under the terms of the Apache 2.0 license. See LICENSE in the project root.\n+\n+#pragma once\n+\n+#include <vespa/searchlib/query/weight.h>\n+#include <vespa/searchlib/util/rawbuf.h>\n+#include <vespa/vespalib/stllike/string.h>\n+#include <vespa/searchlib/parsequery/parse.h>\n+\n+namespace search {\n+\n+/**\n+ * An item on the simple query stack.\n+ *\n+ * An object of this class represents a single item\n+ * on the simple query stack. It has a type, which corresponds\n+ * to the different query stack execution operations. It also\n+ * provides an arity, and the string values indexName and term, to\n+ * accomodate the different needs of the operations.\n+ */\n+class SimpleQueryStackItem : public ParseItem\n+{\n+private:\n+    SimpleQueryStackItem(const SimpleQueryStackItem &) = delete;\n+    SimpleQueryStackItem& operator=(const SimpleQueryStackItem &) = delete;\n+    SimpleQueryStackItem();\n+public:\n+    /** Pointer to next item in a linked list. */\n+    SimpleQueryStackItem *_next;\n+\n+private:\n+    query::Weight _weight;\n+    uint32_t      _uniqueId;\n+    uint32_t      _arg1;\n+    double        _arg2;\n+    double        _arg3;\n+    uint8_t       _type;\n+    uint8_t       _flags;\n+\n+public:\n+    /** Extra information on each item (creator id) coded in bits 12-19 of _type */\n+    static inline ItemCreator GetCreator(uint8_t type) { return static_cast<ItemCreator>((type >> 3) & 0x01); }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "69c84f46fae6c13b01b085738882e16bc7f11024"}, "originalPosition": 42}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1NTI1NDUz", "url": "https://github.com/vespa-engine/vespa/pull/13848#pullrequestreview-445525453", "createdAt": "2020-07-09T11:24:43Z", "commit": {"oid": "69c84f46fae6c13b01b085738882e16bc7f11024"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c4e625a62bfc31d776a66576506404910dd51bba", "author": {"user": {"login": "arnej27959", "name": "Arne H Juul"}}, "url": "https://github.com/vespa-engine/vespa/commit/c4e625a62bfc31d776a66576506404910dd51bba", "committedDate": "2020-07-09T12:24:49Z", "message": "remove even more unused code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "68d95a43f7c3664c3a26dc84b03e2d42a161f5dc", "author": {"user": {"login": "arnej27959", "name": "Arne H Juul"}}, "url": "https://github.com/vespa-engine/vespa/commit/68d95a43f7c3664c3a26dc84b03e2d42a161f5dc", "committedDate": "2020-07-09T12:32:17Z", "message": "update ABI spec"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1NTg4Mjky", "url": "https://github.com/vespa-engine/vespa/pull/13848#pullrequestreview-445588292", "createdAt": "2020-07-09T12:57:05Z", "commit": {"oid": "68d95a43f7c3664c3a26dc84b03e2d42a161f5dc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1NjMzMDQ0", "url": "https://github.com/vespa-engine/vespa/pull/13848#pullrequestreview-445633044", "createdAt": "2020-07-09T13:48:05Z", "commit": {"oid": "68d95a43f7c3664c3a26dc84b03e2d42a161f5dc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3536, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}