{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY0Nzk0Nzgw", "number": 11855, "title": "Jvenstad/optional submission data", "bodyText": "@freva please reivew.", "createdAt": "2020-01-20T11:51:18Z", "url": "https://github.com/vespa-engine/vespa/pull/11855", "merged": true, "mergeCommit": {"oid": "157f6039f21c4a756c12a6aaf47237363e3a13e0"}, "closed": true, "closedAt": "2020-01-20T12:11:03Z", "author": {"login": "jonmv"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb8KijxgH2gAyMzY0Nzk0NzgwOjExNWEzYjI0MmJlMWU2MDQzZDkyN2JjZDc1NzBkZTVjNmVmZWZhNDQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb8Lcb4AH2gAyMzY0Nzk0NzgwOmJjZTA1MzFjM2Y3Njc5YTQxNzZhODkyNjA4YTlmNzdiMzFmOTg0OGQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "115a3b242be1e6043d927bcd7570de5c6efefa44", "author": {"user": {"login": "jonmv", "name": "Jon Marius Venstad"}}, "url": "https://github.com/vespa-engine/vespa/commit/115a3b242be1e6043d927bcd7570de5c6efefa44", "committedDate": "2020-01-20T11:07:11Z", "message": "Make mojo send only specified data, and make it all optional"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5f4ca0aab540012fb02326fd597207c2a181add6", "author": {"user": {"login": "jonmv", "name": "Jon Marius Venstad"}}, "url": "https://github.com/vespa-engine/vespa/commit/5f4ca0aab540012fb02326fd597207c2a181add6", "committedDate": "2020-01-20T11:50:58Z", "message": "Make ApplicationVersion id depend on number and commit, and make revision optional"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ1MjU3ODcz", "url": "https://github.com/vespa-engine/vespa/pull/11855#pullrequestreview-345257873", "createdAt": "2020-01-20T11:54:18Z", "commit": {"oid": "5f4ca0aab540012fb02326fd597207c2a181add6"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMFQxMTo1NDoxOFrOFfcBEw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMFQxMTo1OTo1OFrOFfcJug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODUwOTIwMw==", "bodyText": "\ud83d\udc4f", "url": "https://github.com/vespa-engine/vespa/pull/11855#discussion_r368509203", "createdAt": "2020-01-20T11:54:18Z", "author": {"login": "freva"}, "path": "controller-api/src/main/java/com/yahoo/vespa/hosted/controller/api/integration/deployment/ApplicationVersion.java", "diffHunk": "@@ -39,24 +40,22 @@\n     public ApplicationVersion(Optional<SourceRevision> source, OptionalLong buildNumber, Optional<String> authorEmail,\n                                Optional<Version> compileVersion, Optional<Instant> buildTime, Optional<String> sourceUrl,\n                                Optional<String> commit) {\n-        Objects.requireNonNull(source, \"source cannot be null\");\n-        Objects.requireNonNull(buildNumber, \"buildNumber cannot be null\");\n-        Objects.requireNonNull(authorEmail, \"author cannot be null\");\n-        if (source.isPresent() != buildNumber.isPresent()) {\n-            throw new IllegalArgumentException(\"both buildNumber and source must be set together\");\n-        }\n-        if (compileVersion.isPresent() != buildTime.isPresent()) {\n-            throw new IllegalArgumentException(\"both compileVersion and buildTime must be set together\");\n-        }\n-        if (buildNumber.isPresent() && buildNumber.getAsLong() <= 0) {\n-            throw new IllegalArgumentException(\"buildNumber must be > 0\");\n-        }\n-        if (authorEmail.isPresent() && ! authorEmail.get().matches(\"[^@]+@[^@]+\")) {\n+        if (buildNumber.isEmpty() && (   source.isPresent() || authorEmail.isPresent() || compileVersion.isPresent()\n+                                      || buildTime.isPresent() || sourceUrl.isPresent() || commit.isPresent()))\n+            throw new IllegalArgumentException(\"Build number must be present if any other attribute is\");\n+\n+        if (buildNumber.isPresent() && buildNumber.getAsLong() <= 0)\n+            throw new IllegalArgumentException(\"Build number must be > 0\");\n+\n+        if (commit.isPresent() && commit.get().length() > 128)\n+            throw new IllegalArgumentException(\"Commit may not be longer than 128 characters\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5f4ca0aab540012fb02326fd597207c2a181add6"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODUxMTEzNA==", "bodyText": "When can buildNumber be empty?", "url": "https://github.com/vespa-engine/vespa/pull/11855#discussion_r368511134", "createdAt": "2020-01-20T11:59:12Z", "author": {"login": "freva"}, "path": "controller-api/src/main/java/com/yahoo/vespa/hosted/controller/api/integration/deployment/ApplicationVersion.java", "diffHunk": "@@ -39,24 +40,22 @@\n     public ApplicationVersion(Optional<SourceRevision> source, OptionalLong buildNumber, Optional<String> authorEmail,\n                                Optional<Version> compileVersion, Optional<Instant> buildTime, Optional<String> sourceUrl,\n                                Optional<String> commit) {\n-        Objects.requireNonNull(source, \"source cannot be null\");\n-        Objects.requireNonNull(buildNumber, \"buildNumber cannot be null\");\n-        Objects.requireNonNull(authorEmail, \"author cannot be null\");\n-        if (source.isPresent() != buildNumber.isPresent()) {\n-            throw new IllegalArgumentException(\"both buildNumber and source must be set together\");\n-        }\n-        if (compileVersion.isPresent() != buildTime.isPresent()) {\n-            throw new IllegalArgumentException(\"both compileVersion and buildTime must be set together\");\n-        }\n-        if (buildNumber.isPresent() && buildNumber.getAsLong() <= 0) {\n-            throw new IllegalArgumentException(\"buildNumber must be > 0\");\n-        }\n-        if (authorEmail.isPresent() && ! authorEmail.get().matches(\"[^@]+@[^@]+\")) {\n+        if (buildNumber.isEmpty() && (   source.isPresent() || authorEmail.isPresent() || compileVersion.isPresent()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5f4ca0aab540012fb02326fd597207c2a181add6"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODUxMTQxOA==", "bodyText": "Validate URL somewhere?", "url": "https://github.com/vespa-engine/vespa/pull/11855#discussion_r368511418", "createdAt": "2020-01-20T11:59:58Z", "author": {"login": "freva"}, "path": "controller-api/src/main/java/com/yahoo/vespa/hosted/controller/api/integration/deployment/ApplicationVersion.java", "diffHunk": "@@ -39,24 +40,22 @@\n     public ApplicationVersion(Optional<SourceRevision> source, OptionalLong buildNumber, Optional<String> authorEmail,\n                                Optional<Version> compileVersion, Optional<Instant> buildTime, Optional<String> sourceUrl,\n                                Optional<String> commit) {\n-        Objects.requireNonNull(source, \"source cannot be null\");\n-        Objects.requireNonNull(buildNumber, \"buildNumber cannot be null\");\n-        Objects.requireNonNull(authorEmail, \"author cannot be null\");\n-        if (source.isPresent() != buildNumber.isPresent()) {\n-            throw new IllegalArgumentException(\"both buildNumber and source must be set together\");\n-        }\n-        if (compileVersion.isPresent() != buildTime.isPresent()) {\n-            throw new IllegalArgumentException(\"both compileVersion and buildTime must be set together\");\n-        }\n-        if (buildNumber.isPresent() && buildNumber.getAsLong() <= 0) {\n-            throw new IllegalArgumentException(\"buildNumber must be > 0\");\n-        }\n-        if (authorEmail.isPresent() && ! authorEmail.get().matches(\"[^@]+@[^@]+\")) {\n+        if (buildNumber.isEmpty() && (   source.isPresent() || authorEmail.isPresent() || compileVersion.isPresent()\n+                                      || buildTime.isPresent() || sourceUrl.isPresent() || commit.isPresent()))\n+            throw new IllegalArgumentException(\"Build number must be present if any other attribute is\");\n+\n+        if (buildNumber.isPresent() && buildNumber.getAsLong() <= 0)\n+            throw new IllegalArgumentException(\"Build number must be > 0\");\n+\n+        if (commit.isPresent() && commit.get().length() > 128)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5f4ca0aab540012fb02326fd597207c2a181add6"}, "originalPosition": 32}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bce0531c3f7679a4176a892608a9f77b31f9848d", "author": {"user": {"login": "jonmv", "name": "Jon Marius Venstad"}}, "url": "https://github.com/vespa-engine/vespa/commit/bce0531c3f7679a4176a892608a9f77b31f9848d", "committedDate": "2020-01-20T12:10:24Z", "message": "Validate sourceUrl parameters"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3940, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}