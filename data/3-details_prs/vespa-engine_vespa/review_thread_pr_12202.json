{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc1NDYzNzgx", "number": 12202, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QxNTo1MToyMlrODgb76g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QxNjowMjo1NFrODgcLKg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM1MzM4NzMwOnYy", "diffSide": "RIGHT", "path": "config-model/src/main/java/com/yahoo/vespa/model/container/search/ContainerSearch.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QxNTo1MToyMlrOFqpE8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QyMTo1NjozOVrOFqwcSQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDI1NzUyMg==", "bodyText": "Suggest to use var for these, as their type is clear from the right hand side.", "url": "https://github.com/vespa-engine/vespa/pull/12202#discussion_r380257522", "createdAt": "2020-02-17T15:51:22Z", "author": {"login": "gjoranv"}, "path": "config-model/src/main/java/com/yahoo/vespa/model/container/search/ContainerSearch.java", "diffHunk": "@@ -58,7 +59,11 @@ public void connectSearchClusters(Map<String, AbstractSearchCluster> searchClust\n     private void initializeDispatchers(Collection<AbstractSearchCluster> searchClusters) {\n         for (AbstractSearchCluster searchCluster : searchClusters) {\n             if ( ! ( searchCluster instanceof IndexedSearchCluster)) continue;\n-            owningCluster.addComponent(new DispatcherComponent((IndexedSearchCluster)searchCluster));\n+            Component dispatcher = new DispatcherComponent((IndexedSearchCluster)searchCluster);\n+            Component rpcResoucePool = new RpcResourcePoolComponent();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6393b18c87614ab8bda956414bc0d9f2a963fd8d"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDM3ODE4NQ==", "bodyText": "Can use 'var' for rpcResourcePool, but due to some generics mumbo jumbo with addComponent it was not possible for the dispatcher.", "url": "https://github.com/vespa-engine/vespa/pull/12202#discussion_r380378185", "createdAt": "2020-02-17T21:56:39Z", "author": {"login": "baldersheim"}, "path": "config-model/src/main/java/com/yahoo/vespa/model/container/search/ContainerSearch.java", "diffHunk": "@@ -58,7 +59,11 @@ public void connectSearchClusters(Map<String, AbstractSearchCluster> searchClust\n     private void initializeDispatchers(Collection<AbstractSearchCluster> searchClusters) {\n         for (AbstractSearchCluster searchCluster : searchClusters) {\n             if ( ! ( searchCluster instanceof IndexedSearchCluster)) continue;\n-            owningCluster.addComponent(new DispatcherComponent((IndexedSearchCluster)searchCluster));\n+            Component dispatcher = new DispatcherComponent((IndexedSearchCluster)searchCluster);\n+            Component rpcResoucePool = new RpcResourcePoolComponent();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDI1NzUyMg=="}, "originalCommit": {"oid": "6393b18c87614ab8bda956414bc0d9f2a963fd8d"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM1MzQxMzk0OnYy", "diffSide": "RIGHT", "path": "config-model/src/main/java/com/yahoo/vespa/model/container/search/ContainerSearch.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QxNTo1OToyMVrOFqpVGw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QyMTo1NDo1N1rOFqwaqQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDI2MTY1OQ==", "bodyText": "Just inject() will do. The name is only used with the @Named annotation for named constructor params, which is useful when the same ctor needs multiple instances of the same class.", "url": "https://github.com/vespa-engine/vespa/pull/12202#discussion_r380261659", "createdAt": "2020-02-17T15:59:21Z", "author": {"login": "gjoranv"}, "path": "config-model/src/main/java/com/yahoo/vespa/model/container/search/ContainerSearch.java", "diffHunk": "@@ -58,7 +59,11 @@ public void connectSearchClusters(Map<String, AbstractSearchCluster> searchClust\n     private void initializeDispatchers(Collection<AbstractSearchCluster> searchClusters) {\n         for (AbstractSearchCluster searchCluster : searchClusters) {\n             if ( ! ( searchCluster instanceof IndexedSearchCluster)) continue;\n-            owningCluster.addComponent(new DispatcherComponent((IndexedSearchCluster)searchCluster));\n+            Component dispatcher = new DispatcherComponent((IndexedSearchCluster)searchCluster);\n+            Component rpcResoucePool = new RpcResourcePoolComponent();\n+            dispatcher.injectForName(rpcResoucePool.getComponentId().getName(), rpcResoucePool);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6393b18c87614ab8bda956414bc0d9f2a963fd8d"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDM3Nzc2OQ==", "bodyText": "Ok, fixed", "url": "https://github.com/vespa-engine/vespa/pull/12202#discussion_r380377769", "createdAt": "2020-02-17T21:54:57Z", "author": {"login": "baldersheim"}, "path": "config-model/src/main/java/com/yahoo/vespa/model/container/search/ContainerSearch.java", "diffHunk": "@@ -58,7 +59,11 @@ public void connectSearchClusters(Map<String, AbstractSearchCluster> searchClust\n     private void initializeDispatchers(Collection<AbstractSearchCluster> searchClusters) {\n         for (AbstractSearchCluster searchCluster : searchClusters) {\n             if ( ! ( searchCluster instanceof IndexedSearchCluster)) continue;\n-            owningCluster.addComponent(new DispatcherComponent((IndexedSearchCluster)searchCluster));\n+            Component dispatcher = new DispatcherComponent((IndexedSearchCluster)searchCluster);\n+            Component rpcResoucePool = new RpcResourcePoolComponent();\n+            dispatcher.injectForName(rpcResoucePool.getComponentId().getName(), rpcResoucePool);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDI2MTY1OQ=="}, "originalCommit": {"oid": "6393b18c87614ab8bda956414bc0d9f2a963fd8d"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM1MzQyNjM0OnYy", "diffSide": "RIGHT", "path": "config-model/src/main/java/com/yahoo/vespa/model/container/search/RpcResourcePoolComponent.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QxNjowMjo1NFrOFqpcjQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QyMTo1Njo1OFrOFqwclA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDI2MzU2NQ==", "bodyText": "container-search is available from the model, so the class object can be used instead of a string. It will then fail compile-time instead of runtime if the class is moved or renamed.", "url": "https://github.com/vespa-engine/vespa/pull/12202#discussion_r380263565", "createdAt": "2020-02-17T16:02:54Z", "author": {"login": "gjoranv"}, "path": "config-model/src/main/java/com/yahoo/vespa/model/container/search/RpcResourcePoolComponent.java", "diffHunk": "@@ -0,0 +1,18 @@\n+// Copyright 2020 Oath Inc. Licensed under the terms of the Apache 2.0 license. See LICENSE in the project root.\n+package com.yahoo.vespa.model.container.search;\n+\n+import com.yahoo.osgi.provider.model.ComponentModel;\n+import com.yahoo.vespa.model.container.component.Component;\n+import com.yahoo.vespa.model.container.xml.BundleMapper;\n+\n+public class RpcResourcePoolComponent extends Component<RpcResourcePoolComponent, ComponentModel> {\n+\n+    public RpcResourcePoolComponent() {\n+        super(toComponentModel());\n+    }\n+\n+    private static ComponentModel toComponentModel() {\n+        String className = \"com.yahoo.search.dispatch.rpc.RpcResourcePool\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6393b18c87614ab8bda956414bc0d9f2a963fd8d"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDM3ODI2MA==", "bodyText": "Thanks, done.", "url": "https://github.com/vespa-engine/vespa/pull/12202#discussion_r380378260", "createdAt": "2020-02-17T21:56:58Z", "author": {"login": "baldersheim"}, "path": "config-model/src/main/java/com/yahoo/vespa/model/container/search/RpcResourcePoolComponent.java", "diffHunk": "@@ -0,0 +1,18 @@\n+// Copyright 2020 Oath Inc. Licensed under the terms of the Apache 2.0 license. See LICENSE in the project root.\n+package com.yahoo.vespa.model.container.search;\n+\n+import com.yahoo.osgi.provider.model.ComponentModel;\n+import com.yahoo.vespa.model.container.component.Component;\n+import com.yahoo.vespa.model.container.xml.BundleMapper;\n+\n+public class RpcResourcePoolComponent extends Component<RpcResourcePoolComponent, ComponentModel> {\n+\n+    public RpcResourcePoolComponent() {\n+        super(toComponentModel());\n+    }\n+\n+    private static ComponentModel toComponentModel() {\n+        String className = \"com.yahoo.search.dispatch.rpc.RpcResourcePool\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDI2MzU2NQ=="}, "originalCommit": {"oid": "6393b18c87614ab8bda956414bc0d9f2a963fd8d"}, "originalPosition": 15}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2494, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}