{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgwMjA1Mzcx", "number": 12348, "title": "Arnej/shrink if needed", "bodyText": "I confirm that this contribution is made under the terms of the license found in the root directory of this repository's source tree and that I have the authority necessary to make this contribution on behalf of its copyright owner.\n@geirst please review", "createdAt": "2020-02-26T12:17:11Z", "url": "https://github.com/vespa-engine/vespa/pull/12348", "merged": true, "mergeCommit": {"oid": "0b1ce5f0c2f709c1ef103269b87a08f933e3e44a"}, "closed": true, "closedAt": "2020-02-27T10:09:30Z", "author": {"login": "arnej27959"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcIFF9vgH2gAyMzgwMjA1MzcxOmIzZWZmNzgxYWUzODZkMmYxNjlkY2RlMzYzZWNmMWY5NGUxMzk3Y2Q=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcIX8XtAH2gAyMzgwMjA1MzcxOmY1NzQzY2Y4YjQ5OTAxYmI1YzQ2MjE2MDQ0MTEwYjIwZjJmODI0Njk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b3eff781ae386d2f169dcde363ecf1f94e1397cd", "author": {"user": {"login": "arnej27959", "name": "Arne H Juul"}}, "url": "https://github.com/vespa-engine/vespa/commit/b3eff781ae386d2f169dcde363ecf1f94e1397cd", "committedDate": "2020-02-26T11:33:31Z", "message": "shrink links if needed\n\n* select \"M\" links on all layers\n* change unit test parameters to avoid triggering shrink early\n* add symmetry validation method for use from unit test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "be8f9cc5c7bc8555e766b95b1e0c4cc6a0bb12b1", "author": {"user": {"login": "arnej27959", "name": "Arne H Juul"}}, "url": "https://github.com/vespa-engine/vespa/commit/be8f9cc5c7bc8555e766b95b1e0c4cc6a0bb12b1", "committedDate": "2020-02-26T11:33:31Z", "message": "rename config variable"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1MDA3Mzc3", "url": "https://github.com/vespa-engine/vespa/pull/12348#pullrequestreview-365007377", "createdAt": "2020-02-26T15:42:06Z", "commit": {"oid": "b3eff781ae386d2f169dcde363ecf1f94e1397cd"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxNTo0MjowNlrOFuwt2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxNTo0NTowNFrOFuw2Iw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDU3Njk4NQ==", "bodyText": "Shouldn't we still differentiate between max links for level 0 and hierarchical levels?", "url": "https://github.com/vespa-engine/vespa/pull/12348#discussion_r384576985", "createdAt": "2020-02-26T15:42:06Z", "author": {"login": "geirst"}, "path": "searchlib/src/vespa/searchlib/tensor/hnsw_index.cpp", "diffHunk": "@@ -287,8 +325,8 @@ HnswIndex::add_document(uint32_t docid)\n     while (search_level >= 0) {\n         // TODO: Rename to search_level?\n         search_layer(input, _cfg.neighbors_to_explore_at_construction(), best_neighbors, search_level);\n-        auto neighbors = select_neighbors(best_neighbors.peek(), max_links_for_level(search_level));\n-        connect_new_node(docid, neighbors, search_level);\n+        auto neighbors = select_neighbors(best_neighbors.peek(), _cfg.max_links_at_hierarchic_levels());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b3eff781ae386d2f169dcde363ecf1f94e1397cd"}, "originalPosition": 118}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDU3OTEwNw==", "bodyText": "I guess we can remove the TODO on the next line?", "url": "https://github.com/vespa-engine/vespa/pull/12348#discussion_r384579107", "createdAt": "2020-02-26T15:45:04Z", "author": {"login": "geirst"}, "path": "searchlib/src/vespa/searchlib/tensor/hnsw_index.cpp", "diffHunk": "@@ -287,8 +325,8 @@ HnswIndex::add_document(uint32_t docid)\n     while (search_level >= 0) {\n         // TODO: Rename to search_level?\n         search_layer(input, _cfg.neighbors_to_explore_at_construction(), best_neighbors, search_level);\n-        auto neighbors = select_neighbors(best_neighbors.peek(), max_links_for_level(search_level));\n-        connect_new_node(docid, neighbors, search_level);\n+        auto neighbors = select_neighbors(best_neighbors.peek(), _cfg.max_links_at_hierarchic_levels());\n+        connect_new_node(docid, neighbors.used, search_level);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b3eff781ae386d2f169dcde363ecf1f94e1397cd"}, "originalPosition": 119}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f5743cf8b49901bb5c46216044110b20f2f82469", "author": {"user": {"login": "arnej27959", "name": "Arne H Juul"}}, "url": "https://github.com/vespa-engine/vespa/commit/f5743cf8b49901bb5c46216044110b20f2f82469", "committedDate": "2020-02-27T09:31:14Z", "message": "remove outdated TODO"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2823, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}