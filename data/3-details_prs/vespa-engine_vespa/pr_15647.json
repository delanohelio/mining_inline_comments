{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMxOTgwNTQ5", "number": 15647, "title": "Don't increment or decrement volatile variables. It is deprecated when using C++20.", "bodyText": "@baldersheim : please review", "createdAt": "2020-12-03T18:13:22Z", "url": "https://github.com/vespa-engine/vespa/pull/15647", "merged": true, "mergeCommit": {"oid": "7d79f28b0c89ecc4f314423a9d49ff54b52b8f9e"}, "closed": true, "closedAt": "2020-12-03T19:02:48Z", "author": {"login": "toregge"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdinDwwAH2gAyNTMxOTgwNTQ5OjU0ZTJmMGQ0MGNhZDllZTFkNDQyOTYzZTRkYzc2NTc5NmZiYWM5NmI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdin8MFAFqTU0NDI4NTAzNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "54e2f0d40cad9ee1d442963e4dc765796fbac96b", "author": {"user": null}, "url": "https://github.com/vespa-engine/vespa/commit/54e2f0d40cad9ee1d442963e4dc765796fbac96b", "committedDate": "2020-12-03T18:01:04Z", "message": "Don't increment or decrement volatile variables. It is deprecated\nwhen using C++20."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0MjUwOTYw", "url": "https://github.com/vespa-engine/vespa/pull/15647#pullrequestreview-544250960", "createdAt": "2020-12-03T18:21:21Z", "commit": {"oid": "54e2f0d40cad9ee1d442963e4dc765796fbac96b"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxODoyMToyMVrOH-qy1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxODoyMjozMVrOH-q2oA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTQ3NDkwMA==", "bodyText": "I think that it is better to remove volatile instead. It seems all use is while holding a lock.", "url": "https://github.com/vespa-engine/vespa/pull/15647#discussion_r535474900", "createdAt": "2020-12-03T18:21:21Z", "author": {"login": "baldersheim"}, "path": "searchcore/src/vespa/searchcore/proton/matching/querylimiter.cpp", "diffHunk": "@@ -25,14 +25,14 @@ QueryLimiter::grabToken(const Doom & doom)\n             _cond.wait_for(guard, left);\n         }\n     }\n-    _activeThreads++;\n+    _activeThreads = _activeThreads + 1;\n }\n \n void\n QueryLimiter::releaseToken()\n {\n     std::lock_guard<std::mutex> guard(_lock);\n-    _activeThreads--;\n+    _activeThreads = _activeThreads - 1;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "54e2f0d40cad9ee1d442963e4dc765796fbac96b"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTQ3NTc2MQ==", "bodyText": "I think it is better to replace with an atomic instead.", "url": "https://github.com/vespa-engine/vespa/pull/15647#discussion_r535475761", "createdAt": "2020-12-03T18:22:22Z", "author": {"login": "baldersheim"}, "path": "vespalib/src/tests/array/array_test.cpp", "diffHunk": "@@ -27,16 +27,16 @@ std::ostream & operator << (std::ostream & os, const Array<T> & a)\n \n class Clever {\n public:\n-    Clever() : _counter(&_global) { (*_counter)++; }\n+    Clever() : _counter(&_global) { *_counter = *_counter + 1; }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "54e2f0d40cad9ee1d442963e4dc765796fbac96b"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTQ3NTg3Mg==", "bodyText": "I think it is better to replace with an atomic instead.", "url": "https://github.com/vespa-engine/vespa/pull/15647#discussion_r535475872", "createdAt": "2020-12-03T18:22:31Z", "author": {"login": "baldersheim"}, "path": "vespalib/src/tests/stllike/hash_test.cpp", "diffHunk": "@@ -171,16 +171,16 @@ TEST(\"test hash map iterator stability\")\n \n class Clever {\n public:\n-    Clever() : _counter(&_global) { (*_counter)++; }\n+    Clever() : _counter(&_global) { *_counter = *_counter + 1; }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "54e2f0d40cad9ee1d442963e4dc765796fbac96b"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "13148035ce5843881e89f14ad2d644ac58a1b7ef", "author": {"user": null}, "url": "https://github.com/vespa-engine/vespa/commit/13148035ce5843881e89f14ad2d644ac58a1b7ef", "committedDate": "2020-12-03T18:46:35Z", "message": "Use std::atomic."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0Mjg1MDM1", "url": "https://github.com/vespa-engine/vespa/pull/15647#pullrequestreview-544285035", "createdAt": "2020-12-03T19:02:42Z", "commit": {"oid": "13148035ce5843881e89f14ad2d644ac58a1b7ef"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3847, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}