{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk3NzM5NTI3", "number": 12813, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxMToxNzoyMFrODuVa7Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxMjoxNzoyM1rODuWiQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5OTEyMDQ1OnYy", "diffSide": "RIGHT", "path": "storage/src/vespa/storage/common/storagelink.cpp", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxMToxNzoyMFrOGARMxQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxMjo0ODo1OFrOGAT_4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjkzNDk4MQ==", "bodyText": "Were these assertions removed because they were triggering or because it was desired to observe explicit log errors during testing?", "url": "https://github.com/vespa-engine/vespa/pull/12813#discussion_r402934981", "createdAt": "2020-04-03T11:17:20Z", "author": {"login": "vekterli"}, "path": "storage/src/vespa/storage/common/storagelink.cpp", "diffHunk": "@@ -165,9 +165,9 @@ void StorageLink::sendUp(const shared_ptr<StorageMessage> & msg)\n         default:\n             LOG(error, \"Link %s trying to send %s up while in state %s\",\n                 toString().c_str(), msg->toString(true).c_str(), stateToString(getState()));\n-            assert(false);\n+            return;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a2c8ad475de58e6686e484610488bc4adae30273"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjk4MDgzMw==", "bodyText": "There was one test that tested enque/deque ordering that triggered this. It posted N tasks BEFORE doing open(), and then checking that they were received in same order as posted.\nWith a queue it would wait in the queue until open was called. That would now trigger the assert as it is open once constructed. So I concluded the assert could just be removed.", "url": "https://github.com/vespa-engine/vespa/pull/12813#discussion_r402980833", "createdAt": "2020-04-03T12:48:58Z", "author": {"login": "baldersheim"}, "path": "storage/src/vespa/storage/common/storagelink.cpp", "diffHunk": "@@ -165,9 +165,9 @@ void StorageLink::sendUp(const shared_ptr<StorageMessage> & msg)\n         default:\n             LOG(error, \"Link %s trying to send %s up while in state %s\",\n                 toString().c_str(), msg->toString(true).c_str(), stateToString(getState()));\n-            assert(false);\n+            return;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjkzNDk4MQ=="}, "originalCommit": {"oid": "a2c8ad475de58e6686e484610488bc4adae30273"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5OTMwMzA1OnYy", "diffSide": "RIGHT", "path": "storage/src/vespa/storage/storageserver/communicationmanager.cpp", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxMjoxNzoyM1rOGAS7qw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QxMjo0OToyMFrOGAUAyQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjk2MzM3MQ==", "bodyText": "We should probably rename CommunicationManager::enqueue in due time as well \ud83d\ude42", "url": "https://github.com/vespa-engine/vespa/pull/12813#discussion_r402963371", "createdAt": "2020-04-03T12:17:23Z", "author": {"login": "vekterli"}, "path": "storage/src/vespa/storage/storageserver/communicationmanager.cpp", "diffHunk": "@@ -492,8 +489,8 @@ void\n CommunicationManager::enqueue(std::shared_ptr<api::StorageMessage> msg)\n {\n     assert(msg);\n-    LOG(spam, \"Enq storage message %s, priority %d\", msg->toString().c_str(), msg->getPriority());\n-    _eventQueue.enqueue(std::move(msg));\n+    LOG(spam, \"Process storage message %s, priority %d\", msg->toString().c_str(), msg->getPriority());\n+    process(msg);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a2c8ad475de58e6686e484610488bc4adae30273"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjk4MTA2NQ==", "bodyText": "Yes and some other  stuff could go away too.", "url": "https://github.com/vespa-engine/vespa/pull/12813#discussion_r402981065", "createdAt": "2020-04-03T12:49:20Z", "author": {"login": "baldersheim"}, "path": "storage/src/vespa/storage/storageserver/communicationmanager.cpp", "diffHunk": "@@ -492,8 +489,8 @@ void\n CommunicationManager::enqueue(std::shared_ptr<api::StorageMessage> msg)\n {\n     assert(msg);\n-    LOG(spam, \"Enq storage message %s, priority %d\", msg->toString().c_str(), msg->getPriority());\n-    _eventQueue.enqueue(std::move(msg));\n+    LOG(spam, \"Process storage message %s, priority %d\", msg->toString().c_str(), msg->getPriority());\n+    process(msg);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjk2MzM3MQ=="}, "originalCommit": {"oid": "a2c8ad475de58e6686e484610488bc4adae30273"}, "originalPosition": 31}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2184, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}