{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAwNTYzODk0", "number": 14801, "title": "Signal deference of config change application until restart", "bodyText": "When a restart needs to be done, processes should not apply\nnew config until restarted. This signals to clusters in the config model\nwhen this obtains, but this is a no-op for now.", "createdAt": "2020-10-09T12:42:11Z", "url": "https://github.com/vespa-engine/vespa/pull/14801", "merged": true, "mergeCommit": {"oid": "2725323b44ad9f88a16be4f0b73e7f1486ad4b38"}, "closed": true, "closedAt": "2020-10-09T15:12:09Z", "author": {"login": "bratseth"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdQ1eMHAH2gAyNTAwNTYzODk0OjRlNmY3Nzc2ZmVlOTQ2MWRjOGM3ZTQzNjRiNzc0YzA0OTE2Zjk5ZDQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdQ3rNgAFqTUwNTc2NTMxMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4e6f7776fee9461dc8c7e4364b774c04916f99d4", "author": {"user": {"login": "bratseth", "name": "Jon Bratseth"}}, "url": "https://github.com/vespa-engine/vespa/commit/4e6f7776fee9461dc8c7e4364b774c04916f99d4", "committedDate": "2020-10-09T12:37:58Z", "message": "Signal deference of config change application until restart\n\nWhen a restart needs to be done, processes should not apply\nnew config until restarted. This signals to clusters in the config model\nwhen this obtains, but this is a no-op for now."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1NjYxNTM5", "url": "https://github.com/vespa-engine/vespa/pull/14801#pullrequestreview-505661539", "createdAt": "2020-10-09T13:15:33Z", "commit": {"oid": "4e6f7776fee9461dc8c7e4364b774c04916f99d4"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQxMzoxNTozM1rOHfJOSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQxMzoxNTozM1rOHfJOSw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjQxOTAxOQ==", "bodyText": "Wont this throw NPE?", "url": "https://github.com/vespa-engine/vespa/pull/14801#discussion_r502419019", "createdAt": "2020-10-09T13:15:33Z", "author": {"login": "freva"}, "path": "config-model/src/main/java/com/yahoo/vespa/model/application/validation/Validation.java", "diffHunk": "@@ -103,4 +108,20 @@ private static void validateFirstTimeDeployment(VespaModel model, DeployState de\n         new AccessControlOnFirstDeploymentValidator().validate(model, deployState);\n     }\n \n+    private static void deferConfigChangesForClustersToBeRestarted(List<ConfigChangeAction> actions, VespaModel model) {\n+        Set<ClusterSpec.Id> clustersToBeRestarted = actions.stream()\n+                                                           .filter(action -> action.getType() == ConfigChangeAction.Type.RESTART)\n+                                                           .map(action -> action.clusterId())\n+                                                           .collect(Collectors.toSet());\n+        for (var clusterToRestart : clustersToBeRestarted) {\n+            var containerCluster = model.getContainerClusters().get(clusterToRestart.value());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4e6f7776fee9461dc8c7e4364b774c04916f99d4"}, "originalPosition": 40}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "48f21dccc0b133128df6765512013e7bef07fc6f", "author": {"user": {"login": "bratseth", "name": "Jon Bratseth"}}, "url": "https://github.com/vespa-engine/vespa/commit/48f21dccc0b133128df6765512013e7bef07fc6f", "committedDate": "2020-10-09T14:25:48Z", "message": "Filter out actions without cluster"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1NzY1MzEx", "url": "https://github.com/vespa-engine/vespa/pull/14801#pullrequestreview-505765311", "createdAt": "2020-10-09T15:12:00Z", "commit": {"oid": "48f21dccc0b133128df6765512013e7bef07fc6f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2500, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}