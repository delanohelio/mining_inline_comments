{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgyNzkxNjkw", "number": 14337, "title": "Arnej/more time for prepare for restart ", "bodyText": "I confirm that this contribution is made under the terms of the license found in the root directory of this repository's source tree and that I have the authority necessary to make this contribution on behalf of its copyright owner.\nNOTE: this changes (indirectly) the waiting time for vespa-stop-services, which means that restarting vespa on a node may take 10-15 minutes instead of 1-1.5 minutes.\nHowever, in those cases it will also be much more likely that proton will manage to actually flush all the data it needs to flush in order to restart quickly afterwards, so the total restart time should not become any worse.\n@baldersheim please review", "createdAt": "2020-09-09T11:58:18Z", "url": "https://github.com/vespa-engine/vespa/pull/14337", "merged": true, "mergeCommit": {"oid": "d481454782579688bb4db794f09c29124a35d51e"}, "closed": true, "closedAt": "2020-09-11T06:40:10Z", "author": {"login": "arnej27959"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdHKq4yAH2gAyNDgyNzkxNjkwOmVhMzNiOTliYzczYTUwYWFiYmQ0MmE3OWNjODMxNTliZjYxYTRlNzk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdHemHCgFqTQ4NTgxMjA2OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ea33b99bc73a50aabbd42a79cc83159bf61a4e79", "author": {"user": {"login": "arnej27959", "name": "Arne H Juul"}}, "url": "https://github.com/vespa-engine/vespa/commit/ea33b99bc73a50aabbd42a79cc83159bf61a4e79", "committedDate": "2020-09-09T11:40:36Z", "message": "allocate 10 minutes for proton.prepareRestart"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "813c6084ebb71613310c1f015501e78144254c1c", "author": {"user": {"login": "arnej27959", "name": "Arne H Juul"}}, "url": "https://github.com/vespa-engine/vespa/commit/813c6084ebb71613310c1f015501e78144254c1c", "committedDate": "2020-09-09T11:46:23Z", "message": "more time for clean shutdown\n\n* wait 12 minutes before sending SIGTERM to entire process group\n* wait 15 minutes before sending SIGKILL to entire process group"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d0ac0e8561c4bc49b07c1903278430e9a723054f", "author": {"user": {"login": "arnej27959", "name": "Arne H Juul"}}, "url": "https://github.com/vespa-engine/vespa/commit/d0ac0e8561c4bc49b07c1903278430e9a723054f", "committedDate": "2020-09-09T11:50:28Z", "message": "avoid confusing \"showdown\" messages"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg0OTM4MDUz", "url": "https://github.com/vespa-engine/vespa/pull/14337#pullrequestreview-484938053", "createdAt": "2020-09-09T12:04:46Z", "commit": {"oid": "d0ac0e8561c4bc49b07c1903278430e9a723054f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg0OTQ4ODM0", "url": "https://github.com/vespa-engine/vespa/pull/14337#pullrequestreview-484948834", "createdAt": "2020-09-09T12:19:34Z", "commit": {"oid": "d0ac0e8561c4bc49b07c1903278430e9a723054f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxMjoxOTozNVrOHPEmsA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQxMjoxOTozNVrOHPEmsA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTU2NjEyOA==", "bodyText": "@arnej27959 and @baldersheim: If we are not able to differentiate between processes, perhaps we should be conservative at first and increase this to only 120 seconds?", "url": "https://github.com/vespa-engine/vespa/pull/14337#discussion_r485566128", "createdAt": "2020-09-09T12:19:35Z", "author": {"login": "geirst"}, "path": "vespalog/src/logger/runserver.cpp", "diffHunk": "@@ -390,16 +390,16 @@ int main(int argc, char *argv[])\n             } else {\n                 fprintf(stdout, \"%s was running with pid %d, sending SIGTERM\\n\",\n                     service, pid);\n-                if (killpg(pid, SIGTERM) != 0) {\n+                if (kill(pid, SIGTERM) != 0) {\n                     fprintf(stderr, \"could not signal %d: %s\\n\", pid,\n                             strerror(errno));\n                     return 1;\n                 }\n             }\n-            fprintf(stdout, \"Waiting for exit (up to 60 seconds)\\n\");\n-            for (int cnt(0); cnt < 1800; cnt++) {\n+            fprintf(stdout, \"Waiting for exit (up to 15 minutes)\\n\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d0ac0e8561c4bc49b07c1903278430e9a723054f"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7e3bfe3b4f81f06da7a623bc9a7643efff6ebab6", "author": {"user": {"login": "arnej27959", "name": "Arne H Juul"}}, "url": "https://github.com/vespa-engine/vespa/commit/7e3bfe3b4f81f06da7a623bc9a7643efff6ebab6", "committedDate": "2020-09-10T09:45:44Z", "message": "run prepare_for_shutdown before sending any signals"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1ODExNTc4", "url": "https://github.com/vespa-engine/vespa/pull/14337#pullrequestreview-485811578", "createdAt": "2020-09-10T10:52:46Z", "commit": {"oid": "7e3bfe3b4f81f06da7a623bc9a7643efff6ebab6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1ODEyMDY5", "url": "https://github.com/vespa-engine/vespa/pull/14337#pullrequestreview-485812069", "createdAt": "2020-09-10T10:53:29Z", "commit": {"oid": "7e3bfe3b4f81f06da7a623bc9a7643efff6ebab6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4323, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}