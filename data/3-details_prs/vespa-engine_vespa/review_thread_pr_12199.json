{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc1NDIwNzU3", "number": 12199, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQxNjo0MDo1MVrODf81Vg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQxNzozMjoxNVrODf9uUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM0ODI5MTQyOnYy", "diffSide": "RIGHT", "path": "metrics-proxy/pom.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQxNjo0MDo1MVrOFp8xpg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQxNjo0MDo1MVrOFp8xpg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTUzMTY4Ng==", "bodyText": "Please skip explicit compile scope, it is the default.", "url": "https://github.com/vespa-engine/vespa/pull/12199#discussion_r379531686", "createdAt": "2020-02-14T16:40:51Z", "author": {"login": "gjoranv"}, "path": "metrics-proxy/pom.xml", "diffHunk": "@@ -132,6 +132,11 @@\n       <groupId>org.apache.httpcomponents</groupId>\n       <artifactId>httpclient</artifactId>\n     </dependency>\n+    <dependency>\n+      <groupId>org.apache.velocity</groupId>\n+      <artifactId>velocity</artifactId>\n+      <scope>compile</scope>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01f6bc47ffa13fff4b4255a7ab9d3e3c12c794c7"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM0ODMyNzgwOnYy", "diffSide": "RIGHT", "path": "metrics-proxy/src/main/resources/templates/cloudwatch_plugin.vm", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQxNjo1MjoxOFrOFp9JAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQxNjo1MjoxOFrOFp9JAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTUzNzY2Nw==", "bodyText": "This should only be output if the profile is non-empty in the config. Is that implicitly being taken care of?", "url": "https://github.com/vespa-engine/vespa/pull/12199#discussion_r379537667", "createdAt": "2020-02-14T16:52:18Z", "author": {"login": "gjoranv"}, "path": "metrics-proxy/src/main/resources/templates/cloudwatch_plugin.vm", "diffHunk": "@@ -0,0 +1,30 @@\n+# Configuration for telegraf agent\n+[agent]\n+  interval = \"${intervalSeconds}s\"\n+  round_interval = true\n+  metric_batch_size = 1000\n+  metric_buffer_limit = 10000\n+  collection_jitter = \"0s\"\n+  flush_interval = \"${intervalSeconds}s\"\n+  flush_jitter = \"0s\"\n+  precision = \"\"\n+\n+# Configuration for AWS CloudWatch output.\n+[[outputs.cloudwatch]]\n+  region = \"$cloudwatchRegion\"\n+  namespace = \"$cloudwatchNamespace\"\n+#if( $isHosted )\n+  access_key = \"$cloudwatchSecretKey\"\n+  secret_key = \"$cloudwatchAccessKey\"\n+#else\n+  profile = \"$cloudwatchProfile\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01f6bc47ffa13fff4b4255a7ab9d3e3c12c794c7"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM0ODMyODQ5OnYy", "diffSide": "RIGHT", "path": "metrics-proxy/src/main/resources/templates/cloudwatch_plugin.vm", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQxNjo1MjozMlrOFp9Jdw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQxNjo1MjozMlrOFp9Jdw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTUzNzc4Mw==", "bodyText": "Please add trailing newline.", "url": "https://github.com/vespa-engine/vespa/pull/12199#discussion_r379537783", "createdAt": "2020-02-14T16:52:32Z", "author": {"login": "gjoranv"}, "path": "metrics-proxy/src/main/resources/templates/cloudwatch_plugin.vm", "diffHunk": "@@ -0,0 +1,30 @@\n+# Configuration for telegraf agent\n+[agent]\n+  interval = \"${intervalSeconds}s\"\n+  round_interval = true\n+  metric_batch_size = 1000\n+  metric_buffer_limit = 10000\n+  collection_jitter = \"0s\"\n+  flush_interval = \"${intervalSeconds}s\"\n+  flush_jitter = \"0s\"\n+  precision = \"\"\n+\n+# Configuration for AWS CloudWatch output.\n+[[outputs.cloudwatch]]\n+  region = \"$cloudwatchRegion\"\n+  namespace = \"$cloudwatchNamespace\"\n+#if( $isHosted )\n+  access_key = \"$cloudwatchSecretKey\"\n+  secret_key = \"$cloudwatchAccessKey\"\n+#else\n+  profile = \"$cloudwatchProfile\"\n+#end\n+\n+# Configuration for Vespa input plugin\n+[[inputs.vespa]]\n+  url = \"http://localhost:19092/metrics/v2/values?consumer=$vespaConsumer\"\n+#if( $isHosted )\n+  tls_cert = \"${VESPA_CERTIFICATE_PATH}\"\n+  tls_key = \"${VESPA_KEY_PATH}\"\n+  insecure_skip_verify = true\n+#end", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01f6bc47ffa13fff4b4255a7ab9d3e3c12c794c7"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM0ODMzMjk1OnYy", "diffSide": "RIGHT", "path": "metrics-proxy/src/main/java/ai/vespa/metricsproxy/telegraf/Telegraf.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQxNjo1NDowNlrOFp9MeQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQxNjo1NDowNlrOFp9MeQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTUzODU1Mw==", "bodyText": "We probably need to consider these file paths, especially where to read the template path from.", "url": "https://github.com/vespa-engine/vespa/pull/12199#discussion_r379538553", "createdAt": "2020-02-14T16:54:06Z", "author": {"login": "gjoranv"}, "path": "metrics-proxy/src/main/java/ai/vespa/metricsproxy/telegraf/Telegraf.java", "diffHunk": "@@ -0,0 +1,77 @@\n+// Copyright 2020 Oath Inc. Licensed under the terms of the Apache 2.0 license. See LICENSE in the project root.\n+package ai.vespa.metricsproxy.telegraf;\n+\n+import com.google.inject.Inject;\n+import com.yahoo.component.AbstractComponent;\n+import com.yahoo.system.execution.ProcessExecutor;\n+import org.apache.velocity.Template;\n+import org.apache.velocity.VelocityContext;\n+import org.apache.velocity.app.VelocityEngine;\n+\n+import java.io.FileWriter;\n+\n+import static com.yahoo.yolean.Exceptions.uncheck;\n+\n+/**\n+ * @author olaa\n+ */\n+public class Telegraf extends AbstractComponent {\n+\n+    private static final String TELEGRAF_CONFIG_PATH = \"/etc/telegraf/telegraf.conf\";\n+    private static final String TELEGRAF_CONFIG_TEMPLATE_PATH = \"src/main/resources/templates/cloudwatch_plugin.vm\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01f6bc47ffa13fff4b4255a7ab9d3e3c12c794c7"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM0ODQzNzMwOnYy", "diffSide": "RIGHT", "path": "metrics-proxy/pom.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQxNzozMjoxNVrOFp-PFw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQxNzozMjoxNVrOFp-PFw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTU1NTYwNw==", "bodyText": "Please add an exclude for this artifact in config-model/pom.xml's dependency on metrics-proxy. It adds an extra 0.5 MB.", "url": "https://github.com/vespa-engine/vespa/pull/12199#discussion_r379555607", "createdAt": "2020-02-14T17:32:15Z", "author": {"login": "gjoranv"}, "path": "metrics-proxy/pom.xml", "diffHunk": "@@ -132,6 +132,11 @@\n       <groupId>org.apache.httpcomponents</groupId>\n       <artifactId>httpclient</artifactId>\n     </dependency>\n+    <dependency>\n+      <groupId>org.apache.velocity</groupId>\n+      <artifactId>velocity</artifactId>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "01f6bc47ffa13fff4b4255a7ab9d3e3c12c794c7"}, "originalPosition": 6}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2491, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}