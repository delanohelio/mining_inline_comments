{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDUwMjA3MDEy", "number": 13907, "title": "Detect changed bucket space for document type.", "bodyText": "@geirst : please review", "createdAt": "2020-07-16T13:42:24Z", "url": "https://github.com/vespa-engine/vespa/pull/13907", "merged": true, "mergeCommit": {"oid": "f26c185567882621485b0aac7ef311fff8d52be9"}, "closed": true, "closedAt": "2020-07-17T10:41:36Z", "author": {"login": "toregge"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc1fLnogH2gAyNDUwMjA3MDEyOjRiNjU2ZmQ0MzJkZDVkZWM5MWQxMGQ1YmEzOTU3ZWFkNmY0MTEwZjM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc1xdU9gFqTQ1MDU1NjE0Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4b656fd432dd5dec91d10d5ba3957ead6f4110f3", "author": {"user": null}, "url": "https://github.com/vespa-engine/vespa/commit/4b656fd432dd5dec91d10d5ba3957ead6f4110f3", "committedDate": "2020-07-16T13:23:49Z", "message": "Detect changed bucket space for document type."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwNDk3NzU3", "url": "https://github.com/vespa-engine/vespa/pull/13907#pullrequestreview-450497757", "createdAt": "2020-07-17T09:09:08Z", "commit": {"oid": "4b656fd432dd5dec91d10d5ba3957ead6f4110f3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwNDk5NzAz", "url": "https://github.com/vespa-engine/vespa/pull/13907#pullrequestreview-450499703", "createdAt": "2020-07-17T09:12:11Z", "commit": {"oid": "4b656fd432dd5dec91d10d5ba3957ead6f4110f3"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QwOToxMjoxMVrOGzLoNg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QwOToxMjoxMVrOGzLoNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjMyMTA3OA==", "bodyText": "It could be helpful to mention in the log message that doing this in a running system has undefined behavior and that the process must therefore immediately restart.", "url": "https://github.com/vespa-engine/vespa/pull/13907#discussion_r456321078", "createdAt": "2020-07-17T09:12:11Z", "author": {"login": "vekterli"}, "path": "searchcore/src/vespa/searchcore/proton/server/proton_configurer.cpp", "diffHunk": "@@ -177,6 +180,13 @@ ProtonConfigurer::configureDocumentDB(const ProtonConfigSnapshot &configSnapshot\n     } else {\n         auto documentDB = dbitr->second.first.lock();\n         assert(documentDB);\n+        auto old_bucket_space = documentDB->getBucketSpace();\n+        if (bucketSpace != old_bucket_space) {\n+            vespalib::string old_bucket_space_name = document::FixedBucketSpaces::to_string(old_bucket_space);\n+            vespalib::string bucket_space_name = document::FixedBucketSpaces::to_string(bucketSpace);\n+            LOG(fatal, \"Bucket space for document type %s changed from %s to %s\", docTypeName.getName().c_str(), old_bucket_space_name.c_str(), bucket_space_name.c_str());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b656fd432dd5dec91d10d5ba3957ead6f4110f3"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f5116ccd4b414ff03f51697992f6a3bbfb0b2262", "author": {"user": null}, "url": "https://github.com/vespa-engine/vespa/commit/f5116ccd4b414ff03f51697992f6a3bbfb0b2262", "committedDate": "2020-07-17T09:49:12Z", "message": "Extend log message when bucket space for document type has changed."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwNTU2MTQ3", "url": "https://github.com/vespa-engine/vespa/pull/13907#pullrequestreview-450556147", "createdAt": "2020-07-17T10:41:27Z", "commit": {"oid": "f5116ccd4b414ff03f51697992f6a3bbfb0b2262"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3464, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}