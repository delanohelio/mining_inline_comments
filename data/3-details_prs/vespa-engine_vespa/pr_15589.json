{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMwOTM0NDcx", "number": 15589, "title": "Subclass QuorumPeerMain to be able to use initializeAndRun()", "bodyText": "Cannot use QuoeumPeerMain.main(), since it calls System.exit() and will not work\nwhen running unit tests, so subclass and use initializeAndRun()", "createdAt": "2020-12-02T11:01:33Z", "url": "https://github.com/vespa-engine/vespa/pull/15589", "merged": true, "mergeCommit": {"oid": "f1d18d3b3e41eb36c0a610d167dac6ee75f246ce"}, "closed": true, "closedAt": "2020-12-02T12:01:58Z", "author": {"login": "hmusum"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdiMb1-AH2gAyNTMwOTM0NDcxOmYwZjQ5ZTZmZDA3NmE4MjA1MGE5YjM5MzdkNTQyYTg1MThlODkzMDY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdiNTP3gFqTU0Mjc2NTgwNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f0f49e6fd076a82050a9b3937d542a8518e89306", "author": {"user": {"login": "hmusum", "name": "Harald Musum"}}, "url": "https://github.com/vespa-engine/vespa/commit/f0f49e6fd076a82050a9b3937d542a8518e89306", "committedDate": "2020-12-02T10:59:56Z", "message": "Subclass QuorumPeerMain to be able to use initializeAndRun()\n\nCannot use main(), since it calls System.exit() and will not work\nwhen running unit tests, so subclass and use initializeAndRun()"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQyNzYwNjQy", "url": "https://github.com/vespa-engine/vespa/pull/15589#pullrequestreview-542760642", "createdAt": "2020-12-02T11:53:28Z", "commit": {"oid": "f0f49e6fd076a82050a9b3937d542a8518e89306"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQxMTo1MzoyOFrOH9Xb9A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQxMTo1MzoyOFrOH9Xb9A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDEwOTE3Mg==", "bodyText": "Wait for shutdown?", "url": "https://github.com/vespa-engine/vespa/pull/15589#discussion_r534109172", "createdAt": "2020-12-02T11:53:28Z", "author": {"login": "mpolden"}, "path": "zookeeper-server/zookeeper-server-3.5.6/src/main/java/com/yahoo/vespa/zookeeper/ZooKeeperRunner.java", "diffHunk": "@@ -18,31 +25,42 @@\n public class ZooKeeperRunner implements Runnable {\n     private static final Logger log = java.util.logging.Logger.getLogger(ZooKeeperRunner.class.getName());\n \n-    private final Thread zkServerThread;\n+    private final ExecutorService executorService;\n     private final ZookeeperServerConfig zookeeperServerConfig;\n \n     public ZooKeeperRunner(ZookeeperServerConfig zookeeperServerConfig) {\n         this.zookeeperServerConfig = zookeeperServerConfig;\n         new Configurator(zookeeperServerConfig).writeConfigToDisk(TransportSecurityUtils.getOptions());\n-        zkServerThread = new Thread(this, \"zookeeper server\");\n-        zkServerThread.start();\n+        executorService = Executors.newSingleThreadExecutor(new DaemonThreadFactory(\"zookeeper server\"));\n+        executorService.submit(this);\n     }\n \n     void shutdown() {\n-        zkServerThread.interrupt();\n-        try {\n-            zkServerThread.join();\n-        } catch (InterruptedException e) {\n-            log.log(Level.WARNING, \"Error joining server thread on shutdown\", e);\n-        }\n+        executorService.shutdownNow();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0f49e6fd076a82050a9b3937d542a8518e89306"}, "originalPosition": 40}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "68af74ad922e3d05d491655942c5d4f624840580", "author": {"user": {"login": "hmusum", "name": "Harald Musum"}}, "url": "https://github.com/vespa-engine/vespa/commit/68af74ad922e3d05d491655942c5d4f624840580", "committedDate": "2020-12-02T11:58:50Z", "message": "Shutdown and wait for termination"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQyNzY1ODA1", "url": "https://github.com/vespa-engine/vespa/pull/15589#pullrequestreview-542765805", "createdAt": "2020-12-02T12:00:27Z", "commit": {"oid": "68af74ad922e3d05d491655942c5d4f624840580"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1835, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}