{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMwODY3MDcz", "number": 15586, "title": "Bjorncs/cluster controller reindexing status", "bodyText": "I confirm that this contribution is made under the terms of the license found in the root directory of this repository's source tree and that I have the authority necessary to make this contribution on behalf of its copyright owner.", "createdAt": "2020-12-02T09:10:57Z", "url": "https://github.com/vespa-engine/vespa/pull/15586", "merged": true, "mergeCommit": {"oid": "512f4e8371f2fbdfba121148e2fe77003cbdf7ed"}, "closed": true, "closedAt": "2020-12-02T12:18:21Z", "author": {"login": "bjorncs"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdiK3l9AH2gAyNTMwODY3MDczOjY1M2E4MzM5OGU1MzZjMDQxM2E0ZjJlZTUwOTgxY2JlM2E2ZjEyZjc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdiNjj0AFqTU0Mjc3ODcwMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "653a83398e536c0413a4f2ee50981cbe3a6f12f7", "author": {"user": {"login": "bjorncs", "name": "Bj\u00f8rn Christian Seime"}}, "url": "https://github.com/vespa-engine/vespa/commit/653a83398e536c0413a4f2ee50981cbe3a6f12f7", "committedDate": "2020-12-02T09:10:26Z", "message": "Add helper for combining multiple completable futures"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c04726727464a042c3ce0c0bad9b8935eb9b5d8f", "author": {"user": {"login": "bjorncs", "name": "Bj\u00f8rn Christian Seime"}}, "url": "https://github.com/vespa-engine/vespa/commit/c04726727464a042c3ce0c0bad9b8935eb9b5d8f", "committedDate": "2020-12-02T09:10:27Z", "message": "Add helper method to rethrow checked as unchecked"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "03c00de5438637108875365dbe949e390f10d4bc", "author": {"user": {"login": "bjorncs", "name": "Bj\u00f8rn Christian Seime"}}, "url": "https://github.com/vespa-engine/vespa/commit/03c00de5438637108875365dbe949e390f10d4bc", "committedDate": "2020-12-02T09:10:27Z", "message": "Move serialized value definition to State enum"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a040d7d09ad97c2b06e47e0c44d47882eee16617", "author": {"user": {"login": "bjorncs", "name": "Bj\u00f8rn Christian Seime"}}, "url": "https://github.com/vespa-engine/vespa/commit/a040d7d09ad97c2b06e47e0c44d47882eee16617", "committedDate": "2020-12-02T09:26:09Z", "message": "Fetch cluster reindexing status from cluster controllers"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "124608092189eba3a27de7463a647191f236a1f6", "author": {"user": {"login": "bjorncs", "name": "Bj\u00f8rn Christian Seime"}}, "url": "https://github.com/vespa-engine/vespa/commit/124608092189eba3a27de7463a647191f236a1f6", "committedDate": "2020-12-02T12:13:23Z", "message": "Correctly handle optional fields in JSON response body"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQyNzc4NTQy", "url": "https://github.com/vespa-engine/vespa/pull/15586#pullrequestreview-542778542", "createdAt": "2020-12-02T12:18:01Z", "commit": {"oid": "124608092189eba3a27de7463a647191f236a1f6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQxMjoxODowMlrOH9YS7Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQxMjoxODowMlrOH9YS7Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDEyMzI0NQ==", "bodyText": "This is always there, but can fix later.", "url": "https://github.com/vespa-engine/vespa/pull/15586#discussion_r534123245", "createdAt": "2020-12-02T12:18:02Z", "author": {"login": "jonmv"}, "path": "configserver/src/main/java/com/yahoo/vespa/config/server/application/DefaultClusterReindexingStatusClient.java", "diffHunk": "@@ -105,10 +106,18 @@ private static ClusterReindexing toClusterReindexing(byte[] requestBody) throws\n         for (JsonNode statusJson : jsonNode.get(\"status\")) {\n             String type = statusJson.get(\"type\").textValue();\n             Instant startedMillis = Instant.ofEpochMilli(statusJson.get(\"startedMillis\").longValue());\n-            Instant endedMillis = Instant.ofEpochMilli(statusJson.get(\"endedMillis\").longValue());\n-            String progressToken = statusJson.get(\"progress\").textValue();\n-            ClusterReindexing.State state = ClusterReindexing.State.fromString(statusJson.get(\"state\").textValue());\n-            String message = statusJson.get(\"message\").textValue();\n+            Instant endedMillis = Optional.ofNullable(statusJson.get(\"endedMillis\"))\n+                    .map(json -> Instant.ofEpochMilli(json.longValue()))\n+                    .orElse(null);\n+            String progressToken = Optional.ofNullable(statusJson.get(\"progress\"))\n+                    .map(JsonNode::textValue)\n+                    .orElse(null);\n+            ClusterReindexing.State state = Optional.ofNullable(statusJson.get(\"state\"))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "124608092189eba3a27de7463a647191f236a1f6"}, "originalPosition": 22}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQyNzc4NzAy", "url": "https://github.com/vespa-engine/vespa/pull/15586#pullrequestreview-542778702", "createdAt": "2020-12-02T12:18:16Z", "commit": {"oid": "124608092189eba3a27de7463a647191f236a1f6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1831, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}