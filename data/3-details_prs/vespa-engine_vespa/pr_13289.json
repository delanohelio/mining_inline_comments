{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE5NTc5NTQ3", "number": 13289, "title": "Handle when an instance has only declared tests", "bodyText": "@mpolden please review.\nAn instance with only declared tests would not qualify as an upgrade target to the Upgrader, making such a pipeline stop. This fixes that by adding declared test jobs also when there aren't (yet, because the next instance with the production job can't upgrade before the current instance, with only the tests) any production jobs waiting tot have their change tested. Not super-pretty, but I couldn't find a better way.", "createdAt": "2020-05-18T15:34:52Z", "url": "https://github.com/vespa-engine/vespa/pull/13289", "merged": true, "mergeCommit": {"oid": "89e26b2fe42a1fd88957ec76c5e1d1532d03b380"}, "closed": true, "closedAt": "2020-05-19T08:14:59Z", "author": {"login": "jonmv"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcihtgogFqTQxMzcxMDYxNw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABciv9yYABqjMzNTA2MzI1NTU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzNzEwNjE3", "url": "https://github.com/vespa-engine/vespa/pull/13289#pullrequestreview-413710617", "createdAt": "2020-05-18T15:35:58Z", "commit": {"oid": "daf2385562c2a7960f93d2d3b0889f4cdfac6e00"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxNTozNTo1OFrOGW8qaw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxNTozNTo1OFrOGW8qaw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjcxNTc1NQ==", "bodyText": "This should be safe ...", "url": "https://github.com/vespa-engine/vespa/pull/13289#discussion_r426715755", "createdAt": "2020-05-18T15:35:58Z", "author": {"login": "jonmv"}, "path": "controller-server/src/main/java/com/yahoo/vespa/hosted/controller/maintenance/Upgrader.java", "diffHunk": "@@ -105,7 +104,7 @@ public void maintain() {\n     /** Returns a list of all production application instances, except those which are pinned, which we should not manipulate here. */\n     private InstanceList instances() {\n         return InstanceList.from(controller().jobController().deploymentStatuses(ApplicationList.from(controller().applications().readable())))\n-                           .withProductionDeployment()\n+                           .withDeclaredJobs()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "daf2385562c2a7960f93d2d3b0889f4cdfac6e00"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d608fd9754dc12b6460ec3a5a2955085b4000b9", "author": {"user": {"login": "jonmv", "name": "Jon Marius Venstad"}}, "url": "https://github.com/vespa-engine/vespa/commit/8d608fd9754dc12b6460ec3a5a2955085b4000b9", "committedDate": "2020-05-19T07:58:05Z", "message": "Handle when an instance has only declared tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4c279a3bc4a2266b87feb338cac3f0e493450ec3", "author": {"user": {"login": "jonmv", "name": "Jon Marius Venstad"}}, "url": "https://github.com/vespa-engine/vespa/commit/4c279a3bc4a2266b87feb338cac3f0e493450ec3", "committedDate": "2020-05-19T08:12:25Z", "message": "Variable was renamed in different PR"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "daf2385562c2a7960f93d2d3b0889f4cdfac6e00", "author": {"user": {"login": "jonmv", "name": "Jon Marius Venstad"}}, "url": "https://github.com/vespa-engine/vespa/commit/daf2385562c2a7960f93d2d3b0889f4cdfac6e00", "committedDate": "2020-05-18T15:32:17Z", "message": "Handle when an instance has only declared tests"}, "afterCommit": {"oid": "4c279a3bc4a2266b87feb338cac3f0e493450ec3", "author": {"user": {"login": "jonmv", "name": "Jon Marius Venstad"}}, "url": "https://github.com/vespa-engine/vespa/commit/4c279a3bc4a2266b87feb338cac3f0e493450ec3", "committedDate": "2020-05-19T08:12:25Z", "message": "Variable was renamed in different PR"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3136, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}