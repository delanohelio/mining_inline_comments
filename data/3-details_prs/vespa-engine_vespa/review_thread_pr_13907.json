{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDUwMjA3MDEy", "number": 13907, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QwOToxMjoxMVrOEPda9w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QwOToxMjoxMVrOEPda9w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0NjQ2MTM1OnYy", "diffSide": "RIGHT", "path": "searchcore/src/vespa/searchcore/proton/server/proton_configurer.cpp", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QwOToxMjoxMVrOGzLoNg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QwOToxOTowNVrOGzL2TA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjMyMTA3OA==", "bodyText": "It could be helpful to mention in the log message that doing this in a running system has undefined behavior and that the process must therefore immediately restart.", "url": "https://github.com/vespa-engine/vespa/pull/13907#discussion_r456321078", "createdAt": "2020-07-17T09:12:11Z", "author": {"login": "vekterli"}, "path": "searchcore/src/vespa/searchcore/proton/server/proton_configurer.cpp", "diffHunk": "@@ -177,6 +180,13 @@ ProtonConfigurer::configureDocumentDB(const ProtonConfigSnapshot &configSnapshot\n     } else {\n         auto documentDB = dbitr->second.first.lock();\n         assert(documentDB);\n+        auto old_bucket_space = documentDB->getBucketSpace();\n+        if (bucketSpace != old_bucket_space) {\n+            vespalib::string old_bucket_space_name = document::FixedBucketSpaces::to_string(old_bucket_space);\n+            vespalib::string bucket_space_name = document::FixedBucketSpaces::to_string(bucketSpace);\n+            LOG(fatal, \"Bucket space for document type %s changed from %s to %s\", docTypeName.getName().c_str(), old_bucket_space_name.c_str(), bucket_space_name.c_str());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b656fd432dd5dec91d10d5ba3957ead6f4110f3"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjMyNDY4NA==", "bodyText": "Yes, and that the restart will fix it.", "url": "https://github.com/vespa-engine/vespa/pull/13907#discussion_r456324684", "createdAt": "2020-07-17T09:19:05Z", "author": {"login": "geirst"}, "path": "searchcore/src/vespa/searchcore/proton/server/proton_configurer.cpp", "diffHunk": "@@ -177,6 +180,13 @@ ProtonConfigurer::configureDocumentDB(const ProtonConfigSnapshot &configSnapshot\n     } else {\n         auto documentDB = dbitr->second.first.lock();\n         assert(documentDB);\n+        auto old_bucket_space = documentDB->getBucketSpace();\n+        if (bucketSpace != old_bucket_space) {\n+            vespalib::string old_bucket_space_name = document::FixedBucketSpaces::to_string(old_bucket_space);\n+            vespalib::string bucket_space_name = document::FixedBucketSpaces::to_string(bucketSpace);\n+            LOG(fatal, \"Bucket space for document type %s changed from %s to %s\", docTypeName.getName().c_str(), old_bucket_space_name.c_str(), bucket_space_name.c_str());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjMyMTA3OA=="}, "originalCommit": {"oid": "4b656fd432dd5dec91d10d5ba3957ead6f4110f3"}, "originalPosition": 18}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1814, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}