{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMxMDUwODYw", "number": 15605, "title": "Limit HostSwitchUpdater to relevant systems", "bodyText": "@freva", "createdAt": "2020-12-02T14:22:28Z", "url": "https://github.com/vespa-engine/vespa/pull/15605", "merged": true, "mergeCommit": {"oid": "c93a7bc06c966b880511073a493a34c7e787f384"}, "closed": true, "closedAt": "2020-12-02T18:59:44Z", "author": {"login": "mpolden"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdiPUAGgH2gAyNTMxMDUwODYwOjk5YmNmZmY1MmJmNDk4MmUyMTRlMzFhNzVjYWIzMTY1MWIwMzQ5MGM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdiTQ1vgFqTU0MzE0NDkxNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "99bcfff52bf4982e214e31a75cab31651b03490c", "author": {"user": {"login": "mpolden", "name": "Martin Polden"}}, "url": "https://github.com/vespa-engine/vespa/commit/99bcfff52bf4982e214e31a75cab31651b03490c", "committedDate": "2020-12-02T14:21:05Z", "message": "Limit HostSwitchUpdater to relevant systems"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQyODg2Nzc5", "url": "https://github.com/vespa-engine/vespa/pull/15605#pullrequestreview-542886779", "createdAt": "2020-12-02T14:26:26Z", "commit": {"oid": "99bcfff52bf4982e214e31a75cab31651b03490c"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQxNDoyNjoyNlrOH9daPA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQxNDoyNjoyNlrOH9daPA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDIwNzAzNg==", "bodyText": "Could also limit this to yahoo cloud zones...", "url": "https://github.com/vespa-engine/vespa/pull/15605#discussion_r534207036", "createdAt": "2020-12-02T14:26:26Z", "author": {"login": "freva"}, "path": "controller-server/src/main/java/com/yahoo/vespa/hosted/controller/maintenance/HostSwitchUpdater.java", "diffHunk": "@@ -31,14 +36,22 @@ protected boolean maintain() {\n         Map<String, NodeEntity> nodeEntities = controller().serviceRegistry().entityService().listNodes().stream()\n                                                            .collect(Collectors.toMap(NodeEntity::hostname,\n                                                                                      Function.identity()));\n-        for (var zone : controller().zoneRegistry().zones().controllerUpgraded().all().ids()) {\n-            for (var node : nodeRepository.list(zone)) {\n-                NodeEntity nodeEntity = nodeEntities.get(node.hostname().value());\n-                if (!shouldUpdate(node, nodeEntity)) continue;\n-\n-                NodeRepositoryNode updatedNode = new NodeRepositoryNode();\n-                updatedNode.setSwitchHostname(nodeEntity.switchHostname().get());\n-                nodeRepository.patchNode(zone, node.hostname().value(), updatedNode);\n+        int nodesUpdated = 0;\n+        try {\n+            for (var zone : controller().zoneRegistry().zones().controllerUpgraded().all().ids()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "99bcfff52bf4982e214e31a75cab31651b03490c"}, "originalPosition": 47}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "079a183dfca7a290cf697e4c7ee2d479e04f4d39", "author": {"user": {"login": "mpolden", "name": "Martin Polden"}}, "url": "https://github.com/vespa-engine/vespa/commit/079a183dfca7a290cf697e4c7ee2d479e04f4d39", "committedDate": "2020-12-02T18:26:17Z", "message": "Handle hosts registered under a different hostname"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQzMTQ0OTE0", "url": "https://github.com/vespa-engine/vespa/pull/15605#pullrequestreview-543144914", "createdAt": "2020-12-02T18:57:15Z", "commit": {"oid": "079a183dfca7a290cf697e4c7ee2d479e04f4d39"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1846, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}