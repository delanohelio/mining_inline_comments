{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQwMDEzMDQ4", "number": 13710, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQwNzoxNjo1M1rOEJB2Cw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQwNzoxNjo1M1rOEJB2Cw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3OTAyODU5OnYy", "diffSide": "RIGHT", "path": "searchlib/src/vespa/searchlib/attribute/document_weight_or_filter_search.cpp", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQwNzoxNjo1NFrOGpWRSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQwOTo0NTozMVrOGpatXw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjAwOTY3NQ==", "bodyText": "Any reason for not using uint32_t (same as docId)? Consider replacing", "url": "https://github.com/vespa-engine/vespa/pull/13710#discussion_r446009675", "createdAt": "2020-06-26T07:16:54Z", "author": {"login": "geirst"}, "path": "searchlib/src/vespa/searchlib/attribute/document_weight_or_filter_search.cpp", "diffHunk": "@@ -0,0 +1,80 @@\n+// Copyright Verizon Media. Licensed under the terms of the Apache 2.0 license. See LICENSE in the project root.\n+\n+#include \"document_weight_or_filter_search.h\"\n+#include \"iterator_pack.h\"\n+#include <vespa/searchlib/common/bitvector.h>\n+#include <vespa/searchlib/queryeval/emptysearch.h>\n+\n+namespace search::attribute {\n+\n+class DocumentWeightOrFilterSearchImpl : public DocumentWeightOrFilterSearch\n+{\n+    AttributeIteratorPack _children;\n+public:\n+    DocumentWeightOrFilterSearchImpl(AttributeIteratorPack&& children);\n+    ~DocumentWeightOrFilterSearchImpl();\n+\n+    void doSeek(uint32_t docId) override;\n+    \n+    void doUnpack(uint32_t) override;\n+\n+    void initRange(uint32_t begin, uint32_t end) override {\n+        SearchIterator::initRange(begin, end);\n+        _children.initRange(begin, end);\n+    }\n+\n+    void or_hits_into(BitVector &result, uint32_t begin_id) override {\n+        return _children.or_hits_into(result, begin_id);\n+    }\n+\n+    void and_hits_into(BitVector &result, uint32_t begin_id) override {\n+        return result.andWith(*get_hits(begin_id));\n+    }\n+\n+    std::unique_ptr<BitVector> get_hits(uint32_t begin_id) override {\n+        return _children.get_hits(begin_id, getEndId());\n+    }\n+\n+    Trinary is_strict() const override { return Trinary::True; }\n+};\n+\n+DocumentWeightOrFilterSearchImpl::DocumentWeightOrFilterSearchImpl(AttributeIteratorPack&& children)\n+    : DocumentWeightOrFilterSearch(),\n+      _children(std::move(children))\n+{\n+}\n+\n+DocumentWeightOrFilterSearchImpl::~DocumentWeightOrFilterSearchImpl() = default;\n+\n+void\n+DocumentWeightOrFilterSearchImpl::doSeek(uint32_t docId)\n+{\n+    if (_children.get_docid(0) < docId) {\n+        _children.seek(0, docId);\n+    }\n+    uint32_t min_doc_id = _children.get_docid(0);\n+    for (unsigned int i = 1; min_doc_id > docId && i < _children.size(); ++i) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "07344e04b5628b52da54aaeaed6a28fe979e83f1"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjA1NTE3Nw==", "bodyText": "_children.size() returns a value of type size_t, while _children.get_docid() and _children.seek() expects argument of type uint16_t. Perhaps it's better to use uint16_t ?", "url": "https://github.com/vespa-engine/vespa/pull/13710#discussion_r446055177", "createdAt": "2020-06-26T08:51:43Z", "author": {"login": "toregge"}, "path": "searchlib/src/vespa/searchlib/attribute/document_weight_or_filter_search.cpp", "diffHunk": "@@ -0,0 +1,80 @@\n+// Copyright Verizon Media. Licensed under the terms of the Apache 2.0 license. See LICENSE in the project root.\n+\n+#include \"document_weight_or_filter_search.h\"\n+#include \"iterator_pack.h\"\n+#include <vespa/searchlib/common/bitvector.h>\n+#include <vespa/searchlib/queryeval/emptysearch.h>\n+\n+namespace search::attribute {\n+\n+class DocumentWeightOrFilterSearchImpl : public DocumentWeightOrFilterSearch\n+{\n+    AttributeIteratorPack _children;\n+public:\n+    DocumentWeightOrFilterSearchImpl(AttributeIteratorPack&& children);\n+    ~DocumentWeightOrFilterSearchImpl();\n+\n+    void doSeek(uint32_t docId) override;\n+    \n+    void doUnpack(uint32_t) override;\n+\n+    void initRange(uint32_t begin, uint32_t end) override {\n+        SearchIterator::initRange(begin, end);\n+        _children.initRange(begin, end);\n+    }\n+\n+    void or_hits_into(BitVector &result, uint32_t begin_id) override {\n+        return _children.or_hits_into(result, begin_id);\n+    }\n+\n+    void and_hits_into(BitVector &result, uint32_t begin_id) override {\n+        return result.andWith(*get_hits(begin_id));\n+    }\n+\n+    std::unique_ptr<BitVector> get_hits(uint32_t begin_id) override {\n+        return _children.get_hits(begin_id, getEndId());\n+    }\n+\n+    Trinary is_strict() const override { return Trinary::True; }\n+};\n+\n+DocumentWeightOrFilterSearchImpl::DocumentWeightOrFilterSearchImpl(AttributeIteratorPack&& children)\n+    : DocumentWeightOrFilterSearch(),\n+      _children(std::move(children))\n+{\n+}\n+\n+DocumentWeightOrFilterSearchImpl::~DocumentWeightOrFilterSearchImpl() = default;\n+\n+void\n+DocumentWeightOrFilterSearchImpl::doSeek(uint32_t docId)\n+{\n+    if (_children.get_docid(0) < docId) {\n+        _children.seek(0, docId);\n+    }\n+    uint32_t min_doc_id = _children.get_docid(0);\n+    for (unsigned int i = 1; min_doc_id > docId && i < _children.size(); ++i) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjAwOTY3NQ=="}, "originalCommit": {"oid": "07344e04b5628b52da54aaeaed6a28fe979e83f1"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjA1Nzc1NQ==", "bodyText": "Yes, I agree", "url": "https://github.com/vespa-engine/vespa/pull/13710#discussion_r446057755", "createdAt": "2020-06-26T08:56:42Z", "author": {"login": "geirst"}, "path": "searchlib/src/vespa/searchlib/attribute/document_weight_or_filter_search.cpp", "diffHunk": "@@ -0,0 +1,80 @@\n+// Copyright Verizon Media. Licensed under the terms of the Apache 2.0 license. See LICENSE in the project root.\n+\n+#include \"document_weight_or_filter_search.h\"\n+#include \"iterator_pack.h\"\n+#include <vespa/searchlib/common/bitvector.h>\n+#include <vespa/searchlib/queryeval/emptysearch.h>\n+\n+namespace search::attribute {\n+\n+class DocumentWeightOrFilterSearchImpl : public DocumentWeightOrFilterSearch\n+{\n+    AttributeIteratorPack _children;\n+public:\n+    DocumentWeightOrFilterSearchImpl(AttributeIteratorPack&& children);\n+    ~DocumentWeightOrFilterSearchImpl();\n+\n+    void doSeek(uint32_t docId) override;\n+    \n+    void doUnpack(uint32_t) override;\n+\n+    void initRange(uint32_t begin, uint32_t end) override {\n+        SearchIterator::initRange(begin, end);\n+        _children.initRange(begin, end);\n+    }\n+\n+    void or_hits_into(BitVector &result, uint32_t begin_id) override {\n+        return _children.or_hits_into(result, begin_id);\n+    }\n+\n+    void and_hits_into(BitVector &result, uint32_t begin_id) override {\n+        return result.andWith(*get_hits(begin_id));\n+    }\n+\n+    std::unique_ptr<BitVector> get_hits(uint32_t begin_id) override {\n+        return _children.get_hits(begin_id, getEndId());\n+    }\n+\n+    Trinary is_strict() const override { return Trinary::True; }\n+};\n+\n+DocumentWeightOrFilterSearchImpl::DocumentWeightOrFilterSearchImpl(AttributeIteratorPack&& children)\n+    : DocumentWeightOrFilterSearch(),\n+      _children(std::move(children))\n+{\n+}\n+\n+DocumentWeightOrFilterSearchImpl::~DocumentWeightOrFilterSearchImpl() = default;\n+\n+void\n+DocumentWeightOrFilterSearchImpl::doSeek(uint32_t docId)\n+{\n+    if (_children.get_docid(0) < docId) {\n+        _children.seek(0, docId);\n+    }\n+    uint32_t min_doc_id = _children.get_docid(0);\n+    for (unsigned int i = 1; min_doc_id > docId && i < _children.size(); ++i) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjAwOTY3NQ=="}, "originalCommit": {"oid": "07344e04b5628b52da54aaeaed6a28fe979e83f1"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjA4MjM5OQ==", "bodyText": "Fixed.", "url": "https://github.com/vespa-engine/vespa/pull/13710#discussion_r446082399", "createdAt": "2020-06-26T09:45:31Z", "author": {"login": "toregge"}, "path": "searchlib/src/vespa/searchlib/attribute/document_weight_or_filter_search.cpp", "diffHunk": "@@ -0,0 +1,80 @@\n+// Copyright Verizon Media. Licensed under the terms of the Apache 2.0 license. See LICENSE in the project root.\n+\n+#include \"document_weight_or_filter_search.h\"\n+#include \"iterator_pack.h\"\n+#include <vespa/searchlib/common/bitvector.h>\n+#include <vespa/searchlib/queryeval/emptysearch.h>\n+\n+namespace search::attribute {\n+\n+class DocumentWeightOrFilterSearchImpl : public DocumentWeightOrFilterSearch\n+{\n+    AttributeIteratorPack _children;\n+public:\n+    DocumentWeightOrFilterSearchImpl(AttributeIteratorPack&& children);\n+    ~DocumentWeightOrFilterSearchImpl();\n+\n+    void doSeek(uint32_t docId) override;\n+    \n+    void doUnpack(uint32_t) override;\n+\n+    void initRange(uint32_t begin, uint32_t end) override {\n+        SearchIterator::initRange(begin, end);\n+        _children.initRange(begin, end);\n+    }\n+\n+    void or_hits_into(BitVector &result, uint32_t begin_id) override {\n+        return _children.or_hits_into(result, begin_id);\n+    }\n+\n+    void and_hits_into(BitVector &result, uint32_t begin_id) override {\n+        return result.andWith(*get_hits(begin_id));\n+    }\n+\n+    std::unique_ptr<BitVector> get_hits(uint32_t begin_id) override {\n+        return _children.get_hits(begin_id, getEndId());\n+    }\n+\n+    Trinary is_strict() const override { return Trinary::True; }\n+};\n+\n+DocumentWeightOrFilterSearchImpl::DocumentWeightOrFilterSearchImpl(AttributeIteratorPack&& children)\n+    : DocumentWeightOrFilterSearch(),\n+      _children(std::move(children))\n+{\n+}\n+\n+DocumentWeightOrFilterSearchImpl::~DocumentWeightOrFilterSearchImpl() = default;\n+\n+void\n+DocumentWeightOrFilterSearchImpl::doSeek(uint32_t docId)\n+{\n+    if (_children.get_docid(0) < docId) {\n+        _children.seek(0, docId);\n+    }\n+    uint32_t min_doc_id = _children.get_docid(0);\n+    for (unsigned int i = 1; min_doc_id > docId && i < _children.size(); ++i) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjAwOTY3NQ=="}, "originalCommit": {"oid": "07344e04b5628b52da54aaeaed6a28fe979e83f1"}, "originalPosition": 56}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1895, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}