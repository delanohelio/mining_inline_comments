{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc3ODcxMjg4", "number": 14257, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QwOToxMDowMFrOEf5dHQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QwOToxNDo1MVrOEf5ltQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAxODgyNjUzOnYy", "diffSide": "RIGHT", "path": "container-core/src/main/java/com/yahoo/container/jdisc/HttpResponse.java", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QwOToxMDowMFrOHMdb2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQwODo1NzowMFrOHNFkwg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjgyNzIyNQ==", "bodyText": "Why is request type as member of HttpResponse? I would assume HttpRequest is more suitable as the \"type\" is a property of the request, not the response. It's also stored in the request type for the jdisc core abstraction layer.", "url": "https://github.com/vespa-engine/vespa/pull/14257#discussion_r482827225", "createdAt": "2020-09-03T09:10:00Z", "author": {"login": "bjorncs"}, "path": "container-core/src/main/java/com/yahoo/container/jdisc/HttpResponse.java", "diffHunk": "@@ -129,4 +125,13 @@ public void complete() { }\n         return Collections::emptyIterator;\n     }\n \n+    /** Sets the type classification of this request for metric collection purposes */\n+    public void setRequestType(Request.RequestType requestType) { this.requestType = requestType; }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3c9de78274d5f7e5d7c7c19105e4925a91103e9e"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzQ2Njc4Mw==", "bodyText": "That allows the handler/processors/searchers to process the request and decide the right classification based on its content.", "url": "https://github.com/vespa-engine/vespa/pull/14257#discussion_r483466783", "createdAt": "2020-09-04T08:24:21Z", "author": {"login": "bratseth"}, "path": "container-core/src/main/java/com/yahoo/container/jdisc/HttpResponse.java", "diffHunk": "@@ -129,4 +125,13 @@ public void complete() { }\n         return Collections::emptyIterator;\n     }\n \n+    /** Sets the type classification of this request for metric collection purposes */\n+    public void setRequestType(Request.RequestType requestType) { this.requestType = requestType; }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjgyNzIyNQ=="}, "originalCommit": {"oid": "3c9de78274d5f7e5d7c7c19105e4925a91103e9e"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzQ2ODY0OQ==", "bodyText": "Jdisc filters cannot perform this classification easily if it's not part of the request type.", "url": "https://github.com/vespa-engine/vespa/pull/14257#discussion_r483468649", "createdAt": "2020-09-04T08:27:48Z", "author": {"login": "bjorncs"}, "path": "container-core/src/main/java/com/yahoo/container/jdisc/HttpResponse.java", "diffHunk": "@@ -129,4 +125,13 @@ public void complete() { }\n         return Collections::emptyIterator;\n     }\n \n+    /** Sets the type classification of this request for metric collection purposes */\n+    public void setRequestType(Request.RequestType requestType) { this.requestType = requestType; }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjgyNzIyNQ=="}, "originalCommit": {"oid": "3c9de78274d5f7e5d7c7c19105e4925a91103e9e"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzQ3MjY5NQ==", "bodyText": "Well there's lots of things filters cannot perform easily - they are special purpose. Is there a good use case for filters doing this classification?", "url": "https://github.com/vespa-engine/vespa/pull/14257#discussion_r483472695", "createdAt": "2020-09-04T08:35:14Z", "author": {"login": "bratseth"}, "path": "container-core/src/main/java/com/yahoo/container/jdisc/HttpResponse.java", "diffHunk": "@@ -129,4 +125,13 @@ public void complete() { }\n         return Collections::emptyIterator;\n     }\n \n+    /** Sets the type classification of this request for metric collection purposes */\n+    public void setRequestType(Request.RequestType requestType) { this.requestType = requestType; }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjgyNzIyNQ=="}, "originalCommit": {"oid": "3c9de78274d5f7e5d7c7c19105e4925a91103e9e"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzQ4NDg2Ng==", "bodyText": "Access control", "url": "https://github.com/vespa-engine/vespa/pull/14257#discussion_r483484866", "createdAt": "2020-09-04T08:57:00Z", "author": {"login": "bjorncs"}, "path": "container-core/src/main/java/com/yahoo/container/jdisc/HttpResponse.java", "diffHunk": "@@ -129,4 +125,13 @@ public void complete() { }\n         return Collections::emptyIterator;\n     }\n \n+    /** Sets the type classification of this request for metric collection purposes */\n+    public void setRequestType(Request.RequestType requestType) { this.requestType = requestType; }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjgyNzIyNQ=="}, "originalCommit": {"oid": "3c9de78274d5f7e5d7c7c19105e4925a91103e9e"}, "originalPosition": 56}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAxODgzNTU4OnYy", "diffSide": "RIGHT", "path": "jdisc_core/src/main/java/com/yahoo/jdisc/Request.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QwOToxMToyNFrOHMdhYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQwODowMjo1MFrOHNDy0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjgyODY0Mw==", "bodyText": "RequestType is a too generic term in my opinion. Consider naming the concept something more specific.", "url": "https://github.com/vespa-engine/vespa/pull/14257#discussion_r482828643", "createdAt": "2020-09-03T09:11:24Z", "author": {"login": "bjorncs"}, "path": "jdisc_core/src/main/java/com/yahoo/jdisc/Request.java", "diffHunk": "@@ -48,6 +48,11 @@\n     private boolean serverRequest;\n     private Long timeout;\n     private URI uri;\n+    private RequestType requestType;\n+\n+    public enum RequestType {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3c9de78274d5f7e5d7c7c19105e4925a91103e9e"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzQ1MzcwMg==", "bodyText": "That's what it's already called in the metric so using a different name here increases entropy a bit. Did you have a suggestion in mind?", "url": "https://github.com/vespa-engine/vespa/pull/14257#discussion_r483453702", "createdAt": "2020-09-04T07:59:10Z", "author": {"login": "bratseth"}, "path": "jdisc_core/src/main/java/com/yahoo/jdisc/Request.java", "diffHunk": "@@ -48,6 +48,11 @@\n     private boolean serverRequest;\n     private Long timeout;\n     private URI uri;\n+    private RequestType requestType;\n+\n+    public enum RequestType {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjgyODY0Mw=="}, "originalCommit": {"oid": "3c9de78274d5f7e5d7c7c19105e4925a91103e9e"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzQ1NTY5OQ==", "bodyText": "Not really, good naming ain't easy :)", "url": "https://github.com/vespa-engine/vespa/pull/14257#discussion_r483455699", "createdAt": "2020-09-04T08:02:50Z", "author": {"login": "bjorncs"}, "path": "jdisc_core/src/main/java/com/yahoo/jdisc/Request.java", "diffHunk": "@@ -48,6 +48,11 @@\n     private boolean serverRequest;\n     private Long timeout;\n     private URI uri;\n+    private RequestType requestType;\n+\n+    public enum RequestType {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjgyODY0Mw=="}, "originalCommit": {"oid": "3c9de78274d5f7e5d7c7c19105e4925a91103e9e"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAxODg0ODUzOnYy", "diffSide": "RIGHT", "path": "jdisc_http_service/src/main/java/com/yahoo/jdisc/http/server/jetty/JettyHttpServer.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QwOToxNDo1MVrOHMdpZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQwNzo1OTowN1rOHNDq4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjgzMDY5Mg==", "bodyText": "I actually prefer the previous indentation style. The new style requires a re-indentation of all parameters if the name or return type of the method is changed.", "url": "https://github.com/vespa-engine/vespa/pull/14257#discussion_r482830692", "createdAt": "2020-09-03T09:14:51Z", "author": {"login": "bjorncs"}, "path": "jdisc_http_service/src/main/java/com/yahoo/jdisc/http/server/jetty/JettyHttpServer.java", "diffHunk": "@@ -208,32 +203,26 @@ private static void initializeJettyLogging() {\n     private static void setupJmx(Server server, ServerConfig serverConfig) {\n         if (serverConfig.jmx().enabled()) {\n             System.setProperty(\"java.rmi.server.hostname\", \"localhost\");\n-            server.addBean(\n-                    new MBeanContainer(ManagementFactory.getPlatformMBeanServer()));\n-            server.addBean(\n-                    new ConnectorServer(\n-                            createJmxLoopbackOnlyServiceUrl(serverConfig.jmx().listenPort()),\n-                            \"org.eclipse.jetty.jmx:name=rmiconnectorserver\"));\n+            server.addBean(new MBeanContainer(ManagementFactory.getPlatformMBeanServer()));\n+            server.addBean(new ConnectorServer(createJmxLoopbackOnlyServiceUrl(serverConfig.jmx().listenPort()),\n+                                               \"org.eclipse.jetty.jmx:name=rmiconnectorserver\"));\n         }\n     }\n \n     private static JMXServiceURL createJmxLoopbackOnlyServiceUrl(int port) {\n         try {\n-            return new JMXServiceURL(\n-                    \"rmi\", \"localhost\", port, \"/jndi/rmi://localhost:\" + port + \"/jmxrmi\");\n+            return new JMXServiceURL(\"rmi\", \"localhost\", port, \"/jndi/rmi://localhost:\" + port + \"/jmxrmi\");\n         } catch (MalformedURLException e) {\n             throw new RuntimeException(e);\n         }\n     }\n \n-    private HandlerCollection getHandlerCollection(\n-            ServerConfig serverConfig,\n-            ServletPathsConfig servletPathsConfig,\n-            List<JDiscServerConnector> connectors,\n-            ServletHolder jdiscServlet,\n-            ComponentRegistry<ServletHolder> servletHolders,\n-            FilterHolder jDiscFilterInvokerFilter) {\n-\n+    private HandlerCollection getHandlerCollection(ServerConfig serverConfig,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3c9de78274d5f7e5d7c7c19105e4925a91103e9e"}, "originalPosition": 130}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzQ1Mjk2Mw==", "bodyText": "But the IDE does that for you automatically ...", "url": "https://github.com/vespa-engine/vespa/pull/14257#discussion_r483452963", "createdAt": "2020-09-04T07:57:50Z", "author": {"login": "bratseth"}, "path": "jdisc_http_service/src/main/java/com/yahoo/jdisc/http/server/jetty/JettyHttpServer.java", "diffHunk": "@@ -208,32 +203,26 @@ private static void initializeJettyLogging() {\n     private static void setupJmx(Server server, ServerConfig serverConfig) {\n         if (serverConfig.jmx().enabled()) {\n             System.setProperty(\"java.rmi.server.hostname\", \"localhost\");\n-            server.addBean(\n-                    new MBeanContainer(ManagementFactory.getPlatformMBeanServer()));\n-            server.addBean(\n-                    new ConnectorServer(\n-                            createJmxLoopbackOnlyServiceUrl(serverConfig.jmx().listenPort()),\n-                            \"org.eclipse.jetty.jmx:name=rmiconnectorserver\"));\n+            server.addBean(new MBeanContainer(ManagementFactory.getPlatformMBeanServer()));\n+            server.addBean(new ConnectorServer(createJmxLoopbackOnlyServiceUrl(serverConfig.jmx().listenPort()),\n+                                               \"org.eclipse.jetty.jmx:name=rmiconnectorserver\"));\n         }\n     }\n \n     private static JMXServiceURL createJmxLoopbackOnlyServiceUrl(int port) {\n         try {\n-            return new JMXServiceURL(\n-                    \"rmi\", \"localhost\", port, \"/jndi/rmi://localhost:\" + port + \"/jmxrmi\");\n+            return new JMXServiceURL(\"rmi\", \"localhost\", port, \"/jndi/rmi://localhost:\" + port + \"/jmxrmi\");\n         } catch (MalformedURLException e) {\n             throw new RuntimeException(e);\n         }\n     }\n \n-    private HandlerCollection getHandlerCollection(\n-            ServerConfig serverConfig,\n-            ServletPathsConfig servletPathsConfig,\n-            List<JDiscServerConnector> connectors,\n-            ServletHolder jdiscServlet,\n-            ComponentRegistry<ServletHolder> servletHolders,\n-            FilterHolder jDiscFilterInvokerFilter) {\n-\n+    private HandlerCollection getHandlerCollection(ServerConfig serverConfig,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjgzMDY5Mg=="}, "originalCommit": {"oid": "3c9de78274d5f7e5d7c7c19105e4925a91103e9e"}, "originalPosition": 130}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzQ1MzY2NA==", "bodyText": "Not mine, probably missing some non-default configuration.", "url": "https://github.com/vespa-engine/vespa/pull/14257#discussion_r483453664", "createdAt": "2020-09-04T07:59:07Z", "author": {"login": "bjorncs"}, "path": "jdisc_http_service/src/main/java/com/yahoo/jdisc/http/server/jetty/JettyHttpServer.java", "diffHunk": "@@ -208,32 +203,26 @@ private static void initializeJettyLogging() {\n     private static void setupJmx(Server server, ServerConfig serverConfig) {\n         if (serverConfig.jmx().enabled()) {\n             System.setProperty(\"java.rmi.server.hostname\", \"localhost\");\n-            server.addBean(\n-                    new MBeanContainer(ManagementFactory.getPlatformMBeanServer()));\n-            server.addBean(\n-                    new ConnectorServer(\n-                            createJmxLoopbackOnlyServiceUrl(serverConfig.jmx().listenPort()),\n-                            \"org.eclipse.jetty.jmx:name=rmiconnectorserver\"));\n+            server.addBean(new MBeanContainer(ManagementFactory.getPlatformMBeanServer()));\n+            server.addBean(new ConnectorServer(createJmxLoopbackOnlyServiceUrl(serverConfig.jmx().listenPort()),\n+                                               \"org.eclipse.jetty.jmx:name=rmiconnectorserver\"));\n         }\n     }\n \n     private static JMXServiceURL createJmxLoopbackOnlyServiceUrl(int port) {\n         try {\n-            return new JMXServiceURL(\n-                    \"rmi\", \"localhost\", port, \"/jndi/rmi://localhost:\" + port + \"/jmxrmi\");\n+            return new JMXServiceURL(\"rmi\", \"localhost\", port, \"/jndi/rmi://localhost:\" + port + \"/jmxrmi\");\n         } catch (MalformedURLException e) {\n             throw new RuntimeException(e);\n         }\n     }\n \n-    private HandlerCollection getHandlerCollection(\n-            ServerConfig serverConfig,\n-            ServletPathsConfig servletPathsConfig,\n-            List<JDiscServerConnector> connectors,\n-            ServletHolder jdiscServlet,\n-            ComponentRegistry<ServletHolder> servletHolders,\n-            FilterHolder jDiscFilterInvokerFilter) {\n-\n+    private HandlerCollection getHandlerCollection(ServerConfig serverConfig,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjgzMDY5Mg=="}, "originalCommit": {"oid": "3c9de78274d5f7e5d7c7c19105e4925a91103e9e"}, "originalPosition": 130}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1442, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}