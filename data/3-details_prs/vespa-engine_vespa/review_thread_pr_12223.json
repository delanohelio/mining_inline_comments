{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc2MTYwMTQx", "number": 12223, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQwODozOToxNlrODgmsGw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQwODo0NDo1NVrODgmyiQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM1NTE0OTA3OnYy", "diffSide": "RIGHT", "path": "searchlib/src/vespa/searchlib/tensor/hnsw_index.cpp", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQwODozOToxNlrOFq5W9w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOVQxMjoyODo0N1rOFrmQ3g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDUyNDI3OQ==", "bodyText": "Perhaps 'k + 100' should be a parameter to the function instead, e.g. 'search_k'?", "url": "https://github.com/vespa-engine/vespa/pull/12223#discussion_r380524279", "createdAt": "2020-02-18T08:39:16Z", "author": {"login": "geirst"}, "path": "searchlib/src/vespa/searchlib/tensor/hnsw_index.cpp", "diffHunk": "@@ -310,6 +310,43 @@ HnswIndex::remove_document(uint32_t docid)\n     _node_refs[docid].store_release(invalid);\n }\n \n+std::vector<uint32_t>\n+HnswIndex::find_top_k(TypedCells vector, uint32_t k)\n+{\n+    std::vector<uint32_t> result;\n+    std::vector<HnswCandidate> candidates = top_k_candidates(vector, k + 100);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d3853d707b9fd95a7cdb9d0edf1ad8de245dc049"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTI1OTk5OA==", "bodyText": "now exposed as \"explore_k\"", "url": "https://github.com/vespa-engine/vespa/pull/12223#discussion_r381259998", "createdAt": "2020-02-19T12:28:47Z", "author": {"login": "arnej27959"}, "path": "searchlib/src/vespa/searchlib/tensor/hnsw_index.cpp", "diffHunk": "@@ -310,6 +310,43 @@ HnswIndex::remove_document(uint32_t docid)\n     _node_refs[docid].store_release(invalid);\n }\n \n+std::vector<uint32_t>\n+HnswIndex::find_top_k(TypedCells vector, uint32_t k)\n+{\n+    std::vector<uint32_t> result;\n+    std::vector<HnswCandidate> candidates = top_k_candidates(vector, k + 100);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDUyNDI3OQ=="}, "originalCommit": {"oid": "d3853d707b9fd95a7cdb9d0edf1ad8de245dc049"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM1NTE2NTUzOnYy", "diffSide": "RIGHT", "path": "searchlib/src/tests/tensor/hnsw_index/hnsw_index_test.cpp", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQwODo0NDo1NVrOFq5hUA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xOFQwODo0NDo1NVrOFq5hUA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDUyNjkyOA==", "bodyText": "Consider removing this.", "url": "https://github.com/vespa-engine/vespa/pull/12223#discussion_r380526928", "createdAt": "2020-02-18T08:44:55Z", "author": {"login": "geirst"}, "path": "searchlib/src/tests/tensor/hnsw_index/hnsw_index_test.cpp", "diffHunk": "@@ -86,6 +86,24 @@ class HnswIndexTest : public ::testing::Test {\n         ASSERT_EQ(exp_levels.size(), act_node.size());\n         EXPECT_EQ(exp_levels, act_node.levels());\n     }\n+    void expect_top_3(uint32_t docid, std::vector<uint32_t> exp_hits) {\n+        uint32_t k = 3;\n+        auto qv = vectors.get_vector(docid);\n+        auto rv = index->top_k_candidates(qv, k);\n+        size_t idx = 0;\n+        for (const auto & hit : rv) {\n+            // fprintf(stderr, \"found docid %u dist %.1f\\n\", hit.docid, hit.distance);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d3853d707b9fd95a7cdb9d0edf1ad8de245dc049"}, "originalPosition": 19}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2409, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}