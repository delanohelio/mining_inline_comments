{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE3Mzk0OTc3", "number": 13243, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQwNzoyMjozNFrOD8WnCQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQwNzoyMjozNFrOD8WnCQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0NjExNTkzOnYy", "diffSide": "RIGHT", "path": "controller-server/src/main/java/com/yahoo/vespa/hosted/controller/ApplicationController.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQwNzoyMjozNFrOGVPNJA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQwNzoyMjozNFrOGVPNJA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDkyMjQwNA==", "bodyText": "We should make deployment fail on failed role creation.", "url": "https://github.com/vespa-engine/vespa/pull/13243#discussion_r424922404", "createdAt": "2020-05-14T07:22:34Z", "author": {"login": "oyving"}, "path": "controller-server/src/main/java/com/yahoo/vespa/hosted/controller/ApplicationController.java", "diffHunk": "@@ -328,10 +333,19 @@ public ActivateResult deploy2(JobId job, boolean deploySourceVersions) { // TODO\n                 endpointCertificateMetadata = endpointCertificateManager.getEndpointCertificateMetadata(instance, zone);\n \n                 endpoints = controller.routing().registerEndpointsInDns(application.get(), job.application().instance(), zone);\n+\n+                // Provision application roles if enabled for the zone\n+                if (provisionApplicationRoles.with(FetchVector.Dimension.ZONE_ID, zone.value()).value()) {\n+                    try {\n+                        applicationRoles = controller.serviceRegistry().applicationRoleService().createApplicationRoles(instance.id());\n+                    } catch (Exception e) {\n+                        log.log(Level.SEVERE, \"Exception creating application roles for application: \" + instance.id(), e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "30609118ff8644aa68c443ddae8e09202abdc846"}, "originalPosition": 63}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1653, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}