{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgwNzc3OTc5", "number": 12361, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QyMzowMDozNlrODjpCPQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QyMzowMDozNlrODjpCPQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4Njk5MDY5OnYy", "diffSide": "RIGHT", "path": "node-repository/src/main/java/com/yahoo/vespa/hosted/provision/restapi/v2/NodePatcher.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QyMzowMDozNlrOFvkM9w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yN1QyMzowMToxNVrOFvkN_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTQyMDUzNQ==", "bodyText": "If more than one of WANT_TO_RETIRE, ipAddresses, additionalIpAddresses are specified in the patch request, then this PR will invoke nodeRepository.list(lock) that many times. This happens e.g. on provisioning, when the last two are specified. At the risk of making this much more convoluted, consider listing at most once.", "url": "https://github.com/vespa-engine/vespa/pull/12361#discussion_r385420535", "createdAt": "2020-02-27T23:00:36Z", "author": {"login": "hakonhall"}, "path": "node-repository/src/main/java/com/yahoo/vespa/hosted/provision/restapi/v2/NodePatcher.java", "diffHunk": "@@ -133,9 +130,9 @@ private Node applyField(Node node, String name, Inspector value) {\n             case \"parentHostname\" :\n                 return node.withParentHostname(asString(value));\n             case \"ipAddresses\" :\n-                return IP.Config.verify(node.with(node.ipConfig().with(asStringSet(value))), nodes);\n+                return IP.Config.verify(node.with(node.ipConfig().with(asStringSet(value))), nodes.get());\n             case \"additionalIpAddresses\" :\n-                return IP.Config.verify(node.with(node.ipConfig().with(IP.Pool.of(asStringSet(value)))), nodes);\n+                return IP.Config.verify(node.with(node.ipConfig().with(IP.Pool.of(asStringSet(value)))), nodes.get());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ae06cc33e932ce132867744eab058eb8fddea25d"}, "originalPosition": 72}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTQyMDc5Ng==", "bodyText": "The overall impact of this PR should be a great win, so merging now...", "url": "https://github.com/vespa-engine/vespa/pull/12361#discussion_r385420796", "createdAt": "2020-02-27T23:01:15Z", "author": {"login": "hakonhall"}, "path": "node-repository/src/main/java/com/yahoo/vespa/hosted/provision/restapi/v2/NodePatcher.java", "diffHunk": "@@ -133,9 +130,9 @@ private Node applyField(Node node, String name, Inspector value) {\n             case \"parentHostname\" :\n                 return node.withParentHostname(asString(value));\n             case \"ipAddresses\" :\n-                return IP.Config.verify(node.with(node.ipConfig().with(asStringSet(value))), nodes);\n+                return IP.Config.verify(node.with(node.ipConfig().with(asStringSet(value))), nodes.get());\n             case \"additionalIpAddresses\" :\n-                return IP.Config.verify(node.with(node.ipConfig().with(IP.Pool.of(asStringSet(value)))), nodes);\n+                return IP.Config.verify(node.with(node.ipConfig().with(IP.Pool.of(asStringSet(value)))), nodes.get());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTQyMDUzNQ=="}, "originalCommit": {"oid": "ae06cc33e932ce132867744eab058eb8fddea25d"}, "originalPosition": 72}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2363, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}