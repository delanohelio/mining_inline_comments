{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI3NDI4MjQz", "number": 15466, "title": "Simplify storage message address", "bodyText": "@vekterli please review\n@baldersheim FYI", "createdAt": "2020-11-25T13:01:12Z", "url": "https://github.com/vespa-engine/vespa/pull/15466", "merged": true, "mergeCommit": {"oid": "3ca30562411372bb23d3d871a24111e20f79892b"}, "closed": true, "closedAt": "2020-11-25T15:52:58Z", "author": {"login": "geirst"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdf9cUtAH2gAyNTI3NDI4MjQzOmFhOTAzYmZiZjIzZDNiODU1ZDUwZGUxODVhMTVkODA2MTgyNWM3Nzg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdgAUomgFqTUzODYyODg2NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "aa903bfbf23d3b855d50de185a15d8061825c778", "author": {"user": {"login": "geirst", "name": "Geir Storli"}}, "url": "https://github.com/vespa-engine/vespa/commit/aa903bfbf23d3b855d50de185a15d8061825c778", "committedDate": "2020-11-25T12:24:02Z", "message": "Change control and data destination to use mbus::Route directly."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c090dda709692c07ca492b698af9db3e1a76d8e1", "author": {"user": {"login": "geirst", "name": "Geir Storli"}}, "url": "https://github.com/vespa-engine/vespa/commit/c090dda709692c07ca492b698af9db3e1a76d8e1", "committedDate": "2020-11-25T12:56:50Z", "message": "Create the mbus::Route on demand instead of storing it inside StorageMessageAddress.\n\nCreating and deleting the route is expensive and not used with RPC for Storage API communication."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM4NDg2MDEw", "url": "https://github.com/vespa-engine/vespa/pull/15466#pullrequestreview-538486010", "createdAt": "2020-11-25T13:19:20Z", "commit": {"oid": "c090dda709692c07ca492b698af9db3e1a76d8e1"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQxMzoxOToyMFrOH5zFVw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQxMzoxOToyMFrOH5zFVw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDM2NzgzMQ==", "bodyText": "To avoid having to contemplate any struct alignment issues and how they may affect the resulting value, could be simplified down to\nuint16_t buf[] = { type, index };\nreturn vespalib::hashValue(&buf, sizeof(buf));", "url": "https://github.com/vespa-engine/vespa/pull/15466#discussion_r530367831", "createdAt": "2020-11-25T13:19:20Z", "author": {"login": "vekterli"}, "path": "storageapi/src/vespa/storageapi/messageapi/storagemessage.cpp", "diffHunk": "@@ -160,39 +151,50 @@ createAddress(vespalib::stringref cluster, const lib::NodeType& type, uint16_t i\n     return os.str();\n }\n \n+size_t\n+calculate_node_hash(const lib::NodeType& type, uint16_t index)\n+{\n+    struct NodeValue {\n+        uint16_t type;\n+        uint16_t index;\n+        NodeValue(const lib::NodeType& type_in, uint16_t index_in) : type(type_in), index(index_in) {}\n+    };\n+    NodeValue value(type, index);\n+    return vespalib::hashValue(&value, sizeof(NodeValue));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c090dda709692c07ca492b698af9db3e1a76d8e1"}, "originalPosition": 29}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e9e1b5ef1e6cd77ff5e198ac2ff70449499371af", "author": {"user": {"login": "geirst", "name": "Geir Storli"}}, "url": "https://github.com/vespa-engine/vespa/commit/e9e1b5ef1e6cd77ff5e198ac2ff70449499371af", "committedDate": "2020-11-25T13:59:23Z", "message": "Simplify hash calculation."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM4NjI4ODY0", "url": "https://github.com/vespa-engine/vespa/pull/15466#pullrequestreview-538628864", "createdAt": "2020-11-25T15:45:21Z", "commit": {"oid": "e9e1b5ef1e6cd77ff5e198ac2ff70449499371af"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1880, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}