{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY0Nzk0Nzgw", "number": 11855, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMFQxMTo1NDoxOFrODZL5iw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMFQxMTo1OTo1OFrODZL_Kw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI3NzM1OTQ3OnYy", "diffSide": "RIGHT", "path": "controller-api/src/main/java/com/yahoo/vespa/hosted/controller/api/integration/deployment/ApplicationVersion.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMFQxMTo1NDoxOFrOFfcBEw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMFQxMTo1NDoxOFrOFfcBEw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODUwOTIwMw==", "bodyText": "\ud83d\udc4f", "url": "https://github.com/vespa-engine/vespa/pull/11855#discussion_r368509203", "createdAt": "2020-01-20T11:54:18Z", "author": {"login": "freva"}, "path": "controller-api/src/main/java/com/yahoo/vespa/hosted/controller/api/integration/deployment/ApplicationVersion.java", "diffHunk": "@@ -39,24 +40,22 @@\n     public ApplicationVersion(Optional<SourceRevision> source, OptionalLong buildNumber, Optional<String> authorEmail,\n                                Optional<Version> compileVersion, Optional<Instant> buildTime, Optional<String> sourceUrl,\n                                Optional<String> commit) {\n-        Objects.requireNonNull(source, \"source cannot be null\");\n-        Objects.requireNonNull(buildNumber, \"buildNumber cannot be null\");\n-        Objects.requireNonNull(authorEmail, \"author cannot be null\");\n-        if (source.isPresent() != buildNumber.isPresent()) {\n-            throw new IllegalArgumentException(\"both buildNumber and source must be set together\");\n-        }\n-        if (compileVersion.isPresent() != buildTime.isPresent()) {\n-            throw new IllegalArgumentException(\"both compileVersion and buildTime must be set together\");\n-        }\n-        if (buildNumber.isPresent() && buildNumber.getAsLong() <= 0) {\n-            throw new IllegalArgumentException(\"buildNumber must be > 0\");\n-        }\n-        if (authorEmail.isPresent() && ! authorEmail.get().matches(\"[^@]+@[^@]+\")) {\n+        if (buildNumber.isEmpty() && (   source.isPresent() || authorEmail.isPresent() || compileVersion.isPresent()\n+                                      || buildTime.isPresent() || sourceUrl.isPresent() || commit.isPresent()))\n+            throw new IllegalArgumentException(\"Build number must be present if any other attribute is\");\n+\n+        if (buildNumber.isPresent() && buildNumber.getAsLong() <= 0)\n+            throw new IllegalArgumentException(\"Build number must be > 0\");\n+\n+        if (commit.isPresent() && commit.get().length() > 128)\n+            throw new IllegalArgumentException(\"Commit may not be longer than 128 characters\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5f4ca0aab540012fb02326fd597207c2a181add6"}, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI3NzM3MTk3OnYy", "diffSide": "RIGHT", "path": "controller-api/src/main/java/com/yahoo/vespa/hosted/controller/api/integration/deployment/ApplicationVersion.java", "isResolved": true, "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMFQxMTo1OToxMlrOFfcIng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMFQxMjozMDozMVrOFfc4Xw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODUxMTEzNA==", "bodyText": "When can buildNumber be empty?", "url": "https://github.com/vespa-engine/vespa/pull/11855#discussion_r368511134", "createdAt": "2020-01-20T11:59:12Z", "author": {"login": "freva"}, "path": "controller-api/src/main/java/com/yahoo/vespa/hosted/controller/api/integration/deployment/ApplicationVersion.java", "diffHunk": "@@ -39,24 +40,22 @@\n     public ApplicationVersion(Optional<SourceRevision> source, OptionalLong buildNumber, Optional<String> authorEmail,\n                                Optional<Version> compileVersion, Optional<Instant> buildTime, Optional<String> sourceUrl,\n                                Optional<String> commit) {\n-        Objects.requireNonNull(source, \"source cannot be null\");\n-        Objects.requireNonNull(buildNumber, \"buildNumber cannot be null\");\n-        Objects.requireNonNull(authorEmail, \"author cannot be null\");\n-        if (source.isPresent() != buildNumber.isPresent()) {\n-            throw new IllegalArgumentException(\"both buildNumber and source must be set together\");\n-        }\n-        if (compileVersion.isPresent() != buildTime.isPresent()) {\n-            throw new IllegalArgumentException(\"both compileVersion and buildTime must be set together\");\n-        }\n-        if (buildNumber.isPresent() && buildNumber.getAsLong() <= 0) {\n-            throw new IllegalArgumentException(\"buildNumber must be > 0\");\n-        }\n-        if (authorEmail.isPresent() && ! authorEmail.get().matches(\"[^@]+@[^@]+\")) {\n+        if (buildNumber.isEmpty() && (   source.isPresent() || authorEmail.isPresent() || compileVersion.isPresent()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5f4ca0aab540012fb02326fd597207c2a181add6"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODUxMzA1OQ==", "bodyText": "ApplicationVersion.empty.", "url": "https://github.com/vespa-engine/vespa/pull/11855#discussion_r368513059", "createdAt": "2020-01-20T12:04:09Z", "author": {"login": "jonmv"}, "path": "controller-api/src/main/java/com/yahoo/vespa/hosted/controller/api/integration/deployment/ApplicationVersion.java", "diffHunk": "@@ -39,24 +40,22 @@\n     public ApplicationVersion(Optional<SourceRevision> source, OptionalLong buildNumber, Optional<String> authorEmail,\n                                Optional<Version> compileVersion, Optional<Instant> buildTime, Optional<String> sourceUrl,\n                                Optional<String> commit) {\n-        Objects.requireNonNull(source, \"source cannot be null\");\n-        Objects.requireNonNull(buildNumber, \"buildNumber cannot be null\");\n-        Objects.requireNonNull(authorEmail, \"author cannot be null\");\n-        if (source.isPresent() != buildNumber.isPresent()) {\n-            throw new IllegalArgumentException(\"both buildNumber and source must be set together\");\n-        }\n-        if (compileVersion.isPresent() != buildTime.isPresent()) {\n-            throw new IllegalArgumentException(\"both compileVersion and buildTime must be set together\");\n-        }\n-        if (buildNumber.isPresent() && buildNumber.getAsLong() <= 0) {\n-            throw new IllegalArgumentException(\"buildNumber must be > 0\");\n-        }\n-        if (authorEmail.isPresent() && ! authorEmail.get().matches(\"[^@]+@[^@]+\")) {\n+        if (buildNumber.isEmpty() && (   source.isPresent() || authorEmail.isPresent() || compileVersion.isPresent()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODUxMTEzNA=="}, "originalCommit": {"oid": "5f4ca0aab540012fb02326fd597207c2a181add6"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODUxNDMzNQ==", "bodyText": "But is it only used internally or is it possible to get this as response to some job? (I know that at least in the past deployments to dev did not have build number)", "url": "https://github.com/vespa-engine/vespa/pull/11855#discussion_r368514335", "createdAt": "2020-01-20T12:07:09Z", "author": {"login": "freva"}, "path": "controller-api/src/main/java/com/yahoo/vespa/hosted/controller/api/integration/deployment/ApplicationVersion.java", "diffHunk": "@@ -39,24 +40,22 @@\n     public ApplicationVersion(Optional<SourceRevision> source, OptionalLong buildNumber, Optional<String> authorEmail,\n                                Optional<Version> compileVersion, Optional<Instant> buildTime, Optional<String> sourceUrl,\n                                Optional<String> commit) {\n-        Objects.requireNonNull(source, \"source cannot be null\");\n-        Objects.requireNonNull(buildNumber, \"buildNumber cannot be null\");\n-        Objects.requireNonNull(authorEmail, \"author cannot be null\");\n-        if (source.isPresent() != buildNumber.isPresent()) {\n-            throw new IllegalArgumentException(\"both buildNumber and source must be set together\");\n-        }\n-        if (compileVersion.isPresent() != buildTime.isPresent()) {\n-            throw new IllegalArgumentException(\"both compileVersion and buildTime must be set together\");\n-        }\n-        if (buildNumber.isPresent() && buildNumber.getAsLong() <= 0) {\n-            throw new IllegalArgumentException(\"buildNumber must be > 0\");\n-        }\n-        if (authorEmail.isPresent() && ! authorEmail.get().matches(\"[^@]+@[^@]+\")) {\n+        if (buildNumber.isEmpty() && (   source.isPresent() || authorEmail.isPresent() || compileVersion.isPresent()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODUxMTEzNA=="}, "originalCommit": {"oid": "5f4ca0aab540012fb02326fd597207c2a181add6"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODUxNjYwNA==", "bodyText": "They explicitly use the empty one.", "url": "https://github.com/vespa-engine/vespa/pull/11855#discussion_r368516604", "createdAt": "2020-01-20T12:13:10Z", "author": {"login": "jonmv"}, "path": "controller-api/src/main/java/com/yahoo/vespa/hosted/controller/api/integration/deployment/ApplicationVersion.java", "diffHunk": "@@ -39,24 +40,22 @@\n     public ApplicationVersion(Optional<SourceRevision> source, OptionalLong buildNumber, Optional<String> authorEmail,\n                                Optional<Version> compileVersion, Optional<Instant> buildTime, Optional<String> sourceUrl,\n                                Optional<String> commit) {\n-        Objects.requireNonNull(source, \"source cannot be null\");\n-        Objects.requireNonNull(buildNumber, \"buildNumber cannot be null\");\n-        Objects.requireNonNull(authorEmail, \"author cannot be null\");\n-        if (source.isPresent() != buildNumber.isPresent()) {\n-            throw new IllegalArgumentException(\"both buildNumber and source must be set together\");\n-        }\n-        if (compileVersion.isPresent() != buildTime.isPresent()) {\n-            throw new IllegalArgumentException(\"both compileVersion and buildTime must be set together\");\n-        }\n-        if (buildNumber.isPresent() && buildNumber.getAsLong() <= 0) {\n-            throw new IllegalArgumentException(\"buildNumber must be > 0\");\n-        }\n-        if (authorEmail.isPresent() && ! authorEmail.get().matches(\"[^@]+@[^@]+\")) {\n+        if (buildNumber.isEmpty() && (   source.isPresent() || authorEmail.isPresent() || compileVersion.isPresent()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODUxMTEzNA=="}, "originalCommit": {"oid": "5f4ca0aab540012fb02326fd597207c2a181add6"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODUxNzA5Nw==", "bodyText": ":(", "url": "https://github.com/vespa-engine/vespa/pull/11855#discussion_r368517097", "createdAt": "2020-01-20T12:14:29Z", "author": {"login": "freva"}, "path": "controller-api/src/main/java/com/yahoo/vespa/hosted/controller/api/integration/deployment/ApplicationVersion.java", "diffHunk": "@@ -39,24 +40,22 @@\n     public ApplicationVersion(Optional<SourceRevision> source, OptionalLong buildNumber, Optional<String> authorEmail,\n                                Optional<Version> compileVersion, Optional<Instant> buildTime, Optional<String> sourceUrl,\n                                Optional<String> commit) {\n-        Objects.requireNonNull(source, \"source cannot be null\");\n-        Objects.requireNonNull(buildNumber, \"buildNumber cannot be null\");\n-        Objects.requireNonNull(authorEmail, \"author cannot be null\");\n-        if (source.isPresent() != buildNumber.isPresent()) {\n-            throw new IllegalArgumentException(\"both buildNumber and source must be set together\");\n-        }\n-        if (compileVersion.isPresent() != buildTime.isPresent()) {\n-            throw new IllegalArgumentException(\"both compileVersion and buildTime must be set together\");\n-        }\n-        if (buildNumber.isPresent() && buildNumber.getAsLong() <= 0) {\n-            throw new IllegalArgumentException(\"buildNumber must be > 0\");\n-        }\n-        if (authorEmail.isPresent() && ! authorEmail.get().matches(\"[^@]+@[^@]+\")) {\n+        if (buildNumber.isEmpty() && (   source.isPresent() || authorEmail.isPresent() || compileVersion.isPresent()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODUxMTEzNA=="}, "originalCommit": {"oid": "5f4ca0aab540012fb02326fd597207c2a181add6"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODUyMDgxOQ==", "bodyText": "Why sad face?", "url": "https://github.com/vespa-engine/vespa/pull/11855#discussion_r368520819", "createdAt": "2020-01-20T12:24:21Z", "author": {"login": "jonmv"}, "path": "controller-api/src/main/java/com/yahoo/vespa/hosted/controller/api/integration/deployment/ApplicationVersion.java", "diffHunk": "@@ -39,24 +40,22 @@\n     public ApplicationVersion(Optional<SourceRevision> source, OptionalLong buildNumber, Optional<String> authorEmail,\n                                Optional<Version> compileVersion, Optional<Instant> buildTime, Optional<String> sourceUrl,\n                                Optional<String> commit) {\n-        Objects.requireNonNull(source, \"source cannot be null\");\n-        Objects.requireNonNull(buildNumber, \"buildNumber cannot be null\");\n-        Objects.requireNonNull(authorEmail, \"author cannot be null\");\n-        if (source.isPresent() != buildNumber.isPresent()) {\n-            throw new IllegalArgumentException(\"both buildNumber and source must be set together\");\n-        }\n-        if (compileVersion.isPresent() != buildTime.isPresent()) {\n-            throw new IllegalArgumentException(\"both compileVersion and buildTime must be set together\");\n-        }\n-        if (buildNumber.isPresent() && buildNumber.getAsLong() <= 0) {\n-            throw new IllegalArgumentException(\"buildNumber must be > 0\");\n-        }\n-        if (authorEmail.isPresent() && ! authorEmail.get().matches(\"[^@]+@[^@]+\")) {\n+        if (buildNumber.isEmpty() && (   source.isPresent() || authorEmail.isPresent() || compileVersion.isPresent()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODUxMTEzNA=="}, "originalCommit": {"oid": "5f4ca0aab540012fb02326fd597207c2a181add6"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODUyMzM1OQ==", "bodyText": "Would be nice to have something we can use to consistently refer to builds in console", "url": "https://github.com/vespa-engine/vespa/pull/11855#discussion_r368523359", "createdAt": "2020-01-20T12:30:31Z", "author": {"login": "freva"}, "path": "controller-api/src/main/java/com/yahoo/vespa/hosted/controller/api/integration/deployment/ApplicationVersion.java", "diffHunk": "@@ -39,24 +40,22 @@\n     public ApplicationVersion(Optional<SourceRevision> source, OptionalLong buildNumber, Optional<String> authorEmail,\n                                Optional<Version> compileVersion, Optional<Instant> buildTime, Optional<String> sourceUrl,\n                                Optional<String> commit) {\n-        Objects.requireNonNull(source, \"source cannot be null\");\n-        Objects.requireNonNull(buildNumber, \"buildNumber cannot be null\");\n-        Objects.requireNonNull(authorEmail, \"author cannot be null\");\n-        if (source.isPresent() != buildNumber.isPresent()) {\n-            throw new IllegalArgumentException(\"both buildNumber and source must be set together\");\n-        }\n-        if (compileVersion.isPresent() != buildTime.isPresent()) {\n-            throw new IllegalArgumentException(\"both compileVersion and buildTime must be set together\");\n-        }\n-        if (buildNumber.isPresent() && buildNumber.getAsLong() <= 0) {\n-            throw new IllegalArgumentException(\"buildNumber must be > 0\");\n-        }\n-        if (authorEmail.isPresent() && ! authorEmail.get().matches(\"[^@]+@[^@]+\")) {\n+        if (buildNumber.isEmpty() && (   source.isPresent() || authorEmail.isPresent() || compileVersion.isPresent()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODUxMTEzNA=="}, "originalCommit": {"oid": "5f4ca0aab540012fb02326fd597207c2a181add6"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI3NzM3Mzg3OnYy", "diffSide": "RIGHT", "path": "controller-api/src/main/java/com/yahoo/vespa/hosted/controller/api/integration/deployment/ApplicationVersion.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMFQxMTo1OTo1OFrOFfcJug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMFQxMjoxNToyMlrOFfchDQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODUxMTQxOA==", "bodyText": "Validate URL somewhere?", "url": "https://github.com/vespa-engine/vespa/pull/11855#discussion_r368511418", "createdAt": "2020-01-20T11:59:58Z", "author": {"login": "freva"}, "path": "controller-api/src/main/java/com/yahoo/vespa/hosted/controller/api/integration/deployment/ApplicationVersion.java", "diffHunk": "@@ -39,24 +40,22 @@\n     public ApplicationVersion(Optional<SourceRevision> source, OptionalLong buildNumber, Optional<String> authorEmail,\n                                Optional<Version> compileVersion, Optional<Instant> buildTime, Optional<String> sourceUrl,\n                                Optional<String> commit) {\n-        Objects.requireNonNull(source, \"source cannot be null\");\n-        Objects.requireNonNull(buildNumber, \"buildNumber cannot be null\");\n-        Objects.requireNonNull(authorEmail, \"author cannot be null\");\n-        if (source.isPresent() != buildNumber.isPresent()) {\n-            throw new IllegalArgumentException(\"both buildNumber and source must be set together\");\n-        }\n-        if (compileVersion.isPresent() != buildTime.isPresent()) {\n-            throw new IllegalArgumentException(\"both compileVersion and buildTime must be set together\");\n-        }\n-        if (buildNumber.isPresent() && buildNumber.getAsLong() <= 0) {\n-            throw new IllegalArgumentException(\"buildNumber must be > 0\");\n-        }\n-        if (authorEmail.isPresent() && ! authorEmail.get().matches(\"[^@]+@[^@]+\")) {\n+        if (buildNumber.isEmpty() && (   source.isPresent() || authorEmail.isPresent() || compileVersion.isPresent()\n+                                      || buildTime.isPresent() || sourceUrl.isPresent() || commit.isPresent()))\n+            throw new IllegalArgumentException(\"Build number must be present if any other attribute is\");\n+\n+        if (buildNumber.isPresent() && buildNumber.getAsLong() <= 0)\n+            throw new IllegalArgumentException(\"Build number must be > 0\");\n+\n+        if (commit.isPresent() && commit.get().length() > 128)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5f4ca0aab540012fb02326fd597207c2a181add6"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODUxMzU3MQ==", "bodyText": "Hmm... Yes, for the explicitly passed sourceUrl, I guess that makes sense. I don't dare do it for the generated ones :)", "url": "https://github.com/vespa-engine/vespa/pull/11855#discussion_r368513571", "createdAt": "2020-01-20T12:05:29Z", "author": {"login": "jonmv"}, "path": "controller-api/src/main/java/com/yahoo/vespa/hosted/controller/api/integration/deployment/ApplicationVersion.java", "diffHunk": "@@ -39,24 +40,22 @@\n     public ApplicationVersion(Optional<SourceRevision> source, OptionalLong buildNumber, Optional<String> authorEmail,\n                                Optional<Version> compileVersion, Optional<Instant> buildTime, Optional<String> sourceUrl,\n                                Optional<String> commit) {\n-        Objects.requireNonNull(source, \"source cannot be null\");\n-        Objects.requireNonNull(buildNumber, \"buildNumber cannot be null\");\n-        Objects.requireNonNull(authorEmail, \"author cannot be null\");\n-        if (source.isPresent() != buildNumber.isPresent()) {\n-            throw new IllegalArgumentException(\"both buildNumber and source must be set together\");\n-        }\n-        if (compileVersion.isPresent() != buildTime.isPresent()) {\n-            throw new IllegalArgumentException(\"both compileVersion and buildTime must be set together\");\n-        }\n-        if (buildNumber.isPresent() && buildNumber.getAsLong() <= 0) {\n-            throw new IllegalArgumentException(\"buildNumber must be > 0\");\n-        }\n-        if (authorEmail.isPresent() && ! authorEmail.get().matches(\"[^@]+@[^@]+\")) {\n+        if (buildNumber.isEmpty() && (   source.isPresent() || authorEmail.isPresent() || compileVersion.isPresent()\n+                                      || buildTime.isPresent() || sourceUrl.isPresent() || commit.isPresent()))\n+            throw new IllegalArgumentException(\"Build number must be present if any other attribute is\");\n+\n+        if (buildNumber.isPresent() && buildNumber.getAsLong() <= 0)\n+            throw new IllegalArgumentException(\"Build number must be > 0\");\n+\n+        if (commit.isPresent() && commit.get().length() > 128)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODUxMTQxOA=="}, "originalCommit": {"oid": "5f4ca0aab540012fb02326fd597207c2a181add6"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODUxNzM4OQ==", "bodyText": "URI.create() is a start, but unfortunately it allows relative URLs or just the path component", "url": "https://github.com/vespa-engine/vespa/pull/11855#discussion_r368517389", "createdAt": "2020-01-20T12:15:22Z", "author": {"login": "freva"}, "path": "controller-api/src/main/java/com/yahoo/vespa/hosted/controller/api/integration/deployment/ApplicationVersion.java", "diffHunk": "@@ -39,24 +40,22 @@\n     public ApplicationVersion(Optional<SourceRevision> source, OptionalLong buildNumber, Optional<String> authorEmail,\n                                Optional<Version> compileVersion, Optional<Instant> buildTime, Optional<String> sourceUrl,\n                                Optional<String> commit) {\n-        Objects.requireNonNull(source, \"source cannot be null\");\n-        Objects.requireNonNull(buildNumber, \"buildNumber cannot be null\");\n-        Objects.requireNonNull(authorEmail, \"author cannot be null\");\n-        if (source.isPresent() != buildNumber.isPresent()) {\n-            throw new IllegalArgumentException(\"both buildNumber and source must be set together\");\n-        }\n-        if (compileVersion.isPresent() != buildTime.isPresent()) {\n-            throw new IllegalArgumentException(\"both compileVersion and buildTime must be set together\");\n-        }\n-        if (buildNumber.isPresent() && buildNumber.getAsLong() <= 0) {\n-            throw new IllegalArgumentException(\"buildNumber must be > 0\");\n-        }\n-        if (authorEmail.isPresent() && ! authorEmail.get().matches(\"[^@]+@[^@]+\")) {\n+        if (buildNumber.isEmpty() && (   source.isPresent() || authorEmail.isPresent() || compileVersion.isPresent()\n+                                      || buildTime.isPresent() || sourceUrl.isPresent() || commit.isPresent()))\n+            throw new IllegalArgumentException(\"Build number must be present if any other attribute is\");\n+\n+        if (buildNumber.isPresent() && buildNumber.getAsLong() <= 0)\n+            throw new IllegalArgumentException(\"Build number must be > 0\");\n+\n+        if (commit.isPresent() && commit.get().length() > 128)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODUxMTQxOA=="}, "originalCommit": {"oid": "5f4ca0aab540012fb02326fd597207c2a181add6"}, "originalPosition": 32}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2587, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}