{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYyMDM3Mzgw", "number": 11755, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xM1QxMjozMzo1N1rODXgV_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xM1QxMjozMzo1N1rODXgV_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI1OTczNzU4OnYy", "diffSide": "RIGHT", "path": "document/src/main/java/com/yahoo/document/update/TensorModifyUpdate.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xM1QxMjozMzo1N1rOFc1c_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xM1QxMzo0Mjo1MVrOFc3PaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTc4MDIyMg==", "bodyText": "This will break how we handle such updates in backend. We treat the cells to update as a sparse tensor and assumes this has been verified before serialized. To support the blocked syntax, the resulting tensor must still be a sparse one. Also see tensor_modify_update_treats_the_input_tensor_as_sparse().", "url": "https://github.com/vespa-engine/vespa/pull/11755#discussion_r365780222", "createdAt": "2020-01-13T12:33:57Z", "author": {"login": "geirst"}, "path": "document/src/main/java/com/yahoo/document/update/TensorModifyUpdate.java", "diffHunk": "@@ -29,8 +30,8 @@ public TensorModifyUpdate(Operation operation, TensorFieldValue tensor) {\n     }\n \n     private void verifyCompatibleType(TensorType type) {\n-        if (type.dimensions().stream().anyMatch(dim -> dim.isIndexed()) ) {\n-            throw new IllegalArgumentException(\"Tensor type '\" + type + \"' is not compatible as it contains some indexed dimensions\");\n+        if (type.rank() > 0 && type.dimensions().stream().noneMatch(dim -> dim.isMapped()) ) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a3ec97de26572acdbfe4b1801744061decb84d38"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTgwOTUxMg==", "bodyText": "Okay, let's convert in this layer for now #11766", "url": "https://github.com/vespa-engine/vespa/pull/11755#discussion_r365809512", "createdAt": "2020-01-13T13:42:51Z", "author": {"login": "bratseth"}, "path": "document/src/main/java/com/yahoo/document/update/TensorModifyUpdate.java", "diffHunk": "@@ -29,8 +30,8 @@ public TensorModifyUpdate(Operation operation, TensorFieldValue tensor) {\n     }\n \n     private void verifyCompatibleType(TensorType type) {\n-        if (type.dimensions().stream().anyMatch(dim -> dim.isIndexed()) ) {\n-            throw new IllegalArgumentException(\"Tensor type '\" + type + \"' is not compatible as it contains some indexed dimensions\");\n+        if (type.rank() > 0 && type.dimensions().stream().noneMatch(dim -> dim.isMapped()) ) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTc4MDIyMg=="}, "originalCommit": {"oid": "a3ec97de26572acdbfe4b1801744061decb84d38"}, "originalPosition": 14}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2629, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}