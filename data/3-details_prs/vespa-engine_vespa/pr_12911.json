{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAzMzA1Njkw", "number": 12911, "title": "Ensure that documentid is legal.", "bodyText": "@vekterli PR", "createdAt": "2020-04-14T17:02:24Z", "url": "https://github.com/vespa-engine/vespa/pull/12911", "merged": true, "mergeCommit": {"oid": "42e589a6d06acc7b302525eb71009e3a6eef3801"}, "closed": true, "closedAt": "2020-04-14T17:42:12Z", "author": {"login": "baldersheim"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcXmdTCAH2gAyNDAzMzA1NjkwOjkxMjVkMTY1MTc0MjQ4MWJkZDM1OWI3Mjg4YTE3MWM1N2U3YjZiNTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcX0HABgFqTM5MzUyNjA1MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9125d1651742481bdd359b7288a171c57e7b6b54", "author": {"user": {"login": "baldersheim", "name": "Henning Baldersheim"}}, "url": "https://github.com/vespa-engine/vespa/commit/9125d1651742481bdd359b7288a171c57e7b6b54", "committedDate": "2020-04-14T16:54:44Z", "message": "Ensure that documentid is legal."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzMTQwOTAw", "url": "https://github.com/vespa-engine/vespa/pull/12911#pullrequestreview-393140900", "createdAt": "2020-04-14T17:24:35Z", "commit": {"oid": "9125d1651742481bdd359b7288a171c57e7b6b54"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzNTI2MDUx", "url": "https://github.com/vespa-engine/vespa/pull/12911#pullrequestreview-393526051", "createdAt": "2020-04-15T07:38:21Z", "commit": {"oid": "9125d1651742481bdd359b7288a171c57e7b6b54"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwNzozODoyMVrOGFtdOw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwODo0Nzo1MFrOGFv7LA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODY0MDgyNw==", "bodyText": "s/Namspace/Namespace/", "url": "https://github.com/vespa-engine/vespa/pull/12911#discussion_r408640827", "createdAt": "2020-04-15T07:38:21Z", "author": {"login": "vekterli"}, "path": "document/src/test/java/com/yahoo/document/IdIdStringTest.java", "diffHunk": "@@ -59,6 +62,35 @@ public void requireThatKeysWithoutValuesThrow() throws Exception {\n             new IdIdString(\"namespace\", \"type\", \"illegal-pair\", \"foo\");\n             fail();\n         } catch (IllegalArgumentException e) {\n+            assertEquals(\"Illegal key-value pair 'illegal-pair'\", e.getMessage());\n+        }\n+    }\n+\n+    @Test\n+    public void requireThatTooLongPreNamspaceSpecificThrowsWhileParsing() throws Exception {\n+        StringBuilder builder = new StringBuilder(\"id:\");\n+        for (int i = 0; i < 0x10000; i++) {\n+            builder.append('n');\n+        }\n+        builder.append(\":type::namespacespecificpart_01\");\n+        try {\n+            IdString.createIdString(builder.toString());\n+            fail();\n+        } catch (IllegalArgumentException e) {\n+            assertEquals(\"Document id prior to the namespace specific part, 65545, is longer than 65534\", e.getMessage().substring(0, 77));\n+        }\n+    }\n+    @Test\n+    public void requireThatTooLongPreNamspaceSpecificThrowsOnConstruction() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9125d1651742481bdd359b7288a171c57e7b6b54"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODY0MDg1Ng==", "bodyText": "s/Namspace/Namespace/", "url": "https://github.com/vespa-engine/vespa/pull/12911#discussion_r408640856", "createdAt": "2020-04-15T07:38:25Z", "author": {"login": "vekterli"}, "path": "document/src/test/java/com/yahoo/document/IdIdStringTest.java", "diffHunk": "@@ -59,6 +62,35 @@ public void requireThatKeysWithoutValuesThrow() throws Exception {\n             new IdIdString(\"namespace\", \"type\", \"illegal-pair\", \"foo\");\n             fail();\n         } catch (IllegalArgumentException e) {\n+            assertEquals(\"Illegal key-value pair 'illegal-pair'\", e.getMessage());\n+        }\n+    }\n+\n+    @Test\n+    public void requireThatTooLongPreNamspaceSpecificThrowsWhileParsing() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9125d1651742481bdd359b7288a171c57e7b6b54"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODY0Nzk3MQ==", "bodyText": "I think a quick comment on the significance of the number 5 would be nice here", "url": "https://github.com/vespa-engine/vespa/pull/12911#discussion_r408647971", "createdAt": "2020-04-15T07:51:11Z", "author": {"login": "vekterli"}, "path": "document/src/main/java/com/yahoo/document/idstring/IdIdString.java", "diffHunk": "@@ -47,6 +47,10 @@ public IdIdString(String namespace, String type, String keyValues, String localI\n         super(Scheme.id, namespace, localId);\n         this.type = type;\n         boolean hasSetLocation = false;\n+        if (namespace.length() + type.length() + keyValues.length() + 5 >= IdString.MAX_LENGTH_EXCEPT_NAMESPACE_SPECIFIC) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9125d1651742481bdd359b7288a171c57e7b6b54"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODY4MTI2MA==", "bodyText": "0xffff - 1 due to actual offset being the next char after :, I presume? A tiny comment would be nice for future reference \ud83d\ude42", "url": "https://github.com/vespa-engine/vespa/pull/12911#discussion_r408681260", "createdAt": "2020-04-15T08:47:50Z", "author": {"login": "vekterli"}, "path": "document/src/main/java/com/yahoo/document/idstring/IdString.java", "diffHunk": "@@ -42,6 +42,7 @@ public String getGroup() {\n     private final String namespace;\n     private final String namespaceSpecific;\n     private Utf8String cache;\n+    static final int MAX_LENGTH_EXCEPT_NAMESPACE_SPECIFIC = 0xfffe;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9125d1651742481bdd359b7288a171c57e7b6b54"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3409, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}