{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIwNTMyOTEw", "number": 13315, "title": "change splunkd startup logic", "bodyText": "doing \"start\" then \"restart\" seems to trigger splunkd core dumps,\nso we will try \"stop\" + wait + \"start\" instead.\nlog logforwarder actions on info level to make it easier to\ntrack splunk activity.\n\nI confirm that this contribution is made under the terms of the license found in the root directory of this repository's source tree and that I have the authority necessary to make this contribution on behalf of its copyright owner.", "createdAt": "2020-05-20T06:20:19Z", "url": "https://github.com/vespa-engine/vespa/pull/13315", "merged": true, "mergeCommit": {"oid": "c2f0bf7951099883154696d9cc040383463ec676"}, "closed": true, "closedAt": "2020-05-29T06:06:51Z", "author": {"login": "arnej27959"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcjC7PggH2gAyNDIwNTMyOTEwOjJkNTg1NDJlODM2YzgwNWU4MDE2MmQwNDVkMzU4YTZlYWNmMTI5MzY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcjDE4sgFqTQxNTAyNjIxMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2d58542e836c805e80162d045d358a6eacf12936", "author": {"user": {"login": "arnej27959", "name": "Arne H Juul"}}, "url": "https://github.com/vespa-engine/vespa/commit/2d58542e836c805e80162d045d358a6eacf12936", "committedDate": "2020-05-20T06:17:57Z", "message": "change splunkd startup logic\n\n* doing \"start\" then \"restart\" seems to trigger splunkd core dumps,\n  so we will try \"stop\" + wait + \"start\" instead.\n* log logforwarder actions on info level to make it easier to\n  track splunk activity."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE1MDI2MDI0", "url": "https://github.com/vespa-engine/vespa/pull/13315#pullrequestreview-415026024", "createdAt": "2020-05-20T06:28:08Z", "commit": {"oid": "2d58542e836c805e80162d045d358a6eacf12936"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQwNjoyODowOFrOGX89Lg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQwNjoyODowOFrOGX89Lg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzc2OTEzNA==", "bodyText": "It looked from the logs like stopping splunkd would take roughly 15s. I don't know what happens if we don't wait for the previous instance to shut down, but it's probably OK, since we don't know otherwise by now.", "url": "https://github.com/vespa-engine/vespa/pull/13315#discussion_r427769134", "createdAt": "2020-05-20T06:28:08Z", "author": {"login": "jonmv"}, "path": "logforwarder/src/apps/vespa-logforwarder-start/child-handler.cpp", "diffHunk": "@@ -76,14 +76,15 @@ void\n ChildHandler::startChild(const vespalib::string &prefix)\n {\n     if (! _childRunning) {\n+        // it is possible that splunk was already running anyway, so\n+        // make sure we restart it to get new config activated:\n+        runSplunk(prefix, {\"stop\"});\n+        sleep(1);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d58542e836c805e80162d045d358a6eacf12936"}, "originalPosition": 33}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE1MDI2MjEy", "url": "https://github.com/vespa-engine/vespa/pull/13315#pullrequestreview-415026212", "createdAt": "2020-05-20T06:28:29Z", "commit": {"oid": "2d58542e836c805e80162d045d358a6eacf12936"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3159, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}