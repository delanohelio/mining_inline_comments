{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA4MDY1OTE2", "number": 15000, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxMTozNjo0OVrOEwuV1Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxMTozNjo0OVrOEwuV1Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE5NTI2MzU3OnYy", "diffSide": "RIGHT", "path": "node-repository/src/main/java/com/yahoo/vespa/hosted/provision/provisioning/NodeResourceLimits.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxMTozNjo0OVrOHmda3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxMTo0NjoxNlrOHmdvPQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDA4OTk0OQ==", "bodyText": "Will this code be exercised for currently provisioned hosts too, and that are using the old thin pool sizes?  How does that work?  AFAIK, only if we're currently enlarging (rounding up) the node resources will prepare  now instead require a larger disk, which may involve... migration I guess?", "url": "https://github.com/vespa-engine/vespa/pull/15000#discussion_r510089949", "createdAt": "2020-10-22T11:36:49Z", "author": {"login": "hakonhall"}, "path": "node-repository/src/main/java/com/yahoo/vespa/hosted/provision/provisioning/NodeResourceLimits.java", "diffHunk": "@@ -72,26 +72,27 @@ private double minAdvertisedMemoryGb(ClusterSpec.Type clusterType) {\n     }\n \n     private double minAdvertisedDiskGb(NodeResources requested) {\n-        if (requested.storageType() == NodeResources.StorageType.local && zone().getCloud().dynamicProvisioning()) {\n+        return minRealDiskGb() + getThinPoolSize(requested.storageType());\n+    }\n+\n+    // TODO: Calculate thin pool size instead of hardcoding\n+    private long getThinPoolSize(NodeResources.StorageType storageType) {\n+        if (storageType == NodeResources.StorageType.local && zone().getCloud().dynamicProvisioning()) {\n             if (zone().system() == SystemName.Public)\n-                return 10 + minRealDiskGb();\n+                return 12;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5f502286dc936755beea0efa1f48c04bf1943b8b"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDA5NTE2NQ==", "bodyText": "If someone specified less resources than what is now legal, their deployment will fail.\nIf someone specified resource range and they are nearly not utilizing anything, then they will be scaled to minimum - which is now increased, so they will be migrated. The rest should not be changed.", "url": "https://github.com/vespa-engine/vespa/pull/15000#discussion_r510095165", "createdAt": "2020-10-22T11:46:16Z", "author": {"login": "freva"}, "path": "node-repository/src/main/java/com/yahoo/vespa/hosted/provision/provisioning/NodeResourceLimits.java", "diffHunk": "@@ -72,26 +72,27 @@ private double minAdvertisedMemoryGb(ClusterSpec.Type clusterType) {\n     }\n \n     private double minAdvertisedDiskGb(NodeResources requested) {\n-        if (requested.storageType() == NodeResources.StorageType.local && zone().getCloud().dynamicProvisioning()) {\n+        return minRealDiskGb() + getThinPoolSize(requested.storageType());\n+    }\n+\n+    // TODO: Calculate thin pool size instead of hardcoding\n+    private long getThinPoolSize(NodeResources.StorageType storageType) {\n+        if (storageType == NodeResources.StorageType.local && zone().getCloud().dynamicProvisioning()) {\n             if (zone().system() == SystemName.Public)\n-                return 10 + minRealDiskGb();\n+                return 12;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDA4OTk0OQ=="}, "originalCommit": {"oid": "5f502286dc936755beea0efa1f48c04bf1943b8b"}, "originalPosition": 54}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1113, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}