{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk1MjE0NTMx", "number": 12752, "title": "Set warmup duration based on zone", "bodyText": "No warmup time necessary in cd or test environments. Set\ndefault warmup time to 89 seconds, as the previous value of 60\nseconds (which ended up being ~90 seconds) was the wanted one based\non experience with prod applications.\nMerge needs to be coordinated with change in internal repo, please review only.", "createdAt": "2020-03-29T07:57:37Z", "url": "https://github.com/vespa-engine/vespa/pull/12752", "merged": true, "mergeCommit": {"oid": "49bbb07870e221e6c38b2b7955985c5f3f5518ed"}, "closed": true, "closedAt": "2020-03-29T10:40:01Z", "author": {"login": "hmusum"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcSVJGgAH2gAyMzk1MjE0NTMxOmQwZTM2ZjgzMjlkYWJhMDk0ZTkwOGMxOTQ5ZGRkZDdlN2RlOTQxZTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcSXC6ZgFqTM4MzM5MzYyMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d0e36f8329daba094e908c1949dddd7e7de941e8", "author": {"user": {"login": "hmusum", "name": "Harald Musum"}}, "url": "https://github.com/vespa-engine/vespa/commit/d0e36f8329daba094e908c1949dddd7e7de941e8", "committedDate": "2020-03-29T07:54:40Z", "message": "Set warmup duration based on zone\n\nNo warmup time necessary in cd or test environments. Set\ndefault warmup time to 89 seconds, as the previous value of 60\nseconds (which ended up being ~90 seconds) was the wanted one based\non experience with prod applications."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzMzg3NjIy", "url": "https://github.com/vespa-engine/vespa/pull/12752#pullrequestreview-383387622", "createdAt": "2020-03-29T08:50:11Z", "commit": {"oid": "d0e36f8329daba094e908c1949dddd7e7de941e8"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yOVQwODo1MDoxMVrOF9P0ww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yOVQwODo1ODoyNFrOF9P4Iw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTc2NjcyMw==", "bodyText": "Any reason this shouldn't apply to PublicCd?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    return zone.getSystemName() == SystemName.cd || zone.getEnvironment().isTest()\n          \n          \n            \n                    return zone.getSystemName().isCd() || zone.getEnvironment().isTest()", "url": "https://github.com/vespa-engine/vespa/pull/12752#discussion_r399766723", "createdAt": "2020-03-29T08:50:11Z", "author": {"login": "freva"}, "path": "node-admin/src/main/java/com/yahoo/vespa/hosted/node/admin/nodeagent/NodeAgentImpl.java", "diffHunk": "@@ -605,4 +606,10 @@ public void createSymlink(Path symlink, Path target) {\n     protected Optional<CredentialsMaintainer> credentialsMaintainer() {\n         return credentialsMaintainer;\n     }\n+\n+    private static Duration warmUpDurationForZone(ZoneApi zone) {\n+        return zone.getSystemName() == SystemName.cd || zone.getEnvironment().isTest()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d0e36f8329daba094e908c1949dddd7e7de941e8"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTc2NzEwNQ==", "bodyText": "Duration of zero still starts the container unconstrained, but then immediately attempts to suspend against orch. to set limits. Negative will start the container with the constraints \n  \n    \n      vespa/node-admin/src/main/java/com/yahoo/vespa/hosted/node/admin/nodeagent/NodeAgentImpl.java\n    \n    \n         Line 215\n      in\n      44e2be1\n    \n    \n    \n    \n\n        \n          \n           ContainerResources wantedResources = context.nodeType() != NodeType.tenant || warmUpDuration.isNegative() ? \n        \n    \n  \n\n\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            ? Duration.ZERO\n          \n          \n            \n                            ? Duration.ofSeconds(-1)", "url": "https://github.com/vespa-engine/vespa/pull/12752#discussion_r399767105", "createdAt": "2020-03-29T08:53:40Z", "author": {"login": "freva"}, "path": "node-admin/src/main/java/com/yahoo/vespa/hosted/node/admin/nodeagent/NodeAgentImpl.java", "diffHunk": "@@ -605,4 +606,10 @@ public void createSymlink(Path symlink, Path target) {\n     protected Optional<CredentialsMaintainer> credentialsMaintainer() {\n         return credentialsMaintainer;\n     }\n+\n+    private static Duration warmUpDurationForZone(ZoneApi zone) {\n+        return zone.getSystemName() == SystemName.cd || zone.getEnvironment().isTest()\n+                ? Duration.ZERO", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d0e36f8329daba094e908c1949dddd7e7de941e8"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTc2NzU4Nw==", "bodyText": "Consider just resolving this when needed via the ZoneApi in NodeAgentContext", "url": "https://github.com/vespa-engine/vespa/pull/12752#discussion_r399767587", "createdAt": "2020-03-29T08:58:24Z", "author": {"login": "freva"}, "path": "node-admin/src/main/java/com/yahoo/vespa/hosted/node/admin/nodeagent/NodeAgentImpl.java", "diffHunk": "@@ -102,9 +103,9 @@\n     public NodeAgentImpl(NodeAgentContextSupplier contextSupplier, NodeRepository nodeRepository,\n                          Orchestrator orchestrator, DockerOperations dockerOperations, StorageMaintainer storageMaintainer,\n                          FlagSource flagSource, Optional<CredentialsMaintainer> credentialsMaintainer,\n-                         Optional<AclMaintainer> aclMaintainer, Optional<HealthChecker> healthChecker, Clock clock) {\n+                         Optional<AclMaintainer> aclMaintainer, Optional<HealthChecker> healthChecker, Clock clock, ZoneApi zone) {\n         this(contextSupplier, nodeRepository, orchestrator, dockerOperations, storageMaintainer, flagSource, credentialsMaintainer,\n-                aclMaintainer, healthChecker, clock, DEFAULT_WARM_UP_DURATION);\n+             aclMaintainer, healthChecker, clock, warmUpDurationForZone(zone));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d0e36f8329daba094e908c1949dddd7e7de941e8"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "efc586ec3d49146b5c8ed44f9805556637db2378", "author": {"user": {"login": "hmusum", "name": "Harald Musum"}}, "url": "https://github.com/vespa-engine/vespa/commit/efc586ec3d49146b5c8ed44f9805556637db2378", "committedDate": "2020-03-29T09:18:05Z", "message": "Update node-admin/src/main/java/com/yahoo/vespa/hosted/node/admin/nodeagent/NodeAgentImpl.java\n\nCo-Authored-By: Valerij Fredriksen <freva@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "965e3af747afaa4c4c0521d92b25cc155320d80b", "author": {"user": {"login": "hmusum", "name": "Harald Musum"}}, "url": "https://github.com/vespa-engine/vespa/commit/965e3af747afaa4c4c0521d92b25cc155320d80b", "committedDate": "2020-03-29T09:18:14Z", "message": "Update node-admin/src/main/java/com/yahoo/vespa/hosted/node/admin/nodeagent/NodeAgentImpl.java\n\nCo-Authored-By: Valerij Fredriksen <freva@users.noreply.github.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzMzkwMjA3", "url": "https://github.com/vespa-engine/vespa/pull/12752#pullrequestreview-383390207", "createdAt": "2020-03-29T09:24:31Z", "commit": {"oid": "965e3af747afaa4c4c0521d92b25cc155320d80b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9109a39de0048098fc45ecf3910ac9eaaa87459b", "author": {"user": {"login": "hmusum", "name": "Harald Musum"}}, "url": "https://github.com/vespa-engine/vespa/commit/9109a39de0048098fc45ecf3910ac9eaaa87459b", "committedDate": "2020-03-29T10:03:42Z", "message": "Use zone from context and resolve warmup time in method instead"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzMzkzNjIw", "url": "https://github.com/vespa-engine/vespa/pull/12752#pullrequestreview-383393620", "createdAt": "2020-03-29T10:07:43Z", "commit": {"oid": "9109a39de0048098fc45ecf3910ac9eaaa87459b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2537, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}