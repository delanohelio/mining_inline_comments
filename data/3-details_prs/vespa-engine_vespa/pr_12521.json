{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg1ODEwNjYz", "number": 12521, "title": "Bratseth/deprovisioned node state", "bodyText": "", "createdAt": "2020-03-09T20:46:38Z", "url": "https://github.com/vespa-engine/vespa/pull/12521", "merged": true, "mergeCommit": {"oid": "ddd5141d112d44f881da17e83d26ac18ad35c3c1"}, "closed": true, "closedAt": "2020-03-10T07:58:33Z", "author": {"login": "bratseth"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcL8YLrAH2gAyMzg1ODEwNjYzOjJjYTBlM2JlMjQyMzMyZWU2NjI3NzAwMWRhMzVjMjc4ZjJiZjNhNGY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcMPmQSAFqTM3MTgxNjE4NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2ca0e3be242332ee66277001da35c278f2bf3a4f", "author": {"user": {"login": "vespa-headless", "name": null}}, "url": "https://github.com/vespa-engine/vespa/commit/2ca0e3be242332ee66277001da35c278f2bf3a4f", "committedDate": "2020-03-09T11:39:58Z", "message": "Simplify, no functional changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5d86852c1f81f6e71aeaf3d6ccd3665e94b2e918", "author": {"user": {"login": "vespa-headless", "name": null}}, "url": "https://github.com/vespa-engine/vespa/commit/5d86852c1f81f6e71aeaf3d6ccd3665e94b2e918", "committedDate": "2020-03-09T12:43:26Z", "message": "Simplify, no functional changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aa1758edef6a1bfaa06dc7c88b888dc9ea0061b9", "author": {"user": {"login": "vespa-headless", "name": null}}, "url": "https://github.com/vespa-engine/vespa/commit/aa1758edef6a1bfaa06dc7c88b888dc9ea0061b9", "committedDate": "2020-03-09T13:48:40Z", "message": "Add deprovisioned state"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4753b5cadf9bcf74ad9cef6de2273f495d47c47f", "author": {"user": {"login": "vespa-headless", "name": null}}, "url": "https://github.com/vespa-engine/vespa/commit/4753b5cadf9bcf74ad9cef6de2273f495d47c47f", "committedDate": "2020-03-09T15:06:56Z", "message": "Recycle deprovisioned nodes on provision"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fcedbb36c7caea42e9ab9f6816fdcd28d71aeae9", "author": {"user": {"login": "vespa-headless", "name": null}}, "url": "https://github.com/vespa-engine/vespa/commit/fcedbb36c7caea42e9ab9f6816fdcd28d71aeae9", "committedDate": "2020-03-09T20:26:02Z", "message": "Remove hosts on aws"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2e8dfe4a5c8bc571262ae4b92feb31cebddc7c5b", "author": {"user": {"login": "vespa-headless", "name": null}}, "url": "https://github.com/vespa-engine/vespa/commit/2e8dfe4a5c8bc571262ae4b92feb31cebddc7c5b", "committedDate": "2020-03-09T21:17:00Z", "message": "Don't change method name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4cf0f9f70c0d7c640f079f0cd1d055e37f4e8fb1", "author": {"user": {"login": "vespa-headless", "name": null}}, "url": "https://github.com/vespa-engine/vespa/commit/4cf0f9f70c0d7c640f079f0cd1d055e37f4e8fb1", "committedDate": "2020-03-10T06:20:32Z", "message": "Add deprivisioned state"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxNzI5NzM4", "url": "https://github.com/vespa-engine/vespa/pull/12521#pullrequestreview-371729738", "createdAt": "2020-03-10T07:39:54Z", "commit": {"oid": "fcedbb36c7caea42e9ab9f6816fdcd28d71aeae9"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQwNzozOTo1NFrOF0D_WA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQwNzo0ODowM1rOF0EK3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDEzNTY0MA==", "bodyText": "Looks like we have this in several places now. We should find a way to model it properly soon.", "url": "https://github.com/vespa-engine/vespa/pull/12521#discussion_r390135640", "createdAt": "2020-03-10T07:39:54Z", "author": {"login": "mpolden"}, "path": "node-repository/src/main/java/com/yahoo/vespa/hosted/provision/NodeRepository.java", "diffHunk": "@@ -608,8 +608,11 @@ public Node markNodeAvailableForNewAllocation(String hostname, Agent agent, Stri\n                 List<Node> children = list().childrenOf(node).asList();\n                 children.forEach(child -> requireRemovable(child, true, force));\n                 db.removeNodes(children);\n-                move(node, State.deprovisioned, Agent.system, Optional.empty());\n                 List<Node> removed = new ArrayList<>(children);\n+                if (zone.cloud().value().equals(\"aws\"))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fcedbb36c7caea42e9ab9f6816fdcd28d71aeae9"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDEzNzY1NA==", "bodyText": "Should also be added to com.yahoo.vespa.hosted.controller.api.integration.noderepository.NodeState.", "url": "https://github.com/vespa-engine/vespa/pull/12521#discussion_r390137654", "createdAt": "2020-03-10T07:45:21Z", "author": {"login": "mpolden"}, "path": "node-admin/src/main/java/com/yahoo/vespa/hosted/node/admin/configserver/noderepository/NodeState.java", "diffHunk": "@@ -9,5 +9,5 @@\n  * @author freva\n  */\n public enum NodeState {\n-    provisioned, ready, reserved, active, inactive, dirty, failed, parked\n+    provisioned, ready, reserved, active, inactive, dirty, failed, parked, deprovisioned", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4cf0f9f70c0d7c640f079f0cd1d055e37f4e8fb1"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDEzODU4OA==", "bodyText": "Why not?", "url": "https://github.com/vespa-engine/vespa/pull/12521#discussion_r390138588", "createdAt": "2020-03-10T07:48:03Z", "author": {"login": "mpolden"}, "path": "config-provisioning/src/main/java/com/yahoo/config/provision/NodeType.java", "diffHunk": "@@ -45,7 +45,7 @@\n         this.description = description;\n     }\n \n-    public boolean isHost() {\n+    public boolean isDockerHost() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2e8dfe4a5c8bc571262ae4b92feb31cebddc7c5b"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5f488cb8afc8ea85cbdd5d5ba327caa376d1dc1b", "author": {"user": {"login": "vespa-headless", "name": null}}, "url": "https://github.com/vespa-engine/vespa/commit/5f488cb8afc8ea85cbdd5d5ba327caa376d1dc1b", "committedDate": "2020-03-10T07:56:32Z", "message": "Add deprovisioned state"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxNzM3NzA1", "url": "https://github.com/vespa-engine/vespa/pull/12521#pullrequestreview-371737705", "createdAt": "2020-03-10T07:57:57Z", "commit": {"oid": "5f488cb8afc8ea85cbdd5d5ba327caa376d1dc1b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxODE2MTg1", "url": "https://github.com/vespa-engine/vespa/pull/12521#pullrequestreview-371816185", "createdAt": "2020-03-10T10:03:31Z", "commit": {"oid": "5f488cb8afc8ea85cbdd5d5ba327caa376d1dc1b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQxMDowMzozMlrOF0ITQg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQxMDowMzozMlrOF0ITQg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDIwNjI3NA==", "bodyText": "Add to \n  \n    \n      vespa/controller-api/src/main/java/com/yahoo/vespa/hosted/controller/api/integration/noderepository/NodeHistory.java\n    \n    \n         Line 35\n      in\n      ddd5141\n    \n    \n    \n    \n\n        \n          \n           public enum Agent {", "url": "https://github.com/vespa-engine/vespa/pull/12521#discussion_r390206274", "createdAt": "2020-03-10T10:03:32Z", "author": {"login": "freva"}, "path": "node-repository/src/main/java/com/yahoo/vespa/hosted/provision/node/Agent.java", "diffHunk": "@@ -17,5 +17,6 @@\n     FailedExpirer,\n     InactiveExpirer,\n     ProvisionedExpirer,\n-    ReservationExpirer\n+    ReservationExpirer,\n+    DynamicProvisioningMaintainer", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5f488cb8afc8ea85cbdd5d5ba327caa376d1dc1b"}, "originalPosition": 22}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2641, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}