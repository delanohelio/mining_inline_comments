{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU5OTUxNDI1", "number": 11672, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QxMjo1Mjo0NVrODWPUHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QxMzowNjo0N1rODWPhlA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI0NjQ2MTcyOnYy", "diffSide": "RIGHT", "path": "vespa-http-client/src/test/java/com/yahoo/vespa/http/client/core/operationProcessor/OperationProcessorTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QxMjo1Mjo0NVrOFa4hnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QxMzoyMzozOVrOFa5ORQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzczMzQwNQ==", "bodyText": "Consider extending test name with what the expected behavior is, e.g. unknownHostThrowsExceptionAtConstructionTime", "url": "https://github.com/vespa-engine/vespa/pull/11672#discussion_r363733405", "createdAt": "2020-01-07T12:52:45Z", "author": {"login": "vekterli"}, "path": "vespa-http-client/src/test/java/com/yahoo/vespa/http/client/core/operationProcessor/OperationProcessorTest.java", "diffHunk": "@@ -410,4 +412,18 @@ public void testSendsResponseToQueuedDocumentOnClose() throws InterruptedExcepti\n         operationProcessor.close();\n         countDownLatch.await();\n     }\n+\n+    @Test\n+    public void testUnknownHost() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b0d801daed411fa114223a5e6f0663b595334de5"}, "originalPosition": 158}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzc0NDgzNw==", "bodyText": "Done", "url": "https://github.com/vespa-engine/vespa/pull/11672#discussion_r363744837", "createdAt": "2020-01-07T13:23:39Z", "author": {"login": "bratseth"}, "path": "vespa-http-client/src/test/java/com/yahoo/vespa/http/client/core/operationProcessor/OperationProcessorTest.java", "diffHunk": "@@ -410,4 +412,18 @@ public void testSendsResponseToQueuedDocumentOnClose() throws InterruptedExcepti\n         operationProcessor.close();\n         countDownLatch.await();\n     }\n+\n+    @Test\n+    public void testUnknownHost() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzczMzQwNQ=="}, "originalCommit": {"oid": "b0d801daed411fa114223a5e6f0663b595334de5"}, "originalPosition": 158}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI0NjQ3NDg3OnYy", "diffSide": "RIGHT", "path": "vespa-http-client/src/test/java/com/yahoo/vespa/http/client/core/operationProcessor/OperationProcessorTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QxMjo1Nzo1N1rOFa4pDQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QxMzoyMzo1NlrOFa5Ouw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzczNTMwOQ==", "bodyText": "Consider using a reserved TLD to minimize the chance that someone has a valid host mapping for \"unknown\", e.g. something like \"unknown.invalid\" (RFC6761)", "url": "https://github.com/vespa-engine/vespa/pull/11672#discussion_r363735309", "createdAt": "2020-01-07T12:57:57Z", "author": {"login": "vekterli"}, "path": "vespa-http-client/src/test/java/com/yahoo/vespa/http/client/core/operationProcessor/OperationProcessorTest.java", "diffHunk": "@@ -410,4 +412,18 @@ public void testSendsResponseToQueuedDocumentOnClose() throws InterruptedExcepti\n         operationProcessor.close();\n         countDownLatch.await();\n     }\n+\n+    @Test\n+    public void testUnknownHost() {\n+        try {\n+            new SessionParams.Builder()\n+                    .addCluster(new Cluster.Builder().addEndpoint(Endpoint.create(\"localhost\")).build())\n+                    .addCluster(new Cluster.Builder().addEndpoint(Endpoint.create(\"unknown\")).build())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b0d801daed411fa114223a5e6f0663b595334de5"}, "originalPosition": 162}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzc0NDk1NQ==", "bodyText": "Good one, done", "url": "https://github.com/vespa-engine/vespa/pull/11672#discussion_r363744955", "createdAt": "2020-01-07T13:23:56Z", "author": {"login": "bratseth"}, "path": "vespa-http-client/src/test/java/com/yahoo/vespa/http/client/core/operationProcessor/OperationProcessorTest.java", "diffHunk": "@@ -410,4 +412,18 @@ public void testSendsResponseToQueuedDocumentOnClose() throws InterruptedExcepti\n         operationProcessor.close();\n         countDownLatch.await();\n     }\n+\n+    @Test\n+    public void testUnknownHost() {\n+        try {\n+            new SessionParams.Builder()\n+                    .addCluster(new Cluster.Builder().addEndpoint(Endpoint.create(\"localhost\")).build())\n+                    .addCluster(new Cluster.Builder().addEndpoint(Endpoint.create(\"unknown\")).build())", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzczNTMwOQ=="}, "originalCommit": {"oid": "b0d801daed411fa114223a5e6f0663b595334de5"}, "originalPosition": 162}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI0NjQ4MzU5OnYy", "diffSide": "RIGHT", "path": "vespa-http-client/src/test/java/com/yahoo/vespa/http/client/core/operationProcessor/OperationProcessorTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QxMzowMToxOFrOFa4t2g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QxMzoyNDowNlrOFa5O-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzczNjUzOA==", "bodyText": "Based on the code, shouldn't this be \"Unknown host: unknown\"?", "url": "https://github.com/vespa-engine/vespa/pull/11672#discussion_r363736538", "createdAt": "2020-01-07T13:01:18Z", "author": {"login": "vekterli"}, "path": "vespa-http-client/src/test/java/com/yahoo/vespa/http/client/core/operationProcessor/OperationProcessorTest.java", "diffHunk": "@@ -410,4 +412,18 @@ public void testSendsResponseToQueuedDocumentOnClose() throws InterruptedExcepti\n         operationProcessor.close();\n         countDownLatch.await();\n     }\n+\n+    @Test\n+    public void testUnknownHost() {\n+        try {\n+            new SessionParams.Builder()\n+                    .addCluster(new Cluster.Builder().addEndpoint(Endpoint.create(\"localhost\")).build())\n+                    .addCluster(new Cluster.Builder().addEndpoint(Endpoint.create(\"unknown\")).build())\n+                    .build();\n+        }\n+        catch (IllegalArgumentException e) {\n+            assertEquals(\"\", e.getMessage());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b0d801daed411fa114223a5e6f0663b595334de5"}, "originalPosition": 166}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzc0NTAxNw==", "bodyText": "Yes, fixed.", "url": "https://github.com/vespa-engine/vespa/pull/11672#discussion_r363745017", "createdAt": "2020-01-07T13:24:06Z", "author": {"login": "bratseth"}, "path": "vespa-http-client/src/test/java/com/yahoo/vespa/http/client/core/operationProcessor/OperationProcessorTest.java", "diffHunk": "@@ -410,4 +412,18 @@ public void testSendsResponseToQueuedDocumentOnClose() throws InterruptedExcepti\n         operationProcessor.close();\n         countDownLatch.await();\n     }\n+\n+    @Test\n+    public void testUnknownHost() {\n+        try {\n+            new SessionParams.Builder()\n+                    .addCluster(new Cluster.Builder().addEndpoint(Endpoint.create(\"localhost\")).build())\n+                    .addCluster(new Cluster.Builder().addEndpoint(Endpoint.create(\"unknown\")).build())\n+                    .build();\n+        }\n+        catch (IllegalArgumentException e) {\n+            assertEquals(\"\", e.getMessage());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzczNjUzOA=="}, "originalCommit": {"oid": "b0d801daed411fa114223a5e6f0663b595334de5"}, "originalPosition": 166}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI0NjQ4NjA0OnYy", "diffSide": "RIGHT", "path": "vespa-http-client/src/test/java/com/yahoo/vespa/http/client/core/operationProcessor/OperationProcessorTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QxMzowMjoyMlrOFa4vVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QxMzoyNToxMVrOFa5Qaw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzczNjkxNg==", "bodyText": "Consider using an exception expectation as part of the test declaration instead of an explicit catch. This test will currently succeed if the code doesn't throw as well.", "url": "https://github.com/vespa-engine/vespa/pull/11672#discussion_r363736916", "createdAt": "2020-01-07T13:02:22Z", "author": {"login": "vekterli"}, "path": "vespa-http-client/src/test/java/com/yahoo/vespa/http/client/core/operationProcessor/OperationProcessorTest.java", "diffHunk": "@@ -410,4 +412,18 @@ public void testSendsResponseToQueuedDocumentOnClose() throws InterruptedExcepti\n         operationProcessor.close();\n         countDownLatch.await();\n     }\n+\n+    @Test\n+    public void testUnknownHost() {\n+        try {\n+            new SessionParams.Builder()\n+                    .addCluster(new Cluster.Builder().addEndpoint(Endpoint.create(\"localhost\")).build())\n+                    .addCluster(new Cluster.Builder().addEndpoint(Endpoint.create(\"unknown\")).build())\n+                    .build();\n+        }\n+        catch (IllegalArgumentException e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b0d801daed411fa114223a5e6f0663b595334de5"}, "originalPosition": 165}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzc0NTM4Nw==", "bodyText": "But I want to assert on the error message.", "url": "https://github.com/vespa-engine/vespa/pull/11672#discussion_r363745387", "createdAt": "2020-01-07T13:25:11Z", "author": {"login": "bratseth"}, "path": "vespa-http-client/src/test/java/com/yahoo/vespa/http/client/core/operationProcessor/OperationProcessorTest.java", "diffHunk": "@@ -410,4 +412,18 @@ public void testSendsResponseToQueuedDocumentOnClose() throws InterruptedExcepti\n         operationProcessor.close();\n         countDownLatch.await();\n     }\n+\n+    @Test\n+    public void testUnknownHost() {\n+        try {\n+            new SessionParams.Builder()\n+                    .addCluster(new Cluster.Builder().addEndpoint(Endpoint.create(\"localhost\")).build())\n+                    .addCluster(new Cluster.Builder().addEndpoint(Endpoint.create(\"unknown\")).build())\n+                    .build();\n+        }\n+        catch (IllegalArgumentException e) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzczNjkxNg=="}, "originalCommit": {"oid": "b0d801daed411fa114223a5e6f0663b595334de5"}, "originalPosition": 165}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI0NjQ5NjIwOnYy", "diffSide": "RIGHT", "path": "vespa-http-client/src/main/java/com/yahoo/vespa/http/client/core/communication/ApacheGatewayConnection.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QxMzowNjo0N1rOFa41VQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QxMzoyNjoxMVrOFa5SCA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzczODQ1Mw==", "bodyText": "Consider making static", "url": "https://github.com/vespa-engine/vespa/pull/11672#discussion_r363738453", "createdAt": "2020-01-07T13:06:47Z", "author": {"login": "vekterli"}, "path": "vespa-http-client/src/main/java/com/yahoo/vespa/http/client/core/communication/ApacheGatewayConnection.java", "diffHunk": "@@ -90,8 +92,17 @@\n             endOfFeed = END_OF_FEED_XML;\n         }\n         this.clientId = clientId;\n-        if (this.clientId == null) {\n-            throw new RuntimeException(\"Got no client Id.\");\n+        if (this.clientId == null)\n+            throw new IllegalArgumentException(\"Got no client Id.\");\n+    }\n+\n+    private Endpoint validate(Endpoint endpoint) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b0d801daed411fa114223a5e6f0663b595334de5"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzc0NTgwMA==", "bodyText": "Done", "url": "https://github.com/vespa-engine/vespa/pull/11672#discussion_r363745800", "createdAt": "2020-01-07T13:26:11Z", "author": {"login": "bratseth"}, "path": "vespa-http-client/src/main/java/com/yahoo/vespa/http/client/core/communication/ApacheGatewayConnection.java", "diffHunk": "@@ -90,8 +92,17 @@\n             endOfFeed = END_OF_FEED_XML;\n         }\n         this.clientId = clientId;\n-        if (this.clientId == null) {\n-            throw new RuntimeException(\"Got no client Id.\");\n+        if (this.clientId == null)\n+            throw new IllegalArgumentException(\"Got no client Id.\");\n+    }\n+\n+    private Endpoint validate(Endpoint endpoint) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzczODQ1Mw=="}, "originalCommit": {"oid": "b0d801daed411fa114223a5e6f0663b595334de5"}, "originalPosition": 28}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2691, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}