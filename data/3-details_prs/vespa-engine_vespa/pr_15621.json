{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMxMjg5OTYw", "number": 15621, "title": "Allocate once with the correct size", "bodyText": "@havardpe PR", "createdAt": "2020-12-02T21:07:01Z", "url": "https://github.com/vespa-engine/vespa/pull/15621", "merged": true, "mergeCommit": {"oid": "1648fae933dbd040117759d7dff3e28c318543d0"}, "closed": true, "closedAt": "2020-12-03T10:13:45Z", "author": {"login": "baldersheim"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdiVGpyAH2gAyNTMxMjg5OTYwOjAyOGM3ZjM4ZmZlODUzMjdiODVhNWZlMDUwNTExYTViZWNmNzI1ODg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdiguAAAFqTU0MzgxNzIwNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "028c7f38ffe85327b85a5fe050511a5becf72588", "author": {"user": {"login": "baldersheim", "name": "Henning Baldersheim"}}, "url": "https://github.com/vespa-engine/vespa/commit/028c7f38ffe85327b85a5fe050511a5becf72588", "committedDate": "2020-12-02T21:05:56Z", "message": "Allocate once with the correct size"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fc8b150ba0b7ed457eecee6d81ae4347f6756120", "author": {"user": {"login": "baldersheim", "name": "Henning Baldersheim"}}, "url": "https://github.com/vespa-engine/vespa/commit/fc8b150ba0b7ed457eecee6d81ae4347f6756120", "committedDate": "2020-12-02T21:27:49Z", "message": "Be explicit wether size is give or not"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQzNzc0NjQ3", "url": "https://github.com/vespa-engine/vespa/pull/15621#pullrequestreview-543774647", "createdAt": "2020-12-03T09:46:17Z", "commit": {"oid": "fc8b150ba0b7ed457eecee6d81ae4347f6756120"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQzODE3MjA1", "url": "https://github.com/vespa-engine/vespa/pull/15621#pullrequestreview-543817205", "createdAt": "2020-12-03T10:34:23Z", "commit": {"oid": "fc8b150ba0b7ed457eecee6d81ae4347f6756120"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxMDozNDoyM1rOH-Sbvw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxMDozNDoyM1rOH-Sbvw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTA3NTc3NQ==", "bodyText": "would it not be better to round up the memory used to (close to) a power of 2, instead of the number of entries?", "url": "https://github.com/vespa-engine/vespa/pull/15621#discussion_r535075775", "createdAt": "2020-12-03T10:34:23Z", "author": {"login": "havardpe"}, "path": "vespalib/src/vespa/vespalib/stllike/hashtable.hpp", "diffHunk": "@@ -6,6 +6,28 @@\n \n namespace vespalib {\n \n+namespace {\n+\n+/// TODO Currently we require that you have atleast one element in _nodes to avoid one extra branch\n+/// However that means that empty unused hashtables are larger than necessary.\n+/// This we should probably reconsider.\n+template<typename Modulator>\n+uint32_t\n+computeModulo(size_t size) {\n+    return (size > 0) ? Modulator::selectHashTableSize(roundUp2inN(size) / 3) : 1;\n+}\n+\n+template <typename NodeStore>\n+NodeStore\n+createStore(size_t size, uint32_t modulo) {\n+    size = (size > 0) ? roundUp2inN(std::max(size_t(modulo), roundUp2inN(size))) : 1;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fc8b150ba0b7ed457eecee6d81ae4347f6756120"}, "originalPosition": 18}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1851, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}