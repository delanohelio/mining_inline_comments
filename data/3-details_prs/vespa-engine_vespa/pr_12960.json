{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA0OTk4MjQ1", "number": 12960, "title": "Reduce initial maintainer delay in controller", "bodyText": "@mpolden please review and merge.", "createdAt": "2020-04-17T08:34:17Z", "url": "https://github.com/vespa-engine/vespa/pull/12960", "merged": true, "mergeCommit": {"oid": "3d477471159147bd5c79e11756ef0617d833993d"}, "closed": true, "closedAt": "2020-04-17T21:05:38Z", "author": {"login": "jonmv"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcYdF9KgH2gAyNDA0OTk4MjQ1OjA4ZjUxMmIxYzkzMTdjZDA5ZTYyMWNhZDM0NDZlOTdkNmZmNzliZmI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcYmz-vAFqTM5NTczMjY3Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "08f512b1c9317cd09e621cad3446e97d6ff79bfb", "author": {"user": {"login": "jonmv", "name": "Jon Marius Venstad"}}, "url": "https://github.com/vespa-engine/vespa/commit/08f512b1c9317cd09e621cad3446e97d6ff79bfb", "committedDate": "2020-04-17T08:34:01Z", "message": "Reduce initial maintainer delay in controller"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1MjY4Mjk0", "url": "https://github.com/vespa-engine/vespa/pull/12960#pullrequestreview-395268294", "createdAt": "2020-04-17T08:40:53Z", "commit": {"oid": "08f512b1c9317cd09e621cad3446e97d6ff79bfb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QwODo0MDo1M1rOGHFNew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QwODo0MDo1M1rOGHFNew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDA3ODU4Nw==", "bodyText": "Should be changed in com.yahoo.vespa.hosted.provision.maintenance.Maintainer too.", "url": "https://github.com/vespa-engine/vespa/pull/12960#discussion_r410078587", "createdAt": "2020-04-17T08:40:53Z", "author": {"login": "mpolden"}, "path": "controller-server/src/main/java/com/yahoo/vespa/hosted/controller/maintenance/Maintainer.java", "diffHunk": "@@ -116,7 +116,7 @@ static long staggeredDelay(List<HostName> cluster, HostName host, Instant now, D\n \n         long offset = cluster.indexOf(host) * interval.toMillis() / cluster.size();\n         long timeUntilNextRun = Math.floorMod(offset - now.toEpochMilli(), interval.toMillis());\n-        return timeUntilNextRun + interval.toMillis() / cluster.size();\n+        return timeUntilNextRun;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "08f512b1c9317cd09e621cad3446e97d6ff79bfb"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3a6fbf844732dd41ad2fc2ef6b597a281808868d", "author": {"user": {"login": "jonmv", "name": "Jon Marius Venstad"}}, "url": "https://github.com/vespa-engine/vespa/commit/3a6fbf844732dd41ad2fc2ef6b597a281808868d", "committedDate": "2020-04-17T09:15:22Z", "message": "Reduce initial delay of config server maintainers too"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5644d4216c1ca3c2ec48a666db915ca02dd21259", "author": {"user": {"login": "jonmv", "name": "Jon Marius Venstad"}}, "url": "https://github.com/vespa-engine/vespa/commit/5644d4216c1ca3c2ec48a666db915ca02dd21259", "committedDate": "2020-04-17T09:16:35Z", "message": "Used named threads in maintainers"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1b536d61af0be52103fdb83e0fb6f2b6947b57c7", "author": {"user": {"login": "jonmv", "name": "Jon Marius Venstad"}}, "url": "https://github.com/vespa-engine/vespa/commit/1b536d61af0be52103fdb83e0fb6f2b6947b57c7", "committedDate": "2020-04-17T10:38:04Z", "message": "Inline variables"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "564ea2ed446154746bfb23a29aa8f1a414de3c9b", "author": {"user": {"login": "jonmv", "name": "Jon Marius Venstad"}}, "url": "https://github.com/vespa-engine/vespa/commit/564ea2ed446154746bfb23a29aa8f1a414de3c9b", "committedDate": "2020-04-17T10:38:33Z", "message": "Expand ContactInformationMaintainer unit test to verify exception handling"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cf3a25d6906c976fbe12b4eb686c916a383e3bd6", "author": {"user": {"login": "jonmv", "name": "Jon Marius Venstad"}}, "url": "https://github.com/vespa-engine/vespa/commit/cf3a25d6906c976fbe12b4eb686c916a383e3bd6", "committedDate": "2020-04-17T10:49:33Z", "message": "Log process during contact information updates"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b98bf882f2d90808349d0ae482c5694aa08e3b2c", "author": {"user": {"login": "jonmv", "name": "Jon Marius Venstad"}}, "url": "https://github.com/vespa-engine/vespa/commit/b98bf882f2d90808349d0ae482c5694aa08e3b2c", "committedDate": "2020-04-17T12:16:16Z", "message": "break, not return, from switch statement"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1NDA1MTEw", "url": "https://github.com/vespa-engine/vespa/pull/12960#pullrequestreview-395405110", "createdAt": "2020-04-17T12:21:30Z", "commit": {"oid": "b98bf882f2d90808349d0ae482c5694aa08e3b2c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1NDA0NjU1", "url": "https://github.com/vespa-engine/vespa/pull/12960#pullrequestreview-395404655", "createdAt": "2020-04-17T12:20:48Z", "commit": {"oid": "5644d4216c1ca3c2ec48a666db915ca02dd21259"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QxMjoyMDo0OFrOGHLurA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QxMjoyMjowNFrOGHLxAA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDE4NTM4OA==", "bodyText": "Use name() in case maintainer has specified a custom one.", "url": "https://github.com/vespa-engine/vespa/pull/12960#discussion_r410185388", "createdAt": "2020-04-17T12:20:48Z", "author": {"login": "mpolden"}, "path": "controller-server/src/main/java/com/yahoo/vespa/hosted/controller/maintenance/Maintainer.java", "diffHunk": "@@ -52,7 +52,7 @@ public Maintainer(Controller controller, Duration interval, JobControl jobContro\n         this.name = name;\n         this.activeSystems = Set.copyOf(activeSystems);\n \n-        service = new ScheduledThreadPoolExecutor(1);\n+        service = new ScheduledThreadPoolExecutor(1, r -> new Thread(r, getClass().getSimpleName() + \"-worker\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5644d4216c1ca3c2ec48a666db915ca02dd21259"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDE4NTk4NA==", "bodyText": "\ud83d\ude01", "url": "https://github.com/vespa-engine/vespa/pull/12960#discussion_r410185984", "createdAt": "2020-04-17T12:22:04Z", "author": {"login": "mpolden"}, "path": "controller-server/src/main/java/com/yahoo/vespa/hosted/controller/maintenance/ContactInformationMaintainer.java", "diffHunk": "@@ -48,9 +48,9 @@ protected void maintain() {\n                                           (Optional.of(contact).equals(tenant.contact()) ? \"un\" : \"\") + \"changed\");\n                             tenants.store(lockedTenant.with(contact));\n                         });\n-                        return;\n+                        break;\n                     case cloud:\n-                        return;\n+                        break;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b98bf882f2d90808349d0ae482c5694aa08e3b2c"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1NzEzNjQ1", "url": "https://github.com/vespa-engine/vespa/pull/12960#pullrequestreview-395713645", "createdAt": "2020-04-17T19:21:07Z", "commit": {"oid": "b98bf882f2d90808349d0ae482c5694aa08e3b2c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QxOToyMTowN1rOGHaRQw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QxOToyMTowN1rOGHaRQw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQyMzYxOQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    service = new ScheduledThreadPoolExecutor(1, r -> new Thread(r, getClass().getSimpleName() + \"-worker\"));\n          \n          \n            \n                    service = new ScheduledThreadPoolExecutor(1, r -> new Thread(r, name() + \"-worker\"));", "url": "https://github.com/vespa-engine/vespa/pull/12960#discussion_r410423619", "createdAt": "2020-04-17T19:21:07Z", "author": {"login": "jonmv"}, "path": "node-repository/src/main/java/com/yahoo/vespa/hosted/provision/maintenance/Maintainer.java", "diffHunk": "@@ -42,7 +42,7 @@ public Maintainer(NodeRepository nodeRepository, Duration interval) {\n \n         HostName hostname = HostName.from(com.yahoo.net.HostName.getLocalhost());\n         long delay = staggeredDelay(nodeRepository.database().cluster(), hostname, nodeRepository.clock().instant(), interval);\n-        service = new ScheduledThreadPoolExecutor(1);\n+        service = new ScheduledThreadPoolExecutor(1, r -> new Thread(r, getClass().getSimpleName() + \"-worker\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b98bf882f2d90808349d0ae482c5694aa08e3b2c"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c16e37ada9df0cca4e686ee546442e02a3cd1ed9", "author": {"user": {"login": "jonmv", "name": "Jon Marius Venstad"}}, "url": "https://github.com/vespa-engine/vespa/commit/c16e37ada9df0cca4e686ee546442e02a3cd1ed9", "committedDate": "2020-04-17T19:21:47Z", "message": "Apply suggestions from code review"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1NzMyNjc3", "url": "https://github.com/vespa-engine/vespa/pull/12960#pullrequestreview-395732677", "createdAt": "2020-04-17T19:53:26Z", "commit": {"oid": "c16e37ada9df0cca4e686ee546442e02a3cd1ed9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3330, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}