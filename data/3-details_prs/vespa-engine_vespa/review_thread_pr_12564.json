{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg4MDEyMzQ0", "number": 12564, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQwODoxNToxOVrODoOdwg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxMDowOTozNVrODoQzGA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzNTA2NjI2OnYy", "diffSide": "RIGHT", "path": "vespaclient-container-plugin/src/main/java/com/yahoo/vespa/http/server/FeedHandlerV3.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQwODoxNToxOVrOF2pYBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQwODozNDo1NFrOF2p7ZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjg0NTMxNg==", "bodyText": "Minor: I would have used Duration and Instant for these two", "url": "https://github.com/vespa-engine/vespa/pull/12564#discussion_r392845316", "createdAt": "2020-03-16T08:15:19Z", "author": {"login": "hmusum"}, "path": "vespaclient-container-plugin/src/main/java/com/yahoo/vespa/http/server/FeedHandlerV3.java", "diffHunk": "@@ -43,6 +43,9 @@\n     protected final ReplyHandler feedReplyHandler;\n     private final Metric metric;\n     private final Object monitor = new Object();\n+    private int remainingThreadsForFeedingAllowance;\n+    private final long msBetweenBumpingMaxThreads;\n+    private long nextTimeToAllocateAnotherThread;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c52421478d1e47db32ec8ff8c482f861fd93b93"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjg1NDM3Mg==", "bodyText": "Thanks, now I will use that for time in java from now on.", "url": "https://github.com/vespa-engine/vespa/pull/12564#discussion_r392854372", "createdAt": "2020-03-16T08:34:54Z", "author": {"login": "baldersheim"}, "path": "vespaclient-container-plugin/src/main/java/com/yahoo/vespa/http/server/FeedHandlerV3.java", "diffHunk": "@@ -43,6 +43,9 @@\n     protected final ReplyHandler feedReplyHandler;\n     private final Metric metric;\n     private final Object monitor = new Object();\n+    private int remainingThreadsForFeedingAllowance;\n+    private final long msBetweenBumpingMaxThreads;\n+    private long nextTimeToAllocateAnotherThread;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjg0NTMxNg=="}, "originalCommit": {"oid": "2c52421478d1e47db32ec8ff8c482f861fd93b93"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzNTQ0NDg1OnYy", "diffSide": "RIGHT", "path": "vespaclient-container-plugin/src/main/java/com/yahoo/vespa/http/server/FeedHandlerV3.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxMDowODozNFrOF2s_1Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxMDowODozNFrOF2s_1Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjkwNDY2MQ==", "bodyText": "Why are these member variables not protected by a monitor?", "url": "https://github.com/vespa-engine/vespa/pull/12564#discussion_r392904661", "createdAt": "2020-03-16T10:08:34Z", "author": {"login": "bjorncs"}, "path": "vespaclient-container-plugin/src/main/java/com/yahoo/vespa/http/server/FeedHandlerV3.java", "diffHunk": "@@ -43,6 +43,9 @@\n     protected final ReplyHandler feedReplyHandler;\n     private final Metric metric;\n     private final Object monitor = new Object();\n+    private int remainingThreadsForFeedingAllowance;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c52421478d1e47db32ec8ff8c482f861fd93b93"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzNTQ0ODU2OnYy", "diffSide": "RIGHT", "path": "vespaclient-container-plugin/src/main/java/com/yahoo/vespa/http/server/FeedHandlerV3.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxMDowOTozNVrOF2tCHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQxMDowOTozNVrOF2tCHA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjkwNTI0NA==", "bodyText": "Consider using Duration.ZERO as sentinel value instead.", "url": "https://github.com/vespa-engine/vespa/pull/12564#discussion_r392905244", "createdAt": "2020-03-16T10:09:35Z", "author": {"login": "bjorncs"}, "path": "vespaclient-container-plugin/src/main/java/com/yahoo/vespa/http/server/FeedHandlerV3.java", "diffHunk": "@@ -66,17 +68,17 @@ public FeedHandlerV3(LoggingRequestHandler.Context parentCtx,\n             remainingThreadsForFeedingAllowance = Math.max((int) (0.4 * threadpoolConfig.maxthreads()), 1);\n             if (threadpoolConfig.softStartSeconds() > 0.0) {\n                 threadsAvailableForFeeding = new AtomicInteger(0);\n-                msBetweenBumpingMaxThreads = (long)threadpoolConfig.softStartSeconds() * 1000 / remainingThreadsForFeedingAllowance;\n+                timeBetweenBumpingMaxThreads = Duration.ofMillis((long)(threadpoolConfig.softStartSeconds() * 1000) / remainingThreadsForFeedingAllowance);\n             } else {\n                 threadsAvailableForFeeding = new AtomicInteger(remainingThreadsForFeedingAllowance);\n                 remainingThreadsForFeedingAllowance = 0;\n-                msBetweenBumpingMaxThreads = 0;\n+                timeBetweenBumpingMaxThreads = null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "49c6107c09e539e575f71c2f2b8a148780c28ff8"}, "originalPosition": 30}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2262, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}