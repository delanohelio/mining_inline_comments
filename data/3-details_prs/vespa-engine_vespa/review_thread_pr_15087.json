{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEyMjA3ODEw", "number": 15087, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwODoyODozMVrOE0RmAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwODozNDoyOFrOE0Rtgw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMjQ5NjY3OnYy", "diffSide": "RIGHT", "path": "configserver/src/main/java/com/yahoo/vespa/config/server/application/ConfigConvergenceChecker.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwODoyODozMVrOHr6WEA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwODoyODozMVrOHr6WEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTgwNjczNg==", "bodyText": "Consider renaming to getServiceConfigGenerationsResponse", "url": "https://github.com/vespa-engine/vespa/pull/15087#discussion_r515806736", "createdAt": "2020-11-02T08:28:31Z", "author": {"login": "bjorncs"}, "path": "configserver/src/main/java/com/yahoo/vespa/config/server/application/ConfigConvergenceChecker.java", "diffHunk": "@@ -70,26 +70,30 @@ public ConfigConvergenceChecker(StateApiFactory stateApiFactory) {\n         this.stateApiFactory = stateApiFactory;\n     }\n \n-    /** Check all services in given application. Returns the minimum current generation of all services */\n-    public ServiceListResponse servicesToCheck(Application application, URI requestUrl, Duration timeoutPerService) {\n-        log.log(Level.FINE, () -> \"Finding services to check config convergence for in '\" + application);\n+    /** Fetches the active config generation for all services in the given application. */\n+    public Map<ServiceInfo, Long> getServiceConfigGenerations(Application application, Duration timeoutPerService) {\n         List<ServiceInfo> servicesToCheck = new ArrayList<>();\n         application.getModel().getHosts()\n                    .forEach(host -> host.getServices().stream()\n                                         .filter(service -> serviceTypesToCheck.contains(service.getServiceType()))\n                                         .forEach(service -> getStatePort(service).ifPresent(port -> servicesToCheck.add(service))));\n \n-        Map<ServiceInfo, Long> currentGenerations = getServiceGenerations(servicesToCheck, timeoutPerService);\n+        return getServiceGenerations(servicesToCheck, timeoutPerService);\n+    }\n+\n+    /** Check all services in given application. Returns the minimum current generation of all services */\n+    public ServiceListResponse getServiceConfigGenerationsJson(Application application, URI requestUrl, Duration timeoutPerService) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "41a7f812d0393194c89ade76a30f406f80a7f18f"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMjUxNTg3OnYy", "diffSide": "RIGHT", "path": "configserver/src/main/java/com/yahoo/vespa/config/server/application/ReindexingStatus.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwODozNDoyOFrOHr6hdA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQwODo0MzowNFrOHr6zyg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTgwOTY1Mg==", "bodyText": "What is the reason for not copying the second parameter?", "url": "https://github.com/vespa-engine/vespa/pull/15087#discussion_r515809652", "createdAt": "2020-11-02T08:34:28Z", "author": {"login": "bjorncs"}, "path": "configserver/src/main/java/com/yahoo/vespa/config/server/application/ReindexingStatus.java", "diffHunk": "@@ -0,0 +1,132 @@\n+// Copyright Verizon Media. Licensed under the terms of the Apache 2.0 license. See LICENSE in the project root.\n+package com.yahoo.vespa.config.server.application;\n+\n+import com.yahoo.config.model.api.Reindexing;\n+\n+import java.time.Instant;\n+import java.util.Map;\n+import java.util.Objects;\n+import java.util.stream.Stream;\n+\n+import static java.util.stream.Collectors.toUnmodifiableMap;\n+\n+/**\n+ * Pending and ready reindexing per document type. Each document type can have either a pending or a ready reindexing.\n+ * This is immutable.\n+ *\n+ * @author jonmv\n+ */\n+public class ReindexingStatus implements Reindexing {\n+\n+    private static final ReindexingStatus empty = new ReindexingStatus(Map.of(), Map.of());\n+\n+    private final Map<String, Long> pending;\n+    private final Map<String, Status> ready;\n+\n+    ReindexingStatus(Map<String, Long> pending, Map<String, Status> ready) {\n+        this.pending = Map.copyOf(pending);\n+        this.ready = ready;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d41673879f667dc06ea326fe14ad8f6520ff981b"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTgxNDM0Ng==", "bodyText": "Silly author, most likely >_<", "url": "https://github.com/vespa-engine/vespa/pull/15087#discussion_r515814346", "createdAt": "2020-11-02T08:43:04Z", "author": {"login": "jonmv"}, "path": "configserver/src/main/java/com/yahoo/vespa/config/server/application/ReindexingStatus.java", "diffHunk": "@@ -0,0 +1,132 @@\n+// Copyright Verizon Media. Licensed under the terms of the Apache 2.0 license. See LICENSE in the project root.\n+package com.yahoo.vespa.config.server.application;\n+\n+import com.yahoo.config.model.api.Reindexing;\n+\n+import java.time.Instant;\n+import java.util.Map;\n+import java.util.Objects;\n+import java.util.stream.Stream;\n+\n+import static java.util.stream.Collectors.toUnmodifiableMap;\n+\n+/**\n+ * Pending and ready reindexing per document type. Each document type can have either a pending or a ready reindexing.\n+ * This is immutable.\n+ *\n+ * @author jonmv\n+ */\n+public class ReindexingStatus implements Reindexing {\n+\n+    private static final ReindexingStatus empty = new ReindexingStatus(Map.of(), Map.of());\n+\n+    private final Map<String, Long> pending;\n+    private final Map<String, Status> ready;\n+\n+    ReindexingStatus(Map<String, Long> pending, Map<String, Status> ready) {\n+        this.pending = Map.copyOf(pending);\n+        this.ready = ready;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTgwOTY1Mg=="}, "originalCommit": {"oid": "d41673879f667dc06ea326fe14ad8f6520ff981b"}, "originalPosition": 28}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1054, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}