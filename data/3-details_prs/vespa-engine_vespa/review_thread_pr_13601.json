{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM1MTAwMzQx", "number": 13601, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxMzozMDoyN1rOEF8Dmw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNDowMjoyOFrOEF9Azw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc0NjYyMjk5OnYy", "diffSide": "RIGHT", "path": "document/src/main/java/com/yahoo/document/Document.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxMzozMDoyN1rOGkbYbA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwNToyMDoxNFrOGlf9Bg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDg1MDU0MA==", "bodyText": "Is there a risk that someone might call this today (despite being deprecated) and effectively expect an empty Struct instead of null?", "url": "https://github.com/vespa-engine/vespa/pull/13601#discussion_r440850540", "createdAt": "2020-06-16T13:30:27Z", "author": {"login": "vekterli"}, "path": "document/src/main/java/com/yahoo/document/Document.java", "diffHunk": "@@ -104,7 +102,7 @@ private void internalSetId(DocumentId id, DocumentType docType) {\n \n     /** @deprecated do not use: Use getField(), getFieldValue() or iterator() instead */\n     @Deprecated // TODO: Remove on Vespa 8\n-    public Struct getBody() { return body; }\n+    public Struct getBody() { return null; }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fcf38c0586e6166ed819a078355502bda4656d01"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTk3NDAyMg==", "bodyText": "There is no known usages.", "url": "https://github.com/vespa-engine/vespa/pull/13601#discussion_r441974022", "createdAt": "2020-06-18T05:20:14Z", "author": {"login": "baldersheim"}, "path": "document/src/main/java/com/yahoo/document/Document.java", "diffHunk": "@@ -104,7 +102,7 @@ private void internalSetId(DocumentId id, DocumentType docType) {\n \n     /** @deprecated do not use: Use getField(), getFieldValue() or iterator() instead */\n     @Deprecated // TODO: Remove on Vespa 8\n-    public Struct getBody() { return body; }\n+    public Struct getBody() { return null; }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDg1MDU0MA=="}, "originalCommit": {"oid": "fcf38c0586e6166ed819a078355502bda4656d01"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc0NjY1MzgxOnYy", "diffSide": "RIGHT", "path": "document/src/main/java/com/yahoo/document/Document.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxMzozNzoxN1rOGkbsHQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwNToyMDozM1rOGlf9XQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDg1NTU4MQ==", "bodyText": "Can this entire iterator facade be removed now?", "url": "https://github.com/vespa-engine/vespa/pull/13601#discussion_r440855581", "createdAt": "2020-06-16T13:37:17Z", "author": {"login": "vekterli"}, "path": "document/src/main/java/com/yahoo/document/Document.java", "diffHunk": "@@ -193,66 +185,40 @@ public Field getField(String fieldName) {\n \n     @Override\n     public FieldValue getFieldValue(Field field) {\n-        FieldValue fv = header.getFieldValue(field);\n-        if (fv == null) {\n-            fv = body.getFieldValue(field);\n-        }\n-        return fv;\n+        return header.getFieldValue(field);\n     }\n \n     @Override\n-    @SuppressWarnings(\"deprecation\")\n     protected void doSetFieldValue(Field field, FieldValue value) {\n-        if (field.isHeader()) {\n-            header.setFieldValue(field, value);\n-        } else {\n-            body.setFieldValue(field, value);\n-        }\n+        header.setFieldValue(field, value);\n     }\n \n     @Override\n     public FieldValue removeFieldValue(Field field) {\n-        FieldValue removed = header.removeFieldValue(field);\n-        if (removed == null) {\n-            removed = body.removeFieldValue(field);\n-        }\n-        return removed;\n+        return header.removeFieldValue(field);\n     }\n \n     @Override\n     public void clear() {\n         header.clear();\n-        body.clear();\n     }\n \n     @Override\n     public Iterator<Map.Entry<Field, FieldValue>> iterator() {\n         return new Iterator<>() {\n \n             private Iterator<Map.Entry<Field, FieldValue>> headerIt = header.iterator();\n-            private Iterator<Map.Entry<Field, FieldValue>> bodyIt = body.iterator();\n \n             public boolean hasNext() {\n-                if (headerIt != null) {\n-                    if (headerIt.hasNext()) {\n-                        return true;\n-                    } else {\n-                        headerIt = null;\n-                    }\n-                }\n-                return bodyIt.hasNext();\n+                return headerIt.hasNext();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fcf38c0586e6166ed819a078355502bda4656d01"}, "originalPosition": 105}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTk3NDEwOQ==", "bodyText": "Yes", "url": "https://github.com/vespa-engine/vespa/pull/13601#discussion_r441974109", "createdAt": "2020-06-18T05:20:33Z", "author": {"login": "baldersheim"}, "path": "document/src/main/java/com/yahoo/document/Document.java", "diffHunk": "@@ -193,66 +185,40 @@ public Field getField(String fieldName) {\n \n     @Override\n     public FieldValue getFieldValue(Field field) {\n-        FieldValue fv = header.getFieldValue(field);\n-        if (fv == null) {\n-            fv = body.getFieldValue(field);\n-        }\n-        return fv;\n+        return header.getFieldValue(field);\n     }\n \n     @Override\n-    @SuppressWarnings(\"deprecation\")\n     protected void doSetFieldValue(Field field, FieldValue value) {\n-        if (field.isHeader()) {\n-            header.setFieldValue(field, value);\n-        } else {\n-            body.setFieldValue(field, value);\n-        }\n+        header.setFieldValue(field, value);\n     }\n \n     @Override\n     public FieldValue removeFieldValue(Field field) {\n-        FieldValue removed = header.removeFieldValue(field);\n-        if (removed == null) {\n-            removed = body.removeFieldValue(field);\n-        }\n-        return removed;\n+        return header.removeFieldValue(field);\n     }\n \n     @Override\n     public void clear() {\n         header.clear();\n-        body.clear();\n     }\n \n     @Override\n     public Iterator<Map.Entry<Field, FieldValue>> iterator() {\n         return new Iterator<>() {\n \n             private Iterator<Map.Entry<Field, FieldValue>> headerIt = header.iterator();\n-            private Iterator<Map.Entry<Field, FieldValue>> bodyIt = body.iterator();\n \n             public boolean hasNext() {\n-                if (headerIt != null) {\n-                    if (headerIt.hasNext()) {\n-                        return true;\n-                    } else {\n-                        headerIt = null;\n-                    }\n-                }\n-                return bodyIt.hasNext();\n+                return headerIt.hasNext();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDg1NTU4MQ=="}, "originalCommit": {"oid": "fcf38c0586e6166ed819a078355502bda4656d01"}, "originalPosition": 105}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc0NjY3MDI0OnYy", "diffSide": "RIGHT", "path": "document/src/main/java/com/yahoo/document/DocumentType.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxMzo0MDo0N1rOGkb2QA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwNTowMjozN1rOGlfr-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDg1ODE3Ng==", "bodyText": "Same question as getBody wrt. existing callers expecting something here. If there might be, maybe we should have a dummy empty sentinel struct type that gets returned?", "url": "https://github.com/vespa-engine/vespa/pull/13601#discussion_r440858176", "createdAt": "2020-06-16T13:40:47Z", "author": {"login": "vekterli"}, "path": "document/src/main/java/com/yahoo/document/DocumentType.java", "diffHunk": "@@ -139,11 +147,10 @@ public StructDataType getHeaderType() {\n     @Deprecated // TODO: Remove on Vespa 8\n     /** @deprecated use contentStruct instead */\n     public StructDataType getBodyType() {\n-        return bodyType;\n+        return null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fcf38c0586e6166ed819a078355502bda4656d01"}, "originalPosition": 80}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTk2OTY1Ng==", "bodyText": "These has been deprecated for a long time, so I think not. But I actually think it is better to just remove it. There is currently no usage of it.", "url": "https://github.com/vespa-engine/vespa/pull/13601#discussion_r441969656", "createdAt": "2020-06-18T05:02:37Z", "author": {"login": "baldersheim"}, "path": "document/src/main/java/com/yahoo/document/DocumentType.java", "diffHunk": "@@ -139,11 +147,10 @@ public StructDataType getHeaderType() {\n     @Deprecated // TODO: Remove on Vespa 8\n     /** @deprecated use contentStruct instead */\n     public StructDataType getBodyType() {\n-        return bodyType;\n+        return null;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDg1ODE3Ng=="}, "originalCommit": {"oid": "fcf38c0586e6166ed819a078355502bda4656d01"}, "originalPosition": 80}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc0NjY3OTYxOnYy", "diffSide": "RIGHT", "path": "document/src/main/java/com/yahoo/document/DocumentType.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxMzo0Mjo0OFrOGkb8Lg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwNToxMjoyM1rOGlf0_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDg1OTY5NA==", "bodyText": "Can this iterator facade be removed too?", "url": "https://github.com/vespa-engine/vespa/pull/13601#discussion_r440859694", "createdAt": "2020-06-16T13:42:48Z", "author": {"login": "vekterli"}, "path": "document/src/main/java/com/yahoo/document/DocumentType.java", "diffHunk": "@@ -485,26 +475,19 @@ public Field removeField(String name) {\n     public Iterator<Field> fieldIteratorThisTypeOnly() {\n         return new Iterator<>() {\n             Iterator<Field> headerIt = headerType.getFields().iterator();\n-            Iterator<Field> bodyIt = bodyType.getFields().iterator();\n \n             public boolean hasNext() {\n-                if (headerIt != null) {\n-                    if (headerIt.hasNext()) return true;\n-                    headerIt = null;\n-                }\n-                return bodyIt.hasNext();\n+                return headerIt.hasNext();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fcf38c0586e6166ed819a078355502bda4656d01"}, "originalPosition": 189}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTk3MTk2NA==", "bodyText": "Yes, it can.", "url": "https://github.com/vespa-engine/vespa/pull/13601#discussion_r441971964", "createdAt": "2020-06-18T05:12:23Z", "author": {"login": "baldersheim"}, "path": "document/src/main/java/com/yahoo/document/DocumentType.java", "diffHunk": "@@ -485,26 +475,19 @@ public Field removeField(String name) {\n     public Iterator<Field> fieldIteratorThisTypeOnly() {\n         return new Iterator<>() {\n             Iterator<Field> headerIt = headerType.getFields().iterator();\n-            Iterator<Field> bodyIt = bodyType.getFields().iterator();\n \n             public boolean hasNext() {\n-                if (headerIt != null) {\n-                    if (headerIt.hasNext()) return true;\n-                    headerIt = null;\n-                }\n-                return bodyIt.hasNext();\n+                return headerIt.hasNext();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDg1OTY5NA=="}, "originalCommit": {"oid": "fcf38c0586e6166ed819a078355502bda4656d01"}, "originalPosition": 189}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc0Njc3OTY3OnYy", "diffSide": "RIGHT", "path": "document/src/tests/data/crossplatform-java-cpp-document.cfg", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNDowMjoyOFrOGkc65Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQwNToyMjoxMFrOGlf--w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDg3NTc0OQ==", "bodyText": "Should this be 15 instead of 11?", "url": "https://github.com/vespa-engine/vespa/pull/13601#discussion_r440875749", "createdAt": "2020-06-16T14:02:28Z", "author": {"login": "vekterli"}, "path": "document/src/tests/data/crossplatform-java-cpp-document.cfg", "diffHunk": "@@ -63,7 +62,7 @@ datatype[7].weightedsettype[0]\n datatype[7].structtype[1]\n datatype[7].structtype[0].name serializetest.header\n datatype[7].structtype[0].version 0\n-datatype[7].structtype[0].field[4]\n+datatype[7].structtype[0].field[11]", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fcf38c0586e6166ed819a078355502bda4656d01"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTk3NDUyMw==", "bodyText": "Correct.", "url": "https://github.com/vespa-engine/vespa/pull/13601#discussion_r441974523", "createdAt": "2020-06-18T05:22:10Z", "author": {"login": "baldersheim"}, "path": "document/src/tests/data/crossplatform-java-cpp-document.cfg", "diffHunk": "@@ -63,7 +62,7 @@ datatype[7].weightedsettype[0]\n datatype[7].structtype[1]\n datatype[7].structtype[0].name serializetest.header\n datatype[7].structtype[0].version 0\n-datatype[7].structtype[0].field[4]\n+datatype[7].structtype[0].field[11]", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDg3NTc0OQ=="}, "originalCommit": {"oid": "fcf38c0586e6166ed819a078355502bda4656d01"}, "originalPosition": 28}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1952, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}