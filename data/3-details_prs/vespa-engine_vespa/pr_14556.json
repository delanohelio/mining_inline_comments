{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkyOTgzNjg2", "number": 14556, "title": "Internal restart on internal deployments", "bodyText": "", "createdAt": "2020-09-25T10:33:04Z", "url": "https://github.com/vespa-engine/vespa/pull/14556", "merged": true, "mergeCommit": {"oid": "058e37f658cf010c5bcf8da31d503845a8f5d7e5"}, "closed": true, "closedAt": "2020-09-25T11:15:24Z", "author": {"login": "freva"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdMRtUogH2gAyNDkyOTgzNjg2OjlmZTUzZGMxNmVhZjcxMTI0YmViZjE2YWEyODNhNGVlMzc2MjVlODY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdMTwuygFqTQ5NjMyMTk3NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9fe53dc16eaf71124bebf16aa283a4ee37625e86", "author": {"user": {"login": "freva", "name": "Valerij Fredriksen"}}, "url": "https://github.com/vespa-engine/vespa/commit/9fe53dc16eaf71124bebf16aa283a4ee37625e86", "committedDate": "2020-09-25T08:42:13Z", "message": "Allow creating Deployment with PrepareParams"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4fb114d59b873a66ac5ea4d4e9693f7540d9e275", "author": {"user": {"login": "freva", "name": "Valerij Fredriksen"}}, "url": "https://github.com/vespa-engine/vespa/commit/4fb114d59b873a66ac5ea4d4e9693f7540d9e275", "committedDate": "2020-09-25T09:06:59Z", "message": "Use deployment to prepare"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f55fed1e7da7b4ed4f4d35cb7359ec9d1ac5a6a2", "author": {"user": {"login": "freva", "name": "Valerij Fredriksen"}}, "url": "https://github.com/vespa-engine/vespa/commit/f55fed1e7da7b4ed4f4d35cb7359ec9d1ac5a6a2", "committedDate": "2020-09-25T10:30:35Z", "message": "Remove unused argument"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1e3f05536e75344d4e5444b656ca5904387a4041", "author": {"user": {"login": "freva", "name": "Valerij Fredriksen"}}, "url": "https://github.com/vespa-engine/vespa/commit/1e3f05536e75344d4e5444b656ca5904387a4041", "committedDate": "2020-09-25T10:30:35Z", "message": "Move internal restart to Deployment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "22accc554d2cbe3e07dc21a4e9af375468b95118", "author": {"user": {"login": "freva", "name": "Valerij Fredriksen"}}, "url": "https://github.com/vespa-engine/vespa/commit/22accc554d2cbe3e07dc21a4e9af375468b95118", "committedDate": "2020-09-25T10:30:35Z", "message": "Use same Deployment across prepare & activate"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "27c498346fcf15c999f5c93ddf8e9e36e055a2b8", "author": {"user": {"login": "freva", "name": "Valerij Fredriksen"}}, "url": "https://github.com/vespa-engine/vespa/commit/27c498346fcf15c999f5c93ddf8e9e36e055a2b8", "committedDate": "2020-09-25T10:30:35Z", "message": "Deploy with internal restart if flag is set in zone"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk2MzA1MTE4", "url": "https://github.com/vespa-engine/vespa/pull/14556#pullrequestreview-496305118", "createdAt": "2020-09-25T10:37:02Z", "commit": {"oid": "27c498346fcf15c999f5c93ddf8e9e36e055a2b8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQxMDozNzowMlrOHX-WjQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQxMDozNzowMlrOHX-WjQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDkwMDg3Nw==", "bodyText": "Without ZONE_ID here since the flag will be set on the configserver for internal deployments. For external deployments the flag still must be set on the controller. That could be changed, but would need to re-create PrepareParams.\nI think we can remove internalRestart parameter and this flag in a week or so anyway and just always do internal restarts if the provisioner is set?", "url": "https://github.com/vespa-engine/vespa/pull/14556#discussion_r494900877", "createdAt": "2020-09-25T10:37:02Z", "author": {"login": "freva"}, "path": "configserver/src/main/java/com/yahoo/vespa/config/server/ApplicationRepository.java", "diffHunk": "@@ -395,9 +382,10 @@ public PrepareResult deploy(File applicationPackage, PrepareParams prepareParams\n         SessionRepository sessionRepository = tenant.getSessionRepository();\n         LocalSession newSession = sessionRepository.createSessionFromExisting(activeSession, logger, true, timeoutBudget);\n         sessionRepository.addLocalSession(newSession);\n+        boolean internalRestart = deployWithInternalRestart.with(FetchVector.Dimension.APPLICATION_ID, application.serializedForm()).value();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "27c498346fcf15c999f5c93ddf8e9e36e055a2b8"}, "originalPosition": 113}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk2MzIxOTc1", "url": "https://github.com/vespa-engine/vespa/pull/14556#pullrequestreview-496321975", "createdAt": "2020-09-25T11:05:45Z", "commit": {"oid": "27c498346fcf15c999f5c93ddf8e9e36e055a2b8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4221, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}