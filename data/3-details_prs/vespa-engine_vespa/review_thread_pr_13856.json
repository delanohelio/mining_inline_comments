{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ2ODk0MzQ5", "number": 13856, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxNDo0NToxN1rOEM7Wpg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxNDo0NToxN1rOEM7Wpg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxOTkwODIyOnYy", "diffSide": "RIGHT", "path": "searchlib/src/vespa/searchlib/docstore/logdatastore.cpp", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxNDo0NToxN1rOGvUfTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQxNzoxNjozNVrOGvahow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjI3MTk0OA==", "bodyText": "Consider a strategy to avoid having to call getDiskBloat() again here, e.g. return std::pair<bool, size_t> or just a size_t from a renamed isTotalDiskBloatExceeded().", "url": "https://github.com/vespa-engine/vespa/pull/13856#discussion_r452271948", "createdAt": "2020-07-09T14:45:17Z", "author": {"login": "toregge"}, "path": "searchlib/src/vespa/searchlib/docstore/logdatastore.cpp", "diffHunk": "@@ -313,16 +313,23 @@ LogDataStore::compact(uint64_t syncToken)\n     }\n }\n \n+bool\n+LogDataStore::isTotalDiskBloatExceeded() const {\n+    const size_t diskFootPrint = getDiskFootprint();\n+    const size_t maxConfiguredDiskBloat = diskFootPrint * _config.getMaxDiskBloatFactor();\n+    return getDiskBloat() > maxConfiguredDiskBloat;\n+}\n+\n size_t\n LogDataStore::getMaxCompactGain() const\n {\n+    size_t bloat = 0;\n+    if ( isTotalDiskBloatExceeded() ) {\n+        bloat = getDiskBloat();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a59af1171472ef0f9f58ec20996f21deb7e7b9f2"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjM3MDg1MQ==", "bodyText": "Done, in addition to avoid deadlock.", "url": "https://github.com/vespa-engine/vespa/pull/13856#discussion_r452370851", "createdAt": "2020-07-09T17:16:35Z", "author": {"login": "baldersheim"}, "path": "searchlib/src/vespa/searchlib/docstore/logdatastore.cpp", "diffHunk": "@@ -313,16 +313,23 @@ LogDataStore::compact(uint64_t syncToken)\n     }\n }\n \n+bool\n+LogDataStore::isTotalDiskBloatExceeded() const {\n+    const size_t diskFootPrint = getDiskFootprint();\n+    const size_t maxConfiguredDiskBloat = diskFootPrint * _config.getMaxDiskBloatFactor();\n+    return getDiskBloat() > maxConfiguredDiskBloat;\n+}\n+\n size_t\n LogDataStore::getMaxCompactGain() const\n {\n+    size_t bloat = 0;\n+    if ( isTotalDiskBloatExceeded() ) {\n+        bloat = getDiskBloat();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjI3MTk0OA=="}, "originalCommit": {"oid": "a59af1171472ef0f9f58ec20996f21deb7e7b9f2"}, "originalPosition": 16}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1867, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}