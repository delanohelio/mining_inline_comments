{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA4MDY1OTE2", "number": 15000, "title": "Update with new thin pool sizes", "bodyText": "Needs to be merged with changes in internal repo", "createdAt": "2020-10-22T06:59:44Z", "url": "https://github.com/vespa-engine/vespa/pull/15000", "merged": true, "mergeCommit": {"oid": "3ed6e4c013e6b6a6290d52dd75b15c67d0299f6d"}, "closed": true, "closedAt": "2020-10-22T11:36:50Z", "author": {"login": "hmusum"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdU8XSwAH2gAyNTA4MDY1OTE2OjAyMWQwMjQ3NjA4OGIyNjIyODU4MzA3ZWFlNDliYzViMDA0OWU5ZmY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdVAY4GgFqTUxNDYzMDAyMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "021d02476088b2622858307eae49bc5b0049e9ff", "author": {"user": {"login": "hmusum", "name": "Harald Musum"}}, "url": "https://github.com/vespa-engine/vespa/commit/021d02476088b2622858307eae49bc5b0049e9ff", "committedDate": "2020-10-22T06:55:28Z", "message": "Remove unused argument"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a03b65e377d94ab09e7682a51858a39205bb8360", "author": {"user": {"login": "hmusum", "name": "Harald Musum"}}, "url": "https://github.com/vespa-engine/vespa/commit/a03b65e377d94ab09e7682a51858a39205bb8360", "committedDate": "2020-10-22T06:59:03Z", "message": "Update thin pool sizes after changes in internal repo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5f502286dc936755beea0efa1f48c04bf1943b8b", "author": {"user": {"login": "hmusum", "name": "Harald Musum"}}, "url": "https://github.com/vespa-engine/vespa/commit/5f502286dc936755beea0efa1f48c04bf1943b8b", "committedDate": "2020-10-22T08:32:36Z", "message": "Update after changes in code this dependends on"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE0NjIxMDMx", "url": "https://github.com/vespa-engine/vespa/pull/15000#pullrequestreview-514621031", "createdAt": "2020-10-22T11:24:06Z", "commit": {"oid": "5f502286dc936755beea0efa1f48c04bf1943b8b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE0NjMwMDIw", "url": "https://github.com/vespa-engine/vespa/pull/15000#pullrequestreview-514630020", "createdAt": "2020-10-22T11:36:48Z", "commit": {"oid": "5f502286dc936755beea0efa1f48c04bf1943b8b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxMTozNjo0OVrOHmda3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxMTozNjo0OVrOHmda3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDA4OTk0OQ==", "bodyText": "Will this code be exercised for currently provisioned hosts too, and that are using the old thin pool sizes?  How does that work?  AFAIK, only if we're currently enlarging (rounding up) the node resources will prepare  now instead require a larger disk, which may involve... migration I guess?", "url": "https://github.com/vespa-engine/vespa/pull/15000#discussion_r510089949", "createdAt": "2020-10-22T11:36:49Z", "author": {"login": "hakonhall"}, "path": "node-repository/src/main/java/com/yahoo/vespa/hosted/provision/provisioning/NodeResourceLimits.java", "diffHunk": "@@ -72,26 +72,27 @@ private double minAdvertisedMemoryGb(ClusterSpec.Type clusterType) {\n     }\n \n     private double minAdvertisedDiskGb(NodeResources requested) {\n-        if (requested.storageType() == NodeResources.StorageType.local && zone().getCloud().dynamicProvisioning()) {\n+        return minRealDiskGb() + getThinPoolSize(requested.storageType());\n+    }\n+\n+    // TODO: Calculate thin pool size instead of hardcoding\n+    private long getThinPoolSize(NodeResources.StorageType storageType) {\n+        if (storageType == NodeResources.StorageType.local && zone().getCloud().dynamicProvisioning()) {\n             if (zone().system() == SystemName.Public)\n-                return 10 + minRealDiskGb();\n+                return 12;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5f502286dc936755beea0efa1f48c04bf1943b8b"}, "originalPosition": 54}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2318, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}