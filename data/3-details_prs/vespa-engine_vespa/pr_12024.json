{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY5NjAyMDI1", "number": 12024, "title": "Handle empty source revision", "bodyText": "Would be good to have this in Monday's release, but @jonmv should probably have\na look first.\nApplicationVersion needs a serious makeover...", "createdAt": "2020-01-31T14:15:24Z", "url": "https://github.com/vespa-engine/vespa/pull/12024", "merged": true, "mergeCommit": {"oid": "262b9e3734c5c0b580c31528ba2fb3556a77e1f5"}, "closed": true, "closedAt": "2020-01-31T14:53:06Z", "author": {"login": "mpolden"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb_vzEygH2gAyMzY5NjAyMDI1OmM0OWZlZGE1M2VlZjI2NTgwMmFmZjRiNWU4ZmMxYzgxNjBiZGMxNjc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb_yzmFAFqTM1MTY2MzY0Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c49feda53eef265802aff4b5e8fc1c8160bdc167", "author": {"user": {"login": "mpolden", "name": "Martin Polden"}}, "url": "https://github.com/vespa-engine/vespa/commit/c49feda53eef265802aff4b5e8fc1c8160bdc167", "committedDate": "2020-01-31T14:13:29Z", "message": "Handle empty source revision"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxNTM5OTI2", "url": "https://github.com/vespa-engine/vespa/pull/12024#pullrequestreview-351539926", "createdAt": "2020-01-31T14:28:29Z", "commit": {"oid": "c49feda53eef265802aff4b5e8fc1c8160bdc167"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxNjYzNjQ3", "url": "https://github.com/vespa-engine/vespa/pull/12024#pullrequestreview-351663647", "createdAt": "2020-01-31T17:35:53Z", "commit": {"oid": "c49feda53eef265802aff4b5e8fc1c8160bdc167"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQxNzozNTo1M1rOFkSpAg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQxNzozNTo1M1rOFkSpAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzU5ODQ2Ng==", "bodyText": "@jonmv This was the bug. When source revision is empty, no fields are written to the latestVersion object, but the object itself is created, thus becoming an unknown version. Subsequent reads fail because the Application constructor throws if latestVersion is unknown so fromSlime/toSlime is asymmetric.\n\nWhat are the other changes here?\n\nCleanup of SourceRevision. SourceRevision where all fields are empty is now treated as an empty source revision.\nThe fact they can be empty might point to a bug or lack of validation in the submission API?", "url": "https://github.com/vespa-engine/vespa/pull/12024#discussion_r373598466", "createdAt": "2020-01-31T17:35:53Z", "author": {"login": "mpolden"}, "path": "controller-server/src/main/java/com/yahoo/vespa/hosted/controller/persistence/ApplicationSerializer.java", "diffHunk": "@@ -258,15 +258,13 @@ private void zoneIdToSlime(ZoneId zone, Cursor object) {\n     }\n \n     private void toSlime(ApplicationVersion applicationVersion, Cursor object) {\n-        if (applicationVersion.buildNumber().isPresent() && applicationVersion.source().isPresent()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c49feda53eef265802aff4b5e8fc1c8160bdc167"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3924, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}