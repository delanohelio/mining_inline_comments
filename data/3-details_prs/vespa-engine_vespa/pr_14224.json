{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc2OTc1ODEw", "number": 14224, "title": "Arnej/add direct tensor attribute", "bodyText": "I confirm that this contribution is made under the terms of the license found in the root directory of this repository's source tree and that I have the authority necessary to make this contribution on behalf of its copyright owner.\n@geirst please review\n@toregge please review\n@havardpe FYI", "createdAt": "2020-09-01T10:16:18Z", "url": "https://github.com/vespa-engine/vespa/pull/14224", "merged": true, "mergeCommit": {"oid": "d3297ff1426fd6d2074a914b395e4c20b2f03652"}, "closed": true, "closedAt": "2020-09-01T14:41:20Z", "author": {"login": "arnej27959"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdEj0rggH2gAyNDc2OTc1ODEwOmI0OTY3ZjljYTA5YWQ0NzI4YTg2ZGFmNDMzNjhkMGRmNDE4ZjNkNjg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdEn9NMgFqTQ3OTc3NjEyMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b4967f9ca09ad4728a86daf43368d0df418f3d68", "author": {"user": {"login": "arnej27959", "name": "Arne H Juul"}}, "url": "https://github.com/vespa-engine/vespa/commit/b4967f9ca09ad4728a86daf43368d0df418f3d68", "committedDate": "2020-09-01T09:17:09Z", "message": "add DirectTensorAttribute implementation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7f2bba064e2bd2aa79a6aea9658821e3ec1e7c76", "author": {"user": {"login": "arnej27959", "name": "Arne H Juul"}}, "url": "https://github.com/vespa-engine/vespa/commit/7f2bba064e2bd2aa79a6aea9658821e3ec1e7c76", "committedDate": "2020-09-01T10:14:39Z", "message": "set_tensor() -> store_tensor() to better reflect intent"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "00415c9642d15a2a03c7d1692df05697a18f3edd", "author": {"user": {"login": "arnej27959", "name": "Arne H Juul"}}, "url": "https://github.com/vespa-engine/vespa/commit/00415c9642d15a2a03c7d1692df05697a18f3edd", "committedDate": "2020-09-01T10:14:44Z", "message": "create DirectTensorAttribute for sparse tensors with fast-search"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5d52e67fb5222b65201204786785d62d8655de39", "author": {"user": {"login": "arnej27959", "name": "Arne H Juul"}}, "url": "https://github.com/vespa-engine/vespa/commit/5d52e67fb5222b65201204786785d62d8655de39", "committedDate": "2020-09-01T10:14:45Z", "message": "use direct access to tensor when possible"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb43df5c1cdd0802754c13d6243179e18183fd5d", "author": {"user": {"login": "arnej27959", "name": "Arne H Juul"}}, "url": "https://github.com/vespa-engine/vespa/commit/fb43df5c1cdd0802754c13d6243179e18183fd5d", "committedDate": "2020-09-01T10:14:45Z", "message": "unit test direct tensor reference as well"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc5NjkzOTM4", "url": "https://github.com/vespa-engine/vespa/pull/14224#pullrequestreview-479693938", "createdAt": "2020-09-01T12:33:17Z", "commit": {"oid": "5d52e67fb5222b65201204786785d62d8655de39"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQxMjozMzoxN1rOHK0JLA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQxMjozMzoxN1rOHK0JLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTEwMjEyNA==", "bodyText": "To avoid type checking in the inner-loop, consider creating a separate executor instead and choose that in createTensorAttributeExecutor() in attributefeature.cpp.", "url": "https://github.com/vespa-engine/vespa/pull/14224#discussion_r481102124", "createdAt": "2020-09-01T12:33:17Z", "author": {"login": "geirst"}, "path": "searchlib/src/vespa/searchlib/features/tensor_attribute_executor.cpp", "diffHunk": "@@ -17,6 +18,11 @@ TensorAttributeExecutor(const search::tensor::ITensorAttribute *attribute)\n void\n TensorAttributeExecutor::execute(uint32_t docId)\n {\n+    using DTA = search::tensor::DirectTensorAttribute;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5d52e67fb5222b65201204786785d62d8655de39"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1e3ffd7130e44e696281ed7f8ccda28180cf2538", "author": {"user": {"login": "arnej27959", "name": "Arne H Juul"}}, "url": "https://github.com/vespa-engine/vespa/commit/1e3ffd7130e44e696281ed7f8ccda28180cf2538", "committedDate": "2020-09-01T13:19:04Z", "message": "allow \"attribute: fast-search\" for sparse tensors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "618dd98341a131cd40e70cf8a150948284ad55e1", "author": {"user": {"login": "arnej27959", "name": "Arne H Juul"}}, "url": "https://github.com/vespa-engine/vespa/commit/618dd98341a131cd40e70cf8a150948284ad55e1", "committedDate": "2020-09-01T13:34:34Z", "message": "even simpler executor for direct tensor attributes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc5NzYyMDEy", "url": "https://github.com/vespa-engine/vespa/pull/14224#pullrequestreview-479762012", "createdAt": "2020-09-01T13:51:22Z", "commit": {"oid": "618dd98341a131cd40e70cf8a150948284ad55e1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQxMzo1MToyMlrOHK3QUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQxMzo1MToyMlrOHK3QUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTE1MzEwNg==", "bodyText": "Consider reverting change to TensorAttributeExecutor now that we have a DIrectTensorAttributeExecutor ?", "url": "https://github.com/vespa-engine/vespa/pull/14224#discussion_r481153106", "createdAt": "2020-09-01T13:51:22Z", "author": {"login": "toregge"}, "path": "searchlib/src/vespa/searchlib/features/attributefeature.cpp", "diffHunk": "@@ -469,6 +472,9 @@ createTensorAttributeExecutor(const IAttributeVector *attribute, const vespalib:\n     if (tensorType.is_dense()) {\n         return stash.create<DenseTensorAttributeExecutor>(tensorAttribute);\n     }\n+    if (auto direct = dynamic_cast<const DirectTensorAttribute *>(tensorAttribute)) {\n+        return stash.create<DirectTensorAttributeExecutor>(*direct);\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "618dd98341a131cd40e70cf8a150948284ad55e1"}, "originalPosition": 28}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "03bbd9929378a602788499d0dba2bb4319617fbb", "author": {"user": {"login": "arnej27959", "name": "Arne H Juul"}}, "url": "https://github.com/vespa-engine/vespa/commit/03bbd9929378a602788499d0dba2bb4319617fbb", "committedDate": "2020-09-01T13:53:53Z", "message": "Revert \"use direct access to tensor when possible\"\n\n(this is now handled by its own executor)\n\nThis reverts commit 5d52e67fb5222b65201204786785d62d8655de39."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc5NzY2NTUx", "url": "https://github.com/vespa-engine/vespa/pull/14224#pullrequestreview-479766551", "createdAt": "2020-09-01T13:56:10Z", "commit": {"oid": "03bbd9929378a602788499d0dba2bb4319617fbb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc5Nzc2MTIz", "url": "https://github.com/vespa-engine/vespa/pull/14224#pullrequestreview-479776123", "createdAt": "2020-09-01T14:06:05Z", "commit": {"oid": "03bbd9929378a602788499d0dba2bb4319617fbb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4362, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}