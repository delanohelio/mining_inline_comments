{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMxMjg5OTYw", "number": 15621, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxMDozNDoyM1rOFAJyIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxMDozNDoyM1rOFAJyIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM1NzA0NjA4OnYy", "diffSide": "RIGHT", "path": "vespalib/src/vespa/vespalib/stllike/hashtable.hpp", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxMDozNDoyM1rOH-Sbvw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxMDozNDoyM1rOH-Sbvw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTA3NTc3NQ==", "bodyText": "would it not be better to round up the memory used to (close to) a power of 2, instead of the number of entries?", "url": "https://github.com/vespa-engine/vespa/pull/15621#discussion_r535075775", "createdAt": "2020-12-03T10:34:23Z", "author": {"login": "havardpe"}, "path": "vespalib/src/vespa/vespalib/stllike/hashtable.hpp", "diffHunk": "@@ -6,6 +6,28 @@\n \n namespace vespalib {\n \n+namespace {\n+\n+/// TODO Currently we require that you have atleast one element in _nodes to avoid one extra branch\n+/// However that means that empty unused hashtables are larger than necessary.\n+/// This we should probably reconsider.\n+template<typename Modulator>\n+uint32_t\n+computeModulo(size_t size) {\n+    return (size > 0) ? Modulator::selectHashTableSize(roundUp2inN(size) / 3) : 1;\n+}\n+\n+template <typename NodeStore>\n+NodeStore\n+createStore(size_t size, uint32_t modulo) {\n+    size = (size > 0) ? roundUp2inN(std::max(size_t(modulo), roundUp2inN(size))) : 1;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fc8b150ba0b7ed457eecee6d81ae4347f6756120"}, "originalPosition": 18}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 780, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}