{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE4NTIzMzMz", "number": 15257, "title": "Arnej/add java tensor conformance app", "bodyText": "I confirm that this contribution is made under the terms of the license found in the root directory of this repository's source tree and that I have the authority necessary to make this contribution on behalf of its copyright owner.\n@lesters please review\n@havardpe please review\n@bratseth @geirst FYI", "createdAt": "2020-11-10T14:21:36Z", "url": "https://github.com/vespa-engine/vespa/pull/15257", "merged": true, "mergeCommit": {"oid": "106a4c8115aaea20fd6da7bd9801d525f5da804d"}, "closed": true, "closedAt": "2020-11-11T11:53:42Z", "author": {"login": "arnej27959"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdbI_pYgH2gAyNTE4NTIzMzMzOjE0ODc0Zjc4MTkxMTMyZTdjYmZhNmIzNmUwMTIxYjUzNzY5NDg5NTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdbNXHIAH2gAyNTE4NTIzMzMzOjI4ZDUwNzE0ZTExNjM3OTk4NWExOGU2YWVhMjA4ZTdlMWExNzU0ZjI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "14874f78191132e7cbfa6b36e0121b5376948953", "author": {"user": {"login": "arnej27959", "name": "Arne H Juul"}}, "url": "https://github.com/vespa-engine/vespa/commit/14874f78191132e7cbfa6b36e0121b5376948953", "committedDate": "2020-11-10T13:01:57Z", "message": "add a new Java application for evaluating tensor conformance tests\n\n* based on TensorConformanceTest unit test class\n* reads JSON into Slime structure\n* annotates with actual results from vespajlib evaluation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db0c16fa7703507486a628f69cd2353c52e1ce56", "author": {"user": {"login": "arnej27959", "name": "Arne H Juul"}}, "url": "https://github.com/vespa-engine/vespa/commit/db0c16fa7703507486a628f69cd2353c52e1ce56", "committedDate": "2020-11-10T13:01:57Z", "message": "add script wrapper"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "de0f467a1f319972740c5b2945ebc0479faecb7e", "author": {"user": {"login": "arnej27959", "name": "Arne H Juul"}}, "url": "https://github.com/vespa-engine/vespa/commit/de0f467a1f319972740c5b2945ebc0479faecb7e", "committedDate": "2020-11-10T14:18:58Z", "message": "install binary for vespa-tensor-conformance"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3MjU1OTcy", "url": "https://github.com/vespa-engine/vespa/pull/15257#pullrequestreview-527255972", "createdAt": "2020-11-10T14:27:24Z", "commit": {"oid": "de0f467a1f319972740c5b2945ebc0479faecb7e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxNDoyNzoyNVrOHwfFpg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxNDoyNzoyNVrOHwfFpg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDYwMzA0Ng==", "bodyText": "Copyright Verizon Media", "url": "https://github.com/vespa-engine/vespa/pull/15257#discussion_r520603046", "createdAt": "2020-11-10T14:27:25Z", "author": {"login": "lesters"}, "path": "searchlib/src/main/java/com/yahoo/searchlib/tensor/EvaluateTensorConformance.java", "diffHunk": "@@ -0,0 +1,160 @@\n+// Copyright 2018 Yahoo Holdings. Licensed under the terms of the Apache 2.0 license. See LICENSE in the project root.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de0f467a1f319972740c5b2945ebc0479faecb7e"}, "originalPosition": 1}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3MjU2MTU3", "url": "https://github.com/vespa-engine/vespa/pull/15257#pullrequestreview-527256157", "createdAt": "2020-11-10T14:27:35Z", "commit": {"oid": "de0f467a1f319972740c5b2945ebc0479faecb7e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxNDoyNzozNVrOHwfGLw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxNDoyNzozNVrOHwfGLw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDYwMzE4Mw==", "bodyText": "indent", "url": "https://github.com/vespa-engine/vespa/pull/15257#discussion_r520603183", "createdAt": "2020-11-10T14:27:35Z", "author": {"login": "lesters"}, "path": "searchlib/src/main/java/com/yahoo/searchlib/tensor/EvaluateTensorConformance.java", "diffHunk": "@@ -0,0 +1,160 @@\n+// Copyright 2018 Yahoo Holdings. Licensed under the terms of the Apache 2.0 license. See LICENSE in the project root.\n+package com.yahoo.searchlib.tensor;\n+\n+import com.yahoo.slime.Cursor;\n+import com.yahoo.slime.Inspector;\n+import com.yahoo.slime.JsonFormat;\n+import com.yahoo.slime.ObjectTraverser;\n+import com.yahoo.slime.Slime;\n+import com.yahoo.slime.SlimeUtils;\n+\n+import com.yahoo.io.GrowableByteBuffer;\n+import com.yahoo.searchlib.rankingexpression.RankingExpression;\n+import com.yahoo.searchlib.rankingexpression.evaluation.BooleanValue;\n+import com.yahoo.searchlib.rankingexpression.evaluation.DoubleCompatibleValue;\n+import com.yahoo.searchlib.rankingexpression.evaluation.MapContext;\n+import com.yahoo.searchlib.rankingexpression.evaluation.StringValue;\n+import com.yahoo.searchlib.rankingexpression.evaluation.TensorValue;\n+import com.yahoo.searchlib.rankingexpression.evaluation.Value;\n+import com.yahoo.searchlib.rankingexpression.parser.ParseException;\n+import com.yahoo.tensor.Tensor;\n+import com.yahoo.tensor.serialization.TypedBinaryFormat;\n+\n+import java.io.BufferedOutputStream;\n+import java.io.BufferedReader;\n+import java.io.File;\n+import java.io.FileNotFoundException;\n+import java.io.FileReader;\n+import java.io.IOException;\n+import java.io.InputStreamReader;\n+import java.io.OutputStream;\n+\n+import java.util.ArrayList;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.Optional;\n+\n+public class EvaluateTensorConformance {\n+\n+    public static void main(String[] args) {\n+        var app = new EvaluateTensorConformance();\n+        app.evaluateStdIn();\n+    }\n+\n+    OutputStream outStream = new BufferedOutputStream(System.out);\n+\n+    void evaluateStdIn() {\n+        int count = 0;\n+        try (BufferedReader br = new BufferedReader(new InputStreamReader(System.in))) {\n+            String test = br.readLine();\n+            while (test != null) {\n+                boolean success = testCase(test, count);\n+                if (!success) {\n+                    System.err.println(\"FAILED testcase \"+count);\n+                }\n+                ++count;\n+                test = br.readLine();\n+            }\n+        } catch (IOException e) {\n+            System.err.println(count + \" FAILED : \" + e.toString());\n+        }\n+    }\n+\n+    void output(Slime result) {\n+        try {\n+            new JsonFormat(true).encode(outStream, result);\n+            outStream.write('\\n');\n+            outStream.flush();\n+        } catch (IOException e) {\n+            System.err.println(\"FAILED writing output: \"+e);\n+            System.exit(1);\n+        }\n+    }\n+        \n+    private boolean testCase(String test, int count) {\n+        boolean okAndEqual = false;\n+        try {\n+\t    Slime input = SlimeUtils.jsonToSlime(test);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de0f467a1f319972740c5b2945ebc0479faecb7e"}, "originalPosition": 77}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3MjU2NTQ3", "url": "https://github.com/vespa-engine/vespa/pull/15257#pullrequestreview-527256547", "createdAt": "2020-11-10T14:27:57Z", "commit": {"oid": "de0f467a1f319972740c5b2945ebc0479faecb7e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3Mjg3NTUy", "url": "https://github.com/vespa-engine/vespa/pull/15257#pullrequestreview-527287552", "createdAt": "2020-11-10T14:57:09Z", "commit": {"oid": "de0f467a1f319972740c5b2945ebc0479faecb7e"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7f468e2ce0c4c4845a308655ac80bd9fee14a5f2", "author": {"user": {"login": "arnej27959", "name": "Arne H Juul"}}, "url": "https://github.com/vespa-engine/vespa/commit/7f468e2ce0c4c4845a308655ac80bd9fee14a5f2", "committedDate": "2020-11-10T16:17:02Z", "message": "fix copyright, untabify"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "28d50714e116379985a18e6aea208e7e1a1754f2", "author": {"user": {"login": "arnej27959", "name": "Arne H Juul"}}, "url": "https://github.com/vespa-engine/vespa/commit/28d50714e116379985a18e6aea208e7e1a1754f2", "committedDate": "2020-11-10T18:07:12Z", "message": "just compute our result"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2011, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}