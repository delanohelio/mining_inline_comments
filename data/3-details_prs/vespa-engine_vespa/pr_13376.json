{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIzMTUxNTk1", "number": 13376, "title": "extend blueprint API", "bodyText": "I confirm that this contribution is made under the terms of the license found in the root directory of this repository's source tree and that I have the authority necessary to make this contribution on behalf of its copyright owner.\n@havardpe @geirst @toregge for consideration - does this look reasonable?\nNote: we cannot re-use TrueSearch, it is only for unit tests.", "createdAt": "2020-05-26T11:37:22Z", "url": "https://github.com/vespa-engine/vespa/pull/13376", "merged": true, "mergeCommit": {"oid": "d8be0cc5b5aed6deff9d37c6336757d6f07ad34f"}, "closed": true, "closedAt": "2020-05-27T09:29:53Z", "author": {"login": "arnej27959"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABclC95hAH2gAyNDIzMTUxNTk1OjNjOTkxM2FkNmQwMzUxODM0Yzk1ZGZjYmIyYjc3NDc1NmUwODY4ODg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABclVwqFAH2gAyNDIzMTUxNTk1OjMyNzRhNGU0ZTY4OTUyYmQ2Zjg4MTM5ZjUxNTUzYTQzZDlhZWJmNDY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3c9913ad6d0351834c95dfcbb2b774756e086888", "author": {"user": {"login": "arnej27959", "name": "Arne H Juul"}}, "url": "https://github.com/vespa-engine/vespa/commit/3c9913ad6d0351834c95dfcbb2b774756e086888", "committedDate": "2020-05-26T11:28:42Z", "message": "extend blueprint API"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE4MjcxMzEy", "url": "https://github.com/vespa-engine/vespa/pull/13376#pullrequestreview-418271312", "createdAt": "2020-05-26T12:59:27Z", "commit": {"oid": "3c9913ad6d0351834c95dfcbb2b774756e086888"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQxMjo1OTo1NVrOGadFiA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQxMzowOToyNFrOGadc_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDM5MjcxMg==", "bodyText": "I think a new bitvector is also empty", "url": "https://github.com/vespa-engine/vespa/pull/13376#discussion_r430392712", "createdAt": "2020-05-26T12:59:55Z", "author": {"login": "havardpe"}, "path": "searchlib/src/vespa/searchlib/queryeval/emptysearch.cpp", "diffHunk": "@@ -15,6 +14,27 @@ EmptySearch::doUnpack(uint32_t)\n {\n }\n \n+void\n+EmptySearch::or_hits_into(BitVector &, uint32_t)\n+{\n+    // nop\n+}\n+\n+void\n+EmptySearch::and_hits_into(BitVector &result, uint32_t begin_id)\n+{\n+    result.clearInterval(begin_id, getEndId());\n+}\n+\n+BitVector::UP\n+EmptySearch::get_hits(uint32_t begin_id)\n+{\n+    auto result = BitVector::create(begin_id, getEndId());\n+    result->clearInterval(begin_id, getEndId());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3c9913ad6d0351834c95dfcbb2b774756e086888"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDM5NDczNA==", "bodyText": "I think the 'bound' part should be part of the enum values and not the enum type, since it smells like past tense 'bind' on its own. Maybe FilterType or FilterConstraint, with UPPER_BOUND and LOWER_BOUND", "url": "https://github.com/vespa-engine/vespa/pull/13376#discussion_r430394734", "createdAt": "2020-05-26T13:03:03Z", "author": {"login": "havardpe"}, "path": "searchlib/src/vespa/searchlib/queryeval/blueprint.h", "diffHunk": "@@ -164,6 +164,8 @@ class Blueprint\n         virtual bool check(const Blueprint & bp) const = 0;\n     };\n \n+    enum class FilterBound { UPPER, LOWER };", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3c9913ad6d0351834c95dfcbb2b774756e086888"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDM5Nzg0Ng==", "bodyText": "setInterval also invalidates the cached count", "url": "https://github.com/vespa-engine/vespa/pull/13376#discussion_r430397846", "createdAt": "2020-05-26T13:08:01Z", "author": {"login": "havardpe"}, "path": "searchlib/src/vespa/searchlib/queryeval/full_search.cpp", "diffHunk": "@@ -0,0 +1,46 @@\n+// Copyright Verizon Media. Licensed under the terms of the Apache 2.0 license. See LICENSE in the project root.\n+\n+#include \"full_search.h\"\n+\n+namespace search::queryeval {\n+\n+void\n+FullSearch::doSeek(uint32_t docid)\n+{\n+    setDocId(docid);\n+}\n+\n+void\n+FullSearch::doUnpack(uint32_t)\n+{\n+    abort();\n+}\n+\n+void\n+FullSearch::or_hits_into(BitVector &result, uint32_t begin_id)\n+{\n+    result.setInterval(begin_id, getEndId());\n+}\n+\n+void\n+FullSearch::and_hits_into(BitVector &, uint32_t)\n+{\n+    // nop\n+}\n+\n+BitVector::UP\n+FullSearch::get_hits(uint32_t begin_id)\n+{\n+    auto result = BitVector::create(begin_id, getEndId());\n+    result->setInterval(begin_id, getEndId());\n+    result->invalidateCachedCount();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3c9913ad6d0351834c95dfcbb2b774756e086888"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDM5ODcxOQ==", "bodyText": "I think empty is better than aborting", "url": "https://github.com/vespa-engine/vespa/pull/13376#discussion_r430398719", "createdAt": "2020-05-26T13:09:24Z", "author": {"login": "havardpe"}, "path": "searchlib/src/vespa/searchlib/queryeval/full_search.cpp", "diffHunk": "@@ -0,0 +1,46 @@\n+// Copyright Verizon Media. Licensed under the terms of the Apache 2.0 license. See LICENSE in the project root.\n+\n+#include \"full_search.h\"\n+\n+namespace search::queryeval {\n+\n+void\n+FullSearch::doSeek(uint32_t docid)\n+{\n+    setDocId(docid);\n+}\n+\n+void\n+FullSearch::doUnpack(uint32_t)\n+{\n+    abort();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3c9913ad6d0351834c95dfcbb2b774756e086888"}, "originalPosition": 16}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE4MzE5MDQ2", "url": "https://github.com/vespa-engine/vespa/pull/13376#pullrequestreview-418319046", "createdAt": "2020-05-26T13:51:58Z", "commit": {"oid": "3c9913ad6d0351834c95dfcbb2b774756e086888"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQxMzo1MTo1OFrOGafQ9w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQxMzo1MzoxOFrOGafUzg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQyODQwNw==", "bodyText": "Also add a comment describing the difference between the two.", "url": "https://github.com/vespa-engine/vespa/pull/13376#discussion_r430428407", "createdAt": "2020-05-26T13:51:58Z", "author": {"login": "geirst"}, "path": "searchlib/src/vespa/searchlib/queryeval/blueprint.h", "diffHunk": "@@ -164,6 +164,8 @@ class Blueprint\n         virtual bool check(const Blueprint & bp) const = 0;\n     };\n \n+    enum class FilterBound { UPPER, LOWER };", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDM5NDczNA=="}, "originalCommit": {"oid": "3c9913ad6d0351834c95dfcbb2b774756e086888"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQyOTM5MA==", "bodyText": "Please add class comment.", "url": "https://github.com/vespa-engine/vespa/pull/13376#discussion_r430429390", "createdAt": "2020-05-26T13:53:18Z", "author": {"login": "geirst"}, "path": "searchlib/src/vespa/searchlib/queryeval/full_search.h", "diffHunk": "@@ -0,0 +1,25 @@\n+// Copyright Verizon Media. Licensed under the terms of the Apache 2.0 license. See LICENSE in the project root.\n+\n+#pragma once\n+\n+#include \"searchiterator.h\"\n+#include <vespa/searchlib/common/bitvector.h>\n+\n+namespace search::queryeval {\n+\n+class FullSearch : public SearchIterator", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3c9913ad6d0351834c95dfcbb2b774756e086888"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b0d036c0b271ad4d19888bb010f89182058cb67a", "author": {"user": {"login": "arnej27959", "name": "Arne H Juul"}}, "url": "https://github.com/vespa-engine/vespa/commit/b0d036c0b271ad4d19888bb010f89182058cb67a", "committedDate": "2020-05-26T17:56:04Z", "message": "review follow-up\n\n* add some documentation comments\n* remove un-needed invalidateCachedCount\n* rename upper/lower bound signaling enum"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE4OTMzMTgx", "url": "https://github.com/vespa-engine/vespa/pull/13376#pullrequestreview-418933181", "createdAt": "2020-05-27T07:41:30Z", "commit": {"oid": "b0d036c0b271ad4d19888bb010f89182058cb67a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE4OTU1ODc5", "url": "https://github.com/vespa-engine/vespa/pull/13376#pullrequestreview-418955879", "createdAt": "2020-05-27T08:12:30Z", "commit": {"oid": "b0d036c0b271ad4d19888bb010f89182058cb67a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QwODoxMjozMVrOGa-N0w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QwODoxMjozMVrOGa-N0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDkzNTUwNw==", "bodyText": "I still do not think you need to clear an empty bitvector", "url": "https://github.com/vespa-engine/vespa/pull/13376#discussion_r430935507", "createdAt": "2020-05-27T08:12:31Z", "author": {"login": "havardpe"}, "path": "searchlib/src/vespa/searchlib/queryeval/emptysearch.cpp", "diffHunk": "@@ -15,6 +14,26 @@ EmptySearch::doUnpack(uint32_t)\n {\n }\n \n+void\n+EmptySearch::or_hits_into(BitVector &, uint32_t)\n+{\n+    // nop\n+}\n+\n+void\n+EmptySearch::and_hits_into(BitVector &result, uint32_t begin_id)\n+{\n+    result.clearInterval(begin_id, getEndId());\n+}\n+\n+BitVector::UP\n+EmptySearch::get_hits(uint32_t begin_id)\n+{\n+    auto result = BitVector::create(begin_id, getEndId());\n+    result->clearInterval(begin_id, getEndId());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b0d036c0b271ad4d19888bb010f89182058cb67a"}, "originalPosition": 30}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3274a4e4e68952bd6f88139f51553a43d9aebf46", "author": {"user": {"login": "arnej27959", "name": "Arne H Juul"}}, "url": "https://github.com/vespa-engine/vespa/commit/3274a4e4e68952bd6f88139f51553a43d9aebf46", "committedDate": "2020-05-27T09:22:26Z", "message": "remove one more unneeded clearInterval"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3041, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}