{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQwNDA1OTQ5", "number": 13716, "title": "Avoid going out of memory when deleting files", "bodyText": "Host-admin would go out of memory when deleting a directory with 4M files.", "createdAt": "2020-06-26T06:26:46Z", "url": "https://github.com/vespa-engine/vespa/pull/13716", "merged": true, "mergeCommit": {"oid": "16937304cf4fb3ac8970c07d3ae6fed86d8fe11c"}, "closed": true, "closedAt": "2020-06-26T07:51:00Z", "author": {"login": "freva"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcu9NjugH2gAyNDQwNDA1OTQ5OjMxMDdkYjFkZGViYTY3OGIxZmE5ZDg1MjNkOTZiMzZiOGYzMjAwM2E=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcu9ueLAFqTQzODA1NzUwNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3107db1ddeba678b1fa9d8523d96b36b8f32003a", "author": {"user": {"login": "freva", "name": "Valerij Fredriksen"}}, "url": "https://github.com/vespa-engine/vespa/commit/3107db1ddeba678b1fa9d8523d96b36b8f32003a", "committedDate": "2020-06-26T06:25:37Z", "message": "Avoid going out of memory when deleting files"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4MDQ1NjE3", "url": "https://github.com/vespa-engine/vespa/pull/13716#pullrequestreview-438045617", "createdAt": "2020-06-26T06:35:02Z", "commit": {"oid": "3107db1ddeba678b1fa9d8523d96b36b8f32003a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQwNjozNTowMlrOGpVUDw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQwNjozNTowMlrOGpVUDw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTk5Mzk5OQ==", "bodyText": "Why not use a for loop on line 118 instead to avoid this hack?", "url": "https://github.com/vespa-engine/vespa/pull/13716#discussion_r445993999", "createdAt": "2020-06-26T06:35:02Z", "author": {"login": "bratseth"}, "path": "node-admin/src/main/java/com/yahoo/vespa/hosted/node/admin/task/util/file/FileFinder.java", "diffHunk": "@@ -110,17 +110,19 @@ public FileFinder maxDepth(int maxDepth) {\n      * @return true iff anything was matched and deleted\n      */\n     public boolean deleteRecursively(TaskContext context) {\n+        final int limit = 20;\n+        int[] numDeleted = { 0 };", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3107db1ddeba678b1fa9d8523d96b36b8f32003a"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4MDQ1ODY1", "url": "https://github.com/vespa-engine/vespa/pull/13716#pullrequestreview-438045865", "createdAt": "2020-06-26T06:35:40Z", "commit": {"oid": "3107db1ddeba678b1fa9d8523d96b36b8f32003a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQwNjozNTo0MFrOGpVU4w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQwNjozNTo0MFrOGpVU4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTk5NDIxMQ==", "bodyText": "Maybe worth a comment saying why there is a limit?", "url": "https://github.com/vespa-engine/vespa/pull/13716#discussion_r445994211", "createdAt": "2020-06-26T06:35:40Z", "author": {"login": "bratseth"}, "path": "node-admin/src/main/java/com/yahoo/vespa/hosted/node/admin/task/util/file/FileFinder.java", "diffHunk": "@@ -110,17 +110,19 @@ public FileFinder maxDepth(int maxDepth) {\n      * @return true iff anything was matched and deleted\n      */\n     public boolean deleteRecursively(TaskContext context) {\n+        final int limit = 20;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3107db1ddeba678b1fa9d8523d96b36b8f32003a"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dd5396dbf99b414b480eb32f7f26014f7f064bf4", "author": {"user": {"login": "freva", "name": "Valerij Fredriksen"}}, "url": "https://github.com/vespa-engine/vespa/commit/dd5396dbf99b414b480eb32f7f26014f7f064bf4", "committedDate": "2020-06-26T06:44:46Z", "message": "Rename variable to make purpose clearer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "22141cff2b94755a2f973ef221c3ccb3e34c6b74", "author": {"user": {"login": "freva", "name": "Valerij Fredriksen"}}, "url": "https://github.com/vespa-engine/vespa/commit/22141cff2b94755a2f973ef221c3ccb3e34c6b74", "committedDate": "2020-06-26T07:00:15Z", "message": "Use mutable integer instead"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM4MDU3NTA2", "url": "https://github.com/vespa-engine/vespa/pull/13716#pullrequestreview-438057506", "createdAt": "2020-06-26T07:01:34Z", "commit": {"oid": "22141cff2b94755a2f973ef221c3ccb3e34c6b74"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3584, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}