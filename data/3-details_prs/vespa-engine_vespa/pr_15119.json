{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEzMDY1MjY1", "number": 15119, "title": "added simple median aggregator", "bodyText": "I confirm that this contribution is made under the terms of the license found in the root directory of this repository's source tree and that I have the authority necessary to make this contribution on behalf of its copyright owner.\n@arnej27959 please review\n@bratseth FYI", "createdAt": "2020-10-30T14:57:54Z", "url": "https://github.com/vespa-engine/vespa/pull/15119", "merged": true, "mergeCommit": {"oid": "ed55e251ef2db9e3ff6a690d2ca011cf59a838a9"}, "closed": true, "closedAt": "2020-11-02T10:55:59Z", "author": {"login": "havardpe"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdXoCN1gH2gAyNTEzMDY1MjY1OmE5MTJlYWFhOWY2NGNiZDM1Y2M0MDViMjZjNDFmZjMzYzQ1ZTYzMTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdX4YtbAFqTUyMTEyNzI5Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a912eaaa9f64cbd35cc405b26c41ff33c45e6314", "author": {"user": {"login": "havardpe", "name": "H\u00e5vard Pettersen"}}, "url": "https://github.com/vespa-engine/vespa/commit/a912eaaa9f64cbd35cc405b26c41ff33c45e6314", "committedDate": "2020-10-30T14:56:07Z", "message": "added simple median aggregator"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxMDM1NjIw", "url": "https://github.com/vespa-engine/vespa/pull/15119#pullrequestreview-521035620", "createdAt": "2020-10-30T21:05:29Z", "commit": {"oid": "a912eaaa9f64cbd35cc405b26c41ff33c45e6314"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQyMTowNToyOVrOHrgdaw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQyMTowNToyOVrOHrgdaw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTM4MjYzNQ==", "bodyText": "if you want, you can always do this, because if \"cnt\" is odd then (cnt/2) == (cnt-1)/2 and (x+x)/2 == x", "url": "https://github.com/vespa-engine/vespa/pull/15119#discussion_r515382635", "createdAt": "2020-10-30T21:05:29Z", "author": {"login": "arnej27959"}, "path": "eval/src/vespa/eval/eval/aggr.h", "diffHunk": "@@ -120,6 +121,32 @@ template <typename T> class Max {\n     constexpr T result() const { return _max; }\n };\n \n+template <typename T> class Median {\n+private:\n+    std::vector<T> _seen;\n+public:\n+    constexpr Median() : _seen() {}\n+    constexpr Median(T value) : _seen({value}) {}\n+    constexpr void sample(T value) { _seen.push_back(value); }\n+    constexpr void merge(const Median &rhs) {\n+        for (T value: rhs._seen) {\n+            _seen.push_back(value);\n+        }\n+    };\n+    constexpr T result() const {\n+        if (_seen.empty()) {\n+            return std::numeric_limits<T>::quiet_NaN();\n+        }\n+        std::vector<T> tmp = _seen;\n+        std::sort(tmp.begin(), tmp.end());\n+        size_t cnt = tmp.size();\n+        if ((cnt % 2) == 0) {\n+            return ((tmp[cnt/2] + tmp[(cnt-1)/2]) / T{2});", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a912eaaa9f64cbd35cc405b26c41ff33c45e6314"}, "originalPosition": 41}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ed503386849a167f57bb7023a80dd93d58c788e4", "author": {"user": {"login": "havardpe", "name": "H\u00e5vard Pettersen"}}, "url": "https://github.com/vespa-engine/vespa/commit/ed503386849a167f57bb7023a80dd93d58c788e4", "committedDate": "2020-10-30T22:34:11Z", "message": "ignore NaN values"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxMDc3OTQ3", "url": "https://github.com/vespa-engine/vespa/pull/15119#pullrequestreview-521077947", "createdAt": "2020-10-30T23:01:05Z", "commit": {"oid": "ed503386849a167f57bb7023a80dd93d58c788e4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "52e8bd8f35b4eaf2a61d3c3d519c88181047f185", "author": {"user": {"login": "havardpe", "name": "H\u00e5vard Pettersen"}}, "url": "https://github.com/vespa-engine/vespa/commit/52e8bd8f35b4eaf2a61d3c3d519c88181047f185", "committedDate": "2020-10-30T23:07:56Z", "message": "re-write to use nth_element and max_element"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxMDgzNTI4", "url": "https://github.com/vespa-engine/vespa/pull/15119#pullrequestreview-521083528", "createdAt": "2020-10-30T23:24:06Z", "commit": {"oid": "52e8bd8f35b4eaf2a61d3c3d519c88181047f185"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5cf5c2d2f0c7e371364eb9a29c255973c7ccd554", "author": {"user": {"login": "havardpe", "name": "H\u00e5vard Pettersen"}}, "url": "https://github.com/vespa-engine/vespa/commit/5cf5c2d2f0c7e371364eb9a29c255973c7ccd554", "committedDate": "2020-10-31T00:59:51Z", "message": "median gives NaN if there are any NaN values"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxMTI3Mjkz", "url": "https://github.com/vespa-engine/vespa/pull/15119#pullrequestreview-521127293", "createdAt": "2020-10-31T09:59:10Z", "commit": {"oid": "5cf5c2d2f0c7e371364eb9a29c255973c7ccd554"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2257, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}