{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg3MTI5MDU3", "number": 12543, "title": "Do not aggregate header info over multiple calls", "bodyText": "@havardpe PR\n@yngveaasheim FYI\nThis plugs a huge memory leak.", "createdAt": "2020-03-12T09:24:02Z", "url": "https://github.com/vespa-engine/vespa/pull/12543", "merged": true, "mergeCommit": {"oid": "9c36deb6a5bca2b53ba76558f6804c8dd5be7dda"}, "closed": true, "closedAt": "2020-03-12T14:10:21Z", "author": {"login": "baldersheim"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcM4LZFAH2gAyMzg3MTI5MDU3Ojc2OWRhMThiZjQ3YjQ4MGUzYjA4MjJkZDI1NWY1NTcwZjU2YmU4NDY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcM7mcnAH2gAyMzg3MTI5MDU3OjRhNzA4ZTQ0N2YwZjNlNmVmYmE3ZWVlMzg3ZTU1NThmZDUwNTYzOTE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "769da18bf47b480e3b0822dd255f5570f56be846", "author": {"user": {"login": "baldersheim", "name": "Henning Baldersheim"}}, "url": "https://github.com/vespa-engine/vespa/commit/769da18bf47b480e3b0822dd255f5570f56be846", "committedDate": "2020-03-12T09:20:18Z", "message": "Do not aggregate header info over multiple calls"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczNDE0OTc4", "url": "https://github.com/vespa-engine/vespa/pull/12543#pullrequestreview-373414978", "createdAt": "2020-03-12T09:58:44Z", "commit": {"oid": "769da18bf47b480e3b0822dd255f5570f56be846"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQwOTo1ODo0NFrOF1X74w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQwOTo1OToxNFrOF1X9Hg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTUxMTAxMQ==", "bodyText": "why is it better to move it out of the class than to reset it when reading headers? (kind of messes with the API)\n(would not simply changing from += to = solve it?)", "url": "https://github.com/vespa-engine/vespa/pull/12543#discussion_r391511011", "createdAt": "2020-03-12T09:58:44Z", "author": {"login": "havardpe"}, "path": "fbench/src/httpclient/httpclient.h", "diffHunk": "@@ -95,21 +95,20 @@ class HTTPClient\n     vespalib::SocketAddress        _address;\n     vespalib::SyncCryptoSocket::UP _socket;\n \n-  std::string      _hostname;\n-  int              _port;\n-  bool             _keepAlive;\n-  bool             _headerBenchmarkdataCoverage;\n-  std::string      _extraHeaders;\n+  const std::string    _hostname;\n+  int                  _port;\n+  bool                 _keepAlive;\n+  bool                 _headerBenchmarkdataCoverage;\n+  const std::string    _extraHeaders;\n   vespalib::SocketSpec _sni_spec;\n-  std::string      _host_header_value;\n-  uint64_t         _reuseCount;\n+  std::string          _host_header_value;\n+  uint64_t             _reuseCount;\n \n   size_t           _bufsize;\n   char            *_buf;\n   ssize_t          _bufused;\n   ssize_t          _bufpos;\n \n-  std::string      _headerinfo;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "769da18bf47b480e3b0822dd255f5570f56be846"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTUxMTMyNg==", "bodyText": "this seems connected to the headerinfo string somehow...", "url": "https://github.com/vespa-engine/vespa/pull/12543#discussion_r391511326", "createdAt": "2020-03-12T09:59:14Z", "author": {"login": "havardpe"}, "path": "fbench/src/httpclient/httpclient.h", "diffHunk": "@@ -95,21 +95,20 @@ class HTTPClient\n     vespalib::SocketAddress        _address;\n     vespalib::SyncCryptoSocket::UP _socket;\n \n-  std::string      _hostname;\n-  int              _port;\n-  bool             _keepAlive;\n-  bool             _headerBenchmarkdataCoverage;\n-  std::string      _extraHeaders;\n+  const std::string    _hostname;\n+  int                  _port;\n+  bool                 _keepAlive;\n+  bool                 _headerBenchmarkdataCoverage;\n+  const std::string    _extraHeaders;\n   vespalib::SocketSpec _sni_spec;\n-  std::string      _host_header_value;\n-  uint64_t         _reuseCount;\n+  std::string          _host_header_value;\n+  uint64_t             _reuseCount;\n \n   size_t           _bufsize;\n   char            *_buf;\n   ssize_t          _bufused;\n   ssize_t          _bufpos;\n \n-  std::string      _headerinfo;\n   unsigned int     _headerinfoPos;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "769da18bf47b480e3b0822dd255f5570f56be846"}, "originalPosition": 26}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4a708e447f0f3e6efba7eee387e5558fd5056391", "author": {"user": {"login": "baldersheim", "name": "Henning Baldersheim"}}, "url": "https://github.com/vespa-engine/vespa/commit/4a708e447f0f3e6efba7eee387e5558fd5056391", "committedDate": "2020-03-12T13:19:34Z", "message": "Move parts of interface not needing to be public to private.\nAvoid complicated buffer management from the time when malloc was expensive."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2663, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}