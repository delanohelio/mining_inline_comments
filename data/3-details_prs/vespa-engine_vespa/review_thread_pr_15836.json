{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQxMTIxMTc4", "number": 15836, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxMjozODowNFrOFGK9gQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxMzo0OToyOVrOFGM5pQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQyMDE1MzYxOnYy", "diffSide": "RIGHT", "path": "storage/src/vespa/storage/distributor/distributormessagesender.cpp", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxMjozODowNFrOIHDTRg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxMjozODowNFrOIHDTRg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDI2NTAzMA==", "bodyText": "Consider const auto* to make constness and pointer more explicitly visible", "url": "https://github.com/vespa-engine/vespa/pull/15836#discussion_r544265030", "createdAt": "2020-12-16T12:38:04Z", "author": {"login": "vekterli"}, "path": "storage/src/vespa/storage/distributor/distributormessagesender.cpp", "diffHunk": "@@ -10,9 +10,10 @@ DistributorMessageSender::sendToNode(const lib::NodeType& nodeType, uint16_t nod\n                                      const std::shared_ptr<api::StorageCommand> & cmd, bool useDocumentAPI)\n {\n     cmd->setSourceIndex(getDistributorIndex());\n+    auto cluster_np = cluster_context().cluster_name_ptr();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8044382d3c4a0190561302799c6612b157fb8840"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQyMDQ0MDAxOnYy", "diffSide": "RIGHT", "path": "storage/src/tests/distributor/dummy_cluster_context.h", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxMzo0Mjo1MlrOIHF5Eg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxMzo0Mjo1MlrOIHF5Eg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDMwNzQ3NA==", "bodyText": "Please add copyright", "url": "https://github.com/vespa-engine/vespa/pull/15836#discussion_r544307474", "createdAt": "2020-12-16T13:42:52Z", "author": {"login": "geirst"}, "path": "storage/src/tests/distributor/dummy_cluster_context.h", "diffHunk": "@@ -0,0 +1,11 @@\n+#pragma once", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8044382d3c4a0190561302799c6612b157fb8840"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQyMDQ0MjM4OnYy", "diffSide": "RIGHT", "path": "storage/src/vespa/storage/common/cluster_context.h", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxMzo0MzoyN1rOIHF6lA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxMzo0MzoyN1rOIHF6lA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDMwNzg2MA==", "bodyText": "Please add class comment.", "url": "https://github.com/vespa-engine/vespa/pull/15836#discussion_r544307860", "createdAt": "2020-12-16T13:43:27Z", "author": {"login": "geirst"}, "path": "storage/src/vespa/storage/common/cluster_context.h", "diffHunk": "@@ -0,0 +1,36 @@\n+// Copyright Verizon Media. Licensed under the terms of the Apache 2.0 license. See LICENSE in the project root.\n+\n+#pragma once\n+\n+#include <vespa/vespalib/stllike/string.h>\n+\n+namespace storage {\n+\n+struct ClusterContext {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8044382d3c4a0190561302799c6612b157fb8840"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQyMDQ2NzI3OnYy", "diffSide": "RIGHT", "path": "storage/src/vespa/storage/persistence/bucketownershipnotifier.cpp", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxMzo0ODoyOVrOIHGI2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxMzo0ODoyOVrOIHGI2Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDMxMTUxMw==", "bodyText": "Consider const auto*", "url": "https://github.com/vespa-engine/vespa/pull/15836#discussion_r544311513", "createdAt": "2020-12-16T13:48:29Z", "author": {"login": "vekterli"}, "path": "storage/src/vespa/storage/persistence/bucketownershipnotifier.cpp", "diffHunk": "@@ -59,7 +59,8 @@ BucketOwnershipNotifier::sendNotifyBucketToDistributor(\n     }\n     auto notifyCmd = std::make_shared<api::NotifyBucketChangeCommand>(bucket, infoToSend);\n \n-    notifyCmd->setAddress(api::StorageMessageAddress::create(&_component.getClusterName(), lib::NodeType::DISTRIBUTOR, distributorIndex));\n+    auto cluster_np = _component.cluster_context().cluster_name_ptr();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8044382d3c4a0190561302799c6612b157fb8840"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQyMDQ2OTc2OnYy", "diffSide": "RIGHT", "path": "storage/src/vespa/storage/storageserver/mergethrottler.cpp", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxMzo0OTowMlrOIHGKTg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxMzo0OTowMlrOIHGKTg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDMxMTg4Ng==", "bodyText": "Consider const auto*", "url": "https://github.com/vespa-engine/vespa/pull/15836#discussion_r544311886", "createdAt": "2020-12-16T13:49:02Z", "author": {"login": "vekterli"}, "path": "storage/src/vespa/storage/storageserver/mergethrottler.cpp", "diffHunk": "@@ -373,7 +373,8 @@ MergeThrottler::forwardCommandToNode(\n                     mergeCmd.getMaxTimestamp(),\n                     mergeCmd.getClusterStateVersion(),\n                     newChain));\n-    fwdMerge->setAddress(api::StorageMessageAddress::create(&_component.getClusterName(), lib::NodeType::STORAGE, nodeIndex));\n+    auto cluster_np = _component.cluster_context().cluster_name_ptr();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8044382d3c4a0190561302799c6612b157fb8840"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQyMDQ3MTQxOnYy", "diffSide": "RIGHT", "path": "storage/src/vespa/storage/common/cluster_context.h", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxMzo0OToyOVrOIHGLXw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxMzo0OToyOVrOIHGLXw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDMxMjE1OQ==", "bodyText": "Consider adding a noexcept specifier to this", "url": "https://github.com/vespa-engine/vespa/pull/15836#discussion_r544312159", "createdAt": "2020-12-16T13:49:29Z", "author": {"login": "vekterli"}, "path": "storage/src/vespa/storage/common/cluster_context.h", "diffHunk": "@@ -0,0 +1,36 @@\n+// Copyright Verizon Media. Licensed under the terms of the Apache 2.0 license. See LICENSE in the project root.\n+\n+#pragma once\n+\n+#include <vespa/vespalib/stllike/string.h>\n+\n+namespace storage {\n+\n+struct ClusterContext {\n+protected:\n+    virtual ~ClusterContext() = default;\n+public:\n+    // returns a pointer to the cluster name\n+    // must be a valid pointer to a constant string for the\n+    // lifetime of all the components that may ask for it\n+    virtual const vespalib::string * cluster_name_ptr() const = 0;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8044382d3c4a0190561302799c6612b157fb8840"}, "originalPosition": 16}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2059, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}