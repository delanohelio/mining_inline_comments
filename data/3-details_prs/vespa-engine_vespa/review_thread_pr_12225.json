{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc2MTgwMDY4", "number": 12225, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxMDoxNzo1OFrODh1GGw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxMDoyMjowN1rODh1Ldw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2Nzk5NTE1OnYy", "diffSide": "RIGHT", "path": "searchcore/src/vespa/searchcore/proton/server/searchview.cpp", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxMDoxNzo1OFrOFsyEtA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMlQyMTo0ODoyMVrOFtNC7g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjUwMjA2OA==", "bodyText": "I do not like this const-cast. Maybe this function should not be const (since it is allowed to change the object state).", "url": "https://github.com/vespa-engine/vespa/pull/12225#discussion_r382502068", "createdAt": "2020-02-21T10:17:58Z", "author": {"login": "havardpe"}, "path": "searchcore/src/vespa/searchcore/proton/server/searchview.cpp", "diffHunk": "@@ -161,8 +161,9 @@ SearchView::getDocsumsInternal(const DocsumRequest & req)\n }\n \n std::unique_ptr<SearchReply>\n-SearchView::match(const ISearchHandler::SP &self, const SearchRequest &req, ThreadBundle &threadBundle) const {\n-    return _matchView->match(self, req, threadBundle);\n+SearchView::match(const SearchRequest &req, ThreadBundle &threadBundle) const {\n+    ISearchHandler::SP self = const_cast<SearchView *>(this)->shared_from_this();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4a01e6c3b85eb18ece1c4b5d9f337b08ba3b76d"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjk0Mzk4Mg==", "bodyText": "Const cast was not necessary. Just passing a const ISearchHandler was sufficient.", "url": "https://github.com/vespa-engine/vespa/pull/12225#discussion_r382943982", "createdAt": "2020-02-22T21:48:21Z", "author": {"login": "baldersheim"}, "path": "searchcore/src/vespa/searchcore/proton/server/searchview.cpp", "diffHunk": "@@ -161,8 +161,9 @@ SearchView::getDocsumsInternal(const DocsumRequest & req)\n }\n \n std::unique_ptr<SearchReply>\n-SearchView::match(const ISearchHandler::SP &self, const SearchRequest &req, ThreadBundle &threadBundle) const {\n-    return _matchView->match(self, req, threadBundle);\n+SearchView::match(const SearchRequest &req, ThreadBundle &threadBundle) const {\n+    ISearchHandler::SP self = const_cast<SearchView *>(this)->shared_from_this();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjUwMjA2OA=="}, "originalCommit": {"oid": "c4a01e6c3b85eb18ece1c4b5d9f337b08ba3b76d"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2ODAwODg3OnYy", "diffSide": "RIGHT", "path": "searchcore/src/vespa/searchcore/proton/server/searchview.h", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxMDoyMjowN1rOFsyM1Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMlQyMDozMjowM1rOFtMxrQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjUwNDE0OQ==", "bodyText": "A class inheriting from enable_shared_from_this should pass itself as template parameter.\nAlso consider making the constructors private and replace them with static create functions returning shared pointers to ensure that objects are actually owned by shared pointers.", "url": "https://github.com/vespa-engine/vespa/pull/12225#discussion_r382504149", "createdAt": "2020-02-21T10:22:07Z", "author": {"login": "havardpe"}, "path": "searchcore/src/vespa/searchcore/proton/server/searchview.h", "diffHunk": "@@ -8,7 +8,7 @@\n \n namespace proton {\n \n-class SearchView : public ISearchHandler\n+class SearchView : public ISearchHandler, public std::enable_shared_from_this<ISearchHandler>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4a01e6c3b85eb18ece1c4b5d9f337b08ba3b76d"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjkzOTU2NQ==", "bodyText": "Fixed.", "url": "https://github.com/vespa-engine/vespa/pull/12225#discussion_r382939565", "createdAt": "2020-02-22T20:32:03Z", "author": {"login": "baldersheim"}, "path": "searchcore/src/vespa/searchcore/proton/server/searchview.h", "diffHunk": "@@ -8,7 +8,7 @@\n \n namespace proton {\n \n-class SearchView : public ISearchHandler\n+class SearchView : public ISearchHandler, public std::enable_shared_from_this<ISearchHandler>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjUwNDE0OQ=="}, "originalCommit": {"oid": "c4a01e6c3b85eb18ece1c4b5d9f337b08ba3b76d"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2410, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}