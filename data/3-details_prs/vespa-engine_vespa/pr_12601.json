{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg5ODk4NjYz", "number": 12601, "title": "Bjorncs/implicit access control", "bodyText": "", "createdAt": "2020-03-17T15:14:34Z", "url": "https://github.com/vespa-engine/vespa/pull/12601", "merged": true, "mergeCommit": {"oid": "476d295ec2d3a6e4d980d989a1747b5afec1b29b"}, "closed": true, "closedAt": "2020-03-18T10:20:30Z", "author": {"login": "bjorncs"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcOjYmRAH2gAyMzg5ODk4NjYzOmNkOTRmZTlkODYxOTg3M2IwNjZjM2RkZTk4NmYwZWU4N2YwOWUwMmQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcO0islgFqTM3NjcyNTAwNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "cd94fe9d8619873b066c3dde986f0ee87f09e02d", "author": {"user": {"login": "bjorncs", "name": "Bj\u00f8rn Christian Seime"}}, "url": "https://github.com/vespa-engine/vespa/commit/cd94fe9d8619873b066c3dde986f0ee87f09e02d", "committedDate": "2020-03-17T14:14:34Z", "message": "Extract to method 'isHostedTenantApplication'"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "100a45031e31c0c3dbd64bb8d1fd07dd94c02208", "author": {"user": {"login": "bjorncs", "name": "Bj\u00f8rn Christian Seime"}}, "url": "https://github.com/vespa-engine/vespa/commit/100a45031e31c0c3dbd64bb8d1fd07dd94c02208", "committedDate": "2020-03-17T14:14:34Z", "message": "Move call to 'addImplicitHttpIfPresent' up one level and rename"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "58c77c37f204b724c71a1dfad2ef25fcbd3a5a25", "author": {"user": {"login": "bjorncs", "name": "Bj\u00f8rn Christian Seime"}}, "url": "https://github.com/vespa-engine/vespa/commit/58c77c37f204b724c71a1dfad2ef25fcbd3a5a25", "committedDate": "2020-03-17T14:14:34Z", "message": "Make method private"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d0e879d09ed8f63bab738b461a7365d5be292c7c", "author": {"user": {"login": "bjorncs", "name": "Bj\u00f8rn Christian Seime"}}, "url": "https://github.com/vespa-engine/vespa/commit/d0e879d09ed8f63bab738b461a7365d5be292c7c", "committedDate": "2020-03-17T14:14:34Z", "message": "Group public methods above private"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3a48cdb53107e1be7112d711bfda77790cbdefff", "author": {"user": {"login": "bjorncs", "name": "Bj\u00f8rn Christian Seime"}}, "url": "https://github.com/vespa-engine/vespa/commit/3a48cdb53107e1be7112d711bfda77790cbdefff", "committedDate": "2020-03-17T14:14:34Z", "message": "Combine 'setHandlers' + 'setServlets' to single method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8c4c00e79390ce4d670ed1482e6f777e5c86461f", "author": {"user": {"login": "bjorncs", "name": "Bj\u00f8rn Christian Seime"}}, "url": "https://github.com/vespa-engine/vespa/commit/8c4c00e79390ce4d670ed1482e6f777e5c86461f", "committedDate": "2020-03-17T14:15:22Z", "message": "Add implicit access control for hosted tenant applications"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2ae2b42dc0c323e8965918078bee538f746cdf31", "author": {"user": {"login": "bjorncs", "name": "Bj\u00f8rn Christian Seime"}}, "url": "https://github.com/vespa-engine/vespa/commit/2ae2b42dc0c323e8965918078bee538f746cdf31", "committedDate": "2020-03-17T15:11:36Z", "message": "Prefer Athenz domain from deploy properties\n\nOnly use domain from 'access-control' if domain is not provided by\ndeploy properties. Make 'domain' in 'access-control' optional."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3001a98e3e6799f569c5852151b579495ccb53b6", "author": {"user": {"login": "bjorncs", "name": "Bj\u00f8rn Christian Seime"}}, "url": "https://github.com/vespa-engine/vespa/commit/3001a98e3e6799f569c5852151b579495ccb53b6", "committedDate": "2020-03-17T15:38:15Z", "message": "Add Athenz domain to TestProperties"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "96808803dda3cc863056599b27656a3ee43ebcc7", "author": {"user": {"login": "bjorncs", "name": "Bj\u00f8rn Christian Seime"}}, "url": "https://github.com/vespa-engine/vespa/commit/96808803dda3cc863056599b27656a3ee43ebcc7", "committedDate": "2020-03-17T15:38:15Z", "message": "Test that access control is implicitly added for hosted apps"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2Mzc5MTEw", "url": "https://github.com/vespa-engine/vespa/pull/12601#pullrequestreview-376379110", "createdAt": "2020-03-17T20:26:13Z", "commit": {"oid": "2ae2b42dc0c323e8965918078bee538f746cdf31"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QyMDoyNjoxM1rOF3stnw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QyMDoyNjoxM1rOF3stnw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzk0ODU3NQ==", "bodyText": "will this fail the first redeploy (after config server is upgraded) ? or will this only be evaluated when application is deployed with the new version?", "url": "https://github.com/vespa-engine/vespa/pull/12601#discussion_r393948575", "createdAt": "2020-03-17T20:26:13Z", "author": {"login": "tokle"}, "path": "config-model/src/main/java/com/yahoo/vespa/model/container/http/xml/HttpBuilder.java", "diffHunk": "@@ -79,6 +82,28 @@ private AccessControl buildAccessControl(DeployState deployState, AbstractConfig\n         return builder.build();\n     }\n \n+    // TODO Fail if domain is not provided through deploy properties\n+    private static AthenzDomain getAccessControlDomain(DeployState deployState, Element accessControlElem) {\n+        AthenzDomain tenantDomain = deployState.getProperties().athenzDomain().orElse(null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ae2b42dc0c323e8965918078bee538f746cdf31"}, "originalPosition": 32}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a41f870975382beaa403111db7f7440509a884ad", "author": {"user": {"login": "bjorncs", "name": "Bj\u00f8rn Christian Seime"}}, "url": "https://github.com/vespa-engine/vespa/commit/a41f870975382beaa403111db7f7440509a884ad", "committedDate": "2020-03-18T10:08:46Z", "message": "Fix check for non-identical domains"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2NzI1MDA0", "url": "https://github.com/vespa-engine/vespa/pull/12601#pullrequestreview-376725004", "createdAt": "2020-03-18T10:13:59Z", "commit": {"oid": "a41f870975382beaa403111db7f7440509a884ad"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2716, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}