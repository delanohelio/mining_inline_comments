{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcwMDE4MDY5", "number": 14095, "title": "Reapply \"Throw exception instead of returning null when reading application id\"", "bodyText": "", "createdAt": "2020-08-19T08:51:45Z", "url": "https://github.com/vespa-engine/vespa/pull/14095", "merged": true, "mergeCommit": {"oid": "9df7e34d0866a2ce30f4b573476eab3d5ac2d050"}, "closed": true, "closedAt": "2020-08-19T12:22:55Z", "author": {"login": "hmusum"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdAXdbsAH2gAyNDcwMDE4MDY5OjJkODAxMzU5MmI1MjA3M2Y0ODY5N2Q4OTk3NzhiMmY4YzIwYjZjMzQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdAasAZAFqTQ3MDQwMTkxNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2d8013592b52073f48697d899778b2f8c20b6c34", "author": {"user": {"login": "hmusum", "name": "Harald Musum"}}, "url": "https://github.com/vespa-engine/vespa/commit/2d8013592b52073f48697d899778b2f8c20b6c34", "committedDate": "2020-08-19T08:37:12Z", "message": "Revert \"Revert \"Throw exception instead of returning null when reading application id\u2026\"\""}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5237d30ab21f17bf69b7ad817a48d85eb8f9f6a8", "author": {"user": {"login": "hmusum", "name": "Harald Musum"}}, "url": "https://github.com/vespa-engine/vespa/commit/5237d30ab21f17bf69b7ad817a48d85eb8f9f6a8", "committedDate": "2020-08-19T08:49:25Z", "message": "Add and use getOptionalApplicationId in some places\n\nIn some scenarios data might be missing in ZooKeeper, in those\ncases handle that instead of failing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6e61a311040ffd2c7ee00410fa85ade70f77d5b6", "author": {"user": {"login": "hmusum", "name": "Harald Musum"}}, "url": "https://github.com/vespa-engine/vespa/commit/6e61a311040ffd2c7ee00410fa85ade70f77d5b6", "committedDate": "2020-08-19T09:58:38Z", "message": "Add test of expiring a local session that has no zookeeper data"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "441c5945add33a4b7f643c167272a9ce8e7fcff8", "author": {"user": {"login": "hmusum", "name": "Harald Musum"}}, "url": "https://github.com/vespa-engine/vespa/commit/441c5945add33a4b7f643c167272a9ce8e7fcff8", "committedDate": "2020-08-19T10:02:06Z", "message": "Fix comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcwMzE0NTMy", "url": "https://github.com/vespa-engine/vespa/pull/14095#pullrequestreview-470314532", "createdAt": "2020-08-19T10:10:51Z", "commit": {"oid": "5237d30ab21f17bf69b7ad817a48d85eb8f9f6a8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxMDoxMDo1MlrOHDAj-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxMDoxMDo1MlrOHDAj-g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjkxNjk4Ng==", "bodyText": "It would perhaps be better if the readApplicationId() returned an optional, and getApplicationId() threw on empty? I fear something else may go wrong, and we then believe that was because the id didn't exist, even though it does.", "url": "https://github.com/vespa-engine/vespa/pull/14095#discussion_r472916986", "createdAt": "2020-08-19T10:10:52Z", "author": {"login": "jonmv"}, "path": "configserver/src/main/java/com/yahoo/vespa/config/server/session/Session.java", "diffHunk": "@@ -134,8 +134,18 @@ public void setAthenzDomain(Optional<AthenzDomain> athenzDomain) {\n         sessionZooKeeperClient.writeAthenzDomain(athenzDomain);\n     }\n \n+    /** Returns application id read from ZooKeeper. Will throw RuntimeException if not found */\n     public ApplicationId getApplicationId() { return sessionZooKeeperClient.readApplicationId(); }\n \n+    /** Returns application id read from ZooKeeper. Will return Optional.empty() if not found */\n+    public Optional<ApplicationId> getOptionalApplicationId() {\n+        try {\n+            return Optional.of(getApplicationId());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5237d30ab21f17bf69b7ad817a48d85eb8f9f6a8"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d286ae0b58047a439b67c6f68137e0f7d72fd764", "author": {"user": {"login": "hmusum", "name": "Harald Musum"}}, "url": "https://github.com/vespa-engine/vespa/commit/d286ae0b58047a439b67c6f68137e0f7d72fd764", "committedDate": "2020-08-19T12:05:00Z", "message": "Return Optional when reading application id from zookeeper"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcwNDAxOTE1", "url": "https://github.com/vespa-engine/vespa/pull/14095#pullrequestreview-470401915", "createdAt": "2020-08-19T12:22:50Z", "commit": {"oid": "d286ae0b58047a439b67c6f68137e0f7d72fd764"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4414, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}