{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgxMDc2MjMy", "number": 14304, "title": "Balder/group commits to tls 2 remaining rebased", "bodyText": "@toregge PR\nThis is #14286 pluss the last commit that uses the scheduler for regular commit.", "createdAt": "2020-09-07T06:06:09Z", "url": "https://github.com/vespa-engine/vespa/pull/14304", "merged": true, "mergeCommit": {"oid": "bf725254e886c67df4df14b6a0a2990186867ea7"}, "closed": true, "closedAt": "2020-09-07T13:06:02Z", "author": {"login": "baldersheim"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdGMerYgH2gAyNDgxMDc2MjMyOjc2ZWM2ZTc1NjU2ZGQ5NDRlYTYxZGU0NmRiZmQ1ZDExNzNmM2JiODE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdGiZKLAH2gAyNDgxMDc2MjMyOjk5ZDM5NzRmOGRiYjk1Yzc5N2QzMmRjYWYzOWI3MThjZGU0OWE2YzE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "76ec6e75656dd944ea61de46dbfd5d1173f3bb81", "author": {"user": {"login": "baldersheim", "name": "Henning Baldersheim"}}, "url": "https://github.com/vespa-engine/vespa/commit/76ec6e75656dd944ea61de46dbfd5d1173f3bb81", "committedDate": "2020-09-06T11:13:09Z", "message": "Group commits to TLS and sync (resurrected)."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e63ea578a31339bd8cf3a473fdda288be9c01725", "author": {"user": {"login": "baldersheim", "name": "Henning Baldersheim"}}, "url": "https://github.com/vespa-engine/vespa/commit/e63ea578a31339bd8cf3a473fdda288be9c01725", "committedDate": "2020-09-06T11:13:10Z", "message": "Also consider doing compression."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "50af9d8d0119b42dc71ff57e271a9b5a3711d2f1", "author": {"user": {"login": "baldersheim", "name": "Henning Baldersheim"}}, "url": "https://github.com/vespa-engine/vespa/commit/50af9d8d0119b42dc71ff57e271a9b5a3711d2f1", "committedDate": "2020-09-06T11:13:10Z", "message": "Follow fsync config."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4023193782d0364ecc3dcca7ecd7daceca2a4c87", "author": {"user": {"login": "baldersheim", "name": "Henning Baldersheim"}}, "url": "https://github.com/vespa-engine/vespa/commit/4023193782d0364ecc3dcca7ecd7daceca2a4c87", "committedDate": "2020-09-06T11:13:10Z", "message": "Avoid negation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f6efaa2a9b9d71912372fec609d7496ca1e072fa", "author": {"user": {"login": "baldersheim", "name": "Henning Baldersheim"}}, "url": "https://github.com/vespa-engine/vespa/commit/f6efaa2a9b9d71912372fec609d7496ca1e072fa", "committedDate": "2020-09-06T11:13:10Z", "message": "Use NONE as default for now"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f84faaddbcbbcf78156a07ff614e8d8a6f390083", "author": {"user": {"login": "baldersheim", "name": "Henning Baldersheim"}}, "url": "https://github.com/vespa-engine/vespa/commit/f84faaddbcbbcf78156a07ff614e8d8a6f390083", "committedDate": "2020-09-06T11:13:10Z", "message": "Update expected error message."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eb69db8a095ae681cbfe23a7c2978b5af5b77be3", "author": {"user": {"login": "baldersheim", "name": "Henning Baldersheim"}}, "url": "https://github.com/vespa-engine/vespa/commit/eb69db8a095ae681cbfe23a7c2978b5af5b77be3", "committedDate": "2020-09-07T06:02:11Z", "message": "Use the scheduler to regulary commit operations to the TLS."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgzNDU4MTYz", "url": "https://github.com/vespa-engine/vespa/pull/14304#pullrequestreview-483458163", "createdAt": "2020-09-07T10:48:32Z", "commit": {"oid": "eb69db8a095ae681cbfe23a7c2978b5af5b77be3"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QxMDo0ODozM1rOHN6mng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QxMDo0ODozM1rOHN6mng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDM1MzY5NA==", "bodyText": "This looks like a memory leak. You'll need to remember the task, and call Kill() as part of teardown.", "url": "https://github.com/vespa-engine/vespa/pull/14304#discussion_r484353694", "createdAt": "2020-09-07T10:48:33Z", "author": {"login": "toregge"}, "path": "searchlib/src/vespa/searchlib/transactionlog/translogserver.cpp", "diffHunk": "@@ -144,6 +167,9 @@ TransLogServer::TransLogServer(const vespalib::string &name, int listenPort, con\n         throw std::runtime_error(make_string(\"Failed creating tls base dir %s r(%d), e(%d). Requires manual intervention.\", _baseDir.c_str(), retval, errno));\n     }\n     start(*_threadPool);\n+    double chunkAgeLimit = vespalib::to_s(_domainConfig.getChunkAgeLimit());\n+    auto staleCommitTask = new StaleCommitTask(_supervisor->GetScheduler(), *this, chunkAgeLimit);\n+    staleCommitTask->ScheduleNow();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eb69db8a095ae681cbfe23a7c2978b5af5b77be3"}, "originalPosition": 36}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "99d3974f8dbb95c797d32dcaf39b718cde49a6c1", "author": {"user": {"login": "baldersheim", "name": "Henning Baldersheim"}}, "url": "https://github.com/vespa-engine/vespa/commit/99d3974f8dbb95c797d32dcaf39b718cde49a6c1", "committedDate": "2020-09-07T12:45:02Z", "message": "Properly clean up stale commit task. Also reduce visibility of code."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4305, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}