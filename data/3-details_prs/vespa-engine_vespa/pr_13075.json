{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA5MTc2NjQy", "number": 13075, "title": "Prepare for making persistence layer async.", "bodyText": "Avoid state in the thread.\n@vekterli PR", "createdAt": "2020-04-26T23:13:10Z", "url": "https://github.com/vespa-engine/vespa/pull/13075", "merged": true, "mergeCommit": {"oid": "b9e615474174e8f62314cbb614ec090a770db444"}, "closed": true, "closedAt": "2020-04-27T08:53:29Z", "author": {"login": "baldersheim"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcbjAZggH2gAyNDA5MTc2NjQyOjQ2NjNmZDNmYWI1ZWU0ZDdhMDBjNzU0OWE5NjYyOGQ0NGYyN2NhNmQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcbrTxUgH2gAyNDA5MTc2NjQyOjM5MTU4MGVlZmJlY2MzYTk3YTg1MjdhNzlhMDJlODY4N2M4ZGI0NmE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4663fd3fab5ee4d7a00c7549a96628d44f27ca6d", "author": {"user": {"login": "baldersheim", "name": "Henning Baldersheim"}}, "url": "https://github.com/vespa-engine/vespa/commit/4663fd3fab5ee4d7a00c7549a96628d44f27ca6d", "committedDate": "2020-04-26T23:09:09Z", "message": "Prepare for making persistence layer async.\nAvoid state in the thread."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwNzM5ODEy", "url": "https://github.com/vespa-engine/vespa/pull/13075#pullrequestreview-400739812", "createdAt": "2020-04-27T08:36:56Z", "commit": {"oid": "4663fd3fab5ee4d7a00c7549a96628d44f27ca6d"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QwODozNjo1NlrOGMXdyw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QwODozODozMFrOGMXh2w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTYyMDU1NQ==", "bodyText": "Super nitpick: missing leading space", "url": "https://github.com/vespa-engine/vespa/pull/13075#discussion_r415620555", "createdAt": "2020-04-27T08:36:56Z", "author": {"login": "vekterli"}, "path": "storage/src/vespa/storage/persistence/persistencethread.cpp", "diffHunk": "@@ -934,7 +933,10 @@ PersistenceThread::flushAllReplies(\n         }\n #endif\n         spi::Bucket b(bucket, spi::PartitionId(_env._partition));\n-        spi::Result result = _spi.flush(b, _context);\n+        // Flush is not used for anything currentlu, and the context is not correct either when batching is done\n+        //So just faking it here.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4663fd3fab5ee4d7a00c7549a96628d44f27ca6d"}, "originalPosition": 368}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTYyMTU5NQ==", "bodyText": "Consider removing now outdated comment for this line regarding old _context", "url": "https://github.com/vespa-engine/vespa/pull/13075#discussion_r415621595", "createdAt": "2020-04-27T08:38:30Z", "author": {"login": "vekterli"}, "path": "storage/src/vespa/storage/persistence/persistencethread.cpp", "diffHunk": "@@ -186,9 +185,9 @@ PersistenceThread::handleGet(api::GetCommand& cmd)\n     document::FieldSetRepo repo;\n     document::FieldSet::UP fieldSet = repo.parse(*_env._component.getTypeRepo(), cmd.getFieldSet());\n     // _context is reset per command, so it's safe to modify it like this.\n-    _context.setReadConsistency(api_read_consistency_to_spi(cmd.internal_read_consistency()));\n+    context.setReadConsistency(api_read_consistency_to_spi(cmd.internal_read_consistency()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4663fd3fab5ee4d7a00c7549a96628d44f27ca6d"}, "originalPosition": 100}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "391580eefbecc3a97a8527a79a02e8687c8db46a", "author": {"user": {"login": "baldersheim", "name": "Henning Baldersheim"}}, "url": "https://github.com/vespa-engine/vespa/commit/391580eefbecc3a97a8527a79a02e8687c8db46a", "committedDate": "2020-04-27T08:49:33Z", "message": "Update comments to reflect reality."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3269, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}