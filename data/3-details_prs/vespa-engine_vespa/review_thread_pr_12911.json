{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAzMzA1Njkw", "number": 12911, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwNzozODoyMVrODx82-A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwODo0Nzo1MFrODx-aRA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzNzAzOTI4OnYy", "diffSide": "RIGHT", "path": "document/src/test/java/com/yahoo/document/IdIdStringTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwNzozODoyMVrOGFtdOw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwNzozODoyMVrOGFtdOw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODY0MDgyNw==", "bodyText": "s/Namspace/Namespace/", "url": "https://github.com/vespa-engine/vespa/pull/12911#discussion_r408640827", "createdAt": "2020-04-15T07:38:21Z", "author": {"login": "vekterli"}, "path": "document/src/test/java/com/yahoo/document/IdIdStringTest.java", "diffHunk": "@@ -59,6 +62,35 @@ public void requireThatKeysWithoutValuesThrow() throws Exception {\n             new IdIdString(\"namespace\", \"type\", \"illegal-pair\", \"foo\");\n             fail();\n         } catch (IllegalArgumentException e) {\n+            assertEquals(\"Illegal key-value pair 'illegal-pair'\", e.getMessage());\n+        }\n+    }\n+\n+    @Test\n+    public void requireThatTooLongPreNamspaceSpecificThrowsWhileParsing() throws Exception {\n+        StringBuilder builder = new StringBuilder(\"id:\");\n+        for (int i = 0; i < 0x10000; i++) {\n+            builder.append('n');\n+        }\n+        builder.append(\":type::namespacespecificpart_01\");\n+        try {\n+            IdString.createIdString(builder.toString());\n+            fail();\n+        } catch (IllegalArgumentException e) {\n+            assertEquals(\"Document id prior to the namespace specific part, 65545, is longer than 65534\", e.getMessage().substring(0, 77));\n+        }\n+    }\n+    @Test\n+    public void requireThatTooLongPreNamspaceSpecificThrowsOnConstruction() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9125d1651742481bdd359b7288a171c57e7b6b54"}, "originalPosition": 43}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzNzAzOTQzOnYy", "diffSide": "RIGHT", "path": "document/src/test/java/com/yahoo/document/IdIdStringTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwNzozODoyNVrOGFtdWA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwNzozODoyNVrOGFtdWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODY0MDg1Ng==", "bodyText": "s/Namspace/Namespace/", "url": "https://github.com/vespa-engine/vespa/pull/12911#discussion_r408640856", "createdAt": "2020-04-15T07:38:25Z", "author": {"login": "vekterli"}, "path": "document/src/test/java/com/yahoo/document/IdIdStringTest.java", "diffHunk": "@@ -59,6 +62,35 @@ public void requireThatKeysWithoutValuesThrow() throws Exception {\n             new IdIdString(\"namespace\", \"type\", \"illegal-pair\", \"foo\");\n             fail();\n         } catch (IllegalArgumentException e) {\n+            assertEquals(\"Illegal key-value pair 'illegal-pair'\", e.getMessage());\n+        }\n+    }\n+\n+    @Test\n+    public void requireThatTooLongPreNamspaceSpecificThrowsWhileParsing() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9125d1651742481bdd359b7288a171c57e7b6b54"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzNzA4NTQzOnYy", "diffSide": "RIGHT", "path": "document/src/main/java/com/yahoo/document/idstring/IdIdString.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwNzo1MToxMVrOGFt5Iw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwNzo1MToxMVrOGFt5Iw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODY0Nzk3MQ==", "bodyText": "I think a quick comment on the significance of the number 5 would be nice here", "url": "https://github.com/vespa-engine/vespa/pull/12911#discussion_r408647971", "createdAt": "2020-04-15T07:51:11Z", "author": {"login": "vekterli"}, "path": "document/src/main/java/com/yahoo/document/idstring/IdIdString.java", "diffHunk": "@@ -47,6 +47,10 @@ public IdIdString(String namespace, String type, String keyValues, String localI\n         super(Scheme.id, namespace, localId);\n         this.type = type;\n         boolean hasSetLocation = false;\n+        if (namespace.length() + type.length() + keyValues.length() + 5 >= IdString.MAX_LENGTH_EXCEPT_NAMESPACE_SPECIFIC) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9125d1651742481bdd359b7288a171c57e7b6b54"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzNzI5MzQ4OnYy", "diffSide": "RIGHT", "path": "document/src/main/java/com/yahoo/document/idstring/IdString.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwODo0Nzo1MFrOGFv7LA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQwODo0Nzo1MFrOGFv7LA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODY4MTI2MA==", "bodyText": "0xffff - 1 due to actual offset being the next char after :, I presume? A tiny comment would be nice for future reference \ud83d\ude42", "url": "https://github.com/vespa-engine/vespa/pull/12911#discussion_r408681260", "createdAt": "2020-04-15T08:47:50Z", "author": {"login": "vekterli"}, "path": "document/src/main/java/com/yahoo/document/idstring/IdString.java", "diffHunk": "@@ -42,6 +42,7 @@ public String getGroup() {\n     private final String namespace;\n     private final String namespaceSpecific;\n     private Utf8String cache;\n+    static final int MAX_LENGTH_EXCEPT_NAMESPACE_SPECIFIC = 0xfffe;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9125d1651742481bdd359b7288a171c57e7b6b54"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1781, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}