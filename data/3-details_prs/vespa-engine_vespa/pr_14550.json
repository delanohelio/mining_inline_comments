{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkyOTIzNzcw", "number": 14550, "title": "Jonmv/async doc v1", "bodyText": "@bjorncs or @baldersheim please review.", "createdAt": "2020-09-25T08:38:07Z", "url": "https://github.com/vespa-engine/vespa/pull/14550", "merged": true, "mergeCommit": {"oid": "4209883f5e426652f22697a0bcec3e1dd2ef016f"}, "closed": true, "closedAt": "2020-09-25T11:12:47Z", "author": {"login": "jonmv"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdMQvhjgH2gAyNDkyOTIzNzcwOjBkMTJlNjY1MGMyMDc5OTI0MGViOTMyNGVmNDI2NzQ1ZDcwZWU1OGY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdMTJHogFqTQ5NjI5NjQyMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0d12e6650c20799240eb9324ef426745d70ee58f", "author": {"user": {"login": "jonmv", "name": "Jon Marius Venstad"}}, "url": "https://github.com/vespa-engine/vespa/commit/0d12e6650c20799240eb9324ef426745d70ee58f", "committedDate": "2020-09-25T07:34:43Z", "message": "Non-functional changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f6d6f0db9f6dab4a48aea33dd8c41b28ff624ad5", "author": {"user": {"login": "jonmv", "name": "Jon Marius Venstad"}}, "url": "https://github.com/vespa-engine/vespa/commit/f6d6f0db9f6dab4a48aea33dd8c41b28ff624ad5", "committedDate": "2020-09-25T07:53:42Z", "message": "Let the injectable lazy document access be specifically injected"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "17c6dc3a23badb17f468fe8b38bda57eab717a4c", "author": {"user": {"login": "jonmv", "name": "Jon Marius Venstad"}}, "url": "https://github.com/vespa-engine/vespa/commit/17c6dc3a23badb17f468fe8b38bda57eab717a4c", "committedDate": "2020-09-25T08:37:50Z", "message": "Eliminate config self-subscription from MessageBusDocumentAccess"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk2MjMyNDk3", "url": "https://github.com/vespa-engine/vespa/pull/14550#pullrequestreview-496232497", "createdAt": "2020-09-25T08:52:37Z", "commit": {"oid": "f6d6f0db9f6dab4a48aea33dd8c41b28ff624ad5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQwODo1MjozN1rOHX66-A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQwODo1MjozN1rOHX66-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDg0NDY2NA==", "bodyText": "This lets us use this in internal classes as well, without fear that the user may have configured their own DocumentAccess component.", "url": "https://github.com/vespa-engine/vespa/pull/14550#discussion_r494844664", "createdAt": "2020-09-25T08:52:37Z", "author": {"login": "jonmv"}, "path": "container-core/src/main/java/com/yahoo/container/core/documentapi/DocumentAccessProvider.java", "diffHunk": "@@ -27,18 +27,18 @@\n  *\n  * @author jonmv\n  */\n-public class MessageBusDocumentAccessProvider extends AbstractComponent implements Provider<DocumentAccess> {\n+public class DocumentAccessProvider extends AbstractComponent implements Provider<DocumentAccessProvider.LazyWrapper> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f6d6f0db9f6dab4a48aea33dd8c41b28ff624ad5"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2cd240de82eedbad02868290c89036e91d3f8e7d", "author": {"user": {"login": "jonmv", "name": "Jon Marius Venstad"}}, "url": "https://github.com/vespa-engine/vespa/commit/2cd240de82eedbad02868290c89036e91d3f8e7d", "committedDate": "2020-09-25T09:23:06Z", "message": "Move injectable lazy document access to top level and rename to VespaDocumentAccess"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1ce342752d01f2118688d9a7016944b98c4946b1", "author": {"user": {"login": "jonmv", "name": "Jon Marius Venstad"}}, "url": "https://github.com/vespa-engine/vespa/commit/1ce342752d01f2118688d9a7016944b98c4946b1", "committedDate": "2020-09-25T09:23:12Z", "message": "Update abi spec"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk2Mjc4NzY5", "url": "https://github.com/vespa-engine/vespa/pull/14550#pullrequestreview-496278769", "createdAt": "2020-09-25T09:55:19Z", "commit": {"oid": "1ce342752d01f2118688d9a7016944b98c4946b1"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQwOTo1NToyMFrOHX9GNA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQwOTo1NjoyOFrOHX9IdA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDg4MDMwOA==", "bodyText": "Add copyright header to your intellij template :)", "url": "https://github.com/vespa-engine/vespa/pull/14550#discussion_r494880308", "createdAt": "2020-09-25T09:55:20Z", "author": {"login": "bjorncs"}, "path": "container-core/src/main/java/com/yahoo/container/core/documentapi/DocumentAccessProvider.java", "diffHunk": "@@ -0,0 +1,38 @@\n+package com.yahoo.container.core.documentapi;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ce342752d01f2118688d9a7016944b98c4946b1"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDg4MDg4NA==", "bodyText": "Consider adding warning in log if self-subscription", "url": "https://github.com/vespa-engine/vespa/pull/14550#discussion_r494880884", "createdAt": "2020-09-25T09:56:28Z", "author": {"login": "bjorncs"}, "path": "documentapi/src/main/java/com/yahoo/documentapi/messagebus/MessageBusDocumentAccess.java", "diffHunk": "@@ -60,7 +60,9 @@ public MessageBusDocumentAccess(MessageBusParams params) {\n                 bus = new NetworkMessageBus(network, new MessageBus(network, mbusParams));\n             }\n             else {\n-                bus = new RPCMessageBus(mbusParams, params.getRPCNetworkParams(), params.getRoutingConfigId());\n+                bus = params.getRPCNetworkParams().getSlobroksConfig() != null && mbusParams.getMessageBusConfig() != null\n+                      ? new RPCMessageBus(mbusParams, params.getRPCNetworkParams()) // prefer without self-subscription if config is set\n+                      : new RPCMessageBus(mbusParams, params.getRPCNetworkParams(), params.getRoutingConfigId());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ce342752d01f2118688d9a7016944b98c4946b1"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e51cf8cde83e94a1ce33bdc1ff00301851f5f165", "author": {"user": {"login": "jonmv", "name": "Jon Marius Venstad"}}, "url": "https://github.com/vespa-engine/vespa/commit/e51cf8cde83e94a1ce33bdc1ff00301851f5f165", "committedDate": "2020-09-25T10:15:04Z", "message": "Log on self-subscroption and fix copyright hreaders"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "77978067f2c6eddedfbb08ae7abc732f18adfd8e", "author": {"user": {"login": "jonmv", "name": "Jon Marius Venstad"}}, "url": "https://github.com/vespa-engine/vespa/commit/77978067f2c6eddedfbb08ae7abc732f18adfd8e", "committedDate": "2020-09-25T10:18:14Z", "message": "Refer to correct class i config model"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk2Mjk2NDIx", "url": "https://github.com/vespa-engine/vespa/pull/14550#pullrequestreview-496296421", "createdAt": "2020-09-25T10:22:29Z", "commit": {"oid": "77978067f2c6eddedfbb08ae7abc732f18adfd8e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4214, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}