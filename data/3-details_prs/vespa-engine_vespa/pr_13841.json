{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ2MzgwODYy", "number": 13841, "title": "Skip communication manager thread for requests.", "bodyText": "@vekterli PR\n@geirst FYI", "createdAt": "2020-07-08T17:21:23Z", "url": "https://github.com/vespa-engine/vespa/pull/13841", "merged": true, "mergeCommit": {"oid": "c2a74c6e8d7b64fd237e36a4d5c886a387dcfaa0"}, "closed": true, "closedAt": "2020-07-09T10:20:08Z", "author": {"login": "baldersheim"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcy9w6mAH2gAyNDQ2MzgwODYyOjk3OTMxYjY5YmE4M2Q2MGJmNjg1YzNiYzMwZTBkYjAwY2E2OTcyZmI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABczMVOkAH2gAyNDQ2MzgwODYyOmU5MGNlNjBjZjQxMTBmZDdiMjA2YWQ0NzUxOTIxN2UxNTY3NTIwMGM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "97931b69ba83d60bf685c3bc30e0db00ca6972fb", "author": {"user": {"login": "baldersheim", "name": "Henning Baldersheim"}}, "url": "https://github.com/vespa-engine/vespa/commit/97931b69ba83d60bf685c3bc30e0db00ca6972fb", "committedDate": "2020-07-08T17:19:56Z", "message": "Skip communication manager thread for requests."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f5a7e90808220419841444ad1e8094087b0a8695", "author": {"user": {"login": "baldersheim", "name": "Henning Baldersheim"}}, "url": "https://github.com/vespa-engine/vespa/commit/f5a7e90808220419841444ad1e8094087b0a8695", "committedDate": "2020-07-08T20:33:04Z", "message": "Since requests are now exeuted by caller storge must be open to send anything."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3af0dfbc0f011a70259424d446a8a9f1bd9b994b", "author": {"user": {"login": "baldersheim", "name": "Henning Baldersheim"}}, "url": "https://github.com/vespa-engine/vespa/commit/3af0dfbc0f011a70259424d446a8a9f1bd9b994b", "committedDate": "2020-07-08T20:38:14Z", "message": "Remove assert that i snow possible during testing."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "637de9a2313414da6930f703e2a63eae4637d0e6", "author": {"user": {"login": "baldersheim", "name": "Henning Baldersheim"}}, "url": "https://github.com/vespa-engine/vespa/commit/637de9a2313414da6930f703e2a63eae4637d0e6", "committedDate": "2020-07-09T07:45:01Z", "message": "Config control over what treads to skip."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ1NDIwNzcx", "url": "https://github.com/vespa-engine/vespa/pull/13841#pullrequestreview-445420771", "createdAt": "2020-07-09T08:57:33Z", "commit": {"oid": "637de9a2313414da6930f703e2a63eae4637d0e6"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQwODo1NzozNFrOGvIEyg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOVQwOTowNzoyMFrOGvIa_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjA2ODU1NA==", "bodyText": "Consider renaming to something like process_or_enqueue since it's not immediately obvious from \"optionalEnqueue\" what happens if it doesn't enqueue", "url": "https://github.com/vespa-engine/vespa/pull/13841#discussion_r452068554", "createdAt": "2020-07-09T08:57:34Z", "author": {"login": "vekterli"}, "path": "storage/src/vespa/storage/storageserver/communicationmanager.cpp", "diffHunk": "@@ -437,6 +443,18 @@ CommunicationManager::process(const std::shared_ptr<api::StorageMessage>& msg)\n     }\n }\n \n+void\n+CommunicationManager::optionalEnqueue(std::shared_ptr<api::StorageMessage> msg)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "637de9a2313414da6930f703e2a63eae4637d0e6"}, "originalPosition": 63}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjA3MDY2MA==", "bodyText": "Is it safe to remove these abort-branches? If the link is not in a state where it's safe to process certain types of messages, the behavior is likely undefined", "url": "https://github.com/vespa-engine/vespa/pull/13841#discussion_r452070660", "createdAt": "2020-07-09T09:01:04Z", "author": {"login": "vekterli"}, "path": "storage/src/vespa/storage/common/storagelink.cpp", "diffHunk": "@@ -165,9 +165,9 @@ void StorageLink::sendUp(const shared_ptr<StorageMessage> & msg)\n         default:\n             LOG(error, \"Link %s trying to send %s up while in state %s\",\n                 toString().c_str(), msg->toString(true).c_str(), stateToString(getState()));\n-            assert(false);\n+            return;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "637de9a2313414da6930f703e2a63eae4637d0e6"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjA3NDIzNw==", "bodyText": "Is it currently safe to have thread-skipping be the default behavior for this constructor overload? Or should this be false, false instead?", "url": "https://github.com/vespa-engine/vespa/pull/13841#discussion_r452074237", "createdAt": "2020-07-09T09:07:20Z", "author": {"login": "vekterli"}, "path": "messagebus/src/vespa/messagebus/messagebus.cpp", "diffHunk": "@@ -112,7 +112,7 @@ MessageBus::MessageBus(INetwork &net, const MessageBusParams &params) :\n     _routingTables(),\n     _sessions(),\n     _protocolRepository(std::make_unique<ProtocolRepository>()),\n-    _msn(std::make_unique<Messenger>()),\n+    _msn(std::make_unique<Messenger>(true, true)),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "637de9a2313414da6930f703e2a63eae4637d0e6"}, "originalPosition": 21}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cbca38828c11f8d0e369b0e6a263ca5701796f59", "author": {"user": {"login": "baldersheim", "name": "Henning Baldersheim"}}, "url": "https://github.com/vespa-engine/vespa/commit/cbca38828c11f8d0e369b0e6a263ca5701796f59", "committedDate": "2020-07-09T09:26:07Z", "message": "Merge branch 'master' into balder/skip-communicationmanager-only"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "58af8c0af7cdcdd304995dd26f82f60760eaa9ec", "author": {"user": {"login": "baldersheim", "name": "Henning Baldersheim"}}, "url": "https://github.com/vespa-engine/vespa/commit/58af8c0af7cdcdd304995dd26f82f60760eaa9ec", "committedDate": "2020-07-09T09:28:43Z", "message": "optionalEnqueue -> enque_or_process"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e90ce60cf4110fd7b206ad47519217e15675200c", "author": {"user": {"login": "baldersheim", "name": "Henning Baldersheim"}}, "url": "https://github.com/vespa-engine/vespa/commit/e90ce60cf4110fd7b206ad47519217e15675200c", "committedDate": "2020-07-09T10:18:16Z", "message": "Re-add asserts"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3527, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}