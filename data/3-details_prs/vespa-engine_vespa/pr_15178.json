{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE1Mzg5NzEy", "number": 15178, "title": "Bjorncs/detect indexing mode change storeonly", "bodyText": "I confirm that this contribution is made under the terms of the license found in the root directory of this repository's source tree and that I have the authority necessary to make this contribution on behalf of its copyright owner.", "createdAt": "2020-11-04T13:35:36Z", "url": "https://github.com/vespa-engine/vespa/pull/15178", "merged": true, "mergeCommit": {"oid": "41cc23bb91e30d34efb60a8698ecccb188d12010"}, "closed": true, "closedAt": "2020-11-04T13:42:51Z", "author": {"login": "bjorncs"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdZKzL1AH2gAyNTE1Mzg5NzEyOjZiYTRhNmViZDVmMThmYTkxNTY1MjdmY2U3ODJhNWY1ZmMwZDY4YTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdZN-1CAFqTUyMzM3MDE3Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6ba4a6ebd5f18fa9156527fce782a5f5fc0d68a3", "author": {"user": {"login": "bjorncs", "name": "Bj\u00f8rn Christian Seime"}}, "url": "https://github.com/vespa-engine/vespa/commit/6ba4a6ebd5f18fa9156527fce782a5f5fc0d68a3", "committedDate": "2020-11-04T10:00:18Z", "message": "Expose document types that are store-only"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b5422be3a3e339540573fbed8063636644af603", "author": {"user": {"login": "bjorncs", "name": "Bj\u00f8rn Christian Seime"}}, "url": "https://github.com/vespa-engine/vespa/commit/8b5422be3a3e339540573fbed8063636644af603", "committedDate": "2020-11-04T10:14:50Z", "message": "Deduplicate and simplify logic for determing indexing mode"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bdd6068f43504027bc4bf2a04708486cc8ccbcb9", "author": {"user": {"login": "bjorncs", "name": "Bj\u00f8rn Christian Seime"}}, "url": "https://github.com/vespa-engine/vespa/commit/bdd6068f43504027bc4bf2a04708486cc8ccbcb9", "committedDate": "2020-11-04T13:34:50Z", "message": "Detect doctypes changing indexing-mode 'indexed' <=> 'store-only'"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIzMzY1NjQ3", "url": "https://github.com/vespa-engine/vespa/pull/15178#pullrequestreview-523365647", "createdAt": "2020-11-04T13:37:18Z", "commit": {"oid": "6ba4a6ebd5f18fa9156527fce782a5f5fc0d68a3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQxMzozNzoxOFrOHtYXsQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQxMzozNzoxOFrOHtYXsQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzM0NzI0OQ==", "bodyText": "Strange variabble type for a store-only set ;)", "url": "https://github.com/vespa-engine/vespa/pull/15178#discussion_r517347249", "createdAt": "2020-11-04T13:37:18Z", "author": {"login": "jonmv"}, "path": "config-model/src/main/java/com/yahoo/vespa/model/content/ContentSearchCluster.java", "diffHunk": "@@ -357,6 +357,18 @@ public void handleRedundancy(Redundancy redundancy) {\n         return indexedDocTypes;\n     }\n \n+    public List<NewDocumentType> getDocumentTypesWithStoreOnly() {\n+        List<NewDocumentType> indexedDocTypes = new ArrayList<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6ba4a6ebd5f18fa9156527fce782a5f5fc0d68a3"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIzMzY2ODk0", "url": "https://github.com/vespa-engine/vespa/pull/15178#pullrequestreview-523366894", "createdAt": "2020-11-04T13:38:47Z", "commit": {"oid": "6ba4a6ebd5f18fa9156527fce782a5f5fc0d68a3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQxMzozODo0OFrOHtYbMA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQxMzozODo0OFrOHtYbMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzM0ODE0NA==", "bodyText": "Could be simplified to ```\n( ! hasIndexedCluster() || ! getIndexed().hasDocumentDB(type.getFullName().getName()))", "url": "https://github.com/vespa-engine/vespa/pull/15178#discussion_r517348144", "createdAt": "2020-11-04T13:38:48Z", "author": {"login": "jonmv"}, "path": "config-model/src/main/java/com/yahoo/vespa/model/content/ContentSearchCluster.java", "diffHunk": "@@ -357,6 +357,18 @@ public void handleRedundancy(Redundancy redundancy) {\n         return indexedDocTypes;\n     }\n \n+    public List<NewDocumentType> getDocumentTypesWithStoreOnly() {\n+        List<NewDocumentType> indexedDocTypes = new ArrayList<>();\n+        for (NewDocumentType type : documentDefinitions.values()) {\n+            if (findStreamingCluster(type.getFullName().getName()).isEmpty() &&\n+                    (hasIndexedCluster() && !getIndexed().hasDocumentDB(type.getFullName().getName()) ||\n+                            !hasIndexedCluster())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6ba4a6ebd5f18fa9156527fce782a5f5fc0d68a3"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIzMzcwMTc3", "url": "https://github.com/vespa-engine/vespa/pull/15178#pullrequestreview-523370177", "createdAt": "2020-11-04T13:42:44Z", "commit": {"oid": "bdd6068f43504027bc4bf2a04708486cc8ccbcb9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2128, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}