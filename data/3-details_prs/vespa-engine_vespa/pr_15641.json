{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMxODIxMDgy", "number": 15641, "title": "Report reindexing progress as -1 for non-current states", "bodyText": "@hakonhall please review.", "createdAt": "2020-12-03T14:29:49Z", "url": "https://github.com/vespa-engine/vespa/pull/15641", "merged": true, "mergeCommit": {"oid": "8d824993bfe9573d3ea5336c48971b146d8b9b58"}, "closed": true, "closedAt": "2020-12-03T14:52:01Z", "author": {"login": "jonmv"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdikCFPgH2gAyNTMxODIxMDgyOjgxYTQ0N2JhMzIyOWRkYjY3NWNmNDQ2YWYxYzg0ZjNhZTU0MWQyYmQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdikWf4gH2gAyNTMxODIxMDgyOjZmMDNkZGIxM2Q0MWFlZTU2MjYxMWVhNDcyOTkzOGZkNmM4MTE4NjE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "81a447ba3229ddb675cf446af1c84f3ae541d2bd", "author": {"user": {"login": "jonmv", "name": "Jon Marius Venstad"}}, "url": "https://github.com/vespa-engine/vespa/commit/81a447ba3229ddb675cf446af1c84f3ae541d2bd", "committedDate": "2020-12-03T14:29:31Z", "message": "Report reindexing progress as -1 for non-current states"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0MDEwMTYy", "url": "https://github.com/vespa-engine/vespa/pull/15641#pullrequestreview-544010162", "createdAt": "2020-12-03T14:31:02Z", "commit": {"oid": "81a447ba3229ddb675cf446af1c84f3ae541d2bd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxNDozMTowMlrOH-eiIQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxNDozMTowMlrOH-eiIQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTI3NDAxNw==", "bodyText": ">= 0", "url": "https://github.com/vespa-engine/vespa/pull/15641#discussion_r535274017", "createdAt": "2020-12-03T14:31:02Z", "author": {"login": "hakonhall"}, "path": "clustercontroller-reindexer/src/main/java/ai/vespa/reindexing/ReindexingMetrics.java", "diffHunk": "@@ -26,12 +27,20 @@\n \n     void dump(Reindexing reindexing) {\n         reindexing.status().forEach((type, status) -> {\n+            Reindexing.State state = status.state();\n             metric.set(\"reindexing.progress\",\n                        status.progress().map(ProgressToken::percentFinished).map(percentage -> percentage * 1e-2)\n                              .orElse(status.state() == SUCCESSFUL ? 1.0 : 0.0),\n                        metric.createContext(Map.of(\"clusterid\", cluster,\n                                                    \"documenttype\", type.getName(),\n-                                                   \"state\", toString(status.state()))));\n+                                                   \"state\", toString(state))));\n+            // Set metric value to -1 for all states not currently active, so we only have one value >= at any given time.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "81a447ba3229ddb675cf446af1c84f3ae541d2bd"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0MDExOTQy", "url": "https://github.com/vespa-engine/vespa/pull/15641#pullrequestreview-544011942", "createdAt": "2020-12-03T14:32:33Z", "commit": {"oid": "81a447ba3229ddb675cf446af1c84f3ae541d2bd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6f03ddb13d41aee562611ea4729938fd6c811861", "author": {"user": {"login": "jonmv", "name": "Jon Marius Venstad"}}, "url": "https://github.com/vespa-engine/vespa/commit/6f03ddb13d41aee562611ea4729938fd6c811861", "committedDate": "2020-12-03T14:51:49Z", "message": "Fix typo"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3841, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}