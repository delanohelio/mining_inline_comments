{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ0NzM4NjQ4", "number": 15873, "title": "Jonmv/remove storage policy", "bodyText": "@vekterli", "createdAt": "2020-12-23T11:57:03Z", "url": "https://github.com/vespa-engine/vespa/pull/15873", "merged": true, "mergeCommit": {"oid": "f3d54a087fee498ac1669ad06da1724e2bdce4a8"}, "closed": true, "closedAt": "2021-01-05T09:08:29Z", "author": {"login": "jonmv"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdo-PHlAFqTU1NzgzNjY5Mw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABds5jZIgH2gAyNTQ0NzM4NjQ4OjNlMzJkMTk5ZmNhNmU5ZmQzNDdiYmVjNzVkN2NmMzBmNTZiOTkyNTM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU3ODM2Njkz", "url": "https://github.com/vespa-engine/vespa/pull/15873#pullrequestreview-557836693", "createdAt": "2020-12-23T12:24:50Z", "commit": {"oid": "d37f395ccb4db43ad6cb813412e7df5683363219"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QxMjoyNDo1MFrOIKjN6A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QxMjoyNDo1MFrOIKjN6A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzkzMzY3Mg==", "bodyText": "Oops, not intended to be here, but this is just removal of dead code that shouldn't be there in the first place.", "url": "https://github.com/vespa-engine/vespa/pull/15873#discussion_r547933672", "createdAt": "2020-12-23T12:24:50Z", "author": {"login": "jonmv"}, "path": "vespaclient-container-plugin/src/main/java/com/yahoo/document/restapi/resource/DocumentV1ApiHandler.java", "diffHunk": "@@ -377,10 +377,6 @@ private DocumentOperationParameters parametersFromRequest(HttpRequest request, S\n                                                           .map(parameters::withRoute)\n                                                           .orElse(parameters);\n                 break;\n-            case CONDITION:\n-                parameters = getProperty(request, ROUTE).map(parameters::withRoute)\n-                                                        .orElse(parameters);\n-                break;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d37f395ccb4db43ad6cb813412e7df5683363219"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7bf09c3200422d047100362c82de6e1fdf2b323c", "author": {"user": {"login": "aressem", "name": "Arnstein Ressem"}}, "url": "https://github.com/vespa-engine/vespa/commit/7bf09c3200422d047100362c82de6e1fdf2b323c", "committedDate": "2020-12-30T10:59:56Z", "message": "Revert \"Revert \"Merge StoragePolicy down into ContentPolicy, and always use this\"\""}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7efd5dfa1111e0aa94b97fbca06852de95258aa5", "author": {"user": {"login": "jonmv", "name": "Jon Marius Venstad"}}, "url": "https://github.com/vespa-engine/vespa/commit/7efd5dfa1111e0aa94b97fbca06852de95258aa5", "committedDate": "2020-12-30T10:59:56Z", "message": "Replace use of [Storage... with [Content... and avoid overriding config id"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ae314e6d20ba0f4e77e00c4bf3542c39cb3bef46", "author": {"user": {"login": "jonmv", "name": "Jon Marius Venstad"}}, "url": "https://github.com/vespa-engine/vespa/commit/ae314e6d20ba0f4e77e00c4bf3542c39cb3bef46", "committedDate": "2020-12-30T10:59:56Z", "message": "Use just content cluster name as route"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3ca9668a22041a80ffebc53924f5c5c244b484e8", "author": {"user": {"login": "jonmv", "name": "Jon Marius Venstad"}}, "url": "https://github.com/vespa-engine/vespa/commit/3ca9668a22041a80ffebc53924f5c5c244b484e8", "committedDate": "2020-12-30T10:59:56Z", "message": "Merge storagepolicy into contentpolicy"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "965d21f339ccca4fc042eab8c76d1d055fb0863b", "author": {"user": {"login": "jonmv", "name": "Jon Marius Venstad"}}, "url": "https://github.com/vespa-engine/vespa/commit/965d21f339ccca4fc042eab8c76d1d055fb0863b", "committedDate": "2020-12-30T10:59:56Z", "message": "Non-functional"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "347b8c50518599711bc390c137afd9b763fb66cf", "author": {"user": {"login": "jonmv", "name": "Jon Marius Venstad"}}, "url": "https://github.com/vespa-engine/vespa/commit/347b8c50518599711bc390c137afd9b763fb66cf", "committedDate": "2020-12-30T09:56:28Z", "message": "Merge storagepolicy into contentpolicy"}, "afterCommit": {"oid": "965d21f339ccca4fc042eab8c76d1d055fb0863b", "author": {"user": {"login": "jonmv", "name": "Jon Marius Venstad"}}, "url": "https://github.com/vespa-engine/vespa/commit/965d21f339ccca4fc042eab8c76d1d055fb0863b", "committedDate": "2020-12-30T10:59:56Z", "message": "Non-functional"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6eede0d2c93cd086a980d2bed5c5cc5d1eca9712", "author": {"user": {"login": "jonmv", "name": "Jon Marius Venstad"}}, "url": "https://github.com/vespa-engine/vespa/commit/6eede0d2c93cd086a980d2bed5c5cc5d1eca9712", "committedDate": "2020-12-30T11:26:43Z", "message": "More non-functional"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYxMDE0ODIy", "url": "https://github.com/vespa-engine/vespa/pull/15873#pullrequestreview-561014822", "createdAt": "2021-01-04T13:06:53Z", "commit": {"oid": "6eede0d2c93cd086a980d2bed5c5cc5d1eca9712"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQxMzowNjo1NFrOINxDeA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wNFQxNDoxNDozMVrOINzIWg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTMwNjEwNA==", "bodyText": "Consider adding a note in the comment on when this can be done so major version cleanup greps can find it", "url": "https://github.com/vespa-engine/vespa/pull/15873#discussion_r551306104", "createdAt": "2021-01-04T13:06:54Z", "author": {"login": "vekterli"}, "path": "documentapi/src/vespa/documentapi/messagebus/documentprotocol.cpp", "diffHunk": "@@ -32,14 +32,14 @@ DocumentProtocol::DocumentProtocol(std::shared_ptr<const DocumentTypeRepo> repo,\n     // When adding factories to this list, please KEEP THEM ORDERED alphabetically like they are now.\n     putRoutingPolicyFactory(\"AND\", std::make_shared<RoutingPolicyFactories::AndPolicyFactory>());\n     putRoutingPolicyFactory(\"Content\", std::make_shared<RoutingPolicyFactories::ContentPolicyFactory>());\n-    putRoutingPolicyFactory(\"MessageType\", std::make_shared<RoutingPolicyFactories::MessageTypePolicyFactory>());\n+    putRoutingPolicyFactory(\"Storage\", std::make_shared<RoutingPolicyFactories::ContentPolicyFactory>()); // TODO: remove", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6eede0d2c93cd086a980d2bed5c5cc5d1eca9712"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTM0MDEyMg==", "bodyText": "Should we retain at least one test per language that tests that Storage still works?", "url": "https://github.com/vespa-engine/vespa/pull/15873#discussion_r551340122", "createdAt": "2021-01-04T14:14:31Z", "author": {"login": "vekterli"}, "path": "documentapi/src/tests/policies/policies_test.cpp", "diffHunk": "@@ -83,10 +83,10 @@ class Test : public vespalib::TestApp {\n     void requireThatExternPolicyWithUnknownPatternSelectsNone();\n     void requireThatExternPolicySelectsFromExternSlobrok();\n     void requireThatExternPolicyMergesOneReplyAsProtocol();\n-    void requireThatStoragePolicyWithIllegalParamIsAnErrorPolicy();\n-    void requireThatStoragePolicyIsRandomWithoutState();\n-    void requireThatStoragePolicyIsTargetedWithState();\n-    void requireThatStoragePolicyCombinesSystemAndSlobrokState();\n+    void requireThatContentPolicyWithIllegalParamIsAnErrorPolicy();\n+    void requireThatContentPolicyIsRandomWithoutState();\n+    void requireThatContentPolicyIsTargetedWithState();\n+    void requireThatContentPolicyCombinesSystemAndSlobrokState();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6eede0d2c93cd086a980d2bed5c5cc5d1eca9712"}, "originalPosition": 35}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "50a2a9012a1a01f1240759cfd724c3bdf71783cb", "author": {"user": {"login": "jonmv", "name": "Jon Marius Venstad"}}, "url": "https://github.com/vespa-engine/vespa/commit/50a2a9012a1a01f1240759cfd724c3bdf71783cb", "committedDate": "2021-01-04T14:36:33Z", "message": "Specify when TODO"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b1e15a0e12bc6fb258b65cdd6e6fcfb925e8f3c1", "author": {"user": {"login": "jonmv", "name": "Jon Marius Venstad"}}, "url": "https://github.com/vespa-engine/vespa/commit/b1e15a0e12bc6fb258b65cdd6e6fcfb925e8f3c1", "committedDate": "2021-01-04T15:43:06Z", "message": "Use clustername-direct routes for visitors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3e32d199fca6e9fd347bbec75d7cf30f56b99253", "author": {"user": {"login": "jonmv", "name": "Jon Marius Venstad"}}, "url": "https://github.com/vespa-engine/vespa/commit/3e32d199fca6e9fd347bbec75d7cf30f56b99253", "committedDate": "2021-01-04T17:13:09Z", "message": "Merge branch 'jonmv/remove-storage-policy' of github.com:vespa-engine/vespa into jonmv/remove-storage-policy"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3794, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}