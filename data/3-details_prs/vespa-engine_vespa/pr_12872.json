{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAwNjkyMjYy", "number": 12872, "title": "add unit tests for HnswIndex::get_state()", "bodyText": "I confirm that this contribution is made under the terms of the license found in the root directory of this repository's source tree and that I have the authority necessary to make this contribution on behalf of its copyright owner.\n@geirst please review and merge", "createdAt": "2020-04-08T08:03:10Z", "url": "https://github.com/vespa-engine/vespa/pull/12872", "merged": true, "mergeCommit": {"oid": "0ec953e3a219ccb3ddb1a88019d400434677d08e"}, "closed": true, "closedAt": "2020-04-09T09:04:56Z", "author": {"login": "arnej27959"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcVjE7SgH2gAyNDAwNjkyMjYyOjkxZTAwMjA5ODFjNmViZmVkZjdkYjdmOTk3NWY3ODAwMDFkMDVjY2U=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcVtSTsgH2gAyNDAwNjkyMjYyOjkyMTIwM2JhMTEzNTdlZmVlZWVmY2RmMGY3Y2ViZWFlMmJjNzUwOTI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "91e0020981c6ebfedf7db7f9975f780001d05cce", "author": {"user": {"login": "arnej27959", "name": "Arne H Juul"}}, "url": "https://github.com/vespa-engine/vespa/commit/91e0020981c6ebfedf7db7f9975f780001d05cce", "committedDate": "2020-04-08T07:50:33Z", "message": "add unit tests for HnswIndex::get_state()"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5ODkyOTE2", "url": "https://github.com/vespa-engine/vespa/pull/12872#pullrequestreview-389892916", "createdAt": "2020-04-08T11:39:35Z", "commit": {"oid": "91e0020981c6ebfedf7db7f9975f780001d05cce"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxMTozOTozNlrOGCrPrA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxMTozOTo0OFrOGCrQOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTQ1ODg2MA==", "bodyText": "Consider checking number of nodes with 1 outgoing link at level 0 as well (root[\"level_0_links_histogram\"][1])", "url": "https://github.com/vespa-engine/vespa/pull/12872#discussion_r405458860", "createdAt": "2020-04-08T11:39:36Z", "author": {"login": "geirst"}, "path": "searchlib/src/tests/tensor/hnsw_index/hnsw_index_test.cpp", "diffHunk": "@@ -293,6 +297,19 @@ TEST_F(HnswIndexTest, 2d_vectors_inserted_in_hierarchic_graph_with_heuristic_sel\n     expect_level_0(5, {2, 6});\n     expect_levels(6, {{2, 5, 7}, {3}, {}});\n     expect_level_0(7, {3, 6});\n+    {\n+        Slime actualSlime;\n+        SlimeInserter inserter(actualSlime);\n+        index->get_state(inserter);\n+        const auto &root = actualSlime.get();\n+        EXPECT_EQ(0, root[\"memory_usage\"][\"onHold\"].asLong());\n+        EXPECT_EQ(8, root[\"nodes\"].asLong());\n+        EXPECT_EQ(7, root[\"valid_nodes\"].asLong());\n+        EXPECT_EQ(0, root[\"level_histogram\"][0].asLong());\n+        EXPECT_EQ(5, root[\"level_histogram\"][1].asLong());\n+        EXPECT_EQ(0, root[\"level_0_links_histogram\"][0].asLong());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91e0020981c6ebfedf7db7f9975f780001d05cce"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTQ1OTAwMA==", "bodyText": "Consider checking number of nodes with 1 outgoing link at level 0 as well (root[\"level_0_links_histogram\"][1])", "url": "https://github.com/vespa-engine/vespa/pull/12872#discussion_r405459000", "createdAt": "2020-04-08T11:39:48Z", "author": {"login": "geirst"}, "path": "searchlib/src/tests/tensor/hnsw_index/hnsw_index_test.cpp", "diffHunk": "@@ -305,6 +322,19 @@ TEST_F(HnswIndexTest, 2d_vectors_inserted_in_hierarchic_graph_with_heuristic_sel\n     expect_level_0(5, {2, 6});\n     expect_levels(6, {{2, 5, 7}, {3}, {}});\n     expect_level_0(7, {3, 6});\n+    {\n+        Slime actualSlime;\n+        SlimeInserter inserter(actualSlime);\n+        index->get_state(inserter);\n+        const auto &root = actualSlime.get();\n+        EXPECT_EQ(0, root[\"memory_usage\"][\"onHold\"].asLong());\n+        EXPECT_EQ(8, root[\"nodes\"].asLong());\n+        EXPECT_EQ(6, root[\"valid_nodes\"].asLong());\n+        EXPECT_EQ(0, root[\"level_histogram\"][0].asLong());\n+        EXPECT_EQ(4, root[\"level_histogram\"][1].asLong());\n+        EXPECT_EQ(0, root[\"level_0_links_histogram\"][0].asLong());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91e0020981c6ebfedf7db7f9975f780001d05cce"}, "originalPosition": 52}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "921203ba11357efeeeefcdf0f7cebeae2bc75092", "author": {"user": {"login": "arnej27959", "name": "Arne H Juul"}}, "url": "https://github.com/vespa-engine/vespa/commit/921203ba11357efeeeefcdf0f7cebeae2bc75092", "committedDate": "2020-04-08T19:44:13Z", "message": "unit test links histogram better"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3392, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}