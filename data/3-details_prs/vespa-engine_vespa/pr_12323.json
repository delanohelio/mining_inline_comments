{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc5MDE3MDYz", "number": 12323, "title": "add set_node for unit testing", "bodyText": "I confirm that this contribution is made under the terms of the license found in the root directory of this repository's source tree and that I have the authority necessary to make this contribution on behalf of its copyright owner.\n@geirst please review and merge", "createdAt": "2020-02-24T14:22:38Z", "url": "https://github.com/vespa-engine/vespa/pull/12323", "merged": true, "mergeCommit": {"oid": "9a26817560a90dedfe01002e59bbcfdf89cc2096"}, "closed": true, "closedAt": "2020-02-25T08:37:53Z", "author": {"login": "arnej27959"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcHeQx_AH2gAyMzc5MDE3MDYzOmYxYzgzOGU2YmI4OTRlN2EyNjIwM2Y5OWFhNGMyNzRiYjQxNzBiYWE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcHtuubgH2gAyMzc5MDE3MDYzOjMwZmRhODRlNWY2MTUwN2ZiODU3Y2YzZmJmNWFmMGFkOWRiNjkyNjg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f1c838e6bb894e7a26203f99aa4c274bb4170baa", "author": {"user": {"login": "arnej27959", "name": "Arne H Juul"}}, "url": "https://github.com/vespa-engine/vespa/commit/f1c838e6bb894e7a26203f99aa4c274bb4170baa", "committedDate": "2020-02-24T14:19:02Z", "message": "add set_node for unit testing"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYzNDY3MzE5", "url": "https://github.com/vespa-engine/vespa/pull/12323#pullrequestreview-363467319", "createdAt": "2020-02-24T15:19:27Z", "commit": {"oid": "f1c838e6bb894e7a26203f99aa4c274bb4170baa"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQxNToxOToyN1rOFtkZuw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQxNToyMDowMVrOFtkbAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzMyNjY1MQ==", "bodyText": "Also consider checking that doc 5 is connected to {1,2} on level 0 and {4} on level 1.", "url": "https://github.com/vespa-engine/vespa/pull/12323#discussion_r383326651", "createdAt": "2020-02-24T15:19:27Z", "author": {"login": "geirst"}, "path": "searchlib/src/tests/tensor/hnsw_index/hnsw_index_test.cpp", "diffHunk": "@@ -266,5 +266,33 @@ TEST_F(HnswIndexTest, 2d_vectors_inserted_in_hierarchic_graph_with_heuristic_sel\n     expect_level_0(7, {3, 6});\n }\n \n+TEST_F(HnswIndexTest, manual_insert)\n+{\n+    init(false);\n+\n+    std::vector<uint32_t> nbl;\n+    HnswNode empty{nbl};\n+    index->set_node(1, empty);\n+    index->set_node(2, empty);\n+\n+    HnswNode three{{1,2}};\n+    index->set_node(3, three);\n+    expect_level_0(1, {3});\n+    expect_level_0(2, {3});\n+    expect_level_0(3, {1,2});\n+\n+    expect_entry_point(1, 0);\n+\n+    HnswNode twolevels{{{1},nbl}};\n+    index->set_node(4, twolevels);\n+\n+    expect_entry_point(4, 1);\n+    expect_level_0(1, {3,4});\n+\n+    HnswNode five{{{1,2}, {4}}};\n+    index->set_node(5, five);\n+    expect_levels(4, {{1}, {5}});", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1c838e6bb894e7a26203f99aa4c274bb4170baa"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzMyNjk3OA==", "bodyText": "Even though this is just used for unit testing, consider passing HnswNode as const reference.", "url": "https://github.com/vespa-engine/vespa/pull/12323#discussion_r383326978", "createdAt": "2020-02-24T15:20:01Z", "author": {"login": "geirst"}, "path": "searchlib/src/vespa/searchlib/tensor/hnsw_index.h", "diffHunk": "@@ -145,8 +145,7 @@ class HnswIndex : public NearestNeighborIndex {\n \n     // Should only be used by unit tests.\n     HnswNode get_node(uint32_t docid) const;\n-\n-    // TODO: Implement set_node() as well for use in unit tests.\n+    void set_node(uint32_t docid, HnswNode node);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1c838e6bb894e7a26203f99aa4c274bb4170baa"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "30fda84e5f61507fb857cf3fbf5af0ad9db69268", "author": {"user": {"login": "arnej27959", "name": "Arne H Juul"}}, "url": "https://github.com/vespa-engine/vespa/commit/30fda84e5f61507fb857cf3fbf5af0ad9db69268", "committedDate": "2020-02-25T08:20:19Z", "message": "minor fixes after review"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2800, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}