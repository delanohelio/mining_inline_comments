{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkyOTIzNzcw", "number": 14550, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQwODo1MjozN1rOEnXjag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQwOTo1NjoyOFrOEnY-2Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA5NzE1ODE4OnYy", "diffSide": "RIGHT", "path": "container-core/src/main/java/com/yahoo/container/core/documentapi/DocumentAccessProvider.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQwODo1MjozN1rOHX66-A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQwODo1MjozN1rOHX66-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDg0NDY2NA==", "bodyText": "This lets us use this in internal classes as well, without fear that the user may have configured their own DocumentAccess component.", "url": "https://github.com/vespa-engine/vespa/pull/14550#discussion_r494844664", "createdAt": "2020-09-25T08:52:37Z", "author": {"login": "jonmv"}, "path": "container-core/src/main/java/com/yahoo/container/core/documentapi/DocumentAccessProvider.java", "diffHunk": "@@ -27,18 +27,18 @@\n  *\n  * @author jonmv\n  */\n-public class MessageBusDocumentAccessProvider extends AbstractComponent implements Provider<DocumentAccess> {\n+public class DocumentAccessProvider extends AbstractComponent implements Provider<DocumentAccessProvider.LazyWrapper> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f6d6f0db9f6dab4a48aea33dd8c41b28ff624ad5"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA5NzM4ODc0OnYy", "diffSide": "RIGHT", "path": "container-core/src/main/java/com/yahoo/container/core/documentapi/DocumentAccessProvider.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQwOTo1NToyMFrOHX9GNA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQxMDoxOTowM1rOHX91LA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDg4MDMwOA==", "bodyText": "Add copyright header to your intellij template :)", "url": "https://github.com/vespa-engine/vespa/pull/14550#discussion_r494880308", "createdAt": "2020-09-25T09:55:20Z", "author": {"login": "bjorncs"}, "path": "container-core/src/main/java/com/yahoo/container/core/documentapi/DocumentAccessProvider.java", "diffHunk": "@@ -0,0 +1,38 @@\n+package com.yahoo.container.core.documentapi;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ce342752d01f2118688d9a7016944b98c4946b1"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDg5MjMzMg==", "bodyText": "Done!", "url": "https://github.com/vespa-engine/vespa/pull/14550#discussion_r494892332", "createdAt": "2020-09-25T10:19:03Z", "author": {"login": "jonmv"}, "path": "container-core/src/main/java/com/yahoo/container/core/documentapi/DocumentAccessProvider.java", "diffHunk": "@@ -0,0 +1,38 @@\n+package com.yahoo.container.core.documentapi;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDg4MDMwOA=="}, "originalCommit": {"oid": "1ce342752d01f2118688d9a7016944b98c4946b1"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA5NzM5MjI1OnYy", "diffSide": "RIGHT", "path": "documentapi/src/main/java/com/yahoo/documentapi/messagebus/MessageBusDocumentAccess.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQwOTo1NjoyOFrOHX9IdA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQwOTo1NjoyOFrOHX9IdA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDg4MDg4NA==", "bodyText": "Consider adding warning in log if self-subscription", "url": "https://github.com/vespa-engine/vespa/pull/14550#discussion_r494880884", "createdAt": "2020-09-25T09:56:28Z", "author": {"login": "bjorncs"}, "path": "documentapi/src/main/java/com/yahoo/documentapi/messagebus/MessageBusDocumentAccess.java", "diffHunk": "@@ -60,7 +60,9 @@ public MessageBusDocumentAccess(MessageBusParams params) {\n                 bus = new NetworkMessageBus(network, new MessageBus(network, mbusParams));\n             }\n             else {\n-                bus = new RPCMessageBus(mbusParams, params.getRPCNetworkParams(), params.getRoutingConfigId());\n+                bus = params.getRPCNetworkParams().getSlobroksConfig() != null && mbusParams.getMessageBusConfig() != null\n+                      ? new RPCMessageBus(mbusParams, params.getRPCNetworkParams()) // prefer without self-subscription if config is set\n+                      : new RPCMessageBus(mbusParams, params.getRPCNetworkParams(), params.getRoutingConfigId());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1ce342752d01f2118688d9a7016944b98c4946b1"}, "originalPosition": 7}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1319, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}