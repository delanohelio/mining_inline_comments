{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc2MzM2MTEy", "number": 14211, "title": "Implement store for heap allocated tensors.", "bodyText": "@toregge please review\n@arnej27959 FYI", "createdAt": "2020-08-31T14:29:48Z", "url": "https://github.com/vespa-engine/vespa/pull/14211", "merged": true, "mergeCommit": {"oid": "924ba9becee4f608db610f402422efd71ab6073c"}, "closed": true, "closedAt": "2020-08-31T16:07:16Z", "author": {"login": "geirst"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdETQGjgH2gAyNDc2MzM2MTEyOmUzNWNiNjI2ZTI4MjUzNzZmNGM4OGQ2MmQ1NDY2YmQ4YzIwNWE4ZDQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdEUH60gFqTQ3ODY5MTg4OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e35cb626e2825376f4c88d62d5466bd8c205a8d4", "author": {"user": {"login": "geirst", "name": "Geir Storli"}}, "url": "https://github.com/vespa-engine/vespa/commit/e35cb626e2825376f4c88d62d5466bd8c205a8d4", "committedDate": "2020-08-31T13:58:43Z", "message": "Implement store for heap allocated tensors."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4NjY5MjE3", "url": "https://github.com/vespa-engine/vespa/pull/14211#pullrequestreview-478669217", "createdAt": "2020-08-31T14:33:02Z", "commit": {"oid": "e35cb626e2825376f4c88d62d5466bd8c205a8d4"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxNDozMzowM1rOHJ7VsA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxNDozNToxM1rOHJ7bow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDE3MTQ0MA==", "bodyText": "Consider removing unneeded log setup.", "url": "https://github.com/vespa-engine/vespa/pull/14211#discussion_r480171440", "createdAt": "2020-08-31T14:33:03Z", "author": {"login": "toregge"}, "path": "searchlib/src/tests/tensor/direct_tensor_store/direct_tensor_store_test.cpp", "diffHunk": "@@ -0,0 +1,93 @@\n+// Copyright Verizon Media. Licensed under the terms of the Apache 2.0 license. See LICENSE in the project root.\n+\n+#include <vespa/searchlib/tensor/direct_tensor_store.h>\n+#include <vespa/vespalib/gtest/gtest.h>\n+#include <vespa/eval/tensor/default_tensor_engine.h>\n+#include <vespa/eval/tensor/tensor.h>\n+\n+#include <vespa/log/log.h>\n+LOG_SETUP(\"direct_tensor_store_test\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e35cb626e2825376f4c88d62d5466bd8c205a8d4"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDE3Mjk2Mw==", "bodyText": "Consider removing unneeded equality check, passing identity check implies equality.", "url": "https://github.com/vespa-engine/vespa/pull/14211#discussion_r480172963", "createdAt": "2020-08-31T14:35:13Z", "author": {"login": "toregge"}, "path": "searchlib/src/tests/tensor/direct_tensor_store/direct_tensor_store_test.cpp", "diffHunk": "@@ -0,0 +1,93 @@\n+// Copyright Verizon Media. Licensed under the terms of the Apache 2.0 license. See LICENSE in the project root.\n+\n+#include <vespa/searchlib/tensor/direct_tensor_store.h>\n+#include <vespa/vespalib/gtest/gtest.h>\n+#include <vespa/eval/tensor/default_tensor_engine.h>\n+#include <vespa/eval/tensor/tensor.h>\n+\n+#include <vespa/log/log.h>\n+LOG_SETUP(\"direct_tensor_store_test\");\n+\n+using namespace search::tensor;\n+\n+using vespalib::datastore::EntryRef;\n+using vespalib::eval::TensorSpec;\n+using vespalib::tensor::DefaultTensorEngine;\n+using vespalib::tensor::Tensor;\n+\n+vespalib::string tensor_spec(\"tensor(x{})\");\n+\n+Tensor::UP\n+make_tensor(const TensorSpec& spec)\n+{\n+    auto value = DefaultTensorEngine::ref().from_spec(spec);\n+    auto* tensor = dynamic_cast<Tensor*>(value.get());\n+    assert(tensor != nullptr);\n+    value.release();\n+    return Tensor::UP(tensor);\n+}\n+\n+Tensor::UP\n+make_tensor(double value)\n+{\n+    return make_tensor(TensorSpec(tensor_spec).add({{\"x\", \"a\"}}, value));\n+}\n+\n+class DirectTensorStoreTest : public ::testing::Test {\n+public:\n+    DirectTensorStore store;\n+\n+    DirectTensorStoreTest() : store() {}\n+\n+    virtual ~DirectTensorStoreTest() {\n+        store.clearHoldLists();\n+    }\n+\n+    void expect_tensor(const Tensor* exp, EntryRef ref) {\n+        const auto* act = store.get_tensor(ref);\n+        ASSERT_TRUE(act);\n+        EXPECT_EQ(exp, act);\n+        EXPECT_EQ(*exp, *act);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e35cb626e2825376f4c88d62d5466bd8c205a8d4"}, "originalPosition": 50}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3386f45c62d4d5194fafa7e06fcf3811942dafcb", "author": {"user": {"login": "geirst", "name": "Geir Storli"}}, "url": "https://github.com/vespa-engine/vespa/commit/3386f45c62d4d5194fafa7e06fcf3811942dafcb", "committedDate": "2020-08-31T14:56:12Z", "message": "Remove unneeded code."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4NjkxODg4", "url": "https://github.com/vespa-engine/vespa/pull/14211#pullrequestreview-478691888", "createdAt": "2020-08-31T14:59:41Z", "commit": {"oid": "3386f45c62d4d5194fafa7e06fcf3811942dafcb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4356, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}