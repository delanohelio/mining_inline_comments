{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA5OTEyODc2", "number": 15033, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxMDozMTozNVrOEx1uvw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxMDozODoyNlrOEx14tQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIwNjk1OTk5OnYy", "diffSide": "RIGHT", "path": "storage/src/vespa/storage/persistence/asynchandler.h", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxMDozMTozNVrOHoJdBg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxMToxMTo0MFrOHoK1fQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTg1OTk3NA==", "bodyText": "Could safely be tagged as noexcept", "url": "https://github.com/vespa-engine/vespa/pull/15033#discussion_r511859974", "createdAt": "2020-10-26T10:31:35Z", "author": {"login": "vekterli"}, "path": "storage/src/vespa/storage/persistence/asynchandler.h", "diffHunk": "@@ -25,6 +25,7 @@ class AsyncHandler : public Types {\n     MessageTrackerUP handlePut(api::PutCommand& cmd, MessageTrackerUP tracker) const;\n     MessageTrackerUP handleRemove(api::RemoveCommand& cmd, MessageTrackerUP tracker) const;\n     MessageTrackerUP handleUpdate(api::UpdateCommand& cmd, MessageTrackerUP tracker) const;\n+    static bool is_async_message(api::MessageType::Id type_id);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f41815b4118b3e98dce00a5a94be94334fe6e29c"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTg4MjYyMQ==", "bodyText": "Fixed", "url": "https://github.com/vespa-engine/vespa/pull/15033#discussion_r511882621", "createdAt": "2020-10-26T11:11:40Z", "author": {"login": "geirst"}, "path": "storage/src/vespa/storage/persistence/asynchandler.h", "diffHunk": "@@ -25,6 +25,7 @@ class AsyncHandler : public Types {\n     MessageTrackerUP handlePut(api::PutCommand& cmd, MessageTrackerUP tracker) const;\n     MessageTrackerUP handleRemove(api::RemoveCommand& cmd, MessageTrackerUP tracker) const;\n     MessageTrackerUP handleUpdate(api::UpdateCommand& cmd, MessageTrackerUP tracker) const;\n+    static bool is_async_message(api::MessageType::Id type_id);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTg1OTk3NA=="}, "originalCommit": {"oid": "f41815b4118b3e98dce00a5a94be94334fe6e29c"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIwNjk4NTQ5OnYy", "diffSide": "RIGHT", "path": "storage/src/vespa/storage/persistence/filestorage/filestorhandlerimpl.cpp", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxMDozODoyNlrOHoJstA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxMToxMTo0N1rOHoK1qg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTg2Mzk4OA==", "bodyText": "Consider ++iter", "url": "https://github.com/vespa-engine/vespa/pull/15033#discussion_r511863988", "createdAt": "2020-10-26T10:38:26Z", "author": {"login": "vekterli"}, "path": "storage/src/vespa/storage/persistence/filestorage/filestorhandlerimpl.cpp", "diffHunk": "@@ -910,6 +921,24 @@ FileStorHandlerImpl::Stripe::getNextMessage(vespalib::duration timeout)\n     return {}; // No message fetched.\n }\n \n+FileStorHandler::LockedMessage\n+FileStorHandlerImpl::Stripe::get_next_async_message(monitor_guard& guard)\n+{\n+    if (_owner.isClosed() || _owner.isPaused()) {\n+        return {};\n+    }\n+    PriorityIdx& idx(bmi::get<1>(*_queue));\n+    PriorityIdx::iterator iter(idx.begin()), end(idx.end());\n+\n+    while ((iter != end) && operationIsInhibited(guard, iter->_bucket, *iter->_command)) {\n+        iter++;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f41815b4118b3e98dce00a5a94be94334fe6e29c"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTg4MjY2Ng==", "bodyText": "Fixed", "url": "https://github.com/vespa-engine/vespa/pull/15033#discussion_r511882666", "createdAt": "2020-10-26T11:11:47Z", "author": {"login": "geirst"}, "path": "storage/src/vespa/storage/persistence/filestorage/filestorhandlerimpl.cpp", "diffHunk": "@@ -910,6 +921,24 @@ FileStorHandlerImpl::Stripe::getNextMessage(vespalib::duration timeout)\n     return {}; // No message fetched.\n }\n \n+FileStorHandler::LockedMessage\n+FileStorHandlerImpl::Stripe::get_next_async_message(monitor_guard& guard)\n+{\n+    if (_owner.isClosed() || _owner.isPaused()) {\n+        return {};\n+    }\n+    PriorityIdx& idx(bmi::get<1>(*_queue));\n+    PriorityIdx::iterator iter(idx.begin()), end(idx.end());\n+\n+    while ((iter != end) && operationIsInhibited(guard, iter->_bucket, *iter->_command)) {\n+        iter++;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTg2Mzk4OA=="}, "originalCommit": {"oid": "f41815b4118b3e98dce00a5a94be94334fe6e29c"}, "originalPosition": 39}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1012, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}