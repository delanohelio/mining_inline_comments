{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE2NTgyNTQ4", "number": 13221, "title": "allow filter in bruteforce", "bodyText": "add support for using a whitelist filter in bruteforce nearest neighbor iterator.\n\nI confirm that this contribution is made under the terms of the license found in the root directory of this repository's source tree and that I have the authority necessary to make this contribution on behalf of its copyright owner.\n@geirst @toregge please review", "createdAt": "2020-05-12T08:52:19Z", "url": "https://github.com/vespa-engine/vespa/pull/13221", "merged": true, "mergeCommit": {"oid": "b43e8090a860bf92b07153a2fd01d95f7fa2e548"}, "closed": true, "closedAt": "2020-05-12T14:29:13Z", "author": {"login": "arnej27959"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcggTNQAH2gAyNDE2NTgyNTQ4OjUwMzg4MGY5OGRhZTgzOGMyNGZiYjY4Njk4NDAxMDhiNzM2ODQ5NTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcgkLEiAH2gAyNDE2NTgyNTQ4OjYwMDcwNDg4ODRlYTVjMjIyYzBhZDg4ODYyZjdjYzEyOTkyYWMzMzY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "503880f98dae838c24fbb6869840108b73684952", "author": {"user": {"login": "arnej27959", "name": "Arne H Juul"}}, "url": "https://github.com/vespa-engine/vespa/commit/503880f98dae838c24fbb6869840108b73684952", "committedDate": "2020-05-12T08:49:36Z", "message": "allow filter in bruteforce\n\n* add support for using a whitelist filter in bruteforce nearest neighbor iterator."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5OTU4MTA5", "url": "https://github.com/vespa-engine/vespa/pull/13221#pullrequestreview-409958109", "createdAt": "2020-05-12T11:44:57Z", "commit": {"oid": "503880f98dae838c24fbb6869840108b73684952"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxMTo0NDo1OFrOGUCsVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxMTo0NzozNlrOGUCxhA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzY2ODgyMA==", "bodyText": "Consider inverting template argument to use_filter instead. It is easier to read it that way.", "url": "https://github.com/vespa-engine/vespa/pull/13221#discussion_r423668820", "createdAt": "2020-05-12T11:44:58Z", "author": {"login": "geirst"}, "path": "searchlib/src/vespa/searchlib/queryeval/nearest_neighbor_iterator.cpp", "diffHunk": "@@ -29,7 +30,7 @@ is_compatible(const vespalib::eval::ValueType& lhs,\n  * Keeps a heap of the K best hit distances.\n  * Currently always does brute-force scanning, which is very expensive.\n  **/\n-template <bool strict>\n+template <bool strict, bool no_bitvector>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "503880f98dae838c24fbb6869840108b73684952"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzY2OTkyNQ==", "bodyText": "Consider renaming bit_vector to filter to match how it is named in hnsw index.", "url": "https://github.com/vespa-engine/vespa/pull/13221#discussion_r423669925", "createdAt": "2020-05-12T11:47:09Z", "author": {"login": "geirst"}, "path": "searchlib/src/vespa/searchlib/queryeval/nearest_neighbor_iterator.cpp", "diffHunk": "@@ -112,11 +116,16 @@ NearestNeighborIterator::create(\n         const vespalib::tensor::DenseTensorView &queryTensor,\n         const search::tensor::DenseTensorAttribute &tensorAttribute,\n         NearestNeighborDistanceHeap &distanceHeap,\n+        const search::BitVector *bit_vector,\n         const search::tensor::DistanceFunction *dist_fun)\n \n {\n-    Params params(tfmd, queryTensor, tensorAttribute, distanceHeap, dist_fun);\n-    return resolve_strict_LCT_RCT(strict, params);\n+    Params params(tfmd, queryTensor, tensorAttribute, distanceHeap, bit_vector, dist_fun);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "503880f98dae838c24fbb6869840108b73684952"}, "originalPosition": 75}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzY3MDE0OA==", "bodyText": "Consider renaming bit_vector to filter to match how it is named in hnsw index. Applies for rest of file.", "url": "https://github.com/vespa-engine/vespa/pull/13221#discussion_r423670148", "createdAt": "2020-05-12T11:47:36Z", "author": {"login": "geirst"}, "path": "searchlib/src/vespa/searchlib/queryeval/nearest_neighbor_iterator.h", "diffHunk": "@@ -25,17 +25,20 @@ class NearestNeighborIterator : public SearchIterator\n         const DenseTensorView &queryTensor;\n         const DenseTensorAttribute &tensorAttribute;\n         NearestNeighborDistanceHeap &distanceHeap;\n+        const search::BitVector *bit_vector;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "503880f98dae838c24fbb6869840108b73684952"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6007048884ea5c222c0ad88862f7cc12992ac336", "author": {"user": {"login": "arnej27959", "name": "Arne H Juul"}}, "url": "https://github.com/vespa-engine/vespa/commit/6007048884ea5c222c0ad88862f7cc12992ac336", "committedDate": "2020-05-12T13:20:20Z", "message": "no_bitvector -> !has_filter"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3217, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}