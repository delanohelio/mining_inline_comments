{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg5ODI2ODE5", "number": 12597, "title": "Act on the readable subset of applications when appropriate", "bodyText": "@jonmv", "createdAt": "2020-03-17T13:10:39Z", "url": "https://github.com/vespa-engine/vespa/pull/12597", "merged": true, "mergeCommit": {"oid": "92b774fe4b9c65eb34ca72f6b8ea5074214c9a7a"}, "closed": true, "closedAt": "2020-03-18T14:44:14Z", "author": {"login": "mpolden"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcOjNYfgBqjMxMzc0NTc2NjE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcO4Ca8gFqTM3NjkwNzAwNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "18dd6a62b561f3d8bca58d42faf78d178408a33b", "author": {"user": {"login": "mpolden", "name": "Martin Polden"}}, "url": "https://github.com/vespa-engine/vespa/commit/18dd6a62b561f3d8bca58d42faf78d178408a33b", "committedDate": "2020-03-17T13:07:12Z", "message": "Remove unused ApplicationIdSource interface and related classes"}, "afterCommit": {"oid": "77f6a2fb86fc4368306d123626f120b179fc6f57", "author": {"user": {"login": "mpolden", "name": "Martin Polden"}}, "url": "https://github.com/vespa-engine/vespa/commit/77f6a2fb86fc4368306d123626f120b179fc6f57", "committedDate": "2020-03-17T14:02:09Z", "message": "Remove unused ApplicationIdSource interface and related classes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2NjcyMDIw", "url": "https://github.com/vespa-engine/vespa/pull/12597#pullrequestreview-376672020", "createdAt": "2020-03-18T09:03:12Z", "commit": {"oid": "77f6a2fb86fc4368306d123626f120b179fc6f57"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQwOTowMzoxMlrOF37rBg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQwOTowMzoxMlrOF37rBg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDE5MzY3MA==", "bodyText": "Perhaps add a test with a deployment scenario, where one app is unreadable?", "url": "https://github.com/vespa-engine/vespa/pull/12597#discussion_r394193670", "createdAt": "2020-03-18T09:03:12Z", "author": {"login": "jonmv"}, "path": "controller-server/src/test/java/com/yahoo/vespa/hosted/controller/ControllerTest.java", "diffHunk": "@@ -939,4 +941,25 @@ public void testChangeEndpointCluster() {\n                                                        .rotations().get(0).clusterId());\n     }\n \n+    @Test\n+    public void testReadableApplications() {\n+        var db = new MockCuratorDb();\n+        var tester = new DeploymentTester(new ControllerTester(db));\n+\n+        // Create two applications\n+        tester.newDeploymentContext(\"t1\", \"a1\", \"default\");\n+        tester.newDeploymentContext(\"t2\", \"a2\", \"default\");\n+        assertEquals(2, tester.applications().readable().size());\n+\n+        // Write invalid data to one application\n+        db.curator().set(Path.fromString(\"/controller/v1/applications/t2:a2\"), new byte[]{(byte) 0xDE, (byte) 0xAD});\n+        assertEquals(1, tester.applications().readable().size());\n+\n+        try {\n+            tester.applications().asList();\n+            fail(\"Expected exception\");\n+        } catch (Exception ignored) {\n+        }\n+    }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "77f6a2fb86fc4368306d123626f120b179fc6f57"}, "originalPosition": 40}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2NjcyMzY0", "url": "https://github.com/vespa-engine/vespa/pull/12597#pullrequestreview-376672364", "createdAt": "2020-03-18T09:03:45Z", "commit": {"oid": "77f6a2fb86fc4368306d123626f120b179fc6f57"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "95687a4eef69a4ebfc27c7391d1ec2152104fb66", "author": {"user": {"login": "mpolden", "name": "Martin Polden"}}, "url": "https://github.com/vespa-engine/vespa/commit/95687a4eef69a4ebfc27c7391d1ec2152104fb66", "committedDate": "2020-03-18T13:14:55Z", "message": "Remove user tenant cleanup"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "53ec9e367187cb208b95db1e4f4a1f33b9d1aac9", "author": {"user": {"login": "mpolden", "name": "Martin Polden"}}, "url": "https://github.com/vespa-engine/vespa/commit/53ec9e367187cb208b95db1e4f4a1f33b9d1aac9", "committedDate": "2020-03-18T13:14:55Z", "message": "Act on the readable subset of applications when appropriate"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2451e73874428f2fa38701490f1b95e5add4fbeb", "author": {"user": {"login": "mpolden", "name": "Martin Polden"}}, "url": "https://github.com/vespa-engine/vespa/commit/2451e73874428f2fa38701490f1b95e5add4fbeb", "committedDate": "2020-03-18T13:14:55Z", "message": "Remove unused ApplicationIdSource interface and related classes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b37ede37fd837c2f7af12950ce78eb4dd2a5a9c2", "author": {"user": {"login": "mpolden", "name": "Martin Polden"}}, "url": "https://github.com/vespa-engine/vespa/commit/b37ede37fd837c2f7af12950ce78eb4dd2a5a9c2", "committedDate": "2020-03-18T13:34:02Z", "message": "Refactor assignment of single rotation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6dbdc482cb824c92184d44c59ac013382f67881f", "author": {"user": {"login": "mpolden", "name": "Martin Polden"}}, "url": "https://github.com/vespa-engine/vespa/commit/6dbdc482cb824c92184d44c59ac013382f67881f", "committedDate": "2020-03-18T13:34:02Z", "message": "Test deployment while unreadable application exists"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "77f6a2fb86fc4368306d123626f120b179fc6f57", "author": {"user": {"login": "mpolden", "name": "Martin Polden"}}, "url": "https://github.com/vespa-engine/vespa/commit/77f6a2fb86fc4368306d123626f120b179fc6f57", "committedDate": "2020-03-17T14:02:09Z", "message": "Remove unused ApplicationIdSource interface and related classes"}, "afterCommit": {"oid": "6dbdc482cb824c92184d44c59ac013382f67881f", "author": {"user": {"login": "mpolden", "name": "Martin Polden"}}, "url": "https://github.com/vespa-engine/vespa/commit/6dbdc482cb824c92184d44c59ac013382f67881f", "committedDate": "2020-03-18T13:34:02Z", "message": "Test deployment while unreadable application exists"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2OTA3MDA0", "url": "https://github.com/vespa-engine/vespa/pull/12597#pullrequestreview-376907004", "createdAt": "2020-03-18T14:18:21Z", "commit": {"oid": "6dbdc482cb824c92184d44c59ac013382f67881f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2706, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}