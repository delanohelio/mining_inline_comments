{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMxNzU0NzAy", "number": 15636, "title": "Arnej/less mutable dense tensor view", "bodyText": "I confirm that this contribution is made under the terms of the license found in the root directory of this repository's source tree and that I have the authority necessary to make this contribution on behalf of its copyright owner.\n@geirst please review\n@havardpe please take a quick look", "createdAt": "2020-12-03T12:49:14Z", "url": "https://github.com/vespa-engine/vespa/pull/15636", "merged": true, "mergeCommit": {"oid": "52ed0fb674ceca2ca1617bc1526a5101f91d6a75"}, "closed": true, "closedAt": "2020-12-03T18:07:00Z", "author": {"login": "arnej27959"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdihXs8gH2gAyNTMxNzU0NzAyOmY1YTNiNDlhMmYzZmU5ZjkyNmIyODYzMzk0NmVkMGE0Nzc2ODUxNmQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdilLKAAFqTU0NDEwMjc3Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f5a3b49a2f3fe9f926b28633946ed0a47768516d", "author": {"user": {"login": "arnej27959", "name": "Arne H Juul"}}, "url": "https://github.com/vespa-engine/vespa/commit/f5a3b49a2f3fe9f926b28633946ed0a47768516d", "committedDate": "2020-12-03T11:23:25Z", "message": "include only what is needed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "957237a4e2859bda5ccaf536c0553092f0edde76", "author": {"user": {"login": "arnej27959", "name": "Arne H Juul"}}, "url": "https://github.com/vespa-engine/vespa/commit/957237a4e2859bda5ccaf536c0553092f0edde76", "committedDate": "2020-12-03T11:23:25Z", "message": "simplify notImplemented()\n\n* no need for notImplemented() to be virtual\n* special version for documentmetastore does not seem to\n  add any value\n* ensure [[noreturn]] attribute actually works"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c3fef6299473204c6e5b0ea1e020ce9c17621b2c", "author": {"user": {"login": "arnej27959", "name": "Arne H Juul"}}, "url": "https://github.com/vespa-engine/vespa/commit/c3fef6299473204c6e5b0ea1e020ce9c17621b2c", "committedDate": "2020-12-03T11:23:25Z", "message": "extract_dense_view can just return the cells reference"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a15a1170bf007ddf1223eb4efeded13af3414756", "author": {"user": {"login": "arnej27959", "name": "Arne H Juul"}}, "url": "https://github.com/vespa-engine/vespa/commit/a15a1170bf007ddf1223eb4efeded13af3414756", "committedDate": "2020-12-03T11:23:26Z", "message": "getTensor with mutable view no longer needed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "055dbdc3cbc9fcfb0e95246953f356835caa6fb6", "author": {"user": {"login": "arnej27959", "name": "Arne H Juul"}}, "url": "https://github.com/vespa-engine/vespa/commit/055dbdc3cbc9fcfb0e95246953f356835caa6fb6", "committedDate": "2020-12-03T11:23:26Z", "message": "GC leftovers"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "913f34b83a52ae90a6b88fcb1b7ad7acf8402731", "author": {"user": {"login": "arnej27959", "name": "Arne H Juul"}}, "url": "https://github.com/vespa-engine/vespa/commit/913f34b83a52ae90a6b88fcb1b7ad7acf8402731", "committedDate": "2020-12-03T11:23:26Z", "message": "be a Value directly\n\n* move to vespalib::eval namespace\n* do not inherit via DenseTensorView"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "76e7067ce6c9c7f7186a88ea9a9713681168af46", "author": {"user": {"login": "arnej27959", "name": "Arne H Juul"}}, "url": "https://github.com/vespa-engine/vespa/commit/76e7067ce6c9c7f7186a88ea9a9713681168af46", "committedDate": "2020-12-03T11:23:26Z", "message": "can now just extract cells directly"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2b59e7df82e6d47eefd06cc6a0b2cc8f7031250a", "author": {"user": {"login": "arnej27959", "name": "Arne H Juul"}}, "url": "https://github.com/vespa-engine/vespa/commit/2b59e7df82e6d47eefd06cc6a0b2cc8f7031250a", "committedDate": "2020-12-03T11:23:26Z", "message": "track API changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "416d6daaffb6f4bcaca02622ae6e50b52725993e", "author": {"user": {"login": "arnej27959", "name": "Arne H Juul"}}, "url": "https://github.com/vespa-engine/vespa/commit/416d6daaffb6f4bcaca02622ae6e50b52725993e", "committedDate": "2020-12-03T12:10:22Z", "message": "rename extract_dense_view -> extract_cells_ref"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQzOTM2NTMx", "url": "https://github.com/vespa-engine/vespa/pull/15636#pullrequestreview-543936531", "createdAt": "2020-12-03T13:11:11Z", "commit": {"oid": "416d6daaffb6f4bcaca02622ae6e50b52725993e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxMzoxMToxMVrOH-a34Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxMzoxMToxMVrOH-a34Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTIxNDA0OQ==", "bodyText": "consider keeping the assert for cell type equality", "url": "https://github.com/vespa-engine/vespa/pull/15636#discussion_r535214049", "createdAt": "2020-12-03T13:11:11Z", "author": {"login": "havardpe"}, "path": "eval/src/vespa/eval/tensor/dense/mutable_dense_tensor_view.h", "diffHunk": "@@ -2,25 +2,27 @@\n \n #pragma once\n \n-#include \"dense_tensor_view.h\"\n+#include <vespa/eval/eval/value.h>\n #include <cassert>\n \n-namespace vespalib::tensor {\n+namespace vespalib::eval {\n \n /**\n- * A mutable view to a dense tensor where all dimensions are indexed.\n+ * A dense tensor with a cells reference that can be modified.\n  */\n-class MutableDenseTensorView : public DenseTensorView\n-{\n+class MutableDenseTensorView : public Value {\n private:\n-    eval::ValueType _type;\n-\n+    const ValueType _type;\n+    TypedCells _cells;\n public:\n-    MutableDenseTensorView(eval::ValueType type_in);\n-    MutableDenseTensorView(MutableDenseTensorView &&) = default;\n+    MutableDenseTensorView(const ValueType &type_in);\n     void setCells(TypedCells cells_in) {\n-        initCellsRef(cells_in);\n+        _cells = cells_in;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "416d6daaffb6f4bcaca02622ae6e50b52725993e"}, "originalPosition": 29}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ae914e3a26518b6c098fb5b2569f0cab9cf77a73", "author": {"user": {"login": "arnej27959", "name": "Arne H Juul"}}, "url": "https://github.com/vespa-engine/vespa/commit/ae914e3a26518b6c098fb5b2569f0cab9cf77a73", "committedDate": "2020-12-03T13:57:18Z", "message": "assert on cell type also"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0MTAyNzc2", "url": "https://github.com/vespa-engine/vespa/pull/15636#pullrequestreview-544102776", "createdAt": "2020-12-03T15:49:20Z", "commit": {"oid": "ae914e3a26518b6c098fb5b2569f0cab9cf77a73"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3836, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}