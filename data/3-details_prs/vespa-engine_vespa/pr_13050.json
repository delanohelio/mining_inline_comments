{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA4NDE2MjA0", "number": 13050, "title": "add more tracing and debug logging of stemming", "bodyText": "I confirm that this contribution is made under the terms of the license found in the root directory of this repository's source tree and that I have the authority necessary to make this contribution on behalf of its copyright owner.\n@bratseth please review\n@kkraune FYI", "createdAt": "2020-04-24T08:46:22Z", "url": "https://github.com/vespa-engine/vespa/pull/13050", "merged": true, "mergeCommit": {"oid": "8fdbdf6b988f9fcddcc19ecdba7b0b2840f09ad5"}, "closed": true, "closedAt": "2020-04-24T10:09:42Z", "author": {"login": "arnej27959"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcatTS5gH2gAyNDA4NDE2MjA0Ojk3NmYyODY4MGRmNDI0YmYwMjhlYjEyYTNmNDEzMDQ5YzE3YmYwOTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcaupzCAFqTM5OTgxNDg1MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "976f28680df424bf028eb12a3f413049c17bf098", "author": {"user": {"login": "arnej27959", "name": "Arne H Juul"}}, "url": "https://github.com/vespa-engine/vespa/commit/976f28680df424bf028eb12a3f413049c17bf098", "committedDate": "2020-04-24T08:34:55Z", "message": "add more tracing and debug logging of stemming"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5NzcxMjM4", "url": "https://github.com/vespa-engine/vespa/pull/13050#pullrequestreview-399771238", "createdAt": "2020-04-24T09:07:30Z", "commit": {"oid": "976f28680df424bf028eb12a3f413049c17bf098"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQwOTowNzozMFrOGLOFKQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQwOToxMjowOVrOGLORkg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQxODIxNw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        getLogger().log(LogLevel.DEBUG, \"Stem '\"+current.stringValue()+\"' mode \"+index.getStemMode()\n          \n          \n            \n                        getLogger().log(LogLevel.DEBUG, () -> \"Stem '\"+current.stringValue()+\"' mode \"+index.getStemMode()", "url": "https://github.com/vespa-engine/vespa/pull/13050#discussion_r414418217", "createdAt": "2020-04-24T09:07:30Z", "author": {"login": "bratseth"}, "path": "container-search/src/main/java/com/yahoo/prelude/querytransform/StemmingSearcher.java", "diffHunk": "@@ -183,9 +184,20 @@ private Item stem(BlockItem current, StemContext context, Index index) {\n         Substring substring = getOffsets(current);\n \n         if (segments.size() == 1) {\n+            getLogger().log(LogLevel.DEBUG, \"Stem '\"+current.stringValue()+\"' mode \"+index.getStemMode()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "976f28680df424bf028eb12a3f413049c17bf098"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQxOTQ0NQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        getLogger().log(LogLevel.DEBUG, \"Stem to multiple segments '\"+segment+\"'\");\n          \n          \n            \n                        getLogger().log(LogLevel.DEBUG, () -> \"Stem to multiple segments '\"+segment+\"'\");", "url": "https://github.com/vespa-engine/vespa/pull/13050#discussion_r414419445", "createdAt": "2020-04-24T09:09:20Z", "author": {"login": "bratseth"}, "path": "container-search/src/main/java/com/yahoo/prelude/querytransform/StemmingSearcher.java", "diffHunk": "@@ -194,6 +206,7 @@ private Item stem(BlockItem current, StemContext context, Index index) {\n             composite = chooseComposite(current, ((Item) current).getParent(), indexName);\n \n         for (StemList segment : segments) {\n+            getLogger().log(LogLevel.DEBUG, \"Stem to multiple segments '\"+segment+\"'\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "976f28680df424bf028eb12a3f413049c17bf098"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQyMDE1Mw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    log.log(Level.FINEST, \"getStemmerForLanguage '\"+language+\"' mode: \"+stemMode);\n          \n          \n            \n                    log.log(Level.FINEST, () -> \"getStemmerForLanguage '\"+language+\"' mode: \"+stemMode);", "url": "https://github.com/vespa-engine/vespa/pull/13050#discussion_r414420153", "createdAt": "2020-04-24T09:10:21Z", "author": {"login": "bratseth"}, "path": "linguistics/src/main/java/com/yahoo/language/opennlp/OpenNlpTokenizer.java", "diffHunk": "@@ -57,6 +60,7 @@ public OpenNlpTokenizer(Normalizer normalizer, Transformer transformer) {\n     }\n \n     private Stemmer getStemmerForLanguage(Language language, StemMode stemMode) {\n+        log.log(Level.FINEST, \"getStemmerForLanguage '\"+language+\"' mode: \"+stemMode);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "976f28680df424bf028eb12a3f413049c17bf098"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQyMDQyOQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    log.log(Level.FINEST, \"processToken '\"+token+\"'\");\n          \n          \n            \n                    log.log(Level.FINEST, () -> \"processToken '\"+token+\"'\");", "url": "https://github.com/vespa-engine/vespa/pull/13050#discussion_r414420429", "createdAt": "2020-04-24T09:10:43Z", "author": {"login": "bratseth"}, "path": "linguistics/src/main/java/com/yahoo/language/opennlp/OpenNlpTokenizer.java", "diffHunk": "@@ -120,13 +124,17 @@ private Stemmer getStemmerForLanguage(Language language, StemMode stemMode) {\n \n     private String processToken(String token, Language language, StemMode stemMode, boolean removeAccents,\n                                 Stemmer stemmer) {\n+        log.log(Level.FINEST, \"processToken '\"+token+\"'\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "976f28680df424bf028eb12a3f413049c17bf098"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQyMDYyMA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        log.log(Level.FINEST, \"stem '\"+oldToken+\"' to '\"+token+\"'\");\n          \n          \n            \n                        log.log(Level.FINEST, () -> \"stem '\"+oldToken+\"' to '\"+token+\"'\");", "url": "https://github.com/vespa-engine/vespa/pull/13050#discussion_r414420620", "createdAt": "2020-04-24T09:11:02Z", "author": {"login": "bratseth"}, "path": "linguistics/src/main/java/com/yahoo/language/opennlp/OpenNlpTokenizer.java", "diffHunk": "@@ -120,13 +124,17 @@ private Stemmer getStemmerForLanguage(Language language, StemMode stemMode) {\n \n     private String processToken(String token, Language language, StemMode stemMode, boolean removeAccents,\n                                 Stemmer stemmer) {\n+        log.log(Level.FINEST, \"processToken '\"+token+\"'\");\n         token = normalizer.normalize(token);\n         token = LinguisticsCase.toLowerCase(token);\n         if (removeAccents)\n             token = transformer.accentDrop(token, language);\n         if (stemMode != StemMode.NONE) {\n+            String oldToken = token;\n             token = doStemming(token, stemmer);\n+            log.log(Level.FINEST, \"stem '\"+oldToken+\"' to '\"+token+\"'\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "976f28680df424bf028eb12a3f413049c17bf098"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQyMDgyMg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    log.log(Level.FINEST, \"processed token is: \"+token);\n          \n          \n            \n                    log.log(Level.FINEST, () -> \"processed token is: \"+token);", "url": "https://github.com/vespa-engine/vespa/pull/13050#discussion_r414420822", "createdAt": "2020-04-24T09:11:20Z", "author": {"login": "bratseth"}, "path": "linguistics/src/main/java/com/yahoo/language/opennlp/OpenNlpTokenizer.java", "diffHunk": "@@ -120,13 +124,17 @@ private Stemmer getStemmerForLanguage(Language language, StemMode stemMode) {\n \n     private String processToken(String token, Language language, StemMode stemMode, boolean removeAccents,\n                                 Stemmer stemmer) {\n+        log.log(Level.FINEST, \"processToken '\"+token+\"'\");\n         token = normalizer.normalize(token);\n         token = LinguisticsCase.toLowerCase(token);\n         if (removeAccents)\n             token = transformer.accentDrop(token, language);\n         if (stemMode != StemMode.NONE) {\n+            String oldToken = token;\n             token = doStemming(token, stemmer);\n+            log.log(Level.FINEST, \"stem '\"+oldToken+\"' to '\"+token+\"'\");\n         }\n+        log.log(Level.FINEST, \"processed token is: \"+token);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "976f28680df424bf028eb12a3f413049c17bf098"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQyMTAzOA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    log.log(Level.FINE, \"guessing language \"+result.get()+\" from input: \"+input);\n          \n          \n            \n                    log.log(Level.FINE, () -> \"guessing language \"+result.get()+\" from input: \"+input);", "url": "https://github.com/vespa-engine/vespa/pull/13050#discussion_r414421038", "createdAt": "2020-04-24T09:11:39Z", "author": {"login": "bratseth"}, "path": "linguistics/src/main/java/com/yahoo/language/opennlp/OptimaizeDetector.java", "diffHunk": "@@ -96,6 +99,7 @@ public Language guessLanguage(String input) {\n     private static Language guessLanguageUsingOptimaize(String input) {\n         Optional<LdLocale> result = languageDetector.detect(textObjectFactory.forText(input));\n         if ( ! result.isPresent()) return Language.UNKNOWN;\n+        log.log(Level.FINE, \"guessing language \"+result.get()+\" from input: \"+input);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "976f28680df424bf028eb12a3f413049c17bf098"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQyMTI3NA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        log.log(Level.FINEST, \"stem '\"+oldToken+\"' to '\"+token+\"'\");\n          \n          \n            \n                        log.log(Level.FINEST, () -> \"stem '\"+oldToken+\"' to '\"+token+\"'\");", "url": "https://github.com/vespa-engine/vespa/pull/13050#discussion_r414421274", "createdAt": "2020-04-24T09:11:57Z", "author": {"login": "bratseth"}, "path": "linguistics/src/main/java/com/yahoo/language/simple/SimpleTokenizer.java", "diffHunk": "@@ -64,12 +67,17 @@ public SimpleTokenizer(Normalizer normalizer, Transformer transformer) {\n     }\n \n     private String processToken(String token, Language language, StemMode stemMode, boolean removeAccents) {\n+        log.log(Level.FINEST, \"processToken '\"+token+\"'\");\n         token = normalizer.normalize(token);\n         token = LinguisticsCase.toLowerCase(token);\n         if (removeAccents)\n             token = transformer.accentDrop(token, language);\n-        if (stemMode != StemMode.NONE)\n+        if (stemMode != StemMode.NONE) {\n+            String oldToken = token;\n             token = stemmer.stem(token);\n+            log.log(Level.FINEST, \"stem '\"+oldToken+\"' to '\"+token+\"'\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "976f28680df424bf028eb12a3f413049c17bf098"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQyMTM5NA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    log.log(Level.FINEST, \"processed token is: \"+token);\n          \n          \n            \n                    log.log(Level.FINEST, () -> \"processed token is: \"+token);", "url": "https://github.com/vespa-engine/vespa/pull/13050#discussion_r414421394", "createdAt": "2020-04-24T09:12:09Z", "author": {"login": "bratseth"}, "path": "linguistics/src/main/java/com/yahoo/language/simple/SimpleTokenizer.java", "diffHunk": "@@ -64,12 +67,17 @@ public SimpleTokenizer(Normalizer normalizer, Transformer transformer) {\n     }\n \n     private String processToken(String token, Language language, StemMode stemMode, boolean removeAccents) {\n+        log.log(Level.FINEST, \"processToken '\"+token+\"'\");\n         token = normalizer.normalize(token);\n         token = LinguisticsCase.toLowerCase(token);\n         if (removeAccents)\n             token = transformer.accentDrop(token, language);\n-        if (stemMode != StemMode.NONE)\n+        if (stemMode != StemMode.NONE) {\n+            String oldToken = token;\n             token = stemmer.stem(token);\n+            log.log(Level.FINEST, \"stem '\"+oldToken+\"' to '\"+token+\"'\");\n+        }\n+        log.log(Level.FINEST, \"processed token is: \"+token);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "976f28680df424bf028eb12a3f413049c17bf098"}, "originalPosition": 32}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "be1fb0d49eead759e69ed224c403cd8ecf5ed84e", "author": {"user": {"login": "arnej27959", "name": "Arne H Juul"}}, "url": "https://github.com/vespa-engine/vespa/commit/be1fb0d49eead759e69ed224c403cd8ecf5ed84e", "committedDate": "2020-04-24T09:18:18Z", "message": "Apply suggestions from code review\n\nCo-Authored-By: Jon Bratseth <bratseth@oath.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b1e84e7c2275cf787826e7621934480c7056f142", "author": {"user": {"login": "arnej27959", "name": "Arne H Juul"}}, "url": "https://github.com/vespa-engine/vespa/commit/b1e84e7c2275cf787826e7621934480c7056f142", "committedDate": "2020-04-24T09:29:53Z", "message": "variables in lambdas must be final"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5ODE0ODUw", "url": "https://github.com/vespa-engine/vespa/pull/13050#pullrequestreview-399814850", "createdAt": "2020-04-24T10:09:24Z", "commit": {"oid": "b1e84e7c2275cf787826e7621934480c7056f142"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3375, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}