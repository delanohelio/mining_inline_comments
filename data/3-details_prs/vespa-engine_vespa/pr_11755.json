{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYyMDM3Mzgw", "number": 11755, "title": "Support modify of mixed tensors", "bodyText": "It should be possible to modify a tensor field with a mixed type using the \"blocks\" short form.", "createdAt": "2020-01-13T10:21:52Z", "url": "https://github.com/vespa-engine/vespa/pull/11755", "merged": true, "mergeCommit": {"oid": "48f343ce07f74d6a7eaefcfc6c907c4ef255619c"}, "closed": true, "closedAt": "2020-01-13T12:26:32Z", "author": {"login": "bratseth"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb55qS-AH2gAyMzYyMDM3MzgwOmEzZWM5N2RlMjY1NzJhY2RiZmU0YjE4MDE3NDQwNjFkZWNiODRkMzg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb57llmAFqTM0MTgxMjQzMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a3ec97de26572acdbfe4b1801744061decb84d38", "author": {"user": {"login": "vespa-headless", "name": null}}, "url": "https://github.com/vespa-engine/vespa/commit/a3ec97de26572acdbfe4b1801744061decb84d38", "committedDate": "2020-01-13T10:19:24Z", "message": "Support modify of mixed tensors"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQxODAzMTEx", "url": "https://github.com/vespa-engine/vespa/pull/11755#pullrequestreview-341803111", "createdAt": "2020-01-13T12:14:52Z", "commit": {"oid": "a3ec97de26572acdbfe4b1801744061decb84d38"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8477acfc593e68fba389bbdda69d65267a2da641", "author": {"user": {"login": "vespa-headless", "name": null}}, "url": "https://github.com/vespa-engine/vespa/commit/8477acfc593e68fba389bbdda69d65267a2da641", "committedDate": "2020-01-13T12:25:53Z", "message": "Update javadoc"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQxODEyNDMx", "url": "https://github.com/vespa-engine/vespa/pull/11755#pullrequestreview-341812431", "createdAt": "2020-01-13T12:33:57Z", "commit": {"oid": "a3ec97de26572acdbfe4b1801744061decb84d38"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xM1QxMjozMzo1N1rOFc1c_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xM1QxMjozMzo1N1rOFc1c_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTc4MDIyMg==", "bodyText": "This will break how we handle such updates in backend. We treat the cells to update as a sparse tensor and assumes this has been verified before serialized. To support the blocked syntax, the resulting tensor must still be a sparse one. Also see tensor_modify_update_treats_the_input_tensor_as_sparse().", "url": "https://github.com/vespa-engine/vespa/pull/11755#discussion_r365780222", "createdAt": "2020-01-13T12:33:57Z", "author": {"login": "geirst"}, "path": "document/src/main/java/com/yahoo/document/update/TensorModifyUpdate.java", "diffHunk": "@@ -29,8 +30,8 @@ public TensorModifyUpdate(Operation operation, TensorFieldValue tensor) {\n     }\n \n     private void verifyCompatibleType(TensorType type) {\n-        if (type.dimensions().stream().anyMatch(dim -> dim.isIndexed()) ) {\n-            throw new IllegalArgumentException(\"Tensor type '\" + type + \"' is not compatible as it contains some indexed dimensions\");\n+        if (type.rank() > 0 && type.dimensions().stream().noneMatch(dim -> dim.isMapped()) ) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a3ec97de26572acdbfe4b1801744061decb84d38"}, "originalPosition": 14}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3995, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}