{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk3NTgxMDEy", "number": 12810, "title": "Add distributor bucket db memory usage metrics", "bodyText": "@geirst please review.\nOne question up for debate is the metric dimension key name of the bucket DB metrics. There is one dimension for the mutable DBs and one for the read-only DBs. I've just gone with \"type\" as the key here, but we might have something more suitable.", "createdAt": "2020-04-02T13:31:11Z", "url": "https://github.com/vespa-engine/vespa/pull/12810", "merged": true, "mergeCommit": {"oid": "6299f2bf521a233f47d76fc6efa30d46aa417910"}, "closed": true, "closedAt": "2020-04-03T12:39:41Z", "author": {"login": "vekterli"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcTsR5igH2gAyMzk3NTgxMDEyOjJkM2FjZjI2NGZkM2E4NjYxZDIxZDViM2YzNmJjNmQ4YTY1YWI4OTU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcT__ohAFqTM4NzIwNjg4OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2d3acf264fd3a8661d21d5b3f36bc6d8a65ab895", "author": {"user": {"login": "vekterli", "name": "Tor Brede Vekterli"}}, "url": "https://github.com/vespa-engine/vespa/commit/2d3acf264fd3a8661d21d5b3f36bc6d8a65ab895", "committedDate": "2020-04-02T13:26:01Z", "message": "Add memory usage metrics for distributor bucket databases"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dae2cca202f475db9f42aff60ace97a6baecf7a8", "author": {"user": {"login": "vekterli", "name": "Tor Brede Vekterli"}}, "url": "https://github.com/vespa-engine/vespa/commit/dae2cca202f475db9f42aff60ace97a6baecf7a8", "committedDate": "2020-04-02T13:26:05Z", "message": "Use common MemoryUsageMetrics in searchcore as well"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3MTAzMzgw", "url": "https://github.com/vespa-engine/vespa/pull/12810#pullrequestreview-387103380", "createdAt": "2020-04-03T09:36:54Z", "commit": {"oid": "2d3acf264fd3a8661d21d5b3f36bc6d8a65ab895"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QwOTozNjo1NFrOGAN-yQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QwOTo0MTo0M1rOGAOJew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjg4MjI0OQ==", "bodyText": "Consider changing description to match metric name: \"<= allocated_bytes\"", "url": "https://github.com/vespa-engine/vespa/pull/12810#discussion_r402882249", "createdAt": "2020-04-03T09:36:54Z", "author": {"login": "geirst"}, "path": "metrics/src/vespa/metrics/common/memory_usage_metrics.cpp", "diffHunk": "@@ -0,0 +1,28 @@\n+// Copyright 2017 Yahoo Holdings. Licensed under the terms of the Apache 2.0 license. See LICENSE in the project root.\n+\n+#include \"memory_usage_metrics.h\"\n+#include <vespa/vespalib/util/memoryusage.h>\n+\n+namespace metrics {\n+\n+MemoryUsageMetrics::MemoryUsageMetrics(metrics::MetricSet* parent)\n+    : MetricSet(\"memory_usage\", {}, \"The memory usage for a given component\", parent),\n+      _allocated_bytes(\"allocated_bytes\", {}, \"The number of allocated bytes\", this),\n+      _used_bytes(\"used_bytes\", {}, \"The number of used bytes (<= allocatedbytes)\", this),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d3acf264fd3a8661d21d5b3f36bc6d8a65ab895"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjg4MjQyMA==", "bodyText": "Consider changing description to match metric name: \"<= used_bytes\"", "url": "https://github.com/vespa-engine/vespa/pull/12810#discussion_r402882420", "createdAt": "2020-04-03T09:37:13Z", "author": {"login": "geirst"}, "path": "metrics/src/vespa/metrics/common/memory_usage_metrics.cpp", "diffHunk": "@@ -0,0 +1,28 @@\n+// Copyright 2017 Yahoo Holdings. Licensed under the terms of the Apache 2.0 license. See LICENSE in the project root.\n+\n+#include \"memory_usage_metrics.h\"\n+#include <vespa/vespalib/util/memoryusage.h>\n+\n+namespace metrics {\n+\n+MemoryUsageMetrics::MemoryUsageMetrics(metrics::MetricSet* parent)\n+    : MetricSet(\"memory_usage\", {}, \"The memory usage for a given component\", parent),\n+      _allocated_bytes(\"allocated_bytes\", {}, \"The number of allocated bytes\", this),\n+      _used_bytes(\"used_bytes\", {}, \"The number of used bytes (<= allocatedbytes)\", this),\n+      _dead_bytes(\"dead_bytes\", {}, \"The number of dead bytes (<= usedbytes)\", this),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d3acf264fd3a8661d21d5b3f36bc6d8a65ab895"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjg4NDk4Nw==", "bodyText": "I think \"type\" could interfere with other dimension names. Consider \"bucket_db_type\" instead?", "url": "https://github.com/vespa-engine/vespa/pull/12810#discussion_r402884987", "createdAt": "2020-04-03T09:41:43Z", "author": {"login": "geirst"}, "path": "storage/src/vespa/storage/distributor/distributormetricsset.cpp", "diffHunk": "@@ -2,11 +2,19 @@\n #include \"distributormetricsset.h\"\n #include <vespa/metrics/loadmetric.hpp>\n #include <vespa/metrics/summetric.hpp>\n+#include <vespa/vespalib/util/memoryusage.h>\n \n namespace storage::distributor {\n \n using metrics::MetricSet;\n \n+BucketDbMetrics::BucketDbMetrics(const vespalib::string& db_type, metrics::MetricSet* owner)\n+    : metrics::MetricSet(\"bucket_db\", {{\"type\", db_type}}, \"\", owner),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d3acf264fd3a8661d21d5b3f36bc6d8a65ab895"}, "originalPosition": 11}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c27e2a92ceb19a0f7b9d805e8e04c0ac4f910c2d", "author": {"user": {"login": "vekterli", "name": "Tor Brede Vekterli"}}, "url": "https://github.com/vespa-engine/vespa/commit/c27e2a92ceb19a0f7b9d805e8e04c0ac4f910c2d", "committedDate": "2020-04-03T12:00:38Z", "message": "Improve dimension naming and metric descriptions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3MjA2ODg4", "url": "https://github.com/vespa-engine/vespa/pull/12810#pullrequestreview-387206888", "createdAt": "2020-04-03T12:24:10Z", "commit": {"oid": "c27e2a92ceb19a0f7b9d805e8e04c0ac4f910c2d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2564, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}