{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc1NDYzNzgx", "number": 12202, "title": "Revert \"Revert \"Create a resourcepool so that we do not need to reconnect to content \u2026\"\"", "bodyText": "Reverts #12197", "createdAt": "2020-02-14T16:13:43Z", "url": "https://github.com/vespa-engine/vespa/pull/12202", "merged": true, "mergeCommit": {"oid": "07466b9a8a8d4b6d61b193893a1ef13bed1f47c0"}, "closed": true, "closedAt": "2020-02-18T21:53:50Z", "author": {"login": "baldersheim"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcER5_BAH2gAyMzc1NDYzNzgxOjRlMzY2OTQ1ZDNjYTRlYjljYjQ2ODI3NzA2ODJlZmI1ZGFkZTNjMTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcFemqSgFqTM2MDE4NzcxOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4e366945d3ca4eb9cb4682770682efb5dade3c13", "author": {"user": {"login": "baldersheim", "name": "Henning Baldersheim"}}, "url": "https://github.com/vespa-engine/vespa/commit/4e366945d3ca4eb9cb4682770682efb5dade3c13", "committedDate": "2020-02-14T16:13:30Z", "message": "Revert \"Revert \"Create a resourcepool so that we do not need to reconnect to content \u2026\"\""}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e2959282016fa77d7b64aa6511286387e360b153", "author": {"user": {"login": "baldersheim", "name": "Henning Baldersheim"}}, "url": "https://github.com/vespa-engine/vespa/commit/e2959282016fa77d7b64aa6511286387e360b153", "committedDate": "2020-02-14T18:53:36Z", "message": "Let rpcresourcepool be a child of dispatcher and inject it."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6393b18c87614ab8bda956414bc0d9f2a963fd8d", "author": {"user": {"login": "baldersheim", "name": "Henning Baldersheim"}}, "url": "https://github.com/vespa-engine/vespa/commit/6393b18c87614ab8bda956414bc0d9f2a963fd8d", "committedDate": "2020-02-15T13:12:57Z", "message": "Make the resourcepool a proper child of the dispatcher."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5ODMxNzY1", "url": "https://github.com/vespa-engine/vespa/pull/12202#pullrequestreview-359831765", "createdAt": "2020-02-17T15:51:22Z", "commit": {"oid": "6393b18c87614ab8bda956414bc0d9f2a963fd8d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QxNTo1MToyMlrOFqpE8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QxNjowMjo1NFrOFqpcjQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDI1NzUyMg==", "bodyText": "Suggest to use var for these, as their type is clear from the right hand side.", "url": "https://github.com/vespa-engine/vespa/pull/12202#discussion_r380257522", "createdAt": "2020-02-17T15:51:22Z", "author": {"login": "gjoranv"}, "path": "config-model/src/main/java/com/yahoo/vespa/model/container/search/ContainerSearch.java", "diffHunk": "@@ -58,7 +59,11 @@ public void connectSearchClusters(Map<String, AbstractSearchCluster> searchClust\n     private void initializeDispatchers(Collection<AbstractSearchCluster> searchClusters) {\n         for (AbstractSearchCluster searchCluster : searchClusters) {\n             if ( ! ( searchCluster instanceof IndexedSearchCluster)) continue;\n-            owningCluster.addComponent(new DispatcherComponent((IndexedSearchCluster)searchCluster));\n+            Component dispatcher = new DispatcherComponent((IndexedSearchCluster)searchCluster);\n+            Component rpcResoucePool = new RpcResourcePoolComponent();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6393b18c87614ab8bda956414bc0d9f2a963fd8d"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDI2MTY1OQ==", "bodyText": "Just inject() will do. The name is only used with the @Named annotation for named constructor params, which is useful when the same ctor needs multiple instances of the same class.", "url": "https://github.com/vespa-engine/vespa/pull/12202#discussion_r380261659", "createdAt": "2020-02-17T15:59:21Z", "author": {"login": "gjoranv"}, "path": "config-model/src/main/java/com/yahoo/vespa/model/container/search/ContainerSearch.java", "diffHunk": "@@ -58,7 +59,11 @@ public void connectSearchClusters(Map<String, AbstractSearchCluster> searchClust\n     private void initializeDispatchers(Collection<AbstractSearchCluster> searchClusters) {\n         for (AbstractSearchCluster searchCluster : searchClusters) {\n             if ( ! ( searchCluster instanceof IndexedSearchCluster)) continue;\n-            owningCluster.addComponent(new DispatcherComponent((IndexedSearchCluster)searchCluster));\n+            Component dispatcher = new DispatcherComponent((IndexedSearchCluster)searchCluster);\n+            Component rpcResoucePool = new RpcResourcePoolComponent();\n+            dispatcher.injectForName(rpcResoucePool.getComponentId().getName(), rpcResoucePool);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6393b18c87614ab8bda956414bc0d9f2a963fd8d"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDI2MzU2NQ==", "bodyText": "container-search is available from the model, so the class object can be used instead of a string. It will then fail compile-time instead of runtime if the class is moved or renamed.", "url": "https://github.com/vespa-engine/vespa/pull/12202#discussion_r380263565", "createdAt": "2020-02-17T16:02:54Z", "author": {"login": "gjoranv"}, "path": "config-model/src/main/java/com/yahoo/vespa/model/container/search/RpcResourcePoolComponent.java", "diffHunk": "@@ -0,0 +1,18 @@\n+// Copyright 2020 Oath Inc. Licensed under the terms of the Apache 2.0 license. See LICENSE in the project root.\n+package com.yahoo.vespa.model.container.search;\n+\n+import com.yahoo.osgi.provider.model.ComponentModel;\n+import com.yahoo.vespa.model.container.component.Component;\n+import com.yahoo.vespa.model.container.xml.BundleMapper;\n+\n+public class RpcResourcePoolComponent extends Component<RpcResourcePoolComponent, ComponentModel> {\n+\n+    public RpcResourcePoolComponent() {\n+        super(toComponentModel());\n+    }\n+\n+    private static ComponentModel toComponentModel() {\n+        String className = \"com.yahoo.search.dispatch.rpc.RpcResourcePool\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6393b18c87614ab8bda956414bc0d9f2a963fd8d"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "760e14dfef63c04d27a6b6e88bd2d003bafdd314", "author": {"user": {"login": "baldersheim", "name": "Henning Baldersheim"}}, "url": "https://github.com/vespa-engine/vespa/commit/760e14dfef63c04d27a6b6e88bd2d003bafdd314", "committedDate": "2020-02-17T21:52:53Z", "message": "Use class.getName to get compile time error detection.\nUse 'inject' and 'var' where obvious."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYwMTg3NzE4", "url": "https://github.com/vespa-engine/vespa/pull/12202#pullrequestreview-360187718", "createdAt": "2020-02-18T09:35:05Z", "commit": {"oid": "760e14dfef63c04d27a6b6e88bd2d003bafdd314"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3001, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}