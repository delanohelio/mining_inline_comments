{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI4MDM3MzYy", "number": 13489, "title": "Config server refactoring, part 6", "bodyText": "", "createdAt": "2020-06-04T19:16:12Z", "url": "https://github.com/vespa-engine/vespa/pull/13489", "merged": true, "mergeCommit": {"oid": "8cb9e85e810b2e1bc7dcd55fcb9c96858c44720f"}, "closed": true, "closedAt": "2020-06-05T09:21:21Z", "author": {"login": "hmusum"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcn4BJgAH2gAyNDI4MDM3MzYyOjIwMjFlZTUyNjNhYzg0YjJmODFlZjc0ODMwOGRkZjEzYjYxMmIxNjI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcoO6X6gFqTQyNTEyMjA5MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2021ee5263ac84b2f81ef748308ddf13b612b162", "author": {"user": {"login": "hmusum", "name": "Harald Musum"}}, "url": "https://github.com/vespa-engine/vespa/commit/2021ee5263ac84b2f81ef748308ddf13b612b162", "committedDate": "2020-06-04T06:25:04Z", "message": "Remove dead code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "be78d3ca58195e5461986f50e0597cfbf16f8810", "author": {"user": {"login": "hmusum", "name": "Harald Musum"}}, "url": "https://github.com/vespa-engine/vespa/commit/be78d3ca58195e5461986f50e0597cfbf16f8810", "committedDate": "2020-06-04T19:15:07Z", "message": "Merge TenantApplications and TenantRequestHandler\n\nMove tests to ApplicationRepositoryTest or TenantApplicationsTest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6b111969731bb4d18c2e26e817b0a205e50dc3ea", "author": {"user": {"login": "hmusum", "name": "Harald Musum"}}, "url": "https://github.com/vespa-engine/vespa/commit/6b111969731bb4d18c2e26e817b0a205e50dc3ea", "committedDate": "2020-06-05T06:02:46Z", "message": "Remove debug output"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1MTIyMDkx", "url": "https://github.com/vespa-engine/vespa/pull/13489#pullrequestreview-425122091", "createdAt": "2020-06-05T09:01:04Z", "commit": {"oid": "be78d3ca58195e5461986f50e0597cfbf16f8810"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQwOTowMTowNFrOGfmUrw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQwOTowMTowNFrOGfmUrw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTc4NjkyNw==", "bodyText": "If all the things are directly available for injection, I suggest to do that instead of using the GlobalComponentRegistry.", "url": "https://github.com/vespa-engine/vespa/pull/13489#discussion_r435786927", "createdAt": "2020-06-05T09:01:04Z", "author": {"login": "gjoranv"}, "path": "configserver/src/main/java/com/yahoo/vespa/config/server/application/TenantApplications.java", "diffHunk": "@@ -38,32 +53,43 @@\n  * @author Ulf Lilleengen\n  * @author jonmv\n  */\n-public class TenantApplications {\n+public class TenantApplications implements RequestHandler, ReloadHandler, HostValidator<ApplicationId> {\n \n     private static final Logger log = Logger.getLogger(TenantApplications.class.getName());\n \n     private final Curator curator;\n     private final Path applicationsPath;\n     private final Path locksPath;\n     private final Curator.DirectoryCache directoryCache;\n-    private final ReloadHandler reloadHandler;\n     private final Executor zkWatcherExecutor;\n+    private final Metrics metrics;\n+    private final TenantName tenant;\n+    private final List<ReloadListener> reloadListeners;\n+    private final ConfigResponseFactory responseFactory;\n+    private final HostRegistry<ApplicationId> hostRegistry;\n+    private final ApplicationMapper applicationMapper = new ApplicationMapper();\n+    private final MetricUpdater tenantMetricUpdater;\n+    private final Clock clock = Clock.systemUTC();\n \n-    private TenantApplications(Curator curator, ReloadHandler reloadHandler, TenantName tenant,\n-                               ExecutorService zkCacheExecutor, StripedExecutor<TenantName> zkWatcherExecutor) {\n-        this.curator = curator;\n+\n+    private TenantApplications(TenantName tenant, GlobalComponentRegistry registry) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "be78d3ca58195e5461986f50e0597cfbf16f8810"}, "originalPosition": 79}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3686, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}