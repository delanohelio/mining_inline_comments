{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkyMzc0OTIz", "number": 14523, "title": "Cache node objects", "bodyText": "I suggest we do this first and consider handling it in CuratorDatabase if we\ncan think of a safe way to update that cache.\nReduces test run time in this module by 5 seconds on my machine.\n@bratseth or @baldersheim", "createdAt": "2020-09-24T11:21:41Z", "url": "https://github.com/vespa-engine/vespa/pull/14523", "merged": true, "mergeCommit": {"oid": "c885111053de7e47484321a443911b2afd40ed48"}, "closed": true, "closedAt": "2020-09-24T13:25:04Z", "author": {"login": "mpolden"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdL-29mgH2gAyNDkyMzc0OTIzOjk4NWU3YzM4Y2Q4NDhjNWY0ZjNhZGNkYzQ1NGJiZTYyYmE4MTczMjM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdMAGkVAH2gAyNDkyMzc0OTIzOjAwYjhhNDhlYmRlY2FjZWMyNjRiM2E0NTc1NTdjYTcyM2VjODhhMjE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "985e7c38cd848c5f4f3adcdc454bbe62ba817323", "author": {"user": {"login": "mpolden", "name": "Martin Polden"}}, "url": "https://github.com/vespa-engine/vespa/commit/985e7c38cd848c5f4f3adcdc454bbe62ba817323", "committedDate": "2020-09-24T10:44:33Z", "message": "Add node object cache"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "87063d6525aace2042378d94bc1616a35c69f761", "author": {"user": {"login": "mpolden", "name": "Martin Polden"}}, "url": "https://github.com/vespa-engine/vespa/commit/87063d6525aace2042378d94bc1616a35c69f761", "committedDate": "2020-09-24T10:58:51Z", "message": "Report node object cache metrics"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1NDg4MzE0", "url": "https://github.com/vespa-engine/vespa/pull/14523#pullrequestreview-495488314", "createdAt": "2020-09-24T11:50:41Z", "commit": {"oid": "87063d6525aace2042378d94bc1616a35c69f761"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1NDg4OTgw", "url": "https://github.com/vespa-engine/vespa/pull/14523#pullrequestreview-495488980", "createdAt": "2020-09-24T11:51:49Z", "commit": {"oid": "87063d6525aace2042378d94bc1616a35c69f761"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxMTo1MTo0OVrOHXWxRQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxMTo1MTo0OVrOHXWxRQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDI1MjM1Nw==", "bodyText": "I guess the size should be configurable.", "url": "https://github.com/vespa-engine/vespa/pull/14523#discussion_r494252357", "createdAt": "2020-09-24T11:51:49Z", "author": {"login": "baldersheim"}, "path": "node-repository/src/main/java/com/yahoo/vespa/hosted/provision/persistence/NodeSerializer.java", "diffHunk": "@@ -107,6 +113,12 @@\n     // Network port fields\n     private static final String networkPortsKey = \"networkPorts\";\n \n+    // A cache of deserialized Node objects. The cache is keyed on the hash of serialized node data.\n+    //\n+    // Deserializing a Node from slime is expensive, and happens frequently. Node instances that have already been\n+    // deserialized are returned from this cache instead of being deserialized again.\n+    private final Cache<Long, Node> cache = CacheBuilder.newBuilder().maximumSize(1000).build();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "87063d6525aace2042378d94bc1616a35c69f761"}, "originalPosition": 34}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1NDkwNjYy", "url": "https://github.com/vespa-engine/vespa/pull/14523#pullrequestreview-495490662", "createdAt": "2020-09-24T11:54:09Z", "commit": {"oid": "87063d6525aace2042378d94bc1616a35c69f761"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "00b8a48ebdecacec264b3a457557ca723ec88a21", "author": {"user": {"login": "mpolden", "name": "Martin Polden"}}, "url": "https://github.com/vespa-engine/vespa/commit/00b8a48ebdecacec264b3a457557ca723ec88a21", "committedDate": "2020-09-24T12:11:30Z", "message": "Add flag for adjusting cache size"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4197, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}