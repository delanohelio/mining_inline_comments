{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc3NzE1NDUy", "number": 14241, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQxMjowNToxNVrOEfbD6g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQxMjowNToxNVrOEfbD6g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAxMzg0NjgyOnYy", "diffSide": "RIGHT", "path": "docproc/src/main/java/com/yahoo/docproc/jdisc/messagebus/MbusRequestContext.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQxMjowNToxNVrOHLr8zA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQxMjoyMzozMVrOHLsiWQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjAxNjQ2MA==", "bodyText": "Shouldn't this be numMsgWithOriginalSequenceId >= 1 ?", "url": "https://github.com/vespa-engine/vespa/pull/14241#discussion_r482016460", "createdAt": "2020-09-02T12:05:15Z", "author": {"login": "bratseth"}, "path": "docproc/src/main/java/com/yahoo/docproc/jdisc/messagebus/MbusRequestContext.java", "diffHunk": "@@ -96,12 +97,16 @@ public void processingDone(List<Processing> processings) {\n         }\n         long inputSequenceId = requestMsg.getSequenceId();\n         ResponseMerger responseHandler = new ResponseMerger(requestMsg, messages.size(), this);\n+        int numMsgWithOriginalSequenceId = 0;\n         for (Message message : messages) {\n+            if (message.getSequenceId() == inputSequenceId) numMsgWithOriginalSequenceId++;\n+        }\n+        for (Message message : messages) {\n+            String path = internalNoThrottledSourcePath;\n+            if ((numMsgWithOriginalSequenceId == 1) && (message.getSequenceId() == inputSequenceId))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ea820868d666739da68850ecae07d20628d941b6"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjAyNDIyMw==", "bodyText": "No, you shall only continue on the original path if there is exactly one operation with the same id as the incoming operation. If there are multiple operations with the same id they must always be sequenced. If they are to the original id or not does not matter.", "url": "https://github.com/vespa-engine/vespa/pull/14241#discussion_r482024223", "createdAt": "2020-09-02T12:20:09Z", "author": {"login": "baldersheim"}, "path": "docproc/src/main/java/com/yahoo/docproc/jdisc/messagebus/MbusRequestContext.java", "diffHunk": "@@ -96,12 +97,16 @@ public void processingDone(List<Processing> processings) {\n         }\n         long inputSequenceId = requestMsg.getSequenceId();\n         ResponseMerger responseHandler = new ResponseMerger(requestMsg, messages.size(), this);\n+        int numMsgWithOriginalSequenceId = 0;\n         for (Message message : messages) {\n+            if (message.getSequenceId() == inputSequenceId) numMsgWithOriginalSequenceId++;\n+        }\n+        for (Message message : messages) {\n+            String path = internalNoThrottledSourcePath;\n+            if ((numMsgWithOriginalSequenceId == 1) && (message.getSequenceId() == inputSequenceId))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjAxNjQ2MA=="}, "originalCommit": {"oid": "ea820868d666739da68850ecae07d20628d941b6"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjAyNDkxNQ==", "bodyText": "The if is actually the normal path :)", "url": "https://github.com/vespa-engine/vespa/pull/14241#discussion_r482024915", "createdAt": "2020-09-02T12:21:22Z", "author": {"login": "baldersheim"}, "path": "docproc/src/main/java/com/yahoo/docproc/jdisc/messagebus/MbusRequestContext.java", "diffHunk": "@@ -96,12 +97,16 @@ public void processingDone(List<Processing> processings) {\n         }\n         long inputSequenceId = requestMsg.getSequenceId();\n         ResponseMerger responseHandler = new ResponseMerger(requestMsg, messages.size(), this);\n+        int numMsgWithOriginalSequenceId = 0;\n         for (Message message : messages) {\n+            if (message.getSequenceId() == inputSequenceId) numMsgWithOriginalSequenceId++;\n+        }\n+        for (Message message : messages) {\n+            String path = internalNoThrottledSourcePath;\n+            if ((numMsgWithOriginalSequenceId == 1) && (message.getSequenceId() == inputSequenceId))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjAxNjQ2MA=="}, "originalCommit": {"oid": "ea820868d666739da68850ecae07d20628d941b6"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjAyNjA3Mw==", "bodyText": "\ud83d\udc4d", "url": "https://github.com/vespa-engine/vespa/pull/14241#discussion_r482026073", "createdAt": "2020-09-02T12:23:31Z", "author": {"login": "bratseth"}, "path": "docproc/src/main/java/com/yahoo/docproc/jdisc/messagebus/MbusRequestContext.java", "diffHunk": "@@ -96,12 +97,16 @@ public void processingDone(List<Processing> processings) {\n         }\n         long inputSequenceId = requestMsg.getSequenceId();\n         ResponseMerger responseHandler = new ResponseMerger(requestMsg, messages.size(), this);\n+        int numMsgWithOriginalSequenceId = 0;\n         for (Message message : messages) {\n+            if (message.getSequenceId() == inputSequenceId) numMsgWithOriginalSequenceId++;\n+        }\n+        for (Message message : messages) {\n+            String path = internalNoThrottledSourcePath;\n+            if ((numMsgWithOriginalSequenceId == 1) && (message.getSequenceId() == inputSequenceId))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjAxNjQ2MA=="}, "originalCommit": {"oid": "ea820868d666739da68850ecae07d20628d941b6"}, "originalPosition": 18}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1435, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}