{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg5ODcxMjEw", "number": 12599, "title": "use label marker for distance and closeness features", "bodyText": "distance feature now has a two arguments version, allowing\nthe user to explicitly specify label or field\nextend closeness feature the same ways as distance feature\nadd unit test for NNS closeness\n\nI confirm that this contribution is made under the terms of the license found in the root directory of this repository's source tree and that I have the authority necessary to make this contribution on behalf of its copyright owner.\nas discussed earlier today.\n@geirst please review\n@havardpe FYI\nsystem test must be updated when merging this, i have the changes ready and will make PR.", "createdAt": "2020-03-17T14:29:06Z", "url": "https://github.com/vespa-engine/vespa/pull/12599", "merged": true, "mergeCommit": {"oid": "750cbeb19241bcfcb9237f431b9d6686a68dd41f"}, "closed": true, "closedAt": "2020-03-19T07:27:13Z", "author": {"login": "arnej27959"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcOitvGgH2gAyMzg5ODcxMjEwOmZmODUyY2RkNWUzOTE0MTdhODRiNTJiMGFhNDUyMTljNGExODVkN2I=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcO3ewuAFqTM3Njg3MDYwOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ff852cdd5e391417a84b52b0aa45219c4a185d7b", "author": {"user": {"login": "arnej27959", "name": "Arne H Juul"}}, "url": "https://github.com/vespa-engine/vespa/commit/ff852cdd5e391417a84b52b0aa45219c4a185d7b", "committedDate": "2020-03-17T13:27:45Z", "message": "use label marker for distance and closeness features\n\n* distance feature now has a two arguments version, allowing\n  the user to explicitly specify label or field\n* extend closeness feature the same ways as distance feature\n* add unit test for NNS closeness"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2ODE1ODc0", "url": "https://github.com/vespa-engine/vespa/pull/12599#pullrequestreview-376815874", "createdAt": "2020-03-18T12:28:51Z", "commit": {"oid": "ff852cdd5e391417a84b52b0aa45219c4a185d7b"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxMjoyODo1MlrOF4Cuwg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xOFQxMjoyODo1MlrOF4Cuwg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDMwOTMxNA==", "bodyText": "Labels, NoLabels and SingleLabel are now duplicated in 3 unit tests. Please move them to searchlib/src/vespa/searchlib/fef/test and put them in namespace search::fef::test.", "url": "https://github.com/vespa-engine/vespa/pull/12599#discussion_r394309314", "createdAt": "2020-03-18T12:28:52Z", "author": {"login": "geirst"}, "path": "searchlib/src/tests/features/nns_closeness/nns_closeness_test.cpp", "diffHunk": "@@ -0,0 +1,177 @@\n+// Copyright Verizon Media. Licensed under the terms of the Apache 2.0 license. See LICENSE in the project root.\n+\n+#include <vespa/vespalib/testkit/test_kit.h>\n+#include <vespa/searchlib/features/setup.h>\n+#include <vespa/searchlib/fef/test/indexenvironment.h>\n+#include <vespa/searchlib/fef/test/indexenvironmentbuilder.h>\n+#include <vespa/searchlib/fef/test/queryenvironment.h>\n+#include <vespa/searchlib/features/closenessfeature.h>\n+#include <vespa/searchlib/fef/fef.h>\n+#include <vespa/searchlib/fef/test/dummy_dependency_handler.h>\n+#include <vespa/vespalib/stllike/asciistream.h>\n+#include <vespa/vespalib/util/stringfmt.h>\n+\n+using search::feature_t;\n+using namespace search::fef;\n+using namespace search::fef::test;\n+using namespace search::features;\n+using CollectionType = FieldInfo::CollectionType;\n+using DataType = FieldInfo::DataType;\n+\n+const vespalib::string labelFeatureName(\"closeness(label,nns)\");\n+const vespalib::string fieldFeatureName(\"closeness(bar)\");\n+\n+struct BlueprintFactoryFixture {\n+    BlueprintFactory factory;\n+    BlueprintFactoryFixture() : factory()\n+    {\n+        setup_search_features(factory);\n+    }\n+};\n+\n+struct IndexFixture {\n+    IndexEnvironment indexEnv;\n+    IndexFixture() : indexEnv()\n+    {\n+        IndexEnvironmentBuilder builder(indexEnv);\n+        builder.addField(FieldType::ATTRIBUTE, CollectionType::SINGLE, DataType::INT64, \"foo\");\n+        builder.addField(FieldType::ATTRIBUTE, CollectionType::SINGLE, DataType::TENSOR, \"bar\");\n+    }\n+};\n+\n+struct FeatureDumpFixture : public IDumpFeatureVisitor {\n+    virtual void visitDumpFeature(const vespalib::string &) override {\n+        TEST_ERROR(\"no features should be dumped\");\n+    }\n+    FeatureDumpFixture() : IDumpFeatureVisitor() {}\n+};\n+\n+struct Labels {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ff852cdd5e391417a84b52b0aa45219c4a185d7b"}, "originalPosition": 49}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "61b09ca3ef94afef2f7ef59c78178b6514a3e80b", "author": {"user": {"login": "arnej27959", "name": "Arne H Juul"}}, "url": "https://github.com/vespa-engine/vespa/commit/61b09ca3ef94afef2f7ef59c78178b6514a3e80b", "committedDate": "2020-03-18T12:52:29Z", "message": "refactor common test code to reduce duplication"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2ODcwNjA4", "url": "https://github.com/vespa-engine/vespa/pull/12599#pullrequestreview-376870608", "createdAt": "2020-03-18T13:39:24Z", "commit": {"oid": "61b09ca3ef94afef2f7ef59c78178b6514a3e80b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2710, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}