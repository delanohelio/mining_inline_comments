{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg1ODEwNjYz", "number": 12521, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQwNzozOTo1NFrODmkkEA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQxMDowMzozMlrODmnTpQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQxNzcxNTM2OnYy", "diffSide": "RIGHT", "path": "node-repository/src/main/java/com/yahoo/vespa/hosted/provision/NodeRepository.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQwNzozOTo1NFrOF0D_WA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQwNzo1NDowNFrOF0ETXg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDEzNTY0MA==", "bodyText": "Looks like we have this in several places now. We should find a way to model it properly soon.", "url": "https://github.com/vespa-engine/vespa/pull/12521#discussion_r390135640", "createdAt": "2020-03-10T07:39:54Z", "author": {"login": "mpolden"}, "path": "node-repository/src/main/java/com/yahoo/vespa/hosted/provision/NodeRepository.java", "diffHunk": "@@ -608,8 +608,11 @@ public Node markNodeAvailableForNewAllocation(String hostname, Agent agent, Stri\n                 List<Node> children = list().childrenOf(node).asList();\n                 children.forEach(child -> requireRemovable(child, true, force));\n                 db.removeNodes(children);\n-                move(node, State.deprovisioned, Agent.system, Optional.empty());\n                 List<Node> removed = new ArrayList<>(children);\n+                if (zone.cloud().value().equals(\"aws\"))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fcedbb36c7caea42e9ab9f6816fdcd28d71aeae9"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDE0MDc2Ng==", "bodyText": "Agree. What I want to do is create a \"cloud config\" which defines the properties of a cloud and then only test for those properties.", "url": "https://github.com/vespa-engine/vespa/pull/12521#discussion_r390140766", "createdAt": "2020-03-10T07:54:04Z", "author": {"login": "bratseth"}, "path": "node-repository/src/main/java/com/yahoo/vespa/hosted/provision/NodeRepository.java", "diffHunk": "@@ -608,8 +608,11 @@ public Node markNodeAvailableForNewAllocation(String hostname, Agent agent, Stri\n                 List<Node> children = list().childrenOf(node).asList();\n                 children.forEach(child -> requireRemovable(child, true, force));\n                 db.removeNodes(children);\n-                move(node, State.deprovisioned, Agent.system, Optional.empty());\n                 List<Node> removed = new ArrayList<>(children);\n+                if (zone.cloud().value().equals(\"aws\"))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDEzNTY0MA=="}, "originalCommit": {"oid": "fcedbb36c7caea42e9ab9f6816fdcd28d71aeae9"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQxNzcyODY5OnYy", "diffSide": "RIGHT", "path": "node-admin/src/main/java/com/yahoo/vespa/hosted/node/admin/configserver/noderepository/NodeState.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQwNzo0NToyMVrOF0EHNg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQwNzo1Njo1MlrOF0EXJA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDEzNzY1NA==", "bodyText": "Should also be added to com.yahoo.vespa.hosted.controller.api.integration.noderepository.NodeState.", "url": "https://github.com/vespa-engine/vespa/pull/12521#discussion_r390137654", "createdAt": "2020-03-10T07:45:21Z", "author": {"login": "mpolden"}, "path": "node-admin/src/main/java/com/yahoo/vespa/hosted/node/admin/configserver/noderepository/NodeState.java", "diffHunk": "@@ -9,5 +9,5 @@\n  * @author freva\n  */\n public enum NodeState {\n-    provisioned, ready, reserved, active, inactive, dirty, failed, parked\n+    provisioned, ready, reserved, active, inactive, dirty, failed, parked, deprovisioned", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4cf0f9f70c0d7c640f079f0cd1d055e37f4e8fb1"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDE0MTczMg==", "bodyText": "Done - thanks", "url": "https://github.com/vespa-engine/vespa/pull/12521#discussion_r390141732", "createdAt": "2020-03-10T07:56:52Z", "author": {"login": "bratseth"}, "path": "node-admin/src/main/java/com/yahoo/vespa/hosted/node/admin/configserver/noderepository/NodeState.java", "diffHunk": "@@ -9,5 +9,5 @@\n  * @author freva\n  */\n public enum NodeState {\n-    provisioned, ready, reserved, active, inactive, dirty, failed, parked\n+    provisioned, ready, reserved, active, inactive, dirty, failed, parked, deprovisioned", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDEzNzY1NA=="}, "originalCommit": {"oid": "4cf0f9f70c0d7c640f079f0cd1d055e37f4e8fb1"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQxNzczNDc1OnYy", "diffSide": "RIGHT", "path": "config-provisioning/src/main/java/com/yahoo/config/provision/NodeType.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQwNzo0ODowM1rOF0EK3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQwNzo1NToxN1rOF0EU9g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDEzODU4OA==", "bodyText": "Why not?", "url": "https://github.com/vespa-engine/vespa/pull/12521#discussion_r390138588", "createdAt": "2020-03-10T07:48:03Z", "author": {"login": "mpolden"}, "path": "config-provisioning/src/main/java/com/yahoo/config/provision/NodeType.java", "diffHunk": "@@ -45,7 +45,7 @@\n         this.description = description;\n     }\n \n-    public boolean isHost() {\n+    public boolean isDockerHost() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2e8dfe4a5c8bc571262ae4b92feb31cebddc7c5b"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDE0MTE3NA==", "bodyText": "Breaks the config server/config model API - in theory, did not look at usages.\nI still want to do it but in a separate PR.", "url": "https://github.com/vespa-engine/vespa/pull/12521#discussion_r390141174", "createdAt": "2020-03-10T07:55:17Z", "author": {"login": "bratseth"}, "path": "config-provisioning/src/main/java/com/yahoo/config/provision/NodeType.java", "diffHunk": "@@ -45,7 +45,7 @@\n         this.description = description;\n     }\n \n-    public boolean isHost() {\n+    public boolean isDockerHost() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDEzODU4OA=="}, "originalCommit": {"oid": "2e8dfe4a5c8bc571262ae4b92feb31cebddc7c5b"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQxODE2NDg1OnYy", "diffSide": "RIGHT", "path": "node-repository/src/main/java/com/yahoo/vespa/hosted/provision/node/Agent.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQxMDowMzozMlrOF0ITQg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMFQxMDoxMzozM1rOF0Iobw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDIwNjI3NA==", "bodyText": "Add to \n  \n    \n      vespa/controller-api/src/main/java/com/yahoo/vespa/hosted/controller/api/integration/noderepository/NodeHistory.java\n    \n    \n         Line 35\n      in\n      ddd5141\n    \n    \n    \n    \n\n        \n          \n           public enum Agent {", "url": "https://github.com/vespa-engine/vespa/pull/12521#discussion_r390206274", "createdAt": "2020-03-10T10:03:32Z", "author": {"login": "freva"}, "path": "node-repository/src/main/java/com/yahoo/vespa/hosted/provision/node/Agent.java", "diffHunk": "@@ -17,5 +17,6 @@\n     FailedExpirer,\n     InactiveExpirer,\n     ProvisionedExpirer,\n-    ReservationExpirer\n+    ReservationExpirer,\n+    DynamicProvisioningMaintainer", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5f488cb8afc8ea85cbdd5d5ba327caa376d1dc1b"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDIxMTY5NQ==", "bodyText": "Thanks\n#12523", "url": "https://github.com/vespa-engine/vespa/pull/12521#discussion_r390211695", "createdAt": "2020-03-10T10:13:33Z", "author": {"login": "bratseth"}, "path": "node-repository/src/main/java/com/yahoo/vespa/hosted/provision/node/Agent.java", "diffHunk": "@@ -17,5 +17,6 @@\n     FailedExpirer,\n     InactiveExpirer,\n     ProvisionedExpirer,\n-    ReservationExpirer\n+    ReservationExpirer,\n+    DynamicProvisioningMaintainer", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDIwNjI3NA=="}, "originalCommit": {"oid": "5f488cb8afc8ea85cbdd5d5ba327caa376d1dc1b"}, "originalPosition": 22}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2232, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}