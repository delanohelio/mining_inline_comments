{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY0ODc4NDQx", "number": 11861, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMVQwNzoxNDo0NVrODZZNBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMVQwNzo0Njo0NVrODZZkVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI3OTUzOTI0OnYy", "diffSide": "RIGHT", "path": "controller-server/src/main/java/com/yahoo/vespa/hosted/controller/deployment/JobMetrics.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMVQwNzoxNDo0NVrOFfwPoQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMVQwODozNjo0OFrOFfx1fA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODg0MDYwOQ==", "bodyText": "Typo.", "url": "https://github.com/vespa-engine/vespa/pull/11861#discussion_r368840609", "createdAt": "2020-01-21T07:14:45Z", "author": {"login": "mpolden"}, "path": "controller-server/src/main/java/com/yahoo/vespa/hosted/controller/deployment/JobMetrics.java", "diffHunk": "@@ -0,0 +1,64 @@\n+package com.yahoo.vespa.hosted.controller.deployment;\n+\n+import com.yahoo.config.provision.SystemName;\n+import com.yahoo.jdisc.Metric;\n+import com.yahoo.vespa.hosted.controller.api.integration.deployment.JobId;\n+\n+import java.util.Map;\n+\n+/**\n+ * Records metrics related to deployment jobs.\n+ *\n+ * @author jommv", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "79002706787ca4c1def5e5ef50c4ee1340e06dd0"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODg2NjYyMQ==", "bodyText": "Nah, changed my name last week >_<", "url": "https://github.com/vespa-engine/vespa/pull/11861#discussion_r368866621", "createdAt": "2020-01-21T08:36:36Z", "author": {"login": "jonmv"}, "path": "controller-server/src/main/java/com/yahoo/vespa/hosted/controller/deployment/JobMetrics.java", "diffHunk": "@@ -0,0 +1,64 @@\n+package com.yahoo.vespa.hosted.controller.deployment;\n+\n+import com.yahoo.config.provision.SystemName;\n+import com.yahoo.jdisc.Metric;\n+import com.yahoo.vespa.hosted.controller.api.integration.deployment.JobId;\n+\n+import java.util.Map;\n+\n+/**\n+ * Records metrics related to deployment jobs.\n+ *\n+ * @author jommv", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODg0MDYwOQ=="}, "originalCommit": {"oid": "79002706787ca4c1def5e5ef50c4ee1340e06dd0"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODg2NjY4NA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             * @author jommv\n          \n          \n            \n             * @author jonmv", "url": "https://github.com/vespa-engine/vespa/pull/11861#discussion_r368866684", "createdAt": "2020-01-21T08:36:48Z", "author": {"login": "jonmv"}, "path": "controller-server/src/main/java/com/yahoo/vespa/hosted/controller/deployment/JobMetrics.java", "diffHunk": "@@ -0,0 +1,64 @@\n+package com.yahoo.vespa.hosted.controller.deployment;\n+\n+import com.yahoo.config.provision.SystemName;\n+import com.yahoo.jdisc.Metric;\n+import com.yahoo.vespa.hosted.controller.api.integration.deployment.JobId;\n+\n+import java.util.Map;\n+\n+/**\n+ * Records metrics related to deployment jobs.\n+ *\n+ * @author jommv", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODg0MDYwOQ=="}, "originalCommit": {"oid": "79002706787ca4c1def5e5ef50c4ee1340e06dd0"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI3OTU5NDk3OnYy", "diffSide": "RIGHT", "path": "controller-server/src/main/java/com/yahoo/vespa/hosted/controller/deployment/JobMetrics.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMVQwNzo0NDo0NFrOFfww2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMVQwODozNzoyNVrOFfx2ag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODg0OTExMg==", "bodyText": "Missing copyright header:\n// Copyright 2020 Oath Inc. Licensed under the terms of the Apache 2.0 license. See LICENSE in the project root.", "url": "https://github.com/vespa-engine/vespa/pull/11861#discussion_r368849112", "createdAt": "2020-01-21T07:44:44Z", "author": {"login": "mpolden"}, "path": "controller-server/src/main/java/com/yahoo/vespa/hosted/controller/deployment/JobMetrics.java", "diffHunk": "@@ -0,0 +1,64 @@\n+package com.yahoo.vespa.hosted.controller.deployment;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "79002706787ca4c1def5e5ef50c4ee1340e06dd0"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODg2NjkyMg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            package com.yahoo.vespa.hosted.controller.deployment;\n          \n          \n            \n            // Copyright 2020 Oath Inc. Licensed under the terms of the Apache 2.0 license. See LICENSE in the project root.\n          \n          \n            \n            package com.yahoo.vespa.hosted.controller.deployment;", "url": "https://github.com/vespa-engine/vespa/pull/11861#discussion_r368866922", "createdAt": "2020-01-21T08:37:25Z", "author": {"login": "jonmv"}, "path": "controller-server/src/main/java/com/yahoo/vespa/hosted/controller/deployment/JobMetrics.java", "diffHunk": "@@ -0,0 +1,64 @@\n+package com.yahoo.vespa.hosted.controller.deployment;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODg0OTExMg=="}, "originalCommit": {"oid": "79002706787ca4c1def5e5ef50c4ee1340e06dd0"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI3OTU5ODkzOnYy", "diffSide": "RIGHT", "path": "controller-server/src/main/java/com/yahoo/vespa/hosted/controller/deployment/JobMetrics.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMVQwNzo0Njo0NVrOFfwzHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yMVQwODozODozNFrOFfx4WA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODg0OTY5NQ==", "bodyText": "Include the unexpected value in the message (or remove this case and let default handle it).", "url": "https://github.com/vespa-engine/vespa/pull/11861#discussion_r368849695", "createdAt": "2020-01-21T07:46:45Z", "author": {"login": "mpolden"}, "path": "controller-server/src/main/java/com/yahoo/vespa/hosted/controller/deployment/JobMetrics.java", "diffHunk": "@@ -0,0 +1,64 @@\n+package com.yahoo.vespa.hosted.controller.deployment;\n+\n+import com.yahoo.config.provision.SystemName;\n+import com.yahoo.jdisc.Metric;\n+import com.yahoo.vespa.hosted.controller.api.integration.deployment.JobId;\n+\n+import java.util.Map;\n+\n+/**\n+ * Records metrics related to deployment jobs.\n+ *\n+ * @author jommv\n+ */\n+public class JobMetrics {\n+\n+    public static final String start = \"deployment.start\";\n+    public static final String outOfCapacity = \"deployment.outOfCapacity\";\n+    public static final String deploymentFailure = \"deployment.deploymentFailure\";\n+    public static final String convergenceFailure = \"deployment.convergenceFailure\";\n+    public static final String testFailure = \"deployment.testFailure\";\n+    public static final String error = \"deployment.error\";\n+    public static final String abort = \"deployment.abort\";\n+    public static final String success = \"deployment.success\";\n+\n+    private final Metric metric;\n+    private final SystemName system;\n+\n+    public JobMetrics(Metric metric, SystemName system) {\n+        this.metric = metric;\n+        this.system = system;\n+    }\n+\n+    public void jobStarted(JobId id) {\n+        metric.add(start, 1, metric.createContext(contextOf(id)));\n+    }\n+\n+    public void jobFinished(JobId id, RunStatus status) {\n+        metric.add(valueOf(status), 1, metric.createContext(contextOf(id)));\n+    }\n+\n+    Map<String, String> contextOf(JobId id) {\n+        return Map.of(\"tenant\", id.application().tenant().value(),\n+                      \"application\", id.application().application().value(),\n+                      \"instance\", id.application().instance().value(),\n+                      \"job\", id.type().jobName(),\n+                      \"environment\", id.type().environment().value(),\n+                      \"region\", id.type().zone(system).region().value());\n+    }\n+\n+    static String valueOf(RunStatus status) {\n+        switch (status) {\n+            case outOfCapacity: return outOfCapacity;\n+            case deploymentFailed: return deploymentFailure;\n+            case installationFailed: return convergenceFailure;\n+            case testFailure: return testFailure;\n+            case error: return error;\n+            case aborted: return abort;\n+            case success: return success;\n+            case running: throw new IllegalArgumentException(\"Not supposed to get this value\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "79002706787ca4c1def5e5ef50c4ee1340e06dd0"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODg2NzM2MA==", "bodyText": "I have no idea why I wrote it this way o_O", "url": "https://github.com/vespa-engine/vespa/pull/11861#discussion_r368867360", "createdAt": "2020-01-21T08:38:26Z", "author": {"login": "jonmv"}, "path": "controller-server/src/main/java/com/yahoo/vespa/hosted/controller/deployment/JobMetrics.java", "diffHunk": "@@ -0,0 +1,64 @@\n+package com.yahoo.vespa.hosted.controller.deployment;\n+\n+import com.yahoo.config.provision.SystemName;\n+import com.yahoo.jdisc.Metric;\n+import com.yahoo.vespa.hosted.controller.api.integration.deployment.JobId;\n+\n+import java.util.Map;\n+\n+/**\n+ * Records metrics related to deployment jobs.\n+ *\n+ * @author jommv\n+ */\n+public class JobMetrics {\n+\n+    public static final String start = \"deployment.start\";\n+    public static final String outOfCapacity = \"deployment.outOfCapacity\";\n+    public static final String deploymentFailure = \"deployment.deploymentFailure\";\n+    public static final String convergenceFailure = \"deployment.convergenceFailure\";\n+    public static final String testFailure = \"deployment.testFailure\";\n+    public static final String error = \"deployment.error\";\n+    public static final String abort = \"deployment.abort\";\n+    public static final String success = \"deployment.success\";\n+\n+    private final Metric metric;\n+    private final SystemName system;\n+\n+    public JobMetrics(Metric metric, SystemName system) {\n+        this.metric = metric;\n+        this.system = system;\n+    }\n+\n+    public void jobStarted(JobId id) {\n+        metric.add(start, 1, metric.createContext(contextOf(id)));\n+    }\n+\n+    public void jobFinished(JobId id, RunStatus status) {\n+        metric.add(valueOf(status), 1, metric.createContext(contextOf(id)));\n+    }\n+\n+    Map<String, String> contextOf(JobId id) {\n+        return Map.of(\"tenant\", id.application().tenant().value(),\n+                      \"application\", id.application().application().value(),\n+                      \"instance\", id.application().instance().value(),\n+                      \"job\", id.type().jobName(),\n+                      \"environment\", id.type().environment().value(),\n+                      \"region\", id.type().zone(system).region().value());\n+    }\n+\n+    static String valueOf(RunStatus status) {\n+        switch (status) {\n+            case outOfCapacity: return outOfCapacity;\n+            case deploymentFailed: return deploymentFailure;\n+            case installationFailed: return convergenceFailure;\n+            case testFailure: return testFailure;\n+            case error: return error;\n+            case aborted: return abort;\n+            case success: return success;\n+            case running: throw new IllegalArgumentException(\"Not supposed to get this value\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODg0OTY5NQ=="}, "originalCommit": {"oid": "79002706787ca4c1def5e5ef50c4ee1340e06dd0"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODg2NzQxNg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        case running: throw new IllegalArgumentException(\"Not supposed to get this value\");", "url": "https://github.com/vespa-engine/vespa/pull/11861#discussion_r368867416", "createdAt": "2020-01-21T08:38:34Z", "author": {"login": "jonmv"}, "path": "controller-server/src/main/java/com/yahoo/vespa/hosted/controller/deployment/JobMetrics.java", "diffHunk": "@@ -0,0 +1,64 @@\n+package com.yahoo.vespa.hosted.controller.deployment;\n+\n+import com.yahoo.config.provision.SystemName;\n+import com.yahoo.jdisc.Metric;\n+import com.yahoo.vespa.hosted.controller.api.integration.deployment.JobId;\n+\n+import java.util.Map;\n+\n+/**\n+ * Records metrics related to deployment jobs.\n+ *\n+ * @author jommv\n+ */\n+public class JobMetrics {\n+\n+    public static final String start = \"deployment.start\";\n+    public static final String outOfCapacity = \"deployment.outOfCapacity\";\n+    public static final String deploymentFailure = \"deployment.deploymentFailure\";\n+    public static final String convergenceFailure = \"deployment.convergenceFailure\";\n+    public static final String testFailure = \"deployment.testFailure\";\n+    public static final String error = \"deployment.error\";\n+    public static final String abort = \"deployment.abort\";\n+    public static final String success = \"deployment.success\";\n+\n+    private final Metric metric;\n+    private final SystemName system;\n+\n+    public JobMetrics(Metric metric, SystemName system) {\n+        this.metric = metric;\n+        this.system = system;\n+    }\n+\n+    public void jobStarted(JobId id) {\n+        metric.add(start, 1, metric.createContext(contextOf(id)));\n+    }\n+\n+    public void jobFinished(JobId id, RunStatus status) {\n+        metric.add(valueOf(status), 1, metric.createContext(contextOf(id)));\n+    }\n+\n+    Map<String, String> contextOf(JobId id) {\n+        return Map.of(\"tenant\", id.application().tenant().value(),\n+                      \"application\", id.application().application().value(),\n+                      \"instance\", id.application().instance().value(),\n+                      \"job\", id.type().jobName(),\n+                      \"environment\", id.type().environment().value(),\n+                      \"region\", id.type().zone(system).region().value());\n+    }\n+\n+    static String valueOf(RunStatus status) {\n+        switch (status) {\n+            case outOfCapacity: return outOfCapacity;\n+            case deploymentFailed: return deploymentFailure;\n+            case installationFailed: return convergenceFailure;\n+            case testFailure: return testFailure;\n+            case error: return error;\n+            case aborted: return abort;\n+            case success: return success;\n+            case running: throw new IllegalArgumentException(\"Not supposed to get this value\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODg0OTY5NQ=="}, "originalCommit": {"oid": "79002706787ca4c1def5e5ef50c4ee1340e06dd0"}, "originalPosition": 59}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2596, "cost": 1, "resetAt": "2021-11-13T12:26:42Z"}}}