{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE3MzYwNDA4", "number": 8038, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQwNjowNTozOVrOD8vlPQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQwNjowNTozOVrOD8vlPQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1MDIwNzMzOnYy", "diffSide": "RIGHT", "path": "audit-connector/src/main/java/com/sequenceiq/cloudbreak/audit/converter/AuditEventToGrpcAuditEventConverter.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQwNjowNTozOVrOGV3n4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQwNjowNTozOVrOGV3n4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTU4NDYxMA==", "bodyText": "why dont you use generic type for EventData?", "url": "https://github.com/hortonworks/cloudbreak/pull/8038#discussion_r425584610", "createdAt": "2020-05-15T06:05:39Z", "author": {"login": "topolyai5"}, "path": "audit-connector/src/main/java/com/sequenceiq/cloudbreak/audit/converter/AuditEventToGrpcAuditEventConverter.java", "diffHunk": "@@ -0,0 +1,79 @@\n+package com.sequenceiq.cloudbreak.audit.converter;\n+\n+import static com.sequenceiq.cloudbreak.util.ConditionBasedEvaluatorUtil.doIfTrue;\n+import static com.sequenceiq.cloudbreak.util.UuidUtil.uuidSupplier;\n+\n+import java.util.Optional;\n+\n+import org.apache.commons.lang3.StringUtils;\n+import org.springframework.stereotype.Component;\n+\n+import com.cloudera.thunderhead.service.audit.AuditProto;\n+import com.sequenceiq.cloudbreak.audit.model.ActorBase;\n+import com.sequenceiq.cloudbreak.audit.model.ActorCrn;\n+import com.sequenceiq.cloudbreak.audit.model.ActorService;\n+import com.sequenceiq.cloudbreak.audit.model.ApiRequestData;\n+import com.sequenceiq.cloudbreak.audit.model.AuditEvent;\n+import com.sequenceiq.cloudbreak.audit.model.EventData;\n+import com.sequenceiq.cloudbreak.audit.model.ServiceEventData;\n+\n+@Component\n+public class AuditEventToGrpcAuditEventConverter {\n+\n+    public AuditProto.AuditEvent convert(AuditEvent source) {\n+        String id = Optional.ofNullable(source.getId()).orElseGet(uuidSupplier());\n+        String requestId = Optional.ofNullable(source.getRequestId()).orElseGet(uuidSupplier());\n+        AuditProto.AuditEvent.Builder auditEventBuilder = prepareBuilderForCreateAuditEvent(source, id, requestId);\n+        updateAuditEventActor(auditEventBuilder, source.getActor());\n+        updateAuditEventData(auditEventBuilder, source.getEventData());\n+        return auditEventBuilder.build();\n+    }\n+\n+    private AuditProto.AuditEvent.Builder prepareBuilderForCreateAuditEvent(AuditEvent source, String id, String requestId) {\n+        AuditProto.AuditEvent.Builder builder = AuditProto.AuditEvent.newBuilder()\n+                .setId(id)\n+                .setTimestamp(System.currentTimeMillis())\n+                .setAccountId(source.getAccountId())\n+                .setRequestId(requestId)\n+                .setEventName(source.getEventName())\n+                .setEventSource(source.getEventSource());\n+        doIfTrue(source.getSourceIp(), StringUtils::isNotEmpty, builder::setSourceIPAddress);\n+        return builder;\n+    }\n+\n+    private void updateAuditEventActor(AuditProto.AuditEvent.Builder auditEventBuilder, ActorBase actorBase) {\n+        if (actorBase instanceof ActorCrn) {\n+            ActorCrn actor = (ActorCrn) actorBase;\n+            auditEventBuilder.setActorCrn(actor.getActorCrn());\n+        } else if (actorBase instanceof ActorService) {\n+            ActorService actor = (ActorService) actorBase;\n+            auditEventBuilder.setActorServiceName(actor.getActorServiceName());\n+        } else {\n+            throw new IllegalArgumentException(\"Actor has an invalid class: \" + actorBase.getClass().getName());\n+        }\n+    }\n+\n+    private void updateAuditEventData(AuditProto.AuditEvent.Builder auditEventBuilder, EventData source) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "776e2004e35a7d85902aeb026be463fdcae43319"}, "originalPosition": 56}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2460, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}