{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM1MjU3MTg1", "number": 9618, "title": "CB-10255. Ability to use DataBus CNAME instead of the sigma DataBus e\u2026", "bodyText": "\u2026ndpoint.\ndetails:\nadd new entitlement to let customers to use databus cname endpoint instead of the original one\nthe value would be: CDP_USE_DATABUS_CNAME_ENDPOINT\nSee detailed description in the commit message.", "createdAt": "2020-12-09T15:22:43Z", "url": "https://github.com/hortonworks/cloudbreak/pull/9618", "merged": true, "mergeCommit": {"oid": "c84c8047d72f714ecd1746e4a8e3fe4f1e8110e4"}, "closed": true, "closedAt": "2020-12-09T16:30:09Z", "author": {"login": "oleewere"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdkgWwyAH2gAyNTM1MjU3MTg1OjVhYTljODU5MzcwN2I5ZGVjNTc0Njg1MzRhNDI4NjUzMDIwYWM1Yzg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdkg-gugFqTU0ODM0MDAyOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5aa9c8593707b9dec57468534a428653020ac5c8", "author": {"user": {"login": "oleewere", "name": "Oliv\u00e9r Szabo"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/5aa9c8593707b9dec57468534a428653020ac5c8", "committedDate": "2020-12-09T15:20:20Z", "message": "CB-10255. Ability to use DataBus CNAME instead of the sigma DataBus endpoint.\ndetails:\nadd new entitlement to let customers to use databus cname endpoint instead of the original one\n\nthe value would be: CDP_USE_DATABUS_CNAME_ENDPOINT"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ4MzI5MjQx", "url": "https://github.com/hortonworks/cloudbreak/pull/9618#pullrequestreview-548329241", "createdAt": "2020-12-09T15:53:43Z", "commit": {"oid": "5aa9c8593707b9dec57468534a428653020ac5c8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ4MzM0MjI2", "url": "https://github.com/hortonworks/cloudbreak/pull/9618#pullrequestreview-548334226", "createdAt": "2020-12-09T15:58:17Z", "commit": {"oid": "5aa9c8593707b9dec57468534a428653020ac5c8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxNTo1ODoxN1rOICcIdw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxNTo1ODoxN1rOICcIdw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTQyODk4Mw==", "bodyText": "Are we sure this URL won't change? If not, then maybe it is worth to make a new config property for this in application.yml", "url": "https://github.com/hortonworks/cloudbreak/pull/9618#discussion_r539428983", "createdAt": "2020-12-09T15:58:17Z", "author": {"login": "horadla23"}, "path": "common/src/main/java/com/sequenceiq/cloudbreak/telemetry/DataBusEndpointProvider.java", "diffHunk": "@@ -0,0 +1,22 @@\n+package com.sequenceiq.cloudbreak.telemetry;\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.stereotype.Component;\n+\n+@Component\n+public class DataBusEndpointProvider {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(DataBusEndpointProvider.class);\n+\n+    private static final String CNAME_ENDPOINT = \"https://dbusapi.us-west-1.altus.cloudera.com\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5aa9c8593707b9dec57468534a428653020ac5c8"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ4MzM2MTc5", "url": "https://github.com/hortonworks/cloudbreak/pull/9618#pullrequestreview-548336179", "createdAt": "2020-12-09T16:00:09Z", "commit": {"oid": "5aa9c8593707b9dec57468534a428653020ac5c8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxNjowMDoxMFrOICcOxg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxNjowMDoxMFrOICcOxg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTQzMDU5OA==", "bodyText": "This logic is very similar to the logic in TelemetryDecorator and in ClouderaManagerMgmtTelemetryService, might worth to make an own method for it somewhere, maybe in DataBusEndpointProvider, then you do not need to inject Entitlementservice  everywhere", "url": "https://github.com/hortonworks/cloudbreak/pull/9618#discussion_r539430598", "createdAt": "2020-12-09T16:00:10Z", "author": {"login": "horadla23"}, "path": "core/src/main/java/com/sequenceiq/cloudbreak/core/flow2/service/DiagnosticsTriggerService.java", "diffHunk": "@@ -71,9 +81,12 @@ public FlowIdentifier startDiagnosticsCollection(BaseDiagnosticsCollectionReques\n                 && StringUtils.isNotBlank(stack.getCluster().getBlueprint().getStackVersion())) {\n             clusterVersion = stack.getCluster().getBlueprint().getStackVersion();\n         }\n+        String accountId = Crn.fromString(stack.getResourceCrn()).getAccountId();\n+        boolean useDbusCnameEndpoint = entitlementService.useDataBusCNameEndpointEnabled(INTERNAL_ACTOR_CRN, accountId);\n+        String databusEndpoint = dataBusEndpointProvider.getDataBusEndpoint(telemetry.getDatabusEndpoint(), useDbusCnameEndpoint);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5aa9c8593707b9dec57468534a428653020ac5c8"}, "originalPosition": 43}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ4MzQwMDI4", "url": "https://github.com/hortonworks/cloudbreak/pull/9618#pullrequestreview-548340028", "createdAt": "2020-12-09T16:03:45Z", "commit": {"oid": "5aa9c8593707b9dec57468534a428653020ac5c8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1961, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}