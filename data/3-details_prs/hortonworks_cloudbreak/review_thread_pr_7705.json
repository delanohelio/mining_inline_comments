{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk2OTgzMzA1", "number": 7705, "reviewThreads": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQxMzoxODozMlrODthyHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxNTo1NDozM1rODuBJ9w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5MDY2MDE1OnYy", "diffSide": "RIGHT", "path": "environment-api/src/main/java/com/sequenceiq/environment/api/doc/environment/EnvironmentModelDescription.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQxMzoxODozMlrOF_ALHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQxMzoxODozMlrOF_ALHg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTYwNzQ1NA==", "bodyText": "FreeIpa", "url": "https://github.com/hortonworks/cloudbreak/pull/7705#discussion_r401607454", "createdAt": "2020-04-01T13:18:32Z", "author": {"login": "doktoric"}, "path": "environment-api/src/main/java/com/sequenceiq/environment/api/doc/environment/EnvironmentModelDescription.java", "diffHunk": "@@ -72,6 +72,10 @@\n     public static final String PARENT_ENVIRONMENT_NAME = \"Parent environment name\";\n     public static final String PARENT_ENVIRONMENT_CLOUD_PLATFORM = \"Parent environment cloud platform\";\n \n+    public static final String FREEIPA_AWS_PARAMETERS = \"Aws specific FreeIpa parameters\";\n+    public static final String FREEIPA_AWS_SPOT_PARAMETERS = \"Aws spot instance related parameters.\";\n+    public static final String FREEIPA_AWS_SPOT_PERCENTAGE = \"Percentage of spot instances launched in freeipa instance group\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1219713eef6f0745074e011608a775181a2d66f4"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5MDY2NzEzOnYy", "diffSide": "RIGHT", "path": "environment-api/src/main/java/com/sequenceiq/environment/api/v1/environment/model/response/FreeIpaResponse.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQxMzoyMDowNlrOF_APdQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQxMzoyMDoxN1rOF_AP8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTYwODU2NQ==", "bodyText": "can we use the same structure here ?", "url": "https://github.com/hortonworks/cloudbreak/pull/7705#discussion_r401608565", "createdAt": "2020-04-01T13:20:06Z", "author": {"login": "doktoric"}, "path": "environment-api/src/main/java/com/sequenceiq/environment/api/v1/environment/model/response/FreeIpaResponse.java", "diffHunk": "@@ -11,6 +11,9 @@\n     @ApiModelProperty(EnvironmentModelDescription.FREEIPA_INSTANCE_COUNT_BY_GROUP)\n     private Integer instanceCountByGroup = 1;\n \n+    @ApiModelProperty(EnvironmentModelDescription.FREEIPA_AWS_SPOT_PERCENTAGE)\n+    private Integer spotPercentage;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1219713eef6f0745074e011608a775181a2d66f4"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTYwODY5MA==", "bodyText": "like aws.spot.percentage?", "url": "https://github.com/hortonworks/cloudbreak/pull/7705#discussion_r401608690", "createdAt": "2020-04-01T13:20:17Z", "author": {"login": "doktoric"}, "path": "environment-api/src/main/java/com/sequenceiq/environment/api/v1/environment/model/response/FreeIpaResponse.java", "diffHunk": "@@ -11,6 +11,9 @@\n     @ApiModelProperty(EnvironmentModelDescription.FREEIPA_INSTANCE_COUNT_BY_GROUP)\n     private Integer instanceCountByGroup = 1;\n \n+    @ApiModelProperty(EnvironmentModelDescription.FREEIPA_AWS_SPOT_PERCENTAGE)\n+    private Integer spotPercentage;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTYwODU2NQ=="}, "originalCommit": {"oid": "1219713eef6f0745074e011608a775181a2d66f4"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5MDY4NzYxOnYy", "diffSide": "RIGHT", "path": "environment-api/src/main/java/com/sequenceiq/environment/api/v1/environment/model/request/aws/AttachedFreeIpaRequestAwsSpotParameters.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQxMzoyNDo0NFrOF_AciQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQxMzoyNDo0NFrOF_AciQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTYxMTkxMw==", "bodyText": "I used plain integer, not the Integer class", "url": "https://github.com/hortonworks/cloudbreak/pull/7705#discussion_r401611913", "createdAt": "2020-04-01T13:24:44Z", "author": {"login": "bergerdenes"}, "path": "environment-api/src/main/java/com/sequenceiq/environment/api/v1/environment/model/request/aws/AttachedFreeIpaRequestAwsSpotParameters.java", "diffHunk": "@@ -0,0 +1,28 @@\n+package com.sequenceiq.environment.api.v1.environment.model.request.aws;\n+\n+import javax.validation.constraints.Digits;\n+import javax.validation.constraints.Max;\n+import javax.validation.constraints.Min;\n+\n+import com.sequenceiq.environment.api.doc.environment.EnvironmentModelDescription;\n+\n+import io.swagger.annotations.ApiModel;\n+import io.swagger.annotations.ApiModelProperty;\n+\n+@ApiModel(value = \"AttachedFreeIpaRequestAwsSpotParameters\")\n+public class AttachedFreeIpaRequestAwsSpotParameters {\n+\n+    @ApiModelProperty(EnvironmentModelDescription.FREEIPA_AWS_SPOT_PERCENTAGE)\n+    @Min(value = 0, message = \"Spot percentage must be between 0 and 100 percent\")\n+    @Max(value = 100, message = \"Spot percentage must be between 0 and 100 percent\")\n+    @Digits(fraction = 0, integer = 3, message = \"Spot percentage has to be a number\")\n+    private Integer percentage;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1219713eef6f0745074e011608a775181a2d66f4"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5NTAwNDAxOnYy", "diffSide": "RIGHT", "path": "environment-api/src/main/java/com/sequenceiq/environment/api/v1/environment/model/request/AttachedFreeIpaRequest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxMzowMjozMFrOF_qH_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxMzowMjozMFrOF_qH_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjI5NDc4Mw==", "bodyText": "please add @Valid to private AttachedFreeIpaRequest freeIpa; line 72 the EnvironmentRequest class", "url": "https://github.com/hortonworks/cloudbreak/pull/7705#discussion_r402294783", "createdAt": "2020-04-02T13:02:30Z", "author": {"login": "bergerdenes"}, "path": "environment-api/src/main/java/com/sequenceiq/environment/api/v1/environment/model/request/AttachedFreeIpaRequest.java", "diffHunk": "@@ -17,6 +19,10 @@\n     @ApiModelProperty(value = EnvironmentModelDescription.FREEIPA_INSTANCE_COUNT_BY_GROUP)\n     private Integer instanceCountByGroup;\n \n+    @Valid", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8501bab305894b49e6204053c9fdc6587c97b9a7"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5NTA3NDg2OnYy", "diffSide": "RIGHT", "path": "environment/src/main/java/com/sequenceiq/environment/environment/dto/FreeIpaCreationDto.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxMzoyMDowOVrOF_q0ZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxMzoyMDowOVrOF_q0ZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjMwNjE0OA==", "bodyText": "FreeIpaCreationAwsSpotParametersDto does not define toString()", "url": "https://github.com/hortonworks/cloudbreak/pull/7705#discussion_r402306148", "createdAt": "2020-04-02T13:20:09Z", "author": {"login": "bergerdenes"}, "path": "environment/src/main/java/com/sequenceiq/environment/environment/dto/FreeIpaCreationDto.java", "diffHunk": "@@ -25,11 +27,16 @@ public int getInstanceCountByGroup() {\n         return instanceCountByGroup;\n     }\n \n+    public FreeIpaCreationAwsParametersDto getAws() {\n+        return aws;\n+    }\n+\n     @Override\n     public String toString() {\n         return \"FreeIpaCreationDto{\" +\n             \"create='\" + create + '\\'' +\n             \"instanceCountByGroup='\" + instanceCountByGroup + '\\'' +\n+            \"aws='\" + aws + '\\'' +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8501bab305894b49e6204053c9fdc6587c97b9a7"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5NTEyNTA4OnYy", "diffSide": "RIGHT", "path": "environment/src/main/java/com/sequenceiq/environment/parameters/dao/domain/AwsParameters.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxMzozMDo1OFrOF_rSsQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxMzozMDo1OFrOF_rSsQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjMxMzkwNQ==", "bodyText": "minor:  freeipa in one word", "url": "https://github.com/hortonworks/cloudbreak/pull/7705#discussion_r402313905", "createdAt": "2020-04-02T13:30:58Z", "author": {"login": "bergerdenes"}, "path": "environment/src/main/java/com/sequenceiq/environment/parameters/dao/domain/AwsParameters.java", "diffHunk": "@@ -17,6 +17,9 @@\n     @Enumerated(EnumType.STRING)\n     private S3GuardTableCreation s3guardTableCreation;\n \n+    @Column(name = \"free_ipa_spot_percentage\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8501bab305894b49e6204053c9fdc6587c97b9a7"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5NTgwMDIzOnYy", "diffSide": "RIGHT", "path": "environment/src/test/java/com/sequenceiq/environment/environment/validation/EnvironmentValidatorServiceTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxNTo1NDozM1rOF_x-lA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxNTo1NDozM1rOF_x-lA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQyMzQ0NA==", "bodyText": "can you please add 2 more test ?\nArguments.of(2, 100, true)\nArguments.of(2, 0, true)", "url": "https://github.com/hortonworks/cloudbreak/pull/7705#discussion_r402423444", "createdAt": "2020-04-02T15:54:33Z", "author": {"login": "doktoric"}, "path": "environment/src/test/java/com/sequenceiq/environment/environment/validation/EnvironmentValidatorServiceTest.java", "diffHunk": "@@ -324,4 +331,30 @@ private Environment aValidEnvirontmentWithParent() {\n \n         return environment;\n     }\n+\n+    @ParameterizedTest\n+    @MethodSource(\"freeIpaCreationArguments\")\n+    void shouldValidateFreeIpaCreation(int instanceCountByGroup, int spotPercentage, boolean valid) {\n+        FreeIpaCreationDto freeIpaCreationDto = FreeIpaCreationDto.builder()\n+                .withInstanceCountByGroup(instanceCountByGroup)\n+                .withAws(FreeIpaCreationAwsParametersDto.builder()\n+                        .withSpot(FreeIpaCreationAwsSpotParametersDto.builder()\n+                                .withPercentage(spotPercentage)\n+                                .build())\n+                        .build())\n+                .build();\n+\n+        ValidationResult validationResult = underTest.validateFreeIpaCreation(freeIpaCreationDto);\n+        assertEquals(!valid, validationResult.hasError());\n+    }\n+\n+    private static Stream<Arguments> freeIpaCreationArguments() {\n+        return Stream.of(\n+                Arguments.of(1, 0, true),\n+                Arguments.of(1, 100, true),\n+                Arguments.of(1, 50, false),\n+                Arguments.of(2, 50, true)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "62795e90415f2497a8f0dc68d2ccfbad5fc02c37"}, "originalPosition": 51}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2615, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}