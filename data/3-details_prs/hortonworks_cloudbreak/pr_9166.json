{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk5NTI4NjA1", "number": 9166, "title": "CDPCP-3121 - Filter internal machine users for user sync", "bodyText": "See detailed description in the commit message.\nThis changes the flag we use when retrieving machine users. Rather than retrieving all internal machine users, most of which are not workload identities, we've added another flag to the usermanagement.proto to indicate that we want all the workload machine users.\nThis change is needed because we've discovered that we have an unknown and likely large number of orphaned internal machine users. Processing all internal machine users negatively impacts user sync performance. E.g., in mow-dev, we move from syncing 2500 actors to 8000+ actors.", "createdAt": "2020-10-07T21:31:52Z", "url": "https://github.com/hortonworks/cloudbreak/pull/9166", "merged": true, "mergeCommit": {"oid": "ca2a9db4a477d0a22b77173644d089e80548fa1f"}, "closed": true, "closedAt": "2020-10-13T15:53:54Z", "author": {"login": "handavid"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdP7mWNgH2gAyNDk5NTI4NjA1OjViMTNlMjIzYTI3NjM4ZWYzOWU0MzE4MzUzNzQ3ZmY2YzQ5YTRlYzM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdSKqoKgFqTUwNzU4OTA4Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5b13e223a27638ef39e4318353747ff6c49a4ec3", "author": {"user": {"login": "handavid", "name": "David Han"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/5b13e223a27638ef39e4318353747ff6c49a4ec3", "committedDate": "2020-10-06T17:12:23Z", "message": "CDPCP-3121. Update usermanagement.proto\n\nA flag has been added to the ListMachineUsersRequest to include workload users\ninstead of including all internal machine users. Usage of this flag will allow\nuser sync to include internal machine users that are workload users and skip\ninternal machine users that are not."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a1a2abe96a89af93096c56b7b758ea44e981d61a", "author": {"user": {"login": "handavid", "name": "David Han"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/a1a2abe96a89af93096c56b7b758ea44e981d61a", "committedDate": "2020-10-06T17:21:11Z", "message": "CDPCP-3121. Update user sync to use includeWorkloadMachineUser flag\n\nUser sync cannot include all internal machine users for consideration\ndue to the large amount of orphaned internal machine users.\n\nInstead, a new field was added to the usermanagement.proto that allows\nthe UMS to filter and return only those internal machine users that\nare also workload users. This commit updates user sync to use this\nnew flag."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA0Mjg0MDcz", "url": "https://github.com/hortonworks/cloudbreak/pull/9166#pullrequestreview-504284073", "createdAt": "2020-10-07T21:34:03Z", "commit": {"oid": "a1a2abe96a89af93096c56b7b758ea44e981d61a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QyMTozNDowNFrOHeGVJA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wN1QyMTozNDowNFrOHeGVJA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTMyMzA0NA==", "bodyText": "this is the needed proto change. the rest of the proto is just to keep it in sync with the UMS.", "url": "https://github.com/hortonworks/cloudbreak/pull/9166#discussion_r501323044", "createdAt": "2020-10-07T21:34:04Z", "author": {"login": "handavid"}, "path": "auth-connector/src/main/proto/usermanagement.proto", "diffHunk": "@@ -1703,6 +1727,13 @@ message ListMachineUsersRequest {\n   bool includeInternal = 5;\n   // Whether to include deleted machine users.\n   bool includeDeleted = 6;\n+  // Whether to include workload machine users. All regular machine users are\n+  // workload machine users. This is a subset of the internal machine users,\n+  // which have a password set. This field has no effect if internal machine\n+  // users are requested because all workload machine users will already be\n+  // included in the results. Note that this has no impact when listing by name\n+  // or CRN. For those calls, internal machine users are always returned.\n+  bool includeWorkloadMachineUsers = 7;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a1a2abe96a89af93096c56b7b758ea44e981d61a"}, "originalPosition": 91}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA0NDgzODMy", "url": "https://github.com/hortonworks/cloudbreak/pull/9166#pullrequestreview-504483832", "createdAt": "2020-10-08T07:08:37Z", "commit": {"oid": "a1a2abe96a89af93096c56b7b758ea44e981d61a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA0NDkzNzE2", "url": "https://github.com/hortonworks/cloudbreak/pull/9166#pullrequestreview-504493716", "createdAt": "2020-10-08T07:23:22Z", "commit": {"oid": "a1a2abe96a89af93096c56b7b758ea44e981d61a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3NTg4NjQ5", "url": "https://github.com/hortonworks/cloudbreak/pull/9166#pullrequestreview-507588649", "createdAt": "2020-10-13T15:53:03Z", "commit": {"oid": "a1a2abe96a89af93096c56b7b758ea44e981d61a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA3NTg5MDgy", "url": "https://github.com/hortonworks/cloudbreak/pull/9166#pullrequestreview-507589082", "createdAt": "2020-10-13T15:53:29Z", "commit": {"oid": "a1a2abe96a89af93096c56b7b758ea44e981d61a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2116, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}