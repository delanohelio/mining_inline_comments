{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY4MTYzMTY5", "number": 7160, "title": "CDPCP-624. Prevent cross-account queries for operation status", "bodyText": "This commit renames the existing OperationStatusService to OperationService.\nEntity conversion into API models has been moved to the controllers so\nthat all internal code works with the Operation entity instead.\nAn account id must always be specified when retrieving an operation from\nthe database. The controller for the getSyncOperationStatus api gets the\naccount id from the caller (i.e., from the x-cdp-actor header). This ensures\nthat no actor can retrieve operation status for any account other than its\nown account. Since the request does not include an account\nparameter, there is no way for an internal actor to request status of\nan operation in a different account.", "createdAt": "2020-01-28T18:29:26Z", "url": "https://github.com/hortonworks/cloudbreak/pull/7160", "merged": true, "mergeCommit": {"oid": "3705b4251f83d779c9407b3138478a4b1367389c"}, "closed": true, "closedAt": "2020-01-31T09:54:25Z", "author": {"login": "handavid"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb-1jI5gH2gAyMzY4MTYzMTY5OmVjMzJjZjJiM2MwNWYxNmE4MmQ4M2UxNDk1MmQ5ZmE3ZTkwNzgyN2E=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb_BqygAFqTM0OTkzMDE4Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ec32cf2b3c05f16a82d83e14952d9fa7e907827a", "author": {"user": {"login": "handavid", "name": "David Han"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/ec32cf2b3c05f16a82d83e14952d9fa7e907827a", "committedDate": "2020-01-28T18:21:35Z", "message": "CDPCP-624. Prevent cross-account queries for operation status\n\nThis commit renames the existing OperationStatusService to OperationService.\n\nEntity conversion into API models has been moved to the controllers so\nthat all internal code works with the Operation entity instead.\n\nAn account id must always be specified when retrieving an operation from\nthe database. The controller for the getSyncOperationStatus api gets the\naccount id from the caller (i.e., from the x-cdp-actor header). This ensures\nthat no actor can retrieve operation status for any account other than its\nown account. Since the request does not include an account\nparameter, there is no way for an internal actor to request status of\nan operation in a different account."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5ODY4MzUx", "url": "https://github.com/hortonworks/cloudbreak/pull/7160#pullrequestreview-349868351", "createdAt": "2020-01-29T05:23:52Z", "commit": {"oid": "ec32cf2b3c05f16a82d83e14952d9fa7e907827a"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQwNToyMzo1MlrOFi86zQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQwNToyMzo1MlrOFi86zQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjE5Mzk5Nw==", "bodyText": "So was this functionality was always there but you just didn't use it? What are the use cases for using getOperationForOperationID? should that be removed?", "url": "https://github.com/hortonworks/cloudbreak/pull/7160#discussion_r372193997", "createdAt": "2020-01-29T05:23:52Z", "author": {"login": "giladwolff"}, "path": "freeipa/src/main/java/com/sequenceiq/freeipa/service/operation/OperationService.java", "diffHunk": "@@ -97,12 +87,13 @@ public Operation failOperation(String operationId, String failureMessage) {\n         return failOperation(operationId, failureMessage, Collections.emptyList(), Collections.emptyList());\n     }\n \n-    public SyncOperationStatus getSyncOperationStatus(String operationId) {\n-        return operationToSyncOperationStatus.convert(getOperationForOperationId(operationId));\n-    }\n-\n-    public OperationStatus getOperationStatus(String operationId, String accountId) {\n-        return operationToOperationStatusConverter.convert(getOperationForOperationId(operationId));\n+    public Operation getOperationForAccountIdAndOperationId(String accountId, String operationId) {\n+        Optional<Operation> operationOptional = operationRepository.findByOperationIdAndAccountId(operationId, accountId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec32cf2b3c05f16a82d83e14952d9fa7e907827a"}, "originalPosition": 44}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5OTMwMTgz", "url": "https://github.com/hortonworks/cloudbreak/pull/7160#pullrequestreview-349930183", "createdAt": "2020-01-29T08:28:48Z", "commit": {"oid": "ec32cf2b3c05f16a82d83e14952d9fa7e907827a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1918, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}