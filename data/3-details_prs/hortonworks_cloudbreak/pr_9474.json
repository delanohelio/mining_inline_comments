{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIzNTQxMDQz", "number": 9474, "title": "CDPSDX-1981: missing DNS a record in ipa during datalake provisioning ", "bodyText": "During datalake provisioning, an intermittent error of \"does not have corresponding DNS A/AAAA record\" happens. Currently we don't have logging for dnsrecord add operation. Only a timestamp exists in the log to show the dns add operation is done. This fix will log the added DNS record and the success return information in the add operation. This will help to confirm and debug the missing DNS a record issue.\nSee detailed description in the commit message.", "createdAt": "2020-11-18T22:39:35Z", "url": "https://github.com/hortonworks/cloudbreak/pull/9474", "merged": true, "mergeCommit": {"oid": "53fe5bb630050b7f51094d7ae9a607c5fc834cf6"}, "closed": true, "closedAt": "2020-11-23T18:38:19Z", "author": {"login": "christmasferret"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdd92N2AFqTUzNDE1MDUzNg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdfXUF5gFqTUzNjYxMzgzMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM0MTUwNTM2", "url": "https://github.com/hortonworks/cloudbreak/pull/9474#pullrequestreview-534150536", "createdAt": "2020-11-19T07:44:28Z", "commit": {"oid": "3f196feeba3010290c30d287e731581f012204fb"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3f196feeba3010290c30d287e731581f012204fb", "author": {"user": {"login": "christmasferret", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/3f196feeba3010290c30d287e731581f012204fb", "committedDate": "2020-11-18T22:37:48Z", "message": "CDPSDX-1981: missing DNS a record in ipa\n\nDuring datalake provisioning, an intermittent error of \"does not have corresponding DNS A/AAAA record\" happens. Currently we don't have logging for dnsrecord add operation. Only a timestamp exist in the log to show the operation done. This fix will log the added DNS record and the success return information in the add operation. This will help to confirm and debug the missing DNS a record issue."}, "afterCommit": {"oid": "0ca0a1dbf5dc68aec35f319e47ad0c8799f1843a", "author": {"user": {"login": "christmasferret", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/0ca0a1dbf5dc68aec35f319e47ad0c8799f1843a", "committedDate": "2020-11-20T23:24:33Z", "message": "CDPSDX-1981: missing DNS A record in ipa during datalake provisioning\n\nDuring datalake provisioning, an intermittent error of \"does not have corresponding DNS A/AAAA record\" happens. Currently we don't have logging for dnsrecord add operation. Only a timestamp exists in the log to show the dns add operation is done. This fix will log the added DNS record and the success return information in the add operation. This will help to confirm and debug the missing DNS a record issue."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM2NDI2ODY0", "url": "https://github.com/hortonworks/cloudbreak/pull/9474#pullrequestreview-536426864", "createdAt": "2020-11-23T12:28:36Z", "commit": {"oid": "0ca0a1dbf5dc68aec35f319e47ad0c8799f1843a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxMjoyODozNlrOH4LWIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yM1QxMjoyODozNlrOH4LWIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODY2ODE5Mg==", "bodyText": "is there a reason you used ; instead of &&?\nI think dnsrecord-add.log would be better name, and more consistent with the other salt states, as we use the .log for logs and the executed ending for indicating that the script has run", "url": "https://github.com/hortonworks/cloudbreak/pull/9474#discussion_r528668192", "createdAt": "2020-11-23T12:28:36Z", "author": {"login": "lacikaaa"}, "path": "orchestrator-salt/src/main/resources/salt/salt/sssd/ipa.sls", "diffHunk": "@@ -65,7 +65,7 @@ removing_dns_entries:\n \n add_dns_record:\n   cmd.run:\n-    - name: /opt/salt/scripts/add_dns_record.sh && echo $(date +%Y-%m-%d:%H:%M:%S) >> /var/log/dnsrecord-add-executed\n+    - name: /opt/salt/scripts/add_dns_record.sh 2>&1 | tee -a /var/log/dnsrecord-add-history ; test ${PIPESTATUS[0]} -eq 0 && echo $(date +%Y-%m-%d:%H:%M:%S) >> /var/log/dnsrecord-add-executed", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0ca0a1dbf5dc68aec35f319e47ad0c8799f1843a"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "35dca73e559ddfa540207326c0aeca64c6b0c91f", "author": {"user": {"login": "christmasferret", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/35dca73e559ddfa540207326c0aeca64c6b0c91f", "committedDate": "2020-11-23T15:26:33Z", "message": "CDPSDX-1981: missing DNS a record in ipa during datalake provisioning\n\nDuring datalake provisioning, an intermittent error of \"does not have corresponding DNS A/AAAA record\" happens. Currently we don't have logging for dnsrecord add operation. Only a timestamp exists in the log to show the dns add operation is done. This fix will log the added DNS record and the success return information in the add operation. This will help to confirm and debug the missing DNS a record issue."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0ca0a1dbf5dc68aec35f319e47ad0c8799f1843a", "author": {"user": {"login": "christmasferret", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/0ca0a1dbf5dc68aec35f319e47ad0c8799f1843a", "committedDate": "2020-11-20T23:24:33Z", "message": "CDPSDX-1981: missing DNS A record in ipa during datalake provisioning\n\nDuring datalake provisioning, an intermittent error of \"does not have corresponding DNS A/AAAA record\" happens. Currently we don't have logging for dnsrecord add operation. Only a timestamp exists in the log to show the dns add operation is done. This fix will log the added DNS record and the success return information in the add operation. This will help to confirm and debug the missing DNS a record issue."}, "afterCommit": {"oid": "35dca73e559ddfa540207326c0aeca64c6b0c91f", "author": {"user": {"login": "christmasferret", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/35dca73e559ddfa540207326c0aeca64c6b0c91f", "committedDate": "2020-11-23T15:26:33Z", "message": "CDPSDX-1981: missing DNS a record in ipa during datalake provisioning\n\nDuring datalake provisioning, an intermittent error of \"does not have corresponding DNS A/AAAA record\" happens. Currently we don't have logging for dnsrecord add operation. Only a timestamp exists in the log to show the dns add operation is done. This fix will log the added DNS record and the success return information in the add operation. This will help to confirm and debug the missing DNS a record issue."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM2NjEzODMw", "url": "https://github.com/hortonworks/cloudbreak/pull/9474#pullrequestreview-536613830", "createdAt": "2020-11-23T15:58:39Z", "commit": {"oid": "35dca73e559ddfa540207326c0aeca64c6b0c91f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2009, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}