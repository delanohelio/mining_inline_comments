{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkwODcwNjg1", "number": 9059, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QwOTo1NDowM1rOEmfB-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QwOTo1NDowM1rOEmfB-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4Nzg5NzU1OnYy", "diffSide": "RIGHT", "path": "orchestrator-salt/src/main/resources/salt/salt/cloudera/manager/init.sls", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QwOTo1NDowM1rOHWiOAQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxMDoyOTozN1rOHWkPkg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzM5MTM2MQ==", "bodyText": "Should we have an unless condition or it doesn't matter as replace wouldn't do anything anyway?", "url": "https://github.com/hortonworks/cloudbreak/pull/9059#discussion_r493391361", "createdAt": "2020-09-23T09:54:03Z", "author": {"login": "keyki"}, "path": "orchestrator-salt/src/main/resources/salt/salt/cloudera/manager/init.sls", "diffHunk": "@@ -88,6 +88,18 @@ cloudera_manager_set_parcel_validation:\n \n {% if cloudera_manager.communication.autotls_enabled == True %}\n \n+replace_crl_in_cmca_profile:\n+  file.replace:\n+    - name: /etc/cloudera-scm-server/cmSubCaCert.profile\n+    - pattern: \"policyset.cmSubCaCertSet.9.default.params.crlDistPointsPointName_0=http://changeme.com/ipa/crl/MasterCRL.bin\"\n+    - repl: \"policyset.cmSubCaCertSet.9.default.params.crlDistPointsPointName_0=http://ipa-ca.{{ metadata.cluster_domain }}/ipa/crl/MasterCRL.bin\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2805a9ff563dc6ee9c89f83d0f641a2e245c7067"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzM5NzMyNA==", "bodyText": "AFAIK file.replace will only make a change if it has any effect. But I can test it", "url": "https://github.com/hortonworks/cloudbreak/pull/9059#discussion_r493397324", "createdAt": "2020-09-23T10:00:01Z", "author": {"login": "lacikaaa"}, "path": "orchestrator-salt/src/main/resources/salt/salt/cloudera/manager/init.sls", "diffHunk": "@@ -88,6 +88,18 @@ cloudera_manager_set_parcel_validation:\n \n {% if cloudera_manager.communication.autotls_enabled == True %}\n \n+replace_crl_in_cmca_profile:\n+  file.replace:\n+    - name: /etc/cloudera-scm-server/cmSubCaCert.profile\n+    - pattern: \"policyset.cmSubCaCertSet.9.default.params.crlDistPointsPointName_0=http://changeme.com/ipa/crl/MasterCRL.bin\"\n+    - repl: \"policyset.cmSubCaCertSet.9.default.params.crlDistPointsPointName_0=http://ipa-ca.{{ metadata.cluster_domain }}/ipa/crl/MasterCRL.bin\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzM5MTM2MQ=="}, "originalCommit": {"oid": "2805a9ff563dc6ee9c89f83d0f641a2e245c7067"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzQyNDUzMA==", "bodyText": "----------\n          ID: cloudera_manager_set_parcel_validation\n    Function: file.replace\n        Name: /opt/cloudera/cm/bin/cm-server\n      Result: True\n     Comment: unless condition is true\n     Started: 10:26:57.457679\n    Duration: 20.731 ms\n     Changes:\n----------\n          ID: replace_crl_in_cmca_profile\n    Function: file.replace\n        Name: /etc/cloudera-scm-server/cmSubCaCert.profile\n      Result: True\n     Comment: No changes needed to be made\n     Started: 10:26:57.478883\n    Duration: 5.332 ms\n     Changes:\n----------\n          ID: replace_ocsp_in_cmca_profile\n    Function: file.replace\n        Name: /etc/cloudera-scm-server/cmSubCaCert.profile\n      Result: True\n     Comment: No changes needed to be made\n     Started: 10:26:57.484460\n    Duration: 4.205 ms\n     Changes:\n----------\n\nthe first state is with unless+grep, the other 2 is the new state. in result there is no difference, it's even faster this way", "url": "https://github.com/hortonworks/cloudbreak/pull/9059#discussion_r493424530", "createdAt": "2020-09-23T10:29:37Z", "author": {"login": "lacikaaa"}, "path": "orchestrator-salt/src/main/resources/salt/salt/cloudera/manager/init.sls", "diffHunk": "@@ -88,6 +88,18 @@ cloudera_manager_set_parcel_validation:\n \n {% if cloudera_manager.communication.autotls_enabled == True %}\n \n+replace_crl_in_cmca_profile:\n+  file.replace:\n+    - name: /etc/cloudera-scm-server/cmSubCaCert.profile\n+    - pattern: \"policyset.cmSubCaCertSet.9.default.params.crlDistPointsPointName_0=http://changeme.com/ipa/crl/MasterCRL.bin\"\n+    - repl: \"policyset.cmSubCaCertSet.9.default.params.crlDistPointsPointName_0=http://ipa-ca.{{ metadata.cluster_domain }}/ipa/crl/MasterCRL.bin\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzM5MTM2MQ=="}, "originalCommit": {"oid": "2805a9ff563dc6ee9c89f83d0f641a2e245c7067"}, "originalPosition": 8}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2192, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}