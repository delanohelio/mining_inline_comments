{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY5NTM2MTg5", "number": 8834, "title": "CB-8480 internal calls broke tags and audit", "bodyText": "See detailed description in the commit message.", "createdAt": "2020-08-18T14:28:43Z", "url": "https://github.com/hortonworks/cloudbreak/pull/8834", "merged": true, "mergeCommit": {"oid": "8d3b533bc9478dc67130885865cf51947cd0f9f8"}, "closed": true, "closedAt": "2020-08-19T10:25:00Z", "author": {"login": "sodre90"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdAIIuEABqjM2NjY3MDkyODc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdAYZDHgBqjM2Njk5NTg5NzA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "db87aeac591dcebecf61be9dc1529ca795bfc081", "author": {"user": {"login": "sodre90", "name": "Erd\u0151s P\u00e9ter"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/db87aeac591dcebecf61be9dc1529ca795bfc081", "committedDate": "2020-08-18T13:04:53Z", "message": "CB-8480 internal calls broke tags and audit"}, "afterCommit": {"oid": "7183bd5bbcd5f027c29de4f3ab4c4ba0b984e336", "author": {"user": {"login": "sodre90", "name": "Erd\u0151s P\u00e9ter"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/7183bd5bbcd5f027c29de4f3ab4c4ba0b984e336", "committedDate": "2020-08-18T14:45:43Z", "message": "CB-8480 internal calls broke tags and audit"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7183bd5bbcd5f027c29de4f3ab4c4ba0b984e336", "author": {"user": {"login": "sodre90", "name": "Erd\u0151s P\u00e9ter"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/7183bd5bbcd5f027c29de4f3ab4c4ba0b984e336", "committedDate": "2020-08-18T14:45:43Z", "message": "CB-8480 internal calls broke tags and audit"}, "afterCommit": {"oid": "cda185e574a20ed47fbcff77eea1609d1366d833", "author": {"user": {"login": "sodre90", "name": "Erd\u0151s P\u00e9ter"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/cda185e574a20ed47fbcff77eea1609d1366d833", "committedDate": "2020-08-18T16:49:10Z", "message": "CB-8480 internal calls broke tags and audit"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cda185e574a20ed47fbcff77eea1609d1366d833", "author": {"user": {"login": "sodre90", "name": "Erd\u0151s P\u00e9ter"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/cda185e574a20ed47fbcff77eea1609d1366d833", "committedDate": "2020-08-18T16:49:10Z", "message": "CB-8480 internal calls broke tags and audit"}, "afterCommit": {"oid": "62dbc85e4b7cc0861c5dd6c85665a91b70a9451c", "author": {"user": {"login": "sodre90", "name": "Erd\u0151s P\u00e9ter"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/62dbc85e4b7cc0861c5dd6c85665a91b70a9451c", "committedDate": "2020-08-19T05:18:43Z", "message": "CB-8480 internal calls broke tags and audit"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcwMjczMDMy", "url": "https://github.com/hortonworks/cloudbreak/pull/8834#pullrequestreview-470273032", "createdAt": "2020-08-19T09:15:34Z", "commit": {"oid": "62dbc85e4b7cc0861c5dd6c85665a91b70a9451c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQwOToxNTozNFrOHC-ktw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQwOToxNTozNFrOHC-ktw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjg4NDQwNw==", "bodyText": "Can't we skip the whole workspace ID from these new API's?", "url": "https://github.com/hortonworks/cloudbreak/pull/8834#discussion_r472884407", "createdAt": "2020-08-19T09:15:34Z", "author": {"login": "lnardai"}, "path": "core-api/src/main/java/com/sequenceiq/cloudbreak/api/endpoint/v4/stacks/StackV4Endpoint.java", "diffHunk": "@@ -285,6 +351,13 @@ UpgradeV4Response checkForClusterUpgradeByName(@PathParam(\"workspaceId\") Long wo\n     FlowIdentifier upgradeClusterByName(@PathParam(\"workspaceId\") Long workspaceId, @PathParam(\"name\") String name, String imageId,\n             @AccountId @QueryParam(\"accountId\") String accountId);\n \n+    @POST\n+    @Path(\"internal/{name}/cluster_upgrade\")\n+    @Produces(MediaType.APPLICATION_JSON)\n+    @ApiOperation(value = STACK_UPGRADE_INTERNAL, nickname = \"upgradeClusterByNameInternal\")\n+    FlowIdentifier upgradeClusterByNameInternal(@PathParam(\"workspaceId\") Long workspaceId, @PathParam(\"name\") String name, String imageId,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "62dbc85e4b7cc0861c5dd6c85665a91b70a9451c"}, "originalPosition": 154}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcwMjc1NTQ3", "url": "https://github.com/hortonworks/cloudbreak/pull/8834#pullrequestreview-470275547", "createdAt": "2020-08-19T09:18:40Z", "commit": {"oid": "62dbc85e4b7cc0861c5dd6c85665a91b70a9451c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQwOToxODo0MFrOHC-skw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQwOToxODo0MFrOHC-skw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjg4NjQxOQ==", "bodyText": "Can we check if the endpoint has the @InternalOnly annotation?", "url": "https://github.com/hortonworks/cloudbreak/pull/8834#discussion_r472886419", "createdAt": "2020-08-19T09:18:40Z", "author": {"login": "lnardai"}, "path": "authorization-common/src/main/java/com/sequenceiq/authorization/service/PermissionCheckService.java", "diffHunk": "@@ -54,6 +68,12 @@ public Object hasPermission(ProceedingJoinPoint proceedingJoinPoint) {\n         MethodSignature methodSignature = (MethodSignature) proceedingJoinPoint.getSignature();\n         LOGGER.debug(\"Permission check started at {} (method: {})\", startTime,\n                 methodSignature.getMethod().getDeclaringClass().getSimpleName() + \"#\" + methodSignature.getMethod().getName());\n+        Optional<Object> initiatorUserCrn = reflectionUtil.getParameter(proceedingJoinPoint, methodSignature, InitiatorUserCrn.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "62dbc85e4b7cc0861c5dd6c85665a91b70a9451c"}, "originalPosition": 35}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcwMjc1OTU5", "url": "https://github.com/hortonworks/cloudbreak/pull/8834#pullrequestreview-470275959", "createdAt": "2020-08-19T09:19:14Z", "commit": {"oid": "62dbc85e4b7cc0861c5dd6c85665a91b70a9451c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "62dbc85e4b7cc0861c5dd6c85665a91b70a9451c", "author": {"user": {"login": "sodre90", "name": "Erd\u0151s P\u00e9ter"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/62dbc85e4b7cc0861c5dd6c85665a91b70a9451c", "committedDate": "2020-08-19T05:18:43Z", "message": "CB-8480 internal calls broke tags and audit"}, "afterCommit": {"oid": "31bcd253d192521c5bba97364857a801497ae19c", "author": {"user": {"login": "sodre90", "name": "Erd\u0151s P\u00e9ter"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/31bcd253d192521c5bba97364857a801497ae19c", "committedDate": "2020-08-19T09:26:51Z", "message": "CB-8480 internal calls broke tags and audit"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7e0bb1afe2b46bf2154f22c51cc4dd74ad4214dc", "author": {"user": {"login": "sodre90", "name": "Erd\u0151s P\u00e9ter"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/7e0bb1afe2b46bf2154f22c51cc4dd74ad4214dc", "committedDate": "2020-08-19T09:42:04Z", "message": "CB-8480 internal calls broke tags and audit"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "31bcd253d192521c5bba97364857a801497ae19c", "author": {"user": {"login": "sodre90", "name": "Erd\u0151s P\u00e9ter"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/31bcd253d192521c5bba97364857a801497ae19c", "committedDate": "2020-08-19T09:26:51Z", "message": "CB-8480 internal calls broke tags and audit"}, "afterCommit": {"oid": "7e0bb1afe2b46bf2154f22c51cc4dd74ad4214dc", "author": {"user": {"login": "sodre90", "name": "Erd\u0151s P\u00e9ter"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/7e0bb1afe2b46bf2154f22c51cc4dd74ad4214dc", "committedDate": "2020-08-19T09:42:04Z", "message": "CB-8480 internal calls broke tags and audit"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2489, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}