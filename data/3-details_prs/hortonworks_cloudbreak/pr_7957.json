{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEyNjgwMTU1", "number": 7957, "title": "CB-6879: Redundant full backup created on Azure FreeIPA HA hosts", "bodyText": "This prevents the monthly backup from running, when enabled, until the next month after the initial install.  This is the first step to fixing CB-6717 across multiple FreeIPA HA nodes.\nCloses #CB-6879", "createdAt": "2020-05-03T22:53:30Z", "url": "https://github.com/hortonworks/cloudbreak/pull/7957", "merged": true, "mergeCommit": {"oid": "03e1bd519cfe4350139483b4ffc131c3df575661"}, "closed": true, "closedAt": "2020-05-04T16:19:17Z", "author": {"login": "wonderslug"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcd9DrpgFqTQwNDg3NDUxMg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABceBm7TAFqTQwNTEyMTk2NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0ODc0NTEy", "url": "https://github.com/hortonworks/cloudbreak/pull/7957#pullrequestreview-404874512", "createdAt": "2020-05-04T10:38:07Z", "commit": {"oid": "5c52f6e9c9537619f134893e1615756a5e72ed70"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxMDozODowN1rOGP67-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxMDozODowN1rOGP67-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTM0NzQ0OQ==", "bodyText": "could you rename this state and move the command into the name parameter?\nalso this would be called every time a highstate is called, so I think you should place a file somewhere so it wouldn't run again", "url": "https://github.com/hortonworks/cloudbreak/pull/7957#discussion_r419347449", "createdAt": "2020-05-04T10:38:07Z", "author": {"login": "lacikaaa"}, "path": "freeipa/src/main/resources/freeipa-salt/salt/freeipa/backups.sls", "diffHunk": "@@ -15,6 +15,10 @@\n     - mode: 640\n \n {% if salt['pillar.get']('freeipa:backup:monthly_full_enabled') %}\n+'/sbin/anacron -u cron.monthly':", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5c52f6e9c9537619f134893e1615756a5e72ed70"}, "originalPosition": 4}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "272a8d79199f91e9471ec0e854ae71b4f03d5165", "author": {"user": {"login": "wonderslug", "name": "Brian Towles"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/272a8d79199f91e9471ec0e854ae71b4f03d5165", "committedDate": "2020-05-04T12:31:42Z", "message": "CB-6879: Redundant full backup created on Azure FreeIPA HA hosts\n\nThis prevents monthly backup from running when enabled until the next month.  This is the first step to fixing CB-6717 across multiple FreeIPA HA nodes.\n\nreview changes"}, "afterCommit": {"oid": "5c52f6e9c9537619f134893e1615756a5e72ed70", "author": {"user": {"login": "wonderslug", "name": "Brian Towles"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/5c52f6e9c9537619f134893e1615756a5e72ed70", "committedDate": "2020-05-03T22:48:59Z", "message": "CB-6879: Redundant full backup created on Azure FreeIPA HA hosts\n\nThis prevents monthly backup from running when enabled until the next month.  This is the first step to fixing CB-6717 across multiple FreeIPA HA nodes."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2d2c3a7462469344badcf4baa90010926c5d92ef", "author": {"user": {"login": "wonderslug", "name": "Brian Towles"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/2d2c3a7462469344badcf4baa90010926c5d92ef", "committedDate": "2020-05-04T12:38:39Z", "message": "CB-6879: Redundant full backup created on Azure FreeIPA HA hosts\n\nThis prevents monthly backup from running when enabled until the next month.  This is the first step to fixing CB-6717 across multiple FreeIPA HA nodes.\n\nCB-6879: Redundant full backup created on Azure FreeIPA HA hosts"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5c52f6e9c9537619f134893e1615756a5e72ed70", "author": {"user": {"login": "wonderslug", "name": "Brian Towles"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/5c52f6e9c9537619f134893e1615756a5e72ed70", "committedDate": "2020-05-03T22:48:59Z", "message": "CB-6879: Redundant full backup created on Azure FreeIPA HA hosts\n\nThis prevents monthly backup from running when enabled until the next month.  This is the first step to fixing CB-6717 across multiple FreeIPA HA nodes."}, "afterCommit": {"oid": "2d2c3a7462469344badcf4baa90010926c5d92ef", "author": {"user": {"login": "wonderslug", "name": "Brian Towles"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/2d2c3a7462469344badcf4baa90010926c5d92ef", "committedDate": "2020-05-04T12:38:39Z", "message": "CB-6879: Redundant full backup created on Azure FreeIPA HA hosts\n\nThis prevents monthly backup from running when enabled until the next month.  This is the first step to fixing CB-6717 across multiple FreeIPA HA nodes.\n\nCB-6879: Redundant full backup created on Azure FreeIPA HA hosts"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0OTQ5MDI3", "url": "https://github.com/hortonworks/cloudbreak/pull/7957#pullrequestreview-404949027", "createdAt": "2020-05-04T12:41:43Z", "commit": {"oid": "2d2c3a7462469344badcf4baa90010926c5d92ef"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1MDI2MzY3", "url": "https://github.com/hortonworks/cloudbreak/pull/7957#pullrequestreview-405026367", "createdAt": "2020-05-04T14:13:11Z", "commit": {"oid": "2d2c3a7462469344badcf4baa90010926c5d92ef"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxNDoxMzoxMVrOGQCREg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxNDoxMzoxMVrOGQCREg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQ2NzUzOA==", "bodyText": "Is it possible that the anacron monthly backup runs once before the FreeIPA backup is added to it? If so, then this file would exist but the backup would not.", "url": "https://github.com/hortonworks/cloudbreak/pull/7957#discussion_r419467538", "createdAt": "2020-05-04T14:13:11Z", "author": {"login": "jamisonbennett"}, "path": "freeipa/src/main/resources/freeipa-salt/salt/freeipa/backups.sls", "diffHunk": "@@ -15,6 +15,11 @@\n     - mode: 640\n \n {% if salt['pillar.get']('freeipa:backup:monthly_full_enabled') %}\n+freeipa_backoff_monthly_full:\n+  cmd.run:\n+    - name: /sbin/anacron -u cron.monthly\n+    - onlyif: test ! -s /var/spool/anacron/cron.monthly", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d2c3a7462469344badcf4baa90010926c5d92ef"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1MTIxOTY1", "url": "https://github.com/hortonworks/cloudbreak/pull/7957#pullrequestreview-405121965", "createdAt": "2020-05-04T15:56:14Z", "commit": {"oid": "2d2c3a7462469344badcf4baa90010926c5d92ef"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2158, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}