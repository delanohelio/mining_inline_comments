{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc2MzEwNzQ1", "number": 8891, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxNToxNzowNlrOEeWcQQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxNToyMjoxOFrOEeWkQw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwMjYwNDE3OnYy", "diffSide": "RIGHT", "path": "freeipa/src/main/java/com/sequenceiq/freeipa/service/freeipa/FreeIpaClientFactory.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxNToxNzowNlrOHJ9EzQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxNjoyMDoyMFrOHJ_iQg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDE5OTg4NQ==", "bodyText": "would it make sense to move this to the private getFreeIpaClient method? Then it would work for all the various public methods of this class.", "url": "https://github.com/hortonworks/cloudbreak/pull/8891#discussion_r480199885", "createdAt": "2020-08-31T15:17:06Z", "author": {"login": "handavid"}, "path": "freeipa/src/main/java/com/sequenceiq/freeipa/service/freeipa/FreeIpaClientFactory.java", "diffHunk": "@@ -87,6 +88,7 @@ public FreeIpaClient getFreeIpaClientForStackId(Long stackId) throws FreeIpaClie\n \n     public FreeIpaClient getFreeIpaClientByAccountAndEnvironment(String environmentCrn, String accountId) throws FreeIpaClientException {\n         Stack stack = stackService.getByEnvironmentCrnAndAccountId(environmentCrn, accountId);\n+        MDCBuilder.buildMdcContext(stack);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "11f95b2144dc43477841ae632d8b6239035a9156"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDIyMzk1Ng==", "bodyText": "I have added MDC building where the context was insufficient. I started from the endpoints and followed the call chain to check if the context is set at the earliest point where Stack is available. Most probably the calls to the FreeIpaClientFactory come from flows, which have the context already set (at least I hope so, haven't checked all of them). But it's possible I missed some places so I'm open to suggestions :)", "url": "https://github.com/hortonworks/cloudbreak/pull/8891#discussion_r480223956", "createdAt": "2020-08-31T15:52:19Z", "author": {"login": "lacikaaa"}, "path": "freeipa/src/main/java/com/sequenceiq/freeipa/service/freeipa/FreeIpaClientFactory.java", "diffHunk": "@@ -87,6 +88,7 @@ public FreeIpaClient getFreeIpaClientForStackId(Long stackId) throws FreeIpaClie\n \n     public FreeIpaClient getFreeIpaClientByAccountAndEnvironment(String environmentCrn, String accountId) throws FreeIpaClientException {\n         Stack stack = stackService.getByEnvironmentCrnAndAccountId(environmentCrn, accountId);\n+        MDCBuilder.buildMdcContext(stack);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDE5OTg4NQ=="}, "originalCommit": {"oid": "11f95b2144dc43477841ae632d8b6239035a9156"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDI0MDE5NA==", "bodyText": "it makes sense to set the MDC at the earliest possible moment. The FreeIpaClientFactory should be able to rely on callers of getFreeIpaClientForStack to have already set the MDC.", "url": "https://github.com/hortonworks/cloudbreak/pull/8891#discussion_r480240194", "createdAt": "2020-08-31T16:20:20Z", "author": {"login": "handavid"}, "path": "freeipa/src/main/java/com/sequenceiq/freeipa/service/freeipa/FreeIpaClientFactory.java", "diffHunk": "@@ -87,6 +88,7 @@ public FreeIpaClient getFreeIpaClientForStackId(Long stackId) throws FreeIpaClie\n \n     public FreeIpaClient getFreeIpaClientByAccountAndEnvironment(String environmentCrn, String accountId) throws FreeIpaClientException {\n         Stack stack = stackService.getByEnvironmentCrnAndAccountId(environmentCrn, accountId);\n+        MDCBuilder.buildMdcContext(stack);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDE5OTg4NQ=="}, "originalCommit": {"oid": "11f95b2144dc43477841ae632d8b6239035a9156"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwMjYyNDY3OnYy", "diffSide": "RIGHT", "path": "freeipa/src/main/java/com/sequenceiq/freeipa/service/freeipa/dns/DnsRecordService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxNToyMjoxOFrOHJ9RLA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxNToyMjoxOFrOHJ9RLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDIwMzA1Mg==", "bodyText": "we already have the Stack so we can avoid a redundant read by calling getFreeIpaClientForStack instead of getFreeIpaClientByAccountAndEnvironment", "url": "https://github.com/hortonworks/cloudbreak/pull/8891#discussion_r480203052", "createdAt": "2020-08-31T15:22:18Z", "author": {"login": "handavid"}, "path": "freeipa/src/main/java/com/sequenceiq/freeipa/service/freeipa/dns/DnsRecordService.java", "diffHunk": "@@ -36,6 +37,7 @@\n \n     public void deleteDnsRecordByFqdn(String environmentCrn, String accountId,  List<String> fqdns) throws FreeIpaClientException {\n         Stack stack = stackService.getByEnvironmentCrnAndAccountId(environmentCrn, accountId);\n+        MDCBuilder.buildMdcContext(stack);\n         FreeIpa freeIpa = freeIpaService.findByStack(stack);\n         FreeIpaClient freeIpaClient = freeIpaClientFactory.getFreeIpaClientByAccountAndEnvironment(environmentCrn, accountId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "11f95b2144dc43477841ae632d8b6239035a9156"}, "originalPosition": 23}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2319, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}