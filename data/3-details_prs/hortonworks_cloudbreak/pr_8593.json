{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDUzMzI1MDYz", "number": 8593, "title": "Log collection api for datahub and datalake", "bodyText": "See detailed description in the commit message.\nSee the epic for even more info: https://jira.cloudera.com/browse/CB-6994", "createdAt": "2020-07-20T10:56:49Z", "url": "https://github.com/hortonworks/cloudbreak/pull/8593", "merged": true, "mergeCommit": {"oid": "a4e6089efd7a756387c11dd93e7ac156d4ec8e71"}, "closed": true, "closedAt": "2020-07-21T13:35:24Z", "author": {"login": "attilapalfi92"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc2wfGGABqjM1NjU0NzA4NTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc3FOJvABqjM1NzA5NTAyMTQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f027b67d32cfcafb7cd08626cd7e66160e94a38f", "author": {"user": {"login": "attilapalfi92", "name": "Attila P\u00e1lfi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/f027b67d32cfcafb7cd08626cd7e66160e94a38f", "committedDate": "2020-07-20T10:53:54Z", "message": "CB-7979 - created diagnostics api for datalake"}, "afterCommit": {"oid": "585e637c27b8963389937c4d06cef75370b8b966", "author": {"user": {"login": "oleewere", "name": "Oliv\u00e9r Szabo"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/585e637c27b8963389937c4d06cef75370b8b966", "committedDate": "2020-07-20T12:06:57Z", "message": "CB-8045. Resolve references in VM log path fields"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "585e637c27b8963389937c4d06cef75370b8b966", "author": {"user": {"login": "oleewere", "name": "Oliv\u00e9r Szabo"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/585e637c27b8963389937c4d06cef75370b8b966", "committedDate": "2020-07-20T12:06:57Z", "message": "CB-8045. Resolve references in VM log path fields"}, "afterCommit": {"oid": "c702d45dc42d8599aa7f6a9f8b3aebf6f778e796", "author": {"user": {"login": "oleewere", "name": "Oliv\u00e9r Szabo"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/c702d45dc42d8599aa7f6a9f8b3aebf6f778e796", "committedDate": "2020-07-20T13:01:24Z", "message": "CB-8045. Resolve references in VM log path fields"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxNjM4MDY3", "url": "https://github.com/hortonworks/cloudbreak/pull/8593#pullrequestreview-451638067", "createdAt": "2020-07-20T14:05:28Z", "commit": {"oid": "c702d45dc42d8599aa7f6a9f8b3aebf6f778e796"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxNjQyMzE0", "url": "https://github.com/hortonworks/cloudbreak/pull/8593#pullrequestreview-451642314", "createdAt": "2020-07-20T14:10:03Z", "commit": {"oid": "c702d45dc42d8599aa7f6a9f8b3aebf6f778e796"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxNDoxMDowM1rOG0OxHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMFQxNDo0MDowNFrOG0QelA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzQyMTA4NA==", "bodyText": "what happens if you use this on distrox api? i think it will fail because it check for datalake", "url": "https://github.com/hortonworks/cloudbreak/pull/8593#discussion_r457421084", "createdAt": "2020-07-20T14:10:03Z", "author": {"login": "horadla23"}, "path": "core-api/src/main/java/com/sequenceiq/cloudbreak/api/endpoint/v4/diagnostics/model/DiagnosticsCollectionRequest.java", "diffHunk": "@@ -0,0 +1,33 @@\n+package com.sequenceiq.cloudbreak.api.endpoint.v4.diagnostics.model;\n+\n+import javax.validation.constraints.NotNull;\n+\n+import com.fasterxml.jackson.annotation.JsonIgnoreProperties;\n+import com.fasterxml.jackson.annotation.JsonInclude;\n+import com.sequenceiq.authorization.annotation.ResourceObjectField;\n+import com.sequenceiq.authorization.resource.AuthorizationResourceAction;\n+import com.sequenceiq.authorization.resource.AuthorizationVariableType;\n+import com.sequenceiq.cloudbreak.doc.ModelDescriptions;\n+import com.sequenceiq.common.api.diagnostics.BaseDiagnosticsCollectionRequest;\n+\n+import io.swagger.annotations.ApiModel;\n+import io.swagger.annotations.ApiModelProperty;\n+\n+@ApiModel(\"DiagnosticsCollectionRequest\")\n+@JsonIgnoreProperties(ignoreUnknown = true)\n+@JsonInclude(JsonInclude.Include.NON_NULL)\n+public class DiagnosticsCollectionRequest extends BaseDiagnosticsCollectionRequest {\n+\n+    @NotNull\n+    @ApiModelProperty(ModelDescriptions.StackModelDescription.CRN)\n+    @ResourceObjectField(action = AuthorizationResourceAction.DATALAKE_READ, variableType = AuthorizationVariableType.CRN)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c702d45dc42d8599aa7f6a9f8b3aebf6f778e796"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzQ0OTEwOA==", "bodyText": "as discussed, pls authorize this as it is done in related controller of datalake service", "url": "https://github.com/hortonworks/cloudbreak/pull/8593#discussion_r457449108", "createdAt": "2020-07-20T14:40:04Z", "author": {"login": "horadla23"}, "path": "core/src/main/java/com/sequenceiq/cloudbreak/controller/v4/DiagnosticsV4Controller.java", "diffHunk": "@@ -0,0 +1,49 @@\n+package com.sequenceiq.cloudbreak.controller.v4;\n+\n+import javax.inject.Inject;\n+import javax.validation.Valid;\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.stereotype.Controller;\n+\n+import com.sequenceiq.authorization.annotation.DisableCheckPermissions;\n+import com.sequenceiq.cloudbreak.api.endpoint.v4.diagnostics.DiagnosticsV4Endpoint;\n+import com.sequenceiq.cloudbreak.api.endpoint.v4.diagnostics.model.DiagnosticsCollectionRequest;\n+import com.sequenceiq.cloudbreak.core.flow2.service.DiagnosticsTriggerService;\n+import com.sequenceiq.cloudbreak.service.CloudbreakRestRequestThreadLocalService;\n+import com.sequenceiq.cloudbreak.telemetry.VmLogsService;\n+import com.sequenceiq.cloudbreak.telemetry.converter.VmLogsToVmLogsResponseConverter;\n+import com.sequenceiq.common.api.telemetry.response.VmLogsResponse;\n+\n+@Controller\n+@DisableCheckPermissions\n+public class DiagnosticsV4Controller implements DiagnosticsV4Endpoint {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(DiagnosticsV4Controller.class);\n+\n+    @Inject\n+    private CloudbreakRestRequestThreadLocalService crnService;\n+\n+    @Inject\n+    private DiagnosticsTriggerService diagnosticsTriggerService;\n+\n+    @Inject\n+    private VmLogsService vmLogsService;\n+\n+    @Inject\n+    private VmLogsToVmLogsResponseConverter vmlogsConverter;\n+\n+    @Override\n+    public void collectDiagnostics(@Valid DiagnosticsCollectionRequest request) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c702d45dc42d8599aa7f6a9f8b3aebf6f778e796"}, "originalPosition": 38}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c702d45dc42d8599aa7f6a9f8b3aebf6f778e796", "author": {"user": {"login": "oleewere", "name": "Oliv\u00e9r Szabo"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/c702d45dc42d8599aa7f6a9f8b3aebf6f778e796", "committedDate": "2020-07-20T13:01:24Z", "message": "CB-8045. Resolve references in VM log path fields"}, "afterCommit": {"oid": "6f868441c9726e9e8356d4215716478bf32d8f5c", "author": {"user": {"login": "attilapalfi92", "name": "Attila P\u00e1lfi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/6f868441c9726e9e8356d4215716478bf32d8f5c", "committedDate": "2020-07-20T15:00:14Z", "message": "CB-7979 - created diagnostics api for datalake"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxNjk4NzQz", "url": "https://github.com/hortonworks/cloudbreak/pull/8593#pullrequestreview-451698743", "createdAt": "2020-07-20T15:08:56Z", "commit": {"oid": "6f868441c9726e9e8356d4215716478bf32d8f5c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6f868441c9726e9e8356d4215716478bf32d8f5c", "author": {"user": {"login": "attilapalfi92", "name": "Attila P\u00e1lfi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/6f868441c9726e9e8356d4215716478bf32d8f5c", "committedDate": "2020-07-20T15:00:14Z", "message": "CB-7979 - created diagnostics api for datalake"}, "afterCommit": {"oid": "cb0864af6042983259a05c3b7b6cd285cb13c3f1", "author": {"user": {"login": "attilapalfi92", "name": "Attila P\u00e1lfi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/cb0864af6042983259a05c3b7b6cd285cb13c3f1", "committedDate": "2020-07-21T09:02:07Z", "message": "CB-7979 - created diagnostics api for datalake"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb66d9d29bd06bf4d0d62edd62104be80bb46b5c", "author": {"user": {"login": "attilapalfi92", "name": "Attila P\u00e1lfi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/fb66d9d29bd06bf4d0d62edd62104be80bb46b5c", "committedDate": "2020-07-21T12:16:21Z", "message": "CB-7978 - Added diagnostics collection flow for CM in cloudbreak. Some code that is shared with FreeIpa is extracted to common modules. Added diagnostics collection endpoints to both Cloudbreak and DistroX APIs. The endpoint in Cloudbreak will be used by Datalake."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b08256612e57b18194a410c3dfc5dfe6adaac340", "author": {"user": {"login": "attilapalfi92", "name": "Attila P\u00e1lfi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/b08256612e57b18194a410c3dfc5dfe6adaac340", "committedDate": "2020-07-21T12:16:21Z", "message": "CB-8032 - added UI notifications to cloudbreak's diagnostics flow steps"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "492fe29d9e4aca4686c19f45445cddef29e68edd", "author": {"user": {"login": "oleewere", "name": "Oliv\u00e9r Szabo"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/492fe29d9e4aca4686c19f45445cddef29e68edd", "committedDate": "2020-07-21T12:16:21Z", "message": "CB-8045 - Resolve references in VM log path fields. For freeipa static log paths were used, but for CM, references have to resolved from the vm-logs.json.\n\nSigned-off-by: attilapalfi92 <apalfi@cloudera.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cda7bb743bd672a78dbb34d91d77eefd2d11bcd8", "author": {"user": {"login": "attilapalfi92", "name": "Attila P\u00e1lfi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/cda7bb743bd672a78dbb34d91d77eefd2d11bcd8", "committedDate": "2020-07-21T12:16:21Z", "message": "CB-7979 - created diagnostics api for datalake"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cb0864af6042983259a05c3b7b6cd285cb13c3f1", "author": {"user": {"login": "attilapalfi92", "name": "Attila P\u00e1lfi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/cb0864af6042983259a05c3b7b6cd285cb13c3f1", "committedDate": "2020-07-21T09:02:07Z", "message": "CB-7979 - created diagnostics api for datalake"}, "afterCommit": {"oid": "cda7bb743bd672a78dbb34d91d77eefd2d11bcd8", "author": {"user": {"login": "attilapalfi92", "name": "Attila P\u00e1lfi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/cda7bb743bd672a78dbb34d91d77eefd2d11bcd8", "committedDate": "2020-07-21T12:16:21Z", "message": "CB-7979 - created diagnostics api for datalake"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2600, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}