{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM4NTcyNzE0", "number": 8379, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QxOTozNDozM1rOEIG1bQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QxOTozOToxNVrOEIG6ww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2OTM2MDQ1OnYy", "diffSide": "RIGHT", "path": "freeipa/src/main/resources/freeipa-salt/salt/freeipa/scripts/freeipa_backup", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QxOTozNDozM1rOGn3sTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QyMDozMzo1OVrOGn5iFA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDQ2MDEwOA==", "bodyText": "Is there a reason to have double quotes nextto each other? echo \"$(date \"+%Y-%m-%dT%H:%M:%SZ\") $type_of_msg $msg\" > \"${STATUSFILEPREFIX}${BACKUP_SCHEDULE}\".log might be a little cleaner.", "url": "https://github.com/hortonworks/cloudbreak/pull/8379#discussion_r444460108", "createdAt": "2020-06-23T19:34:33Z", "author": {"login": "jamisonbennett"}, "path": "freeipa/src/main/resources/freeipa-salt/salt/freeipa/scripts/freeipa_backup", "diffHunk": "@@ -93,25 +111,25 @@ elif [[ \"$TYPE\" = \"DATA\" ]]; then\n fi\n \n doLog(){\n-    type_of_msg=$(echo $*|cut -d\" \" -f1)\n+    type_of_msg=$(echo \"$*\"|cut -d\" \" -f1)\n     msg=$(echo \"$*\"|cut -d\" \" -f2-)\n-    [[ $type_of_msg == DEBUG ]] && [[ $do_print_debug_msgs -ne 1 ]] && return\n+    [[ $type_of_msg == DEBUG ]] && [[ ${PRINT_DEBUG_MSGS} -ne 1 ]] && return\n     [[ $type_of_msg == INFO ]] && type_of_msg=\"INFO \" # one space for aligning\n     [[ $type_of_msg == WARN ]] && type_of_msg=\"WARN \" # as well\n \n     # print to the terminal if we have one\n-    test -t 1 && echo \"`date \"+%Y-%m-%dT%H:%M:%SZ\"` $type_of_msg \"\"$msg\"\n-    echo \"`date \"+%Y-%m-%dT%H:%M:%SZ\"` $type_of_msg \"\"$msg\" >> $LOGFILE\n+    test -t 1 && echo \"$(date \"+%Y-%m-%dT%H:%M:%SZ\") $type_of_msg \"\"$msg\"\n+    echo \"$(date \"+%Y-%m-%dT%H:%M:%SZ\") $type_of_msg \"\"$msg\" >> \"${LOGFILE}\"\n }\n \n doStatus(){\n     if [[ -n \"$BACKUP_SCHEDULE\" ]]\n     then\n-        type_of_msg=$(echo $*|cut -d\" \" -f1)\n+        type_of_msg=$(echo \"$*\"|cut -d\" \" -f1)\n         msg=$(echo \"$*\"|cut -d\" \" -f2-)\n         [[ $type_of_msg == INFO ]] && type_of_msg=\"INFO \" # one space for aligning\n \n-        echo \"`date \"+%Y-%m-%dT%H:%M:%SZ\"` $type_of_msg $msg\" > $STATUSFILEPREFIX$BACKUP_SCHEDULE.log\n+        echo \"$(date \"+%Y-%m-%dT%H:%M:%SZ\") $type_of_msg $msg\" > \"${STATUSFILEPREFIX}\"\"${BACKUP_SCHEDULE}\".log", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9c810ab749f06907288b6516abb051904ddbe31a"}, "originalPosition": 93}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDQ5MDI2MA==", "bodyText": "fixed", "url": "https://github.com/hortonworks/cloudbreak/pull/8379#discussion_r444490260", "createdAt": "2020-06-23T20:33:59Z", "author": {"login": "wonderslug"}, "path": "freeipa/src/main/resources/freeipa-salt/salt/freeipa/scripts/freeipa_backup", "diffHunk": "@@ -93,25 +111,25 @@ elif [[ \"$TYPE\" = \"DATA\" ]]; then\n fi\n \n doLog(){\n-    type_of_msg=$(echo $*|cut -d\" \" -f1)\n+    type_of_msg=$(echo \"$*\"|cut -d\" \" -f1)\n     msg=$(echo \"$*\"|cut -d\" \" -f2-)\n-    [[ $type_of_msg == DEBUG ]] && [[ $do_print_debug_msgs -ne 1 ]] && return\n+    [[ $type_of_msg == DEBUG ]] && [[ ${PRINT_DEBUG_MSGS} -ne 1 ]] && return\n     [[ $type_of_msg == INFO ]] && type_of_msg=\"INFO \" # one space for aligning\n     [[ $type_of_msg == WARN ]] && type_of_msg=\"WARN \" # as well\n \n     # print to the terminal if we have one\n-    test -t 1 && echo \"`date \"+%Y-%m-%dT%H:%M:%SZ\"` $type_of_msg \"\"$msg\"\n-    echo \"`date \"+%Y-%m-%dT%H:%M:%SZ\"` $type_of_msg \"\"$msg\" >> $LOGFILE\n+    test -t 1 && echo \"$(date \"+%Y-%m-%dT%H:%M:%SZ\") $type_of_msg \"\"$msg\"\n+    echo \"$(date \"+%Y-%m-%dT%H:%M:%SZ\") $type_of_msg \"\"$msg\" >> \"${LOGFILE}\"\n }\n \n doStatus(){\n     if [[ -n \"$BACKUP_SCHEDULE\" ]]\n     then\n-        type_of_msg=$(echo $*|cut -d\" \" -f1)\n+        type_of_msg=$(echo \"$*\"|cut -d\" \" -f1)\n         msg=$(echo \"$*\"|cut -d\" \" -f2-)\n         [[ $type_of_msg == INFO ]] && type_of_msg=\"INFO \" # one space for aligning\n \n-        echo \"`date \"+%Y-%m-%dT%H:%M:%SZ\"` $type_of_msg $msg\" > $STATUSFILEPREFIX$BACKUP_SCHEDULE.log\n+        echo \"$(date \"+%Y-%m-%dT%H:%M:%SZ\") $type_of_msg $msg\" > \"${STATUSFILEPREFIX}\"\"${BACKUP_SCHEDULE}\".log", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDQ2MDEwOA=="}, "originalCommit": {"oid": "9c810ab749f06907288b6516abb051904ddbe31a"}, "originalPosition": 93}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2OTM2Nzk0OnYy", "diffSide": "RIGHT", "path": "freeipa/src/main/resources/freeipa-salt/salt/freeipa/scripts/freeipa_backup", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QxOTozNzoxNFrOGn3xOg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QyMDozMzo1M1rOGn5h6Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDQ2MTM3MA==", "bodyText": "Is there a reason the double quotes are back to back?\nWouldn't BACKUPDIR=$(basename \"$(ls -td \"${config[backup_path]}/ipa-*\" | head -1)\") be simpler?", "url": "https://github.com/hortonworks/cloudbreak/pull/8379#discussion_r444461370", "createdAt": "2020-06-23T19:37:14Z", "author": {"login": "jamisonbennett"}, "path": "freeipa/src/main/resources/freeipa-salt/salt/freeipa/scripts/freeipa_backup", "diffHunk": "@@ -158,8 +176,12 @@ exlock_now || error_exit \"A backup seems to be currently running. Lock file is a\n #set -x\n \n # Perform a backup\n-/sbin/ipa-backup $BACKUP_OPTIONS >> $LOGFILE 2>&1 || error_exit \"ipa-backup failed! Aborting!\"\n-BACKUPDIR=$(basename $(ls -td ${config[backup_path]}/ipa-* | head -1))\n+\n+# shellcheck disable=SC2086\n+/sbin/ipa-backup ${BACKUP_OPTIONS} >> \"${LOGFILE}\" 2>&1 || error_exit \"ipa-backup failed! Aborting!\"\n+\n+# shellcheck disable=SC2012\n+BACKUPDIR=$(basename \"$(ls -td \"${config[backup_path]}\"\"/ipa-*\" | head -1)\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9c810ab749f06907288b6516abb051904ddbe31a"}, "originalPosition": 129}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDQ5MDIxNw==", "bodyText": "fixed", "url": "https://github.com/hortonworks/cloudbreak/pull/8379#discussion_r444490217", "createdAt": "2020-06-23T20:33:53Z", "author": {"login": "wonderslug"}, "path": "freeipa/src/main/resources/freeipa-salt/salt/freeipa/scripts/freeipa_backup", "diffHunk": "@@ -158,8 +176,12 @@ exlock_now || error_exit \"A backup seems to be currently running. Lock file is a\n #set -x\n \n # Perform a backup\n-/sbin/ipa-backup $BACKUP_OPTIONS >> $LOGFILE 2>&1 || error_exit \"ipa-backup failed! Aborting!\"\n-BACKUPDIR=$(basename $(ls -td ${config[backup_path]}/ipa-* | head -1))\n+\n+# shellcheck disable=SC2086\n+/sbin/ipa-backup ${BACKUP_OPTIONS} >> \"${LOGFILE}\" 2>&1 || error_exit \"ipa-backup failed! Aborting!\"\n+\n+# shellcheck disable=SC2012\n+BACKUPDIR=$(basename \"$(ls -td \"${config[backup_path]}\"\"/ipa-*\" | head -1)\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDQ2MTM3MA=="}, "originalCommit": {"oid": "9c810ab749f06907288b6516abb051904ddbe31a"}, "originalPosition": 129}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc2OTM3NDExOnYy", "diffSide": "RIGHT", "path": "freeipa/src/main/resources/freeipa-salt/salt/freeipa/scripts/freeipa_backup", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QxOTozOToxNVrOGn31Cw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QyMDozMzo1MFrOGn5hyA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDQ2MjM0Nw==", "bodyText": "Same thing with double quoting here on these two lines.", "url": "https://github.com/hortonworks/cloudbreak/pull/8379#discussion_r444462347", "createdAt": "2020-06-23T19:39:15Z", "author": {"login": "jamisonbennett"}, "path": "freeipa/src/main/resources/freeipa-salt/salt/freeipa/scripts/freeipa_backup", "diffHunk": "@@ -93,25 +111,25 @@ elif [[ \"$TYPE\" = \"DATA\" ]]; then\n fi\n \n doLog(){\n-    type_of_msg=$(echo $*|cut -d\" \" -f1)\n+    type_of_msg=$(echo \"$*\"|cut -d\" \" -f1)\n     msg=$(echo \"$*\"|cut -d\" \" -f2-)\n-    [[ $type_of_msg == DEBUG ]] && [[ $do_print_debug_msgs -ne 1 ]] && return\n+    [[ $type_of_msg == DEBUG ]] && [[ ${PRINT_DEBUG_MSGS} -ne 1 ]] && return\n     [[ $type_of_msg == INFO ]] && type_of_msg=\"INFO \" # one space for aligning\n     [[ $type_of_msg == WARN ]] && type_of_msg=\"WARN \" # as well\n \n     # print to the terminal if we have one\n-    test -t 1 && echo \"`date \"+%Y-%m-%dT%H:%M:%SZ\"` $type_of_msg \"\"$msg\"\n-    echo \"`date \"+%Y-%m-%dT%H:%M:%SZ\"` $type_of_msg \"\"$msg\" >> $LOGFILE\n+    test -t 1 && echo \"$(date \"+%Y-%m-%dT%H:%M:%SZ\") $type_of_msg \"\"$msg\"\n+    echo \"$(date \"+%Y-%m-%dT%H:%M:%SZ\") $type_of_msg \"\"$msg\" >> \"${LOGFILE}\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9c810ab749f06907288b6516abb051904ddbe31a"}, "originalPosition": 81}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDQ5MDE4NA==", "bodyText": "fixed", "url": "https://github.com/hortonworks/cloudbreak/pull/8379#discussion_r444490184", "createdAt": "2020-06-23T20:33:50Z", "author": {"login": "wonderslug"}, "path": "freeipa/src/main/resources/freeipa-salt/salt/freeipa/scripts/freeipa_backup", "diffHunk": "@@ -93,25 +111,25 @@ elif [[ \"$TYPE\" = \"DATA\" ]]; then\n fi\n \n doLog(){\n-    type_of_msg=$(echo $*|cut -d\" \" -f1)\n+    type_of_msg=$(echo \"$*\"|cut -d\" \" -f1)\n     msg=$(echo \"$*\"|cut -d\" \" -f2-)\n-    [[ $type_of_msg == DEBUG ]] && [[ $do_print_debug_msgs -ne 1 ]] && return\n+    [[ $type_of_msg == DEBUG ]] && [[ ${PRINT_DEBUG_MSGS} -ne 1 ]] && return\n     [[ $type_of_msg == INFO ]] && type_of_msg=\"INFO \" # one space for aligning\n     [[ $type_of_msg == WARN ]] && type_of_msg=\"WARN \" # as well\n \n     # print to the terminal if we have one\n-    test -t 1 && echo \"`date \"+%Y-%m-%dT%H:%M:%SZ\"` $type_of_msg \"\"$msg\"\n-    echo \"`date \"+%Y-%m-%dT%H:%M:%SZ\"` $type_of_msg \"\"$msg\" >> $LOGFILE\n+    test -t 1 && echo \"$(date \"+%Y-%m-%dT%H:%M:%SZ\") $type_of_msg \"\"$msg\"\n+    echo \"$(date \"+%Y-%m-%dT%H:%M:%SZ\") $type_of_msg \"\"$msg\" >> \"${LOGFILE}\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDQ2MjM0Nw=="}, "originalCommit": {"oid": "9c810ab749f06907288b6516abb051904ddbe31a"}, "originalPosition": 81}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3164, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}