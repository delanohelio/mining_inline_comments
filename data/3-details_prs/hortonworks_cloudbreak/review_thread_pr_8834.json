{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY5NTM2MTg5", "number": 8834, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQwOToxNTozNFrOEZ45hg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQwOToxODo0MFrOEZ4-hQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk1NTgyMDg2OnYy", "diffSide": "RIGHT", "path": "core-api/src/main/java/com/sequenceiq/cloudbreak/api/endpoint/v4/stacks/StackV4Endpoint.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQwOToxNTozNFrOHC-ktw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQwOToyNToyN1rOHC--Jg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjg4NDQwNw==", "bodyText": "Can't we skip the whole workspace ID from these new API's?", "url": "https://github.com/hortonworks/cloudbreak/pull/8834#discussion_r472884407", "createdAt": "2020-08-19T09:15:34Z", "author": {"login": "lnardai"}, "path": "core-api/src/main/java/com/sequenceiq/cloudbreak/api/endpoint/v4/stacks/StackV4Endpoint.java", "diffHunk": "@@ -285,6 +351,13 @@ UpgradeV4Response checkForClusterUpgradeByName(@PathParam(\"workspaceId\") Long wo\n     FlowIdentifier upgradeClusterByName(@PathParam(\"workspaceId\") Long workspaceId, @PathParam(\"name\") String name, String imageId,\n             @AccountId @QueryParam(\"accountId\") String accountId);\n \n+    @POST\n+    @Path(\"internal/{name}/cluster_upgrade\")\n+    @Produces(MediaType.APPLICATION_JSON)\n+    @ApiOperation(value = STACK_UPGRADE_INTERNAL, nickname = \"upgradeClusterByNameInternal\")\n+    FlowIdentifier upgradeClusterByNameInternal(@PathParam(\"workspaceId\") Long workspaceId, @PathParam(\"name\") String name, String imageId,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "62dbc85e4b7cc0861c5dd6c85665a91b70a9451c"}, "originalPosition": 154}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjg4NTcwMw==", "bodyText": "Or use accountId instead?", "url": "https://github.com/hortonworks/cloudbreak/pull/8834#discussion_r472885703", "createdAt": "2020-08-19T09:17:29Z", "author": {"login": "lnardai"}, "path": "core-api/src/main/java/com/sequenceiq/cloudbreak/api/endpoint/v4/stacks/StackV4Endpoint.java", "diffHunk": "@@ -285,6 +351,13 @@ UpgradeV4Response checkForClusterUpgradeByName(@PathParam(\"workspaceId\") Long wo\n     FlowIdentifier upgradeClusterByName(@PathParam(\"workspaceId\") Long workspaceId, @PathParam(\"name\") String name, String imageId,\n             @AccountId @QueryParam(\"accountId\") String accountId);\n \n+    @POST\n+    @Path(\"internal/{name}/cluster_upgrade\")\n+    @Produces(MediaType.APPLICATION_JSON)\n+    @ApiOperation(value = STACK_UPGRADE_INTERNAL, nickname = \"upgradeClusterByNameInternal\")\n+    FlowIdentifier upgradeClusterByNameInternal(@PathParam(\"workspaceId\") Long workspaceId, @PathParam(\"name\") String name, String imageId,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjg4NDQwNw=="}, "originalCommit": {"oid": "62dbc85e4b7cc0861c5dd6c85665a91b70a9451c"}, "originalPosition": 154}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjg5MDkxOA==", "bodyText": "I'd like to, but we have some precheck code for this and fails if there is no workspaceId. We can create a followup task for this but I didn't want to deal with this in this PR.", "url": "https://github.com/hortonworks/cloudbreak/pull/8834#discussion_r472890918", "createdAt": "2020-08-19T09:25:27Z", "author": {"login": "sodre90"}, "path": "core-api/src/main/java/com/sequenceiq/cloudbreak/api/endpoint/v4/stacks/StackV4Endpoint.java", "diffHunk": "@@ -285,6 +351,13 @@ UpgradeV4Response checkForClusterUpgradeByName(@PathParam(\"workspaceId\") Long wo\n     FlowIdentifier upgradeClusterByName(@PathParam(\"workspaceId\") Long workspaceId, @PathParam(\"name\") String name, String imageId,\n             @AccountId @QueryParam(\"accountId\") String accountId);\n \n+    @POST\n+    @Path(\"internal/{name}/cluster_upgrade\")\n+    @Produces(MediaType.APPLICATION_JSON)\n+    @ApiOperation(value = STACK_UPGRADE_INTERNAL, nickname = \"upgradeClusterByNameInternal\")\n+    FlowIdentifier upgradeClusterByNameInternal(@PathParam(\"workspaceId\") Long workspaceId, @PathParam(\"name\") String name, String imageId,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjg4NDQwNw=="}, "originalCommit": {"oid": "62dbc85e4b7cc0861c5dd6c85665a91b70a9451c"}, "originalPosition": 154}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk1NTgzMzY1OnYy", "diffSide": "RIGHT", "path": "authorization-common/src/main/java/com/sequenceiq/authorization/service/PermissionCheckService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQwOToxODo0MFrOHC-skw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQwOToxODo0MFrOHC-skw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjg4NjQxOQ==", "bodyText": "Can we check if the endpoint has the @InternalOnly annotation?", "url": "https://github.com/hortonworks/cloudbreak/pull/8834#discussion_r472886419", "createdAt": "2020-08-19T09:18:40Z", "author": {"login": "lnardai"}, "path": "authorization-common/src/main/java/com/sequenceiq/authorization/service/PermissionCheckService.java", "diffHunk": "@@ -54,6 +68,12 @@ public Object hasPermission(ProceedingJoinPoint proceedingJoinPoint) {\n         MethodSignature methodSignature = (MethodSignature) proceedingJoinPoint.getSignature();\n         LOGGER.debug(\"Permission check started at {} (method: {})\", startTime,\n                 methodSignature.getMethod().getDeclaringClass().getSimpleName() + \"#\" + methodSignature.getMethod().getName());\n+        Optional<Object> initiatorUserCrn = reflectionUtil.getParameter(proceedingJoinPoint, methodSignature, InitiatorUserCrn.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "62dbc85e4b7cc0861c5dd6c85665a91b70a9451c"}, "originalPosition": 35}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2408, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}