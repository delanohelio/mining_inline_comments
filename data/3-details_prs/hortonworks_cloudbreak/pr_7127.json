{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY2MDE2OTQw", "number": 7127, "title": "CB-5019, CB-5020: Extend Nifi configproviders with certain config properties", "bodyText": "@keyki pls review", "createdAt": "2020-01-22T19:10:49Z", "url": "https://github.com/hortonworks/cloudbreak/pull/7127", "merged": true, "mergeCommit": {"oid": "399f621e01d34826ae3816eef7b1cf045e6e5a71"}, "closed": true, "closedAt": "2020-02-05T09:05:41Z", "author": {"login": "schfeca75"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb9EykjABqjI5NzI2NDQ0Nzk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcA9EW1gFqTM1Mjc4NjM2OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "17f3d7e3a79c409e70bb275594e22c2b136da56a", "author": {"user": {"login": "schfeca75", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/17f3d7e3a79c409e70bb275594e22c2b136da56a", "committedDate": "2020-01-22T19:08:29Z", "message": "CB-5019, CB-5020: Extend Nifi configproviders with certain config properties"}, "afterCommit": {"oid": "e050096b8ab61e339da17dac1f286071af8d9591", "author": {"user": {"login": "schfeca75", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/e050096b8ab61e339da17dac1f286071af8d9591", "committedDate": "2020-01-23T06:58:10Z", "message": "CB-5019, CB-5020: Extend Nifi configproviders with certain config properties"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e050096b8ab61e339da17dac1f286071af8d9591", "author": {"user": {"login": "schfeca75", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/e050096b8ab61e339da17dac1f286071af8d9591", "committedDate": "2020-01-23T06:58:10Z", "message": "CB-5019, CB-5020: Extend Nifi configproviders with certain config properties"}, "afterCommit": {"oid": "755141e117e935c42b9eccdcbde3e7ce76e5c726", "author": {"user": {"login": "schfeca75", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/755141e117e935c42b9eccdcbde3e7ce76e5c726", "committedDate": "2020-01-23T08:56:05Z", "message": "CB-5019, CB-5020: Extend Nifi configproviders with certain config properties"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "755141e117e935c42b9eccdcbde3e7ce76e5c726", "author": {"user": {"login": "schfeca75", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/755141e117e935c42b9eccdcbde3e7ce76e5c726", "committedDate": "2020-01-23T08:56:05Z", "message": "CB-5019, CB-5020: Extend Nifi configproviders with certain config properties"}, "afterCommit": {"oid": "a7e3010371934739db257feb16d3b03a7a4db243", "author": {"user": {"login": "schfeca75", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/a7e3010371934739db257feb16d3b03a7a4db243", "committedDate": "2020-01-27T14:29:19Z", "message": "CB-5019, CB-5020: Extend Nifi configproviders with certain config properties"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ4NzU2MDQw", "url": "https://github.com/hortonworks/cloudbreak/pull/7127#pullrequestreview-348756040", "createdAt": "2020-01-27T15:35:43Z", "commit": {"oid": "a7e3010371934739db257feb16d3b03a7a4db243"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxNTozNTo0NFrOFiHC1w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxNTozNTo0NFrOFiHC1w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTMxMTMxOQ==", "bodyText": "Let's make it 7.1.0", "url": "https://github.com/hortonworks/cloudbreak/pull/7127#discussion_r371311319", "createdAt": "2020-01-27T15:35:44Z", "author": {"login": "keyki"}, "path": "template-manager-cmtemplate/src/main/java/com/sequenceiq/cloudbreak/cmtemplate/configproviders/nifi/NifiConfigProvider.java", "diffHunk": "@@ -1,19 +1,40 @@\n package com.sequenceiq.cloudbreak.cmtemplate.configproviders.nifi;\n \n+import static com.sequenceiq.cloudbreak.cmtemplate.CMRepositoryVersionUtil.CLOUDERAMANAGER_VERSION_7_0_1;\n+import static com.sequenceiq.cloudbreak.cmtemplate.CMRepositoryVersionUtil.isVersionNewerOrEqualThanLimited;\n+import static com.sequenceiq.cloudbreak.cmtemplate.configproviders.ConfigUtils.config;\n+\n+import java.util.ArrayList;\n import java.util.List;\n \n+import javax.inject.Inject;\n+\n import org.springframework.stereotype.Component;\n \n import com.cloudera.api.swagger.model.ApiClusterTemplateConfig;\n-import com.sequenceiq.cloudbreak.cmtemplate.configproviders.AbstractRoleConfigProvider;\n+import com.sequenceiq.cloudbreak.auth.altus.UmsRight;\n+import com.sequenceiq.cloudbreak.auth.altus.VirtualGroupRequest;\n+import com.sequenceiq.cloudbreak.auth.altus.VirtualGroupService;\n+import com.sequenceiq.cloudbreak.cmtemplate.CmTemplateComponentConfigProvider;\n+import com.sequenceiq.cloudbreak.cmtemplate.CmTemplateProcessor;\n import com.sequenceiq.cloudbreak.template.TemplatePreparationObject;\n \n @Component\n-public class NifiConfigProvider extends AbstractRoleConfigProvider {\n+public class NifiConfigProvider implements CmTemplateComponentConfigProvider {\n+    @Inject\n+    private VirtualGroupService virtualGroupService;\n \n     @Override\n-    public List<ApiClusterTemplateConfig> getRoleConfigs(String roleType, TemplatePreparationObject source) {\n-        return List.of();\n+    public List<ApiClusterTemplateConfig> getServiceConfigs(CmTemplateProcessor templateProcessor, TemplatePreparationObject source) {\n+        List<ApiClusterTemplateConfig> configList = new ArrayList<>();\n+        String cdhVersion = source.getBlueprintView().getProcessor().getStackVersion() == null ?\n+                \"\" : source.getBlueprintView().getProcessor().getStackVersion();\n+        if (isVersionNewerOrEqualThanLimited(cdhVersion, CLOUDERAMANAGER_VERSION_7_0_1)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a7e3010371934739db257feb16d3b03a7a4db243"}, "originalPosition": 36}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ4NzU2MzI5", "url": "https://github.com/hortonworks/cloudbreak/pull/7127#pullrequestreview-348756329", "createdAt": "2020-01-27T15:36:05Z", "commit": {"oid": "a7e3010371934739db257feb16d3b03a7a4db243"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxNTozNjowNlrOFiHDxw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yN1QxNTozNjowNlrOFiHDxw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTMxMTU1OQ==", "bodyText": "Same here.", "url": "https://github.com/hortonworks/cloudbreak/pull/7127#discussion_r371311559", "createdAt": "2020-01-27T15:36:06Z", "author": {"login": "keyki"}, "path": "template-manager-cmtemplate/src/main/java/com/sequenceiq/cloudbreak/cmtemplate/configproviders/nifi/NifiRegistryConfigProvider.java", "diffHunk": "@@ -1,19 +1,40 @@\n package com.sequenceiq.cloudbreak.cmtemplate.configproviders.nifi;\n \n+import static com.sequenceiq.cloudbreak.cmtemplate.CMRepositoryVersionUtil.CLOUDERAMANAGER_VERSION_7_0_1;\n+import static com.sequenceiq.cloudbreak.cmtemplate.CMRepositoryVersionUtil.isVersionNewerOrEqualThanLimited;\n+import static com.sequenceiq.cloudbreak.cmtemplate.configproviders.ConfigUtils.config;\n+\n+import java.util.ArrayList;\n import java.util.List;\n \n+import javax.inject.Inject;\n+\n import org.springframework.stereotype.Component;\n \n import com.cloudera.api.swagger.model.ApiClusterTemplateConfig;\n-import com.sequenceiq.cloudbreak.cmtemplate.configproviders.AbstractRoleConfigProvider;\n+import com.sequenceiq.cloudbreak.auth.altus.UmsRight;\n+import com.sequenceiq.cloudbreak.auth.altus.VirtualGroupRequest;\n+import com.sequenceiq.cloudbreak.auth.altus.VirtualGroupService;\n+import com.sequenceiq.cloudbreak.cmtemplate.CmTemplateComponentConfigProvider;\n+import com.sequenceiq.cloudbreak.cmtemplate.CmTemplateProcessor;\n import com.sequenceiq.cloudbreak.template.TemplatePreparationObject;\n \n @Component\n-public class NifiRegistryConfigProvider extends AbstractRoleConfigProvider {\n+public class NifiRegistryConfigProvider implements CmTemplateComponentConfigProvider {\n+    @Inject\n+    private VirtualGroupService virtualGroupService;\n \n     @Override\n-    public List<ApiClusterTemplateConfig> getRoleConfigs(String roleType, TemplatePreparationObject source) {\n-        return List.of();\n+    public List<ApiClusterTemplateConfig> getServiceConfigs(CmTemplateProcessor templateProcessor, TemplatePreparationObject source) {\n+        List<ApiClusterTemplateConfig> configList = new ArrayList<>();\n+        String cdhVersion = source.getBlueprintView().getProcessor().getStackVersion() == null ?\n+                \"\" : source.getBlueprintView().getProcessor().getStackVersion();\n+        if (isVersionNewerOrEqualThanLimited(cdhVersion, CLOUDERAMANAGER_VERSION_7_0_1)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a7e3010371934739db257feb16d3b03a7a4db243"}, "originalPosition": 36}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a7e3010371934739db257feb16d3b03a7a4db243", "author": {"user": {"login": "schfeca75", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/a7e3010371934739db257feb16d3b03a7a4db243", "committedDate": "2020-01-27T14:29:19Z", "message": "CB-5019, CB-5020: Extend Nifi configproviders with certain config properties"}, "afterCommit": {"oid": "3de4c47221b1de5b4abbcb0d8babd2eeabf710df", "author": {"user": {"login": "schfeca75", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/3de4c47221b1de5b4abbcb0d8babd2eeabf710df", "committedDate": "2020-01-27T17:25:14Z", "message": "CB-5019, CB-5020: Extend Nifi configproviders with certain config properties"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3de4c47221b1de5b4abbcb0d8babd2eeabf710df", "author": {"user": {"login": "schfeca75", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/3de4c47221b1de5b4abbcb0d8babd2eeabf710df", "committedDate": "2020-01-27T17:25:14Z", "message": "CB-5019, CB-5020: Extend Nifi configproviders with certain config properties"}, "afterCommit": {"oid": "b97d3d44d7b21155dbc5b008afd56e8ec8d36fac", "author": {"user": {"login": "schfeca75", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/b97d3d44d7b21155dbc5b008afd56e8ec8d36fac", "committedDate": "2020-01-29T13:39:33Z", "message": "CB-5019, CB-5020: Extend Nifi configproviders with certain config properties"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b97d3d44d7b21155dbc5b008afd56e8ec8d36fac", "author": {"user": {"login": "schfeca75", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/b97d3d44d7b21155dbc5b008afd56e8ec8d36fac", "committedDate": "2020-01-29T13:39:33Z", "message": "CB-5019, CB-5020: Extend Nifi configproviders with certain config properties"}, "afterCommit": {"oid": "c4770b29ce3eaeef65952f21313aec1cb48a7d86", "author": {"user": {"login": "schfeca75", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/c4770b29ce3eaeef65952f21313aec1cb48a7d86", "committedDate": "2020-01-29T13:56:41Z", "message": "CB-5019, CB-5020: Extend Nifi configproviders with certain config properties"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c4770b29ce3eaeef65952f21313aec1cb48a7d86", "author": {"user": {"login": "schfeca75", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/c4770b29ce3eaeef65952f21313aec1cb48a7d86", "committedDate": "2020-01-29T13:56:41Z", "message": "CB-5019, CB-5020: Extend Nifi configproviders with certain config properties"}, "afterCommit": {"oid": "6b207a323b86d3b8f289a92c240417e293494329", "author": {"user": {"login": "schfeca75", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/6b207a323b86d3b8f289a92c240417e293494329", "committedDate": "2020-01-29T16:00:43Z", "message": "CB-5019, CB-5020: Extend Nifi configproviders with certain config properties"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6b207a323b86d3b8f289a92c240417e293494329", "author": {"user": {"login": "schfeca75", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/6b207a323b86d3b8f289a92c240417e293494329", "committedDate": "2020-01-29T16:00:43Z", "message": "CB-5019, CB-5020: Extend Nifi configproviders with certain config properties"}, "afterCommit": {"oid": "cf11e59402b1995b3417bbac403035b7b13cb282", "author": {"user": {"login": "schfeca75", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/cf11e59402b1995b3417bbac403035b7b13cb282", "committedDate": "2020-01-29T16:06:13Z", "message": "CB-5019, CB-5020: Extend Nifi configproviders with certain config properties"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8a9c70e017191f44af035d92ea82ff6ccadd3d49", "author": {"user": {"login": "schfeca75", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/8a9c70e017191f44af035d92ea82ff6ccadd3d49", "committedDate": "2020-01-30T09:32:34Z", "message": "CB-5019, CB-5020: Extend Nifi configproviders with certain config properties"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cf11e59402b1995b3417bbac403035b7b13cb282", "author": {"user": {"login": "schfeca75", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/cf11e59402b1995b3417bbac403035b7b13cb282", "committedDate": "2020-01-29T16:06:13Z", "message": "CB-5019, CB-5020: Extend Nifi configproviders with certain config properties"}, "afterCommit": {"oid": "8a9c70e017191f44af035d92ea82ff6ccadd3d49", "author": {"user": {"login": "schfeca75", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/8a9c70e017191f44af035d92ea82ff6ccadd3d49", "committedDate": "2020-01-30T09:32:34Z", "message": "CB-5019, CB-5020: Extend Nifi configproviders with certain config properties"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyNzg2MzY5", "url": "https://github.com/hortonworks/cloudbreak/pull/7127#pullrequestreview-352786369", "createdAt": "2020-02-04T08:15:03Z", "commit": {"oid": "8a9c70e017191f44af035d92ea82ff6ccadd3d49"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1994, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}