{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcyOTk0MDU2", "number": 8851, "title": "CDPCP-2822. Ensure datalake is running before triggerring OID sync", "bodyText": "This ensures that we only make the CM api calls to set cloud\nidentity configs on CM's that are running.", "createdAt": "2020-08-25T07:11:42Z", "url": "https://github.com/hortonworks/cloudbreak/pull/8851", "merged": true, "mergeCommit": {"oid": "ee7859f6b0ccd54e0ac905a348c7c90571826521"}, "closed": true, "closedAt": "2020-08-26T11:57:18Z", "author": {"login": "aarman-cloudera"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdCcLEdgFqTQ3NDc3NzU5MQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdCqgD9gFqTQ3NTQxNDM3MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc0Nzc3NTkx", "url": "https://github.com/hortonworks/cloudbreak/pull/8851#pullrequestreview-474777591", "createdAt": "2020-08-25T19:14:31Z", "commit": {"oid": "e1d344f9c4ca8e7ef37cfb57416a72d4ec32b2a8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxOToxNDozMVrOHGmK7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxOToxNDozMVrOHGmK7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjY3ODg5Mg==", "bodyText": "this is a duplicate of the getRangerCloudIdentitySyncStatus. could you refactor this to a common part to reduce code duplication?", "url": "https://github.com/hortonworks/cloudbreak/pull/8851#discussion_r476678892", "createdAt": "2020-08-25T19:14:31Z", "author": {"login": "lacikaaa"}, "path": "datalake/src/main/java/com/sequenceiq/datalake/cm/RangerCloudIdentityService.java", "diffHunk": "@@ -64,11 +70,20 @@ private RangerCloudIdentitySyncStatus setAzureCloudIdentityMapping(String envCrn\n         return Optional.of(Iterables.getOnlyElement(sdxClusters));\n     }\n \n+    private boolean isDatalakeRunning(SdxCluster sdxCluster) {\n+        SdxStatusEntity sdxStatusEntity = sdxStatusService.getActualStatusForSdx(sdxCluster);\n+        LOGGER.debug(\"SDX status = {}\", sdxStatusEntity.getStatus());\n+        return sdxStatusEntity.getStatus().equals(DatalakeStatusEnum.RUNNING);\n+    }\n+\n     public RangerCloudIdentitySyncStatus setAzureCloudIdentityMapping(String envCrn, Map<String, String> azureUserMapping) {\n         Optional<SdxCluster> sdxCluster = getSdxCluster(envCrn);\n         if (sdxCluster.isEmpty()) {\n             return newSyncStatus(RangerCloudIdentitySyncState.NOT_APPLICABLE, \"No datalakes associated with the environment.\");\n         }\n+        if (!isDatalakeRunning(sdxCluster.get())) {\n+            return newSyncStatus(RangerCloudIdentitySyncState.NOT_APPLICABLE, \"Datalake is not running for the environment.\");\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e1d344f9c4ca8e7ef37cfb57416a72d4ec32b2a8"}, "originalPosition": 39}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e1d344f9c4ca8e7ef37cfb57416a72d4ec32b2a8", "author": {"user": {"login": "aarman-cloudera", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/e1d344f9c4ca8e7ef37cfb57416a72d4ec32b2a8", "committedDate": "2020-08-25T07:02:00Z", "message": "CDPCP-2822. Ensure datalake is running before triggerring OID sync\n\nThis ensures that we only make the CM api calls to set cloud\nidentity configs on CM's that are running."}, "afterCommit": {"oid": "8c3c32544029f77e5b98c4faf0bda0b7d0a3b403", "author": {"user": {"login": "aarman-cloudera", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/8c3c32544029f77e5b98c4faf0bda0b7d0a3b403", "committedDate": "2020-08-25T19:58:28Z", "message": "CDPCP-2822. Ensure datalake is running before triggerring OID sync\n\nThis ensures that we only make the CM api calls to set cloud\nidentity configs on CM's that are running."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c869a6b654a33b3401e5f78b7eb47ebc1c3eb9c2", "author": {"user": {"login": "aarman-cloudera", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/c869a6b654a33b3401e5f78b7eb47ebc1c3eb9c2", "committedDate": "2020-08-26T08:22:26Z", "message": "CDPCP-2822. Ensure datalake is running before triggerring OID sync\n\nThis ensures that we only make the CM api calls to set cloud\nidentity configs on CM's that are running."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8c3c32544029f77e5b98c4faf0bda0b7d0a3b403", "author": {"user": {"login": "aarman-cloudera", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/8c3c32544029f77e5b98c4faf0bda0b7d0a3b403", "committedDate": "2020-08-25T19:58:28Z", "message": "CDPCP-2822. Ensure datalake is running before triggerring OID sync\n\nThis ensures that we only make the CM api calls to set cloud\nidentity configs on CM's that are running."}, "afterCommit": {"oid": "c869a6b654a33b3401e5f78b7eb47ebc1c3eb9c2", "author": {"user": {"login": "aarman-cloudera", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/c869a6b654a33b3401e5f78b7eb47ebc1c3eb9c2", "committedDate": "2020-08-26T08:22:26Z", "message": "CDPCP-2822. Ensure datalake is running before triggerring OID sync\n\nThis ensures that we only make the CM api calls to set cloud\nidentity configs on CM's that are running."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc1NDE0Mzcw", "url": "https://github.com/hortonworks/cloudbreak/pull/8851#pullrequestreview-475414370", "createdAt": "2020-08-26T11:56:07Z", "commit": {"oid": "c869a6b654a33b3401e5f78b7eb47ebc1c3eb9c2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2357, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}