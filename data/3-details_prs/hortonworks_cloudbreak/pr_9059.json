{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkwODcwNjg1", "number": 9059, "title": "CB-8714 Fix OCSP and CRL URL for CM CA", "bodyText": "When creating cloudera manager intermediate CA, it has a default\nprofile present. This has invalid settings for OCSP and CRL. In this\ncommit we are replacing those values with the right ones.", "createdAt": "2020-09-22T11:23:29Z", "url": "https://github.com/hortonworks/cloudbreak/pull/9059", "merged": true, "mergeCommit": {"oid": "b6462fb866c4ca77547276ee2487f94bc8ac12c3"}, "closed": true, "closedAt": "2020-09-23T11:01:50Z", "author": {"login": "lacikaaa"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdLpQHpgH2gAyNDkwODcwNjg1OjI4MDVhOWZmNTYzZGM2ZWU5Yzg5ZjgzZDBmNjQxYTJlMjQ1YzcwNjc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdLpiXngFqTQ5NDQ5MTQ0Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2805a9ff563dc6ee9c89f83d0f641a2e245c7067", "author": {"user": {"login": "lacikaaa", "name": "Mihaly Laszlo Molnar"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/2805a9ff563dc6ee9c89f83d0f641a2e245c7067", "committedDate": "2020-09-23T09:34:07Z", "message": "CB-8714 Fix OCSP and CRL URL for CM CA\n\nWhen creating cloudera manager intermediate CA, it has a default\nprofile present. This has invalid settings for OCSP and CRL. In this\ncommit we are replacing those values with the right ones.\nOCSP and CRL are solutions for checking if the certificate is still\nvalid even if it's not expired. It makes possible to revoke a\ncertificate in cases like it has been compromised or in our case the\ncluster is deleted."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "de4f07af1c3ebf289c1bd4466115f59a0afdb5ca", "author": {"user": {"login": "lacikaaa", "name": "Mihaly Laszlo Molnar"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/de4f07af1c3ebf289c1bd4466115f59a0afdb5ca", "committedDate": "2020-09-22T11:20:43Z", "message": "CB-8714 Fix OCSP and CRL URL for CM CA\n\nWhen creating cloudera manager intermediate CA, it has a default\nprofile present. This has invalid settings for OCSP and CRL. In this\ncommit we are replacing those values with the right ones."}, "afterCommit": {"oid": "2805a9ff563dc6ee9c89f83d0f641a2e245c7067", "author": {"user": {"login": "lacikaaa", "name": "Mihaly Laszlo Molnar"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/2805a9ff563dc6ee9c89f83d0f641a2e245c7067", "committedDate": "2020-09-23T09:34:07Z", "message": "CB-8714 Fix OCSP and CRL URL for CM CA\n\nWhen creating cloudera manager intermediate CA, it has a default\nprofile present. This has invalid settings for OCSP and CRL. In this\ncommit we are replacing those values with the right ones.\nOCSP and CRL are solutions for checking if the certificate is still\nvalid even if it's not expired. It makes possible to revoke a\ncertificate in cases like it has been compromised or in our case the\ncluster is deleted."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk0NDkxNDQ3", "url": "https://github.com/hortonworks/cloudbreak/pull/9059#pullrequestreview-494491447", "createdAt": "2020-09-23T09:54:02Z", "commit": {"oid": "2805a9ff563dc6ee9c89f83d0f641a2e245c7067"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QwOTo1NDowM1rOHWiOAQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QwOTo1NDowM1rOHWiOAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzM5MTM2MQ==", "bodyText": "Should we have an unless condition or it doesn't matter as replace wouldn't do anything anyway?", "url": "https://github.com/hortonworks/cloudbreak/pull/9059#discussion_r493391361", "createdAt": "2020-09-23T09:54:03Z", "author": {"login": "keyki"}, "path": "orchestrator-salt/src/main/resources/salt/salt/cloudera/manager/init.sls", "diffHunk": "@@ -88,6 +88,18 @@ cloudera_manager_set_parcel_validation:\n \n {% if cloudera_manager.communication.autotls_enabled == True %}\n \n+replace_crl_in_cmca_profile:\n+  file.replace:\n+    - name: /etc/cloudera-scm-server/cmSubCaCert.profile\n+    - pattern: \"policyset.cmSubCaCertSet.9.default.params.crlDistPointsPointName_0=http://changeme.com/ipa/crl/MasterCRL.bin\"\n+    - repl: \"policyset.cmSubCaCertSet.9.default.params.crlDistPointsPointName_0=http://ipa-ca.{{ metadata.cluster_domain }}/ipa/crl/MasterCRL.bin\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2805a9ff563dc6ee9c89f83d0f641a2e245c7067"}, "originalPosition": 8}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2219, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}