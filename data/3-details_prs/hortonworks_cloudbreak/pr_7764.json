{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAwOTkzNDQy", "number": 7764, "title": "CB-6458 Deny distrox/sdx stop on spot instances", "bodyText": "", "createdAt": "2020-04-08T17:55:46Z", "url": "https://github.com/hortonworks/cloudbreak/pull/7764", "merged": true, "mergeCommit": {"oid": "b812d3300d93c94d78eed9d8b7ed901f065de88d"}, "closed": true, "closedAt": "2020-04-14T09:55:14Z", "author": {"login": "Bajzathd"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcV8hjtgH2gAyNDAwOTkzNDQyOmQyOWZlOTQ1YjgxMmQzZmMzMjc4OGEwZmFhM2NlZDMyYTg2YmU5ZTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcXgcwrgFqTM5Mjc3NjE1NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d29fe945b812d3fc32788a0faa3ced32a86be9e0", "author": {"user": {"login": "Bajzathd", "name": "Bajz\u00e1th D\u00e1vid"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/d29fe945b812d3fc32788a0faa3ced32a86be9e0", "committedDate": "2020-04-09T13:29:27Z", "message": "CB-6458 Deny distrox/sdx stop on spot instances"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a9d5de1548a6c8da260ddacdd72d084e286b2cdf", "author": {"user": {"login": "Bajzathd", "name": "Bajz\u00e1th D\u00e1vid"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/a9d5de1548a6c8da260ddacdd72d084e286b2cdf", "committedDate": "2020-04-08T17:54:17Z", "message": "CB-6458 Deny distrox/sdx stop on spot instances"}, "afterCommit": {"oid": "d29fe945b812d3fc32788a0faa3ced32a86be9e0", "author": {"user": {"login": "Bajzathd", "name": "Bajz\u00e1th D\u00e1vid"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/d29fe945b812d3fc32788a0faa3ced32a86be9e0", "committedDate": "2020-04-09T13:29:27Z", "message": "CB-6458 Deny distrox/sdx stop on spot instances"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwODcwODc5", "url": "https://github.com/hortonworks/cloudbreak/pull/7764#pullrequestreview-390870879", "createdAt": "2020-04-09T14:56:44Z", "commit": {"oid": "37e06f89f2f32e9f5edeeafa378a6add4e10fa45"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxNDo1Njo0NFrOGDciEg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxNDo1Njo0NFrOGDciEg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjI2NjM4Ng==", "bodyText": "pls add  verify(stackUpdater, never()).updateStackStatus(any(), any()) here", "url": "https://github.com/hortonworks/cloudbreak/pull/7764#discussion_r406266386", "createdAt": "2020-04-09T14:56:44Z", "author": {"login": "bergerdenes"}, "path": "core/src/test/java/com/sequenceiq/cloudbreak/service/stack/flow/StackOperationServiceTest.java", "diffHunk": "@@ -106,4 +124,40 @@ public void testStartWhenClusterStopFailed() {\n         verify(flowManager, times(1)).triggerStackStart(stack.getId());\n         verify(stackUpdater, times(1)).updateStackStatus(stack.getId(),  DetailedStackStatus.START_REQUESTED);\n     }\n+\n+    @Test\n+    public void shouldNotTriggerStopWhenStackRunsOnSpotInstances() {\n+        Stack stack = new Stack();\n+        stack.setId(9876L);\n+        stack.setStackStatus(new StackStatus(stack, AVAILABLE));\n+        stack.setInstanceGroups(Set.of(createInstanceGroup(100)));\n+\n+        when(stackService.getByIdWithLists(stack.getId())).thenReturn(stack);\n+\n+        Assertions.assertThatThrownBy(() -> underTest.updateStatus(stack.getId(), StatusRequest.STOPPED, true, new User()))\n+                .isInstanceOf(BadRequestException.class)\n+                .hasMessage(String.format(\"Cannot update the status of stack '%s' to STOPPED, because it runs on spot instances\", stack.getName()));\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "37e06f89f2f32e9f5edeeafa378a6add4e10fa45"}, "originalPosition": 66}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "37e06f89f2f32e9f5edeeafa378a6add4e10fa45", "author": {"user": {"login": "Bajzathd", "name": "Bajz\u00e1th D\u00e1vid"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/37e06f89f2f32e9f5edeeafa378a6add4e10fa45", "committedDate": "2020-04-09T14:26:55Z", "message": "CB-6458 Add tests to deny distrox/sdx stop on spot instances"}, "afterCommit": {"oid": "be84a51096f18633c5887156f5c4e2096b174c8f", "author": {"user": {"login": "Bajzathd", "name": "Bajz\u00e1th D\u00e1vid"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/be84a51096f18633c5887156f5c4e2096b174c8f", "committedDate": "2020-04-09T15:02:10Z", "message": "CB-6458 Add tests to deny distrox/sdx stop on spot instances"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "94d5e81754d5a0b9b7fb9c054c195ff31c9aa77f", "author": {"user": {"login": "Bajzathd", "name": "Bajz\u00e1th D\u00e1vid"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/94d5e81754d5a0b9b7fb9c054c195ff31c9aa77f", "committedDate": "2020-04-14T09:23:00Z", "message": "CB-6458 Add tests to deny distrox/sdx stop on spot instances"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "be84a51096f18633c5887156f5c4e2096b174c8f", "author": {"user": {"login": "Bajzathd", "name": "Bajz\u00e1th D\u00e1vid"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/be84a51096f18633c5887156f5c4e2096b174c8f", "committedDate": "2020-04-09T15:02:10Z", "message": "CB-6458 Add tests to deny distrox/sdx stop on spot instances"}, "afterCommit": {"oid": "94d5e81754d5a0b9b7fb9c054c195ff31c9aa77f", "author": {"user": {"login": "Bajzathd", "name": "Bajz\u00e1th D\u00e1vid"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/94d5e81754d5a0b9b7fb9c054c195ff31c9aa77f", "committedDate": "2020-04-14T09:23:00Z", "message": "CB-6458 Add tests to deny distrox/sdx stop on spot instances"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkyNzc2MTU0", "url": "https://github.com/hortonworks/cloudbreak/pull/7764#pullrequestreview-392776154", "createdAt": "2020-04-14T09:54:43Z", "commit": {"oid": "94d5e81754d5a0b9b7fb9c054c195ff31c9aa77f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2301, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}