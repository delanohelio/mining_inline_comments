{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk2OTgzMzA1", "number": 7705, "title": "CB-6267 Add AWS Spot parameters to Environment creation request", "bodyText": "", "createdAt": "2020-04-01T13:06:57Z", "url": "https://github.com/hortonworks/cloudbreak/pull/7705", "merged": true, "mergeCommit": {"oid": "2c3e2b7694aa6fb5225f0439fe036ce7f7b9d789"}, "closed": true, "closedAt": "2020-04-03T07:40:40Z", "author": {"login": "Bajzathd"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcTXbztABqjMxODc4MTI5MDc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcTueDRAFqTM4NjU2OTczMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e1e76659a60a99f6ca69b5e72758680ed8de26d0", "author": {"user": {"login": "Bajzathd", "name": "Bajz\u00e1th D\u00e1vid"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/e1e76659a60a99f6ca69b5e72758680ed8de26d0", "committedDate": "2020-04-01T13:04:29Z", "message": "CB-6267 Add AWS Spot parameters to Environment creation request"}, "afterCommit": {"oid": "f28e7116a431fa7585eb8d29ac58b5bf622c341f", "author": {"user": {"login": "Bajzathd", "name": "Bajz\u00e1th D\u00e1vid"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/f28e7116a431fa7585eb8d29ac58b5bf622c341f", "committedDate": "2020-04-01T13:08:34Z", "message": "CB-6267 Add AWS Spot parameters to Environment creation request"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f28e7116a431fa7585eb8d29ac58b5bf622c341f", "author": {"user": {"login": "Bajzathd", "name": "Bajz\u00e1th D\u00e1vid"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/f28e7116a431fa7585eb8d29ac58b5bf622c341f", "committedDate": "2020-04-01T13:08:34Z", "message": "CB-6267 Add AWS Spot parameters to Environment creation request"}, "afterCommit": {"oid": "1219713eef6f0745074e011608a775181a2d66f4", "author": {"user": {"login": "Bajzathd", "name": "Bajz\u00e1th D\u00e1vid"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/1219713eef6f0745074e011608a775181a2d66f4", "committedDate": "2020-04-01T13:09:28Z", "message": "CB-6267 Add AWS Spot parameters to Environment creation request"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg1NTc1MDYz", "url": "https://github.com/hortonworks/cloudbreak/pull/7705#pullrequestreview-385575063", "createdAt": "2020-04-01T13:18:31Z", "commit": {"oid": "1219713eef6f0745074e011608a775181a2d66f4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQxMzoxODozMlrOF_ALHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQxMzoxODozMlrOF_ALHg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTYwNzQ1NA==", "bodyText": "FreeIpa", "url": "https://github.com/hortonworks/cloudbreak/pull/7705#discussion_r401607454", "createdAt": "2020-04-01T13:18:32Z", "author": {"login": "doktoric"}, "path": "environment-api/src/main/java/com/sequenceiq/environment/api/doc/environment/EnvironmentModelDescription.java", "diffHunk": "@@ -72,6 +72,10 @@\n     public static final String PARENT_ENVIRONMENT_NAME = \"Parent environment name\";\n     public static final String PARENT_ENVIRONMENT_CLOUD_PLATFORM = \"Parent environment cloud platform\";\n \n+    public static final String FREEIPA_AWS_PARAMETERS = \"Aws specific FreeIpa parameters\";\n+    public static final String FREEIPA_AWS_SPOT_PARAMETERS = \"Aws spot instance related parameters.\";\n+    public static final String FREEIPA_AWS_SPOT_PERCENTAGE = \"Percentage of spot instances launched in freeipa instance group\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1219713eef6f0745074e011608a775181a2d66f4"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg1NTc2NTA4", "url": "https://github.com/hortonworks/cloudbreak/pull/7705#pullrequestreview-385576508", "createdAt": "2020-04-01T13:20:06Z", "commit": {"oid": "1219713eef6f0745074e011608a775181a2d66f4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQxMzoyMDowNlrOF_APdQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQxMzoyMDowNlrOF_APdQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTYwODU2NQ==", "bodyText": "can we use the same structure here ?", "url": "https://github.com/hortonworks/cloudbreak/pull/7705#discussion_r401608565", "createdAt": "2020-04-01T13:20:06Z", "author": {"login": "doktoric"}, "path": "environment-api/src/main/java/com/sequenceiq/environment/api/v1/environment/model/response/FreeIpaResponse.java", "diffHunk": "@@ -11,6 +11,9 @@\n     @ApiModelProperty(EnvironmentModelDescription.FREEIPA_INSTANCE_COUNT_BY_GROUP)\n     private Integer instanceCountByGroup = 1;\n \n+    @ApiModelProperty(EnvironmentModelDescription.FREEIPA_AWS_SPOT_PERCENTAGE)\n+    private Integer spotPercentage;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1219713eef6f0745074e011608a775181a2d66f4"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg1NTgwODQx", "url": "https://github.com/hortonworks/cloudbreak/pull/7705#pullrequestreview-385580841", "createdAt": "2020-04-01T13:24:44Z", "commit": {"oid": "1219713eef6f0745074e011608a775181a2d66f4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQxMzoyNDo0NFrOF_AciQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQxMzoyNDo0NFrOF_AciQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTYxMTkxMw==", "bodyText": "I used plain integer, not the Integer class", "url": "https://github.com/hortonworks/cloudbreak/pull/7705#discussion_r401611913", "createdAt": "2020-04-01T13:24:44Z", "author": {"login": "bergerdenes"}, "path": "environment-api/src/main/java/com/sequenceiq/environment/api/v1/environment/model/request/aws/AttachedFreeIpaRequestAwsSpotParameters.java", "diffHunk": "@@ -0,0 +1,28 @@\n+package com.sequenceiq.environment.api.v1.environment.model.request.aws;\n+\n+import javax.validation.constraints.Digits;\n+import javax.validation.constraints.Max;\n+import javax.validation.constraints.Min;\n+\n+import com.sequenceiq.environment.api.doc.environment.EnvironmentModelDescription;\n+\n+import io.swagger.annotations.ApiModel;\n+import io.swagger.annotations.ApiModelProperty;\n+\n+@ApiModel(value = \"AttachedFreeIpaRequestAwsSpotParameters\")\n+public class AttachedFreeIpaRequestAwsSpotParameters {\n+\n+    @ApiModelProperty(EnvironmentModelDescription.FREEIPA_AWS_SPOT_PERCENTAGE)\n+    @Min(value = 0, message = \"Spot percentage must be between 0 and 100 percent\")\n+    @Max(value = 100, message = \"Spot percentage must be between 0 and 100 percent\")\n+    @Digits(fraction = 0, integer = 3, message = \"Spot percentage has to be a number\")\n+    private Integer percentage;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1219713eef6f0745074e011608a775181a2d66f4"}, "originalPosition": 19}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1219713eef6f0745074e011608a775181a2d66f4", "author": {"user": {"login": "Bajzathd", "name": "Bajz\u00e1th D\u00e1vid"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/1219713eef6f0745074e011608a775181a2d66f4", "committedDate": "2020-04-01T13:09:28Z", "message": "CB-6267 Add AWS Spot parameters to Environment creation request"}, "afterCommit": {"oid": "baa71f2df86a1b69307ef50295a9edb971db790d", "author": {"user": {"login": "Bajzathd", "name": "Bajz\u00e1th D\u00e1vid"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/baa71f2df86a1b69307ef50295a9edb971db790d", "committedDate": "2020-04-01T13:47:46Z", "message": "CB-6267 Add AWS Spot parameters to Environment creation request"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5e544694e00c201a807406915d7de936de8cdf65", "author": {"user": {"login": "Bajzathd", "name": "Bajz\u00e1th D\u00e1vid"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/5e544694e00c201a807406915d7de936de8cdf65", "committedDate": "2020-04-02T11:04:22Z", "message": "CB-6267 Redesign aws spot parameters in env creation request"}, "afterCommit": {"oid": "8501bab305894b49e6204053c9fdc6587c97b9a7", "author": {"user": {"login": "Bajzathd", "name": "Bajz\u00e1th D\u00e1vid"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/8501bab305894b49e6204053c9fdc6587c97b9a7", "committedDate": "2020-04-02T12:35:50Z", "message": "CB-6267 Redesign aws spot parameters in env creation request"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2NDAyMTkx", "url": "https://github.com/hortonworks/cloudbreak/pull/7705#pullrequestreview-386402191", "createdAt": "2020-04-02T13:02:30Z", "commit": {"oid": "8501bab305894b49e6204053c9fdc6587c97b9a7"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxMzowMjozMFrOF_qH_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxMzozMDo1OFrOF_rSsQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjI5NDc4Mw==", "bodyText": "please add @Valid to private AttachedFreeIpaRequest freeIpa; line 72 the EnvironmentRequest class", "url": "https://github.com/hortonworks/cloudbreak/pull/7705#discussion_r402294783", "createdAt": "2020-04-02T13:02:30Z", "author": {"login": "bergerdenes"}, "path": "environment-api/src/main/java/com/sequenceiq/environment/api/v1/environment/model/request/AttachedFreeIpaRequest.java", "diffHunk": "@@ -17,6 +19,10 @@\n     @ApiModelProperty(value = EnvironmentModelDescription.FREEIPA_INSTANCE_COUNT_BY_GROUP)\n     private Integer instanceCountByGroup;\n \n+    @Valid", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8501bab305894b49e6204053c9fdc6587c97b9a7"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjMwNjE0OA==", "bodyText": "FreeIpaCreationAwsSpotParametersDto does not define toString()", "url": "https://github.com/hortonworks/cloudbreak/pull/7705#discussion_r402306148", "createdAt": "2020-04-02T13:20:09Z", "author": {"login": "bergerdenes"}, "path": "environment/src/main/java/com/sequenceiq/environment/environment/dto/FreeIpaCreationDto.java", "diffHunk": "@@ -25,11 +27,16 @@ public int getInstanceCountByGroup() {\n         return instanceCountByGroup;\n     }\n \n+    public FreeIpaCreationAwsParametersDto getAws() {\n+        return aws;\n+    }\n+\n     @Override\n     public String toString() {\n         return \"FreeIpaCreationDto{\" +\n             \"create='\" + create + '\\'' +\n             \"instanceCountByGroup='\" + instanceCountByGroup + '\\'' +\n+            \"aws='\" + aws + '\\'' +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8501bab305894b49e6204053c9fdc6587c97b9a7"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjMxMzkwNQ==", "bodyText": "minor:  freeipa in one word", "url": "https://github.com/hortonworks/cloudbreak/pull/7705#discussion_r402313905", "createdAt": "2020-04-02T13:30:58Z", "author": {"login": "bergerdenes"}, "path": "environment/src/main/java/com/sequenceiq/environment/parameters/dao/domain/AwsParameters.java", "diffHunk": "@@ -17,6 +17,9 @@\n     @Enumerated(EnumType.STRING)\n     private S3GuardTableCreation s3guardTableCreation;\n \n+    @Column(name = \"free_ipa_spot_percentage\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8501bab305894b49e6204053c9fdc6587c97b9a7"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2NDg2MTA3", "url": "https://github.com/hortonworks/cloudbreak/pull/7705#pullrequestreview-386486107", "createdAt": "2020-04-02T14:32:01Z", "commit": {"oid": "62795e90415f2497a8f0dc68d2ccfbad5fc02c37"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "35c5047cc9ea1330b7473316a8a94df16beaaa61", "author": {"user": {"login": "Bajzathd", "name": "Bajz\u00e1th D\u00e1vid"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/35c5047cc9ea1330b7473316a8a94df16beaaa61", "committedDate": "2020-04-02T14:41:09Z", "message": "CB-6267 Add AWS Spot parameters to Environment creation request"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bda8323c4f88751109471e6982ad75a76d907a42", "author": {"user": {"login": "Bajzathd", "name": "Bajz\u00e1th D\u00e1vid"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/bda8323c4f88751109471e6982ad75a76d907a42", "committedDate": "2020-04-02T14:41:09Z", "message": "CB-6267 Redesign aws spot parameters in env creation request"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2NTY1NDk5", "url": "https://github.com/hortonworks/cloudbreak/pull/7705#pullrequestreview-386565499", "createdAt": "2020-04-02T15:54:33Z", "commit": {"oid": "62795e90415f2497a8f0dc68d2ccfbad5fc02c37"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxNTo1NDozM1rOF_x-lA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMlQxNTo1NDozM1rOF_x-lA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQyMzQ0NA==", "bodyText": "can you please add 2 more test ?\nArguments.of(2, 100, true)\nArguments.of(2, 0, true)", "url": "https://github.com/hortonworks/cloudbreak/pull/7705#discussion_r402423444", "createdAt": "2020-04-02T15:54:33Z", "author": {"login": "doktoric"}, "path": "environment/src/test/java/com/sequenceiq/environment/environment/validation/EnvironmentValidatorServiceTest.java", "diffHunk": "@@ -324,4 +331,30 @@ private Environment aValidEnvirontmentWithParent() {\n \n         return environment;\n     }\n+\n+    @ParameterizedTest\n+    @MethodSource(\"freeIpaCreationArguments\")\n+    void shouldValidateFreeIpaCreation(int instanceCountByGroup, int spotPercentage, boolean valid) {\n+        FreeIpaCreationDto freeIpaCreationDto = FreeIpaCreationDto.builder()\n+                .withInstanceCountByGroup(instanceCountByGroup)\n+                .withAws(FreeIpaCreationAwsParametersDto.builder()\n+                        .withSpot(FreeIpaCreationAwsSpotParametersDto.builder()\n+                                .withPercentage(spotPercentage)\n+                                .build())\n+                        .build())\n+                .build();\n+\n+        ValidationResult validationResult = underTest.validateFreeIpaCreation(freeIpaCreationDto);\n+        assertEquals(!valid, validationResult.hasError());\n+    }\n+\n+    private static Stream<Arguments> freeIpaCreationArguments() {\n+        return Stream.of(\n+                Arguments.of(1, 0, true),\n+                Arguments.of(1, 100, true),\n+                Arguments.of(1, 50, false),\n+                Arguments.of(2, 50, true)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "62795e90415f2497a8f0dc68d2ccfbad5fc02c37"}, "originalPosition": 51}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ca902522c66c9ddd21e446c6588ddf5a29608195", "author": {"user": {"login": "Bajzathd", "name": "Bajz\u00e1th D\u00e1vid"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/ca902522c66c9ddd21e446c6588ddf5a29608195", "committedDate": "2020-04-02T15:57:55Z", "message": "CB-6267 Fix minor issues"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "62795e90415f2497a8f0dc68d2ccfbad5fc02c37", "author": {"user": {"login": "Bajzathd", "name": "Bajz\u00e1th D\u00e1vid"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/62795e90415f2497a8f0dc68d2ccfbad5fc02c37", "committedDate": "2020-04-02T14:27:33Z", "message": "CB-6267 Fix minor issues"}, "afterCommit": {"oid": "ca902522c66c9ddd21e446c6588ddf5a29608195", "author": {"user": {"login": "Bajzathd", "name": "Bajz\u00e1th D\u00e1vid"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/ca902522c66c9ddd21e446c6588ddf5a29608195", "committedDate": "2020-04-02T15:57:55Z", "message": "CB-6267 Fix minor issues"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2NTY5NzMz", "url": "https://github.com/hortonworks/cloudbreak/pull/7705#pullrequestreview-386569733", "createdAt": "2020-04-02T15:59:06Z", "commit": {"oid": "62795e90415f2497a8f0dc68d2ccfbad5fc02c37"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2397, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}