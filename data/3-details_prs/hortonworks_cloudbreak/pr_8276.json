{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM0MzU5MzAx", "number": 8276, "title": "CB-7294 FlowChain ends before next flow actually executed", "bodyText": "", "createdAt": "2020-06-15T08:00:44Z", "url": "https://github.com/hortonworks/cloudbreak/pull/8276", "merged": true, "mergeCommit": {"oid": "04ac7003782df23dd1ced97446385f848df2c081"}, "closed": true, "closedAt": "2020-06-17T09:11:14Z", "author": {"login": "foldik"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcrcFxGAFqTQzMDQxMTY1MQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcsFGbnABqjM0NTIzMDI2MDY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwNDExNjUx", "url": "https://github.com/hortonworks/cloudbreak/pull/8276#pullrequestreview-430411651", "createdAt": "2020-06-15T08:08:28Z", "commit": {"oid": "64da38570ce27a06ddcc26f040069cffcccaa097"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQwODowODoyOFrOGjneiQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQwODowODoyOFrOGjneiQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDAwMDEzNw==", "bodyText": "just a minor thing: as far as i see, there is a void version from required method, is it possible to use that here?", "url": "https://github.com/hortonworks/cloudbreak/pull/8276#discussion_r440000137", "createdAt": "2020-06-15T08:08:28Z", "author": {"login": "horadla23"}, "path": "flow/src/main/java/com/sequenceiq/flow/core/Flow2Handler.java", "diffHunk": "@@ -145,7 +145,13 @@ private void handle(String key, Payload payload, FlowParameters flowParameters,\n                         flow.initialize(contextParams);\n                         runningFlows.put(flow, flowChainId);\n                         try {\n-                            flowLogService.save(flowParameters, flowChainId, key, payload, null, flowConfig.getClass(), flow.getCurrentState());\n+                            transactionService.required(() -> {\n+                                flowLogService.save(flowParameters, flowChainId, key, payload, null, flowConfig.getClass(), flow.getCurrentState());\n+                                if (flowChainId != null) {\n+                                    flowChains.removeLastTriggerEvent(flowChainId, flowParameters.getFlowTriggerUserCrn());\n+                                }\n+                                return null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "64da38570ce27a06ddcc26f040069cffcccaa097"}, "originalPosition": 10}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "378cb2ae45dc707ac5f34664be6da1f88916c416", "author": {"user": {"login": "foldik", "name": "Attila Kristof Foldi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/378cb2ae45dc707ac5f34664be6da1f88916c416", "committedDate": "2020-06-15T08:25:54Z", "message": "CB-7294 FlowChain ends before next flow actually executed"}, "afterCommit": {"oid": "d18bd65ab73dc8466c6cf5c86f2609a0f5778fab", "author": {"user": {"login": "foldik", "name": "Attila Kristof Foldi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/d18bd65ab73dc8466c6cf5c86f2609a0f5778fab", "committedDate": "2020-06-15T08:27:42Z", "message": "CB-7294 FlowChain ends before next flow actually executed"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMwNDI5NTU5", "url": "https://github.com/hortonworks/cloudbreak/pull/8276#pullrequestreview-430429559", "createdAt": "2020-06-15T08:32:19Z", "commit": {"oid": "d18bd65ab73dc8466c6cf5c86f2609a0f5778fab"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d18bd65ab73dc8466c6cf5c86f2609a0f5778fab", "author": {"user": {"login": "foldik", "name": "Attila Kristof Foldi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/d18bd65ab73dc8466c6cf5c86f2609a0f5778fab", "committedDate": "2020-06-15T08:27:42Z", "message": "CB-7294 FlowChain ends before next flow actually executed"}, "afterCommit": {"oid": "ebe98cedfd80742e0c4fa7af6616c66aa454b173", "author": {"user": {"login": "foldik", "name": "Attila Kristof Foldi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/ebe98cedfd80742e0c4fa7af6616c66aa454b173", "committedDate": "2020-06-16T06:58:44Z", "message": "CB-7294 FlowChain ends before next flow actually executed"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ebe98cedfd80742e0c4fa7af6616c66aa454b173", "author": {"user": {"login": "foldik", "name": "Attila Kristof Foldi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/ebe98cedfd80742e0c4fa7af6616c66aa454b173", "committedDate": "2020-06-16T06:58:44Z", "message": "CB-7294 FlowChain ends before next flow actually executed"}, "afterCommit": {"oid": "aa2415d547b2fce345b4d9db28b73c63241e7129", "author": {"user": {"login": "foldik", "name": "Attila Kristof Foldi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/aa2415d547b2fce345b4d9db28b73c63241e7129", "committedDate": "2020-06-16T07:56:49Z", "message": "CB-7294 FlowChain ends before next flow actually executed"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "aa2415d547b2fce345b4d9db28b73c63241e7129", "author": {"user": {"login": "foldik", "name": "Attila Kristof Foldi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/aa2415d547b2fce345b4d9db28b73c63241e7129", "committedDate": "2020-06-16T07:56:49Z", "message": "CB-7294 FlowChain ends before next flow actually executed"}, "afterCommit": {"oid": "acf37f928f41f545c5d630a2b31f20f821019712", "author": {"user": {"login": "foldik", "name": "Attila Kristof Foldi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/acf37f928f41f545c5d630a2b31f20f821019712", "committedDate": "2020-06-16T08:49:03Z", "message": "CB-7294 Fix next flow triggering in flow chains"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxMzc4Njgy", "url": "https://github.com/hortonworks/cloudbreak/pull/8276#pullrequestreview-431378682", "createdAt": "2020-06-16T10:42:54Z", "commit": {"oid": "acf37f928f41f545c5d630a2b31f20f821019712"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "acf37f928f41f545c5d630a2b31f20f821019712", "author": {"user": {"login": "foldik", "name": "Attila Kristof Foldi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/acf37f928f41f545c5d630a2b31f20f821019712", "committedDate": "2020-06-16T08:49:03Z", "message": "CB-7294 Fix next flow triggering in flow chains"}, "afterCommit": {"oid": "b6d7d528b81c00c6f2cb4233d67e1716d430fe2b", "author": {"user": {"login": "foldik", "name": "Attila Kristof Foldi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/b6d7d528b81c00c6f2cb4233d67e1716d430fe2b", "committedDate": "2020-06-17T07:48:20Z", "message": "CB-7294 FlowChain ends before next flow actually executed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c1871a1daaaf47ff8009e7bd5ae50c4bbdbdaba3", "author": {"user": {"login": "foldik", "name": "Attila Kristof Foldi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/c1871a1daaaf47ff8009e7bd5ae50c4bbdbdaba3", "committedDate": "2020-06-17T07:54:54Z", "message": "CB-7294 FlowChain ends before next flow actually executed"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b6d7d528b81c00c6f2cb4233d67e1716d430fe2b", "author": {"user": {"login": "foldik", "name": "Attila Kristof Foldi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/b6d7d528b81c00c6f2cb4233d67e1716d430fe2b", "committedDate": "2020-06-17T07:48:20Z", "message": "CB-7294 FlowChain ends before next flow actually executed"}, "afterCommit": {"oid": "c1871a1daaaf47ff8009e7bd5ae50c4bbdbdaba3", "author": {"user": {"login": "foldik", "name": "Attila Kristof Foldi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/c1871a1daaaf47ff8009e7bd5ae50c4bbdbdaba3", "committedDate": "2020-06-17T07:54:54Z", "message": "CB-7294 FlowChain ends before next flow actually executed"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1705, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}