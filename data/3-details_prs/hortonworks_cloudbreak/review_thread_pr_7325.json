{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc3MTc1ODA5", "number": 7325, "reviewThreads": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxMDo1MDoxOVrODh1sCg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxMzowMToxMFrODh3uAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2ODA5MjI2OnYy", "diffSide": "RIGHT", "path": "common-handlebar/src/main/java/com/sequenceiq/cloudbreak/EqHelper.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxMDo1MDoxOVrOFsy_cQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxMDo1MDoxOVrOFsy_cQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjUxNzEwNQ==", "bodyText": "is the com.sequenceiq.cloudbreak best package? what was the problem with template package? it is moved to the template core module", "url": "https://github.com/hortonworks/cloudbreak/pull/7325#discussion_r382517105", "createdAt": "2020-02-21T10:50:19Z", "author": {"login": "topolyai5"}, "path": "common-handlebar/src/main/java/com/sequenceiq/cloudbreak/EqHelper.java", "diffHunk": "@@ -1,4 +1,4 @@\n-package com.sequenceiq.cloudbreak.template;\n+package com.sequenceiq.cloudbreak;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f4e725fa20a8f76cefa15e690567bf17fc334fc4"}, "originalPosition": 2}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2ODMzOTI0OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/com/sequenceiq/cloudbreak/service/stack/StackService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxMjoyOTowOFrOFs1W3g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxMjoyOTowOFrOFs1W3g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjU1NTg3MA==", "bodyText": "please add aTVF to exception", "url": "https://github.com/hortonworks/cloudbreak/pull/7325#discussion_r382555870", "createdAt": "2020-02-21T12:29:08Z", "author": {"login": "topolyai5"}, "path": "core/src/main/java/com/sequenceiq/cloudbreak/service/stack/StackService.java", "diffHunk": "@@ -537,11 +543,15 @@ private void setDefaultTags(Stack stack) {\n                     .withResourceCrn(stack.getResourceCrn())\n                     .withIsInternalTenant(internalTenant)\n                     .withUserName(stack.getCreator().getUserName())\n+                    .withAccountTags(accountTagClientService.list())\n+                    .withUserDefinedTags(userDefinedTags)\n                     .build();\n \n             Map<String, String> defaultTags = stackTag.getDefaultTags();\n             defaultTags.putAll(costTagging.prepareDefaultTags(request));\n-            stack.setTags(new Json(new StackTags(stackTag.getUserDefinedTags(), stackTag.getApplicationTags(), defaultTags)));\n+            stack.setTags(new Json(new StackTags(userDefinedTags, stackTag.getApplicationTags(), defaultTags)));\n+        } catch (AccountTagValidationFailed aTVF) {\n+            throw new BadRequestException(aTVF.getMessage());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aa444218c42bd360a7e267467367d05a48f92616"}, "originalPosition": 59}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2ODM2MTE0OnYy", "diffSide": "RIGHT", "path": "environment/src/main/java/com/sequenceiq/environment/tags/service/AccountTagService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxMjozODowOFrOFs1kPw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxMjozODowOFrOFs1kPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjU1OTI5NQ==", "bodyText": "Please add log message and e to the new exception", "url": "https://github.com/hortonworks/cloudbreak/pull/7325#discussion_r382559295", "createdAt": "2020-02-21T12:38:08Z", "author": {"login": "topolyai5"}, "path": "environment/src/main/java/com/sequenceiq/environment/tags/service/AccountTagService.java", "diffHunk": "@@ -0,0 +1,55 @@\n+package com.sequenceiq.environment.tags.service;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Set;\n+import java.util.UUID;\n+\n+import org.springframework.dao.DataIntegrityViolationException;\n+import org.springframework.security.access.AccessDeniedException;\n+import org.springframework.stereotype.Service;\n+\n+import com.sequenceiq.cloudbreak.auth.altus.Crn;\n+import com.sequenceiq.environment.tags.domain.AccountTag;\n+import com.sequenceiq.environment.tags.repository.AccountTagRepository;\n+\n+@Service\n+public class AccountTagService {\n+\n+    private final AccountTagRepository accountTagRepository;\n+\n+    public AccountTagService(AccountTagRepository accountTagRepository) {\n+        this.accountTagRepository = accountTagRepository;\n+    }\n+\n+    public Set<AccountTag> get(String accountId) {\n+        return accountTagRepository.findAllInAccount(accountId);\n+    }\n+\n+    public List<AccountTag> create(List<AccountTag> accountTags, String accountId) {\n+        try {\n+            accountTagRepository.arhiveAll(accountId);\n+\n+            List<AccountTag> result = new ArrayList<>();\n+            for (AccountTag accountTag : accountTags) {\n+                accountTag.setAccountId(accountId);\n+                accountTag.setArchived(false);\n+                accountTag.setResourceCrn(createCRN(accountId));\n+                result.add(accountTagRepository.save(accountTag));\n+            }\n+            return result;\n+        } catch (DataIntegrityViolationException e) {\n+            throw new AccessDeniedException(\"Access denied\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aa444218c42bd360a7e267467367d05a48f92616"}, "originalPosition": 42}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2ODM4NTI4OnYy", "diffSide": "RIGHT", "path": "template-manager-tag/build.gradle", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxMjo0NzowMlrOFs1yVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQwODoxOTo1M1rOFtYK_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjU2MjkwMA==", "bodyText": "@lnardai refactored the junit4/5. Could you please discuss with him about this?", "url": "https://github.com/hortonworks/cloudbreak/pull/7325#discussion_r382562900", "createdAt": "2020-02-21T12:47:02Z", "author": {"login": "topolyai5"}, "path": "template-manager-tag/build.gradle", "diffHunk": "@@ -0,0 +1,47 @@\n+apply plugin: 'java'\n+\n+repositories {\n+    mavenLocal()\n+    maven { url = \"$repoUrl\" }\n+    mavenCentral()\n+}\n+\n+jar {\n+    baseName = 'template-manager-tag'\n+}\n+\n+dependencies {\n+    compile project(':common')\n+    compile project(':common-handlebar')\n+\n+    testCompile (group: 'junit', name: 'junit', version: junitVersion) {\n+        exclude group: 'org.hamcrest'\n+    }\n+    testCompile (group: 'org.mockito',             name: 'mockito-core',          version: mockitoVersion) {\n+        exclude group: 'org.hamcrest'\n+    }\n+\n+    testCompile group: 'org.springframework.boot',  name: 'spring-boot-starter',            version: springBootVersion\n+    testCompile group: 'org.springframework.boot',  name: 'spring-boot-starter-test',       version: springBootVersion\n+    testCompile group: 'org.junit.jupiter',         name: 'junit-jupiter-api',              version: junitJupiterVersion\n+    testCompile 'org.hamcrest:java-hamcrest:2.0.0.0'\n+    testCompile 'net.javacrumbs.json-unit:json-unit:1.28.2'\n+\n+    testImplementation group: \"org.mockito\",               name: \"mockito-core\",                             version: mockitoVersion\n+    testImplementation group: \"org.mockito\",               name: \"mockito-junit-jupiter\",                    version: mockitoVersion\n+    testImplementation group: 'org.junit.jupiter',         name: 'junit-jupiter-params',                     version: junitJupiterVersion", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aa444218c42bd360a7e267467367d05a48f92616"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjU4NzE4NA==", "bodyText": "I think that PR will not solve all the problem just specifically in one modul", "url": "https://github.com/hortonworks/cloudbreak/pull/7325#discussion_r382587184", "createdAt": "2020-02-21T13:43:42Z", "author": {"login": "doktoric"}, "path": "template-manager-tag/build.gradle", "diffHunk": "@@ -0,0 +1,47 @@\n+apply plugin: 'java'\n+\n+repositories {\n+    mavenLocal()\n+    maven { url = \"$repoUrl\" }\n+    mavenCentral()\n+}\n+\n+jar {\n+    baseName = 'template-manager-tag'\n+}\n+\n+dependencies {\n+    compile project(':common')\n+    compile project(':common-handlebar')\n+\n+    testCompile (group: 'junit', name: 'junit', version: junitVersion) {\n+        exclude group: 'org.hamcrest'\n+    }\n+    testCompile (group: 'org.mockito',             name: 'mockito-core',          version: mockitoVersion) {\n+        exclude group: 'org.hamcrest'\n+    }\n+\n+    testCompile group: 'org.springframework.boot',  name: 'spring-boot-starter',            version: springBootVersion\n+    testCompile group: 'org.springframework.boot',  name: 'spring-boot-starter-test',       version: springBootVersion\n+    testCompile group: 'org.junit.jupiter',         name: 'junit-jupiter-api',              version: junitJupiterVersion\n+    testCompile 'org.hamcrest:java-hamcrest:2.0.0.0'\n+    testCompile 'net.javacrumbs.json-unit:json-unit:1.28.2'\n+\n+    testImplementation group: \"org.mockito\",               name: \"mockito-core\",                             version: mockitoVersion\n+    testImplementation group: \"org.mockito\",               name: \"mockito-junit-jupiter\",                    version: mockitoVersion\n+    testImplementation group: 'org.junit.jupiter',         name: 'junit-jupiter-params',                     version: junitJupiterVersion", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjU2MjkwMA=="}, "originalCommit": {"oid": "aa444218c42bd360a7e267467367d05a48f92616"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjU5MDE2OA==", "bodyText": "No, Laci wants to clean from all module. In the new module we should follow the clean way.", "url": "https://github.com/hortonworks/cloudbreak/pull/7325#discussion_r382590168", "createdAt": "2020-02-21T13:50:09Z", "author": {"login": "topolyai5"}, "path": "template-manager-tag/build.gradle", "diffHunk": "@@ -0,0 +1,47 @@\n+apply plugin: 'java'\n+\n+repositories {\n+    mavenLocal()\n+    maven { url = \"$repoUrl\" }\n+    mavenCentral()\n+}\n+\n+jar {\n+    baseName = 'template-manager-tag'\n+}\n+\n+dependencies {\n+    compile project(':common')\n+    compile project(':common-handlebar')\n+\n+    testCompile (group: 'junit', name: 'junit', version: junitVersion) {\n+        exclude group: 'org.hamcrest'\n+    }\n+    testCompile (group: 'org.mockito',             name: 'mockito-core',          version: mockitoVersion) {\n+        exclude group: 'org.hamcrest'\n+    }\n+\n+    testCompile group: 'org.springframework.boot',  name: 'spring-boot-starter',            version: springBootVersion\n+    testCompile group: 'org.springframework.boot',  name: 'spring-boot-starter-test',       version: springBootVersion\n+    testCompile group: 'org.junit.jupiter',         name: 'junit-jupiter-api',              version: junitJupiterVersion\n+    testCompile 'org.hamcrest:java-hamcrest:2.0.0.0'\n+    testCompile 'net.javacrumbs.json-unit:json-unit:1.28.2'\n+\n+    testImplementation group: \"org.mockito\",               name: \"mockito-core\",                             version: mockitoVersion\n+    testImplementation group: \"org.mockito\",               name: \"mockito-junit-jupiter\",                    version: mockitoVersion\n+    testImplementation group: 'org.junit.jupiter',         name: 'junit-jupiter-params',                     version: junitJupiterVersion", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjU2MjkwMA=="}, "originalCommit": {"oid": "aa444218c42bd360a7e267467367d05a48f92616"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzEyNjI2OQ==", "bodyText": "done", "url": "https://github.com/hortonworks/cloudbreak/pull/7325#discussion_r383126269", "createdAt": "2020-02-24T08:19:53Z", "author": {"login": "doktoric"}, "path": "template-manager-tag/build.gradle", "diffHunk": "@@ -0,0 +1,47 @@\n+apply plugin: 'java'\n+\n+repositories {\n+    mavenLocal()\n+    maven { url = \"$repoUrl\" }\n+    mavenCentral()\n+}\n+\n+jar {\n+    baseName = 'template-manager-tag'\n+}\n+\n+dependencies {\n+    compile project(':common')\n+    compile project(':common-handlebar')\n+\n+    testCompile (group: 'junit', name: 'junit', version: junitVersion) {\n+        exclude group: 'org.hamcrest'\n+    }\n+    testCompile (group: 'org.mockito',             name: 'mockito-core',          version: mockitoVersion) {\n+        exclude group: 'org.hamcrest'\n+    }\n+\n+    testCompile group: 'org.springframework.boot',  name: 'spring-boot-starter',            version: springBootVersion\n+    testCompile group: 'org.springframework.boot',  name: 'spring-boot-starter-test',       version: springBootVersion\n+    testCompile group: 'org.junit.jupiter',         name: 'junit-jupiter-api',              version: junitJupiterVersion\n+    testCompile 'org.hamcrest:java-hamcrest:2.0.0.0'\n+    testCompile 'net.javacrumbs.json-unit:json-unit:1.28.2'\n+\n+    testImplementation group: \"org.mockito\",               name: \"mockito-core\",                             version: mockitoVersion\n+    testImplementation group: \"org.mockito\",               name: \"mockito-junit-jupiter\",                    version: mockitoVersion\n+    testImplementation group: 'org.junit.jupiter',         name: 'junit-jupiter-params',                     version: junitJupiterVersion", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjU2MjkwMA=="}, "originalCommit": {"oid": "aa444218c42bd360a7e267467367d05a48f92616"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2ODM4NzI0OnYy", "diffSide": "RIGHT", "path": "template-manager-tag/src/main/java/com/sequenceiq/cloudbreak/tag/CentralTagUpdater.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxMjo0Nzo1OFrOFs1zkw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxMjo0Nzo1OFrOFs1zkw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjU2MzIxOQ==", "bodyText": "maybe the e would be good in the log message", "url": "https://github.com/hortonworks/cloudbreak/pull/7325#discussion_r382563219", "createdAt": "2020-02-21T12:47:58Z", "author": {"login": "topolyai5"}, "path": "template-manager-tag/src/main/java/com/sequenceiq/cloudbreak/tag/CentralTagUpdater.java", "diffHunk": "@@ -0,0 +1,35 @@\n+package com.sequenceiq.cloudbreak.tag;\n+\n+import java.io.IOException;\n+\n+import javax.inject.Inject;\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.stereotype.Component;\n+\n+@Component\n+public class CentralTagUpdater {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(CentralTagUpdater.class);\n+\n+    @Inject\n+    private TagTemplateProcessor tagTemplateProcessor;\n+\n+    public String getTagText(TagPreparationObject model, String tagText) {\n+        try {\n+            tagText = updateTagConfiguration(model, tagText);\n+        } catch (IOException e) {\n+            String message = String.format(\"Unable to update tag with default properties which was: %s\", tagText);\n+            LOGGER.warn(message);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aa444218c42bd360a7e267467367d05a48f92616"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2ODM4OTkyOnYy", "diffSide": "RIGHT", "path": "template-manager-tag/src/main/java/com/sequenceiq/cloudbreak/tag/DefaultCostTaggingService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxMjo0ODo0OFrOFs11DA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxMjo0ODo0OFrOFs11DA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjU2MzU5Ng==", "bodyText": "if you add a comment, you can separate in a method", "url": "https://github.com/hortonworks/cloudbreak/pull/7325#discussion_r382563596", "createdAt": "2020-02-21T12:48:48Z", "author": {"login": "topolyai5"}, "path": "template-manager-tag/src/main/java/com/sequenceiq/cloudbreak/tag/DefaultCostTaggingService.java", "diffHunk": "@@ -0,0 +1,112 @@\n+package com.sequenceiq.cloudbreak.tag;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+\n+import javax.inject.Inject;\n+\n+import org.apache.commons.lang3.StringUtils;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.stereotype.Service;\n+import org.springframework.util.CollectionUtils;\n+\n+import com.google.common.base.Strings;\n+import com.sequenceiq.cloudbreak.tag.request.CDPTagGenerationRequest;\n+import com.sequenceiq.cloudbreak.tag.request.CDPTagMergeRequest;\n+\n+@Service\n+public class DefaultCostTaggingService implements CostTagging {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(DefaultCostTaggingService.class);\n+\n+    @Inject\n+    private CentralTagUpdater centralTagUpdater;\n+\n+    @Override\n+    public Map<String, String> prepareDefaultTags(CDPTagGenerationRequest request) {\n+        LOGGER.debug(\"About to prepare default tag(s)...\");\n+        Map<String, String> result = new HashMap<>();\n+        String platform = request.getPlatform();\n+        validateResourceTagsNotContainTheSameTag(request.getUserDefinedTags(), request.getAccountTags());\n+        addCDPCrnIfPresent(result, DefaultApplicationTag.ENVIRONMENT_CRN, request.getEnvironmentCrn(), platform);\n+        addCDPCrnIfPresent(result, DefaultApplicationTag.CREATOR_CRN, request.getCreatorCrn(), platform);\n+        addCDPCrnIfPresent(result, DefaultApplicationTag.RESOURCE_CRN, request.getResourceCrn(), platform);\n+\n+        // Generate Account Tags", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aa444218c42bd360a7e267467367d05a48f92616"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2ODQxMzE4OnYy", "diffSide": "RIGHT", "path": "template-manager-tag/src/main/java/com/sequenceiq/cloudbreak/tag/TagTemplateProcessor.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxMjo1NzoxMFrOFs2Cmw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxMzozOToxNFrOFs3JFA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjU2NzA2Nw==", "bodyText": "if you use Clock, you can use this method from there (and the other places as well)", "url": "https://github.com/hortonworks/cloudbreak/pull/7325#discussion_r382567067", "createdAt": "2020-02-21T12:57:10Z", "author": {"login": "topolyai5"}, "path": "template-manager-tag/src/main/java/com/sequenceiq/cloudbreak/tag/TagTemplateProcessor.java", "diffHunk": "@@ -0,0 +1,56 @@\n+package com.sequenceiq.cloudbreak.tag;\n+\n+import java.io.IOException;\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+import javax.inject.Inject;\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.stereotype.Component;\n+\n+import com.github.jknack.handlebars.Handlebars;\n+import com.github.jknack.handlebars.Template;\n+import com.sequenceiq.cloudbreak.handlebar.HandlebarTemplate;\n+import com.sequenceiq.cloudbreak.handlebar.HandlebarUtils;\n+import com.sequenceiq.cloudbreak.common.json.JsonUtil;\n+import com.sequenceiq.cloudbreak.common.service.Clock;\n+\n+@Component\n+public class TagTemplateProcessor {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(TagTemplateProcessor.class);\n+\n+    private final Handlebars handlebars = HandlebarUtils.handlebars();\n+\n+    @Inject\n+    private Clock clock;\n+\n+    public String process(String sourceTemplate, TagPreparationObject model) throws IOException {\n+        long started = System.currentTimeMillis();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aa444218c42bd360a7e267467367d05a48f92616"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjU4NTEwOA==", "bodyText": "I think this is different here", "url": "https://github.com/hortonworks/cloudbreak/pull/7325#discussion_r382585108", "createdAt": "2020-02-21T13:39:14Z", "author": {"login": "doktoric"}, "path": "template-manager-tag/src/main/java/com/sequenceiq/cloudbreak/tag/TagTemplateProcessor.java", "diffHunk": "@@ -0,0 +1,56 @@\n+package com.sequenceiq.cloudbreak.tag;\n+\n+import java.io.IOException;\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+import javax.inject.Inject;\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.stereotype.Component;\n+\n+import com.github.jknack.handlebars.Handlebars;\n+import com.github.jknack.handlebars.Template;\n+import com.sequenceiq.cloudbreak.handlebar.HandlebarTemplate;\n+import com.sequenceiq.cloudbreak.handlebar.HandlebarUtils;\n+import com.sequenceiq.cloudbreak.common.json.JsonUtil;\n+import com.sequenceiq.cloudbreak.common.service.Clock;\n+\n+@Component\n+public class TagTemplateProcessor {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(TagTemplateProcessor.class);\n+\n+    private final Handlebars handlebars = HandlebarUtils.handlebars();\n+\n+    @Inject\n+    private Clock clock;\n+\n+    public String process(String sourceTemplate, TagPreparationObject model) throws IOException {\n+        long started = System.currentTimeMillis();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjU2NzA2Nw=="}, "originalCommit": {"oid": "aa444218c42bd360a7e267467367d05a48f92616"}, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2ODQyMTgyOnYy", "diffSide": "RIGHT", "path": "template-manager-tag/src/test/java/com/sequenceiq/cloudbreak/DefaultCostTaggingServiceAccountTagValidationTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxMzowMDoxNlrOFs2Hvg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxMzowMDoxNlrOFs2Hvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjU2ODM4Mg==", "bodyText": "hm, copy/paste pattern for test name and tested method?", "url": "https://github.com/hortonworks/cloudbreak/pull/7325#discussion_r382568382", "createdAt": "2020-02-21T13:00:16Z", "author": {"login": "topolyai5"}, "path": "template-manager-tag/src/test/java/com/sequenceiq/cloudbreak/DefaultCostTaggingServiceAccountTagValidationTest.java", "diffHunk": "@@ -0,0 +1,104 @@\n+package com.sequenceiq.cloudbreak;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.Objects;\n+\n+import org.junit.jupiter.api.Assertions;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.InjectMocks;\n+import org.mockito.Mock;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+\n+import com.sequenceiq.cloudbreak.common.mappable.CloudPlatform;\n+import com.sequenceiq.cloudbreak.tag.AccountTagValidationFailed;\n+import com.sequenceiq.cloudbreak.tag.CentralTagUpdater;\n+import com.sequenceiq.cloudbreak.tag.DefaultCostTaggingService;\n+import com.sequenceiq.cloudbreak.tag.request.CDPTagGenerationRequest;\n+\n+@ExtendWith(MockitoExtension.class)\n+public class DefaultCostTaggingServiceAccountTagValidationTest {\n+\n+    @Mock\n+    private CentralTagUpdater centralTagUpdater;\n+\n+    @InjectMocks\n+    private DefaultCostTaggingService underTest;\n+\n+    @Test\n+    void getWithResourceTagValidationWhenUserDefinedResourceTagsIsNull() throws AccountTagValidationFailed {\n+        underTest.prepareDefaultTags(tagRequest(null));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aa444218c42bd360a7e267467367d05a48f92616"}, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2ODQyNDU1OnYy", "diffSide": "RIGHT", "path": "template-manager-tag/src/test/java/com/sequenceiq/cloudbreak/DefaultCostTaggingServiceAccountTagValidationTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxMzowMDo1N1rOFs2JJw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxMzowMDo1N1rOFs2JJw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjU2ODc0Mw==", "bodyText": "what are you testing here?", "url": "https://github.com/hortonworks/cloudbreak/pull/7325#discussion_r382568743", "createdAt": "2020-02-21T13:00:57Z", "author": {"login": "topolyai5"}, "path": "template-manager-tag/src/test/java/com/sequenceiq/cloudbreak/DefaultCostTaggingServiceAccountTagValidationTest.java", "diffHunk": "@@ -0,0 +1,104 @@\n+package com.sequenceiq.cloudbreak;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.Objects;\n+\n+import org.junit.jupiter.api.Assertions;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.InjectMocks;\n+import org.mockito.Mock;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+\n+import com.sequenceiq.cloudbreak.common.mappable.CloudPlatform;\n+import com.sequenceiq.cloudbreak.tag.AccountTagValidationFailed;\n+import com.sequenceiq.cloudbreak.tag.CentralTagUpdater;\n+import com.sequenceiq.cloudbreak.tag.DefaultCostTaggingService;\n+import com.sequenceiq.cloudbreak.tag.request.CDPTagGenerationRequest;\n+\n+@ExtendWith(MockitoExtension.class)\n+public class DefaultCostTaggingServiceAccountTagValidationTest {\n+\n+    @Mock\n+    private CentralTagUpdater centralTagUpdater;\n+\n+    @InjectMocks\n+    private DefaultCostTaggingService underTest;\n+\n+    @Test\n+    void getWithResourceTagValidationWhenUserDefinedResourceTagsIsNull() throws AccountTagValidationFailed {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aa444218c42bd360a7e267467367d05a48f92616"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM2ODQyNDk3OnYy", "diffSide": "RIGHT", "path": "template-manager-tag/src/test/java/com/sequenceiq/cloudbreak/DefaultCostTaggingServiceAccountTagValidationTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxMzowMToxMVrOFs2JZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQxMzowMToxMVrOFs2JZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjU2ODgwNw==", "bodyText": "what are you testing here?", "url": "https://github.com/hortonworks/cloudbreak/pull/7325#discussion_r382568807", "createdAt": "2020-02-21T13:01:11Z", "author": {"login": "topolyai5"}, "path": "template-manager-tag/src/test/java/com/sequenceiq/cloudbreak/DefaultCostTaggingServiceAccountTagValidationTest.java", "diffHunk": "@@ -0,0 +1,104 @@\n+package com.sequenceiq.cloudbreak;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.Objects;\n+\n+import org.junit.jupiter.api.Assertions;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.ExtendWith;\n+import org.mockito.InjectMocks;\n+import org.mockito.Mock;\n+import org.mockito.junit.jupiter.MockitoExtension;\n+\n+import com.sequenceiq.cloudbreak.common.mappable.CloudPlatform;\n+import com.sequenceiq.cloudbreak.tag.AccountTagValidationFailed;\n+import com.sequenceiq.cloudbreak.tag.CentralTagUpdater;\n+import com.sequenceiq.cloudbreak.tag.DefaultCostTaggingService;\n+import com.sequenceiq.cloudbreak.tag.request.CDPTagGenerationRequest;\n+\n+@ExtendWith(MockitoExtension.class)\n+public class DefaultCostTaggingServiceAccountTagValidationTest {\n+\n+    @Mock\n+    private CentralTagUpdater centralTagUpdater;\n+\n+    @InjectMocks\n+    private DefaultCostTaggingService underTest;\n+\n+    @Test\n+    void getWithResourceTagValidationWhenUserDefinedResourceTagsIsNull() throws AccountTagValidationFailed {\n+        underTest.prepareDefaultTags(tagRequest(null));\n+    }\n+\n+    @Test\n+    void getWithResourceTagValidationWhenUserDefinedResourceTagsIsEmpty() throws AccountTagValidationFailed {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aa444218c42bd360a7e267467367d05a48f92616"}, "originalPosition": 35}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2868, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}