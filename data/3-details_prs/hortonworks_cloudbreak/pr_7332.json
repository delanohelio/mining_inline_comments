{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc3NDIxMDk5", "number": 7332, "title": "CB-5636. E2E tests: ABFS logs are missing from idbroker host.", "bodyText": "Pass idbroker identity for fluentd configs (not the log identity one), technically multiple identities should be assigned, but as we are not doing that just use the idbroker one\n\nUTs added\nfew permission fixes (databus credentials)\n\ncluster testing is in progress", "createdAt": "2020-02-19T22:07:06Z", "url": "https://github.com/hortonworks/cloudbreak/pull/7332", "merged": true, "mergeCommit": {"oid": "3129ba2660048fee434ef99820c71dd3b6ae1d23"}, "closed": true, "closedAt": "2020-02-20T15:06:10Z", "author": {"login": "oleewere"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcF_lqyABqjMwNTM4Njk1Mzc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcGLXWIgFqTM2MTkwOTI5NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f10cc9ba4927e9336e471578e4cbdd6bc1b79ba3", "author": {"user": {"login": "oleewere", "name": "Oliv\u00e9r Szabo"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/f10cc9ba4927e9336e471578e4cbdd6bc1b79ba3", "committedDate": "2020-02-19T22:03:41Z", "message": "CB-5636. ABFS logs are missing from idbroker host."}, "afterCommit": {"oid": "e5df958b69422a6896e095cf75aa3c165bb3ed8c", "author": {"user": {"login": "oleewere", "name": "Oliv\u00e9r Szabo"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/e5df958b69422a6896e095cf75aa3c165bb3ed8c", "committedDate": "2020-02-19T23:58:53Z", "message": "CB-5636. ABFS logs are missing from idbroker host."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYxNzE5NTY0", "url": "https://github.com/hortonworks/cloudbreak/pull/7332#pullrequestreview-361719564", "createdAt": "2020-02-20T08:47:24Z", "commit": {"oid": "e5df958b69422a6896e095cf75aa3c165bb3ed8c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQwODo0NzoyNFrOFsKn-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMFQwODo1MzoxN1rOFsK0FQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTg1NTczOQ==", "bodyText": "Hmm, this is certainly wrong as it overwrites the value just retrieved in the previous line. \ud83d\ude04", "url": "https://github.com/hortonworks/cloudbreak/pull/7332#discussion_r381855739", "createdAt": "2020-02-20T08:47:24Z", "author": {"login": "lajosrodek"}, "path": "orchestrator-salt/src/main/resources/salt-common/salt/fluent/settings.sls", "diffHunk": "@@ -36,6 +36,8 @@\n {% set s3_log_bucket = salt['pillar.get']('fluent:s3LogArchiveBucketName') %}\n {% set azure_container = salt['pillar.get']('fluent:azureContainer') %}\n {% set azure_storage_instance_msi = salt['pillar.get']('fluent:azureInstanceMsi') %}\n+{% set azure_storage_instance_msi = salt['pillar.get']('fluent:azureIdBrokerInstanceMsi') %}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e5df958b69422a6896e095cf75aa3c165bb3ed8c"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTg1ODgzNw==", "bodyText": "At first sight this did not make sense to me as log shipping normally does not work on the IDBroker node (see CB-5107). I guess this setting only works in case of internal E2E testing when the IDBroker VM MSI (i.e. the assumer identity) also contains the necessary role assignment for accessing the log storage account location. And similarly for AWS, the IDBroker EC2 instance profile role should have a policy for accessing the log S3 bucket.", "url": "https://github.com/hortonworks/cloudbreak/pull/7332#discussion_r381858837", "createdAt": "2020-02-20T08:53:17Z", "author": {"login": "lajosrodek"}, "path": "orchestrator-salt/src/main/resources/salt-common/salt/fluent/template/output.conf.j2", "diffHunk": "@@ -56,7 +56,11 @@\n     azure_storage_account    {{fluent.azureStorageAccount}}\n     azure_container          {{fluent.azureContainer}}\n {% if fluent.azureInstanceMsi is defined and fluent.azureInstanceMsi is not none and fluent.azureInstanceMsi %}\n+    {% if grains['hostgroup'] == \"idbroker\" %}\n+    azure_instance_msi       {{fluent.azureIdBrokerInstanceMsi}}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e5df958b69422a6896e095cf75aa3c165bb3ed8c"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e5df958b69422a6896e095cf75aa3c165bb3ed8c", "author": {"user": {"login": "oleewere", "name": "Oliv\u00e9r Szabo"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/e5df958b69422a6896e095cf75aa3c165bb3ed8c", "committedDate": "2020-02-19T23:58:53Z", "message": "CB-5636. ABFS logs are missing from idbroker host."}, "afterCommit": {"oid": "53c48869632de35844bcaa800bd2a8d7ce1f8b84", "author": {"user": {"login": "oleewere", "name": "Oliv\u00e9r Szabo"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/53c48869632de35844bcaa800bd2a8d7ce1f8b84", "committedDate": "2020-02-20T09:10:34Z", "message": "CB-5636. ABFS logs are missing from idbroker host."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "53c48869632de35844bcaa800bd2a8d7ce1f8b84", "author": {"user": {"login": "oleewere", "name": "Oliv\u00e9r Szabo"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/53c48869632de35844bcaa800bd2a8d7ce1f8b84", "committedDate": "2020-02-20T09:10:34Z", "message": "CB-5636. ABFS logs are missing from idbroker host."}, "afterCommit": {"oid": "c18511889815f7ec36412120e5f38e209f7d9ae3", "author": {"user": {"login": "oleewere", "name": "Oliv\u00e9r Szabo"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/c18511889815f7ec36412120e5f38e209f7d9ae3", "committedDate": "2020-02-20T11:17:06Z", "message": "CB-5636. ABFS logs are missing from idbroker host."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c18511889815f7ec36412120e5f38e209f7d9ae3", "author": {"user": {"login": "oleewere", "name": "Oliv\u00e9r Szabo"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/c18511889815f7ec36412120e5f38e209f7d9ae3", "committedDate": "2020-02-20T11:17:06Z", "message": "CB-5636. ABFS logs are missing from idbroker host."}, "afterCommit": {"oid": "241431a8aaff1d6f5108e813c41d6318f74e9005", "author": {"user": {"login": "oleewere", "name": "Oliv\u00e9r Szabo"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/241431a8aaff1d6f5108e813c41d6318f74e9005", "committedDate": "2020-02-20T12:09:52Z", "message": "CB-5636. ABFS logs are missing from idbroker host."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "241431a8aaff1d6f5108e813c41d6318f74e9005", "author": {"user": {"login": "oleewere", "name": "Oliv\u00e9r Szabo"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/241431a8aaff1d6f5108e813c41d6318f74e9005", "committedDate": "2020-02-20T12:09:52Z", "message": "CB-5636. ABFS logs are missing from idbroker host."}, "afterCommit": {"oid": "9df689ca9707059e327aab34c1edaffde033c449", "author": {"user": {"login": "oleewere", "name": "Oliv\u00e9r Szabo"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/9df689ca9707059e327aab34c1edaffde033c449", "committedDate": "2020-02-20T12:15:01Z", "message": "CB-5636. ABFS logs are missing from idbroker host."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9df689ca9707059e327aab34c1edaffde033c449", "author": {"user": {"login": "oleewere", "name": "Oliv\u00e9r Szabo"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/9df689ca9707059e327aab34c1edaffde033c449", "committedDate": "2020-02-20T12:15:01Z", "message": "CB-5636. ABFS logs are missing from idbroker host."}, "afterCommit": {"oid": "ebf0963e5aca90eaecb30c3aefef19b0d504fdbd", "author": {"user": {"login": "oleewere", "name": "Oliv\u00e9r Szabo"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/ebf0963e5aca90eaecb30c3aefef19b0d504fdbd", "committedDate": "2020-02-20T12:59:39Z", "message": "CB-5636. ABFS logs are missing from idbroker host."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7e4253ff52601a13bdeb54ccbb9a0d840de66369", "author": {"user": {"login": "oleewere", "name": "Oliv\u00e9r Szabo"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/7e4253ff52601a13bdeb54ccbb9a0d840de66369", "committedDate": "2020-02-20T13:13:21Z", "message": "CB-5636. ABFS logs are missing from idbroker host."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ebf0963e5aca90eaecb30c3aefef19b0d504fdbd", "author": {"user": {"login": "oleewere", "name": "Oliv\u00e9r Szabo"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/ebf0963e5aca90eaecb30c3aefef19b0d504fdbd", "committedDate": "2020-02-20T12:59:39Z", "message": "CB-5636. ABFS logs are missing from idbroker host."}, "afterCommit": {"oid": "7e4253ff52601a13bdeb54ccbb9a0d840de66369", "author": {"user": {"login": "oleewere", "name": "Oliv\u00e9r Szabo"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/7e4253ff52601a13bdeb54ccbb9a0d840de66369", "committedDate": "2020-02-20T13:13:21Z", "message": "CB-5636. ABFS logs are missing from idbroker host."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYxOTA5Mjk1", "url": "https://github.com/hortonworks/cloudbreak/pull/7332#pullrequestreview-361909295", "createdAt": "2020-02-20T13:44:06Z", "commit": {"oid": "7e4253ff52601a13bdeb54ccbb9a0d840de66369"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1902, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}