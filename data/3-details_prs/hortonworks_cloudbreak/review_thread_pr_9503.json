{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI2MzYwODc5", "number": 9503, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxMDowODoyNFrOE8oeBg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxMDoyMjoyN1rOE8pGJw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMyMDEzMDYyOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/com/sequenceiq/cloudbreak/core/flow2/externaldatabase/ExternalDatabaseService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxMDowODoyNFrOH43qoQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxMDowODoyNFrOH43qoQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTM5NDMzNw==", "bodyText": "please set as private", "url": "https://github.com/hortonworks/cloudbreak/pull/9503#discussion_r529394337", "createdAt": "2020-11-24T10:08:24Z", "author": {"login": "bergerdenes"}, "path": "core/src/main/java/com/sequenceiq/cloudbreak/core/flow2/externaldatabase/ExternalDatabaseService.java", "diffHunk": "@@ -87,20 +92,32 @@ public void startDatabase(Cluster cluster, DatabaseAvailabilityType externalData\n                 externalDatabase.name(), environment.getName(), cluster.getName());\n         String databaseCrn = cluster.getDatabaseServerCrn();\n         try {\n-            redbeamsClient.startByCrn(databaseCrn);\n-            waitAndGetDatabase(cluster, databaseCrn, DatabaseOperation.START, false);\n+            if (externalDatabaseReferenceExist(databaseCrn)) {\n+                redbeamsClient.startByCrn(databaseCrn);\n+                waitAndGetDatabase(cluster, databaseCrn, DatabaseOperation.START, false);\n+            } else {\n+                LOGGER.warn(\"[INVESTIGATE] The external database type was {} but there was no crn\", externalDatabase);\n+            }\n         } catch (NotFoundException notFoundException) {\n             LOGGER.info(\"Database server not found on redbeams side {}\", databaseCrn);\n         }\n     }\n \n+    public boolean externalDatabaseReferenceExist(String databaseCrn) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2e4f0ffaf2a9e3bef6196325599ccc92b11f57e8"}, "originalPosition": 40}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMyMDIzMzM1OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/com/sequenceiq/cloudbreak/core/flow2/externaldatabase/ExternalDatabaseService.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxMDoyMjoyN1rOH44uQQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxMDoyODo0MlrOH45NLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTQxMTY0OQ==", "bodyText": "Not sure if the MDCcontext is correct at these places, but if not then probably it would be better to include more information in the logs, like data hub name or crn.", "url": "https://github.com/hortonworks/cloudbreak/pull/9503#discussion_r529411649", "createdAt": "2020-11-24T10:22:27Z", "author": {"login": "keyki"}, "path": "core/src/main/java/com/sequenceiq/cloudbreak/core/flow2/externaldatabase/ExternalDatabaseService.java", "diffHunk": "@@ -99,13 +108,21 @@ public void stopDatabase(Cluster cluster, DatabaseAvailabilityType externalDatab\n                 externalDatabase.name(), environment.getName(), cluster.getName());\n         String databaseCrn = cluster.getDatabaseServerCrn();\n         try {\n-            redbeamsClient.stopByCrn(databaseCrn);\n-            waitAndGetDatabase(cluster, databaseCrn, DatabaseOperation.STOP, false);\n+            if (externalDatabaseReferenceExist(databaseCrn)) {\n+                redbeamsClient.stopByCrn(databaseCrn);\n+                waitAndGetDatabase(cluster, databaseCrn, DatabaseOperation.STOP, false);\n+            } else {\n+                LOGGER.warn(\"[INVESTIGATE] The external database type was {} but there was no crn\", externalDatabase);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "def8d4cde79f7e73b6f734e15afd739528d705f4"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTQxOTU2NA==", "bodyText": "it must be correct. we checked the logs and the information is there. I just want to highlight how many times it happened.", "url": "https://github.com/hortonworks/cloudbreak/pull/9503#discussion_r529419564", "createdAt": "2020-11-24T10:28:42Z", "author": {"login": "doktoric"}, "path": "core/src/main/java/com/sequenceiq/cloudbreak/core/flow2/externaldatabase/ExternalDatabaseService.java", "diffHunk": "@@ -99,13 +108,21 @@ public void stopDatabase(Cluster cluster, DatabaseAvailabilityType externalDatab\n                 externalDatabase.name(), environment.getName(), cluster.getName());\n         String databaseCrn = cluster.getDatabaseServerCrn();\n         try {\n-            redbeamsClient.stopByCrn(databaseCrn);\n-            waitAndGetDatabase(cluster, databaseCrn, DatabaseOperation.STOP, false);\n+            if (externalDatabaseReferenceExist(databaseCrn)) {\n+                redbeamsClient.stopByCrn(databaseCrn);\n+                waitAndGetDatabase(cluster, databaseCrn, DatabaseOperation.STOP, false);\n+            } else {\n+                LOGGER.warn(\"[INVESTIGATE] The external database type was {} but there was no crn\", externalDatabase);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTQxMTY0OQ=="}, "originalCommit": {"oid": "def8d4cde79f7e73b6f734e15afd739528d705f4"}, "originalPosition": 48}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3513, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}