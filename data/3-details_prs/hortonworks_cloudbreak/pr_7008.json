{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU5MDMyOTIw", "number": 7008, "title": "Cb 4931 DistroX and environment tests to their own package and remove provider specific code from tests", "bodyText": "e2e refactor, followup of #6925\nTests run locally for aws:\nclasses:\n- name: com.sequenceiq.it.cloudbreak.testcase.e2e.distrox.DistroXTest\n- name: com.sequenceiq.it.cloudbreak.testcase.e2e.distrox.DistroXBaseImageTests", "createdAt": "2020-01-03T15:49:08Z", "url": "https://github.com/hortonworks/cloudbreak/pull/7008", "merged": true, "mergeCommit": {"oid": "00dd11fca3071fa40a7713331e865518971213a3"}, "closed": true, "closedAt": "2020-01-08T22:05:16Z", "author": {"login": "gergopapi2"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb2wgFwABqjI5MjA1NTM0ODE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb4W3lpgFqTMzOTkzMDYxNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "bfde262ab339d391dc203ac0365d202a43226c0c", "author": {"user": {"login": "gergopapi2", "name": "Gergely Papp"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/bfde262ab339d391dc203ac0365d202a43226c0c", "committedDate": "2020-01-06T15:39:38Z", "message": "CB-4931 e2e tests: distrox and environment tests to distrox package and remove provider specific code"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM5ODg4MjM5", "url": "https://github.com/hortonworks/cloudbreak/pull/7008#pullrequestreview-339888239", "createdAt": "2020-01-08T14:12:17Z", "commit": {"oid": "bfde262ab339d391dc203ac0365d202a43226c0c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOFQxNDoxMjoxN1rOFbYCjQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOFQxNDoxMjoxN1rOFbYCjQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDI0OTc0MQ==", "bodyText": "would not be nicer to implement in CloudProvider a getInstanceTemplateV1Request which decorate  the request, instead of a switch case?", "url": "https://github.com/hortonworks/cloudbreak/pull/7008#discussion_r364249741", "createdAt": "2020-01-08T14:12:17Z", "author": {"login": "afarsang"}, "path": "integration-test/src/main/java/com/sequenceiq/it/cloudbreak/dto/distrox/instancegroup/DistroXInstanceGroupsBuilder.java", "diffHunk": "@@ -0,0 +1,72 @@\n+package com.sequenceiq.it.cloudbreak.dto.distrox.instancegroup;\n+\n+import static com.sequenceiq.it.cloudbreak.cloud.HostGroupType.COMPUTE;\n+import static com.sequenceiq.it.cloudbreak.cloud.HostGroupType.MASTER;\n+import static com.sequenceiq.it.cloudbreak.cloud.HostGroupType.WORKER;\n+import static com.sequenceiq.it.cloudbreak.dto.distrox.instancegroup.DistroXInstanceGroupTestDto.withHostGroup;\n+\n+import java.util.List;\n+import java.util.stream.Collectors;\n+\n+import org.apache.commons.lang3.NotImplementedException;\n+\n+import com.sequenceiq.cloudbreak.common.mappable.CloudPlatform;\n+import com.sequenceiq.common.api.type.EncryptionType;\n+import com.sequenceiq.distrox.api.v1.distrox.model.instancegroup.template.AwsEncryptionV1Parameters;\n+import com.sequenceiq.distrox.api.v1.distrox.model.instancegroup.template.AwsInstanceTemplateV1Parameters;\n+import com.sequenceiq.distrox.api.v1.distrox.model.instancegroup.template.InstanceTemplateV1Request;\n+import com.sequenceiq.it.cloudbreak.context.TestContext;\n+\n+public class DistroXInstanceGroupsBuilder {\n+\n+    private final TestContext testContext;\n+\n+    private List<DistroXInstanceGroupTestDto> distroXInstanceGroupTestDtoList;\n+\n+    public DistroXInstanceGroupsBuilder(TestContext testContext) {\n+        this.testContext = testContext;\n+    }\n+\n+    public DistroXInstanceGroupsBuilder defaultHostGroup() {\n+        distroXInstanceGroupTestDtoList = withHostGroup(testContext, MASTER, COMPUTE, WORKER);\n+        return this;\n+    }\n+\n+    public DistroXInstanceGroupsBuilder withDiskEncryption() {\n+        getInstanceTemplates().forEach(this::setInstanceTemplateV1Parameters);\n+        return this;\n+    }\n+\n+    public List<DistroXInstanceGroupTestDto> build() {\n+        return distroXInstanceGroupTestDtoList;\n+    }\n+\n+    private List<InstanceTemplateV1Request> getInstanceTemplates() {\n+        return distroXInstanceGroupTestDtoList.stream()\n+                .map(this::getInstanceTemplate)\n+                .collect(Collectors.toList());\n+    }\n+\n+    private InstanceTemplateV1Request getInstanceTemplate(DistroXInstanceGroupTestDto distroXInstanceGroupTestDto) {\n+        return distroXInstanceGroupTestDto.getRequest().getTemplate();\n+    }\n+\n+    private void setInstanceTemplateV1Parameters(InstanceTemplateV1Request instanceTemplateV1Request) {\n+        CloudPlatform cloudPlatform = testContext.getCloudProvider().getCloudPlatform();\n+        switch (cloudPlatform) {\n+            case AWS:\n+                instanceTemplateV1Request.setAws(getAwsInstanceTemplateV1Parameters());\n+                break;\n+            default:\n+                throw new NotImplementedException(String.format(\"Not implemented on cloudPlatform %s\", cloudPlatform));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bfde262ab339d391dc203ac0365d202a43226c0c"}, "originalPosition": 61}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "37fab73743e1cfc937e436d56de4ddb25abfebe7", "author": {"user": {"login": "gergopapi2", "name": "Gergely Papp"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/37fab73743e1cfc937e436d56de4ddb25abfebe7", "committedDate": "2020-01-08T15:08:05Z", "message": "CB-4931 e2e tests: distrox and environment tests to their own package and remove provider specific code"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bfde262ab339d391dc203ac0365d202a43226c0c", "author": {"user": {"login": "gergopapi2", "name": "Gergely Papp"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/bfde262ab339d391dc203ac0365d202a43226c0c", "committedDate": "2020-01-06T15:39:38Z", "message": "CB-4931 e2e tests: distrox and environment tests to distrox package and remove provider specific code"}, "afterCommit": {"oid": "37fab73743e1cfc937e436d56de4ddb25abfebe7", "author": {"user": {"login": "gergopapi2", "name": "Gergely Papp"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/37fab73743e1cfc937e436d56de4ddb25abfebe7", "committedDate": "2020-01-08T15:08:05Z", "message": "CB-4931 e2e tests: distrox and environment tests to their own package and remove provider specific code"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM5OTMwNjE3", "url": "https://github.com/hortonworks/cloudbreak/pull/7008#pullrequestreview-339930617", "createdAt": "2020-01-08T15:13:19Z", "commit": {"oid": "37fab73743e1cfc937e436d56de4ddb25abfebe7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2005, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}