{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE5NzU3MTE4", "number": 9416, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxNTo0NDowOVrOE5jDEQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxNTo0ODowMlrOE5jLnA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI4Nzc4NTEzOnYy", "diffSide": "RIGHT", "path": "integration-test/src/main/java/com/sequenceiq/it/cloudbreak/dto/clustertemplate/DistroXTemplateTestDto.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxNTo0NDowOVrOH0Esig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxNjo1NDozNVrOH0IAyA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDM2NDkzOA==", "bodyText": "Wouldn't be possible to has this withGatewayPort() call in the MockCloudProvider class only? I guess other providers will work without it.", "url": "https://github.com/hortonworks/cloudbreak/pull/9416#discussion_r524364938", "createdAt": "2020-11-16T15:44:09Z", "author": {"login": "afarsang"}, "path": "integration-test/src/main/java/com/sequenceiq/it/cloudbreak/dto/clustertemplate/DistroXTemplateTestDto.java", "diffHunk": "@@ -44,7 +43,8 @@ public DistroXTemplateTestDto valid() {\n         return withName(getResourcePropertyProvider().getName(getCloudPlatform()))\n                 .withEnvironmentName(getTestContext().get(EnvironmentTestDto.class).getName())\n                 .withCluster(getTestContext().init(ClusterTestDto.class).getRequest())\n-                .withInstanceGroups(getTestContext().init(InstanceGroupTestDto.class).getRequest());\n+                .withInstanceGroups(getTestContext().init(InstanceGroupTestDto.class).getRequest())\n+                .withGatewayPort(getCloudProvider().gatewayPort(this));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1a7cd51bf8de033b18494304502a54739aff5261"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDQxOTI3Mg==", "bodyText": "Maybe you are right. I don't think about this yet. If the test doesn't need this, I will remove this part as well", "url": "https://github.com/hortonworks/cloudbreak/pull/9416#discussion_r524419272", "createdAt": "2020-11-16T16:54:35Z", "author": {"login": "topolyai5"}, "path": "integration-test/src/main/java/com/sequenceiq/it/cloudbreak/dto/clustertemplate/DistroXTemplateTestDto.java", "diffHunk": "@@ -44,7 +43,8 @@ public DistroXTemplateTestDto valid() {\n         return withName(getResourcePropertyProvider().getName(getCloudPlatform()))\n                 .withEnvironmentName(getTestContext().get(EnvironmentTestDto.class).getName())\n                 .withCluster(getTestContext().init(ClusterTestDto.class).getRequest())\n-                .withInstanceGroups(getTestContext().init(InstanceGroupTestDto.class).getRequest());\n+                .withInstanceGroups(getTestContext().init(InstanceGroupTestDto.class).getRequest())\n+                .withGatewayPort(getCloudProvider().gatewayPort(this));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDM2NDkzOA=="}, "originalCommit": {"oid": "1a7cd51bf8de033b18494304502a54739aff5261"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI4Nzc5MzM1OnYy", "diffSide": "RIGHT", "path": "integration-test/src/main/java/com/sequenceiq/it/cloudbreak/dto/mock/answer/AbstractRequestHandler.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxNTo0NTozNVrOH0ExSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxNjo1MTozM1rOH0H37A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDM2NjE1NA==", "bodyText": "This comment seems unnecessary", "url": "https://github.com/hortonworks/cloudbreak/pull/9416#discussion_r524366154", "createdAt": "2020-11-16T15:45:35Z", "author": {"login": "afarsang"}, "path": "integration-test/src/main/java/com/sequenceiq/it/cloudbreak/dto/mock/answer/AbstractRequestHandler.java", "diffHunk": "@@ -54,7 +52,8 @@ public HttpMock getMock() {\n     }\n \n     public HttpMock clearDefinedResponses() {\n-        mock.getDynamicRouteStack().clear(method.getHttpMethod(), path);\n+//        mock.getDynamicRouteStack().clear(method.getHttpMethod(), path);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1a7cd51bf8de033b18494304502a54739aff5261"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDQxNzAwNA==", "bodyText": "I don't know yet. When I will refactor the verification part, I will decide that if need or not. I need to broke to more parts because it would be a gigantosaurus PR", "url": "https://github.com/hortonworks/cloudbreak/pull/9416#discussion_r524417004", "createdAt": "2020-11-16T16:51:33Z", "author": {"login": "topolyai5"}, "path": "integration-test/src/main/java/com/sequenceiq/it/cloudbreak/dto/mock/answer/AbstractRequestHandler.java", "diffHunk": "@@ -54,7 +52,8 @@ public HttpMock getMock() {\n     }\n \n     public HttpMock clearDefinedResponses() {\n-        mock.getDynamicRouteStack().clear(method.getHttpMethod(), path);\n+//        mock.getDynamicRouteStack().clear(method.getHttpMethod(), path);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDM2NjE1NA=="}, "originalCommit": {"oid": "1a7cd51bf8de033b18494304502a54739aff5261"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI4Nzc5NzAyOnYy", "diffSide": "RIGHT", "path": "integration-test/src/main/java/com/sequenceiq/it/cloudbreak/dto/mock/answer/AbstractRequestWithBodyHandler.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxNTo0NjoxMVrOH0EzcA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxNTo0NjoxMVrOH0EzcA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDM2NjcwNA==", "bodyText": "Do we need this?", "url": "https://github.com/hortonworks/cloudbreak/pull/9416#discussion_r524366704", "createdAt": "2020-11-16T15:46:11Z", "author": {"login": "afarsang"}, "path": "integration-test/src/main/java/com/sequenceiq/it/cloudbreak/dto/mock/answer/AbstractRequestWithBodyHandler.java", "diffHunk": "@@ -25,20 +22,17 @@\n     }\n \n     public HttpMock thenReturn(GenericRequestResponse<S, T> genericResponse) {\n-        S handle = genericResponse.handle(null, null, null);\n+        S handle = genericResponse.handle(null, null);\n         executeQuery().executeConfigure(getPath(), pathVariables(), new MockResponse(handle, getMethod().getHttpMethod().name(), getPath()));\n         return getMock();\n     }\n \n-    abstract T prepareRequestInstance(spark.Request request);\n+//    abstract T prepareRequestInstance(spark.Request request);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1a7cd51bf8de033b18494304502a54739aff5261"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI4NzgwNzAwOnYy", "diffSide": "RIGHT", "path": "integration-test/src/main/java/com/sequenceiq/it/cloudbreak/dto/mock/answer/JsonRequestAnswer.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxNTo0ODowMlrOH0E5Ug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxNTo0ODowMlrOH0E5Ug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDM2ODIxMA==", "bodyText": "This is commented out in many place. If it works without it I'll assume it can be deleted", "url": "https://github.com/hortonworks/cloudbreak/pull/9416#discussion_r524368210", "createdAt": "2020-11-16T15:48:02Z", "author": {"login": "afarsang"}, "path": "integration-test/src/main/java/com/sequenceiq/it/cloudbreak/dto/mock/answer/JsonRequestAnswer.java", "diffHunk": "@@ -1,33 +1,27 @@\n package com.sequenceiq.it.cloudbreak.dto.mock.answer;\n \n-import java.io.IOException;\n-\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n \n import com.fasterxml.jackson.databind.JsonNode;\n-import com.sequenceiq.cloudbreak.common.json.JsonUtil;\n import com.sequenceiq.it.cloudbreak.dto.mock.HttpMock;\n import com.sequenceiq.it.cloudbreak.dto.mock.Method;\n-import com.sequenceiq.it.cloudbreak.exception.TestFailException;\n import com.sequenceiq.it.cloudbreak.mock.ExecuteQueryToMockInfrastructure;\n \n-import spark.Request;\n-\n public class JsonRequestAnswer<S> extends AbstractRequestWithBodyHandler<S, JsonNode, JsonRequestAnswer<S>> {\n     private static final Logger LOGGER = LoggerFactory.getLogger(JsonRequestAnswer.class);\n \n     public JsonRequestAnswer(Method method, String path, Class<String> requestType, HttpMock mock, ExecuteQueryToMockInfrastructure executeQuery) {\n         super(method, path, JsonNode.class, mock, executeQuery);\n     }\n \n-    @Override\n-    JsonNode prepareRequestInstance(Request request) {\n-        try {\n-            return JsonUtil.readTree(request.body());\n-        } catch (IOException e) {\n-            LOGGER.error(\"Could not parse json from request body\", e);\n-            throw new TestFailException(\"Could not parse json from request body\", e);\n-        }\n-    }\n+//    @Override\n+//    JsonNode prepareRequestInstance(Request request) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1a7cd51bf8de033b18494304502a54739aff5261"}, "originalPosition": 34}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3580, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}