{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYyODUzNzE2", "number": 8709, "title": "CB-8213 [ASRG] dl and dh might leak resources in case of provisioning\u2026", "bodyText": "\u2026 error\nIn case datalake of datahub is provisioned but some error comes up during stack provisioning then the created cloud resources might not be persisted into cloudbreak resources table. This leads to resource leakage in the azure single RG use case during deletion.\nSee detailed description in the commit message.", "createdAt": "2020-08-04T15:50:20Z", "url": "https://github.com/hortonworks/cloudbreak/pull/8709", "merged": true, "mergeCommit": {"oid": "d14eab243de6d84165a81ed2122af32e1e72b7e2"}, "closed": true, "closedAt": "2020-08-06T14:44:33Z", "author": {"login": "gergopapi2"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc75CfBgBqjM2MjQxMzEzMDg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc8KTfugFqTQ2MjIzNzE1MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a3b19bc0f1f6234152cd1944d8771d0caf4639c7", "author": {"user": {"login": "gergopapi2", "name": "Gergely Papp"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/a3b19bc0f1f6234152cd1944d8771d0caf4639c7", "committedDate": "2020-08-04T13:10:38Z", "message": "CB-8213 [ASRG] dl and dh might leak resources in case of provisioning error\n\nIn case datalake of datahub is provisioned but some error comes up during stack provisioning then the created cloud resources might not be persisted into cloudbreak resources table. This leads to resource leakage in the azure single RG use case during deletion."}, "afterCommit": {"oid": "f9e69d5ca2183a7c7a2faa35c7704aa577a24a1c", "author": {"user": {"login": "gergopapi2", "name": "Gergely Papp"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/f9e69d5ca2183a7c7a2faa35c7704aa577a24a1c", "committedDate": "2020-08-05T10:54:22Z", "message": "CB-8213 [ASRG] dl and dh might leak resources in case of provisioning error\n\nIn case datalake of datahub is provisioned but some error comes up during stack provisioning then the created cloud resources might not be persisted into cloudbreak resources table. This leads to resource leakage in the azure single RG use case during deletion."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxODE3OTY2", "url": "https://github.com/hortonworks/cloudbreak/pull/8709#pullrequestreview-461817966", "createdAt": "2020-08-05T16:15:03Z", "commit": {"oid": "f9e69d5ca2183a7c7a2faa35c7704aa577a24a1c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxNjoxNTowM1rOG8Qz7Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxNjoxNTowM1rOG8Qz7Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTg0MzE4MQ==", "bodyText": "We should add log messages to this method about what's happening.", "url": "https://github.com/hortonworks/cloudbreak/pull/8709#discussion_r465843181", "createdAt": "2020-08-05T16:15:03Z", "author": {"login": "keyki"}, "path": "cloud-azure/src/main/java/com/sequenceiq/cloudbreak/cloud/azure/AzureResourceConnector.java", "diffHunk": "@@ -141,6 +141,24 @@\n         return resources;\n     }\n \n+    private List<CloudResource> persistCloudResources(\n+            AuthenticatedContext ac, CloudStack stack, PersistenceNotifier notifier, CloudContext cloudContext, String stackName,\n+            String resourceGroupName, Deployment templateDeployment) {\n+        List<CloudResource> allResourcesToPersist = new ArrayList<>();\n+        List<CloudResource> instances;\n+        try {\n+            List<CloudResource> templateResources = azureCloudResourceService.getDeploymentCloudResources(templateDeployment);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f9e69d5ca2183a7c7a2faa35c7704aa577a24a1c"}, "originalPosition": 62}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7d888dada682309f290f69d0f08625c8e8266f6c", "author": {"user": {"login": "gergopapi2", "name": "Gergely Papp"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/7d888dada682309f290f69d0f08625c8e8266f6c", "committedDate": "2020-08-06T06:45:43Z", "message": "CB-8213 [ASRG] dl and dh might leak resources in case of provisioning error\n\nIn case datalake or datahub is provisioned but some error comes up during stack provisioning then the created cloud resources might not be persisted into cloudbreak resources table. This leads to resource leakage in the azure single RG use case during deletion."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f9e69d5ca2183a7c7a2faa35c7704aa577a24a1c", "author": {"user": {"login": "gergopapi2", "name": "Gergely Papp"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/f9e69d5ca2183a7c7a2faa35c7704aa577a24a1c", "committedDate": "2020-08-05T10:54:22Z", "message": "CB-8213 [ASRG] dl and dh might leak resources in case of provisioning error\n\nIn case datalake of datahub is provisioned but some error comes up during stack provisioning then the created cloud resources might not be persisted into cloudbreak resources table. This leads to resource leakage in the azure single RG use case during deletion."}, "afterCommit": {"oid": "7d888dada682309f290f69d0f08625c8e8266f6c", "author": {"user": {"login": "gergopapi2", "name": "Gergely Papp"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/7d888dada682309f290f69d0f08625c8e8266f6c", "committedDate": "2020-08-06T06:45:43Z", "message": "CB-8213 [ASRG] dl and dh might leak resources in case of provisioning error\n\nIn case datalake or datahub is provisioned but some error comes up during stack provisioning then the created cloud resources might not be persisted into cloudbreak resources table. This leads to resource leakage in the azure single RG use case during deletion."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyMjM3MTUw", "url": "https://github.com/hortonworks/cloudbreak/pull/8709#pullrequestreview-462237150", "createdAt": "2020-08-06T07:01:53Z", "commit": {"oid": "7d888dada682309f290f69d0f08625c8e8266f6c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2545, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}