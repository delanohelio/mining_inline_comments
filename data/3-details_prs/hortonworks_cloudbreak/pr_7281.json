{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc0ODgwMzk2", "number": 7281, "title": "CB-4502 Consolidate DistroX/SDX/FreeIPA/RDS tagging", "bodyText": "", "createdAt": "2020-02-13T13:53:20Z", "url": "https://github.com/hortonworks/cloudbreak/pull/7281", "merged": true, "mergeCommit": {"oid": "99b76ef8669d91a470802aa312b0e1bc19e73309"}, "closed": true, "closedAt": "2020-02-17T11:16:55Z", "author": {"login": "doktoric"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcD7UqCgBqjMwMzQ5MzUzNjQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcFJeIxAFqTM1OTU3MTkxMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "39d65a84088c9646951c2127a5099de19dfe1e96", "author": {"user": {"login": "doktoric", "name": "Richard Doktorics"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/39d65a84088c9646951c2127a5099de19dfe1e96", "committedDate": "2020-02-13T13:52:38Z", "message": "CB-4502 Consolidate DistroX/SDX/FreeIPA/RDS tagging"}, "afterCommit": {"oid": "3ae7bede954bc94a50c6dfbdb180f493e574534c", "author": {"user": {"login": "doktoric", "name": "Richard Doktorics"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/3ae7bede954bc94a50c6dfbdb180f493e574534c", "committedDate": "2020-02-13T13:54:25Z", "message": "CB-4502 Consolidate DistroX/SDX/FreeIPA/RDS tagging"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3ae7bede954bc94a50c6dfbdb180f493e574534c", "author": {"user": {"login": "doktoric", "name": "Richard Doktorics"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/3ae7bede954bc94a50c6dfbdb180f493e574534c", "committedDate": "2020-02-13T13:54:25Z", "message": "CB-4502 Consolidate DistroX/SDX/FreeIPA/RDS tagging"}, "afterCommit": {"oid": "0e99f5f3de06f51c7f1a71a9fa4091660f848304", "author": {"user": {"login": "doktoric", "name": "Richard Doktorics"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/0e99f5f3de06f51c7f1a71a9fa4091660f848304", "committedDate": "2020-02-13T13:55:59Z", "message": "CB-4502 Consolidate DistroX/SDX/FreeIPA/RDS tagging"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0e99f5f3de06f51c7f1a71a9fa4091660f848304", "author": {"user": {"login": "doktoric", "name": "Richard Doktorics"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/0e99f5f3de06f51c7f1a71a9fa4091660f848304", "committedDate": "2020-02-13T13:55:59Z", "message": "CB-4502 Consolidate DistroX/SDX/FreeIPA/RDS tagging"}, "afterCommit": {"oid": "751901f99ea6e091133dbdffea952b65189c9974", "author": {"user": {"login": "doktoric", "name": "Richard Doktorics"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/751901f99ea6e091133dbdffea952b65189c9974", "committedDate": "2020-02-14T09:07:01Z", "message": "CB-4502 Consolidate DistroX/SDX/FreeIPA/RDS tagging"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU4OTAwMTg3", "url": "https://github.com/hortonworks/cloudbreak/pull/7281#pullrequestreview-358900187", "createdAt": "2020-02-14T12:12:13Z", "commit": {"oid": "0e99f5f3de06f51c7f1a71a9fa4091660f848304"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQxMjoxNDowMFrOFp0vTw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQxMjoxODo1NVrOFp02QA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTQwMDAxNQ==", "bodyText": "Is it only used in case of Azure?", "url": "https://github.com/hortonworks/cloudbreak/pull/7281#discussion_r379400015", "createdAt": "2020-02-14T12:14:00Z", "author": {"login": "biharitomi"}, "path": "environment/src/main/java/com/sequenceiq/environment/environment/dto/EnvironmentDtoConverter.java", "diffHunk": "@@ -99,11 +121,39 @@ public LocationDto environmentToLocationDto(Environment environment) {\n                 .build();\n     }\n \n+    private String getUserFromCrn(String crn) {\n+        return Optional.ofNullable(Crn.fromString(crn)).map(Crn::getUserId).orElse(null);\n+    }\n+\n     private SecurityAccessDto environmentToSecurityAccessDto(Environment environment) {\n         return SecurityAccessDto.builder()\n                 .withCidr(environment.getCidr())\n                 .withSecurityGroupIdForKnox(environment.getSecurityGroupIdForKnox())\n                 .withDefaultSecurityGroupId(environment.getDefaultSecurityGroupId())\n                 .build();\n     }\n+\n+    private Json getTags(EnvironmentCreationDto creationDto) {\n+        boolean internalTenant = entitlementService.internalTenant(creationDto.getCreator(), creationDto.getAccountId());\n+        CDPTagGenerationRequest request = CDPTagGenerationRequest.Builder.builder()\n+                .withCreatorCrn(creationDto.getCreator())\n+                .withEnvironmentCrn(creationDto.getCrn())\n+                .withAccountId(creationDto.getAccountId())\n+                .withPlatform(CloudConstants.AZURE)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "751901f99ea6e091133dbdffea952b65189c9974"}, "originalPosition": 91}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTQwMDQ1Ng==", "bodyText": "The getUserCrn method should be used here for getting user's crn.", "url": "https://github.com/hortonworks/cloudbreak/pull/7281#discussion_r379400456", "createdAt": "2020-02-14T12:15:09Z", "author": {"login": "biharitomi"}, "path": "environment/src/main/java/com/sequenceiq/environment/environment/v1/EnvironmentApiConverter.java", "diffHunk": "@@ -112,6 +117,8 @@ public EnvironmentCreationDto initCreationDto(EnvironmentRequest request) {\n                 .withRegions(request.getRegions())\n                 .withAuthentication(authenticationRequestToDto(request.getAuthentication()))\n                 .withAdminGroupName(request.getAdminGroupName())\n+                .withTags(request.getTags())\n+                .withCrn(createCrn(ThreadBasedUserCrnProvider.getAccountId()))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "751901f99ea6e091133dbdffea952b65189c9974"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTQwMTc5Mg==", "bodyText": "I sow a similar method, maybe we should create a dedicated factory or constructor for creating this object from EnvironmentDto.", "url": "https://github.com/hortonworks/cloudbreak/pull/7281#discussion_r379401792", "createdAt": "2020-02-14T12:18:55Z", "author": {"login": "biharitomi"}, "path": "environment/src/main/java/com/sequenceiq/environment/network/service/NetworkCreationRequestFactory.java", "diffHunk": "@@ -70,4 +77,13 @@ private boolean getPrivateSubnetEnabled(EnvironmentDto environmentDto) {\n     private String getUserFromCrn(String crn) {\n         return Optional.ofNullable(Crn.fromString(crn)).map(Crn::getUserId).orElse(null);\n     }\n+\n+    private CDPTagMergeRequest cdpTagMergeRequest(EnvironmentDto environmentDto) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "751901f99ea6e091133dbdffea952b65189c9974"}, "originalPosition": 38}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "751901f99ea6e091133dbdffea952b65189c9974", "author": {"user": {"login": "doktoric", "name": "Richard Doktorics"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/751901f99ea6e091133dbdffea952b65189c9974", "committedDate": "2020-02-14T09:07:01Z", "message": "CB-4502 Consolidate DistroX/SDX/FreeIPA/RDS tagging"}, "afterCommit": {"oid": "abd61da2297c58bfdb4cad459245759310dc17ba", "author": {"user": {"login": "doktoric", "name": "Richard Doktorics"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/abd61da2297c58bfdb4cad459245759310dc17ba", "committedDate": "2020-02-14T13:06:22Z", "message": "CB-4502 Consolidate DistroX/SDX/FreeIPA/RDS tagging"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d32bb1058a8ad97def19b318c679d1925e4351d6", "author": {"user": {"login": "doktoric", "name": "Richard Doktorics"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/d32bb1058a8ad97def19b318c679d1925e4351d6", "committedDate": "2020-02-17T08:06:54Z", "message": "CB-4502 Consolidate DistroX/SDX/FreeIPA/RDS tagging"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "abd61da2297c58bfdb4cad459245759310dc17ba", "author": {"user": {"login": "doktoric", "name": "Richard Doktorics"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/abd61da2297c58bfdb4cad459245759310dc17ba", "committedDate": "2020-02-14T13:06:22Z", "message": "CB-4502 Consolidate DistroX/SDX/FreeIPA/RDS tagging"}, "afterCommit": {"oid": "d32bb1058a8ad97def19b318c679d1925e4351d6", "author": {"user": {"login": "doktoric", "name": "Richard Doktorics"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/d32bb1058a8ad97def19b318c679d1925e4351d6", "committedDate": "2020-02-17T08:06:54Z", "message": "CB-4502 Consolidate DistroX/SDX/FreeIPA/RDS tagging"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5NTcxOTEx", "url": "https://github.com/hortonworks/cloudbreak/pull/7281#pullrequestreview-359571911", "createdAt": "2020-02-17T08:57:46Z", "commit": {"oid": "d32bb1058a8ad97def19b318c679d1925e4351d6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1867, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}