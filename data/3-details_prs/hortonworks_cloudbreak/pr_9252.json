{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA2OTQ4NzE3", "number": 9252, "title": "CB-9392. Add default annymization rule for CDP hashed password & refactor default rule loading", "bodyText": "See detailed description in the commit message\nadd a default anonymization rule for cdp hashed password", "createdAt": "2020-10-20T16:38:21Z", "url": "https://github.com/hortonworks/cloudbreak/pull/9252", "merged": true, "mergeCommit": {"oid": "fa48f57f3d7ca7bfbc73f198cf2a1a3a0df0b3be"}, "closed": true, "closedAt": "2020-10-28T12:24:09Z", "author": {"login": "oleewere"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdUcLXygBqjM4OTk5NDEyMTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdW7tJkgFqTUxODU1NDk5MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8652f20c7fa757fad397cd814b1315f167031d4e", "author": {"user": {"login": "oleewere", "name": "Oliv\u00e9r Szabo"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/8652f20c7fa757fad397cd814b1315f167031d4e", "committedDate": "2020-10-20T16:36:19Z", "message": "CB-9392. Hide CDP password hashes by default in ipa logs."}, "afterCommit": {"oid": "2f25a694ae9610bc79e20e212251a49a82c3e4b4", "author": {"user": {"login": "oleewere", "name": "Oliv\u00e9r Szabo"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/2f25a694ae9610bc79e20e212251a49a82c3e4b4", "committedDate": "2020-10-20T17:25:08Z", "message": "CB-9392. Hide CDP password hashes by default in ipa logs."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2f25a694ae9610bc79e20e212251a49a82c3e4b4", "author": {"user": {"login": "oleewere", "name": "Oliv\u00e9r Szabo"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/2f25a694ae9610bc79e20e212251a49a82c3e4b4", "committedDate": "2020-10-20T17:25:08Z", "message": "CB-9392. Hide CDP password hashes by default in ipa logs."}, "afterCommit": {"oid": "260282c2433a40c7065a9ca3b260c2f11a482e84", "author": {"user": {"login": "oleewere", "name": "Oliv\u00e9r Szabo"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/260282c2433a40c7065a9ca3b260c2f11a482e84", "committedDate": "2020-10-22T13:38:26Z", "message": "CB-9392. Add default annymization rule for CDP hashed password & refactor default rule loading"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2NjY2NTAy", "url": "https://github.com/hortonworks/cloudbreak/pull/9252#pullrequestreview-516666502", "createdAt": "2020-10-26T11:01:08Z", "commit": {"oid": "260282c2433a40c7065a9ca3b260c2f11a482e84"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxMTowMTowOVrOHoKfsA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxMTowMTowOVrOHoKfsA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTg3NzA0MA==", "bodyText": "I think we won't notice this issue when something is wrong if we let the app start", "url": "https://github.com/hortonworks/cloudbreak/pull/9252#discussion_r511877040", "createdAt": "2020-10-26T11:01:09Z", "author": {"login": "lacikaaa"}, "path": "environment/src/main/java/com/sequenceiq/environment/telemetry/service/AccountTelemetryService.java", "diffHunk": "@@ -28,28 +38,25 @@\n \n     private static final Logger LOGGER = LoggerFactory.getLogger(AccountTelemetryService.class);\n \n-    private static final String EMAIL_PATTERN = \"\\\\b([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9\\\\-\\\\._]\" +\n-            \"*[A-Za-z0-9])@(([A-Za-z0-9]|[A-Za-z][A-Za-z0-9\\\\-]*[A-Za-z0-9])\\\\.)+([A-Za-z0-9]\" +\n-            \"|[A-Za-z0-9][A-Za-z0-9\\\\-]*[A-Za-z0-9])\\\\b\";\n-\n-    private static final String EMAIL_REPLACEMENT = \"email@redacted.host\";\n-\n-    private static final String CREDIT_CARD_PATTERN = \"\\\\d{4}[^\\\\w]\\\\d{4}[^\\\\w]\\\\d{4}[^\\\\w]\\\\d{4}\";\n-\n-    private static final String CREDIT_CARD_REPLACEMENT = \"XXXX-XXXX-XXXX-XXXX\";\n-\n-    private static final String SSN_PATTERN = \"\\\\d{3}[^\\\\w]\\\\d{2}[^\\\\w]\\\\d{4}\";\n-\n-    private static final String SSN_REPLACEMENT = \"XXX-XX-XXXX\";\n-\n-    private static final String FREEIPA_PWD_PATTERN = \"FPW\\\\:\\\\s+[\\\\w|\\\\W].*\";\n+    private final AccountTelemetryRepository accountTelemetryRepository;\n \n-    private static final String FREEIPA_PWD_REPLACEMENT = \"FPW: [REDACTED]\";\n+    private final String rulesFileLocation;\n \n-    private final AccountTelemetryRepository accountTelemetryRepository;\n+    private List<AnonymizationRule> defaultRules = new ArrayList<>();\n \n-    public AccountTelemetryService(AccountTelemetryRepository accountTelemetryRepository) {\n+    public AccountTelemetryService(AccountTelemetryRepository accountTelemetryRepository,\n+            @Value(\"${environment.telemetry.default.rules.file:telemetry/default-anonymization-rules.yaml\") String rulesFileLocation) {\n         this.accountTelemetryRepository = accountTelemetryRepository;\n+        this.rulesFileLocation = rulesFileLocation;\n+    }\n+\n+    @PostConstruct\n+    public void init() {\n+        try {\n+            defaultRules = loadAnonymizationRules();\n+        } catch (IOException e) {\n+            LOGGER.error(\"Error during loading default anonymization rules.\", e);\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "260282c2433a40c7065a9ca3b260c2f11a482e84"}, "originalPosition": 67}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2NjY4NTU1", "url": "https://github.com/hortonworks/cloudbreak/pull/9252#pullrequestreview-516668555", "createdAt": "2020-10-26T11:03:51Z", "commit": {"oid": "260282c2433a40c7065a9ca3b260c2f11a482e84"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxMTowMzo1MVrOHoKlPg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxMTowMzo1MVrOHoKlPg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTg3ODQ2Mg==", "bodyText": "we should test the same file we use in prod, and not a different one.", "url": "https://github.com/hortonworks/cloudbreak/pull/9252#discussion_r511878462", "createdAt": "2020-10-26T11:03:51Z", "author": {"login": "lacikaaa"}, "path": "environment/src/test/resources/default-anonymization-rules.yaml", "diffHunk": "@@ -0,0 +1,10 @@\n+- pattern: \\b([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9\\-\\._]*[A-Za-z0-9])@(([A-Za-z0-9]|[A-Za-z][A-Za-z0-9\\-]*[A-Za-z0-9])\\.)+([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9\\-]*[A-Za-z0-9])\\b\n+  replacement: \"email@redacted.host\"\n+- pattern: \\d{4}[^\\w]\\d{4}[^\\w]\\d{4}[^\\w]\\d{4}\n+  replacement: \"XXXX-XXXX-XXXX-XXXX\"\n+- pattern: \\d{3}[^\\w]\\d{2}[^\\w]\\d{4}\n+  replacement: \"XXX-XX-XXXX\"\n+- pattern: FPW\\:\\s+[\\w|\\W].*\n+  replacement: \"FPW: [REDACTED]\"\n+- pattern: cdpHashedPassword=.*[']\n+  replacement: \"[CDP PWD ATTRS REDACTED]\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "260282c2433a40c7065a9ca3b260c2f11a482e84"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2Njc0ODQy", "url": "https://github.com/hortonworks/cloudbreak/pull/9252#pullrequestreview-516674842", "createdAt": "2020-10-26T11:13:02Z", "commit": {"oid": "260282c2433a40c7065a9ca3b260c2f11a482e84"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxMToxMzowMlrOHoK4Pw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxMToxMzowMlrOHoK4Pw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTg4MzMyNw==", "bodyText": "instead of reading the file manually, wouldn't be it better if we would use spring for this? like in InstanceMetadataUpdater we use it for reading the packages info.", "url": "https://github.com/hortonworks/cloudbreak/pull/9252#discussion_r511883327", "createdAt": "2020-10-26T11:13:02Z", "author": {"login": "lacikaaa"}, "path": "environment/src/main/java/com/sequenceiq/environment/telemetry/service/AccountTelemetryService.java", "diffHunk": "@@ -190,4 +178,26 @@ private String createCRN(String accountId) {\n                 .build()\n                 .toString();\n     }\n+\n+    private List<AnonymizationRule> loadAnonymizationRules() throws IOException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "260282c2433a40c7065a9ca3b260c2f11a482e84"}, "originalPosition": 122}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2Njc1NDQ2", "url": "https://github.com/hortonworks/cloudbreak/pull/9252#pullrequestreview-516675446", "createdAt": "2020-10-26T11:13:57Z", "commit": {"oid": "260282c2433a40c7065a9ca3b260c2f11a482e84"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxMToxMzo1N1rOHoK57w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxMToxMzo1N1rOHoK57w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTg4Mzc1OQ==", "bodyText": "unnecessary space as first char", "url": "https://github.com/hortonworks/cloudbreak/pull/9252#discussion_r511883759", "createdAt": "2020-10-26T11:13:57Z", "author": {"login": "lacikaaa"}, "path": "environment/src/main/resources/telemetry/default-anonymization-rules.yaml", "diffHunk": "@@ -0,0 +1,10 @@\n+- pattern: \\b([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9\\-\\._]*[A-Za-z0-9])@(([A-Za-z0-9]|[A-Za-z][A-Za-z0-9\\-]*[A-Za-z0-9])\\.)+([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9\\-]*[A-Za-z0-9])\\b\n+  replacement: \"email@redacted.host\"\n+- pattern: \\d{4}[^\\w]\\d{4}[^\\w]\\d{4}[^\\w]\\d{4}\n+  replacement: \"XXXX-XXXX-XXXX-XXXX\"\n+- pattern: \\d{3}[^\\w]\\d{2}[^\\w]\\d{4}\n+  replacement: \"XXX-XX-XXXX\"\n+- pattern: FPW\\:\\s+[\\w|\\W].*\n+  replacement: \"FPW: [REDACTED]\"\n+ - pattern: cdpHashedPassword=.*[']", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "260282c2433a40c7065a9ca3b260c2f11a482e84"}, "originalPosition": 9}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "260282c2433a40c7065a9ca3b260c2f11a482e84", "author": {"user": {"login": "oleewere", "name": "Oliv\u00e9r Szabo"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/260282c2433a40c7065a9ca3b260c2f11a482e84", "committedDate": "2020-10-22T13:38:26Z", "message": "CB-9392. Add default annymization rule for CDP hashed password & refactor default rule loading"}, "afterCommit": {"oid": "83bbde7a33a5aa8479394b51a4fd72ea958ba5d1", "author": {"user": {"login": "oleewere", "name": "Oliv\u00e9r Szabo"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/83bbde7a33a5aa8479394b51a4fd72ea958ba5d1", "committedDate": "2020-10-27T15:11:50Z", "message": "CB-9392. Add default annymization rule for CDP hashed password & refactor default rule loading\n- include rule definitions in environment application.yml"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4NDQ4MTc0", "url": "https://github.com/hortonworks/cloudbreak/pull/9252#pullrequestreview-518448174", "createdAt": "2020-10-28T09:05:53Z", "commit": {"oid": "83bbde7a33a5aa8479394b51a4fd72ea958ba5d1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQwOTowNTo1M1rOHpgJUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQwOTowNTo1M1rOHpgJUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI4MDMzOA==", "bodyText": "the main purpose of @Configuration is to indicate the class declares Beans\nI think here we should go with @Component", "url": "https://github.com/hortonworks/cloudbreak/pull/9252#discussion_r513280338", "createdAt": "2020-10-28T09:05:53Z", "author": {"login": "lacikaaa"}, "path": "environment/src/main/java/com/sequenceiq/environment/configuration/telemetry/AccountTelemetryConfig.java", "diffHunk": "@@ -0,0 +1,24 @@\n+package com.sequenceiq.environment.configuration.telemetry;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import org.springframework.boot.context.properties.ConfigurationProperties;\n+import org.springframework.context.annotation.Configuration;\n+\n+import com.sequenceiq.common.api.telemetry.model.AnonymizationRule;\n+\n+@Configuration", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "83bbde7a33a5aa8479394b51a4fd72ea958ba5d1"}, "originalPosition": 11}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8613d8dd4ff1916749aa0ae10b3a9d290edbb75a", "author": {"user": {"login": "oleewere", "name": "Oliv\u00e9r Szabo"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/8613d8dd4ff1916749aa0ae10b3a9d290edbb75a", "committedDate": "2020-10-28T11:14:09Z", "message": "CB-9392. Add default annymization rule for CDP hashed password & refactor default rule loading\n- include rule definitions in environment application.yml"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "83bbde7a33a5aa8479394b51a4fd72ea958ba5d1", "author": {"user": {"login": "oleewere", "name": "Oliv\u00e9r Szabo"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/83bbde7a33a5aa8479394b51a4fd72ea958ba5d1", "committedDate": "2020-10-27T15:11:50Z", "message": "CB-9392. Add default annymization rule for CDP hashed password & refactor default rule loading\n- include rule definitions in environment application.yml"}, "afterCommit": {"oid": "8613d8dd4ff1916749aa0ae10b3a9d290edbb75a", "author": {"user": {"login": "oleewere", "name": "Oliv\u00e9r Szabo"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/8613d8dd4ff1916749aa0ae10b3a9d290edbb75a", "committedDate": "2020-10-28T11:14:09Z", "message": "CB-9392. Add default annymization rule for CDP hashed password & refactor default rule loading\n- include rule definitions in environment application.yml"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4NTU0OTkw", "url": "https://github.com/hortonworks/cloudbreak/pull/9252#pullrequestreview-518554990", "createdAt": "2020-10-28T11:17:17Z", "commit": {"oid": "8613d8dd4ff1916749aa0ae10b3a9d290edbb75a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2031, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}