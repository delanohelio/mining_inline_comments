{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYwMzg5NzIw", "number": 8686, "title": "CB-8207: Add --region flag to aws s3 cp command for datalake backup/restore", "bodyText": "Closes CB-8207\n\nAdd aws_region pillar value\nAdd --region parameter to backup and restore script aws invocations\nAdd aws_region to the BackupRestoreSaltConfigGenerator\nUpdate test for BackupRestoreSaltConfigGenerator\nPass in Stack object to BackupRestoreSaltConfigGenerator\n\nTested by:\n\nRunning salt state.apply postgresql.disaster_recovery.bakup and state.apply postgresql.disaster_recovery.restore manually in Data Lake with external DB.\nTriggering backup + restore using the Datalake API while running with an external DB.", "createdAt": "2020-07-31T18:31:31Z", "url": "https://github.com/hortonworks/cloudbreak/pull/8686", "merged": true, "mergeCommit": {"oid": "1da2c85cddc386dfb34ba17800bfd71ec5259131"}, "closed": true, "closedAt": "2020-08-05T06:59:16Z", "author": {"login": "brycederriso"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc6YtfdABqjM2MDk3ODgzMDI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc71T3igFqTQ2MTM3NjUxOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ed7c56fe2a8d4afe4d3d05f72ec2ffaccbbb6d7c", "author": {"user": {"login": "brycederriso", "name": "Bryce"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/ed7c56fe2a8d4afe4d3d05f72ec2ffaccbbb6d7c", "committedDate": "2020-07-31T18:34:19Z", "message": "Actually pass the region value to salt scripts."}, "afterCommit": {"oid": "281cf6074eb338b5749ad0e45b41a3ba7e846034", "author": {"user": {"login": "brycederriso", "name": "Bryce"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/281cf6074eb338b5749ad0e45b41a3ba7e846034", "committedDate": "2020-07-31T18:40:29Z", "message": "Add --region flag to aws s3 cp command in backup scripts.\n\nAdd region option to aws restore."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU5NDA4MTM4", "url": "https://github.com/hortonworks/cloudbreak/pull/8686#pullrequestreview-459408138", "createdAt": "2020-07-31T19:24:54Z", "commit": {"oid": "281cf6074eb338b5749ad0e45b41a3ba7e846034"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQxOToyNDo1NFrOG6TgAA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQxOToyNDo1NFrOG6TgAA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzc5MDA4MA==", "bodyText": "When/where is this actually filled in with the region, if applicable?", "url": "https://github.com/hortonworks/cloudbreak/pull/8686#discussion_r463790080", "createdAt": "2020-07-31T19:24:54Z", "author": {"login": "hreeve-cloudera"}, "path": "orchestrator-salt/src/main/resources/salt/pillar/postgresql/disaster_recovery.sls", "diffHunk": "@@ -1,3 +1,4 @@\n disaster_recovery:\n   object_storage_url:\n+  aws_region: '' # empty string to prevent salt from passing the literal 'None'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "281cf6074eb338b5749ad0e45b41a3ba7e846034"}, "originalPosition": 3}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU5NTM5Mjg1", "url": "https://github.com/hortonworks/cloudbreak/pull/8686#pullrequestreview-459539285", "createdAt": "2020-08-01T01:29:51Z", "commit": {"oid": "281cf6074eb338b5749ad0e45b41a3ba7e846034"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wMVQwMToyOTo1MVrOG6abdA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wMVQwMToyOTo1MVrOG6abdA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzkwMzYwNA==", "bodyText": "you are defining a new pillar for this, right. Where is the application change that passes this information?", "url": "https://github.com/hortonworks/cloudbreak/pull/8686#discussion_r463903604", "createdAt": "2020-08-01T01:29:51Z", "author": {"login": "kkalvagadda1"}, "path": "orchestrator-salt/src/main/resources/salt/pillar/postgresql/disaster_recovery.sls", "diffHunk": "@@ -1,3 +1,4 @@\n disaster_recovery:\n   object_storage_url:\n+  aws_region: '' # empty string to prevent salt from passing the literal 'None'", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzc5MDA4MA=="}, "originalCommit": {"oid": "281cf6074eb338b5749ad0e45b41a3ba7e846034"}, "originalPosition": 3}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "281cf6074eb338b5749ad0e45b41a3ba7e846034", "author": {"user": {"login": "brycederriso", "name": "Bryce"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/281cf6074eb338b5749ad0e45b41a3ba7e846034", "committedDate": "2020-07-31T18:40:29Z", "message": "Add --region flag to aws s3 cp command in backup scripts.\n\nAdd region option to aws restore."}, "afterCommit": {"oid": "39c7ddca4ba46d78030d753af2055018ad44fa1a", "author": {"user": {"login": "brycederriso", "name": "Bryce"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/39c7ddca4ba46d78030d753af2055018ad44fa1a", "committedDate": "2020-08-03T15:40:48Z", "message": "Use stack to derive region value for salt pillar config."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e854deec483c8cca467ed658634d64b6c232b6a2", "author": {"user": {"login": "brycederriso", "name": "Bryce"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/e854deec483c8cca467ed658634d64b6c232b6a2", "committedDate": "2020-08-03T15:43:29Z", "message": "Remove unused imports."}, "afterCommit": {"oid": "6fd16e84b2a66bb2905bbbf7128b06bbe064301f", "author": {"user": {"login": "brycederriso", "name": "Bryce"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/6fd16e84b2a66bb2905bbbf7128b06bbe064301f", "committedDate": "2020-08-04T13:37:10Z", "message": "Remove unused imports."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c9fdb7c3714d44f0e009ce85018b630a38454b1d", "author": {"user": {"login": "brycederriso", "name": "Bryce"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/c9fdb7c3714d44f0e009ce85018b630a38454b1d", "committedDate": "2020-08-04T14:12:03Z", "message": "Add --region flag to aws s3 cp command in backup scripts.\n\nAdd region option to aws restore.\n\nPass stack object into createSaltConfig.\n\nUse stack to derive region value for salt pillar config.\n\nRemove unused imports.\n\nFix checkstyle and spotbugs errors"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6fd16e84b2a66bb2905bbbf7128b06bbe064301f", "author": {"user": {"login": "brycederriso", "name": "Bryce"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/6fd16e84b2a66bb2905bbbf7128b06bbe064301f", "committedDate": "2020-08-04T13:37:10Z", "message": "Remove unused imports."}, "afterCommit": {"oid": "c9fdb7c3714d44f0e009ce85018b630a38454b1d", "author": {"user": {"login": "brycederriso", "name": "Bryce"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/c9fdb7c3714d44f0e009ce85018b630a38454b1d", "committedDate": "2020-08-04T14:12:03Z", "message": "Add --region flag to aws s3 cp command in backup scripts.\n\nAdd region option to aws restore.\n\nPass stack object into createSaltConfig.\n\nUse stack to derive region value for salt pillar config.\n\nRemove unused imports.\n\nFix checkstyle and spotbugs errors"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxMzc2NTE5", "url": "https://github.com/hortonworks/cloudbreak/pull/8686#pullrequestreview-461376519", "createdAt": "2020-08-05T06:34:17Z", "commit": {"oid": "c9fdb7c3714d44f0e009ce85018b630a38454b1d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQwNjozNDoxN1rOG78FSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQwNjozNDoxN1rOG78FSg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTUwMzU2Mg==", "bodyText": "This doesn't need to be public, others visibility can be lowered also to package level.", "url": "https://github.com/hortonworks/cloudbreak/pull/8686#discussion_r465503562", "createdAt": "2020-08-05T06:34:17Z", "author": {"login": "keyki"}, "path": "core/src/main/java/com/sequenceiq/cloudbreak/reactor/handler/cluster/dr/BackupRestoreSaltConfigGenerator.java", "diffHunk": "@@ -17,17 +18,31 @@\n \n @Component\n public class BackupRestoreSaltConfigGenerator {\n+    // these values are tightly coupled to the `postgresql/disaster_recovery.sls` salt pillar in `orchestrator-salt`\n+    public static final String POSTGRESQL_DISASTER_RECOVERY_PILLAR_PATH = \"/postgresql/disaster_recovery.sls\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c9fdb7c3714d44f0e009ce85018b630a38454b1d"}, "originalPosition": 13}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2533, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}