{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgyNTI1MzAz", "number": 8950, "title": "CB-8739 Consistent Hostnames Enhancements", "bodyText": "Node name generation logic enhanced so that all  hostgroup's nodes start with index 0.\nTesting done.\n\nTested launch of new cluster with 0 based node indexes for every hostgroup.\nTested scale up and scale down of hostgroup nodes with hostGroup based node index.\nTested deleted on provider node and new node added with same name on repair.\nTested manually deleted nodes and successful scale up.\nTested scale up\\down on existing clusters with privateId based names.", "createdAt": "2020-09-09T05:47:49Z", "url": "https://github.com/hortonworks/cloudbreak/pull/8950", "merged": true, "mergeCommit": {"oid": "ebdb2df9661aa3916c6337d1357b4a8ef9fd1b82"}, "closed": true, "closedAt": "2020-09-14T07:37:04Z", "author": {"login": "smaniraju"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdHIzMoAFqTQ4NDgyMzkwMA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdIuLdpgFqTQ4NzQ4ODk4Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg0ODIzOTAw", "url": "https://github.com/hortonworks/cloudbreak/pull/8950#pullrequestreview-484823900", "createdAt": "2020-09-09T09:23:58Z", "commit": {"oid": "2ab8927b87e722e9e11fd5409a8ecba88815d28e"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQwOToyMzo1OVrOHO-svg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQwOToyNzo0NVrOHO-2Qw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTQ2OTM3NA==", "bodyText": "this should be private or moved to a separate class", "url": "https://github.com/hortonworks/cloudbreak/pull/8950#discussion_r485469374", "createdAt": "2020-09-09T09:23:59Z", "author": {"login": "lacikaaa"}, "path": "core/src/main/java/com/sequenceiq/cloudbreak/core/bootstrap/service/ClusterBootstrapper.java", "diffHunk": "@@ -361,4 +373,21 @@ private void validatePollingResultForCancellation(PollingResult pollingResult, S\n         }\n     }\n \n+    String getNodeNameForInstance(InstanceMetaData im, Stack stack,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ab8927b87e722e9e11fd5409a8ecba88815d28e"}, "originalPosition": 75}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTQ2OTkxNg==", "bodyText": "unnecessary line break", "url": "https://github.com/hortonworks/cloudbreak/pull/8950#discussion_r485469916", "createdAt": "2020-09-09T09:24:48Z", "author": {"login": "lacikaaa"}, "path": "core/src/main/java/com/sequenceiq/cloudbreak/core/bootstrap/service/ClusterBootstrapper.java", "diffHunk": "@@ -361,4 +373,21 @@ private void validatePollingResultForCancellation(PollingResult pollingResult, S\n         }\n     }\n \n+    String getNodeNameForInstance(InstanceMetaData im, Stack stack,\n+            Map<String, AtomicLong> hostGroupNodeIndex, Set<String> clusterNodeNames) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ab8927b87e722e9e11fd5409a8ecba88815d28e"}, "originalPosition": 76}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTQ3MDE2NA==", "bodyText": "missing else to indicate there are multiple exit point for the method", "url": "https://github.com/hortonworks/cloudbreak/pull/8950#discussion_r485470164", "createdAt": "2020-09-09T09:25:12Z", "author": {"login": "lacikaaa"}, "path": "core/src/main/java/com/sequenceiq/cloudbreak/core/bootstrap/service/ClusterBootstrapper.java", "diffHunk": "@@ -361,4 +373,21 @@ private void validatePollingResultForCancellation(PollingResult pollingResult, S\n         }\n     }\n \n+    String getNodeNameForInstance(InstanceMetaData im, Stack stack,\n+            Map<String, AtomicLong> hostGroupNodeIndex, Set<String> clusterNodeNames) {\n+        if (isNotBlank(im.getShortHostname())) {\n+            return im.getShortHostname();\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ab8927b87e722e9e11fd5409a8ecba88815d28e"}, "originalPosition": 79}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTQ3MDczMg==", "bodyText": "0L instead of integer 0", "url": "https://github.com/hortonworks/cloudbreak/pull/8950#discussion_r485470732", "createdAt": "2020-09-09T09:26:05Z", "author": {"login": "lacikaaa"}, "path": "core/src/main/java/com/sequenceiq/cloudbreak/core/bootstrap/service/ClusterBootstrapper.java", "diffHunk": "@@ -361,4 +373,21 @@ private void validatePollingResultForCancellation(PollingResult pollingResult, S\n         }\n     }\n \n+    String getNodeNameForInstance(InstanceMetaData im, Stack stack,\n+            Map<String, AtomicLong> hostGroupNodeIndex, Set<String> clusterNodeNames) {\n+        if (isNotBlank(im.getShortHostname())) {\n+            return im.getShortHostname();\n+        }\n+        AtomicLong hostGroupIndex = hostGroupNodeIndex.computeIfAbsent(im.getInstanceGroup().getGroupName(),\n+                instantGroup -> new AtomicLong(0));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ab8927b87e722e9e11fd5409a8ecba88815d28e"}, "originalPosition": 81}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTQ3MTgxMQ==", "bodyText": "this doesn't scale well at first blink, if I have a 300 node cluster in a single hostgroup and upscale with 50 node what would happen?", "url": "https://github.com/hortonworks/cloudbreak/pull/8950#discussion_r485471811", "createdAt": "2020-09-09T09:27:45Z", "author": {"login": "lacikaaa"}, "path": "core/src/main/java/com/sequenceiq/cloudbreak/core/bootstrap/service/ClusterBootstrapper.java", "diffHunk": "@@ -361,4 +373,21 @@ private void validatePollingResultForCancellation(PollingResult pollingResult, S\n         }\n     }\n \n+    String getNodeNameForInstance(InstanceMetaData im, Stack stack,\n+            Map<String, AtomicLong> hostGroupNodeIndex, Set<String> clusterNodeNames) {\n+        if (isNotBlank(im.getShortHostname())) {\n+            return im.getShortHostname();\n+        }\n+        AtomicLong hostGroupIndex = hostGroupNodeIndex.computeIfAbsent(im.getInstanceGroup().getGroupName(),\n+                instantGroup -> new AtomicLong(0));\n+        String generatedHostName;\n+        do {\n+            generatedHostName = hostDiscoveryService.calculateHostname(stack.getCustomHostname(), im.getShortHostname(),\n+                    im.getInstanceGroupName(), hostGroupIndex.getAndIncrement(), stack.isHostgroupNameAsHostname());\n+        } while (clusterNodeNames.contains(generatedHostName));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ab8927b87e722e9e11fd5409a8ecba88815d28e"}, "originalPosition": 86}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2ab8927b87e722e9e11fd5409a8ecba88815d28e", "author": {"user": {"login": "smaniraju", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/2ab8927b87e722e9e11fd5409a8ecba88815d28e", "committedDate": "2020-09-09T05:03:39Z", "message": "CB-6185 Consistent Hostnames Enhancements\n\nNode name generation logic enhanced so that all  hostgroup's nodes start with index 0."}, "afterCommit": {"oid": "eaae6ce323073da35dcc4be86514e9e019e2ed72", "author": {"user": {"login": "smaniraju", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/eaae6ce323073da35dcc4be86514e9e019e2ed72", "committedDate": "2020-09-10T08:11:42Z", "message": "CB-8739 Consistent Hostnames Enhancements\n\nNode name generation logic enhanced so that all  hostgroup's nodes start with index 0."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "eaae6ce323073da35dcc4be86514e9e019e2ed72", "author": {"user": {"login": "smaniraju", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/eaae6ce323073da35dcc4be86514e9e019e2ed72", "committedDate": "2020-09-10T08:11:42Z", "message": "CB-8739 Consistent Hostnames Enhancements\n\nNode name generation logic enhanced so that all  hostgroup's nodes start with index 0."}, "afterCommit": {"oid": "cfbd729ccab8601f2877127fc0a04e5e8c4e62eb", "author": {"user": {"login": "smaniraju", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/cfbd729ccab8601f2877127fc0a04e5e8c4e62eb", "committedDate": "2020-09-11T11:06:15Z", "message": "CB-8739 Consistent Hostnames Enhancements\n\nNode name generation logic enhanced so that all  hostgroup's nodes start with index 0."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "92976cb9f57b230b1be2a0d9304146d3bce76ee2", "author": {"user": {"login": "smaniraju", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/92976cb9f57b230b1be2a0d9304146d3bce76ee2", "committedDate": "2020-09-11T13:10:27Z", "message": "CB-8739 Consistent Hostnames Enhancements\n\nNode name generation logic enhanced so that all  hostgroup's nodes start with index 0."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cfbd729ccab8601f2877127fc0a04e5e8c4e62eb", "author": {"user": {"login": "smaniraju", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/cfbd729ccab8601f2877127fc0a04e5e8c4e62eb", "committedDate": "2020-09-11T11:06:15Z", "message": "CB-8739 Consistent Hostnames Enhancements\n\nNode name generation logic enhanced so that all  hostgroup's nodes start with index 0."}, "afterCommit": {"oid": "92976cb9f57b230b1be2a0d9304146d3bce76ee2", "author": {"user": {"login": "smaniraju", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/92976cb9f57b230b1be2a0d9304146d3bce76ee2", "committedDate": "2020-09-11T13:10:27Z", "message": "CB-8739 Consistent Hostnames Enhancements\n\nNode name generation logic enhanced so that all  hostgroup's nodes start with index 0."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3NDg4OTg2", "url": "https://github.com/hortonworks/cloudbreak/pull/8950#pullrequestreview-487488986", "createdAt": "2020-09-14T07:36:47Z", "commit": {"oid": "92976cb9f57b230b1be2a0d9304146d3bce76ee2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2283, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}