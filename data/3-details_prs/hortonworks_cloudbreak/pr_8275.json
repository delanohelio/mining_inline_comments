{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM0MzIzMTIz", "number": 8275, "title": "DISTX-480 Integrate with autoscale hostgroup recommendations", "bodyText": "Integrate with autoscale hostgroup recommendations.\nIntegrate with MessageSource messages.\nOptimize Yarn Response Unmarshalling\nCloses #DISTX-480\nCloses #DISTX-496\nCloses #DISTX-498", "createdAt": "2020-06-15T06:38:51Z", "url": "https://github.com/hortonworks/cloudbreak/pull/8275", "merged": true, "mergeCommit": {"oid": "bab0972285bc0845a18f054d5e58408968ed1ffa"}, "closed": true, "closedAt": "2020-06-17T15:04:30Z", "author": {"login": "smaniraju"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcruHnxgFqTQzMTE2MjQ1NA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcsFooFgFqTQzMjE3NzMyNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMxMTYyNDU0", "url": "https://github.com/hortonworks/cloudbreak/pull/8275#pullrequestreview-431162454", "createdAt": "2020-06-16T05:07:00Z", "commit": {"oid": "91bc048a04e83857e9e04ed4c24289a6bb6d295e"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQwNTowNzowMFrOGkLYzA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQwNTowNzowMFrOGkLYzA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDU4ODQ5Mg==", "bodyText": "This will not NPE if there's no supported groups, correct?", "url": "https://github.com/hortonworks/cloudbreak/pull/8275#discussion_r440588492", "createdAt": "2020-06-16T05:07:00Z", "author": {"login": "sidseth"}, "path": "autoscale/src/main/java/com/sequenceiq/periscope/controller/AlertController.java", "diffHunk": "@@ -176,15 +185,36 @@ private void validateAccountEntitlement(Cluster cluster) {\n                 ThreadBasedUserCrnProvider.getUserCrn(),\n                 ThreadBasedUserCrnProvider.getAccountId(),\n                 cluster.getCloudPlatform())) {\n-            throw new BadRequestException(String.format(\"Autoscaling is not enabled for CloudPlatform '%s', Cluster '%s' in this Account\",\n-                    cluster.getCloudPlatform(), cluster.getStackCrn()));\n+            throw new BadRequestException(messagesService.getMessage(MessageCode.AUTOSCALING_ENTITLEMENT_NOT_ENABLED,\n+                    List.of(cluster.getCloudPlatform(),  cluster.getStackName())));\n+        }\n+    }\n+\n+    private void validateSupportedHostGroup(Cluster cluster, String requestHostGroup, AlertType alertType) {\n+        Set<String> supportedHostGroups = Optional.ofNullable(\n+                recommendationService.getAutoscaleRecommendations(cluster.getStackCrn())).map(\n+                recommendation -> {\n+                    if (AlertType.LOAD.equals(alertType)) {\n+                        return recommendation.getLoadBasedHostGroups();\n+                    }\n+                    if (AlertType.TIME.equals(alertType)) {\n+                        return recommendation.getTimeBasedHostGroups();\n+                    }\n+                    return Set.of(\"\");\n+                }).orElse(Set.of(\"\"));\n+        if (!supportedHostGroups.contains(requestHostGroup)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91bc048a04e83857e9e04ed4c24289a6bb6d295e"}, "originalPosition": 90}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "91bc048a04e83857e9e04ed4c24289a6bb6d295e", "author": {"user": {"login": "smaniraju", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/91bc048a04e83857e9e04ed4c24289a6bb6d295e", "committedDate": "2020-06-12T13:23:52Z", "message": "DISTX-480 Integrate with autoscale recommendations\n\nIntegrate with autoscale recommendations.\nIntegrate with MessageSource messages."}, "afterCommit": {"oid": "4f2401f1fdb5bec1826a8ba33140ec1a7f9e21c5", "author": {"user": {"login": "smaniraju", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/4f2401f1fdb5bec1826a8ba33140ec1a7f9e21c5", "committedDate": "2020-06-16T10:24:06Z", "message": "DISTX-480 Integrate with autoscale recommendations\n\nIntegrate with autoscale recommendations.\nIntegrate with MessageSource messages.\nOptimize Yarn Response Unmarshalling"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyMTQxMjIw", "url": "https://github.com/hortonworks/cloudbreak/pull/8275#pullrequestreview-432141220", "createdAt": "2020-06-17T07:45:50Z", "commit": {"oid": "4f2401f1fdb5bec1826a8ba33140ec1a7f9e21c5"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QwNzo0NTo1MFrOGk5tog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QwNzo0NzoxOFrOGk5w_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTM0NzQ5MA==", "bodyText": "what is your opinion about that you convert only the different value and you are using the .name() any other case?", "url": "https://github.com/hortonworks/cloudbreak/pull/8275#discussion_r441347490", "createdAt": "2020-06-17T07:45:50Z", "author": {"login": "topolyai5"}, "path": "autoscale-api/src/main/java/com/sequenceiq/periscope/api/model/AlertType.java", "diffHunk": "@@ -1,5 +1,16 @@\n package com.sequenceiq.periscope.api.model;\n \n public enum AlertType {\n-    METRIC, TIME, PROMETHEUS, LOAD\n+    METRIC, TIME, PROMETHEUS, LOAD;\n+\n+    @Override\n+    public String toString() {\n+        switch (this) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4f2401f1fdb5bec1826a8ba33140ec1a7f9e21c5"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTM0ODM1MA==", "bodyText": "this should work without this because the class is annotated with @RunWith(MockitoJUnitRunner.class) or am I missing something?", "url": "https://github.com/hortonworks/cloudbreak/pull/8275#discussion_r441348350", "createdAt": "2020-06-17T07:47:18Z", "author": {"login": "topolyai5"}, "path": "autoscale-api/src/test/java/com/sequenceiq/periscope/api/endpoint/validator/DistroXAutoscaleRequestValidatorTest.java", "diffHunk": "@@ -38,8 +43,12 @@\n \n     private ConstraintValidatorContext validatorContext;\n \n+    @Mock\n+    private CloudbreakMessagesService messagesService;\n+\n     @Before\n     public void setupMocks() {\n+        MockitoAnnotations.initMocks(this);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4f2401f1fdb5bec1826a8ba33140ec1a7f9e21c5"}, "originalPosition": 30}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "64dae250f3d6a4f4b422b6b17f394548025a5e91", "author": {"user": {"login": "smaniraju", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/64dae250f3d6a4f4b422b6b17f394548025a5e91", "committedDate": "2020-06-17T08:22:44Z", "message": "DISTX-480 Integrate with autoscale recommendations\n\nIntegrate with autoscale recommendations.\nIntegrate with MessageSource messages.\nOptimize Yarn Response Unmarshalling"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4f2401f1fdb5bec1826a8ba33140ec1a7f9e21c5", "author": {"user": {"login": "smaniraju", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/4f2401f1fdb5bec1826a8ba33140ec1a7f9e21c5", "committedDate": "2020-06-16T10:24:06Z", "message": "DISTX-480 Integrate with autoscale recommendations\n\nIntegrate with autoscale recommendations.\nIntegrate with MessageSource messages.\nOptimize Yarn Response Unmarshalling"}, "afterCommit": {"oid": "64dae250f3d6a4f4b422b6b17f394548025a5e91", "author": {"user": {"login": "smaniraju", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/64dae250f3d6a4f4b422b6b17f394548025a5e91", "committedDate": "2020-06-17T08:22:44Z", "message": "DISTX-480 Integrate with autoscale recommendations\n\nIntegrate with autoscale recommendations.\nIntegrate with MessageSource messages.\nOptimize Yarn Response Unmarshalling"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyMTc3MzI2", "url": "https://github.com/hortonworks/cloudbreak/pull/8275#pullrequestreview-432177326", "createdAt": "2020-06-17T08:32:39Z", "commit": {"oid": "64dae250f3d6a4f4b422b6b17f394548025a5e91"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1703, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}