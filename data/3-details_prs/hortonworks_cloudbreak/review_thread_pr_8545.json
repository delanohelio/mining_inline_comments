{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ4Njg3OTQw", "number": 8545, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxMToxNjozNFrOEOo5fw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxMToyODo0NlrOEOpH3g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzNzg1NTk5OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/com/sequenceiq/cloudbreak/service/upgrade/ClusterUpgradeImageFilter.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxMToxNjozNFrOGx5iCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxMToxNjozNFrOGx5iCA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk3NjAwOA==", "bodyText": "pls do this in an NPE safe way", "url": "https://github.com/hortonworks/cloudbreak/pull/8545#discussion_r454976008", "createdAt": "2020-07-15T11:16:34Z", "author": {"login": "pdarvasi"}, "path": "core/src/main/java/com/sequenceiq/cloudbreak/service/upgrade/ClusterUpgradeImageFilter.java", "diffHunk": "@@ -109,9 +116,11 @@ private boolean permitLockedComponentsUpgrade(Image currentImage, Image image) {\n         return currentImagePackageVersions.equals(imagePackageVersions);\n     }\n \n-    private boolean permitCmAndStackUpgrade(Image currentImage, Image image, String key) {\n-        return upgradePermissionProvider.permitCmAndStackUpgrade(currentImage.getPackageVersions().get(key),\n-                image.getPackageVersions().get(key));\n+    private boolean permitCmAndStackUpgrade(Image currentImage, Image image, String versionKey, String buildNumberKey) {\n+        String currentVersion = currentImage.getPackageVersions().get(versionKey);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a3371c42292c1a89011901621c8e7b04ad4e02a8"}, "originalPosition": 39}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzNzg1NzU5OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/com/sequenceiq/cloudbreak/service/upgrade/ClusterUpgradeImageFilter.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxMToxNzowOFrOGx5jBQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxMToxNzowOFrOGx5jBQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk3NjI2MQ==", "bodyText": "pls do this in an NPE safe way", "url": "https://github.com/hortonworks/cloudbreak/pull/8545#discussion_r454976261", "createdAt": "2020-07-15T11:17:08Z", "author": {"login": "pdarvasi"}, "path": "core/src/main/java/com/sequenceiq/cloudbreak/service/upgrade/ClusterUpgradeImageFilter.java", "diffHunk": "@@ -109,9 +116,11 @@ private boolean permitLockedComponentsUpgrade(Image currentImage, Image image) {\n         return currentImagePackageVersions.equals(imagePackageVersions);\n     }\n \n-    private boolean permitCmAndStackUpgrade(Image currentImage, Image image, String key) {\n-        return upgradePermissionProvider.permitCmAndStackUpgrade(currentImage.getPackageVersions().get(key),\n-                image.getPackageVersions().get(key));\n+    private boolean permitCmAndStackUpgrade(Image currentImage, Image image, String versionKey, String buildNumberKey) {\n+        String currentVersion = currentImage.getPackageVersions().get(versionKey);\n+        String newVersion = image.getPackageVersions().get(versionKey);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a3371c42292c1a89011901621c8e7b04ad4e02a8"}, "originalPosition": 40}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzNzg5Mjc4OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/com/sequenceiq/cloudbreak/service/upgrade/ClusterUpgradeImageFilter.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxMToyODo0NlrOGx54hA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxMToyODo0NlrOGx54hA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk4MTc2NA==", "bodyText": "logically, this should be part of permitCmAndStackUpgrade method otherwise, it might be misleading, couldn't it?", "url": "https://github.com/hortonworks/cloudbreak/pull/8545#discussion_r454981764", "createdAt": "2020-07-15T11:28:46Z", "author": {"login": "pdarvasi"}, "path": "core/src/main/java/com/sequenceiq/cloudbreak/service/upgrade/ClusterUpgradeImageFilter.java", "diffHunk": "@@ -109,9 +116,11 @@ private boolean permitLockedComponentsUpgrade(Image currentImage, Image image) {\n         return currentImagePackageVersions.equals(imagePackageVersions);\n     }\n \n-    private boolean permitCmAndStackUpgrade(Image currentImage, Image image, String key) {\n-        return upgradePermissionProvider.permitCmAndStackUpgrade(currentImage.getPackageVersions().get(key),\n-                image.getPackageVersions().get(key));\n+    private boolean permitCmAndStackUpgrade(Image currentImage, Image image, String versionKey, String buildNumberKey) {\n+        String currentVersion = currentImage.getPackageVersions().get(versionKey);\n+        String newVersion = image.getPackageVersions().get(versionKey);\n+        return upgradePermissionProvider.permitCmAndStackUpgrade(currentVersion, newVersion)\n+                || (currentVersion.equals(newVersion) && componentBuildNumberComparator.compare(currentImage, image, buildNumberKey));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a3371c42292c1a89011901621c8e7b04ad4e02a8"}, "originalPosition": 42}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3037, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}