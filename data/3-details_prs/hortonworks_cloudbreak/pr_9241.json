{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA2MjU0MDkw", "number": 9241, "title": "CB-9374: Use last FreeIPA cookie when there are multiple", "bodyText": "When there are multiple FreeIPA ipa_session cookies, use the last one.\nThis is the same behavior as FreeIPA does.\nSee https://github.com/freeipa/freeipa/blob/139d60d74706d2ba9855db5faefee322b23b0ba5/ipapython/cookie.py#L322-L349\nfor details.\nSee detailed description in the commit message.", "createdAt": "2020-10-19T20:22:04Z", "url": "https://github.com/hortonworks/cloudbreak/pull/9241", "merged": true, "mergeCommit": {"oid": "302e984637775cac69e0e6b1b706341cade5fa22"}, "closed": true, "closedAt": "2020-10-22T12:14:34Z", "author": {"login": "jamisonbennett"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdUVUtkgFqTUxMjUwODQ3MQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdU86uVAFqTUxNDQzNjQwOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEyNTA4NDcx", "url": "https://github.com/hortonworks/cloudbreak/pull/9241#pullrequestreview-512508471", "createdAt": "2020-10-20T09:26:21Z", "commit": {"oid": "0716e26c054669a70be981927927f1646544fc22"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEzODU1Mzgz", "url": "https://github.com/hortonworks/cloudbreak/pull/9241#pullrequestreview-513855383", "createdAt": "2020-10-21T16:07:44Z", "commit": {"oid": "0716e26c054669a70be981927927f1646544fc22"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQxNjowNzo0NFrOHl0RFg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQxNjowNzo0NFrOHl0RFg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTQxNTcwMg==", "bodyText": "Lets add this comment block from the canonical freeipa client for reference\n\nA cookie string may contain multiple cookies, parse the cookie\nstring and return the last cookie in the string matching the\ncookie name or None if not found.\nmethod which iterates over what parse() returns looking for\nthe specific cookie.\nWhen cookie_name appears more than once the last instance is\nreturned rather than the first because the ordering sequence\nmakes the last instance the current value.", "url": "https://github.com/hortonworks/cloudbreak/pull/9241#discussion_r509415702", "createdAt": "2020-10-21T16:07:44Z", "author": {"login": "kmanamcheri"}, "path": "freeipa/src/main/java/com/sequenceiq/freeipa/client/FreeIpaClientBuilder.java", "diffHunk": "@@ -231,7 +231,10 @@ private CookieAndStickyId connect(String user, String pass, String apiAddress, i\n                         response.getStatusLine().getStatusCode()));\n             }\n         }\n-        Cookie sessionCookie = cookieStore.getCookies().stream().filter(cookie -> \"ipa_session\".equalsIgnoreCase(cookie.getName())).findFirst().get();\n+        Cookie sessionCookie = cookieStore.getCookies().stream()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0716e26c054669a70be981927927f1646544fc22"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0716e26c054669a70be981927927f1646544fc22", "author": {"user": {"login": "jamisonbennett", "name": "Jamison Bennett"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/0716e26c054669a70be981927927f1646544fc22", "committedDate": "2020-10-19T20:20:32Z", "message": "CB-9374: Use last FreeIPA cookie when there are multiple\n\nWhen there are multiple FreeIPA ipa_session cookies, use the last one.\nThis is the same behavior as FreeIPA does.\nSee https://github.com/freeipa/freeipa/blob/139d60d74706d2ba9855db5faefee322b23b0ba5/ipapython/cookie.py#L322-L349\nfor details."}, "afterCommit": {"oid": "865c9d05b03a675e0169b5fa3f17efcbd1c5d98d", "author": {"user": {"login": "jamisonbennett", "name": "Jamison Bennett"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/865c9d05b03a675e0169b5fa3f17efcbd1c5d98d", "committedDate": "2020-10-21T20:29:55Z", "message": "CB-9374: Use last FreeIPA cookie when there are multiple\n\nWhen there are multiple FreeIPA ipa_session cookies, use the last one.\nThis is the same behavior as FreeIPA does.\nSee https://github.com/freeipa/freeipa/blob/139d60d74706d2ba9855db5faefee322b23b0ba5/ipapython/cookie.py#L322-L349\nfor details."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE0MTY2MzY4", "url": "https://github.com/hortonworks/cloudbreak/pull/9241#pullrequestreview-514166368", "createdAt": "2020-10-21T20:37:54Z", "commit": {"oid": "865c9d05b03a675e0169b5fa3f17efcbd1c5d98d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQyMDozNzo1NFrOHmEETQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQyMDozNzo1NFrOHmEETQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTY3NDU3Mw==", "bodyText": "Don't you have to use it somewhere? Like when you are sorting above, you have to use this comparator, no?", "url": "https://github.com/hortonworks/cloudbreak/pull/9241#discussion_r509674573", "createdAt": "2020-10-21T20:37:54Z", "author": {"login": "kmanamcheri"}, "path": "freeipa/src/main/java/com/sequenceiq/freeipa/util/CookieComparator.java", "diffHunk": "@@ -0,0 +1,46 @@\n+package com.sequenceiq.freeipa.util;\n+\n+import java.io.Serializable;\n+import java.util.Comparator;\n+import java.util.Date;\n+\n+import org.apache.http.cookie.Cookie;\n+import org.apache.http.cookie.CookieIdentityComparator;\n+\n+// Sort preceidence:\n+//   1. Cookie name (backwards - doesn't matter)\n+//   2. Domain name (backwards - doesn't matter)\n+//   3. Cookie path (more specific path is listed first) per RFC-6265 section 5.4.2\n+//   4. Expiration (no expiratation is listed first, latest expiration is listed next)\n+public class CookieComparator implements Serializable, Comparator<Cookie> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "865c9d05b03a675e0169b5fa3f17efcbd1c5d98d"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE0MTY5NjIz", "url": "https://github.com/hortonworks/cloudbreak/pull/9241#pullrequestreview-514169623", "createdAt": "2020-10-21T20:42:31Z", "commit": {"oid": "865c9d05b03a675e0169b5fa3f17efcbd1c5d98d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQyMDo0MjozMVrOHmEVRA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQyMDo0MjozMVrOHmEVRA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTY3ODkxNg==", "bodyText": "nit: typo", "url": "https://github.com/hortonworks/cloudbreak/pull/9241#discussion_r509678916", "createdAt": "2020-10-21T20:42:31Z", "author": {"login": "kmanamcheri"}, "path": "freeipa/src/main/java/com/sequenceiq/freeipa/util/CookieComparator.java", "diffHunk": "@@ -0,0 +1,46 @@\n+package com.sequenceiq.freeipa.util;\n+\n+import java.io.Serializable;\n+import java.util.Comparator;\n+import java.util.Date;\n+\n+import org.apache.http.cookie.Cookie;\n+import org.apache.http.cookie.CookieIdentityComparator;\n+\n+// Sort preceidence:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "865c9d05b03a675e0169b5fa3f17efcbd1c5d98d"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE0MTcxMTc0", "url": "https://github.com/hortonworks/cloudbreak/pull/9241#pullrequestreview-514171174", "createdAt": "2020-10-21T20:44:42Z", "commit": {"oid": "865c9d05b03a675e0169b5fa3f17efcbd1c5d98d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f181c41e3e1261c1b2744360f7cac5a9c8eff7b9", "author": {"user": {"login": "jamisonbennett", "name": "Jamison Bennett"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/f181c41e3e1261c1b2744360f7cac5a9c8eff7b9", "committedDate": "2020-10-21T20:45:04Z", "message": "CB-9374: Use last FreeIPA cookie when there are multiple\n\nWhen there are multiple FreeIPA ipa_session cookies, use the last one.\nThis is the same behavior as FreeIPA does.\nSee https://github.com/freeipa/freeipa/blob/139d60d74706d2ba9855db5faefee322b23b0ba5/ipapython/cookie.py#L322-L349\nfor details."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c25521c463323ebe250c1a8c3525623efd15340c", "author": {"user": {"login": "jamisonbennett", "name": "Jamison Bennett"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/c25521c463323ebe250c1a8c3525623efd15340c", "committedDate": "2020-10-21T20:43:23Z", "message": "asdf"}, "afterCommit": {"oid": "f181c41e3e1261c1b2744360f7cac5a9c8eff7b9", "author": {"user": {"login": "jamisonbennett", "name": "Jamison Bennett"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/f181c41e3e1261c1b2744360f7cac5a9c8eff7b9", "committedDate": "2020-10-21T20:45:04Z", "message": "CB-9374: Use last FreeIPA cookie when there are multiple\n\nWhen there are multiple FreeIPA ipa_session cookies, use the last one.\nThis is the same behavior as FreeIPA does.\nSee https://github.com/freeipa/freeipa/blob/139d60d74706d2ba9855db5faefee322b23b0ba5/ipapython/cookie.py#L322-L349\nfor details."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE0NDM2NDA4", "url": "https://github.com/hortonworks/cloudbreak/pull/9241#pullrequestreview-514436408", "createdAt": "2020-10-22T07:34:10Z", "commit": {"oid": "f181c41e3e1261c1b2744360f7cac5a9c8eff7b9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2025, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}