{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEzMzI0MzI0", "number": 9349, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNjoyNjoyNlrOE0c5Cw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxNDozODoxM1rOE2y6aw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzNDM0NzYzOnYy", "diffSide": "RIGHT", "path": "datalake/src/main/java/com/sequenceiq/datalake/controller/sdx/SdxController.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNjoyNjoyN1rOHsLz3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNjo1ODoyMFrOHsNQTw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA5Mjg5Mg==", "bodyText": "Why are we passing both backupId and restoreId to the restore operation calls? I don't see where we're actually using backupId, although I may just be missing it.", "url": "https://github.com/hortonworks/cloudbreak/pull/9349#discussion_r516092892", "createdAt": "2020-11-02T16:26:27Z", "author": {"login": "hreeve-cloudera"}, "path": "datalake/src/main/java/com/sequenceiq/datalake/controller/sdx/SdxController.java", "diffHunk": "@@ -265,9 +265,10 @@ public SdxDatabaseBackupResponse backupDatabaseByName(@ResourceName String name,\n \n     @Override\n     @CheckPermissionByAccount(action = AuthorizationResourceAction.RESTORE_DATALAKE)\n-    public SdxDatabaseRestoreResponse restoreDatabaseByName(@ResourceName String name, String backupId, String backupLocation) {\n+    public SdxDatabaseRestoreResponse restoreDatabaseByName(@ResourceName String name, String backupId,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "171eb9336d3ff0333f9c402de34a39a95833745f"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjExNjU1OQ==", "bodyText": "we need backup-id to use the exact backup location for database backup. This was there from before.\nWe need restore-id to poll the status of datalake-dr operation for the restore to end the flow.", "url": "https://github.com/hortonworks/cloudbreak/pull/9349#discussion_r516116559", "createdAt": "2020-11-02T16:58:20Z", "author": {"login": "kkalvagadda1"}, "path": "datalake/src/main/java/com/sequenceiq/datalake/controller/sdx/SdxController.java", "diffHunk": "@@ -265,9 +265,10 @@ public SdxDatabaseBackupResponse backupDatabaseByName(@ResourceName String name,\n \n     @Override\n     @CheckPermissionByAccount(action = AuthorizationResourceAction.RESTORE_DATALAKE)\n-    public SdxDatabaseRestoreResponse restoreDatabaseByName(@ResourceName String name, String backupId, String backupLocation) {\n+    public SdxDatabaseRestoreResponse restoreDatabaseByName(@ResourceName String name, String backupId,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA5Mjg5Mg=="}, "originalCommit": {"oid": "171eb9336d3ff0333f9c402de34a39a95833745f"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzNDkzMTEyOnYy", "diffSide": "RIGHT", "path": "datalake/src/main/java/com/sequenceiq/datalake/flow/dr/backup/DatalakeDatabaseBackupActions.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxODo0NjozNFrOHsRXGg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxNDowNjoyMVrOHvwa8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjE4MzgzNA==", "bodyText": "If this method is databasebackupFailed, we can leave the log message the same as it was before, since it is about the failed database backup.", "url": "https://github.com/hortonworks/cloudbreak/pull/9349#discussion_r516183834", "createdAt": "2020-11-02T18:46:34Z", "author": {"login": "hreeve-cloudera"}, "path": "datalake/src/main/java/com/sequenceiq/datalake/flow/dr/backup/DatalakeDatabaseBackupActions.java", "diffHunk": "@@ -159,7 +189,7 @@ protected SdxContext createFlowContext(FlowParameters flowParameters, StateConte\n             @Override\n             protected void doExecute(SdxContext context, DatalakeDatabaseBackupFailedEvent payload, Map<Object, Object> variables) {\n                 Exception exception = payload.getException();\n-                LOGGER.error(\"Datalake database backup failed for datalake with id: {}\", payload.getResourceId(), exception);\n+                LOGGER.error(\"Datalake backup failed for datalake with id: {}\", payload.getResourceId(), exception);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "171eb9336d3ff0333f9c402de34a39a95833745f"}, "originalPosition": 150}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTgzODQ0OA==", "bodyText": "addressed.", "url": "https://github.com/hortonworks/cloudbreak/pull/9349#discussion_r519838448", "createdAt": "2020-11-09T14:06:21Z", "author": {"login": "kkalvagadda1"}, "path": "datalake/src/main/java/com/sequenceiq/datalake/flow/dr/backup/DatalakeDatabaseBackupActions.java", "diffHunk": "@@ -159,7 +189,7 @@ protected SdxContext createFlowContext(FlowParameters flowParameters, StateConte\n             @Override\n             protected void doExecute(SdxContext context, DatalakeDatabaseBackupFailedEvent payload, Map<Object, Object> variables) {\n                 Exception exception = payload.getException();\n-                LOGGER.error(\"Datalake database backup failed for datalake with id: {}\", payload.getResourceId(), exception);\n+                LOGGER.error(\"Datalake backup failed for datalake with id: {}\", payload.getResourceId(), exception);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjE4MzgzNA=="}, "originalCommit": {"oid": "171eb9336d3ff0333f9c402de34a39a95833745f"}, "originalPosition": 150}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzNDkzMTk1OnYy", "diffSide": "RIGHT", "path": "datalake/src/main/java/com/sequenceiq/datalake/flow/dr/backup/DatalakeDatabaseBackupActions.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxODo0Njo1MFrOHsRXpA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxNDowNjoyOFrOHvwbMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjE4Mzk3Mg==", "bodyText": "nit: Fix camelcase. databaseBackupFailed", "url": "https://github.com/hortonworks/cloudbreak/pull/9349#discussion_r516183972", "createdAt": "2020-11-02T18:46:50Z", "author": {"login": "hreeve-cloudera"}, "path": "datalake/src/main/java/com/sequenceiq/datalake/flow/dr/backup/DatalakeDatabaseBackupActions.java", "diffHunk": "@@ -122,33 +128,57 @@ protected Object getFailurePayload(DatalakeDatabaseBackupCouldNotStartEvent payl\n         };\n     }\n \n-    @Bean(name = \"DATALAKE_DATABASE_BACKUP_FINISHED_STATE\")\n-    public Action<?, ?> finishedBackupAction() {\n-        return new AbstractSdxAction<>(DatalakeDatabaseBackupSuccessEvent.class) {\n+    @Bean(name = \"DATALAKE_FULL_BACKUP_IN_PROGRESS_STATE\")\n+    public Action<?, ?> datalakeFullBackupInProgress() {\n+        return new AbstractSdxAction<>(SdxEvent.class) {\n \n             @Override\n-            protected SdxContext createFlowContext(FlowParameters flowParameters, StateContext<FlowState, FlowEvent> stateContext,\n-                    DatalakeDatabaseBackupSuccessEvent payload) {\n+            protected SdxContext createFlowContext(FlowParameters flowParameters, StateContext<FlowState, FlowEvent> stateContext, SdxEvent payload) {\n                 return SdxContext.from(flowParameters, payload);\n             }\n \n             @Override\n-            protected void doExecute(SdxContext context, DatalakeDatabaseBackupSuccessEvent payload, Map<Object, Object> variables) {\n-                LOGGER.info(\"Sdx database backup is finalized with sdx id: {}\", payload.getResourceId());\n+            protected void doExecute(SdxContext context, SdxEvent payload, Map<Object, Object> variables) {\n+                LOGGER.info(\"Full datalake backup is in progress for {} \", payload.getResourceId());\n                 String operationId = (String) variables.get(OPERATION_ID);\n+                String backupId = (String) variables.get(BACKUP_ID);\n                 sdxDatabaseDrService.updateDatabaseStatusEntry(operationId, SdxOperationStatus.SUCCEEDED, null);\n+                sendEvent(context, DatalakeFullBackupWaitRequest.from(context, backupId));\n+            }\n+\n+            @Override\n+            protected Object getFailurePayload(SdxEvent payload, Optional<SdxContext> flowContext, Exception ex) {\n+                return DatalakeDatabaseBackupFailedEvent.from(payload, ex);\n+\n+            }\n+        };\n+    }\n+\n+    @Bean(name = \"DATALAKE_BACKUP_FINISHED_STATE\")\n+    public Action<?, ?> finishedBackupAction() {\n+        return new AbstractSdxAction<>(DatalakeBackupSuccessEvent.class) {\n+\n+            @Override\n+            protected SdxContext createFlowContext(FlowParameters flowParameters, StateContext<FlowState, FlowEvent> stateContext,\n+                    DatalakeBackupSuccessEvent payload) {\n+                return SdxContext.from(flowParameters, payload);\n+            }\n+\n+            @Override\n+            protected void doExecute(SdxContext context, DatalakeBackupSuccessEvent payload, Map<Object, Object> variables) {\n+                LOGGER.info(\"Sdx backup is finalized with sdx id: {}\", payload.getResourceId());\n                 sendEvent(context, DATALAKE_DATABASE_BACKUP_FINALIZED_EVENT.event(), payload);\n             }\n \n             @Override\n-            protected Object getFailurePayload(DatalakeDatabaseBackupSuccessEvent payload, Optional<SdxContext> flowContext, Exception ex) {\n+            protected Object getFailurePayload(DatalakeBackupSuccessEvent payload, Optional<SdxContext> flowContext, Exception ex) {\n                 return DatalakeDatabaseBackupFailedEvent.from(payload, ex);\n             }\n         };\n     }\n \n     @Bean(name = \"DATALAKE_DATABASE_BACKUP_FAILED_STATE\")\n-    public Action<?, ?> backupFailed() {\n+    public Action<?, ?> databasebackupFailed() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "171eb9336d3ff0333f9c402de34a39a95833745f"}, "originalPosition": 141}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTgzODUxMw==", "bodyText": "addressed.", "url": "https://github.com/hortonworks/cloudbreak/pull/9349#discussion_r519838513", "createdAt": "2020-11-09T14:06:28Z", "author": {"login": "kkalvagadda1"}, "path": "datalake/src/main/java/com/sequenceiq/datalake/flow/dr/backup/DatalakeDatabaseBackupActions.java", "diffHunk": "@@ -122,33 +128,57 @@ protected Object getFailurePayload(DatalakeDatabaseBackupCouldNotStartEvent payl\n         };\n     }\n \n-    @Bean(name = \"DATALAKE_DATABASE_BACKUP_FINISHED_STATE\")\n-    public Action<?, ?> finishedBackupAction() {\n-        return new AbstractSdxAction<>(DatalakeDatabaseBackupSuccessEvent.class) {\n+    @Bean(name = \"DATALAKE_FULL_BACKUP_IN_PROGRESS_STATE\")\n+    public Action<?, ?> datalakeFullBackupInProgress() {\n+        return new AbstractSdxAction<>(SdxEvent.class) {\n \n             @Override\n-            protected SdxContext createFlowContext(FlowParameters flowParameters, StateContext<FlowState, FlowEvent> stateContext,\n-                    DatalakeDatabaseBackupSuccessEvent payload) {\n+            protected SdxContext createFlowContext(FlowParameters flowParameters, StateContext<FlowState, FlowEvent> stateContext, SdxEvent payload) {\n                 return SdxContext.from(flowParameters, payload);\n             }\n \n             @Override\n-            protected void doExecute(SdxContext context, DatalakeDatabaseBackupSuccessEvent payload, Map<Object, Object> variables) {\n-                LOGGER.info(\"Sdx database backup is finalized with sdx id: {}\", payload.getResourceId());\n+            protected void doExecute(SdxContext context, SdxEvent payload, Map<Object, Object> variables) {\n+                LOGGER.info(\"Full datalake backup is in progress for {} \", payload.getResourceId());\n                 String operationId = (String) variables.get(OPERATION_ID);\n+                String backupId = (String) variables.get(BACKUP_ID);\n                 sdxDatabaseDrService.updateDatabaseStatusEntry(operationId, SdxOperationStatus.SUCCEEDED, null);\n+                sendEvent(context, DatalakeFullBackupWaitRequest.from(context, backupId));\n+            }\n+\n+            @Override\n+            protected Object getFailurePayload(SdxEvent payload, Optional<SdxContext> flowContext, Exception ex) {\n+                return DatalakeDatabaseBackupFailedEvent.from(payload, ex);\n+\n+            }\n+        };\n+    }\n+\n+    @Bean(name = \"DATALAKE_BACKUP_FINISHED_STATE\")\n+    public Action<?, ?> finishedBackupAction() {\n+        return new AbstractSdxAction<>(DatalakeBackupSuccessEvent.class) {\n+\n+            @Override\n+            protected SdxContext createFlowContext(FlowParameters flowParameters, StateContext<FlowState, FlowEvent> stateContext,\n+                    DatalakeBackupSuccessEvent payload) {\n+                return SdxContext.from(flowParameters, payload);\n+            }\n+\n+            @Override\n+            protected void doExecute(SdxContext context, DatalakeBackupSuccessEvent payload, Map<Object, Object> variables) {\n+                LOGGER.info(\"Sdx backup is finalized with sdx id: {}\", payload.getResourceId());\n                 sendEvent(context, DATALAKE_DATABASE_BACKUP_FINALIZED_EVENT.event(), payload);\n             }\n \n             @Override\n-            protected Object getFailurePayload(DatalakeDatabaseBackupSuccessEvent payload, Optional<SdxContext> flowContext, Exception ex) {\n+            protected Object getFailurePayload(DatalakeBackupSuccessEvent payload, Optional<SdxContext> flowContext, Exception ex) {\n                 return DatalakeDatabaseBackupFailedEvent.from(payload, ex);\n             }\n         };\n     }\n \n     @Bean(name = \"DATALAKE_DATABASE_BACKUP_FAILED_STATE\")\n-    public Action<?, ?> backupFailed() {\n+    public Action<?, ?> databasebackupFailed() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjE4Mzk3Mg=="}, "originalCommit": {"oid": "171eb9336d3ff0333f9c402de34a39a95833745f"}, "originalPosition": 141}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1ODc2NTc5OnYy", "diffSide": "RIGHT", "path": "datalake-api/src/main/java/com/sequenceiq/sdx/api/endpoint/SdxEndpoint.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxNDowMjoyNlrOHvwQwA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxODo1MDowMVrOHv8rKA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTgzNTg0MA==", "bodyText": "restoreTd - restoreId", "url": "https://github.com/hortonworks/cloudbreak/pull/9349#discussion_r519835840", "createdAt": "2020-11-09T14:02:26Z", "author": {"login": "sodre90"}, "path": "datalake-api/src/main/java/com/sequenceiq/sdx/api/endpoint/SdxEndpoint.java", "diffHunk": "@@ -194,7 +194,8 @@ SdxDatabaseBackupResponse backupDatabaseByName(@PathParam(\"name\") String name,\n     @Produces(MediaType.APPLICATION_JSON)\n     @ApiOperation(value = \"restore the database backing datalake \", produces = MediaType.APPLICATION_JSON, nickname = \"restoreDatabase\")\n     SdxDatabaseRestoreResponse restoreDatabaseByName(@PathParam(\"name\") String name,\n-            @QueryParam(\"backupId\") String backupId, @QueryParam(\"backupLocation\") String backupLocation);\n+            @QueryParam(\"backupId\") String backupId, @QueryParam(\"restoreTd\") String restoreId,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "171eb9336d3ff0333f9c402de34a39a95833745f"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAzOTIwOA==", "bodyText": "will fix.", "url": "https://github.com/hortonworks/cloudbreak/pull/9349#discussion_r520039208", "createdAt": "2020-11-09T18:50:01Z", "author": {"login": "kkalvagadda1"}, "path": "datalake-api/src/main/java/com/sequenceiq/sdx/api/endpoint/SdxEndpoint.java", "diffHunk": "@@ -194,7 +194,8 @@ SdxDatabaseBackupResponse backupDatabaseByName(@PathParam(\"name\") String name,\n     @Produces(MediaType.APPLICATION_JSON)\n     @ApiOperation(value = \"restore the database backing datalake \", produces = MediaType.APPLICATION_JSON, nickname = \"restoreDatabase\")\n     SdxDatabaseRestoreResponse restoreDatabaseByName(@PathParam(\"name\") String name,\n-            @QueryParam(\"backupId\") String backupId, @QueryParam(\"backupLocation\") String backupLocation);\n+            @QueryParam(\"backupId\") String backupId, @QueryParam(\"restoreTd\") String restoreId,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTgzNTg0MA=="}, "originalCommit": {"oid": "171eb9336d3ff0333f9c402de34a39a95833745f"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1ODg4ODI0OnYy", "diffSide": "RIGHT", "path": "datalake/src/main/java/com/sequenceiq/datalake/flow/dr/restore/DatalakeDatabaseRestoreActions.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxNDoyOTo0OFrOHvxbqw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxODo1MToxOVrOHv8uQg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTg1NTAxOQ==", "bodyText": "why is this line duplicated?", "url": "https://github.com/hortonworks/cloudbreak/pull/9349#discussion_r519855019", "createdAt": "2020-11-09T14:29:48Z", "author": {"login": "sodre90"}, "path": "datalake/src/main/java/com/sequenceiq/datalake/flow/dr/restore/DatalakeDatabaseRestoreActions.java", "diffHunk": "@@ -120,32 +128,60 @@ protected Object getFailurePayload(DatalakeDatabaseRestoreCouldNotStartEvent pay\n         };\n     }\n \n+    @Bean(name = \"DATALAKE_FULL_RESTORE_IN_PROGRESS_STATE\")\n+    public Action<?, ?> datalakeFullResoreInProgress() {\n+        return new AbstractSdxAction<>(SdxEvent.class) {\n+\n+            @Override\n+            protected SdxContext createFlowContext(FlowParameters flowParameters, StateContext<FlowState, FlowEvent> stateContext, SdxEvent payload) {\n+                return SdxContext.from(flowParameters, payload);\n+            }\n+\n+            @Override\n+            protected void doExecute(SdxContext context, SdxEvent payload, Map<Object, Object> variables) {\n+                LOGGER.info(\"Full datalake restore is in progress for {} \", payload.getResourceId());\n+                String operationId = (String) variables.get(OPERATION_ID);\n+                sdxDatabaseDrService.updateDatabaseStatusEntry(operationId, SdxOperationStatus.SUCCEEDED, null);\n+                sendEvent(context, DatalakeFullRestoreWaitRequest.from(context, operationId));\n+\n+                String restoreId = (String) variables.get(RESTORE_ID);\n+                sdxDatabaseDrService.updateDatabaseStatusEntry(operationId, SdxOperationStatus.SUCCEEDED, null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bca8b3b4829ab2a7e36408b8d7b51e6743a9ca94"}, "originalPosition": 88}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDA0MDAwMg==", "bodyText": "My bad. I fixed it now.", "url": "https://github.com/hortonworks/cloudbreak/pull/9349#discussion_r520040002", "createdAt": "2020-11-09T18:51:19Z", "author": {"login": "kkalvagadda1"}, "path": "datalake/src/main/java/com/sequenceiq/datalake/flow/dr/restore/DatalakeDatabaseRestoreActions.java", "diffHunk": "@@ -120,32 +128,60 @@ protected Object getFailurePayload(DatalakeDatabaseRestoreCouldNotStartEvent pay\n         };\n     }\n \n+    @Bean(name = \"DATALAKE_FULL_RESTORE_IN_PROGRESS_STATE\")\n+    public Action<?, ?> datalakeFullResoreInProgress() {\n+        return new AbstractSdxAction<>(SdxEvent.class) {\n+\n+            @Override\n+            protected SdxContext createFlowContext(FlowParameters flowParameters, StateContext<FlowState, FlowEvent> stateContext, SdxEvent payload) {\n+                return SdxContext.from(flowParameters, payload);\n+            }\n+\n+            @Override\n+            protected void doExecute(SdxContext context, SdxEvent payload, Map<Object, Object> variables) {\n+                LOGGER.info(\"Full datalake restore is in progress for {} \", payload.getResourceId());\n+                String operationId = (String) variables.get(OPERATION_ID);\n+                sdxDatabaseDrService.updateDatabaseStatusEntry(operationId, SdxOperationStatus.SUCCEEDED, null);\n+                sendEvent(context, DatalakeFullRestoreWaitRequest.from(context, operationId));\n+\n+                String restoreId = (String) variables.get(RESTORE_ID);\n+                sdxDatabaseDrService.updateDatabaseStatusEntry(operationId, SdxOperationStatus.SUCCEEDED, null);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTg1NTAxOQ=="}, "originalCommit": {"oid": "bca8b3b4829ab2a7e36408b8d7b51e6743a9ca94"}, "originalPosition": 88}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1ODkyNzE1OnYy", "diffSide": "RIGHT", "path": "datalake/src/main/java/com/sequenceiq/datalake/flow/dr/restore/DatalakeDatabaseRestoreActions.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxNDozODoxM1rOHvxzHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxODo1MTozOFrOHv8vAA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTg2MTAyMw==", "bodyText": "we send 2 event from this action, is this intended?", "url": "https://github.com/hortonworks/cloudbreak/pull/9349#discussion_r519861023", "createdAt": "2020-11-09T14:38:13Z", "author": {"login": "sodre90"}, "path": "datalake/src/main/java/com/sequenceiq/datalake/flow/dr/restore/DatalakeDatabaseRestoreActions.java", "diffHunk": "@@ -120,32 +128,60 @@ protected Object getFailurePayload(DatalakeDatabaseRestoreCouldNotStartEvent pay\n         };\n     }\n \n+    @Bean(name = \"DATALAKE_FULL_RESTORE_IN_PROGRESS_STATE\")\n+    public Action<?, ?> datalakeFullResoreInProgress() {\n+        return new AbstractSdxAction<>(SdxEvent.class) {\n+\n+            @Override\n+            protected SdxContext createFlowContext(FlowParameters flowParameters, StateContext<FlowState, FlowEvent> stateContext, SdxEvent payload) {\n+                return SdxContext.from(flowParameters, payload);\n+            }\n+\n+            @Override\n+            protected void doExecute(SdxContext context, SdxEvent payload, Map<Object, Object> variables) {\n+                LOGGER.info(\"Full datalake restore is in progress for {} \", payload.getResourceId());\n+                String operationId = (String) variables.get(OPERATION_ID);\n+                sdxDatabaseDrService.updateDatabaseStatusEntry(operationId, SdxOperationStatus.SUCCEEDED, null);\n+                sendEvent(context, DatalakeFullRestoreWaitRequest.from(context, operationId));\n+\n+                String restoreId = (String) variables.get(RESTORE_ID);\n+                sdxDatabaseDrService.updateDatabaseStatusEntry(operationId, SdxOperationStatus.SUCCEEDED, null);\n+                sendEvent(context, DatalakeFullRestoreWaitRequest.from(context, restoreId));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bca8b3b4829ab2a7e36408b8d7b51e6743a9ca94"}, "originalPosition": 89}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDA0MDE5Mg==", "bodyText": "That is incorrect. I will fix it.", "url": "https://github.com/hortonworks/cloudbreak/pull/9349#discussion_r520040192", "createdAt": "2020-11-09T18:51:38Z", "author": {"login": "kkalvagadda1"}, "path": "datalake/src/main/java/com/sequenceiq/datalake/flow/dr/restore/DatalakeDatabaseRestoreActions.java", "diffHunk": "@@ -120,32 +128,60 @@ protected Object getFailurePayload(DatalakeDatabaseRestoreCouldNotStartEvent pay\n         };\n     }\n \n+    @Bean(name = \"DATALAKE_FULL_RESTORE_IN_PROGRESS_STATE\")\n+    public Action<?, ?> datalakeFullResoreInProgress() {\n+        return new AbstractSdxAction<>(SdxEvent.class) {\n+\n+            @Override\n+            protected SdxContext createFlowContext(FlowParameters flowParameters, StateContext<FlowState, FlowEvent> stateContext, SdxEvent payload) {\n+                return SdxContext.from(flowParameters, payload);\n+            }\n+\n+            @Override\n+            protected void doExecute(SdxContext context, SdxEvent payload, Map<Object, Object> variables) {\n+                LOGGER.info(\"Full datalake restore is in progress for {} \", payload.getResourceId());\n+                String operationId = (String) variables.get(OPERATION_ID);\n+                sdxDatabaseDrService.updateDatabaseStatusEntry(operationId, SdxOperationStatus.SUCCEEDED, null);\n+                sendEvent(context, DatalakeFullRestoreWaitRequest.from(context, operationId));\n+\n+                String restoreId = (String) variables.get(RESTORE_ID);\n+                sdxDatabaseDrService.updateDatabaseStatusEntry(operationId, SdxOperationStatus.SUCCEEDED, null);\n+                sendEvent(context, DatalakeFullRestoreWaitRequest.from(context, restoreId));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTg2MTAyMw=="}, "originalCommit": {"oid": "bca8b3b4829ab2a7e36408b8d7b51e6743a9ca94"}, "originalPosition": 89}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3609, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}