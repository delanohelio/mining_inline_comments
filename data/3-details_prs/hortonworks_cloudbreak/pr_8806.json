{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY3MzQ2MzE4", "number": 8806, "title": "ENGESC-3681 Cluster expansion hung after hitting EC2 limit. An attemp\u2026", "bodyText": "\u2026t to increase the size of a data hub cluster failed due to an AWS quota limit, but the operation in CB isn't timing out or canceling. In this PR, I'm decreasing the timeout from 13,5H to 0,5H\nSee detailed description in the commit message.", "createdAt": "2020-08-13T12:15:15Z", "url": "https://github.com/hortonworks/cloudbreak/pull/8806", "merged": true, "mergeCommit": {"oid": "e1544b49fe139777b76173e16de42ddf61c2b224"}, "closed": true, "closedAt": "2020-08-17T15:29:12Z", "author": {"login": "topolyai5"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc-hS_mAFqTQ2Njg0NDIzNw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc_yHV3gBqjM2NjE3NzI1MTE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2ODQ0MjM3", "url": "https://github.com/hortonworks/cloudbreak/pull/8806#pullrequestreview-466844237", "createdAt": "2020-08-13T14:57:00Z", "commit": {"oid": "43f1ce36956b1031e248b186d00e2ce0578a8025"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "43f1ce36956b1031e248b186d00e2ce0578a8025", "author": {"user": {"login": "topolyai5", "name": "Gergely Topolyai"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/43f1ce36956b1031e248b186d00e2ce0578a8025", "committedDate": "2020-08-13T12:14:19Z", "message": "ENGESC-3681 Cluster expansion hung after hitting EC2 limit. An attempt to increase the size of a data hub cluster failed due to an AWS quota limit, but the operation in CB isn't timing out or canceling. In this PR, I'm decreasing the timeout from 13,5H to 0,5H"}, "afterCommit": {"oid": "759becaa44e3c0a4c058c0432e2cfa6f3236bec9", "author": {"user": {"login": "topolyai5", "name": "Gergely Topolyai"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/759becaa44e3c0a4c058c0432e2cfa6f3236bec9", "committedDate": "2020-08-14T15:06:36Z", "message": "ENGESC-3681 Cluster expansion hung after hitting EC2 limit. An attempt to increase the size of a data hub cluster failed due to an AWS quota limit, but the operation in CB isn't timing out or canceling. I'm decreasing the timeout from 13,5H to 0,5H and I am checking the last activity whether is failed or not. If it failed, the upscale will be aborted."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "759becaa44e3c0a4c058c0432e2cfa6f3236bec9", "author": {"user": {"login": "topolyai5", "name": "Gergely Topolyai"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/759becaa44e3c0a4c058c0432e2cfa6f3236bec9", "committedDate": "2020-08-14T15:06:36Z", "message": "ENGESC-3681 Cluster expansion hung after hitting EC2 limit. An attempt to increase the size of a data hub cluster failed due to an AWS quota limit, but the operation in CB isn't timing out or canceling. I'm decreasing the timeout from 13,5H to 0,5H and I am checking the last activity whether is failed or not. If it failed, the upscale will be aborted."}, "afterCommit": {"oid": "ac056fcc05573b5c895c6f803d856707428731ab", "author": {"user": {"login": "topolyai5", "name": "Gergely Topolyai"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/ac056fcc05573b5c895c6f803d856707428731ab", "committedDate": "2020-08-14T15:11:30Z", "message": "ENGESC-3681 Cluster expansion hung after hitting EC2 limit. An attempt to increase the size of a data hub cluster failed due to an AWS quota limit, but the operation in CB isn't timing out or canceling. I'm decreasing the timeout from 13,5H to 0,5H and I am checking the last activity whether is failed or not. If it failed, the upscale will be aborted."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY3NjczODQ2", "url": "https://github.com/hortonworks/cloudbreak/pull/8806#pullrequestreview-467673846", "createdAt": "2020-08-14T15:33:13Z", "commit": {"oid": "ac056fcc05573b5c895c6f803d856707428731ab"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxNTozMzoxM1rOHA5OpQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxNTozMzoxM1rOHA5OpQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDY5OTY4NQ==", "bodyText": "Wouldn't it be better to have a solid try-catch on this provider call?", "url": "https://github.com/hortonworks/cloudbreak/pull/8806#discussion_r470699685", "createdAt": "2020-08-14T15:33:13Z", "author": {"login": "biharitomi"}, "path": "cloud-aws/src/main/java/com/sequenceiq/cloudbreak/cloud/aws/connector/resource/AwsAutoScalingService.java", "diffHunk": "@@ -143,6 +149,27 @@ private void waitForGroup(AmazonEC2Client amClient, AmazonAutoScalingClient asCl\n         }\n     }\n \n+    private void checkLastScalingActivity(AmazonAutoScalingClient asClient, AmazonAutoScalingRetryClient asRetryClient, String autoScalingGroupName,\n+            Date timeBeforeASUpdate) throws AmazonAutoscalingFailed {\n+        try {\n+            Waiter<DescribeScalingActivitiesRequest> autoscalingActivitesWaiter = customAmazonWaiterProvider\n+                    .getAutoscalingActivitesWaiter(asClient, timeBeforeASUpdate);\n+            autoscalingActivitesWaiter.run(new WaiterParameters<>(new DescribeScalingActivitiesRequest().withAutoScalingGroupName(autoScalingGroupName)));\n+        } catch (Exception e) {\n+            LOGGER.error(\"Failed to list activities: {}\", e.getMessage(), e);\n+            throw new AmazonAutoscalingFailed(e.getMessage(), e);\n+        }\n+        DescribeScalingActivitiesResult describeScalingActivitiesResult = asRetryClient", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ac056fcc05573b5c895c6f803d856707428731ab"}, "originalPosition": 56}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ac056fcc05573b5c895c6f803d856707428731ab", "author": {"user": {"login": "topolyai5", "name": "Gergely Topolyai"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/ac056fcc05573b5c895c6f803d856707428731ab", "committedDate": "2020-08-14T15:11:30Z", "message": "ENGESC-3681 Cluster expansion hung after hitting EC2 limit. An attempt to increase the size of a data hub cluster failed due to an AWS quota limit, but the operation in CB isn't timing out or canceling. I'm decreasing the timeout from 13,5H to 0,5H and I am checking the last activity whether is failed or not. If it failed, the upscale will be aborted."}, "afterCommit": {"oid": "c6d4815f0bc86ffba2240750e04d412debfa9c4d", "author": {"user": {"login": "topolyai5", "name": "Gergely Topolyai"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/c6d4815f0bc86ffba2240750e04d412debfa9c4d", "committedDate": "2020-08-17T11:57:46Z", "message": "ENGESC-3681 Cluster expansion hung after hitting EC2 limit. An attempt to increase the size of a data hub cluster failed due to an AWS quota limit, but the operation in CB isn't timing out or canceling. I'm decreasing the timeout from 13,5H to 0,5H and I am checking the last activity whether is failed or not. If it failed, the upscale will be aborted."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c6d4815f0bc86ffba2240750e04d412debfa9c4d", "author": {"user": {"login": "topolyai5", "name": "Gergely Topolyai"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/c6d4815f0bc86ffba2240750e04d412debfa9c4d", "committedDate": "2020-08-17T11:57:46Z", "message": "ENGESC-3681 Cluster expansion hung after hitting EC2 limit. An attempt to increase the size of a data hub cluster failed due to an AWS quota limit, but the operation in CB isn't timing out or canceling. I'm decreasing the timeout from 13,5H to 0,5H and I am checking the last activity whether is failed or not. If it failed, the upscale will be aborted."}, "afterCommit": {"oid": "a5647ebb1438d0d84a5f8fd21e0f8377359a6a46", "author": {"user": {"login": "topolyai5", "name": "Gergely Topolyai"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/a5647ebb1438d0d84a5f8fd21e0f8377359a6a46", "committedDate": "2020-08-17T12:10:11Z", "message": "ENGESC-3681 Cluster expansion hung after hitting EC2 limit. An attempt to increase the size of a data hub cluster failed due to an AWS quota limit, but the operation in CB isn't timing out or canceling. I'm decreasing the timeout from 13,5H to 0,5H and I am checking the last activity whether is failed or not. If it failed, the upscale will be aborted."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY4NDMxNzQy", "url": "https://github.com/hortonworks/cloudbreak/pull/8806#pullrequestreview-468431742", "createdAt": "2020-08-17T12:49:29Z", "commit": {"oid": "a5647ebb1438d0d84a5f8fd21e0f8377359a6a46"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "25f2bbe562674577256fe2c5d52dac94169ced34", "author": {"user": {"login": "topolyai5", "name": "Gergely Topolyai"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/25f2bbe562674577256fe2c5d52dac94169ced34", "committedDate": "2020-08-17T13:05:53Z", "message": "ENGESC-3681 Cluster expansion hung after hitting EC2 limit. An attempt to increase the size of a data hub cluster failed due to an AWS quota limit, but the operation in CB isn't timing out or canceling. I'm decreasing the timeout from 13,5H to 0,5H and I am checking the last activity whether is failed or not. If it failed, the upscale will be aborted."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a5647ebb1438d0d84a5f8fd21e0f8377359a6a46", "author": {"user": {"login": "topolyai5", "name": "Gergely Topolyai"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/a5647ebb1438d0d84a5f8fd21e0f8377359a6a46", "committedDate": "2020-08-17T12:10:11Z", "message": "ENGESC-3681 Cluster expansion hung after hitting EC2 limit. An attempt to increase the size of a data hub cluster failed due to an AWS quota limit, but the operation in CB isn't timing out or canceling. I'm decreasing the timeout from 13,5H to 0,5H and I am checking the last activity whether is failed or not. If it failed, the upscale will be aborted."}, "afterCommit": {"oid": "25f2bbe562674577256fe2c5d52dac94169ced34", "author": {"user": {"login": "topolyai5", "name": "Gergely Topolyai"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/25f2bbe562674577256fe2c5d52dac94169ced34", "committedDate": "2020-08-17T13:05:53Z", "message": "ENGESC-3681 Cluster expansion hung after hitting EC2 limit. An attempt to increase the size of a data hub cluster failed due to an AWS quota limit, but the operation in CB isn't timing out or canceling. I'm decreasing the timeout from 13,5H to 0,5H and I am checking the last activity whether is failed or not. If it failed, the upscale will be aborted."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2464, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}