{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM1NDQ3Nzc0", "number": 9620, "title": "CB-10242 API changes to support semi-private networks", "bodyText": "Adds new optional fields 'usePublicEndpointAccessGateway' and\n'endpointGatewaySubnetIds' to the EnvironmentNetworkV1Request API object. These\nfields are persisted to the EnvironmentNetwork and NetworkDto BaseNetwork\nobjects. Adds new columns for these fields to the environment_network table\nand saves them to the database.\nTested with unit tests, and by manually setting the new fields in the IDE and\nverifying they were converted/persisted in the database correctly.\nSee detailed description in the commit message.", "createdAt": "2020-12-09T20:33:55Z", "url": "https://github.com/hortonworks/cloudbreak/pull/9620", "merged": true, "mergeCommit": {"oid": "51fce895215a5d3e3e1df90e336fbe1dd82f6e53"}, "closed": true, "closedAt": "2020-12-15T16:05:12Z", "author": {"login": "hreeve-cloudera"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdkmwedgFqTU0ODY3ODIxMg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdmckXMgFqTU1MjYxNDkxNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ4Njc4MjEy", "url": "https://github.com/hortonworks/cloudbreak/pull/9620#pullrequestreview-548678212", "createdAt": "2020-12-09T22:47:51Z", "commit": {"oid": "e722379396640a8f6f0284b0ca96070da39ee096"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e722379396640a8f6f0284b0ca96070da39ee096", "author": {"user": {"login": "hreeve-cloudera", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/e722379396640a8f6f0284b0ca96070da39ee096", "committedDate": "2020-12-09T20:26:25Z", "message": "CB-10242 API changes to support semi-private networks\n\nAdds new optional fields 'usePublicEndpointAccessGateway' and\n'endpointGatewaySubnetIds' to the EnvironmentNetworkV1Request API object. These\nfields are persisted to the EnvironmentNetwork and NetworkDto BaseNetwork\nobjects. Adds new columns for these fields to the environment_network table\nand saves them to the database.\n\nTested with unit tests, and by manually setting the new fields in the IDE and\nverifying they were converted/persisted in the database correctly."}, "afterCommit": {"oid": "31ad5507ec7c34ecfa7dd89e3d359938962b03da", "author": {"user": {"login": "hreeve-cloudera", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/31ad5507ec7c34ecfa7dd89e3d359938962b03da", "committedDate": "2020-12-10T15:37:37Z", "message": "CB-10242 API changes to support semi-private networks\n\nAdds new optional fields 'usePublicEndpointAccessGateway' and\n'endpointGatewaySubnetIds' to the EnvironmentNetworkV1Request API object. These\nfields are persisted to the EnvironmentNetwork and NetworkDto BaseNetwork\nobjects. Adds new columns for these fields to the environment_network table\nand saves them to the database.\n\nTested with unit tests, and by manually setting the new fields in the IDE and\nverifying they were converted/persisted in the database correctly."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "31ad5507ec7c34ecfa7dd89e3d359938962b03da", "author": {"user": {"login": "hreeve-cloudera", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/31ad5507ec7c34ecfa7dd89e3d359938962b03da", "committedDate": "2020-12-10T15:37:37Z", "message": "CB-10242 API changes to support semi-private networks\n\nAdds new optional fields 'usePublicEndpointAccessGateway' and\n'endpointGatewaySubnetIds' to the EnvironmentNetworkV1Request API object. These\nfields are persisted to the EnvironmentNetwork and NetworkDto BaseNetwork\nobjects. Adds new columns for these fields to the environment_network table\nand saves them to the database.\n\nTested with unit tests, and by manually setting the new fields in the IDE and\nverifying they were converted/persisted in the database correctly."}, "afterCommit": {"oid": "41e55e6bd5de0b37bf0ec078991bd80303e2f5d5", "author": {"user": {"login": "hreeve-cloudera", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/41e55e6bd5de0b37bf0ec078991bd80303e2f5d5", "committedDate": "2020-12-10T18:08:49Z", "message": "CB-10242 API changes to support semi-private networks\n\nAdds new optional fields 'usePublicEndpointAccessGateway' and\n'endpointGatewaySubnetIds' to the EnvironmentNetworkV1Request API object. These\nfields are persisted to the EnvironmentNetwork and NetworkDto BaseNetwork\nobjects. Adds new columns for these fields to the environment_network table\nand saves them to the database.\n\nTested with unit tests, and by manually setting the new fields in the IDE and\nverifying they were converted/persisted in the database correctly."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUxMTA0MzIy", "url": "https://github.com/hortonworks/cloudbreak/pull/9620#pullrequestreview-551104322", "createdAt": "2020-12-14T07:37:18Z", "commit": {"oid": "41e55e6bd5de0b37bf0ec078991bd80303e2f5d5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQwNzozNzoxOFrOIFDUfw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQwNzozNzoxOFrOIFDUfw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjE2ODE5MQ==", "bodyText": "Usually, we prefer enums instead of booleans, it makes it easier to extend it the future.", "url": "https://github.com/hortonworks/cloudbreak/pull/9620#discussion_r542168191", "createdAt": "2020-12-14T07:37:18Z", "author": {"login": "akanto"}, "path": "environment-api/src/main/java/com/sequenceiq/environment/api/v1/environment/model/base/EnvironmentNetworkBase.java", "diffHunk": "@@ -42,6 +42,12 @@\n     @ApiModelProperty(EnvironmentModelDescription.SERVICE_ENDPOINT_CREATION)\n     private ServiceEndpointCreation serviceEndpointCreation = ServiceEndpointCreation.DISABLED;\n \n+    @ApiModelProperty(EnvironmentModelDescription.PUBLIC_ENDPOINT_ACCESS_GATEWAY)\n+    private Boolean usePublicEndpointAccessGateway = false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "41e55e6bd5de0b37bf0ec078991bd80303e2f5d5"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUxMTA1MTk0", "url": "https://github.com/hortonworks/cloudbreak/pull/9620#pullrequestreview-551105194", "createdAt": "2020-12-14T07:39:02Z", "commit": {"oid": "41e55e6bd5de0b37bf0ec078991bd80303e2f5d5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQwNzozOTowMlrOIFDXvg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQwNzozOTowMlrOIFDXvg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjE2OTAyMg==", "bodyText": "Can you add more description here, please? What is the purpose of the subnetids?", "url": "https://github.com/hortonworks/cloudbreak/pull/9620#discussion_r542169022", "createdAt": "2020-12-14T07:39:02Z", "author": {"login": "akanto"}, "path": "environment-api/src/main/java/com/sequenceiq/environment/api/doc/environment/EnvironmentModelDescription.java", "diffHunk": "@@ -14,6 +14,9 @@\n     public static final String NETWORKCIDRS = \"The network cidrs for the configured vpc\";\n     public static final String PRIVATE_SUBNET_CREATION = \"A flag to enable or disable the private subnet creation.\";\n     public static final String SERVICE_ENDPOINT_CREATION = \"A flag to enable or disable the service endpoint creation.\";\n+    public static final String PUBLIC_ENDPOINT_ACCESS_GATEWAY = \"A flag to select a public or private endpoint access gateway.\";\n+    public static final String ENDPOINT_ACCESS_GATEWAY_SUBNET_IDS = \"Subnet ids for the endpoint access gateway. (Optional)\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "41e55e6bd5de0b37bf0ec078991bd80303e2f5d5"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUxMTM4MTUx", "url": "https://github.com/hortonworks/cloudbreak/pull/9620#pullrequestreview-551138151", "createdAt": "2020-12-14T08:31:13Z", "commit": {"oid": "41e55e6bd5de0b37bf0ec078991bd80303e2f5d5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQwODozMToxM1rOIFFCnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQwODozMToxM1rOIFFCnQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjE5NjM4MQ==", "bodyText": "this fields can not be not null because in case of a production roll back we need to use the modified scheme with the previous CB version", "url": "https://github.com/hortonworks/cloudbreak/pull/9620#discussion_r542196381", "createdAt": "2020-12-14T08:31:13Z", "author": {"login": "doktoric"}, "path": "environment/src/main/resources/schema/app/20201208195427_CB-10242_API_changes_for_semi-private_networks.sql", "diffHunk": "@@ -0,0 +1,11 @@\n+-- // CB-10242 API changes for semi-private networks\n+-- Migration SQL that makes the change goes here.\n+\n+ALTER TABLE environment_network ADD COLUMN IF NOT EXISTS usepublicendpointaccessgateway BOOLEAN NOT NULL DEFAULT false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "41e55e6bd5de0b37bf0ec078991bd80303e2f5d5"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUxMTU2MjI0", "url": "https://github.com/hortonworks/cloudbreak/pull/9620#pullrequestreview-551156224", "createdAt": "2020-12-14T08:54:16Z", "commit": {"oid": "41e55e6bd5de0b37bf0ec078991bd80303e2f5d5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQwODo1NDoxNlrOIFF7Lw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQwODo1NDoxNlrOIFF7Lw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjIxMDg2Mw==", "bodyText": "use enum please", "url": "https://github.com/hortonworks/cloudbreak/pull/9620#discussion_r542210863", "createdAt": "2020-12-14T08:54:16Z", "author": {"login": "doktoric"}, "path": "environment/src/main/java/com/sequenceiq/environment/environment/v1/converter/NetworkRequestToDtoConverter.java", "diffHunk": "@@ -110,4 +115,8 @@ private ServiceEndpointCreation getServiceEndpointCreation(EnvironmentNetworkReq\n     private OutboundInternetTraffic getOutboundInternetTraffic(EnvironmentNetworkRequest network) {\n         return Optional.ofNullable(network.getOutboundInternetTraffic()).orElse(OutboundInternetTraffic.ENABLED);\n     }\n+\n+    private Boolean getUsePublicEndpointAccessGateway(EnvironmentNetworkRequest network) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "41e55e6bd5de0b37bf0ec078991bd80303e2f5d5"}, "originalPosition": 23}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUxMTU2ODYx", "url": "https://github.com/hortonworks/cloudbreak/pull/9620#pullrequestreview-551156861", "createdAt": "2020-12-14T08:55:01Z", "commit": {"oid": "41e55e6bd5de0b37bf0ec078991bd80303e2f5d5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQwODo1NTowMVrOIFF9NA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQwODo1NTowMVrOIFF9NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjIxMTM4MA==", "bodyText": "we can not set nullable = false here", "url": "https://github.com/hortonworks/cloudbreak/pull/9620#discussion_r542211380", "createdAt": "2020-12-14T08:55:01Z", "author": {"login": "doktoric"}, "path": "environment/src/main/java/com/sequenceiq/environment/network/dao/domain/BaseNetwork.java", "diffHunk": "@@ -79,6 +79,12 @@\n     @Convert(converter = ServiceEndpointCreationConverter.class)\n     private ServiceEndpointCreation serviceEndpointCreation;\n \n+    private boolean usePublicEndpointAccessGateway;\n+\n+    @Convert(converter = JsonToString.class)\n+    @Column(columnDefinition = \"TEXT\", nullable = false)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "41e55e6bd5de0b37bf0ec078991bd80303e2f5d5"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUxMTU2OTc4", "url": "https://github.com/hortonworks/cloudbreak/pull/9620#pullrequestreview-551156978", "createdAt": "2020-12-14T08:55:09Z", "commit": {"oid": "41e55e6bd5de0b37bf0ec078991bd80303e2f5d5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQwODo1NTowOVrOIFF9lg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQwODo1NTowOVrOIFF9lg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjIxMTQ3OA==", "bodyText": "enum please", "url": "https://github.com/hortonworks/cloudbreak/pull/9620#discussion_r542211478", "createdAt": "2020-12-14T08:55:09Z", "author": {"login": "doktoric"}, "path": "environment/src/main/java/com/sequenceiq/environment/network/dao/domain/BaseNetwork.java", "diffHunk": "@@ -169,6 +175,23 @@ public void setSubnetMetas(Map<String, CloudSubnet> subnetMetas) {\n         });\n     }\n \n+    public boolean isUsePublicEndpointAccessGateway() {\n+        return usePublicEndpointAccessGateway;\n+    }\n+\n+    public void setUsePublicEndpointAccessGateway(boolean usePublicEndpointAccessGateway) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "41e55e6bd5de0b37bf0ec078991bd80303e2f5d5"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUxMTU3MDI5", "url": "https://github.com/hortonworks/cloudbreak/pull/9620#pullrequestreview-551157029", "createdAt": "2020-12-14T08:55:12Z", "commit": {"oid": "41e55e6bd5de0b37bf0ec078991bd80303e2f5d5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQwODo1NToxM1rOIFF9uw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQwODo1NToxM1rOIFF9uw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjIxMTUxNQ==", "bodyText": "enum please", "url": "https://github.com/hortonworks/cloudbreak/pull/9620#discussion_r542211515", "createdAt": "2020-12-14T08:55:13Z", "author": {"login": "doktoric"}, "path": "environment/src/main/java/com/sequenceiq/environment/network/dao/domain/BaseNetwork.java", "diffHunk": "@@ -169,6 +175,23 @@ public void setSubnetMetas(Map<String, CloudSubnet> subnetMetas) {\n         });\n     }\n \n+    public boolean isUsePublicEndpointAccessGateway() {\n+        return usePublicEndpointAccessGateway;\n+    }\n+\n+    public void setUsePublicEndpointAccessGateway(boolean usePublicEndpointAccessGateway) {\n+        this.usePublicEndpointAccessGateway = usePublicEndpointAccessGateway;\n+    }\n+\n+    public void setEndpointGatewaySubnetMetas(Map<String, CloudSubnet> endpointGatewaySubnetMetas) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "41e55e6bd5de0b37bf0ec078991bd80303e2f5d5"}, "originalPosition": 25}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "41e55e6bd5de0b37bf0ec078991bd80303e2f5d5", "author": {"user": {"login": "hreeve-cloudera", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/41e55e6bd5de0b37bf0ec078991bd80303e2f5d5", "committedDate": "2020-12-10T18:08:49Z", "message": "CB-10242 API changes to support semi-private networks\n\nAdds new optional fields 'usePublicEndpointAccessGateway' and\n'endpointGatewaySubnetIds' to the EnvironmentNetworkV1Request API object. These\nfields are persisted to the EnvironmentNetwork and NetworkDto BaseNetwork\nobjects. Adds new columns for these fields to the environment_network table\nand saves them to the database.\n\nTested with unit tests, and by manually setting the new fields in the IDE and\nverifying they were converted/persisted in the database correctly."}, "afterCommit": {"oid": "9dca75f436b7eb17c699b40458fc5f826ecda1be", "author": {"user": {"login": "hreeve-cloudera", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/9dca75f436b7eb17c699b40458fc5f826ecda1be", "committedDate": "2020-12-14T22:45:59Z", "message": "CB-10242 API changes to support semi-private networks\n\nAdds new optional fields 'publicEndpointAccessGateway' and\n'endpointGatewaySubnetIds' to the EnvironmentNetworkV1Request API object. These\nfields are persisted to the EnvironmentNetwork and NetworkDto BaseNetwork\nobjects. Adds new columns for these fields to the environment_network table\nand saves them to the database.\n\nTested with unit tests, and by manually setting the new fields in the IDE and\nverifying they were converted/persisted in the database correctly."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b33c6f0c5aede8e2980deb8721c30623f81c0ad8", "author": {"user": {"login": "hreeve-cloudera", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/b33c6f0c5aede8e2980deb8721c30623f81c0ad8", "committedDate": "2020-12-14T23:03:37Z", "message": "CB-10242 API changes to support semi-private networks\n\nAdds new optional fields 'publicEndpointAccessGateway' and\n'endpointGatewaySubnetIds' to the EnvironmentNetworkV1Request API object. These\nfields are persisted to the EnvironmentNetwork and NetworkDto BaseNetwork\nobjects. Adds new columns for these fields to the environment_network table\nand saves them to the database.\n\nTested with unit tests, and by manually setting the new fields in the IDE and\nverifying they were converted/persisted in the database correctly."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9dca75f436b7eb17c699b40458fc5f826ecda1be", "author": {"user": {"login": "hreeve-cloudera", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/9dca75f436b7eb17c699b40458fc5f826ecda1be", "committedDate": "2020-12-14T22:45:59Z", "message": "CB-10242 API changes to support semi-private networks\n\nAdds new optional fields 'publicEndpointAccessGateway' and\n'endpointGatewaySubnetIds' to the EnvironmentNetworkV1Request API object. These\nfields are persisted to the EnvironmentNetwork and NetworkDto BaseNetwork\nobjects. Adds new columns for these fields to the environment_network table\nand saves them to the database.\n\nTested with unit tests, and by manually setting the new fields in the IDE and\nverifying they were converted/persisted in the database correctly."}, "afterCommit": {"oid": "b33c6f0c5aede8e2980deb8721c30623f81c0ad8", "author": {"user": {"login": "hreeve-cloudera", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/b33c6f0c5aede8e2980deb8721c30623f81c0ad8", "committedDate": "2020-12-14T23:03:37Z", "message": "CB-10242 API changes to support semi-private networks\n\nAdds new optional fields 'publicEndpointAccessGateway' and\n'endpointGatewaySubnetIds' to the EnvironmentNetworkV1Request API object. These\nfields are persisted to the EnvironmentNetwork and NetworkDto BaseNetwork\nobjects. Adds new columns for these fields to the environment_network table\nand saves them to the database.\n\nTested with unit tests, and by manually setting the new fields in the IDE and\nverifying they were converted/persisted in the database correctly."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUyNjE0OTE0", "url": "https://github.com/hortonworks/cloudbreak/pull/9620#pullrequestreview-552614914", "createdAt": "2020-12-15T16:03:25Z", "commit": {"oid": "b33c6f0c5aede8e2980deb8721c30623f81c0ad8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1965, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}