{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY3OTU2NTM3", "number": 8818, "title": "CB-8412 Gracefully fail if gateway metadata missing during repair", "bodyText": "Azure DL master repair failed due to missing instance metadata:\nError during execution of com.sequenceiq.cloudbreak.core.flow2.stack.upscale.StackUpscaleActions$5 java.lang.NullPointerException: null at com.sequenceiq.cloudbreak.converter.spi.InstanceMetaDataToCloudInstanceConverter.convert(InstanceMetaDataToCloudInstanceConverter.java:34)\nAzure did not respond with VM data for some reason:\nAugust 12th 2020, 08:32:40.293 | 2020-08-12 06:32:40,293 [reactorDispatcher-93] hasMissingVm:85 INFO  c.s.c.c.a.AzureVirtualMachineService - [...] Fetched VM id-s ([]) do not contain one of the following id-s: [azure-test-d79e97e7d96d4624b1f6d47c385c64090m2]\nAugust 12th 2020, 08:32:40.293 | 2020-08-12 06:32:40,293 [reactorDispatcher-93] hasMissingVm:85 INFO  c.s.c.c.a.AzureVirtualMachineService - [...] Fetched VM id-s ([]) do not contain one of the following id-s: [azure-test-d79e97e7d96d4624b1f6d47c385c64090m2]\nAugust 12th 2020, 08:32:40.293 | 2020-08-12 06:32:40,293 [reactorDispatcher-93] validateResponse:98 WARN  c.s.c.c.a.AzureVirtualMachineService - [...] Failed to retrieve all host from Azure. Only 0 found from the 1.\nSince we are upscaling with best effort policy, this should not result in instant failure, however in case of gateway repair it is, and our error message should be clear.", "createdAt": "2020-08-14T12:27:23Z", "url": "https://github.com/hortonworks/cloudbreak/pull/8818", "merged": true, "mergeCommit": {"oid": "0e2ee78c0bcfb002a81a984f31ffc6077dd4ce45"}, "closed": true, "closedAt": "2020-08-24T08:50:55Z", "author": {"login": "daszabo"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc-0HM7gBqjM2NTYxMTEwNzQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdB98eAgBqjM2ODQyMjAwNjg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e2cd791e32151977d59f312d2573dc93b6845f8c", "author": {"user": {"login": "daszabo", "name": "David Szabo"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/e2cd791e32151977d59f312d2573dc93b6845f8c", "committedDate": "2020-08-14T12:18:57Z", "message": "CB-8412 Gracefully fail if gateway metadata missing during repair"}, "afterCommit": {"oid": "c050b89831e8ae405f103934ef8454c3766987e2", "author": {"user": {"login": "daszabo", "name": "David Szabo"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/c050b89831e8ae405f103934ef8454c3766987e2", "committedDate": "2020-08-14T12:51:57Z", "message": "CB-8412 Gracefully fail if gateway metadata missing during repair"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY3NTUwNjcz", "url": "https://github.com/hortonworks/cloudbreak/pull/8818#pullrequestreview-467550673", "createdAt": "2020-08-14T12:54:41Z", "commit": {"oid": "c050b89831e8ae405f103934ef8454c3766987e2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxMjo1NDo0MlrOHAzfSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQxMjo1NDo0MlrOHAzfSw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDYwNTY0Mw==", "bodyText": "Can we indicate that the gateway metadata could not be got from the provider side?", "url": "https://github.com/hortonworks/cloudbreak/pull/8818#discussion_r470605643", "createdAt": "2020-08-14T12:54:42Z", "author": {"login": "biharitomi"}, "path": "core/src/main/java/com/sequenceiq/cloudbreak/core/flow2/stack/upscale/StackUpscaleActions.java", "diffHunk": "@@ -214,6 +215,9 @@ protected void doExecute(StackScalingFlowContext context, CollectMetadataResult\n                 if (InstanceGroupType.GATEWAY == ig.getInstanceGroupType()) {\n                     Stack stack = stackService.getByIdWithListsInTransaction(context.getStack().getId());\n                     InstanceMetaData gatewayMetaData = stack.getPrimaryGatewayInstance();\n+                    if (null == gatewayMetaData && isRepair(variables)) {\n+                        throw new CloudbreakServiceException(\"Could not get instance metadata from the cloud provider.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c050b89831e8ae405f103934ef8454c3766987e2"}, "originalPosition": 13}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c050b89831e8ae405f103934ef8454c3766987e2", "author": {"user": {"login": "daszabo", "name": "David Szabo"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/c050b89831e8ae405f103934ef8454c3766987e2", "committedDate": "2020-08-14T12:51:57Z", "message": "CB-8412 Gracefully fail if gateway metadata missing during repair"}, "afterCommit": {"oid": "ac3d98a9498b55218c8c4f5f75ca14fe6aa690e0", "author": {"user": {"login": "daszabo", "name": "David Szabo"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/ac3d98a9498b55218c8c4f5f75ca14fe6aa690e0", "committedDate": "2020-08-14T16:20:57Z", "message": "CB-8412 Gracefully fail if gateway metadata missing during repair"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY4MDAyNjQw", "url": "https://github.com/hortonworks/cloudbreak/pull/8818#pullrequestreview-468002640", "createdAt": "2020-08-15T16:10:20Z", "commit": {"oid": "ac3d98a9498b55218c8c4f5f75ca14fe6aa690e0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7e857ecb8a5c9ef65c8385d1186ee0ccb9b64c86", "author": {"user": {"login": "daszabo", "name": "David Szabo"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/7e857ecb8a5c9ef65c8385d1186ee0ccb9b64c86", "committedDate": "2020-08-24T08:01:08Z", "message": "CB-8412 Gracefully fail if gateway metadata missing during repair"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ac3d98a9498b55218c8c4f5f75ca14fe6aa690e0", "author": {"user": {"login": "daszabo", "name": "David Szabo"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/ac3d98a9498b55218c8c4f5f75ca14fe6aa690e0", "committedDate": "2020-08-14T16:20:57Z", "message": "CB-8412 Gracefully fail if gateway metadata missing during repair"}, "afterCommit": {"oid": "7e857ecb8a5c9ef65c8385d1186ee0ccb9b64c86", "author": {"user": {"login": "daszabo", "name": "David Szabo"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/7e857ecb8a5c9ef65c8385d1186ee0ccb9b64c86", "committedDate": "2020-08-24T08:01:08Z", "message": "CB-8412 Gracefully fail if gateway metadata missing during repair"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2479, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}