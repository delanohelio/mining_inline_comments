{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE3ODQ1MzM4", "number": 8048, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQxMDozODozNlrOD-jVhQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQxMDozOTowOVrOD-jV8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY2OTE3MjUzOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/com/sequenceiq/cloudbreak/repository/StackRepository.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQxMDozODozNlrOGYuMyw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQxMDo0NDoyNVrOGYuVng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODU3NTk0Nw==", "bodyText": "findAliveOnesWithAmbari -> findAliveOnesWithClusterManager", "url": "https://github.com/hortonworks/cloudbreak/pull/8048#discussion_r428575947", "createdAt": "2020-05-21T10:38:36Z", "author": {"login": "doktoric"}, "path": "core/src/main/java/com/sequenceiq/cloudbreak/repository/StackRepository.java", "diffHunk": "@@ -172,8 +175,7 @@\n             + \"WHERE ig.instanceGroupType = 'GATEWAY' \"\n             + \"AND im.instanceMetadataType = 'GATEWAY_PRIMARY' \"\n             + \"AND s.terminated = null \"\n-            + \"AND c.clusterManagerIp IS NOT NULL \"\n-            + \"AND c.status = 'AVAILABLE' \"\n+            + \"AND c.status in ('AVAILABLE', 'REQUESTED', 'UPDATE_IN_PROGRESS') \"\n             + \"AND (s.type is not 'TEMPLATE' OR s.type is null)\")\n     Set<AutoscaleStack> findAliveOnesWithAmbari();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5d7ac7c895068f8d20f2d5f4f0e0965c3a756df9"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODU3ODIwNg==", "bodyText": "ack", "url": "https://github.com/hortonworks/cloudbreak/pull/8048#discussion_r428578206", "createdAt": "2020-05-21T10:44:25Z", "author": {"login": "smaniraju"}, "path": "core/src/main/java/com/sequenceiq/cloudbreak/repository/StackRepository.java", "diffHunk": "@@ -172,8 +175,7 @@\n             + \"WHERE ig.instanceGroupType = 'GATEWAY' \"\n             + \"AND im.instanceMetadataType = 'GATEWAY_PRIMARY' \"\n             + \"AND s.terminated = null \"\n-            + \"AND c.clusterManagerIp IS NOT NULL \"\n-            + \"AND c.status = 'AVAILABLE' \"\n+            + \"AND c.status in ('AVAILABLE', 'REQUESTED', 'UPDATE_IN_PROGRESS') \"\n             + \"AND (s.type is not 'TEMPLATE' OR s.type is null)\")\n     Set<AutoscaleStack> findAliveOnesWithAmbari();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODU3NTk0Nw=="}, "originalCommit": {"oid": "5d7ac7c895068f8d20f2d5f4f0e0965c3a756df9"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY2OTE3MzE4OnYy", "diffSide": "LEFT", "path": "core/src/main/java/com/sequenceiq/cloudbreak/service/StackCommonService.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQxMDozODo1MlrOGYuNQA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQxMTowNzowNlrOGYu5-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODU3NjA2NA==", "bodyText": "why we removed this ?", "url": "https://github.com/hortonworks/cloudbreak/pull/8048#discussion_r428576064", "createdAt": "2020-05-21T10:38:52Z", "author": {"login": "doktoric"}, "path": "core/src/main/java/com/sequenceiq/cloudbreak/service/StackCommonService.java", "diffHunk": "@@ -254,7 +253,6 @@ public GeneratedBlueprintV4Response postStackForBlueprint(StackV4Request stackRe\n         return response;\n     }\n \n-    @PreAuthorize(\"hasRole('AUTOSCALE')\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5d7ac7c895068f8d20f2d5f4f0e0965c3a756df9"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODU4NzUxNQ==", "bodyText": "AutoscaleV4Controller::getCertificate already has @PreAuthorize(\"hasRole('AUTOSCALE')\"). Hence this was duplicate check.", "url": "https://github.com/hortonworks/cloudbreak/pull/8048#discussion_r428587515", "createdAt": "2020-05-21T11:07:06Z", "author": {"login": "smaniraju"}, "path": "core/src/main/java/com/sequenceiq/cloudbreak/service/StackCommonService.java", "diffHunk": "@@ -254,7 +253,6 @@ public GeneratedBlueprintV4Response postStackForBlueprint(StackV4Request stackRe\n         return response;\n     }\n \n-    @PreAuthorize(\"hasRole('AUTOSCALE')\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODU3NjA2NA=="}, "originalCommit": {"oid": "5d7ac7c895068f8d20f2d5f4f0e0965c3a756df9"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY2OTE3MzYzOnYy", "diffSide": "LEFT", "path": "core/src/main/java/com/sequenceiq/cloudbreak/service/stack/StackService.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQxMDozOTowOVrOGYuNhg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQxMTowOTo0MlrOGYu-lA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODU3NjEzNA==", "bodyText": "why we removed this?", "url": "https://github.com/hortonworks/cloudbreak/pull/8048#discussion_r428576134", "createdAt": "2020-05-21T10:39:09Z", "author": {"login": "doktoric"}, "path": "core/src/main/java/com/sequenceiq/cloudbreak/service/stack/StackService.java", "diffHunk": "@@ -261,18 +259,6 @@ public StackClusterStatusView getStatusByNameOrCrn(NameOrCrn nameOrCrn, Long wor\n         return foundStack.orElseThrow(() -> new NotFoundException(String.format(STACK_NOT_FOUND_BY_NAME_OR_CRN_EXCEPTION_MESSAGE, nameOrCrn)));\n     }\n \n-    @PreAuthorize(\"hasRole('AUTOSCALE')\")\n-    public Long getWorkspaceId(String crn) {\n-        return stackRepository.findWorkspaceIdByCrn(crn);\n-    }\n-\n-    @PreAuthorize(\"hasRole('AUTOSCALE')\")\n-    public Tenant getTenant(String crn) {\n-        Workspace workspace = stackRepository.findWorkspaceByCrn(crn).orElseThrow(notFound(\"workspace\", crn));\n-        return workspace.getTenant();\n-    }\n-\n-    @PreAuthorize(\"hasRole('AUTOSCALE')\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5d7ac7c895068f8d20f2d5f4f0e0965c3a756df9"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODU4ODY5Mg==", "bodyText": "This was again duplicate check, since AutoscaleV4Controller::getAllForAutoscale has     @PreAuthorize(\"hasRole('AUTOSCALE')\"). The remaining two methods getTenant/getWorkspaceId was only used in AutoscaleV4Controller flow.", "url": "https://github.com/hortonworks/cloudbreak/pull/8048#discussion_r428588692", "createdAt": "2020-05-21T11:09:42Z", "author": {"login": "smaniraju"}, "path": "core/src/main/java/com/sequenceiq/cloudbreak/service/stack/StackService.java", "diffHunk": "@@ -261,18 +259,6 @@ public StackClusterStatusView getStatusByNameOrCrn(NameOrCrn nameOrCrn, Long wor\n         return foundStack.orElseThrow(() -> new NotFoundException(String.format(STACK_NOT_FOUND_BY_NAME_OR_CRN_EXCEPTION_MESSAGE, nameOrCrn)));\n     }\n \n-    @PreAuthorize(\"hasRole('AUTOSCALE')\")\n-    public Long getWorkspaceId(String crn) {\n-        return stackRepository.findWorkspaceIdByCrn(crn);\n-    }\n-\n-    @PreAuthorize(\"hasRole('AUTOSCALE')\")\n-    public Tenant getTenant(String crn) {\n-        Workspace workspace = stackRepository.findWorkspaceByCrn(crn).orElseThrow(notFound(\"workspace\", crn));\n-        return workspace.getTenant();\n-    }\n-\n-    @PreAuthorize(\"hasRole('AUTOSCALE')\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODU3NjEzNA=="}, "originalCommit": {"oid": "5d7ac7c895068f8d20f2d5f4f0e0965c3a756df9"}, "originalPosition": 31}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3310, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}