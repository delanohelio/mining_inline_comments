{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI4MTg5MDQ5", "number": 9532, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQxOTo1MjoxMVrOE9v06g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQwNzoyODoxMVrOE-hlqg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMzMTgyMTg2OnYy", "diffSide": "RIGHT", "path": "freeipa/src/main/resources/freeipa-salt/salt/ccm/scripts/socket-wait-cleanup.sh", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNlQxOTo1MjoxMVrOH6mPVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQwOToxODozM1rOH7yAWQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTIwNTk3Mw==", "bodyText": "what if an another service will do this (does not close connections properly), will this restart CCM service?\ncan we check that as well these sockets are all CCM related in the script (you should be able to match process id against the open connections)?", "url": "https://github.com/hortonworks/cloudbreak/pull/9532#discussion_r531205973", "createdAt": "2020-11-26T19:52:11Z", "author": {"login": "oleewere"}, "path": "freeipa/src/main/resources/freeipa-salt/salt/ccm/scripts/socket-wait-cleanup.sh", "diffHunk": "@@ -0,0 +1,11 @@\n+#!/usr/bin/env bash\n+\n+: \"${SOCKET_WAIT_LIMIT:=1000}\"\n+socket_wait_count=$(netstat -nat | egrep 'CLOSE_WAIT' | wc -l)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cfa3ac18305c41a48179a96582e53055c586e0a7"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjQ0NzMyMQ==", "bodyText": "PR was updated, please check. Relevant part:\nsocket_wait_count=$(netstat -nat -p | grep ':9443|:443' | grep CLOSE_WAIT | wc -l)", "url": "https://github.com/hortonworks/cloudbreak/pull/9532#discussion_r532447321", "createdAt": "2020-11-30T09:18:33Z", "author": {"login": "sodre90"}, "path": "freeipa/src/main/resources/freeipa-salt/salt/ccm/scripts/socket-wait-cleanup.sh", "diffHunk": "@@ -0,0 +1,11 @@\n+#!/usr/bin/env bash\n+\n+: \"${SOCKET_WAIT_LIMIT:=1000}\"\n+socket_wait_count=$(netstat -nat | egrep 'CLOSE_WAIT' | wc -l)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMTIwNTk3Mw=="}, "originalCommit": {"oid": "cfa3ac18305c41a48179a96582e53055c586e0a7"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMzOTk3NDgyOnYy", "diffSide": "RIGHT", "path": "orchestrator-salt/src/main/resources/salt/salt/top.sls", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQwNzoyODoxMVrOH7ukWA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQwNzoyODoxMVrOH7ukWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjM5MTAwMA==", "bodyText": "I think we should add the script only if CCM is enabled, so the state should be role dependent. Also only gateway nodes configured for CCM if I remember well, so we should not add this to every node", "url": "https://github.com/hortonworks/cloudbreak/pull/9532#discussion_r532391000", "createdAt": "2020-11-30T07:28:11Z", "author": {"login": "lacikaaa"}, "path": "orchestrator-salt/src/main/resources/salt/salt/top.sls", "diffHunk": "@@ -11,6 +11,7 @@ base:\n     - metering\n     - ntp\n     - postgresql.root-certs\n+    - ccm", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cfa3ac18305c41a48179a96582e53055c586e0a7"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3534, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}