{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAwODQ4NjE4", "number": 7761, "title": "CB-6380. Do not persist telemetry component for stack with template type", "bodyText": "do not add telemetry component for stacks with type 'TEMPLATE'\nremove already existing ones from DB\n\ntested against dtahub deployments with default cluster definitions + custom ones", "createdAt": "2020-04-08T13:28:20Z", "url": "https://github.com/hortonworks/cloudbreak/pull/7761", "merged": true, "mergeCommit": {"oid": "04440939bb01fd5a741a1019a06dc9aa86d09fec"}, "closed": true, "closedAt": "2020-04-09T13:29:52Z", "author": {"login": "oleewere"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcVoQzhgFqTM4OTk5NTg3OA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcV8hksAFqTM5MDc5MjAxOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg5OTk1ODc4", "url": "https://github.com/hortonworks/cloudbreak/pull/7761#pullrequestreview-389995878", "createdAt": "2020-04-08T13:53:02Z", "commit": {"oid": "21f2e53a3469742dc902b9d13032fac60a2df864"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxMzo1MzowM1rOGCwU5A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxMzo1MzowM1rOGCwU5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTU0MjExNg==", "bodyText": "Should this be done only for stacks that are already deleted?", "url": "https://github.com/hortonworks/cloudbreak/pull/7761#discussion_r405542116", "createdAt": "2020-04-08T13:53:03Z", "author": {"login": "lnardai"}, "path": "core/src/main/resources/schema/app/20200408152731_CB-6380_Do_not_persist_telemetry_for_stack_template.sql", "diffHunk": "@@ -0,0 +1,7 @@\n+-- // CB-6380 Do not persist telemetry component for stack with template type\n+-- Migration SQL that makes the change goes here.\n+\n+DELETE FROM component WHERE componenttype = 'TELEMETRY' AND stack_id IN (SELECT id FROM stack WHERE type = 'TEMPLATE')", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21f2e53a3469742dc902b9d13032fac60a2df864"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwNzI0NDU5", "url": "https://github.com/hortonworks/cloudbreak/pull/7761#pullrequestreview-390724459", "createdAt": "2020-04-09T11:53:29Z", "commit": {"oid": "21f2e53a3469742dc902b9d13032fac60a2df864"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxMTo1MzoyOVrOGDVdxQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOVQxMTo1MzoyOVrOGDVdxQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjE1MDU5Nw==", "bodyText": "can you move into the else branch? or inside to convertAsStack(source, stack)", "url": "https://github.com/hortonworks/cloudbreak/pull/7761#discussion_r406150597", "createdAt": "2020-04-09T11:53:29Z", "author": {"login": "topolyai5"}, "path": "core/src/main/java/com/sequenceiq/cloudbreak/converter/v4/stacks/StackV4RequestToStackConverter.java", "diffHunk": "@@ -139,8 +139,9 @@ public Stack convert(StackV4Request source) {\n         stack.setInstanceGroups(convertInstanceGroups(source, stack));\n         measure(() -> updateCluster(source, stack, workspace),\n                 LOGGER, \"Converted cluster and updated the stack in {} ms for stack {}\", source.getName());\n-        stack.getComponents().add(getTelemetryComponent(stack, source));\n-\n+        if (!isTemplate(source)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21f2e53a3469742dc902b9d13032fac60a2df864"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d8cddd881245b0b8298d626c7f9e61c742f094e1", "author": {"user": {"login": "oleewere", "name": "Oliv\u00e9r Szabo"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/d8cddd881245b0b8298d626c7f9e61c742f094e1", "committedDate": "2020-04-09T12:13:30Z", "message": "CB-6380. Do not persist telemetry component for stack with template type."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "21f2e53a3469742dc902b9d13032fac60a2df864", "author": {"user": {"login": "oleewere", "name": "Oliv\u00e9r Szabo"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/21f2e53a3469742dc902b9d13032fac60a2df864", "committedDate": "2020-04-08T13:26:10Z", "message": "CB-6380. Do not persist telemetry component for stack with template type."}, "afterCommit": {"oid": "d8cddd881245b0b8298d626c7f9e61c742f094e1", "author": {"user": {"login": "oleewere", "name": "Oliv\u00e9r Szabo"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/d8cddd881245b0b8298d626c7f9e61c742f094e1", "committedDate": "2020-04-09T12:13:30Z", "message": "CB-6380. Do not persist telemetry component for stack with template type."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwNzkyMDE4", "url": "https://github.com/hortonworks/cloudbreak/pull/7761#pullrequestreview-390792018", "createdAt": "2020-04-09T13:29:28Z", "commit": {"oid": "d8cddd881245b0b8298d626c7f9e61c742f094e1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2298, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}