{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk5NTI3NjE3", "number": 9165, "title": "CB-8923 Introduce a custom JUnit XML Report Listener", "bodyText": "Introduce a custom JUnit XML Report Listener to override the original ReportNG one. So we can solve the issue: we cannot check the details with the 'Show/Hide Errors'\nBeyond this I customised the tests.name at the test suite YAML files, because of the TestNG generated XML results are saved with the same file name. On the Jenkins these caused troubles with spaces in the names.", "createdAt": "2020-10-07T21:29:43Z", "url": "https://github.com/hortonworks/cloudbreak/pull/9165", "merged": true, "mergeCommit": {"oid": "6b9295fcd18142eb0795e73451488431765bf4fb"}, "closed": true, "closedAt": "2020-10-09T13:30:37Z", "author": {"login": "aszegedi"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdQdV-CABqjM4NTQxOTAyNDI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdQ2I-ZAFqTUwNTY2OTA3OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "15d0fd1dd11c205b8af095eee82a5a5fa8f360a3", "author": {"user": {"login": "aszegedi", "name": "Annamaria Szegedi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/15d0fd1dd11c205b8af095eee82a5a5fa8f360a3", "committedDate": "2020-10-07T21:21:59Z", "message": "CB-8923 Introduce a custom JUnit XML Report Listener"}, "afterCommit": {"oid": "d656bb71165734ab703a500372467544e0e338a6", "author": {"user": {"login": "aszegedi", "name": "Annamaria Szegedi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/d656bb71165734ab703a500372467544e0e338a6", "committedDate": "2020-10-08T08:30:54Z", "message": "CB-8923 Introduce a custom JUnit XML Report Listener"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA0NTY1OTQy", "url": "https://github.com/hortonworks/cloudbreak/pull/9165#pullrequestreview-504565942", "createdAt": "2020-10-08T08:54:33Z", "commit": {"oid": "d656bb71165734ab703a500372467544e0e338a6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQwODo1NDozM1rOHeUgdw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQwODo1NDozM1rOHeUgdw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTU1NTMxOQ==", "bodyText": "What does status 2 mean? Why 2 exactly?", "url": "https://github.com/hortonworks/cloudbreak/pull/9165#discussion_r501555319", "createdAt": "2020-10-08T08:54:33Z", "author": {"login": "lnardai"}, "path": "integration-test/src/main/java/com/sequenceiq/it/cloudbreak/context/TestContext.java", "diffHunk": "@@ -1133,6 +1139,29 @@ public void handleExceptionsDuringTest(TestErrorLog testErrorLog) {\n             String errorMessage = errorLogMessageProvider.getMessage(exceptionMap, clues);\n             testErrorLog.report(LOGGER, errorMessage);\n \n+            ITestResult testResult = Reporter.getCurrentTestResult();\n+            Throwable testFailException = errorLogMessageProvider.getException(exceptionMap);\n+\n+            if (testFailException != null) {\n+                testResult.setThrowable(testFailException);\n+                testResult.setTestName(getTestMethodName().get());\n+                testResult.setStatus(2);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d656bb71165734ab703a500372467544e0e338a6"}, "originalPosition": 30}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA0NjIxMjQ3", "url": "https://github.com/hortonworks/cloudbreak/pull/9165#pullrequestreview-504621247", "createdAt": "2020-10-08T10:01:05Z", "commit": {"oid": "d656bb71165734ab703a500372467544e0e338a6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQxMDowMTowNlrOHeXGEg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQxMDowMTowNlrOHeXGEg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTU5NzcxNA==", "bodyText": "Just asking, would this work correctly with parallel runs since it's static?", "url": "https://github.com/hortonworks/cloudbreak/pull/9165#discussion_r501597714", "createdAt": "2020-10-08T10:01:06Z", "author": {"login": "lnardai"}, "path": "integration-test/src/main/java/com/sequenceiq/it/cloudbreak/listener/ReportListener.java", "diffHunk": "@@ -24,23 +23,31 @@\n \n     public static final String MEASUREMENTS = \"measurements\";\n \n-    private static final Logger LOGGER = LoggerFactory.getLogger(ReportListener.class);\n-\n     @Override\n     public void onTestFailure(ITestResult tr) {\n-        super.onTestFailure(tr);\n         logUrl(tr);\n         logMeasurements(tr);\n         log(tr);\n+        Reporter.setCurrentTestResult(tr);\n+        super.onTestFailure(tr);\n     }\n \n     @Override\n     public void onTestSuccess(ITestResult tr) {\n         logUrl(tr);\n         logMeasurements(tr);\n+        Reporter.setCurrentTestResult(tr);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d656bb71165734ab703a500372467544e0e338a6"}, "originalPosition": 31}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d656bb71165734ab703a500372467544e0e338a6", "author": {"user": {"login": "aszegedi", "name": "Annamaria Szegedi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/d656bb71165734ab703a500372467544e0e338a6", "committedDate": "2020-10-08T08:30:54Z", "message": "CB-8923 Introduce a custom JUnit XML Report Listener"}, "afterCommit": {"oid": "5f09fb397572cbea28c0f2d6c2fb1d0fc7232ba4", "author": {"user": {"login": "aszegedi", "name": "Annamaria Szegedi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/5f09fb397572cbea28c0f2d6c2fb1d0fc7232ba4", "committedDate": "2020-10-08T12:16:58Z", "message": "CB-8923 Introduce a custom JUnit XML Report Listener"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5f09fb397572cbea28c0f2d6c2fb1d0fc7232ba4", "author": {"user": {"login": "aszegedi", "name": "Annamaria Szegedi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/5f09fb397572cbea28c0f2d6c2fb1d0fc7232ba4", "committedDate": "2020-10-08T12:16:58Z", "message": "CB-8923 Introduce a custom JUnit XML Report Listener"}, "afterCommit": {"oid": "eae0d4f62fb6295abf6aa5fb8442944240bc6ff2", "author": {"user": {"login": "aszegedi", "name": "Annamaria Szegedi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/eae0d4f62fb6295abf6aa5fb8442944240bc6ff2", "committedDate": "2020-10-08T12:17:34Z", "message": "CB-8923 Introduce a custom JUnit XML Report Listener"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "eae0d4f62fb6295abf6aa5fb8442944240bc6ff2", "author": {"user": {"login": "aszegedi", "name": "Annamaria Szegedi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/eae0d4f62fb6295abf6aa5fb8442944240bc6ff2", "committedDate": "2020-10-08T12:17:34Z", "message": "CB-8923 Introduce a custom JUnit XML Report Listener"}, "afterCommit": {"oid": "427c6a621e221df3ee5878fcb68243a1190af44e", "author": {"user": {"login": "aszegedi", "name": "Annamaria Szegedi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/427c6a621e221df3ee5878fcb68243a1190af44e", "committedDate": "2020-10-08T12:31:05Z", "message": "CB-8923 Introduce a custom JUnit XML Report Listener"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "427c6a621e221df3ee5878fcb68243a1190af44e", "author": {"user": {"login": "aszegedi", "name": "Annamaria Szegedi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/427c6a621e221df3ee5878fcb68243a1190af44e", "committedDate": "2020-10-08T12:31:05Z", "message": "CB-8923 Introduce a custom JUnit XML Report Listener"}, "afterCommit": {"oid": "947cf142473c693ae5156a84645271e2d73fcd21", "author": {"user": {"login": "aszegedi", "name": "Annamaria Szegedi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/947cf142473c693ae5156a84645271e2d73fcd21", "committedDate": "2020-10-08T21:18:53Z", "message": "CB-8923 Introduce a custom JUnit XML Report Listener"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb8d958c45f194fa0e5f4a129c3d21dbc310360b", "author": {"user": {"login": "aszegedi", "name": "Annamaria Szegedi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/fb8d958c45f194fa0e5f4a129c3d21dbc310360b", "committedDate": "2020-10-08T21:19:30Z", "message": "CB-8923 Introduce a custom JUnit XML Report Listener"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "947cf142473c693ae5156a84645271e2d73fcd21", "author": {"user": {"login": "aszegedi", "name": "Annamaria Szegedi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/947cf142473c693ae5156a84645271e2d73fcd21", "committedDate": "2020-10-08T21:18:53Z", "message": "CB-8923 Introduce a custom JUnit XML Report Listener"}, "afterCommit": {"oid": "fb8d958c45f194fa0e5f4a129c3d21dbc310360b", "author": {"user": {"login": "aszegedi", "name": "Annamaria Szegedi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/fb8d958c45f194fa0e5f4a129c3d21dbc310360b", "committedDate": "2020-10-08T21:19:30Z", "message": "CB-8923 Introduce a custom JUnit XML Report Listener"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1NjYzNjY0", "url": "https://github.com/hortonworks/cloudbreak/pull/9165#pullrequestreview-505663664", "createdAt": "2020-10-09T13:18:08Z", "commit": {"oid": "fb8d958c45f194fa0e5f4a129c3d21dbc310360b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQxMzoxODowOFrOHfJUVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQxMzoxODowOFrOHfJUVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjQyMDU2Ng==", "bodyText": "This will only show the first exception that we encounter in the test, is that correct?\nOr we are specifically looking for this type of exceptions among them?\nIf so this method should be rather, findFirstTestFailException.", "url": "https://github.com/hortonworks/cloudbreak/pull/9165#discussion_r502420566", "createdAt": "2020-10-09T13:18:08Z", "author": {"login": "lnardai"}, "path": "integration-test/src/main/java/com/sequenceiq/it/cloudbreak/util/ErrorLogMessageProvider.java", "diffHunk": "@@ -22,6 +23,13 @@\n \n     private static final ObjectWriter OBJECT_WRITER = new ObjectMapper().writerWithDefaultPrettyPrinter();\n \n+    public Throwable getException(Map<String, Exception> exceptionsDuringTest) {\n+        return exceptionsDuringTest.values().stream()\n+                .filter(exception -> exception.getCause() instanceof TestFailException)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fb8d958c45f194fa0e5f4a129c3d21dbc310360b"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1NjY0Mjkz", "url": "https://github.com/hortonworks/cloudbreak/pull/9165#pullrequestreview-505664293", "createdAt": "2020-10-09T13:18:56Z", "commit": {"oid": "fb8d958c45f194fa0e5f4a129c3d21dbc310360b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQxMzoxODo1NlrOHfJWAg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQxMzoxODo1NlrOHfJWAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjQyMDk5NA==", "bodyText": "I think this will require changes in jenkins for all jobs right? or we only use the top level suite name?", "url": "https://github.com/hortonworks/cloudbreak/pull/9165#discussion_r502420994", "createdAt": "2020-10-09T13:18:56Z", "author": {"login": "lnardai"}, "path": "integration-test/src/main/resources/testsuites/e2e/aws-distrox-baseimage-tests.yaml", "diffHunk": "@@ -1,5 +1,5 @@\n name: \"aws-distrox-baseimage-tests\"\n tests:\n-  - name: \"aws distrox e2e base image tests\"\n+  - name: \"aws_distrox_e2e_base_image_tests\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fb8d958c45f194fa0e5f4a129c3d21dbc310360b"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1NjY5MDc5", "url": "https://github.com/hortonworks/cloudbreak/pull/9165#pullrequestreview-505669079", "createdAt": "2020-10-09T13:24:42Z", "commit": {"oid": "fb8d958c45f194fa0e5f4a129c3d21dbc310360b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2113, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}