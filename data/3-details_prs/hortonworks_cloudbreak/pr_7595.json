{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg5MjQ0MDU4", "number": 7595, "title": "CB-5734 Introduce Load Based Alert Endpoint", "bodyText": "CB-5734 Introduce Load Based Alert Endpoint for DataHub AutoScaling\nCloses #CB-5734", "createdAt": "2020-03-16T13:42:43Z", "url": "https://github.com/hortonworks/cloudbreak/pull/7595", "merged": true, "mergeCommit": {"oid": "fa3a08b7584e4397bb3a3b497c1564fe8382b7e1"}, "closed": true, "closedAt": "2020-03-20T14:04:04Z", "author": {"login": "smaniraju"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcOdBXxAFqTM3NTcwMTU0Nw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcPgsNmABqjMxNDkzNjQ3NzU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1NzAxNTQ3", "url": "https://github.com/hortonworks/cloudbreak/pull/7595#pullrequestreview-375701547", "createdAt": "2020-03-17T02:37:25Z", "commit": {"oid": "559afe9b8e7a9652db6f2b69a345384363939692"}, "state": "COMMENTED", "comments": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QwMjozNzoyNVrOF3MBVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QwMzozMzozNlrOF3M4DA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzQxMjk0OQ==", "bodyText": "Is this new check valid for the other alert types?", "url": "https://github.com/hortonworks/cloudbreak/pull/7595#discussion_r393412949", "createdAt": "2020-03-17T02:37:25Z", "author": {"login": "sidseth"}, "path": "autoscale-api/src/main/java/com/sequenceiq/periscope/api/model/ScalingPolicyBase.java", "diffHunk": "@@ -16,15 +20,19 @@\n     private String name;\n \n     @ApiModelProperty(ScalingPolicyJsonProperties.ADJUSTMENTTYPE)\n+    @NotNull", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "559afe9b8e7a9652db6f2b69a345384363939692"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzQxMzI2Mw==", "bodyText": "Not in case of Cron, AdjustmentType.PERCENTAGE or AdjustmentType.NODE_COUNT -> (-20%). Shrink by 20%.", "url": "https://github.com/hortonworks/cloudbreak/pull/7595#discussion_r393413263", "createdAt": "2020-03-17T02:38:42Z", "author": {"login": "sidseth"}, "path": "autoscale-api/src/main/java/com/sequenceiq/periscope/api/model/ScalingPolicyBase.java", "diffHunk": "@@ -16,15 +20,19 @@\n     private String name;\n \n     @ApiModelProperty(ScalingPolicyJsonProperties.ADJUSTMENTTYPE)\n+    @NotNull\n     private AdjustmentType adjustmentType;\n \n     @ApiModelProperty(ScalingPolicyJsonProperties.SCALINGADJUSTMENT)\n+    @Positive", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "559afe9b8e7a9652db6f2b69a345384363939692"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzQxNzg0Ng==", "bodyText": "What does this 'id' represent? Will this be different from the 'id' inside the ScalingPolicyResponse object? Or is this the AlertId vs PolicyId?", "url": "https://github.com/hortonworks/cloudbreak/pull/7595#discussion_r393417846", "createdAt": "2020-03-17T02:57:55Z", "author": {"login": "sidseth"}, "path": "autoscale-api/src/main/java/com/sequenceiq/periscope/api/model/TimeAlertResponse.java", "diffHunk": "@@ -48,19 +45,11 @@ public void setId(Long id) {\n         this.id = id;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "559afe9b8e7a9652db6f2b69a345384363939692"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzQyMDM4Ng==", "bodyText": "Not exactly related to the review.\n\nWhat format TimeZone is supported?\nWhat format CRON expressions supported. It looks like the code allows expressions with a minimum of 3 entries.\nThese will eventually need to be documented.\nAlso will eventually need to add more error validation for the TimeZone, and other fields in general.", "url": "https://github.com/hortonworks/cloudbreak/pull/7595#discussion_r393420386", "createdAt": "2020-03-17T03:06:08Z", "author": {"login": "sidseth"}, "path": "autoscale-api/src/main/java/com/sequenceiq/periscope/api/model/TimeAlertRequest.java", "diffHunk": "@@ -12,9 +14,13 @@\n public class TimeAlertRequest extends AbstractAlertJson {\n \n     @ApiModelProperty(TimeAlertJsonProperties.TIMEZONE)\n+    @NotEmpty\n+    @Size(max = 50)\n     private String timeZone;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "559afe9b8e7a9652db6f2b69a345384363939692"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzQyMjg1MA==", "bodyText": "This error message is nice. However, when we start working with CRNs - this becomes problematic. This shouldn't show up to the end user. Are there other scenarios where this happens as well?", "url": "https://github.com/hortonworks/cloudbreak/pull/7595#discussion_r393422850", "createdAt": "2020-03-17T03:15:51Z", "author": {"login": "sidseth"}, "path": "autoscale/src/main/java/com/sequenceiq/periscope/controller/AlertController.java", "diffHunk": "@@ -175,4 +228,19 @@ private TimeAlertResponse createTimeAlertResponse(TimeAlert alarm) {\n     private PrometheusAlertResponse createPrometheusAlertResponse(PrometheusAlert alarm) {\n         return prometheusAlertResponseConverter.convert(alarm);\n     }\n+\n+    private void validateAlertForUpdate(Long clusterId, Long alertId, AlertType alertType) {\n+        BaseAlert alert;\n+        switch (alertType) {\n+            case LOAD:\n+                alert = alertService.findLoadAlertByCluster(clusterId, alertId);\n+                break;\n+            case TIME:\n+            default:\n+                alert = alertService.findTimeAlertByCluster(clusterId, alertId);\n+        }\n+        if (alert == null) {\n+            throw new NotFoundException(String.format(\"Could not find %s alert with id: '%s', for cluster: '%s'\", alertType, alertId, clusterId));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "559afe9b8e7a9652db6f2b69a345384363939692"}, "originalPosition": 120}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzQyMzI1OQ==", "bodyText": "May be worth adding a node here that this essentially breaks updates to metric / prometheus alerts (Yes - these will be disabled, but for future fixes - if someone decides to go update them)", "url": "https://github.com/hortonworks/cloudbreak/pull/7595#discussion_r393423259", "createdAt": "2020-03-17T03:17:38Z", "author": {"login": "sidseth"}, "path": "autoscale/src/main/java/com/sequenceiq/periscope/controller/AlertController.java", "diffHunk": "@@ -175,4 +228,19 @@ private TimeAlertResponse createTimeAlertResponse(TimeAlert alarm) {\n     private PrometheusAlertResponse createPrometheusAlertResponse(PrometheusAlert alarm) {\n         return prometheusAlertResponseConverter.convert(alarm);\n     }\n+\n+    private void validateAlertForUpdate(Long clusterId, Long alertId, AlertType alertType) {\n+        BaseAlert alert;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "559afe9b8e7a9652db6f2b69a345384363939692"}, "originalPosition": 110}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzQyMzc4NQ==", "bodyText": "Does this mean 'One Load Alert per Cluster', or 'One Alert per cluster' or something else?", "url": "https://github.com/hortonworks/cloudbreak/pull/7595#discussion_r393423785", "createdAt": "2020-03-17T03:20:04Z", "author": {"login": "sidseth"}, "path": "autoscale/src/main/java/com/sequenceiq/periscope/domain/LoadAlert.java", "diffHunk": "@@ -0,0 +1,28 @@\n+package com.sequenceiq.periscope.domain;\n+\n+import javax.persistence.DiscriminatorValue;\n+import javax.persistence.Entity;\n+import javax.persistence.NamedQueries;\n+import javax.persistence.NamedQuery;\n+import javax.persistence.OneToOne;\n+\n+@Entity\n+@DiscriminatorValue(\"LOAD\")\n+@NamedQueries({\n+        @NamedQuery(name = \"LoadAlert.findByCluster\", query = \"SELECT c FROM LoadAlert c WHERE c.cluster.id= :clusterId AND c.id= :alertId\"),\n+        @NamedQuery(name = \"LoadAlert.findAllByCluster\", query = \"SELECT c FROM LoadAlert c WHERE c.cluster.id= :clusterId\")\n+})\n+public class LoadAlert extends BaseAlert {\n+\n+    @OneToOne", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "559afe9b8e7a9652db6f2b69a345384363939692"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzQyMzkzNA==", "bodyText": "Add a Json text field for Configuration? Can be populated with defaults, or left empty for now.", "url": "https://github.com/hortonworks/cloudbreak/pull/7595#discussion_r393423934", "createdAt": "2020-03-17T03:20:38Z", "author": {"login": "sidseth"}, "path": "autoscale/src/main/java/com/sequenceiq/periscope/domain/LoadAlert.java", "diffHunk": "@@ -0,0 +1,28 @@\n+package com.sequenceiq.periscope.domain;\n+\n+import javax.persistence.DiscriminatorValue;\n+import javax.persistence.Entity;\n+import javax.persistence.NamedQueries;\n+import javax.persistence.NamedQuery;\n+import javax.persistence.OneToOne;\n+\n+@Entity\n+@DiscriminatorValue(\"LOAD\")\n+@NamedQueries({\n+        @NamedQuery(name = \"LoadAlert.findByCluster\", query = \"SELECT c FROM LoadAlert c WHERE c.cluster.id= :clusterId AND c.id= :alertId\"),\n+        @NamedQuery(name = \"LoadAlert.findAllByCluster\", query = \"SELECT c FROM LoadAlert c WHERE c.cluster.id= :clusterId\")\n+})\n+public class LoadAlert extends BaseAlert {\n+\n+    @OneToOne\n+    private Cluster cluster;\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "559afe9b8e7a9652db6f2b69a345384363939692"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzQyNjk1Ng==", "bodyText": "List for future enhancements?, where load alerts may be set on different hostgroups on a single cluster?", "url": "https://github.com/hortonworks/cloudbreak/pull/7595#discussion_r393426956", "createdAt": "2020-03-17T03:33:36Z", "author": {"login": "sidseth"}, "path": "autoscale/src/main/java/com/sequenceiq/periscope/converter/ClusterConverter.java", "diffHunk": "@@ -59,6 +63,11 @@ public AutoscaleClusterResponse convert(Cluster source) {\n             json.setPrometheusAlerts(prometheusAlertRequests);\n         }\n \n+        if (!source.getLoadAlerts().isEmpty()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "559afe9b8e7a9652db6f2b69a345384363939692"}, "originalPosition": 30}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "559afe9b8e7a9652db6f2b69a345384363939692", "author": {"user": {"login": "smaniraju", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/559afe9b8e7a9652db6f2b69a345384363939692", "committedDate": "2020-03-16T13:39:50Z", "message": "Introduce Load Based Alert Endpoint"}, "afterCommit": {"oid": "6754703bf01c5f4ced53e081020e13eac3994af9", "author": {"user": {"login": "smaniraju", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/6754703bf01c5f4ced53e081020e13eac3994af9", "committedDate": "2020-03-17T15:01:38Z", "message": "Introduce Load Based Alert Endpoint"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6754703bf01c5f4ced53e081020e13eac3994af9", "author": {"user": {"login": "smaniraju", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/6754703bf01c5f4ced53e081020e13eac3994af9", "committedDate": "2020-03-17T15:01:38Z", "message": "Introduce Load Based Alert Endpoint"}, "afterCommit": {"oid": "403d50e6a7f36ec2cbe46a328156d9a98c581930", "author": {"user": {"login": "smaniraju", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/403d50e6a7f36ec2cbe46a328156d9a98c581930", "committedDate": "2020-03-19T13:46:58Z", "message": "Introduce Load Based Alert Endpoint"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "403d50e6a7f36ec2cbe46a328156d9a98c581930", "author": {"user": {"login": "smaniraju", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/403d50e6a7f36ec2cbe46a328156d9a98c581930", "committedDate": "2020-03-19T13:46:58Z", "message": "Introduce Load Based Alert Endpoint"}, "afterCommit": {"oid": "b6b704b6e9bea51dfe895cbe9dda293467f1bc9e", "author": {"user": {"login": "smaniraju", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/b6b704b6e9bea51dfe895cbe9dda293467f1bc9e", "committedDate": "2020-03-19T15:42:36Z", "message": "Introduce Load Based Alert Endpoint"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4Mjc1NTA5", "url": "https://github.com/hortonworks/cloudbreak/pull/7595#pullrequestreview-378275509", "createdAt": "2020-03-20T07:39:43Z", "commit": {"oid": "b6b704b6e9bea51dfe895cbe9dda293467f1bc9e"}, "state": "COMMENTED", "comments": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQwNzozOTo0M1rOF5J1HA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQwODo0NjoxOVrOF5LZnQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTQ3NDIwNA==", "bodyText": "What had we finalized on in terms of specifying minSize, maxSize and coolDown for Load Based only, or for Time Based as well?", "url": "https://github.com/hortonworks/cloudbreak/pull/7595#discussion_r395474204", "createdAt": "2020-03-20T07:39:43Z", "author": {"login": "sidseth"}, "path": "autoscale-api/src/main/java/com/sequenceiq/periscope/api/model/DistroXAutoscaleClusterRequest.java", "diffHunk": "@@ -0,0 +1,77 @@\n+package com.sequenceiq.periscope.api.model;\n+\n+import java.util.List;\n+\n+import javax.validation.Valid;\n+import javax.validation.constraints.NotNull;\n+\n+import com.sequenceiq.periscope.doc.ApiDescription.ClusterJsonsProperties;\n+import com.sequenceiq.periscope.doc.ApiDescription.DistroXClusterJsonsProperties;\n+\n+import io.swagger.annotations.ApiModel;\n+import io.swagger.annotations.ApiModelProperty;\n+\n+@ApiModel\n+public class DistroXAutoscaleClusterRequest implements Json {\n+    @ApiModelProperty(ClusterJsonsProperties.ENABLE_AUTOSCALING)\n+    private @NotNull Boolean enableAutoscaling;\n+\n+    @ApiModelProperty(DistroXClusterJsonsProperties.DISTROX_SCALING_MODE)\n+    private @Valid AutoscalingModeType autoScalingMode;\n+\n+    @ApiModelProperty(ClusterJsonsProperties.SCALING_CONFIGURATION)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b6b704b6e9bea51dfe895cbe9dda293467f1bc9e"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTQ3NjEzMA==", "bodyText": "Extending AbstractAlertJson means the 'alertName' is present in LoadAlertConfigurationRequest as well as LoadAlertRequest. Also the description being repeated.", "url": "https://github.com/hortonworks/cloudbreak/pull/7595#discussion_r395476130", "createdAt": "2020-03-20T07:45:53Z", "author": {"login": "sidseth"}, "path": "autoscale-api/src/main/java/com/sequenceiq/periscope/api/model/LoadAlertConfigurationRequest.java", "diffHunk": "@@ -0,0 +1,34 @@\n+package com.sequenceiq.periscope.api.model;\n+\n+import javax.validation.Valid;\n+\n+import com.sequenceiq.periscope.doc.ApiDescription.LoadAlertJsonProperties;\n+\n+import io.swagger.annotations.ApiModel;\n+import io.swagger.annotations.ApiModelProperty;\n+\n+@ApiModel\n+public class LoadAlertConfigurationRequest extends AbstractAlertJson {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b6b704b6e9bea51dfe895cbe9dda293467f1bc9e"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTQ3NjMyMA==", "bodyText": "How would these relate to the ScalingConfigurationRequest that exists in the DistroXAutoscaleClusterRequest?", "url": "https://github.com/hortonworks/cloudbreak/pull/7595#discussion_r395476320", "createdAt": "2020-03-20T07:46:31Z", "author": {"login": "sidseth"}, "path": "autoscale-api/src/main/java/com/sequenceiq/periscope/api/model/LoadAlertConfigurationRequest.java", "diffHunk": "@@ -0,0 +1,34 @@\n+package com.sequenceiq.periscope.api.model;\n+\n+import javax.validation.Valid;\n+\n+import com.sequenceiq.periscope.doc.ApiDescription.LoadAlertJsonProperties;\n+\n+import io.swagger.annotations.ApiModel;\n+import io.swagger.annotations.ApiModelProperty;\n+\n+@ApiModel\n+public class LoadAlertConfigurationRequest extends AbstractAlertJson {\n+\n+    @ApiModelProperty(LoadAlertJsonProperties.LOAD_ALERT_CONFIGURATION_MIN_RESOUCE_VALUE)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b6b704b6e9bea51dfe895cbe9dda293467f1bc9e"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTQ4MDExOA==", "bodyText": "AutoScalingMode being at the top level means a single cluster can only have a single AutoScalingMode for each host group.\nAt the moment, this doesn't matter since there is only one hostGroup to scale out. However, the interface allows for multiple Time or Load based policies - so it is partly catering to future requirements, while disallowing some functionality that may be required in the future. Can this be flipped to pull the hostGroup up - similar to 'https://github.infra.cloudera.com/sseth/thunderhead/blob/master/services/libs/protocols-yaml/src/main/yaml/datahub.yaml#L1754'. That does not disallow different host groups from having different types of scaling configs. It doesn't necessarily enable potential future functionality like Spot instance ratios, but does not block it out either. (For Spot - the thought was to specify hostGroups, and then a ratio within that single policy block).", "url": "https://github.com/hortonworks/cloudbreak/pull/7595#discussion_r395480118", "createdAt": "2020-03-20T07:57:53Z", "author": {"login": "sidseth"}, "path": "autoscale-api/src/main/java/com/sequenceiq/periscope/api/model/DistroXAutoscaleClusterRequest.java", "diffHunk": "@@ -0,0 +1,77 @@\n+package com.sequenceiq.periscope.api.model;\n+\n+import java.util.List;\n+\n+import javax.validation.Valid;\n+import javax.validation.constraints.NotNull;\n+\n+import com.sequenceiq.periscope.doc.ApiDescription.ClusterJsonsProperties;\n+import com.sequenceiq.periscope.doc.ApiDescription.DistroXClusterJsonsProperties;\n+\n+import io.swagger.annotations.ApiModel;\n+import io.swagger.annotations.ApiModelProperty;\n+\n+@ApiModel\n+public class DistroXAutoscaleClusterRequest implements Json {\n+    @ApiModelProperty(ClusterJsonsProperties.ENABLE_AUTOSCALING)\n+    private @NotNull Boolean enableAutoscaling;\n+\n+    @ApiModelProperty(DistroXClusterJsonsProperties.DISTROX_SCALING_MODE)\n+    private @Valid AutoscalingModeType autoScalingMode;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b6b704b6e9bea51dfe895cbe9dda293467f1bc9e"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTQ4MDc0Nw==", "bodyText": "State and Stack_Type - Is it possible to make these Enums? Not sure what they mean, and what the valid values are.", "url": "https://github.com/hortonworks/cloudbreak/pull/7595#discussion_r395480747", "createdAt": "2020-03-20T07:59:46Z", "author": {"login": "sidseth"}, "path": "autoscale-api/src/main/java/com/sequenceiq/periscope/api/model/DistroXAutoscaleClusterResponse.java", "diffHunk": "@@ -0,0 +1,134 @@\n+package com.sequenceiq.periscope.api.model;\n+\n+import java.util.List;\n+\n+import com.sequenceiq.periscope.doc.ApiDescription;\n+import com.sequenceiq.periscope.doc.ApiDescription.ClusterJsonsProperties;\n+\n+import io.swagger.annotations.ApiModel;\n+import io.swagger.annotations.ApiModelProperty;\n+\n+@ApiModel\n+public class DistroXAutoscaleClusterResponse implements Json {\n+    @ApiModelProperty(ClusterJsonsProperties.ID)\n+    private long id;\n+\n+    @ApiModelProperty(ClusterJsonsProperties.STACK_NAME)\n+    private String stackName;\n+\n+    @ApiModelProperty(ClusterJsonsProperties.STACK_CRN)\n+    private String stackCrn;\n+\n+    @ApiModelProperty(ClusterJsonsProperties.STATE)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b6b704b6e9bea51dfe895cbe9dda293467f1bc9e"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTQ4MDk2Mg==", "bodyText": "ScalingConfigurarationResponse? (Likely identical to ScalingConfigurationRequest - but should still be a separate class), or maybe just name the object ScalingConfiguration.", "url": "https://github.com/hortonworks/cloudbreak/pull/7595#discussion_r395480962", "createdAt": "2020-03-20T08:00:23Z", "author": {"login": "sidseth"}, "path": "autoscale-api/src/main/java/com/sequenceiq/periscope/api/model/DistroXAutoscaleClusterResponse.java", "diffHunk": "@@ -0,0 +1,134 @@\n+package com.sequenceiq.periscope.api.model;\n+\n+import java.util.List;\n+\n+import com.sequenceiq.periscope.doc.ApiDescription;\n+import com.sequenceiq.periscope.doc.ApiDescription.ClusterJsonsProperties;\n+\n+import io.swagger.annotations.ApiModel;\n+import io.swagger.annotations.ApiModelProperty;\n+\n+@ApiModel\n+public class DistroXAutoscaleClusterResponse implements Json {\n+    @ApiModelProperty(ClusterJsonsProperties.ID)\n+    private long id;\n+\n+    @ApiModelProperty(ClusterJsonsProperties.STACK_NAME)\n+    private String stackName;\n+\n+    @ApiModelProperty(ClusterJsonsProperties.STACK_CRN)\n+    private String stackCrn;\n+\n+    @ApiModelProperty(ClusterJsonsProperties.STATE)\n+    private String state;\n+\n+    @ApiModelProperty(ClusterJsonsProperties.STACK_TYPE)\n+    private String stackType;\n+\n+    @ApiModelProperty(ClusterJsonsProperties.AUTOSCALING_ENABLED)\n+    private Boolean autoscalingEnabled;\n+\n+    @ApiModelProperty(ApiDescription.DistroXClusterJsonsProperties.DISTROX_SCALING_MODE)\n+    private AutoscalingModeType autoScalingMode;\n+\n+    @ApiModelProperty(ClusterJsonsProperties.TIME_ALERTS)\n+    private List<TimeAlertResponse> timeAlerts;\n+\n+    @ApiModelProperty(ClusterJsonsProperties.LOAD_ALERTS)\n+    private List<LoadAlertResponse> loadAlerts;\n+\n+    @ApiModelProperty(ClusterJsonsProperties.SCALING_CONFIGURATION)\n+    private ScalingConfigurationRequest scalingConfiguration;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b6b704b6e9bea51dfe895cbe9dda293467f1bc9e"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTQ4MTk3MA==", "bodyText": "LoadAlertConfigurationRequest and LoadAlertConfigurationResponse are identical. Should be a single base class from which they inherit. Alternately, can be replaced by a 'LoadAlertConfiguration'", "url": "https://github.com/hortonworks/cloudbreak/pull/7595#discussion_r395481970", "createdAt": "2020-03-20T08:03:15Z", "author": {"login": "sidseth"}, "path": "autoscale-api/src/main/java/com/sequenceiq/periscope/api/model/LoadAlertConfigurationResponse.java", "diffHunk": "@@ -0,0 +1,31 @@\n+package com.sequenceiq.periscope.api.model;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b6b704b6e9bea51dfe895cbe9dda293467f1bc9e"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTQ4Mjk3Ng==", "bodyText": "Similarly here. The only difference between the Request and Response is the 'id' in the response. Base class + inherit?", "url": "https://github.com/hortonworks/cloudbreak/pull/7595#discussion_r395482976", "createdAt": "2020-03-20T08:06:03Z", "author": {"login": "sidseth"}, "path": "autoscale-api/src/main/java/com/sequenceiq/periscope/api/model/LoadAlertRequest.java", "diffHunk": "@@ -0,0 +1,35 @@\n+package com.sequenceiq.periscope.api.model;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b6b704b6e9bea51dfe895cbe9dda293467f1bc9e"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTQ5MDY1NA==", "bodyText": "General question: This and AutoScaleClusterV1Controller - Is there some specific reason to move the conversion (domain (or DB) to model (API) from the Service over to the Controller?", "url": "https://github.com/hortonworks/cloudbreak/pull/7595#discussion_r395490654", "createdAt": "2020-03-20T08:24:47Z", "author": {"login": "sidseth"}, "path": "autoscale/src/main/java/com/sequenceiq/periscope/controller/AutoScaleClusterV2Controller.java", "diffHunk": "@@ -10,6 +10,7 @@\n import com.sequenceiq.periscope.api.model.AutoscaleClusterResponse;\n import com.sequenceiq.periscope.api.model.AutoscaleClusterState;\n import com.sequenceiq.periscope.api.model.StateJson;\n+import com.sequenceiq.periscope.converter.ClusterConverter;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b6b704b6e9bea51dfe895cbe9dda293467f1bc9e"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTQ5Mjg4NQ==", "bodyText": "What is the significance of this?, and potential alternate values?", "url": "https://github.com/hortonworks/cloudbreak/pull/7595#discussion_r395492885", "createdAt": "2020-03-20T08:29:33Z", "author": {"login": "sidseth"}, "path": "autoscale-api/src/main/java/com/sequenceiq/periscope/api/model/AutoscaleStackType.java", "diffHunk": "@@ -0,0 +1,5 @@\n+package com.sequenceiq.periscope.api.model;\n+\n+public enum AutoscaleStackType {\n+    WORKLOAD", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b6b704b6e9bea51dfe895cbe9dda293467f1bc9e"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTQ5NDgyMA==", "bodyText": "Would a name need to be associated with each of the cron expressions? (Can be auto-generated if required)", "url": "https://github.com/hortonworks/cloudbreak/pull/7595#discussion_r395494820", "createdAt": "2020-03-20T08:34:08Z", "author": {"login": "sidseth"}, "path": "autoscale-api/src/main/java/com/sequenceiq/periscope/api/model/DistroXAutoscaleClusterRequest.java", "diffHunk": "@@ -0,0 +1,77 @@\n+package com.sequenceiq.periscope.api.model;\n+\n+import java.util.List;\n+\n+import javax.validation.Valid;\n+import javax.validation.constraints.NotNull;\n+\n+import com.sequenceiq.periscope.doc.ApiDescription.ClusterJsonsProperties;\n+import com.sequenceiq.periscope.doc.ApiDescription.DistroXClusterJsonsProperties;\n+\n+import io.swagger.annotations.ApiModel;\n+import io.swagger.annotations.ApiModelProperty;\n+\n+@ApiModel\n+public class DistroXAutoscaleClusterRequest implements Json {\n+    @ApiModelProperty(ClusterJsonsProperties.ENABLE_AUTOSCALING)\n+    private @NotNull Boolean enableAutoscaling;\n+\n+    @ApiModelProperty(DistroXClusterJsonsProperties.DISTROX_SCALING_MODE)\n+    private @Valid AutoscalingModeType autoScalingMode;\n+\n+    @ApiModelProperty(ClusterJsonsProperties.SCALING_CONFIGURATION)\n+    private @Valid ScalingConfigurationRequest scalingConfiguration;\n+\n+    @ApiModelProperty(ClusterJsonsProperties.TIME_ALERTS)\n+    private @Valid List<TimeAlertRequest> timeAlertRequests;\n+\n+    @ApiModelProperty(ClusterJsonsProperties.LOAD_ALERTS)\n+    private @Valid List<LoadAlertRequest> loadAlertRequests;\n+\n+    public DistroXAutoscaleClusterRequest() {\n+    }\n+\n+    public DistroXAutoscaleClusterRequest(boolean enableAutoscaling) {\n+        this.enableAutoscaling = enableAutoscaling;\n+    }\n+\n+    public void setEnableAutoscaling(Boolean enableAutoscaling) {\n+        this.enableAutoscaling = enableAutoscaling;\n+    }\n+\n+    public List<TimeAlertRequest> getTimeAlertRequests() {\n+        return timeAlertRequests;\n+    }\n+\n+    public void setTimeAlertRequests(List<TimeAlertRequest> timeAlertRequests) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b6b704b6e9bea51dfe895cbe9dda293467f1bc9e"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTQ5Njc0Mg==", "bodyText": "Skip this? Set the fields in the constructor itself, so that they can be 'final'", "url": "https://github.com/hortonworks/cloudbreak/pull/7595#discussion_r395496742", "createdAt": "2020-03-20T08:38:37Z", "author": {"login": "sidseth"}, "path": "autoscale/src/main/java/com/sequenceiq/periscope/model/MonitoredStack.java", "diffHunk": "@@ -8,20 +8,31 @@\n \n     private final ClusterManager clusterManager;\n \n-    private final String stackCrn;\n+    private String stackCrn;\n+\n+    private String stackName;\n+\n+    private String stackType;\n \n     private final Long stackId;\n \n     private final SecurityConfig securityConfig;\n \n     private final Tunnel tunnel;\n \n-    public MonitoredStack(ClusterManager clusterManager, String stackCrn, Long stackId, SecurityConfig securityConfig, Tunnel tunnel) {\n+    public MonitoredStack(ClusterManager clusterManager, String stackName, String stackCrn,\n+            String stackType, Long stackId, SecurityConfig securityConfig, Tunnel tunnel) {\n         this.clusterManager = clusterManager;\n-        this.stackCrn = stackCrn;\n-        this.stackId = stackId;\n         this.securityConfig = securityConfig;\n         this.tunnel = tunnel;\n+        this.stackId = stackId;\n+        initStackContext(stackName, stackCrn, stackType);\n+    }\n+\n+    private void initStackContext(String stackName, String stackCrn, String stackType) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b6b704b6e9bea51dfe895cbe9dda293467f1bc9e"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTQ5NzQwMg==", "bodyText": "Same as previous - significance of the 'stackType' field? Why was it not required earlier when the id was being used?", "url": "https://github.com/hortonworks/cloudbreak/pull/7595#discussion_r395497402", "createdAt": "2020-03-20T08:40:18Z", "author": {"login": "sidseth"}, "path": "autoscale/src/main/java/com/sequenceiq/periscope/repository/ClusterRepository.java", "diffHunk": "@@ -25,6 +29,9 @@\n     @Query(\"SELECT c FROM Cluster c LEFT JOIN FETCH c.clusterPertain WHERE c.clusterPertain.userId = :userId\")\n     List<Cluster> findByUserId(@Param(\"userId\") String userId);\n \n+    @Query(\"SELECT c FROM Cluster c LEFT JOIN FETCH c.clusterPertain WHERE c.clusterPertain.userId = :userId and c.stackType = :stackType\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b6b704b6e9bea51dfe895cbe9dda293467f1bc9e"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTQ5OTkzMw==", "bodyText": "Will ideally need indexes on these fields as well if using them as filter parameters.", "url": "https://github.com/hortonworks/cloudbreak/pull/7595#discussion_r395499933", "createdAt": "2020-03-20T08:46:19Z", "author": {"login": "sidseth"}, "path": "autoscale/src/main/resources/schema/app/20200318083430_CB-5734_cluster_table_enhancements.sql", "diffHunk": "@@ -0,0 +1,18 @@\n+-- // CB-5734_cluster_table_enhancements\n+-- Migration SQL that makes the change goes here.\n+\n+ALTER TABLE cluster ADD COLUMN IF NOT EXISTS cb_stack_name VARCHAR(255);\n+\n+ALTER TABLE cluster ADD COLUMN IF NOT EXISTS cb_stack_type VARCHAR(255);\n+\n+ALTER TABLE cluster ADD COLUMN IF NOT EXISTS autoscale_mode VARCHAR(255);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b6b704b6e9bea51dfe895cbe9dda293467f1bc9e"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "71f7622ca61c26a56f262b166112a536e8d20e51", "author": {"user": {"login": "smaniraju", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/71f7622ca61c26a56f262b166112a536e8d20e51", "committedDate": "2020-03-20T13:39:53Z", "message": "Introduce Load Based Alert Endpoint"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b6b704b6e9bea51dfe895cbe9dda293467f1bc9e", "author": {"user": {"login": "smaniraju", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/b6b704b6e9bea51dfe895cbe9dda293467f1bc9e", "committedDate": "2020-03-19T15:42:36Z", "message": "Introduce Load Based Alert Endpoint"}, "afterCommit": {"oid": "71f7622ca61c26a56f262b166112a536e8d20e51", "author": {"user": {"login": "smaniraju", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/71f7622ca61c26a56f262b166112a536e8d20e51", "committedDate": "2020-03-20T13:39:53Z", "message": "Introduce Load Based Alert Endpoint"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2462, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}