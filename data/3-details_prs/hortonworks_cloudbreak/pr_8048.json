{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE3ODQ1MzM4", "number": 8048, "title": "DISTX-399 Introduce Periscope DataHub Autoscaling (Part 1)", "bodyText": "DISTX-399 Introduce Periscope DataHub Autoscaling (Part 1).\n\nAll AutoscaleV4Endpoint endpoints are authorized by UMS Authorization or hasRole for internal-crn and all authorization checks moved to AutoscaleV4Controller.\nDisabling unused endpoint registration and in swagger-spec for swagger-spec based cdp-cli integration.\nDisabled unused monitors from running.\nSupport for retrieving additional parameters Cluster Creator's User CRN, Stack Type, CloudPlatform during cluster sync.\nExisting scaling interaction between Periscope and CB was based on Cluster Creator's UserId, this has been enhanced to use Cluster Creator's UserCRN, since CB requires valid Knox UserCRN while scaling up cluster.\n\nSome methods in PR appear unused because DISTX-399-Feature-Branch-Datahub-AutoScaling has full feature change and am merging the changes in smaller PRs for easier review.", "createdAt": "2020-05-14T08:46:27Z", "url": "https://github.com/hortonworks/cloudbreak/pull/8048", "merged": true, "mergeCommit": {"oid": "b57e19d6a9e99b49ad442677cfd05367b8073fcf"}, "closed": true, "closedAt": "2020-05-22T07:47:58Z", "author": {"login": "smaniraju"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcjbQO-AFqTQxNjA0NTQ1Mg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcjbowTgBqjMzNjAyNDU4MTQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE2MDQ1NDUy", "url": "https://github.com/hortonworks/cloudbreak/pull/8048#pullrequestreview-416045452", "createdAt": "2020-05-21T10:38:35Z", "commit": {"oid": "5d7ac7c895068f8d20f2d5f4f0e0965c3a756df9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQxMDozODozNlrOGYuMyw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQxMDozODozNlrOGYuMyw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODU3NTk0Nw==", "bodyText": "findAliveOnesWithAmbari -> findAliveOnesWithClusterManager", "url": "https://github.com/hortonworks/cloudbreak/pull/8048#discussion_r428575947", "createdAt": "2020-05-21T10:38:36Z", "author": {"login": "doktoric"}, "path": "core/src/main/java/com/sequenceiq/cloudbreak/repository/StackRepository.java", "diffHunk": "@@ -172,8 +175,7 @@\n             + \"WHERE ig.instanceGroupType = 'GATEWAY' \"\n             + \"AND im.instanceMetadataType = 'GATEWAY_PRIMARY' \"\n             + \"AND s.terminated = null \"\n-            + \"AND c.clusterManagerIp IS NOT NULL \"\n-            + \"AND c.status = 'AVAILABLE' \"\n+            + \"AND c.status in ('AVAILABLE', 'REQUESTED', 'UPDATE_IN_PROGRESS') \"\n             + \"AND (s.type is not 'TEMPLATE' OR s.type is null)\")\n     Set<AutoscaleStack> findAliveOnesWithAmbari();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5d7ac7c895068f8d20f2d5f4f0e0965c3a756df9"}, "originalPosition": 22}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE2MDQ1NjA5", "url": "https://github.com/hortonworks/cloudbreak/pull/8048#pullrequestreview-416045609", "createdAt": "2020-05-21T10:38:52Z", "commit": {"oid": "5d7ac7c895068f8d20f2d5f4f0e0965c3a756df9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQxMDozODo1MlrOGYuNQA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQxMDozODo1MlrOGYuNQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODU3NjA2NA==", "bodyText": "why we removed this ?", "url": "https://github.com/hortonworks/cloudbreak/pull/8048#discussion_r428576064", "createdAt": "2020-05-21T10:38:52Z", "author": {"login": "doktoric"}, "path": "core/src/main/java/com/sequenceiq/cloudbreak/service/StackCommonService.java", "diffHunk": "@@ -254,7 +253,6 @@ public GeneratedBlueprintV4Response postStackForBlueprint(StackV4Request stackRe\n         return response;\n     }\n \n-    @PreAuthorize(\"hasRole('AUTOSCALE')\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5d7ac7c895068f8d20f2d5f4f0e0965c3a756df9"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE2MDQ1NzMw", "url": "https://github.com/hortonworks/cloudbreak/pull/8048#pullrequestreview-416045730", "createdAt": "2020-05-21T10:39:09Z", "commit": {"oid": "5d7ac7c895068f8d20f2d5f4f0e0965c3a756df9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQxMDozOTowOVrOGYuNhg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQxMDozOTowOVrOGYuNhg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODU3NjEzNA==", "bodyText": "why we removed this?", "url": "https://github.com/hortonworks/cloudbreak/pull/8048#discussion_r428576134", "createdAt": "2020-05-21T10:39:09Z", "author": {"login": "doktoric"}, "path": "core/src/main/java/com/sequenceiq/cloudbreak/service/stack/StackService.java", "diffHunk": "@@ -261,18 +259,6 @@ public StackClusterStatusView getStatusByNameOrCrn(NameOrCrn nameOrCrn, Long wor\n         return foundStack.orElseThrow(() -> new NotFoundException(String.format(STACK_NOT_FOUND_BY_NAME_OR_CRN_EXCEPTION_MESSAGE, nameOrCrn)));\n     }\n \n-    @PreAuthorize(\"hasRole('AUTOSCALE')\")\n-    public Long getWorkspaceId(String crn) {\n-        return stackRepository.findWorkspaceIdByCrn(crn);\n-    }\n-\n-    @PreAuthorize(\"hasRole('AUTOSCALE')\")\n-    public Tenant getTenant(String crn) {\n-        Workspace workspace = stackRepository.findWorkspaceByCrn(crn).orElseThrow(notFound(\"workspace\", crn));\n-        return workspace.getTenant();\n-    }\n-\n-    @PreAuthorize(\"hasRole('AUTOSCALE')\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5d7ac7c895068f8d20f2d5f4f0e0965c3a756df9"}, "originalPosition": 31}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "357ddeef61767a5fae92991965e42eb2d006ee1f", "author": {"user": {"login": "smaniraju", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/357ddeef61767a5fae92991965e42eb2d006ee1f", "committedDate": "2020-05-21T11:03:24Z", "message": "DISTX-399 CB Changes to suport Load Based Autoscaling"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5d7ac7c895068f8d20f2d5f4f0e0965c3a756df9", "author": {"user": {"login": "smaniraju", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/5d7ac7c895068f8d20f2d5f4f0e0965c3a756df9", "committedDate": "2020-05-14T08:06:33Z", "message": "DISTX-399 CB Changes to suport Load Based Autoscaling"}, "afterCommit": {"oid": "357ddeef61767a5fae92991965e42eb2d006ee1f", "author": {"user": {"login": "smaniraju", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/357ddeef61767a5fae92991965e42eb2d006ee1f", "committedDate": "2020-05-21T11:03:24Z", "message": "DISTX-399 CB Changes to suport Load Based Autoscaling"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1828, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}