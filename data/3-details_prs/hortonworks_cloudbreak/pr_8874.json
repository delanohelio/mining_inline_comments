{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc0NjA5NzA5", "number": 8874, "title": "CB-6185-Consistent HostNames", "bodyText": "The hostgroups are sorted to follow same privateId generation pattern for a given template.\nGateway hostgroups start with privateId 0 (the hosgroup which maps to various endpoints like CM-API, HiveServer..).\nIf multiple hostGroups are marked gateway then they are processed alphabetically so privateId remains same and hence hostName remaing same for a given template.\nGateway hostgroups as defined in various default templates\n\nDE : master\nDE HA  : manager\nDatamart : master\nFlink : manager\nFlowManagement : gateway\n\nSee detailed description in the commit message.", "createdAt": "2020-08-27T10:37:32Z", "url": "https://github.com/hortonworks/cloudbreak/pull/8874", "merged": true, "mergeCommit": {"oid": "97fa632a19e55751ecaac1a70280ad9e7c2b5db3"}, "closed": true, "closedAt": "2020-08-31T07:16:17Z", "author": {"login": "smaniraju"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdC8vJUgH2gAyNDc0NjA5NzA5OjRkNWFmMjYxM2VlNTU2MzIwNmM0MTVjYTA0ZjBmOTEwY2ZiN2I5Njc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdDRwpoAFqTQ3NzU5MDcyMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4d5af2613ee5563206c415ca04f0f910cfb7b967", "author": {"user": {"login": "smaniraju", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/4d5af2613ee5563206c415ca04f0f910cfb7b967", "committedDate": "2020-08-27T09:10:53Z", "message": "CB-6185-Consistent HostNames\n\n The hostgroups are sorted to follow same privateId generation pattern for a given template.\n\n Gateway hostgroups start with privateId 0 (the hosgroup which maps to various endpoints like CM-API, HiveServer..).\n If multiple hostGroups are marked gateway then they are processed alphabetically so privateId remains same and hence hostName remaing same for a given template.\n\n Gateway hostgroups as defined in various default templates\n 1. DE : master\n 2. DE HA  : manager\n 3. Datamart : master\n 4. Flink : manager\n 5. FlowManagement : gateway"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc2NjkyMjQ2", "url": "https://github.com/hortonworks/cloudbreak/pull/8874#pullrequestreview-476692246", "createdAt": "2020-08-27T12:57:17Z", "commit": {"oid": "4d5af2613ee5563206c415ca04f0f910cfb7b967"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc3MTM4MTUz", "url": "https://github.com/hortonworks/cloudbreak/pull/8874#pullrequestreview-477138153", "createdAt": "2020-08-27T22:57:09Z", "commit": {"oid": "4d5af2613ee5563206c415ca04f0f910cfb7b967"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QyMjo1NzowOVrOHIj-PQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QyMjo1NzowOVrOHIj-PQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODc0MDAyOQ==", "bodyText": "I don't think this will provide the Knox node(s) (which effectively is the endpoint for all services) with a consistent hostname. e.g. If the number of 'CORE' nodes is dynamic - the 'GATEWAY' instance will get a number which follows the count of all 'CORE' nodes.\nThis needs better understanding of 'CORE' vs 'GATEWAY'. If I'm not mistaken, there can be one GATEWAY hostGroup, and this is the instance on which KNOX is installed (not sure if there can be more than one such node). I could be completely wrong about this though. @cegganesh84 - I think you have a much better understanding of CORE vs GATEWAY and cardinality given the HA templates that you've worked on.\nIf GATEWAY==KNOX node and there can be only 1 gateway hostGroup, explicitly assigning numbers to this hostGroup first probably works.\nAlternately, may need to make this service aware.", "url": "https://github.com/hortonworks/cloudbreak/pull/8874#discussion_r478740029", "createdAt": "2020-08-27T22:57:09Z", "author": {"login": "sidseth"}, "path": "core/src/main/java/com/sequenceiq/cloudbreak/controller/StackCreatorService.java", "diffHunk": "@@ -370,9 +372,13 @@ private void setStackTypeAndValidateDatalake(Stack stack, Blueprint blueprint) {\n         }\n     }\n \n-    private void fillInstanceMetadata(Stack stack) {\n+    void fillInstanceMetadata(Stack stack) {\n         long privateIdNumber = 0;\n-        for (InstanceGroup instanceGroup : stack.getInstanceGroups()) {\n+        //Gateway HostGroups are sorted first to start with privateIdNumber 0.\n+        List<InstanceGroup> sortedInstanceGroups = stack.getInstanceGroups().stream()\n+                .sorted(Comparator.comparing(InstanceGroup::getInstanceGroupType)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4d5af2613ee5563206c415ca04f0f910cfb7b967"}, "originalPosition": 26}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc3NTkwNzIw", "url": "https://github.com/hortonworks/cloudbreak/pull/8874#pullrequestreview-477590720", "createdAt": "2020-08-28T09:40:32Z", "commit": {"oid": "4d5af2613ee5563206c415ca04f0f910cfb7b967"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2370, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}