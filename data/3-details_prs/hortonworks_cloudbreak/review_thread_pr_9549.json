{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMwNDY4NDI5", "number": 9549, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQxNDowMzo0MVrOE_oiBg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQxNzozNjoyM1rOE_u42w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM1MTU5ODE0OnYy", "diffSide": "RIGHT", "path": "orchestrator-salt/src/main/resources/salt/salt/sssd/template/add_dns_record.j2", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQxNDowMzo0MVrOH9cXGg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQxNDo1MjozOFrOH9esfQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDE4OTg1MA==", "bodyText": "why random? I think we should stick with a fix value", "url": "https://github.com/hortonworks/cloudbreak/pull/9549#discussion_r534189850", "createdAt": "2020-12-02T14:03:41Z", "author": {"login": "lacikaaa"}, "path": "orchestrator-salt/src/main/resources/salt/salt/sssd/template/add_dns_record.j2", "diffHunk": "@@ -17,10 +17,15 @@ FQDN=$(hostname -f)\n IPADDR=$(hostname -i)\n REVERSE_IP=$(hostname -i | awk -F. '{print $4\".\"$3\".\" $2\".\"$1}')\n \n-# dnsrecord-add must either add the record or modify it\n-if ! ipa dnsrecord-find {{ pillar['sssd-ipa']['domain'] }}. \"--name=${HOSTNAME}\" \"--a-rec=${IPADDR}\"  --ttl {{ pillar['sssd-ipa']['dns_ttl'] }} --all; then\n-  ipa dnsrecord-add {{ pillar['sssd-ipa']['domain'] }}. \"${HOSTNAME}\" \"--a-rec=${IPADDR}\" --ttl {{ pillar['sssd-ipa']['dns_ttl'] }}\n-fi\n+# add dns a-record 3 times with a random 10-15 seconds interval (see CDPSDX-1981)\n+for attempt in {1..3}\n+do\n+  echo \"add dns a-record hostname for ${HOSTNAME}, attempt ${attempt}\"\n+  if ! ipa dnsrecord-find {{ pillar['sssd-ipa']['domain'] }}. \"--name=${HOSTNAME}\" \"--a-rec=${IPADDR}\"  --ttl {{ pillar['sssd-ipa']['dns_ttl'] }} --all; then\n+    ipa dnsrecord-add {{ pillar['sssd-ipa']['domain'] }}. \"${HOSTNAME}\" \"--a-rec=${IPADDR}\" --ttl {{ pillar['sssd-ipa']['dns_ttl'] }}\n+  fi\n+  sleep $(((RANDOM % 5) + 10))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c1785349b4768ce08b23536c49425392f6176c5"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDIyODA5Mw==", "bodyText": "Thanks! I changed it to a fixed 10. It is more of a personal habit to put random or exponential in retry as learned from previous experience.", "url": "https://github.com/hortonworks/cloudbreak/pull/9549#discussion_r534228093", "createdAt": "2020-12-02T14:52:38Z", "author": {"login": "christmasferret"}, "path": "orchestrator-salt/src/main/resources/salt/salt/sssd/template/add_dns_record.j2", "diffHunk": "@@ -17,10 +17,15 @@ FQDN=$(hostname -f)\n IPADDR=$(hostname -i)\n REVERSE_IP=$(hostname -i | awk -F. '{print $4\".\"$3\".\" $2\".\"$1}')\n \n-# dnsrecord-add must either add the record or modify it\n-if ! ipa dnsrecord-find {{ pillar['sssd-ipa']['domain'] }}. \"--name=${HOSTNAME}\" \"--a-rec=${IPADDR}\"  --ttl {{ pillar['sssd-ipa']['dns_ttl'] }} --all; then\n-  ipa dnsrecord-add {{ pillar['sssd-ipa']['domain'] }}. \"${HOSTNAME}\" \"--a-rec=${IPADDR}\" --ttl {{ pillar['sssd-ipa']['dns_ttl'] }}\n-fi\n+# add dns a-record 3 times with a random 10-15 seconds interval (see CDPSDX-1981)\n+for attempt in {1..3}\n+do\n+  echo \"add dns a-record hostname for ${HOSTNAME}, attempt ${attempt}\"\n+  if ! ipa dnsrecord-find {{ pillar['sssd-ipa']['domain'] }}. \"--name=${HOSTNAME}\" \"--a-rec=${IPADDR}\"  --ttl {{ pillar['sssd-ipa']['dns_ttl'] }} --all; then\n+    ipa dnsrecord-add {{ pillar['sssd-ipa']['domain'] }}. \"${HOSTNAME}\" \"--a-rec=${IPADDR}\" --ttl {{ pillar['sssd-ipa']['dns_ttl'] }}\n+  fi\n+  sleep $(((RANDOM % 5) + 10))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDE4OTg1MA=="}, "originalCommit": {"oid": "2c1785349b4768ce08b23536c49425392f6176c5"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM1MjYzOTYzOnYy", "diffSide": "RIGHT", "path": "orchestrator-salt/src/main/resources/salt/salt/sssd/template/add_dns_record.j2", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQxNzozNjoyM1rOH9mc_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQxOTo0OToxNFrOH9rhiQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDM1NTE5Nw==", "bodyText": "please adjust the comment to the code, as it's not random now. thanks", "url": "https://github.com/hortonworks/cloudbreak/pull/9549#discussion_r534355197", "createdAt": "2020-12-02T17:36:23Z", "author": {"login": "lacikaaa"}, "path": "orchestrator-salt/src/main/resources/salt/salt/sssd/template/add_dns_record.j2", "diffHunk": "@@ -17,10 +17,15 @@ FQDN=$(hostname -f)\n IPADDR=$(hostname -i)\n REVERSE_IP=$(hostname -i | awk -F. '{print $4\".\"$3\".\" $2\".\"$1}')\n \n-# dnsrecord-add must either add the record or modify it\n-if ! ipa dnsrecord-find {{ pillar['sssd-ipa']['domain'] }}. \"--name=${HOSTNAME}\" \"--a-rec=${IPADDR}\"  --ttl {{ pillar['sssd-ipa']['dns_ttl'] }} --all; then\n-  ipa dnsrecord-add {{ pillar['sssd-ipa']['domain'] }}. \"${HOSTNAME}\" \"--a-rec=${IPADDR}\" --ttl {{ pillar['sssd-ipa']['dns_ttl'] }}\n-fi\n+# add dns a-record 3 times with a random 10-15 seconds interval (see CDPSDX-1981)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b9f1353ec2e7893d01d3e4da432c8599bab9b54c"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDQzODI4MQ==", "bodyText": "resolved", "url": "https://github.com/hortonworks/cloudbreak/pull/9549#discussion_r534438281", "createdAt": "2020-12-02T19:49:14Z", "author": {"login": "christmasferret"}, "path": "orchestrator-salt/src/main/resources/salt/salt/sssd/template/add_dns_record.j2", "diffHunk": "@@ -17,10 +17,15 @@ FQDN=$(hostname -f)\n IPADDR=$(hostname -i)\n REVERSE_IP=$(hostname -i | awk -F. '{print $4\".\"$3\".\" $2\".\"$1}')\n \n-# dnsrecord-add must either add the record or modify it\n-if ! ipa dnsrecord-find {{ pillar['sssd-ipa']['domain'] }}. \"--name=${HOSTNAME}\" \"--a-rec=${IPADDR}\"  --ttl {{ pillar['sssd-ipa']['dns_ttl'] }} --all; then\n-  ipa dnsrecord-add {{ pillar['sssd-ipa']['domain'] }}. \"${HOSTNAME}\" \"--a-rec=${IPADDR}\" --ttl {{ pillar['sssd-ipa']['dns_ttl'] }}\n-fi\n+# add dns a-record 3 times with a random 10-15 seconds interval (see CDPSDX-1981)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDM1NTE5Nw=="}, "originalCommit": {"oid": "b9f1353ec2e7893d01d3e4da432c8599bab9b54c"}, "originalPosition": 8}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3543, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}