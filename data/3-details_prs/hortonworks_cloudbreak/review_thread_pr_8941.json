{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgxNTQ2NDg3", "number": 8941, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxNzo1NToyM1rOEhWvfQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxNzo1NToyM1rOEhWvfQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzNDExMDY5OnYy", "diffSide": "RIGHT", "path": "cloud-azure/src/main/java/com/sequenceiq/cloudbreak/cloud/azure/AzureNetworkConnector.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxNzo1NToyM1rOHOoCqA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxNzo1NToyM1rOHOoCqA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTA5ODE1Mg==", "bodyText": "This is the third occurrence of this fragment in this class, let alone the others, could you pls extract this logic?", "url": "https://github.com/hortonworks/cloudbreak/pull/8941#discussion_r485098152", "createdAt": "2020-09-08T17:55:23Z", "author": {"login": "pdarvasi"}, "path": "cloud-azure/src/main/java/com/sequenceiq/cloudbreak/cloud/azure/AzureNetworkConnector.java", "diffHunk": "@@ -113,21 +113,46 @@ public CreatedCloudNetwork createNetworkWithSubnets(NetworkCreationRequest netwo\n     @Override\n     public void deleteNetworkWithSubnets(NetworkDeletionRequest networkDeletionRequest) {\n         if (!networkDeletionRequest.isExisting()) {\n-            try {\n-                AzureClient azureClient = azureClientService.getClient(networkDeletionRequest.getCloudCredential());\n-                if (resourceGroupExists(azureClient, networkDeletionRequest)) {\n-                    azureClient.deleteTemplateDeployment(networkDeletionRequest.getResourceGroup(), networkDeletionRequest.getStackName());\n-                    azureClient.deleteResourceGroup(networkDeletionRequest.getResourceGroup());\n-                }\n-            } catch (CloudException e) {\n-                LOGGER.warn(\"Deletion error, cloud exception happened: \", e);\n-                if (e.body() != null && e.body().details() != null) {\n-                    String details = e.body().details().stream().map(CloudError::message).collect(Collectors.joining(\", \"));\n-                    throw new CloudConnectorException(String.format(\"Network deletion failed, status code %s, error message: %s, details: %s\",\n-                            e.body().code(), e.body().message(), details));\n-                } else {\n-                    throw new CloudConnectorException(String.format(\"Network deletion failed: '%s', please go to Azure Portal for detailed message\", e));\n-                }\n+            if (networkDeletionRequest.isSingleResourceGroup()) {\n+                deleteResources(networkDeletionRequest);\n+            } else {\n+                deleteNetworkResourceGroup(networkDeletionRequest);\n+            }\n+        }\n+    }\n+\n+    private void deleteResources(NetworkDeletionRequest networkDeletionRequest) {\n+        try {\n+            AzureClient azureClient = azureClientService.getClient(networkDeletionRequest.getCloudCredential());\n+            azureClient.deleteNetworkInResourceGroup(networkDeletionRequest.getResourceGroup(), networkDeletionRequest.getNetworkId());\n+            azureClient.deleteTemplateDeployment(networkDeletionRequest.getResourceGroup(), networkDeletionRequest.getStackName());\n+        } catch (CloudException e) {\n+            LOGGER.warn(\"Deletion error, cloud exception happened: \", e);\n+            if (e.body() != null && e.body().details() != null) {\n+                String details = e.body().details().stream().map(CloudError::message).collect(Collectors.joining(\", \"));\n+                throw new CloudConnectorException(String.format(\"Network deletion failed, status code %s, error message: %s, details: %s\",\n+                        e.body().code(), e.body().message(), details));\n+            } else {\n+                throw new CloudConnectorException(String.format(\"Network deletion failed: '%s', please go to Azure Portal for detailed message\", e));\n+            }\n+        }\n+    }\n+\n+    private void deleteNetworkResourceGroup(NetworkDeletionRequest networkDeletionRequest) {\n+        try {\n+            AzureClient azureClient = azureClientService.getClient(networkDeletionRequest.getCloudCredential());\n+            if (resourceGroupExists(azureClient, networkDeletionRequest)) {\n+                azureClient.deleteTemplateDeployment(networkDeletionRequest.getResourceGroup(), networkDeletionRequest.getStackName());\n+                azureClient.deleteResourceGroup(networkDeletionRequest.getResourceGroup());\n+            }\n+        } catch (CloudException e) {\n+            LOGGER.warn(\"Deletion error, cloud exception happened: \", e);\n+            if (e.body() != null && e.body().details() != null) {\n+                String details = e.body().details().stream().map(CloudError::message).collect(Collectors.joining(\", \"));\n+                throw new CloudConnectorException(String.format(\"Network deletion failed, status code %s, error message: %s, details: %s\",\n+                        e.body().code(), e.body().message(), details));\n+            } else {\n+                throw new CloudConnectorException(String.format(\"Network deletion failed: '%s', please go to Azure Portal for detailed message\", e));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fcb85df93e0e20a8862c546ba45913ee5a980d6b"}, "originalPosition": 58}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2238, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}