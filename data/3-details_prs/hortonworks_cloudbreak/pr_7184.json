{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY5NTA1NzA0", "number": 7184, "title": "CB-5076 subnet configurations for experiences", "bodyText": "", "createdAt": "2020-01-31T10:10:59Z", "url": "https://github.com/hortonworks/cloudbreak/pull/7184", "merged": true, "mergeCommit": {"oid": "8c13a24dc18fb381ceeb384d6f4e9fec50049043"}, "closed": true, "closedAt": "2020-02-04T10:15:59Z", "author": {"login": "doktoric"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcAvdXrABqjMwMDI4NzkxNjk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcA-Ru_AFqTM1MjgzNTg3Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0d7762f5a905533f8ae0c081d210f3b40385551b", "author": {"user": {"login": "doktoric", "name": "Richard Doktorics"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/0d7762f5a905533f8ae0c081d210f3b40385551b", "committedDate": "2020-02-02T21:23:13Z", "message": "sdfs"}, "afterCommit": {"oid": "395acafcda692290bb5237dc9fb11a27cb654294", "author": {"user": {"login": "doktoric", "name": "Richard Doktorics"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/395acafcda692290bb5237dc9fb11a27cb654294", "committedDate": "2020-02-03T16:02:40Z", "message": "CB-5076 subnet configurations for experiences"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyNzcwNzA1", "url": "https://github.com/hortonworks/cloudbreak/pull/7184#pullrequestreview-352770705", "createdAt": "2020-02-04T07:38:16Z", "commit": {"oid": "395acafcda692290bb5237dc9fb11a27cb654294"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQwNzozODoxN1rOFlKcDA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQwNzo1MDo0MlrOFlKr4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDUxMjY1Mg==", "bodyText": "unnecessary line break", "url": "https://github.com/hortonworks/cloudbreak/pull/7184#discussion_r374512652", "createdAt": "2020-02-04T07:38:17Z", "author": {"login": "topolyai5"}, "path": "cloud-aws/src/main/java/com/sequenceiq/cloudbreak/cloud/aws/AwsNetworkCfTemplateProvider.java", "diffHunk": "@@ -43,8 +43,11 @@ public String provide(String vpcCidr, List<SubnetRequest> subnets, boolean priva\n         }\n     }\n \n-    private Map<String, Object> createModel(String vpcCidr, List<SubnetRequest> subnets, boolean privateSubnetEnabled) {\n+    private Map<String, Object> createModel(String envName, Long envId, String vpcCidr, List<SubnetRequest> subnets,\n+        boolean privateSubnetEnabled) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "395acafcda692290bb5237dc9fb11a27cb654294"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDUxMjc4OQ==", "bodyText": "you can move the private subnet inside the function", "url": "https://github.com/hortonworks/cloudbreak/pull/7184#discussion_r374512789", "createdAt": "2020-02-04T07:38:42Z", "author": {"login": "topolyai5"}, "path": "cloud-aws/src/main/java/com/sequenceiq/cloudbreak/cloud/aws/AwsNetworkCfTemplateProvider.java", "diffHunk": "@@ -31,9 +31,9 @@\n     @Inject\n     private FreeMarkerTemplateUtils freeMarkerTemplateUtils;\n \n-    public String provide(String vpcCidr, List<SubnetRequest> subnets, boolean privateSubnetEnabled) {\n+    public String provide(String envName, Long envId, String vpcCidr, List<SubnetRequest> subnets, boolean privateSubnetEnabled) {\n \n-        Map<String, Object> model = createModel(vpcCidr, subnets, privateSubnetEnabled);\n+        Map<String, Object> model = createModel(envName, envId, vpcCidr, subnets, privateSubnetEnabled);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "395acafcda692290bb5237dc9fb11a27cb654294"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDUxMzg1MQ==", "bodyText": "i think you want to use the private subnet cidrs", "url": "https://github.com/hortonworks/cloudbreak/pull/7184#discussion_r374513851", "createdAt": "2020-02-04T07:42:01Z", "author": {"login": "topolyai5"}, "path": "cloud-aws/src/main/java/com/sequenceiq/cloudbreak/cloud/aws/AwsSubnetRequestProvider.java", "diffHunk": "@@ -14,23 +13,29 @@\n @Component\n public class AwsSubnetRequestProvider {\n \n-    public List<SubnetRequest> provide(AmazonEC2Client ec2Client, List<String> subnetCidrs) {\n-        Assert.isTrue(subnetCidrs.size() % 2 == 0, \"The number of the subnets should be even!\");\n+    public List<SubnetRequest> provide(AmazonEC2Client ec2Client, List<String> publicSubnetCidrs,  List<String> privateSubnetCidrs) {\n         List<String> az = getAvailabilityZones(ec2Client);\n         List<SubnetRequest> subnets = new ArrayList<>();\n-        int sunetIndex = 0;\n-        for (int i = 0; i < subnetCidrs.size() / 2; i++) {\n+        int index = 0;\n+\n+        for (int i = 0; i < publicSubnetCidrs.size(); i++) {\n+            SubnetRequest subnetRequest = new SubnetRequest();\n+            subnetRequest.setPublicSubnetCidr(publicSubnetCidrs.get(i));\n+            subnetRequest.setAvailabilityZone(az.get(i % az.size()));\n+            subnetRequest.setSubnetGroup(i % publicSubnetCidrs.size());\n+            subnetRequest.setIndex(index++);\n+            subnets.add(subnetRequest);\n+        }\n+\n+        for (int i = 0; i < privateSubnetCidrs.size(); i++) {\n             SubnetRequest subnetRequest = new SubnetRequest();\n-            subnetRequest.setPublicSubnetCidr(subnetCidrs.get(sunetIndex));\n-            subnetRequest.setPrivateSubnetCidr(subnetCidrs.get(sunetIndex + 1));\n-            sunetIndex += 2;\n-            if (i < az.size()) {\n-                subnetRequest.setAvailabilityZone(az.get(i));\n-            } else {\n-                subnetRequest.setAvailabilityZone(az.get(az.size() - 1));\n-            }\n+            subnetRequest.setPrivateSubnetCidr(privateSubnetCidrs.get(i));\n+            subnetRequest.setAvailabilityZone(az.get(i % az.size()));\n+            subnetRequest.setSubnetGroup(i % publicSubnetCidrs.size());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "395acafcda692290bb5237dc9fb11a27cb654294"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDUxNjE5Nw==", "bodyText": "same in AWS", "url": "https://github.com/hortonworks/cloudbreak/pull/7184#discussion_r374516197", "createdAt": "2020-02-04T07:49:11Z", "author": {"login": "topolyai5"}, "path": "cloud-azure/src/main/java/com/sequenceiq/cloudbreak/cloud/azure/AzureSubnetRequestProvider.java", "diffHunk": "@@ -0,0 +1,37 @@\n+package com.sequenceiq.cloudbreak.cloud.azure;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import org.springframework.stereotype.Component;\n+\n+import com.sequenceiq.cloudbreak.cloud.model.network.SubnetRequest;\n+\n+@Component\n+public class AzureSubnetRequestProvider {\n+\n+    public List<SubnetRequest> provide(String region, List<String> publicSubnetCidrs,  List<String> privateSubnetCidrs) {\n+        List<SubnetRequest> subnets = new ArrayList<>();\n+        int index = 0;\n+\n+        for (int i = 0; i < publicSubnetCidrs.size(); i++) {\n+            SubnetRequest subnetRequest = new SubnetRequest();\n+            subnetRequest.setPublicSubnetCidr(publicSubnetCidrs.get(i));\n+            subnetRequest.setAvailabilityZone(region);\n+            subnetRequest.setSubnetGroup(i % publicSubnetCidrs.size());\n+            subnetRequest.setIndex(index++);\n+            subnets.add(subnetRequest);\n+        }\n+\n+        for (int i = 0; i < privateSubnetCidrs.size(); i++) {\n+            SubnetRequest subnetRequest = new SubnetRequest();\n+            subnetRequest.setPrivateSubnetCidr(privateSubnetCidrs.get(i));\n+            subnetRequest.setAvailabilityZone(region);\n+            subnetRequest.setSubnetGroup(i % publicSubnetCidrs.size());\n+            subnetRequest.setIndex(index++);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "395acafcda692290bb5237dc9fb11a27cb654294"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDUxNjcwNQ==", "bodyText": "I think you can refactor these lines", "url": "https://github.com/hortonworks/cloudbreak/pull/7184#discussion_r374516705", "createdAt": "2020-02-04T07:50:42Z", "author": {"login": "topolyai5"}, "path": "cloud-azure/src/main/java/com/sequenceiq/cloudbreak/cloud/azure/AzureSubnetRequestProvider.java", "diffHunk": "@@ -0,0 +1,37 @@\n+package com.sequenceiq.cloudbreak.cloud.azure;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import org.springframework.stereotype.Component;\n+\n+import com.sequenceiq.cloudbreak.cloud.model.network.SubnetRequest;\n+\n+@Component\n+public class AzureSubnetRequestProvider {\n+\n+    public List<SubnetRequest> provide(String region, List<String> publicSubnetCidrs,  List<String> privateSubnetCidrs) {\n+        List<SubnetRequest> subnets = new ArrayList<>();\n+        int index = 0;\n+\n+        for (int i = 0; i < publicSubnetCidrs.size(); i++) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "395acafcda692290bb5237dc9fb11a27cb654294"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "996eba33925d27ed3d363f6f1d20de91bfef50f7", "author": {"user": {"login": "doktoric", "name": "Richard Doktorics"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/996eba33925d27ed3d363f6f1d20de91bfef50f7", "committedDate": "2020-02-04T07:59:24Z", "message": "CB-5076 subnet configurations for experiences"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "395acafcda692290bb5237dc9fb11a27cb654294", "author": {"user": {"login": "doktoric", "name": "Richard Doktorics"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/395acafcda692290bb5237dc9fb11a27cb654294", "committedDate": "2020-02-03T16:02:40Z", "message": "CB-5076 subnet configurations for experiences"}, "afterCommit": {"oid": "996eba33925d27ed3d363f6f1d20de91bfef50f7", "author": {"user": {"login": "doktoric", "name": "Richard Doktorics"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/996eba33925d27ed3d363f6f1d20de91bfef50f7", "committedDate": "2020-02-04T07:59:24Z", "message": "CB-5076 subnet configurations for experiences"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUyODM1ODc2", "url": "https://github.com/hortonworks/cloudbreak/pull/7184#pullrequestreview-352835876", "createdAt": "2020-02-04T09:39:34Z", "commit": {"oid": "996eba33925d27ed3d363f6f1d20de91bfef50f7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1930, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}