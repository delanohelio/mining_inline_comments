{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIxNzI3Mjc2", "number": 9434, "title": "CB-9554 recognize if salt highstate fails, because it is is running with another PID", "bodyText": "", "createdAt": "2020-11-16T15:12:30Z", "url": "https://github.com/hortonworks/cloudbreak/pull/9434", "merged": true, "mergeCommit": {"oid": "61867ece26a4c498f576bc813fdda5d7ab259b7f"}, "closed": true, "closedAt": "2020-11-17T18:13:49Z", "author": {"login": "sodre90"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABddWfOBgFqTUzMjE4NDg0Ng==", "endCursor": "Y3Vyc29yOnYyOpPPAAABddcGaTgBqjQwMDYzNjMyNjM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMyMTg0ODQ2", "url": "https://github.com/hortonworks/cloudbreak/pull/9434#pullrequestreview-532184846", "createdAt": "2020-11-17T09:44:10Z", "commit": {"oid": "bc7d01718418a0d6123dba1278918e76c28bcc94"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QwOTo0NDoxMFrOH0sebg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QwOTo1Mjo0NFrOH0s1xQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTAxNjY4Ng==", "bodyText": "isEmpty() please", "url": "https://github.com/hortonworks/cloudbreak/pull/9434#discussion_r525016686", "createdAt": "2020-11-17T09:44:10Z", "author": {"login": "lacikaaa"}, "path": "flow/src/main/java/com/sequenceiq/flow/service/flowlog/FlowLogDBService.java", "diffHunk": "@@ -267,7 +268,11 @@ public FlowLog getLastFlowLogByResourceCrnOrName(String resource) {\n \n     public List<FlowLog> getFlowLogsByFlowIdsCreatedDesc(Set<String> flowIds) {\n         LOGGER.info(\"Getting flow logs by these flow ids: {}\", Joiner.on(\",\").join(flowIds));\n-        return flowLogRepository.findAllByFlowIdsCreatedDesc(flowIds);\n+        if (flowIds.size() > 0) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc7d01718418a0d6123dba1278918e76c28bcc94"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTAyMjY2MQ==", "bodyText": "this seems to be ambiguous to me. I think it would be better to use pattern matching here to get the number, which should be a number if I remember it well.\nAlso there is no unit tests for this.\nthis branch the if could be moved to a method called sth like extractRunningHighstateJid or similar", "url": "https://github.com/hortonworks/cloudbreak/pull/9434#discussion_r525022661", "createdAt": "2020-11-17T09:52:44Z", "author": {"login": "lacikaaa"}, "path": "orchestrator-salt/src/main/java/com/sequenceiq/cloudbreak/orchestrator/salt/states/SaltStates.java", "diffHunk": "@@ -99,7 +99,18 @@ public static ApplyFullResponse showState(SaltConnector sc, String state) {\n \n     public static Multimap<String, Map<String, String>> jidInfo(SaltConnector sc, String jid, Target<String> target, StateType stateType) {\n         if (StateType.HIGH.equals(stateType)) {\n-            return highStateJidInfo(sc, jid);\n+            try {\n+                return highStateJidInfo(sc, jid);\n+            } catch (SaltExecutionWentWrongException e) {\n+                String errorMessage = e.getMessage();\n+                if (errorMessage != null && errorMessage.contains(\"The function \\\"state.highstate\\\" is running as PID\")) {\n+                    String runningHighStateJid = errorMessage.replaceAll(\".*The function \\\"state\\\\.highstate\\\" is running as PID.*with jid \", \"\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc7d01718418a0d6123dba1278918e76c28bcc94"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMyMTkzMDk5", "url": "https://github.com/hortonworks/cloudbreak/pull/9434#pullrequestreview-532193099", "createdAt": "2020-11-17T09:53:34Z", "commit": {"oid": "bc7d01718418a0d6123dba1278918e76c28bcc94"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QwOTo1MzozNVrOH0s4AQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QwOTo1MzozNVrOH0s4AQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTAyMzIzMw==", "bodyText": "Unit test is missing for this logic.", "url": "https://github.com/hortonworks/cloudbreak/pull/9434#discussion_r525023233", "createdAt": "2020-11-17T09:53:35Z", "author": {"login": "lnardai"}, "path": "orchestrator-salt/src/main/java/com/sequenceiq/cloudbreak/orchestrator/salt/states/SaltStates.java", "diffHunk": "@@ -99,7 +99,18 @@ public static ApplyFullResponse showState(SaltConnector sc, String state) {\n \n     public static Multimap<String, Map<String, String>> jidInfo(SaltConnector sc, String jid, Target<String> target, StateType stateType) {\n         if (StateType.HIGH.equals(stateType)) {\n-            return highStateJidInfo(sc, jid);\n+            try {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc7d01718418a0d6123dba1278918e76c28bcc94"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bc7d01718418a0d6123dba1278918e76c28bcc94", "author": {"user": {"login": "sodre90", "name": "Erd\u0151s P\u00e9ter"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/bc7d01718418a0d6123dba1278918e76c28bcc94", "committedDate": "2020-11-16T15:01:36Z", "message": "CB-9554 recognize if salt highstate fails, because it is is running with another PID"}, "afterCommit": {"oid": "752cfa75bf427b7e62bf18bd9813b3ad6a2651ba", "author": {"user": {"login": "sodre90", "name": "Erd\u0151s P\u00e9ter"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/752cfa75bf427b7e62bf18bd9813b3ad6a2651ba", "committedDate": "2020-11-17T14:55:50Z", "message": "CB-9554 recognize if salt highstate fails, because it is is running with another PID"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "752cfa75bf427b7e62bf18bd9813b3ad6a2651ba", "author": {"user": {"login": "sodre90", "name": "Erd\u0151s P\u00e9ter"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/752cfa75bf427b7e62bf18bd9813b3ad6a2651ba", "committedDate": "2020-11-17T14:55:50Z", "message": "CB-9554 recognize if salt highstate fails, because it is is running with another PID"}, "afterCommit": {"oid": "4f3df1d5069a767cc3d45db52f1c0d04b29e776e", "author": {"user": {"login": "sodre90", "name": "Erd\u0151s P\u00e9ter"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/4f3df1d5069a767cc3d45db52f1c0d04b29e776e", "committedDate": "2020-11-17T16:06:57Z", "message": "CB-9554 recognize if salt highstate fails, because it is is running with another PID"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMyNTQ2NDc2", "url": "https://github.com/hortonworks/cloudbreak/pull/9434#pullrequestreview-532546476", "createdAt": "2020-11-17T16:21:54Z", "commit": {"oid": "4f3df1d5069a767cc3d45db52f1c0d04b29e776e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c6b4d590c5c8835abbf5767f7b181f208b962ecd", "author": {"user": {"login": "sodre90", "name": "Erd\u0151s P\u00e9ter"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/c6b4d590c5c8835abbf5767f7b181f208b962ecd", "committedDate": "2020-11-17T16:25:03Z", "message": "CB-9554 recognize if salt highstate fails, because it is is running with another PID"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4f3df1d5069a767cc3d45db52f1c0d04b29e776e", "author": {"user": {"login": "sodre90", "name": "Erd\u0151s P\u00e9ter"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/4f3df1d5069a767cc3d45db52f1c0d04b29e776e", "committedDate": "2020-11-17T16:06:57Z", "message": "CB-9554 recognize if salt highstate fails, because it is is running with another PID"}, "afterCommit": {"oid": "c6b4d590c5c8835abbf5767f7b181f208b962ecd", "author": {"user": {"login": "sodre90", "name": "Erd\u0151s P\u00e9ter"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/c6b4d590c5c8835abbf5767f7b181f208b962ecd", "committedDate": "2020-11-17T16:25:03Z", "message": "CB-9554 recognize if salt highstate fails, because it is is running with another PID"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2120, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}