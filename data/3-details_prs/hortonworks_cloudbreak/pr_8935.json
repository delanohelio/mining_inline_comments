{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgwMzQzNjI1", "number": 8935, "title": "CB-7938: Enable delete protection for RDS to avoid accidental deletions.", "bodyText": "Solution approach:\nWhen the RDS is created we should enable delete protection. This makes sure that customers don't accidentally delete the database.\nWhile terminating the database, we need to disable the delete protection if enabled, and then terminate the database.", "createdAt": "2020-09-05T01:15:06Z", "url": "https://github.com/hortonworks/cloudbreak/pull/8935", "merged": true, "mergeCommit": {"oid": "a4f524d417c087153d5cda3fcfeda7d60ddec588"}, "closed": true, "closedAt": "2020-09-08T20:20:14Z", "author": {"login": "kkalvagadda1"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdFvQcEgH2gAyNDgwMzQzNjI1OjE4MzgzZGEzMzQ4MTk5OWUyYmUxNWQ4ZDQzZDQ1ZjY4N2RkODMyNTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdG6nDiABqjM3NDE5NDE0MDk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "18383da33481999e2be15d8d43d45f687dd83252", "author": {"user": {"login": "kkalvagadda1", "name": "kalyan kumar kalvagadda"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/18383da33481999e2be15d8d43d45f687dd83252", "committedDate": "2020-09-05T01:10:21Z", "message": "CB-7938: Enable delete protection for RDS to avoid accidental deletions."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgzMjY4NjYy", "url": "https://github.com/hortonworks/cloudbreak/pull/8935#pullrequestreview-483268662", "createdAt": "2020-09-07T06:22:20Z", "commit": {"oid": "18383da33481999e2be15d8d43d45f687dd83252"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QwNjoyMjoyMFrOHNxjXg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QwNjoyMjoyMFrOHNxjXg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDIwNTQwNg==", "bodyText": "isDeleteProtectionEnabled", "url": "https://github.com/hortonworks/cloudbreak/pull/8935#discussion_r484205406", "createdAt": "2020-09-07T06:22:20Z", "author": {"login": "doktoric"}, "path": "cloud-aws/src/main/java/com/sequenceiq/cloudbreak/cloud/aws/connector/resource/AwsRdsStatusLookupService.java", "diffHunk": "@@ -44,6 +49,28 @@ public ExternalDatabaseStatus getStatus(AuthenticatedContext ac, DatabaseStack d\n                 .get();\n     }\n \n+    public boolean isDeleteProtectonEnabled(AuthenticatedContext ac, DatabaseStack dbStack) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "18383da33481999e2be15d8d43d45f687dd83252"}, "originalPosition": 32}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgzMjY4ODAw", "url": "https://github.com/hortonworks/cloudbreak/pull/8935#pullrequestreview-483268800", "createdAt": "2020-09-07T06:22:40Z", "commit": {"oid": "18383da33481999e2be15d8d43d45f687dd83252"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QwNjoyMjo0MFrOHNxjxg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QwNjoyMjo0MFrOHNxjxg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDIwNTUxMA==", "bodyText": "isDeleteProtectionEnabled", "url": "https://github.com/hortonworks/cloudbreak/pull/8935#discussion_r484205510", "createdAt": "2020-09-07T06:22:40Z", "author": {"login": "doktoric"}, "path": "cloud-aws/src/main/java/com/sequenceiq/cloudbreak/cloud/aws/connector/resource/AwsResourceConnector.java", "diffHunk": "@@ -118,6 +121,10 @@ private boolean deployingToSameVPC(AwsNetworkView awsNetworkView, boolean existi\n     @Override\n     public List<CloudResourceStatus> terminateDatabaseServer(AuthenticatedContext ac, DatabaseStack stack,\n             List<CloudResource> resources, PersistenceNotifier persistenceNotifier, boolean force) throws Exception {\n+        if(awsRdsStatusLookupService.isDeleteProtectonEnabled(ac, stack)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "18383da33481999e2be15d8d43d45f687dd83252"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgzMjY5MDUy", "url": "https://github.com/hortonworks/cloudbreak/pull/8935#pullrequestreview-483269052", "createdAt": "2020-09-07T06:23:11Z", "commit": {"oid": "18383da33481999e2be15d8d43d45f687dd83252"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QwNjoyMzoxMVrOHNxklA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wN1QwNjoyMzoxMVrOHNxklA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDIwNTcxNg==", "bodyText": "available ?", "url": "https://github.com/hortonworks/cloudbreak/pull/8935#discussion_r484205716", "createdAt": "2020-09-07T06:23:11Z", "author": {"login": "doktoric"}, "path": "cloud-aws/src/main/java/com/sequenceiq/cloudbreak/cloud/aws/scheduler/CustomAmazonWaiterProvider.java", "diffHunk": "@@ -81,4 +81,37 @@ public WaiterState getState() {\n                         new FixedDelayStrategy(DEFAULT_DELAY_IN_SECONDS)))\n                 .withExecutorService(WaiterExecutorServiceFactory.buildExecutorServiceForWaiter(\"AmazonRDSWaiters\")).build();\n     }\n+\n+    public Waiter<DescribeDBInstancesRequest> getDbInstanceModifyWaiter(AmazonRDS rdsClient) {\n+        return new WaiterBuilder<DescribeDBInstancesRequest, DescribeDBInstancesResult>()\n+                .withSdkFunction(new DescribeDBInstancesFunction(rdsClient))\n+                .withAcceptors(new WaiterAcceptor<DescribeDBInstancesResult>() {\n+                    @Override\n+                    public boolean matches(DescribeDBInstancesResult describeDBInstancesResult) {\n+                        return describeDBInstancesResult.getDBInstances().stream().allMatch(instance -> \"avaialble\".equals(instance.getDBInstanceStatus()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "18383da33481999e2be15d8d43d45f687dd83252"}, "originalPosition": 11}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgzMjY5ODUw", "url": "https://github.com/hortonworks/cloudbreak/pull/8935#pullrequestreview-483269850", "createdAt": "2020-09-07T06:24:58Z", "commit": {"oid": "18383da33481999e2be15d8d43d45f687dd83252"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "19e60d9d007025ea48d5b4efbbaa843fa2be30e9", "author": {"user": {"login": "kkalvagadda1", "name": "kalyan kumar kalvagadda"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/19e60d9d007025ea48d5b4efbbaa843fa2be30e9", "committedDate": "2020-09-08T16:57:38Z", "message": "CB-7938: Enable delete protection for RDS to avoid accidental deletions. Addressed review comments and also fixed the style check errors."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5d7501a386077500feb1dba084521ee6259311ce", "author": {"user": {"login": "kkalvagadda1", "name": "kalyan kumar kalvagadda"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/5d7501a386077500feb1dba084521ee6259311ce", "committedDate": "2020-09-08T16:55:05Z", "message": "CB-7938: Enable delete protection for RDS to avoid accidental deletions. Addressed review comments and also fixed the style check errors."}, "afterCommit": {"oid": "19e60d9d007025ea48d5b4efbbaa843fa2be30e9", "author": {"user": {"login": "kkalvagadda1", "name": "kalyan kumar kalvagadda"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/19e60d9d007025ea48d5b4efbbaa843fa2be30e9", "committedDate": "2020-09-08T16:57:38Z", "message": "CB-7938: Enable delete protection for RDS to avoid accidental deletions. Addressed review comments and also fixed the style check errors."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2421, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}