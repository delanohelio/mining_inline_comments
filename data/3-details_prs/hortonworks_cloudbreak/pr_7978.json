{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEzOTM0Nzgy", "number": 7978, "title": "CB-6576 Azure single RG: env service RG validations", "bodyText": "", "createdAt": "2020-05-06T07:53:38Z", "url": "https://github.com/hortonworks/cloudbreak/pull/7978", "merged": true, "mergeCommit": {"oid": "771f19bad4fcb4404d4ea81ceb29f5f8e3e9c61f"}, "closed": true, "closedAt": "2020-05-08T09:58:15Z", "author": {"login": "gergopapi2"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABceoBElgFqTQwNjU3MTM1OA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcfO4VKAFqTQwODEzMjM4MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA2NTcxMzU4", "url": "https://github.com/hortonworks/cloudbreak/pull/7978#pullrequestreview-406571358", "createdAt": "2020-05-06T12:41:11Z", "commit": {"oid": "5928ef95c8dbd59a1d8a29dafab4922fee13afeb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3MzA4Mzk2", "url": "https://github.com/hortonworks/cloudbreak/pull/7978#pullrequestreview-407308396", "createdAt": "2020-05-07T09:37:43Z", "commit": {"oid": "5928ef95c8dbd59a1d8a29dafab4922fee13afeb"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QwOTozNzo0M1rOGR2kxQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QwOTo0NjoxN1rOGR25hg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTM3MzEyNQ==", "bodyText": "This should be with @OverRide", "url": "https://github.com/hortonworks/cloudbreak/pull/7978#discussion_r421373125", "createdAt": "2020-05-07T09:37:43Z", "author": {"login": "pdarvasi"}, "path": "environment/src/main/java/com/sequenceiq/environment/parameters/validation/validators/parameter/AwsParameterValidator.java", "diffHunk": "@@ -24,15 +27,17 @@\n \n     private final ParametersService parametersService;\n \n-    public AwsParameterProcessor(NoSqlTableCreationModeDeterminerService noSqlTableCreationModeDeterminerService,\n+    public AwsParameterValidator(NoSqlTableCreationModeDeterminerService noSqlTableCreationModeDeterminerService,\n             ParametersService parametersService) {\n         this.noSqlTableCreationModeDeterminerService = noSqlTableCreationModeDeterminerService;\n         this.parametersService = parametersService;\n     }\n \n-    public ValidationResult processAwsParameters(EnvironmentDto environmentDto, ParametersDto parametersDto) {\n-        ValidationResultBuilder validationResultBuilder = new ValidationResultBuilder();\n+    public ValidationResult validate(EnvironmentDto environmentDto, ParametersDto parametersDto, ValidationResultBuilder validationResultBuilder) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5928ef95c8dbd59a1d8a29dafab4922fee13afeb"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTM3NjM4Mw==", "bodyText": "We should add some log to the validation process", "url": "https://github.com/hortonworks/cloudbreak/pull/7978#discussion_r421376383", "createdAt": "2020-05-07T09:43:03Z", "author": {"login": "pdarvasi"}, "path": "environment/src/main/java/com/sequenceiq/environment/parameters/validation/validators/parameter/AwsParameterValidator.java", "diffHunk": "@@ -24,15 +27,17 @@\n \n     private final ParametersService parametersService;\n \n-    public AwsParameterProcessor(NoSqlTableCreationModeDeterminerService noSqlTableCreationModeDeterminerService,\n+    public AwsParameterValidator(NoSqlTableCreationModeDeterminerService noSqlTableCreationModeDeterminerService,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5928ef95c8dbd59a1d8a29dafab4922fee13afeb"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTM3NjQ2Ng==", "bodyText": "We should add some log to the validation process", "url": "https://github.com/hortonworks/cloudbreak/pull/7978#discussion_r421376466", "createdAt": "2020-05-07T09:43:10Z", "author": {"login": "pdarvasi"}, "path": "environment/src/main/java/com/sequenceiq/environment/parameters/validation/validators/parameter/AzureParameterValidator.java", "diffHunk": "@@ -0,0 +1,67 @@\n+package com.sequenceiq.environment.parameters.validation.validators.parameter;\n+\n+import static com.sequenceiq.environment.parameters.dao.domain.ResourceGroupCreation.USE_EXISTING;\n+import static com.sequenceiq.environment.parameters.dao.domain.ResourceGroupUsagePattern.USE_MULTIPLE;\n+\n+import java.util.Objects;\n+\n+import javax.inject.Inject;\n+\n+import org.springframework.stereotype.Component;\n+\n+import com.sequenceiq.cloudbreak.cloud.azure.client.AzureClient;\n+import com.sequenceiq.cloudbreak.cloud.azure.client.AzureClientService;\n+import com.sequenceiq.cloudbreak.cloud.init.CloudPlatformConnectors;\n+import com.sequenceiq.cloudbreak.cloud.model.CloudCredential;\n+import com.sequenceiq.cloudbreak.common.mappable.CloudPlatform;\n+import com.sequenceiq.cloudbreak.featureswitch.AzureSingleResourceGroupFeatureSwitch;\n+import com.sequenceiq.cloudbreak.validation.ValidationResult;\n+import com.sequenceiq.cloudbreak.validation.ValidationResult.ValidationResultBuilder;\n+import com.sequenceiq.environment.credential.v1.converter.CredentialToCloudCredentialConverter;\n+import com.sequenceiq.environment.environment.dto.EnvironmentDto;\n+import com.sequenceiq.environment.parameters.dto.AzureParametersDto;\n+import com.sequenceiq.environment.parameters.dto.AzureResourceGroupDto;\n+import com.sequenceiq.environment.parameters.dto.ParametersDto;\n+\n+@Component\n+public class AzureParameterValidator implements ParameterValidator {\n+\n+    @Inject\n+    private CloudPlatformConnectors cloudPlatformConnectors;\n+\n+    @Inject\n+    private AzureClientService azureClientService;\n+\n+    @Inject\n+    private CredentialToCloudCredentialConverter credentialToCloudCredentialConverter;\n+\n+    @Inject\n+    private AzureSingleResourceGroupFeatureSwitch azureSingleResourceGroupFeatureSwitch;\n+\n+    @Override\n+    public ValidationResult validate(EnvironmentDto environmentDto, ParametersDto parametersDto, ValidationResultBuilder validationResultBuilder) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5928ef95c8dbd59a1d8a29dafab4922fee13afeb"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTM3ODMxNQ==", "bodyText": "We should use ValidationResult.empty() instead", "url": "https://github.com/hortonworks/cloudbreak/pull/7978#discussion_r421378315", "createdAt": "2020-05-07T09:46:06Z", "author": {"login": "pdarvasi"}, "path": "environment/src/main/java/com/sequenceiq/environment/parameters/validation/validators/parameter/AzureParameterValidator.java", "diffHunk": "@@ -0,0 +1,67 @@\n+package com.sequenceiq.environment.parameters.validation.validators.parameter;\n+\n+import static com.sequenceiq.environment.parameters.dao.domain.ResourceGroupCreation.USE_EXISTING;\n+import static com.sequenceiq.environment.parameters.dao.domain.ResourceGroupUsagePattern.USE_MULTIPLE;\n+\n+import java.util.Objects;\n+\n+import javax.inject.Inject;\n+\n+import org.springframework.stereotype.Component;\n+\n+import com.sequenceiq.cloudbreak.cloud.azure.client.AzureClient;\n+import com.sequenceiq.cloudbreak.cloud.azure.client.AzureClientService;\n+import com.sequenceiq.cloudbreak.cloud.init.CloudPlatformConnectors;\n+import com.sequenceiq.cloudbreak.cloud.model.CloudCredential;\n+import com.sequenceiq.cloudbreak.common.mappable.CloudPlatform;\n+import com.sequenceiq.cloudbreak.featureswitch.AzureSingleResourceGroupFeatureSwitch;\n+import com.sequenceiq.cloudbreak.validation.ValidationResult;\n+import com.sequenceiq.cloudbreak.validation.ValidationResult.ValidationResultBuilder;\n+import com.sequenceiq.environment.credential.v1.converter.CredentialToCloudCredentialConverter;\n+import com.sequenceiq.environment.environment.dto.EnvironmentDto;\n+import com.sequenceiq.environment.parameters.dto.AzureParametersDto;\n+import com.sequenceiq.environment.parameters.dto.AzureResourceGroupDto;\n+import com.sequenceiq.environment.parameters.dto.ParametersDto;\n+\n+@Component\n+public class AzureParameterValidator implements ParameterValidator {\n+\n+    @Inject\n+    private CloudPlatformConnectors cloudPlatformConnectors;\n+\n+    @Inject\n+    private AzureClientService azureClientService;\n+\n+    @Inject\n+    private CredentialToCloudCredentialConverter credentialToCloudCredentialConverter;\n+\n+    @Inject\n+    private AzureSingleResourceGroupFeatureSwitch azureSingleResourceGroupFeatureSwitch;\n+\n+    @Override\n+    public ValidationResult validate(EnvironmentDto environmentDto, ParametersDto parametersDto, ValidationResultBuilder validationResultBuilder) {\n+        AzureParametersDto azureParametersDto = parametersDto.azureParametersDto();\n+        if (!azureSingleResourceGroupFeatureSwitch.isActive() || Objects.isNull(azureParametersDto)) {\n+            return validationResultBuilder.build();\n+        }\n+\n+        AzureResourceGroupDto azureResourceGroupDto = azureParametersDto.getAzureResourceGroupDto();\n+        if (Objects.isNull(azureResourceGroupDto)\n+                || USE_MULTIPLE.equals(azureResourceGroupDto.getResourceGroupUsagePattern())\n+                || !USE_EXISTING.equals(azureResourceGroupDto.getResourceGroupCreation())) {\n+            return validationResultBuilder.build();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5928ef95c8dbd59a1d8a29dafab4922fee13afeb"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTM3ODQzOA==", "bodyText": "We should use ValidationResult.empty() instead", "url": "https://github.com/hortonworks/cloudbreak/pull/7978#discussion_r421378438", "createdAt": "2020-05-07T09:46:17Z", "author": {"login": "pdarvasi"}, "path": "environment/src/main/java/com/sequenceiq/environment/parameters/validation/validators/parameter/AwsParameterValidator.java", "diffHunk": "@@ -24,15 +27,17 @@\n \n     private final ParametersService parametersService;\n \n-    public AwsParameterProcessor(NoSqlTableCreationModeDeterminerService noSqlTableCreationModeDeterminerService,\n+    public AwsParameterValidator(NoSqlTableCreationModeDeterminerService noSqlTableCreationModeDeterminerService,\n             ParametersService parametersService) {\n         this.noSqlTableCreationModeDeterminerService = noSqlTableCreationModeDeterminerService;\n         this.parametersService = parametersService;\n     }\n \n-    public ValidationResult processAwsParameters(EnvironmentDto environmentDto, ParametersDto parametersDto) {\n-        ValidationResultBuilder validationResultBuilder = new ValidationResultBuilder();\n+    public ValidationResult validate(EnvironmentDto environmentDto, ParametersDto parametersDto, ValidationResultBuilder validationResultBuilder) {\n         AwsParametersDto awsParametersDto = parametersDto.getAwsParametersDto();\n+        if (Objects.isNull(awsParametersDto)) {\n+            return validationResultBuilder.build();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5928ef95c8dbd59a1d8a29dafab4922fee13afeb"}, "originalPosition": 38}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3ae1717672813a5dc2670f13b576c70b345ab333", "author": {"user": {"login": "gergopapi2", "name": "Gergely Papp"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/3ae1717672813a5dc2670f13b576c70b345ab333", "committedDate": "2020-05-08T06:53:06Z", "message": "CB-6576 Azure single RG: env service RG validations"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5928ef95c8dbd59a1d8a29dafab4922fee13afeb", "author": {"user": {"login": "gergopapi2", "name": "Gergely Papp"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/5928ef95c8dbd59a1d8a29dafab4922fee13afeb", "committedDate": "2020-05-06T07:52:58Z", "message": "CB-6576 Azure single RG: env service RG validations"}, "afterCommit": {"oid": "3ae1717672813a5dc2670f13b576c70b345ab333", "author": {"user": {"login": "gergopapi2", "name": "Gergely Papp"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/3ae1717672813a5dc2670f13b576c70b345ab333", "committedDate": "2020-05-08T06:53:06Z", "message": "CB-6576 Azure single RG: env service RG validations"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4MTMyMzgx", "url": "https://github.com/hortonworks/cloudbreak/pull/7978#pullrequestreview-408132381", "createdAt": "2020-05-08T09:57:56Z", "commit": {"oid": "3ae1717672813a5dc2670f13b576c70b345ab333"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2174, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}