{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA3NDc5OTk2", "number": 7876, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QwNTo1OTo0MlrOD1GzFQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQwOToxMDoyNFrOD3GXuw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU3MDEyNTAxOnYy", "diffSide": "RIGHT", "path": "freeipa/src/main/resources/freeipa-salt/salt/freeipa/common-install.sls", "isResolved": true, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QwNTo1OTo0MlrOGKX7jQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QxODo1MDozOFrOGMylQg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzUzMTAyMQ==", "bodyText": "shouldn't this state have any onlyif/unless option, so we won't run it if not necessary?", "url": "https://github.com/hortonworks/cloudbreak/pull/7876#discussion_r413531021", "createdAt": "2020-04-23T05:59:42Z", "author": {"login": "lacikaaa"}, "path": "freeipa/src/main/resources/freeipa-salt/salt/freeipa/common-install.sls", "diffHunk": "@@ -65,3 +65,19 @@ restart_httpd:\n     - watch:\n       - file: /etc/httpd/conf.d/ipa-rewrite.conf\n \n+install-healthagent:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "453867c1b31eb30d364d63d52cc9d01dedf2e6f4"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzg0MjcxMA==", "bodyText": "There was an unless option before, but I think there was a timing problem between the unless call and the actual script because it should not have run based on the unless, but things were failing because it was.  I moved the unless check into the script itself so the script may be called but the actual action isn't performed unless it's necessary.", "url": "https://github.com/hortonworks/cloudbreak/pull/7876#discussion_r413842710", "createdAt": "2020-04-23T14:26:45Z", "author": {"login": "holleyism"}, "path": "freeipa/src/main/resources/freeipa-salt/salt/freeipa/common-install.sls", "diffHunk": "@@ -65,3 +65,19 @@ restart_httpd:\n     - watch:\n       - file: /etc/httpd/conf.d/ipa-rewrite.conf\n \n+install-healthagent:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzUzMTAyMQ=="}, "originalCommit": {"oid": "453867c1b31eb30d364d63d52cc9d01dedf2e6f4"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzg4NjYyNQ==", "bodyText": "this will cause saltstack will always detect this as a change which is not ideal. we can still place a file somewhere from the script and check that from unless", "url": "https://github.com/hortonworks/cloudbreak/pull/7876#discussion_r413886625", "createdAt": "2020-04-23T15:16:44Z", "author": {"login": "lacikaaa"}, "path": "freeipa/src/main/resources/freeipa-salt/salt/freeipa/common-install.sls", "diffHunk": "@@ -65,3 +65,19 @@ restart_httpd:\n     - watch:\n       - file: /etc/httpd/conf.d/ipa-rewrite.conf\n \n+install-healthagent:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzUzMTAyMQ=="}, "originalCommit": {"oid": "453867c1b31eb30d364d63d52cc9d01dedf2e6f4"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDE0ODk2MA==", "bodyText": "updated to a better check.", "url": "https://github.com/hortonworks/cloudbreak/pull/7876#discussion_r414148960", "createdAt": "2020-04-23T21:52:27Z", "author": {"login": "holleyism"}, "path": "freeipa/src/main/resources/freeipa-salt/salt/freeipa/common-install.sls", "diffHunk": "@@ -65,3 +65,19 @@ restart_httpd:\n     - watch:\n       - file: /etc/httpd/conf.d/ipa-rewrite.conf\n \n+install-healthagent:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzUzMTAyMQ=="}, "originalCommit": {"oid": "453867c1b31eb30d364d63d52cc9d01dedf2e6f4"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTkxOTQ1MA==", "bodyText": "I think you should place the unless script in the require part too", "url": "https://github.com/hortonworks/cloudbreak/pull/7876#discussion_r415919450", "createdAt": "2020-04-27T15:36:48Z", "author": {"login": "lacikaaa"}, "path": "freeipa/src/main/resources/freeipa-salt/salt/freeipa/common-install.sls", "diffHunk": "@@ -65,3 +65,19 @@ restart_httpd:\n     - watch:\n       - file: /etc/httpd/conf.d/ipa-rewrite.conf\n \n+install-healthagent:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzUzMTAyMQ=="}, "originalCommit": {"oid": "453867c1b31eb30d364d63d52cc9d01dedf2e6f4"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjA2NDgzNA==", "bodyText": "added", "url": "https://github.com/hortonworks/cloudbreak/pull/7876#discussion_r416064834", "createdAt": "2020-04-27T18:50:38Z", "author": {"login": "holleyism"}, "path": "freeipa/src/main/resources/freeipa-salt/salt/freeipa/common-install.sls", "diffHunk": "@@ -65,3 +65,19 @@ restart_httpd:\n     - watch:\n       - file: /etc/httpd/conf.d/ipa-rewrite.conf\n \n+install-healthagent:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzUzMTAyMQ=="}, "originalCommit": {"oid": "453867c1b31eb30d364d63d52cc9d01dedf2e6f4"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU5MTAyNjUxOnYy", "diffSide": "RIGHT", "path": "freeipa/src/main/resources/freeipa-salt/salt/freeipa/scripts/freeipa_healthagent_setup.sh", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQwOToxMDoyNFrOGNKcew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQxMjo0NjoyOFrOGNSOYw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjQ1NTgwMw==", "bodyText": "I just noticed that this duplicates the content of freeipa_check_replication.sh. could you update this to have it only in one place, eg. like a method and use that in both place?", "url": "https://github.com/hortonworks/cloudbreak/pull/7876#discussion_r416455803", "createdAt": "2020-04-28T09:10:24Z", "author": {"login": "lacikaaa"}, "path": "freeipa/src/main/resources/freeipa-salt/salt/freeipa/scripts/freeipa_healthagent_setup.sh", "diffHunk": "@@ -0,0 +1,19 @@\n+#!/usr/bin/env bash\n+\n+#\n+# Add anonymous access only for replication agreements\n+#\n+\n+export HOSTCN=`hostname -d| sed -E 's/^|\\./,dc=/g' | sed 's/^,//g'`\n+\n+ldapsearch -x -h localhost -D \"cn=directory manager\" -w $FPW -b \"$HOSTCN\" -s base \"(objectclass=*)\"\n+status=$?", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eb2b0b3e05f18dceb2ba192adf6ca165bd1fb6d8"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjU4MzI2Nw==", "bodyText": "changed.", "url": "https://github.com/hortonworks/cloudbreak/pull/7876#discussion_r416583267", "createdAt": "2020-04-28T12:46:28Z", "author": {"login": "holleyism"}, "path": "freeipa/src/main/resources/freeipa-salt/salt/freeipa/scripts/freeipa_healthagent_setup.sh", "diffHunk": "@@ -0,0 +1,19 @@\n+#!/usr/bin/env bash\n+\n+#\n+# Add anonymous access only for replication agreements\n+#\n+\n+export HOSTCN=`hostname -d| sed -E 's/^|\\./,dc=/g' | sed 's/^,//g'`\n+\n+ldapsearch -x -h localhost -D \"cn=directory manager\" -w $FPW -b \"$HOSTCN\" -s base \"(objectclass=*)\"\n+status=$?", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjQ1NTgwMw=="}, "originalCommit": {"oid": "eb2b0b3e05f18dceb2ba192adf6ca165bd1fb6d8"}, "originalPosition": 10}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2485, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}