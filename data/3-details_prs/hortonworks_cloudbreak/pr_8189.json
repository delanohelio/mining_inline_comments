{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI2Mjk3Mzg4", "number": 8189, "title": "DISTX-421 Separate endpoint for autoscale recommendation", "bodyText": "Autoscale needs a recommendation endpoint for the backend verification in periscope.\nTested by changing the auth and setting the workspace and blueprint manually.\n\nDepends on PR #8100 so sent to that PRs branch instead of master.", "createdAt": "2020-06-02T01:31:26Z", "url": "https://github.com/hortonworks/cloudbreak/pull/8189", "merged": true, "mergeCommit": {"oid": "24c42b057875f7203d5eb262f542219be3136685"}, "closed": true, "closedAt": "2020-06-09T12:51:24Z", "author": {"login": "cegganesh84"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcnPeYEgFqTQyMjM5ODU0MA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcpavTzgBqjM0MjI2Mjc3MDA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIyMzk4NTQw", "url": "https://github.com/hortonworks/cloudbreak/pull/8189#pullrequestreview-422398540", "createdAt": "2020-06-02T07:10:03Z", "commit": {"oid": "cbf417194ac7b9d4cb971ce06a23b380b2887678"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQwNzoxMDowM1rOGdkzuw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMlQwNzoxMDowM1rOGdkzuw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzY2NDk1NQ==", "bodyText": "Can this take only clusterCrn and internally use blueprintName ?", "url": "https://github.com/hortonworks/cloudbreak/pull/8189#discussion_r433664955", "createdAt": "2020-06-02T07:10:03Z", "author": {"login": "smaniraju"}, "path": "core-api/src/main/java/com/sequenceiq/cloudbreak/api/endpoint/v4/autoscales/AutoscaleV4Endpoint.java", "diffHunk": "@@ -106,4 +107,10 @@ void decommissionInstancesForClusterCrn(@PathParam(\"crn\") String clusterCrn,\n     @Path(\"clusterproxy\")\n     @Produces(MediaType.APPLICATION_JSON)\n     ClusterProxyConfiguration getClusterProxyconfiguration();\n+\n+    @GET\n+    @Path(\"recommendation\")\n+    @Produces(MediaType.APPLICATION_JSON)\n+    AutoscaleRecommendationV4Response getRecommendation(@QueryParam(\"workspaceId\") Long workspaceId,\n+                                                        @QueryParam(\"blueprintName\") String blueprintName);\n }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cbf417194ac7b9d4cb971ce06a23b380b2887678"}, "originalPosition": 18}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIzMjMxMjM5", "url": "https://github.com/hortonworks/cloudbreak/pull/8189#pullrequestreview-423231239", "createdAt": "2020-06-03T05:38:16Z", "commit": {"oid": "2435dbb5d0b17cc515e9f1f6077b73177b4d15c3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QwNTozODoxNlrOGeMuEQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wM1QwNTozODoxNlrOGeMuEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDMxODg2NQ==", "bodyText": "This api is meant for internal periscope use which uses internalCrn for communication. It should use the earlier PreAuthorize checks  and not CheckPermissionByAccount.", "url": "https://github.com/hortonworks/cloudbreak/pull/8189#discussion_r434318865", "createdAt": "2020-06-03T05:38:16Z", "author": {"login": "smaniraju"}, "path": "core/src/main/java/com/sequenceiq/cloudbreak/controller/v4/AutoscaleV4Controller.java", "diffHunk": "@@ -157,8 +157,7 @@ public ClusterProxyConfiguration getClusterProxyconfiguration() {\n     }\n \n     @Override\n-    @DisableCheckPermissions\n-    @PreAuthorize(\"hasRole('AUTOSCALE')\")\n+    @CheckPermissionByAccount(action = AuthorizationResourceAction.DATAHUB_READ)\n     public AutoscaleRecommendationV4Response getRecommendation(Long workspaceId, String blueprintName) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2435dbb5d0b17cc515e9f1f6077b73177b4d15c3"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI0MTMxODgz", "url": "https://github.com/hortonworks/cloudbreak/pull/8189#pullrequestreview-424131883", "createdAt": "2020-06-04T06:19:51Z", "commit": {"oid": "577e97dfcc012c71f0732a2ed0c409ea421f653b"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQwNjoxOTo1MlrOGe3SoQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNFQwNjoxOTo1MlrOGe3SoQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTAxNjM1Mw==", "bodyText": "Nit: empty lines", "url": "https://github.com/hortonworks/cloudbreak/pull/8189#discussion_r435016353", "createdAt": "2020-06-04T06:19:52Z", "author": {"login": "smaniraju"}, "path": "core/src/main/java/com/sequenceiq/cloudbreak/service/stack/CloudResourceAdvisor.java", "diffHunk": "@@ -149,6 +146,20 @@ public PlatformRecommendation createForBlueprint(Long workspaceId, String bluepr\n         return new PlatformRecommendation(vmTypesByHostGroup, availableVmTypes, diskTypes, instanceCounts, gateway, autoscale, resize);\n     }\n \n+    public AutoscaleRecommendation getAutoscaleRecommendation(Long workspaceId, String blueprintName) {\n+        LOGGER.debug(\"Autoscale advice for blueprintName: {}.\", blueprintName);\n+\n+        BlueprintTextProcessor blueprintTextProcessor = getBlueprintTextProcessor(workspaceId, blueprintName);\n+\n+        return recommendAutoscale(blueprintTextProcessor);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "577e97dfcc012c71f0732a2ed0c409ea421f653b"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI0MzQ2NDYy", "url": "https://github.com/hortonworks/cloudbreak/pull/8189#pullrequestreview-424346462", "createdAt": "2020-06-04T11:25:23Z", "commit": {"oid": "690897b82eb632022004b51081a45212ac9cad2b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "892c735126f3c0b1c2e9862c830a75f3bde49ee2", "author": {"user": null}, "url": "https://github.com/hortonworks/cloudbreak/commit/892c735126f3c0b1c2e9862c830a75f3bde49ee2", "committedDate": "2020-06-09T01:22:04Z", "message": "DISTX-421 Separate endpoint for autoscale recommendation\n\n1. Autoscale needs a recommendation endpoint for the backend verification in periscope."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "762e99b39494e43a4f3e836146ca1801ee1b9522", "author": {"user": null}, "url": "https://github.com/hortonworks/cloudbreak/commit/762e99b39494e43a4f3e836146ca1801ee1b9522", "committedDate": "2020-06-09T01:22:05Z", "message": "DISTX-421 Separate endpoint for autoscale recommendation\n\n1. Autoscale needs a recommendation endpoint for the backend verification in periscope.\n2. Tested in private stack."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cfcda5b873ae789abf81a0564d49e0d54324f6bc", "author": {"user": null}, "url": "https://github.com/hortonworks/cloudbreak/commit/cfcda5b873ae789abf81a0564d49e0d54324f6bc", "committedDate": "2020-06-09T01:22:05Z", "message": "Used clusterCrn instead of workspaceId and blueprintName.\nChanged the auth method.\nTested without these two changes that the api works."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fe1b7097fbbe08549b5386c6de9db864b2f97517", "author": {"user": null}, "url": "https://github.com/hortonworks/cloudbreak/commit/fe1b7097fbbe08549b5386c6de9db864b2f97517", "committedDate": "2020-06-09T01:22:05Z", "message": "Address review comments"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "690897b82eb632022004b51081a45212ac9cad2b", "author": {"user": null}, "url": "https://github.com/hortonworks/cloudbreak/commit/690897b82eb632022004b51081a45212ac9cad2b", "committedDate": "2020-06-04T06:43:22Z", "message": "Address review comments"}, "afterCommit": {"oid": "fe1b7097fbbe08549b5386c6de9db864b2f97517", "author": {"user": null}, "url": "https://github.com/hortonworks/cloudbreak/commit/fe1b7097fbbe08549b5386c6de9db864b2f97517", "committedDate": "2020-06-09T01:22:05Z", "message": "Address review comments"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1776, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}