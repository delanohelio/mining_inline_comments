{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk5NjI2NTQ0", "number": 7749, "title": "CB-6464 Fixing OnTestFailure ReportListener NullPointerException", "bodyText": "@afarsang thank you for your help on this!\n@afarsang or @lnardai please review then merge if it is OK for you!", "createdAt": "2020-04-06T12:56:24Z", "url": "https://github.com/hortonworks/cloudbreak/pull/7749", "merged": true, "mergeCommit": {"oid": "0240b20e33371ff25c54cb2b1c29d5e45c977ce0"}, "closed": true, "closedAt": "2020-04-08T04:39:10Z", "author": {"login": "aszegedi"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcU-rLxgBqjMyMDUzNDk3MDQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcVaDA9gBqjMyMTE2NjUyMjg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "855cd443119feb8d0a1682c63d774b4b70d369e3", "author": {"user": {"login": "aszegedi", "name": "Annamaria Szegedi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/855cd443119feb8d0a1682c63d774b4b70d369e3", "committedDate": "2020-04-06T12:54:07Z", "message": "CB-6464 Fixing OnTestFailure ReportListener NullPointerException"}, "afterCommit": {"oid": "1c004e7aaa27c153eb8b142eebb4c978fc1cb3fe", "author": {"user": {"login": "aszegedi", "name": "Annamaria Szegedi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/1c004e7aaa27c153eb8b142eebb4c978fc1cb3fe", "committedDate": "2020-04-06T13:25:29Z", "message": "CB-6464 Fixing OnTestFailure ReportListener NullPointerException"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1c004e7aaa27c153eb8b142eebb4c978fc1cb3fe", "author": {"user": {"login": "aszegedi", "name": "Annamaria Szegedi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/1c004e7aaa27c153eb8b142eebb4c978fc1cb3fe", "committedDate": "2020-04-06T13:25:29Z", "message": "CB-6464 Fixing OnTestFailure ReportListener NullPointerException"}, "afterCommit": {"oid": "26b5dbb4badec244782cafb94916e8ee8dcacc05", "author": {"user": {"login": "aszegedi", "name": "Annamaria Szegedi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/26b5dbb4badec244782cafb94916e8ee8dcacc05", "committedDate": "2020-04-06T13:52:34Z", "message": "CB-6464 Fixing OnTestFailure ReportListener NullPointerException"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4OTE4NTgz", "url": "https://github.com/hortonworks/cloudbreak/pull/7749#pullrequestreview-388918583", "createdAt": "2020-04-07T08:57:42Z", "commit": {"oid": "26b5dbb4badec244782cafb94916e8ee8dcacc05"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QwODo1Nzo0M1rOGB5yVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QwODo1Nzo0M1rOGB5yVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDY0ODUzNA==", "bodyText": "Wouldn't it be better to put this logic whole in to our custom Logger class, and it would accept a throwable as a parameter?", "url": "https://github.com/hortonworks/cloudbreak/pull/7749#discussion_r404648534", "createdAt": "2020-04-07T08:57:43Z", "author": {"login": "lnardai"}, "path": "integration-test/src/main/java/com/sequenceiq/it/cloudbreak/listener/ReportListener.java", "diffHunk": "@@ -30,8 +32,20 @@ public void onTestFailure(ITestResult tr) {\n         super.onTestFailure(tr);\n         logUrl(tr);\n         logMeasurements(tr);\n-        Throwable throwable = tr.getThrowable();\n-        Log.log(throwable.getMessage());\n+        if (tr.getThrowable() != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "26b5dbb4badec244782cafb94916e8ee8dcacc05"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4OTE5NDI1", "url": "https://github.com/hortonworks/cloudbreak/pull/7749#pullrequestreview-388919425", "createdAt": "2020-04-07T08:58:43Z", "commit": {"oid": "26b5dbb4badec244782cafb94916e8ee8dcacc05"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QwODo1ODo0M1rOGB51Cg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QwODo1ODo0M1rOGB51Cg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDY0OTIyNg==", "bodyText": "toString is not required.", "url": "https://github.com/hortonworks/cloudbreak/pull/7749#discussion_r404649226", "createdAt": "2020-04-07T08:58:43Z", "author": {"login": "lnardai"}, "path": "integration-test/src/main/java/com/sequenceiq/it/cloudbreak/listener/ReportListener.java", "diffHunk": "@@ -30,8 +32,20 @@ public void onTestFailure(ITestResult tr) {\n         super.onTestFailure(tr);\n         logUrl(tr);\n         logMeasurements(tr);\n-        Throwable throwable = tr.getThrowable();\n-        Log.log(throwable.getMessage());\n+        if (tr.getThrowable() != null) {\n+            try {\n+                final Throwable testResultThrowable = tr.getThrowable();\n+                String message = testResultThrowable.getMessage() != null ? testResultThrowable.getMessage() : testResultThrowable.getCause().getMessage();\n+\n+                if (message == null || message.isEmpty()) {\n+                    Log.log(LOGGER, format(\" Test Case: %s have been failed! \", tr.getMethod().toString()));\n+                } else {\n+                    Log.log(message);\n+                }\n+            } catch (Exception e) {\n+                Log.log(LOGGER, format(\" %s got Unexpected Exception: %s \", tr.getMethod().toString(), e.getMessage()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "26b5dbb4badec244782cafb94916e8ee8dcacc05"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4OTE5NjEz", "url": "https://github.com/hortonworks/cloudbreak/pull/7749#pullrequestreview-388919613", "createdAt": "2020-04-07T08:58:58Z", "commit": {"oid": "26b5dbb4badec244782cafb94916e8ee8dcacc05"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QwODo1ODo1OFrOGB51qw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QwODo1ODo1OFrOGB51qw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDY0OTM4Nw==", "bodyText": "toString is not required", "url": "https://github.com/hortonworks/cloudbreak/pull/7749#discussion_r404649387", "createdAt": "2020-04-07T08:58:58Z", "author": {"login": "lnardai"}, "path": "integration-test/src/main/java/com/sequenceiq/it/cloudbreak/listener/ReportListener.java", "diffHunk": "@@ -30,8 +32,20 @@ public void onTestFailure(ITestResult tr) {\n         super.onTestFailure(tr);\n         logUrl(tr);\n         logMeasurements(tr);\n-        Throwable throwable = tr.getThrowable();\n-        Log.log(throwable.getMessage());\n+        if (tr.getThrowable() != null) {\n+            try {\n+                final Throwable testResultThrowable = tr.getThrowable();\n+                String message = testResultThrowable.getMessage() != null ? testResultThrowable.getMessage() : testResultThrowable.getCause().getMessage();\n+\n+                if (message == null || message.isEmpty()) {\n+                    Log.log(LOGGER, format(\" Test Case: %s have been failed! \", tr.getMethod().toString()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "26b5dbb4badec244782cafb94916e8ee8dcacc05"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4OTI0NjU0", "url": "https://github.com/hortonworks/cloudbreak/pull/7749#pullrequestreview-388924654", "createdAt": "2020-04-07T09:05:30Z", "commit": {"oid": "26b5dbb4badec244782cafb94916e8ee8dcacc05"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QwOTowNTozMFrOGB6Fqw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wN1QwOTowNTozMFrOGB6Fqw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDY1MzQ4Mw==", "bodyText": "If it's not a hassle, can you also log the current status the resource is in? Please make sure this is done for all other newly added log messages.", "url": "https://github.com/hortonworks/cloudbreak/pull/7749#discussion_r404653483", "createdAt": "2020-04-07T09:05:30Z", "author": {"login": "lnardai"}, "path": "integration-test/src/main/java/com/sequenceiq/it/cloudbreak/util/wait/WaitUtil.java", "diffHunk": "@@ -300,9 +300,11 @@ private boolean checkFailedStatuses(EnvironmentStatus currentStatus) {\n             if (databaseServerResponse != null && databaseServerResponse.getStatus() != null) {\n                 builder.append(\"statusReason: \").append(databaseServerResponse.getStatusReason());\n             }\n-            throw new RuntimeException(builder.toString());\n+            LOGGER.error(builder.toString());\n+            throw new TestFailException(builder.toString());\n         } else if (waitResult == WaitResult.TIMEOUT) {\n-            throw new RuntimeException(\"Timeout happened\");\n+            LOGGER.error(\"Timeout happened while waiting for {} status at {}\", desiredStatus.name(), crn);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "26b5dbb4badec244782cafb94916e8ee8dcacc05"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4OTI1MjQ5", "url": "https://github.com/hortonworks/cloudbreak/pull/7749#pullrequestreview-388925249", "createdAt": "2020-04-07T09:06:15Z", "commit": {"oid": "26b5dbb4badec244782cafb94916e8ee8dcacc05"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "26b5dbb4badec244782cafb94916e8ee8dcacc05", "author": {"user": {"login": "aszegedi", "name": "Annamaria Szegedi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/26b5dbb4badec244782cafb94916e8ee8dcacc05", "committedDate": "2020-04-06T13:52:34Z", "message": "CB-6464 Fixing OnTestFailure ReportListener NullPointerException"}, "afterCommit": {"oid": "b96071f0e15f092e6f80d25d65da2c3282861681", "author": {"user": {"login": "aszegedi", "name": "Annamaria Szegedi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/b96071f0e15f092e6f80d25d65da2c3282861681", "committedDate": "2020-04-07T14:51:03Z", "message": "CB-6464 Fixing OnTestFailure ReportListener NullPointerException"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "33ece8b9fd76b5581f8f9518cf2468481d6abfd5", "author": {"user": {"login": "aszegedi", "name": "Annamaria Szegedi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/33ece8b9fd76b5581f8f9518cf2468481d6abfd5", "committedDate": "2020-04-07T14:52:28Z", "message": "CB-6464 Fixing OnTestFailure ReportListener NullPointerException"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b96071f0e15f092e6f80d25d65da2c3282861681", "author": {"user": {"login": "aszegedi", "name": "Annamaria Szegedi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/b96071f0e15f092e6f80d25d65da2c3282861681", "committedDate": "2020-04-07T14:51:03Z", "message": "CB-6464 Fixing OnTestFailure ReportListener NullPointerException"}, "afterCommit": {"oid": "33ece8b9fd76b5581f8f9518cf2468481d6abfd5", "author": {"user": {"login": "aszegedi", "name": "Annamaria Szegedi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/33ece8b9fd76b5581f8f9518cf2468481d6abfd5", "committedDate": "2020-04-07T14:52:28Z", "message": "CB-6464 Fixing OnTestFailure ReportListener NullPointerException"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e4761807324c2d441111e5074f8aa355c105f62d", "author": {"user": {"login": "aszegedi", "name": "Annamaria Szegedi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/e4761807324c2d441111e5074f8aa355c105f62d", "committedDate": "2020-04-07T19:53:51Z", "message": "CB-6464 Fixing OnTestFailure ReportListener NullPointerException"}, "afterCommit": {"oid": "db965cd9b3d2e5b353ca38b88c9ae6670c871cf3", "author": {"user": {"login": "aszegedi", "name": "Annamaria Szegedi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/db965cd9b3d2e5b353ca38b88c9ae6670c871cf3", "committedDate": "2020-04-07T20:20:58Z", "message": "CB-6464 Fixing OnTestFailure ReportListener NullPointerException"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "db965cd9b3d2e5b353ca38b88c9ae6670c871cf3", "author": {"user": {"login": "aszegedi", "name": "Annamaria Szegedi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/db965cd9b3d2e5b353ca38b88c9ae6670c871cf3", "committedDate": "2020-04-07T20:20:58Z", "message": "CB-6464 Fixing OnTestFailure ReportListener NullPointerException"}, "afterCommit": {"oid": "9dabf671a8de682e0212225a59f2426b2386250c", "author": {"user": {"login": "aszegedi", "name": "Annamaria Szegedi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/9dabf671a8de682e0212225a59f2426b2386250c", "committedDate": "2020-04-07T20:25:01Z", "message": "CB-6464 Fixing OnTestFailure ReportListener NullPointerException"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "93dd3d685f865e71e1211cce5b913d76882a5e17", "author": {"user": {"login": "aszegedi", "name": "Annamaria Szegedi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/93dd3d685f865e71e1211cce5b913d76882a5e17", "committedDate": "2020-04-07T21:18:56Z", "message": "CB-6464 Fixing OnTestFailure ReportListener NullPointerException"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9dabf671a8de682e0212225a59f2426b2386250c", "author": {"user": {"login": "aszegedi", "name": "Annamaria Szegedi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/9dabf671a8de682e0212225a59f2426b2386250c", "committedDate": "2020-04-07T20:25:01Z", "message": "CB-6464 Fixing OnTestFailure ReportListener NullPointerException"}, "afterCommit": {"oid": "93dd3d685f865e71e1211cce5b913d76882a5e17", "author": {"user": {"login": "aszegedi", "name": "Annamaria Szegedi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/93dd3d685f865e71e1211cce5b913d76882a5e17", "committedDate": "2020-04-07T21:18:56Z", "message": "CB-6464 Fixing OnTestFailure ReportListener NullPointerException"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2287, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}