{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA4OTAxNDgz", "number": 7897, "title": "CB-6605 only sync env related WAGs", "bodyText": "Test against mow-dev\nbefore\nusers: 1305\ntotal groups: 2000 <- we're already missing user groups\nwl groups: 1946\n\nafter\nusers: 1305\ntotal groups: 437\nwl groups: 48 (1 env 8 groups)\n\nThe original WAG list and the user member of group list is fetched at a different time\nso they can be different as they can launch environments in between\n(probably we need to filter there as well), but the listWorkloadAdministrationGroupsForMember\nonly returns the name of the group so there is nothing to filter on.\nLocally it's much slower to connect to UMS than from mow-dev so this will not be that different there\nCrn handling needed: Error during UMS operation: 'cdpp is not a valid partition value'\nThere are also weird WAGs\nNot adding to filter: _c_wag_testers_34ef5c69 crn: null\nNot adding to filter: _c_wag_testers_1bd31292 crn: crn:altus:iam:us-west-1:9d74eee4-1cad-45d7-b645-7ccf9edbb73d:user:59cbfafb-999b-4df9-81e2-aa00a88382e9\nNot adding to filter: _c_ml_users_34ef5c69 crn: null\nNot adding to filter: _c_ml_users_5c217dc6 crn: null\nNot adding to filter: _c_ml_admins_34ef5c69 crn: null\nNot adding to filter: _c_ml_admins_2c888e37 crn: null\nNot adding to filter: _c_ml_admins_5c217dc6 crn: null\nNot adding to filter: _c_ml_admins_43a040f6 crn: null\n\nSimilar approach #7898. However, this does not sync any other WAGs besides env related ones, if there are any.", "createdAt": "2020-04-25T12:33:28Z", "url": "https://github.com/hortonworks/cloudbreak/pull/7897", "merged": true, "mergeCommit": {"oid": "1fbec548faab7cee8f89a15e235ae64f2907f645"}, "closed": true, "closedAt": "2020-04-27T16:41:53Z", "author": {"login": "keyki"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcbFSe2gH2gAyNDA4OTAxNDgzOjk2NzYwNDU0ZTBjOWYyNGYyMGM3MjgyMDgzMmY5ZDBlMDE2NTI3Zjc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcby3fVAFqTQwMTE3NzUxMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "96760454e0c9f24f20c72820832f9d0e016527f7", "author": {"user": {"login": "keyki", "name": "Krisztian Horvath"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/96760454e0c9f24f20c72820832f9d0e016527f7", "committedDate": "2020-04-25T12:31:45Z", "message": "CB-6605 only sync env related WAGs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwNjQ3NDgz", "url": "https://github.com/hortonworks/cloudbreak/pull/7897#pullrequestreview-400647483", "createdAt": "2020-04-27T06:04:00Z", "commit": {"oid": "96760454e0c9f24f20c72820832f9d0e016527f7"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwOTc3MDU2", "url": "https://github.com/hortonworks/cloudbreak/pull/7897#pullrequestreview-400977056", "createdAt": "2020-04-27T13:56:50Z", "commit": {"oid": "96760454e0c9f24f20c72820832f9d0e016527f7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAxMTI5NTUx", "url": "https://github.com/hortonworks/cloudbreak/pull/7897#pullrequestreview-401129551", "createdAt": "2020-04-27T16:37:25Z", "commit": {"oid": "96760454e0c9f24f20c72820832f9d0e016527f7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAxMTc3NTEz", "url": "https://github.com/hortonworks/cloudbreak/pull/7897#pullrequestreview-401177513", "createdAt": "2020-04-27T17:37:31Z", "commit": {"oid": "96760454e0c9f24f20c72820832f9d0e016527f7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QxNzozNzozMVrOGMvecQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QxNzozNzozMVrOGMvecQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjAxMzkzNw==", "bodyText": "So we have these utility functions in Crns.java and Crn.java to do things like Crns.safeFromString (that can't return null) and Crns.forTypr(String, Service, ResourceType) that ensures that a crn belongs to a service and is of a specific resource type. It may be useful to bring that in here.", "url": "https://github.com/hortonworks/cloudbreak/pull/7897#discussion_r416013937", "createdAt": "2020-04-27T17:37:31Z", "author": {"login": "giladwolff"}, "path": "freeipa/src/main/java/com/sequenceiq/freeipa/service/freeipa/user/UmsUsersStateProvider.java", "diffHunk": "@@ -230,4 +247,14 @@ private EnvironmentAccessChecker createEnvironmentAccessChecker(String environme\n         requireNonNull(environmentCrn, \"environmentCrn is null\");\n         return new EnvironmentAccessChecker(grpcUmsClient, environmentCrn);\n     }\n+\n+    private Crn getCrn(WorkloadAdministrationGroup wag) {\n+        Crn resourceCrn = null;\n+        try {\n+            resourceCrn = Crn.fromString(wag.getResource());\n+        } catch (Exception e) {\n+            LOGGER.debug(\"Invalid resource is assigned to workload admin group: {}\", e.getMessage());\n+        }\n+        return resourceCrn;\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "96760454e0c9f24f20c72820832f9d0e016527f7"}, "originalPosition": 102}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2249, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}