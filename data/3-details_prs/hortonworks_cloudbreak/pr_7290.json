{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc1NDEyNjg1", "number": 7290, "title": "CB-5548 Sdx status checker won't move cluster from REPAIR_FAILED state", "bodyText": "", "createdAt": "2020-02-14T14:22:20Z", "url": "https://github.com/hortonworks/cloudbreak/pull/7290", "merged": true, "mergeCommit": {"oid": "10c7a0ceee2ffc98064f099bc6e5c70eabde4431"}, "closed": true, "closedAt": "2020-02-17T13:56:35Z", "author": {"login": "bbihari"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcFKTOOgFqTM1OTYwOTc3Ng==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcFK7w9AFqTM1OTYzOTA5OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5NjA5Nzc2", "url": "https://github.com/hortonworks/cloudbreak/pull/7290#pullrequestreview-359609776", "createdAt": "2020-02-17T09:55:44Z", "commit": {"oid": "6c4aaab9a3ff81e08df55c24d8a62b409cc6b390"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QwOTo1NTo0NFrOFqeZWg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xN1QwOTo1NTo0NFrOFqeZWg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDA4MjUyMg==", "bodyText": "SDX_REPAIR_FINISHED message can be a little bit misleading as if it's not coming from repair failed", "url": "https://github.com/hortonworks/cloudbreak/pull/7290#discussion_r380082522", "createdAt": "2020-02-17T09:55:44Z", "author": {"login": "lacikaaa"}, "path": "datalake/src/main/java/com/sequenceiq/datalake/job/SdxClusterStatusCheckerJob.java", "diffHunk": "@@ -66,35 +77,44 @@ private void handleAmbiguousSdx(StackStatusV4Response stack, SdxCluster sdx) {\n \n     private void handleStoppedSdx(StackStatusV4Response stack, SdxCluster sdx) {\n         if (stack.getStatus().isAvailable() && stack.getClusterStatus().isAvailable()) {\n-            sdxStatusService.setStatusForDatalakeAndNotify(DatalakeStatusEnum.RUNNING, ResourceEvent.SDX_STOP_FINISHED, \"\", sdx);\n+            sdxStatusService.setStatusForDatalakeAndNotify(DatalakeStatusEnum.RUNNING, ResourceEvent.SDX_START_FINISHED, \"\", sdx);\n             logStateChange(DatalakeStatusEnum.STOPPED, DatalakeStatusEnum.RUNNING);\n         }\n-        if (stack.getStatus().equals(Status.DELETE_COMPLETED)) {\n-            sdxStatusService.setStatusForDatalakeAndNotify(DatalakeStatusEnum.STACK_DELETED, ResourceEvent.SDX_CLUSTER_DELETION_FINISHED, \"\", sdx);\n-            jobService.unschedule(String.valueOf(sdx.getId()));\n-            logStateChange(DatalakeStatusEnum.RUNNING, DatalakeStatusEnum.STACK_DELETED);\n+        setDeleteCompleted(stack, sdx);\n+        setDeleteFailed(stack, sdx);\n+    }\n+\n+    private void handleFailedSdx(StackStatusV4Response stack, SdxCluster sdx) {\n+        if (stack.getStatus().isAvailable() && stack.getClusterStatus().isAvailable()) {\n+            sdxStatusService.setStatusForDatalakeAndNotify(DatalakeStatusEnum.RUNNING, ResourceEvent.SDX_REPAIR_FINISHED, \"\", sdx);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6c4aaab9a3ff81e08df55c24d8a62b409cc6b390"}, "originalPosition": 58}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1141ec225cde1691076a4888c227450413f2390e", "author": {"user": {"login": "bbihari", "name": "Bal\u00e1zs Bihari"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/1141ec225cde1691076a4888c227450413f2390e", "committedDate": "2020-02-17T10:37:20Z", "message": "CB-5548 Sdx status checker won't move cluster from REPAIR_FAILED state"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6c4aaab9a3ff81e08df55c24d8a62b409cc6b390", "author": {"user": {"login": "bbihari", "name": "Bal\u00e1zs Bihari"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/6c4aaab9a3ff81e08df55c24d8a62b409cc6b390", "committedDate": "2020-02-14T14:20:02Z", "message": "CB-5548 Sdx status checker won't move cluster from REPAIR_FAILED state"}, "afterCommit": {"oid": "1141ec225cde1691076a4888c227450413f2390e", "author": {"user": {"login": "bbihari", "name": "Bal\u00e1zs Bihari"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/1141ec225cde1691076a4888c227450413f2390e", "committedDate": "2020-02-17T10:37:20Z", "message": "CB-5548 Sdx status checker won't move cluster from REPAIR_FAILED state"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5NjM5MDk5", "url": "https://github.com/hortonworks/cloudbreak/pull/7290#pullrequestreview-359639099", "createdAt": "2020-02-17T10:40:03Z", "commit": {"oid": "1141ec225cde1691076a4888c227450413f2390e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1872, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}