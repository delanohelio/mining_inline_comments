{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYwNTAxNjU0", "number": 7030, "title": "CB-4578 - Allow base image usage only based on entitlement system", "bodyText": "", "createdAt": "2020-01-08T15:01:50Z", "url": "https://github.com/hortonworks/cloudbreak/pull/7030", "merged": true, "mergeCommit": {"oid": "fecc219ebf6c8634ab39a1f89551ff15bc0fb8bb"}, "closed": true, "closedAt": "2020-01-12T15:38:22Z", "author": {"login": "pdarvasi"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb4XQOzABqjI5MzE3MDM4MjY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb5Ah3QABqjI5Mzg5NTI5NTY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwNzM5NzI0", "url": "https://github.com/hortonworks/cloudbreak/pull/7030#pullrequestreview-340739724", "createdAt": "2020-01-09T18:49:59Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxODo0OTo1OVrOFb_-HQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxODo0OTo1OVrOFb_-HQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDkwMzk2NQ==", "bodyText": "This log message might not be correct.", "url": "https://github.com/hortonworks/cloudbreak/pull/7030#discussion_r364903965", "createdAt": "2020-01-09T18:49:59Z", "author": {"login": "keyki"}, "path": "core/src/main/java/com/sequenceiq/cloudbreak/controller/StackCreatorService.java", "diffHunk": "@@ -386,14 +392,20 @@ private Blueprint determineBlueprint(StackV4Request stackRequest, Workspace work\n         if (clusterRequest == null) {\n             return null;\n         }\n+        boolean shouldUseBaseCMImage = shouldUseBaseCMImage(clusterRequest);\n+        boolean baseImageEnabled = imageCatalogService.baseImageEnabled();\n         return executorService.submit(() -> {\n-            try {\n-                boolean base = shouldUseBaseCMImage(clusterRequest);\n-                LOGGER.info(\"The stack with name {} will use base image: {}\", stackName, base);\n-                return imageService.determineImageFromCatalog(workspace.getId(), stackRequest.getImage(), platformString, blueprint, base, user, image -> true);\n-            } catch (CloudbreakImageNotFoundException | CloudbreakImageCatalogException e) {\n-                throw new BadRequestException(e.getMessage(), e);\n-            }\n+\n+            LOGGER.info(\"The stack with name {} will use base image: {}\", stackName, shouldUseBaseCMImage);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 100}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwNzQwNDk5", "url": "https://github.com/hortonworks/cloudbreak/pull/7030#pullrequestreview-340740499", "createdAt": "2020-01-09T18:51:15Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxODo1MToxNVrOFcAAVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxODo1MToxNVrOFcAAVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDkwNDUzMg==", "bodyText": "exiting typo", "url": "https://github.com/hortonworks/cloudbreak/pull/7030#discussion_r364904532", "createdAt": "2020-01-09T18:51:15Z", "author": {"login": "keyki"}, "path": "core/src/main/java/com/sequenceiq/cloudbreak/service/image/ImageCatalogService.java", "diffHunk": "@@ -146,14 +149,14 @@ public ImageCatalog findByResourceCrn(String resourceCrn) {\n \n     public Images getImagesByCatalogName(Long workspaceId, String catalogName, String stackName, String platform) throws CloudbreakImageCatalogException {\n         if (isNotEmpty(platform) && isNotEmpty(stackName)) {\n-            throw new BadRequestException(\"Platform or stackName cannot be filled in the same request.\");\n+            throw new BadRequestException(\"Both platform and exiting stack name could not be present in the request.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 38}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwNzQyMjc4", "url": "https://github.com/hortonworks/cloudbreak/pull/7030#pullrequestreview-340742278", "createdAt": "2020-01-09T18:54:17Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxODo1NDoxOFrOFcAFmQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxODo1NDoxOFrOFcAFmQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDkwNTg4MQ==", "bodyText": "fix or delete", "url": "https://github.com/hortonworks/cloudbreak/pull/7030#discussion_r364905881", "createdAt": "2020-01-09T18:54:18Z", "author": {"login": "keyki"}, "path": "core/src/test/java/com/sequenceiq/cloudbreak/service/image/ImageCatalogServiceTest.java", "diffHunk": "@@ -631,7 +639,7 @@ public void testGetByWorkspaceIfDtoIsNullThenIllegalArgumentExceptionComes() {\n     public void testPopulateCrnCorrectly() {\n         ImageCatalog imageCatalog = getImageCatalog();\n \n-        when(userService.getOrCreate(any(CloudbreakUser.class))).thenReturn(user);\n+        //when(userService.getOrCreate(any(CloudbreakUser.class))).thenReturn(user);", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 47}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "a4cc85067459ac0eef7147c6104d02f1129a953d", "author": {"user": {"login": "pdarvasi", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/a4cc85067459ac0eef7147c6104d02f1129a953d", "committedDate": "2020-01-09T20:56:19Z", "message": "CB-4578 - Allow base image usage only based on entitlement system"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a4cc85067459ac0eef7147c6104d02f1129a953d", "author": {"user": {"login": "pdarvasi", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/a4cc85067459ac0eef7147c6104d02f1129a953d", "committedDate": "2020-01-09T20:56:19Z", "message": "CB-4578 - Allow base image usage only based on entitlement system"}, "afterCommit": {"oid": "52a557ac4369ddd48cd606d1aa49ef7196970902", "author": {"user": {"login": "pdarvasi", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/52a557ac4369ddd48cd606d1aa49ef7196970902", "committedDate": "2020-01-10T14:55:14Z", "message": "CB-4578 - Allow base image usage only based on entitlement system"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bf2b3c03f48362252f9a11886f5eb32bb09b1aac", "author": {"user": {"login": "pdarvasi", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/bf2b3c03f48362252f9a11886f5eb32bb09b1aac", "committedDate": "2020-01-10T15:45:21Z", "message": "CB-4578 - Allow base image usage only based on entitlement system"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "52a557ac4369ddd48cd606d1aa49ef7196970902", "author": {"user": {"login": "pdarvasi", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/52a557ac4369ddd48cd606d1aa49ef7196970902", "committedDate": "2020-01-10T14:55:14Z", "message": "CB-4578 - Allow base image usage only based on entitlement system"}, "afterCommit": {"oid": "bf2b3c03f48362252f9a11886f5eb32bb09b1aac", "author": {"user": {"login": "pdarvasi", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/bf2b3c03f48362252f9a11886f5eb32bb09b1aac", "committedDate": "2020-01-10T15:45:21Z", "message": "CB-4578 - Allow base image usage only based on entitlement system"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2016, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}