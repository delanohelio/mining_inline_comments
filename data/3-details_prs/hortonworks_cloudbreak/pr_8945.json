{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgxOTQ2MTUz", "number": 8945, "title": "CB-8605 - New SINGLE option to use Dedicated Storage Account", "bodyText": "This change introduces a SINGLE_WITH_DEDICATED_STORAGE_ACCOUNT option for Azure resourceGroup request which calculates the storage account and resource group names for the VHD as it used to be in the legacy \"MULTIPLE\" RG use-case.\nThe intent is to use this internally (mow-dev) to save the time and cost of many image copies.\nThe feature is behind entitlement CDP_AZURE_SINGLE_RESOURCE_GROUP_DEDICATED_STORAGE_ACCOUNT and also CDP_AZURE_SINGLE_RESOURCE_GROUP entitlement has to be turned on, too.", "createdAt": "2020-09-08T10:29:59Z", "url": "https://github.com/hortonworks/cloudbreak/pull/8945", "merged": true, "mergeCommit": {"oid": "b2b99fdb2e3dcd621f7f8cacc3c0a2805cdf5305"}, "closed": true, "closedAt": "2020-09-09T13:41:54Z", "author": {"login": "pdarvasi"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdG2itbABqjM3NDA2MjI2NDg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdHJFLBAFqTQ4NDg0NDAwMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9da53e626bf0f966ce4f4e328e4b381854083fe6", "author": {"user": {"login": "pdarvasi", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/9da53e626bf0f966ce4f4e328e4b381854083fe6", "committedDate": "2020-09-08T10:23:42Z", "message": "CB-8605 - New SINGLE option to use Dedicated Storage Account"}, "afterCommit": {"oid": "2bcb7d24c284b5369d2584a697baf32f008a310f", "author": {"user": {"login": "pdarvasi", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/2bcb7d24c284b5369d2584a697baf32f008a310f", "committedDate": "2020-09-08T12:13:12Z", "message": "CB-8605 - New SINGLE option to use Dedicated Storage Account"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2bcb7d24c284b5369d2584a697baf32f008a310f", "author": {"user": {"login": "pdarvasi", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/2bcb7d24c284b5369d2584a697baf32f008a310f", "committedDate": "2020-09-08T12:13:12Z", "message": "CB-8605 - New SINGLE option to use Dedicated Storage Account"}, "afterCommit": {"oid": "24e46dd8d0878f413e087ff36cd1811cbe37a527", "author": {"user": {"login": "pdarvasi", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/24e46dd8d0878f413e087ff36cd1811cbe37a527", "committedDate": "2020-09-08T15:06:46Z", "message": "CB-8605 - New SINGLE option to use Dedicated Storage Account"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bb36e7167c5bd4c0667313200fc1f399fc2046e4", "author": {"user": {"login": "pdarvasi", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/bb36e7167c5bd4c0667313200fc1f399fc2046e4", "committedDate": "2020-09-08T19:46:02Z", "message": "CB-8605 - New SINGLE option to use Dedicated Storage Account"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "24e46dd8d0878f413e087ff36cd1811cbe37a527", "author": {"user": {"login": "pdarvasi", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/24e46dd8d0878f413e087ff36cd1811cbe37a527", "committedDate": "2020-09-08T15:06:46Z", "message": "CB-8605 - New SINGLE option to use Dedicated Storage Account"}, "afterCommit": {"oid": "bb36e7167c5bd4c0667313200fc1f399fc2046e4", "author": {"user": {"login": "pdarvasi", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/bb36e7167c5bd4c0667313200fc1f399fc2046e4", "committedDate": "2020-09-08T19:46:02Z", "message": "CB-8605 - New SINGLE option to use Dedicated Storage Account"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg0ODA3MDQz", "url": "https://github.com/hortonworks/cloudbreak/pull/8945#pullrequestreview-484807043", "createdAt": "2020-09-09T09:04:05Z", "commit": {"oid": "bb36e7167c5bd4c0667313200fc1f399fc2046e4"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQwOTowNDowNVrOHO94Xg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOVQwOTo0Nzo1MlrOHO_l4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTQ1NTk2Ng==", "bodyText": "I would add a method as isSingleResourceGroup(), as in some cases the flavor of the single RG is not important.", "url": "https://github.com/hortonworks/cloudbreak/pull/8945#discussion_r485455966", "createdAt": "2020-09-09T09:04:05Z", "author": {"login": "gergopapi2"}, "path": "cloud-azure/src/main/java/com/sequenceiq/cloudbreak/cloud/azure/ResourceGroupUsage.java", "diffHunk": "@@ -2,5 +2,6 @@\n \n public enum ResourceGroupUsage {\n     SINGLE,\n-    MULTIPLE\n+    MULTIPLE,\n+    SINGLE_WITH_DEDICATED_STORAGE_ACCOUNT", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bb36e7167c5bd4c0667313200fc1f399fc2046e4"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTQ2OTI4Ng==", "bodyText": "I am not sure this is related to the rest of the changes. If not, it might make sense to extract it to a separate PR.", "url": "https://github.com/hortonworks/cloudbreak/pull/8945#discussion_r485469286", "createdAt": "2020-09-09T09:23:51Z", "author": {"login": "gergopapi2"}, "path": "core/src/main/java/com/sequenceiq/distrox/v1/distrox/StackOperations.java", "diffHunk": "@@ -234,7 +235,9 @@ public UpgradeV4Response checkForClusterUpgrade(@NotNull NameOrCrn nameOrCrn, Lo\n             boolean osUpgrade = upgradeService.isOsUpgrade(request);\n             UpgradeV4Response upgradeResponse = clusterUpgradeAvailabilityService.checkForUpgradesByName(workspaceId, stackName,\n                     osUpgrade);\n-            clusterUpgradeAvailabilityService.filterUpgradeOptions(upgradeResponse, request);\n+            if (CollectionUtils.isNotEmpty(upgradeResponse.getUpgradeCandidates())) {\n+                clusterUpgradeAvailabilityService.filterUpgradeOptions(upgradeResponse, request);\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bb36e7167c5bd4c0667313200fc1f399fc2046e4"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTQ4NDAwMw==", "bodyText": "It might make sense to merge it with the above line", "url": "https://github.com/hortonworks/cloudbreak/pull/8945#discussion_r485484003", "createdAt": "2020-09-09T09:47:52Z", "author": {"login": "gergopapi2"}, "path": "mock-thunderhead/src/main/resources/application.yml", "diffHunk": "@@ -22,6 +22,7 @@ auth:\n     raz.enable: true\n     freeipadlebsencryption.enable: true\n     azure.single.resourcegroup.enable: false\n+    azure.single.resourcegroup.dedicated.storage.account.enable: false", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bb36e7167c5bd4c0667313200fc1f399fc2046e4"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg0ODQ0MDAy", "url": "https://github.com/hortonworks/cloudbreak/pull/8945#pullrequestreview-484844002", "createdAt": "2020-09-09T09:49:30Z", "commit": {"oid": "bb36e7167c5bd4c0667313200fc1f399fc2046e4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2280, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}