{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg1NjYyOTc0", "number": 7513, "title": "CB-5790 Cleanup freeipa during cluster creaton", "bodyText": "", "createdAt": "2020-03-09T15:41:04Z", "url": "https://github.com/hortonworks/cloudbreak/pull/7513", "merged": true, "mergeCommit": {"oid": "40ee7a19e6972c4763eb87ab061c60c73c920167"}, "closed": true, "closedAt": "2020-03-10T09:56:31Z", "author": {"login": "lacikaaa"}, "timelineItems": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcL_yy4gH2gAyMzg1NjYyOTc0Ojk3ZjlhZTVlZDRjZDRjN2RmYzU5MTdmMDU3YzlhNzZiZWUyYWEwZjc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcMAXJDgFqTM3MTMxOTc2Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "97f9ae5ed4cd4c7dfc5917f057c9a76bee2aa0f7", "author": {"user": {"login": "lacikaaa", "name": "Mihaly Laszlo Molnar"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/97f9ae5ed4cd4c7dfc5917f057c9a76bee2aa0f7", "committedDate": "2020-03-09T15:38:45Z", "message": "CB-5790 Cleanup freeipa during cluster creaton"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxMzE5NzY2", "url": "https://github.com/hortonworks/cloudbreak/pull/7513#pullrequestreview-371319766", "createdAt": "2020-03-09T16:09:13Z", "commit": {"oid": "97f9ae5ed4cd4c7dfc5917f057c9a76bee2aa0f7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQxNjowOToxM1rOFzvK1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQxNjowOToxM1rOFzvK1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTc5NDUxNg==", "bodyText": "Why is this StackEvent instead of CleanupFreeIpaEvent? Is it because we don't actually care about anything in the event?", "url": "https://github.com/hortonworks/cloudbreak/pull/7513#discussion_r389794516", "createdAt": "2020-03-09T16:09:13Z", "author": {"login": "handavid"}, "path": "core/src/main/java/com/sequenceiq/cloudbreak/core/flow2/cluster/provision/ClusterCreationActions.java", "diffHunk": "@@ -107,11 +112,33 @@ protected Selectable createRequest(StackContext context) {\n         };\n     }\n \n+    @Bean(name = \"CLEANUP_FREEIPA_STATE\")\n+    public Action<?, ?> cleanupFreeIpaAction() {\n+        return new AbstractStackCreationAction<>(HostMetadataSetupSuccess.class) {\n+\n+            @Inject\n+            private InstanceMetaDataService instanceMetaDataService;\n+\n+            @Override\n+            protected void doExecute(StackContext context, HostMetadataSetupSuccess payload, Map<Object, Object> variables) throws Exception {\n+                sendEvent(context);\n+            }\n+\n+            @Override\n+            protected Selectable createRequest(StackContext context) {\n+                Set<InstanceMetaData> instanceMetaData = instanceMetaDataService.findNotTerminatedForStack(context.getStack().getId());\n+                Set<String> hostNames = instanceMetaData.stream().map(InstanceMetaData::getDiscoveryFQDN).collect(Collectors.toSet());\n+                Set<String> ips = instanceMetaData.stream().map(InstanceMetaData::getPrivateIp).collect(Collectors.toSet());\n+                return new CleanupFreeIpaEvent(context.getStack().getId(), hostNames, ips);\n+            }\n+        };\n+    }\n+\n     @Bean(name = \"BOOTSTRAPPING_PUBLIC_ENDPOINT_STATE\")\n     public Action<?, ?> bootStrappingPublicEndpointAction() {\n-        return new AbstractStackCreationAction<>(HostMetadataSetupSuccess.class) {\n+        return new AbstractStackCreationAction<>(StackEvent.class) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "97f9ae5ed4cd4c7dfc5917f057c9a76bee2aa0f7"}, "originalPosition": 56}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2546, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}