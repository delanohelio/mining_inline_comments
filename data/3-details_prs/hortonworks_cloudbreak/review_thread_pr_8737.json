{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY0MDA5MTAw", "number": 8737, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxMzoyNjoxOVrOEV09LQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QwODowNjoyMlrOEWHvDg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxMzIzMTgxOnYy", "diffSide": "RIGHT", "path": "autoscale/src/main/java/com/sequenceiq/periscope/controller/DistroXAutoScaleClusterV1Controller.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxMzoyNjoxOVrOG8zbDQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QxMDowMDowMVrOG9UByw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjQxMDI1Mw==", "bodyText": "getClusters for tenant with Autoscaling Configured  is still an AccountLevel Permission Check.", "url": "https://github.com/hortonworks/cloudbreak/pull/8737#discussion_r466410253", "createdAt": "2020-08-06T13:26:19Z", "author": {"login": "smaniraju"}, "path": "autoscale/src/main/java/com/sequenceiq/periscope/controller/DistroXAutoScaleClusterV1Controller.java", "diffHunk": "@@ -58,91 +66,102 @@\n     @Inject\n     private CloudbreakMessagesService messagesService;\n \n+    @Inject\n+    private TimeAlertRequestConverter timeAlertRequestConverter;\n+\n+    @Inject\n+    private LoadAlertRequestConverter loadAlertRequestConverter;\n+\n+    @Inject\n+    private EntitlementValidationService entitlementValidationService;\n+\n     @Override\n-    @CheckPermissionByAccount(action = AuthorizationResourceAction.DATAHUB_READ)\n+    @CheckPermissionByAccount(action = AuthorizationResourceAction.SCALE_DATAHUB)\n     public List<DistroXAutoscaleClusterResponse> getClusters() {\n         return distroXAutoscaleClusterResponseConverter.convertAllToJson(asClusterCommonService.getDistroXClusters());\n     }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "55f975481b3c241f8ec438afc60df37d5524c7d3"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjcxODg0Nw==", "bodyText": "This is interesting. Wondering, if in the future, we can have list* calls give back a list of resources to which the user has READ/WRITE access.\ni.e. instead of listing all entities (clusters in this case) belonging to an environment - list clusters on which this particular user can either READ the autoscaling rules or CREATE autoscaling rules.\ncc @lnardai\nDistroXV1Controller in CB-core seems disable permission checking for list(envName, envCrn) - so presumably that allows a user with access to the tenant to see all other running clusters.", "url": "https://github.com/hortonworks/cloudbreak/pull/8737#discussion_r466718847", "createdAt": "2020-08-06T22:26:53Z", "author": {"login": "sidseth"}, "path": "autoscale/src/main/java/com/sequenceiq/periscope/controller/DistroXAutoScaleClusterV1Controller.java", "diffHunk": "@@ -58,91 +66,102 @@\n     @Inject\n     private CloudbreakMessagesService messagesService;\n \n+    @Inject\n+    private TimeAlertRequestConverter timeAlertRequestConverter;\n+\n+    @Inject\n+    private LoadAlertRequestConverter loadAlertRequestConverter;\n+\n+    @Inject\n+    private EntitlementValidationService entitlementValidationService;\n+\n     @Override\n-    @CheckPermissionByAccount(action = AuthorizationResourceAction.DATAHUB_READ)\n+    @CheckPermissionByAccount(action = AuthorizationResourceAction.SCALE_DATAHUB)\n     public List<DistroXAutoscaleClusterResponse> getClusters() {\n         return distroXAutoscaleClusterResponseConverter.convertAllToJson(asClusterCommonService.getDistroXClusters());\n     }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjQxMDI1Mw=="}, "originalCommit": {"oid": "55f975481b3c241f8ec438afc60df37d5524c7d3"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njg5MTU0OA==", "bodyText": "i think scaledatahub right will be present only in resource roles, so it wont work with account level, so this will work only with poweruser, so it is better to change this @DisabledCheckPermissions since we decided to disable authz on list for now, right @lnardai ?", "url": "https://github.com/hortonworks/cloudbreak/pull/8737#discussion_r466891548", "createdAt": "2020-08-07T08:13:44Z", "author": {"login": "horadla23"}, "path": "autoscale/src/main/java/com/sequenceiq/periscope/controller/DistroXAutoScaleClusterV1Controller.java", "diffHunk": "@@ -58,91 +66,102 @@\n     @Inject\n     private CloudbreakMessagesService messagesService;\n \n+    @Inject\n+    private TimeAlertRequestConverter timeAlertRequestConverter;\n+\n+    @Inject\n+    private LoadAlertRequestConverter loadAlertRequestConverter;\n+\n+    @Inject\n+    private EntitlementValidationService entitlementValidationService;\n+\n     @Override\n-    @CheckPermissionByAccount(action = AuthorizationResourceAction.DATAHUB_READ)\n+    @CheckPermissionByAccount(action = AuthorizationResourceAction.SCALE_DATAHUB)\n     public List<DistroXAutoscaleClusterResponse> getClusters() {\n         return distroXAutoscaleClusterResponseConverter.convertAllToJson(asClusterCommonService.getDistroXClusters());\n     }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjQxMDI1Mw=="}, "originalCommit": {"oid": "55f975481b3c241f8ec438afc60df37d5524c7d3"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njk0NDQ1OQ==", "bodyText": "ok added @DisabledCheckPermissions for listApi in sync with other listApi like distrox.", "url": "https://github.com/hortonworks/cloudbreak/pull/8737#discussion_r466944459", "createdAt": "2020-08-07T10:00:01Z", "author": {"login": "smaniraju"}, "path": "autoscale/src/main/java/com/sequenceiq/periscope/controller/DistroXAutoScaleClusterV1Controller.java", "diffHunk": "@@ -58,91 +66,102 @@\n     @Inject\n     private CloudbreakMessagesService messagesService;\n \n+    @Inject\n+    private TimeAlertRequestConverter timeAlertRequestConverter;\n+\n+    @Inject\n+    private LoadAlertRequestConverter loadAlertRequestConverter;\n+\n+    @Inject\n+    private EntitlementValidationService entitlementValidationService;\n+\n     @Override\n-    @CheckPermissionByAccount(action = AuthorizationResourceAction.DATAHUB_READ)\n+    @CheckPermissionByAccount(action = AuthorizationResourceAction.SCALE_DATAHUB)\n     public List<DistroXAutoscaleClusterResponse> getClusters() {\n         return distroXAutoscaleClusterResponseConverter.convertAllToJson(asClusterCommonService.getDistroXClusters());\n     }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjQxMDI1Mw=="}, "originalCommit": {"oid": "55f975481b3c241f8ec438afc60df37d5524c7d3"}, "originalPosition": 54}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjkxNjMwODYyOnYy", "diffSide": "RIGHT", "path": "autoscale/src/main/java/com/sequenceiq/periscope/controller/AutoScaleClusterV2Controller.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QwODowNjoyMlrOG9Qlrg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QwODozODoyMlrOG9Ripg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njg4ODExMA==", "bodyText": "I think this should be changed to @InternalOnly to ensure that noone will call this", "url": "https://github.com/hortonworks/cloudbreak/pull/8737#discussion_r466888110", "createdAt": "2020-08-07T08:06:22Z", "author": {"login": "horadla23"}, "path": "autoscale/src/main/java/com/sequenceiq/periscope/controller/AutoScaleClusterV2Controller.java", "diffHunk": "@@ -17,7 +18,8 @@\n /**\n  * @deprecated Database ID based endpoints are deprecated for removal.\n  */\n-@Component\n+@Controller\n+@DisableCheckPermissions", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "55f975481b3c241f8ec438afc60df37d5524c7d3"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjkwMzcxOA==", "bodyText": "ok", "url": "https://github.com/hortonworks/cloudbreak/pull/8737#discussion_r466903718", "createdAt": "2020-08-07T08:38:22Z", "author": {"login": "smaniraju"}, "path": "autoscale/src/main/java/com/sequenceiq/periscope/controller/AutoScaleClusterV2Controller.java", "diffHunk": "@@ -17,7 +18,8 @@\n /**\n  * @deprecated Database ID based endpoints are deprecated for removal.\n  */\n-@Component\n+@Controller\n+@DisableCheckPermissions", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njg4ODExMA=="}, "originalCommit": {"oid": "55f975481b3c241f8ec438afc60df37d5524c7d3"}, "originalPosition": 17}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3026, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}