{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI5NTk3MTc1", "number": 9538, "reviewThreads": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQyMDozNjoxM1rOE-1PLw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQxMToyMTozNlrOE_GtlA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM0MzE5NDA3OnYy", "diffSide": "RIGHT", "path": "environment/src/test/java/com/sequenceiq/environment/environment/dto/AuthenticationDtoConverterTest.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQyMDozNjoxM1rOH8M3Pw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQxMDo1Nzo1M1rOH8nRmw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjg4NzM1OQ==", "bodyText": "I would like to see more use case here based on the regex", "url": "https://github.com/hortonworks/cloudbreak/pull/9538#discussion_r532887359", "createdAt": "2020-11-30T20:36:13Z", "author": {"login": "doktoric"}, "path": "environment/src/test/java/com/sequenceiq/environment/environment/dto/AuthenticationDtoConverterTest.java", "diffHunk": "@@ -59,4 +67,19 @@ void authenticationToDto() {\n                 .matches(m -> Objects.equals(m.getPublicKeyId(), environment.getPublicKeyId()))\n                 .matches(m -> Objects.equals(m.isManagedKey(), environment.isManagedKey()));\n     }\n+\n+    @Test\n+    void testSshKeyCreation() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "326f5ad2f486cdfe29d85e1178db7d116ce273d6"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjk2MzQ1NQ==", "bodyText": "It's not the place to test it. It has it's tests in the PublicKeyValidatorTest", "url": "https://github.com/hortonworks/cloudbreak/pull/9538#discussion_r532963455", "createdAt": "2020-11-30T23:11:05Z", "author": {"login": "attilapalfi92"}, "path": "environment/src/test/java/com/sequenceiq/environment/environment/dto/AuthenticationDtoConverterTest.java", "diffHunk": "@@ -59,4 +67,19 @@ void authenticationToDto() {\n                 .matches(m -> Objects.equals(m.getPublicKeyId(), environment.getPublicKeyId()))\n                 .matches(m -> Objects.equals(m.isManagedKey(), environment.isManagedKey()));\n     }\n+\n+    @Test\n+    void testSshKeyCreation() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjg4NzM1OQ=="}, "originalCommit": {"oid": "326f5ad2f486cdfe29d85e1178db7d116ce273d6"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzMyMDA5MQ==", "bodyText": "\ud83d\udc4d", "url": "https://github.com/hortonworks/cloudbreak/pull/9538#discussion_r533320091", "createdAt": "2020-12-01T10:57:53Z", "author": {"login": "doktoric"}, "path": "environment/src/test/java/com/sequenceiq/environment/environment/dto/AuthenticationDtoConverterTest.java", "diffHunk": "@@ -59,4 +67,19 @@ void authenticationToDto() {\n                 .matches(m -> Objects.equals(m.getPublicKeyId(), environment.getPublicKeyId()))\n                 .matches(m -> Objects.equals(m.isManagedKey(), environment.isManagedKey()));\n     }\n+\n+    @Test\n+    void testSshKeyCreation() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjg4NzM1OQ=="}, "originalCommit": {"oid": "326f5ad2f486cdfe29d85e1178db7d116ce273d6"}, "originalPosition": 42}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM0MzE5NTcwOnYy", "diffSide": "RIGHT", "path": "environment/src/test/java/com/sequenceiq/environment/environment/dto/AuthenticationDtoConverterTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQyMDozNjo0MlrOH8M4UQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQyMzoxMzo0OFrOH8Rk7g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjg4NzYzMw==", "bodyText": "verify would be great", "url": "https://github.com/hortonworks/cloudbreak/pull/9538#discussion_r532887633", "createdAt": "2020-11-30T20:36:42Z", "author": {"login": "doktoric"}, "path": "environment/src/test/java/com/sequenceiq/environment/environment/dto/AuthenticationDtoConverterTest.java", "diffHunk": "@@ -59,4 +67,19 @@ void authenticationToDto() {\n                 .matches(m -> Objects.equals(m.getPublicKeyId(), environment.getPublicKeyId()))\n                 .matches(m -> Objects.equals(m.isManagedKey(), environment.isManagedKey()));\n     }\n+\n+    @Test\n+    void testSshKeyCreation() {\n+        String testKey = \"ssh-rsa AAAASASFAS3532== banana@apple.com\";\n+        AuthenticationDto dto = AuthenticationDto.builder()\n+                .withLoginUserName(LOGIN)\n+                .withPublicKey(testKey)\n+                .withPublicKeyId(PUBLIC_KEY_ID)\n+                .withManagedKey(true)\n+                .build();\n+\n+        EnvironmentAuthentication environmentAuthentication = underTest.dtoToAuthentication(dto);\n+\n+        assertEquals(\"ssh-rsa AAAASASFAS3532== cloudbreak\", environmentAuthentication.getPublicKey());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "326f5ad2f486cdfe29d85e1178db7d116ce273d6"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjk2NDU5MA==", "bodyText": "can you help me, what do you mean by verify?", "url": "https://github.com/hortonworks/cloudbreak/pull/9538#discussion_r532964590", "createdAt": "2020-11-30T23:13:48Z", "author": {"login": "attilapalfi92"}, "path": "environment/src/test/java/com/sequenceiq/environment/environment/dto/AuthenticationDtoConverterTest.java", "diffHunk": "@@ -59,4 +67,19 @@ void authenticationToDto() {\n                 .matches(m -> Objects.equals(m.getPublicKeyId(), environment.getPublicKeyId()))\n                 .matches(m -> Objects.equals(m.isManagedKey(), environment.isManagedKey()));\n     }\n+\n+    @Test\n+    void testSshKeyCreation() {\n+        String testKey = \"ssh-rsa AAAASASFAS3532== banana@apple.com\";\n+        AuthenticationDto dto = AuthenticationDto.builder()\n+                .withLoginUserName(LOGIN)\n+                .withPublicKey(testKey)\n+                .withPublicKeyId(PUBLIC_KEY_ID)\n+                .withManagedKey(true)\n+                .build();\n+\n+        EnvironmentAuthentication environmentAuthentication = underTest.dtoToAuthentication(dto);\n+\n+        assertEquals(\"ssh-rsa AAAASASFAS3532== cloudbreak\", environmentAuthentication.getPublicKey());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjg4NzYzMw=="}, "originalCommit": {"oid": "326f5ad2f486cdfe29d85e1178db7d116ce273d6"}, "originalPosition": 53}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM0MzE5NjgyOnYy", "diffSide": "RIGHT", "path": "environment/src/test/java/com/sequenceiq/environment/environment/service/EnvironmentCreationServiceTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQyMDozNjo1NlrOH8M4_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQyMDozNjo1NlrOH8M4_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjg4NzgwNg==", "bodyText": "please add verify as well", "url": "https://github.com/hortonworks/cloudbreak/pull/9538#discussion_r532887806", "createdAt": "2020-11-30T20:36:56Z", "author": {"login": "doktoric"}, "path": "environment/src/test/java/com/sequenceiq/environment/environment/service/EnvironmentCreationServiceTest.java", "diffHunk": "@@ -94,6 +95,11 @@\n     @Inject\n     private EnvironmentCreationService environmentCreationServiceUnderTest;\n \n+    @BeforeEach\n+    void setup() {\n+        when(validatorService.validatePublicKey(any())).thenReturn(ValidationResult.empty());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "326f5ad2f486cdfe29d85e1178db7d116ce273d6"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM0MzE5OTUyOnYy", "diffSide": "RIGHT", "path": "environment/src/test/java/com/sequenceiq/environment/environment/validation/validators/PublicKeyValidatorTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQyMDozNzo0M1rOH8M6nQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQyMDozNzo0M1rOH8M6nQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjg4ODIyMQ==", "bodyText": "would be nice to see the result in test name", "url": "https://github.com/hortonworks/cloudbreak/pull/9538#discussion_r532888221", "createdAt": "2020-11-30T20:37:43Z", "author": {"login": "doktoric"}, "path": "environment/src/test/java/com/sequenceiq/environment/environment/validation/validators/PublicKeyValidatorTest.java", "diffHunk": "@@ -0,0 +1,70 @@\n+package com.sequenceiq.environment.environment.validation.validators;\n+\n+import static org.junit.jupiter.api.Assertions.assertFalse;\n+\n+import org.junit.jupiter.api.Test;\n+\n+import com.sequenceiq.cloudbreak.validation.ValidationResult;\n+\n+class PublicKeyValidatorTest {\n+\n+    private final PublicKeyValidator underTest = new PublicKeyValidator();\n+\n+    @Test\n+    void testPublicKeyValidationWithValidKeyAndComment() {\n+        String validKey = \"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDXF9paZtj6ibDgRGtw2jTls1fysxETxG/rbCN9vYlpDw6ROK90rjXnC0qi43kXbs5Z/Ny\" +\n+                \"FDDcYW4U1nUmJCIhQqNJv00ukTbS4McfeNYrZF78KNLtbUP57SfKzjcH1Txz9Zr3ILEADqMyNRzgSB2gw5XnfbbLUFQYcF3hT11gjEw99Qi9eCQ6nC\" +\n+                \"M37iy9tCIfMyB5CI24LECv+8UMFdYw+X9JQXgkAlcPi1zmVNckD6dDGGC2nY9mK7jw0dqZ2W/Q2HvGVgP7iSxnKIFIylifPMz0jmtzpjPi4czgr34\" +\n+                \"d4PFlQsv8LgwWEQMyTJGQmtF3GGa1o/qT07gePY2tl1sAzOLszfglmkBZS+POYi65fxYGepF5C0Rmc3427dLp+HPl8QSAuq0j92/3LGLOKTjn1qC2\" +\n+                \"MjBNhbkhFhDKnv0VQslmN/nkgDKUSHfQqfMwo4HXFIIydUWxT+5PxFCaS4axzGQ2HYylxqonnU3P0DJkh/omegI36HyxxlMNlpf/zn3/zrwSFvKN\" +\n+                \"CFvbQezJg8jdqq7VEHx4DH6WhYQ02TLsjmcA0EFp1HxTCbJojD/Ixev/Wc5duHotOBiS0CXdJwyzKSQttQS9NGn+/LvUyiD/Z/Rz2r3B0LpQsQu4\" +\n+                \"tI/8F5Jq+QiRgS9cQRnuLZuvAwbSNYI+g+zPdhaZq8fvumWarcQ== apalfi@hortonworks.com\\n\" +\n+                \"\\n\";\n+\n+        ValidationResult validationResult = underTest.validatePublicKey(validKey);\n+        assertFalse(validationResult.hasError());\n+    }\n+\n+    @Test\n+    void testPublicKeyValidationWithBackSlashesInComment() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "326f5ad2f486cdfe29d85e1178db7d116ce273d6"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM0MzIwMDMwOnYy", "diffSide": "RIGHT", "path": "environment/src/test/java/com/sequenceiq/environment/environment/validation/validators/PublicKeyValidatorTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQyMDozNzo1OFrOH8M7Hg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQyMDozNzo1OFrOH8M7Hg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjg4ODM1MA==", "bodyText": "would be nice to see the result in test name", "url": "https://github.com/hortonworks/cloudbreak/pull/9538#discussion_r532888350", "createdAt": "2020-11-30T20:37:58Z", "author": {"login": "doktoric"}, "path": "environment/src/test/java/com/sequenceiq/environment/environment/validation/validators/PublicKeyValidatorTest.java", "diffHunk": "@@ -0,0 +1,70 @@\n+package com.sequenceiq.environment.environment.validation.validators;\n+\n+import static org.junit.jupiter.api.Assertions.assertFalse;\n+\n+import org.junit.jupiter.api.Test;\n+\n+import com.sequenceiq.cloudbreak.validation.ValidationResult;\n+\n+class PublicKeyValidatorTest {\n+\n+    private final PublicKeyValidator underTest = new PublicKeyValidator();\n+\n+    @Test\n+    void testPublicKeyValidationWithValidKeyAndComment() {\n+        String validKey = \"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDXF9paZtj6ibDgRGtw2jTls1fysxETxG/rbCN9vYlpDw6ROK90rjXnC0qi43kXbs5Z/Ny\" +\n+                \"FDDcYW4U1nUmJCIhQqNJv00ukTbS4McfeNYrZF78KNLtbUP57SfKzjcH1Txz9Zr3ILEADqMyNRzgSB2gw5XnfbbLUFQYcF3hT11gjEw99Qi9eCQ6nC\" +\n+                \"M37iy9tCIfMyB5CI24LECv+8UMFdYw+X9JQXgkAlcPi1zmVNckD6dDGGC2nY9mK7jw0dqZ2W/Q2HvGVgP7iSxnKIFIylifPMz0jmtzpjPi4czgr34\" +\n+                \"d4PFlQsv8LgwWEQMyTJGQmtF3GGa1o/qT07gePY2tl1sAzOLszfglmkBZS+POYi65fxYGepF5C0Rmc3427dLp+HPl8QSAuq0j92/3LGLOKTjn1qC2\" +\n+                \"MjBNhbkhFhDKnv0VQslmN/nkgDKUSHfQqfMwo4HXFIIydUWxT+5PxFCaS4axzGQ2HYylxqonnU3P0DJkh/omegI36HyxxlMNlpf/zn3/zrwSFvKN\" +\n+                \"CFvbQezJg8jdqq7VEHx4DH6WhYQ02TLsjmcA0EFp1HxTCbJojD/Ixev/Wc5duHotOBiS0CXdJwyzKSQttQS9NGn+/LvUyiD/Z/Rz2r3B0LpQsQu4\" +\n+                \"tI/8F5Jq+QiRgS9cQRnuLZuvAwbSNYI+g+zPdhaZq8fvumWarcQ== apalfi@hortonworks.com\\n\" +\n+                \"\\n\";\n+\n+        ValidationResult validationResult = underTest.validatePublicKey(validKey);\n+        assertFalse(validationResult.hasError());\n+    }\n+\n+    @Test\n+    void testPublicKeyValidationWithBackSlashesInComment() {\n+        String validKey = \"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDXF9paZtj6ibDgRGtw2jTls1fysxETxG/rbCN9vYlpDw6ROK90rjXnC0qi43kXbs5Z/Ny\" +\n+                \"FDDcYW4U1nUmJCIhQqNJv00ukTbS4McfeNYrZF78KNLtbUP57SfKzjcH1Txz9Zr3ILEADqMyNRzgSB2gw5XnfbbLUFQYcF3hT11gjEw99Qi9eCQ6nC\" +\n+                \"M37iy9tCIfMyB5CI24LECv+8UMFdYw+X9JQXgkAlcPi1zmVNckD6dDGGC2nY9mK7jw0dqZ2W/Q2HvGVgP7iSxnKIFIylifPMz0jmtzpjPi4czgr34\" +\n+                \"d4PFlQsv8LgwWEQMyTJGQmtF3GGa1o/qT07gePY2tl1sAzOLszfglmkBZS+POYi65fxYGepF5C0Rmc3427dLp+HPl8QSAuq0j92/3LGLOKTjn1qC2\" +\n+                \"MjBNhbkhFhDKnv0VQslmN/nkgDKUSHfQqfMwo4HXFIIydUWxT+5PxFCaS4axzGQ2HYylxqonnU3P0DJkh/omegI36HyxxlMNlpf/zn3/zrwSFvKN\" +\n+                \"CFvbQezJg8jdqq7VEHx4DH6WhYQ02TLsjmcA0EFp1HxTCbJojD/Ixev/Wc5duHotOBiS0CXdJwyzKSQttQS9NGn+/LvUyiD/Z/Rz2r3B0LpQsQu4\" +\n+                \"tI/8F5Jq+QiRgS9cQRnuLZuvAwbSNYI+g+zPdhaZq8fvumWarcQ== office01\\\\\\\\en10022@PCL15925\\n\" +\n+                \"\\n\";\n+\n+        ValidationResult validationResult = underTest.validatePublicKey(validKey);\n+        assertFalse(validationResult.hasError());\n+    }\n+\n+    @Test\n+    void testPublicKeyValidationWithNoComment() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "326f5ad2f486cdfe29d85e1178db7d116ce273d6"}, "originalPosition": 44}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM0MzIwMDU0OnYy", "diffSide": "RIGHT", "path": "environment/src/test/java/com/sequenceiq/environment/environment/validation/validators/PublicKeyValidatorTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQyMDozODowMlrOH8M7RA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQyMDozODowMlrOH8M7RA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjg4ODM4OA==", "bodyText": "would be nice to see the result in test name", "url": "https://github.com/hortonworks/cloudbreak/pull/9538#discussion_r532888388", "createdAt": "2020-11-30T20:38:02Z", "author": {"login": "doktoric"}, "path": "environment/src/test/java/com/sequenceiq/environment/environment/validation/validators/PublicKeyValidatorTest.java", "diffHunk": "@@ -0,0 +1,70 @@\n+package com.sequenceiq.environment.environment.validation.validators;\n+\n+import static org.junit.jupiter.api.Assertions.assertFalse;\n+\n+import org.junit.jupiter.api.Test;\n+\n+import com.sequenceiq.cloudbreak.validation.ValidationResult;\n+\n+class PublicKeyValidatorTest {\n+\n+    private final PublicKeyValidator underTest = new PublicKeyValidator();\n+\n+    @Test\n+    void testPublicKeyValidationWithValidKeyAndComment() {\n+        String validKey = \"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDXF9paZtj6ibDgRGtw2jTls1fysxETxG/rbCN9vYlpDw6ROK90rjXnC0qi43kXbs5Z/Ny\" +\n+                \"FDDcYW4U1nUmJCIhQqNJv00ukTbS4McfeNYrZF78KNLtbUP57SfKzjcH1Txz9Zr3ILEADqMyNRzgSB2gw5XnfbbLUFQYcF3hT11gjEw99Qi9eCQ6nC\" +\n+                \"M37iy9tCIfMyB5CI24LECv+8UMFdYw+X9JQXgkAlcPi1zmVNckD6dDGGC2nY9mK7jw0dqZ2W/Q2HvGVgP7iSxnKIFIylifPMz0jmtzpjPi4czgr34\" +\n+                \"d4PFlQsv8LgwWEQMyTJGQmtF3GGa1o/qT07gePY2tl1sAzOLszfglmkBZS+POYi65fxYGepF5C0Rmc3427dLp+HPl8QSAuq0j92/3LGLOKTjn1qC2\" +\n+                \"MjBNhbkhFhDKnv0VQslmN/nkgDKUSHfQqfMwo4HXFIIydUWxT+5PxFCaS4axzGQ2HYylxqonnU3P0DJkh/omegI36HyxxlMNlpf/zn3/zrwSFvKN\" +\n+                \"CFvbQezJg8jdqq7VEHx4DH6WhYQ02TLsjmcA0EFp1HxTCbJojD/Ixev/Wc5duHotOBiS0CXdJwyzKSQttQS9NGn+/LvUyiD/Z/Rz2r3B0LpQsQu4\" +\n+                \"tI/8F5Jq+QiRgS9cQRnuLZuvAwbSNYI+g+zPdhaZq8fvumWarcQ== apalfi@hortonworks.com\\n\" +\n+                \"\\n\";\n+\n+        ValidationResult validationResult = underTest.validatePublicKey(validKey);\n+        assertFalse(validationResult.hasError());\n+    }\n+\n+    @Test\n+    void testPublicKeyValidationWithBackSlashesInComment() {\n+        String validKey = \"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDXF9paZtj6ibDgRGtw2jTls1fysxETxG/rbCN9vYlpDw6ROK90rjXnC0qi43kXbs5Z/Ny\" +\n+                \"FDDcYW4U1nUmJCIhQqNJv00ukTbS4McfeNYrZF78KNLtbUP57SfKzjcH1Txz9Zr3ILEADqMyNRzgSB2gw5XnfbbLUFQYcF3hT11gjEw99Qi9eCQ6nC\" +\n+                \"M37iy9tCIfMyB5CI24LECv+8UMFdYw+X9JQXgkAlcPi1zmVNckD6dDGGC2nY9mK7jw0dqZ2W/Q2HvGVgP7iSxnKIFIylifPMz0jmtzpjPi4czgr34\" +\n+                \"d4PFlQsv8LgwWEQMyTJGQmtF3GGa1o/qT07gePY2tl1sAzOLszfglmkBZS+POYi65fxYGepF5C0Rmc3427dLp+HPl8QSAuq0j92/3LGLOKTjn1qC2\" +\n+                \"MjBNhbkhFhDKnv0VQslmN/nkgDKUSHfQqfMwo4HXFIIydUWxT+5PxFCaS4axzGQ2HYylxqonnU3P0DJkh/omegI36HyxxlMNlpf/zn3/zrwSFvKN\" +\n+                \"CFvbQezJg8jdqq7VEHx4DH6WhYQ02TLsjmcA0EFp1HxTCbJojD/Ixev/Wc5duHotOBiS0CXdJwyzKSQttQS9NGn+/LvUyiD/Z/Rz2r3B0LpQsQu4\" +\n+                \"tI/8F5Jq+QiRgS9cQRnuLZuvAwbSNYI+g+zPdhaZq8fvumWarcQ== office01\\\\\\\\en10022@PCL15925\\n\" +\n+                \"\\n\";\n+\n+        ValidationResult validationResult = underTest.validatePublicKey(validKey);\n+        assertFalse(validationResult.hasError());\n+    }\n+\n+    @Test\n+    void testPublicKeyValidationWithNoComment() {\n+        String validKey = \"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDXF9paZtj6ibDgRGtw2jTls1fysxETxG/rbCN9vYlpDw6ROK90rjXnC0qi43kXbs5Z/Ny\" +\n+                \"FDDcYW4U1nUmJCIhQqNJv00ukTbS4McfeNYrZF78KNLtbUP57SfKzjcH1Txz9Zr3ILEADqMyNRzgSB2gw5XnfbbLUFQYcF3hT11gjEw99Qi9eCQ6nC\" +\n+                \"M37iy9tCIfMyB5CI24LECv+8UMFdYw+X9JQXgkAlcPi1zmVNckD6dDGGC2nY9mK7jw0dqZ2W/Q2HvGVgP7iSxnKIFIylifPMz0jmtzpjPi4czgr34\" +\n+                \"d4PFlQsv8LgwWEQMyTJGQmtF3GGa1o/qT07gePY2tl1sAzOLszfglmkBZS+POYi65fxYGepF5C0Rmc3427dLp+HPl8QSAuq0j92/3LGLOKTjn1qC2\" +\n+                \"MjBNhbkhFhDKnv0VQslmN/nkgDKUSHfQqfMwo4HXFIIydUWxT+5PxFCaS4axzGQ2HYylxqonnU3P0DJkh/omegI36HyxxlMNlpf/zn3/zrwSFvKN\" +\n+                \"CFvbQezJg8jdqq7VEHx4DH6WhYQ02TLsjmcA0EFp1HxTCbJojD/Ixev/Wc5duHotOBiS0CXdJwyzKSQttQS9NGn+/LvUyiD/Z/Rz2r3B0LpQsQu4\" +\n+                \"tI/8F5Jq+QiRgS9cQRnuLZuvAwbSNYI+g+zPdhaZq8fvumWarcQ==\";\n+\n+        ValidationResult validationResult = underTest.validatePublicKey(validKey);\n+        assertFalse(validationResult.hasError());\n+    }\n+\n+    @Test\n+    void testPublicKeyValidationWith45Parts() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "326f5ad2f486cdfe29d85e1178db7d116ce273d6"}, "originalPosition": 58}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM0MzIwMTcwOnYy", "diffSide": "RIGHT", "path": "environment/src/test/java/com/sequenceiq/environment/environment/validation/validators/PublicKeyValidatorTest.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQyMDozODozMFrOH8M8Dg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQxMTowNDo0M1rOH8nhEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjg4ODU5MA==", "bodyText": "based on the regex we should cover more scenario", "url": "https://github.com/hortonworks/cloudbreak/pull/9538#discussion_r532888590", "createdAt": "2020-11-30T20:38:30Z", "author": {"login": "doktoric"}, "path": "environment/src/test/java/com/sequenceiq/environment/environment/validation/validators/PublicKeyValidatorTest.java", "diffHunk": "@@ -0,0 +1,70 @@\n+package com.sequenceiq.environment.environment.validation.validators;\n+\n+import static org.junit.jupiter.api.Assertions.assertFalse;\n+\n+import org.junit.jupiter.api.Test;\n+\n+import com.sequenceiq.cloudbreak.validation.ValidationResult;\n+\n+class PublicKeyValidatorTest {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "326f5ad2f486cdfe29d85e1178db7d116ce273d6"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjk2MzgyNw==", "bodyText": "I'll create one for each algorithm", "url": "https://github.com/hortonworks/cloudbreak/pull/9538#discussion_r532963827", "createdAt": "2020-11-30T23:11:54Z", "author": {"login": "attilapalfi92"}, "path": "environment/src/test/java/com/sequenceiq/environment/environment/validation/validators/PublicKeyValidatorTest.java", "diffHunk": "@@ -0,0 +1,70 @@\n+package com.sequenceiq.environment.environment.validation.validators;\n+\n+import static org.junit.jupiter.api.Assertions.assertFalse;\n+\n+import org.junit.jupiter.api.Test;\n+\n+import com.sequenceiq.cloudbreak.validation.ValidationResult;\n+\n+class PublicKeyValidatorTest {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjg4ODU5MA=="}, "originalCommit": {"oid": "326f5ad2f486cdfe29d85e1178db7d116ce273d6"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzMxOTQ1NQ==", "bodyText": "I see these \"ssh-rsa\", \"ecdsa-sha2-nistp256\", \"ecdsa-sha2-nistp384\", \"ecdsa-sha2-nistp521\", \"ssh-ed25519\", \"ssh-dss\"", "url": "https://github.com/hortonworks/cloudbreak/pull/9538#discussion_r533319455", "createdAt": "2020-12-01T10:56:48Z", "author": {"login": "doktoric"}, "path": "environment/src/test/java/com/sequenceiq/environment/environment/validation/validators/PublicKeyValidatorTest.java", "diffHunk": "@@ -0,0 +1,70 @@\n+package com.sequenceiq.environment.environment.validation.validators;\n+\n+import static org.junit.jupiter.api.Assertions.assertFalse;\n+\n+import org.junit.jupiter.api.Test;\n+\n+import com.sequenceiq.cloudbreak.validation.ValidationResult;\n+\n+class PublicKeyValidatorTest {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjg4ODU5MA=="}, "originalCommit": {"oid": "326f5ad2f486cdfe29d85e1178db7d116ce273d6"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzMyNDA0OQ==", "bodyText": "those are the algorithms", "url": "https://github.com/hortonworks/cloudbreak/pull/9538#discussion_r533324049", "createdAt": "2020-12-01T11:04:43Z", "author": {"login": "attilapalfi92"}, "path": "environment/src/test/java/com/sequenceiq/environment/environment/validation/validators/PublicKeyValidatorTest.java", "diffHunk": "@@ -0,0 +1,70 @@\n+package com.sequenceiq.environment.environment.validation.validators;\n+\n+import static org.junit.jupiter.api.Assertions.assertFalse;\n+\n+import org.junit.jupiter.api.Test;\n+\n+import com.sequenceiq.cloudbreak.validation.ValidationResult;\n+\n+class PublicKeyValidatorTest {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjg4ODU5MA=="}, "originalCommit": {"oid": "326f5ad2f486cdfe29d85e1178db7d116ce273d6"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM0MzIwMzI5OnYy", "diffSide": "RIGHT", "path": "integration-test/src/main/java/com/sequenceiq/it/cloudbreak/testcase/mock/EnvironmentEditTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQyMDozOTowMFrOH8M89g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQyMzoxMjoxMlrOH8RiUQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjg4ODgyMg==", "bodyText": "why space is here ?", "url": "https://github.com/hortonworks/cloudbreak/pull/9538#discussion_r532888822", "createdAt": "2020-11-30T20:39:00Z", "author": {"login": "doktoric"}, "path": "integration-test/src/main/java/com/sequenceiq/it/cloudbreak/testcase/mock/EnvironmentEditTest.java", "diffHunk": "@@ -66,7 +73,7 @@ public void authenticationEditWhenSetExistingKeyAndDeleteManagedSuccessfully(Moc\n                 .then((tc, t, c) -> {\n                     String publicKeyId = t.getResponse().getAuthentication().getPublicKeyId();\n                     String publicKey = t.getResponse().getAuthentication().getPublicKey();\n-                    if (!\"existing-public-key\".equals(publicKeyId)) {\n+                    if (!\"existing-public-key\" .equals(publicKeyId)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "326f5ad2f486cdfe29d85e1178db7d116ce273d6"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjk2MzkyMQ==", "bodyText": "I guess its an error", "url": "https://github.com/hortonworks/cloudbreak/pull/9538#discussion_r532963921", "createdAt": "2020-11-30T23:12:12Z", "author": {"login": "attilapalfi92"}, "path": "integration-test/src/main/java/com/sequenceiq/it/cloudbreak/testcase/mock/EnvironmentEditTest.java", "diffHunk": "@@ -66,7 +73,7 @@ public void authenticationEditWhenSetExistingKeyAndDeleteManagedSuccessfully(Moc\n                 .then((tc, t, c) -> {\n                     String publicKeyId = t.getResponse().getAuthentication().getPublicKeyId();\n                     String publicKey = t.getResponse().getAuthentication().getPublicKey();\n-                    if (!\"existing-public-key\".equals(publicKeyId)) {\n+                    if (!\"existing-public-key\" .equals(publicKeyId)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjg4ODgyMg=="}, "originalCommit": {"oid": "326f5ad2f486cdfe29d85e1178db7d116ce273d6"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM0MzIwNDQ2OnYy", "diffSide": "RIGHT", "path": "integration-test/src/main/java/com/sequenceiq/it/cloudbreak/testcase/mock/EnvironmentEditTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQyMDozOToyMFrOH8M9qQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQyMzoxMjoyM1rOH8RioA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjg4OTAwMQ==", "bodyText": "do we need space here ?", "url": "https://github.com/hortonworks/cloudbreak/pull/9538#discussion_r532889001", "createdAt": "2020-11-30T20:39:20Z", "author": {"login": "doktoric"}, "path": "integration-test/src/main/java/com/sequenceiq/it/cloudbreak/testcase/mock/EnvironmentEditTest.java", "diffHunk": "@@ -110,7 +117,7 @@ public void authenticationEditWhenSetManagedKeyAndNotDeleteExisted(MockedTestCon\n                 .then((tc, t, c) -> {\n                     String publicKeyId = t.getResponse().getAuthentication().getPublicKeyId();\n                     String publicKey = t.getResponse().getAuthentication().getPublicKey();\n-                    if (\"existing-public-key\".equals(publicKeyId)) {\n+                    if (\"existing-public-key\" .equals(publicKeyId)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "326f5ad2f486cdfe29d85e1178db7d116ce273d6"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjk2NDAwMA==", "bodyText": "I don't know why the space is here", "url": "https://github.com/hortonworks/cloudbreak/pull/9538#discussion_r532964000", "createdAt": "2020-11-30T23:12:23Z", "author": {"login": "attilapalfi92"}, "path": "integration-test/src/main/java/com/sequenceiq/it/cloudbreak/testcase/mock/EnvironmentEditTest.java", "diffHunk": "@@ -110,7 +117,7 @@ public void authenticationEditWhenSetManagedKeyAndNotDeleteExisted(MockedTestCon\n                 .then((tc, t, c) -> {\n                     String publicKeyId = t.getResponse().getAuthentication().getPublicKeyId();\n                     String publicKey = t.getResponse().getAuthentication().getPublicKey();\n-                    if (\"existing-public-key\".equals(publicKeyId)) {\n+                    if (\"existing-public-key\" .equals(publicKeyId)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjg4OTAwMQ=="}, "originalCommit": {"oid": "326f5ad2f486cdfe29d85e1178db7d116ce273d6"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM0MzIwODAxOnYy", "diffSide": "LEFT", "path": "usage-collection/src/generated/main/java/com/cloudera/thunderhead/service/common/usage/UsageProto.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQyMDo0MDoxNFrOH8M_sg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQyMzoxMzoyNlrOH8RkSQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjg4OTUyMg==", "bodyText": "do we need this?", "url": "https://github.com/hortonworks/cloudbreak/pull/9538#discussion_r532889522", "createdAt": "2020-11-30T20:40:14Z", "author": {"login": "doktoric"}, "path": "usage-collection/src/generated/main/java/com/cloudera/thunderhead/service/common/usage/UsageProto.java", "diffHunk": "@@ -42919,7 +42919,7 @@ private CDPEnvironmentsEnvironmentType(\n       YARN(4),\n       /**\n        * <pre>\n-       * YCloud", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "326f5ad2f486cdfe29d85e1178db7d116ce273d6"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjk2NDQyNQ==", "bodyText": "interesting change. I rebased to the master and dont remember touching this", "url": "https://github.com/hortonworks/cloudbreak/pull/9538#discussion_r532964425", "createdAt": "2020-11-30T23:13:26Z", "author": {"login": "attilapalfi92"}, "path": "usage-collection/src/generated/main/java/com/cloudera/thunderhead/service/common/usage/UsageProto.java", "diffHunk": "@@ -42919,7 +42919,7 @@ private CDPEnvironmentsEnvironmentType(\n       YARN(4),\n       /**\n        * <pre>\n-       * YCloud", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjg4OTUyMg=="}, "originalCommit": {"oid": "326f5ad2f486cdfe29d85e1178db7d116ce273d6"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM0MzIxNTk3OnYy", "diffSide": "RIGHT", "path": "environment/src/main/java/com/sequenceiq/environment/environment/dto/AuthenticationDtoConverter.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQyMDo0MjozM1rOH8NEVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQxMDo1NTo1MlrOH8nM8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjg5MDcxMA==", "bodyText": "why cloudbreak at the end?", "url": "https://github.com/hortonworks/cloudbreak/pull/9538#discussion_r532890710", "createdAt": "2020-11-30T20:42:33Z", "author": {"login": "doktoric"}, "path": "environment/src/main/java/com/sequenceiq/environment/environment/dto/AuthenticationDtoConverter.java", "diffHunk": "@@ -1,16 +1,34 @@\n package com.sequenceiq.environment.environment.dto;\n \n+import java.util.Arrays;\n+import java.util.List;\n+\n+import org.apache.commons.lang3.StringUtils;\n import org.springframework.stereotype.Component;\n \n+import com.sequenceiq.cloudbreak.validation.ValidationResult;\n import com.sequenceiq.environment.environment.domain.EnvironmentAuthentication;\n+import com.sequenceiq.environment.environment.validation.validators.PublicKeyValidator;\n \n @Component\n public class AuthenticationDtoConverter {\n \n+    private final PublicKeyValidator publicKeyValidator;\n+\n+    public AuthenticationDtoConverter(PublicKeyValidator publicKeyValidator) {\n+        this.publicKeyValidator = publicKeyValidator;\n+    }\n+\n     public EnvironmentAuthentication dtoToAuthentication(AuthenticationDto authenticationDto) {\n         EnvironmentAuthentication environmentAuthentication = new EnvironmentAuthentication();\n+        if (StringUtils.isNotEmpty(authenticationDto.getPublicKey())) {\n+            ValidationResult validationResult = publicKeyValidator.validatePublicKey(authenticationDto.getPublicKey());\n+            if (!validationResult.hasError()) {\n+                List<String> parts = Arrays.asList(StringUtils.split(authenticationDto.getPublicKey(), \" \"));\n+                environmentAuthentication.setPublicKey(String.format(\"%s %s %s\", parts.get(0), parts.get(1), \"cloudbreak\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "326f5ad2f486cdfe29d85e1178db7d116ce273d6"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjk2NDE5Ng==", "bodyText": "this is what we agreed in the support meeting", "url": "https://github.com/hortonworks/cloudbreak/pull/9538#discussion_r532964196", "createdAt": "2020-11-30T23:12:50Z", "author": {"login": "attilapalfi92"}, "path": "environment/src/main/java/com/sequenceiq/environment/environment/dto/AuthenticationDtoConverter.java", "diffHunk": "@@ -1,16 +1,34 @@\n package com.sequenceiq.environment.environment.dto;\n \n+import java.util.Arrays;\n+import java.util.List;\n+\n+import org.apache.commons.lang3.StringUtils;\n import org.springframework.stereotype.Component;\n \n+import com.sequenceiq.cloudbreak.validation.ValidationResult;\n import com.sequenceiq.environment.environment.domain.EnvironmentAuthentication;\n+import com.sequenceiq.environment.environment.validation.validators.PublicKeyValidator;\n \n @Component\n public class AuthenticationDtoConverter {\n \n+    private final PublicKeyValidator publicKeyValidator;\n+\n+    public AuthenticationDtoConverter(PublicKeyValidator publicKeyValidator) {\n+        this.publicKeyValidator = publicKeyValidator;\n+    }\n+\n     public EnvironmentAuthentication dtoToAuthentication(AuthenticationDto authenticationDto) {\n         EnvironmentAuthentication environmentAuthentication = new EnvironmentAuthentication();\n+        if (StringUtils.isNotEmpty(authenticationDto.getPublicKey())) {\n+            ValidationResult validationResult = publicKeyValidator.validatePublicKey(authenticationDto.getPublicKey());\n+            if (!validationResult.hasError()) {\n+                List<String> parts = Arrays.asList(StringUtils.split(authenticationDto.getPublicKey(), \" \"));\n+                environmentAuthentication.setPublicKey(String.format(\"%s %s %s\", parts.get(0), parts.get(1), \"cloudbreak\"));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjg5MDcxMA=="}, "originalCommit": {"oid": "326f5ad2f486cdfe29d85e1178db7d116ce273d6"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzMxODg5Nw==", "bodyText": "authenticationDto.loginUserName pls", "url": "https://github.com/hortonworks/cloudbreak/pull/9538#discussion_r533318897", "createdAt": "2020-12-01T10:55:52Z", "author": {"login": "doktoric"}, "path": "environment/src/main/java/com/sequenceiq/environment/environment/dto/AuthenticationDtoConverter.java", "diffHunk": "@@ -1,16 +1,34 @@\n package com.sequenceiq.environment.environment.dto;\n \n+import java.util.Arrays;\n+import java.util.List;\n+\n+import org.apache.commons.lang3.StringUtils;\n import org.springframework.stereotype.Component;\n \n+import com.sequenceiq.cloudbreak.validation.ValidationResult;\n import com.sequenceiq.environment.environment.domain.EnvironmentAuthentication;\n+import com.sequenceiq.environment.environment.validation.validators.PublicKeyValidator;\n \n @Component\n public class AuthenticationDtoConverter {\n \n+    private final PublicKeyValidator publicKeyValidator;\n+\n+    public AuthenticationDtoConverter(PublicKeyValidator publicKeyValidator) {\n+        this.publicKeyValidator = publicKeyValidator;\n+    }\n+\n     public EnvironmentAuthentication dtoToAuthentication(AuthenticationDto authenticationDto) {\n         EnvironmentAuthentication environmentAuthentication = new EnvironmentAuthentication();\n+        if (StringUtils.isNotEmpty(authenticationDto.getPublicKey())) {\n+            ValidationResult validationResult = publicKeyValidator.validatePublicKey(authenticationDto.getPublicKey());\n+            if (!validationResult.hasError()) {\n+                List<String> parts = Arrays.asList(StringUtils.split(authenticationDto.getPublicKey(), \" \"));\n+                environmentAuthentication.setPublicKey(String.format(\"%s %s %s\", parts.get(0), parts.get(1), \"cloudbreak\"));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjg5MDcxMA=="}, "originalCommit": {"oid": "326f5ad2f486cdfe29d85e1178db7d116ce273d6"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM0NjA1NzE2OnYy", "diffSide": "RIGHT", "path": "environment/src/main/java/com/sequenceiq/environment/environment/validation/validators/PublicKeyValidator.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQxMToyMTozNlrOH8oGvA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQxMzowMDozNVrOH8rgIg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzMzMzY5Mg==", "bodyText": "what if we determine the non-matching character with e.g end() and give it back in the validation result? The methods start() and end() will give the indexes into the text where the found match starts and ends. Actually end() returns the index of the character just after the end of the matching section.", "url": "https://github.com/hortonworks/cloudbreak/pull/9538#discussion_r533333692", "createdAt": "2020-12-01T11:21:36Z", "author": {"login": "pdarvasi"}, "path": "environment/src/main/java/com/sequenceiq/environment/environment/validation/validators/PublicKeyValidator.java", "diffHunk": "@@ -0,0 +1,34 @@\n+package com.sequenceiq.environment.environment.validation.validators;\n+\n+import java.util.Set;\n+import java.util.regex.Pattern;\n+\n+import org.apache.commons.lang3.StringUtils;\n+import org.springframework.stereotype.Component;\n+\n+import com.sequenceiq.cloudbreak.validation.ValidationResult;\n+\n+@Component\n+public class PublicKeyValidator {\n+\n+    private static final Set<String> SUPPORTED_ALGORITHMS\n+            = Set.of(\"ssh-rsa\", \"ecdsa-sha2-nistp256\", \"ecdsa-sha2-nistp384\", \"ecdsa-sha2-nistp521\", \"ssh-ed25519\", \"ssh-dss\");\n+\n+    private static final String ALGORITHM_TEXT_LIST = String.join(\", \", SUPPORTED_ALGORITHMS);\n+\n+    private static final Pattern SSH_PUBLIC_KEY_PATTERN = Pattern.compile(\"^(ssh-rsa AAAAB3NzaC1yc2|ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNT|\"\n+            + \"ecdsa-sha2-nistp384 AAAAE2VjZHNhLXNoYTItbmlzdHAzODQAAAAIbmlzdHAzOD|ecdsa-sha2-nistp521 AAAAE2VjZHNhLXNoYTItbmlzdHA1MjEAAAAIbmlzdHA1Mj|\"\n+            + \"ssh-ed25519 AAAAC3NzaC1lZDI1NTE5|ssh-dss AAAAB3NzaC1kc3)[0-9A-Za-z+\\\\/]+[=]{0,3}( .*)?$\");\n+\n+    public ValidationResult validatePublicKey(String publicKey) {\n+        ValidationResult.ValidationResultBuilder validationResultBuilder = ValidationResult.builder();\n+        if (StringUtils.isNotEmpty(publicKey)) {\n+            if (!SSH_PUBLIC_KEY_PATTERN.matcher(publicKey.trim()).matches()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "326f5ad2f486cdfe29d85e1178db7d116ce273d6"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzM4OTM0Ng==", "bodyText": "start and find throws illegalstateexception when there is no match and with this regex there are no partial matches / groups", "url": "https://github.com/hortonworks/cloudbreak/pull/9538#discussion_r533389346", "createdAt": "2020-12-01T13:00:35Z", "author": {"login": "attilapalfi92"}, "path": "environment/src/main/java/com/sequenceiq/environment/environment/validation/validators/PublicKeyValidator.java", "diffHunk": "@@ -0,0 +1,34 @@\n+package com.sequenceiq.environment.environment.validation.validators;\n+\n+import java.util.Set;\n+import java.util.regex.Pattern;\n+\n+import org.apache.commons.lang3.StringUtils;\n+import org.springframework.stereotype.Component;\n+\n+import com.sequenceiq.cloudbreak.validation.ValidationResult;\n+\n+@Component\n+public class PublicKeyValidator {\n+\n+    private static final Set<String> SUPPORTED_ALGORITHMS\n+            = Set.of(\"ssh-rsa\", \"ecdsa-sha2-nistp256\", \"ecdsa-sha2-nistp384\", \"ecdsa-sha2-nistp521\", \"ssh-ed25519\", \"ssh-dss\");\n+\n+    private static final String ALGORITHM_TEXT_LIST = String.join(\", \", SUPPORTED_ALGORITHMS);\n+\n+    private static final Pattern SSH_PUBLIC_KEY_PATTERN = Pattern.compile(\"^(ssh-rsa AAAAB3NzaC1yc2|ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNT|\"\n+            + \"ecdsa-sha2-nistp384 AAAAE2VjZHNhLXNoYTItbmlzdHAzODQAAAAIbmlzdHAzOD|ecdsa-sha2-nistp521 AAAAE2VjZHNhLXNoYTItbmlzdHA1MjEAAAAIbmlzdHA1Mj|\"\n+            + \"ssh-ed25519 AAAAC3NzaC1lZDI1NTE5|ssh-dss AAAAB3NzaC1kc3)[0-9A-Za-z+\\\\/]+[=]{0,3}( .*)?$\");\n+\n+    public ValidationResult validatePublicKey(String publicKey) {\n+        ValidationResult.ValidationResultBuilder validationResultBuilder = ValidationResult.builder();\n+        if (StringUtils.isNotEmpty(publicKey)) {\n+            if (!SSH_PUBLIC_KEY_PATTERN.matcher(publicKey.trim()).matches()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzMzMzY5Mg=="}, "originalCommit": {"oid": "326f5ad2f486cdfe29d85e1178db7d116ce273d6"}, "originalPosition": 26}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3538, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}