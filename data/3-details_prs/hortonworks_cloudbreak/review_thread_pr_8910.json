{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc3ODAyNDU0", "number": 8910, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQxMzo0MzozNFrOEfdfww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQxMzo0MzozNFrOEfdfww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAxNDI0NTc5OnYy", "diffSide": "RIGHT", "path": "orchestrator-salt/src/main/resources/salt/salt/cloudera/manager/start.sls", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQxMzo0MzozNFrOHLvxYg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQxNDowOToyMVrOHLw9_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjA3OTA3NA==", "bodyText": "I think we can omit this one as start_server already contains it, no reason to duplicate the same setting", "url": "https://github.com/hortonworks/cloudbreak/pull/8910#discussion_r482079074", "createdAt": "2020-09-02T13:43:34Z", "author": {"login": "lacikaaa"}, "path": "orchestrator-salt/src/main/resources/salt/salt/cloudera/manager/start.sls", "diffHunk": "@@ -8,6 +9,27 @@ init-cloudera-manager-db:\n         - user: {{ cloudera_manager.cloudera_manager_database.connectionUserName }}\n         - pass: {{ cloudera_manager.cloudera_manager_database.connectionPassword }}\n \n+# We need to restart the CM if the fromtend URL has been changed\n+{% if salt['pillar.get']('gateway:userfacingfqdn') is defined and salt['pillar.get']('gateway:userfacingfqdn')|length > 1 %}\n+update_frontend_url_of_cm:\n+  file.replace:\n+      - name: /etc/cloudera-scm-server/cm.settings\n+      - pattern: 'setsettings FRONTEND_URL.*'\n+      - repl: 'setsettings FRONTEND_URL https://{{ salt['pillar.get']('gateway:userfacingfqdn') }}/'\n+      - unless: grep \"^setsettings FRONTEND_URL https://{{ salt['pillar.get']('gateway:userfacingfqdn') }}/$\" /etc/cloudera-scm-server/cm.settings\n+\n+restart_cm_after_fronted_url_change:\n+  service.running:\n+    - name: cloudera-scm-server\n+    - enable: True", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7d95c51c71c0a2dcbeec5294d0f3be2304d41a23"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjA5ODY4Ng==", "bodyText": "ok", "url": "https://github.com/hortonworks/cloudbreak/pull/8910#discussion_r482098686", "createdAt": "2020-09-02T14:09:21Z", "author": {"login": "akanto"}, "path": "orchestrator-salt/src/main/resources/salt/salt/cloudera/manager/start.sls", "diffHunk": "@@ -8,6 +9,27 @@ init-cloudera-manager-db:\n         - user: {{ cloudera_manager.cloudera_manager_database.connectionUserName }}\n         - pass: {{ cloudera_manager.cloudera_manager_database.connectionPassword }}\n \n+# We need to restart the CM if the fromtend URL has been changed\n+{% if salt['pillar.get']('gateway:userfacingfqdn') is defined and salt['pillar.get']('gateway:userfacingfqdn')|length > 1 %}\n+update_frontend_url_of_cm:\n+  file.replace:\n+      - name: /etc/cloudera-scm-server/cm.settings\n+      - pattern: 'setsettings FRONTEND_URL.*'\n+      - repl: 'setsettings FRONTEND_URL https://{{ salt['pillar.get']('gateway:userfacingfqdn') }}/'\n+      - unless: grep \"^setsettings FRONTEND_URL https://{{ salt['pillar.get']('gateway:userfacingfqdn') }}/$\" /etc/cloudera-scm-server/cm.settings\n+\n+restart_cm_after_fronted_url_change:\n+  service.running:\n+    - name: cloudera-scm-server\n+    - enable: True", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjA3OTA3NA=="}, "originalCommit": {"oid": "7d95c51c71c0a2dcbeec5294d0f3be2304d41a23"}, "originalPosition": 22}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2332, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}