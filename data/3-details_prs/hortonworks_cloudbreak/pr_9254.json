{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA2OTU2NDQ3", "number": 9254, "title": "CB-9154: Add ssl root cert and ssl mode to backup and restore PGSQL settings.", "bodyText": "Check if a root cert exists on the instance.\n\nRun backup/restore with ssl-full, using the root cert if it's there.\nFallback to default behavior if the root cert is not present.\n\nTested by rsyncing salt scripts on to a datalake master node and manually running salt backup and restore commands.\n\nrsync salt scripts\nrsync rds root certs to /hadoopfs/fs1/database-cacerts/certs.pem\nupdate pillar values with ranger_admin_group and backup_location\nrun backup and restore:\n\nsalt $(hostname -f) state.apply postgresql.disaster_recovery.backup\nsalt $(hostname -f) state.apply postgresql.disaster_recovery.restore\nTested backup and restore when:\n\nRoot cert present\nRoot cert not present\n\nAnd when force_ssl rds option is 0 and 1 in AWS.", "createdAt": "2020-10-20T16:52:23Z", "url": "https://github.com/hortonworks/cloudbreak/pull/9254", "merged": true, "mergeCommit": {"oid": "1f0c915bb4b961d2df0a187c541dc7ed238421da"}, "closed": true, "closedAt": "2020-10-29T08:43:32Z", "author": {"login": "brycederriso"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdXC0HvABqjM5MzMwNTE1Mzc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdXGNsigFqTUxOTE1ODU2MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e247cac07957638479bba61eb57dec3b02fc7d0e", "author": {"user": {"login": "brycederriso", "name": "Bryce"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/e247cac07957638479bba61eb57dec3b02fc7d0e", "committedDate": "2020-10-20T16:48:31Z", "message": "CB-9154 Add ssl root cert and ssl mode to PGSQL settings."}, "afterCommit": {"oid": "d0aaa8c8fabe736174276c4478114f32642d669a", "author": {"user": {"login": "brycederriso", "name": "Bryce"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/d0aaa8c8fabe736174276c4478114f32642d669a", "committedDate": "2020-10-28T19:31:19Z", "message": "CB-9154 Add ssl root cert and ssl mode to PGSQL settings."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "21d3d6cecc5da37de95eb8dd9bc47c0388bba86a", "author": {"user": {"login": "brycederriso", "name": "Bryce"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/21d3d6cecc5da37de95eb8dd9bc47c0388bba86a", "committedDate": "2020-10-28T19:52:15Z", "message": "CB-9154 Add ssl root cert and ssl mode to PGSQL settings.\n\n* Check if root cert file exists.\n* Opt in to verify-full and provide the root cert if it does exist.\n* Follow default behavior if it doesn't."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d0aaa8c8fabe736174276c4478114f32642d669a", "author": {"user": {"login": "brycederriso", "name": "Bryce"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/d0aaa8c8fabe736174276c4478114f32642d669a", "committedDate": "2020-10-28T19:31:19Z", "message": "CB-9154 Add ssl root cert and ssl mode to PGSQL settings."}, "afterCommit": {"oid": "21d3d6cecc5da37de95eb8dd9bc47c0388bba86a", "author": {"user": {"login": "brycederriso", "name": "Bryce"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/21d3d6cecc5da37de95eb8dd9bc47c0388bba86a", "committedDate": "2020-10-28T19:52:15Z", "message": "CB-9154 Add ssl root cert and ssl mode to PGSQL settings.\n\n* Check if root cert file exists.\n* Opt in to verify-full and provide the root cert if it does exist.\n* Follow default behavior if it doesn't."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE5MDkyNjA5", "url": "https://github.com/hortonworks/cloudbreak/pull/9254#pullrequestreview-519092609", "createdAt": "2020-10-28T21:19:21Z", "commit": {"oid": "21d3d6cecc5da37de95eb8dd9bc47c0388bba86a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE5MTA2ODY4", "url": "https://github.com/hortonworks/cloudbreak/pull/9254#pullrequestreview-519106868", "createdAt": "2020-10-28T21:42:19Z", "commit": {"oid": "21d3d6cecc5da37de95eb8dd9bc47c0388bba86a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQyMTo0MjoxOVrOHp-l1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQyMTo0MjoxOVrOHp-l1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzc3OTE1OA==", "bodyText": "how about if we pass the folder /hadoopfs/fs1 down  in a pillar. In that case if somebody change the volume logic then we automatically get the right value.", "url": "https://github.com/hortonworks/cloudbreak/pull/9254#discussion_r513779158", "createdAt": "2020-10-28T21:42:19Z", "author": {"login": "doktoric"}, "path": "orchestrator-salt/src/main/resources/salt/salt/postgresql/disaster_recovery/scripts/backup_db.sh", "diffHunk": "@@ -29,6 +29,11 @@ RANGERGROUP=\"$5\"\n LOGFILE=${6:-/var/log/}/dl_postgres_backup.log\n echo \"Logs at ${LOGFILE}\"\n \n+if [[ -f /hadoopfs/fs1/database-cacerts/certs.pem ]]; then", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21d3d6cecc5da37de95eb8dd9bc47c0388bba86a"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c0c24d747041abd90a99357005c94d5192dd5a71", "author": {"user": {"login": "brycederriso", "name": "Bryce"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/c0c24d747041abd90a99357005c94d5192dd5a71", "committedDate": "2020-10-28T23:14:26Z", "message": "Look up root cert from pillar."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE5MTU4NTYx", "url": "https://github.com/hortonworks/cloudbreak/pull/9254#pullrequestreview-519158561", "createdAt": "2020-10-28T23:31:53Z", "commit": {"oid": "c0c24d747041abd90a99357005c94d5192dd5a71"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2033, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}