{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcwMjI4NDcx", "number": 7194, "title": "CB-5240 Refactor byName and byCrn methods in StackService, StackCommo\u2026", "bodyText": "For a description please see problem description at: #7128\nThis refactor contains changes only where resourceAccessDto was already used.\nMethods that still use String name or String crn need to be changed => a later refactorign step.", "createdAt": "2020-02-03T10:06:02Z", "url": "https://github.com/hortonworks/cloudbreak/pull/7194", "merged": true, "mergeCommit": {"oid": "91131b72b4e6386ec19fc3576450343c5fee8a03"}, "closed": true, "closedAt": "2020-02-19T10:27:34Z", "author": {"login": "gergopapi2"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcAwBmCABqjMwMDMwMjc5MDI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcFy-V1gBqjMwNTA4NzYyODk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "29b3a8037ac84baddb997722298d70dde5b29f36", "author": {"user": {"login": "gergopapi2", "name": "Gergely Papp"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/29b3a8037ac84baddb997722298d70dde5b29f36", "committedDate": "2020-02-03T10:03:27Z", "message": "CB-5240 Refactor byName and byCrn methods in StackService, StackCommonService, StackOperations"}, "afterCommit": {"oid": "8c0453a33d44769f6c653fa7b79562a96fa80863", "author": {"user": {"login": "gergopapi2", "name": "Gergely Papp"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/8c0453a33d44769f6c653fa7b79562a96fa80863", "committedDate": "2020-02-03T17:02:50Z", "message": "CB-5240 Refactor byName and byCrn methods in StackService, StackCommonService, StackOperations"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1NzQ3MzAy", "url": "https://github.com/hortonworks/cloudbreak/pull/7194#pullrequestreview-355747302", "createdAt": "2020-02-10T08:14:05Z", "commit": {"oid": "8c0453a33d44769f6c653fa7b79562a96fa80863"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQwODoxNDowNVrOFnc-_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMFQwODoxNDowNVrOFnc-_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjkxMzY2Mw==", "bodyText": "Please rename the param name to crn.", "url": "https://github.com/hortonworks/cloudbreak/pull/7194#discussion_r376913663", "createdAt": "2020-02-10T08:14:05Z", "author": {"login": "foldik"}, "path": "core/src/main/java/com/sequenceiq/cloudbreak/repository/StackRepository.java", "diffHunk": "@@ -207,6 +207,10 @@\n     @Query(\"SELECT s.id FROM Stack s WHERE s.name= :name AND s.workspace.id= :workspaceId AND s.terminated = null\")\n     Optional<Long> findIdByNameAndWorkspaceId(@Param(\"name\") String name, @Param(\"workspaceId\") Long workspaceId);\n \n+    @DisableCheckPermissions\n+    @Query(\"SELECT s.id FROM Stack s WHERE s.resourceCrn= :crn AND s.workspace.id= :workspaceId AND s.terminated = null\")\n+    Optional<Long> findIdByCrnAndWorkspaceId(@Param(\"crn\") String name, @Param(\"workspaceId\") Long workspaceId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c0453a33d44769f6c653fa7b79562a96fa80863"}, "originalPosition": 6}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8c0453a33d44769f6c653fa7b79562a96fa80863", "author": {"user": {"login": "gergopapi2", "name": "Gergely Papp"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/8c0453a33d44769f6c653fa7b79562a96fa80863", "committedDate": "2020-02-03T17:02:50Z", "message": "CB-5240 Refactor byName and byCrn methods in StackService, StackCommonService, StackOperations"}, "afterCommit": {"oid": "486d73376755c1a72d77f84271da1301a6aa6d66", "author": {"user": {"login": "gergopapi2", "name": "Gergely Papp"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/486d73376755c1a72d77f84271da1301a6aa6d66", "committedDate": "2020-02-10T10:58:11Z", "message": "CB-5240 Refactor byName and byCrn methods in StackService, StackCommonService, StackOperations"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "486d73376755c1a72d77f84271da1301a6aa6d66", "author": {"user": {"login": "gergopapi2", "name": "Gergely Papp"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/486d73376755c1a72d77f84271da1301a6aa6d66", "committedDate": "2020-02-10T10:58:11Z", "message": "CB-5240 Refactor byName and byCrn methods in StackService, StackCommonService, StackOperations"}, "afterCommit": {"oid": "e1643bf58f6be5d7ce11dc9e04b886f4be7d5a4f", "author": {"user": {"login": "gergopapi2", "name": "Gergely Papp"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/e1643bf58f6be5d7ce11dc9e04b886f4be7d5a4f", "committedDate": "2020-02-10T15:39:45Z", "message": "CB-5240 Refactor byName and byCrn methods in StackService, StackCommonService, StackOperations"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e1643bf58f6be5d7ce11dc9e04b886f4be7d5a4f", "author": {"user": {"login": "gergopapi2", "name": "Gergely Papp"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/e1643bf58f6be5d7ce11dc9e04b886f4be7d5a4f", "committedDate": "2020-02-10T15:39:45Z", "message": "CB-5240 Refactor byName and byCrn methods in StackService, StackCommonService, StackOperations"}, "afterCommit": {"oid": "d7c7c6cee2609db06bf2f3fe6afb484761f65774", "author": {"user": {"login": "gergopapi2", "name": "Gergely Papp"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/d7c7c6cee2609db06bf2f3fe6afb484761f65774", "committedDate": "2020-02-12T12:23:24Z", "message": "CB-5240 Refactor byName and byCrn methods in StackService, StackCommonService, StackOperations"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU3NDUzODU4", "url": "https://github.com/hortonworks/cloudbreak/pull/7194#pullrequestreview-357453858", "createdAt": "2020-02-12T13:35:21Z", "commit": {"oid": "d7c7c6cee2609db06bf2f3fe6afb484761f65774"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU3NDU2MTcy", "url": "https://github.com/hortonworks/cloudbreak/pull/7194#pullrequestreview-357456172", "createdAt": "2020-02-12T13:38:33Z", "commit": {"oid": "d7c7c6cee2609db06bf2f3fe6afb484761f65774"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQxMzozODozM1rOFou0kg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMlQxMzozODozM1rOFou0kg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODI1NDQ4Mg==", "bodyText": "small thing: why are you using toString here instead of name?", "url": "https://github.com/hortonworks/cloudbreak/pull/7194#discussion_r378254482", "createdAt": "2020-02-12T13:38:33Z", "author": {"login": "horadla23"}, "path": "core/src/main/java/com/sequenceiq/cloudbreak/service/upgrade/UpgradeService.java", "diffHunk": "@@ -74,18 +75,18 @@\n     @Inject\n     private TransactionService transactionService;\n \n-    public UpgradeOptionV4Response getUpgradeOptionByStackName(Long workspaceId, String stackName, User user) {\n+    public UpgradeOptionV4Response getUpgradeOptionByStackNameOrCrn(Long workspaceId, NameOrCrn nameOrCrn, User user) {\n         try {\n             return transactionService.required(() -> {\n-                Optional<Stack> stack = stackService.findStackByNameAndWorkspaceId(stackName, workspaceId);\n+                Optional<Stack> stack = stackService.findStackByNameOrCrnAndWorkspaceId(nameOrCrn, workspaceId);\n                 if (stack.isPresent()) {\n                     try {\n                         return getUpgradeOption(stack.get(), workspaceId, user);\n                     } catch (CloudbreakImageNotFoundException | CloudbreakImageCatalogException e) {\n                         throw new BadRequestException(e.getMessage());\n                     }\n                 } else {\n-                    throw notFoundException(\"Stack\", stackName);\n+                    throw notFoundException(\"Stack\", nameOrCrn.toString());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d7c7c6cee2609db06bf2f3fe6afb484761f65774"}, "originalPosition": 26}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d7c7c6cee2609db06bf2f3fe6afb484761f65774", "author": {"user": {"login": "gergopapi2", "name": "Gergely Papp"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/d7c7c6cee2609db06bf2f3fe6afb484761f65774", "committedDate": "2020-02-12T12:23:24Z", "message": "CB-5240 Refactor byName and byCrn methods in StackService, StackCommonService, StackOperations"}, "afterCommit": {"oid": "cdb494ea7cfbbd23d1c49d136e33b3b365bc95a9", "author": {"user": {"login": "gergopapi2", "name": "Gergely Papp"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/cdb494ea7cfbbd23d1c49d136e33b3b365bc95a9", "committedDate": "2020-02-14T10:57:14Z", "message": "CB-5240 Refactor byName and byCrn methods in StackService, StackCommonService, StackOperations"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5MDczOTc0", "url": "https://github.com/hortonworks/cloudbreak/pull/7194#pullrequestreview-359073974", "createdAt": "2020-02-14T16:42:38Z", "commit": {"oid": "cdb494ea7cfbbd23d1c49d136e33b3b365bc95a9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "77a0d341a7ee1c25a9477d8858ebe2ed2113c423", "author": {"user": {"login": "gergopapi2", "name": "Gergely Papp"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/77a0d341a7ee1c25a9477d8858ebe2ed2113c423", "committedDate": "2020-02-19T09:18:38Z", "message": "CB-5240 Refactor byName and byCrn methods in StackService, StackCommonService, StackOperations"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cdb494ea7cfbbd23d1c49d136e33b3b365bc95a9", "author": {"user": {"login": "gergopapi2", "name": "Gergely Papp"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/cdb494ea7cfbbd23d1c49d136e33b3b365bc95a9", "committedDate": "2020-02-14T10:57:14Z", "message": "CB-5240 Refactor byName and byCrn methods in StackService, StackCommonService, StackOperations"}, "afterCommit": {"oid": "77a0d341a7ee1c25a9477d8858ebe2ed2113c423", "author": {"user": {"login": "gergopapi2", "name": "Gergely Papp"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/77a0d341a7ee1c25a9477d8858ebe2ed2113c423", "committedDate": "2020-02-19T09:18:38Z", "message": "CB-5240 Refactor byName and byCrn methods in StackService, StackCommonService, StackOperations"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1936, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}