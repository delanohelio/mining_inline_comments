{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY0MDA5MTAw", "number": 8737, "title": "DISTX-528 Periscope API Resource Based Authorizations.", "bodyText": "Periscope endpoints updated to use resource based UMS authorization.\nPeriscope API are authorized for AuthorizationResourceAction.SCALE_DATAHUB\nAuthorization annotation check enabled in periscope.\nUnused DB-Id based AlertEndpoint removed.\n\nSee detailed description in the commit message.", "createdAt": "2020-08-06T12:54:57Z", "url": "https://github.com/hortonworks/cloudbreak/pull/8737", "merged": true, "mergeCommit": {"oid": "4ddc625aa4a42edb00a238561eb5746ea80dc88f"}, "closed": true, "closedAt": "2020-08-09T13:37:42Z", "author": {"login": "smaniraju"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc8PzdHgFqTQ2MjUxNTU3Ng==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc8oEPDAFqTQ2MjkxNzMwNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyNTE1NTc2", "url": "https://github.com/hortonworks/cloudbreak/pull/8737#pullrequestreview-462515576", "createdAt": "2020-08-06T13:26:19Z", "commit": {"oid": "55f975481b3c241f8ec438afc60df37d5524c7d3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxMzoyNjoxOVrOG8zbDQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxMzoyNjoxOVrOG8zbDQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjQxMDI1Mw==", "bodyText": "getClusters for tenant with Autoscaling Configured  is still an AccountLevel Permission Check.", "url": "https://github.com/hortonworks/cloudbreak/pull/8737#discussion_r466410253", "createdAt": "2020-08-06T13:26:19Z", "author": {"login": "smaniraju"}, "path": "autoscale/src/main/java/com/sequenceiq/periscope/controller/DistroXAutoScaleClusterV1Controller.java", "diffHunk": "@@ -58,91 +66,102 @@\n     @Inject\n     private CloudbreakMessagesService messagesService;\n \n+    @Inject\n+    private TimeAlertRequestConverter timeAlertRequestConverter;\n+\n+    @Inject\n+    private LoadAlertRequestConverter loadAlertRequestConverter;\n+\n+    @Inject\n+    private EntitlementValidationService entitlementValidationService;\n+\n     @Override\n-    @CheckPermissionByAccount(action = AuthorizationResourceAction.DATAHUB_READ)\n+    @CheckPermissionByAccount(action = AuthorizationResourceAction.SCALE_DATAHUB)\n     public List<DistroXAutoscaleClusterResponse> getClusters() {\n         return distroXAutoscaleClusterResponseConverter.convertAllToJson(asClusterCommonService.getDistroXClusters());\n     }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "55f975481b3c241f8ec438afc60df37d5524c7d3"}, "originalPosition": 54}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYzMTE1NTEw", "url": "https://github.com/hortonworks/cloudbreak/pull/8737#pullrequestreview-463115510", "createdAt": "2020-08-07T08:06:22Z", "commit": {"oid": "55f975481b3c241f8ec438afc60df37d5524c7d3"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QwODowNjoyMlrOG9Qlrg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QwODoxMzo0NFrOG9QzHA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njg4ODExMA==", "bodyText": "I think this should be changed to @InternalOnly to ensure that noone will call this", "url": "https://github.com/hortonworks/cloudbreak/pull/8737#discussion_r466888110", "createdAt": "2020-08-07T08:06:22Z", "author": {"login": "horadla23"}, "path": "autoscale/src/main/java/com/sequenceiq/periscope/controller/AutoScaleClusterV2Controller.java", "diffHunk": "@@ -17,7 +18,8 @@\n /**\n  * @deprecated Database ID based endpoints are deprecated for removal.\n  */\n-@Component\n+@Controller\n+@DisableCheckPermissions", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "55f975481b3c241f8ec438afc60df37d5524c7d3"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Njg5MTU0OA==", "bodyText": "i think scaledatahub right will be present only in resource roles, so it wont work with account level, so this will work only with poweruser, so it is better to change this @DisabledCheckPermissions since we decided to disable authz on list for now, right @lnardai ?", "url": "https://github.com/hortonworks/cloudbreak/pull/8737#discussion_r466891548", "createdAt": "2020-08-07T08:13:44Z", "author": {"login": "horadla23"}, "path": "autoscale/src/main/java/com/sequenceiq/periscope/controller/DistroXAutoScaleClusterV1Controller.java", "diffHunk": "@@ -58,91 +66,102 @@\n     @Inject\n     private CloudbreakMessagesService messagesService;\n \n+    @Inject\n+    private TimeAlertRequestConverter timeAlertRequestConverter;\n+\n+    @Inject\n+    private LoadAlertRequestConverter loadAlertRequestConverter;\n+\n+    @Inject\n+    private EntitlementValidationService entitlementValidationService;\n+\n     @Override\n-    @CheckPermissionByAccount(action = AuthorizationResourceAction.DATAHUB_READ)\n+    @CheckPermissionByAccount(action = AuthorizationResourceAction.SCALE_DATAHUB)\n     public List<DistroXAutoscaleClusterResponse> getClusters() {\n         return distroXAutoscaleClusterResponseConverter.convertAllToJson(asClusterCommonService.getDistroXClusters());\n     }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjQxMDI1Mw=="}, "originalCommit": {"oid": "55f975481b3c241f8ec438afc60df37d5524c7d3"}, "originalPosition": 54}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "55f975481b3c241f8ec438afc60df37d5524c7d3", "author": {"user": {"login": "smaniraju", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/55f975481b3c241f8ec438afc60df37d5524c7d3", "committedDate": "2020-08-06T07:51:47Z", "message": "DISTX-528 Periscope API Resource Based Authorizations.\n\n1. Periscope endpoints updated to use resource based UMS authorization.\n2. Periscope API are authroized for AuthorizationResourceAction.SCALE_DATAHUB\n3. Authorization annotation check enabled in periscope.\n4. Unused DB-Id based AlertEndpoint removed."}, "afterCommit": {"oid": "02bb8b913d98df9701113d801c04e6f351f7daec", "author": {"user": {"login": "smaniraju", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/02bb8b913d98df9701113d801c04e6f351f7daec", "committedDate": "2020-08-07T09:55:43Z", "message": "DISTX-528 Periscope API Resource Based Authorizations.\n\n1. Periscope endpoints updated to use resource based UMS authorization.\n2. Periscope API are authroized for AuthorizationResourceAction.SCALE_DATAHUB\n3. Authorization annotation check enabled in periscope.\n4. Unused DB-Id based AlertEndpoint removed."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4f5f1bb310d0c2d4246763b051a5d3164b376073", "author": {"user": {"login": "smaniraju", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/4f5f1bb310d0c2d4246763b051a5d3164b376073", "committedDate": "2020-08-07T11:03:25Z", "message": "DISTX-528 Periscope API Resource Based Authorizations.\n\n1. Periscope endpoints updated to use resource based UMS authorization.\n2. Periscope API are authroized for AuthorizationResourceAction.SCALE_DATAHUB\n3. Authorization annotation check enabled in periscope.\n4. Unused DB-Id based AlertEndpoint removed."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "02bb8b913d98df9701113d801c04e6f351f7daec", "author": {"user": {"login": "smaniraju", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/02bb8b913d98df9701113d801c04e6f351f7daec", "committedDate": "2020-08-07T09:55:43Z", "message": "DISTX-528 Periscope API Resource Based Authorizations.\n\n1. Periscope endpoints updated to use resource based UMS authorization.\n2. Periscope API are authroized for AuthorizationResourceAction.SCALE_DATAHUB\n3. Authorization annotation check enabled in periscope.\n4. Unused DB-Id based AlertEndpoint removed."}, "afterCommit": {"oid": "4f5f1bb310d0c2d4246763b051a5d3164b376073", "author": {"user": {"login": "smaniraju", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/4f5f1bb310d0c2d4246763b051a5d3164b376073", "committedDate": "2020-08-07T11:03:25Z", "message": "DISTX-528 Periscope API Resource Based Authorizations.\n\n1. Periscope endpoints updated to use resource based UMS authorization.\n2. Periscope API are authroized for AuthorizationResourceAction.SCALE_DATAHUB\n3. Authorization annotation check enabled in periscope.\n4. Unused DB-Id based AlertEndpoint removed."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYzMjMyNjE5", "url": "https://github.com/hortonworks/cloudbreak/pull/8737#pullrequestreview-463232619", "createdAt": "2020-08-07T11:17:56Z", "commit": {"oid": "4f5f1bb310d0c2d4246763b051a5d3164b376073"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyOTE3MzA0", "url": "https://github.com/hortonworks/cloudbreak/pull/8737#pullrequestreview-462917304", "createdAt": "2020-08-06T22:26:52Z", "commit": {"oid": "55f975481b3c241f8ec438afc60df37d5524c7d3"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMjoyNjo1M1rOG9GQfw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQyMjoyNjo1M1rOG9GQfw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjcxODg0Nw==", "bodyText": "This is interesting. Wondering, if in the future, we can have list* calls give back a list of resources to which the user has READ/WRITE access.\ni.e. instead of listing all entities (clusters in this case) belonging to an environment - list clusters on which this particular user can either READ the autoscaling rules or CREATE autoscaling rules.\ncc @lnardai\nDistroXV1Controller in CB-core seems disable permission checking for list(envName, envCrn) - so presumably that allows a user with access to the tenant to see all other running clusters.", "url": "https://github.com/hortonworks/cloudbreak/pull/8737#discussion_r466718847", "createdAt": "2020-08-06T22:26:53Z", "author": {"login": "sidseth"}, "path": "autoscale/src/main/java/com/sequenceiq/periscope/controller/DistroXAutoScaleClusterV1Controller.java", "diffHunk": "@@ -58,91 +66,102 @@\n     @Inject\n     private CloudbreakMessagesService messagesService;\n \n+    @Inject\n+    private TimeAlertRequestConverter timeAlertRequestConverter;\n+\n+    @Inject\n+    private LoadAlertRequestConverter loadAlertRequestConverter;\n+\n+    @Inject\n+    private EntitlementValidationService entitlementValidationService;\n+\n     @Override\n-    @CheckPermissionByAccount(action = AuthorizationResourceAction.DATAHUB_READ)\n+    @CheckPermissionByAccount(action = AuthorizationResourceAction.SCALE_DATAHUB)\n     public List<DistroXAutoscaleClusterResponse> getClusters() {\n         return distroXAutoscaleClusterResponseConverter.convertAllToJson(asClusterCommonService.getDistroXClusters());\n     }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjQxMDI1Mw=="}, "originalCommit": {"oid": "55f975481b3c241f8ec438afc60df37d5524c7d3"}, "originalPosition": 54}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2565, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}