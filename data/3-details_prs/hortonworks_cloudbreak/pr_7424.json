{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgxNDAzNTIz", "number": 7424, "title": "CB-5067 Create external database for DistroX clusters", "bodyText": "", "createdAt": "2020-02-28T13:57:40Z", "url": "https://github.com/hortonworks/cloudbreak/pull/7424", "merged": true, "mergeCommit": {"oid": "75341a4ccae88235beb652b4e51ba8cc5b131152"}, "closed": true, "closedAt": "2020-03-03T11:44:48Z", "author": {"login": "bergerdenes"}, "timelineItems": {"totalCount": 19, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcIwc0kAFqTM2NjQxODE2NQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcKA2KUgFqTM2NzkxMDU2Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2NDE4MTY1", "url": "https://github.com/hortonworks/cloudbreak/pull/7424#pullrequestreview-366418165", "createdAt": "2020-02-28T14:04:24Z", "commit": {"oid": "2d2dbf88df51d4eb753a45458518167ce02595ad"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQxNDowNDoyNFrOFv1_Iw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQxNDowNDoyNFrOFv1_Iw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTcxMTkwNw==", "bodyText": "external.database ?", "url": "https://github.com/hortonworks/cloudbreak/pull/7424#discussion_r385711907", "createdAt": "2020-02-28T14:04:24Z", "author": {"login": "doktoric"}, "path": "common/src/main/resources/messages/messages.properties", "diffHunk": "@@ -122,6 +122,14 @@ cluster.gateway.change=Starting primary gateway change\n cluster.gateway.changed.successfully=Primary gateway successfully changed to {0}\n cluster.gateway.change.failed=Primary gateway change failed. Reason: {0}\n cluster.ambari.cluster.decommissioning.time=The decommission of the Data nodes will take approximately {0}.\n+\n+cluster.externaldatabase.deletion.started=External database termination started.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d2dbf88df51d4eb753a45458518167ce02595ad"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2NDIwMDgx", "url": "https://github.com/hortonworks/cloudbreak/pull/7424#pullrequestreview-366420081", "createdAt": "2020-02-28T14:07:11Z", "commit": {"oid": "2d2dbf88df51d4eb753a45458518167ce02595ad"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQxNDowNzoxMVrOFv2EzQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQxNDowNzoxMVrOFv2EzQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTcxMzM1Nw==", "bodyText": "is this a tottaly new class for datalake db ?", "url": "https://github.com/hortonworks/cloudbreak/pull/7424#discussion_r385713357", "createdAt": "2020-02-28T14:07:11Z", "author": {"login": "doktoric"}, "path": "core/src/main/java/com/sequenceiq/cloudbreak/conf/ExternalDatabaseConfig.java", "diffHunk": "@@ -0,0 +1,97 @@\n+package com.sequenceiq.cloudbreak.conf;\n+\n+import java.io.IOException;\n+import java.util.HashSet;\n+import java.util.Locale;\n+import java.util.Map;\n+import java.util.Optional;\n+import java.util.Set;\n+\n+import javax.annotation.PostConstruct;\n+import javax.inject.Inject;\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.annotation.Value;\n+import org.springframework.context.annotation.Bean;\n+import org.springframework.context.annotation.Configuration;\n+\n+import com.google.common.collect.ImmutableMap;\n+import com.sequenceiq.cloudbreak.common.json.JsonUtil;\n+import com.sequenceiq.cloudbreak.common.mappable.CloudPlatform;\n+import com.sequenceiq.cloudbreak.service.externaldatabase.DatabaseServerParameterSetter;\n+import com.sequenceiq.cloudbreak.service.externaldatabase.model.DatabaseStackConfig;\n+import com.sequenceiq.cloudbreak.util.FileReaderUtils;\n+\n+@Configuration\n+public class ExternalDatabaseConfig {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(ExternalDatabaseConfig.class);\n+\n+    @Value(\"${datalake.supported.externaldb.platform:AWS}\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d2dbf88df51d4eb753a45458518167ce02595ad"}, "originalPosition": 31}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2NDIwNzM5", "url": "https://github.com/hortonworks/cloudbreak/pull/7424#pullrequestreview-366420739", "createdAt": "2020-02-28T14:08:07Z", "commit": {"oid": "2d2dbf88df51d4eb753a45458518167ce02595ad"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQxNDowODowN1rOFv2GmA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQxNDowODowN1rOFv2GmA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTcxMzgxNg==", "bodyText": "for cluster -> for Data Hub", "url": "https://github.com/hortonworks/cloudbreak/pull/7424#discussion_r385713816", "createdAt": "2020-02-28T14:08:07Z", "author": {"login": "doktoric"}, "path": "core/src/main/java/com/sequenceiq/cloudbreak/core/flow2/externaldatabase/ExternalDatabaseService.java", "diffHunk": "@@ -0,0 +1,160 @@\n+package com.sequenceiq.cloudbreak.core.flow2.externaldatabase;\n+\n+import java.util.Locale;\n+import java.util.Map;\n+import java.util.concurrent.TimeUnit;\n+\n+import javax.ws.rs.BadRequestException;\n+import javax.ws.rs.NotFoundException;\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.stereotype.Service;\n+\n+import com.dyngr.Polling;\n+import com.dyngr.core.AttemptResults;\n+import com.sequenceiq.cloudbreak.api.endpoint.v4.stacks.request.database.DatabaseAvailabilityType;\n+import com.sequenceiq.cloudbreak.cloud.scheduler.PollGroup;\n+import com.sequenceiq.cloudbreak.cloud.store.InMemoryStateStore;\n+import com.sequenceiq.cloudbreak.common.json.JsonUtil;\n+import com.sequenceiq.cloudbreak.common.mappable.CloudPlatform;\n+import com.sequenceiq.cloudbreak.domain.stack.cluster.Cluster;\n+import com.sequenceiq.cloudbreak.repository.cluster.ClusterRepository;\n+import com.sequenceiq.cloudbreak.service.externaldatabase.DatabaseOperation;\n+import com.sequenceiq.cloudbreak.service.externaldatabase.DatabaseServerParameterSetter;\n+import com.sequenceiq.cloudbreak.service.externaldatabase.PollingConfig;\n+import com.sequenceiq.cloudbreak.service.externaldatabase.model.DatabaseServerParameter;\n+import com.sequenceiq.cloudbreak.service.externaldatabase.model.DatabaseStackConfig;\n+import com.sequenceiq.cloudbreak.service.rdsconfig.RedbeamsClientService;\n+import com.sequenceiq.environment.api.v1.environment.model.response.DetailedEnvironmentResponse;\n+import com.sequenceiq.redbeams.api.endpoint.v4.databaseserver.requests.AllocateDatabaseServerV4Request;\n+import com.sequenceiq.redbeams.api.endpoint.v4.databaseserver.responses.DatabaseServerV4Response;\n+import com.sequenceiq.redbeams.api.endpoint.v4.stacks.DatabaseServerV4StackRequest;\n+\n+@Service\n+public class ExternalDatabaseService {\n+\n+    public static final int SLEEP_TIME_IN_SEC_FOR_DB_POLLING = 10;\n+\n+    public static final int DURATION_IN_MINUTES_FOR_DB_POLLING = 60;\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(ExternalDatabaseService.class);\n+\n+    private final RedbeamsClientService redbeamsClient;\n+\n+    private final ClusterRepository clusterRepository;\n+\n+    private final  Map<CloudPlatform, DatabaseStackConfig> dbConfigs;\n+\n+    private final Map<CloudPlatform, DatabaseServerParameterSetter> databaseServerParameterSetterMap;\n+\n+    public ExternalDatabaseService(RedbeamsClientService redbeamsClient, ClusterRepository clusterRepository,\n+            Map<CloudPlatform, DatabaseStackConfig> dbConfigs, Map<CloudPlatform, DatabaseServerParameterSetter> databaseServerParameterSetterMap) {\n+        this.redbeamsClient = redbeamsClient;\n+        this.clusterRepository = clusterRepository;\n+        this.dbConfigs = dbConfigs;\n+        this.databaseServerParameterSetterMap = databaseServerParameterSetterMap;\n+    }\n+\n+    public void provisionDatabase(Cluster cluster, DatabaseAvailabilityType externalDatabase, DetailedEnvironmentResponse environment) {\n+        LOGGER.info(\"Create external {} database server in environment {} for cluster {}\", externalDatabase.name(), environment.getName(), cluster.getName());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d2dbf88df51d4eb753a45458518167ce02595ad"}, "originalPosition": 60}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2NDIwODk1", "url": "https://github.com/hortonworks/cloudbreak/pull/7424#pullrequestreview-366420895", "createdAt": "2020-02-28T14:08:20Z", "commit": {"oid": "2d2dbf88df51d4eb753a45458518167ce02595ad"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQxNDowODoyMFrOFv2HCw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQxNDowODoyMFrOFv2HCw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTcxMzkzMQ==", "bodyText": "for Data Hub", "url": "https://github.com/hortonworks/cloudbreak/pull/7424#discussion_r385713931", "createdAt": "2020-02-28T14:08:20Z", "author": {"login": "doktoric"}, "path": "core/src/main/java/com/sequenceiq/cloudbreak/core/flow2/externaldatabase/ExternalDatabaseService.java", "diffHunk": "@@ -0,0 +1,160 @@\n+package com.sequenceiq.cloudbreak.core.flow2.externaldatabase;\n+\n+import java.util.Locale;\n+import java.util.Map;\n+import java.util.concurrent.TimeUnit;\n+\n+import javax.ws.rs.BadRequestException;\n+import javax.ws.rs.NotFoundException;\n+\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.stereotype.Service;\n+\n+import com.dyngr.Polling;\n+import com.dyngr.core.AttemptResults;\n+import com.sequenceiq.cloudbreak.api.endpoint.v4.stacks.request.database.DatabaseAvailabilityType;\n+import com.sequenceiq.cloudbreak.cloud.scheduler.PollGroup;\n+import com.sequenceiq.cloudbreak.cloud.store.InMemoryStateStore;\n+import com.sequenceiq.cloudbreak.common.json.JsonUtil;\n+import com.sequenceiq.cloudbreak.common.mappable.CloudPlatform;\n+import com.sequenceiq.cloudbreak.domain.stack.cluster.Cluster;\n+import com.sequenceiq.cloudbreak.repository.cluster.ClusterRepository;\n+import com.sequenceiq.cloudbreak.service.externaldatabase.DatabaseOperation;\n+import com.sequenceiq.cloudbreak.service.externaldatabase.DatabaseServerParameterSetter;\n+import com.sequenceiq.cloudbreak.service.externaldatabase.PollingConfig;\n+import com.sequenceiq.cloudbreak.service.externaldatabase.model.DatabaseServerParameter;\n+import com.sequenceiq.cloudbreak.service.externaldatabase.model.DatabaseStackConfig;\n+import com.sequenceiq.cloudbreak.service.rdsconfig.RedbeamsClientService;\n+import com.sequenceiq.environment.api.v1.environment.model.response.DetailedEnvironmentResponse;\n+import com.sequenceiq.redbeams.api.endpoint.v4.databaseserver.requests.AllocateDatabaseServerV4Request;\n+import com.sequenceiq.redbeams.api.endpoint.v4.databaseserver.responses.DatabaseServerV4Response;\n+import com.sequenceiq.redbeams.api.endpoint.v4.stacks.DatabaseServerV4StackRequest;\n+\n+@Service\n+public class ExternalDatabaseService {\n+\n+    public static final int SLEEP_TIME_IN_SEC_FOR_DB_POLLING = 10;\n+\n+    public static final int DURATION_IN_MINUTES_FOR_DB_POLLING = 60;\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(ExternalDatabaseService.class);\n+\n+    private final RedbeamsClientService redbeamsClient;\n+\n+    private final ClusterRepository clusterRepository;\n+\n+    private final  Map<CloudPlatform, DatabaseStackConfig> dbConfigs;\n+\n+    private final Map<CloudPlatform, DatabaseServerParameterSetter> databaseServerParameterSetterMap;\n+\n+    public ExternalDatabaseService(RedbeamsClientService redbeamsClient, ClusterRepository clusterRepository,\n+            Map<CloudPlatform, DatabaseStackConfig> dbConfigs, Map<CloudPlatform, DatabaseServerParameterSetter> databaseServerParameterSetterMap) {\n+        this.redbeamsClient = redbeamsClient;\n+        this.clusterRepository = clusterRepository;\n+        this.dbConfigs = dbConfigs;\n+        this.databaseServerParameterSetterMap = databaseServerParameterSetterMap;\n+    }\n+\n+    public void provisionDatabase(Cluster cluster, DatabaseAvailabilityType externalDatabase, DetailedEnvironmentResponse environment) {\n+        LOGGER.info(\"Create external {} database server in environment {} for cluster {}\", externalDatabase.name(), environment.getName(), cluster.getName());\n+        AllocateDatabaseServerV4Request request = getDatabaseRequest(environment, externalDatabase);\n+        String databaseCrn;\n+        try {\n+            databaseCrn = redbeamsClient.create(request).getResourceCrn();\n+            updateClusterWithDatabaseServerCrn(cluster, databaseCrn);\n+        } catch (BadRequestException badRequestException) {\n+            LOGGER.error(\"Redbeams create request failed, bad request\", badRequestException);\n+            throw badRequestException;\n+        }\n+        waitAndGetDatabase(cluster, databaseCrn, DatabaseOperation.CREATION, true);\n+\n+    }\n+\n+    public void terminateDatabase(Cluster cluster, DatabaseAvailabilityType externalDatabase, DetailedEnvironmentResponse environment, boolean forced) {\n+        LOGGER.info(\"Terminate external {} database server in environment {} for cluster {}\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d2dbf88df51d4eb753a45458518167ce02595ad"}, "originalPosition": 75}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2NDYwOTUw", "url": "https://github.com/hortonworks/cloudbreak/pull/7424#pullrequestreview-366460950", "createdAt": "2020-02-28T15:03:03Z", "commit": {"oid": "2d2dbf88df51d4eb753a45458518167ce02595ad"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2NDYxMjA5", "url": "https://github.com/hortonworks/cloudbreak/pull/7424#pullrequestreview-366461209", "createdAt": "2020-02-28T15:03:26Z", "commit": {"oid": "2d2dbf88df51d4eb753a45458518167ce02595ad"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQxNTowMzoyNlrOFv385w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQxNTowMzoyNlrOFv385w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc0NDEwMw==", "bodyText": "?", "url": "https://github.com/hortonworks/cloudbreak/pull/7424#discussion_r385744103", "createdAt": "2020-02-28T15:03:26Z", "author": {"login": "doktoric"}, "path": "core/src/main/java/com/sequenceiq/cloudbreak/core/flow2/externaldatabase/provision/ExternalDatabaseCreationActions.java", "diffHunk": "@@ -0,0 +1,97 @@\n+package com.sequenceiq.cloudbreak.core.flow2.externaldatabase.provision;\n+\n+import java.util.Map;\n+\n+import javax.inject.Inject;\n+\n+import org.springframework.context.annotation.Bean;\n+import org.springframework.context.annotation.Configuration;\n+import org.springframework.statemachine.StateContext;\n+import org.springframework.statemachine.action.Action;\n+\n+import com.sequenceiq.cloudbreak.api.endpoint.v4.common.DetailedStackStatus;\n+import com.sequenceiq.cloudbreak.common.event.Selectable;\n+import com.sequenceiq.cloudbreak.core.flow2.externaldatabase.ExternalDatabaseContext;\n+import com.sequenceiq.cloudbreak.core.flow2.externaldatabase.StackUpdaterService;\n+import com.sequenceiq.cloudbreak.core.flow2.externaldatabase.provision.action.AbstractExternalDatabaseCreationAction;\n+import com.sequenceiq.cloudbreak.core.flow2.externaldatabase.provision.config.ExternalDatabaseCreationEvent;\n+import com.sequenceiq.cloudbreak.core.flow2.externaldatabase.provision.config.ExternalDatabaseCreationState;\n+import com.sequenceiq.cloudbreak.core.flow2.stack.provision.StackCreationEvent;\n+import com.sequenceiq.cloudbreak.domain.stack.Stack;\n+import com.sequenceiq.cloudbreak.event.ResourceEvent;\n+import com.sequenceiq.cloudbreak.reactor.api.event.StackEvent;\n+import com.sequenceiq.cloudbreak.reactor.api.event.externaldatabase.CreateExternalDatabaseFailed;\n+import com.sequenceiq.cloudbreak.reactor.api.event.externaldatabase.CreateExternalDatabaseRequest;\n+import com.sequenceiq.cloudbreak.reactor.api.event.externaldatabase.CreateExternalDatabaseResult;\n+import com.sequenceiq.cloudbreak.service.metrics.MetricType;\n+import com.sequenceiq.flow.core.Flow;\n+import com.sequenceiq.flow.core.FlowParameters;\n+\n+@Configuration\n+public class ExternalDatabaseCreationActions {\n+\n+    @Inject\n+    private StackUpdaterService stackUpdaterService;\n+\n+    @Bean(name = \"WAIT_FOR_EXTERNAL_DATABASE_STATE\")\n+    public Action<?, ?> externalDatabaseCreation() {\n+        return new AbstractExternalDatabaseCreationAction<>(StackEvent.class) {\n+            @Override\n+            protected void doExecute(ExternalDatabaseContext context, StackEvent payload, Map<Object, Object> variables) {\n+                sendEvent(context);\n+            }\n+\n+            @Override\n+            protected Selectable createRequest(ExternalDatabaseContext context) {\n+                Stack stack = context.getStack();\n+                return new CreateExternalDatabaseRequest(stack.getId(), \"CreateExternalDatabaseRequest\", stack.getName(), stack.getResourceCrn(), stack);\n+            }\n+        };\n+    }\n+\n+    @Bean(name = \"EXTERNAL_DATABASE_CREATION_FINISHED_STATE\")\n+    public Action<?, ?> externalDatabaseCreationFinishedAction() {\n+        return new AbstractExternalDatabaseCreationAction<>(CreateExternalDatabaseResult.class) {\n+            @Override\n+            protected void doExecute(ExternalDatabaseContext context, CreateExternalDatabaseResult payload, Map<Object, Object> variables) {\n+                getMetricService().incrementMetricCounter(MetricType.EXTERNAL_DATABASE_CREATION_SUCCESSFUL, context.getStack());\n+                sendEvent(context);\n+            }\n+\n+            @Override\n+            protected Selectable createRequest(ExternalDatabaseContext context) {\n+                return new StackEvent(ExternalDatabaseCreationEvent.EXTERNAL_DATABASE_CREATION_FINISHED_EVENT.event(), context.getStack().getId());\n+            }\n+        };\n+    }\n+\n+    @Bean(name = \"EXTERNAL_DATABASE_CREATION_FAILED_STATE\")\n+    public Action<?, ?> externalDatabaseCreationFailureAction() {\n+        return new AbstractExternalDatabaseCreationAction<>(CreateExternalDatabaseFailed.class) {\n+\n+            @Override\n+            protected void doExecute(ExternalDatabaseContext context, CreateExternalDatabaseFailed payload, Map<Object, Object> variables) {\n+//                stackCreationService.handleStackCreationFailure(context.getStack(), payload.getException());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d2dbf88df51d4eb753a45458518167ce02595ad"}, "originalPosition": 74}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2NDYxODg2", "url": "https://github.com/hortonworks/cloudbreak/pull/7424#pullrequestreview-366461886", "createdAt": "2020-02-28T15:04:17Z", "commit": {"oid": "2d2dbf88df51d4eb753a45458518167ce02595ad"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQxNTowNDoxN1rOFv3-4w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQxNTowNDoxN1rOFv3-4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc0NDYxMQ==", "bodyText": "some log would be nice here", "url": "https://github.com/hortonworks/cloudbreak/pull/7424#discussion_r385744611", "createdAt": "2020-02-28T15:04:17Z", "author": {"login": "doktoric"}, "path": "core/src/main/java/com/sequenceiq/cloudbreak/core/flow2/externaldatabase/provision/handler/CreateExternalDatabaseHandler.java", "diffHunk": "@@ -0,0 +1,130 @@\n+package com.sequenceiq.cloudbreak.core.flow2.externaldatabase.provision.handler;\n+\n+import static com.sequenceiq.cloudbreak.core.flow2.externaldatabase.provision.config.ExternalDatabaseCreationEvent.EXTERNAL_DATABASE_CREATION_FAILED_EVENT;\n+import static com.sequenceiq.cloudbreak.core.flow2.externaldatabase.provision.config.ExternalDatabaseCreationEvent.EXTERNAL_DATABASE_WAIT_SUCCESS_EVENT;\n+\n+import java.util.Map;\n+import java.util.stream.Collectors;\n+\n+import javax.inject.Inject;\n+\n+import org.apache.commons.lang3.ObjectUtils;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.stereotype.Component;\n+\n+import com.dyngr.exception.PollerException;\n+import com.dyngr.exception.PollerStoppedException;\n+import com.dyngr.exception.UserBreakException;\n+import com.sequenceiq.cloudbreak.api.endpoint.v4.common.DetailedStackStatus;\n+import com.sequenceiq.cloudbreak.api.endpoint.v4.stacks.request.database.DatabaseAvailabilityType;\n+import com.sequenceiq.cloudbreak.cloud.model.CloudSubnet;\n+import com.sequenceiq.cloudbreak.common.event.Selectable;\n+import com.sequenceiq.cloudbreak.common.mappable.CloudPlatform;\n+import com.sequenceiq.cloudbreak.core.flow2.externaldatabase.StackUpdaterService;\n+import com.sequenceiq.cloudbreak.core.flow2.externaldatabase.ExternalDatabaseService;\n+import com.sequenceiq.cloudbreak.domain.stack.Stack;\n+import com.sequenceiq.cloudbreak.event.ResourceEvent;\n+import com.sequenceiq.cloudbreak.exception.BadRequestException;\n+import com.sequenceiq.cloudbreak.reactor.api.event.externaldatabase.CreateExternalDatabaseFailed;\n+import com.sequenceiq.cloudbreak.reactor.api.event.externaldatabase.CreateExternalDatabaseRequest;\n+import com.sequenceiq.cloudbreak.reactor.api.event.externaldatabase.CreateExternalDatabaseResult;\n+import com.sequenceiq.cloudbreak.service.environment.EnvironmentClientService;\n+import com.sequenceiq.environment.api.v1.environment.model.response.DetailedEnvironmentResponse;\n+import com.sequenceiq.flow.reactor.api.handler.EventHandler;\n+\n+import reactor.bus.Event;\n+import reactor.bus.EventBus;\n+\n+@Component\n+public class CreateExternalDatabaseHandler implements EventHandler<CreateExternalDatabaseRequest> {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(CreateExternalDatabaseHandler.class);\n+\n+    @Inject\n+    private EventBus eventBus;\n+\n+    @Inject\n+    private ExternalDatabaseService provisionService;\n+\n+    @Inject\n+    private StackUpdaterService stackUpdaterService;\n+\n+    @Inject\n+    private EnvironmentClientService environmentClientService;\n+\n+    @Override\n+    public String selector() {\n+        return \"CreateExternalDatabaseRequest\";\n+    }\n+\n+    @Override\n+    public void accept(Event<CreateExternalDatabaseRequest> createExternalDatabaseRequest) {\n+        LOGGER.debug(\"In CreateExternalDatabaseHandler.accept\");\n+        CreateExternalDatabaseRequest request = createExternalDatabaseRequest.getData();\n+        Stack stack = request.getStack();\n+        DatabaseAvailabilityType externalDatabase = ObjectUtils.defaultIfNull(stack.getExternalDatabase(), DatabaseAvailabilityType.NONE);\n+        Selectable result;\n+        try {\n+            if (externalDatabase == DatabaseAvailabilityType.NONE) {\n+                LOGGER.info(\"External database for stack {} is not requested.\", stack.getName());\n+                result = new CreateExternalDatabaseResult(stack.getId(), EXTERNAL_DATABASE_WAIT_SUCCESS_EVENT.event(), stack.getName(), null);\n+            } else {\n+                stackUpdaterService.updateStatus(stack.getId(), DetailedStackStatus.EXTERNAL_DATABASE_CREATION_IN_PROGRESS,\n+                        ResourceEvent.CLUSTER_EXTERNAL_DATABASE_CREATION_STARTED, \"External database creation in progress\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d2dbf88df51d4eb753a45458518167ce02595ad"}, "originalPosition": 74}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2NDYzMjM4", "url": "https://github.com/hortonworks/cloudbreak/pull/7424#pullrequestreview-366463238", "createdAt": "2020-02-28T15:06:05Z", "commit": {"oid": "2d2dbf88df51d4eb753a45458518167ce02595ad"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQxNTowNjowNVrOFv4CxQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQxNTowNjowNVrOFv4CxQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc0NTYwNQ==", "bodyText": "do we really want to remove this ?", "url": "https://github.com/hortonworks/cloudbreak/pull/7424#discussion_r385745605", "createdAt": "2020-02-28T15:06:05Z", "author": {"login": "doktoric"}, "path": "core/src/main/java/com/sequenceiq/cloudbreak/service/cluster/flow/ClusterTerminationService.java", "diffHunk": "@@ -146,7 +146,6 @@ public void finalizeClusterTermination(Long clusterId, boolean force) throws Tra\n             deleteFileSystemResources(stackId, fs, force);\n         }\n         cluster.setBlueprint(null);\n-        cluster.setStack(null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d2dbf88df51d4eb753a45458518167ce02595ad"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2NDY0MTgw", "url": "https://github.com/hortonworks/cloudbreak/pull/7424#pullrequestreview-366464180", "createdAt": "2020-02-28T15:07:21Z", "commit": {"oid": "2d2dbf88df51d4eb753a45458518167ce02595ad"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQxNTowNzoyMVrOFv4Fgg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQxNTowNzoyMVrOFv4Fgg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc0NjMwNg==", "bodyText": "I think the same is used in sdx app so we should expose these classes into a common modul. What do you think ?", "url": "https://github.com/hortonworks/cloudbreak/pull/7424#discussion_r385746306", "createdAt": "2020-02-28T15:07:21Z", "author": {"login": "doktoric"}, "path": "core/src/main/java/com/sequenceiq/cloudbreak/service/externaldatabase/AzureDatabaseServerParameterSetter.java", "diffHunk": "@@ -0,0 +1,32 @@\n+package com.sequenceiq.cloudbreak.service.externaldatabase;\n+\n+import org.springframework.beans.factory.annotation.Value;\n+import org.springframework.stereotype.Component;\n+\n+import com.sequenceiq.cloudbreak.common.mappable.CloudPlatform;\n+import com.sequenceiq.cloudbreak.service.externaldatabase.model.DatabaseServerParameter;\n+import com.sequenceiq.redbeams.api.endpoint.v4.stacks.DatabaseServerV4StackRequest;\n+import com.sequenceiq.redbeams.api.endpoint.v4.stacks.azure.AzureDatabaseServerV4Parameters;\n+\n+@Component\n+public class AzureDatabaseServerParameterSetter implements DatabaseServerParameterSetter {\n+\n+    @Value(\"${cb.azure.externaldatabase.retentionperiod:7}\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d2dbf88df51d4eb753a45458518167ce02595ad"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2NDY0NTk0", "url": "https://github.com/hortonworks/cloudbreak/pull/7424#pullrequestreview-366464594", "createdAt": "2020-02-28T15:07:57Z", "commit": {"oid": "2d2dbf88df51d4eb753a45458518167ce02595ad"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQxNTowNzo1N1rOFv4Grg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQxNTowNzo1N1rOFv4Grg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc0NjYwNg==", "bodyText": "Database", "url": "https://github.com/hortonworks/cloudbreak/pull/7424#discussion_r385746606", "createdAt": "2020-02-28T15:07:57Z", "author": {"login": "doktoric"}, "path": "core/src/main/java/com/sequenceiq/cloudbreak/service/rdsconfig/RedbeamsClientService.java", "diffHunk": "@@ -28,4 +31,24 @@ public DatabaseServerV4Response getByCrn(String dbCrn) {\n             throw new CloudbreakServiceException(message, e);\n         }\n     }\n+\n+    public DatabaseServerStatusV4Response create(AllocateDatabaseServerV4Request request) {\n+        try {\n+            return redbeamsServerEndpoint.create(request);\n+        } catch (WebApplicationException | ProcessingException e) {\n+            String message = String.format(\"Failed to create DatabseServer %s\", request.getName());\n+            LOGGER.error(message, e);\n+            throw new CloudbreakServiceException(message, e);\n+        }\n+    }\n+\n+    public DatabaseServerV4Response deleteByCrn(String crn, boolean force) {\n+        try {\n+            return redbeamsServerEndpoint.deleteByCrn(crn, force);\n+        } catch (WebApplicationException | ProcessingException e) {\n+            String message = String.format(\"Failed to delete DatabseServer with CRN %s\", crn);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d2dbf88df51d4eb753a45458518167ce02595ad"}, "originalPosition": 33}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2NDY0Njc3", "url": "https://github.com/hortonworks/cloudbreak/pull/7424#pullrequestreview-366464677", "createdAt": "2020-02-28T15:08:05Z", "commit": {"oid": "2d2dbf88df51d4eb753a45458518167ce02595ad"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQxNTowODowNVrOFv4G7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQxNTowODowNVrOFv4G7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc0NjY3MQ==", "bodyText": "Database", "url": "https://github.com/hortonworks/cloudbreak/pull/7424#discussion_r385746671", "createdAt": "2020-02-28T15:08:05Z", "author": {"login": "doktoric"}, "path": "core/src/main/java/com/sequenceiq/cloudbreak/service/rdsconfig/RedbeamsClientService.java", "diffHunk": "@@ -28,4 +31,24 @@ public DatabaseServerV4Response getByCrn(String dbCrn) {\n             throw new CloudbreakServiceException(message, e);\n         }\n     }\n+\n+    public DatabaseServerStatusV4Response create(AllocateDatabaseServerV4Request request) {\n+        try {\n+            return redbeamsServerEndpoint.create(request);\n+        } catch (WebApplicationException | ProcessingException e) {\n+            String message = String.format(\"Failed to create DatabseServer %s\", request.getName());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d2dbf88df51d4eb753a45458518167ce02595ad"}, "originalPosition": 23}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2NDY1NDY2", "url": "https://github.com/hortonworks/cloudbreak/pull/7424#pullrequestreview-366465466", "createdAt": "2020-02-28T15:09:09Z", "commit": {"oid": "2d2dbf88df51d4eb753a45458518167ce02595ad"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQxNTowOTowOVrOFv4JSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQxNTowOTowOVrOFv4JSw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc0NzI3NQ==", "bodyText": "I think it can be part of the simple application yml and then we will rewrite in help charts", "url": "https://github.com/hortonworks/cloudbreak/pull/7424#discussion_r385747275", "createdAt": "2020-02-28T15:09:09Z", "author": {"login": "doktoric"}, "path": "core/src/main/resources/application-dev.yml", "diffHunk": "@@ -1 +1,2 @@\n-cb.image.catalog.url: https://cloudbreak-imagecatalog.s3.amazonaws.com/v3-dev-cb-image-catalog.json\n\\ No newline at end of file\n+cb.image.catalog.url: https://cloudbreak-imagecatalog.s3.amazonaws.com/v3-dev-cb-image-catalog.json\n+cb.aws.externaldatabase.retentionperiod: 0", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d2dbf88df51d4eb753a45458518167ce02595ad"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2NDY1OTU1", "url": "https://github.com/hortonworks/cloudbreak/pull/7424#pullrequestreview-366465955", "createdAt": "2020-02-28T15:09:50Z", "commit": {"oid": "2d2dbf88df51d4eb753a45458518167ce02595ad"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQxNTowOTo1MVrOFv4KzA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQxNTowOTo1MVrOFv4KzA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTc0NzY2MA==", "bodyText": "externaldatabaseCreationType?", "url": "https://github.com/hortonworks/cloudbreak/pull/7424#discussion_r385747660", "createdAt": "2020-02-28T15:09:51Z", "author": {"login": "doktoric"}, "path": "core/src/main/resources/schema/app/20200204150634_CB-5067_add_externaldatabase_to_stack.sql", "diffHunk": "@@ -0,0 +1,11 @@\n+-- // CB-5067 Add externaldatabase field to the stack table\n+-- Migration SQL that makes the change goes here.\n+\n+ALTER TABLE stack ADD IF NOT EXISTS externaldatabase VARCHAR(10) DEFAULT 'NONE';\n+UPDATE stack SET externaldatabase = 'NONE' WHERE externaldatabase IS NULL;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d2dbf88df51d4eb753a45458518167ce02595ad"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY3MTIzMzIy", "url": "https://github.com/hortonworks/cloudbreak/pull/7424#pullrequestreview-367123322", "createdAt": "2020-03-02T11:19:18Z", "commit": {"oid": "2d2dbf88df51d4eb753a45458518167ce02595ad"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxMToxOToxOFrOFwcAkw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxMToyOToxNVrOFwcRpQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjMzNDg2Nw==", "bodyText": "DatabaseServerParameter serverParameter parameter is not used. Are you sure this is the right method signature?", "url": "https://github.com/hortonworks/cloudbreak/pull/7424#discussion_r386334867", "createdAt": "2020-03-02T11:19:18Z", "author": {"login": "attilapalfi92"}, "path": "core/src/main/java/com/sequenceiq/cloudbreak/service/externaldatabase/AzureDatabaseServerParameterSetter.java", "diffHunk": "@@ -0,0 +1,32 @@\n+package com.sequenceiq.cloudbreak.service.externaldatabase;\n+\n+import org.springframework.beans.factory.annotation.Value;\n+import org.springframework.stereotype.Component;\n+\n+import com.sequenceiq.cloudbreak.common.mappable.CloudPlatform;\n+import com.sequenceiq.cloudbreak.service.externaldatabase.model.DatabaseServerParameter;\n+import com.sequenceiq.redbeams.api.endpoint.v4.stacks.DatabaseServerV4StackRequest;\n+import com.sequenceiq.redbeams.api.endpoint.v4.stacks.azure.AzureDatabaseServerV4Parameters;\n+\n+@Component\n+public class AzureDatabaseServerParameterSetter implements DatabaseServerParameterSetter {\n+\n+    @Value(\"${cb.azure.externaldatabase.retentionperiod:7}\")\n+    private int retentionPeriod;\n+\n+    @Value(\"${cb.azure.externaldatabase.geoRedundantBackup:true}\")\n+    private Boolean geoRedundantBackup;\n+\n+    @Override\n+    public void setParameters(DatabaseServerV4StackRequest request, DatabaseServerParameter serverParameter) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d2dbf88df51d4eb753a45458518167ce02595ad"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjMzNDk1OA==", "bodyText": "DatabaseServerParameter serverParameter parameter is not used. Are you sure this is the right method signature?", "url": "https://github.com/hortonworks/cloudbreak/pull/7424#discussion_r386334958", "createdAt": "2020-03-02T11:19:29Z", "author": {"login": "attilapalfi92"}, "path": "core/src/main/java/com/sequenceiq/cloudbreak/service/externaldatabase/AwsDatabaseServerParameterSetter.java", "diffHunk": "@@ -0,0 +1,33 @@\n+package com.sequenceiq.cloudbreak.service.externaldatabase;\n+\n+import org.springframework.beans.factory.annotation.Value;\n+import org.springframework.stereotype.Component;\n+\n+import com.sequenceiq.cloudbreak.common.mappable.CloudPlatform;\n+import com.sequenceiq.cloudbreak.service.externaldatabase.model.DatabaseServerParameter;\n+import com.sequenceiq.redbeams.api.endpoint.v4.stacks.DatabaseServerV4StackRequest;\n+import com.sequenceiq.redbeams.api.endpoint.v4.stacks.aws.AwsDatabaseServerV4Parameters;\n+\n+@Component\n+public class AwsDatabaseServerParameterSetter implements DatabaseServerParameterSetter {\n+\n+    @Value(\"${cb.aws.externaldatabase.retentionperiod:1}\")\n+    private int retentionPeriod;\n+\n+    @Value(\"${cb.aws.externaldatabase.engineversion:10.6}\")\n+    private String engineVersion;\n+\n+    @Override\n+    public void setParameters(DatabaseServerV4StackRequest request, DatabaseServerParameter serverParameter) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d2dbf88df51d4eb753a45458518167ce02595ad"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjMzNTMyNQ==", "bodyText": "Could be named DatabaseServerParameterDecorator. Setter name is used for setter method, looks weird as class name,", "url": "https://github.com/hortonworks/cloudbreak/pull/7424#discussion_r386335325", "createdAt": "2020-03-02T11:20:28Z", "author": {"login": "attilapalfi92"}, "path": "core/src/main/java/com/sequenceiq/cloudbreak/service/externaldatabase/DatabaseServerParameterSetter.java", "diffHunk": "@@ -0,0 +1,11 @@\n+package com.sequenceiq.cloudbreak.service.externaldatabase;\n+\n+import com.sequenceiq.cloudbreak.common.mappable.CloudPlatform;\n+import com.sequenceiq.cloudbreak.service.externaldatabase.model.DatabaseServerParameter;\n+import com.sequenceiq.redbeams.api.endpoint.v4.stacks.DatabaseServerV4StackRequest;\n+\n+public interface DatabaseServerParameterSetter {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d2dbf88df51d4eb753a45458518167ce02595ad"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjMzNTU5Ng==", "bodyText": "DatabaseServerParameter serverParameter Where is it used?", "url": "https://github.com/hortonworks/cloudbreak/pull/7424#discussion_r386335596", "createdAt": "2020-03-02T11:21:02Z", "author": {"login": "attilapalfi92"}, "path": "core/src/main/java/com/sequenceiq/cloudbreak/service/externaldatabase/DatabaseServerParameterSetter.java", "diffHunk": "@@ -0,0 +1,11 @@\n+package com.sequenceiq.cloudbreak.service.externaldatabase;\n+\n+import com.sequenceiq.cloudbreak.common.mappable.CloudPlatform;\n+import com.sequenceiq.cloudbreak.service.externaldatabase.model.DatabaseServerParameter;\n+import com.sequenceiq.redbeams.api.endpoint.v4.stacks.DatabaseServerV4StackRequest;\n+\n+public interface DatabaseServerParameterSetter {\n+    void setParameters(DatabaseServerV4StackRequest request, DatabaseServerParameter serverParameter);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d2dbf88df51d4eb753a45458518167ce02595ad"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjMzODQxOQ==", "bodyText": "We are moving away from using Spring's conversions service, because its very hard to debug and follow through the code. Can you please implement it without extending AbstractConversionServiceAwareConverter?", "url": "https://github.com/hortonworks/cloudbreak/pull/7424#discussion_r386338419", "createdAt": "2020-03-02T11:27:28Z", "author": {"login": "attilapalfi92"}, "path": "core/src/main/java/com/sequenceiq/cloudbreak/converter/v4/stacks/database/DatabaseAvailabilityTypeToDatabaseResponseConverter.java", "diffHunk": "@@ -0,0 +1,18 @@\n+package com.sequenceiq.cloudbreak.converter.v4.stacks.database;\n+\n+import org.springframework.stereotype.Component;\n+\n+import com.sequenceiq.cloudbreak.api.endpoint.v4.stacks.request.database.DatabaseAvailabilityType;\n+import com.sequenceiq.cloudbreak.api.endpoint.v4.stacks.response.database.DatabaseResponse;\n+import com.sequenceiq.cloudbreak.converter.AbstractConversionServiceAwareConverter;\n+\n+@Component\n+public class DatabaseAvailabilityTypeToDatabaseResponseConverter  extends AbstractConversionServiceAwareConverter<DatabaseAvailabilityType, DatabaseResponse> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d2dbf88df51d4eb753a45458518167ce02595ad"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjMzOTIzNw==", "bodyText": "Is this added to the parallel flows too?", "url": "https://github.com/hortonworks/cloudbreak/pull/7424#discussion_r386339237", "createdAt": "2020-03-02T11:29:15Z", "author": {"login": "attilapalfi92"}, "path": "core/src/main/java/com/sequenceiq/cloudbreak/core/flow2/CloudbreakFlowInformation.java", "diffHunk": "@@ -73,7 +74,7 @@\n \n     @Override\n     public List<Class<? extends FlowConfiguration<?>>> getTerminationFlow() {\n-        return Arrays.asList(StackTerminationFlowConfig.class, ClusterTerminationFlowConfig.class);\n+        return Arrays.asList(StackTerminationFlowConfig.class, ClusterTerminationFlowConfig.class, ExternalDatabaseTerminationFlowConfig.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2d2dbf88df51d4eb753a45458518167ce02595ad"}, "originalPosition": 13}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e64db038dab9b551fbe1dd46ac979beab9579a2b", "author": {"user": null}, "url": "https://github.com/hortonworks/cloudbreak/commit/e64db038dab9b551fbe1dd46ac979beab9579a2b", "committedDate": "2020-03-02T15:57:01Z", "message": "csillamponi"}, "afterCommit": {"oid": "5eb235faf28584b84c9204e85ba2f9427ffa8776", "author": {"user": null}, "url": "https://github.com/hortonworks/cloudbreak/commit/5eb235faf28584b84c9204e85ba2f9427ffa8776", "committedDate": "2020-03-02T16:01:55Z", "message": "CB-5067 Create external database for DistroX clusters"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c107b0181e814e00fb061300a3fe2e2f07126c9b", "author": {"user": null}, "url": "https://github.com/hortonworks/cloudbreak/commit/c107b0181e814e00fb061300a3fe2e2f07126c9b", "committedDate": "2020-03-03T08:51:50Z", "message": "CB-5067 Create external database for DistroX clusters"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5eb235faf28584b84c9204e85ba2f9427ffa8776", "author": {"user": null}, "url": "https://github.com/hortonworks/cloudbreak/commit/5eb235faf28584b84c9204e85ba2f9427ffa8776", "committedDate": "2020-03-02T16:01:55Z", "message": "CB-5067 Create external database for DistroX clusters"}, "afterCommit": {"oid": "c107b0181e814e00fb061300a3fe2e2f07126c9b", "author": {"user": null}, "url": "https://github.com/hortonworks/cloudbreak/commit/c107b0181e814e00fb061300a3fe2e2f07126c9b", "committedDate": "2020-03-03T08:51:50Z", "message": "CB-5067 Create external database for DistroX clusters"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY3ODYwNTcy", "url": "https://github.com/hortonworks/cloudbreak/pull/7424#pullrequestreview-367860572", "createdAt": "2020-03-03T10:26:15Z", "commit": {"oid": "c107b0181e814e00fb061300a3fe2e2f07126c9b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY3OTEwNTY2", "url": "https://github.com/hortonworks/cloudbreak/pull/7424#pullrequestreview-367910566", "createdAt": "2020-03-03T11:44:29Z", "commit": {"oid": "c107b0181e814e00fb061300a3fe2e2f07126c9b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2622, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}