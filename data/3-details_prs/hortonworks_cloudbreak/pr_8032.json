{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE3MjM1MTk0", "number": 8032, "title": "CB-6967 Use DatabaseStack as resource connector parameter instead of DBInstanceIdentifier and implement Azure status lookup", "bodyText": "CB-6967 Use DatabaseStack as resource connector parameter instead of DBInstanceIdentifier and implement Azure status lookup", "createdAt": "2020-05-13T09:25:04Z", "url": "https://github.com/hortonworks/cloudbreak/pull/8032", "merged": true, "mergeCommit": {"oid": "082ca86ab095f5ff37b43d6f496348e43d0bed8f"}, "closed": true, "closedAt": "2020-05-18T07:46:31Z", "author": {"login": "pkedvessy"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcg1mv2gH2gAyNDE3MjM1MTk0OmZmOTQ5MDFjZmU4MmEyZDUyNzY4NDA2ZGQyMTNhNjE0ZmYyMzRhNmE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcia23ZAFqTQxMzMzOTA3Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ff94901cfe82a2d52768406dd213a614ff234a6a", "author": {"user": {"login": "pkedvessy", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/ff94901cfe82a2d52768406dd213a614ff234a6a", "committedDate": "2020-05-13T09:38:57Z", "message": "CB-6967 Use DatabaseStack as resource connector parameter instead of DBInstanceIdentifier and implement Azure status lookup"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "500e5900b46b8a1931563e1a4043c4ce8f1a173e", "author": {"user": {"login": "pkedvessy", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/500e5900b46b8a1931563e1a4043c4ce8f1a173e", "committedDate": "2020-05-13T09:22:54Z", "message": "CB-6967 Use DatabaseStack as resource connector parameter instead of DBInstanceIdentifier and implement Azure status lookup"}, "afterCommit": {"oid": "ff94901cfe82a2d52768406dd213a614ff234a6a", "author": {"user": {"login": "pkedvessy", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/ff94901cfe82a2d52768406dd213a614ff234a6a", "committedDate": "2020-05-13T09:38:57Z", "message": "CB-6967 Use DatabaseStack as resource connector parameter instead of DBInstanceIdentifier and implement Azure status lookup"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExMDQzOTU3", "url": "https://github.com/hortonworks/cloudbreak/pull/8032#pullrequestreview-411043957", "createdAt": "2020-05-13T15:29:01Z", "commit": {"oid": "ff94901cfe82a2d52768406dd213a614ff234a6a"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNToyOTowMVrOGU3Oig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQwNzozMjozMVrOGVPg6g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDUyOTU0Ng==", "bodyText": "Why do we return only these two statuses?", "url": "https://github.com/hortonworks/cloudbreak/pull/8032#discussion_r424529546", "createdAt": "2020-05-13T15:29:01Z", "author": {"login": "gergopapi2"}, "path": "cloud-azure/src/main/java/com/sequenceiq/cloudbreak/cloud/azure/connector/resource/AzureDatabaseResourceService.java", "diffHunk": "@@ -141,5 +143,22 @@\n                 .name(resourceGroupName)\n                 .build(), ResourceStatus.DELETED));\n     }\n+\n+    public ExternalDatabaseStatus getDatabaseServerStatus(AuthenticatedContext ac, DatabaseStack stack) {\n+        CloudContext cloudContext = ac.getCloudContext();\n+        AzureClient client = ac.getParameter(AzureClient.class);\n+        String resourceGroupName = azureUtils.getResourceGroupName(cloudContext, stack);\n+\n+        try {\n+            ResourceGroup resourceGroup = client.getResourceGroup(resourceGroupName);\n+            if (resourceGroup == null) {\n+                return ExternalDatabaseStatus.DELETED;\n+            }\n+            return ExternalDatabaseStatus.STARTED;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ff94901cfe82a2d52768406dd213a614ff234a6a"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDkyNzQ2Ng==", "bodyText": "Question: during a mock test is the status sync running? If yes, it might then break the test.", "url": "https://github.com/hortonworks/cloudbreak/pull/8032#discussion_r424927466", "createdAt": "2020-05-14T07:32:31Z", "author": {"login": "gergopapi2"}, "path": "cloud-mock/src/main/java/com/sequenceiq/cloudbreak/cloud/mock/MockResourceConnector.java", "diffHunk": "@@ -193,17 +193,17 @@ public String getDBStackTemplate() throws TemplatingDoesNotSupportedException {\n     }\n \n     @Override\n-    public void startDatabaseServer(AuthenticatedContext authenticatedContext, String dbInstanceIdentifier) {\n+    public void startDatabaseServer(AuthenticatedContext authenticatedContext, DatabaseStack stack) {\n         throw new UnsupportedOperationException(\"Database server start operation is not supported for \" + getClass().getName());\n     }\n \n     @Override\n-    public void stopDatabaseServer(AuthenticatedContext authenticatedContext, String dbInstanceIdentifier) {\n+    public void stopDatabaseServer(AuthenticatedContext authenticatedContext, DatabaseStack stack) {\n         throw new UnsupportedOperationException(\"Database server stop operation is not supported for \" + getClass().getName());\n     }\n \n     @Override\n-    public ExternalDatabaseStatus getDatabaseServerStatus(AuthenticatedContext authenticatedContext, String dbInstanceIdentifier) throws Exception {\n+    public ExternalDatabaseStatus getDatabaseServerStatus(AuthenticatedContext authenticatedContext, DatabaseStack stack) throws Exception {\n         throw new UnsupportedOperationException(\"Database server status lookup is not supported for \" + getClass().getName());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ff94901cfe82a2d52768406dd213a614ff234a6a"}, "originalPosition": 18}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzMzM5MDc2", "url": "https://github.com/hortonworks/cloudbreak/pull/8032#pullrequestreview-413339076", "createdAt": "2020-05-18T07:36:58Z", "commit": {"oid": "ff94901cfe82a2d52768406dd213a614ff234a6a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2198, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}