{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAzNDI1OTA5", "number": 9222, "reviewThreads": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxNDoxNTozMlrOE3PuMA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxNDoyNToyN1rOE3QBcQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI2MzY0NzIwOnYy", "diffSide": "RIGHT", "path": "integration-test/src/main/java/com/sequenceiq/it/cloudbreak/testcase/mock/EnvironmentEditTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxNDoxNTozMlrOHwehZg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxNDoxNTozMlrOHwehZg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDU5Mzc2Ng==", "bodyText": "do you really want to comment out ?", "url": "https://github.com/hortonworks/cloudbreak/pull/9222#discussion_r520593766", "createdAt": "2020-11-10T14:15:32Z", "author": {"login": "doktoric"}, "path": "integration-test/src/main/java/com/sequenceiq/it/cloudbreak/testcase/mock/EnvironmentEditTest.java", "diffHunk": "@@ -48,15 +48,16 @@ public void authenticationEditWhenSetExistingKeyAndDeleteManagedSuccessfully(Moc\n                 .given(HttpMock.class).whenRequested(SpiEndpoints.RegisterPublicKey.class).post()\n                 .thenReturn((s, model, uriParameters) -> \"\")\n                 .whenRequested(SpiEndpoints.GetPublicKey.class).get()\n-                .thenReturn((s, model, uriParameters) -> \"true\")\n+                .pathVariable(\"publicKeyId\", \"id\")\n+                .thenReturn((s, model, uriParameters) -> true)\n                 .given(EnvironmentTestDto.class)\n                 .withCreateFreeIpa(false)\n                 .when(environmentTestClient.create())\n                 .await(EnvironmentStatus.AVAILABLE)\n \n-                .given(HttpMock.class).whenRequested(SpiEndpoints.UnregisterPublicKey.class).post().clearCalls()\n-                .whenRequested(SpiEndpoints.UnregisterPublicKey.class).post()\n-                .thenReturn((s, model, uriParameters) -> \"\")\n+//                .given(HttpMock.class).whenRequested(SpiEndpoints.UnregisterPublicKey.class).post().clearCalls()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3d0a8ce5e1045316a7f1dd36cd676eed3fee67e3"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI2MzY0NzU2OnYy", "diffSide": "RIGHT", "path": "integration-test/src/main/java/com/sequenceiq/it/cloudbreak/testcase/mock/EnvironmentEditTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxNDoxNTozOFrOHwehpg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxNDozODo0N1rOHwfnNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDU5MzgzMA==", "bodyText": "do you really want to comment out ?", "url": "https://github.com/hortonworks/cloudbreak/pull/9222#discussion_r520593830", "createdAt": "2020-11-10T14:15:38Z", "author": {"login": "doktoric"}, "path": "integration-test/src/main/java/com/sequenceiq/it/cloudbreak/testcase/mock/EnvironmentEditTest.java", "diffHunk": "@@ -97,9 +99,9 @@ public void authenticationEditWhenSetManagedKeyAndNotDeleteExisted(MockedTestCon\n                 .when(environmentTestClient.create())\n                 .await(EnvironmentStatus.AVAILABLE)\n \n-                .given(HttpMock.class)\n-                .whenRequested(SpiEndpoints.RegisterPublicKey.class).post()\n-                .thenReturn((s, model, uriParameters) -> \"\")\n+//                .given(HttpMock.class)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3d0a8ce5e1045316a7f1dd36cd676eed3fee67e3"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDYxMTYzOA==", "bodyText": "Yes, because these functionalities will be implemented in the next task (almost all verifications, response modifications)", "url": "https://github.com/hortonworks/cloudbreak/pull/9222#discussion_r520611638", "createdAt": "2020-11-10T14:38:47Z", "author": {"login": "topolyai5"}, "path": "integration-test/src/main/java/com/sequenceiq/it/cloudbreak/testcase/mock/EnvironmentEditTest.java", "diffHunk": "@@ -97,9 +99,9 @@ public void authenticationEditWhenSetManagedKeyAndNotDeleteExisted(MockedTestCon\n                 .when(environmentTestClient.create())\n                 .await(EnvironmentStatus.AVAILABLE)\n \n-                .given(HttpMock.class)\n-                .whenRequested(SpiEndpoints.RegisterPublicKey.class).post()\n-                .thenReturn((s, model, uriParameters) -> \"\")\n+//                .given(HttpMock.class)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDU5MzgzMA=="}, "originalCommit": {"oid": "3d0a8ce5e1045316a7f1dd36cd676eed3fee67e3"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI2MzY4MTM0OnYy", "diffSide": "RIGHT", "path": "datalake/src/main/resources/duties/7.2.1/mock/light_duty.json", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxNDoyMjoyNVrOHwe2iw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxNDoyMjoyNVrOHwe2iw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDU5OTE3OQ==", "bodyText": "I guess we should remove this", "url": "https://github.com/hortonworks/cloudbreak/pull/9222#discussion_r520599179", "createdAt": "2020-11-10T14:22:25Z", "author": {"login": "doktoric"}, "path": "datalake/src/main/resources/duties/7.2.1/mock/light_duty.json", "diffHunk": "@@ -3,7 +3,7 @@\n     \"blueprintName\": \"7.2.1 - SDX Light Duty: Apache Hive Metastore, Apache Ranger, Apache Atlas\",\n     \"validateBlueprint\": false\n   },\n-  \"gatewayPort\": 9401,\n+  \"xgatewayPort\": 9401,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3d0a8ce5e1045316a7f1dd36cd676eed3fee67e3"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI2MzY4MTk5OnYy", "diffSide": "RIGHT", "path": "datalake/src/main/resources/duties/7.2.2/mock/light_duty.json", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxNDoyMjozM1rOHwe26g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxNDoyMjozM1rOHwe26g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDU5OTI3NA==", "bodyText": "I guess we should remove this", "url": "https://github.com/hortonworks/cloudbreak/pull/9222#discussion_r520599274", "createdAt": "2020-11-10T14:22:33Z", "author": {"login": "doktoric"}, "path": "datalake/src/main/resources/duties/7.2.2/mock/light_duty.json", "diffHunk": "@@ -3,7 +3,7 @@\n     \"blueprintName\": \"7.2.2 - SDX Light Duty: Apache Hive Metastore, Apache Ranger, Apache Atlas\",\n     \"validateBlueprint\": false\n   },\n-  \"gatewayPort\": 9401,\n+  \"xgatewayPort\": 9401,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3d0a8ce5e1045316a7f1dd36cd676eed3fee67e3"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI2MzY4MjMzOnYy", "diffSide": "RIGHT", "path": "datalake/src/main/resources/duties/7.2.6/mock/light_duty.json", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxNDoyMjozN1rOHwe3JQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxNDoyMjozN1rOHwe3JQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDU5OTMzMw==", "bodyText": "I guess we should remove this", "url": "https://github.com/hortonworks/cloudbreak/pull/9222#discussion_r520599333", "createdAt": "2020-11-10T14:22:37Z", "author": {"login": "doktoric"}, "path": "datalake/src/main/resources/duties/7.2.6/mock/light_duty.json", "diffHunk": "@@ -3,7 +3,7 @@\n     \"blueprintName\": \"7.2.6 - SDX Light Duty: Apache Hive Metastore, Apache Ranger, Apache Atlas\",\n     \"validateBlueprint\": false\n   },\n-  \"gatewayPort\": 9401,\n+  \"xgatewayPort\": 9401,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3d0a8ce5e1045316a7f1dd36cd676eed3fee67e3"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI2MzY4NDgzOnYy", "diffSide": "RIGHT", "path": "integration-test/src/main/java/com/sequenceiq/it/cloudbreak/assertion/MockVerification.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxNDoyMzoxMFrOHwe4yA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxNDoyMzoxMFrOHwe4yA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDU5OTc1Mg==", "bodyText": "Verification is disabled because we cannot decide the test ? what it means ?", "url": "https://github.com/hortonworks/cloudbreak/pull/9222#discussion_r520599752", "createdAt": "2020-11-10T14:23:10Z", "author": {"login": "doktoric"}, "path": "integration-test/src/main/java/com/sequenceiq/it/cloudbreak/assertion/MockVerification.java", "diffHunk": "@@ -61,16 +59,18 @@ public static MockVerification verifyRegEx(HttpMethod httpMethod, String path) {\n \n     @Override\n     public T doAssertion(TestContext testContext, T testDto, MicroserviceClient cloudbreakClient) {\n-        logVerify();\n-        Map<Call, Response> requestResponseMap = ((MockedTestContext) testContext).getSparkServer().getRequestResponseMap();\n-        int matchesCount = getTimesMatched(requestResponseMap);\n-\n-        SimpleRetryWrapper.create(() -> check(matchesCount))\n-                .withName(\"MockVerification check\")\n-                .withRetryTimes(RETRY_TIMES)\n-                .withRetryWaitSeconds(RETRY_WAIT_SECONDS)\n-                .run();\n-\n+        //TODO please don't remove this. It will be enabled if the following jira will be resolved: https://jira.cloudera.com/browse/CB-9111\n+//        logVerify();\n+//        Call[] calls = testContext.getExecuteQueryToMockInfrastructure().execute(\"/calls/\" + testContext.getTestMethodName(), r -> r.readEntity(Call[].class));\n+//        int matchesCount = getTimesMatched(Arrays.asList(calls));\n+\n+//        SimpleRetryWrapper.create(() -> check(matchesCount))\n+//                .withName(\"MockVerification check\")\n+//                .withRetryTimes(RETRY_TIMES)\n+//                .withRetryWaitSeconds(RETRY_WAIT_SECONDS)\n+//                .run();\n+\n+        LOGGER.info(\"Verification is disabled because we cannot decide the test.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3d0a8ce5e1045316a7f1dd36cd676eed3fee67e3"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI2MzY5MTQ4OnYy", "diffSide": "RIGHT", "path": "integration-test/src/main/java/com/sequenceiq/it/cloudbreak/cloud/v4/mock/MockCloudProvider.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxNDoyNDozMFrOHwe85Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxNDo0MDo0M1rOHwftRg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDYwMDgwNQ==", "bodyText": "why fixed port ?", "url": "https://github.com/hortonworks/cloudbreak/pull/9222#discussion_r520600805", "createdAt": "2020-11-10T14:24:30Z", "author": {"login": "doktoric"}, "path": "integration-test/src/main/java/com/sequenceiq/it/cloudbreak/cloud/v4/mock/MockCloudProvider.java", "diffHunk": "@@ -84,7 +82,7 @@ public StackTestDtoBase stack(StackTestDtoBase stack) {\n \n     @Override\n     public DistroXTestDtoBase distrox(DistroXTestDtoBase distrox) {\n-        return distrox.withGatewayPort(getSparkServerPort(distrox.getTestContext()));\n+        return distrox.withGatewayPort(10090);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3d0a8ce5e1045316a7f1dd36cd676eed3fee67e3"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDYxMzE5MA==", "bodyText": "Our new service has a dedicated port but in under the \"path shifting or unique path\" task, this will be removed", "url": "https://github.com/hortonworks/cloudbreak/pull/9222#discussion_r520613190", "createdAt": "2020-11-10T14:40:43Z", "author": {"login": "topolyai5"}, "path": "integration-test/src/main/java/com/sequenceiq/it/cloudbreak/cloud/v4/mock/MockCloudProvider.java", "diffHunk": "@@ -84,7 +82,7 @@ public StackTestDtoBase stack(StackTestDtoBase stack) {\n \n     @Override\n     public DistroXTestDtoBase distrox(DistroXTestDtoBase distrox) {\n-        return distrox.withGatewayPort(getSparkServerPort(distrox.getTestContext()));\n+        return distrox.withGatewayPort(10090);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDYwMDgwNQ=="}, "originalCommit": {"oid": "3d0a8ce5e1045316a7f1dd36cd676eed3fee67e3"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI2MzY5MzA2OnYy", "diffSide": "RIGHT", "path": "integration-test/src/main/java/com/sequenceiq/it/cloudbreak/mock/DefaultModel.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxNDoyNDo0OVrOHwe95w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxNDoyNDo0OVrOHwe95w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDYwMTA2Mw==", "bodyText": "remove?", "url": "https://github.com/hortonworks/cloudbreak/pull/9222#discussion_r520601063", "createdAt": "2020-11-10T14:24:49Z", "author": {"login": "doktoric"}, "path": "integration-test/src/main/java/com/sequenceiq/it/cloudbreak/mock/DefaultModel.java", "diffHunk": "@@ -48,13 +47,13 @@ public void startModel(Service sparkService, String mockServerAddress, Set<Strin\n \n         ambariMock = new AmbariMock(sparkService, this);\n         spiMock = new SPIMock(sparkService, this);\n-        saltMock = new SaltMock(sparkService, this);\n+//        saltMock = new SaltMock(sparkService, this);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3d0a8ce5e1045316a7f1dd36cd676eed3fee67e3"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI2MzY5MzM2OnYy", "diffSide": "RIGHT", "path": "integration-test/src/main/java/com/sequenceiq/it/cloudbreak/mock/DefaultModel.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxNDoyNDo1MlrOHwe-EQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxNDoyNDo1MlrOHwe-EQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDYwMTEwNQ==", "bodyText": "remove?", "url": "https://github.com/hortonworks/cloudbreak/pull/9222#discussion_r520601105", "createdAt": "2020-11-10T14:24:52Z", "author": {"login": "doktoric"}, "path": "integration-test/src/main/java/com/sequenceiq/it/cloudbreak/mock/DefaultModel.java", "diffHunk": "@@ -48,13 +47,13 @@ public void startModel(Service sparkService, String mockServerAddress, Set<Strin\n \n         ambariMock = new AmbariMock(sparkService, this);\n         spiMock = new SPIMock(sparkService, this);\n-        saltMock = new SaltMock(sparkService, this);\n+//        saltMock = new SaltMock(sparkService, this);\n         clouderaManagerMock = new ClouderaManagerMock(sparkService, this, activeProfiles);\n \n-        ambariMock.addAmbariMappings();\n-        spiMock.addSPIEndpoints();\n-        saltMock.addSaltMappings();\n-        clouderaManagerMock.addClouderaManagerMappings();\n+//        ambariMock.addAmbariMappings();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3d0a8ce5e1045316a7f1dd36cd676eed3fee67e3"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI2MzY5NDExOnYy", "diffSide": "RIGHT", "path": "integration-test/src/main/java/com/sequenceiq/it/cloudbreak/mock/ExecuteQueryToMockInfrastructure.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxNDoyNTowMVrOHwe-hQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxNDoyNTowMVrOHwe-hQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDYwMTIyMQ==", "bodyText": "why fixed port?", "url": "https://github.com/hortonworks/cloudbreak/pull/9222#discussion_r520601221", "createdAt": "2020-11-10T14:25:01Z", "author": {"login": "doktoric"}, "path": "integration-test/src/main/java/com/sequenceiq/it/cloudbreak/mock/ExecuteQueryToMockInfrastructure.java", "diffHunk": "@@ -0,0 +1,89 @@\n+package com.sequenceiq.it.cloudbreak.mock;\n+\n+import java.security.KeyManagementException;\n+import java.security.SecureRandom;\n+import java.util.Map;\n+import java.util.function.Function;\n+\n+import javax.annotation.PostConstruct;\n+import javax.net.ssl.SSLContext;\n+import javax.net.ssl.TrustManager;\n+import javax.ws.rs.client.Client;\n+import javax.ws.rs.client.Entity;\n+import javax.ws.rs.client.Invocation;\n+import javax.ws.rs.client.WebTarget;\n+import javax.ws.rs.core.Response;\n+\n+import org.glassfish.jersey.SslConfigurator;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.annotation.Value;\n+import org.springframework.stereotype.Component;\n+\n+import com.sequenceiq.cloudbreak.client.CertificateTrustManager;\n+import com.sequenceiq.cloudbreak.client.RestClientUtil;\n+import com.sequenceiq.it.cloudbreak.exception.TestFailException;\n+import com.sequenceiq.it.cloudbreak.log.Log;\n+\n+@Component\n+public class ExecuteQueryToMockInfrastructure {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(ExecuteQueryToMockInfrastructure.class);\n+\n+    @Value(\"${mock.infrastructure.host:localhost}\")\n+    private String mockInfrastructureHost;\n+\n+    @PostConstruct\n+    void log() {\n+        Log.log(LOGGER, \"Mock-infrastructure host: %s\", mockInfrastructureHost);\n+    }\n+\n+    public void call(String path, Function<WebTarget, WebTarget> decorateWebTarget) {\n+        execute(path, decorateWebTarget, r -> null);\n+    }\n+\n+    public <T> T execute(String path, Function<Response, T> handleResponse) {\n+        return execute(path, w -> null, handleResponse);\n+    }\n+\n+    public <T> T execute(String path, Function<WebTarget, WebTarget> decorateWebTarget, Function<Response, T> handleResponse) {\n+        WebTarget target = buildWebTarget(path, decorateWebTarget);\n+        try (Response response = target.request().get()) {\n+            return handleResponse.apply(response);\n+        }\n+    }\n+\n+    public void executeConfigure(String path, Map<String, String> pathVariables, Object body) {\n+        executeConfigure(path, pathVariables, w -> w, body);\n+    }\n+\n+    public void executeConfigure(String path, Map<String, String> pathVariables, Function<WebTarget, WebTarget> decorateWebTarget, Object body) {\n+        WebTarget webTarget = buildWebTarget(path + \"/configure\", decorateWebTarget);\n+        for (Map.Entry<String, String> entry : pathVariables.entrySet()) {\n+            webTarget = webTarget.resolveTemplate(entry.getKey(), entry.getValue());\n+        }\n+        Invocation.Builder invocation = webTarget.request();\n+        try (Response ignore = invocation.post(Entity.json(body))) {\n+\n+        }\n+    }\n+\n+    private WebTarget buildWebTarget(String path, Function<WebTarget, WebTarget> decorateWebTarget) {\n+        CertificateTrustManager.SavingX509TrustManager x509TrustManager = new CertificateTrustManager.SavingX509TrustManager();\n+        TrustManager[] trustManagers = {x509TrustManager};\n+        SSLContext sslContext = SslConfigurator.newInstance().createSSLContext();\n+        try {\n+            sslContext.init(null, trustManagers, new SecureRandom());\n+        } catch (KeyManagementException e) {\n+            throw new TestFailException(\"Cannot init SSL Context: \" + e.getMessage(), e);\n+        }\n+        Client client = RestClientUtil.createClient(sslContext, true);\n+        WebTarget target = client.target(getUrl());\n+        target = decorateWebTarget.apply(target.path(path));\n+        return target;\n+    }\n+\n+    public String getUrl() {\n+        return String.format(\"https://%s:%d\", mockInfrastructureHost, 10090);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3d0a8ce5e1045316a7f1dd36cd676eed3fee67e3"}, "originalPosition": 87}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI2MzY5NTA1OnYy", "diffSide": "RIGHT", "path": "integration-test/src/main/java/com/sequenceiq/it/cloudbreak/mock/model/ClouderaManagerMock.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxNDoyNToxMFrOHwe_FQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxNDoyNToxMFrOHwe_FQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDYwMTM2NQ==", "bodyText": "remove?", "url": "https://github.com/hortonworks/cloudbreak/pull/9222#discussion_r520601365", "createdAt": "2020-11-10T14:25:10Z", "author": {"login": "doktoric"}, "path": "integration-test/src/main/java/com/sequenceiq/it/cloudbreak/mock/model/ClouderaManagerMock.java", "diffHunk": "@@ -231,9 +189,9 @@ public void addClouderaManagerMappings() {\n         dynamicRouteStack.post(CONFIGURE_KERBEROS, new ProfileAwareRoute(\n                 (request, response) -> new ApiCommand().id(BigDecimal.ONE).active(Boolean.TRUE).name(\"Configure Kerberos\"), activeProfiles));\n         dynamicRouteStack.post(GENERATE_CREDENTIALS, new ProfileAwareRoute(\n-                (request, response) -> new ApiCommand().id(BigDecimal.ONE).active(Boolean.TRUE).name(\"Generate Credentials\"), activeProfiles));\n+                (request, response) -> new ApiCommand().id(BigDecimal.ONE).active(Boolean.TRUE).name(\"Generate Credentials\"), activeProfiles));*/\n     }\n-\n+/*", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3d0a8ce5e1045316a7f1dd36cd676eed3fee67e3"}, "originalPosition": 71}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI2MzY5NTQzOnYy", "diffSide": "RIGHT", "path": "integration-test/src/main/java/com/sequenceiq/it/cloudbreak/mock/model/SPIMock.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxNDoyNToxNVrOHwe_UQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxNDoyNToxNVrOHwe_UQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDYwMTQyNQ==", "bodyText": "remove?", "url": "https://github.com/hortonworks/cloudbreak/pull/9222#discussion_r520601425", "createdAt": "2020-11-10T14:25:15Z", "author": {"login": "doktoric"}, "path": "integration-test/src/main/java/com/sequenceiq/it/cloudbreak/mock/model/SPIMock.java", "diffHunk": "@@ -51,14 +51,14 @@ public SPIMock(Service sparkService, DefaultModel defaultModel) {\n     }\n \n     public void addSPIEndpoints() {\n-        Map<String, CloudVmMetaDataStatus> instanceMap = getDefaultModel().getInstanceMap();\n+        /*Map<String, CloudVmMetaDataStatus> instanceMap = getDefaultModel().getInstanceMap();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3d0a8ce5e1045316a7f1dd36cd676eed3fee67e3"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI2MzY5NTgwOnYy", "diffSide": "RIGHT", "path": "integration-test/src/main/java/com/sequenceiq/it/cloudbreak/mock/model/SaltMock.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxNDoyNToxOFrOHwe_gQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxNDoyNToxOFrOHwe_gQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDYwMTQ3Mw==", "bodyText": "remove?", "url": "https://github.com/hortonworks/cloudbreak/pull/9222#discussion_r520601473", "createdAt": "2020-11-10T14:25:18Z", "author": {"login": "doktoric"}, "path": "integration-test/src/main/java/com/sequenceiq/it/cloudbreak/mock/model/SaltMock.java", "diffHunk": "@@ -55,8 +53,8 @@ public SaltMock(Service sparkService, DefaultModel defaultModel) {\n     }\n \n     public void addSaltMappings() {\n-        Map<String, CloudVmMetaDataStatus> instanceMap = getDefaultModel().getInstanceMap();\n-        ObjectMapper objectMapper = new ObjectMapper();\n+//        Map<String, CloudVmMetaDataStatus> instanceMap = getDefaultModel().getInstanceMap();\n+        /*ObjectMapper objectMapper = new ObjectMapper();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3d0a8ce5e1045316a7f1dd36cd676eed3fee67e3"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI2MzY5NjQ5OnYy", "diffSide": "RIGHT", "path": "integration-test/src/main/java/com/sequenceiq/it/cloudbreak/spark/SparkServer.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxNDoyNToyN1rOHwe_7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxNDoyNToyN1rOHwe_7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDYwMTU4Mw==", "bodyText": "remove?", "url": "https://github.com/hortonworks/cloudbreak/pull/9222#discussion_r520601583", "createdAt": "2020-11-10T14:25:27Z", "author": {"login": "doktoric"}, "path": "integration-test/src/main/java/com/sequenceiq/it/cloudbreak/spark/SparkServer.java", "diffHunk": "@@ -59,41 +38,21 @@ public void reset() {\n     }\n \n     public void init() {\n-        callStack.clear();\n-        requestResponseMap.clear();\n-        sparkService.init();\n-        sparkService.before((req, res) -> res.type(\"application/json\"));\n-        sparkService.after(\n-                (request, response) -> {\n-                    if (printRequestBody) {\n-                        LOGGER.info(format(\"%s request from %s --> %s\", request.requestMethod(), request.url(), request.body()));\n-                        LOGGER.info(format(\"response from [%s] ::: [%d] --> %s\", request.url(), response.status(), response.body()));\n-                    }\n-                    requestResponseMap.put(Call.fromRequest(request), response);\n-                });\n-        sparkService.after(\n-                (request, response) -> callStack.push(Call.fromRequest(request))\n-        );\n-        sparkService.get(VALIDATIONCALL, (request, response) -> \"OK\");\n-    }\n-\n-    public Map<Call, Response> getRequestResponseMap() {\n-        return Collections.unmodifiableMap(requestResponseMap);\n     }\n \n     public String getEndpoint() {\n-        return (secure ? \"https://\"  : \"http://\") + endpoint + \":\" + port;\n+        return \"https://%s:10090\";\n     }\n \n     public Service getSparkService() {\n-        return sparkService;\n+        throw new UnsupportedOperationException(\"Please don't use this. WE handle all request in a separated service\");\n     }\n \n     public void awaitInitialization() {\n-        LOGGER.info(\"Spark service initialization in progress on port: {}.\", port);\n-        sparkService.awaitInitialization();\n-        waitEndpointToBeReady(VALIDATIONCALL, null);\n-        LOGGER.info(\"Spark service initialization finished on port {}.\", port);\n+//        LOGGER.info(\"Spark service initialization in progress on port: {}.\", port);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3d0a8ce5e1045316a7f1dd36cd676eed3fee67e3"}, "originalPosition": 80}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2157, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}