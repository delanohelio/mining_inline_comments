{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIyNzg2ODg3", "number": 9461, "title": "CB-6964: Wrong freeIpa status after instance is deleted on provider side", "bodyText": "During a freeipa health check, it first update instances' status and then the freeipa status. In a particular case, if the instance is deleted on provider side, the freeipa will first updates instance status to deleted. But if the environment runtime breaks ad restarts, the healthcheck will skip and won't update the freeipa status because all instances are already deleted. Therefore, after environment recovers, freeipa shows wrong stopped status. This fix will correct the freeipa status as deleted.\nSee detailed description in the commit message.", "createdAt": "2020-11-18T00:13:41Z", "url": "https://github.com/hortonworks/cloudbreak/pull/9461", "merged": true, "mergeCommit": {"oid": "10f36db9be3cc3d80b0feab5dd4cd03ecb34294b"}, "closed": true, "closedAt": "2020-11-18T06:44:40Z", "author": {"login": "christmasferret"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABddiwCigH2gAyNTIyNzg2ODg3OjQ1MGUwMTFlMjYxNDVlM2ZmOTM4Y2UzMDc0ODdjODZiOWQwZjFiOTY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABddooZdAFqTUzMzE1MDE1Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "450e011e26145e3ff938ce307487c86b9d0f1b96", "author": {"user": {"login": "christmasferret", "name": null}}, "url": "https://github.com/hortonworks/cloudbreak/commit/450e011e26145e3ff938ce307487c86b9d0f1b96", "committedDate": "2020-11-18T00:10:17Z", "message": "CB-6964: Wrong freeIpa status after instance is deleted on provider side\n\nDuring a freeipa health check, it first update instances' status and then the freeipa status. In a particular case, if the instance is deleted on provider side, the freeipa will first updates instance status to deleted. But if the environment runtime breaks ad restarts, the healthcheck will skip and won't update the freeipa status because all instances are already deleted. Therefore, after environment recovers, freeipa shows wrong stopped status. This fix will correct the freeipa status as deleted."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMzMTQyNzA4", "url": "https://github.com/hortonworks/cloudbreak/pull/9461#pullrequestreview-533142708", "createdAt": "2020-11-18T06:44:33Z", "commit": {"oid": "450e011e26145e3ff938ce307487c86b9d0f1b96"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMzMTUwMDQ0", "url": "https://github.com/hortonworks/cloudbreak/pull/9461#pullrequestreview-533150044", "createdAt": "2020-11-18T07:01:06Z", "commit": {"oid": "450e011e26145e3ff938ce307487c86b9d0f1b96"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQwNzowMTowNlrOH1fkzA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQwNzowMTowNlrOH1fkzA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTg1MzkwMA==", "bodyText": "Just a minor thing but can you please add a log line for this branch?", "url": "https://github.com/hortonworks/cloudbreak/pull/9461#discussion_r525853900", "createdAt": "2020-11-18T07:01:06Z", "author": {"login": "sodre90"}, "path": "freeipa/src/main/java/com/sequenceiq/freeipa/sync/StackStatusCheckerJob.java", "diffHunk": "@@ -118,6 +118,10 @@ public void syncAStack(Stack stack) {\n                                 LOGGER.debug(\"results is empty, skip update\");\n                             }\n                         }\n+                    } else if (alreadyDeletedCount > 0) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "450e011e26145e3ff938ce307487c86b9d0f1b96"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMzMTUwMTU3", "url": "https://github.com/hortonworks/cloudbreak/pull/9461#pullrequestreview-533150157", "createdAt": "2020-11-18T07:01:22Z", "commit": {"oid": "450e011e26145e3ff938ce307487c86b9d0f1b96"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2001, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}