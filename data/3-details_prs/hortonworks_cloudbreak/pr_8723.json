{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYzNTI0MDE4", "number": 8723, "title": "CB-4915 Respect region disablement policies of customer AWS accounts", "bodyText": "Regarding CB-4915 a new mechanism has been implemented that verifies that the credential which is under creation is able to query regions. If regions could not be described using the globally set default region which is us-east-1 then it tries to describe regions in different EC2 regions. This list of possible default is configurable, but the defaults are stored in environment service's application.yml. Once the describe of regions works from a region then the region is persisted on credential side as a new attribute. This means that AWS related services will picked the credential specific region as default when it is possible/necessary.\nDuring the tests it turned out this describe region process takes some time due to a bug in AWS Java SDK:\naws/aws-sdk-java#2204\nThe SDK's retrying client identifies 401 AuthFailure responses as skew errors which is retryable this way and results in 30 failures/retries from the client side. But this doesn't prevent the customer to have a credential with proper default region configured, just the creation takes much more time then it's expected.", "createdAt": "2020-08-05T17:02:00Z", "url": "https://github.com/hortonworks/cloudbreak/pull/8723", "merged": true, "mergeCommit": {"oid": "725769db27a632ddfb4271b6ae53130d920d7124"}, "closed": true, "closedAt": "2020-08-07T11:47:03Z", "author": {"login": "biharitomi"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc8LKnEgFqTQ2MjI3NjQ3Ng==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc8ilsegFqTQ2MzIzMzM4NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyMjc2NDc2", "url": "https://github.com/hortonworks/cloudbreak/pull/8723#pullrequestreview-462276476", "createdAt": "2020-08-06T08:02:04Z", "commit": {"oid": "12c5f82e4fde77b3291783ecc93acc7eb104a3f3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQwODowMjowNFrOG8nyIA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQwODowMjowNFrOG8nyIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjIxOTU1Mg==", "bodyText": "hmmm\nI am not sure this is the approach what we would like to follow. How about using aws-zone.json for this ?", "url": "https://github.com/hortonworks/cloudbreak/pull/8723#discussion_r466219552", "createdAt": "2020-08-06T08:02:04Z", "author": {"login": "doktoric"}, "path": "environment/src/main/resources/application.yml", "diffHunk": "@@ -145,7 +145,9 @@ cb:\n         services: s3,dynamodb\n       interface:\n         services: autoscaling,cloudformation,ec2,ecr.api,ecr.dkr,elasticfilesystem,elasticloadbalancing,sts\n-    credential.cache.ttl: 60\n+    credential:\n+      cache.ttl: 60\n+      default.regions: us-west-1,us-west-2,eu-central-1,eu-north-1,sa-east-1,ap-northeast-1,eu-west-1,ap-northeast-2,ap-southeast-2,ap-southeast-1", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "12c5f82e4fde77b3291783ecc93acc7eb104a3f3"}, "originalPosition": 7}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "12c5f82e4fde77b3291783ecc93acc7eb104a3f3", "author": {"user": {"login": "biharitomi", "name": "Tamas Bihari"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/12c5f82e4fde77b3291783ecc93acc7eb104a3f3", "committedDate": "2020-08-05T16:36:59Z", "message": "CB-4915 Respect region disablement policies of customer AWS accounts"}, "afterCommit": {"oid": "808b8246e1a3237f3cf662f321538f32d8549dfc", "author": {"user": {"login": "biharitomi", "name": "Tamas Bihari"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/808b8246e1a3237f3cf662f321538f32d8549dfc", "committedDate": "2020-08-06T15:50:14Z", "message": "CB-4915 Respect region disablement policies of customer AWS accounts"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "808b8246e1a3237f3cf662f321538f32d8549dfc", "author": {"user": {"login": "biharitomi", "name": "Tamas Bihari"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/808b8246e1a3237f3cf662f321538f32d8549dfc", "committedDate": "2020-08-06T15:50:14Z", "message": "CB-4915 Respect region disablement policies of customer AWS accounts"}, "afterCommit": {"oid": "827efd59b466648b822cec8ca82c551dc0c4efa6", "author": {"user": {"login": "biharitomi", "name": "Tamas Bihari"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/827efd59b466648b822cec8ca82c551dc0c4efa6", "committedDate": "2020-08-07T07:53:30Z", "message": "CB-4915 Respect region disablement policies of customer AWS accounts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7a19fc9312f94ac01cbc01ff70653de6e4448ed9", "author": {"user": {"login": "biharitomi", "name": "Tamas Bihari"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/7a19fc9312f94ac01cbc01ff70653de6e4448ed9", "committedDate": "2020-08-07T08:51:16Z", "message": "CB-4915 Respect region disablement policies of customer AWS accounts"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "827efd59b466648b822cec8ca82c551dc0c4efa6", "author": {"user": {"login": "biharitomi", "name": "Tamas Bihari"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/827efd59b466648b822cec8ca82c551dc0c4efa6", "committedDate": "2020-08-07T07:53:30Z", "message": "CB-4915 Respect region disablement policies of customer AWS accounts"}, "afterCommit": {"oid": "7a19fc9312f94ac01cbc01ff70653de6e4448ed9", "author": {"user": {"login": "biharitomi", "name": "Tamas Bihari"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/7a19fc9312f94ac01cbc01ff70653de6e4448ed9", "committedDate": "2020-08-07T08:51:16Z", "message": "CB-4915 Respect region disablement policies of customer AWS accounts"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYzMjMzMzg1", "url": "https://github.com/hortonworks/cloudbreak/pull/8723#pullrequestreview-463233385", "createdAt": "2020-08-07T11:19:29Z", "commit": {"oid": "7a19fc9312f94ac01cbc01ff70653de6e4448ed9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2553, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}