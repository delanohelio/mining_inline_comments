{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM5ODQzMDgw", "number": 9651, "title": "CB-9745 Enabling Knox sticky sessions for ui and api requests.", "bodyText": "This also enables round robining to all the hosts in the topology,\nand should not affect Knox services that do not have this enabled.\nSee detailed description in the commit message.", "createdAt": "2020-12-14T22:33:12Z", "url": "https://github.com/hortonworks/cloudbreak/pull/9651", "merged": true, "mergeCommit": {"oid": "c54b3f4aed45874c8dd7d0cc9e5c662e7717f684"}, "closed": true, "closedAt": "2021-04-07T16:59:36Z", "author": {"login": "frozenwizard"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdmOw1TAFqTU1MTk5MDIyNw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABeKzsmJABqjQ1NjMyMDY0MTA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUxOTkwMjI3", "url": "https://github.com/hortonworks/cloudbreak/pull/9651#pullrequestreview-551990227", "createdAt": "2020-12-14T23:54:33Z", "commit": {"oid": "af32c982e4af3d664049d4dae3996ec518ef12de"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQyMzo1NDozM1rOIFx-IQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQyMzo1NDozM1rOIFx-IQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjkzMjUxMw==", "bodyText": "Is this enabled for all runtime versions? Is there a way to enable this only for 7.2.7 and above?", "url": "https://github.com/hortonworks/cloudbreak/pull/9651#discussion_r542932513", "createdAt": "2020-12-14T23:54:33Z", "author": {"login": "kmanamcheri"}, "path": "orchestrator-salt/src/main/resources/salt/salt/gateway/config/cm/topology.xml.j2", "diffHunk": "@@ -198,21 +198,21 @@\n              {% if 'ATLAS' in exposed and 'ATLAS_SERVER' in salt['pillar.get']('gateway:location') -%}\n              <param>\n                  <name>ATLAS</name>\n-                 <value>enabled=true;maxFailoverAttempts=3;failoverSleep=1000</value>\n+                 <value>enabled=true;maxFailoverAttempts=3;failoverSleep=1000;enableStickySessions=true</value>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "af32c982e4af3d664049d4dae3996ec518ef12de"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUyMzY1NTk2", "url": "https://github.com/hortonworks/cloudbreak/pull/9651#pullrequestreview-552365596", "createdAt": "2020-12-15T11:41:12Z", "commit": {"oid": "af32c982e4af3d664049d4dae3996ec518ef12de"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxMTo0MToxMlrOIGGsbA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxMTo0MToxMlrOIGGsbA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzI3MjA0NA==", "bodyText": "Why are we not this for HIVE? Hive would be one to benefit the most.", "url": "https://github.com/hortonworks/cloudbreak/pull/9651#discussion_r543272044", "createdAt": "2020-12-15T11:41:12Z", "author": {"login": "moresandeep"}, "path": "orchestrator-salt/src/main/resources/salt/salt/gateway/config/cm/topology.xml.j2", "diffHunk": "@@ -198,21 +198,21 @@\n              {% if 'ATLAS' in exposed and 'ATLAS_SERVER' in salt['pillar.get']('gateway:location') -%}\n              <param>\n                  <name>ATLAS</name>\n-                 <value>enabled=true;maxFailoverAttempts=3;failoverSleep=1000</value>\n+                 <value>enabled=true;maxFailoverAttempts=3;failoverSleep=1000;enableStickySessions=true</value>\n              </param>\n              <param>\n                  <name>ATLAS-API</name>\n-                 <value>enabled=true;maxFailoverAttempts=3;failoverSleep=1000</value>\n+                 <value>enabled=true;maxFailoverAttempts=3;failoverSleep=1000;enableStickySessions=true</value>\n              </param>\n              {%- endif %}\n              {% if 'CM-API' in exposed and 'CM-API' in salt['pillar.get']('gateway:location') -%}\n              <param>\n                  <name>CM-API</name>\n-                 <value>enabled=true;maxFailoverAttempts=3;failoverSleep=1000</value>\n+                 <value>enabled=true;maxFailoverAttempts=3;failoverSleep=1000;enableStickySessions=true</value>\n              </param>\n              <param>\n                  <name>CM-UI</name>\n-                 <value>enabled=true;maxFailoverAttempts=3;failoverSleep=1000</value>\n+                 <value>enabled=true;maxFailoverAttempts=3;failoverSleep=1000;enableStickySessions=true</value>\n              </param>\n              {%- endif %}\n              {% if 'HIVE' in exposed and 'HIVESERVER2' in salt['pillar.get']('gateway:location') -%}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "af32c982e4af3d664049d4dae3996ec518ef12de"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUyNjIyODQ3", "url": "https://github.com/hortonworks/cloudbreak/pull/9651#pullrequestreview-552622847", "createdAt": "2020-12-15T16:11:19Z", "commit": {"oid": "af32c982e4af3d664049d4dae3996ec518ef12de"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxNjoxMToyMFrOIGTZ-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxNjoxMToyMFrOIGTZ-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzQ4MDMxMw==", "bodyText": "This would break Atlas, we should not be using Knox HA for atlas since it is active-passive. adding stickysession would break it badly.", "url": "https://github.com/hortonworks/cloudbreak/pull/9651#discussion_r543480313", "createdAt": "2020-12-15T16:11:20Z", "author": {"login": "moresandeep"}, "path": "orchestrator-salt/src/main/resources/salt/salt/gateway/config/cm/topology.xml.j2", "diffHunk": "@@ -198,21 +198,21 @@\n              {% if 'ATLAS' in exposed and 'ATLAS_SERVER' in salt['pillar.get']('gateway:location') -%}\n              <param>\n                  <name>ATLAS</name>\n-                 <value>enabled=true;maxFailoverAttempts=3;failoverSleep=1000</value>\n+                 <value>enabled=true;maxFailoverAttempts=3;failoverSleep=1000;enableStickySessions=true</value>\n              </param>\n              <param>\n                  <name>ATLAS-API</name>\n-                 <value>enabled=true;maxFailoverAttempts=3;failoverSleep=1000</value>\n+                 <value>enabled=true;maxFailoverAttempts=3;failoverSleep=1000;enableStickySessions=true</value>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "af32c982e4af3d664049d4dae3996ec518ef12de"}, "originalPosition": 10}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "af32c982e4af3d664049d4dae3996ec518ef12de", "author": {"user": null}, "url": "https://github.com/hortonworks/cloudbreak/commit/af32c982e4af3d664049d4dae3996ec518ef12de", "committedDate": "2020-12-14T22:31:09Z", "message": "CB-9745 Enabling Knox sticky sessions for ui and api requests.\n\nThis also enables round robining to all the hosts in the topology,\nand should not affect Knox services that do not have this enabled."}, "afterCommit": {"oid": "72b32c80eead4cdc51a7bc5d85f06beaf91c533f", "author": {"user": null}, "url": "https://github.com/hortonworks/cloudbreak/commit/72b32c80eead4cdc51a7bc5d85f06beaf91c533f", "committedDate": "2021-04-02T15:13:30Z", "message": "CB-9745 Enable Knox backend round robin to hosts\n\nThis enables Ranger UI/API, Solr, Hive and Phoenix to loadbalance to the other Knox server."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjI3MDUxNjE0", "url": "https://github.com/hortonworks/cloudbreak/pull/9651#pullrequestreview-627051614", "createdAt": "2021-04-02T15:36:12Z", "commit": {"oid": "72b32c80eead4cdc51a7bc5d85f06beaf91c533f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjI3MDczODky", "url": "https://github.com/hortonworks/cloudbreak/pull/9651#pullrequestreview-627073892", "createdAt": "2021-04-02T16:19:08Z", "commit": {"oid": "72b32c80eead4cdc51a7bc5d85f06beaf91c533f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "72b32c80eead4cdc51a7bc5d85f06beaf91c533f", "author": {"user": null}, "url": "https://github.com/hortonworks/cloudbreak/commit/72b32c80eead4cdc51a7bc5d85f06beaf91c533f", "committedDate": "2021-04-02T15:13:30Z", "message": "CB-9745 Enable Knox backend round robin to hosts\n\nThis enables Ranger UI/API, Solr, Hive and Phoenix to loadbalance to the other Knox server."}, "afterCommit": {"oid": "fc55bbaf3ca1a625176b54077f1c10d37c71f607", "author": {"user": null}, "url": "https://github.com/hortonworks/cloudbreak/commit/fc55bbaf3ca1a625176b54077f1c10d37c71f607", "committedDate": "2021-04-05T19:55:38Z", "message": "CB-9745 Enable Knox backend round robin to hosts\n\nThis enables Ranger UI/API, Solr, Hive and Phoenix to loadbalance to the other Knox server."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0b230d92524e16e8588d90773f2106449a460e4a", "author": {"user": null}, "url": "https://github.com/hortonworks/cloudbreak/commit/0b230d92524e16e8588d90773f2106449a460e4a", "committedDate": "2021-04-07T15:21:12Z", "message": "CB-9745 Enable Knox backend round robin to hosts\n\nThis enables Ranger UI/API, Solr, Hive and Phoenix to loadbalance to the other Knox server."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fc55bbaf3ca1a625176b54077f1c10d37c71f607", "author": {"user": null}, "url": "https://github.com/hortonworks/cloudbreak/commit/fc55bbaf3ca1a625176b54077f1c10d37c71f607", "committedDate": "2021-04-05T19:55:38Z", "message": "CB-9745 Enable Knox backend round robin to hosts\n\nThis enables Ranger UI/API, Solr, Hive and Phoenix to loadbalance to the other Knox server."}, "afterCommit": {"oid": "0b230d92524e16e8588d90773f2106449a460e4a", "author": {"user": null}, "url": "https://github.com/hortonworks/cloudbreak/commit/0b230d92524e16e8588d90773f2106449a460e4a", "committedDate": "2021-04-07T15:21:12Z", "message": "CB-9745 Enable Knox backend round robin to hosts\n\nThis enables Ranger UI/API, Solr, Hive and Phoenix to loadbalance to the other Knox server."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1995, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}