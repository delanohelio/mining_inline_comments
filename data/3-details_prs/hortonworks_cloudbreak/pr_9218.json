{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAzMjIxMjQ4", "number": 9218, "title": "CB-8107 CB-8108 Enable SSL enforcement for AWS & Azure DL external DB", "bodyText": "Rebased onto #9215\nEnable SSL enforcement for the external DB of data lakes. The list of cloud platforms where this is applied is controlled by the new Datalake service property datalake.supported.externaldb.sslenforcement.platform (see PlatformConfig.dbServiceSslEnforcementSupportedPlatforms).\n\nIn AWS, the CF stack is extended with a new AWS::RDS::DBParameterGroup resource that has rds.force_ssl=1. Supported engine versions: 9.5, 9.6, 10.x, 11.x, 12.x, 13.x.\nIn Azure, the Microsoft.DBforPostgreSQL/servers resource will have sslEnforcement=Enabled and minimalTlsVersion=TLS1_2.\n\n\nData hub DBs and embedded DBs of any cluster type are not affected.\nAdded new unit tests and updated existing ones to use JUnit 5 and AssertJ.", "createdAt": "2020-10-14T09:00:06Z", "url": "https://github.com/hortonworks/cloudbreak/pull/9218", "merged": true, "mergeCommit": {"oid": "c10934d30d1bac17b5932b06ffef42c7a7721249"}, "closed": true, "closedAt": "2020-10-19T10:14:25Z", "author": {"login": "lajosrodek"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdSzmCvgBqjM4ODIyNTY4NTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdUASBGABqjM4OTIxNzEzMTY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "907ca6f04021ab81ee73b46ef08628e539c6565a", "author": {"user": {"login": "lajosrodek", "name": "Lajos Rodek"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/907ca6f04021ab81ee73b46ef08628e539c6565a", "committedDate": "2020-10-14T08:52:31Z", "message": "CB-8107 CB-8108 Enable SSL enforcement for AWS & Azure external DB\n\nTODO\n* List of changes\n* Unit tests"}, "afterCommit": {"oid": "83116d66fd5f5f1d2787b96f06d44c21a76d0ebf", "author": {"user": {"login": "lajosrodek", "name": "Lajos Rodek"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/83116d66fd5f5f1d2787b96f06d44c21a76d0ebf", "committedDate": "2020-10-15T15:32:56Z", "message": "CB-8107 CB-8108 Enable SSL enforcement for AWS & Azure external DB\n\nTODO\n* Rebased onto #9215\n* List of changes\n* Unit tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "83116d66fd5f5f1d2787b96f06d44c21a76d0ebf", "author": {"user": {"login": "lajosrodek", "name": "Lajos Rodek"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/83116d66fd5f5f1d2787b96f06d44c21a76d0ebf", "committedDate": "2020-10-15T15:32:56Z", "message": "CB-8107 CB-8108 Enable SSL enforcement for AWS & Azure external DB\n\nTODO\n* Rebased onto #9215\n* List of changes\n* Unit tests"}, "afterCommit": {"oid": "5ba908535b48e8e3e2abacb753cd6a98b051e6f4", "author": {"user": {"login": "lajosrodek", "name": "Lajos Rodek"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/5ba908535b48e8e3e2abacb753cd6a98b051e6f4", "committedDate": "2020-10-17T22:52:30Z", "message": "CB-8107 CB-8108 Enable SSL enforcement for AWS & Azure DL external DB\n\n* Rebased onto #9215\n* Enable SSL enforcement for the external DB of data lakes. The list of\n  cloud platforms where this is applied is controlled by the new\n  Datalake service property\n  datalake.supported.externaldb.sslenforcement.platform (see\n  PlatformConfig.dbServiceSslEnforcementSupportedPlatforms).\n  * In AWS, the CF stack is extended with a new\n    AWS::RDS::DBParameterGroup resource that has rds.force_ssl=1.\n    Supported engine versions: 9.5, 9.6, 10.x, 11.x, 12.x, 13.x.\n  * In Azure, the Microsoft.DBforPostgreSQL/servers resource will\n    have sslEnforcement=Enabled and minimalTlsVersion=TLS1_2.\n* Data hub DBs and embedded DBs of any cluster type are not affected.\n* Added new unit tests and updated existing ones to use JUnit 5 and\n  AssertJ."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExMTYyNDMy", "url": "https://github.com/hortonworks/cloudbreak/pull/9218#pullrequestreview-511162432", "createdAt": "2020-10-18T16:59:02Z", "commit": {"oid": "5ba908535b48e8e3e2abacb753cd6a98b051e6f4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOFQxNjo1OTowMlrOHjsNdw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOFQxNjo1OTowMlrOHjsNdw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzE4NjU1MQ==", "bodyText": "do we need this todo?", "url": "https://github.com/hortonworks/cloudbreak/pull/9218#discussion_r507186551", "createdAt": "2020-10-18T16:59:02Z", "author": {"login": "doktoric"}, "path": "redbeams/src/main/java/com/sequenceiq/redbeams/converter/spi/DBStackToDatabaseStackConverter.java", "diffHunk": "@@ -66,6 +68,29 @@ private DatabaseServer buildDatabaseServer(DBStack dbStack) {\n             return null;\n         }\n \n+        Map<String, Object> params = buildParameters(dbStack);\n+        SecurityGroup securityGroup = dbStackDatabaseServer.getSecurityGroup();\n+\n+        DatabaseServer.Builder builder = DatabaseServer.builder()\n+                .serverId(dbStackDatabaseServer.getName())\n+                .flavor(dbStackDatabaseServer.getInstanceType())\n+                .engine(getDatabaseEngine(dbStackDatabaseServer))\n+                .connectionDriver(dbStackDatabaseServer.getConnectionDriver())\n+                .rootUserName(dbStackDatabaseServer.getRootUserName())\n+                .rootPassword(dbStackDatabaseServer.getRootPassword())\n+                .port(dbStackDatabaseServer.getPort())\n+                .useSslEnforcement(determineSslEnforcement(dbStack))\n+                .storageSize(dbStackDatabaseServer.getStorageSize())\n+                .security(securityGroup == null ? null : new Security(Collections.emptyList(), securityGroup.getSecurityGroupIds()))\n+                // TODO / FIXME converter caller decides this?", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ba908535b48e8e3e2abacb753cd6a98b051e6f4"}, "originalPosition": 34}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTExMTYyNjA3", "url": "https://github.com/hortonworks/cloudbreak/pull/9218#pullrequestreview-511162607", "createdAt": "2020-10-18T17:01:17Z", "commit": {"oid": "5ba908535b48e8e3e2abacb753cd6a98b051e6f4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOFQxNzowMToxN1rOHjsOew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOFQxNzowMToxN1rOHjsOew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzE4NjgxMQ==", "bodyText": "if (response.sslConfig == null) {\nresponse.setSslConfig(new SslConfigV4Response());\n}\n?", "url": "https://github.com/hortonworks/cloudbreak/pull/9218#discussion_r507186811", "createdAt": "2020-10-18T17:01:17Z", "author": {"login": "doktoric"}, "path": "redbeams/src/main/java/com/sequenceiq/redbeams/converter/v4/databaseserver/DatabaseServerConfigToDatabaseServerV4ResponseConverter.java", "diffHunk": "@@ -54,10 +54,13 @@ public DatabaseServerV4Response convert(DatabaseServerConfig source) {\n             }\n         } else if (source.getHost() != null && source.getPort() != null) {\n             response.setStatus(Status.AVAILABLE);\n+            response.setSslConfig(new SslConfigV4Response());\n         } else {\n             response.setStatus(Status.UNKNOWN);\n+            response.setSslConfig(new SslConfigV4Response());\n         }\n ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ba908535b48e8e3e2abacb753cd6a98b051e6f4"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d6222551351943ea8cfc4599af4c290b8221060", "author": {"user": {"login": "lajosrodek", "name": "Lajos Rodek"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/3d6222551351943ea8cfc4599af4c290b8221060", "committedDate": "2020-10-19T08:53:39Z", "message": "CB-8107 CB-8108 Enable SSL enforcement for AWS & Azure DL external DB\n\n* Rebased onto #9215\n* Enable SSL enforcement for the external DB of data lakes. The list of\n  cloud platforms where this is applied is controlled by the new\n  Datalake service property\n  datalake.supported.externaldb.sslenforcement.platform (see\n  PlatformConfig.dbServiceSslEnforcementSupportedPlatforms).\n  * In AWS, the CF stack is extended with a new\n    AWS::RDS::DBParameterGroup resource that has rds.force_ssl=1.\n    Supported engine versions: 9.5, 9.6, 10.x, 11.x, 12.x, 13.x.\n  * In Azure, the Microsoft.DBforPostgreSQL/servers resource will\n    have sslEnforcement=Enabled and minimalTlsVersion=TLS1_2.\n* Data hub DBs and embedded DBs of any cluster type are not affected.\n* Added new unit tests and updated existing ones to use JUnit 5 and\n  AssertJ."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5ba908535b48e8e3e2abacb753cd6a98b051e6f4", "author": {"user": {"login": "lajosrodek", "name": "Lajos Rodek"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/5ba908535b48e8e3e2abacb753cd6a98b051e6f4", "committedDate": "2020-10-17T22:52:30Z", "message": "CB-8107 CB-8108 Enable SSL enforcement for AWS & Azure DL external DB\n\n* Rebased onto #9215\n* Enable SSL enforcement for the external DB of data lakes. The list of\n  cloud platforms where this is applied is controlled by the new\n  Datalake service property\n  datalake.supported.externaldb.sslenforcement.platform (see\n  PlatformConfig.dbServiceSslEnforcementSupportedPlatforms).\n  * In AWS, the CF stack is extended with a new\n    AWS::RDS::DBParameterGroup resource that has rds.force_ssl=1.\n    Supported engine versions: 9.5, 9.6, 10.x, 11.x, 12.x, 13.x.\n  * In Azure, the Microsoft.DBforPostgreSQL/servers resource will\n    have sslEnforcement=Enabled and minimalTlsVersion=TLS1_2.\n* Data hub DBs and embedded DBs of any cluster type are not affected.\n* Added new unit tests and updated existing ones to use JUnit 5 and\n  AssertJ."}, "afterCommit": {"oid": "3d6222551351943ea8cfc4599af4c290b8221060", "author": {"user": {"login": "lajosrodek", "name": "Lajos Rodek"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/3d6222551351943ea8cfc4599af4c290b8221060", "committedDate": "2020-10-19T08:53:39Z", "message": "CB-8107 CB-8108 Enable SSL enforcement for AWS & Azure DL external DB\n\n* Rebased onto #9215\n* Enable SSL enforcement for the external DB of data lakes. The list of\n  cloud platforms where this is applied is controlled by the new\n  Datalake service property\n  datalake.supported.externaldb.sslenforcement.platform (see\n  PlatformConfig.dbServiceSslEnforcementSupportedPlatforms).\n  * In AWS, the CF stack is extended with a new\n    AWS::RDS::DBParameterGroup resource that has rds.force_ssl=1.\n    Supported engine versions: 9.5, 9.6, 10.x, 11.x, 12.x, 13.x.\n  * In Azure, the Microsoft.DBforPostgreSQL/servers resource will\n    have sslEnforcement=Enabled and minimalTlsVersion=TLS1_2.\n* Data hub DBs and embedded DBs of any cluster type are not affected.\n* Added new unit tests and updated existing ones to use JUnit 5 and\n  AssertJ."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2172, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}