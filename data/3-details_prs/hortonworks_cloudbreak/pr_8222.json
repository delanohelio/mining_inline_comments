{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI4Mzk3MTY1", "number": 8222, "title": "CB-7057: fix null status reason", "bodyText": "", "createdAt": "2020-06-05T11:37:32Z", "url": "https://github.com/hortonworks/cloudbreak/pull/8222", "merged": true, "mergeCommit": {"oid": "347bf118167e338143d6ed30f199b626ed94b52c"}, "closed": true, "closedAt": "2020-06-08T08:13:23Z", "author": {"login": "tiborpopovics"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcoRPd6AFqTQyNTIyODIwNQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcpLOgvgBqjM0MTg1MjA0Mzg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1MjI4MjA1", "url": "https://github.com/hortonworks/cloudbreak/pull/8222#pullrequestreview-425228205", "createdAt": "2020-06-05T11:48:20Z", "commit": {"oid": "89d4ace4312983fa11227e8cdb90794a44efe4ea"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1MjM4NTg4", "url": "https://github.com/hortonworks/cloudbreak/pull/8222#pullrequestreview-425238588", "createdAt": "2020-06-05T12:04:53Z", "commit": {"oid": "89d4ace4312983fa11227e8cdb90794a44efe4ea"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQxMjowNDo1M1rOGfryBQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQxMjowNDo1M1rOGfryBQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTg3NjM1Nw==", "bodyText": "We should not log the last message if it is null", "url": "https://github.com/hortonworks/cloudbreak/pull/8222#discussion_r435876357", "createdAt": "2020-06-05T12:04:53Z", "author": {"login": "keyki"}, "path": "orchestrator-api/src/main/java/com/sequenceiq/cloudbreak/orchestrator/OrchestratorBootstrapRunner.java", "diffHunk": "@@ -157,9 +157,9 @@ private Boolean checkResult(Boolean success, int retryCount, Exception actualExc\n             nodesWithErrors = ((CloudbreakOrchestratorException) actualException).getNodesWithErrors();\n         }\n         if (retryCount >= maxRetryCount) {\n-            throw new CloudbreakOrchestratorTimeoutException(cause, nodesWithErrors, elapsedTimeRounded);\n+            throw new CloudbreakOrchestratorTimeoutException(errorMessage, nodesWithErrors, elapsedTimeRounded);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89d4ace4312983fa11227e8cdb90794a44efe4ea"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "89d4ace4312983fa11227e8cdb90794a44efe4ea", "author": {"user": null}, "url": "https://github.com/hortonworks/cloudbreak/commit/89d4ace4312983fa11227e8cdb90794a44efe4ea", "committedDate": "2020-06-05T11:36:31Z", "message": "CB-7057: fix null status reason"}, "afterCommit": {"oid": "63be897e0dece2e7abaf23635ff15f3bc4526687", "author": {"user": null}, "url": "https://github.com/hortonworks/cloudbreak/commit/63be897e0dece2e7abaf23635ff15f3bc4526687", "committedDate": "2020-06-05T14:53:26Z", "message": "CB-7057: fix null status reason"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1NDE2NDMz", "url": "https://github.com/hortonworks/cloudbreak/pull/8222#pullrequestreview-425416433", "createdAt": "2020-06-05T15:43:31Z", "commit": {"oid": "63be897e0dece2e7abaf23635ff15f3bc4526687"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQxNTo0MzozMVrOGfzvHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQxNTo0MzozMVrOGfzvHw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjAwNjY4Nw==", "bodyText": "What happens if the template requires 1 param when the actualException is null, but we pass 2 params with the cause to String.format?", "url": "https://github.com/hortonworks/cloudbreak/pull/8222#discussion_r436006687", "createdAt": "2020-06-05T15:43:31Z", "author": {"login": "keyki"}, "path": "orchestrator-api/src/main/java/com/sequenceiq/cloudbreak/orchestrator/OrchestratorBootstrapRunner.java", "diffHunk": "@@ -143,23 +143,28 @@ private Boolean checkResult(Boolean success, int retryCount, Exception actualExc\n         }\n \n         String cause = null;\n+        String messageTemplate;\n+        long elapsedTimeRounded = Math.max(Math.round((double) retryCount * SLEEP_TIME / MS_IN_SEC / SEC_IN_MIN), MINIMUM_DISPLAYED_TIME_IN_MIN);\n         if (actualException != null) {\n             cause = actualException.getMessage();\n+            messageTemplate = success == null\n+                    ? \"Timeout: Orchestrator component failed to finish in %d min(s), last message: %s\"\n+                    : \"Failed: Orchestrator component went failed in %d min(s), message: %s\";\n+        } else {\n+            messageTemplate = success == null\n+                    ? \"Timeout: Orchestrator component failed to finish in %d min(s)\"\n+                    : \"Failed: Orchestrator component went failed in %d min(s)\";\n         }\n-        String messageTemplate = success == null\n-                ? \"Timeout: Orchestrator component failed to finish in %d min(s), last message: %s\"\n-                : \"Failed: Orchestrator component went failed in %d min(s), message: %s\";\n-        long elapsedTimeRounded = Math.max(Math.round((double) retryCount * SLEEP_TIME / MS_IN_SEC / SEC_IN_MIN), MINIMUM_DISPLAYED_TIME_IN_MIN);\n         String errorMessage = String.format(messageTemplate, elapsedTimeRounded, cause);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "63be897e0dece2e7abaf23635ff15f3bc4526687"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1NDI3OTU5", "url": "https://github.com/hortonworks/cloudbreak/pull/8222#pullrequestreview-425427959", "createdAt": "2020-06-05T15:58:41Z", "commit": {"oid": "63be897e0dece2e7abaf23635ff15f3bc4526687"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3ee239e4a64ec154a15895389f91e5295b6a2246", "author": {"user": null}, "url": "https://github.com/hortonworks/cloudbreak/commit/3ee239e4a64ec154a15895389f91e5295b6a2246", "committedDate": "2020-06-08T07:21:28Z", "message": "CB-7057: fix null status reason"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "63be897e0dece2e7abaf23635ff15f3bc4526687", "author": {"user": null}, "url": "https://github.com/hortonworks/cloudbreak/commit/63be897e0dece2e7abaf23635ff15f3bc4526687", "committedDate": "2020-06-05T14:53:26Z", "message": "CB-7057: fix null status reason"}, "afterCommit": {"oid": "3ee239e4a64ec154a15895389f91e5295b6a2246", "author": {"user": null}, "url": "https://github.com/hortonworks/cloudbreak/commit/3ee239e4a64ec154a15895389f91e5295b6a2246", "committedDate": "2020-06-08T07:21:28Z", "message": "CB-7057: fix null status reason"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1809, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}