{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY3NzI1OTEx", "number": 8811, "title": "CB-8401: Add the operation ID to the FreeIPA logs", "bodyText": "Add the operation ID to the FreeIPA logs for repair.\nChange the user sync to use the operationId for the operation ID\nrather than the flowId.\nEnsure the MDC cleanup happens if an exception is thrown.\nThis was tested using a local deployment of cloudbreak.\nSee detailed description in the commit message.", "createdAt": "2020-08-14T02:09:03Z", "url": "https://github.com/hortonworks/cloudbreak/pull/8811", "merged": true, "mergeCommit": {"oid": "5d7c03e48d57fbca78aced1f68459405c8ec23cf"}, "closed": true, "closedAt": "2020-08-25T14:09:07Z", "author": {"login": "jamisonbennett"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc-ufoPAFqTQ2NzMzMTY5Nw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdCECGiABqjM2ODU5MDA5OTc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY3MzMxNjk3", "url": "https://github.com/hortonworks/cloudbreak/pull/8811#pullrequestreview-467331697", "createdAt": "2020-08-14T06:19:34Z", "commit": {"oid": "5c6394cbc51a2651d4e4fd1a9f9d106a71f3dd66"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY3MzQwNjA1", "url": "https://github.com/hortonworks/cloudbreak/pull/8811#pullrequestreview-467340605", "createdAt": "2020-08-14T06:41:44Z", "commit": {"oid": "5c6394cbc51a2651d4e4fd1a9f9d106a71f3dd66"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQwNjo0MTo0NFrOHApUbw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQwNjo0MTo0NFrOHApUbw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDQzOTAyMw==", "bodyText": "I think you should add these methods to MDCBuilder as we have it like addEnvCrn", "url": "https://github.com/hortonworks/cloudbreak/pull/8811#discussion_r470439023", "createdAt": "2020-08-14T06:41:44Z", "author": {"login": "lacikaaa"}, "path": "freeipa/src/main/java/com/sequenceiq/freeipa/service/operation/OperationService.java", "diffHunk": "@@ -99,6 +102,14 @@ public Operation getOperationForAccountIdAndOperationId(String accountId, String\n         return operationOptional.get();\n     }\n \n+    public static void addMdcOperationId(String operationId) {\n+        MDCBuilder.addMdcField(OPERATION_ID_MDC_NAME, operationId);\n+    }\n+\n+    public static void removeMdcOperationId() {\n+        MDCBuilder.removeMdcField(OPERATION_ID_MDC_NAME);\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5c6394cbc51a2651d4e4fd1a9f9d106a71f3dd66"}, "originalPosition": 27}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY3MzQxMDY3", "url": "https://github.com/hortonworks/cloudbreak/pull/8811#pullrequestreview-467341067", "createdAt": "2020-08-14T06:42:51Z", "commit": {"oid": "5c6394cbc51a2651d4e4fd1a9f9d106a71f3dd66"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQwNjo0Mjo1MVrOHApWBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNFQwNjo0Mjo1MVrOHApWBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDQzOTQyOA==", "bodyText": "@oleewere does this change break kibana log parsing?", "url": "https://github.com/hortonworks/cloudbreak/pull/8811#discussion_r470439428", "createdAt": "2020-08-14T06:42:51Z", "author": {"login": "lacikaaa"}, "path": "freeipa/src/main/resources/logback.xml", "diffHunk": "@@ -12,7 +12,7 @@\n         <encoder class=\"ch.qos.logback.core.encoder.LayoutWrappingEncoder\">\n             <layout class=\"com.sequenceiq.cloudbreak.logger.MaskingPatternLayout\">\n                 <loggerNameFilter>com.sequenceiq</loggerNameFilter>\n-                <pattern>%date{ISO8601} [%thread] %method:%line %-5level %logger{5} - [type:%X{resourceType:-springLog}] [crn:%X{resourceCrn:-}] [name:%X{resourceName:-}] [flow:%X{flowId:-}] [requestid:%X{requestId:-}] [tenant:%X{tenant:-}] [userCrn:%X{userCrn:-}] [environment:%X{environmentCrn:-}] [traceId:%X{traceId:-}] [spanId:%X{spanId:-}] %msg%n</pattern>\n+                <pattern>%date{ISO8601} [%thread] %method:%line %-5level %logger{5} - [type:%X{resourceType:-springLog}] [crn:%X{resourceCrn:-}] [name:%X{resourceName:-}] [flow:%X{flowId:-}] [requestid:%X{requestId:-}] [tenant:%X{tenant:-}] [userCrn:%X{userCrn:-}] [environment:%X{environmentCrn:-}] [traceId:%X{traceId:-}] [spanId:%X{spanId:-}] [operationId:%X{operationId:-}] %msg%n</pattern>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5c6394cbc51a2651d4e4fd1a9f9d106a71f3dd66"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5c6394cbc51a2651d4e4fd1a9f9d106a71f3dd66", "author": {"user": {"login": "jamisonbennett", "name": "Jamison Bennett"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/5c6394cbc51a2651d4e4fd1a9f9d106a71f3dd66", "committedDate": "2020-08-14T02:05:52Z", "message": "CB-8401: Add the operation ID to the FreeIPA logs\n\nAdd the operation ID to the FreeIPA logs for repair.\n\nChange the user sync to use the operationId for the operation ID\nrather than the flowId.\n\nEnsure the MDC cleanup happens if an exception is thrown.\n\nThis was tested using a local deployment of cloudbreak."}, "afterCommit": {"oid": "74d89f02ae45ff4602379d69fc8f59e2f0cb5146", "author": {"user": {"login": "jamisonbennett", "name": "Jamison Bennett"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/74d89f02ae45ff4602379d69fc8f59e2f0cb5146", "committedDate": "2020-08-14T18:58:05Z", "message": "CB-8401: Add the operation ID to the FreeIPA logs\n\nAdd the operation ID to the FreeIPA logs for repair.\n\nChange the user sync to use the operationId for the operation ID\nrather than the flowId.\n\nEnsure the MDC cleanup happens if an exception is thrown.\n\nThis was tested using a local deployment of cloudbreak."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "74d89f02ae45ff4602379d69fc8f59e2f0cb5146", "author": {"user": {"login": "jamisonbennett", "name": "Jamison Bennett"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/74d89f02ae45ff4602379d69fc8f59e2f0cb5146", "committedDate": "2020-08-14T18:58:05Z", "message": "CB-8401: Add the operation ID to the FreeIPA logs\n\nAdd the operation ID to the FreeIPA logs for repair.\n\nChange the user sync to use the operationId for the operation ID\nrather than the flowId.\n\nEnsure the MDC cleanup happens if an exception is thrown.\n\nThis was tested using a local deployment of cloudbreak."}, "afterCommit": {"oid": "041b5e226bc017cd1f10627ebbb930831107316e", "author": {"user": {"login": "jamisonbennett", "name": "Jamison Bennett"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/041b5e226bc017cd1f10627ebbb930831107316e", "committedDate": "2020-08-24T14:21:55Z", "message": "CB-8401: Add the operation ID to the FreeIPA logs\n\nAdd the operation ID to the FreeIPA logs for repair.\n\nChange the user sync to use the operationId for the operation ID\nrather than the flowId.\n\nEnsure the MDC cleanup happens if an exception is thrown.\n\nThis was tested using a local deployment of cloudbreak."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7fd53ed6b6b7e501aeec466ab8b21a30f245250f", "author": {"user": {"login": "jamisonbennett", "name": "Jamison Bennett"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/7fd53ed6b6b7e501aeec466ab8b21a30f245250f", "committedDate": "2020-08-24T14:53:24Z", "message": "CB-8401: Add the operation ID to the FreeIPA logs\n\nAdd the operation ID to the FreeIPA logs for repair.\n\nChange the user sync to use the operationId for the operation ID\nrather than the flowId.\n\nEnsure the MDC cleanup happens if an exception is thrown.\n\nThis was tested using a local deployment of cloudbreak."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "041b5e226bc017cd1f10627ebbb930831107316e", "author": {"user": {"login": "jamisonbennett", "name": "Jamison Bennett"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/041b5e226bc017cd1f10627ebbb930831107316e", "committedDate": "2020-08-24T14:21:55Z", "message": "CB-8401: Add the operation ID to the FreeIPA logs\n\nAdd the operation ID to the FreeIPA logs for repair.\n\nChange the user sync to use the operationId for the operation ID\nrather than the flowId.\n\nEnsure the MDC cleanup happens if an exception is thrown.\n\nThis was tested using a local deployment of cloudbreak."}, "afterCommit": {"oid": "7fd53ed6b6b7e501aeec466ab8b21a30f245250f", "author": {"user": {"login": "jamisonbennett", "name": "Jamison Bennett"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/7fd53ed6b6b7e501aeec466ab8b21a30f245250f", "committedDate": "2020-08-24T14:53:24Z", "message": "CB-8401: Add the operation ID to the FreeIPA logs\n\nAdd the operation ID to the FreeIPA logs for repair.\n\nChange the user sync to use the operationId for the operation ID\nrather than the flowId.\n\nEnsure the MDC cleanup happens if an exception is thrown.\n\nThis was tested using a local deployment of cloudbreak."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2473, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}