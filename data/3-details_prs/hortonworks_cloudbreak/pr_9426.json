{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIwNDMzODkx", "number": 9426, "title": "CB-9480 Authorize POST list endpoints", "bodyText": "Real UMS test:\nhttp://ci-cloudbreak.eng.hortonworks.com/job/cloudbreak-real-ums-test/2021/", "createdAt": "2020-11-13T08:32:12Z", "url": "https://github.com/hortonworks/cloudbreak/pull/9426", "merged": true, "mergeCommit": {"oid": "a445f97c2dcf1110ec8d7724d5e1ba81c3a11168"}, "closed": true, "closedAt": "2020-11-20T12:04:51Z", "author": {"login": "foldik"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdcC-rPgBqjM5OTIzODE1ODg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdeVOU0gFqTUzNTMyNzU5NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ee27da00e4e1c354d6c0e146904058ac22330f0c", "author": {"user": {"login": "foldik", "name": "Attila Kristof Foldi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/ee27da00e4e1c354d6c0e146904058ac22330f0c", "committedDate": "2020-11-13T08:29:22Z", "message": "CB-9480 Refactor authorization framework internal logic to collect what and how to authorrize, then call UMS once for recource based authorization"}, "afterCommit": {"oid": "3918049ddd9d48de07ed641c282984ae404e6491", "author": {"user": {"login": "foldik", "name": "Attila Kristof Foldi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/3918049ddd9d48de07ed641c282984ae404e6491", "committedDate": "2020-11-13T08:34:19Z", "message": "CB-9480 Refactor authorization framework internal logic to collect what and how to authorrize, then call UMS once for recource based authorization"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3918049ddd9d48de07ed641c282984ae404e6491", "author": {"user": {"login": "foldik", "name": "Attila Kristof Foldi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/3918049ddd9d48de07ed641c282984ae404e6491", "committedDate": "2020-11-13T08:34:19Z", "message": "CB-9480 Refactor authorization framework internal logic to collect what and how to authorrize, then call UMS once for recource based authorization"}, "afterCommit": {"oid": "90eb4e28223b1cc6b408723c77dcb84742d2e939", "author": {"user": {"login": "foldik", "name": "Attila Kristof Foldi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/90eb4e28223b1cc6b408723c77dcb84742d2e939", "committedDate": "2020-11-13T10:04:05Z", "message": "CB-9480 Refactor authorization framework internal logic to collect what and how to authorrize, then call UMS once for recource based authorization"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "90eb4e28223b1cc6b408723c77dcb84742d2e939", "author": {"user": {"login": "foldik", "name": "Attila Kristof Foldi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/90eb4e28223b1cc6b408723c77dcb84742d2e939", "committedDate": "2020-11-13T10:04:05Z", "message": "CB-9480 Refactor authorization framework internal logic to collect what and how to authorrize, then call UMS once for recource based authorization"}, "afterCommit": {"oid": "ab91aed063ea6583180cdf5b038058595a30c018", "author": {"user": {"login": "foldik", "name": "Attila Kristof Foldi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/ab91aed063ea6583180cdf5b038058595a30c018", "committedDate": "2020-11-13T16:00:46Z", "message": "CB-9480 Refactor authorization framework internal logic to collect what and how to authorrize, then call UMS once for recource based authorization"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ffc11651f2fe6f05755a97f1e807305f3cb8024e", "author": {"user": {"login": "foldik", "name": "Attila Kristof Foldi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/ffc11651f2fe6f05755a97f1e807305f3cb8024e", "committedDate": "2020-11-16T08:19:23Z", "message": "CB-9480 Authorization documentation"}, "afterCommit": {"oid": "7a8cbada574dc5e10cbc8f7934e54729292d29d9", "author": {"user": {"login": "foldik", "name": "Attila Kristof Foldi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/7a8cbada574dc5e10cbc8f7934e54729292d29d9", "committedDate": "2020-11-16T08:32:58Z", "message": "CB-9480 Refactor authorization framework internal logic to collect what and how to authorrize, then call UMS once for recource based authorization"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7a8cbada574dc5e10cbc8f7934e54729292d29d9", "author": {"user": {"login": "foldik", "name": "Attila Kristof Foldi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/7a8cbada574dc5e10cbc8f7934e54729292d29d9", "committedDate": "2020-11-16T08:32:58Z", "message": "CB-9480 Refactor authorization framework internal logic to collect what and how to authorrize, then call UMS once for recource based authorization"}, "afterCommit": {"oid": "ea49a08770bc751c933e0daa5be0f494ed67bf9f", "author": {"user": {"login": "foldik", "name": "Attila Kristof Foldi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/ea49a08770bc751c933e0daa5be0f494ed67bf9f", "committedDate": "2020-11-17T15:26:22Z", "message": "CB-9480 Refactor authorization framework internal logic to collect what and how to authorrize, then call UMS once for recource based authorization"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ea49a08770bc751c933e0daa5be0f494ed67bf9f", "author": {"user": {"login": "foldik", "name": "Attila Kristof Foldi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/ea49a08770bc751c933e0daa5be0f494ed67bf9f", "committedDate": "2020-11-17T15:26:22Z", "message": "CB-9480 Refactor authorization framework internal logic to collect what and how to authorrize, then call UMS once for recource based authorization"}, "afterCommit": {"oid": "ce3115e8aca35eca8b4c6eddc74e5fe652fea665", "author": {"user": {"login": "foldik", "name": "Attila Kristof Foldi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/ce3115e8aca35eca8b4c6eddc74e5fe652fea665", "committedDate": "2020-11-17T15:52:41Z", "message": "CB-9480 Refactor authorization framework internal logic to collect what and how to authorrize, then call UMS once for recource based authorization"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ce3115e8aca35eca8b4c6eddc74e5fe652fea665", "author": {"user": {"login": "foldik", "name": "Attila Kristof Foldi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/ce3115e8aca35eca8b4c6eddc74e5fe652fea665", "committedDate": "2020-11-17T15:52:41Z", "message": "CB-9480 Refactor authorization framework internal logic to collect what and how to authorrize, then call UMS once for recource based authorization"}, "afterCommit": {"oid": "1d90eef3b95aa23ae83858e9f0ec6f9daf023316", "author": {"user": {"login": "foldik", "name": "Attila Kristof Foldi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/1d90eef3b95aa23ae83858e9f0ec6f9daf023316", "committedDate": "2020-11-18T14:33:53Z", "message": "CB-9480 Refactor authorization framework internal logic to collect what and how to authorrize, then call UMS once for recource based authorization"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1d90eef3b95aa23ae83858e9f0ec6f9daf023316", "author": {"user": {"login": "foldik", "name": "Attila Kristof Foldi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/1d90eef3b95aa23ae83858e9f0ec6f9daf023316", "committedDate": "2020-11-18T14:33:53Z", "message": "CB-9480 Refactor authorization framework internal logic to collect what and how to authorrize, then call UMS once for recource based authorization"}, "afterCommit": {"oid": "39c91f1b4dd92c8e33e0a73e9af4c4adcfe1b2fa", "author": {"user": {"login": "foldik", "name": "Attila Kristof Foldi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/39c91f1b4dd92c8e33e0a73e9af4c4adcfe1b2fa", "committedDate": "2020-11-18T16:49:59Z", "message": "CB-9480 Refactor authorization framework internal logic to collect what and how to authorrize, then call UMS once for recource based authorization"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "39c91f1b4dd92c8e33e0a73e9af4c4adcfe1b2fa", "author": {"user": {"login": "foldik", "name": "Attila Kristof Foldi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/39c91f1b4dd92c8e33e0a73e9af4c4adcfe1b2fa", "committedDate": "2020-11-18T16:49:59Z", "message": "CB-9480 Refactor authorization framework internal logic to collect what and how to authorrize, then call UMS once for recource based authorization"}, "afterCommit": {"oid": "093fa8269140b8cb8346863eb6d6d48d050bd046", "author": {"user": {"login": "foldik", "name": "Attila Kristof Foldi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/093fa8269140b8cb8346863eb6d6d48d050bd046", "committedDate": "2020-11-19T06:42:43Z", "message": "CB-9480 Refactor authorization framework internal logic to collect what and how to authorrize, then call UMS once for recource based authorization"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM0Mjg0MDQ5", "url": "https://github.com/hortonworks/cloudbreak/pull/9426#pullrequestreview-534284049", "createdAt": "2020-11-19T10:35:32Z", "commit": {"oid": "093fa8269140b8cb8346863eb6d6d48d050bd046"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxMDozNTozMlrOH2WsbA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxMDo0OToxM1rOH2XO7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjc1Njk3Mg==", "bodyText": "Maybe you should consider to rename these classes. They make sense for devs who is in the development of this feature, but other devs won't understand it at first. These names And, Or, etc. are very general. The same applies for Authorization interface.", "url": "https://github.com/hortonworks/cloudbreak/pull/9426#discussion_r526756972", "createdAt": "2020-11-19T10:35:32Z", "author": {"login": "horadla23"}, "path": "authorization-common/src/main/java/com/sequenceiq/authorization/service/model/And.java", "diffHunk": "@@ -0,0 +1,95 @@\n+package com.sequenceiq.authorization.service.model;\n+\n+import static java.util.stream.Collectors.joining;\n+import static java.util.stream.Collectors.toList;\n+\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.Objects;\n+import java.util.Optional;\n+import java.util.function.BiConsumer;\n+import java.util.function.Function;\n+import java.util.stream.Collectors;\n+\n+import com.sequenceiq.authorization.resource.AuthorizationResourceAction;\n+\n+public class And implements Authorization {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "093fa8269140b8cb8346863eb6d6d48d050bd046"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjc1ODUwNw==", "bodyText": "I am not sure if this is needed, we have StackView and StackApiView also.", "url": "https://github.com/hortonworks/cloudbreak/pull/9426#discussion_r526758507", "createdAt": "2020-11-19T10:38:03Z", "author": {"login": "horadla23"}, "path": "core-model/src/main/java/com/sequenceiq/cloudbreak/domain/projection/StackCrnView.java", "diffHunk": "@@ -0,0 +1,8 @@\n+package com.sequenceiq.cloudbreak.domain.projection;\n+\n+public interface StackCrnView {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "093fa8269140b8cb8346863eb6d6d48d050bd046"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjc1ODcyNg==", "bodyText": "same here, maybe we should move this into StackViewRepository", "url": "https://github.com/hortonworks/cloudbreak/pull/9426#discussion_r526758726", "createdAt": "2020-11-19T10:38:23Z", "author": {"login": "horadla23"}, "path": "core/src/main/java/com/sequenceiq/cloudbreak/repository/StackRepository.java", "diffHunk": "@@ -198,6 +199,12 @@\n     @Query(\"SELECT s FROM Stack s WHERE s.resourceCrn = :crn\")\n     Optional<Stack> findByResourceCrn(@Param(\"crn\") String crn);\n \n+    @Query(\"SELECT s.environmentCrn FROM Stack s WHERE s.resourceCrn = :crn\")\n+    Optional<String> findEnvCrnByResourceCrn(@Param(\"crn\") String crn);\n+\n+    @Query(\"SELECT s.resourceCrn as resourceCrn, s.environmentCrn as environmentCrn FROM Stack s WHERE s.resourceCrn IN (:crns)\")\n+    List<StackCrnView> findAllByResourceCrn(@Param(\"crns\") Set<String> crn);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "093fa8269140b8cb8346863eb6d6d48d050bd046"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjc2NTgwNw==", "bodyText": "'with' not needed in the method name i guess", "url": "https://github.com/hortonworks/cloudbreak/pull/9426#discussion_r526765807", "createdAt": "2020-11-19T10:49:13Z", "author": {"login": "horadla23"}, "path": "authorization-common/src/main/java/com/sequenceiq/authorization/service/ResourceBasedCrnProvider.java", "diffHunk": "@@ -25,5 +27,9 @@ default String getResourceCrnByResourceName(String resourceName) {\n         return Optional.empty();\n     }\n \n+    default Map<String, Optional<String>> getWithEnvironmentCrnsByResourceCrns(Collection<String> resourceCrns) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "093fa8269140b8cb8346863eb6d6d48d050bd046"}, "originalPosition": 13}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "093fa8269140b8cb8346863eb6d6d48d050bd046", "author": {"user": {"login": "foldik", "name": "Attila Kristof Foldi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/093fa8269140b8cb8346863eb6d6d48d050bd046", "committedDate": "2020-11-19T06:42:43Z", "message": "CB-9480 Refactor authorization framework internal logic to collect what and how to authorrize, then call UMS once for recource based authorization"}, "afterCommit": {"oid": "9be6a4d7253c527f72619ffccedbeeff73117434", "author": {"user": {"login": "foldik", "name": "Attila Kristof Foldi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/9be6a4d7253c527f72619ffccedbeeff73117434", "committedDate": "2020-11-19T12:21:20Z", "message": "CB-9480 Refactor authorization framework internal logic to collect what and how to authorrize, then call UMS once for recource based authorization"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c9b7cf52b5994dc7d325009b133be0b2c7fa5f04", "author": {"user": {"login": "foldik", "name": "Attila Kristof Foldi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/c9b7cf52b5994dc7d325009b133be0b2c7fa5f04", "committedDate": "2020-11-19T15:52:04Z", "message": "CB-9480 Refactor authorization framework internal logic to collect what and how to authorrize, then call UMS once for recource based authorization"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9be6a4d7253c527f72619ffccedbeeff73117434", "author": {"user": {"login": "foldik", "name": "Attila Kristof Foldi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/9be6a4d7253c527f72619ffccedbeeff73117434", "committedDate": "2020-11-19T12:21:20Z", "message": "CB-9480 Refactor authorization framework internal logic to collect what and how to authorrize, then call UMS once for recource based authorization"}, "afterCommit": {"oid": "c9b7cf52b5994dc7d325009b133be0b2c7fa5f04", "author": {"user": {"login": "foldik", "name": "Attila Kristof Foldi"}}, "url": "https://github.com/hortonworks/cloudbreak/commit/c9b7cf52b5994dc7d325009b133be0b2c7fa5f04", "committedDate": "2020-11-19T15:52:04Z", "message": "CB-9480 Refactor authorization framework internal logic to collect what and how to authorrize, then call UMS once for recource based authorization"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1Mjc5OTk5", "url": "https://github.com/hortonworks/cloudbreak/pull/9426#pullrequestreview-535279999", "createdAt": "2020-11-20T09:53:47Z", "commit": {"oid": "c9b7cf52b5994dc7d325009b133be0b2c7fa5f04"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1MzI3NTk0", "url": "https://github.com/hortonworks/cloudbreak/pull/9426#pullrequestreview-535327594", "createdAt": "2020-11-20T10:58:37Z", "commit": {"oid": "c9b7cf52b5994dc7d325009b133be0b2c7fa5f04"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2114, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}