{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAwNTY0NjUz", "number": 9188, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQxMjo1ODozNVrOEsCYTQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMVQxNTo1Mjo0NFrOEsZW3w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE0NjExNzg5OnYy", "diffSide": "RIGHT", "path": "authorization-common-api/src/main/java/com/sequenceiq/authorization/resource/AuthorizationResourceAction.java", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQxMjo1ODozNVrOHfInYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQxNzowMTowOVrOHfR4vg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjQwOTA1OQ==", "bodyText": "Should we call it rotateTlsCertDatalake instead? The reason I'm challenging this is that we will have other certs that need to be rotated as well. We already have the let's encrypt certs and soon we will have Database certs.", "url": "https://github.com/hortonworks/cloudbreak/pull/9188#discussion_r502409059", "createdAt": "2020-10-09T12:58:35Z", "author": {"login": "keyki"}, "path": "authorization-common-api/src/main/java/com/sequenceiq/authorization/resource/AuthorizationResourceAction.java", "diffHunk": "@@ -45,6 +45,7 @@\n     START_DATALAKE(\"datalake/startDatalake\", AuthorizationResourceType.DATALAKE),\n     STOP_DATALAKE(\"datalake/stopDatalake\", AuthorizationResourceType.DATALAKE),\n     UPGRADE_DATALAKE(\"datalake/upgradeDatalake\", AuthorizationResourceType.DATALAKE),\n+    ROTATE_CERT_DATALAKE(\"datalake/rotateCertDatalake\", AuthorizationResourceType.DATALAKE),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "987d2cc4030f9173e1d8f6a909639ef007e5692f"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjQyMTMwMQ==", "bodyText": "renamed", "url": "https://github.com/hortonworks/cloudbreak/pull/9188#discussion_r502421301", "createdAt": "2020-10-09T13:19:25Z", "author": {"login": "lacikaaa"}, "path": "authorization-common-api/src/main/java/com/sequenceiq/authorization/resource/AuthorizationResourceAction.java", "diffHunk": "@@ -45,6 +45,7 @@\n     START_DATALAKE(\"datalake/startDatalake\", AuthorizationResourceType.DATALAKE),\n     STOP_DATALAKE(\"datalake/stopDatalake\", AuthorizationResourceType.DATALAKE),\n     UPGRADE_DATALAKE(\"datalake/upgradeDatalake\", AuthorizationResourceType.DATALAKE),\n+    ROTATE_CERT_DATALAKE(\"datalake/rotateCertDatalake\", AuthorizationResourceType.DATALAKE),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjQwOTA1OQ=="}, "originalCommit": {"oid": "987d2cc4030f9173e1d8f6a909639ef007e5692f"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjQzNjA1NQ==", "bodyText": "please update legacyRights.json also", "url": "https://github.com/hortonworks/cloudbreak/pull/9188#discussion_r502436055", "createdAt": "2020-10-09T13:42:58Z", "author": {"login": "sodre90"}, "path": "authorization-common-api/src/main/java/com/sequenceiq/authorization/resource/AuthorizationResourceAction.java", "diffHunk": "@@ -45,6 +45,7 @@\n     START_DATALAKE(\"datalake/startDatalake\", AuthorizationResourceType.DATALAKE),\n     STOP_DATALAKE(\"datalake/stopDatalake\", AuthorizationResourceType.DATALAKE),\n     UPGRADE_DATALAKE(\"datalake/upgradeDatalake\", AuthorizationResourceType.DATALAKE),\n+    ROTATE_CERT_DATALAKE(\"datalake/rotateCertDatalake\", AuthorizationResourceType.DATALAKE),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjQwOTA1OQ=="}, "originalCommit": {"oid": "987d2cc4030f9173e1d8f6a909639ef007e5692f"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjQ3ODk0MQ==", "bodyText": "right, I will upload with the unit tests", "url": "https://github.com/hortonworks/cloudbreak/pull/9188#discussion_r502478941", "createdAt": "2020-10-09T14:45:23Z", "author": {"login": "lacikaaa"}, "path": "authorization-common-api/src/main/java/com/sequenceiq/authorization/resource/AuthorizationResourceAction.java", "diffHunk": "@@ -45,6 +45,7 @@\n     START_DATALAKE(\"datalake/startDatalake\", AuthorizationResourceType.DATALAKE),\n     STOP_DATALAKE(\"datalake/stopDatalake\", AuthorizationResourceType.DATALAKE),\n     UPGRADE_DATALAKE(\"datalake/upgradeDatalake\", AuthorizationResourceType.DATALAKE),\n+    ROTATE_CERT_DATALAKE(\"datalake/rotateCertDatalake\", AuthorizationResourceType.DATALAKE),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjQwOTA1OQ=="}, "originalCommit": {"oid": "987d2cc4030f9173e1d8f6a909639ef007e5692f"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjU2MDk1OA==", "bodyText": "updated and unit test added", "url": "https://github.com/hortonworks/cloudbreak/pull/9188#discussion_r502560958", "createdAt": "2020-10-09T17:01:09Z", "author": {"login": "lacikaaa"}, "path": "authorization-common-api/src/main/java/com/sequenceiq/authorization/resource/AuthorizationResourceAction.java", "diffHunk": "@@ -45,6 +45,7 @@\n     START_DATALAKE(\"datalake/startDatalake\", AuthorizationResourceType.DATALAKE),\n     STOP_DATALAKE(\"datalake/stopDatalake\", AuthorizationResourceType.DATALAKE),\n     UPGRADE_DATALAKE(\"datalake/upgradeDatalake\", AuthorizationResourceType.DATALAKE),\n+    ROTATE_CERT_DATALAKE(\"datalake/rotateCertDatalake\", AuthorizationResourceType.DATALAKE),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjQwOTA1OQ=="}, "originalCommit": {"oid": "987d2cc4030f9173e1d8f6a909639ef007e5692f"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE0NjEyMDc0OnYy", "diffSide": "RIGHT", "path": "datalake/src/main/java/com/sequenceiq/datalake/service/sdx/cert/CertRotationService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQxMjo1OToyNFrOHfIpOg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOVQxNzowMToyNVrOHfR5Vg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjQwOTUzMA==", "bodyText": "please add unit test for this", "url": "https://github.com/hortonworks/cloudbreak/pull/9188#discussion_r502409530", "createdAt": "2020-10-09T12:59:24Z", "author": {"login": "horadla23"}, "path": "datalake/src/main/java/com/sequenceiq/datalake/service/sdx/cert/CertRotationService.java", "diffHunk": "@@ -0,0 +1,164 @@\n+package com.sequenceiq.datalake.service.sdx.cert;\n+\n+import static com.sequenceiq.datalake.service.sdx.CloudbreakFlowService.FlowState.FINISHED;\n+import static com.sequenceiq.datalake.service.sdx.CloudbreakFlowService.FlowState.RUNNING;\n+\n+import java.util.Collections;\n+\n+import javax.inject.Inject;\n+import javax.ws.rs.NotFoundException;\n+import javax.ws.rs.WebApplicationException;\n+\n+import org.apache.commons.lang3.StringUtils;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.stereotype.Service;\n+\n+import com.dyngr.Polling;\n+import com.dyngr.core.AttemptResult;\n+import com.dyngr.core.AttemptResults;\n+import com.fasterxml.jackson.core.JsonProcessingException;\n+import com.sequenceiq.cloudbreak.api.endpoint.v4.common.Status;\n+import com.sequenceiq.cloudbreak.api.endpoint.v4.stacks.StackV4Endpoint;\n+import com.sequenceiq.cloudbreak.api.endpoint.v4.stacks.request.CertificatesRotationV4Request;\n+import com.sequenceiq.cloudbreak.api.endpoint.v4.stacks.response.CertificatesRotationV4Response;\n+import com.sequenceiq.cloudbreak.api.endpoint.v4.stacks.response.StackV4Response;\n+import com.sequenceiq.cloudbreak.api.endpoint.v4.stacks.response.cluster.ClusterV4Response;\n+import com.sequenceiq.cloudbreak.auth.ThreadBasedUserCrnProvider;\n+import com.sequenceiq.cloudbreak.cloud.scheduler.PollGroup;\n+import com.sequenceiq.cloudbreak.common.exception.WebApplicationExceptionMessageExtractor;\n+import com.sequenceiq.cloudbreak.common.json.JsonUtil;\n+import com.sequenceiq.cloudbreak.event.ResourceEvent;\n+import com.sequenceiq.cloudbreak.logger.MDCBuilder;\n+import com.sequenceiq.datalake.entity.DatalakeStatusEnum;\n+import com.sequenceiq.datalake.entity.SdxCluster;\n+import com.sequenceiq.datalake.flow.SdxReactorFlowManager;\n+import com.sequenceiq.datalake.flow.cert.rotation.event.SdxStartCertRotationEvent;\n+import com.sequenceiq.datalake.flow.statestore.DatalakeInMemoryStateStore;\n+import com.sequenceiq.datalake.service.sdx.CloudbreakFlowService;\n+import com.sequenceiq.datalake.service.sdx.CloudbreakFlowService.FlowState;\n+import com.sequenceiq.datalake.service.sdx.PollingConfig;\n+import com.sequenceiq.datalake.service.sdx.SdxService;\n+import com.sequenceiq.datalake.service.sdx.status.AvailabilityChecker;\n+import com.sequenceiq.datalake.service.sdx.status.SdxStatusService;\n+import com.sequenceiq.flow.api.model.FlowIdentifier;\n+\n+@Service\n+public class CertRotationService {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "987d2cc4030f9173e1d8f6a909639ef007e5692f"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjU2MTExMA==", "bodyText": "I have added some unit tests", "url": "https://github.com/hortonworks/cloudbreak/pull/9188#discussion_r502561110", "createdAt": "2020-10-09T17:01:25Z", "author": {"login": "lacikaaa"}, "path": "datalake/src/main/java/com/sequenceiq/datalake/service/sdx/cert/CertRotationService.java", "diffHunk": "@@ -0,0 +1,164 @@\n+package com.sequenceiq.datalake.service.sdx.cert;\n+\n+import static com.sequenceiq.datalake.service.sdx.CloudbreakFlowService.FlowState.FINISHED;\n+import static com.sequenceiq.datalake.service.sdx.CloudbreakFlowService.FlowState.RUNNING;\n+\n+import java.util.Collections;\n+\n+import javax.inject.Inject;\n+import javax.ws.rs.NotFoundException;\n+import javax.ws.rs.WebApplicationException;\n+\n+import org.apache.commons.lang3.StringUtils;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.stereotype.Service;\n+\n+import com.dyngr.Polling;\n+import com.dyngr.core.AttemptResult;\n+import com.dyngr.core.AttemptResults;\n+import com.fasterxml.jackson.core.JsonProcessingException;\n+import com.sequenceiq.cloudbreak.api.endpoint.v4.common.Status;\n+import com.sequenceiq.cloudbreak.api.endpoint.v4.stacks.StackV4Endpoint;\n+import com.sequenceiq.cloudbreak.api.endpoint.v4.stacks.request.CertificatesRotationV4Request;\n+import com.sequenceiq.cloudbreak.api.endpoint.v4.stacks.response.CertificatesRotationV4Response;\n+import com.sequenceiq.cloudbreak.api.endpoint.v4.stacks.response.StackV4Response;\n+import com.sequenceiq.cloudbreak.api.endpoint.v4.stacks.response.cluster.ClusterV4Response;\n+import com.sequenceiq.cloudbreak.auth.ThreadBasedUserCrnProvider;\n+import com.sequenceiq.cloudbreak.cloud.scheduler.PollGroup;\n+import com.sequenceiq.cloudbreak.common.exception.WebApplicationExceptionMessageExtractor;\n+import com.sequenceiq.cloudbreak.common.json.JsonUtil;\n+import com.sequenceiq.cloudbreak.event.ResourceEvent;\n+import com.sequenceiq.cloudbreak.logger.MDCBuilder;\n+import com.sequenceiq.datalake.entity.DatalakeStatusEnum;\n+import com.sequenceiq.datalake.entity.SdxCluster;\n+import com.sequenceiq.datalake.flow.SdxReactorFlowManager;\n+import com.sequenceiq.datalake.flow.cert.rotation.event.SdxStartCertRotationEvent;\n+import com.sequenceiq.datalake.flow.statestore.DatalakeInMemoryStateStore;\n+import com.sequenceiq.datalake.service.sdx.CloudbreakFlowService;\n+import com.sequenceiq.datalake.service.sdx.CloudbreakFlowService.FlowState;\n+import com.sequenceiq.datalake.service.sdx.PollingConfig;\n+import com.sequenceiq.datalake.service.sdx.SdxService;\n+import com.sequenceiq.datalake.service.sdx.status.AvailabilityChecker;\n+import com.sequenceiq.datalake.service.sdx.status.SdxStatusService;\n+import com.sequenceiq.flow.api.model.FlowIdentifier;\n+\n+@Service\n+public class CertRotationService {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjQwOTUzMA=="}, "originalCommit": {"oid": "987d2cc4030f9173e1d8f6a909639ef007e5692f"}, "originalPosition": 47}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE0OTg4MjU1OnYy", "diffSide": "RIGHT", "path": "core-api/src/main/java/com/sequenceiq/distrox/api/v1/distrox/endpoint/DistroXV1Endpoint.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMVQxNTo1Mjo0NFrOHfomFw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xMlQwNjo1NTozN1rOHfxQJw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjkzMzAxNQ==", "bodyText": "Should we call it rotate_autotls_certificates similarly to the permissions?", "url": "https://github.com/hortonworks/cloudbreak/pull/9188#discussion_r502933015", "createdAt": "2020-10-11T15:52:44Z", "author": {"login": "keyki"}, "path": "core-api/src/main/java/com/sequenceiq/distrox/api/v1/distrox/endpoint/DistroXV1Endpoint.java", "diffHunk": "@@ -359,4 +362,16 @@ void setClusterMaintenanceModeByCrn(@PathParam(\"crn\") String crn,\n     @ApiOperation(value = RENEW_CERTIFICATE, produces = MediaType.APPLICATION_JSON, notes = Notes.RENEW_CERTIFICATE_NOTES,\n             nickname = \"renewDistroXCertificate\")\n     FlowIdentifier renewCertificate(@PathParam(\"crn\") String crn);\n+\n+    @PUT\n+    @Path(\"name/{name}/rotate_certificates\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ab2813cce637831f2f2676d9d2560169db1e6008"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA3NDE0Mg==", "bodyText": "it's coming from StackV4Endpoint. I can change this, but then I think I would change in StackV4Endpoint too to keep them in sync. Shall I change them?", "url": "https://github.com/hortonworks/cloudbreak/pull/9188#discussion_r503074142", "createdAt": "2020-10-12T06:54:09Z", "author": {"login": "lacikaaa"}, "path": "core-api/src/main/java/com/sequenceiq/distrox/api/v1/distrox/endpoint/DistroXV1Endpoint.java", "diffHunk": "@@ -359,4 +362,16 @@ void setClusterMaintenanceModeByCrn(@PathParam(\"crn\") String crn,\n     @ApiOperation(value = RENEW_CERTIFICATE, produces = MediaType.APPLICATION_JSON, notes = Notes.RENEW_CERTIFICATE_NOTES,\n             nickname = \"renewDistroXCertificate\")\n     FlowIdentifier renewCertificate(@PathParam(\"crn\") String crn);\n+\n+    @PUT\n+    @Path(\"name/{name}/rotate_certificates\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjkzMzAxNQ=="}, "originalCommit": {"oid": "ab2813cce637831f2f2676d9d2560169db1e6008"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzA3NDg1NQ==", "bodyText": "yes, please.", "url": "https://github.com/hortonworks/cloudbreak/pull/9188#discussion_r503074855", "createdAt": "2020-10-12T06:55:37Z", "author": {"login": "keyki"}, "path": "core-api/src/main/java/com/sequenceiq/distrox/api/v1/distrox/endpoint/DistroXV1Endpoint.java", "diffHunk": "@@ -359,4 +362,16 @@ void setClusterMaintenanceModeByCrn(@PathParam(\"crn\") String crn,\n     @ApiOperation(value = RENEW_CERTIFICATE, produces = MediaType.APPLICATION_JSON, notes = Notes.RENEW_CERTIFICATE_NOTES,\n             nickname = \"renewDistroXCertificate\")\n     FlowIdentifier renewCertificate(@PathParam(\"crn\") String crn);\n+\n+    @PUT\n+    @Path(\"name/{name}/rotate_certificates\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjkzMzAxNQ=="}, "originalCommit": {"oid": "ab2813cce637831f2f2676d9d2560169db1e6008"}, "originalPosition": 23}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2123, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}