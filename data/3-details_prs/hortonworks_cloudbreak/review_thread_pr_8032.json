{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE3MjM1MTk0", "number": 8032, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNToyOTowMVrOD8HoGQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQwNzozMjozMVrOD8WzWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0MzY2MTA1OnYy", "diffSide": "RIGHT", "path": "cloud-azure/src/main/java/com/sequenceiq/cloudbreak/cloud/azure/connector/resource/AzureDatabaseResourceService.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNToyOTowMVrOGU3Oig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQwOToyNjozOVrOGVTxXA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDUyOTU0Ng==", "bodyText": "Why do we return only these two statuses?", "url": "https://github.com/hortonworks/cloudbreak/pull/8032#discussion_r424529546", "createdAt": "2020-05-13T15:29:01Z", "author": {"login": "gergopapi2"}, "path": "cloud-azure/src/main/java/com/sequenceiq/cloudbreak/cloud/azure/connector/resource/AzureDatabaseResourceService.java", "diffHunk": "@@ -141,5 +143,22 @@\n                 .name(resourceGroupName)\n                 .build(), ResourceStatus.DELETED));\n     }\n+\n+    public ExternalDatabaseStatus getDatabaseServerStatus(AuthenticatedContext ac, DatabaseStack stack) {\n+        CloudContext cloudContext = ac.getCloudContext();\n+        AzureClient client = ac.getParameter(AzureClient.class);\n+        String resourceGroupName = azureUtils.getResourceGroupName(cloudContext, stack);\n+\n+        try {\n+            ResourceGroup resourceGroup = client.getResourceGroup(resourceGroupName);\n+            if (resourceGroup == null) {\n+                return ExternalDatabaseStatus.DELETED;\n+            }\n+            return ExternalDatabaseStatus.STARTED;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ff94901cfe82a2d52768406dd213a614ff234a6a"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDk5NzIxMg==", "bodyText": "Because other ExternalDatabaseStatuses are irrelevant on Azure at this point. Azure does not support simple start/stop functionality like AWS.", "url": "https://github.com/hortonworks/cloudbreak/pull/8032#discussion_r424997212", "createdAt": "2020-05-14T09:26:39Z", "author": {"login": "pkedvessy"}, "path": "cloud-azure/src/main/java/com/sequenceiq/cloudbreak/cloud/azure/connector/resource/AzureDatabaseResourceService.java", "diffHunk": "@@ -141,5 +143,22 @@\n                 .name(resourceGroupName)\n                 .build(), ResourceStatus.DELETED));\n     }\n+\n+    public ExternalDatabaseStatus getDatabaseServerStatus(AuthenticatedContext ac, DatabaseStack stack) {\n+        CloudContext cloudContext = ac.getCloudContext();\n+        AzureClient client = ac.getParameter(AzureClient.class);\n+        String resourceGroupName = azureUtils.getResourceGroupName(cloudContext, stack);\n+\n+        try {\n+            ResourceGroup resourceGroup = client.getResourceGroup(resourceGroupName);\n+            if (resourceGroup == null) {\n+                return ExternalDatabaseStatus.DELETED;\n+            }\n+            return ExternalDatabaseStatus.STARTED;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDUyOTU0Ng=="}, "originalCommit": {"oid": "ff94901cfe82a2d52768406dd213a614ff234a6a"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY0NjE0NzQ0OnYy", "diffSide": "RIGHT", "path": "cloud-mock/src/main/java/com/sequenceiq/cloudbreak/cloud/mock/MockResourceConnector.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQwNzozMjozMVrOGVPg6g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQwOTozMTozMFrOGVT9Yg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDkyNzQ2Ng==", "bodyText": "Question: during a mock test is the status sync running? If yes, it might then break the test.", "url": "https://github.com/hortonworks/cloudbreak/pull/8032#discussion_r424927466", "createdAt": "2020-05-14T07:32:31Z", "author": {"login": "gergopapi2"}, "path": "cloud-mock/src/main/java/com/sequenceiq/cloudbreak/cloud/mock/MockResourceConnector.java", "diffHunk": "@@ -193,17 +193,17 @@ public String getDBStackTemplate() throws TemplatingDoesNotSupportedException {\n     }\n \n     @Override\n-    public void startDatabaseServer(AuthenticatedContext authenticatedContext, String dbInstanceIdentifier) {\n+    public void startDatabaseServer(AuthenticatedContext authenticatedContext, DatabaseStack stack) {\n         throw new UnsupportedOperationException(\"Database server start operation is not supported for \" + getClass().getName());\n     }\n \n     @Override\n-    public void stopDatabaseServer(AuthenticatedContext authenticatedContext, String dbInstanceIdentifier) {\n+    public void stopDatabaseServer(AuthenticatedContext authenticatedContext, DatabaseStack stack) {\n         throw new UnsupportedOperationException(\"Database server stop operation is not supported for \" + getClass().getName());\n     }\n \n     @Override\n-    public ExternalDatabaseStatus getDatabaseServerStatus(AuthenticatedContext authenticatedContext, String dbInstanceIdentifier) throws Exception {\n+    public ExternalDatabaseStatus getDatabaseServerStatus(AuthenticatedContext authenticatedContext, DatabaseStack stack) throws Exception {\n         throw new UnsupportedOperationException(\"Database server status lookup is not supported for \" + getClass().getName());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ff94901cfe82a2d52768406dd213a614ff234a6a"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTAwMDI5MA==", "bodyText": "Do you mean the exception might break the test? I don't think it is the case as I'm not aware of any breaking test in connection with this exception. It got introduced more than a month ago.", "url": "https://github.com/hortonworks/cloudbreak/pull/8032#discussion_r425000290", "createdAt": "2020-05-14T09:31:30Z", "author": {"login": "pkedvessy"}, "path": "cloud-mock/src/main/java/com/sequenceiq/cloudbreak/cloud/mock/MockResourceConnector.java", "diffHunk": "@@ -193,17 +193,17 @@ public String getDBStackTemplate() throws TemplatingDoesNotSupportedException {\n     }\n \n     @Override\n-    public void startDatabaseServer(AuthenticatedContext authenticatedContext, String dbInstanceIdentifier) {\n+    public void startDatabaseServer(AuthenticatedContext authenticatedContext, DatabaseStack stack) {\n         throw new UnsupportedOperationException(\"Database server start operation is not supported for \" + getClass().getName());\n     }\n \n     @Override\n-    public void stopDatabaseServer(AuthenticatedContext authenticatedContext, String dbInstanceIdentifier) {\n+    public void stopDatabaseServer(AuthenticatedContext authenticatedContext, DatabaseStack stack) {\n         throw new UnsupportedOperationException(\"Database server stop operation is not supported for \" + getClass().getName());\n     }\n \n     @Override\n-    public ExternalDatabaseStatus getDatabaseServerStatus(AuthenticatedContext authenticatedContext, String dbInstanceIdentifier) throws Exception {\n+    public ExternalDatabaseStatus getDatabaseServerStatus(AuthenticatedContext authenticatedContext, DatabaseStack stack) throws Exception {\n         throw new UnsupportedOperationException(\"Database server status lookup is not supported for \" + getClass().getName());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDkyNzQ2Ng=="}, "originalCommit": {"oid": "ff94901cfe82a2d52768406dd213a614ff234a6a"}, "originalPosition": 18}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2452, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}