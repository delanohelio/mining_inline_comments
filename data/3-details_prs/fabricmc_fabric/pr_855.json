{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQxNzIyNjY0", "number": 855, "title": "Fix tool attributes mining levels", "bodyText": "Currently mining levels are ignored in a few situations, namely when using a Dynamic tool and when using vanilla tools on modded blocks. Modded tools also behave differently on blocks they can't mine vs vanilla tools.\nThis PR fixes those bugs, the associated issues are #853 and #841", "createdAt": "2020-06-30T01:03:02Z", "url": "https://github.com/FabricMC/fabric/pull/855", "merged": true, "mergeCommit": {"oid": "d21d463561f1e4a33c5073389e3816da8372d4b6"}, "closed": true, "closedAt": "2020-07-24T15:24:51Z", "author": {"login": "Snakefangox"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcwKyrTgH2gAyNDQxNzIyNjY0OjdiODVkM2M5MjIwZTA2MjMwYWVhYTNiYzkxMDI2OWFiYTUwNzZmNTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc23GscgFqTQ1MTkxMDMwMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7b85d3c9220e06230aeaa3bc910269aba5076f59", "author": {"user": {"login": "Snakefangox", "name": "Snakefangox"}}, "url": "https://github.com/FabricMC/fabric/commit/7b85d3c9220e06230aeaa3bc910269aba5076f59", "committedDate": "2020-06-30T00:48:51Z", "message": "Decoupled effective checks and mining speed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d8a9adc20c8397f914d0070abae2914ceaa8726f", "author": {"user": {"login": "Snakefangox", "name": "Snakefangox"}}, "url": "https://github.com/FabricMC/fabric/commit/d8a9adc20c8397f914d0070abae2914ceaa8726f", "committedDate": "2020-06-30T00:49:05Z", "message": "Fixed typo"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM5NTk5NzEz", "url": "https://github.com/FabricMC/fabric/pull/855#pullrequestreview-439599713", "createdAt": "2020-06-30T01:04:42Z", "commit": {"oid": "d8a9adc20c8397f914d0070abae2914ceaa8726f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b2465337dc95efa928ba31cce1cbecfffc46bb9", "author": {"user": {"login": "Snakefangox", "name": "Snakefangox"}}, "url": "https://github.com/FabricMC/fabric/commit/8b2465337dc95efa928ba31cce1cbecfffc46bb9", "committedDate": "2020-06-30T01:19:00Z", "message": "Bump major for method sig change"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1a6818c8f88b4c9b81e5dfcbdab870ddc3b2aa9a", "author": {"user": {"login": "Snakefangox", "name": "Snakefangox"}}, "url": "https://github.com/FabricMC/fabric/commit/1a6818c8f88b4c9b81e5dfcbdab870ddc3b2aa9a", "committedDate": "2020-06-30T01:19:40Z", "message": "Fix semvar"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "48a85620cae6630e3fe85833ba9a8ce378d5f821", "author": {"user": {"login": "Snakefangox", "name": "Snakefangox"}}, "url": "https://github.com/FabricMC/fabric/commit/48a85620cae6630e3fe85833ba9a8ce378d5f821", "committedDate": "2020-06-30T20:31:37Z", "message": "Re-add original API method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "72b37cba8ee05d4ff8425f3cf106405817533998", "author": {"user": {"login": "Snakefangox", "name": "Snakefangox"}}, "url": "https://github.com/FabricMC/fabric/commit/72b37cba8ee05d4ff8425f3cf106405817533998", "committedDate": "2020-07-01T08:40:13Z", "message": "Extend test mod"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d2468989372e5cc48f2413bb92f36a0ef9ae095", "author": {"user": {"login": "Snakefangox", "name": "Snakefangox"}}, "url": "https://github.com/FabricMC/fabric/commit/9d2468989372e5cc48f2413bb92f36a0ef9ae095", "committedDate": "2020-07-01T08:40:26Z", "message": "Fix bug discovered by testing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3dc2c5ecb3373ef4f3c23e57bc4eee21dc7e5afa", "author": {"user": {"login": "Snakefangox", "name": "Snakefangox"}}, "url": "https://github.com/FabricMC/fabric/commit/3dc2c5ecb3373ef4f3c23e57bc4eee21dc7e5afa", "committedDate": "2020-07-09T22:37:32Z", "message": "Change current to vanillaResult, update doc for postProcessMiningSpeed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eba9186182bb1398ca84f2b39262dfb106c24752", "author": {"user": {"login": "Snakefangox", "name": "Snakefangox"}}, "url": "https://github.com/FabricMC/fabric/commit/eba9186182bb1398ca84f2b39262dfb106c24752", "committedDate": "2020-07-09T22:41:00Z", "message": "Remove </p> tag"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2MDE5Njky", "url": "https://github.com/FabricMC/fabric/pull/855#pullrequestreview-446019692", "createdAt": "2020-07-09T22:51:26Z", "commit": {"oid": "eba9186182bb1398ca84f2b39262dfb106c24752"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2MDc4ODU4", "url": "https://github.com/FabricMC/fabric/pull/855#pullrequestreview-446078858", "createdAt": "2020-07-10T02:10:25Z", "commit": {"oid": "eba9186182bb1398ca84f2b39262dfb106c24752"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2MjMwNjg0", "url": "https://github.com/FabricMC/fabric/pull/855#pullrequestreview-446230684", "createdAt": "2020-07-10T08:47:54Z", "commit": {"oid": "eba9186182bb1398ca84f2b39262dfb106c24752"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQwODo0Nzo1NVrOGvvPcw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQwOToxMToxMFrOGvwB-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjcxMDI1OQ==", "bodyText": "minor bikeshed but probably want to use the normal names? such as gravelBlock", "url": "https://github.com/FabricMC/fabric/pull/855#discussion_r452710259", "createdAt": "2020-07-10T08:47:55Z", "author": {"login": "shedaniel"}, "path": "fabric-tool-attribute-api-v1/src/testmod/java/net/fabricmc/fabric/test/tool/attribute/ToolAttributeTest.java", "diffHunk": "@@ -18,63 +18,122 @@\n \n import net.minecraft.block.Block;\n import net.minecraft.block.BlockState;\n+import net.minecraft.block.Blocks;\n+import net.minecraft.block.Material;\n import net.minecraft.block.MaterialColor;\n import net.minecraft.entity.LivingEntity;\n import net.minecraft.item.BlockItem;\n import net.minecraft.item.Item;\n import net.minecraft.item.ItemStack;\n+import net.minecraft.item.Items;\n+import net.minecraft.item.ToolItem;\n import net.minecraft.server.MinecraftServer;\n import net.minecraft.sound.BlockSoundGroup;\n import net.minecraft.tag.Tag;\n import net.minecraft.util.Identifier;\n import net.minecraft.util.registry.Registry;\n \n import net.fabricmc.api.ModInitializer;\n+import net.fabricmc.fabric.api.event.server.ServerTickCallback;\n import net.fabricmc.fabric.api.object.builder.v1.block.FabricBlockSettings;\n import net.fabricmc.fabric.api.object.builder.v1.block.FabricMaterialBuilder;\n import net.fabricmc.fabric.api.tool.attribute.v1.DynamicAttributeTool;\n import net.fabricmc.fabric.api.tool.attribute.v1.FabricToolTags;\n-import net.fabricmc.fabric.api.event.server.ServerTickCallback;\n \n public class ToolAttributeTest implements ModInitializer {\n-\tprivate boolean hasValidatedTags = false;\n+\tprivate static final float DEFAULT_BREAK_SPEED = 1.0F;\n+\tprivate static final float TOOL_BREAK_SPEED = 10.0F;\n+\n+\tprivate boolean hasValidated = false;\n+\n+\tBlock gravel_block;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eba9186182bb1398ca84f2b39262dfb106c24752"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjcyMzE5Mw==", "bodyText": "possibly want to test for vanilla tools for vanilla blocks", "url": "https://github.com/FabricMC/fabric/pull/855#discussion_r452723193", "createdAt": "2020-07-10T09:11:10Z", "author": {"login": "shedaniel"}, "path": "fabric-tool-attribute-api-v1/src/testmod/java/net/fabricmc/fabric/test/tool/attribute/ToolAttributeTest.java", "diffHunk": "@@ -18,63 +18,122 @@\n \n import net.minecraft.block.Block;\n import net.minecraft.block.BlockState;\n+import net.minecraft.block.Blocks;\n+import net.minecraft.block.Material;\n import net.minecraft.block.MaterialColor;\n import net.minecraft.entity.LivingEntity;\n import net.minecraft.item.BlockItem;\n import net.minecraft.item.Item;\n import net.minecraft.item.ItemStack;\n+import net.minecraft.item.Items;\n+import net.minecraft.item.ToolItem;\n import net.minecraft.server.MinecraftServer;\n import net.minecraft.sound.BlockSoundGroup;\n import net.minecraft.tag.Tag;\n import net.minecraft.util.Identifier;\n import net.minecraft.util.registry.Registry;\n \n import net.fabricmc.api.ModInitializer;\n+import net.fabricmc.fabric.api.event.server.ServerTickCallback;\n import net.fabricmc.fabric.api.object.builder.v1.block.FabricBlockSettings;\n import net.fabricmc.fabric.api.object.builder.v1.block.FabricMaterialBuilder;\n import net.fabricmc.fabric.api.tool.attribute.v1.DynamicAttributeTool;\n import net.fabricmc.fabric.api.tool.attribute.v1.FabricToolTags;\n-import net.fabricmc.fabric.api.event.server.ServerTickCallback;\n \n public class ToolAttributeTest implements ModInitializer {\n-\tprivate boolean hasValidatedTags = false;\n+\tprivate static final float DEFAULT_BREAK_SPEED = 1.0F;\n+\tprivate static final float TOOL_BREAK_SPEED = 10.0F;\n+\n+\tprivate boolean hasValidated = false;\n+\n+\tBlock gravel_block;\n+\tBlock stone_block;\n+\tItem test_shovel;\n+\tItem test_pickaxe;\n \n \t@Override\n \tpublic void onInitialize() {\n \t\t// Register a custom shovel that has a mining level of 2 (iron) dynamically.\n-\t\tRegistry.register(Registry.ITEM, new Identifier(\"fabric-tool-attribute-api-v1-testmod\", \"test_shovel\"), new TestShovel(new Item.Settings()));\n+\t\ttest_shovel = Registry.register(Registry.ITEM, new Identifier(\"fabric-tool-attribute-api-v1-testmod\", \"test_shovel\"), new TestTool(new Item.Settings(), FabricToolTags.SHOVELS));\n+\t\t//Register a custom pickaxe that has a mining level of 2 (iron) dynamically.\n+\t\ttest_pickaxe = Registry.register(Registry.ITEM, new Identifier(\"fabric-tool-attribute-api-v1-testmod\", \"test_pickaxe\"), new TestTool(new Item.Settings(), FabricToolTags.PICKAXES));\n \t\t// Register a block that requires a shovel that is as strong or stronger than an iron one.\n-\t\tBlock block = Registry.register(Registry.BLOCK, new Identifier(\"fabric-tool-attribute-api-v1-testmod\", \"hardened_block\"),\n+\t\tgravel_block = Registry.register(Registry.BLOCK, new Identifier(\"fabric-tool-attribute-api-v1-testmod\", \"hardened_gravel_block\"),\n \t\t\t\tnew Block(FabricBlockSettings.of(new FabricMaterialBuilder(MaterialColor.SAND).build(), MaterialColor.STONE)\n \t\t\t\t\t\t.breakByTool(FabricToolTags.SHOVELS, 2)\n \t\t\t\t\t\t.requiresTool()\n \t\t\t\t\t\t.strength(0.6F)\n \t\t\t\t\t\t.sounds(BlockSoundGroup.GRAVEL)));\n-\t\tRegistry.register(Registry.ITEM, new Identifier(\"fabric-tool-attribute-api-v1-testmod\", \"hardened_block\"), new BlockItem(block, new Item.Settings()));\n+\t\tRegistry.register(Registry.ITEM, new Identifier(\"fabric-tool-attribute-api-v1-testmod\", \"hardened_gravel_block\"), new BlockItem(gravel_block, new Item.Settings()));\n+\t\t// Register a block that requires a pickaxe that is as strong or stronger than an iron one.\n+\t\tstone_block = Registry.register(Registry.BLOCK, new Identifier(\"fabric-tool-attribute-api-v1-testmod\", \"hardened_stone_block\"),\n+\t\t\t\tnew Block(FabricBlockSettings.of(Material.STONE, MaterialColor.STONE)\n+\t\t\t\t\t\t.breakByTool(FabricToolTags.PICKAXES, 2)\n+\t\t\t\t\t\t.requiresTool()\n+\t\t\t\t\t\t.strength(0.6F)\n+\t\t\t\t\t\t.sounds(BlockSoundGroup.STONE)));\n+\t\tRegistry.register(Registry.ITEM, new Identifier(\"fabric-tool-attribute-api-v1-testmod\", \"hardened_stone_block\"), new BlockItem(stone_block, new Item.Settings()));\n \n-\t\tServerTickCallback.EVENT.register(this::validateTags);\n+\t\tServerTickCallback.EVENT.register(this::validate);\n \t}\n \n-\tprivate void validateTags(MinecraftServer server) {\n-\t\tif (hasValidatedTags) {\n+\tprivate void validate(MinecraftServer server) {\n+\t\tif (hasValidated) {\n \t\t\treturn;\n \t\t}\n \n-\t\thasValidatedTags = true;\n+\t\thasValidated = true;\n \n \t\tif (FabricToolTags.PICKAXES.values().isEmpty()) {\n \t\t\tthrow new AssertionError(\"Failed to load tool tags\");\n \t\t}\n+\n+\t\t//Test vanilla tools don't bypass fabric mining levels", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eba9186182bb1398ca84f2b39262dfb106c24752"}, "originalPosition": 83}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0a868a6922b182d3e3e90f2105aff5a10349c2fc", "author": {"user": {"login": "Snakefangox", "name": "Snakefangox"}}, "url": "https://github.com/FabricMC/fabric/commit/0a868a6922b182d3e3e90f2105aff5a10349c2fc", "committedDate": "2020-07-10T10:22:25Z", "message": "Add vanilla tests and rename vars"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2Mjk0MjE4", "url": "https://github.com/FabricMC/fabric/pull/855#pullrequestreview-446294218", "createdAt": "2020-07-10T10:25:57Z", "commit": {"oid": "0a868a6922b182d3e3e90f2105aff5a10349c2fc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwOTE0OTc4", "url": "https://github.com/FabricMC/fabric/pull/855#pullrequestreview-450914978", "createdAt": "2020-07-17T19:43:40Z", "commit": {"oid": "0a868a6922b182d3e3e90f2105aff5a10349c2fc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxMDI0ODQ4", "url": "https://github.com/FabricMC/fabric/pull/855#pullrequestreview-451024848", "createdAt": "2020-07-18T02:41:19Z", "commit": {"oid": "0a868a6922b182d3e3e90f2105aff5a10349c2fc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUxOTEwMzAw", "url": "https://github.com/FabricMC/fabric/pull/855#pullrequestreview-451910300", "createdAt": "2020-07-20T19:50:05Z", "commit": {"oid": "0a868a6922b182d3e3e90f2105aff5a10349c2fc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3583, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}