{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU3OTQ1NjI1", "number": 964, "reviewThreads": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxOToyNjozN1rOES9Igg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNjo0NzoxMlrOEd0cYw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4MzExNDI2OnYy", "diffSide": "RIGHT", "path": "fabric-item-api-v1/src/main/java/net/fabricmc/fabric/mixin/item/ItemStackMixin.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxOToyNjozN1rOG4bNfA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxOToyNjozN1rOG4bNfA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTgxOTI2MA==", "bodyText": "No need for else block here, drop the else half and just return amount.", "url": "https://github.com/FabricMC/fabric/pull/964#discussion_r461819260", "createdAt": "2020-07-28T19:26:37Z", "author": {"login": "i509VCB"}, "path": "fabric-item-api-v1/src/main/java/net/fabricmc/fabric/mixin/item/ItemStackMixin.java", "diffHunk": "@@ -0,0 +1,69 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.mixin.item;\n+\n+import java.util.function.Consumer;\n+\n+import org.spongepowered.asm.mixin.Mixin;\n+import org.spongepowered.asm.mixin.Shadow;\n+import org.spongepowered.asm.mixin.Unique;\n+import org.spongepowered.asm.mixin.injection.At;\n+import org.spongepowered.asm.mixin.injection.Inject;\n+import org.spongepowered.asm.mixin.injection.ModifyArg;\n+import org.spongepowered.asm.mixin.injection.callback.CallbackInfo;\n+\n+import net.minecraft.entity.LivingEntity;\n+import net.minecraft.item.Item;\n+import net.minecraft.item.ItemStack;\n+\n+import net.fabricmc.fabric.api.item.v1.CustomDamageHandler;\n+\n+@Mixin(ItemStack.class)\n+public abstract class ItemStackMixin {\n+\t@Shadow public abstract Item getItem();\n+\n+\t@Unique\n+\tprivate LivingEntity fabric_damagingEntity;\n+\n+\t@Unique\n+\tprivate Consumer<LivingEntity> fabric_breakCallback;\n+\n+\t@Inject(method = \"damage(ILnet/minecraft/entity/LivingEntity;Ljava/util/function/Consumer;)V\",\n+\t\t\tat = @At(\"HEAD\"))\n+\tprivate void saveDamager(int amount, LivingEntity entity, Consumer<LivingEntity> breakCallback, CallbackInfo ci) {\n+\t\tthis.fabric_damagingEntity = entity;\n+\t\tthis.fabric_breakCallback = breakCallback;\n+\t}\n+\n+\t@ModifyArg(method = \"damage(ILnet/minecraft/entity/LivingEntity;Ljava/util/function/Consumer;)V\",\n+\t\t\tat = @At(value = \"INVOKE\", target = \"Lnet/minecraft/item/ItemStack;damage(ILjava/util/Random;Lnet/minecraft/server/network/ServerPlayerEntity;)Z\"),\n+\t\t\tindex = 0)\n+\tprivate int hookDamage(int amount) {\n+\t\tif (getItem() instanceof CustomDamageHandler) {\n+\t\t\treturn ((CustomDamageHandler) getItem()).damage((ItemStack) (Object) this, amount, fabric_damagingEntity, fabric_breakCallback);\n+\t\t} else {\n+\t\t\treturn amount;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f42afd05e6eea04fd9595570dfd44ce9b09b5fff"}, "originalPosition": 59}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4MzEyMzUxOnYy", "diffSide": "RIGHT", "path": "fabric-item-api-v1/src/main/java/net/fabricmc/fabric/mixin/item/ItemStackMixin.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxOToyOToxOFrOG4bTOQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxOToyOToxOFrOG4bTOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTgyMDcyOQ==", "bodyText": "I very much disagree with modmuss's stance on keeping the entire mixin statement on one line, I may revisit this with a conventions document I'll propose in a few days.\nFor now I think modmuss wants these mixin annotations as one liners.", "url": "https://github.com/FabricMC/fabric/pull/964#discussion_r461820729", "createdAt": "2020-07-28T19:29:18Z", "author": {"login": "i509VCB"}, "path": "fabric-item-api-v1/src/main/java/net/fabricmc/fabric/mixin/item/ItemStackMixin.java", "diffHunk": "@@ -0,0 +1,69 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.mixin.item;\n+\n+import java.util.function.Consumer;\n+\n+import org.spongepowered.asm.mixin.Mixin;\n+import org.spongepowered.asm.mixin.Shadow;\n+import org.spongepowered.asm.mixin.Unique;\n+import org.spongepowered.asm.mixin.injection.At;\n+import org.spongepowered.asm.mixin.injection.Inject;\n+import org.spongepowered.asm.mixin.injection.ModifyArg;\n+import org.spongepowered.asm.mixin.injection.callback.CallbackInfo;\n+\n+import net.minecraft.entity.LivingEntity;\n+import net.minecraft.item.Item;\n+import net.minecraft.item.ItemStack;\n+\n+import net.fabricmc.fabric.api.item.v1.CustomDamageHandler;\n+\n+@Mixin(ItemStack.class)\n+public abstract class ItemStackMixin {\n+\t@Shadow public abstract Item getItem();\n+\n+\t@Unique\n+\tprivate LivingEntity fabric_damagingEntity;\n+\n+\t@Unique\n+\tprivate Consumer<LivingEntity> fabric_breakCallback;\n+\n+\t@Inject(method = \"damage(ILnet/minecraft/entity/LivingEntity;Ljava/util/function/Consumer;)V\",\n+\t\t\tat = @At(\"HEAD\"))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f42afd05e6eea04fd9595570dfd44ce9b09b5fff"}, "originalPosition": 46}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4MzI0MzE2OnYy", "diffSide": "RIGHT", "path": "fabric-item-api-v1/src/main/java/net/fabricmc/fabric/api/item/v1/CustomDamageHandler.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxOTo1NDoyM1rOG4cYPg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQyMDowMzowMVrOG4crQw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTgzODM5OA==", "bodyText": "consider documenting the break callback.", "url": "https://github.com/FabricMC/fabric/pull/964#discussion_r461838398", "createdAt": "2020-07-28T19:54:23Z", "author": {"login": "liach"}, "path": "fabric-item-api-v1/src/main/java/net/fabricmc/fabric/api/item/v1/CustomDamageHandler.java", "diffHunk": "@@ -0,0 +1,35 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.api.item.v1;\n+\n+import java.util.function.Consumer;\n+\n+import net.minecraft.entity.LivingEntity;\n+import net.minecraft.item.ItemStack;\n+\n+/**\n+ * Implement this interface on an item to run custom logic when {@link ItemStack#damage(int, LivingEntity, Consumer)} is called.\n+ */\n+public interface CustomDamageHandler {\n+\t/**\n+\t * Called to apply damage to the given stack.\n+\t * This can be used to e.g. drain from a battery before actually damaging the item\n+\t * @param amount The amount of damage originally requested\n+\t * @return The amount of damage to pass to vanilla's logic\n+\t */\n+\t<T extends LivingEntity> int damage(ItemStack stack, int amount, T entity, Consumer<T> breakCallback);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f42afd05e6eea04fd9595570dfd44ce9b09b5fff"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTg0MzI2Nw==", "bodyText": "it's the same as the one passed to the vanilla method, so i'll just put a see this", "url": "https://github.com/FabricMC/fabric/pull/964#discussion_r461843267", "createdAt": "2020-07-28T20:03:01Z", "author": {"login": "williewillus"}, "path": "fabric-item-api-v1/src/main/java/net/fabricmc/fabric/api/item/v1/CustomDamageHandler.java", "diffHunk": "@@ -0,0 +1,35 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.api.item.v1;\n+\n+import java.util.function.Consumer;\n+\n+import net.minecraft.entity.LivingEntity;\n+import net.minecraft.item.ItemStack;\n+\n+/**\n+ * Implement this interface on an item to run custom logic when {@link ItemStack#damage(int, LivingEntity, Consumer)} is called.\n+ */\n+public interface CustomDamageHandler {\n+\t/**\n+\t * Called to apply damage to the given stack.\n+\t * This can be used to e.g. drain from a battery before actually damaging the item\n+\t * @param amount The amount of damage originally requested\n+\t * @return The amount of damage to pass to vanilla's logic\n+\t */\n+\t<T extends LivingEntity> int damage(ItemStack stack, int amount, T entity, Consumer<T> breakCallback);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTgzODM5OA=="}, "originalCommit": {"oid": "f42afd05e6eea04fd9595570dfd44ce9b09b5fff"}, "originalPosition": 34}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4MzI0NTgwOnYy", "diffSide": "RIGHT", "path": "fabric-item-api-v1/src/main/java/net/fabricmc/fabric/mixin/item/ItemStackMixin.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxOTo1NTowOVrOG4cZ9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQyMTozNToxMFrOG4fwDw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTgzODgzOA==", "bodyText": "maybe keep the result of  getItem in a local var to reduce unnecessary calls if computations are made in getItem call", "url": "https://github.com/FabricMC/fabric/pull/964#discussion_r461838838", "createdAt": "2020-07-28T19:55:09Z", "author": {"login": "liach"}, "path": "fabric-item-api-v1/src/main/java/net/fabricmc/fabric/mixin/item/ItemStackMixin.java", "diffHunk": "@@ -0,0 +1,69 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.mixin.item;\n+\n+import java.util.function.Consumer;\n+\n+import org.spongepowered.asm.mixin.Mixin;\n+import org.spongepowered.asm.mixin.Shadow;\n+import org.spongepowered.asm.mixin.Unique;\n+import org.spongepowered.asm.mixin.injection.At;\n+import org.spongepowered.asm.mixin.injection.Inject;\n+import org.spongepowered.asm.mixin.injection.ModifyArg;\n+import org.spongepowered.asm.mixin.injection.callback.CallbackInfo;\n+\n+import net.minecraft.entity.LivingEntity;\n+import net.minecraft.item.Item;\n+import net.minecraft.item.ItemStack;\n+\n+import net.fabricmc.fabric.api.item.v1.CustomDamageHandler;\n+\n+@Mixin(ItemStack.class)\n+public abstract class ItemStackMixin {\n+\t@Shadow public abstract Item getItem();\n+\n+\t@Unique\n+\tprivate LivingEntity fabric_damagingEntity;\n+\n+\t@Unique\n+\tprivate Consumer<LivingEntity> fabric_breakCallback;\n+\n+\t@Inject(method = \"damage(ILnet/minecraft/entity/LivingEntity;Ljava/util/function/Consumer;)V\",\n+\t\t\tat = @At(\"HEAD\"))\n+\tprivate void saveDamager(int amount, LivingEntity entity, Consumer<LivingEntity> breakCallback, CallbackInfo ci) {\n+\t\tthis.fabric_damagingEntity = entity;\n+\t\tthis.fabric_breakCallback = breakCallback;\n+\t}\n+\n+\t@ModifyArg(method = \"damage(ILnet/minecraft/entity/LivingEntity;Ljava/util/function/Consumer;)V\",\n+\t\t\tat = @At(value = \"INVOKE\", target = \"Lnet/minecraft/item/ItemStack;damage(ILjava/util/Random;Lnet/minecraft/server/network/ServerPlayerEntity;)Z\"),\n+\t\t\tindex = 0)\n+\tprivate int hookDamage(int amount) {\n+\t\tif (getItem() instanceof CustomDamageHandler) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f42afd05e6eea04fd9595570dfd44ce9b09b5fff"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTg0MzQwMQ==", "bodyText": "Sure, though I would be very :concern: if getItem() is modified to do computation", "url": "https://github.com/FabricMC/fabric/pull/964#discussion_r461843401", "createdAt": "2020-07-28T20:03:20Z", "author": {"login": "williewillus"}, "path": "fabric-item-api-v1/src/main/java/net/fabricmc/fabric/mixin/item/ItemStackMixin.java", "diffHunk": "@@ -0,0 +1,69 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.mixin.item;\n+\n+import java.util.function.Consumer;\n+\n+import org.spongepowered.asm.mixin.Mixin;\n+import org.spongepowered.asm.mixin.Shadow;\n+import org.spongepowered.asm.mixin.Unique;\n+import org.spongepowered.asm.mixin.injection.At;\n+import org.spongepowered.asm.mixin.injection.Inject;\n+import org.spongepowered.asm.mixin.injection.ModifyArg;\n+import org.spongepowered.asm.mixin.injection.callback.CallbackInfo;\n+\n+import net.minecraft.entity.LivingEntity;\n+import net.minecraft.item.Item;\n+import net.minecraft.item.ItemStack;\n+\n+import net.fabricmc.fabric.api.item.v1.CustomDamageHandler;\n+\n+@Mixin(ItemStack.class)\n+public abstract class ItemStackMixin {\n+\t@Shadow public abstract Item getItem();\n+\n+\t@Unique\n+\tprivate LivingEntity fabric_damagingEntity;\n+\n+\t@Unique\n+\tprivate Consumer<LivingEntity> fabric_breakCallback;\n+\n+\t@Inject(method = \"damage(ILnet/minecraft/entity/LivingEntity;Ljava/util/function/Consumer;)V\",\n+\t\t\tat = @At(\"HEAD\"))\n+\tprivate void saveDamager(int amount, LivingEntity entity, Consumer<LivingEntity> breakCallback, CallbackInfo ci) {\n+\t\tthis.fabric_damagingEntity = entity;\n+\t\tthis.fabric_breakCallback = breakCallback;\n+\t}\n+\n+\t@ModifyArg(method = \"damage(ILnet/minecraft/entity/LivingEntity;Ljava/util/function/Consumer;)V\",\n+\t\t\tat = @At(value = \"INVOKE\", target = \"Lnet/minecraft/item/ItemStack;damage(ILjava/util/Random;Lnet/minecraft/server/network/ServerPlayerEntity;)Z\"),\n+\t\t\tindex = 0)\n+\tprivate int hookDamage(int amount) {\n+\t\tif (getItem() instanceof CustomDamageHandler) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTgzODgzOA=="}, "originalCommit": {"oid": "f42afd05e6eea04fd9595570dfd44ce9b09b5fff"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTg5MzY0Nw==", "bodyText": "Well this keeping the item can at least skip an isEmpty check", "url": "https://github.com/FabricMC/fabric/pull/964#discussion_r461893647", "createdAt": "2020-07-28T21:35:10Z", "author": {"login": "liach"}, "path": "fabric-item-api-v1/src/main/java/net/fabricmc/fabric/mixin/item/ItemStackMixin.java", "diffHunk": "@@ -0,0 +1,69 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.mixin.item;\n+\n+import java.util.function.Consumer;\n+\n+import org.spongepowered.asm.mixin.Mixin;\n+import org.spongepowered.asm.mixin.Shadow;\n+import org.spongepowered.asm.mixin.Unique;\n+import org.spongepowered.asm.mixin.injection.At;\n+import org.spongepowered.asm.mixin.injection.Inject;\n+import org.spongepowered.asm.mixin.injection.ModifyArg;\n+import org.spongepowered.asm.mixin.injection.callback.CallbackInfo;\n+\n+import net.minecraft.entity.LivingEntity;\n+import net.minecraft.item.Item;\n+import net.minecraft.item.ItemStack;\n+\n+import net.fabricmc.fabric.api.item.v1.CustomDamageHandler;\n+\n+@Mixin(ItemStack.class)\n+public abstract class ItemStackMixin {\n+\t@Shadow public abstract Item getItem();\n+\n+\t@Unique\n+\tprivate LivingEntity fabric_damagingEntity;\n+\n+\t@Unique\n+\tprivate Consumer<LivingEntity> fabric_breakCallback;\n+\n+\t@Inject(method = \"damage(ILnet/minecraft/entity/LivingEntity;Ljava/util/function/Consumer;)V\",\n+\t\t\tat = @At(\"HEAD\"))\n+\tprivate void saveDamager(int amount, LivingEntity entity, Consumer<LivingEntity> breakCallback, CallbackInfo ci) {\n+\t\tthis.fabric_damagingEntity = entity;\n+\t\tthis.fabric_breakCallback = breakCallback;\n+\t}\n+\n+\t@ModifyArg(method = \"damage(ILnet/minecraft/entity/LivingEntity;Ljava/util/function/Consumer;)V\",\n+\t\t\tat = @At(value = \"INVOKE\", target = \"Lnet/minecraft/item/ItemStack;damage(ILjava/util/Random;Lnet/minecraft/server/network/ServerPlayerEntity;)Z\"),\n+\t\t\tindex = 0)\n+\tprivate int hookDamage(int amount) {\n+\t\tif (getItem() instanceof CustomDamageHandler) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTgzODgzOA=="}, "originalCommit": {"oid": "f42afd05e6eea04fd9595570dfd44ce9b09b5fff"}, "originalPosition": 56}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5NDE3MTgxOnYy", "diffSide": "RIGHT", "path": "fabric-item-api-v1/src/main/java/net/fabricmc/fabric/api/item/v1/CustomDamageHandler.java", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQwODozNToyOVrOHIwjnA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQyMToyNzowOVrOHJU67A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODk0NjIwNA==", "bodyText": "I don't think it's possible, but just in case can this be turned into a functional interface so that the actual implementation of making a new CustomDamageHandler is a lot neater? Ideally I'd love to just be able to pass a lambda into the item settings method, but that might not be doable.", "url": "https://github.com/FabricMC/fabric/pull/964#discussion_r478946204", "createdAt": "2020-08-28T08:35:29Z", "author": {"login": "Vaerian"}, "path": "fabric-item-api-v1/src/main/java/net/fabricmc/fabric/api/item/v1/CustomDamageHandler.java", "diffHunk": "@@ -0,0 +1,40 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.api.item.v1;\n+\n+import java.util.function.Consumer;\n+\n+import net.minecraft.entity.LivingEntity;\n+import net.minecraft.item.ItemStack;\n+\n+/**\n+ * Allows an item to run custom logic when {@link ItemStack#damage(int, LivingEntity, Consumer)} is called.\n+ * This is useful for items that, for example, may drain durability from some other source before damaging\n+ * the stack itself.\n+ *\n+ * <p>Custom damage handlers can be set with {@link FabricItemSettings#customDamage}.\n+ */\n+public interface CustomDamageHandler {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d33de77f408781b99fe6a6120f4c8653ac032731"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTI3OTA0Nw==", "bodyText": "This is effectively a functional interface but without the marker.", "url": "https://github.com/FabricMC/fabric/pull/964#discussion_r479279047", "createdAt": "2020-08-28T13:17:22Z", "author": {"login": "i509VCB"}, "path": "fabric-item-api-v1/src/main/java/net/fabricmc/fabric/api/item/v1/CustomDamageHandler.java", "diffHunk": "@@ -0,0 +1,40 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.api.item.v1;\n+\n+import java.util.function.Consumer;\n+\n+import net.minecraft.entity.LivingEntity;\n+import net.minecraft.item.ItemStack;\n+\n+/**\n+ * Allows an item to run custom logic when {@link ItemStack#damage(int, LivingEntity, Consumer)} is called.\n+ * This is useful for items that, for example, may drain durability from some other source before damaging\n+ * the stack itself.\n+ *\n+ * <p>Custom damage handlers can be set with {@link FabricItemSettings#customDamage}.\n+ */\n+public interface CustomDamageHandler {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODk0NjIwNA=="}, "originalCommit": {"oid": "d33de77f408781b99fe6a6120f4c8653ac032731"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQyMDAyMg==", "bodyText": "Not really required, but for these kinds of interfaces it is advised to throw the @FunctionalInterface in", "url": "https://github.com/FabricMC/fabric/pull/964#discussion_r479420022", "createdAt": "2020-08-28T16:45:36Z", "author": {"login": "i509VCB"}, "path": "fabric-item-api-v1/src/main/java/net/fabricmc/fabric/api/item/v1/CustomDamageHandler.java", "diffHunk": "@@ -0,0 +1,40 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.api.item.v1;\n+\n+import java.util.function.Consumer;\n+\n+import net.minecraft.entity.LivingEntity;\n+import net.minecraft.item.ItemStack;\n+\n+/**\n+ * Allows an item to run custom logic when {@link ItemStack#damage(int, LivingEntity, Consumer)} is called.\n+ * This is useful for items that, for example, may drain durability from some other source before damaging\n+ * the stack itself.\n+ *\n+ * <p>Custom damage handlers can be set with {@link FabricItemSettings#customDamage}.\n+ */\n+public interface CustomDamageHandler {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODk0NjIwNA=="}, "originalCommit": {"oid": "d33de77f408781b99fe6a6120f4c8653ac032731"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTU0MTg2Ng==", "bodyText": "Yeah but it uses a generic type parameter meaning it can't be expressed as a lambda. I tested an example of it in an IDE and it threw an error because the interface method was generic. Apparently this is just a limitation of java right now. The only way to allow it to be expressed as a lambda would be to remove the generic type parameter which sounds like it might end up being the plan.", "url": "https://github.com/FabricMC/fabric/pull/964#discussion_r479541866", "createdAt": "2020-08-28T21:26:52Z", "author": {"login": "Vaerian"}, "path": "fabric-item-api-v1/src/main/java/net/fabricmc/fabric/api/item/v1/CustomDamageHandler.java", "diffHunk": "@@ -0,0 +1,40 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.api.item.v1;\n+\n+import java.util.function.Consumer;\n+\n+import net.minecraft.entity.LivingEntity;\n+import net.minecraft.item.ItemStack;\n+\n+/**\n+ * Allows an item to run custom logic when {@link ItemStack#damage(int, LivingEntity, Consumer)} is called.\n+ * This is useful for items that, for example, may drain durability from some other source before damaging\n+ * the stack itself.\n+ *\n+ * <p>Custom damage handlers can be set with {@link FabricItemSettings#customDamage}.\n+ */\n+public interface CustomDamageHandler {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODk0NjIwNA=="}, "originalCommit": {"oid": "d33de77f408781b99fe6a6120f4c8653ac032731"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTU0MTk5Ng==", "bodyText": "But yeah we should also add @FunctionalInterface to it", "url": "https://github.com/FabricMC/fabric/pull/964#discussion_r479541996", "createdAt": "2020-08-28T21:27:09Z", "author": {"login": "Vaerian"}, "path": "fabric-item-api-v1/src/main/java/net/fabricmc/fabric/api/item/v1/CustomDamageHandler.java", "diffHunk": "@@ -0,0 +1,40 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.api.item.v1;\n+\n+import java.util.function.Consumer;\n+\n+import net.minecraft.entity.LivingEntity;\n+import net.minecraft.item.ItemStack;\n+\n+/**\n+ * Allows an item to run custom logic when {@link ItemStack#damage(int, LivingEntity, Consumer)} is called.\n+ * This is useful for items that, for example, may drain durability from some other source before damaging\n+ * the stack itself.\n+ *\n+ * <p>Custom damage handlers can be set with {@link FabricItemSettings#customDamage}.\n+ */\n+public interface CustomDamageHandler {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODk0NjIwNA=="}, "originalCommit": {"oid": "d33de77f408781b99fe6a6120f4c8653ac032731"}, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5NDI1MTU1OnYy", "diffSide": "RIGHT", "path": "fabric-item-api-v1/src/testmod/java/net/fabricmc/fabric/test/item/CustomDamageTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQwODo0Nzo0NlrOHIxRgg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQwODo0Nzo0NlrOHIxRgg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODk1Nzk1NA==", "bodyText": "This is related to the comment above, but like I said this kind of implementation for the custom damage handler just seems clunky, just checking if we're able to avoid it or not with lambdas.\nIdeally I'd love to just be able to do something like\nsuper(\n    ToolMaterials.GOLD,\n    1,\n    -2.8F,\n    new FabricItemSettings()\n        .customDamage((stack, amount, entity, callback) -> {\n            if (entity.isSneaking()) {\n                return amount;\n            } else {\n                CompoundTag tag = stack.getOrCreateTag();\n                tag.putInt(\"weird\", tag.getInt(\"weird\") + 1);\n                return 0;\n            }\n        })\n);", "url": "https://github.com/FabricMC/fabric/pull/964#discussion_r478957954", "createdAt": "2020-08-28T08:47:46Z", "author": {"login": "Vaerian"}, "path": "fabric-item-api-v1/src/testmod/java/net/fabricmc/fabric/test/item/CustomDamageTest.java", "diffHunk": "@@ -0,0 +1,65 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.test.item;\n+\n+import java.util.function.Consumer;\n+\n+import net.minecraft.entity.LivingEntity;\n+import net.minecraft.item.ItemStack;\n+import net.minecraft.item.PickaxeItem;\n+import net.minecraft.item.ToolMaterials;\n+import net.minecraft.nbt.CompoundTag;\n+import net.minecraft.text.Text;\n+import net.minecraft.util.Identifier;\n+import net.minecraft.util.registry.Registry;\n+\n+import net.fabricmc.api.ModInitializer;\n+import net.fabricmc.fabric.api.item.v1.CustomDamageHandler;\n+import net.fabricmc.fabric.api.item.v1.FabricItemSettings;\n+\n+public class CustomDamageTest implements ModInitializer {\n+\t@Override\n+\tpublic void onInitialize() {\n+\t\tRegistry.register(Registry.ITEM, new Identifier(\"fabric-item-api-v1-testmod\", \"weird_pickaxe\"), new WeirdPick());\n+\t}\n+\n+\tpublic static final CustomDamageHandler WEIRD_DAMAGE_HANDLER = new CustomDamageHandler() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d33de77f408781b99fe6a6120f4c8653ac032731"}, "originalPosition": 40}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5NzAyNDU5OnYy", "diffSide": "RIGHT", "path": "fabric-item-api-v1/src/main/java/net/fabricmc/fabric/api/item/v1/FabricItemSettings.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNjo0NDoyNlrOHJNcIw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNjo0NDoyNlrOHJNcIw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQxOTQyNw==", "bodyText": "Really a javadoc nitpick, but possibly add @see CustomDamageHandler so people can see it relates to the handler.", "url": "https://github.com/FabricMC/fabric/pull/964#discussion_r479419427", "createdAt": "2020-08-28T16:44:26Z", "author": {"login": "i509VCB"}, "path": "fabric-item-api-v1/src/main/java/net/fabricmc/fabric/api/item/v1/FabricItemSettings.java", "diffHunk": "@@ -42,6 +42,14 @@ public FabricItemSettings equipmentSlot(EquipmentSlotProvider equipmentSlotProvi\n \t\treturn this;\n \t}\n \n+\t/**\n+\t * Sets the custom damage handler of the item.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d33de77f408781b99fe6a6120f4c8653ac032731"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5NzAzMzk1OnYy", "diffSide": "RIGHT", "path": "fabric-item-api-v1/src/main/java/net/fabricmc/fabric/api/item/v1/FabricItemSettings.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNjo0NzoxMlrOHJNhqQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNjo0NzoxMlrOHJNhqQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQyMDg0MQ==", "bodyText": "Is this called on items that are not damageable? If this is not called on that case, then you need to add javadoc saying the item must be damagable", "url": "https://github.com/FabricMC/fabric/pull/964#discussion_r479420841", "createdAt": "2020-08-28T16:47:12Z", "author": {"login": "i509VCB"}, "path": "fabric-item-api-v1/src/main/java/net/fabricmc/fabric/api/item/v1/FabricItemSettings.java", "diffHunk": "@@ -42,6 +42,14 @@ public FabricItemSettings equipmentSlot(EquipmentSlotProvider equipmentSlotProvi\n \t\treturn this;\n \t}\n \n+\t/**\n+\t * Sets the custom damage handler of the item.\n+\t */\n+\tpublic FabricItemSettings customDamage(CustomDamageHandler handler) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d33de77f408781b99fe6a6120f4c8653ac032731"}, "originalPosition": 7}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3419, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}