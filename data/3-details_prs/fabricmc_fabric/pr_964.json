{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU3OTQ1NjI1", "number": 964, "title": "Add hook for custom damage logic", "bodyText": "Introduces an interface for items that wish to have a say in how they are damaged. There is one method, and it takes the requested damage and returns the amount to pass to vanilla logic.\nThis is a usecase run into by pretty much every mod with \"power tools\" or tools powered by external sources, and I'll be needing it for Botania.\nImplementation wise, it's pretty simple. In order to pass the entity and breakCallback to the ModifyArg hook though, I needed to save and clear it on entry/exit from the method.", "createdAt": "2020-07-28T17:20:26Z", "url": "https://github.com/FabricMC/fabric/pull/964", "merged": true, "mergeCommit": {"oid": "616c01224d0b1009f7a635311f87ce2f3bb50de0"}, "closed": true, "closedAt": "2020-09-27T11:09:07Z", "author": {"login": "williewillus"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc5bo2IgFqTQ1NjkzOTk0Mw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdMmOT4gFqTQ5Njk1NjUzNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2OTM5OTQz", "url": "https://github.com/FabricMC/fabric/pull/964#pullrequestreview-456939943", "createdAt": "2020-07-28T19:26:37Z", "commit": {"oid": "f42afd05e6eea04fd9595570dfd44ce9b09b5fff"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxOToyNjozN1rOG4bNfA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxOToyOToxOFrOG4bTOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTgxOTI2MA==", "bodyText": "No need for else block here, drop the else half and just return amount.", "url": "https://github.com/FabricMC/fabric/pull/964#discussion_r461819260", "createdAt": "2020-07-28T19:26:37Z", "author": {"login": "i509VCB"}, "path": "fabric-item-api-v1/src/main/java/net/fabricmc/fabric/mixin/item/ItemStackMixin.java", "diffHunk": "@@ -0,0 +1,69 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.mixin.item;\n+\n+import java.util.function.Consumer;\n+\n+import org.spongepowered.asm.mixin.Mixin;\n+import org.spongepowered.asm.mixin.Shadow;\n+import org.spongepowered.asm.mixin.Unique;\n+import org.spongepowered.asm.mixin.injection.At;\n+import org.spongepowered.asm.mixin.injection.Inject;\n+import org.spongepowered.asm.mixin.injection.ModifyArg;\n+import org.spongepowered.asm.mixin.injection.callback.CallbackInfo;\n+\n+import net.minecraft.entity.LivingEntity;\n+import net.minecraft.item.Item;\n+import net.minecraft.item.ItemStack;\n+\n+import net.fabricmc.fabric.api.item.v1.CustomDamageHandler;\n+\n+@Mixin(ItemStack.class)\n+public abstract class ItemStackMixin {\n+\t@Shadow public abstract Item getItem();\n+\n+\t@Unique\n+\tprivate LivingEntity fabric_damagingEntity;\n+\n+\t@Unique\n+\tprivate Consumer<LivingEntity> fabric_breakCallback;\n+\n+\t@Inject(method = \"damage(ILnet/minecraft/entity/LivingEntity;Ljava/util/function/Consumer;)V\",\n+\t\t\tat = @At(\"HEAD\"))\n+\tprivate void saveDamager(int amount, LivingEntity entity, Consumer<LivingEntity> breakCallback, CallbackInfo ci) {\n+\t\tthis.fabric_damagingEntity = entity;\n+\t\tthis.fabric_breakCallback = breakCallback;\n+\t}\n+\n+\t@ModifyArg(method = \"damage(ILnet/minecraft/entity/LivingEntity;Ljava/util/function/Consumer;)V\",\n+\t\t\tat = @At(value = \"INVOKE\", target = \"Lnet/minecraft/item/ItemStack;damage(ILjava/util/Random;Lnet/minecraft/server/network/ServerPlayerEntity;)Z\"),\n+\t\t\tindex = 0)\n+\tprivate int hookDamage(int amount) {\n+\t\tif (getItem() instanceof CustomDamageHandler) {\n+\t\t\treturn ((CustomDamageHandler) getItem()).damage((ItemStack) (Object) this, amount, fabric_damagingEntity, fabric_breakCallback);\n+\t\t} else {\n+\t\t\treturn amount;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f42afd05e6eea04fd9595570dfd44ce9b09b5fff"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTgyMDcyOQ==", "bodyText": "I very much disagree with modmuss's stance on keeping the entire mixin statement on one line, I may revisit this with a conventions document I'll propose in a few days.\nFor now I think modmuss wants these mixin annotations as one liners.", "url": "https://github.com/FabricMC/fabric/pull/964#discussion_r461820729", "createdAt": "2020-07-28T19:29:18Z", "author": {"login": "i509VCB"}, "path": "fabric-item-api-v1/src/main/java/net/fabricmc/fabric/mixin/item/ItemStackMixin.java", "diffHunk": "@@ -0,0 +1,69 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.mixin.item;\n+\n+import java.util.function.Consumer;\n+\n+import org.spongepowered.asm.mixin.Mixin;\n+import org.spongepowered.asm.mixin.Shadow;\n+import org.spongepowered.asm.mixin.Unique;\n+import org.spongepowered.asm.mixin.injection.At;\n+import org.spongepowered.asm.mixin.injection.Inject;\n+import org.spongepowered.asm.mixin.injection.ModifyArg;\n+import org.spongepowered.asm.mixin.injection.callback.CallbackInfo;\n+\n+import net.minecraft.entity.LivingEntity;\n+import net.minecraft.item.Item;\n+import net.minecraft.item.ItemStack;\n+\n+import net.fabricmc.fabric.api.item.v1.CustomDamageHandler;\n+\n+@Mixin(ItemStack.class)\n+public abstract class ItemStackMixin {\n+\t@Shadow public abstract Item getItem();\n+\n+\t@Unique\n+\tprivate LivingEntity fabric_damagingEntity;\n+\n+\t@Unique\n+\tprivate Consumer<LivingEntity> fabric_breakCallback;\n+\n+\t@Inject(method = \"damage(ILnet/minecraft/entity/LivingEntity;Ljava/util/function/Consumer;)V\",\n+\t\t\tat = @At(\"HEAD\"))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f42afd05e6eea04fd9595570dfd44ce9b09b5fff"}, "originalPosition": 46}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2OTYxNjM1", "url": "https://github.com/FabricMC/fabric/pull/964#pullrequestreview-456961635", "createdAt": "2020-07-28T19:54:23Z", "commit": {"oid": "f42afd05e6eea04fd9595570dfd44ce9b09b5fff"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxOTo1NDoyM1rOG4cYPg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxOTo1NDoyM1rOG4cYPg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTgzODM5OA==", "bodyText": "consider documenting the break callback.", "url": "https://github.com/FabricMC/fabric/pull/964#discussion_r461838398", "createdAt": "2020-07-28T19:54:23Z", "author": {"login": "liach"}, "path": "fabric-item-api-v1/src/main/java/net/fabricmc/fabric/api/item/v1/CustomDamageHandler.java", "diffHunk": "@@ -0,0 +1,35 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.api.item.v1;\n+\n+import java.util.function.Consumer;\n+\n+import net.minecraft.entity.LivingEntity;\n+import net.minecraft.item.ItemStack;\n+\n+/**\n+ * Implement this interface on an item to run custom logic when {@link ItemStack#damage(int, LivingEntity, Consumer)} is called.\n+ */\n+public interface CustomDamageHandler {\n+\t/**\n+\t * Called to apply damage to the given stack.\n+\t * This can be used to e.g. drain from a battery before actually damaging the item\n+\t * @param amount The amount of damage originally requested\n+\t * @return The amount of damage to pass to vanilla's logic\n+\t */\n+\t<T extends LivingEntity> int damage(ItemStack stack, int amount, T entity, Consumer<T> breakCallback);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f42afd05e6eea04fd9595570dfd44ce9b09b5fff"}, "originalPosition": 34}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2OTYyMTc3", "url": "https://github.com/FabricMC/fabric/pull/964#pullrequestreview-456962177", "createdAt": "2020-07-28T19:55:09Z", "commit": {"oid": "f42afd05e6eea04fd9595570dfd44ce9b09b5fff"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxOTo1NTowOVrOG4cZ9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxOTo1NTowOVrOG4cZ9g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTgzODgzOA==", "bodyText": "maybe keep the result of  getItem in a local var to reduce unnecessary calls if computations are made in getItem call", "url": "https://github.com/FabricMC/fabric/pull/964#discussion_r461838838", "createdAt": "2020-07-28T19:55:09Z", "author": {"login": "liach"}, "path": "fabric-item-api-v1/src/main/java/net/fabricmc/fabric/mixin/item/ItemStackMixin.java", "diffHunk": "@@ -0,0 +1,69 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.mixin.item;\n+\n+import java.util.function.Consumer;\n+\n+import org.spongepowered.asm.mixin.Mixin;\n+import org.spongepowered.asm.mixin.Shadow;\n+import org.spongepowered.asm.mixin.Unique;\n+import org.spongepowered.asm.mixin.injection.At;\n+import org.spongepowered.asm.mixin.injection.Inject;\n+import org.spongepowered.asm.mixin.injection.ModifyArg;\n+import org.spongepowered.asm.mixin.injection.callback.CallbackInfo;\n+\n+import net.minecraft.entity.LivingEntity;\n+import net.minecraft.item.Item;\n+import net.minecraft.item.ItemStack;\n+\n+import net.fabricmc.fabric.api.item.v1.CustomDamageHandler;\n+\n+@Mixin(ItemStack.class)\n+public abstract class ItemStackMixin {\n+\t@Shadow public abstract Item getItem();\n+\n+\t@Unique\n+\tprivate LivingEntity fabric_damagingEntity;\n+\n+\t@Unique\n+\tprivate Consumer<LivingEntity> fabric_breakCallback;\n+\n+\t@Inject(method = \"damage(ILnet/minecraft/entity/LivingEntity;Ljava/util/function/Consumer;)V\",\n+\t\t\tat = @At(\"HEAD\"))\n+\tprivate void saveDamager(int amount, LivingEntity entity, Consumer<LivingEntity> breakCallback, CallbackInfo ci) {\n+\t\tthis.fabric_damagingEntity = entity;\n+\t\tthis.fabric_breakCallback = breakCallback;\n+\t}\n+\n+\t@ModifyArg(method = \"damage(ILnet/minecraft/entity/LivingEntity;Ljava/util/function/Consumer;)V\",\n+\t\t\tat = @At(value = \"INVOKE\", target = \"Lnet/minecraft/item/ItemStack;damage(ILjava/util/Random;Lnet/minecraft/server/network/ServerPlayerEntity;)Z\"),\n+\t\t\tindex = 0)\n+\tprivate int hookDamage(int amount) {\n+\t\tif (getItem() instanceof CustomDamageHandler) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f42afd05e6eea04fd9595570dfd44ce9b09b5fff"}, "originalPosition": 56}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcyNzA1OTY3", "url": "https://github.com/FabricMC/fabric/pull/964#pullrequestreview-472705967", "createdAt": "2020-08-21T18:35:40Z", "commit": {"oid": "4043bbf4c82ef92a3099646aa3d38100a872032d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "82cd5ee0669a3a7299359081c919be06acf9f767", "author": {"user": {"login": "williewillus", "name": "Vincent Lee"}}, "url": "https://github.com/FabricMC/fabric/commit/82cd5ee0669a3a7299359081c919be06acf9f767", "committedDate": "2020-08-24T02:43:10Z", "message": "Add hook for custom damage logic"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "66a434b942b478c7e16d4b8d14ad33f9694a58ec", "author": {"user": {"login": "williewillus", "name": "Vincent Lee"}}, "url": "https://github.com/FabricMC/fabric/commit/66a434b942b478c7e16d4b8d14ad33f9694a58ec", "committedDate": "2020-08-24T02:43:10Z", "message": "Address comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d33de77f408781b99fe6a6120f4c8653ac032731", "author": {"user": {"login": "williewillus", "name": "Vincent Lee"}}, "url": "https://github.com/FabricMC/fabric/commit/d33de77f408781b99fe6a6120f4c8653ac032731", "committedDate": "2020-08-24T03:16:04Z", "message": "Change to use new FabricItemSettings"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4043bbf4c82ef92a3099646aa3d38100a872032d", "author": {"user": {"login": "williewillus", "name": "Vincent Lee"}}, "url": "https://github.com/FabricMC/fabric/commit/4043bbf4c82ef92a3099646aa3d38100a872032d", "committedDate": "2020-07-28T21:59:25Z", "message": "Address comments"}, "afterCommit": {"oid": "d33de77f408781b99fe6a6120f4c8653ac032731", "author": {"user": {"login": "williewillus", "name": "Vincent Lee"}}, "url": "https://github.com/FabricMC/fabric/commit/d33de77f408781b99fe6a6120f4c8653ac032731", "committedDate": "2020-08-24T03:16:04Z", "message": "Change to use new FabricItemSettings"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc3NTIxNDkx", "url": "https://github.com/FabricMC/fabric/pull/964#pullrequestreview-477521491", "createdAt": "2020-08-28T08:35:29Z", "commit": {"oid": "d33de77f408781b99fe6a6120f4c8653ac032731"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQwODozNToyOVrOHIwjnA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQwODo0Nzo0NlrOHIxRgg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODk0NjIwNA==", "bodyText": "I don't think it's possible, but just in case can this be turned into a functional interface so that the actual implementation of making a new CustomDamageHandler is a lot neater? Ideally I'd love to just be able to pass a lambda into the item settings method, but that might not be doable.", "url": "https://github.com/FabricMC/fabric/pull/964#discussion_r478946204", "createdAt": "2020-08-28T08:35:29Z", "author": {"login": "Vaerian"}, "path": "fabric-item-api-v1/src/main/java/net/fabricmc/fabric/api/item/v1/CustomDamageHandler.java", "diffHunk": "@@ -0,0 +1,40 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.api.item.v1;\n+\n+import java.util.function.Consumer;\n+\n+import net.minecraft.entity.LivingEntity;\n+import net.minecraft.item.ItemStack;\n+\n+/**\n+ * Allows an item to run custom logic when {@link ItemStack#damage(int, LivingEntity, Consumer)} is called.\n+ * This is useful for items that, for example, may drain durability from some other source before damaging\n+ * the stack itself.\n+ *\n+ * <p>Custom damage handlers can be set with {@link FabricItemSettings#customDamage}.\n+ */\n+public interface CustomDamageHandler {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d33de77f408781b99fe6a6120f4c8653ac032731"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODk1Nzk1NA==", "bodyText": "This is related to the comment above, but like I said this kind of implementation for the custom damage handler just seems clunky, just checking if we're able to avoid it or not with lambdas.\nIdeally I'd love to just be able to do something like\nsuper(\n    ToolMaterials.GOLD,\n    1,\n    -2.8F,\n    new FabricItemSettings()\n        .customDamage((stack, amount, entity, callback) -> {\n            if (entity.isSneaking()) {\n                return amount;\n            } else {\n                CompoundTag tag = stack.getOrCreateTag();\n                tag.putInt(\"weird\", tag.getInt(\"weird\") + 1);\n                return 0;\n            }\n        })\n);", "url": "https://github.com/FabricMC/fabric/pull/964#discussion_r478957954", "createdAt": "2020-08-28T08:47:46Z", "author": {"login": "Vaerian"}, "path": "fabric-item-api-v1/src/testmod/java/net/fabricmc/fabric/test/item/CustomDamageTest.java", "diffHunk": "@@ -0,0 +1,65 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.test.item;\n+\n+import java.util.function.Consumer;\n+\n+import net.minecraft.entity.LivingEntity;\n+import net.minecraft.item.ItemStack;\n+import net.minecraft.item.PickaxeItem;\n+import net.minecraft.item.ToolMaterials;\n+import net.minecraft.nbt.CompoundTag;\n+import net.minecraft.text.Text;\n+import net.minecraft.util.Identifier;\n+import net.minecraft.util.registry.Registry;\n+\n+import net.fabricmc.api.ModInitializer;\n+import net.fabricmc.fabric.api.item.v1.CustomDamageHandler;\n+import net.fabricmc.fabric.api.item.v1.FabricItemSettings;\n+\n+public class CustomDamageTest implements ModInitializer {\n+\t@Override\n+\tpublic void onInitialize() {\n+\t\tRegistry.register(Registry.ITEM, new Identifier(\"fabric-item-api-v1-testmod\", \"weird_pickaxe\"), new WeirdPick());\n+\t}\n+\n+\tpublic static final CustomDamageHandler WEIRD_DAMAGE_HANDLER = new CustomDamageHandler() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d33de77f408781b99fe6a6120f4c8653ac032731"}, "originalPosition": 40}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc3ODc4MTI1", "url": "https://github.com/FabricMC/fabric/pull/964#pullrequestreview-477878125", "createdAt": "2020-08-28T16:44:25Z", "commit": {"oid": "d33de77f408781b99fe6a6120f4c8653ac032731"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNjo0NDoyNlrOHJNcIw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNjo0NzoxMlrOHJNhqQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQxOTQyNw==", "bodyText": "Really a javadoc nitpick, but possibly add @see CustomDamageHandler so people can see it relates to the handler.", "url": "https://github.com/FabricMC/fabric/pull/964#discussion_r479419427", "createdAt": "2020-08-28T16:44:26Z", "author": {"login": "i509VCB"}, "path": "fabric-item-api-v1/src/main/java/net/fabricmc/fabric/api/item/v1/FabricItemSettings.java", "diffHunk": "@@ -42,6 +42,14 @@ public FabricItemSettings equipmentSlot(EquipmentSlotProvider equipmentSlotProvi\n \t\treturn this;\n \t}\n \n+\t/**\n+\t * Sets the custom damage handler of the item.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d33de77f408781b99fe6a6120f4c8653ac032731"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQyMDAyMg==", "bodyText": "Not really required, but for these kinds of interfaces it is advised to throw the @FunctionalInterface in", "url": "https://github.com/FabricMC/fabric/pull/964#discussion_r479420022", "createdAt": "2020-08-28T16:45:36Z", "author": {"login": "i509VCB"}, "path": "fabric-item-api-v1/src/main/java/net/fabricmc/fabric/api/item/v1/CustomDamageHandler.java", "diffHunk": "@@ -0,0 +1,40 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.api.item.v1;\n+\n+import java.util.function.Consumer;\n+\n+import net.minecraft.entity.LivingEntity;\n+import net.minecraft.item.ItemStack;\n+\n+/**\n+ * Allows an item to run custom logic when {@link ItemStack#damage(int, LivingEntity, Consumer)} is called.\n+ * This is useful for items that, for example, may drain durability from some other source before damaging\n+ * the stack itself.\n+ *\n+ * <p>Custom damage handlers can be set with {@link FabricItemSettings#customDamage}.\n+ */\n+public interface CustomDamageHandler {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODk0NjIwNA=="}, "originalCommit": {"oid": "d33de77f408781b99fe6a6120f4c8653ac032731"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQyMDg0MQ==", "bodyText": "Is this called on items that are not damageable? If this is not called on that case, then you need to add javadoc saying the item must be damagable", "url": "https://github.com/FabricMC/fabric/pull/964#discussion_r479420841", "createdAt": "2020-08-28T16:47:12Z", "author": {"login": "i509VCB"}, "path": "fabric-item-api-v1/src/main/java/net/fabricmc/fabric/api/item/v1/FabricItemSettings.java", "diffHunk": "@@ -42,6 +42,14 @@ public FabricItemSettings equipmentSlot(EquipmentSlotProvider equipmentSlotProvi\n \t\treturn this;\n \t}\n \n+\t/**\n+\t * Sets the custom damage handler of the item.\n+\t */\n+\tpublic FabricItemSettings customDamage(CustomDamageHandler handler) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d33de77f408781b99fe6a6120f4c8653ac032731"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "73d590f49182bd2a74c24df8f04c6bb1a513dece", "author": {"user": {"login": "williewillus", "name": "Vincent Lee"}}, "url": "https://github.com/FabricMC/fabric/commit/73d590f49182bd2a74c24df8f04c6bb1a513dece", "committedDate": "2020-08-29T02:13:45Z", "message": "Make CustomDamageHandler a functional interface"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4NDI0NzMw", "url": "https://github.com/FabricMC/fabric/pull/964#pullrequestreview-478424730", "createdAt": "2020-08-31T08:38:48Z", "commit": {"oid": "73d590f49182bd2a74c24df8f04c6bb1a513dece"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4NTAzMjEw", "url": "https://github.com/FabricMC/fabric/pull/964#pullrequestreview-478503210", "createdAt": "2020-08-31T10:42:44Z", "commit": {"oid": "73d590f49182bd2a74c24df8f04c6bb1a513dece"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3MzA2ODM0", "url": "https://github.com/FabricMC/fabric/pull/964#pullrequestreview-487306834", "createdAt": "2020-09-13T13:24:03Z", "commit": {"oid": "73d590f49182bd2a74c24df8f04c6bb1a513dece"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg4NzQzNjI5", "url": "https://github.com/FabricMC/fabric/pull/964#pullrequestreview-488743629", "createdAt": "2020-09-15T14:27:26Z", "commit": {"oid": "73d590f49182bd2a74c24df8f04c6bb1a513dece"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkzMTA3MzE2", "url": "https://github.com/FabricMC/fabric/pull/964#pullrequestreview-493107316", "createdAt": "2020-09-22T03:31:45Z", "commit": {"oid": "73d590f49182bd2a74c24df8f04c6bb1a513dece"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk2OTU2NTM1", "url": "https://github.com/FabricMC/fabric/pull/964#pullrequestreview-496956535", "createdAt": "2020-09-26T08:36:21Z", "commit": {"oid": "73d590f49182bd2a74c24df8f04c6bb1a513dece"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3202, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}