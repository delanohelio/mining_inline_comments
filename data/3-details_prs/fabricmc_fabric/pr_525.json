{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg2ODgwODQz", "number": 525, "title": "Fix some known issues with the registry sync module.", "bodyText": "This is a proof of concept, and is here to try and get more feedback on fixing the unlaying issues. #507 is another possible solution.\nThis trys to detect if a registry is modded, if its not it will left alone and no syncing or saving will take place.\nI can see this incorrectaly NOT detecting a modded registry if a mod adds/edits the registries during Bootstrap under the minecraft namespace.\nIm not sure about getting the registry ids hashcode, this may not be needed.\nRight now if the registry is none modded nothing will happen, it wont sync or save, should it still sync?\nThis is a common issue that needs to be fixed, any input will be appricated.", "createdAt": "2020-03-11T19:34:05Z", "url": "https://github.com/FabricMC/fabric/pull/525", "merged": true, "mergeCommit": {"oid": "dd263cca8b4be47c9796abb5afcaf6bac739434e"}, "closed": true, "closedAt": "2020-06-04T20:33:57Z", "author": {"login": "modmuss50"}, "timelineItems": {"totalCount": 72, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcMsSzWAH2gAyMzg2ODgwODQzOjFiMDYwNWVhNWY3MjJhMTg3MzdiYWI0YWE0Y2ZhNzE3OTA1ZDgxMDU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcoEET_gH2gAyMzg2ODgwODQzOmFkNGUwMzNiZjYwMzg2MDMxOGE3ZmVlNmE3M2NlNTEyOGI1ZWZlYmQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1b0605ea5f722a18737bab4aa4cfa717905d8105", "author": {"user": {"login": "modmuss50", "name": "modmuss50"}}, "url": "https://github.com/FabricMC/fabric/commit/1b0605ea5f722a18737bab4aa4cfa717905d8105", "committedDate": "2020-03-11T19:29:32Z", "message": "Try to detect if a registry is modded, if its not it will left alone and no syncing or saving will take place."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczMzM3NjQx", "url": "https://github.com/FabricMC/fabric/pull/525#pullrequestreview-373337641", "createdAt": "2020-03-12T07:53:51Z", "commit": {"oid": "1b0605ea5f722a18737bab4aa4cfa717905d8105"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQwNzo1Mzo1MlrOF1UL-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQwNzo1NDo0NFrOF1UNPg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQ0OTU5NQ==", "bodyText": "Shouldn't this be a set ?", "url": "https://github.com/FabricMC/fabric/pull/525#discussion_r391449595", "createdAt": "2020-03-12T07:53:52Z", "author": {"login": "Pyrofab"}, "path": "fabric-registry-sync-v0/src/main/java/net/fabricmc/fabric/impl/registry/sync/RegistrySyncManager.java", "diffHunk": "@@ -55,6 +59,9 @@\n \tprivate static final Set<Identifier> REGISTRY_BLACKLIST = ImmutableSet.of();\n \tprivate static final Set<Identifier> REGISTRY_BLACKLIST_NETWORK = ImmutableSet.of();\n \n+\tpublic static final HashMap<Registry<?>, Integer> bootstrapRegistryHashes = new HashMap<>();\n+\tpublic static final ArrayList<Registry<?>> moddedRegistries = new ArrayList<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b0605ea5f722a18737bab4aa4cfa717905d8105"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQ0OTkxOA==", "bodyText": "Should use fastutil's Object2IntMap", "url": "https://github.com/FabricMC/fabric/pull/525#discussion_r391449918", "createdAt": "2020-03-12T07:54:44Z", "author": {"login": "Pyrofab"}, "path": "fabric-registry-sync-v0/src/main/java/net/fabricmc/fabric/impl/registry/sync/RegistrySyncManager.java", "diffHunk": "@@ -55,6 +59,9 @@\n \tprivate static final Set<Identifier> REGISTRY_BLACKLIST = ImmutableSet.of();\n \tprivate static final Set<Identifier> REGISTRY_BLACKLIST_NETWORK = ImmutableSet.of();\n \n+\tpublic static final HashMap<Registry<?>, Integer> bootstrapRegistryHashes = new HashMap<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b0605ea5f722a18737bab4aa4cfa717905d8105"}, "originalPosition": 22}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c7a00f35f545635f429b5eaa455e87b5babd78a", "author": {"user": {"login": "modmuss50", "name": "modmuss50"}}, "url": "https://github.com/FabricMC/fabric/commit/1c7a00f35f545635f429b5eaa455e87b5babd78a", "committedDate": "2020-03-16T21:17:29Z", "message": "Some more work on moddable registries"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c4eefc32a80ea8924bd645c40b8c7e9a11eeaa73", "author": {"user": {"login": "modmuss50", "name": "modmuss50"}}, "url": "https://github.com/FabricMC/fabric/commit/c4eefc32a80ea8924bd645c40b8c7e9a11eeaa73", "committedDate": "2020-03-16T21:26:33Z", "message": "Checkstyle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "de260f3066543079fa2c63aa86438adf6f153376", "author": {"user": {"login": "modmuss50", "name": "modmuss50"}}, "url": "https://github.com/FabricMC/fabric/commit/de260f3066543079fa2c63aa86438adf6f153376", "committedDate": "2020-03-16T21:33:05Z", "message": "Fix licences"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1NjA5ODk0", "url": "https://github.com/FabricMC/fabric/pull/525#pullrequestreview-375609894", "createdAt": "2020-03-16T21:57:38Z", "commit": {"oid": "de260f3066543079fa2c63aa86438adf6f153376"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQyMTo1NzozOFrOF3HHGg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQyMTo1NzozOFrOF3HHGg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzMzMjUwNg==", "bodyText": "This may not be ideal, as mod provided registries should be able to define these.", "url": "https://github.com/FabricMC/fabric/pull/525#discussion_r393332506", "createdAt": "2020-03-16T21:57:38Z", "author": {"login": "modmuss50"}, "path": "fabric-registry-sync-v0/src/main/java/net/fabricmc/fabric/impl/registry/sync/RegistrySyncManager.java", "diffHunk": "@@ -216,4 +268,67 @@ public static void unmap() throws RemapException {\n \t\t\t}\n \t\t}\n \t}\n+\n+\tpublic static void bootstrapRegistries() {\n+\t\tfor (MutableRegistry<?> registry : Registry.REGISTRIES) {\n+\t\t\tif (registry instanceof ModdableRegistry) {\n+\t\t\t\t((ModdableRegistry) registry).storeIdHash(registry.getIds().hashCode());\n+\t\t\t}\n+\t\t}\n+\n+\t\tpostBootstrap = true;\n+\t}\n+\n+\tprivate static void markModded(Registry<?> registry) {\n+\t\tif (registry instanceof ModdableRegistry) {\n+\t\t\t((ModdableRegistry) registry).markModded();\n+\t\t} else {\n+\t\t\tthrow new RuntimeException(\"Cannot mark a none moddable registry as modded!\");\n+\t\t}\n+\t}\n+\n+\tpublic static boolean isRegistryModded(Identifier registryId) {\n+\t\t//All none minecraft registries are modded\n+\t\tif (!registryId.getNamespace().equals(\"minecraft\")) {\n+\t\t\treturn true;\n+\t\t}\n+\n+\t\tRegistry<?> registry = Registry.REGISTRIES.get(registryId);\n+\n+\t\tif (registry instanceof ModdableRegistry) {\n+\t\t\tModdableRegistry moddableRegistry = (ModdableRegistry) registry;\n+\t\t\treturn moddableRegistry.isModded();\n+\t\t} else {\n+\t\t\treturn false; //TODO what should this be?\n+\t\t}\n+\t}\n+\n+\tprivate static class RegistryTypes {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de260f3066543079fa2c63aa86438adf6f153376"}, "originalPosition": 185}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b5259c209890b4b50c3bd512f1434e463245427e", "author": {"user": {"login": "modmuss50", "name": "modmuss50"}}, "url": "https://github.com/FabricMC/fabric/commit/b5259c209890b4b50c3bd512f1434e463245427e", "committedDate": "2020-04-16T21:43:36Z", "message": "Merge branch '1.16' into vanilla_registries"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1062b723644b43e6b774588a92056e5d1547ec98", "author": {"user": {"login": "modmuss50", "name": "modmuss50"}}, "url": "https://github.com/FabricMC/fabric/commit/1062b723644b43e6b774588a92056e5d1547ec98", "committedDate": "2020-04-16T22:12:32Z", "message": "Cleanup registry attributes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1MDQ0OTA3", "url": "https://github.com/FabricMC/fabric/pull/525#pullrequestreview-395044907", "createdAt": "2020-04-16T22:33:18Z", "commit": {"oid": "1062b723644b43e6b774588a92056e5d1547ec98"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQyMjozMzoxOFrOGG5g5A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQyMjozNDoxMlrOGG5iQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTg4Njk0OA==", "bodyText": "Hmm, can we use like a class than an enum in case mods add custom attributes", "url": "https://github.com/FabricMC/fabric/pull/525#discussion_r409886948", "createdAt": "2020-04-16T22:33:18Z", "author": {"login": "liach"}, "path": "fabric-registry-sync-v0/src/main/java/net/fabricmc/fabric/api/event/registry/RegistryAttribute.java", "diffHunk": "@@ -0,0 +1,14 @@\n+package net.fabricmc.fabric.api.event.registry;\n+\n+public enum RegistryAttribute {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1062b723644b43e6b774588a92056e5d1547ec98"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTg4NzI5Ng==", "bodyText": "I'd prefer one\nvoid registerAttributes(Registry<?> registry, RegistryAttribute attribute);\nvoid registerAttributes(Registry<?> registry, RegistryAttribute... attributes);\ninstead\nAlso consider turning these attributes into like keys, like RegistryAttribute<T> where T may carry custom values for properties", "url": "https://github.com/FabricMC/fabric/pull/525#discussion_r409887296", "createdAt": "2020-04-16T22:34:12Z", "author": {"login": "liach"}, "path": "fabric-registry-sync-v0/src/main/java/net/fabricmc/fabric/api/event/registry/RegistryAttributeRegistry.java", "diffHunk": "@@ -0,0 +1,20 @@\n+package net.fabricmc.fabric.api.event.registry;\n+\n+import net.fabricmc.fabric.impl.registry.sync.RegistryAttributeRegistryImpl;\n+import net.minecraft.util.Identifier;\n+import net.minecraft.util.registry.Registry;\n+\n+//TODO better class name here lol\n+public interface RegistryAttributeRegistry {\n+\n+\tRegistryAttributeRegistry INSTANCE = RegistryAttributeRegistryImpl.INSTANCE;\n+\n+\tvoid registerAttributes(RegistryAttribute attribute, Registry<?>... registries);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1062b723644b43e6b774588a92056e5d1547ec98"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1MDQyNDYz", "url": "https://github.com/FabricMC/fabric/pull/525#pullrequestreview-395042463", "createdAt": "2020-04-16T22:27:31Z", "commit": {"oid": "1062b723644b43e6b774588a92056e5d1547ec98"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQyMjoyNzozMVrOGG5YUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQyMjozNDoyMFrOGG5ibg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTg4NDc1NA==", "bodyText": "Would SyncAttributeRegistry make sense?", "url": "https://github.com/FabricMC/fabric/pull/525#discussion_r409884754", "createdAt": "2020-04-16T22:27:31Z", "author": {"login": "i509VCB"}, "path": "fabric-registry-sync-v0/src/main/java/net/fabricmc/fabric/api/event/registry/RegistryAttributeRegistry.java", "diffHunk": "@@ -0,0 +1,20 @@\n+package net.fabricmc.fabric.api.event.registry;\n+\n+import net.fabricmc.fabric.impl.registry.sync.RegistryAttributeRegistryImpl;\n+import net.minecraft.util.Identifier;\n+import net.minecraft.util.registry.Registry;\n+\n+//TODO better class name here lol\n+public interface RegistryAttributeRegistry {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1062b723644b43e6b774588a92056e5d1547ec98"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTg4NTcwMA==", "bodyText": "Maybe throw a comment in, like a TODO saying we need to add new registries to this list if a new one appears during an update.\nAlso could there be a way we can detect if a registry needs to be synced or persisted without having to manually specify these for all 39+ registries.", "url": "https://github.com/FabricMC/fabric/pull/525#discussion_r409885700", "createdAt": "2020-04-16T22:30:05Z", "author": {"login": "i509VCB"}, "path": "fabric-registry-sync-v0/src/main/java/net/fabricmc/fabric/impl/registry/sync/FabricRegistryInit.java", "diffHunk": "@@ -0,0 +1,23 @@\n+package net.fabricmc.fabric.impl.registry.sync;\n+\n+import net.fabricmc.api.ModInitializer;\n+import net.fabricmc.fabric.api.event.registry.RegistryAttribute;\n+import net.fabricmc.fabric.api.event.registry.RegistryAttributeRegistry;\n+import net.minecraft.util.registry.Registry;\n+\n+public class FabricRegistryInit implements ModInitializer {\n+\t@Override\n+\tpublic void onInitialize() {\n+\t\t//TODO this is a basic list of what should be done, a full list needs to be created", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1062b723644b43e6b774588a92056e5d1547ec98"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTg4NjQzMg==", "bodyText": "Maybe this should be ModifiableRegistry?", "url": "https://github.com/FabricMC/fabric/pull/525#discussion_r409886432", "createdAt": "2020-04-16T22:31:55Z", "author": {"login": "i509VCB"}, "path": "fabric-registry-sync-v0/src/main/java/net/fabricmc/fabric/impl/registry/sync/ModdableRegistry.java", "diffHunk": "@@ -0,0 +1,25 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.impl.registry.sync;\n+\n+public interface ModdableRegistry {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1062b723644b43e6b774588a92056e5d1547ec98"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTg4NzM0Mg==", "bodyText": "Would a version bump make sense?\nObviously the schema hasn't changed but it's worth considering.", "url": "https://github.com/FabricMC/fabric/pull/525#discussion_r409887342", "createdAt": "2020-04-16T22:34:20Z", "author": {"login": "i509VCB"}, "path": "fabric-registry-sync-v0/src/main/java/net/fabricmc/fabric/impl/registry/sync/RegistrySyncManager.java", "diffHunk": "@@ -168,18 +204,38 @@ public static CompoundTag toTag(boolean isClientSync) {\n \t\t\t\t\tregistryTag.putInt(id.toString(), rawId);\n \t\t\t\t}\n \n+\t\t\t\t// Look for existing registry key/values that are not in the current registries\n+\t\t\t\tif (!isClientSync && existingRegistryData != null) {\n+\t\t\t\t\tfor (String key : existingRegistryData.getKeys()) {\n+\t\t\t\t\t\tif (!registryTag.contains(key)) {\n+\t\t\t\t\t\t\tLOGGER.info(\"Saving orphaned registry entry: \" + key);\n+\t\t\t\t\t\t\tregistryTag.putInt(key, registryTag.getInt(key));\n+\t\t\t\t\t\t}\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\n \t\t\t\tmainTag.put(registryId.toString(), registryTag);\n \t\t\t}\n \t\t}\n \n+\t\t// Ensure any orphaned registry's are kept on disk\n+\t\tif (!isClientSync && activeIdMap != null) {\n+\t\t\tfor (String registryKey : activeIdMap.getKeys()) {\n+\t\t\t\tif (!mainTag.contains(registryKey)) {\n+\t\t\t\t\tLOGGER.info(\"Saving orphaned registry: \" + registryKey);\n+\t\t\t\t\tmainTag.put(registryKey, activeIdMap.getCompound(registryKey));\n+\t\t\t\t}\n+\t\t\t}\n+\t\t}\n+\n \t\tCompoundTag tag = new CompoundTag();\n \t\ttag.putInt(\"version\", 1);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1062b723644b43e6b774588a92056e5d1547ec98"}, "originalPosition": 139}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d04ae79675e225997b75f8dffa83cc3fffb46063", "author": {"user": {"login": "modmuss50", "name": "modmuss50"}}, "url": "https://github.com/FabricMC/fabric/commit/d04ae79675e225997b75f8dffa83cc3fffb46063", "committedDate": "2020-05-03T21:05:40Z", "message": "Merge branch '1.16' into vanilla_registries\n\n# Conflicts:\n#\tfabric-registry-sync-v0/src/main/java/net/fabricmc/fabric/mixin/registry/sync/MixinLevelStorageSession.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a995b1c341320be9d50e7200d5f0f14fffba0c73", "author": {"user": {"login": "modmuss50", "name": "modmuss50"}}, "url": "https://github.com/FabricMC/fabric/commit/a995b1c341320be9d50e7200d5f0f14fffba0c73", "committedDate": "2020-05-03T21:47:17Z", "message": "Rework again"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0NjYwNjk5", "url": "https://github.com/FabricMC/fabric/pull/525#pullrequestreview-404660699", "createdAt": "2020-05-03T21:49:22Z", "commit": {"oid": "a995b1c341320be9d50e7200d5f0f14fffba0c73"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wM1QyMTo0OToyMlrOGPv0cw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wM1QyMTo0OToyMlrOGPv0cw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTE2NTI5OQ==", "bodyText": "This should prob be moved from here, to adding RegistryAttribute.MODDED when creating the RegistryAttributeHolder", "url": "https://github.com/FabricMC/fabric/pull/525#discussion_r419165299", "createdAt": "2020-05-03T21:49:22Z", "author": {"login": "modmuss50"}, "path": "fabric-registry-sync-v0/src/main/java/net/fabricmc/fabric/impl/registry/sync/RegistrySyncManager.java", "diffHunk": "@@ -216,4 +268,41 @@ public static void unmap() throws RemapException {\n \t\t\t}\n \t\t}\n \t}\n+\n+\tpublic static void bootstrapRegistries() {\n+\t\tfor (MutableRegistry<?> registry : Registry.REGISTRIES) {\n+\t\t\tif (registry instanceof HashedRegistry) {\n+\t\t\t\t((HashedRegistry) registry).storeHash();\n+\t\t\t}\n+\t\t}\n+\n+\t\tpostBootstrap = true;\n+\t}\n+\n+\t// Checks the stored hash against the current hash, if it has changed mark as modded\n+\tpublic static void checkRegistryHashes() {\n+\t\tfor (MutableRegistry<?> registry : Registry.REGISTRIES) {\n+\t\t\tif (registry instanceof HashedRegistry) {\n+\t\t\t\tif (((HashedRegistry) registry).getStoredHash() != ((HashedRegistry) registry).storeHash()) {\n+\t\t\t\t\tRegistryAttributeHolder<?> holder = RegistryAttributeHolder.get(registry);\n+\n+\t\t\t\t\tif (!holder.hasAttribute(RegistryAttribute.MODDED)) {\n+\t\t\t\t\t\tLOGGER.debug(\"Registry {} has been marked as modded as the hash changed since bootstrap\", Registry.REGISTRIES.getId(registry));\n+\t\t\t\t\t\tholder.addAttribute(RegistryAttribute.MODDED);\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\t\t\t}\n+\t\t}\n+\t}\n+\n+\tpublic static boolean isRegistryModded(Identifier registryId) {\n+\t\t//All none minecraft registries are modded\n+\t\tif (!registryId.getNamespace().equals(\"minecraft\")) {\n+\t\t\treturn true;\n+\t\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a995b1c341320be9d50e7200d5f0f14fffba0c73"}, "originalPosition": 188}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0NjYwNzcy", "url": "https://github.com/FabricMC/fabric/pull/525#pullrequestreview-404660772", "createdAt": "2020-05-03T21:50:14Z", "commit": {"oid": "a995b1c341320be9d50e7200d5f0f14fffba0c73"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wM1QyMTo1MDoxNFrOGPv02Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wM1QyMTo1MjoyM1rOGPv14g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTE2NTQwMQ==", "bodyText": "Would storing the values or implementing the RegistryAttributeHolder onto the Registry make more sense?", "url": "https://github.com/FabricMC/fabric/pull/525#discussion_r419165401", "createdAt": "2020-05-03T21:50:14Z", "author": {"login": "i509VCB"}, "path": "fabric-registry-sync-v0/src/main/java/net/fabricmc/fabric/impl/registry/sync/RegistryAttributesImpl.java", "diffHunk": "@@ -0,0 +1,33 @@\n+package net.fabricmc.fabric.impl.registry.sync;\n+\n+import java.util.HashMap;\n+import java.util.HashSet;\n+import java.util.Map;\n+import java.util.Set;\n+\n+import net.minecraft.util.registry.Registry;\n+\n+import net.fabricmc.fabric.api.event.registry.RegistryAttribute;\n+import net.fabricmc.fabric.api.event.registry.RegistryAttributeHolder;\n+\n+public class RegistryAttributesImpl<T> implements RegistryAttributeHolder<T> {\n+\tprivate static final Map<Registry<?>, RegistryAttributeHolder<?>> registryAttributeMap = new HashMap<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a995b1c341320be9d50e7200d5f0f14fffba0c73"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTE2NTY2Ng==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\t\tLOGGER.debug(\"Not saving none-persistent registry: \" + registryId);\n          \n          \n            \n            \t\t\t\tLOGGER.debug(\"Not saving non-persistent registry: \" + registryId);", "url": "https://github.com/FabricMC/fabric/pull/525#discussion_r419165666", "createdAt": "2020-05-03T21:52:23Z", "author": {"login": "i509VCB"}, "path": "fabric-registry-sync-v0/src/main/java/net/fabricmc/fabric/impl/registry/sync/RegistrySyncManager.java", "diffHunk": "@@ -131,13 +139,35 @@ public static CompoundTag toTag(boolean isClientSync) {\n \t\t\t\t}\n \t\t\t}\n \n-\t\t\tif (REGISTRY_BLACKLIST.contains(registryId)) {\n+\t\t\tCompoundTag existingRegistryData = null;\n+\n+\t\t\tif (activeIdMap != null && activeIdMap.contains(registryId.toString())) {\n+\t\t\t\texistingRegistryData = activeIdMap.getCompound(registryId.toString());\n+\t\t\t}\n+\n+\t\t\t//noinspection unchecked\n+\t\t\tif (!isClientSync && !RegistryAttributeHolder.get(registry).hasAttribute(RegistryAttribute.PERSISTENT)) {\n+\t\t\t\tLOGGER.debug(\"Not saving none-persistent registry: \" + registryId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a995b1c341320be9d50e7200d5f0f14fffba0c73"}, "originalPosition": 78}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0NjYxMzg1", "url": "https://github.com/FabricMC/fabric/pull/525#pullrequestreview-404661385", "createdAt": "2020-05-03T21:58:25Z", "commit": {"oid": "a995b1c341320be9d50e7200d5f0f14fffba0c73"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32626a437574da74e22959f9bf9dfb915da0e70d", "author": {"user": {"login": "modmuss50", "name": "modmuss50"}}, "url": "https://github.com/FabricMC/fabric/commit/32626a437574da74e22959f9bf9dfb915da0e70d", "committedDate": "2020-05-03T21:58:25Z", "message": "Some small tweaks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d54ed1af9ec219ea41caac5a47d8b1d188eb32a4", "author": {"user": {"login": "modmuss50", "name": "modmuss50"}}, "url": "https://github.com/FabricMC/fabric/commit/d54ed1af9ec219ea41caac5a47d8b1d188eb32a4", "committedDate": "2020-05-04T13:58:48Z", "message": "Yet another refactor"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1MDE0MDk3", "url": "https://github.com/FabricMC/fabric/pull/525#pullrequestreview-405014097", "createdAt": "2020-05-04T13:59:50Z", "commit": {"oid": "d54ed1af9ec219ea41caac5a47d8b1d188eb32a4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxMzo1OTo1MFrOGQBq4w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxMzo1OTo1MFrOGQBq4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQ1Nzc2Mw==", "bodyText": "Everything that has a comment on I have checked. If someone can validate this that would be great.\nI will finish off the other later.", "url": "https://github.com/FabricMC/fabric/pull/525#discussion_r419457763", "createdAt": "2020-05-04T13:59:50Z", "author": {"login": "modmuss50"}, "path": "fabric-registry-sync-v0/src/main/java/net/fabricmc/fabric/impl/registry/sync/FabricRegistryInit.java", "diffHunk": "@@ -0,0 +1,158 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.impl.registry.sync;\n+\n+import net.minecraft.util.registry.Registry;\n+\n+import net.fabricmc.api.ModInitializer;\n+import net.fabricmc.fabric.api.event.registry.RegistryAttribute;\n+import net.fabricmc.fabric.api.event.registry.RegistryAttributeHolder;\n+\n+public class FabricRegistryInit implements ModInitializer {\n+\t@Override\n+\tpublic void onInitialize() {\n+\t\t// RegistryAttribute.SYNCED in PlaySoundS2CPacket.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d54ed1af9ec219ea41caac5a47d8b1d188eb32a4"}, "originalPosition": 28}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1MDE2NzY1", "url": "https://github.com/FabricMC/fabric/pull/525#pullrequestreview-405016765", "createdAt": "2020-05-04T14:02:47Z", "commit": {"oid": "d54ed1af9ec219ea41caac5a47d8b1d188eb32a4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxNDowMjo0N1rOGQBzNg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxNDowMjo0N1rOGQBzNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQ1OTg5NA==", "bodyText": "uhh, find and replace went wrong here ;) I will fix this. Should just be \"synced\"", "url": "https://github.com/FabricMC/fabric/pull/525#discussion_r419459894", "createdAt": "2020-05-04T14:02:47Z", "author": {"login": "modmuss50"}, "path": "fabric-registry-sync-v0/src/main/java/net/fabricmc/fabric/impl/registry/sync/FabricRegistryInit.java", "diffHunk": "@@ -0,0 +1,158 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.impl.registry.sync;\n+\n+import net.minecraft.util.registry.Registry;\n+\n+import net.fabricmc.api.ModInitializer;\n+import net.fabricmc.fabric.api.event.registry.RegistryAttribute;\n+import net.fabricmc.fabric.api.event.registry.RegistryAttributeHolder;\n+\n+public class FabricRegistryInit implements ModInitializer {\n+\t@Override\n+\tpublic void onInitialize() {\n+\t\t// RegistryAttribute.SYNCED in PlaySoundS2CPacket.\n+\t\tRegistryAttributeHolder.get(Registry.SOUND_EVENT)\n+\t\t\t\t.addAttribute(RegistryAttribute.SYNCED);\n+\n+\t\t// RegistryAttribute.SYNCED with RegistryTagContainer from RegistryTagManager.\n+\t\tRegistryAttributeHolder.get(Registry.FLUID)\n+\t\t\t\t.addAttribute(RegistryAttribute.SYNCED);\n+\n+\t\t// StatusEffectInstance serialises with raw id.\n+\t\tRegistryAttributeHolder.get(Registry.STATUS_EFFECT)\n+\t\t\t\t.addAttribute(RegistryAttribute.SYNCED)\n+\t\t\t\t.addAttribute(RegistryAttribute.PERSISTED);\n+\n+\t\t// RegistryAttribute.SYNCED in ChunkDeltaUpdateS2CPacket among other places, a pallet is used when saving.\n+\t\tRegistryAttributeHolder.get(Registry.BLOCK)\n+\t\t\t\t.addAttribute(RegistryAttribute.SYNCED);\n+\n+\t\t// Does not appear to be saved or RegistryAttribute.SYNCED, the string id is used.\n+\t\tRegistryAttributeHolder.get(Registry.ENCHANTMENT);\n+\n+\t\t// RegistryAttribute.SYNCED in EntitySpawnS2CPacket\n+\t\tRegistryAttributeHolder.get(Registry.ENTITY_TYPE)\n+\t\t\t\t.addAttribute(RegistryAttribute.SYNCED);\n+\n+\t\t// Doesnt appear to need syncing or saving?\n+\t\tRegistryAttributeHolder.get(Registry.ITEM)\n+\t\t\t\t.addAttribute(RegistryAttribute.SYNCED);\n+\n+\t\t// Saved and RegistryAttribute.SYNCED using string ID.\n+\t\tRegistryAttributeHolder.get(Registry.POTION);\n+\n+\t\t// Doesnt seem to be accessed apart from registering?\n+\t\tRegistryAttributeHolder.get(Registry.CARVER);\n+\n+\t\t// Doesnt seem to be accessed apart from registering?\n+\t\tRegistryAttributeHolder.get(Registry.SURFACE_BUILDER);\n+\n+\t\t// Serialised by string, doesnt seem to be RegistryAttribute.SYNCED\n+\t\tRegistryAttributeHolder.get(Registry.FEATURE);\n+\n+\t\t// Serialised by string, doesnt seem to be RegistryAttribute.SYNCED\n+\t\tRegistryAttributeHolder.get(Registry.DECORATOR);\n+\n+\t\t// Saved to level format\n+\t\tRegistryAttributeHolder.get(Registry.BIOME)\n+\t\t\t\t.addAttribute(RegistryAttribute.SYNCED)\n+\t\t\t\t.addAttribute(RegistryAttribute.PERSISTED);\n+\n+\t\t// Serialised by string, doesnt seem to be RegistryAttribute.SYNCED", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d54ed1af9ec219ea41caac5a47d8b1d188eb32a4"}, "originalPosition": 76}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1MDM2NTk5", "url": "https://github.com/FabricMC/fabric/pull/525#pullrequestreview-405036599", "createdAt": "2020-05-04T14:24:06Z", "commit": {"oid": "d54ed1af9ec219ea41caac5a47d8b1d188eb32a4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxNDoyNDowNlrOGQCvnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxNDoyNDowNlrOGQCvnQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQ3NTM1Nw==", "bodyText": "From what I can tell we dont need to sync items, but im not sure what happens with server side only items? We might need a way only make sure that the registries contain the same keys?", "url": "https://github.com/FabricMC/fabric/pull/525#discussion_r419475357", "createdAt": "2020-05-04T14:24:06Z", "author": {"login": "modmuss50"}, "path": "fabric-registry-sync-v0/src/main/java/net/fabricmc/fabric/impl/registry/sync/FabricRegistryInit.java", "diffHunk": "@@ -0,0 +1,158 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.impl.registry.sync;\n+\n+import net.minecraft.util.registry.Registry;\n+\n+import net.fabricmc.api.ModInitializer;\n+import net.fabricmc.fabric.api.event.registry.RegistryAttribute;\n+import net.fabricmc.fabric.api.event.registry.RegistryAttributeHolder;\n+\n+public class FabricRegistryInit implements ModInitializer {\n+\t@Override\n+\tpublic void onInitialize() {\n+\t\t// RegistryAttribute.SYNCED in PlaySoundS2CPacket.\n+\t\tRegistryAttributeHolder.get(Registry.SOUND_EVENT)\n+\t\t\t\t.addAttribute(RegistryAttribute.SYNCED);\n+\n+\t\t// RegistryAttribute.SYNCED with RegistryTagContainer from RegistryTagManager.\n+\t\tRegistryAttributeHolder.get(Registry.FLUID)\n+\t\t\t\t.addAttribute(RegistryAttribute.SYNCED);\n+\n+\t\t// StatusEffectInstance serialises with raw id.\n+\t\tRegistryAttributeHolder.get(Registry.STATUS_EFFECT)\n+\t\t\t\t.addAttribute(RegistryAttribute.SYNCED)\n+\t\t\t\t.addAttribute(RegistryAttribute.PERSISTED);\n+\n+\t\t// RegistryAttribute.SYNCED in ChunkDeltaUpdateS2CPacket among other places, a pallet is used when saving.\n+\t\tRegistryAttributeHolder.get(Registry.BLOCK)\n+\t\t\t\t.addAttribute(RegistryAttribute.SYNCED);\n+\n+\t\t// Does not appear to be saved or RegistryAttribute.SYNCED, the string id is used.\n+\t\tRegistryAttributeHolder.get(Registry.ENCHANTMENT);\n+\n+\t\t// RegistryAttribute.SYNCED in EntitySpawnS2CPacket\n+\t\tRegistryAttributeHolder.get(Registry.ENTITY_TYPE)\n+\t\t\t\t.addAttribute(RegistryAttribute.SYNCED);\n+\n+\t\t// Doesnt appear to need syncing or saving?\n+\t\tRegistryAttributeHolder.get(Registry.ITEM)\n+\t\t\t\t.addAttribute(RegistryAttribute.SYNCED);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d54ed1af9ec219ea41caac5a47d8b1d188eb32a4"}, "originalPosition": 54}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1MDU2Nzk4", "url": "https://github.com/FabricMC/fabric/pull/525#pullrequestreview-405056798", "createdAt": "2020-05-04T14:44:58Z", "commit": {"oid": "d54ed1af9ec219ea41caac5a47d8b1d188eb32a4"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxNDo0NDo1OFrOGQDsuw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxNDo1MDo1NFrOGQD9jQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQ5MTAwMw==", "bodyText": "If it is a builder wouldn't you want to just call the method attribute(RegistryAttribute)", "url": "https://github.com/FabricMC/fabric/pull/525#discussion_r419491003", "createdAt": "2020-05-04T14:44:58Z", "author": {"login": "i509VCB"}, "path": "fabric-registry-sync-v0/src/main/java/net/fabricmc/fabric/api/event/registry/FabricRegistryBuilder.java", "diffHunk": "@@ -0,0 +1,49 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.api.event.registry;\n+\n+import java.util.HashSet;\n+import java.util.Set;\n+\n+import net.minecraft.util.registry.Registry;\n+\n+import net.fabricmc.fabric.impl.registry.sync.FabricRegistry;\n+\n+public class FabricRegistryBuilder<T> {\n+\tpublic static <T> FabricRegistryBuilder<T> create(Registry<T> registry) {\n+\t\treturn new FabricRegistryBuilder<>(registry);\n+\t}\n+\n+\tprivate final Registry<T> registry;\n+\tprivate final Set<RegistryAttribute> attributes = new HashSet<>();\n+\n+\tprivate FabricRegistryBuilder(Registry<T> registry) {\n+\t\tthis.registry = registry;\n+\t\taddAttribute(RegistryAttribute.MODDED);\n+\t}\n+\n+\tpublic FabricRegistryBuilder<T> addAttribute(RegistryAttribute attribute) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d54ed1af9ec219ea41caac5a47d8b1d188eb32a4"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQ5NDc4Mg==", "bodyText": "I assume the fact this is used in a data tracker isn't a real issue with syncing. (I think it calls getRawId when being queried to track)\nThis is part of the VillagerDataContainer but that stores this as an identifier.\nSomething similar with the Villager professions.", "url": "https://github.com/FabricMC/fabric/pull/525#discussion_r419494782", "createdAt": "2020-05-04T14:50:10Z", "author": {"login": "i509VCB"}, "path": "fabric-registry-sync-v0/src/main/java/net/fabricmc/fabric/impl/registry/sync/FabricRegistryInit.java", "diffHunk": "@@ -0,0 +1,158 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.impl.registry.sync;\n+\n+import net.minecraft.util.registry.Registry;\n+\n+import net.fabricmc.api.ModInitializer;\n+import net.fabricmc.fabric.api.event.registry.RegistryAttribute;\n+import net.fabricmc.fabric.api.event.registry.RegistryAttributeHolder;\n+\n+public class FabricRegistryInit implements ModInitializer {\n+\t@Override\n+\tpublic void onInitialize() {\n+\t\t// RegistryAttribute.SYNCED in PlaySoundS2CPacket.\n+\t\tRegistryAttributeHolder.get(Registry.SOUND_EVENT)\n+\t\t\t\t.addAttribute(RegistryAttribute.SYNCED);\n+\n+\t\t// RegistryAttribute.SYNCED with RegistryTagContainer from RegistryTagManager.\n+\t\tRegistryAttributeHolder.get(Registry.FLUID)\n+\t\t\t\t.addAttribute(RegistryAttribute.SYNCED);\n+\n+\t\t// StatusEffectInstance serialises with raw id.\n+\t\tRegistryAttributeHolder.get(Registry.STATUS_EFFECT)\n+\t\t\t\t.addAttribute(RegistryAttribute.SYNCED)\n+\t\t\t\t.addAttribute(RegistryAttribute.PERSISTED);\n+\n+\t\t// RegistryAttribute.SYNCED in ChunkDeltaUpdateS2CPacket among other places, a pallet is used when saving.\n+\t\tRegistryAttributeHolder.get(Registry.BLOCK)\n+\t\t\t\t.addAttribute(RegistryAttribute.SYNCED);\n+\n+\t\t// Does not appear to be saved or RegistryAttribute.SYNCED, the string id is used.\n+\t\tRegistryAttributeHolder.get(Registry.ENCHANTMENT);\n+\n+\t\t// RegistryAttribute.SYNCED in EntitySpawnS2CPacket\n+\t\tRegistryAttributeHolder.get(Registry.ENTITY_TYPE)\n+\t\t\t\t.addAttribute(RegistryAttribute.SYNCED);\n+\n+\t\t// Doesnt appear to need syncing or saving?\n+\t\tRegistryAttributeHolder.get(Registry.ITEM)\n+\t\t\t\t.addAttribute(RegistryAttribute.SYNCED);\n+\n+\t\t// Saved and RegistryAttribute.SYNCED using string ID.\n+\t\tRegistryAttributeHolder.get(Registry.POTION);\n+\n+\t\t// Doesnt seem to be accessed apart from registering?\n+\t\tRegistryAttributeHolder.get(Registry.CARVER);\n+\n+\t\t// Doesnt seem to be accessed apart from registering?\n+\t\tRegistryAttributeHolder.get(Registry.SURFACE_BUILDER);\n+\n+\t\t// Serialised by string, doesnt seem to be RegistryAttribute.SYNCED\n+\t\tRegistryAttributeHolder.get(Registry.FEATURE);\n+\n+\t\t// Serialised by string, doesnt seem to be RegistryAttribute.SYNCED\n+\t\tRegistryAttributeHolder.get(Registry.DECORATOR);\n+\n+\t\t// Saved to level format\n+\t\tRegistryAttributeHolder.get(Registry.BIOME)\n+\t\t\t\t.addAttribute(RegistryAttribute.SYNCED)\n+\t\t\t\t.addAttribute(RegistryAttribute.PERSISTED);\n+\n+\t\t// Serialised by string, doesnt seem to be RegistryAttribute.SYNCED\n+\t\tRegistryAttributeHolder.get(Registry.BLOCK_STATE_PROVIDER_TYPE);\n+\n+\t\t// Serialised by string, doesnt seem to be RegistryAttribute.SYNCED\n+\t\tRegistryAttributeHolder.get(Registry.BLOCK_PLACER_TYPE);\n+\n+\t\t// Serialised by string, doesnt seem to be RegistryAttribute.SYNCED\n+\t\tRegistryAttributeHolder.get(Registry.FOLIAGE_PLACER_TYPE);\n+\n+\t\t// Serialised by string, doesnt seem to be RegistryAttribute.SYNCED\n+\t\tRegistryAttributeHolder.get(Registry.TRUNK_PLACER_TYPE);\n+\n+\t\t// Serialised by string, doesnt seem to be RegistryAttribute.SYNCED\n+\t\tRegistryAttributeHolder.get(Registry.TREE_DECORATOR_TYPE);\n+\n+\t\t// Serialised by string, doesnt seem to be RegistryAttribute.SYNCED\n+\t\tRegistryAttributeHolder.get(Registry.FEATURE_SIZE_TYPE);\n+\n+\t\t// RegistryAttribute.SYNCED in ParticleS2CPacket\n+\t\tRegistryAttributeHolder.get(Registry.PARTICLE_TYPE)\n+\t\t\t\t.addAttribute(RegistryAttribute.SYNCED);\n+\n+\t\t// Serialised by string, doesnt seem to be RegistryAttribute.SYNCED\n+\t\tRegistryAttributeHolder.get(Registry.BIOME_SOURCE_TYPE);\n+\n+\t\t// Serialised by string, doesnt seem to be RegistryAttribute.SYNCED\n+\t\tRegistryAttributeHolder.get(Registry.CHUNK_GENERATOR_TYPE);\n+\n+\t\t// RegistryAttribute.SYNCED in GameJoinS2CPacket and PlayerRespawnS2CPacket. Entities and maps also use the id when saving.\n+\t\tRegistryAttributeHolder.get(Registry.DIMENSION_TYPE)\n+\t\t\t\t.addAttribute(RegistryAttribute.SYNCED)\n+\t\t\t\t.addAttribute(RegistryAttribute.PERSISTED);\n+\n+\t\t// RegistryAttribute.SYNCED in PaintingSpawnS2CPacket\n+\t\tRegistryAttributeHolder.get(Registry.PAINTING_MOTIVE)\n+\t\t\t\t.addAttribute(RegistryAttribute.SYNCED);\n+\n+\t\t// Doesnt seem to be RegistryAttribute.SYNCED or saved, STAT_TYPE seems to handle the syncing.\n+\t\tRegistryAttributeHolder.get(Registry.CUSTOM_STAT);\n+\n+\t\tRegistryAttributeHolder.get(Registry.CHUNK_STATUS);\n+\n+\t\tRegistryAttributeHolder.get(Registry.STRUCTURE_FEATURE);\n+\n+\t\tRegistryAttributeHolder.get(Registry.STRUCTURE_PIECE);\n+\n+\t\tRegistryAttributeHolder.get(Registry.RULE_TEST);\n+\n+\t\tRegistryAttributeHolder.get(Registry.POS_RULE_TEST);\n+\n+\t\tRegistryAttributeHolder.get(Registry.STRUCTURE_PROCESSOR);\n+\n+\t\tRegistryAttributeHolder.get(Registry.STRUCTURE_POOL_ELEMENT);\n+\n+\t\t// RegistryAttribute.SYNCED in OpenScreenS2CPacket\n+\t\tRegistryAttributeHolder.get(Registry.SCREEN_HANDLER)\n+\t\t\t\t.addAttribute(RegistryAttribute.SYNCED);\n+\n+\t\tRegistryAttributeHolder.get(Registry.RECIPE_TYPE);\n+\n+\t\tRegistryAttributeHolder.get(Registry.RECIPE_SERIALIZER);\n+\n+\t\tRegistryAttributeHolder.get(Registry.ATTRIBUTES);\n+\n+\t\t// RegistryAttribute.SYNCED in StatisticsS2CPacket\n+\t\tRegistryAttributeHolder.get(Registry.STAT_TYPE)\n+\t\t\t\t.addAttribute(RegistryAttribute.SYNCED);\n+\n+\t\tRegistryAttributeHolder.get(Registry.VILLAGER_TYPE);\n+\n+\t\tRegistryAttributeHolder.get(Registry.VILLAGER_PROFESSION);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d54ed1af9ec219ea41caac5a47d8b1d188eb32a4"}, "originalPosition": 146}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQ5NTMwOQ==", "bodyText": "Only present on a server world from my knowledge.", "url": "https://github.com/FabricMC/fabric/pull/525#discussion_r419495309", "createdAt": "2020-05-04T14:50:54Z", "author": {"login": "i509VCB"}, "path": "fabric-registry-sync-v0/src/main/java/net/fabricmc/fabric/impl/registry/sync/FabricRegistryInit.java", "diffHunk": "@@ -0,0 +1,158 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.impl.registry.sync;\n+\n+import net.minecraft.util.registry.Registry;\n+\n+import net.fabricmc.api.ModInitializer;\n+import net.fabricmc.fabric.api.event.registry.RegistryAttribute;\n+import net.fabricmc.fabric.api.event.registry.RegistryAttributeHolder;\n+\n+public class FabricRegistryInit implements ModInitializer {\n+\t@Override\n+\tpublic void onInitialize() {\n+\t\t// RegistryAttribute.SYNCED in PlaySoundS2CPacket.\n+\t\tRegistryAttributeHolder.get(Registry.SOUND_EVENT)\n+\t\t\t\t.addAttribute(RegistryAttribute.SYNCED);\n+\n+\t\t// RegistryAttribute.SYNCED with RegistryTagContainer from RegistryTagManager.\n+\t\tRegistryAttributeHolder.get(Registry.FLUID)\n+\t\t\t\t.addAttribute(RegistryAttribute.SYNCED);\n+\n+\t\t// StatusEffectInstance serialises with raw id.\n+\t\tRegistryAttributeHolder.get(Registry.STATUS_EFFECT)\n+\t\t\t\t.addAttribute(RegistryAttribute.SYNCED)\n+\t\t\t\t.addAttribute(RegistryAttribute.PERSISTED);\n+\n+\t\t// RegistryAttribute.SYNCED in ChunkDeltaUpdateS2CPacket among other places, a pallet is used when saving.\n+\t\tRegistryAttributeHolder.get(Registry.BLOCK)\n+\t\t\t\t.addAttribute(RegistryAttribute.SYNCED);\n+\n+\t\t// Does not appear to be saved or RegistryAttribute.SYNCED, the string id is used.\n+\t\tRegistryAttributeHolder.get(Registry.ENCHANTMENT);\n+\n+\t\t// RegistryAttribute.SYNCED in EntitySpawnS2CPacket\n+\t\tRegistryAttributeHolder.get(Registry.ENTITY_TYPE)\n+\t\t\t\t.addAttribute(RegistryAttribute.SYNCED);\n+\n+\t\t// Doesnt appear to need syncing or saving?\n+\t\tRegistryAttributeHolder.get(Registry.ITEM)\n+\t\t\t\t.addAttribute(RegistryAttribute.SYNCED);\n+\n+\t\t// Saved and RegistryAttribute.SYNCED using string ID.\n+\t\tRegistryAttributeHolder.get(Registry.POTION);\n+\n+\t\t// Doesnt seem to be accessed apart from registering?\n+\t\tRegistryAttributeHolder.get(Registry.CARVER);\n+\n+\t\t// Doesnt seem to be accessed apart from registering?\n+\t\tRegistryAttributeHolder.get(Registry.SURFACE_BUILDER);\n+\n+\t\t// Serialised by string, doesnt seem to be RegistryAttribute.SYNCED\n+\t\tRegistryAttributeHolder.get(Registry.FEATURE);\n+\n+\t\t// Serialised by string, doesnt seem to be RegistryAttribute.SYNCED\n+\t\tRegistryAttributeHolder.get(Registry.DECORATOR);\n+\n+\t\t// Saved to level format\n+\t\tRegistryAttributeHolder.get(Registry.BIOME)\n+\t\t\t\t.addAttribute(RegistryAttribute.SYNCED)\n+\t\t\t\t.addAttribute(RegistryAttribute.PERSISTED);\n+\n+\t\t// Serialised by string, doesnt seem to be RegistryAttribute.SYNCED\n+\t\tRegistryAttributeHolder.get(Registry.BLOCK_STATE_PROVIDER_TYPE);\n+\n+\t\t// Serialised by string, doesnt seem to be RegistryAttribute.SYNCED\n+\t\tRegistryAttributeHolder.get(Registry.BLOCK_PLACER_TYPE);\n+\n+\t\t// Serialised by string, doesnt seem to be RegistryAttribute.SYNCED\n+\t\tRegistryAttributeHolder.get(Registry.FOLIAGE_PLACER_TYPE);\n+\n+\t\t// Serialised by string, doesnt seem to be RegistryAttribute.SYNCED\n+\t\tRegistryAttributeHolder.get(Registry.TRUNK_PLACER_TYPE);\n+\n+\t\t// Serialised by string, doesnt seem to be RegistryAttribute.SYNCED\n+\t\tRegistryAttributeHolder.get(Registry.TREE_DECORATOR_TYPE);\n+\n+\t\t// Serialised by string, doesnt seem to be RegistryAttribute.SYNCED\n+\t\tRegistryAttributeHolder.get(Registry.FEATURE_SIZE_TYPE);\n+\n+\t\t// RegistryAttribute.SYNCED in ParticleS2CPacket\n+\t\tRegistryAttributeHolder.get(Registry.PARTICLE_TYPE)\n+\t\t\t\t.addAttribute(RegistryAttribute.SYNCED);\n+\n+\t\t// Serialised by string, doesnt seem to be RegistryAttribute.SYNCED\n+\t\tRegistryAttributeHolder.get(Registry.BIOME_SOURCE_TYPE);\n+\n+\t\t// Serialised by string, doesnt seem to be RegistryAttribute.SYNCED\n+\t\tRegistryAttributeHolder.get(Registry.CHUNK_GENERATOR_TYPE);\n+\n+\t\t// RegistryAttribute.SYNCED in GameJoinS2CPacket and PlayerRespawnS2CPacket. Entities and maps also use the id when saving.\n+\t\tRegistryAttributeHolder.get(Registry.DIMENSION_TYPE)\n+\t\t\t\t.addAttribute(RegistryAttribute.SYNCED)\n+\t\t\t\t.addAttribute(RegistryAttribute.PERSISTED);\n+\n+\t\t// RegistryAttribute.SYNCED in PaintingSpawnS2CPacket\n+\t\tRegistryAttributeHolder.get(Registry.PAINTING_MOTIVE)\n+\t\t\t\t.addAttribute(RegistryAttribute.SYNCED);\n+\n+\t\t// Doesnt seem to be RegistryAttribute.SYNCED or saved, STAT_TYPE seems to handle the syncing.\n+\t\tRegistryAttributeHolder.get(Registry.CUSTOM_STAT);\n+\n+\t\tRegistryAttributeHolder.get(Registry.CHUNK_STATUS);\n+\n+\t\tRegistryAttributeHolder.get(Registry.STRUCTURE_FEATURE);\n+\n+\t\tRegistryAttributeHolder.get(Registry.STRUCTURE_PIECE);\n+\n+\t\tRegistryAttributeHolder.get(Registry.RULE_TEST);\n+\n+\t\tRegistryAttributeHolder.get(Registry.POS_RULE_TEST);\n+\n+\t\tRegistryAttributeHolder.get(Registry.STRUCTURE_PROCESSOR);\n+\n+\t\tRegistryAttributeHolder.get(Registry.STRUCTURE_POOL_ELEMENT);\n+\n+\t\t// RegistryAttribute.SYNCED in OpenScreenS2CPacket\n+\t\tRegistryAttributeHolder.get(Registry.SCREEN_HANDLER)\n+\t\t\t\t.addAttribute(RegistryAttribute.SYNCED);\n+\n+\t\tRegistryAttributeHolder.get(Registry.RECIPE_TYPE);\n+\n+\t\tRegistryAttributeHolder.get(Registry.RECIPE_SERIALIZER);\n+\n+\t\tRegistryAttributeHolder.get(Registry.ATTRIBUTES);\n+\n+\t\t// RegistryAttribute.SYNCED in StatisticsS2CPacket\n+\t\tRegistryAttributeHolder.get(Registry.STAT_TYPE)\n+\t\t\t\t.addAttribute(RegistryAttribute.SYNCED);\n+\n+\t\tRegistryAttributeHolder.get(Registry.VILLAGER_TYPE);\n+\n+\t\tRegistryAttributeHolder.get(Registry.VILLAGER_PROFESSION);\n+\n+\t\tRegistryAttributeHolder.get(Registry.POINT_OF_INTEREST_TYPE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d54ed1af9ec219ea41caac5a47d8b1d188eb32a4"}, "originalPosition": 148}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "36e2a931e1085541998d5a1fa326ab7361433d38", "author": {"user": {"login": "modmuss50", "name": "modmuss50"}}, "url": "https://github.com/FabricMC/fabric/commit/36e2a931e1085541998d5a1fa326ab7361433d38", "committedDate": "2020-05-07T21:33:58Z", "message": "Merge branch '1.16' into vanilla_registries"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5a8135c210eefbc0f1d32fd1161851f967f75271", "author": {"user": {"login": "modmuss50", "name": "modmuss50"}}, "url": "https://github.com/FabricMC/fabric/commit/5a8135c210eefbc0f1d32fd1161851f967f75271", "committedDate": "2020-05-07T21:36:50Z", "message": "Some minor style fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2da1e2b041e6a01b13a7e085ff9235f7fc77bb86", "author": {"user": {"login": "modmuss50", "name": "modmuss50"}}, "url": "https://github.com/FabricMC/fabric/commit/2da1e2b041e6a01b13a7e085ff9235f7fc77bb86", "committedDate": "2020-05-07T21:48:07Z", "message": "Finish checking registries"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "57cf312c5e581efb0a1414bed2525b4fe3e362ba", "author": {"user": {"login": "modmuss50", "name": "modmuss50"}}, "url": "https://github.com/FabricMC/fabric/commit/57cf312c5e581efb0a1414bed2525b4fe3e362ba", "committedDate": "2020-05-08T12:37:52Z", "message": "Start on a test mod, and apply some fixes."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c8916aee09265a79f16512d7ba002ca0363bcce6", "author": {"user": {"login": "modmuss50", "name": "modmuss50"}}, "url": "https://github.com/FabricMC/fabric/commit/c8916aee09265a79f16512d7ba002ca0363bcce6", "committedDate": "2020-05-09T20:55:41Z", "message": "Checkstyle fixes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4Njg0MzQx", "url": "https://github.com/FabricMC/fabric/pull/525#pullrequestreview-408684341", "createdAt": "2020-05-09T21:06:22Z", "commit": {"oid": "c8916aee09265a79f16512d7ba002ca0363bcce6"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOVQyMTowNjoyMlrOGS-K7Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOVQyMTowODoyNVrOGS-L6A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjU0NjE1Nw==", "bodyText": "Need a synced here, you missed that line", "url": "https://github.com/FabricMC/fabric/pull/525#discussion_r422546157", "createdAt": "2020-05-09T21:06:22Z", "author": {"login": "liach"}, "path": "fabric-registry-sync-v0/src/main/java/net/fabricmc/fabric/impl/registry/sync/FabricRegistryInit.java", "diffHunk": "@@ -0,0 +1,175 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.impl.registry.sync;\n+\n+import net.minecraft.util.registry.Registry;\n+\n+import net.fabricmc.api.ModInitializer;\n+import net.fabricmc.fabric.api.event.registry.RegistryAttribute;\n+import net.fabricmc.fabric.api.event.registry.RegistryAttributeHolder;\n+\n+public class FabricRegistryInit implements ModInitializer {\n+\t@Override\n+\tpublic void onInitialize() {\n+\t\t// Synced in PlaySoundS2CPacket.\n+\t\tRegistryAttributeHolder.get(Registry.SOUND_EVENT)\n+\t\t\t\t.addAttribute(RegistryAttribute.SYNCED);\n+\n+\t\t// Synced with RegistryTagContainer from RegistryTagManager.\n+\t\tRegistryAttributeHolder.get(Registry.FLUID)\n+\t\t\t\t.addAttribute(RegistryAttribute.SYNCED);\n+\n+\t\t// StatusEffectInstance serialises with raw id.\n+\t\tRegistryAttributeHolder.get(Registry.STATUS_EFFECT)\n+\t\t\t\t.addAttribute(RegistryAttribute.SYNCED)\n+\t\t\t\t.addAttribute(RegistryAttribute.PERSISTED);\n+\n+\t\t// Synced in ChunkDeltaUpdateS2CPacket among other places, a pallet is used when saving.\n+\t\tRegistryAttributeHolder.get(Registry.BLOCK)\n+\t\t\t\t.addAttribute(RegistryAttribute.SYNCED);\n+\n+\t\t// Does not appear to be saved or synced, the string id is used.\n+\t\tRegistryAttributeHolder.get(Registry.ENCHANTMENT);\n+\n+\t\t// Synced in EntitySpawnS2CPacket\n+\t\tRegistryAttributeHolder.get(Registry.ENTITY_TYPE)\n+\t\t\t\t.addAttribute(RegistryAttribute.SYNCED);\n+\n+\t\t// Doesnt appear to need syncing or saving?\n+\t\tRegistryAttributeHolder.get(Registry.ITEM)\n+\t\t\t\t.addAttribute(RegistryAttribute.SYNCED);\n+\n+\t\t// Saved and synced using string ID.\n+\t\tRegistryAttributeHolder.get(Registry.POTION);\n+\n+\t\t// Doesnt seem to be accessed apart from registering?\n+\t\tRegistryAttributeHolder.get(Registry.CARVER);\n+\n+\t\t// Doesnt seem to be accessed apart from registering?\n+\t\tRegistryAttributeHolder.get(Registry.SURFACE_BUILDER);\n+\n+\t\t// Serialised by string, doesnt seem to be synced\n+\t\tRegistryAttributeHolder.get(Registry.FEATURE);\n+\n+\t\t// Serialised by string, doesnt seem to be synced\n+\t\tRegistryAttributeHolder.get(Registry.DECORATOR);\n+\n+\t\t// Saved to level format\n+\t\tRegistryAttributeHolder.get(Registry.BIOME)\n+\t\t\t\t.addAttribute(RegistryAttribute.SYNCED)\n+\t\t\t\t.addAttribute(RegistryAttribute.PERSISTED);\n+\n+\t\t// Serialised by string, doesnt seem to be synced\n+\t\tRegistryAttributeHolder.get(Registry.BLOCK_STATE_PROVIDER_TYPE);\n+\n+\t\t// Serialised by string, doesnt seem to be synced\n+\t\tRegistryAttributeHolder.get(Registry.BLOCK_PLACER_TYPE);\n+\n+\t\t// Serialised by string, doesnt seem to be synced\n+\t\tRegistryAttributeHolder.get(Registry.FOLIAGE_PLACER_TYPE);\n+\n+\t\t// Serialised by string, doesnt seem to be synced\n+\t\tRegistryAttributeHolder.get(Registry.TRUNK_PLACER_TYPE);\n+\n+\t\t// Serialised by string, doesnt seem to be synced\n+\t\tRegistryAttributeHolder.get(Registry.TREE_DECORATOR_TYPE);\n+\n+\t\t// Serialised by string, doesnt seem to be synced\n+\t\tRegistryAttributeHolder.get(Registry.FEATURE_SIZE_TYPE);\n+\n+\t\t// Synced in ParticleS2CPacket\n+\t\tRegistryAttributeHolder.get(Registry.PARTICLE_TYPE)\n+\t\t\t\t.addAttribute(RegistryAttribute.SYNCED);\n+\n+\t\t// Serialised by string, doesnt seem to be synced\n+\t\tRegistryAttributeHolder.get(Registry.BIOME_SOURCE_TYPE);\n+\n+\t\t// Serialised by string, doesnt seem to be synced\n+\t\tRegistryAttributeHolder.get(Registry.CHUNK_GENERATOR_TYPE);\n+\n+\t\t// Synced in GameJoinS2CPacket and PlayerRespawnS2CPacket. Entities and maps also use the id when saving.\n+\t\tRegistryAttributeHolder.get(Registry.DIMENSION_TYPE)\n+\t\t\t\t.addAttribute(RegistryAttribute.SYNCED)\n+\t\t\t\t.addAttribute(RegistryAttribute.PERSISTED);\n+\n+\t\t// Synced in PaintingSpawnS2CPacket\n+\t\tRegistryAttributeHolder.get(Registry.PAINTING_MOTIVE)\n+\t\t\t\t.addAttribute(RegistryAttribute.SYNCED);\n+\n+\t\t// Doesnt seem to be synced or saved, STAT_TYPE seems to handle the syncing.\n+\t\tRegistryAttributeHolder.get(Registry.CUSTOM_STAT);\n+\n+\t\t// Serialised by string, doesnt seem to be synced\n+\t\tRegistryAttributeHolder.get(Registry.CHUNK_STATUS);\n+\n+\t\t// Serialised by string, doesnt seem to be synced\n+\t\tRegistryAttributeHolder.get(Registry.STRUCTURE_FEATURE);\n+\n+\t\t// Serialised by string, doesnt seem to be synced\n+\t\tRegistryAttributeHolder.get(Registry.STRUCTURE_PIECE);\n+\n+\t\t// Serialised by string, doesnt seem to be synced\n+\t\tRegistryAttributeHolder.get(Registry.RULE_TEST);\n+\n+\t\t// Serialised by string, doesnt seem to be synced\n+\t\tRegistryAttributeHolder.get(Registry.POS_RULE_TEST);\n+\n+\t\tRegistryAttributeHolder.get(Registry.STRUCTURE_PROCESSOR);\n+\n+\t\t// Serialised by string, doesnt seem to be synced\n+\t\tRegistryAttributeHolder.get(Registry.STRUCTURE_POOL_ELEMENT);\n+\n+\t\t// Synced in OpenScreenS2CPacket\n+\t\tRegistryAttributeHolder.get(Registry.SCREEN_HANDLER)\n+\t\t\t\t.addAttribute(RegistryAttribute.SYNCED);\n+\n+\t\t// Does not seem to be serialised, only queried by id. Not synced\n+\t\tRegistryAttributeHolder.get(Registry.RECIPE_TYPE);\n+\n+\t\t// Synced by id\n+\t\tRegistryAttributeHolder.get(Registry.RECIPE_SERIALIZER);\n+\n+\t\t// Synced and saved by id\n+\t\tRegistryAttributeHolder.get(Registry.ATTRIBUTES);\n+\n+\t\t// Synced in StatisticsS2CPacket\n+\t\tRegistryAttributeHolder.get(Registry.STAT_TYPE)\n+\t\t\t\t.addAttribute(RegistryAttribute.SYNCED);\n+\n+\t\t// Synced by rawID in TrackedDataHandlerRegistry.VILLAGER_DATA\n+\t\tRegistryAttributeHolder.get(Registry.VILLAGER_TYPE)\n+\t\t\t\t.addAttribute(RegistryAttribute.SYNCED);\n+\n+\t\t// Synced by rawID in TrackedDataHandlerRegistry.VILLAGER_DATA\n+\t\tRegistryAttributeHolder.get(Registry.VILLAGER_PROFESSION);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c8916aee09265a79f16512d7ba002ca0363bcce6"}, "originalPosition": 158}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjU0NjIzOQ==", "bodyText": "Should probably bump version here", "url": "https://github.com/FabricMC/fabric/pull/525#discussion_r422546239", "createdAt": "2020-05-09T21:07:01Z", "author": {"login": "liach"}, "path": "fabric-registry-sync-v0/src/main/java/net/fabricmc/fabric/impl/registry/sync/RegistrySyncManager.java", "diffHunk": "@@ -168,18 +204,38 @@ public static CompoundTag toTag(boolean isClientSync) {\n \t\t\t\t\tregistryTag.putInt(id.toString(), rawId);\n \t\t\t\t}\n \n+\t\t\t\t// Look for existing registry key/values that are not in the current registries\n+\t\t\t\tif (!isClientSync && existingRegistryData != null) {\n+\t\t\t\t\tfor (String key : existingRegistryData.getKeys()) {\n+\t\t\t\t\t\tif (!registryTag.contains(key)) {\n+\t\t\t\t\t\t\tLOGGER.info(\"Saving orphaned registry entry: \" + key);\n+\t\t\t\t\t\t\tregistryTag.putInt(key, registryTag.getInt(key));\n+\t\t\t\t\t\t}\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\n \t\t\t\tmainTag.put(registryId.toString(), registryTag);\n \t\t\t}\n \t\t}\n \n+\t\t// Ensure any orphaned registry's are kept on disk\n+\t\tif (!isClientSync && activeIdMap != null) {\n+\t\t\tfor (String registryKey : activeIdMap.getKeys()) {\n+\t\t\t\tif (!mainTag.contains(registryKey)) {\n+\t\t\t\t\tLOGGER.info(\"Saving orphaned registry: \" + registryKey);\n+\t\t\t\t\tmainTag.put(registryKey, activeIdMap.getCompound(registryKey));\n+\t\t\t\t}\n+\t\t\t}\n+\t\t}\n+\n \t\tCompoundTag tag = new CompoundTag();\n \t\ttag.putInt(\"version\", 1);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c8916aee09265a79f16512d7ba002ca0363bcce6"}, "originalPosition": 139}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjU0NjQwOA==", "bodyText": "enum set maybe? unless you use manningheim mills", "url": "https://github.com/FabricMC/fabric/pull/525#discussion_r422546408", "createdAt": "2020-05-09T21:08:25Z", "author": {"login": "liach"}, "path": "fabric-registry-sync-v0/src/main/java/net/fabricmc/fabric/mixin/registry/sync/MixinRegistry.java", "diffHunk": "@@ -0,0 +1,83 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.mixin.registry.sync;\n+\n+import java.util.HashSet;\n+import java.util.Set;\n+\n+import org.spongepowered.asm.mixin.Mixin;\n+import org.spongepowered.asm.mixin.Shadow;\n+import org.spongepowered.asm.mixin.Unique;\n+\n+import net.minecraft.util.registry.Registry;\n+import net.minecraft.util.Identifier;\n+\n+import net.fabricmc.fabric.api.event.registry.RegistryAttribute;\n+import net.fabricmc.fabric.api.event.registry.RegistryAttributeHolder;\n+import net.fabricmc.fabric.impl.registry.sync.FabricRegistry;\n+import net.fabricmc.fabric.impl.registry.sync.HashedRegistry;\n+\n+@Mixin(Registry.class)\n+public abstract class MixinRegistry<T> implements RegistryAttributeHolder, FabricRegistry, HashedRegistry {\n+\t@Unique\n+\tprivate final Set<RegistryAttribute> attributes = new HashSet<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c8916aee09265a79f16512d7ba002ca0363bcce6"}, "originalPosition": 37}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6186a43450f0fe7004f973b7389db27872c721fb", "author": {"user": {"login": "modmuss50", "name": "modmuss50"}}, "url": "https://github.com/FabricMC/fabric/commit/6186a43450f0fe7004f973b7389db27872c721fb", "committedDate": "2020-05-09T21:36:33Z", "message": "Tweak the logic behind previously modded registries"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4Njg2NTI3", "url": "https://github.com/FabricMC/fabric/pull/525#pullrequestreview-408686527", "createdAt": "2020-05-09T21:45:02Z", "commit": {"oid": "6186a43450f0fe7004f973b7389db27872c721fb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6da77ed8f8424d6a6d02906f8111c2dc7e476e61", "author": {"user": {"login": "modmuss50", "name": "modmuss50"}}, "url": "https://github.com/FabricMC/fabric/commit/6da77ed8f8424d6a6d02906f8111c2dc7e476e61", "committedDate": "2020-05-09T21:46:00Z", "message": "Use EnumSet"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4Njg4MDYw", "url": "https://github.com/FabricMC/fabric/pull/525#pullrequestreview-408688060", "createdAt": "2020-05-09T22:13:39Z", "commit": {"oid": "6da77ed8f8424d6a6d02906f8111c2dc7e476e61"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOVQyMjoxMzo0MFrOGS-kqA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOVQyMjoxMzo0MFrOGS-kqA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjU1Mjc0NA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \tprivate final EnumSet<RegistryAttribute> attributes = EnumSet.allOf(RegistryAttribute.class);\n          \n          \n            \n            \tprivate final EnumSet<RegistryAttribute> attributes = EnumSet.noneOf(RegistryAttribute.class);", "url": "https://github.com/FabricMC/fabric/pull/525#discussion_r422552744", "createdAt": "2020-05-09T22:13:40Z", "author": {"login": "liach"}, "path": "fabric-registry-sync-v0/src/main/java/net/fabricmc/fabric/mixin/registry/sync/MixinRegistry.java", "diffHunk": "@@ -34,7 +34,7 @@\n @Mixin(Registry.class)\n public abstract class MixinRegistry<T> implements RegistryAttributeHolder, FabricRegistry, HashedRegistry {\n \t@Unique\n-\tprivate final Set<RegistryAttribute> attributes = new HashSet<>();\n+\tprivate final EnumSet<RegistryAttribute> attributes = EnumSet.allOf(RegistryAttribute.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6da77ed8f8424d6a6d02906f8111c2dc7e476e61"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "976c20e6fd9c5c8c5882aa7fc0d13a912a7eacc9", "author": {"user": {"login": "modmuss50", "name": "modmuss50"}}, "url": "https://github.com/FabricMC/fabric/commit/976c20e6fd9c5c8c5882aa7fc0d13a912a7eacc9", "committedDate": "2020-05-09T22:16:08Z", "message": "Update fabric-registry-sync-v0/src/main/java/net/fabricmc/fabric/mixin/registry/sync/MixinRegistry.java\n\nCo-authored-by: liach <7806504+liach@users.noreply.github.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4Njg4Mzkx", "url": "https://github.com/FabricMC/fabric/pull/525#pullrequestreview-408688391", "createdAt": "2020-05-09T22:19:28Z", "commit": {"oid": "976c20e6fd9c5c8c5882aa7fc0d13a912a7eacc9"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOVQyMjoxOToyOFrOGS-m1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wOVQyMjoyMDoyMFrOGS-nKw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjU1MzMwMg==", "bodyText": "are all registries always going to be modded, just curious?", "url": "https://github.com/FabricMC/fabric/pull/525#discussion_r422553302", "createdAt": "2020-05-09T22:19:28Z", "author": {"login": "liach"}, "path": "fabric-registry-sync-v0/src/main/java/net/fabricmc/fabric/api/event/registry/FabricRegistryBuilder.java", "diffHunk": "@@ -0,0 +1,49 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.api.event.registry;\n+\n+import java.util.HashSet;\n+import java.util.Set;\n+\n+import net.minecraft.util.registry.Registry;\n+\n+import net.fabricmc.fabric.impl.registry.sync.FabricRegistry;\n+\n+public class FabricRegistryBuilder<T> {\n+\tpublic static <T> FabricRegistryBuilder<T> create(Registry<T> registry) {\n+\t\treturn new FabricRegistryBuilder<>(registry);\n+\t}\n+\n+\tprivate final Registry<T> registry;\n+\tprivate final Set<RegistryAttribute> attributes = new HashSet<>();\n+\n+\tprivate FabricRegistryBuilder(Registry<T> registry) {\n+\t\tthis.registry = registry;\n+\t\tattribute(RegistryAttribute.MODDED);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "976c20e6fd9c5c8c5882aa7fc0d13a912a7eacc9"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjU1MzM4Nw==", "bodyText": "Wondering if we can sort these calls by their order of appearance in Registry class or how are we going to organize and make sure no vanilla registry is missed?", "url": "https://github.com/FabricMC/fabric/pull/525#discussion_r422553387", "createdAt": "2020-05-09T22:20:20Z", "author": {"login": "liach"}, "path": "fabric-registry-sync-v0/src/main/java/net/fabricmc/fabric/impl/registry/sync/FabricRegistryInit.java", "diffHunk": "@@ -0,0 +1,175 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.impl.registry.sync;\n+\n+import net.minecraft.util.registry.Registry;\n+\n+import net.fabricmc.api.ModInitializer;\n+import net.fabricmc.fabric.api.event.registry.RegistryAttribute;\n+import net.fabricmc.fabric.api.event.registry.RegistryAttributeHolder;\n+\n+public class FabricRegistryInit implements ModInitializer {\n+\t@Override\n+\tpublic void onInitialize() {\n+\t\t// Synced in PlaySoundS2CPacket.\n+\t\tRegistryAttributeHolder.get(Registry.SOUND_EVENT)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "976c20e6fd9c5c8c5882aa7fc0d13a912a7eacc9"}, "originalPosition": 29}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a2f7212d4f8669a579e9f0c42130e1ae07374be2", "author": {"user": {"login": "modmuss50", "name": "modmuss50"}}, "url": "https://github.com/FabricMC/fabric/commit/a2f7212d4f8669a579e9f0c42130e1ae07374be2", "committedDate": "2020-05-11T23:56:23Z", "message": "Merge branch '1.16' into vanilla_registries"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "926ef1e408dc1361a9600f6429c4099629ce4b3e", "author": {"user": {"login": "modmuss50", "name": "modmuss50"}}, "url": "https://github.com/FabricMC/fabric/commit/926ef1e408dc1361a9600f6429c4099629ce4b3e", "committedDate": "2020-05-12T00:11:37Z", "message": "Fix generics, add javadoc, add tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5NjE5OTI2", "url": "https://github.com/FabricMC/fabric/pull/525#pullrequestreview-409619926", "createdAt": "2020-05-12T00:27:17Z", "commit": {"oid": "926ef1e408dc1361a9600f6429c4099629ce4b3e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwMDoyNzoxN1rOGTx8Sw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwMDoyNzoxN1rOGTx8Sw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzM5NDM3OQ==", "bodyText": "I personally find it a bit odd to pass registry into a builder.", "url": "https://github.com/FabricMC/fabric/pull/525#discussion_r423394379", "createdAt": "2020-05-12T00:27:17Z", "author": {"login": "i509VCB"}, "path": "fabric-registry-sync-v0/src/main/java/net/fabricmc/fabric/api/event/registry/FabricRegistryBuilder.java", "diffHunk": "@@ -0,0 +1,82 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.api.event.registry;\n+\n+import java.util.HashSet;\n+import java.util.Set;\n+\n+import net.minecraft.util.registry.Registry;\n+\n+import net.fabricmc.fabric.impl.registry.sync.FabricRegistry;\n+\n+/**\n+ * Used to create custom registry's, with specified registry attributes.\n+ *\n+ * <pre>\n+ *     MutableRegistry<String> exampleRegistry = FabricRegistryBuilder.create(new SimpleRegistry<String>())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "926ef1e408dc1361a9600f6429c4099629ce4b3e"}, "originalPosition": 30}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5ODg3MTU5", "url": "https://github.com/FabricMC/fabric/pull/525#pullrequestreview-409887159", "createdAt": "2020-05-12T09:59:36Z", "commit": {"oid": "926ef1e408dc1361a9600f6429c4099629ce4b3e"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwOTo1OTozNlrOGT_S1w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQwOTo1OTozNlrOGT_S1w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzYxMzE0Mw==", "bodyText": "{@literal} please for < and >, or use &lt; for < and &gt; for >.", "url": "https://github.com/FabricMC/fabric/pull/525#discussion_r423613143", "createdAt": "2020-05-12T09:59:36Z", "author": {"login": "liach"}, "path": "fabric-registry-sync-v0/src/main/java/net/fabricmc/fabric/api/event/registry/FabricRegistryBuilder.java", "diffHunk": "@@ -0,0 +1,82 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.api.event.registry;\n+\n+import java.util.HashSet;\n+import java.util.Set;\n+\n+import net.minecraft.util.registry.Registry;\n+\n+import net.fabricmc.fabric.impl.registry.sync.FabricRegistry;\n+\n+/**\n+ * Used to create custom registry's, with specified registry attributes.\n+ *\n+ * <pre>\n+ *     MutableRegistry<String> exampleRegistry = FabricRegistryBuilder.create(new SimpleRegistry<String>())", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzM5NDM3OQ=="}, "originalCommit": {"oid": "926ef1e408dc1361a9600f6429c4099629ce4b3e"}, "originalPosition": 30}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3fb992723f4b4463f59d74705459e420ba8a6d9c", "author": {"user": {"login": "modmuss50", "name": "modmuss50"}}, "url": "https://github.com/FabricMC/fabric/commit/3fb992723f4b4463f59d74705459e420ba8a6d9c", "committedDate": "2020-05-13T17:06:44Z", "message": "More changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ecb4240a44d716ac7c553e046805834644bea52c", "author": {"user": {"login": "modmuss50", "name": "modmuss50"}}, "url": "https://github.com/FabricMC/fabric/commit/ecb4240a44d716ac7c553e046805834644bea52c", "committedDate": "2020-05-15T13:16:31Z", "message": "Merge branch '1.16' into vanilla_registries"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7b62eada728c2ccd9f66793286103563c2c3031c", "author": {"user": {"login": "modmuss50", "name": "modmuss50"}}, "url": "https://github.com/FabricMC/fabric/commit/7b62eada728c2ccd9f66793286103563c2c3031c", "committedDate": "2020-05-15T13:18:44Z", "message": "Checkstyle fixes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyOTEyMzA3", "url": "https://github.com/FabricMC/fabric/pull/525#pullrequestreview-412912307", "createdAt": "2020-05-15T19:27:28Z", "commit": {"oid": "7b62eada728c2ccd9f66793286103563c2c3031c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzMDc1OTEw", "url": "https://github.com/FabricMC/fabric/pull/525#pullrequestreview-413075910", "createdAt": "2020-05-16T13:13:24Z", "commit": {"oid": "7b62eada728c2ccd9f66793286103563c2c3031c"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNlQxMzoxMzoyNFrOGWaSsA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNlQxNDoyMzozNFrOGWanOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjE1MjYyNA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             * Used to create custom registry's, with specified registry attributes.\n          \n          \n            \n             * Used to create custom registries, with specified registry attributes.", "url": "https://github.com/FabricMC/fabric/pull/525#discussion_r426152624", "createdAt": "2020-05-16T13:13:24Z", "author": {"login": "Earthcomputer"}, "path": "fabric-registry-sync-v0/src/main/java/net/fabricmc/fabric/api/event/registry/FabricRegistryBuilder.java", "diffHunk": "@@ -0,0 +1,108 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.api.event.registry;\n+\n+import java.util.HashSet;\n+import java.util.Set;\n+\n+import net.minecraft.util.Identifier;\n+import net.minecraft.util.registry.DefaultedRegistry;\n+import net.minecraft.util.registry.SimpleRegistry;\n+import net.minecraft.util.registry.Registry;\n+\n+import net.fabricmc.fabric.impl.registry.sync.FabricRegistry;\n+\n+/**\n+ * Used to create custom registry's, with specified registry attributes.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7b62eada728c2ccd9f66793286103563c2c3031c"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjE1NjUxOQ==", "bodyText": "This implementation of storeHash rings alarm bells for me. This hashCode is implemented by AbstractSet, which simply sums the hashCode of its elements. Each element is an Identifier, which is itself a bad hash function.\nRather than using a hash, it would be far better to simply check the size of the registry to check if it has been added to. No-one is going to remove from a registry after all (that's a hard thing to do and no-one would want to anyway).", "url": "https://github.com/FabricMC/fabric/pull/525#discussion_r426156519", "createdAt": "2020-05-16T14:05:56Z", "author": {"login": "Earthcomputer"}, "path": "fabric-registry-sync-v0/src/main/java/net/fabricmc/fabric/mixin/registry/sync/MixinRegistry.java", "diffHunk": "@@ -0,0 +1,83 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.mixin.registry.sync;\n+\n+import java.util.EnumSet;\n+import java.util.Set;\n+\n+import org.spongepowered.asm.mixin.Mixin;\n+import org.spongepowered.asm.mixin.Shadow;\n+import org.spongepowered.asm.mixin.Unique;\n+\n+import net.minecraft.util.registry.Registry;\n+import net.minecraft.util.Identifier;\n+\n+import net.fabricmc.fabric.api.event.registry.RegistryAttribute;\n+import net.fabricmc.fabric.api.event.registry.RegistryAttributeHolder;\n+import net.fabricmc.fabric.impl.registry.sync.FabricRegistry;\n+import net.fabricmc.fabric.impl.registry.sync.HashedRegistry;\n+\n+@Mixin(Registry.class)\n+public abstract class MixinRegistry<T> implements RegistryAttributeHolder, FabricRegistry, HashedRegistry {\n+\t@Unique\n+\tprivate final EnumSet<RegistryAttribute> attributes = EnumSet.noneOf(RegistryAttribute.class);\n+\n+\t@Unique\n+\tprivate int preBootstrapHash = -1;\n+\n+\t@Shadow\n+\tpublic abstract Set<Identifier> getIds();\n+\n+\t/**\n+\t * This is used to denote backwards compatibility, when false default attributes will be applied.\n+\t * This is set to true when using FabricRegistryBuilder\n+\t */\n+\t@Unique\n+\tprivate boolean builtWithBuilder = false;\n+\n+\t@Override\n+\tpublic RegistryAttributeHolder addAttribute(RegistryAttribute attribute) {\n+\t\tattributes.add(attribute);\n+\t\treturn this;\n+\t}\n+\n+\t@Override\n+\tpublic boolean hasAttribute(RegistryAttribute attribute) {\n+\t\treturn attributes.contains(attribute);\n+\t}\n+\n+\t@Override\n+\tpublic void build(Set<RegistryAttribute> attributes) {\n+\t\tbuiltWithBuilder = true;\n+\t\tthis.attributes.addAll(attributes);\n+\t}\n+\n+\t@Override\n+\tpublic boolean builtByBuilder() {\n+\t\treturn builtWithBuilder;\n+\t}\n+\n+\t@Override\n+\tpublic int getStoredHash() {\n+\t\treturn preBootstrapHash;\n+\t}\n+\n+\t@Override\n+\tpublic int storeHash() {\n+\t\treturn preBootstrapHash = getIds().hashCode();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7b62eada728c2ccd9f66793286103563c2c3031c"}, "originalPosition": 81}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjE1Njg1Mw==", "bodyText": "Maybe also check if this registry is the registry registry.", "url": "https://github.com/FabricMC/fabric/pull/525#discussion_r426156853", "createdAt": "2020-05-16T14:10:04Z", "author": {"login": "Earthcomputer"}, "path": "fabric-registry-sync-v0/src/main/java/net/fabricmc/fabric/mixin/registry/sync/MixinSimpleRegistry.java", "diffHunk": "@@ -0,0 +1,84 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.mixin.registry.sync;\n+\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+import org.spongepowered.asm.mixin.Mixin;\n+import org.spongepowered.asm.mixin.Unique;\n+import org.spongepowered.asm.mixin.injection.At;\n+import org.spongepowered.asm.mixin.injection.Inject;\n+import org.spongepowered.asm.mixin.injection.callback.CallbackInfoReturnable;\n+\n+import net.minecraft.util.Identifier;\n+import net.minecraft.util.registry.MutableRegistry;\n+import net.minecraft.util.registry.Registry;\n+import net.minecraft.util.registry.SimpleRegistry;\n+\n+import net.fabricmc.fabric.impl.registry.sync.RegistrySyncManager;\n+import net.fabricmc.fabric.api.event.registry.RegistryAttribute;\n+import net.fabricmc.fabric.api.event.registry.RegistryAttributeHolder;\n+import net.fabricmc.fabric.impl.registry.sync.FabricRegistry;\n+\n+@Mixin(SimpleRegistry.class)\n+public abstract class MixinSimpleRegistry<T> extends Registry<T> {\n+\t@Unique\n+\tprivate static final Logger FARBIC_LOGGER = LogManager.getLogger(\"FabricRegistrySync\");\n+\n+\t@Inject(method = \"add\", at = @At(\"RETURN\"))\n+\tprivate <V extends T> void add(Identifier id, V entry, CallbackInfoReturnable<V> info) {\n+\t\tonChange(id);\n+\t\tcheckEntry(id, entry);\n+\t}\n+\n+\t@Inject(method = \"set\", at = @At(\"RETURN\"))\n+\tprivate <V extends T> void set(int rawId, Identifier id, V entry, CallbackInfoReturnable<V> info) {\n+\t\tonChange(id);\n+\t\tcheckEntry(id, entry);\n+\t}\n+\n+\t@Unique\n+\tprivate void onChange(Identifier id) {\n+\t\tif (RegistrySyncManager.postBootstrap || !id.getNamespace().equals(\"minecraft\")) {\n+\t\t\tRegistryAttributeHolder holder = RegistryAttributeHolder.get(this);\n+\n+\t\t\tif (!holder.hasAttribute(RegistryAttribute.MODDED)) {\n+\t\t\t\t//noinspection unchecked\n+\t\t\t\tFARBIC_LOGGER.debug(\"Registry {} has been marked as modded, registry entry {} was changed\", Registry.REGISTRIES.getId((MutableRegistry<T>) (Object) this), id);\n+\t\t\t\tRegistryAttributeHolder.get(this).addAttribute(RegistryAttribute.MODDED);\n+\t\t\t}\n+\t\t}\n+\t}\n+\n+\t@Unique\n+\tprivate <V extends T> void checkEntry(Identifier id, V entry) {\n+\t\t// Detect legacy modded registries, this is deprecated as they should use the builder from now on.\n+\t\tif (entry instanceof FabricRegistry) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7b62eada728c2ccd9f66793286103563c2c3031c"}, "originalPosition": 70}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjE1NzUzNA==", "bodyText": "From what I understand, the purpose of this check is to handle implementations of MutableRegistry which are not SimpleRegistrys or to handle SimpleRegistrys modified through accessor mixins. Otherwise, surely what is in MixinSimpleRegistry is sufficient. I would like to point out that all vanilla registries which are MutableRegistrys are also SimpleRegistrys.", "url": "https://github.com/FabricMC/fabric/pull/525#discussion_r426157534", "createdAt": "2020-05-16T14:19:46Z", "author": {"login": "Earthcomputer"}, "path": "fabric-registry-sync-v0/src/main/java/net/fabricmc/fabric/impl/registry/sync/RegistrySyncManager.java", "diffHunk": "@@ -216,4 +278,30 @@ public static void unmap() throws RemapException {\n \t\t\t}\n \t\t}\n \t}\n+\n+\tpublic static void bootstrapRegistries() {\n+\t\tfor (MutableRegistry<?> registry : Registry.REGISTRIES) {\n+\t\t\tif (registry instanceof HashedRegistry) {\n+\t\t\t\t((HashedRegistry) registry).storeHash();\n+\t\t\t}\n+\t\t}\n+\n+\t\tpostBootstrap = true;\n+\t}\n+\n+\t// Checks the stored hash against the current hash, if it has changed mark as modded\n+\tpublic static void checkRegistryHashes() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7b62eada728c2ccd9f66793286103563c2c3031c"}, "originalPosition": 179}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjE1Nzg4MQ==", "bodyText": "This is a bad name as it's set every time storeHash is called, which includes in RegistrySyncManager.bootstrapRegistries(), which is called after bootstrap.", "url": "https://github.com/FabricMC/fabric/pull/525#discussion_r426157881", "createdAt": "2020-05-16T14:23:34Z", "author": {"login": "Earthcomputer"}, "path": "fabric-registry-sync-v0/src/main/java/net/fabricmc/fabric/mixin/registry/sync/MixinRegistry.java", "diffHunk": "@@ -0,0 +1,83 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.mixin.registry.sync;\n+\n+import java.util.EnumSet;\n+import java.util.Set;\n+\n+import org.spongepowered.asm.mixin.Mixin;\n+import org.spongepowered.asm.mixin.Shadow;\n+import org.spongepowered.asm.mixin.Unique;\n+\n+import net.minecraft.util.registry.Registry;\n+import net.minecraft.util.Identifier;\n+\n+import net.fabricmc.fabric.api.event.registry.RegistryAttribute;\n+import net.fabricmc.fabric.api.event.registry.RegistryAttributeHolder;\n+import net.fabricmc.fabric.impl.registry.sync.FabricRegistry;\n+import net.fabricmc.fabric.impl.registry.sync.HashedRegistry;\n+\n+@Mixin(Registry.class)\n+public abstract class MixinRegistry<T> implements RegistryAttributeHolder, FabricRegistry, HashedRegistry {\n+\t@Unique\n+\tprivate final EnumSet<RegistryAttribute> attributes = EnumSet.noneOf(RegistryAttribute.class);\n+\n+\t@Unique\n+\tprivate int preBootstrapHash = -1;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7b62eada728c2ccd9f66793286103563c2c3031c"}, "originalPosition": 40}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzMzE5NzIx", "url": "https://github.com/FabricMC/fabric/pull/525#pullrequestreview-413319721", "createdAt": "2020-05-18T07:04:43Z", "commit": {"oid": "7b62eada728c2ccd9f66793286103563c2c3031c"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQwNzowNDo0M1rOGWp6Dg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQwNzowOTowNFrOGWqBPQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQwODQ2Mg==", "bodyText": "Gone as of 20w20a", "url": "https://github.com/FabricMC/fabric/pull/525#discussion_r426408462", "createdAt": "2020-05-18T07:04:43Z", "author": {"login": "i509VCB"}, "path": "fabric-registry-sync-v0/src/main/java/net/fabricmc/fabric/impl/registry/sync/FabricRegistryInit.java", "diffHunk": "@@ -0,0 +1,175 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.impl.registry.sync;\n+\n+import net.minecraft.util.registry.Registry;\n+\n+import net.fabricmc.api.ModInitializer;\n+import net.fabricmc.fabric.api.event.registry.RegistryAttribute;\n+import net.fabricmc.fabric.api.event.registry.RegistryAttributeHolder;\n+\n+public class FabricRegistryInit implements ModInitializer {\n+\t@Override\n+\tpublic void onInitialize() {\n+\t\t// Synced in PlaySoundS2CPacket.\n+\t\tRegistryAttributeHolder.get(Registry.SOUND_EVENT)\n+\t\t\t\t.addAttribute(RegistryAttribute.SYNCED);\n+\n+\t\t// Synced with RegistryTagContainer from RegistryTagManager.\n+\t\tRegistryAttributeHolder.get(Registry.FLUID)\n+\t\t\t\t.addAttribute(RegistryAttribute.SYNCED);\n+\n+\t\t// StatusEffectInstance serialises with raw id.\n+\t\tRegistryAttributeHolder.get(Registry.STATUS_EFFECT)\n+\t\t\t\t.addAttribute(RegistryAttribute.SYNCED)\n+\t\t\t\t.addAttribute(RegistryAttribute.PERSISTED);\n+\n+\t\t// Synced in ChunkDeltaUpdateS2CPacket among other places, a pallet is used when saving.\n+\t\tRegistryAttributeHolder.get(Registry.BLOCK)\n+\t\t\t\t.addAttribute(RegistryAttribute.SYNCED);\n+\n+\t\t// Does not appear to be saved or synced, the string id is used.\n+\t\tRegistryAttributeHolder.get(Registry.ENCHANTMENT);\n+\n+\t\t// Synced in EntitySpawnS2CPacket\n+\t\tRegistryAttributeHolder.get(Registry.ENTITY_TYPE)\n+\t\t\t\t.addAttribute(RegistryAttribute.SYNCED);\n+\n+\t\t// Doesnt appear to need syncing or saving?\n+\t\tRegistryAttributeHolder.get(Registry.ITEM);\n+\n+\t\t// Saved and synced using string ID.\n+\t\tRegistryAttributeHolder.get(Registry.POTION);\n+\n+\t\t// Doesnt seem to be accessed apart from registering?\n+\t\tRegistryAttributeHolder.get(Registry.CARVER);\n+\n+\t\t// Doesnt seem to be accessed apart from registering?\n+\t\tRegistryAttributeHolder.get(Registry.SURFACE_BUILDER);\n+\n+\t\t// Serialised by string, doesnt seem to be synced\n+\t\tRegistryAttributeHolder.get(Registry.FEATURE);\n+\n+\t\t// Serialised by string, doesnt seem to be synced\n+\t\tRegistryAttributeHolder.get(Registry.DECORATOR);\n+\n+\t\t// Saved to level format\n+\t\tRegistryAttributeHolder.get(Registry.BIOME)\n+\t\t\t\t.addAttribute(RegistryAttribute.SYNCED)\n+\t\t\t\t.addAttribute(RegistryAttribute.PERSISTED);\n+\n+\t\t// Serialised by string, doesnt seem to be synced\n+\t\tRegistryAttributeHolder.get(Registry.BLOCK_STATE_PROVIDER_TYPE);\n+\n+\t\t// Serialised by string, doesnt seem to be synced\n+\t\tRegistryAttributeHolder.get(Registry.BLOCK_PLACER_TYPE);\n+\n+\t\t// Serialised by string, doesnt seem to be synced\n+\t\tRegistryAttributeHolder.get(Registry.FOLIAGE_PLACER_TYPE);\n+\n+\t\t// Serialised by string, doesnt seem to be synced\n+\t\tRegistryAttributeHolder.get(Registry.TRUNK_PLACER_TYPE);\n+\n+\t\t// Serialised by string, doesnt seem to be synced\n+\t\tRegistryAttributeHolder.get(Registry.TREE_DECORATOR_TYPE);\n+\n+\t\t// Serialised by string, doesnt seem to be synced\n+\t\tRegistryAttributeHolder.get(Registry.FEATURE_SIZE_TYPE);\n+\n+\t\t// Synced in ParticleS2CPacket\n+\t\tRegistryAttributeHolder.get(Registry.PARTICLE_TYPE)\n+\t\t\t\t.addAttribute(RegistryAttribute.SYNCED);\n+\n+\t\t// Serialised by string, doesnt seem to be synced\n+\t\tRegistryAttributeHolder.get(Registry.BIOME_SOURCE_TYPE);\n+\n+\t\t// Serialised by string, doesnt seem to be synced\n+\t\tRegistryAttributeHolder.get(Registry.CHUNK_GENERATOR_TYPE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7b62eada728c2ccd9f66793286103563c2c3031c"}, "originalPosition": 101}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQxMDMwMQ==", "bodyText": "Checkstyle your drunk, go home.", "url": "https://github.com/FabricMC/fabric/pull/525#discussion_r426410301", "createdAt": "2020-05-18T07:09:04Z", "author": {"login": "i509VCB"}, "path": "fabric-registry-sync-v0/src/testmod/java/net/fabricmc/fabric/test/registry/sync/RegistrySyncTest.java", "diffHunk": "@@ -0,0 +1,84 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.test.registry.sync;\n+\n+import org.apache.commons.lang3.Validate;\n+\n+import net.minecraft.block.AbstractBlock;\n+import net.minecraft.block.Block;\n+import net.minecraft.block.Material;\n+import net.minecraft.item.BlockItem;\n+import net.minecraft.item.Item;\n+import net.minecraft.util.Identifier;\n+import net.minecraft.util.registry.Registry;\n+import net.minecraft.util.registry.SimpleRegistry;\n+import net.minecraft.util.registry.MutableRegistry;\n+\n+import net.fabricmc.api.ModInitializer;\n+import net.fabricmc.fabric.api.event.registry.RegistryAttribute;\n+import net.fabricmc.fabric.api.event.registry.RegistryAttributeHolder;\n+import net.fabricmc.fabric.api.event.registry.FabricRegistryBuilder;\n+\n+public class RegistrySyncTest implements ModInitializer {\n+\t/**\n+\t * These are system property's as it allows for easier testing with different run configurations.\n+\t */\n+\tpublic static final boolean REGISTER_BLOCKS = Boolean.parseBoolean(System.getProperty(\"fabric.registry.sync.test.register.blocks\", \"true\"));\n+\tpublic static final boolean REGISTER_ITEMS = Boolean.parseBoolean(System.getProperty(\"fabric.registry.sync.test.register.items\", \"true\"));\n+\n+\t@Override\n+\tpublic void onInitialize() {\n+\t\tif (REGISTER_BLOCKS) {\n+\t\t\tfor (int i = 0; i < 5; i++) {\n+\t\t\t\tBlock block = new Block(AbstractBlock.Settings.of(Material.STONE));\n+\t\t\t\tRegistry.BLOCK.add(new Identifier(\"registry_sync\", \"block_\" + i), block);\n+\n+\t\t\t\tif (REGISTER_ITEMS) {\n+\t\t\t\t\tBlockItem blockItem = new BlockItem(block, new Item.Settings());\n+\t\t\t\t\tRegistry.ITEM.add(new Identifier(\"registry_sync\", \"block_\" + i), blockItem);\n+\t\t\t\t}\n+\t\t\t}\n+\n+\t\t\tValidate.isTrue(RegistryAttributeHolder.get(Registry.BLOCK).hasAttribute(RegistryAttribute.MODDED), \"Modded block was registered but registry not marked as modded\");\n+\n+\t\t\tif (REGISTER_ITEMS) {\n+\t\t\t\tValidate.isTrue(RegistryAttributeHolder.get(Registry.ITEM).hasAttribute(RegistryAttribute.MODDED), \"Modded item was registered but registry not marked as modded\");\n+\t\t\t}\n+\t\t}\n+\n+\t\tMutableRegistry<String> fabricRegistry = FabricRegistryBuilder.createSimple(String.class)\n+\t\t\t\t\t\t\t\t\t\t\t\t\t.attribute(RegistryAttribute.SYNCED)\n+\t\t\t\t\t\t\t\t\t\t\t\t\t.build();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7b62eada728c2ccd9f66793286103563c2c3031c"}, "originalPosition": 65}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d690625ac15672ae7ce786b054b8db3ad8b80916", "author": {"user": {"login": "modmuss50", "name": "modmuss50"}}, "url": "https://github.com/FabricMC/fabric/commit/d690625ac15672ae7ce786b054b8db3ad8b80916", "committedDate": "2020-05-18T14:23:54Z", "message": "Minor fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "12a1bbb5765ecd77828f9432e3f82cc0f609dbf3", "author": {"user": {"login": "modmuss50", "name": "modmuss50"}}, "url": "https://github.com/FabricMC/fabric/commit/12a1bbb5765ecd77828f9432e3f82cc0f609dbf3", "committedDate": "2020-05-19T12:31:06Z", "message": "Remove hash stuff"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "adb73e4b980a3d0f6fac0ee3ab4618819395712b", "author": {"user": {"login": "modmuss50", "name": "modmuss50"}}, "url": "https://github.com/FabricMC/fabric/commit/adb73e4b980a3d0f6fac0ee3ab4618819395712b", "committedDate": "2020-05-21T18:17:25Z", "message": "Merge branch '1.16' into vanilla_registries\n\n# Conflicts:\n#\tfabric-registry-sync-v0/src/main/java/net/fabricmc/fabric/impl/registry/sync/RegistrySyncManager.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d712ba3dca89ed6430f7faa0788d8c8ba37e3005", "author": {"user": {"login": "modmuss50", "name": "modmuss50"}}, "url": "https://github.com/FabricMC/fabric/commit/d712ba3dca89ed6430f7faa0788d8c8ba37e3005", "committedDate": "2020-05-21T19:05:30Z", "message": "20w21a - massive changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b9d1f803937de229fbaef06965d6a1c160661acd", "author": {"user": {"login": "modmuss50", "name": "modmuss50"}}, "url": "https://github.com/FabricMC/fabric/commit/b9d1f803937de229fbaef06965d6a1c160661acd", "committedDate": "2020-05-21T19:14:26Z", "message": "fix build"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE2NDIzOTIx", "url": "https://github.com/FabricMC/fabric/pull/525#pullrequestreview-416423921", "createdAt": "2020-05-21T19:21:07Z", "commit": {"oid": "d712ba3dca89ed6430f7faa0788d8c8ba37e3005"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQxOToyMTowN1rOGY_qQA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQxOToyNToxMVrOGY_yGA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODg2MjAxNg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t * Applies the attributes to the registry and register's it.\n          \n          \n            \n            \t * Applies the attributes to the registry and registers it.", "url": "https://github.com/FabricMC/fabric/pull/525#discussion_r428862016", "createdAt": "2020-05-21T19:21:07Z", "author": {"login": "Earthcomputer"}, "path": "fabric-registry-sync-v0/src/main/java/net/fabricmc/fabric/api/event/registry/FabricRegistryBuilder.java", "diffHunk": "@@ -97,12 +104,16 @@ private FabricRegistryBuilder(R registry) {\n \t}\n \n \t/**\n-\t * Applies the attributes to the registry.\n+\t * Applies the attributes to the registry and register's it.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d712ba3dca89ed6430f7faa0788d8c8ba37e3005"}, "originalPosition": 73}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODg2MjY0Mg==", "bodyText": "Should there be helper methods here to allow for passing an Identifier rather than a RegistryKey here? And a default value for lifecycle?", "url": "https://github.com/FabricMC/fabric/pull/525#discussion_r428862642", "createdAt": "2020-05-21T19:22:26Z", "author": {"login": "Earthcomputer"}, "path": "fabric-registry-sync-v0/src/main/java/net/fabricmc/fabric/api/event/registry/FabricRegistryBuilder.java", "diffHunk": "@@ -50,31 +55,33 @@\n \t * @param <R> The registry type\n \t * @return An instance of FabricRegistryBuilder\n \t */\n-\tpublic static <T, R extends Registry<T>> FabricRegistryBuilder<T, R> from(R registry) {\n+\tpublic static <T, R extends MutableRegistry<T>> FabricRegistryBuilder<T, R> from(R registry) {\n \t\treturn new FabricRegistryBuilder<>(registry);\n \t}\n \n \t/**\n \t * Create a new {@link FabricRegistryBuilder} using a {@link SimpleRegistry}, the registry has the {@link RegistryAttribute#MODDED} attribute by default.\n \t *\n-\t * @param type A class matching the type being stored in the registry\n+\t * @param registryKey The RegistryKey to create the registry\n+\t * @param lifecycle The {@link Lifecycle} used to create the registry\n \t * @param <T> The type stored in the Registry\n \t * @return An instance of FabricRegistryBuilder\n \t */\n-\tpublic static <T> FabricRegistryBuilder<T, SimpleRegistry<T>> createSimple(Class<T> type) {\n-\t\treturn from(new SimpleRegistry<>());\n+\tpublic static <T> FabricRegistryBuilder<T, SimpleRegistry<T>> createSimple(class_5321<Registry<T>> registryKey, Lifecycle lifecycle) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d712ba3dca89ed6430f7faa0788d8c8ba37e3005"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODg2NDAyNA==", "bodyText": "Screw backwards compatibility at this point, I guess?", "url": "https://github.com/FabricMC/fabric/pull/525#discussion_r428864024", "createdAt": "2020-05-21T19:25:11Z", "author": {"login": "Earthcomputer"}, "path": "fabric-registry-sync-v0/src/main/java/net/fabricmc/fabric/mixin/registry/sync/MixinRegistry.java", "diffHunk": "@@ -35,16 +33,6 @@\n \t@Unique\n \tprivate final EnumSet<RegistryAttribute> attributes = EnumSet.noneOf(RegistryAttribute.class);\n \n-\t@Shadow\n-\tpublic abstract Set<Identifier> getIds();\n-\n-\t/**\n-\t * This is used to denote backwards compatibility, when false default attributes will be applied.\n-\t * This is set to true when using FabricRegistryBuilder\n-\t */\n-\t@Unique\n-\tprivate boolean builtWithBuilder = false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d712ba3dca89ed6430f7faa0788d8c8ba37e3005"}, "originalPosition": 24}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "89e5bfbde8bcb196583b5937c27ba3446f3408b7", "author": {"user": {"login": "modmuss50", "name": "modmuss50"}}, "url": "https://github.com/FabricMC/fabric/commit/89e5bfbde8bcb196583b5937c27ba3446f3408b7", "committedDate": "2020-05-21T19:27:07Z", "message": "Update fabric-registry-sync-v0/src/main/java/net/fabricmc/fabric/api/event/registry/FabricRegistryBuilder.java\n\nCo-authored-by: Joseph Burton <burtonjae@hotmail.co.uk>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE2NTg1Nzgw", "url": "https://github.com/FabricMC/fabric/pull/525#pullrequestreview-416585780", "createdAt": "2020-05-22T01:01:05Z", "commit": {"oid": "d712ba3dca89ed6430f7faa0788d8c8ba37e3005"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQwMTowMTowNVrOGZHjlg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQwMTowMjo0M1rOGZHlSg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODk5MTM4Mg==", "bodyText": "That generic sugar in registry key is totally unused and can be safely casted. I support earthcomputer's proposal here. A needed registry key in this case can always be created by RegistryKey.ofRegistry(id), creating a registry key of any type extending Registry<T> (T is a wildcard), with registry \"minecraft:root\" and value from id parameter.", "url": "https://github.com/FabricMC/fabric/pull/525#discussion_r428991382", "createdAt": "2020-05-22T01:01:05Z", "author": {"login": "liach"}, "path": "fabric-registry-sync-v0/src/main/java/net/fabricmc/fabric/api/event/registry/FabricRegistryBuilder.java", "diffHunk": "@@ -50,31 +55,33 @@\n \t * @param <R> The registry type\n \t * @return An instance of FabricRegistryBuilder\n \t */\n-\tpublic static <T, R extends Registry<T>> FabricRegistryBuilder<T, R> from(R registry) {\n+\tpublic static <T, R extends MutableRegistry<T>> FabricRegistryBuilder<T, R> from(R registry) {\n \t\treturn new FabricRegistryBuilder<>(registry);\n \t}\n \n \t/**\n \t * Create a new {@link FabricRegistryBuilder} using a {@link SimpleRegistry}, the registry has the {@link RegistryAttribute#MODDED} attribute by default.\n \t *\n-\t * @param type A class matching the type being stored in the registry\n+\t * @param registryKey The RegistryKey to create the registry\n+\t * @param lifecycle The {@link Lifecycle} used to create the registry\n \t * @param <T> The type stored in the Registry\n \t * @return An instance of FabricRegistryBuilder\n \t */\n-\tpublic static <T> FabricRegistryBuilder<T, SimpleRegistry<T>> createSimple(Class<T> type) {\n-\t\treturn from(new SimpleRegistry<>());\n+\tpublic static <T> FabricRegistryBuilder<T, SimpleRegistry<T>> createSimple(class_5321<Registry<T>> registryKey, Lifecycle lifecycle) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODg2MjY0Mg=="}, "originalCommit": {"oid": "d712ba3dca89ed6430f7faa0788d8c8ba37e3005"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODk5MTgxOA==", "bodyText": "Imo we should use an identifier. You cannot prevent people from passing botched registry keys with registry reference other than minecraft:root, while an identifier only specifying the value of the registry key is always safe.", "url": "https://github.com/FabricMC/fabric/pull/525#discussion_r428991818", "createdAt": "2020-05-22T01:02:43Z", "author": {"login": "liach"}, "path": "fabric-registry-sync-v0/src/main/java/net/fabricmc/fabric/api/event/registry/FabricRegistryBuilder.java", "diffHunk": "@@ -50,31 +55,33 @@\n \t * @param <R> The registry type\n \t * @return An instance of FabricRegistryBuilder\n \t */\n-\tpublic static <T, R extends Registry<T>> FabricRegistryBuilder<T, R> from(R registry) {\n+\tpublic static <T, R extends MutableRegistry<T>> FabricRegistryBuilder<T, R> from(R registry) {\n \t\treturn new FabricRegistryBuilder<>(registry);\n \t}\n \n \t/**\n \t * Create a new {@link FabricRegistryBuilder} using a {@link SimpleRegistry}, the registry has the {@link RegistryAttribute#MODDED} attribute by default.\n \t *\n-\t * @param type A class matching the type being stored in the registry\n+\t * @param registryKey The RegistryKey to create the registry\n+\t * @param lifecycle The {@link Lifecycle} used to create the registry\n \t * @param <T> The type stored in the Registry\n \t * @return An instance of FabricRegistryBuilder\n \t */\n-\tpublic static <T> FabricRegistryBuilder<T, SimpleRegistry<T>> createSimple(Class<T> type) {\n-\t\treturn from(new SimpleRegistry<>());\n+\tpublic static <T> FabricRegistryBuilder<T, SimpleRegistry<T>> createSimple(class_5321<Registry<T>> registryKey, Lifecycle lifecycle) {\n+\t\treturn from(new SimpleRegistry<>(registryKey, lifecycle));\n \t}\n \n \t/**\n \t * Create a new {@link FabricRegistryBuilder} using a {@link DefaultedRegistry}, the registry has the {@link RegistryAttribute#MODDED} attribute by default.\n \t *\n-\t * @param type A class matching the type being stored in the registry\n+\t * @param registryKey The RegistryKey to create the registry\n+\t * @param lifecycle The {@link Lifecycle} used to create the registry\n \t * @param defaultId The default registry id\n \t * @param <T> The type stored in the Registry\n \t * @return An instance of FabricRegistryBuilder\n \t */\n-\tpublic static <T> FabricRegistryBuilder<T, DefaultedRegistry<T>> createDefaulted(Class<T> type, Identifier defaultId) {\n-\t\treturn from(new DefaultedRegistry<>(defaultId.toString()));\n+\tpublic static <T> FabricRegistryBuilder<T, DefaultedRegistry<T>> createDefaulted(Identifier defaultId, class_5321<Registry<T>> registryKey, Lifecycle lifecycle) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d712ba3dca89ed6430f7faa0788d8c8ba37e3005"}, "originalPosition": 63}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE2NjA5MzMz", "url": "https://github.com/FabricMC/fabric/pull/525#pullrequestreview-416609333", "createdAt": "2020-05-22T02:27:21Z", "commit": {"oid": "89e5bfbde8bcb196583b5937c27ba3446f3408b7"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQwMjoyNzoyMVrOGZIvfw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQwMzoxNToxM1rOGZJZPQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTAxMDgxNQ==", "bodyText": "EnumSet", "url": "https://github.com/FabricMC/fabric/pull/525#discussion_r429010815", "createdAt": "2020-05-22T02:27:21Z", "author": {"login": "sfPlayer1"}, "path": "fabric-registry-sync-v0/src/main/java/net/fabricmc/fabric/api/event/registry/FabricRegistryBuilder.java", "diffHunk": "@@ -0,0 +1,119 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.api.event.registry;\n+\n+import java.util.HashSet;\n+import java.util.Set;\n+\n+import com.mojang.serialization.Lifecycle;\n+\n+import net.minecraft.class_5321;\n+import net.minecraft.util.Identifier;\n+import net.minecraft.util.registry.DefaultedRegistry;\n+import net.minecraft.util.registry.MutableRegistry;\n+import net.minecraft.util.registry.SimpleRegistry;\n+import net.minecraft.util.registry.Registry;\n+\n+import net.fabricmc.fabric.impl.registry.sync.FabricRegistry;\n+import net.fabricmc.fabric.mixin.registry.sync.AccessorRegistry;\n+\n+/**\n+ * Used to create custom registries, with specified registry attributes.\n+ *\n+ * <pre>\n+ * {@code\n+ *  MutableRegistry<String> exampleRegistry = FabricRegistryBuilder.create(new SimpleRegistry<String>())\n+ * \t\t\t\t\t\t\t\t\t\t\t\t.attribute(RegistryAttribute.SYNCED)\n+ * \t\t\t\t\t\t\t\t\t\t\t\t.build();\n+ * \tRegistry.REGISTRIES.add(new Identifier(\"mod_id\", \"example_registry\"), exampleRegistry);\n+ * \t}\n+ * </pre>\n+ *\n+ * @param <T> The type stored in the Registry\n+ * @param <R> The registry type\n+ */\n+public class FabricRegistryBuilder<T, R extends MutableRegistry<T>> {\n+\t/**\n+\t * Create a new {@link FabricRegistryBuilder}, the registry has the {@link RegistryAttribute#MODDED} attribute by default.\n+\t *\n+\t * @param registry The base registry type such as {@link net.minecraft.util.registry.SimpleRegistry} or {@link net.minecraft.util.registry.DefaultedRegistry}\n+\t * @param <T> The type stored in the Registry\n+\t * @param <R> The registry type\n+\t * @return An instance of FabricRegistryBuilder\n+\t */\n+\tpublic static <T, R extends MutableRegistry<T>> FabricRegistryBuilder<T, R> from(R registry) {\n+\t\treturn new FabricRegistryBuilder<>(registry);\n+\t}\n+\n+\t/**\n+\t * Create a new {@link FabricRegistryBuilder} using a {@link SimpleRegistry}, the registry has the {@link RegistryAttribute#MODDED} attribute by default.\n+\t *\n+\t * @param registryKey The RegistryKey to create the registry\n+\t * @param lifecycle The {@link Lifecycle} used to create the registry\n+\t * @param <T> The type stored in the Registry\n+\t * @return An instance of FabricRegistryBuilder\n+\t */\n+\tpublic static <T> FabricRegistryBuilder<T, SimpleRegistry<T>> createSimple(class_5321<Registry<T>> registryKey, Lifecycle lifecycle) {\n+\t\treturn from(new SimpleRegistry<>(registryKey, lifecycle));\n+\t}\n+\n+\t/**\n+\t * Create a new {@link FabricRegistryBuilder} using a {@link DefaultedRegistry}, the registry has the {@link RegistryAttribute#MODDED} attribute by default.\n+\t *\n+\t * @param registryKey The RegistryKey to create the registry\n+\t * @param lifecycle The {@link Lifecycle} used to create the registry\n+\t * @param defaultId The default registry id\n+\t * @param <T> The type stored in the Registry\n+\t * @return An instance of FabricRegistryBuilder\n+\t */\n+\tpublic static <T> FabricRegistryBuilder<T, DefaultedRegistry<T>> createDefaulted(Identifier defaultId, class_5321<Registry<T>> registryKey, Lifecycle lifecycle) {\n+\t\treturn from(new DefaultedRegistry<>(defaultId.toString(), registryKey, lifecycle));\n+\t}\n+\n+\tprivate final R registry;\n+\tprivate final Set<RegistryAttribute> attributes = new HashSet<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89e5bfbde8bcb196583b5937c27ba3446f3408b7"}, "originalPosition": 88}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTAxNzU0Mw==", "bodyText": "Shouldn't we register it fully? The code in buildAndRegister does AccessorRegistry.getRootRegistry().add(((AccessorRegistry) registry).getRegistryKey(), registry);, which looks similar?", "url": "https://github.com/FabricMC/fabric/pull/525#discussion_r429017543", "createdAt": "2020-05-22T02:56:57Z", "author": {"login": "sfPlayer1"}, "path": "fabric-registry-sync-v0/src/main/java/net/fabricmc/fabric/api/event/registry/FabricRegistryBuilder.java", "diffHunk": "@@ -0,0 +1,119 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.api.event.registry;\n+\n+import java.util.HashSet;\n+import java.util.Set;\n+\n+import com.mojang.serialization.Lifecycle;\n+\n+import net.minecraft.class_5321;\n+import net.minecraft.util.Identifier;\n+import net.minecraft.util.registry.DefaultedRegistry;\n+import net.minecraft.util.registry.MutableRegistry;\n+import net.minecraft.util.registry.SimpleRegistry;\n+import net.minecraft.util.registry.Registry;\n+\n+import net.fabricmc.fabric.impl.registry.sync.FabricRegistry;\n+import net.fabricmc.fabric.mixin.registry.sync.AccessorRegistry;\n+\n+/**\n+ * Used to create custom registries, with specified registry attributes.\n+ *\n+ * <pre>\n+ * {@code\n+ *  MutableRegistry<String> exampleRegistry = FabricRegistryBuilder.create(new SimpleRegistry<String>())\n+ * \t\t\t\t\t\t\t\t\t\t\t\t.attribute(RegistryAttribute.SYNCED)\n+ * \t\t\t\t\t\t\t\t\t\t\t\t.build();\n+ * \tRegistry.REGISTRIES.add(new Identifier(\"mod_id\", \"example_registry\"), exampleRegistry);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89e5bfbde8bcb196583b5937c27ba3446f3408b7"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTAyMDU4Mg==", "bodyText": "IMO this code would be clearer by writing it like thhs since I had to look twice whether it was exhaustive:\nif (!attributeHolder.hasAttribute(isClientSync ? RegistryAttribute.SYNCED : RegistryAttribute.PERSISTED)) {\n\tLOGGER.debug(\"Not {} registry: {}\", isClientSync ? \"syncing\" : \"saving\", registryId);\n\tcontinue;\n}", "url": "https://github.com/FabricMC/fabric/pull/525#discussion_r429020582", "createdAt": "2020-05-22T03:10:52Z", "author": {"login": "sfPlayer1"}, "path": "fabric-registry-sync-v0/src/main/java/net/fabricmc/fabric/impl/registry/sync/RegistrySyncManager.java", "diffHunk": "@@ -130,13 +133,44 @@ public static CompoundTag toTag(boolean isClientSync) {\n \t\t\t\t}\n \t\t\t}\n \n-\t\t\tif (REGISTRY_BLACKLIST.contains(registryId)) {\n+\t\t\tCompoundTag existingRegistryData = null;\n+\n+\t\t\tif (activeIdMap != null && activeIdMap.contains(registryId.toString())) {\n+\t\t\t\texistingRegistryData = activeIdMap.getCompound(registryId.toString());\n+\t\t\t}\n+\n+\t\t\tRegistryAttributeHolder attributeHolder = RegistryAttributeHolder.get(registry);\n+\n+\t\t\tif (!isClientSync && !attributeHolder.hasAttribute(RegistryAttribute.PERSISTED)) {\n+\t\t\t\tLOGGER.debug(\"Not saving non-persistent registry: \" + registryId);\n \t\t\t\tcontinue;\n-\t\t\t} else if (isClientSync && REGISTRY_BLACKLIST_NETWORK.contains(registryId)) {\n+\t\t\t}\n+\n+\t\t\tif (isClientSync && !attributeHolder.hasAttribute(RegistryAttribute.SYNCED)) {\n+\t\t\t\tLOGGER.debug(\"Not syncing registry: \" + registryId);\n \t\t\t\tcontinue;\n \t\t\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89e5bfbde8bcb196583b5937c27ba3446f3408b7"}, "originalPosition": 82}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTAyMDgzMQ==", "bodyText": "\"preserve existing registry ids if they exist\"", "url": "https://github.com/FabricMC/fabric/pull/525#discussion_r429020831", "createdAt": "2020-05-22T03:11:58Z", "author": {"login": "sfPlayer1"}, "path": "fabric-registry-sync-v0/src/main/java/net/fabricmc/fabric/impl/registry/sync/RegistrySyncManager.java", "diffHunk": "@@ -130,13 +133,44 @@ public static CompoundTag toTag(boolean isClientSync) {\n \t\t\t\t}\n \t\t\t}\n \n-\t\t\tif (REGISTRY_BLACKLIST.contains(registryId)) {\n+\t\t\tCompoundTag existingRegistryData = null;\n+\n+\t\t\tif (activeIdMap != null && activeIdMap.contains(registryId.toString())) {\n+\t\t\t\texistingRegistryData = activeIdMap.getCompound(registryId.toString());\n+\t\t\t}\n+\n+\t\t\tRegistryAttributeHolder attributeHolder = RegistryAttributeHolder.get(registry);\n+\n+\t\t\tif (!isClientSync && !attributeHolder.hasAttribute(RegistryAttribute.PERSISTED)) {\n+\t\t\t\tLOGGER.debug(\"Not saving non-persistent registry: \" + registryId);\n \t\t\t\tcontinue;\n-\t\t\t} else if (isClientSync && REGISTRY_BLACKLIST_NETWORK.contains(registryId)) {\n+\t\t\t}\n+\n+\t\t\tif (isClientSync && !attributeHolder.hasAttribute(RegistryAttribute.SYNCED)) {\n+\t\t\t\tLOGGER.debug(\"Not syncing registry: \" + registryId);\n \t\t\t\tcontinue;\n \t\t\t}\n \n-\t\t\tRegistry registry = Registry.REGISTRIES.get(registryId);\n+\t\t\t/*\n+\t\t\t * Dont do anything with vanilla registries on client sync.\n+\t\t\t * When saving, preserve existing registry ids if they exist, else dont save the registry.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89e5bfbde8bcb196583b5937c27ba3446f3408b7"}, "originalPosition": 87}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTAyMTUwMQ==", "bodyText": "It is quite unclear from a quick look what \"existingRegistryData\" and \"activeIdMap\" are supposed to mean", "url": "https://github.com/FabricMC/fabric/pull/525#discussion_r429021501", "createdAt": "2020-05-22T03:15:13Z", "author": {"login": "sfPlayer1"}, "path": "fabric-registry-sync-v0/src/main/java/net/fabricmc/fabric/impl/registry/sync/RegistrySyncManager.java", "diffHunk": "@@ -130,13 +133,44 @@ public static CompoundTag toTag(boolean isClientSync) {\n \t\t\t\t}\n \t\t\t}\n \n-\t\t\tif (REGISTRY_BLACKLIST.contains(registryId)) {\n+\t\t\tCompoundTag existingRegistryData = null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89e5bfbde8bcb196583b5937c27ba3446f3408b7"}, "originalPosition": 65}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "af7a17b7bc44a9c474f61fd65c84f2975e584870", "author": {"user": {"login": "modmuss50", "name": "modmuss50"}}, "url": "https://github.com/FabricMC/fabric/commit/af7a17b7bc44a9c474f61fd65c84f2975e584870", "committedDate": "2020-05-22T13:29:01Z", "message": "Feedback and update mappings"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c2eda65f7a6ad0b62bed53c120f9522107d8c915", "author": {"user": {"login": "modmuss50", "name": "modmuss50"}}, "url": "https://github.com/FabricMC/fabric/commit/c2eda65f7a6ad0b62bed53c120f9522107d8c915", "committedDate": "2020-05-22T13:29:33Z", "message": "Merge remote-tracking branch 'modmuss50/vanilla_registries' into vanilla_registries"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b7ce13e9abc0f5076ecfa775258e2898fd4e88f4", "author": {"user": {"login": "modmuss50", "name": "modmuss50"}}, "url": "https://github.com/FabricMC/fabric/commit/b7ce13e9abc0f5076ecfa775258e2898fd4e88f4", "committedDate": "2020-05-22T14:04:17Z", "message": "No longer apply mappings to vanilla registries, no longer save empty mapping data."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ccbe1bc4dfc0a7aea1c6c9973b7d37f2c67e62c1", "author": {"user": {"login": "modmuss50", "name": "modmuss50"}}, "url": "https://github.com/FabricMC/fabric/commit/ccbe1bc4dfc0a7aea1c6c9973b7d37f2c67e62c1", "committedDate": "2020-05-22T14:22:45Z", "message": "Use Identifier in FabricRegistryBuilder over RegistryKey\nImprove empty registry tag handling"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "90e4b4dfaa42d0ecccf6f96942d71588726bbf92", "author": {"user": {"login": "sfPlayer1", "name": "Player"}}, "url": "https://github.com/FabricMC/fabric/commit/90e4b4dfaa42d0ecccf6f96942d71588726bbf92", "committedDate": "2020-05-22T14:47:41Z", "message": "Reorder toTag empty checks"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE2OTc1MDY3", "url": "https://github.com/FabricMC/fabric/pull/525#pullrequestreview-416975067", "createdAt": "2020-05-22T14:54:40Z", "commit": {"oid": "90e4b4dfaa42d0ecccf6f96942d71588726bbf92"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3MzIyNTY1", "url": "https://github.com/FabricMC/fabric/pull/525#pullrequestreview-417322565", "createdAt": "2020-05-24T02:40:10Z", "commit": {"oid": "90e4b4dfaa42d0ecccf6f96942d71588726bbf92"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNFQwMjo0MDoxMFrOGZsUhg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNFQwMjo0MDoxMFrOGZsUhg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU5MzczNA==", "bodyText": "Maybe also clarify this is synced from the RegistryTagManager", "url": "https://github.com/FabricMC/fabric/pull/525#discussion_r429593734", "createdAt": "2020-05-24T02:40:10Z", "author": {"login": "i509VCB"}, "path": "fabric-registry-sync-v0/src/main/java/net/fabricmc/fabric/impl/registry/sync/FabricRegistryInit.java", "diffHunk": "@@ -0,0 +1,167 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.impl.registry.sync;\n+\n+import net.minecraft.util.registry.Registry;\n+\n+import net.fabricmc.api.ModInitializer;\n+import net.fabricmc.fabric.api.event.registry.RegistryAttribute;\n+import net.fabricmc.fabric.api.event.registry.RegistryAttributeHolder;\n+\n+public class FabricRegistryInit implements ModInitializer {\n+\t@Override\n+\tpublic void onInitialize() {\n+\t\t// Synced in PlaySoundS2CPacket.\n+\t\tRegistryAttributeHolder.get(Registry.SOUND_EVENT)\n+\t\t\t\t.addAttribute(RegistryAttribute.SYNCED);\n+\n+\t\t// Synced with RegistryTagContainer from RegistryTagManager.\n+\t\tRegistryAttributeHolder.get(Registry.FLUID)\n+\t\t\t\t.addAttribute(RegistryAttribute.SYNCED);\n+\n+\t\t// StatusEffectInstance serialises with raw id.\n+\t\tRegistryAttributeHolder.get(Registry.STATUS_EFFECT)\n+\t\t\t\t.addAttribute(RegistryAttribute.SYNCED)\n+\t\t\t\t.addAttribute(RegistryAttribute.PERSISTED);\n+\n+\t\t// Synced in ChunkDeltaUpdateS2CPacket among other places, a pallet is used when saving.\n+\t\tRegistryAttributeHolder.get(Registry.BLOCK)\n+\t\t\t\t.addAttribute(RegistryAttribute.SYNCED);\n+\n+\t\t// Does not appear to be saved or synced, the string id is used.\n+\t\tRegistryAttributeHolder.get(Registry.ENCHANTMENT);\n+\n+\t\t// Synced in EntitySpawnS2CPacket", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "90e4b4dfaa42d0ecccf6f96942d71588726bbf92"}, "originalPosition": 48}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3MzIyNTk3", "url": "https://github.com/FabricMC/fabric/pull/525#pullrequestreview-417322597", "createdAt": "2020-05-24T02:41:03Z", "commit": {"oid": "90e4b4dfaa42d0ecccf6f96942d71588726bbf92"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNFQwMjo0MTowM1rOGZsUrg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNFQwMjo0MTowM1rOGZsUrg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU5Mzc3NA==", "bodyText": "Needs to be synced. Called by RegistryTagManager which syncs raw ids", "url": "https://github.com/FabricMC/fabric/pull/525#discussion_r429593774", "createdAt": "2020-05-24T02:41:03Z", "author": {"login": "i509VCB"}, "path": "fabric-registry-sync-v0/src/main/java/net/fabricmc/fabric/impl/registry/sync/FabricRegistryInit.java", "diffHunk": "@@ -0,0 +1,167 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.impl.registry.sync;\n+\n+import net.minecraft.util.registry.Registry;\n+\n+import net.fabricmc.api.ModInitializer;\n+import net.fabricmc.fabric.api.event.registry.RegistryAttribute;\n+import net.fabricmc.fabric.api.event.registry.RegistryAttributeHolder;\n+\n+public class FabricRegistryInit implements ModInitializer {\n+\t@Override\n+\tpublic void onInitialize() {\n+\t\t// Synced in PlaySoundS2CPacket.\n+\t\tRegistryAttributeHolder.get(Registry.SOUND_EVENT)\n+\t\t\t\t.addAttribute(RegistryAttribute.SYNCED);\n+\n+\t\t// Synced with RegistryTagContainer from RegistryTagManager.\n+\t\tRegistryAttributeHolder.get(Registry.FLUID)\n+\t\t\t\t.addAttribute(RegistryAttribute.SYNCED);\n+\n+\t\t// StatusEffectInstance serialises with raw id.\n+\t\tRegistryAttributeHolder.get(Registry.STATUS_EFFECT)\n+\t\t\t\t.addAttribute(RegistryAttribute.SYNCED)\n+\t\t\t\t.addAttribute(RegistryAttribute.PERSISTED);\n+\n+\t\t// Synced in ChunkDeltaUpdateS2CPacket among other places, a pallet is used when saving.\n+\t\tRegistryAttributeHolder.get(Registry.BLOCK)\n+\t\t\t\t.addAttribute(RegistryAttribute.SYNCED);\n+\n+\t\t// Does not appear to be saved or synced, the string id is used.\n+\t\tRegistryAttributeHolder.get(Registry.ENCHANTMENT);\n+\n+\t\t// Synced in EntitySpawnS2CPacket\n+\t\tRegistryAttributeHolder.get(Registry.ENTITY_TYPE)\n+\t\t\t\t.addAttribute(RegistryAttribute.SYNCED);\n+\n+\t\t// Doesnt appear to need syncing or saving?\n+\t\tRegistryAttributeHolder.get(Registry.ITEM);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "90e4b4dfaa42d0ecccf6f96942d71588726bbf92"}, "originalPosition": 53}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f56b2f5f1f80162569a68d2673c4226f816437b5", "author": {"user": {"login": "modmuss50", "name": "modmuss50"}}, "url": "https://github.com/FabricMC/fabric/commit/f56b2f5f1f80162569a68d2673c4226f816437b5", "committedDate": "2020-05-25T16:16:04Z", "message": "Minor fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5398201dbc8b34cc83ff451e6bc907524f23ad6f", "author": {"user": {"login": "modmuss50", "name": "modmuss50"}}, "url": "https://github.com/FabricMC/fabric/commit/5398201dbc8b34cc83ff451e6bc907524f23ad6f", "committedDate": "2020-05-25T16:16:52Z", "message": "Merge remote-tracking branch 'modmuss50/vanilla_registries' into vanilla_registries"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE4NjU4NjQz", "url": "https://github.com/FabricMC/fabric/pull/525#pullrequestreview-418658643", "createdAt": "2020-05-26T20:34:02Z", "commit": {"oid": "5398201dbc8b34cc83ff451e6bc907524f23ad6f"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQyMDozNDowMlrOGavVfA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQyMDozNDozNlrOGavXaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDY5MTcwOA==", "bodyText": "Should this be final?", "url": "https://github.com/FabricMC/fabric/pull/525#discussion_r430691708", "createdAt": "2020-05-26T20:34:02Z", "author": {"login": "i509VCB"}, "path": "fabric-registry-sync-v0/src/main/java/net/fabricmc/fabric/api/event/registry/FabricRegistryBuilder.java", "diffHunk": "@@ -0,0 +1,114 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.api.event.registry;\n+\n+import java.util.EnumSet;\n+\n+import com.mojang.serialization.Lifecycle;\n+\n+import net.minecraft.util.Identifier;\n+import net.minecraft.util.registry.DefaultedRegistry;\n+import net.minecraft.util.registry.MutableRegistry;\n+import net.minecraft.util.registry.SimpleRegistry;\n+import net.minecraft.util.registry.RegistryKey;\n+\n+import net.fabricmc.fabric.impl.registry.sync.FabricRegistry;\n+import net.fabricmc.fabric.mixin.registry.sync.AccessorRegistry;\n+\n+/**\n+ * Used to create custom registries, with specified registry attributes.\n+ *\n+ * <pre>\n+ * {@code\n+ *  SimpleRegistry<String> registry = FabricRegistryBuilder.createSimple(String.class, new Identifier(\"registry_sync\", \"fabric_registry\"))\n+ * \t\t\t\t\t\t\t\t\t\t\t\t\t.attribute(RegistryAttribute.SYNCED)\n+ * \t\t\t\t\t\t\t\t\t\t\t\t\t.buildAndRegister();\n+ * \t}\n+ * </pre>\n+ *\n+ * @param <T> The type stored in the Registry\n+ * @param <R> The registry type\n+ */\n+public class FabricRegistryBuilder<T, R extends MutableRegistry<T>> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5398201dbc8b34cc83ff451e6bc907524f23ad6f"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDY5MjIwMA==", "bodyText": "RegistryAccessor?", "url": "https://github.com/FabricMC/fabric/pull/525#discussion_r430692200", "createdAt": "2020-05-26T20:34:36Z", "author": {"login": "i509VCB"}, "path": "fabric-registry-sync-v0/src/main/java/net/fabricmc/fabric/mixin/registry/sync/AccessorRegistry.java", "diffHunk": "@@ -0,0 +1,35 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.mixin.registry.sync;\n+\n+import org.spongepowered.asm.mixin.Mixin;\n+import org.spongepowered.asm.mixin.gen.Accessor;\n+\n+import net.minecraft.util.registry.MutableRegistry;\n+import net.minecraft.util.registry.Registry;\n+import net.minecraft.util.registry.RegistryKey;\n+\n+@Mixin(Registry.class)\n+public interface AccessorRegistry<T> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5398201dbc8b34cc83ff451e6bc907524f23ad6f"}, "originalPosition": 27}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d2c8afcc4ec30f1d9b55024fe24a21ae3f0de1d", "author": {"user": {"login": "modmuss50", "name": "modmuss50"}}, "url": "https://github.com/FabricMC/fabric/commit/1d2c8afcc4ec30f1d9b55024fe24a21ae3f0de1d", "committedDate": "2020-05-26T20:55:25Z", "message": "Make FabricRegistryBuilder final"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE4Njk2NzE2", "url": "https://github.com/FabricMC/fabric/pull/525#pullrequestreview-418696716", "createdAt": "2020-05-26T21:36:06Z", "commit": {"oid": "af7a17b7bc44a9c474f61fd65c84f2975e584870"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQyMTozNjowNlrOGaxKDA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNlQyMTozNjowNlrOGaxKDA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDcyMTU0OA==", "bodyText": "Can't Lifecycle.stable() be a default?", "url": "https://github.com/FabricMC/fabric/pull/525#discussion_r430721548", "createdAt": "2020-05-26T21:36:06Z", "author": {"login": "Earthcomputer"}, "path": "fabric-registry-sync-v0/src/main/java/net/fabricmc/fabric/api/event/registry/FabricRegistryBuilder.java", "diffHunk": "@@ -67,7 +67,7 @@\n \t * @param <T> The type stored in the Registry\n \t * @return An instance of FabricRegistryBuilder\n \t */\n-\tpublic static <T> FabricRegistryBuilder<T, SimpleRegistry<T>> createSimple(class_5321<Registry<T>> registryKey, Lifecycle lifecycle) {\n+\tpublic static <T> FabricRegistryBuilder<T, SimpleRegistry<T>> createSimple(RegistryKey<Registry<T>> registryKey, Lifecycle lifecycle) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "af7a17b7bc44a9c474f61fd65c84f2975e584870"}, "originalPosition": 41}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE4Njk3Njg4", "url": "https://github.com/FabricMC/fabric/pull/525#pullrequestreview-418697688", "createdAt": "2020-05-26T21:37:52Z", "commit": {"oid": "1d2c8afcc4ec30f1d9b55024fe24a21ae3f0de1d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIwNDQzMzk5", "url": "https://github.com/FabricMC/fabric/pull/525#pullrequestreview-420443399", "createdAt": "2020-05-28T19:52:15Z", "commit": {"oid": "1d2c8afcc4ec30f1d9b55024fe24a21ae3f0de1d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxOTo1MjoxNVrOGcER8Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxOTo1MjoxNVrOGcER8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjA4MzQ0MQ==", "bodyText": "Raw id used in the EnchantmentTableScreenHandler. Needs to be synced", "url": "https://github.com/FabricMC/fabric/pull/525#discussion_r432083441", "createdAt": "2020-05-28T19:52:15Z", "author": {"login": "i509VCB"}, "path": "fabric-registry-sync-v0/src/main/java/net/fabricmc/fabric/impl/registry/sync/FabricRegistryInit.java", "diffHunk": "@@ -0,0 +1,168 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.impl.registry.sync;\n+\n+import net.minecraft.util.registry.Registry;\n+\n+import net.fabricmc.api.ModInitializer;\n+import net.fabricmc.fabric.api.event.registry.RegistryAttribute;\n+import net.fabricmc.fabric.api.event.registry.RegistryAttributeHolder;\n+\n+public class FabricRegistryInit implements ModInitializer {\n+\t@Override\n+\tpublic void onInitialize() {\n+\t\t// Synced in PlaySoundS2CPacket.\n+\t\tRegistryAttributeHolder.get(Registry.SOUND_EVENT)\n+\t\t\t\t.addAttribute(RegistryAttribute.SYNCED);\n+\n+\t\t// Synced with RegistryTagContainer from RegistryTagManager.\n+\t\tRegistryAttributeHolder.get(Registry.FLUID)\n+\t\t\t\t.addAttribute(RegistryAttribute.SYNCED);\n+\n+\t\t// StatusEffectInstance serialises with raw id.\n+\t\tRegistryAttributeHolder.get(Registry.STATUS_EFFECT)\n+\t\t\t\t.addAttribute(RegistryAttribute.SYNCED)\n+\t\t\t\t.addAttribute(RegistryAttribute.PERSISTED);\n+\n+\t\t// Synced in ChunkDeltaUpdateS2CPacket among other places, a pallet is used when saving.\n+\t\tRegistryAttributeHolder.get(Registry.BLOCK)\n+\t\t\t\t.addAttribute(RegistryAttribute.SYNCED);\n+\n+\t\t// Does not appear to be saved or synced, the string id is used.\n+\t\tRegistryAttributeHolder.get(Registry.ENCHANTMENT);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1d2c8afcc4ec30f1d9b55024fe24a21ae3f0de1d"}, "originalPosition": 46}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIwNTAyMjI0", "url": "https://github.com/FabricMC/fabric/pull/525#pullrequestreview-420502224", "createdAt": "2020-05-28T21:22:40Z", "commit": {"oid": "1d2c8afcc4ec30f1d9b55024fe24a21ae3f0de1d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQyMToyMjo0MVrOGcHNUQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQyMToyMjo0MVrOGcHNUQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjEzMTQwOQ==", "bodyText": "Entry for BlockEntityType is missing", "url": "https://github.com/FabricMC/fabric/pull/525#discussion_r432131409", "createdAt": "2020-05-28T21:22:41Z", "author": {"login": "i509VCB"}, "path": "fabric-registry-sync-v0/src/main/java/net/fabricmc/fabric/impl/registry/sync/FabricRegistryInit.java", "diffHunk": "@@ -0,0 +1,168 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.impl.registry.sync;\n+\n+import net.minecraft.util.registry.Registry;\n+\n+import net.fabricmc.api.ModInitializer;\n+import net.fabricmc.fabric.api.event.registry.RegistryAttribute;\n+import net.fabricmc.fabric.api.event.registry.RegistryAttributeHolder;\n+\n+public class FabricRegistryInit implements ModInitializer {\n+\t@Override\n+\tpublic void onInitialize() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1d2c8afcc4ec30f1d9b55024fe24a21ae3f0de1d"}, "originalPosition": 27}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "edfbf82966fcc736b9f40cd0461500748ba9ef36", "author": {"user": {"login": "modmuss50", "name": "modmuss50"}}, "url": "https://github.com/FabricMC/fabric/commit/edfbf82966fcc736b9f40cd0461500748ba9ef36", "committedDate": "2020-05-29T19:22:04Z", "message": "Merge branch '1.16' into vanilla_registries\n\n# Conflicts:\n#\tbuild.gradle\n#\tfabric-command-api-v1/src/main/java/net/fabricmc/fabric/mixin/command/MixinMinecraftDedicatedServer.java\n#\tfabric-registry-sync-v0/src/main/java/net/fabricmc/fabric/mixin/registry/sync/MixinIdRegistry.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bc362d49d7891775e1c4c4a7320962771ae7d5f7", "author": {"user": {"login": "modmuss50", "name": "modmuss50"}}, "url": "https://github.com/FabricMC/fabric/commit/bc362d49d7891775e1c4c4a7320962771ae7d5f7", "committedDate": "2020-05-29T19:27:36Z", "message": "Update registry attributes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a1c295c9093c1eb5ed08605f347855a26ec338f4", "author": {"user": {"login": "modmuss50", "name": "modmuss50"}}, "url": "https://github.com/FabricMC/fabric/commit/a1c295c9093c1eb5ed08605f347855a26ec338f4", "committedDate": "2020-06-04T20:25:15Z", "message": "Merge remote-tracking branch 'remotes/origin/1.16' into vanilla_registries"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ad4e033bf603860318a7fee6a73ce5128b5efebd", "author": {"user": {"login": "modmuss50", "name": "modmuss50"}}, "url": "https://github.com/FabricMC/fabric/commit/ad4e033bf603860318a7fee6a73ce5128b5efebd", "committedDate": "2020-06-04T20:27:23Z", "message": "Fix compile issue"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3391, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}