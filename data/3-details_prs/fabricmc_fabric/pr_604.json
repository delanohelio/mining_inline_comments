{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEyNDY5MDU4", "number": 604, "title": "Fix commands on servers.", "bodyText": "Based off the same fix I made a year or two ago...", "createdAt": "2020-05-02T15:44:58Z", "url": "https://github.com/FabricMC/fabric/pull/604", "merged": true, "mergeCommit": {"oid": "7b6f8bc5f3cd6a8bf5229a5f8ba817d9a62fc12a"}, "closed": true, "closedAt": "2020-05-02T20:19:25Z", "author": {"login": "modmuss50"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcdYPfwAH2gAyNDEyNDY5MDU4OjFmN2IyMDJlMjVhOGI4NTZlNzcxMmVjYmZiNTkxZjQ3NDA1NDZmOWM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcdcErKAFqTQwNDU1NzIzMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1f7b202e25a8b856e7712ecbfb591f4740546f9c", "author": {"user": {"login": "modmuss50", "name": "modmuss50"}}, "url": "https://github.com/FabricMC/fabric/commit/1f7b202e25a8b856e7712ecbfb591f4740546f9c", "committedDate": "2020-05-02T15:44:32Z", "message": "Fix commands on servers.\n\nBased off the same fix I made a year or two ago..."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0NTM4NDM5", "url": "https://github.com/FabricMC/fabric/pull/604#pullrequestreview-404538439", "createdAt": "2020-05-02T15:47:21Z", "commit": {"oid": "1f7b202e25a8b856e7712ecbfb591f4740546f9c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMlQxNTo0NzoyMVrOGPkIYg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMlQxNTo0NzoyMVrOGPkIYg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODk3Mzc5NA==", "bodyText": "You only have to fire with true. By passing false you fire the event twice.\nThe event is designed in a way where mod devs are expected to use the dedicated flag and handle registration for both integrated and dedicated servers in the same method.", "url": "https://github.com/FabricMC/fabric/pull/604#discussion_r418973794", "createdAt": "2020-05-02T15:47:21Z", "author": {"login": "i509VCB"}, "path": "fabric-command-api-v1/src/main/java/net/fabricmc/fabric/mixin/command/MixinMinecraftDedicatedServer.java", "diffHunk": "@@ -0,0 +1,52 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.mixin.command;\n+\n+import java.io.File;\n+import java.net.Proxy;\n+\n+import com.mojang.authlib.GameProfileRepository;\n+import com.mojang.authlib.minecraft.MinecraftSessionService;\n+import com.mojang.authlib.yggdrasil.YggdrasilAuthenticationService;\n+import com.mojang.datafixers.DataFixer;\n+import org.spongepowered.asm.mixin.Mixin;\n+import org.spongepowered.asm.mixin.injection.At;\n+import org.spongepowered.asm.mixin.injection.Inject;\n+import org.spongepowered.asm.mixin.injection.callback.CallbackInfoReturnable;\n+\n+import net.minecraft.server.MinecraftServer;\n+import net.minecraft.server.WorldGenerationProgressListenerFactory;\n+import net.minecraft.server.command.CommandManager;\n+import net.minecraft.server.dedicated.MinecraftDedicatedServer;\n+import net.minecraft.util.UserCache;\n+\n+import net.fabricmc.fabric.api.command.v1.CommandRegistrationCallback;\n+\n+@Mixin(MinecraftDedicatedServer.class)\n+public abstract class MixinMinecraftDedicatedServer extends MinecraftServer {\n+\tpublic MixinMinecraftDedicatedServer(File gameDir, Proxy proxy, DataFixer dataFixer, CommandManager commandManager, YggdrasilAuthenticationService authService, MinecraftSessionService sessionService, GameProfileRepository gameProfileRepository, UserCache userCache, WorldGenerationProgressListenerFactory worldGenerationProgressListenerFactory, String levelName) {\n+\t\tsuper(gameDir, proxy, dataFixer, commandManager, authService, sessionService, gameProfileRepository, userCache, worldGenerationProgressListenerFactory, levelName);\n+\t}\n+\n+\t@Inject(method = \"setupServer\", at = @At(\"HEAD\"))\n+\tprivate void setupServer(CallbackInfoReturnable<Boolean> info) {\n+\t\tCommandRegistrationCallback.EVENT.invoker().register(getCommandManager().getDispatcher(), true);\n+\t\tCommandRegistrationCallback.EVENT.invoker().register(getCommandManager().getDispatcher(), false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1f7b202e25a8b856e7712ecbfb591f4740546f9c"}, "originalPosition": 48}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eec636454532a28bbd37e9898b1060a451f46b8b", "author": {"user": {"login": "modmuss50", "name": "modmuss50"}}, "url": "https://github.com/FabricMC/fabric/commit/eec636454532a28bbd37e9898b1060a451f46b8b", "committedDate": "2020-05-02T15:48:11Z", "message": "Fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0NTM4ODQy", "url": "https://github.com/FabricMC/fabric/pull/604#pullrequestreview-404538842", "createdAt": "2020-05-02T15:52:23Z", "commit": {"oid": "eec636454532a28bbd37e9898b1060a451f46b8b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0NTU3MTQw", "url": "https://github.com/FabricMC/fabric/pull/604#pullrequestreview-404557140", "createdAt": "2020-05-02T20:10:14Z", "commit": {"oid": "eec636454532a28bbd37e9898b1060a451f46b8b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA0NTU3MjMw", "url": "https://github.com/FabricMC/fabric/pull/604#pullrequestreview-404557230", "createdAt": "2020-05-02T20:12:16Z", "commit": {"oid": "eec636454532a28bbd37e9898b1060a451f46b8b"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMlQyMDoxMjoxNlrOGPl4Gw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wMlQyMDoxMjoxNlrOGPl4Gw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTAwMjM5NQ==", "bodyText": "Should we mixin this on client", "url": "https://github.com/FabricMC/fabric/pull/604#discussion_r419002395", "createdAt": "2020-05-02T20:12:16Z", "author": {"login": "liach"}, "path": "fabric-command-api-v1/src/main/resources/fabric-command-api-v1.mixins.json", "diffHunk": "@@ -3,7 +3,8 @@\n   \"package\": \"net.fabricmc.fabric.mixin.command\",\n   \"compatibilityLevel\": \"JAVA_8\",\n   \"mixins\": [\n-    \"MixinCommandManager\"\n+    \"MixinCommandManager\",\n+    \"MixinMinecraftDedicatedServer\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eec636454532a28bbd37e9898b1060a451f46b8b"}, "originalPosition": 6}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3431, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}