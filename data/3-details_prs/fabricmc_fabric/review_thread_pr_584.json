{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA1NDk4NTc0", "number": 584, "reviewThreads": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOVQwNzowNDowMFrODzVnug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxMjowNjo1NlrOD_XP2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU1MTU4MjAyOnYy", "diffSide": "RIGHT", "path": "fabric-screen-handler-api-v1/src/main/java/net/fabricmc/fabric/impl/screenhandler/ExtendedScreenHandlerType.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOVQwNzowNDowMFrOGHzbWA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOVQwNzoxMjo1NFrOGHzg_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDgzNTgwMA==", "bodyText": "I like final things (could you make this method final?)", "url": "https://github.com/FabricMC/fabric/pull/584#discussion_r410835800", "createdAt": "2020-04-19T07:04:00Z", "author": {"login": "i509VCB"}, "path": "fabric-screen-handler-api-v1/src/main/java/net/fabricmc/fabric/impl/screenhandler/ExtendedScreenHandlerType.java", "diffHunk": "@@ -0,0 +1,46 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.impl.screenhandler;\n+\n+import net.minecraft.entity.player.PlayerInventory;\n+import net.minecraft.network.PacketByteBuf;\n+import net.minecraft.screen.ScreenHandler;\n+import net.minecraft.screen.ScreenHandlerType;\n+\n+import net.fabricmc.api.EnvType;\n+import net.fabricmc.api.Environment;\n+import net.fabricmc.fabric.api.screenhandler.v1.ScreenHandlers;\n+\n+public final class ExtendedScreenHandlerType<T extends ScreenHandler> extends ScreenHandlerType<T> {\n+\tprivate final ScreenHandlers.ExtendedFactory<T> factory;\n+\n+\tExtendedScreenHandlerType(ScreenHandlers.ExtendedFactory<T> factory) {\n+\t\tsuper(null);\n+\t\tthis.factory = factory;\n+\t}\n+\n+\t@Environment(EnvType.CLIENT)\n+\t@Override\n+\tpublic T create(int syncId, PlayerInventory inventory) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e077dc5d2fa67d1c79811ba2ee42c7e09e0f868"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDgzNzI0Ng==", "bodyText": "It doesn't really matter as the class is final.", "url": "https://github.com/FabricMC/fabric/pull/584#discussion_r410837246", "createdAt": "2020-04-19T07:12:54Z", "author": {"login": "Juuxel"}, "path": "fabric-screen-handler-api-v1/src/main/java/net/fabricmc/fabric/impl/screenhandler/ExtendedScreenHandlerType.java", "diffHunk": "@@ -0,0 +1,46 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.impl.screenhandler;\n+\n+import net.minecraft.entity.player.PlayerInventory;\n+import net.minecraft.network.PacketByteBuf;\n+import net.minecraft.screen.ScreenHandler;\n+import net.minecraft.screen.ScreenHandlerType;\n+\n+import net.fabricmc.api.EnvType;\n+import net.fabricmc.api.Environment;\n+import net.fabricmc.fabric.api.screenhandler.v1.ScreenHandlers;\n+\n+public final class ExtendedScreenHandlerType<T extends ScreenHandler> extends ScreenHandlerType<T> {\n+\tprivate final ScreenHandlers.ExtendedFactory<T> factory;\n+\n+\tExtendedScreenHandlerType(ScreenHandlers.ExtendedFactory<T> factory) {\n+\t\tsuper(null);\n+\t\tthis.factory = factory;\n+\t}\n+\n+\t@Environment(EnvType.CLIENT)\n+\t@Override\n+\tpublic T create(int syncId, PlayerInventory inventory) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDgzNTgwMA=="}, "originalCommit": {"oid": "0e077dc5d2fa67d1c79811ba2ee42c7e09e0f868"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU1MTU4NTYzOnYy", "diffSide": "RIGHT", "path": "fabric-screen-handler-api-v1/src/main/java/net/fabricmc/fabric/api/screenhandler/v1/ScreenHandlers.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOVQwNzowNjo0MFrOGHzc9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOVQwNzowNjo0MFrOGHzc9g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDgzNjIxNA==", "bodyText": "This sounds too much like a utility class... You can just make this a utility class which methods accomplish the functionalities (allows preserving binary compatibility across different implementations/updates as well)", "url": "https://github.com/FabricMC/fabric/pull/584#discussion_r410836214", "createdAt": "2020-04-19T07:06:40Z", "author": {"login": "liach"}, "path": "fabric-screen-handler-api-v1/src/main/java/net/fabricmc/fabric/api/screenhandler/v1/ScreenHandlers.java", "diffHunk": "@@ -0,0 +1,91 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.api.screenhandler.v1;\n+\n+import net.minecraft.entity.player.PlayerInventory;\n+import net.minecraft.network.PacketByteBuf;\n+import net.minecraft.screen.ScreenHandler;\n+import net.minecraft.screen.ScreenHandlerType;\n+\n+import net.fabricmc.api.EnvType;\n+import net.fabricmc.api.Environment;\n+import net.fabricmc.fabric.impl.screenhandler.ScreenHandlersImpl;\n+\n+/**\n+ * An utility for creating screen handler types.\n+ */\n+public interface ScreenHandlers {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e077dc5d2fa67d1c79811ba2ee42c7e09e0f868"}, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU1MTU4NjUwOnYy", "diffSide": "RIGHT", "path": "fabric-screen-handler-api-v1/src/main/java/net/fabricmc/fabric/api/screenhandler/v1/client/FabricHandledScreens.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOVQwNzowNzozMlrOGHzdXw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOVQwNzowNzozMlrOGHzdXw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDgzNjMxOQ==", "bodyText": "Class sounds too much like a utility class", "url": "https://github.com/FabricMC/fabric/pull/584#discussion_r410836319", "createdAt": "2020-04-19T07:07:32Z", "author": {"login": "liach"}, "path": "fabric-screen-handler-api-v1/src/main/java/net/fabricmc/fabric/api/screenhandler/v1/client/FabricHandledScreens.java", "diffHunk": "@@ -0,0 +1,65 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.api.screenhandler.v1.client;\n+\n+import net.minecraft.client.gui.screen.Screen;\n+import net.minecraft.client.gui.screen.ingame.ScreenHandlerProvider;\n+import net.minecraft.entity.player.PlayerInventory;\n+import net.minecraft.screen.ScreenHandler;\n+import net.minecraft.screen.ScreenHandlerType;\n+import net.minecraft.text.Text;\n+\n+import net.fabricmc.api.EnvType;\n+import net.fabricmc.api.Environment;\n+import net.fabricmc.fabric.impl.screenhandler.client.FabricHandledScreensImpl;\n+\n+/**\n+ * An utility for registering screens with screen handlers.\n+ */\n+@Environment(EnvType.CLIENT)\n+public interface FabricHandledScreens {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e077dc5d2fa67d1c79811ba2ee42c7e09e0f868"}, "originalPosition": 34}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU1MTU4Njk4OnYy", "diffSide": "RIGHT", "path": "fabric-screen-handler-api-v1/src/main/java/net/fabricmc/fabric/impl/screenhandler/client/NetworkingClient.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOVQwNzowNzo0OVrOGHzdkw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOVQwNzoxNTozN1rOGHziqw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDgzNjM3MQ==", "bodyText": "Unsure about putting the [Fabric] in the logs directly. I want to get someone else to look at this as a standards question as well.", "url": "https://github.com/FabricMC/fabric/pull/584#discussion_r410836371", "createdAt": "2020-04-19T07:07:49Z", "author": {"login": "i509VCB"}, "path": "fabric-screen-handler-api-v1/src/main/java/net/fabricmc/fabric/impl/screenhandler/client/NetworkingClient.java", "diffHunk": "@@ -0,0 +1,85 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.impl.screenhandler.client;\n+\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+\n+import net.minecraft.client.MinecraftClient;\n+import net.minecraft.client.gui.screen.Screen;\n+import net.minecraft.client.gui.screen.ingame.HandledScreens;\n+import net.minecraft.client.gui.screen.ingame.ScreenHandlerProvider;\n+import net.minecraft.entity.player.PlayerEntity;\n+import net.minecraft.network.PacketByteBuf;\n+import net.minecraft.screen.ScreenHandlerType;\n+import net.minecraft.text.Text;\n+import net.minecraft.util.registry.Registry;\n+\n+import net.fabricmc.api.ClientModInitializer;\n+import net.fabricmc.api.EnvType;\n+import net.fabricmc.api.Environment;\n+import net.fabricmc.fabric.api.network.ClientSidePacketRegistry;\n+import net.fabricmc.fabric.impl.screenhandler.ExtendedScreenHandlerType;\n+import net.fabricmc.fabric.impl.screenhandler.Packets;\n+\n+@Environment(EnvType.CLIENT)\n+public final class NetworkingClient implements ClientModInitializer {\n+\tprivate static final Logger LOGGER = LogManager.getLogger();\n+\n+\t@Override\n+\tpublic void onInitializeClient() {\n+\t\tClientSidePacketRegistry.INSTANCE.register(Packets.OPEN_ID, (ctx, buf) -> openScreen(buf));\n+\t}\n+\n+\t@SuppressWarnings({\"rawtypes\", \"unchecked\"})\n+\tprivate void openScreen(PacketByteBuf buf) {\n+\t\tint typeId = buf.readVarInt();\n+\t\tint syncId = buf.readVarInt();\n+\t\tText title = buf.readText();\n+\t\tScreenHandlerType<?> type = Registry.SCREEN_HANDLER.get(typeId);\n+\n+\t\tif (type == null) {\n+\t\t\tLOGGER.warn(\"[Fabric] Unknown screen handler ID: {}\", typeId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e077dc5d2fa67d1c79811ba2ee42c7e09e0f868"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDgzNzY3NQ==", "bodyText": "Good spotting. The logger name should suffice; this [Fabric] should be removed.", "url": "https://github.com/FabricMC/fabric/pull/584#discussion_r410837675", "createdAt": "2020-04-19T07:15:37Z", "author": {"login": "liach"}, "path": "fabric-screen-handler-api-v1/src/main/java/net/fabricmc/fabric/impl/screenhandler/client/NetworkingClient.java", "diffHunk": "@@ -0,0 +1,85 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.impl.screenhandler.client;\n+\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+\n+import net.minecraft.client.MinecraftClient;\n+import net.minecraft.client.gui.screen.Screen;\n+import net.minecraft.client.gui.screen.ingame.HandledScreens;\n+import net.minecraft.client.gui.screen.ingame.ScreenHandlerProvider;\n+import net.minecraft.entity.player.PlayerEntity;\n+import net.minecraft.network.PacketByteBuf;\n+import net.minecraft.screen.ScreenHandlerType;\n+import net.minecraft.text.Text;\n+import net.minecraft.util.registry.Registry;\n+\n+import net.fabricmc.api.ClientModInitializer;\n+import net.fabricmc.api.EnvType;\n+import net.fabricmc.api.Environment;\n+import net.fabricmc.fabric.api.network.ClientSidePacketRegistry;\n+import net.fabricmc.fabric.impl.screenhandler.ExtendedScreenHandlerType;\n+import net.fabricmc.fabric.impl.screenhandler.Packets;\n+\n+@Environment(EnvType.CLIENT)\n+public final class NetworkingClient implements ClientModInitializer {\n+\tprivate static final Logger LOGGER = LogManager.getLogger();\n+\n+\t@Override\n+\tpublic void onInitializeClient() {\n+\t\tClientSidePacketRegistry.INSTANCE.register(Packets.OPEN_ID, (ctx, buf) -> openScreen(buf));\n+\t}\n+\n+\t@SuppressWarnings({\"rawtypes\", \"unchecked\"})\n+\tprivate void openScreen(PacketByteBuf buf) {\n+\t\tint typeId = buf.readVarInt();\n+\t\tint syncId = buf.readVarInt();\n+\t\tText title = buf.readText();\n+\t\tScreenHandlerType<?> type = Registry.SCREEN_HANDLER.get(typeId);\n+\n+\t\tif (type == null) {\n+\t\t\tLOGGER.warn(\"[Fabric] Unknown screen handler ID: {}\", typeId);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDgzNjM3MQ=="}, "originalCommit": {"oid": "0e077dc5d2fa67d1c79811ba2ee42c7e09e0f868"}, "originalPosition": 56}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU1MTU5MzkyOnYy", "diffSide": "RIGHT", "path": "fabric-screen-handler-api-v1/src/main/java/net/fabricmc/fabric/impl/screenhandler/client/NetworkingClient.java", "isResolved": true, "comments": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOVQwNzoxMjoyM1rOGHzgtQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOVQwODowMDoxOFrOGH0CcQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDgzNzE3Mw==", "bodyText": "Hmm, is Registry.get safe in netty eventloop", "url": "https://github.com/FabricMC/fabric/pull/584#discussion_r410837173", "createdAt": "2020-04-19T07:12:23Z", "author": {"login": "liach"}, "path": "fabric-screen-handler-api-v1/src/main/java/net/fabricmc/fabric/impl/screenhandler/client/NetworkingClient.java", "diffHunk": "@@ -0,0 +1,85 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.impl.screenhandler.client;\n+\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+\n+import net.minecraft.client.MinecraftClient;\n+import net.minecraft.client.gui.screen.Screen;\n+import net.minecraft.client.gui.screen.ingame.HandledScreens;\n+import net.minecraft.client.gui.screen.ingame.ScreenHandlerProvider;\n+import net.minecraft.entity.player.PlayerEntity;\n+import net.minecraft.network.PacketByteBuf;\n+import net.minecraft.screen.ScreenHandlerType;\n+import net.minecraft.text.Text;\n+import net.minecraft.util.registry.Registry;\n+\n+import net.fabricmc.api.ClientModInitializer;\n+import net.fabricmc.api.EnvType;\n+import net.fabricmc.api.Environment;\n+import net.fabricmc.fabric.api.network.ClientSidePacketRegistry;\n+import net.fabricmc.fabric.impl.screenhandler.ExtendedScreenHandlerType;\n+import net.fabricmc.fabric.impl.screenhandler.Packets;\n+\n+@Environment(EnvType.CLIENT)\n+public final class NetworkingClient implements ClientModInitializer {\n+\tprivate static final Logger LOGGER = LogManager.getLogger();\n+\n+\t@Override\n+\tpublic void onInitializeClient() {\n+\t\tClientSidePacketRegistry.INSTANCE.register(Packets.OPEN_ID, (ctx, buf) -> openScreen(buf));\n+\t}\n+\n+\t@SuppressWarnings({\"rawtypes\", \"unchecked\"})\n+\tprivate void openScreen(PacketByteBuf buf) {\n+\t\tint typeId = buf.readVarInt();\n+\t\tint syncId = buf.readVarInt();\n+\t\tText title = buf.readText();\n+\t\tScreenHandlerType<?> type = Registry.SCREEN_HANDLER.get(typeId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e077dc5d2fa67d1c79811ba2ee42c7e09e0f868"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDgzODMyNQ==", "bodyText": "I think it's also done in vanilla?", "url": "https://github.com/FabricMC/fabric/pull/584#discussion_r410838325", "createdAt": "2020-04-19T07:19:16Z", "author": {"login": "Juuxel"}, "path": "fabric-screen-handler-api-v1/src/main/java/net/fabricmc/fabric/impl/screenhandler/client/NetworkingClient.java", "diffHunk": "@@ -0,0 +1,85 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.impl.screenhandler.client;\n+\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+\n+import net.minecraft.client.MinecraftClient;\n+import net.minecraft.client.gui.screen.Screen;\n+import net.minecraft.client.gui.screen.ingame.HandledScreens;\n+import net.minecraft.client.gui.screen.ingame.ScreenHandlerProvider;\n+import net.minecraft.entity.player.PlayerEntity;\n+import net.minecraft.network.PacketByteBuf;\n+import net.minecraft.screen.ScreenHandlerType;\n+import net.minecraft.text.Text;\n+import net.minecraft.util.registry.Registry;\n+\n+import net.fabricmc.api.ClientModInitializer;\n+import net.fabricmc.api.EnvType;\n+import net.fabricmc.api.Environment;\n+import net.fabricmc.fabric.api.network.ClientSidePacketRegistry;\n+import net.fabricmc.fabric.impl.screenhandler.ExtendedScreenHandlerType;\n+import net.fabricmc.fabric.impl.screenhandler.Packets;\n+\n+@Environment(EnvType.CLIENT)\n+public final class NetworkingClient implements ClientModInitializer {\n+\tprivate static final Logger LOGGER = LogManager.getLogger();\n+\n+\t@Override\n+\tpublic void onInitializeClient() {\n+\t\tClientSidePacketRegistry.INSTANCE.register(Packets.OPEN_ID, (ctx, buf) -> openScreen(buf));\n+\t}\n+\n+\t@SuppressWarnings({\"rawtypes\", \"unchecked\"})\n+\tprivate void openScreen(PacketByteBuf buf) {\n+\t\tint typeId = buf.readVarInt();\n+\t\tint syncId = buf.readVarInt();\n+\t\tText title = buf.readText();\n+\t\tScreenHandlerType<?> type = Registry.SCREEN_HANDLER.get(typeId);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDgzNzE3Mw=="}, "originalCommit": {"oid": "0e077dc5d2fa67d1c79811ba2ee42c7e09e0f868"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDgzODQ3OA==", "bodyText": "This one should be fine assuming registry isn't changed when the server/client play is active, not so much for client player though if there is a disconnection etc.", "url": "https://github.com/FabricMC/fabric/pull/584#discussion_r410838478", "createdAt": "2020-04-19T07:20:18Z", "author": {"login": "liach"}, "path": "fabric-screen-handler-api-v1/src/main/java/net/fabricmc/fabric/impl/screenhandler/client/NetworkingClient.java", "diffHunk": "@@ -0,0 +1,85 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.impl.screenhandler.client;\n+\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+\n+import net.minecraft.client.MinecraftClient;\n+import net.minecraft.client.gui.screen.Screen;\n+import net.minecraft.client.gui.screen.ingame.HandledScreens;\n+import net.minecraft.client.gui.screen.ingame.ScreenHandlerProvider;\n+import net.minecraft.entity.player.PlayerEntity;\n+import net.minecraft.network.PacketByteBuf;\n+import net.minecraft.screen.ScreenHandlerType;\n+import net.minecraft.text.Text;\n+import net.minecraft.util.registry.Registry;\n+\n+import net.fabricmc.api.ClientModInitializer;\n+import net.fabricmc.api.EnvType;\n+import net.fabricmc.api.Environment;\n+import net.fabricmc.fabric.api.network.ClientSidePacketRegistry;\n+import net.fabricmc.fabric.impl.screenhandler.ExtendedScreenHandlerType;\n+import net.fabricmc.fabric.impl.screenhandler.Packets;\n+\n+@Environment(EnvType.CLIENT)\n+public final class NetworkingClient implements ClientModInitializer {\n+\tprivate static final Logger LOGGER = LogManager.getLogger();\n+\n+\t@Override\n+\tpublic void onInitializeClient() {\n+\t\tClientSidePacketRegistry.INSTANCE.register(Packets.OPEN_ID, (ctx, buf) -> openScreen(buf));\n+\t}\n+\n+\t@SuppressWarnings({\"rawtypes\", \"unchecked\"})\n+\tprivate void openScreen(PacketByteBuf buf) {\n+\t\tint typeId = buf.readVarInt();\n+\t\tint syncId = buf.readVarInt();\n+\t\tText title = buf.readText();\n+\t\tScreenHandlerType<?> type = Registry.SCREEN_HANDLER.get(typeId);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDgzNzE3Mw=="}, "originalCommit": {"oid": "0e077dc5d2fa67d1c79811ba2ee42c7e09e0f868"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDg0MTU0MQ==", "bodyText": "The type also needs to be there for the deserialization of the extra data in buf.", "url": "https://github.com/FabricMC/fabric/pull/584#discussion_r410841541", "createdAt": "2020-04-19T07:37:52Z", "author": {"login": "Juuxel"}, "path": "fabric-screen-handler-api-v1/src/main/java/net/fabricmc/fabric/impl/screenhandler/client/NetworkingClient.java", "diffHunk": "@@ -0,0 +1,85 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.impl.screenhandler.client;\n+\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+\n+import net.minecraft.client.MinecraftClient;\n+import net.minecraft.client.gui.screen.Screen;\n+import net.minecraft.client.gui.screen.ingame.HandledScreens;\n+import net.minecraft.client.gui.screen.ingame.ScreenHandlerProvider;\n+import net.minecraft.entity.player.PlayerEntity;\n+import net.minecraft.network.PacketByteBuf;\n+import net.minecraft.screen.ScreenHandlerType;\n+import net.minecraft.text.Text;\n+import net.minecraft.util.registry.Registry;\n+\n+import net.fabricmc.api.ClientModInitializer;\n+import net.fabricmc.api.EnvType;\n+import net.fabricmc.api.Environment;\n+import net.fabricmc.fabric.api.network.ClientSidePacketRegistry;\n+import net.fabricmc.fabric.impl.screenhandler.ExtendedScreenHandlerType;\n+import net.fabricmc.fabric.impl.screenhandler.Packets;\n+\n+@Environment(EnvType.CLIENT)\n+public final class NetworkingClient implements ClientModInitializer {\n+\tprivate static final Logger LOGGER = LogManager.getLogger();\n+\n+\t@Override\n+\tpublic void onInitializeClient() {\n+\t\tClientSidePacketRegistry.INSTANCE.register(Packets.OPEN_ID, (ctx, buf) -> openScreen(buf));\n+\t}\n+\n+\t@SuppressWarnings({\"rawtypes\", \"unchecked\"})\n+\tprivate void openScreen(PacketByteBuf buf) {\n+\t\tint typeId = buf.readVarInt();\n+\t\tint syncId = buf.readVarInt();\n+\t\tText title = buf.readText();\n+\t\tScreenHandlerType<?> type = Registry.SCREEN_HANDLER.get(typeId);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDgzNzE3Mw=="}, "originalCommit": {"oid": "0e077dc5d2fa67d1c79811ba2ee42c7e09e0f868"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDg0MzQ1Ng==", "bodyText": "I mean the access to client player below is unsafe.", "url": "https://github.com/FabricMC/fabric/pull/584#discussion_r410843456", "createdAt": "2020-04-19T07:48:02Z", "author": {"login": "liach"}, "path": "fabric-screen-handler-api-v1/src/main/java/net/fabricmc/fabric/impl/screenhandler/client/NetworkingClient.java", "diffHunk": "@@ -0,0 +1,85 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.impl.screenhandler.client;\n+\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+\n+import net.minecraft.client.MinecraftClient;\n+import net.minecraft.client.gui.screen.Screen;\n+import net.minecraft.client.gui.screen.ingame.HandledScreens;\n+import net.minecraft.client.gui.screen.ingame.ScreenHandlerProvider;\n+import net.minecraft.entity.player.PlayerEntity;\n+import net.minecraft.network.PacketByteBuf;\n+import net.minecraft.screen.ScreenHandlerType;\n+import net.minecraft.text.Text;\n+import net.minecraft.util.registry.Registry;\n+\n+import net.fabricmc.api.ClientModInitializer;\n+import net.fabricmc.api.EnvType;\n+import net.fabricmc.api.Environment;\n+import net.fabricmc.fabric.api.network.ClientSidePacketRegistry;\n+import net.fabricmc.fabric.impl.screenhandler.ExtendedScreenHandlerType;\n+import net.fabricmc.fabric.impl.screenhandler.Packets;\n+\n+@Environment(EnvType.CLIENT)\n+public final class NetworkingClient implements ClientModInitializer {\n+\tprivate static final Logger LOGGER = LogManager.getLogger();\n+\n+\t@Override\n+\tpublic void onInitializeClient() {\n+\t\tClientSidePacketRegistry.INSTANCE.register(Packets.OPEN_ID, (ctx, buf) -> openScreen(buf));\n+\t}\n+\n+\t@SuppressWarnings({\"rawtypes\", \"unchecked\"})\n+\tprivate void openScreen(PacketByteBuf buf) {\n+\t\tint typeId = buf.readVarInt();\n+\t\tint syncId = buf.readVarInt();\n+\t\tText title = buf.readText();\n+\t\tScreenHandlerType<?> type = Registry.SCREEN_HANDLER.get(typeId);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDgzNzE3Mw=="}, "originalCommit": {"oid": "0e077dc5d2fa67d1c79811ba2ee42c7e09e0f868"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDg0NTM0Mg==", "bodyText": "Would this be a solution for the thread issue? (and do I have to manually release the slice or does the GC do its job)", "url": "https://github.com/FabricMC/fabric/pull/584#discussion_r410845342", "createdAt": "2020-04-19T07:58:02Z", "author": {"login": "Juuxel"}, "path": "fabric-screen-handler-api-v1/src/main/java/net/fabricmc/fabric/impl/screenhandler/client/NetworkingClient.java", "diffHunk": "@@ -0,0 +1,85 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.impl.screenhandler.client;\n+\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+\n+import net.minecraft.client.MinecraftClient;\n+import net.minecraft.client.gui.screen.Screen;\n+import net.minecraft.client.gui.screen.ingame.HandledScreens;\n+import net.minecraft.client.gui.screen.ingame.ScreenHandlerProvider;\n+import net.minecraft.entity.player.PlayerEntity;\n+import net.minecraft.network.PacketByteBuf;\n+import net.minecraft.screen.ScreenHandlerType;\n+import net.minecraft.text.Text;\n+import net.minecraft.util.registry.Registry;\n+\n+import net.fabricmc.api.ClientModInitializer;\n+import net.fabricmc.api.EnvType;\n+import net.fabricmc.api.Environment;\n+import net.fabricmc.fabric.api.network.ClientSidePacketRegistry;\n+import net.fabricmc.fabric.impl.screenhandler.ExtendedScreenHandlerType;\n+import net.fabricmc.fabric.impl.screenhandler.Packets;\n+\n+@Environment(EnvType.CLIENT)\n+public final class NetworkingClient implements ClientModInitializer {\n+\tprivate static final Logger LOGGER = LogManager.getLogger();\n+\n+\t@Override\n+\tpublic void onInitializeClient() {\n+\t\tClientSidePacketRegistry.INSTANCE.register(Packets.OPEN_ID, (ctx, buf) -> openScreen(buf));\n+\t}\n+\n+\t@SuppressWarnings({\"rawtypes\", \"unchecked\"})\n+\tprivate void openScreen(PacketByteBuf buf) {\n+\t\tint typeId = buf.readVarInt();\n+\t\tint syncId = buf.readVarInt();\n+\t\tText title = buf.readText();\n+\t\tScreenHandlerType<?> type = Registry.SCREEN_HANDLER.get(typeId);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDgzNzE3Mw=="}, "originalCommit": {"oid": "0e077dc5d2fa67d1c79811ba2ee42c7e09e0f868"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDg0NTY0Mg==", "bodyText": "You create the retained slice outsdie of the runnable. Otherwise when the handler's method exits the buf is released and by the time you call retainedSlice on buf on main thread, the buf is gone", "url": "https://github.com/FabricMC/fabric/pull/584#discussion_r410845642", "createdAt": "2020-04-19T07:59:22Z", "author": {"login": "liach"}, "path": "fabric-screen-handler-api-v1/src/main/java/net/fabricmc/fabric/impl/screenhandler/client/NetworkingClient.java", "diffHunk": "@@ -0,0 +1,85 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.impl.screenhandler.client;\n+\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+\n+import net.minecraft.client.MinecraftClient;\n+import net.minecraft.client.gui.screen.Screen;\n+import net.minecraft.client.gui.screen.ingame.HandledScreens;\n+import net.minecraft.client.gui.screen.ingame.ScreenHandlerProvider;\n+import net.minecraft.entity.player.PlayerEntity;\n+import net.minecraft.network.PacketByteBuf;\n+import net.minecraft.screen.ScreenHandlerType;\n+import net.minecraft.text.Text;\n+import net.minecraft.util.registry.Registry;\n+\n+import net.fabricmc.api.ClientModInitializer;\n+import net.fabricmc.api.EnvType;\n+import net.fabricmc.api.Environment;\n+import net.fabricmc.fabric.api.network.ClientSidePacketRegistry;\n+import net.fabricmc.fabric.impl.screenhandler.ExtendedScreenHandlerType;\n+import net.fabricmc.fabric.impl.screenhandler.Packets;\n+\n+@Environment(EnvType.CLIENT)\n+public final class NetworkingClient implements ClientModInitializer {\n+\tprivate static final Logger LOGGER = LogManager.getLogger();\n+\n+\t@Override\n+\tpublic void onInitializeClient() {\n+\t\tClientSidePacketRegistry.INSTANCE.register(Packets.OPEN_ID, (ctx, buf) -> openScreen(buf));\n+\t}\n+\n+\t@SuppressWarnings({\"rawtypes\", \"unchecked\"})\n+\tprivate void openScreen(PacketByteBuf buf) {\n+\t\tint typeId = buf.readVarInt();\n+\t\tint syncId = buf.readVarInt();\n+\t\tText title = buf.readText();\n+\t\tScreenHandlerType<?> type = Registry.SCREEN_HANDLER.get(typeId);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDgzNzE3Mw=="}, "originalCommit": {"oid": "0e077dc5d2fa67d1c79811ba2ee42c7e09e0f868"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDg0NTgwOQ==", "bodyText": "In fact, it seems you can just call buf.retain before you call execute and just pass the buf to openScreen", "url": "https://github.com/FabricMC/fabric/pull/584#discussion_r410845809", "createdAt": "2020-04-19T08:00:18Z", "author": {"login": "liach"}, "path": "fabric-screen-handler-api-v1/src/main/java/net/fabricmc/fabric/impl/screenhandler/client/NetworkingClient.java", "diffHunk": "@@ -0,0 +1,85 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.impl.screenhandler.client;\n+\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+\n+import net.minecraft.client.MinecraftClient;\n+import net.minecraft.client.gui.screen.Screen;\n+import net.minecraft.client.gui.screen.ingame.HandledScreens;\n+import net.minecraft.client.gui.screen.ingame.ScreenHandlerProvider;\n+import net.minecraft.entity.player.PlayerEntity;\n+import net.minecraft.network.PacketByteBuf;\n+import net.minecraft.screen.ScreenHandlerType;\n+import net.minecraft.text.Text;\n+import net.minecraft.util.registry.Registry;\n+\n+import net.fabricmc.api.ClientModInitializer;\n+import net.fabricmc.api.EnvType;\n+import net.fabricmc.api.Environment;\n+import net.fabricmc.fabric.api.network.ClientSidePacketRegistry;\n+import net.fabricmc.fabric.impl.screenhandler.ExtendedScreenHandlerType;\n+import net.fabricmc.fabric.impl.screenhandler.Packets;\n+\n+@Environment(EnvType.CLIENT)\n+public final class NetworkingClient implements ClientModInitializer {\n+\tprivate static final Logger LOGGER = LogManager.getLogger();\n+\n+\t@Override\n+\tpublic void onInitializeClient() {\n+\t\tClientSidePacketRegistry.INSTANCE.register(Packets.OPEN_ID, (ctx, buf) -> openScreen(buf));\n+\t}\n+\n+\t@SuppressWarnings({\"rawtypes\", \"unchecked\"})\n+\tprivate void openScreen(PacketByteBuf buf) {\n+\t\tint typeId = buf.readVarInt();\n+\t\tint syncId = buf.readVarInt();\n+\t\tText title = buf.readText();\n+\t\tScreenHandlerType<?> type = Registry.SCREEN_HANDLER.get(typeId);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDgzNzE3Mw=="}, "originalCommit": {"oid": "0e077dc5d2fa67d1c79811ba2ee42c7e09e0f868"}, "originalPosition": 53}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU1MTU5NTE1OnYy", "diffSide": "RIGHT", "path": "fabric-screen-handler-api-v1/src/main/java/net/fabricmc/fabric/impl/screenhandler/client/NetworkingClient.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOVQwNzoxMzoxMFrOGHzhQA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOVQwNzoxMzoxMFrOGHzhQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDgzNzMxMg==", "bodyText": "similar concerns here, some read accesses may be unsafe in event loop", "url": "https://github.com/FabricMC/fabric/pull/584#discussion_r410837312", "createdAt": "2020-04-19T07:13:10Z", "author": {"login": "liach"}, "path": "fabric-screen-handler-api-v1/src/main/java/net/fabricmc/fabric/impl/screenhandler/client/NetworkingClient.java", "diffHunk": "@@ -0,0 +1,85 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.impl.screenhandler.client;\n+\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+\n+import net.minecraft.client.MinecraftClient;\n+import net.minecraft.client.gui.screen.Screen;\n+import net.minecraft.client.gui.screen.ingame.HandledScreens;\n+import net.minecraft.client.gui.screen.ingame.ScreenHandlerProvider;\n+import net.minecraft.entity.player.PlayerEntity;\n+import net.minecraft.network.PacketByteBuf;\n+import net.minecraft.screen.ScreenHandlerType;\n+import net.minecraft.text.Text;\n+import net.minecraft.util.registry.Registry;\n+\n+import net.fabricmc.api.ClientModInitializer;\n+import net.fabricmc.api.EnvType;\n+import net.fabricmc.api.Environment;\n+import net.fabricmc.fabric.api.network.ClientSidePacketRegistry;\n+import net.fabricmc.fabric.impl.screenhandler.ExtendedScreenHandlerType;\n+import net.fabricmc.fabric.impl.screenhandler.Packets;\n+\n+@Environment(EnvType.CLIENT)\n+public final class NetworkingClient implements ClientModInitializer {\n+\tprivate static final Logger LOGGER = LogManager.getLogger();\n+\n+\t@Override\n+\tpublic void onInitializeClient() {\n+\t\tClientSidePacketRegistry.INSTANCE.register(Packets.OPEN_ID, (ctx, buf) -> openScreen(buf));\n+\t}\n+\n+\t@SuppressWarnings({\"rawtypes\", \"unchecked\"})\n+\tprivate void openScreen(PacketByteBuf buf) {\n+\t\tint typeId = buf.readVarInt();\n+\t\tint syncId = buf.readVarInt();\n+\t\tText title = buf.readText();\n+\t\tScreenHandlerType<?> type = Registry.SCREEN_HANDLER.get(typeId);\n+\n+\t\tif (type == null) {\n+\t\t\tLOGGER.warn(\"[Fabric] Unknown screen handler ID: {}\", typeId);\n+\t\t\treturn;\n+\t\t}\n+\n+\t\tif (!(type instanceof ExtendedScreenHandlerType<?>)) {\n+\t\t\tLOGGER.warn(\"[Fabric] Received extended opening packet for non-extended screen handler {}\", Registry.SCREEN_HANDLER.getId(type));\n+\t\t\treturn;\n+\t\t}\n+\n+\t\tHandledScreens.Provider screenFactory = HandledScreens.getProvider(type);\n+\n+\t\tif (screenFactory != null) {\n+\t\t\tMinecraftClient client = MinecraftClient.getInstance();\n+\t\t\tPlayerEntity player = client.player;\n+\n+\t\t\tScreen screen = screenFactory.create(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e077dc5d2fa67d1c79811ba2ee42c7e09e0f868"}, "originalPosition": 71}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU1MTYzOTYxOnYy", "diffSide": "RIGHT", "path": "fabric-screen-handler-api-v1/src/main/java/net/fabricmc/fabric/mixin/screenhandler/ServerPlayerEntityMixin.java", "isResolved": false, "comments": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOVQwNzo0MToyN1rOGHz0lg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOVQwODoxNToyM1rOGH0MlA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDg0MjI2Mg==", "bodyText": "Are we going for prefixing the inject methods with fabric and _? I am seeing mostly no prefix on inject, this is an inject so conflicting names shouldn't matter right?", "url": "https://github.com/FabricMC/fabric/pull/584#discussion_r410842262", "createdAt": "2020-04-19T07:41:27Z", "author": {"login": "shedaniel"}, "path": "fabric-screen-handler-api-v1/src/main/java/net/fabricmc/fabric/mixin/screenhandler/ServerPlayerEntityMixin.java", "diffHunk": "@@ -0,0 +1,80 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.mixin.screenhandler;\n+\n+import java.util.OptionalInt;\n+\n+import org.spongepowered.asm.mixin.Mixin;\n+import org.spongepowered.asm.mixin.Shadow;\n+import org.spongepowered.asm.mixin.Unique;\n+import org.spongepowered.asm.mixin.injection.At;\n+import org.spongepowered.asm.mixin.injection.Inject;\n+import org.spongepowered.asm.mixin.injection.Redirect;\n+import org.spongepowered.asm.mixin.injection.callback.CallbackInfoReturnable;\n+import org.spongepowered.asm.mixin.injection.callback.LocalCapture;\n+\n+import net.minecraft.network.Packet;\n+import net.minecraft.screen.NamedScreenHandlerFactory;\n+import net.minecraft.screen.ScreenHandler;\n+import net.minecraft.server.network.ServerPlayerEntity;\n+import net.minecraft.server.network.ServerPlayNetworkHandler;\n+import net.minecraft.util.Identifier;\n+import net.minecraft.util.registry.Registry;\n+\n+import net.fabricmc.fabric.api.screenhandler.v1.ExtendedScreenHandlerFactory;\n+import net.fabricmc.fabric.impl.screenhandler.ExtendedScreenHandlerType;\n+import net.fabricmc.fabric.impl.screenhandler.ScreenHandlersImpl;\n+\n+@Mixin(ServerPlayerEntity.class)\n+public class ServerPlayerEntityMixin {\n+\t@Shadow\n+\tprivate int screenHandlerSyncId;\n+\n+\t@Unique\n+\tprivate final ThreadLocal<ScreenHandler> fabric_openedScreenHandler = new ThreadLocal<>();\n+\n+\t@Inject(method = \"openHandledScreen(Lnet/minecraft/screen/NamedScreenHandlerFactory;)Ljava/util/OptionalInt;\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/server/network/ServerPlayNetworkHandler;sendPacket(Lnet/minecraft/network/Packet;)V\"), locals = LocalCapture.CAPTURE_FAILHARD)\n+\tprivate void fabric_onOpenHandledScreen_cacheScreenHandler(NamedScreenHandlerFactory factory, CallbackInfoReturnable<OptionalInt> info, ScreenHandler handler) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e077dc5d2fa67d1c79811ba2ee42c7e09e0f868"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDg0MjQwNg==", "bodyText": "The fabric_ prefix is also for exception stacktraces because VanillaClass.someMethod$onSomeMethod doesn't tell what mod caused the error, unlike fabric_onSomeMethod.", "url": "https://github.com/FabricMC/fabric/pull/584#discussion_r410842406", "createdAt": "2020-04-19T07:42:19Z", "author": {"login": "Juuxel"}, "path": "fabric-screen-handler-api-v1/src/main/java/net/fabricmc/fabric/mixin/screenhandler/ServerPlayerEntityMixin.java", "diffHunk": "@@ -0,0 +1,80 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.mixin.screenhandler;\n+\n+import java.util.OptionalInt;\n+\n+import org.spongepowered.asm.mixin.Mixin;\n+import org.spongepowered.asm.mixin.Shadow;\n+import org.spongepowered.asm.mixin.Unique;\n+import org.spongepowered.asm.mixin.injection.At;\n+import org.spongepowered.asm.mixin.injection.Inject;\n+import org.spongepowered.asm.mixin.injection.Redirect;\n+import org.spongepowered.asm.mixin.injection.callback.CallbackInfoReturnable;\n+import org.spongepowered.asm.mixin.injection.callback.LocalCapture;\n+\n+import net.minecraft.network.Packet;\n+import net.minecraft.screen.NamedScreenHandlerFactory;\n+import net.minecraft.screen.ScreenHandler;\n+import net.minecraft.server.network.ServerPlayerEntity;\n+import net.minecraft.server.network.ServerPlayNetworkHandler;\n+import net.minecraft.util.Identifier;\n+import net.minecraft.util.registry.Registry;\n+\n+import net.fabricmc.fabric.api.screenhandler.v1.ExtendedScreenHandlerFactory;\n+import net.fabricmc.fabric.impl.screenhandler.ExtendedScreenHandlerType;\n+import net.fabricmc.fabric.impl.screenhandler.ScreenHandlersImpl;\n+\n+@Mixin(ServerPlayerEntity.class)\n+public class ServerPlayerEntityMixin {\n+\t@Shadow\n+\tprivate int screenHandlerSyncId;\n+\n+\t@Unique\n+\tprivate final ThreadLocal<ScreenHandler> fabric_openedScreenHandler = new ThreadLocal<>();\n+\n+\t@Inject(method = \"openHandledScreen(Lnet/minecraft/screen/NamedScreenHandlerFactory;)Ljava/util/OptionalInt;\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/server/network/ServerPlayNetworkHandler;sendPacket(Lnet/minecraft/network/Packet;)V\"), locals = LocalCapture.CAPTURE_FAILHARD)\n+\tprivate void fabric_onOpenHandledScreen_cacheScreenHandler(NamedScreenHandlerFactory factory, CallbackInfoReturnable<OptionalInt> info, ScreenHandler handler) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDg0MjI2Mg=="}, "originalCommit": {"oid": "0e077dc5d2fa67d1c79811ba2ee42c7e09e0f868"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDg0Mjc0NA==", "bodyText": "We might want to have a standard in place for this, 99% of mixins have no prefix right now, we might want to refactor all of them if that's what we are going for.", "url": "https://github.com/FabricMC/fabric/pull/584#discussion_r410842744", "createdAt": "2020-04-19T07:43:59Z", "author": {"login": "shedaniel"}, "path": "fabric-screen-handler-api-v1/src/main/java/net/fabricmc/fabric/mixin/screenhandler/ServerPlayerEntityMixin.java", "diffHunk": "@@ -0,0 +1,80 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.mixin.screenhandler;\n+\n+import java.util.OptionalInt;\n+\n+import org.spongepowered.asm.mixin.Mixin;\n+import org.spongepowered.asm.mixin.Shadow;\n+import org.spongepowered.asm.mixin.Unique;\n+import org.spongepowered.asm.mixin.injection.At;\n+import org.spongepowered.asm.mixin.injection.Inject;\n+import org.spongepowered.asm.mixin.injection.Redirect;\n+import org.spongepowered.asm.mixin.injection.callback.CallbackInfoReturnable;\n+import org.spongepowered.asm.mixin.injection.callback.LocalCapture;\n+\n+import net.minecraft.network.Packet;\n+import net.minecraft.screen.NamedScreenHandlerFactory;\n+import net.minecraft.screen.ScreenHandler;\n+import net.minecraft.server.network.ServerPlayerEntity;\n+import net.minecraft.server.network.ServerPlayNetworkHandler;\n+import net.minecraft.util.Identifier;\n+import net.minecraft.util.registry.Registry;\n+\n+import net.fabricmc.fabric.api.screenhandler.v1.ExtendedScreenHandlerFactory;\n+import net.fabricmc.fabric.impl.screenhandler.ExtendedScreenHandlerType;\n+import net.fabricmc.fabric.impl.screenhandler.ScreenHandlersImpl;\n+\n+@Mixin(ServerPlayerEntity.class)\n+public class ServerPlayerEntityMixin {\n+\t@Shadow\n+\tprivate int screenHandlerSyncId;\n+\n+\t@Unique\n+\tprivate final ThreadLocal<ScreenHandler> fabric_openedScreenHandler = new ThreadLocal<>();\n+\n+\t@Inject(method = \"openHandledScreen(Lnet/minecraft/screen/NamedScreenHandlerFactory;)Ljava/util/OptionalInt;\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/server/network/ServerPlayNetworkHandler;sendPacket(Lnet/minecraft/network/Packet;)V\"), locals = LocalCapture.CAPTURE_FAILHARD)\n+\tprivate void fabric_onOpenHandledScreen_cacheScreenHandler(NamedScreenHandlerFactory factory, CallbackInfoReturnable<OptionalInt> info, ScreenHandler handler) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDg0MjI2Mg=="}, "originalCommit": {"oid": "0e077dc5d2fa67d1c79811ba2ee42c7e09e0f868"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDg0MjgzMA==", "bodyText": "But that's a topic for another day, let's not bloat this thing", "url": "https://github.com/FabricMC/fabric/pull/584#discussion_r410842830", "createdAt": "2020-04-19T07:44:31Z", "author": {"login": "shedaniel"}, "path": "fabric-screen-handler-api-v1/src/main/java/net/fabricmc/fabric/mixin/screenhandler/ServerPlayerEntityMixin.java", "diffHunk": "@@ -0,0 +1,80 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.mixin.screenhandler;\n+\n+import java.util.OptionalInt;\n+\n+import org.spongepowered.asm.mixin.Mixin;\n+import org.spongepowered.asm.mixin.Shadow;\n+import org.spongepowered.asm.mixin.Unique;\n+import org.spongepowered.asm.mixin.injection.At;\n+import org.spongepowered.asm.mixin.injection.Inject;\n+import org.spongepowered.asm.mixin.injection.Redirect;\n+import org.spongepowered.asm.mixin.injection.callback.CallbackInfoReturnable;\n+import org.spongepowered.asm.mixin.injection.callback.LocalCapture;\n+\n+import net.minecraft.network.Packet;\n+import net.minecraft.screen.NamedScreenHandlerFactory;\n+import net.minecraft.screen.ScreenHandler;\n+import net.minecraft.server.network.ServerPlayerEntity;\n+import net.minecraft.server.network.ServerPlayNetworkHandler;\n+import net.minecraft.util.Identifier;\n+import net.minecraft.util.registry.Registry;\n+\n+import net.fabricmc.fabric.api.screenhandler.v1.ExtendedScreenHandlerFactory;\n+import net.fabricmc.fabric.impl.screenhandler.ExtendedScreenHandlerType;\n+import net.fabricmc.fabric.impl.screenhandler.ScreenHandlersImpl;\n+\n+@Mixin(ServerPlayerEntity.class)\n+public class ServerPlayerEntityMixin {\n+\t@Shadow\n+\tprivate int screenHandlerSyncId;\n+\n+\t@Unique\n+\tprivate final ThreadLocal<ScreenHandler> fabric_openedScreenHandler = new ThreadLocal<>();\n+\n+\t@Inject(method = \"openHandledScreen(Lnet/minecraft/screen/NamedScreenHandlerFactory;)Ljava/util/OptionalInt;\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/server/network/ServerPlayNetworkHandler;sendPacket(Lnet/minecraft/network/Packet;)V\"), locals = LocalCapture.CAPTURE_FAILHARD)\n+\tprivate void fabric_onOpenHandledScreen_cacheScreenHandler(NamedScreenHandlerFactory factory, CallbackInfoReturnable<OptionalInt> info, ScreenHandler handler) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDg0MjI2Mg=="}, "originalCommit": {"oid": "0e077dc5d2fa67d1c79811ba2ee42c7e09e0f868"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDg0MzE3Ng==", "bodyText": "That is actually an issue I brought up already #510", "url": "https://github.com/FabricMC/fabric/pull/584#discussion_r410843176", "createdAt": "2020-04-19T07:46:25Z", "author": {"login": "i509VCB"}, "path": "fabric-screen-handler-api-v1/src/main/java/net/fabricmc/fabric/mixin/screenhandler/ServerPlayerEntityMixin.java", "diffHunk": "@@ -0,0 +1,80 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.mixin.screenhandler;\n+\n+import java.util.OptionalInt;\n+\n+import org.spongepowered.asm.mixin.Mixin;\n+import org.spongepowered.asm.mixin.Shadow;\n+import org.spongepowered.asm.mixin.Unique;\n+import org.spongepowered.asm.mixin.injection.At;\n+import org.spongepowered.asm.mixin.injection.Inject;\n+import org.spongepowered.asm.mixin.injection.Redirect;\n+import org.spongepowered.asm.mixin.injection.callback.CallbackInfoReturnable;\n+import org.spongepowered.asm.mixin.injection.callback.LocalCapture;\n+\n+import net.minecraft.network.Packet;\n+import net.minecraft.screen.NamedScreenHandlerFactory;\n+import net.minecraft.screen.ScreenHandler;\n+import net.minecraft.server.network.ServerPlayerEntity;\n+import net.minecraft.server.network.ServerPlayNetworkHandler;\n+import net.minecraft.util.Identifier;\n+import net.minecraft.util.registry.Registry;\n+\n+import net.fabricmc.fabric.api.screenhandler.v1.ExtendedScreenHandlerFactory;\n+import net.fabricmc.fabric.impl.screenhandler.ExtendedScreenHandlerType;\n+import net.fabricmc.fabric.impl.screenhandler.ScreenHandlersImpl;\n+\n+@Mixin(ServerPlayerEntity.class)\n+public class ServerPlayerEntityMixin {\n+\t@Shadow\n+\tprivate int screenHandlerSyncId;\n+\n+\t@Unique\n+\tprivate final ThreadLocal<ScreenHandler> fabric_openedScreenHandler = new ThreadLocal<>();\n+\n+\t@Inject(method = \"openHandledScreen(Lnet/minecraft/screen/NamedScreenHandlerFactory;)Ljava/util/OptionalInt;\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/server/network/ServerPlayNetworkHandler;sendPacket(Lnet/minecraft/network/Packet;)V\"), locals = LocalCapture.CAPTURE_FAILHARD)\n+\tprivate void fabric_onOpenHandledScreen_cacheScreenHandler(NamedScreenHandlerFactory factory, CallbackInfoReturnable<OptionalInt> info, ScreenHandler handler) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDg0MjI2Mg=="}, "originalCommit": {"oid": "0e077dc5d2fa67d1c79811ba2ee42c7e09e0f868"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDg0MzQ4NQ==", "bodyText": "Prefixes are not necessary on @Inject methods, since Mixin prepends special signature info onto each method. For MixinAbstractFurnaceBlockEntity's fuelTimeMapHook method, Mixin names it handler$zeh000$fuelTimeMapHook. It's also given a @MixinMerged annotation noting the mixin class that added the injection. If the fabric_ prefix here is because Mixin error handling doesn't expose the cause well enough, then we can just improve error handling on our Mixin fork. This method should just be named cacheScreenHandler.", "url": "https://github.com/FabricMC/fabric/pull/584#discussion_r410843485", "createdAt": "2020-04-19T07:48:12Z", "author": {"login": "LemmaEOF"}, "path": "fabric-screen-handler-api-v1/src/main/java/net/fabricmc/fabric/mixin/screenhandler/ServerPlayerEntityMixin.java", "diffHunk": "@@ -0,0 +1,80 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.mixin.screenhandler;\n+\n+import java.util.OptionalInt;\n+\n+import org.spongepowered.asm.mixin.Mixin;\n+import org.spongepowered.asm.mixin.Shadow;\n+import org.spongepowered.asm.mixin.Unique;\n+import org.spongepowered.asm.mixin.injection.At;\n+import org.spongepowered.asm.mixin.injection.Inject;\n+import org.spongepowered.asm.mixin.injection.Redirect;\n+import org.spongepowered.asm.mixin.injection.callback.CallbackInfoReturnable;\n+import org.spongepowered.asm.mixin.injection.callback.LocalCapture;\n+\n+import net.minecraft.network.Packet;\n+import net.minecraft.screen.NamedScreenHandlerFactory;\n+import net.minecraft.screen.ScreenHandler;\n+import net.minecraft.server.network.ServerPlayerEntity;\n+import net.minecraft.server.network.ServerPlayNetworkHandler;\n+import net.minecraft.util.Identifier;\n+import net.minecraft.util.registry.Registry;\n+\n+import net.fabricmc.fabric.api.screenhandler.v1.ExtendedScreenHandlerFactory;\n+import net.fabricmc.fabric.impl.screenhandler.ExtendedScreenHandlerType;\n+import net.fabricmc.fabric.impl.screenhandler.ScreenHandlersImpl;\n+\n+@Mixin(ServerPlayerEntity.class)\n+public class ServerPlayerEntityMixin {\n+\t@Shadow\n+\tprivate int screenHandlerSyncId;\n+\n+\t@Unique\n+\tprivate final ThreadLocal<ScreenHandler> fabric_openedScreenHandler = new ThreadLocal<>();\n+\n+\t@Inject(method = \"openHandledScreen(Lnet/minecraft/screen/NamedScreenHandlerFactory;)Ljava/util/OptionalInt;\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/server/network/ServerPlayNetworkHandler;sendPacket(Lnet/minecraft/network/Packet;)V\"), locals = LocalCapture.CAPTURE_FAILHARD)\n+\tprivate void fabric_onOpenHandledScreen_cacheScreenHandler(NamedScreenHandlerFactory factory, CallbackInfoReturnable<OptionalInt> info, ScreenHandler handler) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDg0MjI2Mg=="}, "originalCommit": {"oid": "0e077dc5d2fa67d1c79811ba2ee42c7e09e0f868"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDg0MzU2Mw==", "bodyText": "we should use prefix, though i personally prefer fabric$ prefix as _ looks too ugly", "url": "https://github.com/FabricMC/fabric/pull/584#discussion_r410843563", "createdAt": "2020-04-19T07:48:29Z", "author": {"login": "liach"}, "path": "fabric-screen-handler-api-v1/src/main/java/net/fabricmc/fabric/mixin/screenhandler/ServerPlayerEntityMixin.java", "diffHunk": "@@ -0,0 +1,80 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.mixin.screenhandler;\n+\n+import java.util.OptionalInt;\n+\n+import org.spongepowered.asm.mixin.Mixin;\n+import org.spongepowered.asm.mixin.Shadow;\n+import org.spongepowered.asm.mixin.Unique;\n+import org.spongepowered.asm.mixin.injection.At;\n+import org.spongepowered.asm.mixin.injection.Inject;\n+import org.spongepowered.asm.mixin.injection.Redirect;\n+import org.spongepowered.asm.mixin.injection.callback.CallbackInfoReturnable;\n+import org.spongepowered.asm.mixin.injection.callback.LocalCapture;\n+\n+import net.minecraft.network.Packet;\n+import net.minecraft.screen.NamedScreenHandlerFactory;\n+import net.minecraft.screen.ScreenHandler;\n+import net.minecraft.server.network.ServerPlayerEntity;\n+import net.minecraft.server.network.ServerPlayNetworkHandler;\n+import net.minecraft.util.Identifier;\n+import net.minecraft.util.registry.Registry;\n+\n+import net.fabricmc.fabric.api.screenhandler.v1.ExtendedScreenHandlerFactory;\n+import net.fabricmc.fabric.impl.screenhandler.ExtendedScreenHandlerType;\n+import net.fabricmc.fabric.impl.screenhandler.ScreenHandlersImpl;\n+\n+@Mixin(ServerPlayerEntity.class)\n+public class ServerPlayerEntityMixin {\n+\t@Shadow\n+\tprivate int screenHandlerSyncId;\n+\n+\t@Unique\n+\tprivate final ThreadLocal<ScreenHandler> fabric_openedScreenHandler = new ThreadLocal<>();\n+\n+\t@Inject(method = \"openHandledScreen(Lnet/minecraft/screen/NamedScreenHandlerFactory;)Ljava/util/OptionalInt;\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/server/network/ServerPlayNetworkHandler;sendPacket(Lnet/minecraft/network/Packet;)V\"), locals = LocalCapture.CAPTURE_FAILHARD)\n+\tprivate void fabric_onOpenHandledScreen_cacheScreenHandler(NamedScreenHandlerFactory factory, CallbackInfoReturnable<OptionalInt> info, ScreenHandler handler) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDg0MjI2Mg=="}, "originalCommit": {"oid": "0e077dc5d2fa67d1c79811ba2ee42c7e09e0f868"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDg0MzkwNA==", "bodyText": "We should follow the standard in the rest of Fabric API or create a new PR to enforce the fabric$ prefix standard across the rest of the API. Renaming mixin methods is not breaking, so it can be done safely at any time. Stick with the API convention for now.", "url": "https://github.com/FabricMC/fabric/pull/584#discussion_r410843904", "createdAt": "2020-04-19T07:50:31Z", "author": {"login": "LemmaEOF"}, "path": "fabric-screen-handler-api-v1/src/main/java/net/fabricmc/fabric/mixin/screenhandler/ServerPlayerEntityMixin.java", "diffHunk": "@@ -0,0 +1,80 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.mixin.screenhandler;\n+\n+import java.util.OptionalInt;\n+\n+import org.spongepowered.asm.mixin.Mixin;\n+import org.spongepowered.asm.mixin.Shadow;\n+import org.spongepowered.asm.mixin.Unique;\n+import org.spongepowered.asm.mixin.injection.At;\n+import org.spongepowered.asm.mixin.injection.Inject;\n+import org.spongepowered.asm.mixin.injection.Redirect;\n+import org.spongepowered.asm.mixin.injection.callback.CallbackInfoReturnable;\n+import org.spongepowered.asm.mixin.injection.callback.LocalCapture;\n+\n+import net.minecraft.network.Packet;\n+import net.minecraft.screen.NamedScreenHandlerFactory;\n+import net.minecraft.screen.ScreenHandler;\n+import net.minecraft.server.network.ServerPlayerEntity;\n+import net.minecraft.server.network.ServerPlayNetworkHandler;\n+import net.minecraft.util.Identifier;\n+import net.minecraft.util.registry.Registry;\n+\n+import net.fabricmc.fabric.api.screenhandler.v1.ExtendedScreenHandlerFactory;\n+import net.fabricmc.fabric.impl.screenhandler.ExtendedScreenHandlerType;\n+import net.fabricmc.fabric.impl.screenhandler.ScreenHandlersImpl;\n+\n+@Mixin(ServerPlayerEntity.class)\n+public class ServerPlayerEntityMixin {\n+\t@Shadow\n+\tprivate int screenHandlerSyncId;\n+\n+\t@Unique\n+\tprivate final ThreadLocal<ScreenHandler> fabric_openedScreenHandler = new ThreadLocal<>();\n+\n+\t@Inject(method = \"openHandledScreen(Lnet/minecraft/screen/NamedScreenHandlerFactory;)Ljava/util/OptionalInt;\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/server/network/ServerPlayNetworkHandler;sendPacket(Lnet/minecraft/network/Packet;)V\"), locals = LocalCapture.CAPTURE_FAILHARD)\n+\tprivate void fabric_onOpenHandledScreen_cacheScreenHandler(NamedScreenHandlerFactory factory, CallbackInfoReturnable<OptionalInt> info, ScreenHandler handler) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDg0MjI2Mg=="}, "originalCommit": {"oid": "0e077dc5d2fa67d1c79811ba2ee42c7e09e0f868"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDg0NDY2Nw==", "bodyText": "There's no API convention, though. Fabric uses all of those different styles that i5 listed in #510.", "url": "https://github.com/FabricMC/fabric/pull/584#discussion_r410844667", "createdAt": "2020-04-19T07:54:29Z", "author": {"login": "Juuxel"}, "path": "fabric-screen-handler-api-v1/src/main/java/net/fabricmc/fabric/mixin/screenhandler/ServerPlayerEntityMixin.java", "diffHunk": "@@ -0,0 +1,80 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.mixin.screenhandler;\n+\n+import java.util.OptionalInt;\n+\n+import org.spongepowered.asm.mixin.Mixin;\n+import org.spongepowered.asm.mixin.Shadow;\n+import org.spongepowered.asm.mixin.Unique;\n+import org.spongepowered.asm.mixin.injection.At;\n+import org.spongepowered.asm.mixin.injection.Inject;\n+import org.spongepowered.asm.mixin.injection.Redirect;\n+import org.spongepowered.asm.mixin.injection.callback.CallbackInfoReturnable;\n+import org.spongepowered.asm.mixin.injection.callback.LocalCapture;\n+\n+import net.minecraft.network.Packet;\n+import net.minecraft.screen.NamedScreenHandlerFactory;\n+import net.minecraft.screen.ScreenHandler;\n+import net.minecraft.server.network.ServerPlayerEntity;\n+import net.minecraft.server.network.ServerPlayNetworkHandler;\n+import net.minecraft.util.Identifier;\n+import net.minecraft.util.registry.Registry;\n+\n+import net.fabricmc.fabric.api.screenhandler.v1.ExtendedScreenHandlerFactory;\n+import net.fabricmc.fabric.impl.screenhandler.ExtendedScreenHandlerType;\n+import net.fabricmc.fabric.impl.screenhandler.ScreenHandlersImpl;\n+\n+@Mixin(ServerPlayerEntity.class)\n+public class ServerPlayerEntityMixin {\n+\t@Shadow\n+\tprivate int screenHandlerSyncId;\n+\n+\t@Unique\n+\tprivate final ThreadLocal<ScreenHandler> fabric_openedScreenHandler = new ThreadLocal<>();\n+\n+\t@Inject(method = \"openHandledScreen(Lnet/minecraft/screen/NamedScreenHandlerFactory;)Ljava/util/OptionalInt;\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/server/network/ServerPlayNetworkHandler;sendPacket(Lnet/minecraft/network/Packet;)V\"), locals = LocalCapture.CAPTURE_FAILHARD)\n+\tprivate void fabric_onOpenHandledScreen_cacheScreenHandler(NamedScreenHandlerFactory factory, CallbackInfoReturnable<OptionalInt> info, ScreenHandler handler) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDg0MjI2Mg=="}, "originalCommit": {"oid": "0e077dc5d2fa67d1c79811ba2ee42c7e09e0f868"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDg0NDg3Mg==", "bodyText": "oh god, really? I could have sworn there was one already", "url": "https://github.com/FabricMC/fabric/pull/584#discussion_r410844872", "createdAt": "2020-04-19T07:55:43Z", "author": {"login": "LemmaEOF"}, "path": "fabric-screen-handler-api-v1/src/main/java/net/fabricmc/fabric/mixin/screenhandler/ServerPlayerEntityMixin.java", "diffHunk": "@@ -0,0 +1,80 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.mixin.screenhandler;\n+\n+import java.util.OptionalInt;\n+\n+import org.spongepowered.asm.mixin.Mixin;\n+import org.spongepowered.asm.mixin.Shadow;\n+import org.spongepowered.asm.mixin.Unique;\n+import org.spongepowered.asm.mixin.injection.At;\n+import org.spongepowered.asm.mixin.injection.Inject;\n+import org.spongepowered.asm.mixin.injection.Redirect;\n+import org.spongepowered.asm.mixin.injection.callback.CallbackInfoReturnable;\n+import org.spongepowered.asm.mixin.injection.callback.LocalCapture;\n+\n+import net.minecraft.network.Packet;\n+import net.minecraft.screen.NamedScreenHandlerFactory;\n+import net.minecraft.screen.ScreenHandler;\n+import net.minecraft.server.network.ServerPlayerEntity;\n+import net.minecraft.server.network.ServerPlayNetworkHandler;\n+import net.minecraft.util.Identifier;\n+import net.minecraft.util.registry.Registry;\n+\n+import net.fabricmc.fabric.api.screenhandler.v1.ExtendedScreenHandlerFactory;\n+import net.fabricmc.fabric.impl.screenhandler.ExtendedScreenHandlerType;\n+import net.fabricmc.fabric.impl.screenhandler.ScreenHandlersImpl;\n+\n+@Mixin(ServerPlayerEntity.class)\n+public class ServerPlayerEntityMixin {\n+\t@Shadow\n+\tprivate int screenHandlerSyncId;\n+\n+\t@Unique\n+\tprivate final ThreadLocal<ScreenHandler> fabric_openedScreenHandler = new ThreadLocal<>();\n+\n+\t@Inject(method = \"openHandledScreen(Lnet/minecraft/screen/NamedScreenHandlerFactory;)Ljava/util/OptionalInt;\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/server/network/ServerPlayNetworkHandler;sendPacket(Lnet/minecraft/network/Packet;)V\"), locals = LocalCapture.CAPTURE_FAILHARD)\n+\tprivate void fabric_onOpenHandledScreen_cacheScreenHandler(NamedScreenHandlerFactory factory, CallbackInfoReturnable<OptionalInt> info, ScreenHandler handler) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDg0MjI2Mg=="}, "originalCommit": {"oid": "0e077dc5d2fa67d1c79811ba2ee42c7e09e0f868"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDg0ODQwNA==", "bodyText": "I searched through some mixins and 99% of them have no prefix, the example in i5's issue for fabric_ is not an inject, most other fabric_ are overrides, the current majority is no prefix.\nI am not saying that no prefix is the best style but mostly injects in fabric API have no prefixes right now, and we should stick to the masses until we have a PR to change this.", "url": "https://github.com/FabricMC/fabric/pull/584#discussion_r410848404", "createdAt": "2020-04-19T08:15:23Z", "author": {"login": "shedaniel"}, "path": "fabric-screen-handler-api-v1/src/main/java/net/fabricmc/fabric/mixin/screenhandler/ServerPlayerEntityMixin.java", "diffHunk": "@@ -0,0 +1,80 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.mixin.screenhandler;\n+\n+import java.util.OptionalInt;\n+\n+import org.spongepowered.asm.mixin.Mixin;\n+import org.spongepowered.asm.mixin.Shadow;\n+import org.spongepowered.asm.mixin.Unique;\n+import org.spongepowered.asm.mixin.injection.At;\n+import org.spongepowered.asm.mixin.injection.Inject;\n+import org.spongepowered.asm.mixin.injection.Redirect;\n+import org.spongepowered.asm.mixin.injection.callback.CallbackInfoReturnable;\n+import org.spongepowered.asm.mixin.injection.callback.LocalCapture;\n+\n+import net.minecraft.network.Packet;\n+import net.minecraft.screen.NamedScreenHandlerFactory;\n+import net.minecraft.screen.ScreenHandler;\n+import net.minecraft.server.network.ServerPlayerEntity;\n+import net.minecraft.server.network.ServerPlayNetworkHandler;\n+import net.minecraft.util.Identifier;\n+import net.minecraft.util.registry.Registry;\n+\n+import net.fabricmc.fabric.api.screenhandler.v1.ExtendedScreenHandlerFactory;\n+import net.fabricmc.fabric.impl.screenhandler.ExtendedScreenHandlerType;\n+import net.fabricmc.fabric.impl.screenhandler.ScreenHandlersImpl;\n+\n+@Mixin(ServerPlayerEntity.class)\n+public class ServerPlayerEntityMixin {\n+\t@Shadow\n+\tprivate int screenHandlerSyncId;\n+\n+\t@Unique\n+\tprivate final ThreadLocal<ScreenHandler> fabric_openedScreenHandler = new ThreadLocal<>();\n+\n+\t@Inject(method = \"openHandledScreen(Lnet/minecraft/screen/NamedScreenHandlerFactory;)Ljava/util/OptionalInt;\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/server/network/ServerPlayNetworkHandler;sendPacket(Lnet/minecraft/network/Packet;)V\"), locals = LocalCapture.CAPTURE_FAILHARD)\n+\tprivate void fabric_onOpenHandledScreen_cacheScreenHandler(NamedScreenHandlerFactory factory, CallbackInfoReturnable<OptionalInt> info, ScreenHandler handler) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDg0MjI2Mg=="}, "originalCommit": {"oid": "0e077dc5d2fa67d1c79811ba2ee42c7e09e0f868"}, "originalPosition": 51}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU1MTY0MDk1OnYy", "diffSide": "RIGHT", "path": "fabric-screen-handler-api-v1/src/main/resources/fabric.mod.json", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOVQwNzo0MjozMlrOGHz1PA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOVQwNzo0Mzo0OFrOGHz2SA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDg0MjQyOA==", "bodyText": "Since I see the fabric-networking-v0 in the build.gradle, care putting it here as well", "url": "https://github.com/FabricMC/fabric/pull/584#discussion_r410842428", "createdAt": "2020-04-19T07:42:32Z", "author": {"login": "shedaniel"}, "path": "fabric-screen-handler-api-v1/src/main/resources/fabric.mod.json", "diffHunk": "@@ -0,0 +1,30 @@\n+{\n+  \"schemaVersion\": 1,\n+  \"id\": \"fabric-screen-handler-api-v1\",\n+  \"name\": \"Fabric Screen Handler API (v1)\",\n+  \"version\": \"${version}\",\n+  \"environment\": \"*\",\n+  \"license\": \"Apache-2.0\",\n+  \"icon\": \"assets/fabric-screen-handler-api-v1/icon.png\",\n+  \"contact\": {\n+    \"homepage\": \"https://fabricmc.net\",\n+    \"irc\": \"irc://irc.esper.net:6667/fabric\",\n+    \"issues\": \"https://github.com/FabricMC/fabric/issues\",\n+    \"sources\": \"https://github.com/FabricMC/fabric\"\n+  },\n+  \"authors\": [\n+    \"FabricMC\"\n+  ],\n+  \"depends\": {\n+    \"fabricloader\": \">=0.8.0\",\n+    \"fabric-api-base\": \"*\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e077dc5d2fa67d1c79811ba2ee42c7e09e0f868"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDg0MjY5Ng==", "bodyText": "Done.", "url": "https://github.com/FabricMC/fabric/pull/584#discussion_r410842696", "createdAt": "2020-04-19T07:43:48Z", "author": {"login": "Juuxel"}, "path": "fabric-screen-handler-api-v1/src/main/resources/fabric.mod.json", "diffHunk": "@@ -0,0 +1,30 @@\n+{\n+  \"schemaVersion\": 1,\n+  \"id\": \"fabric-screen-handler-api-v1\",\n+  \"name\": \"Fabric Screen Handler API (v1)\",\n+  \"version\": \"${version}\",\n+  \"environment\": \"*\",\n+  \"license\": \"Apache-2.0\",\n+  \"icon\": \"assets/fabric-screen-handler-api-v1/icon.png\",\n+  \"contact\": {\n+    \"homepage\": \"https://fabricmc.net\",\n+    \"irc\": \"irc://irc.esper.net:6667/fabric\",\n+    \"issues\": \"https://github.com/FabricMC/fabric/issues\",\n+    \"sources\": \"https://github.com/FabricMC/fabric\"\n+  },\n+  \"authors\": [\n+    \"FabricMC\"\n+  ],\n+  \"depends\": {\n+    \"fabricloader\": \">=0.8.0\",\n+    \"fabric-api-base\": \"*\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDg0MjQyOA=="}, "originalCommit": {"oid": "0e077dc5d2fa67d1c79811ba2ee42c7e09e0f868"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU1MzAwMjU5OnYy", "diffSide": "RIGHT", "path": "fabric-screen-handler-api-v1/src/main/java/net/fabricmc/fabric/mixin/screenhandler/ServerPlayerEntityMixin.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOVQyMTo0OTo1OFrOGH9ZnA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOVQyMTo1MDoxMVrOGH9Zwg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDk5OTE5Ng==", "bodyText": "Whats the use of a ThreadLocal?", "url": "https://github.com/FabricMC/fabric/pull/584#discussion_r410999196", "createdAt": "2020-04-19T21:49:58Z", "author": {"login": "modmuss50"}, "path": "fabric-screen-handler-api-v1/src/main/java/net/fabricmc/fabric/mixin/screenhandler/ServerPlayerEntityMixin.java", "diffHunk": "@@ -0,0 +1,81 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.mixin.screenhandler;\n+\n+import java.util.OptionalInt;\n+\n+import org.spongepowered.asm.mixin.Mixin;\n+import org.spongepowered.asm.mixin.Shadow;\n+import org.spongepowered.asm.mixin.Unique;\n+import org.spongepowered.asm.mixin.injection.At;\n+import org.spongepowered.asm.mixin.injection.Inject;\n+import org.spongepowered.asm.mixin.injection.Redirect;\n+import org.spongepowered.asm.mixin.injection.callback.CallbackInfoReturnable;\n+import org.spongepowered.asm.mixin.injection.callback.LocalCapture;\n+\n+import net.minecraft.network.Packet;\n+import net.minecraft.screen.NamedScreenHandlerFactory;\n+import net.minecraft.screen.ScreenHandler;\n+import net.minecraft.server.network.ServerPlayerEntity;\n+import net.minecraft.server.network.ServerPlayNetworkHandler;\n+import net.minecraft.util.Identifier;\n+import net.minecraft.util.registry.Registry;\n+\n+import net.fabricmc.fabric.api.screenhandler.v1.ExtendedScreenHandlerFactory;\n+import net.fabricmc.fabric.impl.screenhandler.ExtendedScreenHandlerType;\n+import net.fabricmc.fabric.impl.screenhandler.Networking;\n+\n+@Mixin(ServerPlayerEntity.class)\n+public class ServerPlayerEntityMixin {\n+\t@Shadow\n+\tprivate int screenHandlerSyncId;\n+\n+\t@Unique\n+\tprivate final ThreadLocal<ScreenHandler> fabric_openedScreenHandler = new ThreadLocal<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c1797230c283779d1e32026db471645443fd39e"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDk5OTIzNA==", "bodyText": "Edit: Oh I see.", "url": "https://github.com/FabricMC/fabric/pull/584#discussion_r410999234", "createdAt": "2020-04-19T21:50:11Z", "author": {"login": "modmuss50"}, "path": "fabric-screen-handler-api-v1/src/main/java/net/fabricmc/fabric/mixin/screenhandler/ServerPlayerEntityMixin.java", "diffHunk": "@@ -0,0 +1,81 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.mixin.screenhandler;\n+\n+import java.util.OptionalInt;\n+\n+import org.spongepowered.asm.mixin.Mixin;\n+import org.spongepowered.asm.mixin.Shadow;\n+import org.spongepowered.asm.mixin.Unique;\n+import org.spongepowered.asm.mixin.injection.At;\n+import org.spongepowered.asm.mixin.injection.Inject;\n+import org.spongepowered.asm.mixin.injection.Redirect;\n+import org.spongepowered.asm.mixin.injection.callback.CallbackInfoReturnable;\n+import org.spongepowered.asm.mixin.injection.callback.LocalCapture;\n+\n+import net.minecraft.network.Packet;\n+import net.minecraft.screen.NamedScreenHandlerFactory;\n+import net.minecraft.screen.ScreenHandler;\n+import net.minecraft.server.network.ServerPlayerEntity;\n+import net.minecraft.server.network.ServerPlayNetworkHandler;\n+import net.minecraft.util.Identifier;\n+import net.minecraft.util.registry.Registry;\n+\n+import net.fabricmc.fabric.api.screenhandler.v1.ExtendedScreenHandlerFactory;\n+import net.fabricmc.fabric.impl.screenhandler.ExtendedScreenHandlerType;\n+import net.fabricmc.fabric.impl.screenhandler.Networking;\n+\n+@Mixin(ServerPlayerEntity.class)\n+public class ServerPlayerEntityMixin {\n+\t@Shadow\n+\tprivate int screenHandlerSyncId;\n+\n+\t@Unique\n+\tprivate final ThreadLocal<ScreenHandler> fabric_openedScreenHandler = new ThreadLocal<>();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDk5OTE5Ng=="}, "originalCommit": {"oid": "8c1797230c283779d1e32026db471645443fd39e"}, "originalPosition": 48}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU1MzAwNTA0OnYy", "diffSide": "RIGHT", "path": "fabric-screen-handler-api-v1/src/main/java/net/fabricmc/fabric/mixin/screenhandler/ServerPlayerEntityMixin.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOVQyMTo1MToyMlrOGH9auQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQwNDozMDo0MlrOGICq6g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDk5OTQ4MQ==", "bodyText": "Would it be a good idea to set fabric_openedScreenHandler value to null here? Save it hanging around?", "url": "https://github.com/FabricMC/fabric/pull/584#discussion_r410999481", "createdAt": "2020-04-19T21:51:22Z", "author": {"login": "modmuss50"}, "path": "fabric-screen-handler-api-v1/src/main/java/net/fabricmc/fabric/mixin/screenhandler/ServerPlayerEntityMixin.java", "diffHunk": "@@ -0,0 +1,81 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.mixin.screenhandler;\n+\n+import java.util.OptionalInt;\n+\n+import org.spongepowered.asm.mixin.Mixin;\n+import org.spongepowered.asm.mixin.Shadow;\n+import org.spongepowered.asm.mixin.Unique;\n+import org.spongepowered.asm.mixin.injection.At;\n+import org.spongepowered.asm.mixin.injection.Inject;\n+import org.spongepowered.asm.mixin.injection.Redirect;\n+import org.spongepowered.asm.mixin.injection.callback.CallbackInfoReturnable;\n+import org.spongepowered.asm.mixin.injection.callback.LocalCapture;\n+\n+import net.minecraft.network.Packet;\n+import net.minecraft.screen.NamedScreenHandlerFactory;\n+import net.minecraft.screen.ScreenHandler;\n+import net.minecraft.server.network.ServerPlayerEntity;\n+import net.minecraft.server.network.ServerPlayNetworkHandler;\n+import net.minecraft.util.Identifier;\n+import net.minecraft.util.registry.Registry;\n+\n+import net.fabricmc.fabric.api.screenhandler.v1.ExtendedScreenHandlerFactory;\n+import net.fabricmc.fabric.impl.screenhandler.ExtendedScreenHandlerType;\n+import net.fabricmc.fabric.impl.screenhandler.Networking;\n+\n+@Mixin(ServerPlayerEntity.class)\n+public class ServerPlayerEntityMixin {\n+\t@Shadow\n+\tprivate int screenHandlerSyncId;\n+\n+\t@Unique\n+\tprivate final ThreadLocal<ScreenHandler> fabric_openedScreenHandler = new ThreadLocal<>();\n+\n+\t@Inject(method = \"openHandledScreen(Lnet/minecraft/screen/NamedScreenHandlerFactory;)Ljava/util/OptionalInt;\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/server/network/ServerPlayNetworkHandler;sendPacket(Lnet/minecraft/network/Packet;)V\"), locals = LocalCapture.CAPTURE_FAILHARD)\n+\tprivate void fabric_storeOpenedScreenHandler(NamedScreenHandlerFactory factory, CallbackInfoReturnable<OptionalInt> info, ScreenHandler handler) {\n+\t\tif (factory instanceof ExtendedScreenHandlerFactory) {\n+\t\t\tfabric_openedScreenHandler.set(handler);\n+\t\t} else if (handler.getType() instanceof ExtendedScreenHandlerType<?>) {\n+\t\t\tIdentifier id = Registry.SCREEN_HANDLER.getId(handler.getType());\n+\t\t\tthrow new IllegalArgumentException(\"[Fabric] Extended screen handler \" + id + \" must be opened with an ExtendedScreenHandlerFactory!\");\n+\t\t}\n+\t}\n+\n+\t@Redirect(method = \"openHandledScreen(Lnet/minecraft/screen/NamedScreenHandlerFactory;)Ljava/util/OptionalInt;\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/server/network/ServerPlayNetworkHandler;sendPacket(Lnet/minecraft/network/Packet;)V\"))\n+\tprivate void fabric_replaceVanillaScreenPacket(ServerPlayNetworkHandler networkHandler, Packet<?> packet, NamedScreenHandlerFactory factory) {\n+\t\tif (factory instanceof ExtendedScreenHandlerFactory) {\n+\t\t\tScreenHandler handler = fabric_openedScreenHandler.get();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c1797230c283779d1e32026db471645443fd39e"}, "originalPosition": 63}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTA4NTU0Ng==", "bodyText": "It's cleared at RETURN, but I think I can move it there.", "url": "https://github.com/FabricMC/fabric/pull/584#discussion_r411085546", "createdAt": "2020-04-20T04:30:42Z", "author": {"login": "Juuxel"}, "path": "fabric-screen-handler-api-v1/src/main/java/net/fabricmc/fabric/mixin/screenhandler/ServerPlayerEntityMixin.java", "diffHunk": "@@ -0,0 +1,81 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.mixin.screenhandler;\n+\n+import java.util.OptionalInt;\n+\n+import org.spongepowered.asm.mixin.Mixin;\n+import org.spongepowered.asm.mixin.Shadow;\n+import org.spongepowered.asm.mixin.Unique;\n+import org.spongepowered.asm.mixin.injection.At;\n+import org.spongepowered.asm.mixin.injection.Inject;\n+import org.spongepowered.asm.mixin.injection.Redirect;\n+import org.spongepowered.asm.mixin.injection.callback.CallbackInfoReturnable;\n+import org.spongepowered.asm.mixin.injection.callback.LocalCapture;\n+\n+import net.minecraft.network.Packet;\n+import net.minecraft.screen.NamedScreenHandlerFactory;\n+import net.minecraft.screen.ScreenHandler;\n+import net.minecraft.server.network.ServerPlayerEntity;\n+import net.minecraft.server.network.ServerPlayNetworkHandler;\n+import net.minecraft.util.Identifier;\n+import net.minecraft.util.registry.Registry;\n+\n+import net.fabricmc.fabric.api.screenhandler.v1.ExtendedScreenHandlerFactory;\n+import net.fabricmc.fabric.impl.screenhandler.ExtendedScreenHandlerType;\n+import net.fabricmc.fabric.impl.screenhandler.Networking;\n+\n+@Mixin(ServerPlayerEntity.class)\n+public class ServerPlayerEntityMixin {\n+\t@Shadow\n+\tprivate int screenHandlerSyncId;\n+\n+\t@Unique\n+\tprivate final ThreadLocal<ScreenHandler> fabric_openedScreenHandler = new ThreadLocal<>();\n+\n+\t@Inject(method = \"openHandledScreen(Lnet/minecraft/screen/NamedScreenHandlerFactory;)Ljava/util/OptionalInt;\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/server/network/ServerPlayNetworkHandler;sendPacket(Lnet/minecraft/network/Packet;)V\"), locals = LocalCapture.CAPTURE_FAILHARD)\n+\tprivate void fabric_storeOpenedScreenHandler(NamedScreenHandlerFactory factory, CallbackInfoReturnable<OptionalInt> info, ScreenHandler handler) {\n+\t\tif (factory instanceof ExtendedScreenHandlerFactory) {\n+\t\t\tfabric_openedScreenHandler.set(handler);\n+\t\t} else if (handler.getType() instanceof ExtendedScreenHandlerType<?>) {\n+\t\t\tIdentifier id = Registry.SCREEN_HANDLER.getId(handler.getType());\n+\t\t\tthrow new IllegalArgumentException(\"[Fabric] Extended screen handler \" + id + \" must be opened with an ExtendedScreenHandlerFactory!\");\n+\t\t}\n+\t}\n+\n+\t@Redirect(method = \"openHandledScreen(Lnet/minecraft/screen/NamedScreenHandlerFactory;)Ljava/util/OptionalInt;\", at = @At(value = \"INVOKE\", target = \"Lnet/minecraft/server/network/ServerPlayNetworkHandler;sendPacket(Lnet/minecraft/network/Packet;)V\"))\n+\tprivate void fabric_replaceVanillaScreenPacket(ServerPlayNetworkHandler networkHandler, Packet<?> packet, NamedScreenHandlerFactory factory) {\n+\t\tif (factory instanceof ExtendedScreenHandlerFactory) {\n+\t\t\tScreenHandler handler = fabric_openedScreenHandler.get();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDk5OTQ4MQ=="}, "originalCommit": {"oid": "8c1797230c283779d1e32026db471645443fd39e"}, "originalPosition": 63}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU2NTgwMzgwOnYy", "diffSide": "RIGHT", "path": "fabric-screen-handler-api-v1/src/main/java/net/fabricmc/fabric/api/screenhandler/v1/ExtendedScreenHandlerFactory.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxMDo1NzoxN1rOGJwR8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxMDo1NzoxN1rOGJwR8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjg4MTM5Mg==", "bodyText": "Since the comment says \"screen opening data\", maybe rename to writeScreenOpeningData", "url": "https://github.com/FabricMC/fabric/pull/584#discussion_r412881392", "createdAt": "2020-04-22T10:57:17Z", "author": {"login": "immibis"}, "path": "fabric-screen-handler-api-v1/src/main/java/net/fabricmc/fabric/api/screenhandler/v1/ExtendedScreenHandlerFactory.java", "diffHunk": "@@ -0,0 +1,68 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.api.screenhandler.v1;\n+\n+import java.util.function.Consumer;\n+\n+import net.minecraft.entity.player.PlayerEntity;\n+import net.minecraft.entity.player.PlayerInventory;\n+import net.minecraft.network.PacketByteBuf;\n+import net.minecraft.screen.NamedScreenHandlerFactory;\n+import net.minecraft.screen.ScreenHandler;\n+import net.minecraft.text.Text;\n+\n+/**\n+ * An extension of {@code NamedScreenHandlerFactory} that can write additional\n+ * networking data to a screen opening packet.\n+ *\n+ * @see ScreenHandlers#extended(ScreenHandlers.ExtendedFactory)\n+ */\n+public interface ExtendedScreenHandlerFactory extends NamedScreenHandlerFactory {\n+\t/**\n+\t * Writes additional server -> client screen opening data to the buffer.\n+\t */\n+\tvoid writeScreenData(PacketByteBuf buf);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c1797230c283779d1e32026db471645443fd39e"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU2NTgxMjIyOnYy", "diffSide": "RIGHT", "path": "fabric-screen-handler-api-v1/src/main/java/net/fabricmc/fabric/api/screenhandler/v1/ExtendedScreenHandlerFactory.java", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxMDo1OToyMlrOGJwW_A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxNTozMzowOVrOGJ82-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjg4MjY4NA==", "bodyText": "What is the use case for this function?", "url": "https://github.com/FabricMC/fabric/pull/584#discussion_r412882684", "createdAt": "2020-04-22T10:59:22Z", "author": {"login": "immibis"}, "path": "fabric-screen-handler-api-v1/src/main/java/net/fabricmc/fabric/api/screenhandler/v1/ExtendedScreenHandlerFactory.java", "diffHunk": "@@ -0,0 +1,68 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.api.screenhandler.v1;\n+\n+import java.util.function.Consumer;\n+\n+import net.minecraft.entity.player.PlayerEntity;\n+import net.minecraft.entity.player.PlayerInventory;\n+import net.minecraft.network.PacketByteBuf;\n+import net.minecraft.screen.NamedScreenHandlerFactory;\n+import net.minecraft.screen.ScreenHandler;\n+import net.minecraft.text.Text;\n+\n+/**\n+ * An extension of {@code NamedScreenHandlerFactory} that can write additional\n+ * networking data to a screen opening packet.\n+ *\n+ * @see ScreenHandlers#extended(ScreenHandlers.ExtendedFactory)\n+ */\n+public interface ExtendedScreenHandlerFactory extends NamedScreenHandlerFactory {\n+\t/**\n+\t * Writes additional server -> client screen opening data to the buffer.\n+\t */\n+\tvoid writeScreenData(PacketByteBuf buf);\n+\n+\t/**\n+\t * Creates a networked screen handler factory from a base factory and a packet writer.\n+\t *\n+\t * <p>All {@link NamedScreenHandlerFactory} operations are delegated to the base factory,\n+\t * and {@link #writeScreenData(PacketByteBuf)} is delegated to the writer.\n+\t *\n+\t * @param factory      the base factory\n+\t * @param packetWriter the packet writer\n+\t * @return the created factory\n+\t */\n+\tstatic ExtendedScreenHandlerFactory of(NamedScreenHandlerFactory factory, Consumer<PacketByteBuf> packetWriter) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8c1797230c283779d1e32026db471645443fd39e"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjg5MzAyNg==", "bodyText": "If you already have a NamedScreenHandlerFactory from vanilla, you can add the extra screen opening data with a lambda. Tbh, I didn't find any use cases for this in the example mod, so I might just remove it.", "url": "https://github.com/FabricMC/fabric/pull/584#discussion_r412893026", "createdAt": "2020-04-22T11:17:00Z", "author": {"login": "Juuxel"}, "path": "fabric-screen-handler-api-v1/src/main/java/net/fabricmc/fabric/api/screenhandler/v1/ExtendedScreenHandlerFactory.java", "diffHunk": "@@ -0,0 +1,68 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.api.screenhandler.v1;\n+\n+import java.util.function.Consumer;\n+\n+import net.minecraft.entity.player.PlayerEntity;\n+import net.minecraft.entity.player.PlayerInventory;\n+import net.minecraft.network.PacketByteBuf;\n+import net.minecraft.screen.NamedScreenHandlerFactory;\n+import net.minecraft.screen.ScreenHandler;\n+import net.minecraft.text.Text;\n+\n+/**\n+ * An extension of {@code NamedScreenHandlerFactory} that can write additional\n+ * networking data to a screen opening packet.\n+ *\n+ * @see ScreenHandlers#extended(ScreenHandlers.ExtendedFactory)\n+ */\n+public interface ExtendedScreenHandlerFactory extends NamedScreenHandlerFactory {\n+\t/**\n+\t * Writes additional server -> client screen opening data to the buffer.\n+\t */\n+\tvoid writeScreenData(PacketByteBuf buf);\n+\n+\t/**\n+\t * Creates a networked screen handler factory from a base factory and a packet writer.\n+\t *\n+\t * <p>All {@link NamedScreenHandlerFactory} operations are delegated to the base factory,\n+\t * and {@link #writeScreenData(PacketByteBuf)} is delegated to the writer.\n+\t *\n+\t * @param factory      the base factory\n+\t * @param packetWriter the packet writer\n+\t * @return the created factory\n+\t */\n+\tstatic ExtendedScreenHandlerFactory of(NamedScreenHandlerFactory factory, Consumer<PacketByteBuf> packetWriter) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjg4MjY4NA=="}, "originalCommit": {"oid": "8c1797230c283779d1e32026db471645443fd39e"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzA3ODQxNg==", "bodyText": "Can you think of any case where you might have a NamedScreenHandlerFactory from vanilla but also screen opening data? It seems like you'd write an ExtendedScreenHandlerFactory in that case because the vanilla NSHF is going to be completely useless for your custom screen, because it's going to open a vanilla screen.", "url": "https://github.com/FabricMC/fabric/pull/584#discussion_r413078416", "createdAt": "2020-04-22T15:22:23Z", "author": {"login": "immibis"}, "path": "fabric-screen-handler-api-v1/src/main/java/net/fabricmc/fabric/api/screenhandler/v1/ExtendedScreenHandlerFactory.java", "diffHunk": "@@ -0,0 +1,68 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.api.screenhandler.v1;\n+\n+import java.util.function.Consumer;\n+\n+import net.minecraft.entity.player.PlayerEntity;\n+import net.minecraft.entity.player.PlayerInventory;\n+import net.minecraft.network.PacketByteBuf;\n+import net.minecraft.screen.NamedScreenHandlerFactory;\n+import net.minecraft.screen.ScreenHandler;\n+import net.minecraft.text.Text;\n+\n+/**\n+ * An extension of {@code NamedScreenHandlerFactory} that can write additional\n+ * networking data to a screen opening packet.\n+ *\n+ * @see ScreenHandlers#extended(ScreenHandlers.ExtendedFactory)\n+ */\n+public interface ExtendedScreenHandlerFactory extends NamedScreenHandlerFactory {\n+\t/**\n+\t * Writes additional server -> client screen opening data to the buffer.\n+\t */\n+\tvoid writeScreenData(PacketByteBuf buf);\n+\n+\t/**\n+\t * Creates a networked screen handler factory from a base factory and a packet writer.\n+\t *\n+\t * <p>All {@link NamedScreenHandlerFactory} operations are delegated to the base factory,\n+\t * and {@link #writeScreenData(PacketByteBuf)} is delegated to the writer.\n+\t *\n+\t * @param factory      the base factory\n+\t * @param packetWriter the packet writer\n+\t * @return the created factory\n+\t */\n+\tstatic ExtendedScreenHandlerFactory of(NamedScreenHandlerFactory factory, Consumer<PacketByteBuf> packetWriter) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjg4MjY4NA=="}, "originalCommit": {"oid": "8c1797230c283779d1e32026db471645443fd39e"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzA4MTgwNw==", "bodyText": "Mostly when a vanilla named screen handler is used the data needed by the screen is already on client's block entity or so", "url": "https://github.com/FabricMC/fabric/pull/584#discussion_r413081807", "createdAt": "2020-04-22T15:26:28Z", "author": {"login": "liach"}, "path": "fabric-screen-handler-api-v1/src/main/java/net/fabricmc/fabric/api/screenhandler/v1/ExtendedScreenHandlerFactory.java", "diffHunk": "@@ -0,0 +1,68 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.api.screenhandler.v1;\n+\n+import java.util.function.Consumer;\n+\n+import net.minecraft.entity.player.PlayerEntity;\n+import net.minecraft.entity.player.PlayerInventory;\n+import net.minecraft.network.PacketByteBuf;\n+import net.minecraft.screen.NamedScreenHandlerFactory;\n+import net.minecraft.screen.ScreenHandler;\n+import net.minecraft.text.Text;\n+\n+/**\n+ * An extension of {@code NamedScreenHandlerFactory} that can write additional\n+ * networking data to a screen opening packet.\n+ *\n+ * @see ScreenHandlers#extended(ScreenHandlers.ExtendedFactory)\n+ */\n+public interface ExtendedScreenHandlerFactory extends NamedScreenHandlerFactory {\n+\t/**\n+\t * Writes additional server -> client screen opening data to the buffer.\n+\t */\n+\tvoid writeScreenData(PacketByteBuf buf);\n+\n+\t/**\n+\t * Creates a networked screen handler factory from a base factory and a packet writer.\n+\t *\n+\t * <p>All {@link NamedScreenHandlerFactory} operations are delegated to the base factory,\n+\t * and {@link #writeScreenData(PacketByteBuf)} is delegated to the writer.\n+\t *\n+\t * @param factory      the base factory\n+\t * @param packetWriter the packet writer\n+\t * @return the created factory\n+\t */\n+\tstatic ExtendedScreenHandlerFactory of(NamedScreenHandlerFactory factory, Consumer<PacketByteBuf> packetWriter) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjg4MjY4NA=="}, "originalCommit": {"oid": "8c1797230c283779d1e32026db471645443fd39e"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzA4NzQ4MQ==", "bodyText": "I already removed it in the FabLabs repo. I'll just have to port all the changes here.", "url": "https://github.com/FabricMC/fabric/pull/584#discussion_r413087481", "createdAt": "2020-04-22T15:33:09Z", "author": {"login": "Juuxel"}, "path": "fabric-screen-handler-api-v1/src/main/java/net/fabricmc/fabric/api/screenhandler/v1/ExtendedScreenHandlerFactory.java", "diffHunk": "@@ -0,0 +1,68 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package net.fabricmc.fabric.api.screenhandler.v1;\n+\n+import java.util.function.Consumer;\n+\n+import net.minecraft.entity.player.PlayerEntity;\n+import net.minecraft.entity.player.PlayerInventory;\n+import net.minecraft.network.PacketByteBuf;\n+import net.minecraft.screen.NamedScreenHandlerFactory;\n+import net.minecraft.screen.ScreenHandler;\n+import net.minecraft.text.Text;\n+\n+/**\n+ * An extension of {@code NamedScreenHandlerFactory} that can write additional\n+ * networking data to a screen opening packet.\n+ *\n+ * @see ScreenHandlers#extended(ScreenHandlers.ExtendedFactory)\n+ */\n+public interface ExtendedScreenHandlerFactory extends NamedScreenHandlerFactory {\n+\t/**\n+\t * Writes additional server -> client screen opening data to the buffer.\n+\t */\n+\tvoid writeScreenData(PacketByteBuf buf);\n+\n+\t/**\n+\t * Creates a networked screen handler factory from a base factory and a packet writer.\n+\t *\n+\t * <p>All {@link NamedScreenHandlerFactory} operations are delegated to the base factory,\n+\t * and {@link #writeScreenData(PacketByteBuf)} is delegated to the writer.\n+\t *\n+\t * @param factory      the base factory\n+\t * @param packetWriter the packet writer\n+\t * @return the created factory\n+\t */\n+\tstatic ExtendedScreenHandlerFactory of(NamedScreenHandlerFactory factory, Consumer<PacketByteBuf> packetWriter) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjg4MjY4NA=="}, "originalCommit": {"oid": "8c1797230c283779d1e32026db471645443fd39e"}, "originalPosition": 50}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3NzY3NzcwOnYy", "diffSide": "RIGHT", "path": "fabric-screen-handler-api-v1/src/main/java/net/fabricmc/fabric/api/client/screenhandler/v1/package-info.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxMjowNjo1NlrOGZ_BMQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxMzoyODoxN1rOGaBJTw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTkwMDA4MQ==", "bodyText": "Are these needed? I dont think we have them anywhere else in api?", "url": "https://github.com/FabricMC/fabric/pull/584#discussion_r429900081", "createdAt": "2020-05-25T12:06:56Z", "author": {"login": "modmuss50"}, "path": "fabric-screen-handler-api-v1/src/main/java/net/fabricmc/fabric/api/client/screenhandler/v1/package-info.java", "diffHunk": "@@ -0,0 +1,20 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+/**\n+ * API for working with screen handlers on the client.\n+ */\n+package net.fabricmc.fabric.api.client.screenhandler.v1;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9ceae812d00411f69fbc9e2c5f648d54c8877254"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTkzNDIxNw==", "bodyText": "They make the javadoc nicer to browse since you can see a description of the package in addition to the name.", "url": "https://github.com/FabricMC/fabric/pull/584#discussion_r429934217", "createdAt": "2020-05-25T13:26:45Z", "author": {"login": "Juuxel"}, "path": "fabric-screen-handler-api-v1/src/main/java/net/fabricmc/fabric/api/client/screenhandler/v1/package-info.java", "diffHunk": "@@ -0,0 +1,20 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+/**\n+ * API for working with screen handlers on the client.\n+ */\n+package net.fabricmc.fabric.api.client.screenhandler.v1;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTkwMDA4MQ=="}, "originalCommit": {"oid": "9ceae812d00411f69fbc9e2c5f648d54c8877254"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTkzNDkyNw==", "bodyText": "Ok, thats good then.", "url": "https://github.com/FabricMC/fabric/pull/584#discussion_r429934927", "createdAt": "2020-05-25T13:28:17Z", "author": {"login": "modmuss50"}, "path": "fabric-screen-handler-api-v1/src/main/java/net/fabricmc/fabric/api/client/screenhandler/v1/package-info.java", "diffHunk": "@@ -0,0 +1,20 @@\n+/*\n+ * Copyright (c) 2016, 2017, 2018, 2019 FabricMC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+/**\n+ * API for working with screen handlers on the client.\n+ */\n+package net.fabricmc.fabric.api.client.screenhandler.v1;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTkwMDA4MQ=="}, "originalCommit": {"oid": "9ceae812d00411f69fbc9e2c5f648d54c8877254"}, "originalPosition": 20}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3529, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}