{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI5MzQ2Nzg1", "number": 1191, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQwNzozMDo1NFrOE-hoWA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQyMDo1MDoyNlrOE-1h_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMzOTk4MTY4OnYy", "diffSide": "RIGHT", "path": "fabric-lifecycle-events-v1/src/main/java/net/fabricmc/fabric/impl/event/lifecycle/LifecycleEventsImpl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQwNzozMDo1NFrOH7uoLg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQwODoxODowNFrOH7v6NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjM5MTk4Mg==", "bodyText": "Just reminding myself to look here again? I swear I did something here", "url": "https://github.com/FabricMC/fabric/pull/1191#discussion_r532391982", "createdAt": "2020-11-30T07:30:54Z", "author": {"login": "i509VCB"}, "path": "fabric-lifecycle-events-v1/src/main/java/net/fabricmc/fabric/impl/event/lifecycle/LifecycleEventsImpl.java", "diffHunk": "@@ -44,13 +46,17 @@ public void onInitialize() {\n \t\t\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7391ca7c11e02d4134333205503b487f369a08c0"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjQxMjk4MQ==", "bodyText": "Upon testing no issue here", "url": "https://github.com/FabricMC/fabric/pull/1191#discussion_r532412981", "createdAt": "2020-11-30T08:18:04Z", "author": {"login": "i509VCB"}, "path": "fabric-lifecycle-events-v1/src/main/java/net/fabricmc/fabric/impl/event/lifecycle/LifecycleEventsImpl.java", "diffHunk": "@@ -44,13 +46,17 @@ public void onInitialize() {\n \t\t\t}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjM5MTk4Mg=="}, "originalCommit": {"oid": "7391ca7c11e02d4134333205503b487f369a08c0"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM0MDI0NzcxOnYy", "diffSide": "RIGHT", "path": "fabric-lifecycle-events-v1/src/main/java/net/fabricmc/fabric/api/client/event/lifecycle/v1/ClientEntityEvents.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQwODo1MjoyNlrOH7xFHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxMDoyNDoyN1rOH70j0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjQzMjE1OQ==", "bodyText": "Perhaps this should be \"This event is called before the entity is unloaded from the world\" to be consistent?", "url": "https://github.com/FabricMC/fabric/pull/1191#discussion_r532432159", "createdAt": "2020-11-30T08:52:26Z", "author": {"login": "reo-ar"}, "path": "fabric-lifecycle-events-v1/src/main/java/net/fabricmc/fabric/api/client/event/lifecycle/v1/ClientEntityEvents.java", "diffHunk": "@@ -57,12 +57,12 @@ public ClientEntityEvents() {\n \t/**\n \t * Called when an Entity is about to be unloaded from a ClientWorld.\n \t *\n-\t * <p>When this event is called, the entity is still present in the world.\n+\t * <p>This event is called before the entity is removed from the world.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "327337d5aabd6cb1ad51f2a9a89f6a0556631906"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjQ4OTE2OQ==", "bodyText": "Ummm Well.. That is good!!", "url": "https://github.com/FabricMC/fabric/pull/1191#discussion_r532489169", "createdAt": "2020-11-30T10:24:27Z", "author": null, "path": "fabric-lifecycle-events-v1/src/main/java/net/fabricmc/fabric/api/client/event/lifecycle/v1/ClientEntityEvents.java", "diffHunk": "@@ -57,12 +57,12 @@ public ClientEntityEvents() {\n \t/**\n \t * Called when an Entity is about to be unloaded from a ClientWorld.\n \t *\n-\t * <p>When this event is called, the entity is still present in the world.\n+\t * <p>This event is called before the entity is removed from the world.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjQzMjE1OQ=="}, "originalCommit": {"oid": "327337d5aabd6cb1ad51f2a9a89f6a0556631906"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM0MzI0MjIyOnYy", "diffSide": "RIGHT", "path": "fabric-lifecycle-events-v1/src/testmod/java/net/fabricmc/fabric/test/event/lifecycle/ServerEntityLifecycleTests.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQyMDo1MDoyNlrOH8NUcA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQyMDo1MDoyNlrOH8NUcA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjg5NDgzMg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\t\t\tfinal int worldEntities = Iterables.toArray(world.iterateEntities(), Entity.class).length;\n          \n          \n            \n            \t\t\t\t\tfinal int worldEntities = Iterables.size(world.iterateEntities());", "url": "https://github.com/FabricMC/fabric/pull/1191#discussion_r532894832", "createdAt": "2020-11-30T20:50:26Z", "author": {"login": "Pyrofab"}, "path": "fabric-lifecycle-events-v1/src/testmod/java/net/fabricmc/fabric/test/event/lifecycle/ServerEntityLifecycleTests.java", "diffHunk": "@@ -44,5 +49,46 @@ public void onInitialize() {\n \t\t\t\tlogger.info(\"[SERVER] LOADED \" + entity.toString() + \" - Entities: \" + this.serverEntities.size());\n \t\t\t}\n \t\t});\n+\n+\t\tServerEntityEvents.ENTITY_UNLOAD.register((entity, world) -> {\n+\t\t\tthis.serverEntities.remove(entity);\n+\n+\t\t\tif (PRINT_SERVER_ENTITY_MESSAGES) {\n+\t\t\t\tlogger.info(\"[SERVER] UNLOADED \" + entity.toString() + \" - Entities: \" + this.serverEntities.size());\n+\t\t\t}\n+\t\t});\n+\n+\t\tServerTickEvents.END_SERVER_TICK.register(server -> {\n+\t\t\tif (this.serverTicks++ % 200 == 0) {\n+\t\t\t\tint entities = 0;\n+\n+\t\t\t\tfor (ServerWorld world : server.getWorlds()) {\n+\t\t\t\t\tfinal int worldEntities = Iterables.toArray(world.iterateEntities(), Entity.class).length;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7391ca7c11e02d4134333205503b487f369a08c0"}, "originalPosition": 43}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3353, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}