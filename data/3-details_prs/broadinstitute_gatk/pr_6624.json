{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI0NzE1Mzgy", "number": 6624, "title": "Adjusted logic for filtering zero-coverage samples and intervals in CreateReadCountPanelOfNormals.", "bodyText": "Just a minor fix, but could conceivably change results by keeping/dropping samples/intervals on the edge of the filter. See discussion in https://gatk.broadinstitute.org/hc/en-us/community/posts/360057785591-Error-while-running-CreateReadCountPanelOfNormals", "createdAt": "2020-05-28T20:23:35Z", "url": "https://github.com/broadinstitute/gatk/pull/6624", "merged": true, "mergeCommit": {"oid": "46ddda2efec075fecb40a8c413971b041b14c4af"}, "closed": true, "closedAt": "2020-11-13T22:07:47Z", "author": {"login": "samuelklee"}, "timelineItems": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcrNgR7gBqjM0NDE3NzAwODA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdcNgzxgFqTUzMDQwNzU0OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0192a6d043785ad4429dfbe1dff8c9115043536c", "author": {"user": {"login": "samuelklee", "name": null}}, "url": "https://github.com/broadinstitute/gatk/commit/0192a6d043785ad4429dfbe1dff8c9115043536c", "committedDate": "2020-05-28T20:21:59Z", "message": "Adjusted logic for filtering zero-coverage samples and intervals in CreateReadCountPanelOfNormals."}, "afterCommit": {"oid": "b079c79a3729e09ee7aae8ed66a21516e17fe661", "author": {"user": {"login": "samuelklee", "name": null}}, "url": "https://github.com/broadinstitute/gatk/commit/b079c79a3729e09ee7aae8ed66a21516e17fe661", "committedDate": "2020-06-14T15:08:38Z", "message": "Adjusted logic for filtering zero-coverage samples and intervals in CreateReadCountPanelOfNormals."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b079c79a3729e09ee7aae8ed66a21516e17fe661", "author": {"user": {"login": "samuelklee", "name": null}}, "url": "https://github.com/broadinstitute/gatk/commit/b079c79a3729e09ee7aae8ed66a21516e17fe661", "committedDate": "2020-06-14T15:08:38Z", "message": "Adjusted logic for filtering zero-coverage samples and intervals in CreateReadCountPanelOfNormals."}, "afterCommit": {"oid": "a8b9577998b2b99ab107642217f2c4d47c41dec0", "author": {"user": {"login": "samuelklee", "name": null}}, "url": "https://github.com/broadinstitute/gatk/commit/a8b9577998b2b99ab107642217f2c4d47c41dec0", "committedDate": "2020-10-07T17:10:00Z", "message": "Adjusted logic for filtering zero-coverage samples and intervals in CreateReadCountPanelOfNormals."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1MDcxNTE3", "url": "https://github.com/broadinstitute/gatk/pull/6624#pullrequestreview-505071517", "createdAt": "2020-10-08T18:50:09Z", "commit": {"oid": "a8b9577998b2b99ab107642217f2c4d47c41dec0"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQxODo1MDowOVrOHesByA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wOFQxODo1MDowOVrOHesByA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTk0MDY4MA==", "bodyText": "I'm a little confused, why is numZerosInSample a double rather than an int?\nIf you need it to be a double so that the fraction is a double, why not cast at the point of computing the fraction?", "url": "https://github.com/broadinstitute/gatk/pull/6624#discussion_r501940680", "createdAt": "2020-10-08T18:50:09Z", "author": {"login": "fleharty"}, "path": "src/main/java/org/broadinstitute/hellbender/tools/copynumber/denoising/SVDDenoisingUtils.java", "diffHunk": "@@ -230,15 +230,15 @@ private static PreprocessedStandardizedResult preprocessPanel(final RealMatrix r\n             logger.info(String.format(\"A value of 100 was provided for argument %s, so the corresponding filtering step will be skipped...\",\n                     CreateReadCountPanelOfNormals.MAXIMUM_ZEROS_IN_SAMPLE_PERCENTAGE_LONG_NAME));\n         } else {\n-            logger.info(String.format(\"Filtering samples with a fraction of zero-coverage intervals above %.2f percent...\", maximumZerosInSamplePercentage));\n-            final int maxZerosInSample = calculateMaximumZerosCount(countNumberPassingFilter(filterIntervals), maximumZerosInSamplePercentage);\n+            logger.info(String.format(\"Filtering samples with a fraction of zero-coverage intervals greater than or equal to %.2f percent...\", maximumZerosInSamplePercentage));\n+            final int numPassingIntervals = countNumberPassingFilter(filterIntervals);\n             IntStream.range(0, numOriginalSamples)\n                     .filter(sampleIndex -> !filterSamples[sampleIndex])\n                     .forEach(sampleIndex -> {\n-                        final int numZerosInSample = (int) IntStream.range(0, numOriginalIntervals)\n+                        final double numZerosInSample = (double) IntStream.range(0, numOriginalIntervals)\n                                 .filter(intervalIndex -> !filterIntervals[intervalIndex] && readCounts.getEntry(sampleIndex, intervalIndex) == 0.)\n                                 .count();\n-                        if (numZerosInSample > maxZerosInSample) {\n+                        if (numZerosInSample / numPassingIntervals >= maximumZerosInSamplePercentage / 100.) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a8b9577998b2b99ab107642217f2c4d47c41dec0"}, "originalPosition": 16}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a8b9577998b2b99ab107642217f2c4d47c41dec0", "author": {"user": {"login": "samuelklee", "name": null}}, "url": "https://github.com/broadinstitute/gatk/commit/a8b9577998b2b99ab107642217f2c4d47c41dec0", "committedDate": "2020-10-07T17:10:00Z", "message": "Adjusted logic for filtering zero-coverage samples and intervals in CreateReadCountPanelOfNormals."}, "afterCommit": {"oid": "7c7599318151fcccd76640e813909ad8f1871aa2", "author": {"user": {"login": "samuelklee", "name": null}}, "url": "https://github.com/broadinstitute/gatk/commit/7c7599318151fcccd76640e813909ad8f1871aa2", "committedDate": "2020-10-08T21:29:02Z", "message": "Added regression test and additional filter to prevent NaNs from zero-median intervals that result when median filter is disabled."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7c7599318151fcccd76640e813909ad8f1871aa2", "author": {"user": {"login": "samuelklee", "name": null}}, "url": "https://github.com/broadinstitute/gatk/commit/7c7599318151fcccd76640e813909ad8f1871aa2", "committedDate": "2020-10-08T21:29:02Z", "message": "Added regression test and additional filter to prevent NaNs from zero-median intervals that result when median filter is disabled."}, "afterCommit": {"oid": "0d3f4c2dfe16206ba192e0feeaf5832324f9b8a1", "author": {"user": {"login": "samuelklee", "name": null}}, "url": "https://github.com/broadinstitute/gatk/commit/0d3f4c2dfe16206ba192e0feeaf5832324f9b8a1", "committedDate": "2020-10-09T01:05:37Z", "message": "Added regression tests, logging, and a check for zero interval medians to prevent NaNs when running a single sample with uncovered intervals."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0d3f4c2dfe16206ba192e0feeaf5832324f9b8a1", "author": {"user": {"login": "samuelklee", "name": null}}, "url": "https://github.com/broadinstitute/gatk/commit/0d3f4c2dfe16206ba192e0feeaf5832324f9b8a1", "committedDate": "2020-10-09T01:05:37Z", "message": "Added regression tests, logging, and a check for zero interval medians to prevent NaNs when running a single sample with uncovered intervals."}, "afterCommit": {"oid": "62daa97acb1737b09ab588927cab4186af533097", "author": {"user": {"login": "samuelklee", "name": null}}, "url": "https://github.com/broadinstitute/gatk/commit/62daa97acb1737b09ab588927cab4186af533097", "committedDate": "2020-10-09T01:57:38Z", "message": "Added regression tests and logging."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "62daa97acb1737b09ab588927cab4186af533097", "author": {"user": {"login": "samuelklee", "name": null}}, "url": "https://github.com/broadinstitute/gatk/commit/62daa97acb1737b09ab588927cab4186af533097", "committedDate": "2020-10-09T01:57:38Z", "message": "Added regression tests and logging."}, "afterCommit": {"oid": "f121251294919bd0a39ad53ab997b019be333703", "author": {"user": {"login": "samuelklee", "name": null}}, "url": "https://github.com/broadinstitute/gatk/commit/f121251294919bd0a39ad53ab997b019be333703", "committedDate": "2020-10-09T01:58:33Z", "message": "Added regression tests and logging."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f121251294919bd0a39ad53ab997b019be333703", "author": {"user": {"login": "samuelklee", "name": null}}, "url": "https://github.com/broadinstitute/gatk/commit/f121251294919bd0a39ad53ab997b019be333703", "committedDate": "2020-10-09T01:58:33Z", "message": "Added regression tests and logging."}, "afterCommit": {"oid": "2f78de307e5b66ead3d6edd555ec1f317aa8c046", "author": {"user": {"login": "samuelklee", "name": null}}, "url": "https://github.com/broadinstitute/gatk/commit/2f78de307e5b66ead3d6edd555ec1f317aa8c046", "committedDate": "2020-10-09T01:59:38Z", "message": "Added regression tests and logging."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2f78de307e5b66ead3d6edd555ec1f317aa8c046", "author": {"user": {"login": "samuelklee", "name": null}}, "url": "https://github.com/broadinstitute/gatk/commit/2f78de307e5b66ead3d6edd555ec1f317aa8c046", "committedDate": "2020-10-09T01:59:38Z", "message": "Added regression tests and logging."}, "afterCommit": {"oid": "766a1607fa24489bdbf0b12b9e94e8bbc4c4cef4", "author": {"user": {"login": "samuelklee", "name": null}}, "url": "https://github.com/broadinstitute/gatk/commit/766a1607fa24489bdbf0b12b9e94e8bbc4c4cef4", "committedDate": "2020-10-09T02:12:11Z", "message": "Added regression tests and logging."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "766a1607fa24489bdbf0b12b9e94e8bbc4c4cef4", "author": {"user": {"login": "samuelklee", "name": null}}, "url": "https://github.com/broadinstitute/gatk/commit/766a1607fa24489bdbf0b12b9e94e8bbc4c4cef4", "committedDate": "2020-10-09T02:12:11Z", "message": "Added regression tests and logging."}, "afterCommit": {"oid": "240cc3118217d02152bb81436dfbafec3275a5ae", "author": {"user": {"login": "samuelklee", "name": null}}, "url": "https://github.com/broadinstitute/gatk/commit/240cc3118217d02152bb81436dfbafec3275a5ae", "committedDate": "2020-10-09T02:32:21Z", "message": "Added regression tests and logging."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d2f5a1f48c62d8a5fa943710db5f34d41f19275b", "author": {"user": {"login": "samuelklee", "name": null}}, "url": "https://github.com/broadinstitute/gatk/commit/d2f5a1f48c62d8a5fa943710db5f34d41f19275b", "committedDate": "2020-10-09T13:14:36Z", "message": "Adjusted logic for filtering zero-coverage samples and intervals in CreateReadCountPanelOfNormals."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "240cc3118217d02152bb81436dfbafec3275a5ae", "author": {"user": {"login": "samuelklee", "name": null}}, "url": "https://github.com/broadinstitute/gatk/commit/240cc3118217d02152bb81436dfbafec3275a5ae", "committedDate": "2020-10-09T02:32:21Z", "message": "Added regression tests and logging."}, "afterCommit": {"oid": "1839075f50284b19e6535d06fbb3c0d07a95c83f", "author": {"user": {"login": "samuelklee", "name": null}}, "url": "https://github.com/broadinstitute/gatk/commit/1839075f50284b19e6535d06fbb3c0d07a95c83f", "committedDate": "2020-10-09T13:14:36Z", "message": "Added regression tests and logging."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1839075f50284b19e6535d06fbb3c0d07a95c83f", "author": {"user": {"login": "samuelklee", "name": null}}, "url": "https://github.com/broadinstitute/gatk/commit/1839075f50284b19e6535d06fbb3c0d07a95c83f", "committedDate": "2020-10-09T13:14:36Z", "message": "Added regression tests and logging."}, "afterCommit": {"oid": "bc0e296fef7b19ba6e821080ee7ddb3ec163bf45", "author": {"user": {"login": "samuelklee", "name": null}}, "url": "https://github.com/broadinstitute/gatk/commit/bc0e296fef7b19ba6e821080ee7ddb3ec163bf45", "committedDate": "2020-10-09T13:37:11Z", "message": "Added regression tests and logging."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "976ddf26cf0e343619f0a7b989fc463c67988899", "author": {"user": {"login": "samuelklee", "name": null}}, "url": "https://github.com/broadinstitute/gatk/commit/976ddf26cf0e343619f0a7b989fc463c67988899", "committedDate": "2020-10-09T13:39:30Z", "message": "Added regression tests and logging."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bc0e296fef7b19ba6e821080ee7ddb3ec163bf45", "author": {"user": {"login": "samuelklee", "name": null}}, "url": "https://github.com/broadinstitute/gatk/commit/bc0e296fef7b19ba6e821080ee7ddb3ec163bf45", "committedDate": "2020-10-09T13:37:11Z", "message": "Added regression tests and logging."}, "afterCommit": {"oid": "976ddf26cf0e343619f0a7b989fc463c67988899", "author": {"user": {"login": "samuelklee", "name": null}}, "url": "https://github.com/broadinstitute/gatk/commit/976ddf26cf0e343619f0a7b989fc463c67988899", "committedDate": "2020-10-09T13:39:30Z", "message": "Added regression tests and logging."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "88d9fcb14eea4fd529ad405ccbc9971bb3929237", "author": {"user": {"login": "samuelklee", "name": null}}, "url": "https://github.com/broadinstitute/gatk/commit/88d9fcb14eea4fd529ad405ccbc9971bb3929237", "committedDate": "2020-10-09T15:39:41Z", "message": "Set random seeds for shuffles."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6c438e0d0ceeb1bdd30dc33bbaf6459d07e16634", "author": {"user": {"login": "samuelklee", "name": null}}, "url": "https://github.com/broadinstitute/gatk/commit/6c438e0d0ceeb1bdd30dc33bbaf6459d07e16634", "committedDate": "2020-10-09T15:36:57Z", "message": "Seed random shuffles."}, "afterCommit": {"oid": "88d9fcb14eea4fd529ad405ccbc9971bb3929237", "author": {"user": {"login": "samuelklee", "name": null}}, "url": "https://github.com/broadinstitute/gatk/commit/88d9fcb14eea4fd529ad405ccbc9971bb3929237", "committedDate": "2020-10-09T15:39:41Z", "message": "Set random seeds for shuffles."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwNDA3NTQ4", "url": "https://github.com/broadinstitute/gatk/pull/6624#pullrequestreview-530407548", "createdAt": "2020-11-13T20:51:43Z", "commit": {"oid": "88d9fcb14eea4fd529ad405ccbc9971bb3929237"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2603, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}