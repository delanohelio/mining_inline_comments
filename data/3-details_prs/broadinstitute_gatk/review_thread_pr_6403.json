{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY1NDg4NzMy", "number": 6403, "reviewThreads": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxOTowMjoxNFrODdF6cw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQyMDowNTowOVrODdHGFQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxODMyMTc5OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/broadinstitute/hellbender/utils/read/CigarBuilder.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxOTowMjoxNFrOFlf0Jw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yM1QwNjo0NDozMFrOFtOmvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDg2Mjg4Nw==", "bodyText": "This should have some javadoc to explain what the class is for.", "url": "https://github.com/broadinstitute/gatk/pull/6403#discussion_r374862887", "createdAt": "2020-02-04T19:02:14Z", "author": {"login": "lbergelson"}, "path": "src/main/java/org/broadinstitute/hellbender/utils/read/CigarBuilder.java", "diffHunk": "@@ -0,0 +1,109 @@\n+package org.broadinstitute.hellbender.utils.read;\n+\n+import htsjdk.samtools.Cigar;\n+import htsjdk.samtools.CigarElement;\n+import htsjdk.samtools.CigarOperator;\n+import org.broadinstitute.hellbender.utils.Utils;\n+\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.List;\n+\n+public class CigarBuilder {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6a050f08f44f36866c863f1c1f1417cfd5280815"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjk2OTUzMw==", "bodyText": "done", "url": "https://github.com/broadinstitute/gatk/pull/6403#discussion_r382969533", "createdAt": "2020-02-23T06:44:30Z", "author": {"login": "davidbenjamin"}, "path": "src/main/java/org/broadinstitute/hellbender/utils/read/CigarBuilder.java", "diffHunk": "@@ -0,0 +1,109 @@\n+package org.broadinstitute.hellbender.utils.read;\n+\n+import htsjdk.samtools.Cigar;\n+import htsjdk.samtools.CigarElement;\n+import htsjdk.samtools.CigarOperator;\n+import org.broadinstitute.hellbender.utils.Utils;\n+\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.List;\n+\n+public class CigarBuilder {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDg2Mjg4Nw=="}, "originalCommit": {"oid": "6a050f08f44f36866c863f1c1f1417cfd5280815"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxODM0NDM3OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/broadinstitute/hellbender/utils/read/CigarUtils.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxOTowOTo0M1rOFlgCUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yM1QwNjoxNDoxOVrOFtOgSg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDg2NjUxNA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * Removes all clipping operators from the cigar.\n          \n          \n            \n                 * Removes all clipping and padding operators from the cigar.", "url": "https://github.com/broadinstitute/gatk/pull/6403#discussion_r374866514", "createdAt": "2020-02-04T19:09:43Z", "author": {"login": "lbergelson"}, "path": "src/main/java/org/broadinstitute/hellbender/utils/read/CigarUtils.java", "diffHunk": "@@ -128,7 +128,7 @@ public static int countRefBasesIncludingSoftClips(final GATKRead read, final int\n     /**\n      * Removes all clipping operators from the cigar.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "85d97f12416c4bc729d1a58ab8f0ee571059a5e8"}, "originalPosition": 2}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjk2Nzg4Mg==", "bodyText": "done", "url": "https://github.com/broadinstitute/gatk/pull/6403#discussion_r382967882", "createdAt": "2020-02-23T06:14:19Z", "author": {"login": "davidbenjamin"}, "path": "src/main/java/org/broadinstitute/hellbender/utils/read/CigarUtils.java", "diffHunk": "@@ -128,7 +128,7 @@ public static int countRefBasesIncludingSoftClips(final GATKRead read, final int\n     /**\n      * Removes all clipping operators from the cigar.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDg2NjUxNA=="}, "originalCommit": {"oid": "85d97f12416c4bc729d1a58ab8f0ee571059a5e8"}, "originalPosition": 2}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxODM0NTc1OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/broadinstitute/hellbender/utils/read/CigarUtils.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxOToxMDoxMlrOFlgDNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yM1QwNjoxNToxNFrOFtOgbA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDg2Njc0MQ==", "bodyText": "You might want to rename the private isClipOperator to isClipOrPaddingOperator as well.", "url": "https://github.com/broadinstitute/gatk/pull/6403#discussion_r374866741", "createdAt": "2020-02-04T19:10:12Z", "author": {"login": "lbergelson"}, "path": "src/main/java/org/broadinstitute/hellbender/utils/read/CigarUtils.java", "diffHunk": "@@ -128,7 +128,7 @@ public static int countRefBasesIncludingSoftClips(final GATKRead read, final int\n     /**\n      * Removes all clipping operators from the cigar.\n      */\n-    public static Cigar trimReadToUnclippedBases(final Cigar cigar) {\n+    public static Cigar removeClipsAndPadding(final Cigar cigar) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "85d97f12416c4bc729d1a58ab8f0ee571059a5e8"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjk2NzkxNg==", "bodyText": "done", "url": "https://github.com/broadinstitute/gatk/pull/6403#discussion_r382967916", "createdAt": "2020-02-23T06:15:14Z", "author": {"login": "davidbenjamin"}, "path": "src/main/java/org/broadinstitute/hellbender/utils/read/CigarUtils.java", "diffHunk": "@@ -128,7 +128,7 @@ public static int countRefBasesIncludingSoftClips(final GATKRead read, final int\n     /**\n      * Removes all clipping operators from the cigar.\n      */\n-    public static Cigar trimReadToUnclippedBases(final Cigar cigar) {\n+    public static Cigar removeClipsAndPadding(final Cigar cigar) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDg2Njc0MQ=="}, "originalCommit": {"oid": "85d97f12416c4bc729d1a58ab8f0ee571059a5e8"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxODM0OTkwOnYy", "diffSide": "RIGHT", "path": "src/main/java/org/broadinstitute/hellbender/utils/read/ClippingTail.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxOToxMTozNVrOFlgF3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yM1QwNjoxODozNVrOFtOhSQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDg2NzQyMQ==", "bodyText": "It seemed fine where it was but if you have a strong preference for making it a top level class that's also fine with me.", "url": "https://github.com/broadinstitute/gatk/pull/6403#discussion_r374867421", "createdAt": "2020-02-04T19:11:35Z", "author": {"login": "lbergelson"}, "path": "src/main/java/org/broadinstitute/hellbender/utils/read/ClippingTail.java", "diffHunk": "@@ -0,0 +1,9 @@\n+package org.broadinstitute.hellbender.utils.read;\n+\n+/**\n+ * A marker to tell which end of the read has been clipped\n+ */\n+public enum ClippingTail {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "77dd43ad8c1d8a21023455e571c037d3e9ba54f9"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjk2ODEzNw==", "bodyText": "I have a strong preference for shortening long lines code with things like CigarUtils.ClippingTail.RIGHT_TAIL.  I can't say that nesting the enum bothered me for any other reason.", "url": "https://github.com/broadinstitute/gatk/pull/6403#discussion_r382968137", "createdAt": "2020-02-23T06:18:35Z", "author": {"login": "davidbenjamin"}, "path": "src/main/java/org/broadinstitute/hellbender/utils/read/ClippingTail.java", "diffHunk": "@@ -0,0 +1,9 @@\n+package org.broadinstitute.hellbender.utils.read;\n+\n+/**\n+ * A marker to tell which end of the read has been clipped\n+ */\n+public enum ClippingTail {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDg2NzQyMQ=="}, "originalCommit": {"oid": "77dd43ad8c1d8a21023455e571c037d3e9ba54f9"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxODM1NTc0OnYy", "diffSide": "LEFT", "path": "src/main/java/org/broadinstitute/hellbender/utils/clipping/ClippingOp.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxOToxMzoyNlrOFlgJpw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxOToxMzoyNlrOFlgJpw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDg2ODM5MQ==", "bodyText": "wow, this is horrible, good riddance...  as far as I'm concerned asserts are a terrible anti-pattern", "url": "https://github.com/broadinstitute/gatk/pull/6403#discussion_r374868391", "createdAt": "2020-02-04T19:13:26Z", "author": {"login": "lbergelson"}, "path": "src/main/java/org/broadinstitute/hellbender/utils/clipping/ClippingOp.java", "diffHunk": "@@ -263,9 +258,7 @@ private Cigar softClip(final Cigar __cigar, final int __startClipEnd, final int\n \n             final Cigar newCigar = new Cigar();\n             newCigar.add(new CigarElement(cigarLength, CigarOperator.SOFT_CLIP));\n-            if (runAsserts) {\n-                assert newCigar.isValid(null, -1) == null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "832d356f4c0bc4711e24e8ffce2f1283adf050d0"}, "originalPosition": 64}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxODQ0NTM4OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/broadinstitute/hellbender/utils/clipping/ReadClipper.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxOTo0MTo1OFrOFlhCMA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxODo0MTo1OVrOFu3f2A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDg4Mjg2NA==", "bodyText": "Using read.getCigarElements instead of read.getCigar().getCigarElements() was a deliberate optimization that this seems to be undoing.  getCigar has to do a defensive copy of the Cigar since cigars are mutable, but getCigarElements just returns an immutable list view of the elements which is cheaper.", "url": "https://github.com/broadinstitute/gatk/pull/6403#discussion_r374882864", "createdAt": "2020-02-04T19:41:58Z", "author": {"login": "lbergelson"}, "path": "src/main/java/org/broadinstitute/hellbender/utils/clipping/ReadClipper.java", "diffHunk": "@@ -471,7 +457,7 @@ protected GATKRead clipByReferenceCoordinates(final int refStart, final int refS\n      */\n     public static GATKRead softClipToRegionIncludingClippedBases( final GATKRead read, final int refStart, final int refStop ) {\n         final int start = read.getUnclippedStart();\n-        final int stop = start + CigarUtils.countRefBasesBasedOnUnclippedAlignment(read, 0, read.numCigarElements()) - 1;\n+        final int stop = start + CigarUtils.countRefBasesAndClips(read.getCigar(), 0, read.numCigarElements()) - 1;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9d28f9d411b4225bef12bd69ca903613efd7e0bc"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDY4ODA4OA==", "bodyText": "fixed", "url": "https://github.com/broadinstitute/gatk/pull/6403#discussion_r384688088", "createdAt": "2020-02-26T18:41:59Z", "author": {"login": "davidbenjamin"}, "path": "src/main/java/org/broadinstitute/hellbender/utils/clipping/ReadClipper.java", "diffHunk": "@@ -471,7 +457,7 @@ protected GATKRead clipByReferenceCoordinates(final int refStart, final int refS\n      */\n     public static GATKRead softClipToRegionIncludingClippedBases( final GATKRead read, final int refStart, final int refStop ) {\n         final int start = read.getUnclippedStart();\n-        final int stop = start + CigarUtils.countRefBasesBasedOnUnclippedAlignment(read, 0, read.numCigarElements()) - 1;\n+        final int stop = start + CigarUtils.countRefBasesAndClips(read.getCigar(), 0, read.numCigarElements()) - 1;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDg4Mjg2NA=="}, "originalCommit": {"oid": "9d28f9d411b4225bef12bd69ca903613efd7e0bc"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxODQ2MzEyOnYy", "diffSide": "RIGHT", "path": "src/main/java/org/broadinstitute/hellbender/utils/read/CigarUtils.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxOTo0ODowMFrOFlhNpw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxODo0MjoxOVrOFu3gfg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDg4NTc5OQ==", "bodyText": "I don't know if this is a performance critical method in mutect/haplotype caller, but if it is a simple for loop from startIndex to endIndex is going to be more performant than a stream over a sublist.\nThe predicate combination is neat, but I'm not sure if it's more readable than just a set of if statements", "url": "https://github.com/broadinstitute/gatk/pull/6403#discussion_r374885799", "createdAt": "2020-02-04T19:48:00Z", "author": {"login": "lbergelson"}, "path": "src/main/java/org/broadinstitute/hellbender/utils/read/CigarUtils.java", "diffHunk": "@@ -56,40 +57,25 @@ public static Cigar invertCigar (final Cigar cigar) {\n      * For example original position = 10. cigar: 2M3I2D1M. If you remove the 2M the new starting position is 12.\n      * If you remove the 2M3I it is still 12. If you remove 2M3I2D (not reasonable cigar), you will get position 14.\n      */\n-    public static int countRefBasesBasedOnUnclippedAlignment(final GATKRead read, final int cigarStartIndex, final int cigarEndIndex){\n-        if (read == null){\n-            throw new IllegalArgumentException(\"null read\");\n-        }\n-        final List<CigarElement> elems = read.getCigarElements();\n-        if (cigarStartIndex < 0 || cigarEndIndex > elems.size() || cigarStartIndex > cigarEndIndex){\n-            throw new IllegalArgumentException(\"invalid index:\" + 0 + \" -\" + elems.size());\n-        }\n-        int result = 0;\n-        for(int i = cigarStartIndex; i < cigarEndIndex; i++){\n-            final CigarElement cigarElement = elems.get(i);\n-            final CigarOperator operator = cigarElement.getOperator();\n-            if (operator.consumesReferenceBases() || operator.isClipping()) {\n-                result += cigarElement.getLength();\n-            }\n-        }\n-        return result;\n+    public static int countRefBasesAndClips(final Cigar cigar, final int cigarStartIndex, final int cigarEndIndex){\n+        return countRefBasesAndMaybeAlsoClips(cigar, cigarStartIndex, cigarEndIndex, true, true);\n     }\n \n-    public static int countRefBasesIncludingSoftClips(final GATKRead read, final int cigarStartIndex, final int cigarEndIndex){\n-        Utils.nonNull(read, \"null read\");\n-        final List<CigarElement> elems = read.getCigarElements();\n-        if (cigarStartIndex < 0 || cigarEndIndex > elems.size() || cigarStartIndex > cigarEndIndex){\n-            throw new IllegalArgumentException(\"invalid index:\" + 0 + \" -\" + elems.size());\n-        }\n-        int result = 0;\n-        for(int i = cigarStartIndex; i < cigarEndIndex; i++){\n-            final CigarElement cigarElement = elems.get(i);\n-            final CigarOperator operator = cigarElement.getOperator();\n-            if (operator.consumesReferenceBases() || operator == CigarOperator.S) {\n-                result += cigarElement.getLength();\n-            }\n-        }\n-        return result;\n+    public static int countRefBasesAndSoftClips(final Cigar cigar, final int cigarStartIndex, final int cigarEndIndex){\n+        return countRefBasesAndMaybeAlsoClips(cigar, cigarStartIndex, cigarEndIndex, true, false);\n+    }\n+\n+    private static int countRefBasesAndMaybeAlsoClips(final Cigar cigar, final int cigarStartIndex, final int cigarEndIndex, final boolean includeSoftClips, final boolean includeHardClips) {\n+        final List<CigarElement> elems = Utils.nonNull(cigar).getCigarElements();\n+        Utils.validateArg(cigarStartIndex >= 0 && cigarEndIndex <= elems.size() && cigarStartIndex <= cigarEndIndex, () -> \"invalid index:\" + 0 + \" -\" + elems.size());\n+        final Predicate<CigarOperator> consumesRefBases = CigarOperator::consumesReferenceBases;\n+        final Predicate<CigarOperator> clippingPredicate = op -> (includeSoftClips && op == CigarOperator.SOFT_CLIP) || (includeHardClips && op == CigarOperator.HARD_CLIP);\n+        final Predicate<CigarOperator> countOperator = consumesRefBases.or(clippingPredicate);\n+\n+        return elems.subList(cigarStartIndex, cigarEndIndex).stream()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9d28f9d411b4225bef12bd69ca903613efd7e0bc"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDY4ODI1NA==", "bodyText": "fixed on both accounts", "url": "https://github.com/broadinstitute/gatk/pull/6403#discussion_r384688254", "createdAt": "2020-02-26T18:42:19Z", "author": {"login": "davidbenjamin"}, "path": "src/main/java/org/broadinstitute/hellbender/utils/read/CigarUtils.java", "diffHunk": "@@ -56,40 +57,25 @@ public static Cigar invertCigar (final Cigar cigar) {\n      * For example original position = 10. cigar: 2M3I2D1M. If you remove the 2M the new starting position is 12.\n      * If you remove the 2M3I it is still 12. If you remove 2M3I2D (not reasonable cigar), you will get position 14.\n      */\n-    public static int countRefBasesBasedOnUnclippedAlignment(final GATKRead read, final int cigarStartIndex, final int cigarEndIndex){\n-        if (read == null){\n-            throw new IllegalArgumentException(\"null read\");\n-        }\n-        final List<CigarElement> elems = read.getCigarElements();\n-        if (cigarStartIndex < 0 || cigarEndIndex > elems.size() || cigarStartIndex > cigarEndIndex){\n-            throw new IllegalArgumentException(\"invalid index:\" + 0 + \" -\" + elems.size());\n-        }\n-        int result = 0;\n-        for(int i = cigarStartIndex; i < cigarEndIndex; i++){\n-            final CigarElement cigarElement = elems.get(i);\n-            final CigarOperator operator = cigarElement.getOperator();\n-            if (operator.consumesReferenceBases() || operator.isClipping()) {\n-                result += cigarElement.getLength();\n-            }\n-        }\n-        return result;\n+    public static int countRefBasesAndClips(final Cigar cigar, final int cigarStartIndex, final int cigarEndIndex){\n+        return countRefBasesAndMaybeAlsoClips(cigar, cigarStartIndex, cigarEndIndex, true, true);\n     }\n \n-    public static int countRefBasesIncludingSoftClips(final GATKRead read, final int cigarStartIndex, final int cigarEndIndex){\n-        Utils.nonNull(read, \"null read\");\n-        final List<CigarElement> elems = read.getCigarElements();\n-        if (cigarStartIndex < 0 || cigarEndIndex > elems.size() || cigarStartIndex > cigarEndIndex){\n-            throw new IllegalArgumentException(\"invalid index:\" + 0 + \" -\" + elems.size());\n-        }\n-        int result = 0;\n-        for(int i = cigarStartIndex; i < cigarEndIndex; i++){\n-            final CigarElement cigarElement = elems.get(i);\n-            final CigarOperator operator = cigarElement.getOperator();\n-            if (operator.consumesReferenceBases() || operator == CigarOperator.S) {\n-                result += cigarElement.getLength();\n-            }\n-        }\n-        return result;\n+    public static int countRefBasesAndSoftClips(final Cigar cigar, final int cigarStartIndex, final int cigarEndIndex){\n+        return countRefBasesAndMaybeAlsoClips(cigar, cigarStartIndex, cigarEndIndex, true, false);\n+    }\n+\n+    private static int countRefBasesAndMaybeAlsoClips(final Cigar cigar, final int cigarStartIndex, final int cigarEndIndex, final boolean includeSoftClips, final boolean includeHardClips) {\n+        final List<CigarElement> elems = Utils.nonNull(cigar).getCigarElements();\n+        Utils.validateArg(cigarStartIndex >= 0 && cigarEndIndex <= elems.size() && cigarStartIndex <= cigarEndIndex, () -> \"invalid index:\" + 0 + \" -\" + elems.size());\n+        final Predicate<CigarOperator> consumesRefBases = CigarOperator::consumesReferenceBases;\n+        final Predicate<CigarOperator> clippingPredicate = op -> (includeSoftClips && op == CigarOperator.SOFT_CLIP) || (includeHardClips && op == CigarOperator.HARD_CLIP);\n+        final Predicate<CigarOperator> countOperator = consumesRefBases.or(clippingPredicate);\n+\n+        return elems.subList(cigarStartIndex, cigarEndIndex).stream()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDg4NTc5OQ=="}, "originalCommit": {"oid": "9d28f9d411b4225bef12bd69ca903613efd7e0bc"}, "originalPosition": 59}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxODQ2NTcyOnYy", "diffSide": "RIGHT", "path": "src/main/java/org/broadinstitute/hellbender/utils/read/CigarUtils.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxOTo0ODo0NlrOFlhPNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxOTo0ODo0NlrOFlhPNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDg4NjE5Nw==", "bodyText": "Oh, heh, I see, you already addressed the same exact problem here.", "url": "https://github.com/broadinstitute/gatk/pull/6403#discussion_r374886197", "createdAt": "2020-02-04T19:48:46Z", "author": {"login": "lbergelson"}, "path": "src/main/java/org/broadinstitute/hellbender/utils/read/CigarUtils.java", "diffHunk": "@@ -181,16 +181,7 @@ public static boolean isGood(final Cigar c) {\n             return false;\n         }\n         final List<CigarElement> elems = c.getCigarElements();\n-        if (hasConsecutiveIndels(elems)){\n-            return false;\n-        }\n-        if (startsWithDeletionIgnoringClips(elems)){\n-            return false;\n-        }\n-        //revert the list and check deletions at the end\n-        final List<CigarElement> elemsRev = new ArrayList<>(elems);\n-        Collections.reverse(elemsRev);\n-        return !startsWithDeletionIgnoringClips(elemsRev);\n+        return !(hasConsecutiveIndels(elems) || startsOrEndsWithDeletionIgnoringClips(elems));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "747914aed52ee4ca8f2d58f82f0ca589c1976556"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxODQ3OTMxOnYy", "diffSide": "RIGHT", "path": "src/main/java/org/broadinstitute/hellbender/utils/read/CigarUtils.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxOTo1Mjo1N1rOFlhXuA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxOTowMzo1MVrOFu4O4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDg4ODM3Ng==", "bodyText": "doesn't this iterate over the whole cigar string now instead of just the first 2 elements? seems like a possible performance regression", "url": "https://github.com/broadinstitute/gatk/pull/6403#discussion_r374888376", "createdAt": "2020-02-04T19:52:57Z", "author": {"login": "lbergelson"}, "path": "src/main/java/org/broadinstitute/hellbender/utils/read/CigarUtils.java", "diffHunk": "@@ -212,17 +203,19 @@ private static boolean hasConsecutiveIndels(final List<CigarElement> elems) {\n     /**\n      * Checks if cigar starts with a deletion (ignoring any clips at the beginning).\n      */\n-    private static boolean startsWithDeletionIgnoringClips(final List<CigarElement> elems) {\n-        final Iterator<CigarElement> iter = elems.iterator();\n-        boolean isClip = true;\n-        CigarOperator op = null;\n-        while(iter.hasNext() && isClip) { //consume clips at the beginning\n-            final CigarElement elem = iter.next();\n-            op = elem.getOperator();\n-            isClip = (op == CigarOperator.HARD_CLIP || op == CigarOperator.SOFT_CLIP);\n+    private static boolean startsOrEndsWithDeletionIgnoringClips(final List<CigarElement> elems) {\n+        CigarOperator lastOp = null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "747914aed52ee4ca8f2d58f82f0ca589c1976556"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDcwMDEzMA==", "bodyText": "fixed", "url": "https://github.com/broadinstitute/gatk/pull/6403#discussion_r384700130", "createdAt": "2020-02-26T19:03:51Z", "author": {"login": "davidbenjamin"}, "path": "src/main/java/org/broadinstitute/hellbender/utils/read/CigarUtils.java", "diffHunk": "@@ -212,17 +203,19 @@ private static boolean hasConsecutiveIndels(final List<CigarElement> elems) {\n     /**\n      * Checks if cigar starts with a deletion (ignoring any clips at the beginning).\n      */\n-    private static boolean startsWithDeletionIgnoringClips(final List<CigarElement> elems) {\n-        final Iterator<CigarElement> iter = elems.iterator();\n-        boolean isClip = true;\n-        CigarOperator op = null;\n-        while(iter.hasNext() && isClip) { //consume clips at the beginning\n-            final CigarElement elem = iter.next();\n-            op = elem.getOperator();\n-            isClip = (op == CigarOperator.HARD_CLIP || op == CigarOperator.SOFT_CLIP);\n+    private static boolean startsOrEndsWithDeletionIgnoringClips(final List<CigarElement> elems) {\n+        CigarOperator lastOp = null;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDg4ODM3Ng=="}, "originalCommit": {"oid": "747914aed52ee4ca8f2d58f82f0ca589c1976556"}, "originalPosition": 42}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxODQ5MDAwOnYy", "diffSide": "RIGHT", "path": "src/main/java/org/broadinstitute/hellbender/utils/read/CigarUtils.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxOTo1NjozN1rOFlhefA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxOTo1NjozN1rOFlhefA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDg5MDEwOA==", "bodyText": "neat", "url": "https://github.com/broadinstitute/gatk/pull/6403#discussion_r374890108", "createdAt": "2020-02-04T19:56:37Z", "author": {"login": "lbergelson"}, "path": "src/main/java/org/broadinstitute/hellbender/utils/read/CigarUtils.java", "diffHunk": "@@ -355,6 +357,29 @@ public static int countUnclippedReadBases(final Cigar cigar) {\n                 .sum();\n     }\n \n+    private static int countClippedBases(final Cigar cigar, final ClippingTail tail, final boolean includeSoftClips, final boolean includeHardClips) {\n+        Utils.nonNull(cigar);\n+\n+        if (cigar.numCigarElements() == 0) {\n+            return 0;\n+        }\n+\n+        Utils.validate(includeHardClips || includeSoftClips, \"no clips chosen\");\n+        final Predicate<CigarOperator> pred = !includeHardClips ? op -> op == CigarOperator.S :", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "086adb20d0e407615591e57b770ece51c866ef1e"}, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxODQ5ODA2OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/broadinstitute/hellbender/utils/read/CigarUtils.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxOTo1OTowNVrOFlhjTQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yM1QwNjoyMDoxOFrOFtOhjw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDg5MTM0MQ==", "bodyText": "add a check for null clipping tail as well", "url": "https://github.com/broadinstitute/gatk/pull/6403#discussion_r374891341", "createdAt": "2020-02-04T19:59:05Z", "author": {"login": "lbergelson"}, "path": "src/main/java/org/broadinstitute/hellbender/utils/read/CigarUtils.java", "diffHunk": "@@ -355,6 +357,29 @@ public static int countUnclippedReadBases(final Cigar cigar) {\n                 .sum();\n     }\n \n+    private static int countClippedBases(final Cigar cigar, final ClippingTail tail, final boolean includeSoftClips, final boolean includeHardClips) {\n+        Utils.nonNull(cigar);\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "086adb20d0e407615591e57b770ece51c866ef1e"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjk2ODIwNw==", "bodyText": "done", "url": "https://github.com/broadinstitute/gatk/pull/6403#discussion_r382968207", "createdAt": "2020-02-23T06:20:18Z", "author": {"login": "davidbenjamin"}, "path": "src/main/java/org/broadinstitute/hellbender/utils/read/CigarUtils.java", "diffHunk": "@@ -355,6 +357,29 @@ public static int countUnclippedReadBases(final Cigar cigar) {\n                 .sum();\n     }\n \n+    private static int countClippedBases(final Cigar cigar, final ClippingTail tail, final boolean includeSoftClips, final boolean includeHardClips) {\n+        Utils.nonNull(cigar);\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDg5MTM0MQ=="}, "originalCommit": {"oid": "086adb20d0e407615591e57b770ece51c866ef1e"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxODUwMTIwOnYy", "diffSide": "RIGHT", "path": "src/main/java/org/broadinstitute/hellbender/utils/read/CigarUtils.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQyMDowMDoxNVrOFlhlXw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yM1QwNjoyNDoxOFrOFtOinQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDg5MTg3MQ==", "bodyText": "lets pull the elements to iterate out into a variable, might make it a little bit cleaner to read", "url": "https://github.com/broadinstitute/gatk/pull/6403#discussion_r374891871", "createdAt": "2020-02-04T20:00:15Z", "author": {"login": "lbergelson"}, "path": "src/main/java/org/broadinstitute/hellbender/utils/read/CigarUtils.java", "diffHunk": "@@ -355,6 +357,29 @@ public static int countUnclippedReadBases(final Cigar cigar) {\n                 .sum();\n     }\n \n+    private static int countClippedBases(final Cigar cigar, final ClippingTail tail, final boolean includeSoftClips, final boolean includeHardClips) {\n+        Utils.nonNull(cigar);\n+\n+        if (cigar.numCigarElements() == 0) {\n+            return 0;\n+        }\n+\n+        Utils.validate(includeHardClips || includeSoftClips, \"no clips chosen\");\n+        final Predicate<CigarOperator> pred = !includeHardClips ? op -> op == CigarOperator.S :\n+                (includeSoftClips ? op -> op.isClipping() : op -> op == CigarOperator.H);\n+        int result = 0;\n+        for (final CigarElement elem : tail == ClippingTail.LEFT_TAIL ? cigar : Lists.reverse(cigar.getCigarElements())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "086adb20d0e407615591e57b770ece51c866ef1e"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjk2ODQ3Nw==", "bodyText": "done", "url": "https://github.com/broadinstitute/gatk/pull/6403#discussion_r382968477", "createdAt": "2020-02-23T06:24:18Z", "author": {"login": "davidbenjamin"}, "path": "src/main/java/org/broadinstitute/hellbender/utils/read/CigarUtils.java", "diffHunk": "@@ -355,6 +357,29 @@ public static int countUnclippedReadBases(final Cigar cigar) {\n                 .sum();\n     }\n \n+    private static int countClippedBases(final Cigar cigar, final ClippingTail tail, final boolean includeSoftClips, final boolean includeHardClips) {\n+        Utils.nonNull(cigar);\n+\n+        if (cigar.numCigarElements() == 0) {\n+            return 0;\n+        }\n+\n+        Utils.validate(includeHardClips || includeSoftClips, \"no clips chosen\");\n+        final Predicate<CigarOperator> pred = !includeHardClips ? op -> op == CigarOperator.S :\n+                (includeSoftClips ? op -> op.isClipping() : op -> op == CigarOperator.H);\n+        int result = 0;\n+        for (final CigarElement elem : tail == ClippingTail.LEFT_TAIL ? cigar : Lists.reverse(cigar.getCigarElements())) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDg5MTg3MQ=="}, "originalCommit": {"oid": "086adb20d0e407615591e57b770ece51c866ef1e"}, "originalPosition": 36}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxODUwMzQwOnYy", "diffSide": "RIGHT", "path": "src/main/java/org/broadinstitute/hellbender/utils/read/CigarUtils.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQyMDowMDo1NlrOFlhmoA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQyMDowMDo1NlrOFlhmoA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDg5MjE5Mg==", "bodyText": "you could replace the op.isClipping() predicate with op -> true, but that's probably more confusing than it's worth", "url": "https://github.com/broadinstitute/gatk/pull/6403#discussion_r374892192", "createdAt": "2020-02-04T20:00:56Z", "author": {"login": "lbergelson"}, "path": "src/main/java/org/broadinstitute/hellbender/utils/read/CigarUtils.java", "diffHunk": "@@ -355,6 +357,29 @@ public static int countUnclippedReadBases(final Cigar cigar) {\n                 .sum();\n     }\n \n+    private static int countClippedBases(final Cigar cigar, final ClippingTail tail, final boolean includeSoftClips, final boolean includeHardClips) {\n+        Utils.nonNull(cigar);\n+\n+        if (cigar.numCigarElements() == 0) {\n+            return 0;\n+        }\n+\n+        Utils.validate(includeHardClips || includeSoftClips, \"no clips chosen\");\n+        final Predicate<CigarOperator> pred = !includeHardClips ? op -> op == CigarOperator.S :\n+                (includeSoftClips ? op -> op.isClipping() : op -> op == CigarOperator.H);\n+        int result = 0;\n+        for (final CigarElement elem : tail == ClippingTail.LEFT_TAIL ? cigar : Lists.reverse(cigar.getCigarElements())) {\n+            final CigarOperator operator = elem.getOperator();\n+            if (!operator.isClipping()) {\n+                return result;\n+            } else if (pred.test(operator)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "086adb20d0e407615591e57b770ece51c866ef1e"}, "originalPosition": 40}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxODUwNzEyOnYy", "diffSide": "RIGHT", "path": "src/main/java/org/broadinstitute/hellbender/utils/read/CigarUtils.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQyMDowMjoxM1rOFlho9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yM1QwNjoyNjozOFrOFtOjKA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDg5Mjc5MA==", "bodyText": "How do you know it's a single soft clip?  Couldn't it be any number of any clip?", "url": "https://github.com/broadinstitute/gatk/pull/6403#discussion_r374892790", "createdAt": "2020-02-04T20:02:13Z", "author": {"login": "lbergelson"}, "path": "src/main/java/org/broadinstitute/hellbender/utils/read/CigarUtils.java", "diffHunk": "@@ -355,6 +357,29 @@ public static int countUnclippedReadBases(final Cigar cigar) {\n                 .sum();\n     }\n \n+    private static int countClippedBases(final Cigar cigar, final ClippingTail tail, final boolean includeSoftClips, final boolean includeHardClips) {\n+        Utils.nonNull(cigar);\n+\n+        if (cigar.numCigarElements() == 0) {\n+            return 0;\n+        }\n+\n+        Utils.validate(includeHardClips || includeSoftClips, \"no clips chosen\");\n+        final Predicate<CigarOperator> pred = !includeHardClips ? op -> op == CigarOperator.S :\n+                (includeSoftClips ? op -> op.isClipping() : op -> op == CigarOperator.H);\n+        int result = 0;\n+        for (final CigarElement elem : tail == ClippingTail.LEFT_TAIL ? cigar : Lists.reverse(cigar.getCigarElements())) {\n+            final CigarOperator operator = elem.getOperator();\n+            if (!operator.isClipping()) {\n+                return result;\n+            } else if (pred.test(operator)) {\n+                result += elem.getLength();\n+            }\n+        }\n+\n+        throw new IllegalArgumentException(\"Input cigar has a single soft clip region that cannot be assigned to the left or right of the read\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "086adb20d0e407615591e57b770ece51c866ef1e"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjk2ODYxNg==", "bodyText": "true, fixed", "url": "https://github.com/broadinstitute/gatk/pull/6403#discussion_r382968616", "createdAt": "2020-02-23T06:26:38Z", "author": {"login": "davidbenjamin"}, "path": "src/main/java/org/broadinstitute/hellbender/utils/read/CigarUtils.java", "diffHunk": "@@ -355,6 +357,29 @@ public static int countUnclippedReadBases(final Cigar cigar) {\n                 .sum();\n     }\n \n+    private static int countClippedBases(final Cigar cigar, final ClippingTail tail, final boolean includeSoftClips, final boolean includeHardClips) {\n+        Utils.nonNull(cigar);\n+\n+        if (cigar.numCigarElements() == 0) {\n+            return 0;\n+        }\n+\n+        Utils.validate(includeHardClips || includeSoftClips, \"no clips chosen\");\n+        final Predicate<CigarOperator> pred = !includeHardClips ? op -> op == CigarOperator.S :\n+                (includeSoftClips ? op -> op.isClipping() : op -> op == CigarOperator.H);\n+        int result = 0;\n+        for (final CigarElement elem : tail == ClippingTail.LEFT_TAIL ? cigar : Lists.reverse(cigar.getCigarElements())) {\n+            final CigarOperator operator = elem.getOperator();\n+            if (!operator.isClipping()) {\n+                return result;\n+            } else if (pred.test(operator)) {\n+                result += elem.getLength();\n+            }\n+        }\n+\n+        throw new IllegalArgumentException(\"Input cigar has a single soft clip region that cannot be assigned to the left or right of the read\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDg5Mjc5MA=="}, "originalCommit": {"oid": "086adb20d0e407615591e57b770ece51c866ef1e"}, "originalPosition": 45}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxODUxNTQxOnYy", "diffSide": "RIGHT", "path": "src/main/java/org/broadinstitute/hellbender/utils/read/CigarUtils.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQyMDowNTowOVrOFlhuSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yM1QwNjozNDo0NlrOFtOksg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDg5NDE1NA==", "bodyText": "This should note that it will also normalize the cigar in other ways?", "url": "https://github.com/broadinstitute/gatk/pull/6403#discussion_r374894154", "createdAt": "2020-02-04T20:05:09Z", "author": {"login": "lbergelson"}, "path": "src/main/java/org/broadinstitute/hellbender/utils/read/CigarUtils.java", "diffHunk": "@@ -430,4 +430,20 @@ public static int countAlignedBases(final Cigar cigar ) {\n                 .mapToInt(CigarElement::getLength)\n                 .sum();\n     }\n+\n+    /**\n+     * replace soft clips (S) with match (M) operators, merging any consecutive M's that result eg 10S10M -> 20M.\n+     */\n+    public static Cigar revertSoftClips(final Cigar originalCigar) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "184b5a5631e05e05cd7d0065e533897129ed60b6"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDg5ODE0Ng==", "bodyText": "This will explode on a read that is entirely soft clips.  I don't know if that important.", "url": "https://github.com/broadinstitute/gatk/pull/6403#discussion_r374898146", "createdAt": "2020-02-04T20:13:46Z", "author": {"login": "lbergelson"}, "path": "src/main/java/org/broadinstitute/hellbender/utils/read/CigarUtils.java", "diffHunk": "@@ -430,4 +430,20 @@ public static int countAlignedBases(final Cigar cigar ) {\n                 .mapToInt(CigarElement::getLength)\n                 .sum();\n     }\n+\n+    /**\n+     * replace soft clips (S) with match (M) operators, merging any consecutive M's that result eg 10S10M -> 20M.\n+     */\n+    public static Cigar revertSoftClips(final Cigar originalCigar) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDg5NDE1NA=="}, "originalCommit": {"oid": "184b5a5631e05e05cd7d0065e533897129ed60b6"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mjk2OTAxMA==", "bodyText": "This should note that it will also normalize the cigar in other ways?\n\ndone\n\nThis will explode on a read that is entirely soft clips. I don't know if that important.\n\nCompletely clipped reads are treated as invalid elsewhere in the code.  I think I agree with this because if you have no aligned base the read should be considered unmapped.  But also, a completely soft-clipped read will send a bunch of M elements to the CigarBuilder and not explode, I think.  Actually, you could complain about it failing to throw an error if the input cigar is completely clipped, but it don't think this method should be responsible for that.", "url": "https://github.com/broadinstitute/gatk/pull/6403#discussion_r382969010", "createdAt": "2020-02-23T06:34:46Z", "author": {"login": "davidbenjamin"}, "path": "src/main/java/org/broadinstitute/hellbender/utils/read/CigarUtils.java", "diffHunk": "@@ -430,4 +430,20 @@ public static int countAlignedBases(final Cigar cigar ) {\n                 .mapToInt(CigarElement::getLength)\n                 .sum();\n     }\n+\n+    /**\n+     * replace soft clips (S) with match (M) operators, merging any consecutive M's that result eg 10S10M -> 20M.\n+     */\n+    public static Cigar revertSoftClips(final Cigar originalCigar) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDg5NDE1NA=="}, "originalCommit": {"oid": "184b5a5631e05e05cd7d0065e533897129ed60b6"}, "originalPosition": 8}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1207, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}