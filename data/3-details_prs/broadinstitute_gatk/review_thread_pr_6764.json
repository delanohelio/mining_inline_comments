{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcyNjM1Njcz", "number": 6764, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNzowNjowNFrOEd00Bw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNzoxOTowN1rOEd1Djw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5NzA5NDQ3OnYy", "diffSide": "RIGHT", "path": ".travis.yml", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNzowNjowNFrOHJOHGQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNzowNjowNFrOHJOHGQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQzMDQyNQ==", "bodyText": "Why was this necessary?  Just precautionary?", "url": "https://github.com/broadinstitute/gatk/pull/6764#discussion_r479430425", "createdAt": "2020-08-28T17:06:04Z", "author": {"login": "lbergelson"}, "path": ".travis.yml", "diffHunk": "@@ -158,15 +158,22 @@ script:\n     fi;\n     sudo docker images;\n     echo ${TEST_TYPE};\n-    sudo mkdir -p build/reports/;\n-    sudo chmod -R a+w build/reports/;\n+    sudo rm -r ./build;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aae1ebb1908f88e9bd222bf123cb3ea78c5d9140"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5NzEyMTM3OnYy", "diffSide": "RIGHT", "path": "build_docker.sh", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNzoxNDo0OFrOHJOYAg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNzoxNDo0OFrOHJOYAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQzNDc1NA==", "bodyText": "Could you add a comment or echo here to say what this is for?", "url": "https://github.com/broadinstitute/gatk/pull/6764#discussion_r479434754", "createdAt": "2020-08-28T17:14:48Z", "author": {"login": "lbergelson"}, "path": "build_docker.sh", "diffHunk": "@@ -112,22 +112,14 @@ if [ -n \"${IS_PUSH}\" ]; then\n else\n     RELEASE=false\n fi\n-./gradlew clean collectBundleIntoDir shadowTestClassJar shadowTestJar -Drelease=$RELEASE\n-ZIPPATHGATK=$( find ./build -name \"*bundle-files-collected\" )\n-mv ${ZIPPATHGATK} ./unzippedJar\n-ZIPPATHPYTHON=$( find ./unzippedJar -name \"gatkPython*.zip\" )\n-unzip -o -j ${ZIPPATHPYTHON} -d ./unzippedJar/scripts\n-\n-mkdir ${STAGING_ABSOLUTE_PATH:-.}/testJars\n-mv $( find ./build/libs/ -name \"gatk*test.jar\" ) ${STAGING_ABSOLUTE_PATH:-.}/testJars\n-mv $( find ./build/libs/ -name \"gatk*testDependencies.jar\" ) ${STAGING_ABSOLUTE_PATH:-.}/testJars\n \n echo \"Building image to tag ${REPO_PRJ}:${GITHUB_TAG}...\"\n if [ -n \"${IS_PUSH}\" ]; then\n-    docker build -t ${REPO_PRJ}:${GITHUB_TAG} --squash --build-arg ZIPPATH=./unzippedJar .\n+    docker build -t ${REPO_PRJ}:${GITHUB_TAG} --squash .\n else\n-    docker build -t ${REPO_PRJ}:${GITHUB_TAG} --build-arg ZIPPATH=./unzippedJar .\n+    docker build -t ${REPO_PRJ}:${GITHUB_TAG} .\n fi\n+docker image prune -f --filter label=stage=gatkIntermediateBuildImage", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aae1ebb1908f88e9bd222bf123cb3ea78c5d9140"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5NzEyNzY4OnYy", "diffSide": "RIGHT", "path": ".travis.yml", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNzoxNjo1N1rOHJOb9A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNzoxNjo1N1rOHJOb9A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQzNTc2NA==", "bodyText": "Could you add some comments here explaining what this is for?", "url": "https://github.com/broadinstitute/gatk/pull/6764#discussion_r479435764", "createdAt": "2020-08-28T17:16:57Z", "author": {"login": "lbergelson"}, "path": ".travis.yml", "diffHunk": "@@ -158,15 +158,22 @@ script:\n     fi;\n     sudo docker images;\n     echo ${TEST_TYPE};\n-    sudo mkdir -p build/reports/;\n-    sudo chmod -R a+w build/reports/;\n+    sudo rm -r ./build;\n+    ./gradlew clean shadowTestClassJar shadowTestJar;\n+    mkdir ./testJars;\n+    echo $( find ./build/libs/ -name \"gatk*test.jar\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aae1ebb1908f88e9bd222bf123cb3ea78c5d9140"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5NzEzMzE3OnYy", "diffSide": "RIGHT", "path": "src/test/java/org/broadinstitute/hellbender/engine/PipelineSupportIntegrationTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNzoxODo0NlrOHJOfVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNzoxODo0NlrOHJOfVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQzNjYyOA==", "bodyText": "We should be careful about this substitution.  Can you have it default to ./gatk if it doesn't exist?", "url": "https://github.com/broadinstitute/gatk/pull/6764#discussion_r479436628", "createdAt": "2020-08-28T17:18:46Z", "author": {"login": "lbergelson"}, "path": "src/test/java/org/broadinstitute/hellbender/engine/PipelineSupportIntegrationTest.java", "diffHunk": "@@ -16,8 +16,8 @@\n     // Asserting that Picard programs are able to pipe their output without errors\n     public void testPipeForPicardTools() {\n         File output = createTempFile(\"testOutput\",\".bam\");\n-        BaseTest.runProcess(ProcessController.getThreadLocal(), new String[]{\"/bin/sh\",\"-c\",\" ./gatk SortSam -I \"+INPUT_BAM+\" -O /dev/stdout -SO coordinate \" +\n-                \"| ./gatk SetNmMdAndUqTags -I /dev/stdin -O \"+ output.getAbsolutePath()+ \" --CREATE_INDEX true -R \"+b37_reference_20_21});//.split(\" \"));\n+        BaseTest.runProcess(ProcessController.getThreadLocal(), new String[]{\"/bin/sh\",\"-c\",\" ${GATK_LAUNCH_SCRIPT} SortSam -I \"+INPUT_BAM+\" -O /dev/stdout -SO coordinate \" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aae1ebb1908f88e9bd222bf123cb3ea78c5d9140"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5NzEzNDIzOnYy", "diffSide": "RIGHT", "path": "Dockerfile", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNzoxOTowN1rOHJOgAg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNzoxOTowN1rOHJOgAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQzNjgwMg==", "bodyText": "comments about the test jar would be useful to explain that it's necessary plumbing for tests but not for the build itself", "url": "https://github.com/broadinstitute/gatk/pull/6764#discussion_r479436802", "createdAt": "2020-08-28T17:19:07Z", "author": {"login": "lbergelson"}, "path": "Dockerfile", "diffHunk": "@@ -1,13 +1,28 @@\n-# Using OpenJDK 8\n-FROM broadinstitute/gatk:gatkbase-2.3.0\n+# stage 1 for constructing the GATK zip\n+FROM broadinstitute/gatk:gatkbase-2.3.0 AS gradleBuild\n+LABEL stage=gatkIntermediateBuildImage\n \n-# Location of the unzipped gatk bundle files\n-ARG ZIPPATH\n+RUN ls .\n+ADD . /gatk\n+WORKDIR /gatk\n+\n+RUN export GRADLE_OPTS=\"-Xmx4048m -Dorg.gradle.daemon=false\" && /gatk/gradlew clean collectBundleIntoDir shadowTestClassJar shadowTestJar -Drelease=$RELEASE\n+RUN cp -r $( find /gatk/build -name \"*bundle-files-collected\" )/ /gatk/unzippedJar/\n+RUN unzip -o -j $( find /gatk/unzippedJar -name \"gatkPython*.zip\" ) -d /gatk/unzippedJar/scripts", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aae1ebb1908f88e9bd222bf123cb3ea78c5d9140"}, "originalPosition": 15}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1042, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}