{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM4OTY5NTUw", "number": 6675, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxNTo1NToxN1rOEIbavQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNToyMToxMFrOEJK8nQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3MjczMjc3OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/broadinstitute/hellbender/engine/FeatureDataSource.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxNTo1NToxN1rOGoYnjg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQwMDowMDoyOVrOGpPo2g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDk5OTU2Ng==", "bodyText": "Perhaps you should just normalize the workspace to end with a slash on tool startup?", "url": "https://github.com/broadinstitute/gatk/pull/6675#discussion_r444999566", "createdAt": "2020-06-24T15:55:17Z", "author": {"login": "droazen"}, "path": "src/main/java/org/broadinstitute/hellbender/engine/FeatureDataSource.java", "diffHunk": "@@ -387,8 +387,8 @@ final void printCacheStats() {\n     protected static FeatureReader<VariantContext> getGenomicsDBFeatureReader(final GATKPath path, final File reference, final GenomicsDBOptions genomicsDBOptions) {\n         final String workspace = IOUtils.getGenomicsDBAbsolutePath(path) ;\n         if (workspace == null) {\n-            throw new IllegalArgumentException(\"Trying to create a GenomicsDBReader from  non-GenomicsDB inputpath \" + path);\n-        } else if (Files.notExists(IOUtils.getPath(workspace))) {\n+            throw new IllegalArgumentException(\"Trying to create a GenomicsDBReader from  non-GenomicsDB input path \" + path);\n+        } else if (Files.notExists(IOUtils.getPath(workspace.endsWith(\"/\")?workspace:workspace+\"/\"))) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d7840b93b3131498c2d1769118fa1d3dd02b7b56"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTAxODQxNg==", "bodyText": "Sure, I can remove the check here.", "url": "https://github.com/broadinstitute/gatk/pull/6675#discussion_r445018416", "createdAt": "2020-06-24T16:24:50Z", "author": {"login": "nalinigans"}, "path": "src/main/java/org/broadinstitute/hellbender/engine/FeatureDataSource.java", "diffHunk": "@@ -387,8 +387,8 @@ final void printCacheStats() {\n     protected static FeatureReader<VariantContext> getGenomicsDBFeatureReader(final GATKPath path, final File reference, final GenomicsDBOptions genomicsDBOptions) {\n         final String workspace = IOUtils.getGenomicsDBAbsolutePath(path) ;\n         if (workspace == null) {\n-            throw new IllegalArgumentException(\"Trying to create a GenomicsDBReader from  non-GenomicsDB inputpath \" + path);\n-        } else if (Files.notExists(IOUtils.getPath(workspace))) {\n+            throw new IllegalArgumentException(\"Trying to create a GenomicsDBReader from  non-GenomicsDB input path \" + path);\n+        } else if (Files.notExists(IOUtils.getPath(workspace.endsWith(\"/\")?workspace:workspace+\"/\"))) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDk5OTU2Ng=="}, "originalCommit": {"oid": "d7840b93b3131498c2d1769118fa1d3dd02b7b56"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTkwMTAxOA==", "bodyText": "Done.", "url": "https://github.com/broadinstitute/gatk/pull/6675#discussion_r445901018", "createdAt": "2020-06-26T00:00:29Z", "author": {"login": "nalinigans"}, "path": "src/main/java/org/broadinstitute/hellbender/engine/FeatureDataSource.java", "diffHunk": "@@ -387,8 +387,8 @@ final void printCacheStats() {\n     protected static FeatureReader<VariantContext> getGenomicsDBFeatureReader(final GATKPath path, final File reference, final GenomicsDBOptions genomicsDBOptions) {\n         final String workspace = IOUtils.getGenomicsDBAbsolutePath(path) ;\n         if (workspace == null) {\n-            throw new IllegalArgumentException(\"Trying to create a GenomicsDBReader from  non-GenomicsDB inputpath \" + path);\n-        } else if (Files.notExists(IOUtils.getPath(workspace))) {\n+            throw new IllegalArgumentException(\"Trying to create a GenomicsDBReader from  non-GenomicsDB input path \" + path);\n+        } else if (Files.notExists(IOUtils.getPath(workspace.endsWith(\"/\")?workspace:workspace+\"/\"))) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDk5OTU2Ng=="}, "originalCommit": {"oid": "d7840b93b3131498c2d1769118fa1d3dd02b7b56"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3Mjc4MTM2OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/broadinstitute/hellbender/tools/genomicsdb/GenomicsDBArgumentCollection.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxNjowNzoyN1rOGoZGtg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxNjo1NToyNFrOGoa5zQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTAwNzU0Mg==", "bodyText": "I notice that this argument does not control which codec is used in GenomicsDBImport.getReaderFromPath(), which is hardcoded to use a VCFCodec. Should this argument affect the codec used in GenomicsDBImport?", "url": "https://github.com/broadinstitute/gatk/pull/6675#discussion_r445007542", "createdAt": "2020-06-24T16:07:27Z", "author": {"login": "droazen"}, "path": "src/main/java/org/broadinstitute/hellbender/tools/genomicsdb/GenomicsDBArgumentCollection.java", "diffHunk": "@@ -8,11 +8,11 @@\n \n public class GenomicsDBArgumentCollection implements Serializable {\n   private static final long serialVersionUID = 1L;\n-  public static final String USE_VCF_CODEC_LONG_NAME = \"genomicsdb-use-vcf-codec\";\n+  public static final String USE_BCF_CODEC_LONG_NAME = \"genomicsdb-use-bcf-codec\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d7840b93b3131498c2d1769118fa1d3dd02b7b56"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTAzNzAwNQ==", "bodyText": "This does not apply to GenomicsDBImport as VCFCodec is hardcoded there - see GenomicsDBImport.java#L833 as you mention. I am guessing this is because the --variant/-V option for GenomicsDBImport mentions only vcf files as inputs. However, GenomicsDB itself can accept either vcf/bcf files and if we allow bcf files as inputs in the future, it will be the tool deciding the Codec and not the user.", "url": "https://github.com/broadinstitute/gatk/pull/6675#discussion_r445037005", "createdAt": "2020-06-24T16:55:24Z", "author": {"login": "nalinigans"}, "path": "src/main/java/org/broadinstitute/hellbender/tools/genomicsdb/GenomicsDBArgumentCollection.java", "diffHunk": "@@ -8,11 +8,11 @@\n \n public class GenomicsDBArgumentCollection implements Serializable {\n   private static final long serialVersionUID = 1L;\n-  public static final String USE_VCF_CODEC_LONG_NAME = \"genomicsdb-use-vcf-codec\";\n+  public static final String USE_BCF_CODEC_LONG_NAME = \"genomicsdb-use-bcf-codec\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTAwNzU0Mg=="}, "originalCommit": {"oid": "d7840b93b3131498c2d1769118fa1d3dd02b7b56"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc3Mjc5NTA3OnYy", "diffSide": "RIGHT", "path": "src/test/java/org/broadinstitute/hellbender/tools/walkers/GnarlyGenotyperIntegrationTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxNjoxMDo1NVrOGoZPUQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQwMDowMDo0M1rOGpPpJQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTAwOTc0NQ==", "bodyText": "Can you add at least one integration test for GenotypeGVCFs that uses the BCF codec?\nAlso for GenotypeGVCFs, do you have a simple test case with a 64-bit value that fails with BCF and passes with VCF? If so, it would be good to have both a positive test case with VCF that passes and a negative test case with BCF that fails with an expected exception.", "url": "https://github.com/broadinstitute/gatk/pull/6675#discussion_r445009745", "createdAt": "2020-06-24T16:10:55Z", "author": {"login": "droazen"}, "path": "src/test/java/org/broadinstitute/hellbender/tools/walkers/GnarlyGenotyperIntegrationTest.java", "diffHunk": "@@ -37,28 +37,28 @@\n                 //No variants outside requested intervals; no SNPs with QUAL < 60, no INDELs with QUAL < 69?; has star alleles after deletion at chr20:263497; has AC, AF, AN, DP, ExcessHet, FS, MQ, (MQRankSum), (ReadPosRankSum), SOR, QD; has called genotypes\n                 {new File[]{getTestFile(\"sample1.vcf\"), getTestFile(\"sample2.vcf\"), getTestFile(\"sample3.vcf\"), getTestFile(\"sample4.vcf\"), getTestFile(\"sample5.vcf\")},\n                          getTestFile(\"fiveSampleTest.vcf\"), null, Arrays.asList(new SimpleInterval(\"chr20\", 251370, 252000), new SimpleInterval(\"chr20\", 263000, 265600)), Arrays.asList(\"--merge-input-intervals\", \"--only-output-calls-starting-in-intervals\"), b38_reference_20_21},\n-                // Same as above, but with GenomicsDB using VCFCodec for interchange\n+                // Same as above, but with GenomicsDB using BCF2Codec for interchange\n                 {new File[]{getTestFile(\"sample1.vcf\"), getTestFile(\"sample2.vcf\"), getTestFile(\"sample3.vcf\"), getTestFile(\"sample4.vcf\"), getTestFile(\"sample5.vcf\")},\n-                         getTestFile(\"fiveSampleTest.vcf\"), null, Arrays.asList(new SimpleInterval(\"chr20\", 251370, 252000), new SimpleInterval(\"chr20\", 263000, 265600)), Arrays.asList(\"--merge-input-intervals\", \"--only-output-calls-starting-in-intervals\", \"--genomicsdb-use-vcf-codec\"), b38_reference_20_21},\n+                         getTestFile(\"fiveSampleTest.vcf\"), null, Arrays.asList(new SimpleInterval(\"chr20\", 251370, 252000), new SimpleInterval(\"chr20\", 263000, 265600)), Arrays.asList(\"--merge-input-intervals\", \"--only-output-calls-starting-in-intervals\", \"--genomicsdb-use-bcf-codec\"), b38_reference_20_21},", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d7840b93b3131498c2d1769118fa1d3dd02b7b56"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTkwMTA5Mw==", "bodyText": "Done.", "url": "https://github.com/broadinstitute/gatk/pull/6675#discussion_r445901093", "createdAt": "2020-06-26T00:00:43Z", "author": {"login": "nalinigans"}, "path": "src/test/java/org/broadinstitute/hellbender/tools/walkers/GnarlyGenotyperIntegrationTest.java", "diffHunk": "@@ -37,28 +37,28 @@\n                 //No variants outside requested intervals; no SNPs with QUAL < 60, no INDELs with QUAL < 69?; has star alleles after deletion at chr20:263497; has AC, AF, AN, DP, ExcessHet, FS, MQ, (MQRankSum), (ReadPosRankSum), SOR, QD; has called genotypes\n                 {new File[]{getTestFile(\"sample1.vcf\"), getTestFile(\"sample2.vcf\"), getTestFile(\"sample3.vcf\"), getTestFile(\"sample4.vcf\"), getTestFile(\"sample5.vcf\")},\n                          getTestFile(\"fiveSampleTest.vcf\"), null, Arrays.asList(new SimpleInterval(\"chr20\", 251370, 252000), new SimpleInterval(\"chr20\", 263000, 265600)), Arrays.asList(\"--merge-input-intervals\", \"--only-output-calls-starting-in-intervals\"), b38_reference_20_21},\n-                // Same as above, but with GenomicsDB using VCFCodec for interchange\n+                // Same as above, but with GenomicsDB using BCF2Codec for interchange\n                 {new File[]{getTestFile(\"sample1.vcf\"), getTestFile(\"sample2.vcf\"), getTestFile(\"sample3.vcf\"), getTestFile(\"sample4.vcf\"), getTestFile(\"sample5.vcf\")},\n-                         getTestFile(\"fiveSampleTest.vcf\"), null, Arrays.asList(new SimpleInterval(\"chr20\", 251370, 252000), new SimpleInterval(\"chr20\", 263000, 265600)), Arrays.asList(\"--merge-input-intervals\", \"--only-output-calls-starting-in-intervals\", \"--genomicsdb-use-vcf-codec\"), b38_reference_20_21},\n+                         getTestFile(\"fiveSampleTest.vcf\"), null, Arrays.asList(new SimpleInterval(\"chr20\", 251370, 252000), new SimpleInterval(\"chr20\", 263000, 265600)), Arrays.asList(\"--merge-input-intervals\", \"--only-output-calls-starting-in-intervals\", \"--genomicsdb-use-bcf-codec\"), b38_reference_20_21},", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTAwOTc0NQ=="}, "originalCommit": {"oid": "d7840b93b3131498c2d1769118fa1d3dd02b7b56"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4MDUxOTk3OnYy", "diffSide": "LEFT", "path": "src/main/java/org/broadinstitute/hellbender/engine/FeatureDataSource.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNToyMToxMFrOGpk6Qg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNlQxNjoxNzoyMFrOGpmz7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI0OTUzOA==", "bodyText": "I wasn't actually suggesting that you remove this check completely, as I think it's a necessary check -- just that it might be better to normalize the workspace name to end with a slash at an earlier point in the code, if we can't handle lack of a trailing slash.\nSince time is short and the rest of the PR looks good, I am going to restore the previous version of this line via a separate commit.", "url": "https://github.com/broadinstitute/gatk/pull/6675#discussion_r446249538", "createdAt": "2020-06-26T15:21:10Z", "author": {"login": "droazen"}, "path": "src/main/java/org/broadinstitute/hellbender/engine/FeatureDataSource.java", "diffHunk": "@@ -387,9 +387,7 @@ final void printCacheStats() {\n     protected static FeatureReader<VariantContext> getGenomicsDBFeatureReader(final GATKPath path, final File reference, final GenomicsDBOptions genomicsDBOptions) {\n         final String workspace = IOUtils.getGenomicsDBAbsolutePath(path) ;\n         if (workspace == null) {\n-            throw new IllegalArgumentException(\"Trying to create a GenomicsDBReader from  non-GenomicsDB inputpath \" + path);\n-        } else if (Files.notExists(IOUtils.getPath(workspace))) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "20c2dcd11c2c1eca60c67bd14c6f584924c73133"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI4MDY4Nw==", "bodyText": "I will move the normalization to IOUtils.getGenomicsDBAbsolutePath() in a future PR. Thanks.", "url": "https://github.com/broadinstitute/gatk/pull/6675#discussion_r446280687", "createdAt": "2020-06-26T16:17:20Z", "author": {"login": "nalinigans"}, "path": "src/main/java/org/broadinstitute/hellbender/engine/FeatureDataSource.java", "diffHunk": "@@ -387,9 +387,7 @@ final void printCacheStats() {\n     protected static FeatureReader<VariantContext> getGenomicsDBFeatureReader(final GATKPath path, final File reference, final GenomicsDBOptions genomicsDBOptions) {\n         final String workspace = IOUtils.getGenomicsDBAbsolutePath(path) ;\n         if (workspace == null) {\n-            throw new IllegalArgumentException(\"Trying to create a GenomicsDBReader from  non-GenomicsDB inputpath \" + path);\n-        } else if (Files.notExists(IOUtils.getPath(workspace))) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI0OTUzOA=="}, "originalCommit": {"oid": "20c2dcd11c2c1eca60c67bd14c6f584924c73133"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 996, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}