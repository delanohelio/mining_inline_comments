{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk4MzMzNTIx", "number": 6537, "title": "Ignore specified contigs for pre-aligned BAMs in PathSeq", "bodyText": "Adds an argument to PathSeq filtering that lets users specify any contigs that should be ignored. This is useful for BAMs aligned to hg38, which contains the Epstein-Barr virus (chrEBV).", "createdAt": "2020-04-03T18:55:03Z", "url": "https://github.com/broadinstitute/gatk/pull/6537", "merged": true, "mergeCommit": {"oid": "3a7ee7e7d7bdf6f1591fc44a2ec2ad9c2c1638da"}, "closed": true, "closedAt": "2020-05-04T18:27:03Z", "author": {"login": "mwalker174"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcX8op5gFqTM5NDAzODQzMg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABceB_zGABqjMzMDA2NjYzMDU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk0MDM4NDMy", "url": "https://github.com/broadinstitute/gatk/pull/6537#pullrequestreview-394038432", "createdAt": "2020-04-15T18:41:47Z", "commit": {"oid": "74b08a03ffbad5e7aca757c4200cbd87728f8682"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxODo0MTo0N1rOGGGwvQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQxODo0NDowOFrOGGG2GA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTA1NTQyMQ==", "bodyText": "I'd like for the error to specify somehow is that the problem is the contigs specified for filtering.  Otherwise users will be validating all their input files and scratching their heads.", "url": "https://github.com/broadinstitute/gatk/pull/6537#discussion_r409055421", "createdAt": "2020-04-15T18:41:47Z", "author": {"login": "ldgauthier"}, "path": "src/main/java/org/broadinstitute/hellbender/tools/spark/pathseq/PSFilter.java", "diffHunk": "@@ -170,6 +173,21 @@ private static GATKRead clearReadAlignment(final GATKRead read, final SAMFileHea\n                 });\n     }\n \n+    /**\n+     * Validate arguments\n+     */\n+    private void validateFilterArguments() {\n+        final SAMSequenceDictionary dictionary = header.getSequenceDictionary();\n+        if (filterArgs.alignedInput) {\n+            final Set<String> contigsToIgnoreSet = new HashSet<>(filterArgs.alignmentContigsToIgnore);\n+            for (final String contig : contigsToIgnoreSet) {\n+                if (dictionary.getSequence(contig) == null) {\n+                    throw new UserException.MissingContigInSequenceDictionary(contig, dictionary);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "74b08a03ffbad5e7aca757c4200cbd87728f8682"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTA1NjEyNg==", "bodyText": "Is it really called chrEBV?  Honestly I haven't looked at all 3500 names.", "url": "https://github.com/broadinstitute/gatk/pull/6537#discussion_r409056126", "createdAt": "2020-04-15T18:42:58Z", "author": {"login": "ldgauthier"}, "path": "src/main/java/org/broadinstitute/hellbender/tools/spark/pathseq/PSFilterArgumentCollection.java", "diffHunk": "@@ -190,6 +193,16 @@\n             optional = true)\n     public int minIdentity = 30;\n \n+    /**\n+     * If using --is-host-aligned, ignores alignments to these contigs (can be specified multiple times). This\n+     * can be useful if the alignment is to a reference containing a microbe, such as chrEBV in hg38.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "74b08a03ffbad5e7aca757c4200cbd87728f8682"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTA1Njc5Mg==", "bodyText": "I prefer Assert.assertTrue and Assert.assertFalse (below)", "url": "https://github.com/broadinstitute/gatk/pull/6537#discussion_r409056792", "createdAt": "2020-04-15T18:44:08Z", "author": {"login": "ldgauthier"}, "path": "src/test/java/org/broadinstitute/hellbender/tools/spark/pathseq/HostAlignmentReadFilterTest.java", "diffHunk": "@@ -73,13 +75,50 @@ public void testUnmappedRead() {\n         Assert.assertEquals(true, test_i);\n     }\n \n+    @Test\n+    public void testIgnoredContig() {\n+        final Set<String> ignoredContigSet = Sets.newHashSet(IGNORED_CONTIG);\n+        final HostAlignmentReadFilter filter = new HostAlignmentReadFilter(MIN_IDENTITY, ignoredContigSet);\n+        final byte[] bases = new byte[100];\n+        final byte[] qual = new byte[100];\n+        Arrays.fill(bases, (byte) 'A');\n+        Arrays.fill(qual, (byte) 30);\n+\n+        // Mapped fully to ignored contig\n+        final GATKRead readA = ArtificialReadUtils.createArtificialRead(bases, qual, \"100M\");\n+        readA.setAttribute(\"NM\", 0);\n+        readA.setPosition(IGNORED_CONTIG, 1);\n+        final boolean testA = filter.test(readA);\n+        Assert.assertEquals(true, testA);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "74b08a03ffbad5e7aca757c4200cbd87728f8682"}, "originalPosition": 46}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c9a36fe6153752112b62971ca127966bd61b2780", "author": {"user": {"login": "mwalker174", "name": "Mark Walker"}}, "url": "https://github.com/broadinstitute/gatk/commit/c9a36fe6153752112b62971ca127966bd61b2780", "committedDate": "2020-05-04T16:22:41Z", "message": "Add ignored contigs to host read filter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8891594718ee7304e52dc27336071e9ff9c52139", "author": {"user": {"login": "mwalker174", "name": "Mark Walker"}}, "url": "https://github.com/broadinstitute/gatk/commit/8891594718ee7304e52dc27336071e9ff9c52139", "committedDate": "2020-05-04T16:22:41Z", "message": "Delete unused validate function"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4514c2ed06b5a4a1dc228d1e492fc643570e4ddc", "author": {"user": {"login": "mwalker174", "name": "Mark Walker"}}, "url": "https://github.com/broadinstitute/gatk/commit/4514c2ed06b5a4a1dc228d1e492fc643570e4ddc", "committedDate": "2020-05-04T16:22:41Z", "message": "Address reviewer comments"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "74b08a03ffbad5e7aca757c4200cbd87728f8682", "author": {"user": {"login": "mwalker174", "name": "Mark Walker"}}, "url": "https://github.com/broadinstitute/gatk/commit/74b08a03ffbad5e7aca757c4200cbd87728f8682", "committedDate": "2020-04-03T16:52:51Z", "message": "Delete unused validate function"}, "afterCommit": {"oid": "4514c2ed06b5a4a1dc228d1e492fc643570e4ddc", "author": {"user": {"login": "mwalker174", "name": "Mark Walker"}}, "url": "https://github.com/broadinstitute/gatk/commit/4514c2ed06b5a4a1dc228d1e492fc643570e4ddc", "committedDate": "2020-05-04T16:22:41Z", "message": "Address reviewer comments"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2844, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}