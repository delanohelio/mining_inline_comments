{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg3Mzg2NjIz", "number": 6499, "reviewThreads": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxOTowNjo1OVrOEGEnFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQxNTo1MzozMVrOFEDIiw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc0ODAyNDUyOnYy", "diffSide": "RIGHT", "path": "src/main/java/org/broadinstitute/hellbender/tools/copynumber/ModelSegments.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxOTowNjo1OVrOGkpYRw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNi0wOVQxNTowMjozOFrOJqXPJg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTA3OTg3OQ==", "bodyText": "Let's use explicit imports.", "url": "https://github.com/broadinstitute/gatk/pull/6499#discussion_r441079879", "createdAt": "2020-06-16T19:06:59Z", "author": {"login": "fleharty"}, "path": "src/main/java/org/broadinstitute/hellbender/tools/copynumber/ModelSegments.java", "diffHunk": "@@ -1,46 +1,56 @@\n package org.broadinstitute.hellbender.tools.copynumber;\n \n+import com.google.common.collect.ImmutableList;\n import com.google.common.collect.ImmutableSet;\n+import htsjdk.samtools.SAMSequenceDictionary;\n+import htsjdk.samtools.util.Interval;\n+import htsjdk.samtools.util.IntervalList;\n import htsjdk.samtools.util.OverlapDetector;\n-import org.apache.commons.math3.special.Beta;\n-import org.apache.commons.math3.util.FastMath;\n+import org.broadinstitute.barclay.argparser.Advanced;\n import org.broadinstitute.barclay.argparser.Argument;\n+import org.broadinstitute.barclay.argparser.ArgumentCollection;\n import org.broadinstitute.barclay.argparser.CommandLineProgramProperties;\n import org.broadinstitute.barclay.help.DocumentedFeature;\n import org.broadinstitute.hellbender.cmdline.CommandLineProgram;\n import org.broadinstitute.hellbender.cmdline.StandardArgumentDefinitions;\n import org.broadinstitute.hellbender.cmdline.programgroups.CopyNumberProgramGroup;\n-import org.broadinstitute.hellbender.exceptions.UserException;\n-import org.broadinstitute.hellbender.tools.copynumber.arguments.CopyNumberArgumentValidationUtils;\n-import org.broadinstitute.hellbender.tools.copynumber.arguments.CopyNumberStandardArgument;\n+import org.broadinstitute.hellbender.exceptions.GATKException;\n+import org.broadinstitute.hellbender.tools.copynumber.arguments.*;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1dba22a70a8207ae438f75f3d3092e3e78f9b3bf"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0ODQwMDY3OA==", "bodyText": "OK, optimized with explicit imports across source/test code in the copynumber package.", "url": "https://github.com/broadinstitute/gatk/pull/6499#discussion_r648400678", "createdAt": "2021-06-09T15:02:38Z", "author": {"login": "samuelklee"}, "path": "src/main/java/org/broadinstitute/hellbender/tools/copynumber/ModelSegments.java", "diffHunk": "@@ -1,46 +1,56 @@\n package org.broadinstitute.hellbender.tools.copynumber;\n \n+import com.google.common.collect.ImmutableList;\n import com.google.common.collect.ImmutableSet;\n+import htsjdk.samtools.SAMSequenceDictionary;\n+import htsjdk.samtools.util.Interval;\n+import htsjdk.samtools.util.IntervalList;\n import htsjdk.samtools.util.OverlapDetector;\n-import org.apache.commons.math3.special.Beta;\n-import org.apache.commons.math3.util.FastMath;\n+import org.broadinstitute.barclay.argparser.Advanced;\n import org.broadinstitute.barclay.argparser.Argument;\n+import org.broadinstitute.barclay.argparser.ArgumentCollection;\n import org.broadinstitute.barclay.argparser.CommandLineProgramProperties;\n import org.broadinstitute.barclay.help.DocumentedFeature;\n import org.broadinstitute.hellbender.cmdline.CommandLineProgram;\n import org.broadinstitute.hellbender.cmdline.StandardArgumentDefinitions;\n import org.broadinstitute.hellbender.cmdline.programgroups.CopyNumberProgramGroup;\n-import org.broadinstitute.hellbender.exceptions.UserException;\n-import org.broadinstitute.hellbender.tools.copynumber.arguments.CopyNumberArgumentValidationUtils;\n-import org.broadinstitute.hellbender.tools.copynumber.arguments.CopyNumberStandardArgument;\n+import org.broadinstitute.hellbender.exceptions.GATKException;\n+import org.broadinstitute.hellbender.tools.copynumber.arguments.*;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTA3OTg3OQ=="}, "originalCommit": {"oid": "1dba22a70a8207ae438f75f3d3092e3e78f9b3bf"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM1MzIwODQ0OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/broadinstitute/hellbender/tools/copynumber/arguments/CopyNumberArgumentValidationUtils.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQxOTo1OTo1OFrOH9r5mw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQxOTo1OTo1OFrOH9r5mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDQ0NDQ0Mw==", "bodyText": "Explicit imports.", "url": "https://github.com/broadinstitute/gatk/pull/6499#discussion_r534444443", "createdAt": "2020-12-02T19:59:58Z", "author": {"login": "fleharty"}, "path": "src/main/java/org/broadinstitute/hellbender/tools/copynumber/arguments/CopyNumberArgumentValidationUtils.java", "diffHunk": "@@ -3,16 +3,15 @@\n import com.google.common.collect.Ordering;\n import htsjdk.samtools.SAMSequenceDictionary;\n import htsjdk.samtools.util.Locatable;\n+import org.apache.logging.log4j.LogManager;\n import org.apache.logging.log4j.Logger;\n import org.broadinstitute.hellbender.cmdline.argumentcollections.IntervalArgumentCollection;\n import org.broadinstitute.hellbender.exceptions.UserException;\n import org.broadinstitute.hellbender.tools.copynumber.DetermineGermlineContigPloidy;\n import org.broadinstitute.hellbender.tools.copynumber.GermlineCNVCaller;\n-import org.broadinstitute.hellbender.tools.copynumber.formats.collections.AbstractLocatableCollection;\n-import org.broadinstitute.hellbender.tools.copynumber.formats.collections.AnnotatedIntervalCollection;\n-import org.broadinstitute.hellbender.tools.copynumber.formats.collections.SimpleCountCollection;\n-import org.broadinstitute.hellbender.tools.copynumber.formats.collections.SimpleIntervalCollection;\n+import org.broadinstitute.hellbender.tools.copynumber.formats.collections.*;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1dba22a70a8207ae438f75f3d3092e3e78f9b3bf"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM1MzIwOTA3OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/broadinstitute/hellbender/tools/copynumber/arguments/CopyNumberArgumentValidationUtils.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQyMDowMDoxMFrOH9r6Bg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQyMDowMDoxMFrOH9r6Bg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDQ0NDU1MA==", "bodyText": "Explicit imports", "url": "https://github.com/broadinstitute/gatk/pull/6499#discussion_r534444550", "createdAt": "2020-12-02T20:00:10Z", "author": {"login": "fleharty"}, "path": "src/main/java/org/broadinstitute/hellbender/tools/copynumber/arguments/CopyNumberArgumentValidationUtils.java", "diffHunk": "@@ -22,10 +21,7 @@\n \n import java.io.File;\n import java.io.IOException;\n-import java.util.HashSet;\n-import java.util.List;\n-import java.util.OptionalInt;\n-import java.util.Set;\n+import java.util.*;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1dba22a70a8207ae438f75f3d3092e3e78f9b3bf"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM1MzQ1MjAxOnYy", "diffSide": "RIGHT", "path": "src/main/java/org/broadinstitute/hellbender/tools/copynumber/arguments/CopyNumberArgumentValidationUtils.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQyMTowODoyMlrOH9uNiQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNi0wOVQxNDo1ODoyMlrOJqW_3g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDQ4MjMxMw==", "bodyText": "This seems more like an error to me.  Is there a situation where you might like to allow sequence dictionaries to not match?", "url": "https://github.com/broadinstitute/gatk/pull/6499#discussion_r534482313", "createdAt": "2020-12-02T21:08:22Z", "author": {"login": "fleharty"}, "path": "src/main/java/org/broadinstitute/hellbender/tools/copynumber/arguments/CopyNumberArgumentValidationUtils.java", "diffHunk": "@@ -121,6 +120,41 @@ public static SimpleIntervalCollection resolveIntervals(final String readCountPa\n         return new SimpleIntervalCollection(metadata, intervals);\n     }\n \n+    /**\n+     * For all non-null inputs, validate that all metadata are identical and return the metadata.\n+     */\n+    @SafeVarargs\n+    @SuppressWarnings({\"varargs\"})\n+    public static <METADATA extends Metadata> METADATA getValidatedMetadata(final AbstractRecordCollection<METADATA, ?> ... recordCollections) {\n+        Utils.nonNull(recordCollections);\n+        final Set<METADATA> metadataSet = Stream.of(recordCollections)\n+                .filter(Objects::nonNull)\n+                .map(AbstractRecordCollection::getMetadata)\n+                .collect(Collectors.toSet());\n+        Utils.nonEmpty(metadataSet, \"At least one collection must be non-null.\");\n+        Utils.validateArg(metadataSet.size() == 1, \"Metadata do not match.\");\n+        return metadataSet.stream().findFirst().get();\n+    }\n+\n+    /**\n+     * For all non-null inputs, validate that all sequence dictionaries match (using {@link #isSameDictionary})\n+     * and return the sequence dictionary; otherwise, emit a warning.\n+     */\n+    public static SAMSequenceDictionary getValidatedSequenceDictionary(final AbstractLocatableCollection<?, ?> ... locatableCollections) {\n+        Utils.nonNull(locatableCollections);\n+        final List<SAMSequenceDictionary> sequenceDictionaries = Stream.of(locatableCollections)\n+                .filter(Objects::nonNull)\n+                .map(AbstractLocatableCollection::getMetadata)\n+                .map(LocatableMetadata::getSequenceDictionary)\n+                .collect(Collectors.toList());\n+        Utils.nonEmpty(sequenceDictionaries, \"At least one collection must be non-null.\");\n+        if (!IntStream.range(0, sequenceDictionaries.size() - 1).\n+                allMatch(i -> CopyNumberArgumentValidationUtils.isSameDictionary(sequenceDictionaries.get(i), sequenceDictionaries.get(i + 1)))) {\n+            logger.warn(\"Sequence dictionaries do not match across all inputs.\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1dba22a70a8207ae438f75f3d3092e3e78f9b3bf"}, "originalPosition": 83}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0ODM5Njc2Ng==", "bodyText": "I think requiring sequence dictionaries to match even caused issues in TCGA data at some point. I think there are some discussions from long ago in the dsde-methods Slack about how strict we should be about this sort of thing, generally.", "url": "https://github.com/broadinstitute/gatk/pull/6499#discussion_r648396766", "createdAt": "2021-06-09T14:58:22Z", "author": {"login": "samuelklee"}, "path": "src/main/java/org/broadinstitute/hellbender/tools/copynumber/arguments/CopyNumberArgumentValidationUtils.java", "diffHunk": "@@ -121,6 +120,41 @@ public static SimpleIntervalCollection resolveIntervals(final String readCountPa\n         return new SimpleIntervalCollection(metadata, intervals);\n     }\n \n+    /**\n+     * For all non-null inputs, validate that all metadata are identical and return the metadata.\n+     */\n+    @SafeVarargs\n+    @SuppressWarnings({\"varargs\"})\n+    public static <METADATA extends Metadata> METADATA getValidatedMetadata(final AbstractRecordCollection<METADATA, ?> ... recordCollections) {\n+        Utils.nonNull(recordCollections);\n+        final Set<METADATA> metadataSet = Stream.of(recordCollections)\n+                .filter(Objects::nonNull)\n+                .map(AbstractRecordCollection::getMetadata)\n+                .collect(Collectors.toSet());\n+        Utils.nonEmpty(metadataSet, \"At least one collection must be non-null.\");\n+        Utils.validateArg(metadataSet.size() == 1, \"Metadata do not match.\");\n+        return metadataSet.stream().findFirst().get();\n+    }\n+\n+    /**\n+     * For all non-null inputs, validate that all sequence dictionaries match (using {@link #isSameDictionary})\n+     * and return the sequence dictionary; otherwise, emit a warning.\n+     */\n+    public static SAMSequenceDictionary getValidatedSequenceDictionary(final AbstractLocatableCollection<?, ?> ... locatableCollections) {\n+        Utils.nonNull(locatableCollections);\n+        final List<SAMSequenceDictionary> sequenceDictionaries = Stream.of(locatableCollections)\n+                .filter(Objects::nonNull)\n+                .map(AbstractLocatableCollection::getMetadata)\n+                .map(LocatableMetadata::getSequenceDictionary)\n+                .collect(Collectors.toList());\n+        Utils.nonEmpty(sequenceDictionaries, \"At least one collection must be non-null.\");\n+        if (!IntStream.range(0, sequenceDictionaries.size() - 1).\n+                allMatch(i -> CopyNumberArgumentValidationUtils.isSameDictionary(sequenceDictionaries.get(i), sequenceDictionaries.get(i + 1)))) {\n+            logger.warn(\"Sequence dictionaries do not match across all inputs.\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDQ4MjMxMw=="}, "originalCommit": {"oid": "1dba22a70a8207ae438f75f3d3092e3e78f9b3bf"}, "originalPosition": 83}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM1MzUyMjI1OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/broadinstitute/hellbender/tools/copynumber/arguments/CopyNumberArgumentValidationUtils.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQyMToyODoyMlrOH9u25A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNi0wOVQxNToyNTo1NFrOJqYnTQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDQ5MjkwMA==", "bodyText": "Could you add  a simple test for this.", "url": "https://github.com/broadinstitute/gatk/pull/6499#discussion_r534492900", "createdAt": "2020-12-02T21:28:22Z", "author": {"login": "fleharty"}, "path": "src/main/java/org/broadinstitute/hellbender/tools/copynumber/arguments/CopyNumberArgumentValidationUtils.java", "diffHunk": "@@ -121,6 +120,41 @@ public static SimpleIntervalCollection resolveIntervals(final String readCountPa\n         return new SimpleIntervalCollection(metadata, intervals);\n     }\n \n+    /**\n+     * For all non-null inputs, validate that all metadata are identical and return the metadata.\n+     */\n+    @SafeVarargs\n+    @SuppressWarnings({\"varargs\"})\n+    public static <METADATA extends Metadata> METADATA getValidatedMetadata(final AbstractRecordCollection<METADATA, ?> ... recordCollections) {\n+        Utils.nonNull(recordCollections);\n+        final Set<METADATA> metadataSet = Stream.of(recordCollections)\n+                .filter(Objects::nonNull)\n+                .map(AbstractRecordCollection::getMetadata)\n+                .collect(Collectors.toSet());\n+        Utils.nonEmpty(metadataSet, \"At least one collection must be non-null.\");\n+        Utils.validateArg(metadataSet.size() == 1, \"Metadata do not match.\");\n+        return metadataSet.stream().findFirst().get();\n+    }\n+\n+    /**\n+     * For all non-null inputs, validate that all sequence dictionaries match (using {@link #isSameDictionary})\n+     * and return the sequence dictionary; otherwise, emit a warning.\n+     */\n+    public static SAMSequenceDictionary getValidatedSequenceDictionary(final AbstractLocatableCollection<?, ?> ... locatableCollections) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1dba22a70a8207ae438f75f3d3092e3e78f9b3bf"}, "originalPosition": 73}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0ODQyMzI0NQ==", "bodyText": "A bit of extra work to check for warnings, rather than errors. I don't think we care too closely about the exact behavior here (see above comment), so punting as well!", "url": "https://github.com/broadinstitute/gatk/pull/6499#discussion_r648423245", "createdAt": "2021-06-09T15:25:54Z", "author": {"login": "samuelklee"}, "path": "src/main/java/org/broadinstitute/hellbender/tools/copynumber/arguments/CopyNumberArgumentValidationUtils.java", "diffHunk": "@@ -121,6 +120,41 @@ public static SimpleIntervalCollection resolveIntervals(final String readCountPa\n         return new SimpleIntervalCollection(metadata, intervals);\n     }\n \n+    /**\n+     * For all non-null inputs, validate that all metadata are identical and return the metadata.\n+     */\n+    @SafeVarargs\n+    @SuppressWarnings({\"varargs\"})\n+    public static <METADATA extends Metadata> METADATA getValidatedMetadata(final AbstractRecordCollection<METADATA, ?> ... recordCollections) {\n+        Utils.nonNull(recordCollections);\n+        final Set<METADATA> metadataSet = Stream.of(recordCollections)\n+                .filter(Objects::nonNull)\n+                .map(AbstractRecordCollection::getMetadata)\n+                .collect(Collectors.toSet());\n+        Utils.nonEmpty(metadataSet, \"At least one collection must be non-null.\");\n+        Utils.validateArg(metadataSet.size() == 1, \"Metadata do not match.\");\n+        return metadataSet.stream().findFirst().get();\n+    }\n+\n+    /**\n+     * For all non-null inputs, validate that all sequence dictionaries match (using {@link #isSameDictionary})\n+     * and return the sequence dictionary; otherwise, emit a warning.\n+     */\n+    public static SAMSequenceDictionary getValidatedSequenceDictionary(final AbstractLocatableCollection<?, ?> ... locatableCollections) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDQ5MjkwMA=="}, "originalCommit": {"oid": "1dba22a70a8207ae438f75f3d3092e3e78f9b3bf"}, "originalPosition": 73}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM1MzU0MzE5OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/broadinstitute/hellbender/tools/copynumber/arguments/SomaticGenotypingArgumentCollection.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQyMTozNDozMFrOH9vDpA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNi0wOVQxNToyNzo0M1rOJqYtoA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDQ5NjE2NA==", "bodyText": "Since base qualities are typically stored in phred scale, would it make sense to use phred scale here too?", "url": "https://github.com/broadinstitute/gatk/pull/6499#discussion_r534496164", "createdAt": "2020-12-02T21:34:30Z", "author": {"login": "fleharty"}, "path": "src/main/java/org/broadinstitute/hellbender/tools/copynumber/arguments/SomaticGenotypingArgumentCollection.java", "diffHunk": "@@ -0,0 +1,53 @@\n+package org.broadinstitute.hellbender.tools.copynumber.arguments;\n+\n+import org.broadinstitute.barclay.argparser.Argument;\n+\n+import java.io.Serializable;\n+\n+public class SomaticGenotypingArgumentCollection implements Serializable {\n+    public static final long serialVersionUID = 1L;\n+\n+    //het genotyping argument names\n+    public static final String MINIMUM_TOTAL_ALLELE_COUNT_CASE_LONG_NAME = \"minimum-total-allele-count-case\";\n+    public static final String MINIMUM_TOTAL_ALLELE_COUNT_NORMAL_LONG_NAME = \"minimum-total-allele-count-normal\";\n+    public static final String GENOTYPING_HOMOZYGOUS_LOG_RATIO_THRESHOLD_LONG_NAME = \"genotyping-homozygous-log-ratio-threshold\";\n+    public static final String GENOTYPING_BASE_ERROR_RATE_LONG_NAME = \"genotyping-base-error-rate\";\n+\n+    @Argument(\n+            doc = \"Minimum total count for filtering allelic counts in the case sample, if available.  \" +\n+                    \"The default value of zero is appropriate for matched-normal mode; \" +\n+                    \"increase to an appropriate value for case-only mode.\",\n+            fullName = MINIMUM_TOTAL_ALLELE_COUNT_CASE_LONG_NAME,\n+            minValue = 0,\n+            optional = true\n+    )\n+    public int minTotalAlleleCountCase = 0;\n+\n+    @Argument(\n+            doc = \"Minimum total count for filtering allelic counts in the matched-normal sample, if available.\",\n+            fullName = MINIMUM_TOTAL_ALLELE_COUNT_NORMAL_LONG_NAME,\n+            minValue = 0,\n+            optional = true\n+    )\n+    public int minTotalAlleleCountNormal = 30;\n+\n+    @Argument(\n+            doc = \"Log-ratio threshold for genotyping and filtering homozygous allelic counts, if available.  \" +\n+                    \"Increasing this value will increase the number of sites assumed to be heterozygous for modeling.\",\n+            fullName = GENOTYPING_HOMOZYGOUS_LOG_RATIO_THRESHOLD_LONG_NAME,\n+            optional = true\n+    )\n+    public double genotypingHomozygousLogRatioThreshold = -10.;\n+\n+    @Argument(\n+            doc = \"Maximum base-error rate for genotyping and filtering homozygous allelic counts, if available.  \" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1dba22a70a8207ae438f75f3d3092e3e78f9b3bf"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0ODQyNDg2NA==", "bodyText": "This base-error rate is intended to model stray bases in the pileups, which could arise for reasons other than the sequencing errors corresponding to base qualities. The maximum value parameterized here is probably typically on the order of a few percent, so it doesn't seem natural to express this in phred scale.", "url": "https://github.com/broadinstitute/gatk/pull/6499#discussion_r648424864", "createdAt": "2021-06-09T15:27:43Z", "author": {"login": "samuelklee"}, "path": "src/main/java/org/broadinstitute/hellbender/tools/copynumber/arguments/SomaticGenotypingArgumentCollection.java", "diffHunk": "@@ -0,0 +1,53 @@\n+package org.broadinstitute.hellbender.tools.copynumber.arguments;\n+\n+import org.broadinstitute.barclay.argparser.Argument;\n+\n+import java.io.Serializable;\n+\n+public class SomaticGenotypingArgumentCollection implements Serializable {\n+    public static final long serialVersionUID = 1L;\n+\n+    //het genotyping argument names\n+    public static final String MINIMUM_TOTAL_ALLELE_COUNT_CASE_LONG_NAME = \"minimum-total-allele-count-case\";\n+    public static final String MINIMUM_TOTAL_ALLELE_COUNT_NORMAL_LONG_NAME = \"minimum-total-allele-count-normal\";\n+    public static final String GENOTYPING_HOMOZYGOUS_LOG_RATIO_THRESHOLD_LONG_NAME = \"genotyping-homozygous-log-ratio-threshold\";\n+    public static final String GENOTYPING_BASE_ERROR_RATE_LONG_NAME = \"genotyping-base-error-rate\";\n+\n+    @Argument(\n+            doc = \"Minimum total count for filtering allelic counts in the case sample, if available.  \" +\n+                    \"The default value of zero is appropriate for matched-normal mode; \" +\n+                    \"increase to an appropriate value for case-only mode.\",\n+            fullName = MINIMUM_TOTAL_ALLELE_COUNT_CASE_LONG_NAME,\n+            minValue = 0,\n+            optional = true\n+    )\n+    public int minTotalAlleleCountCase = 0;\n+\n+    @Argument(\n+            doc = \"Minimum total count for filtering allelic counts in the matched-normal sample, if available.\",\n+            fullName = MINIMUM_TOTAL_ALLELE_COUNT_NORMAL_LONG_NAME,\n+            minValue = 0,\n+            optional = true\n+    )\n+    public int minTotalAlleleCountNormal = 30;\n+\n+    @Argument(\n+            doc = \"Log-ratio threshold for genotyping and filtering homozygous allelic counts, if available.  \" +\n+                    \"Increasing this value will increase the number of sites assumed to be heterozygous for modeling.\",\n+            fullName = GENOTYPING_HOMOZYGOUS_LOG_RATIO_THRESHOLD_LONG_NAME,\n+            optional = true\n+    )\n+    public double genotypingHomozygousLogRatioThreshold = -10.;\n+\n+    @Argument(\n+            doc = \"Maximum base-error rate for genotyping and filtering homozygous allelic counts, if available.  \" +", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDQ5NjE2NA=="}, "originalCommit": {"oid": "1dba22a70a8207ae438f75f3d3092e3e78f9b3bf"}, "originalPosition": 43}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM2NDc0MjAxOnYy", "diffSide": "RIGHT", "path": "src/main/java/org/broadinstitute/hellbender/tools/copynumber/arguments/SomaticModelingArgumentCollection.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQxNjo0OTowOVrOH_ZPaQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNi0wOVQxNTowNjo1M1rOJqXdzg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjIzNTg4MQ==", "bodyText": "I'm confused about why the default parameters are alpha, 1, 0, 1/2.  Why is beta = 1, and why are you scaling a = 0, and c = 1/2?  Is my interpretation correct here?", "url": "https://github.com/broadinstitute/gatk/pull/6499#discussion_r536235881", "createdAt": "2020-12-04T16:49:09Z", "author": {"login": "fleharty"}, "path": "src/main/java/org/broadinstitute/hellbender/tools/copynumber/arguments/SomaticModelingArgumentCollection.java", "diffHunk": "@@ -0,0 +1,106 @@\n+package org.broadinstitute.hellbender.tools.copynumber.arguments;\n+\n+import org.broadinstitute.barclay.argparser.Argument;\n+import org.broadinstitute.hellbender.utils.Utils;\n+\n+import java.io.Serializable;\n+\n+public class SomaticModelingArgumentCollection implements Serializable {\n+    public static final long serialVersionUID = 1L;\n+\n+    //MCMC argument names\n+    public static final String MINOR_ALLELE_FRACTION_PRIOR_ALPHA_LONG_NAME = \"minor-allele-fraction-prior-alpha\";\n+    public static final String NUMBER_OF_SAMPLES_COPY_RATIO_LONG_NAME = \"number-of-samples-copy-ratio\";\n+    public static final String NUMBER_OF_BURN_IN_SAMPLES_COPY_RATIO_LONG_NAME = \"number-of-burn-in-samples-copy-ratio\";\n+    public static final String NUMBER_OF_SAMPLES_ALLELE_FRACTION_LONG_NAME = \"number-of-samples-allele-fraction\";\n+    public static final String NUMBER_OF_BURN_IN_SAMPLES_ALLELE_FRACTION_LONG_NAME = \"number-of-burn-in-samples-allele-fraction\";\n+\n+    //smoothing argument names\n+    public static final String SMOOTHING_CREDIBLE_INTERVAL_THRESHOLD_COPY_RATIO_LONG_NAME = \"smoothing-credible-interval-threshold-copy-ratio\";\n+    public static final String SMOOTHING_CREDIBLE_INTERVAL_THRESHOLD_ALLELE_FRACTION_LONG_NAME = \"smoothing-credible-interval-threshold-allele-fraction\";\n+    public static final String MAXIMUM_NUMBER_OF_SMOOTHING_ITERATIONS_LONG_NAME = \"maximum-number-of-smoothing-iterations\";\n+    public static final String NUMBER_OF_SMOOTHING_ITERATIONS_PER_FIT_LONG_NAME = \"number-of-smoothing-iterations-per-fit\";\n+\n+    @Argument(\n+            doc = \"Alpha hyperparameter for the 4-parameter beta-distribution prior on segment minor-allele fraction. \" +\n+                    \"The prior for the minor-allele fraction f in each segment is assumed to be Beta(alpha, 1, 0, 1/2). \" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1dba22a70a8207ae438f75f3d3092e3e78f9b3bf"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0ODQwNDQzMA==", "bodyText": "Minor-allele fraction is supported on [0, 1/2), so we set a and c accordingly. We fix beta = 1 just to remove a degree of freedom; it seems unlikely that anyone would want to specify a prior peaked anywhere else besides 0.5, and the prior hopefully doesn't make too much of a difference with good data anyway.", "url": "https://github.com/broadinstitute/gatk/pull/6499#discussion_r648404430", "createdAt": "2021-06-09T15:06:53Z", "author": {"login": "samuelklee"}, "path": "src/main/java/org/broadinstitute/hellbender/tools/copynumber/arguments/SomaticModelingArgumentCollection.java", "diffHunk": "@@ -0,0 +1,106 @@\n+package org.broadinstitute.hellbender.tools.copynumber.arguments;\n+\n+import org.broadinstitute.barclay.argparser.Argument;\n+import org.broadinstitute.hellbender.utils.Utils;\n+\n+import java.io.Serializable;\n+\n+public class SomaticModelingArgumentCollection implements Serializable {\n+    public static final long serialVersionUID = 1L;\n+\n+    //MCMC argument names\n+    public static final String MINOR_ALLELE_FRACTION_PRIOR_ALPHA_LONG_NAME = \"minor-allele-fraction-prior-alpha\";\n+    public static final String NUMBER_OF_SAMPLES_COPY_RATIO_LONG_NAME = \"number-of-samples-copy-ratio\";\n+    public static final String NUMBER_OF_BURN_IN_SAMPLES_COPY_RATIO_LONG_NAME = \"number-of-burn-in-samples-copy-ratio\";\n+    public static final String NUMBER_OF_SAMPLES_ALLELE_FRACTION_LONG_NAME = \"number-of-samples-allele-fraction\";\n+    public static final String NUMBER_OF_BURN_IN_SAMPLES_ALLELE_FRACTION_LONG_NAME = \"number-of-burn-in-samples-allele-fraction\";\n+\n+    //smoothing argument names\n+    public static final String SMOOTHING_CREDIBLE_INTERVAL_THRESHOLD_COPY_RATIO_LONG_NAME = \"smoothing-credible-interval-threshold-copy-ratio\";\n+    public static final String SMOOTHING_CREDIBLE_INTERVAL_THRESHOLD_ALLELE_FRACTION_LONG_NAME = \"smoothing-credible-interval-threshold-allele-fraction\";\n+    public static final String MAXIMUM_NUMBER_OF_SMOOTHING_ITERATIONS_LONG_NAME = \"maximum-number-of-smoothing-iterations\";\n+    public static final String NUMBER_OF_SMOOTHING_ITERATIONS_PER_FIT_LONG_NAME = \"number-of-smoothing-iterations-per-fit\";\n+\n+    @Argument(\n+            doc = \"Alpha hyperparameter for the 4-parameter beta-distribution prior on segment minor-allele fraction. \" +\n+                    \"The prior for the minor-allele fraction f in each segment is assumed to be Beta(alpha, 1, 0, 1/2). \" +", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjIzNTg4MQ=="}, "originalCommit": {"oid": "1dba22a70a8207ae438f75f3d3092e3e78f9b3bf"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM2NDgzMzM1OnYy", "diffSide": "RIGHT", "path": "src/test/java/org/broadinstitute/hellbender/tools/copynumber/segmentation/AlleleFractionKernelSegmenterUnitTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQxNzoxMzo0NFrOH_aGcw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNi0wOVQxNTowNzo0MFrOJqXgtQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjI0OTk3MQ==", "bodyText": "What's the justification for the change from 0.1 to 0.025?\nThe test no longer passes with the value 0.1.", "url": "https://github.com/broadinstitute/gatk/pull/6499#discussion_r536249971", "createdAt": "2020-12-04T17:13:44Z", "author": {"login": "fleharty"}, "path": "src/test/java/org/broadinstitute/hellbender/tools/copynumber/segmentation/AlleleFractionKernelSegmenterUnitTest.java", "diffHunk": "@@ -36,19 +35,19 @@\n     public Object[][] dataAlleleFractionKernelSegmenter() {\n         final int numPoints = 10000;\n         final double noiseLevel = 0.001;\n-        final double homFraction = 0.1;     //low hom fraction minimizes uncertainty in the changepoints coming from runs of adjacent homs near the changepoints\n+        final double homFraction = 0.025;   //low hom fraction minimizes uncertainty in the changepoints coming from runs of adjacent homs near the changepoints", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1dba22a70a8207ae438f75f3d3092e3e78f9b3bf"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0ODQwNTE3Mw==", "bodyText": "See comment in #6499 (comment)", "url": "https://github.com/broadinstitute/gatk/pull/6499#discussion_r648405173", "createdAt": "2021-06-09T15:07:40Z", "author": {"login": "samuelklee"}, "path": "src/test/java/org/broadinstitute/hellbender/tools/copynumber/segmentation/AlleleFractionKernelSegmenterUnitTest.java", "diffHunk": "@@ -36,19 +35,19 @@\n     public Object[][] dataAlleleFractionKernelSegmenter() {\n         final int numPoints = 10000;\n         final double noiseLevel = 0.001;\n-        final double homFraction = 0.1;     //low hom fraction minimizes uncertainty in the changepoints coming from runs of adjacent homs near the changepoints\n+        final double homFraction = 0.025;   //low hom fraction minimizes uncertainty in the changepoints coming from runs of adjacent homs near the changepoints", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjI0OTk3MQ=="}, "originalCommit": {"oid": "1dba22a70a8207ae438f75f3d3092e3e78f9b3bf"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM2NDg1NTY1OnYy", "diffSide": "RIGHT", "path": "src/test/java/org/broadinstitute/hellbender/tools/copynumber/segmentation/AlleleFractionKernelSegmenterUnitTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQxNzoxOTo1M1rOH_aUXw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNi0wOVQxNTowNzo1NlrOJqXhkg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjI1MzUzNQ==", "bodyText": "Test also fails if I change the kernelVariance from 0.05 to its previous value 0.01.", "url": "https://github.com/broadinstitute/gatk/pull/6499#discussion_r536253535", "createdAt": "2020-12-04T17:19:53Z", "author": {"login": "fleharty"}, "path": "src/test/java/org/broadinstitute/hellbender/tools/copynumber/segmentation/AlleleFractionKernelSegmenterUnitTest.java", "diffHunk": "@@ -99,15 +98,15 @@\n \n     @Test(dataProvider = \"dataAlleleFractionKernelSegmenter\")\n     public void testAlleleFractionKernelSegmenter(final AllelicCountCollection allelicCounts,\n-                                                  final AlleleFractionSegmentCollection segmentsExpected) {\n+                                                  final SimpleIntervalCollection segmentsExpected) {\n         final int maxNumChangepointsPerChromosome = 25;\n-        final double kernelVariance = 0.01;\n+        final double kernelVariance = 0.05;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1dba22a70a8207ae438f75f3d3092e3e78f9b3bf"}, "originalPosition": 82}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0ODQwNTM5NA==", "bodyText": "Again, see comment above.", "url": "https://github.com/broadinstitute/gatk/pull/6499#discussion_r648405394", "createdAt": "2021-06-09T15:07:56Z", "author": {"login": "samuelklee"}, "path": "src/test/java/org/broadinstitute/hellbender/tools/copynumber/segmentation/AlleleFractionKernelSegmenterUnitTest.java", "diffHunk": "@@ -99,15 +98,15 @@\n \n     @Test(dataProvider = \"dataAlleleFractionKernelSegmenter\")\n     public void testAlleleFractionKernelSegmenter(final AllelicCountCollection allelicCounts,\n-                                                  final AlleleFractionSegmentCollection segmentsExpected) {\n+                                                  final SimpleIntervalCollection segmentsExpected) {\n         final int maxNumChangepointsPerChromosome = 25;\n-        final double kernelVariance = 0.01;\n+        final double kernelVariance = 0.05;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjI1MzUzNQ=="}, "originalCommit": {"oid": "1dba22a70a8207ae438f75f3d3092e3e78f9b3bf"}, "originalPosition": 82}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM2NDg2NDAzOnYy", "diffSide": "RIGHT", "path": "src/test/java/org/broadinstitute/hellbender/tools/copynumber/segmentation/MultisampleMultidimensionalKernelSegmenterUnitTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQxNzoyMjoxN1rOH_aZnw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNi0wOVQxNToyNDo1MlrOJqYj8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjI1NDg3OQ==", "bodyText": "Could you set variables for 250, and 10.\nIt's not clear if this is equivalent to...\n(i % x) * y + z\nor\n(i % x) * y + y", "url": "https://github.com/broadinstitute/gatk/pull/6499#discussion_r536254879", "createdAt": "2020-12-04T17:22:17Z", "author": {"login": "fleharty"}, "path": "src/test/java/org/broadinstitute/hellbender/tools/copynumber/segmentation/MultisampleMultidimensionalKernelSegmenterUnitTest.java", "diffHunk": "@@ -0,0 +1,179 @@\n+package org.broadinstitute.hellbender.tools.copynumber.segmentation;\n+\n+import htsjdk.samtools.SAMSequenceDictionary;\n+import htsjdk.samtools.SAMSequenceRecord;\n+import org.broadinstitute.hellbender.GATKBaseTest;\n+import org.broadinstitute.hellbender.tools.copynumber.formats.collections.AllelicCountCollection;\n+import org.broadinstitute.hellbender.tools.copynumber.formats.collections.CopyRatioCollection;\n+import org.broadinstitute.hellbender.tools.copynumber.formats.collections.SimpleIntervalCollection;\n+import org.broadinstitute.hellbender.tools.copynumber.formats.metadata.SampleLocatableMetadata;\n+import org.broadinstitute.hellbender.tools.copynumber.formats.metadata.SimpleSampleLocatableMetadata;\n+import org.broadinstitute.hellbender.tools.copynumber.formats.records.AllelicCount;\n+import org.broadinstitute.hellbender.tools.copynumber.formats.records.CopyRatio;\n+import org.broadinstitute.hellbender.tools.copynumber.utils.segmentation.KernelSegmenterUnitTest;\n+import org.broadinstitute.hellbender.utils.SimpleInterval;\n+import org.testng.Assert;\n+import org.testng.annotations.DataProvider;\n+import org.testng.annotations.Test;\n+\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.List;\n+import java.util.Random;\n+import java.util.stream.Collectors;\n+import java.util.stream.IntStream;\n+\n+/**\n+ * @author Samuel Lee &lt;slee@broadinstitute.org&gt;\n+ */\n+public final class MultisampleMultidimensionalKernelSegmenterUnitTest extends GATKBaseTest {\n+    private static final int RANDOM_SEED = 1;   //reset seed before each simulated test case\n+\n+    /**\n+     * Generates same Gaussian and test data as {@link KernelSegmenterUnitTest#dataKernelSegmenter()}\n+     * and alternate-allele-fraction-like data (similar to zero-mean multimodal test data\n+     * in {@link KernelSegmenterUnitTest#dataKernelSegmenter()}),\n+     * but introduces further segments by placing data on different chromosomes.\n+     * This is just a combination of the test data from\n+     * {@link CopyRatioKernelSegmenterUnitTest} and {@link AlleleFractionKernelSegmenterUnitTest},\n+     * but for multiple samples and at lower signal-to-noise ratio.\n+     */\n+    @DataProvider(name = \"dataMultisampleMultidimensionalKernelSegmenter\")\n+    public Object[][] dataMultisampleMultidimensionalKernelSegmenter() {\n+        final Random rng = new Random(RANDOM_SEED);\n+\n+        final int numSamples = 20;\n+        final List<CopyRatioCollection> denoisedCopyRatiosPerSample = new ArrayList<>(numSamples);\n+        final List<AllelicCountCollection> allelicCountsPerSample = new ArrayList<>(numSamples);\n+\n+        final int numIntervals = 1000;\n+        final int numAllSites = 1000;\n+        final double noiseLevelCopyRatio = 1.0;\n+        final double noiseLevelAlleleFraction = 0.25;\n+        final double homFraction = 0.025;   //low hom fraction minimizes uncertainty in the changepoints coming from runs of adjacent homs near the changepoints\n+\n+        //generate intervals for copy-ratio data\n+        final List<SimpleInterval> intervals = IntStream.range(0, numIntervals).boxed()\n+                .map(i -> new SimpleInterval(\n+                        Integer.toString(i / 250 + 1),  //start a new chromosome every 250 points, which adds additional changepoints\n+                        (i % 250) * 10 + 1,\n+                        (i % 250) * 10 + 10))           //intervals for copy-ratio data points have length = 10", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1dba22a70a8207ae438f75f3d3092e3e78f9b3bf"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0ODQyMjM4Ng==", "bodyText": "This bit of code has already been copied to the other versions of this test, unfortunately. However, I think the inline comments are sufficient for test code/parameters that are unlikely to be changed. Punting!", "url": "https://github.com/broadinstitute/gatk/pull/6499#discussion_r648422386", "createdAt": "2021-06-09T15:24:52Z", "author": {"login": "samuelklee"}, "path": "src/test/java/org/broadinstitute/hellbender/tools/copynumber/segmentation/MultisampleMultidimensionalKernelSegmenterUnitTest.java", "diffHunk": "@@ -0,0 +1,179 @@\n+package org.broadinstitute.hellbender.tools.copynumber.segmentation;\n+\n+import htsjdk.samtools.SAMSequenceDictionary;\n+import htsjdk.samtools.SAMSequenceRecord;\n+import org.broadinstitute.hellbender.GATKBaseTest;\n+import org.broadinstitute.hellbender.tools.copynumber.formats.collections.AllelicCountCollection;\n+import org.broadinstitute.hellbender.tools.copynumber.formats.collections.CopyRatioCollection;\n+import org.broadinstitute.hellbender.tools.copynumber.formats.collections.SimpleIntervalCollection;\n+import org.broadinstitute.hellbender.tools.copynumber.formats.metadata.SampleLocatableMetadata;\n+import org.broadinstitute.hellbender.tools.copynumber.formats.metadata.SimpleSampleLocatableMetadata;\n+import org.broadinstitute.hellbender.tools.copynumber.formats.records.AllelicCount;\n+import org.broadinstitute.hellbender.tools.copynumber.formats.records.CopyRatio;\n+import org.broadinstitute.hellbender.tools.copynumber.utils.segmentation.KernelSegmenterUnitTest;\n+import org.broadinstitute.hellbender.utils.SimpleInterval;\n+import org.testng.Assert;\n+import org.testng.annotations.DataProvider;\n+import org.testng.annotations.Test;\n+\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.List;\n+import java.util.Random;\n+import java.util.stream.Collectors;\n+import java.util.stream.IntStream;\n+\n+/**\n+ * @author Samuel Lee &lt;slee@broadinstitute.org&gt;\n+ */\n+public final class MultisampleMultidimensionalKernelSegmenterUnitTest extends GATKBaseTest {\n+    private static final int RANDOM_SEED = 1;   //reset seed before each simulated test case\n+\n+    /**\n+     * Generates same Gaussian and test data as {@link KernelSegmenterUnitTest#dataKernelSegmenter()}\n+     * and alternate-allele-fraction-like data (similar to zero-mean multimodal test data\n+     * in {@link KernelSegmenterUnitTest#dataKernelSegmenter()}),\n+     * but introduces further segments by placing data on different chromosomes.\n+     * This is just a combination of the test data from\n+     * {@link CopyRatioKernelSegmenterUnitTest} and {@link AlleleFractionKernelSegmenterUnitTest},\n+     * but for multiple samples and at lower signal-to-noise ratio.\n+     */\n+    @DataProvider(name = \"dataMultisampleMultidimensionalKernelSegmenter\")\n+    public Object[][] dataMultisampleMultidimensionalKernelSegmenter() {\n+        final Random rng = new Random(RANDOM_SEED);\n+\n+        final int numSamples = 20;\n+        final List<CopyRatioCollection> denoisedCopyRatiosPerSample = new ArrayList<>(numSamples);\n+        final List<AllelicCountCollection> allelicCountsPerSample = new ArrayList<>(numSamples);\n+\n+        final int numIntervals = 1000;\n+        final int numAllSites = 1000;\n+        final double noiseLevelCopyRatio = 1.0;\n+        final double noiseLevelAlleleFraction = 0.25;\n+        final double homFraction = 0.025;   //low hom fraction minimizes uncertainty in the changepoints coming from runs of adjacent homs near the changepoints\n+\n+        //generate intervals for copy-ratio data\n+        final List<SimpleInterval> intervals = IntStream.range(0, numIntervals).boxed()\n+                .map(i -> new SimpleInterval(\n+                        Integer.toString(i / 250 + 1),  //start a new chromosome every 250 points, which adds additional changepoints\n+                        (i % 250) * 10 + 1,\n+                        (i % 250) * 10 + 10))           //intervals for copy-ratio data points have length = 10", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjI1NDg3OQ=="}, "originalCommit": {"oid": "1dba22a70a8207ae438f75f3d3092e3e78f9b3bf"}, "originalPosition": 60}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM2NDkyMzk5OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/broadinstitute/hellbender/tools/copynumber/arguments/SomaticSegmentationArgumentCollection.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQxNzozNTo1OVrOH_a8cA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNi0wOVQxNToxNDoxOVrOJqX3sA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjI2Mzc5Mg==", "bodyText": "This number seems pretty magical, is there any intuition for why this is a good default value?", "url": "https://github.com/broadinstitute/gatk/pull/6499#discussion_r536263792", "createdAt": "2020-12-04T17:35:59Z", "author": {"login": "fleharty"}, "path": "src/main/java/org/broadinstitute/hellbender/tools/copynumber/arguments/SomaticSegmentationArgumentCollection.java", "diffHunk": "@@ -0,0 +1,90 @@\n+package org.broadinstitute.hellbender.tools.copynumber.arguments;\n+\n+import org.broadinstitute.barclay.argparser.Argument;\n+\n+import java.io.Serializable;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.List;\n+\n+public class SomaticSegmentationArgumentCollection implements Serializable {\n+    public static final long serialVersionUID = 1L;\n+\n+    //segmentation argument names\n+    public static final String MAXIMUM_NUMBER_OF_SEGMENTS_PER_CHROMOSOME_LONG_NAME = \"maximum-number-of-segments-per-chromosome\";\n+    public static final String KERNEL_VARIANCE_COPY_RATIO_LONG_NAME = \"kernel-variance-copy-ratio\";\n+    public static final String KERNEL_VARIANCE_ALLELE_FRACTION_LONG_NAME = \"kernel-variance-allele-fraction\";\n+    public static final String KERNEL_SCALING_ALLELE_FRACTION_LONG_NAME = \"kernel-scaling-allele-fraction\";\n+    public static final String KERNEL_APPROXIMATION_DIMENSION_LONG_NAME = \"kernel-approximation-dimension\";\n+    public static final String WINDOW_SIZE_LONG_NAME = \"window-size\";\n+    public static final String NUMBER_OF_CHANGEPOINTS_PENALTY_FACTOR_LONG_NAME = \"number-of-changepoints-penalty-factor\";\n+\n+    @Argument(\n+            doc = \"Maximum number of segments allowed per chromosome.\",\n+            fullName = MAXIMUM_NUMBER_OF_SEGMENTS_PER_CHROMOSOME_LONG_NAME,\n+            minValue = 1,\n+            optional = true\n+    )\n+    public int maxNumSegmentsPerChromosome = 1000;\n+\n+    @Argument(\n+            doc = \"Variance of Gaussian kernel for copy-ratio segmentation, if performed.  If zero, a linear kernel will be used.\",\n+            fullName = KERNEL_VARIANCE_COPY_RATIO_LONG_NAME,\n+            minValue = 0.,\n+            optional = true\n+    )\n+    public double kernelVarianceCopyRatio = 0.;\n+\n+    @Argument(\n+            doc = \"Variance of Gaussian kernel for allele-fraction segmentation, if performed.  If zero, a linear kernel will be used.\",\n+            fullName = KERNEL_VARIANCE_ALLELE_FRACTION_LONG_NAME,\n+            minValue = 0.,\n+            optional = true\n+    )\n+    public double kernelVarianceAlleleFraction = 0.025;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1dba22a70a8207ae438f75f3d3092e3e78f9b3bf"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0ODQxMTA1Ng==", "bodyText": "Not really. Seems to produce reasonable results on typical data. This is the sort of parameter that would need good, representative truth data and some hyperparameter optimization to tune rigorously, as it doesn't have a natural, universal scale.", "url": "https://github.com/broadinstitute/gatk/pull/6499#discussion_r648411056", "createdAt": "2021-06-09T15:14:19Z", "author": {"login": "samuelklee"}, "path": "src/main/java/org/broadinstitute/hellbender/tools/copynumber/arguments/SomaticSegmentationArgumentCollection.java", "diffHunk": "@@ -0,0 +1,90 @@\n+package org.broadinstitute.hellbender.tools.copynumber.arguments;\n+\n+import org.broadinstitute.barclay.argparser.Argument;\n+\n+import java.io.Serializable;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.List;\n+\n+public class SomaticSegmentationArgumentCollection implements Serializable {\n+    public static final long serialVersionUID = 1L;\n+\n+    //segmentation argument names\n+    public static final String MAXIMUM_NUMBER_OF_SEGMENTS_PER_CHROMOSOME_LONG_NAME = \"maximum-number-of-segments-per-chromosome\";\n+    public static final String KERNEL_VARIANCE_COPY_RATIO_LONG_NAME = \"kernel-variance-copy-ratio\";\n+    public static final String KERNEL_VARIANCE_ALLELE_FRACTION_LONG_NAME = \"kernel-variance-allele-fraction\";\n+    public static final String KERNEL_SCALING_ALLELE_FRACTION_LONG_NAME = \"kernel-scaling-allele-fraction\";\n+    public static final String KERNEL_APPROXIMATION_DIMENSION_LONG_NAME = \"kernel-approximation-dimension\";\n+    public static final String WINDOW_SIZE_LONG_NAME = \"window-size\";\n+    public static final String NUMBER_OF_CHANGEPOINTS_PENALTY_FACTOR_LONG_NAME = \"number-of-changepoints-penalty-factor\";\n+\n+    @Argument(\n+            doc = \"Maximum number of segments allowed per chromosome.\",\n+            fullName = MAXIMUM_NUMBER_OF_SEGMENTS_PER_CHROMOSOME_LONG_NAME,\n+            minValue = 1,\n+            optional = true\n+    )\n+    public int maxNumSegmentsPerChromosome = 1000;\n+\n+    @Argument(\n+            doc = \"Variance of Gaussian kernel for copy-ratio segmentation, if performed.  If zero, a linear kernel will be used.\",\n+            fullName = KERNEL_VARIANCE_COPY_RATIO_LONG_NAME,\n+            minValue = 0.,\n+            optional = true\n+    )\n+    public double kernelVarianceCopyRatio = 0.;\n+\n+    @Argument(\n+            doc = \"Variance of Gaussian kernel for allele-fraction segmentation, if performed.  If zero, a linear kernel will be used.\",\n+            fullName = KERNEL_VARIANCE_ALLELE_FRACTION_LONG_NAME,\n+            minValue = 0.,\n+            optional = true\n+    )\n+    public double kernelVarianceAlleleFraction = 0.025;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjI2Mzc5Mg=="}, "originalCommit": {"oid": "1dba22a70a8207ae438f75f3d3092e3e78f9b3bf"}, "originalPosition": 44}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM2NDk0MTg5OnYy", "diffSide": "RIGHT", "path": "src/test/resources/org/broadinstitute/hellbender/tools/copynumber/model-segments-wes-tumor-2-allelic-counts-SM-74P4M-v1-chr20-downsampled.deduplicated.allelicCounts.tsv", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQxNzo0MDoxMVrOH_bGoA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNi0wOVQxNToyODo0MFrOJqYw-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjI2NjQwMA==", "bodyText": "Why are so many of these ALT_NUCLEOTIDES = N?", "url": "https://github.com/broadinstitute/gatk/pull/6499#discussion_r536266400", "createdAt": "2020-12-04T17:40:11Z", "author": {"login": "fleharty"}, "path": "src/test/resources/org/broadinstitute/hellbender/tools/copynumber/model-segments-wes-tumor-2-allelic-counts-SM-74P4M-v1-chr20-downsampled.deduplicated.allelicCounts.tsv", "diffHunk": "@@ -0,0 +1,200 @@\n+@HD\tVN:1.5\n+@SQ\tSN:20\tLN:1000000\tUR:http://www.broadinstitute.org/ftp/pub/seq/references/Homo_sapiens_assembly19.fasta\tAS:GRCh37\tM5:0dec9660ec1efaaf33281c0d5ea2560f\tSP:Homo Sapiens\n+@RG\tID:GATKCopyNumber\tSM:SM-74P4M-2\n+CONTIG\tPOSITION\tREF_COUNT\tALT_COUNT\tREF_NUCLEOTIDE\tALT_NUCLEOTIDE\n+20\t61098\t0\t0\tC\tN", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1dba22a70a8207ae438f75f3d3092e3e78f9b3bf"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0ODQyNTcyMA==", "bodyText": "I think this is because these sites are uncovered in this downsampled toy data. In any case, neither the REF nor ALT nucleotides are actually used anywhere---only the counts are.", "url": "https://github.com/broadinstitute/gatk/pull/6499#discussion_r648425720", "createdAt": "2021-06-09T15:28:40Z", "author": {"login": "samuelklee"}, "path": "src/test/resources/org/broadinstitute/hellbender/tools/copynumber/model-segments-wes-tumor-2-allelic-counts-SM-74P4M-v1-chr20-downsampled.deduplicated.allelicCounts.tsv", "diffHunk": "@@ -0,0 +1,200 @@\n+@HD\tVN:1.5\n+@SQ\tSN:20\tLN:1000000\tUR:http://www.broadinstitute.org/ftp/pub/seq/references/Homo_sapiens_assembly19.fasta\tAS:GRCh37\tM5:0dec9660ec1efaaf33281c0d5ea2560f\tSP:Homo Sapiens\n+@RG\tID:GATKCopyNumber\tSM:SM-74P4M-2\n+CONTIG\tPOSITION\tREF_COUNT\tALT_COUNT\tREF_NUCLEOTIDE\tALT_NUCLEOTIDE\n+20\t61098\t0\t0\tC\tN", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjI2NjQwMA=="}, "originalCommit": {"oid": "1dba22a70a8207ae438f75f3d3092e3e78f9b3bf"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM5NDc1NTM4OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/broadinstitute/hellbender/tools/copynumber/arguments/SomaticSegmentationArgumentCollection.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQwMDoxOTowMlrOIDjcHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNi0wOVQxNTozMjoxMVrOJqY9UQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDU5NzI3OQ==", "bodyText": "What is N?", "url": "https://github.com/broadinstitute/gatk/pull/6499#discussion_r540597279", "createdAt": "2020-12-11T00:19:02Z", "author": {"login": "fleharty"}, "path": "src/main/java/org/broadinstitute/hellbender/tools/copynumber/arguments/SomaticSegmentationArgumentCollection.java", "diffHunk": "@@ -0,0 +1,90 @@\n+package org.broadinstitute.hellbender.tools.copynumber.arguments;\n+\n+import org.broadinstitute.barclay.argparser.Argument;\n+\n+import java.io.Serializable;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.List;\n+\n+public class SomaticSegmentationArgumentCollection implements Serializable {\n+    public static final long serialVersionUID = 1L;\n+\n+    //segmentation argument names\n+    public static final String MAXIMUM_NUMBER_OF_SEGMENTS_PER_CHROMOSOME_LONG_NAME = \"maximum-number-of-segments-per-chromosome\";\n+    public static final String KERNEL_VARIANCE_COPY_RATIO_LONG_NAME = \"kernel-variance-copy-ratio\";\n+    public static final String KERNEL_VARIANCE_ALLELE_FRACTION_LONG_NAME = \"kernel-variance-allele-fraction\";\n+    public static final String KERNEL_SCALING_ALLELE_FRACTION_LONG_NAME = \"kernel-scaling-allele-fraction\";\n+    public static final String KERNEL_APPROXIMATION_DIMENSION_LONG_NAME = \"kernel-approximation-dimension\";\n+    public static final String WINDOW_SIZE_LONG_NAME = \"window-size\";\n+    public static final String NUMBER_OF_CHANGEPOINTS_PENALTY_FACTOR_LONG_NAME = \"number-of-changepoints-penalty-factor\";\n+\n+    @Argument(\n+            doc = \"Maximum number of segments allowed per chromosome.\",\n+            fullName = MAXIMUM_NUMBER_OF_SEGMENTS_PER_CHROMOSOME_LONG_NAME,\n+            minValue = 1,\n+            optional = true\n+    )\n+    public int maxNumSegmentsPerChromosome = 1000;\n+\n+    @Argument(\n+            doc = \"Variance of Gaussian kernel for copy-ratio segmentation, if performed.  If zero, a linear kernel will be used.\",\n+            fullName = KERNEL_VARIANCE_COPY_RATIO_LONG_NAME,\n+            minValue = 0.,\n+            optional = true\n+    )\n+    public double kernelVarianceCopyRatio = 0.;\n+\n+    @Argument(\n+            doc = \"Variance of Gaussian kernel for allele-fraction segmentation, if performed.  If zero, a linear kernel will be used.\",\n+            fullName = KERNEL_VARIANCE_ALLELE_FRACTION_LONG_NAME,\n+            minValue = 0.,\n+            optional = true\n+    )\n+    public double kernelVarianceAlleleFraction = 0.025;\n+\n+    @Argument(\n+            doc = \"Relative scaling S of the kernel K_AF for allele-fraction segmentation to the kernel K_CR for copy-ratio segmentation.  \" +\n+                    \"If multidimensional segmentation is performed, the total kernel used will be K_CR + S * K_AF.\",\n+            fullName = KERNEL_SCALING_ALLELE_FRACTION_LONG_NAME,\n+            minValue = 0.,\n+            optional = true\n+    )\n+    public double kernelScalingAlleleFraction = 1.0;\n+\n+    @Argument(\n+            doc = \"Dimension of the kernel approximation.  A subsample containing this number of data points \" +\n+                    \"will be used to construct the approximation for each chromosome.  \" +\n+                    \"If the total number of data points in a chromosome is greater \" +\n+                    \"than this number, then all data points in the chromosome will be used.  \" +\n+                    \"Time complexity scales quadratically and space complexity scales linearly with this parameter.\",\n+            fullName = KERNEL_APPROXIMATION_DIMENSION_LONG_NAME,\n+            minValue = 1,\n+            optional = true\n+    )\n+    public int kernelApproximationDimension = 100;\n+\n+    @Argument(\n+            doc = \"Window sizes to use for calculating local changepoint costs.  \" +\n+                    \"For each window size, the cost for each data point to be a changepoint will be calculated \" +\n+                    \"assuming that the point demarcates two adjacent segments of that size.  \" +\n+                    \"Including small (large) window sizes will increase sensitivity to small (large) events.  \" +\n+                    \"Duplicate values will be ignored.\",\n+            fullName = WINDOW_SIZE_LONG_NAME,\n+            minValue = 1,\n+            optional = true\n+    )\n+    public List<Integer> windowSizes = new ArrayList<>(Arrays.asList(8, 16, 32, 64, 128, 256));\n+\n+    @Argument(\n+            doc = \"Factor A for the penalty on the number of changepoints per chromosome for segmentation.  \" +\n+                    \"Adds a penalty of the form A * C * [1 + log (N / C)], \" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1dba22a70a8207ae438f75f3d3092e3e78f9b3bf"}, "originalPosition": 81}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0ODQyODg4MQ==", "bodyText": "Fixed, thanks for catching this! N is the number of data points in the chromosome.", "url": "https://github.com/broadinstitute/gatk/pull/6499#discussion_r648428881", "createdAt": "2021-06-09T15:32:11Z", "author": {"login": "samuelklee"}, "path": "src/main/java/org/broadinstitute/hellbender/tools/copynumber/arguments/SomaticSegmentationArgumentCollection.java", "diffHunk": "@@ -0,0 +1,90 @@\n+package org.broadinstitute.hellbender.tools.copynumber.arguments;\n+\n+import org.broadinstitute.barclay.argparser.Argument;\n+\n+import java.io.Serializable;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.List;\n+\n+public class SomaticSegmentationArgumentCollection implements Serializable {\n+    public static final long serialVersionUID = 1L;\n+\n+    //segmentation argument names\n+    public static final String MAXIMUM_NUMBER_OF_SEGMENTS_PER_CHROMOSOME_LONG_NAME = \"maximum-number-of-segments-per-chromosome\";\n+    public static final String KERNEL_VARIANCE_COPY_RATIO_LONG_NAME = \"kernel-variance-copy-ratio\";\n+    public static final String KERNEL_VARIANCE_ALLELE_FRACTION_LONG_NAME = \"kernel-variance-allele-fraction\";\n+    public static final String KERNEL_SCALING_ALLELE_FRACTION_LONG_NAME = \"kernel-scaling-allele-fraction\";\n+    public static final String KERNEL_APPROXIMATION_DIMENSION_LONG_NAME = \"kernel-approximation-dimension\";\n+    public static final String WINDOW_SIZE_LONG_NAME = \"window-size\";\n+    public static final String NUMBER_OF_CHANGEPOINTS_PENALTY_FACTOR_LONG_NAME = \"number-of-changepoints-penalty-factor\";\n+\n+    @Argument(\n+            doc = \"Maximum number of segments allowed per chromosome.\",\n+            fullName = MAXIMUM_NUMBER_OF_SEGMENTS_PER_CHROMOSOME_LONG_NAME,\n+            minValue = 1,\n+            optional = true\n+    )\n+    public int maxNumSegmentsPerChromosome = 1000;\n+\n+    @Argument(\n+            doc = \"Variance of Gaussian kernel for copy-ratio segmentation, if performed.  If zero, a linear kernel will be used.\",\n+            fullName = KERNEL_VARIANCE_COPY_RATIO_LONG_NAME,\n+            minValue = 0.,\n+            optional = true\n+    )\n+    public double kernelVarianceCopyRatio = 0.;\n+\n+    @Argument(\n+            doc = \"Variance of Gaussian kernel for allele-fraction segmentation, if performed.  If zero, a linear kernel will be used.\",\n+            fullName = KERNEL_VARIANCE_ALLELE_FRACTION_LONG_NAME,\n+            minValue = 0.,\n+            optional = true\n+    )\n+    public double kernelVarianceAlleleFraction = 0.025;\n+\n+    @Argument(\n+            doc = \"Relative scaling S of the kernel K_AF for allele-fraction segmentation to the kernel K_CR for copy-ratio segmentation.  \" +\n+                    \"If multidimensional segmentation is performed, the total kernel used will be K_CR + S * K_AF.\",\n+            fullName = KERNEL_SCALING_ALLELE_FRACTION_LONG_NAME,\n+            minValue = 0.,\n+            optional = true\n+    )\n+    public double kernelScalingAlleleFraction = 1.0;\n+\n+    @Argument(\n+            doc = \"Dimension of the kernel approximation.  A subsample containing this number of data points \" +\n+                    \"will be used to construct the approximation for each chromosome.  \" +\n+                    \"If the total number of data points in a chromosome is greater \" +\n+                    \"than this number, then all data points in the chromosome will be used.  \" +\n+                    \"Time complexity scales quadratically and space complexity scales linearly with this parameter.\",\n+            fullName = KERNEL_APPROXIMATION_DIMENSION_LONG_NAME,\n+            minValue = 1,\n+            optional = true\n+    )\n+    public int kernelApproximationDimension = 100;\n+\n+    @Argument(\n+            doc = \"Window sizes to use for calculating local changepoint costs.  \" +\n+                    \"For each window size, the cost for each data point to be a changepoint will be calculated \" +\n+                    \"assuming that the point demarcates two adjacent segments of that size.  \" +\n+                    \"Including small (large) window sizes will increase sensitivity to small (large) events.  \" +\n+                    \"Duplicate values will be ignored.\",\n+            fullName = WINDOW_SIZE_LONG_NAME,\n+            minValue = 1,\n+            optional = true\n+    )\n+    public List<Integer> windowSizes = new ArrayList<>(Arrays.asList(8, 16, 32, 64, 128, 256));\n+\n+    @Argument(\n+            doc = \"Factor A for the penalty on the number of changepoints per chromosome for segmentation.  \" +\n+                    \"Adds a penalty of the form A * C * [1 + log (N / C)], \" +", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDU5NzI3OQ=="}, "originalCommit": {"oid": "1dba22a70a8207ae438f75f3d3092e3e78f9b3bf"}, "originalPosition": 81}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM5NDc2MTQ4OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/broadinstitute/hellbender/tools/copynumber/formats/metadata/SimpleLocatableMetadata.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQwMDoyMToxNlrOIDjfYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNi0wOVQxNToxOTo1NVrOJqYMMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDU5ODExNQ==", "bodyText": "Because this is public, I think this should have a simple java doc.", "url": "https://github.com/broadinstitute/gatk/pull/6499#discussion_r540598115", "createdAt": "2020-12-11T00:21:16Z", "author": {"login": "fleharty"}, "path": "src/main/java/org/broadinstitute/hellbender/tools/copynumber/formats/metadata/SimpleLocatableMetadata.java", "diffHunk": "@@ -16,6 +16,10 @@ public SimpleLocatableMetadata(final SAMSequenceDictionary sequenceDictionary) {\n         this.sequenceDictionary = Utils.nonNull(sequenceDictionary);\n     }\n \n+    public SimpleLocatableMetadata(final LocatableMetadata metadata) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1dba22a70a8207ae438f75f3d3092e3e78f9b3bf"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY0ODQxNjMwNg==", "bodyText": "These are one-liner constructors, which seem pretty self documenting to me? These metadata classes are also relatively internal to the copynumber package, as they're solely used for making sure file-format conventions can be followed. Punting, if you don't mind!", "url": "https://github.com/broadinstitute/gatk/pull/6499#discussion_r648416306", "createdAt": "2021-06-09T15:19:55Z", "author": {"login": "samuelklee"}, "path": "src/main/java/org/broadinstitute/hellbender/tools/copynumber/formats/metadata/SimpleLocatableMetadata.java", "diffHunk": "@@ -16,6 +16,10 @@ public SimpleLocatableMetadata(final SAMSequenceDictionary sequenceDictionary) {\n         this.sequenceDictionary = Utils.nonNull(sequenceDictionary);\n     }\n \n+    public SimpleLocatableMetadata(final LocatableMetadata metadata) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDU5ODExNQ=="}, "originalCommit": {"oid": "1dba22a70a8207ae438f75f3d3092e3e78f9b3bf"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM5NzcyOTMxOnYy", "diffSide": "RIGHT", "path": "src/main/java/org/broadinstitute/hellbender/tools/copynumber/utils/genotyping/NaiveHeterozygousPileupGenotypingUtils.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQxNToxODoxNlrOID9R2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQxNToxODoxNlrOID9R2Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTAyMDYzMw==", "bodyText": "explicit imports", "url": "https://github.com/broadinstitute/gatk/pull/6499#discussion_r541020633", "createdAt": "2020-12-11T15:18:16Z", "author": {"login": "fleharty"}, "path": "src/main/java/org/broadinstitute/hellbender/tools/copynumber/utils/genotyping/NaiveHeterozygousPileupGenotypingUtils.java", "diffHunk": "@@ -0,0 +1,254 @@\n+package org.broadinstitute.hellbender.tools.copynumber.utils.genotyping;\n+\n+import com.google.common.collect.HashMultiset;\n+import com.google.common.collect.ImmutableList;\n+import com.google.common.collect.Multiset;\n+import htsjdk.samtools.util.Locatable;\n+import org.apache.commons.math3.special.Beta;\n+import org.apache.commons.math3.util.FastMath;\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+import org.broadinstitute.hellbender.tools.copynumber.arguments.CopyNumberArgumentValidationUtils;\n+import org.broadinstitute.hellbender.tools.copynumber.formats.collections.AbstractLocatableCollection;\n+import org.broadinstitute.hellbender.tools.copynumber.formats.collections.AllelicCountCollection;\n+import org.broadinstitute.hellbender.tools.copynumber.formats.collections.SimpleIntervalCollection;\n+import org.broadinstitute.hellbender.tools.copynumber.formats.metadata.SampleLocatableMetadata;\n+import org.broadinstitute.hellbender.tools.copynumber.formats.records.AllelicCount;\n+import org.broadinstitute.hellbender.utils.SimpleInterval;\n+import org.broadinstitute.hellbender.utils.Utils;\n+import org.broadinstitute.hellbender.utils.param.ParamUtils;\n+\n+import java.util.*;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1dba22a70a8207ae438f75f3d3092e3e78f9b3bf"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM5Nzg5OTYzOnYy", "diffSide": "RIGHT", "path": "src/main/java/org/broadinstitute/hellbender/tools/copynumber/segmentation/MultisampleMultidimensionalKernelSegmenter.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQxNTo1MzozMVrOID-1Lg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQxNTo1MzozMVrOID-1Lg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTA0NjA2Mg==", "bodyText": "explicit imports", "url": "https://github.com/broadinstitute/gatk/pull/6499#discussion_r541046062", "createdAt": "2020-12-11T15:53:31Z", "author": {"login": "fleharty"}, "path": "src/main/java/org/broadinstitute/hellbender/tools/copynumber/segmentation/MultisampleMultidimensionalKernelSegmenter.java", "diffHunk": "@@ -0,0 +1,323 @@\n+package org.broadinstitute.hellbender.tools.copynumber.segmentation;\n+\n+import htsjdk.samtools.util.Locatable;\n+import htsjdk.samtools.util.OverlapDetector;\n+import org.apache.commons.math3.distribution.NormalDistribution;\n+import org.apache.logging.log4j.LogManager;\n+import org.apache.logging.log4j.Logger;\n+import org.broadinstitute.hellbender.exceptions.GATKException;\n+import org.broadinstitute.hellbender.tools.copynumber.arguments.CopyNumberArgumentValidationUtils;\n+import org.broadinstitute.hellbender.tools.copynumber.formats.collections.AbstractLocatableCollection;\n+import org.broadinstitute.hellbender.tools.copynumber.formats.collections.AllelicCountCollection;\n+import org.broadinstitute.hellbender.tools.copynumber.formats.collections.CopyRatioCollection;\n+import org.broadinstitute.hellbender.tools.copynumber.formats.collections.SimpleIntervalCollection;\n+import org.broadinstitute.hellbender.tools.copynumber.formats.metadata.LocatableMetadata;\n+import org.broadinstitute.hellbender.tools.copynumber.formats.records.AllelicCount;\n+import org.broadinstitute.hellbender.tools.copynumber.utils.segmentation.KernelSegmenter;\n+import org.broadinstitute.hellbender.utils.SimpleInterval;\n+import org.broadinstitute.hellbender.utils.Utils;\n+import org.broadinstitute.hellbender.utils.param.ParamUtils;\n+\n+import java.util.*;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1dba22a70a8207ae438f75f3d3092e3e78f9b3bf"}, "originalPosition": 21}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1136, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}