{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQyNzk3NzA4", "number": 7010, "title": "Yf make BaseUtils methods more robust to handle all possible byte values", "bodyText": "Fixes a bug that was exposed in https://gatk.broadinstitute.org/hc/en-us/community/posts/360075631171-BQSR-no-output-table-found\nThe issue is that bytes are signed in java, and yet we were treating them as unsigned and directly indexing an array with them.....this works as long as you don't have weird characters in your bam/reference...but if you do you get an access error that is non-informative.", "createdAt": "2020-12-18T22:11:28Z", "url": "https://github.com/broadinstitute/gatk/pull/7010", "merged": true, "mergeCommit": {"oid": "b266f833355ef1a49deae6b176339d3e1bc048da"}, "closed": true, "closedAt": "2021-01-12T19:51:46Z", "author": {"login": "yfarjoun"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdnfkfoAH2gAyNTQyNzk3NzA4OmUyZjgwYzI0YTM4OWE0OTMwOWVmYmFmY2Q4YWM5YWVhZWZmYTgxZjc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdvgR2UAFqTU2NjYxOTIyNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e2f80c24a389a49309efbafcd8ac9aeaeffa81f7", "author": {"user": {"login": "yfarjoun", "name": "Yossi Farjoun"}}, "url": "https://github.com/broadinstitute/gatk/commit/e2f80c24a389a49309efbafcd8ac9aeaeffa81f7", "committedDate": "2020-12-18T22:07:12Z", "message": "- test to show that BaseUtils.convertIUPACtoN fails for the \"top half\" of bytes, as they are interpreted as negatives."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3768c752f55f7d57d569fd200e05b01592c04516", "author": {"user": {"login": "yfarjoun", "name": "Yossi Farjoun"}}, "url": "https://github.com/broadinstitute/gatk/commit/3768c752f55f7d57d569fd200e05b01592c04516", "committedDate": "2020-12-18T22:07:12Z", "message": "- fixed access to baseIndexMap and baseIndexWithIupacMap so that it converts the input byte to unsigned first."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e991a345d9b3affd7e84cf094d83d82e866877ca", "author": {"user": {"login": "yfarjoun", "name": "Yossi Farjoun"}}, "url": "https://github.com/broadinstitute/gatk/commit/e991a345d9b3affd7e84cf094d83d82e866877ca", "committedDate": "2020-12-18T22:09:54Z", "message": "fixed imports"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e0357d17bc33157ff671708cc5fc66f6f3acceef", "author": {"user": {"login": "yfarjoun", "name": "Yossi Farjoun"}}, "url": "https://github.com/broadinstitute/gatk/commit/e0357d17bc33157ff671708cc5fc66f6f3acceef", "committedDate": "2020-12-18T22:11:09Z", "message": "let IntelliJ drive a little"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY2NTAxMTA2", "url": "https://github.com/broadinstitute/gatk/pull/7010#pullrequestreview-566501106", "createdAt": "2021-01-12T17:23:19Z", "commit": {"oid": "e0357d17bc33157ff671708cc5fc66f6f3acceef"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xMlQxNzoyMzoxOVrOISMLCQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xMlQxNzoyMzoxOVrOISMLCQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTk0NDcxMw==", "bodyText": "Can you also add a call to BaseUtils.simpleBaseToBaseIndex() in this test method, to cover the other change you made?", "url": "https://github.com/broadinstitute/gatk/pull/7010#discussion_r555944713", "createdAt": "2021-01-12T17:23:19Z", "author": {"login": "droazen"}, "path": "src/test/java/org/broadinstitute/hellbender/utils/BaseUtilsUnitTest.java", "diffHunk": "@@ -27,34 +29,49 @@ public void testConvertIUPACtoN() {\n         checkBytesAreEqual(BaseUtils.convertIUPACtoN(new byte[]{'M', 'M', 'M'}, false, false), new byte[]{'N', 'N', 'N'});\n     }\n \n+    @DataProvider\n+    Iterator<Object[]> allByteValues() {\n+        final List<Object[]> bytes = new ArrayList<>(256);\n+        for (int i = 0; i < 256; i++) {\n+            final byte oneByte = (byte) i;\n+            bytes.add(new Object[]{oneByte});\n+        }\n+        return bytes.iterator();\n+    }\n+\n+    @Test(dataProvider = \"allByteValues\")\n+    public void testCanConvertAllBytes(final byte b) {\n+        BaseUtils.convertIUPACtoN(new byte[]{b, b, b}, false, false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e0357d17bc33157ff671708cc5fc66f6f3acceef"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "533439bb9a7261b2f5eda0991ce97b8b78338e66", "author": {"user": {"login": "yfarjoun", "name": "Yossi Farjoun"}}, "url": "https://github.com/broadinstitute/gatk/commit/533439bb9a7261b2f5eda0991ce97b8b78338e66", "committedDate": "2021-01-12T18:26:37Z", "message": "Added a test for simpleBaseToBaseIndex"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY2NjE5MjI2", "url": "https://github.com/broadinstitute/gatk/pull/7010#pullrequestreview-566619226", "createdAt": "2021-01-12T19:28:09Z", "commit": {"oid": "533439bb9a7261b2f5eda0991ce97b8b78338e66"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2461, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}