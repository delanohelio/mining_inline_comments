{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIwODk2NjM5", "number": 6613, "title": "DetermineGermlineContigPloidy can now process interval lists with a single contig", "bodyText": "I ran a couple of tests - in case of single contig case the ploidy calls correspond to most likely apriori ploidies. In the case of multiple contigs there is no numerical changes to inference whatsoever.", "createdAt": "2020-05-20T17:12:38Z", "url": "https://github.com/broadinstitute/gatk/pull/6613", "merged": true, "mergeCommit": {"oid": "ef127e39da83e0585678483579dd48ded8179b09"}, "closed": true, "closedAt": "2020-05-27T16:04:23Z", "author": {"login": "asmirnov239"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcjMPyOAH2gAyNDIwODk2NjM5OjFjOTIyMDcxYTg3NTNlNmEzYjIyZjRlMGMxOTZkN2QyNTFmMTUyMjc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcjQtH8AH2gAyNDIwODk2NjM5OjQ4ZjI0MDUzMGUzMzM1MTM1NTFhYTU3NzgyMTgxNmQ2YzJkYTMyNjU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1c922071a8753e6a3b22f4e0c196d7d251f15227", "author": {"user": {"login": "asmirnov239", "name": "Andrey Smirnov"}}, "url": "https://github.com/broadinstitute/gatk/commit/1c922071a8753e6a3b22f4e0c196d7d251f15227", "committedDate": "2020-05-20T17:09:32Z", "message": "DetermineGermlineContigPloidy can now process interval lists with a single contig"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE1NjczMTYx", "url": "https://github.com/broadinstitute/gatk/pull/6613#pullrequestreview-415673161", "createdAt": "2020-05-20T20:03:35Z", "commit": {"oid": "1c922071a8753e6a3b22f4e0c196d7d251f15227"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE1NjgyODA5", "url": "https://github.com/broadinstitute/gatk/pull/6613#pullrequestreview-415682809", "createdAt": "2020-05-20T20:17:54Z", "commit": {"oid": "1c922071a8753e6a3b22f4e0c196d7d251f15227"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQyMDoxNzo1NFrOGYcUww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQyMDoxNzo1NFrOGYcUww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODI4MzA3NQ==", "bodyText": "Actually, despite our back and forth on Slack, I'm not convinced there's a good argument either way for\ntt.switch(tt.eq(mu_den_sjk, 0.0), 0.0, mu_num_sjk / mu_den_sjk)\nvs.\ntt.switch(tt.eq(mu_den_sjk, 0.0), 1.0, mu_num_sjk / mu_den_sjk).\nIn the first, we heavily penalize the k = 0 case by saying the Poisson rate is eps_mapping * n_s, whereas the likelihood is flat and the Poisson rate is n_s for k > 0.  In the second, the likelihood is flat and the Poisson rate is n_s for all k.\nTo me, it seems strange to treat k = 0 specially.  So I think I might actually favor the second.  But in either case, in practice (where k = 0 is already heavily penalized by the prior), inference is completely determined by the prior, since mean bias and ploidy cancel out of the likelihood.\nAnd in any case, we should check behavior with some simple tests to make sure we've got things straight!", "url": "https://github.com/broadinstitute/gatk/pull/6613#discussion_r428283075", "createdAt": "2020-05-20T20:17:54Z", "author": {"login": "samuelklee"}, "path": "src/main/python/org/broadinstitute/hellbender/gcnvkernel/models/model_ploidy.py", "diffHunk": "@@ -252,7 +252,10 @@ def __init__(self,\n                       * ploidy_k.dimshuffle('x', 'x', 0))\n         mu_den_sjk = gamma_rest_sj.dimshuffle(0, 1, 'x') + mu_num_sjk\n         eps_mapping_j = eps_mapping * t_j / tt.sum(t_j)  # average number of reads erroneously mapped to contig j\n-        mu_sjk = ((1.0 - eps_mapping) * (mu_num_sjk / mu_den_sjk)\n+\n+        # the switch is required for a single contig edge case\n+        mu_ratio_sjk = tt.switch(tt.eq(mu_den_sjk, 0.0), 0.0, mu_num_sjk / mu_den_sjk)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1c922071a8753e6a3b22f4e0c196d7d251f15227"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "48f240530e333513551aa577821816d6c2da3265", "author": {"user": {"login": "asmirnov239", "name": "Andrey Smirnov"}}, "url": "https://github.com/broadinstitute/gatk/commit/48f240530e333513551aa577821816d6c2da3265", "committedDate": "2020-05-20T22:21:12Z", "message": "Added warning and documentation notes"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2595, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}