{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk2NDgxMTYw", "number": 6859, "title": "Fix to quality score calculation for sites with spanning deletions", "bodyText": "This fixes a bug in the AlleleFrequencyCalculator that was causing quality to be overestimated for sites with * alleles representing spanning deletions.\nThe bug was causing the calculator to not include homozygous * genotypes in the sum of non-site specific variant allele probabilities that is the basis for the qual score. The bug was caused by an off-by-one index error: IndexRange(0,2) returns [0,1], not [0,1,2] as intended. Not including this genotype inflated the quality score for these sites.\nDue to interactions with QUAL-based variant and allele trimming, this causes slightly different behavior when HaplotyeCaller is run in modes where it is forced to emit variants for every locus, as can be seen in the expected/gvcf.basepairResolution.includeNonVariantSites.vcf test file for GenotypeGVCFsIntegrationTest: 1) Sites spanned by a deletion are now reported with a * alt allele and have QUAL 0 and a LowQual filter.\nAlso added a mechanism to GenotypeGCVFsIntegrationTest to automatically update the expected result files, similar to what already exists in HaplotypeCallerIntegrationTest and CombineGVCFsIntegrationTest.", "createdAt": "2020-10-01T19:00:28Z", "url": "https://github.com/broadinstitute/gatk/pull/6859", "merged": true, "mergeCommit": {"oid": "61b992f2bf3b43a54925001c18339477ddaced44"}, "closed": true, "closedAt": "2020-10-29T13:31:44Z", "author": {"login": "cwhelan"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdOmpG0AFqTUwMTE3MjMxNg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdXC7x-AFqTUxOTAyMzY2NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxMTcyMzE2", "url": "https://github.com/broadinstitute/gatk/pull/6859#pullrequestreview-501172316", "createdAt": "2020-10-02T14:13:28Z", "commit": {"oid": "d71d669f2dc51b4bb5580638a1a32ed4f17f4aec"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxMjEzMjAw", "url": "https://github.com/broadinstitute/gatk/pull/6859#pullrequestreview-501213200", "createdAt": "2020-10-02T15:01:32Z", "commit": {"oid": "d71d669f2dc51b4bb5580638a1a32ed4f17f4aec"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d71d669f2dc51b4bb5580638a1a32ed4f17f4aec", "author": {"user": {"login": "cwhelan", "name": null}}, "url": "https://github.com/broadinstitute/gatk/commit/d71d669f2dc51b4bb5580638a1a32ed4f17f4aec", "committedDate": "2020-10-01T17:25:28Z", "message": "update HaplotypeCallerSparkIntegrationTest result file"}, "afterCommit": {"oid": "fca9609ba4314e5d37380585c45b50ab0ebebd21", "author": {"user": {"login": "cwhelan", "name": null}}, "url": "https://github.com/broadinstitute/gatk/commit/fca9609ba4314e5d37380585c45b50ab0ebebd21", "committedDate": "2020-10-14T14:16:37Z", "message": "update HaplotypeCallerSparkIntegrationTest result file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2a4263bf78679135f7748742bc6964e494e22393", "author": {"user": {"login": "cwhelan", "name": null}}, "url": "https://github.com/broadinstitute/gatk/commit/2a4263bf78679135f7748742bc6964e494e22393", "committedDate": "2020-10-23T13:17:57Z", "message": "fix off-by one error that was causing the qual calculation to miss probability assigned to homozygous star allele genotypes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0e7733e1c0b243bd706c0a3fb54317e3a9d456d3", "author": {"user": {"login": "cwhelan", "name": null}}, "url": "https://github.com/broadinstitute/gatk/commit/0e7733e1c0b243bd706c0a3fb54317e3a9d456d3", "committedDate": "2020-10-23T13:18:12Z", "message": "update intgration test files"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5ad032d07fcfa5431a1a8d2b54a45b82862aceb0", "author": {"user": {"login": "cwhelan", "name": null}}, "url": "https://github.com/broadinstitute/gatk/commit/5ad032d07fcfa5431a1a8d2b54a45b82862aceb0", "committedDate": "2020-10-23T13:18:12Z", "message": "add update expected results option"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec9311375a0172e162e9b381ac7dcab72c89dc74", "author": {"user": {"login": "cwhelan", "name": null}}, "url": "https://github.com/broadinstitute/gatk/commit/ec9311375a0172e162e9b381ac7dcab72c89dc74", "committedDate": "2020-10-23T13:18:12Z", "message": "updates to handle the case where the only alleles are ref and star"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ed6de8d4c606352fa5aaa58b51a183639f0dddd1", "author": {"user": {"login": "cwhelan", "name": null}}, "url": "https://github.com/broadinstitute/gatk/commit/ed6de8d4c606352fa5aaa58b51a183639f0dddd1", "committedDate": "2020-10-23T13:18:12Z", "message": "update expected result files for GenotypeGVCFsIntegrationTest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "31f6ae7399430c7704102944428bc0785dba66ab", "author": {"user": {"login": "cwhelan", "name": null}}, "url": "https://github.com/broadinstitute/gatk/commit/31f6ae7399430c7704102944428bc0785dba66ab", "committedDate": "2020-10-23T13:18:13Z", "message": "make sure we output all sites if forceOutput it true"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2c15d8e36760988b91e3f26775c2d4d893767235", "author": {"user": {"login": "cwhelan", "name": null}}, "url": "https://github.com/broadinstitute/gatk/commit/2c15d8e36760988b91e3f26775c2d4d893767235", "committedDate": "2020-10-23T13:18:13Z", "message": "update HaplotypeCallerSparkIntegrationTest result file"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fca9609ba4314e5d37380585c45b50ab0ebebd21", "author": {"user": {"login": "cwhelan", "name": null}}, "url": "https://github.com/broadinstitute/gatk/commit/fca9609ba4314e5d37380585c45b50ab0ebebd21", "committedDate": "2020-10-14T14:16:37Z", "message": "update HaplotypeCallerSparkIntegrationTest result file"}, "afterCommit": {"oid": "2c15d8e36760988b91e3f26775c2d4d893767235", "author": {"user": {"login": "cwhelan", "name": null}}, "url": "https://github.com/broadinstitute/gatk/commit/2c15d8e36760988b91e3f26775c2d4d893767235", "committedDate": "2020-10-23T13:18:13Z", "message": "update HaplotypeCallerSparkIntegrationTest result file"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE4ODI0Njg5", "url": "https://github.com/broadinstitute/gatk/pull/6859#pullrequestreview-518824689", "createdAt": "2020-10-28T15:58:58Z", "commit": {"oid": "2c15d8e36760988b91e3f26775c2d4d893767235"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxNTo1ODo1OFrOHpxbHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOFQxNTo1ODo1OFrOHpxbHA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzU2MzQyMA==", "bodyText": "I understand why the HaplotypeCaller outputs changed at SpanningDeletion sites. What about these files? This one looks like it has neither spanning deletions to genotype nor has its input file changed.  Can you explain why there was so much jitter with the old outputs?", "url": "https://github.com/broadinstitute/gatk/pull/6859#discussion_r513563420", "createdAt": "2020-10-28T15:58:58Z", "author": {"login": "jamesemery"}, "path": "src/test/resources/org/broadinstitute/hellbender/tools/walkers/GenotypeGVCFs/AS_Annotations.gatk3.7_30_ga4f720357.expected.vcf", "diffHunk": "@@ -133,29 +133,28 @@\n ##contig=<ID=GL000192.1,length=547496>\n ##contig=<ID=NC_007605,length=171823>\n ##reference=file:///seq/references/Homo_sapiens_assembly19/v1/Homo_sapiens_assembly19.fasta\n-##source=GenotypeGVCFs\n #CHROM\tPOS\tID\tREF\tALT\tQUAL\tFILTER\tINFO\tFORMAT\tNA12878\n-20\t10087820\t.\tC\tCAG\t294.64\t.\tAC=1;AF=0.500;AN=2;AS_BaseQRankSum=-2.100;AS_FS=2.811;AS_MQ=60.00;AS_MQRankSum=0.600;AS_QD=6.15;AS_ReadPosRankSum=-0.400;AS_SOR=1.147;BaseQRankSum=-2.273e+00;DP=93;ExcessHet=3.0103;FS=4.432;MLEAC=1;MLEAF=0.500;MQ=59.55;MQRankSum=0.678;QD=6.14;RAW_MQ=329810.00;ReadPosRankSum=-4.920e-01;SOR=1.302\tGT:AD:GQ:PL\t0/1:35,13:99:302,0,1079", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c15d8e36760988b91e3f26775c2d4d893767235"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE5MDIzNjY0", "url": "https://github.com/broadinstitute/gatk/pull/6859#pullrequestreview-519023664", "createdAt": "2020-10-28T19:42:36Z", "commit": {"oid": "2c15d8e36760988b91e3f26775c2d4d893767235"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2494, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}