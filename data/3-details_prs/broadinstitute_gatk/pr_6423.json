{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY4MTkyMTEx", "number": 6423, "title": "SplitIntervals has non-intuitive behavior for lists of adjacent intervals", "bodyText": "clarify expected behavior with test (and update WGS joint\ncalling WDL in appropriate repos) and update tool docs", "createdAt": "2020-01-28T19:39:23Z", "url": "https://github.com/broadinstitute/gatk/pull/6423", "merged": true, "mergeCommit": {"oid": "3d83411afc8a6cc221f9da1b3729c8e41b8c2bb1"}, "closed": true, "closedAt": "2020-01-29T21:18:27Z", "author": {"login": "ldgauthier"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb-2t8AgFqTM0OTY1MTU2OQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABb-3-QogBqjI5ODcyNTkwMTM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5NjUxNTY5", "url": "https://github.com/broadinstitute/gatk/pull/6423#pullrequestreview-349651569", "createdAt": "2020-01-28T19:43:16Z", "commit": {"oid": "24104fbf126e33cbcc13d21789fe4b6c94d64ed7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxOTo0MzoxNlrOFiyHzg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxOTo0MzoxNlrOFiyHzg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjAxNzEwMg==", "bodyText": "Wow, that's a dumb one on my part.", "url": "https://github.com/broadinstitute/gatk/pull/6423#discussion_r372017102", "createdAt": "2020-01-28T19:43:16Z", "author": {"login": "lbergelson"}, "path": "src/test/java/org/broadinstitute/hellbender/tools/walkers/SplitIntervalsIntegrationTest.java", "diffHunk": "@@ -108,13 +111,43 @@ public void testNoIntervals() {\n \n     }\n \n-    private static Stream<File> getScatteredFiles(final int scatterCount, final File outputDir, String extension) {\n-        return IntStream.range(0, scatterCount).mapToObj(n -> new File(outputDir, \"000\" + n + extension));\n+    @Test\n+    public void testAsInWGSJointCalling() {\n+        //these intervals are small and adjacent -- we want to distribute them among multiple interval lists, but the default behavior is to merge\n+        final File wgsCallingIntervals = new File(\"src/test/resources/hg38.handcurated.noCentromeres.noTelomeres.interval_list\");\n+        final int scatterCount = 100;\n+        final File outputDir = createTempDir(\"output\");\n+        final String[] args = {\n+                \"-R\", hg38Reference,\n+                \"-L\", wgsCallingIntervals.getAbsolutePath(),\n+                \"-\" + SplitIntervals.SCATTER_COUNT_SHORT_NAME, Integer.toString(scatterCount),\n+                \"--\" + SplitIntervals.SUBDIVISION_MODE_lONG_NAME, IntervalListScatterMode.BALANCING_WITHOUT_INTERVAL_SUBDIVISION_WITH_OVERFLOW.toString(),\n+                \"-imr\", IntervalMergingRule.OVERLAPPING_ONLY.toString(),\n+                \"-O\", outputDir.getAbsolutePath()\n+        };\n+        runCommandLine(args);\n+        verifyScatteredFilesExist(scatterCount, outputDir, SplitIntervals.DEFAULT_EXTENSION);\n+\n+        final File outputDir2 = createTempDir(\"output2\");\n+        final String[] args2 = {\n+                \"-R\", hg38Reference,\n+                \"-L\", wgsCallingIntervals.getAbsolutePath(),\n+                \"-\" + SplitIntervals.SCATTER_COUNT_SHORT_NAME, Integer.toString(scatterCount),\n+                \"--\" + SplitIntervals.SUBDIVISION_MODE_lONG_NAME, IntervalListScatterMode.BALANCING_WITHOUT_INTERVAL_SUBDIVISION_WITH_OVERFLOW.toString(),\n+                \"-O\", outputDir2.getAbsolutePath()\n+        };\n+        runCommandLine(args2);\n+        Assert.assertTrue(outputDir2.listFiles().length < scatterCount);\n+    }\n+\n+    //generates the files to look for given a scatter count, directory and extension\n+    private static Stream<File> getExpectedScatteredFiles(final int scatterCount, final File outputDir, String extension) {\n+        return IntStream.range(0, scatterCount).mapToObj(n -> new File(outputDir, formatter.format(n) + extension));\n     }\n \n     private static void verifyScatteredFilesExist(final int scatterCount, final File outputDir, String extension) {\n-        getScatteredFiles(scatterCount, outputDir, extension).forEach(f -> Assert.assertTrue(f.exists()));\n-        Assert.assertFalse(new File(outputDir, \"000\" + scatterCount + extension).exists());\n+        getExpectedScatteredFiles(scatterCount, outputDir, extension).forEach(f -> Assert.assertTrue(f.exists()));\n+        Assert.assertFalse(new File(outputDir, formatter.format(scatterCount) + extension).exists());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "24104fbf126e33cbcc13d21789fe4b6c94d64ed7"}, "originalPosition": 71}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5NjU1OTQ5", "url": "https://github.com/broadinstitute/gatk/pull/6423#pullrequestreview-349655949", "createdAt": "2020-01-28T19:50:07Z", "commit": {"oid": "24104fbf126e33cbcc13d21789fe4b6c94d64ed7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxOTo1MDowN1rOFiyVOg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOFQxOTo1MDowN1rOFiyVOg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjAyMDUzOA==", "bodyText": "publicTestDir instead of hardcoding the path would be better probably", "url": "https://github.com/broadinstitute/gatk/pull/6423#discussion_r372020538", "createdAt": "2020-01-28T19:50:07Z", "author": {"login": "lbergelson"}, "path": "src/test/java/org/broadinstitute/hellbender/tools/walkers/SplitIntervalsIntegrationTest.java", "diffHunk": "@@ -108,13 +111,43 @@ public void testNoIntervals() {\n \n     }\n \n-    private static Stream<File> getScatteredFiles(final int scatterCount, final File outputDir, String extension) {\n-        return IntStream.range(0, scatterCount).mapToObj(n -> new File(outputDir, \"000\" + n + extension));\n+    @Test\n+    public void testAsInWGSJointCalling() {\n+        //these intervals are small and adjacent -- we want to distribute them among multiple interval lists, but the default behavior is to merge\n+        final File wgsCallingIntervals = new File(\"src/test/resources/hg38.handcurated.noCentromeres.noTelomeres.interval_list\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "24104fbf126e33cbcc13d21789fe4b6c94d64ed7"}, "originalPosition": 36}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ5NjU2NzM3", "url": "https://github.com/broadinstitute/gatk/pull/6423#pullrequestreview-349656737", "createdAt": "2020-01-28T19:51:18Z", "commit": {"oid": "24104fbf126e33cbcc13d21789fe4b6c94d64ed7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "27c33a3fe112310a9f3ed4e41673d8bd97ef4aae", "author": {"user": {"login": "ldgauthier", "name": null}}, "url": "https://github.com/broadinstitute/gatk/commit/27c33a3fe112310a9f3ed4e41673d8bd97ef4aae", "committedDate": "2020-01-28T21:10:52Z", "message": "SplitIntervals has non-intuitive behavior for lists of adjacent\nintervals -- clarify expected behavior with test (and update WGS joint\ncalling WDL in appropriate repos)"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "24104fbf126e33cbcc13d21789fe4b6c94d64ed7", "author": {"user": {"login": "ldgauthier", "name": null}}, "url": "https://github.com/broadinstitute/gatk/commit/24104fbf126e33cbcc13d21789fe4b6c94d64ed7", "committedDate": "2020-01-28T19:38:57Z", "message": "Update docs"}, "afterCommit": {"oid": "27c33a3fe112310a9f3ed4e41673d8bd97ef4aae", "author": {"user": {"login": "ldgauthier", "name": null}}, "url": "https://github.com/broadinstitute/gatk/commit/27c33a3fe112310a9f3ed4e41673d8bd97ef4aae", "committedDate": "2020-01-28T21:10:52Z", "message": "SplitIntervals has non-intuitive behavior for lists of adjacent\nintervals -- clarify expected behavior with test (and update WGS joint\ncalling WDL in appropriate repos)"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2733, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}