{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc4NDkwNjA3", "number": 6465, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQxOToyMzo1NlrODj7N5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQyMDoxMDoxMFrODj8E9g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4OTk2OTY3OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/broadinstitute/hellbender/utils/IntervalUtils.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQxOToyMzo1NlrOFwAJww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQyMDoxMDoyOVrOFwBeyw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTg3ODQ2Nw==", "bodyText": "Kind of a nit, but this error message will no longer include \".interval_list\", which is an acceptable extension.", "url": "https://github.com/broadinstitute/gatk/pull/6465#discussion_r385878467", "createdAt": "2020-02-28T19:23:56Z", "author": {"login": "cmnbroad"}, "path": "src/main/java/org/broadinstitute/hellbender/utils/IntervalUtils.java", "diffHunk": "@@ -303,27 +315,23 @@ public static GenomeLocSortedSet loadIntervals(\n         }\n         // If it's a Feature-containing file, convert it to a list of intervals\n         else if ( FeatureManager.isFeatureFile(IOUtils.getPath(arg)) ) {\n-            rawIntervals.addAll(featureFileToIntervals(parser, arg));\n-        }\n-        // If it's an interval file, add its contents to the raw interval list\n-        else if ( isIntervalFile(arg) ) {\n             try {\n-                rawIntervals.addAll(intervalFileToList(parser, arg));\n-            }\n-            catch ( final UserException.MalformedGenomeLoc e ) {\n-                throw e;\n-            }\n-            catch ( final Exception e ) {\n-                throw new UserException.MalformedFile(new File(arg), \"Interval file could not be parsed in any supported format.\", e);\n+                rawIntervals.addAll(featureFileToIntervals(parser, arg));\n+            } catch (final IllegalArgumentException e){\n+                throw new UserException.MalformedFile(IOUtils.getPath(arg), \"Failure while loading intervals from file.\", e);\n             }\n         }\n+        // If it's an interval file, add its contents to the raw interval list\n+        else if ( isGatkIntervalFile(arg) ) {\n+            rawIntervals.addAll(gatkIntervalFileToList(parser, arg));\n+        }\n         // If it's neither a Feature-containing file nor an interval file, but is an existing file, throw an error.\n         // Note that since contigs can contain periods in their names, we can't use the mere presence of an \"extension\"\n         // as evidence that the user intended the String to be interpreted as a file.\n         else if ( new File(arg).exists() ) {\n             throw new UserException.CouldNotReadInputFile(arg, String.format(\"The file %s exists, but does not contain Features \" +\n                     \"(ie., is not in a supported Feature file format such as vcf, bcf, or bed), \" +\n-                    \"and does not have one of the supported interval file extensions (\" + INTERVAL_FILE_EXTENSIONS + \"). \" +\n+                    \"and does not have one of the supported interval file extensions (\" + GATK_INTERVAL_FILE_EXTENSIONS + \"). \" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7f6f0abff6bf507f77973b79431d411b98cd8a4f"}, "originalPosition": 64}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTkwMDIzNQ==", "bodyText": "technically interval_list is a feature file now", "url": "https://github.com/broadinstitute/gatk/pull/6465#discussion_r385900235", "createdAt": "2020-02-28T20:10:29Z", "author": {"login": "lbergelson"}, "path": "src/main/java/org/broadinstitute/hellbender/utils/IntervalUtils.java", "diffHunk": "@@ -303,27 +315,23 @@ public static GenomeLocSortedSet loadIntervals(\n         }\n         // If it's a Feature-containing file, convert it to a list of intervals\n         else if ( FeatureManager.isFeatureFile(IOUtils.getPath(arg)) ) {\n-            rawIntervals.addAll(featureFileToIntervals(parser, arg));\n-        }\n-        // If it's an interval file, add its contents to the raw interval list\n-        else if ( isIntervalFile(arg) ) {\n             try {\n-                rawIntervals.addAll(intervalFileToList(parser, arg));\n-            }\n-            catch ( final UserException.MalformedGenomeLoc e ) {\n-                throw e;\n-            }\n-            catch ( final Exception e ) {\n-                throw new UserException.MalformedFile(new File(arg), \"Interval file could not be parsed in any supported format.\", e);\n+                rawIntervals.addAll(featureFileToIntervals(parser, arg));\n+            } catch (final IllegalArgumentException e){\n+                throw new UserException.MalformedFile(IOUtils.getPath(arg), \"Failure while loading intervals from file.\", e);\n             }\n         }\n+        // If it's an interval file, add its contents to the raw interval list\n+        else if ( isGatkIntervalFile(arg) ) {\n+            rawIntervals.addAll(gatkIntervalFileToList(parser, arg));\n+        }\n         // If it's neither a Feature-containing file nor an interval file, but is an existing file, throw an error.\n         // Note that since contigs can contain periods in their names, we can't use the mere presence of an \"extension\"\n         // as evidence that the user intended the String to be interpreted as a file.\n         else if ( new File(arg).exists() ) {\n             throw new UserException.CouldNotReadInputFile(arg, String.format(\"The file %s exists, but does not contain Features \" +\n                     \"(ie., is not in a supported Feature file format such as vcf, bcf, or bed), \" +\n-                    \"and does not have one of the supported interval file extensions (\" + INTERVAL_FILE_EXTENSIONS + \"). \" +\n+                    \"and does not have one of the supported interval file extensions (\" + GATK_INTERVAL_FILE_EXTENSIONS + \"). \" +", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTg3ODQ2Nw=="}, "originalCommit": {"oid": "7f6f0abff6bf507f77973b79431d411b98cd8a4f"}, "originalPosition": 64}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4OTk4MjA3OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/broadinstitute/hellbender/utils/IntervalUtils.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQxOToyODoxOVrOFwARSA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQyMDoyMTo1OVrOFwBxBg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTg4MDM5Mg==", "bodyText": "This block seems unnecessary ? It might be better to just rely on the next catch block, which will always include the inputPath name.", "url": "https://github.com/broadinstitute/gatk/pull/6465#discussion_r385880392", "createdAt": "2020-02-28T19:28:19Z", "author": {"login": "cmnbroad"}, "path": "src/main/java/org/broadinstitute/hellbender/utils/IntervalUtils.java", "diffHunk": "@@ -356,67 +364,35 @@ else if ( new File(arg).exists() ) {\n     }\n \n     /**\n-     * Read a file of genome locations to process. The file may be in Picard\n-     * or GATK interval format.\n+     * Read a file of genome locations to process, this file must be in GATK interval format.\n      *\n      * @param glParser   GenomeLocParser\n      * @param fileName  interval file\n      * @return List<GenomeLoc> List of Genome Locs that have been parsed from file\n      */\n-    public static List<GenomeLoc> intervalFileToList(final GenomeLocParser glParser, final String fileName) {\n+    private static List<GenomeLoc> gatkIntervalFileToList(final GenomeLocParser glParser, final String fileName) {\n         Utils.nonNull(glParser, \"glParser is null\");\n         Utils.nonNull(fileName, \"file name is null\");\n \n         final Path inputPath = IOUtils.getPath(fileName);\n         final List<GenomeLoc> ret = new ArrayList<>();\n \n-        /**\n-         * First try to read the file as a Picard interval file since that's well structured --\n-         * we'll fail quickly if it's not a valid file.\n-         */\n-        boolean isPicardInterval = false;\n-        try {\n-            // Note: Picard will skip over intervals with contigs not in the sequence dictionary\n-            final IntervalList il = IntervalList.fromPath(inputPath);\n-            isPicardInterval = true;\n-\n-            for (final Interval interval : il.getIntervals()) {\n-                // The current Agilent exome interval list is off-by-one on all end positions. Until this is fixed we\n-                // need to tolerate intervals where the end is one before the start. We should remove this once a\n-                // corrected version of the interval list is released. This is tracked in:\n-                // https://github.com/broadinstitute/gatk/issues/2089\n-                if (interval.getStart() - interval.getEnd() == 1 ) {\n-                    logger.warn(\"Ignoring possibly incorrectly converted length 1 interval : \" + interval);\n-                }\n-                else if ( glParser.isValidGenomeLoc(interval.getContig(), interval.getStart(), interval.getEnd(), true)) {\n-                    ret.add(glParser.createGenomeLoc(interval.getContig(), interval.getStart(), interval.getEnd(), true));\n-                } else {\n-                    throw new UserException(inputPath.toUri() +  \" has an invalid interval : \" + interval) ;\n+        try (final PathLineIterator reader = new PathLineIterator(inputPath)) {\n+            for (final String line : reader) {\n+                final String trimmedLine = line.trim();\n+                if (!trimmedLine.isEmpty()) {\n+                    ret.add(glParser.parseGenomeLoc(trimmedLine));\n                 }\n             }\n-        }\n-        // if that didn't work, try parsing file as a GATK interval file\n-        catch (final Exception e) {\n-            if ( isPicardInterval ) // definitely a picard file, but we failed to parse\n-            {\n-                throw new UserException.CouldNotReadInputFile(inputPath, e);\n-            } else {\n-                try (PathLineIterator reader = new PathLineIterator(inputPath)) {\n-                    for (final String line : reader) {\n-                        final String trimmedLine = line.trim();\n-                        if (!trimmedLine.isEmpty()) {\n-                            ret.add(glParser.parseGenomeLoc(trimmedLine));\n-                        }\n-                    }\n-                }\n+            if (ret.isEmpty()) {\n+                throw new UserException.MalformedFile(inputPath, \"It contains no intervals.\");\n             }\n+            return ret;\n+        } catch (final UserException e){\n+            throw e;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7f6f0abff6bf507f77973b79431d411b98cd8a4f"}, "originalPosition": 137}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTkwNDkwMg==", "bodyText": "I think I thought it might replace a more specific error with a less specific one.  Since userexceptions don't show the stack trace you'd lose the underlying one in most cases.", "url": "https://github.com/broadinstitute/gatk/pull/6465#discussion_r385904902", "createdAt": "2020-02-28T20:21:59Z", "author": {"login": "lbergelson"}, "path": "src/main/java/org/broadinstitute/hellbender/utils/IntervalUtils.java", "diffHunk": "@@ -356,67 +364,35 @@ else if ( new File(arg).exists() ) {\n     }\n \n     /**\n-     * Read a file of genome locations to process. The file may be in Picard\n-     * or GATK interval format.\n+     * Read a file of genome locations to process, this file must be in GATK interval format.\n      *\n      * @param glParser   GenomeLocParser\n      * @param fileName  interval file\n      * @return List<GenomeLoc> List of Genome Locs that have been parsed from file\n      */\n-    public static List<GenomeLoc> intervalFileToList(final GenomeLocParser glParser, final String fileName) {\n+    private static List<GenomeLoc> gatkIntervalFileToList(final GenomeLocParser glParser, final String fileName) {\n         Utils.nonNull(glParser, \"glParser is null\");\n         Utils.nonNull(fileName, \"file name is null\");\n \n         final Path inputPath = IOUtils.getPath(fileName);\n         final List<GenomeLoc> ret = new ArrayList<>();\n \n-        /**\n-         * First try to read the file as a Picard interval file since that's well structured --\n-         * we'll fail quickly if it's not a valid file.\n-         */\n-        boolean isPicardInterval = false;\n-        try {\n-            // Note: Picard will skip over intervals with contigs not in the sequence dictionary\n-            final IntervalList il = IntervalList.fromPath(inputPath);\n-            isPicardInterval = true;\n-\n-            for (final Interval interval : il.getIntervals()) {\n-                // The current Agilent exome interval list is off-by-one on all end positions. Until this is fixed we\n-                // need to tolerate intervals where the end is one before the start. We should remove this once a\n-                // corrected version of the interval list is released. This is tracked in:\n-                // https://github.com/broadinstitute/gatk/issues/2089\n-                if (interval.getStart() - interval.getEnd() == 1 ) {\n-                    logger.warn(\"Ignoring possibly incorrectly converted length 1 interval : \" + interval);\n-                }\n-                else if ( glParser.isValidGenomeLoc(interval.getContig(), interval.getStart(), interval.getEnd(), true)) {\n-                    ret.add(glParser.createGenomeLoc(interval.getContig(), interval.getStart(), interval.getEnd(), true));\n-                } else {\n-                    throw new UserException(inputPath.toUri() +  \" has an invalid interval : \" + interval) ;\n+        try (final PathLineIterator reader = new PathLineIterator(inputPath)) {\n+            for (final String line : reader) {\n+                final String trimmedLine = line.trim();\n+                if (!trimmedLine.isEmpty()) {\n+                    ret.add(glParser.parseGenomeLoc(trimmedLine));\n                 }\n             }\n-        }\n-        // if that didn't work, try parsing file as a GATK interval file\n-        catch (final Exception e) {\n-            if ( isPicardInterval ) // definitely a picard file, but we failed to parse\n-            {\n-                throw new UserException.CouldNotReadInputFile(inputPath, e);\n-            } else {\n-                try (PathLineIterator reader = new PathLineIterator(inputPath)) {\n-                    for (final String line : reader) {\n-                        final String trimmedLine = line.trim();\n-                        if (!trimmedLine.isEmpty()) {\n-                            ret.add(glParser.parseGenomeLoc(trimmedLine));\n-                        }\n-                    }\n-                }\n+            if (ret.isEmpty()) {\n+                throw new UserException.MalformedFile(inputPath, \"It contains no intervals.\");\n             }\n+            return ret;\n+        } catch (final UserException e){\n+            throw e;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTg4MDM5Mg=="}, "originalCommit": {"oid": "7f6f0abff6bf507f77973b79431d411b98cd8a4f"}, "originalPosition": 137}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM5MDExMDYyOnYy", "diffSide": "RIGHT", "path": "src/main/java/org/broadinstitute/hellbender/utils/IntervalUtils.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQyMDoxMDoxMFrOFwBeVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQyMDoxMDoxMFrOFwBeVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTkwMDExNg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                \"(ie., is not in a supported Feature file format such as vcf, bcf, or bed), \" +\n          \n          \n            \n                                \"(ie., is not in a supported Feature file format such as vcf, bcf, bed, or interval_list), \" +", "url": "https://github.com/broadinstitute/gatk/pull/6465#discussion_r385900116", "createdAt": "2020-02-28T20:10:10Z", "author": {"login": "lbergelson"}, "path": "src/main/java/org/broadinstitute/hellbender/utils/IntervalUtils.java", "diffHunk": "@@ -303,27 +315,23 @@ public static GenomeLocSortedSet loadIntervals(\n         }\n         // If it's a Feature-containing file, convert it to a list of intervals\n         else if ( FeatureManager.isFeatureFile(IOUtils.getPath(arg)) ) {\n-            rawIntervals.addAll(featureFileToIntervals(parser, arg));\n-        }\n-        // If it's an interval file, add its contents to the raw interval list\n-        else if ( isIntervalFile(arg) ) {\n             try {\n-                rawIntervals.addAll(intervalFileToList(parser, arg));\n-            }\n-            catch ( final UserException.MalformedGenomeLoc e ) {\n-                throw e;\n-            }\n-            catch ( final Exception e ) {\n-                throw new UserException.MalformedFile(new File(arg), \"Interval file could not be parsed in any supported format.\", e);\n+                rawIntervals.addAll(featureFileToIntervals(parser, arg));\n+            } catch (final IllegalArgumentException e){\n+                throw new UserException.MalformedFile(IOUtils.getPath(arg), \"Failure while loading intervals from file.\", e);\n             }\n         }\n+        // If it's an interval file, add its contents to the raw interval list\n+        else if ( isGatkIntervalFile(arg) ) {\n+            rawIntervals.addAll(gatkIntervalFileToList(parser, arg));\n+        }\n         // If it's neither a Feature-containing file nor an interval file, but is an existing file, throw an error.\n         // Note that since contigs can contain periods in their names, we can't use the mere presence of an \"extension\"\n         // as evidence that the user intended the String to be interpreted as a file.\n         else if ( new File(arg).exists() ) {\n             throw new UserException.CouldNotReadInputFile(arg, String.format(\"The file %s exists, but does not contain Features \" +\n                     \"(ie., is not in a supported Feature file format such as vcf, bcf, or bed), \" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7f6f0abff6bf507f77973b79431d411b98cd8a4f"}, "originalPosition": 62}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1111, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}