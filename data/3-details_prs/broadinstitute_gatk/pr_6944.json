{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE2OTMzODc1", "number": 6944, "title": "Added a check to VariantAnnotator that all read samples are present in the VCF", "bodyText": "Fixes #6915", "createdAt": "2020-11-06T19:22:34Z", "url": "https://github.com/broadinstitute/gatk/pull/6944", "merged": true, "mergeCommit": {"oid": "9e381c9fdec637772fc6adcd2338b8a4dda599d3"}, "closed": true, "closedAt": "2020-11-24T21:12:53Z", "author": {"login": "jamesemery"}, "timelineItems": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdZ8BrqgH2gAyNTE2OTMzODc1OmM0ZjVmYzc1OGNmODU2ZGZjNmZkMDE1MjZjMmRiYjI2NjJiNzUyNWY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdfwZQXgFqTUzNzkzMjA0MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c4f5fc758cf856dfc6fd01526c2dbb2662b7525f", "author": {"user": {"login": "jamesemery", "name": null}}, "url": "https://github.com/broadinstitute/gatk/commit/c4f5fc758cf856dfc6fd01526c2dbb2662b7525f", "committedDate": "2020-11-06T19:21:29Z", "message": "added a validation check that all samples in the input bam are present in the provided vcf before running variant annotator"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM3ODg2NDA4", "url": "https://github.com/broadinstitute/gatk/pull/6944#pullrequestreview-537886408", "createdAt": "2020-11-24T20:40:42Z", "commit": {"oid": "c4f5fc758cf856dfc6fd01526c2dbb2662b7525f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQyMDo0MDo0MlrOH5UWyg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQyMDo0MDo0MlrOH5UWyg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTg2NDM5NA==", "bodyText": "This checks whether the samples in the bam are present in the vcf. But the original bug report in #6915 was (according to @gbrandt6 ) triggered by the reverse case where samples in the vcf don't exist in the bam.", "url": "https://github.com/broadinstitute/gatk/pull/6944#discussion_r529864394", "createdAt": "2020-11-24T20:40:42Z", "author": {"login": "droazen"}, "path": "src/main/java/org/broadinstitute/hellbender/tools/walkers/annotator/VariantAnnotator.java", "diffHunk": "@@ -196,6 +197,14 @@ public void onTraversalStart() {\n         sequenceDictionary = getBestAvailableSequenceDictionary();\n         variantSamples = new IndexedSampleList(samples);\n \n+        // Check that the reads have compatible samples to the variants:\n+        if (hasReads()) {\n+            final Set<String> readsSamples = getHeaderForReads().getReadGroups().stream().map(rg -> rg.getSample()).collect(Collectors.toSet());\n+            readsSamples.forEach(readSample -> {\n+                if (!samples.contains(readSample))\n+                    throw new UserException(String.format(\"Reads sample '%s' from readgroups tags does not match any sample in the variant genotypes\", readSample));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c4f5fc758cf856dfc6fd01526c2dbb2662b7525f"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM3OTMyMDQw", "url": "https://github.com/broadinstitute/gatk/pull/6944#pullrequestreview-537932040", "createdAt": "2020-11-24T21:11:55Z", "commit": {"oid": "c4f5fc758cf856dfc6fd01526c2dbb2662b7525f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2538, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}