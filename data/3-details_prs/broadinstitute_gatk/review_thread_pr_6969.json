{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIzOTg1NTAy", "number": 6969, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxNDoyMzo0MVrOE7E-eQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxNDoyOTozNFrOE7FJXA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwMzgyOTY5OnYy", "diffSide": "RIGHT", "path": "scripts/variantstore/wdl/ImportGenomes.wdl", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxNDoyMzo0MVrOH2g-RQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxNzowNTozMlrOH2ouZA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjkyNTM4MQ==", "bodyText": "Does Cromwell wait until the full scatter of CreateImportTsvs is complete? Or will this run as soon as the first shard is done?", "url": "https://github.com/broadinstitute/gatk/pull/6969#discussion_r526925381", "createdAt": "2020-11-19T14:23:41Z", "author": {"login": "meganshand"}, "path": "scripts/variantstore/wdl/ImportGenomes.wdl", "diffHunk": "@@ -43,50 +46,76 @@ workflow ImportGenomes {\n     }\n   }\n \n-  call LoadData as LoadMetadataTsvs{\n-    input:\n-      done = CreateImportTsvs.done[0],\n-      project_id = project_id,\n-      dataset_name = dataset_name,\n-      storage_location = output_directory,\n-      datatype = \"metadata\",\n-      numbered = \"false\",\n-      partitioned = \"false\",\n-      table_id = table_id,\n-      schema = metadata_schema,\n-      preemptible_tries = preemptible_tries,\n-      docker = docker_final\n-  }\n+  scatter (i in range(GetMaxTableId.max_table_id)) {\n+    call LoadData as LoadMetadataTsvs{\n+      input:\n+        done = CreateImportTsvs.done[0],\n+        project_id = project_id,\n+        dataset_name = dataset_name,\n+        storage_location = output_directory,\n+        datatype = \"metadata\",\n+        numbered = \"false\",\n+        partitioned = \"false\",\n+        table_id = i + 1,\n+        schema = metadata_schema,\n+        preemptible_tries = preemptible_tries,\n+        docker = docker_final\n+    }\n \n     call LoadData as LoadPetTsvs{\n-    input:\n-      done = CreateImportTsvs.done[0],\n-      project_id = project_id,\n-      dataset_name = dataset_name,\n-      storage_location = output_directory,\n-      datatype = \"pet\",\n-      table_id = table_id,\n-      schema = pet_schema,\n-      preemptible_tries = preemptible_tries,\n-      docker = docker_final\n+      input:\n+        done = CreateImportTsvs.done[0],", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d4e53fb7da427531084188783ffbea78c665d836"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjk0Nzg4Mw==", "bodyText": "I didn't change this -- so I assumed it was doing the right thing before (it does seem to wait) but I wonder if instead if \"done\" should be an array of all the inputs?   @ahaessly how did you arrive at this solution?", "url": "https://github.com/broadinstitute/gatk/pull/6969#discussion_r526947883", "createdAt": "2020-11-19T14:52:43Z", "author": {"login": "kcibul"}, "path": "scripts/variantstore/wdl/ImportGenomes.wdl", "diffHunk": "@@ -43,50 +46,76 @@ workflow ImportGenomes {\n     }\n   }\n \n-  call LoadData as LoadMetadataTsvs{\n-    input:\n-      done = CreateImportTsvs.done[0],\n-      project_id = project_id,\n-      dataset_name = dataset_name,\n-      storage_location = output_directory,\n-      datatype = \"metadata\",\n-      numbered = \"false\",\n-      partitioned = \"false\",\n-      table_id = table_id,\n-      schema = metadata_schema,\n-      preemptible_tries = preemptible_tries,\n-      docker = docker_final\n-  }\n+  scatter (i in range(GetMaxTableId.max_table_id)) {\n+    call LoadData as LoadMetadataTsvs{\n+      input:\n+        done = CreateImportTsvs.done[0],\n+        project_id = project_id,\n+        dataset_name = dataset_name,\n+        storage_location = output_directory,\n+        datatype = \"metadata\",\n+        numbered = \"false\",\n+        partitioned = \"false\",\n+        table_id = i + 1,\n+        schema = metadata_schema,\n+        preemptible_tries = preemptible_tries,\n+        docker = docker_final\n+    }\n \n     call LoadData as LoadPetTsvs{\n-    input:\n-      done = CreateImportTsvs.done[0],\n-      project_id = project_id,\n-      dataset_name = dataset_name,\n-      storage_location = output_directory,\n-      datatype = \"pet\",\n-      table_id = table_id,\n-      schema = pet_schema,\n-      preemptible_tries = preemptible_tries,\n-      docker = docker_final\n+      input:\n+        done = CreateImportTsvs.done[0],", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjkyNTM4MQ=="}, "originalCommit": {"oid": "d4e53fb7da427531084188783ffbea78c665d836"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjk5Mjk2MA==", "bodyText": "@kcibul i think that when i used done, it was just a true/false that was set at the end of a task. i don't think i used it after a scatter. but i think passing the array would be safest. i guess we would change the input param to be an Array of String? (if it's an array of file, we should set the meta param for localizationOptional to true so it doesn't try to localize them all)", "url": "https://github.com/broadinstitute/gatk/pull/6969#discussion_r526992960", "createdAt": "2020-11-19T15:48:51Z", "author": {"login": "ahaessly"}, "path": "scripts/variantstore/wdl/ImportGenomes.wdl", "diffHunk": "@@ -43,50 +46,76 @@ workflow ImportGenomes {\n     }\n   }\n \n-  call LoadData as LoadMetadataTsvs{\n-    input:\n-      done = CreateImportTsvs.done[0],\n-      project_id = project_id,\n-      dataset_name = dataset_name,\n-      storage_location = output_directory,\n-      datatype = \"metadata\",\n-      numbered = \"false\",\n-      partitioned = \"false\",\n-      table_id = table_id,\n-      schema = metadata_schema,\n-      preemptible_tries = preemptible_tries,\n-      docker = docker_final\n-  }\n+  scatter (i in range(GetMaxTableId.max_table_id)) {\n+    call LoadData as LoadMetadataTsvs{\n+      input:\n+        done = CreateImportTsvs.done[0],\n+        project_id = project_id,\n+        dataset_name = dataset_name,\n+        storage_location = output_directory,\n+        datatype = \"metadata\",\n+        numbered = \"false\",\n+        partitioned = \"false\",\n+        table_id = i + 1,\n+        schema = metadata_schema,\n+        preemptible_tries = preemptible_tries,\n+        docker = docker_final\n+    }\n \n     call LoadData as LoadPetTsvs{\n-    input:\n-      done = CreateImportTsvs.done[0],\n-      project_id = project_id,\n-      dataset_name = dataset_name,\n-      storage_location = output_directory,\n-      datatype = \"pet\",\n-      table_id = table_id,\n-      schema = pet_schema,\n-      preemptible_tries = preemptible_tries,\n-      docker = docker_final\n+      input:\n+        done = CreateImportTsvs.done[0],", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjkyNTM4MQ=="}, "originalCommit": {"oid": "d4e53fb7da427531084188783ffbea78c665d836"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA1MjM4OA==", "bodyText": "Yeah I agree, we should pass in the whole Array.", "url": "https://github.com/broadinstitute/gatk/pull/6969#discussion_r527052388", "createdAt": "2020-11-19T17:05:32Z", "author": {"login": "meganshand"}, "path": "scripts/variantstore/wdl/ImportGenomes.wdl", "diffHunk": "@@ -43,50 +46,76 @@ workflow ImportGenomes {\n     }\n   }\n \n-  call LoadData as LoadMetadataTsvs{\n-    input:\n-      done = CreateImportTsvs.done[0],\n-      project_id = project_id,\n-      dataset_name = dataset_name,\n-      storage_location = output_directory,\n-      datatype = \"metadata\",\n-      numbered = \"false\",\n-      partitioned = \"false\",\n-      table_id = table_id,\n-      schema = metadata_schema,\n-      preemptible_tries = preemptible_tries,\n-      docker = docker_final\n-  }\n+  scatter (i in range(GetMaxTableId.max_table_id)) {\n+    call LoadData as LoadMetadataTsvs{\n+      input:\n+        done = CreateImportTsvs.done[0],\n+        project_id = project_id,\n+        dataset_name = dataset_name,\n+        storage_location = output_directory,\n+        datatype = \"metadata\",\n+        numbered = \"false\",\n+        partitioned = \"false\",\n+        table_id = i + 1,\n+        schema = metadata_schema,\n+        preemptible_tries = preemptible_tries,\n+        docker = docker_final\n+    }\n \n     call LoadData as LoadPetTsvs{\n-    input:\n-      done = CreateImportTsvs.done[0],\n-      project_id = project_id,\n-      dataset_name = dataset_name,\n-      storage_location = output_directory,\n-      datatype = \"pet\",\n-      table_id = table_id,\n-      schema = pet_schema,\n-      preemptible_tries = preemptible_tries,\n-      docker = docker_final\n+      input:\n+        done = CreateImportTsvs.done[0],", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjkyNTM4MQ=="}, "originalCommit": {"oid": "d4e53fb7da427531084188783ffbea78c665d836"}, "originalPosition": 67}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwMzgzODE1OnYy", "diffSide": "LEFT", "path": "scripts/variantstore/wdl/ImportGenomes.wdl", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxNDoyNToyNVrOH2hDgg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxNDozODozNFrOH2hqWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjkyNjcyMg==", "bodyText": "Does this still fail with a nice error message if there's no dataset? (Nice enough that I'll realize I forgot to make one)", "url": "https://github.com/broadinstitute/gatk/pull/6969#discussion_r526926722", "createdAt": "2020-11-19T14:25:25Z", "author": {"login": "meganshand"}, "path": "scripts/variantstore/wdl/ImportGenomes.wdl", "diffHunk": "@@ -178,10 +207,6 @@ task LoadData {\n \n   command <<<\n     set -x\n-    set +e\n-    # make sure dataset exists\n-    bq ls --project_id ~{project_id} ~{dataset_name} > /dev/null", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d4e53fb7da427531084188783ffbea78c665d836"}, "originalPosition": 140}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjkzNjY2NA==", "bodyText": "I removed this because later on when you go to make the table, it fails will a clear error message if the dataset doesn't exist", "url": "https://github.com/broadinstitute/gatk/pull/6969#discussion_r526936664", "createdAt": "2020-11-19T14:38:34Z", "author": {"login": "kcibul"}, "path": "scripts/variantstore/wdl/ImportGenomes.wdl", "diffHunk": "@@ -178,10 +207,6 @@ task LoadData {\n \n   command <<<\n     set -x\n-    set +e\n-    # make sure dataset exists\n-    bq ls --project_id ~{project_id} ~{dataset_name} > /dev/null", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjkyNjcyMg=="}, "originalCommit": {"oid": "d4e53fb7da427531084188783ffbea78c665d836"}, "originalPosition": 140}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwMzg1NzU2OnYy", "diffSide": "RIGHT", "path": "scripts/variantstore/wdl/ImportGenomes.wdl", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxNDoyOTozNFrOH2hPvw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxNDozNzo1NVrOH2hohQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjkyOTg1NQ==", "bodyText": "Why does loading the data need so much disk? Isn't it just importing what's in a separate google bucket?", "url": "https://github.com/broadinstitute/gatk/pull/6969#discussion_r526929855", "createdAt": "2020-11-19T14:29:34Z", "author": {"login": "meganshand"}, "path": "scripts/variantstore/wdl/ImportGenomes.wdl", "diffHunk": "@@ -230,8 +264,8 @@ task LoadData {\n   >>>\n   runtime {\n     docker: docker\n-    memory: \"4 GB\"\n-    disks: \"local-disk 10 HDD\"\n+    memory: \"10 GB\"\n+    disks: \"local-disk 1000 HDD\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d4e53fb7da427531084188783ffbea78c665d836"}, "originalPosition": 190}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjkzNjE5Nw==", "bodyText": "no idea -- I changed it to match Terra, but you're right.  I'm going to change it back :D", "url": "https://github.com/broadinstitute/gatk/pull/6969#discussion_r526936197", "createdAt": "2020-11-19T14:37:55Z", "author": {"login": "kcibul"}, "path": "scripts/variantstore/wdl/ImportGenomes.wdl", "diffHunk": "@@ -230,8 +264,8 @@ task LoadData {\n   >>>\n   runtime {\n     docker: docker\n-    memory: \"4 GB\"\n-    disks: \"local-disk 10 HDD\"\n+    memory: \"10 GB\"\n+    disks: \"local-disk 1000 HDD\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjkyOTg1NQ=="}, "originalCommit": {"oid": "d4e53fb7da427531084188783ffbea78c665d836"}, "originalPosition": 190}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 861, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}