{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY4NzcxNjU3", "number": 6425, "title": "Handle zero-weight Gaussians correctly in VariantRecalibrator", "bodyText": "", "createdAt": "2020-01-29T21:22:07Z", "url": "https://github.com/broadinstitute/gatk/pull/6425", "merged": true, "mergeCommit": {"oid": "d3cd0ccb8c2bd91615a9a56fd590fe021390c187"}, "closed": true, "closedAt": "2020-02-07T15:33:24Z", "author": {"login": "ldgauthier"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb_T5N3gFqTM1MDU4NTY2Mg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcBX7q-AFqTM1MzgxMDkwMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUwNTg1NjYy", "url": "https://github.com/broadinstitute/gatk/pull/6425#pullrequestreview-350585662", "createdAt": "2020-01-30T05:15:36Z", "commit": {"oid": "389d956feb94d9bbcd82e8cf0d2b46667bdf8db7"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQwNToxNTozNlrOFjfpBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQwNTo0MDowOFrOFjf6jg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mjc2Mjg4Nw==", "bodyText": "It's not clear to me why this special case is needed.  If it's negative infinity, then adding the normalDistributionLog10 to it yields negative infinity.  You avoid calculating it, of course, but presumably this is an edge case and the optimization doesn't matter.\nMy other guess is that sigma or mu could be NaNs somehow?  If so, why is this connected to zero weight?", "url": "https://github.com/broadinstitute/gatk/pull/6425#discussion_r372762887", "createdAt": "2020-01-30T05:15:36Z", "author": {"login": "davidbenjamin"}, "path": "src/main/java/org/broadinstitute/hellbender/tools/walkers/vqsr/GaussianMixtureModel.java", "diffHunk": "@@ -212,7 +212,11 @@ public Double evaluateDatumInOneDimension( final VariantDatum datum, final int i\n         final double[] pVarInGaussianLog10 = new double[gaussians.size()];\n         int gaussianIndex = 0;\n         for( final MultivariateGaussian gaussian : gaussians ) {\n-            pVarInGaussianLog10[gaussianIndex++] = gaussian.pMixtureLog10 + MathUtils.normalDistributionLog10(gaussian.mu[iii], gaussian.sigma.get(iii, iii), datum.annotations[iii]);\n+            pVarInGaussianLog10[gaussianIndex] = gaussian.pMixtureLog10;\n+            if (gaussian.pMixtureLog10 != Double.NEGATIVE_INFINITY) {\n+                pVarInGaussianLog10[gaussianIndex] += MathUtils.normalDistributionLog10(gaussian.mu[iii], gaussian.sigma.get(iii, iii), datum.annotations[iii]);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "389d956feb94d9bbcd82e8cf0d2b46667bdf8db7"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mjc2NzM3NA==", "bodyText": "Is there anything in the data or arguments from which we expect a priori that these errors will occur, and at the given indices?", "url": "https://github.com/broadinstitute/gatk/pull/6425#discussion_r372767374", "createdAt": "2020-01-30T05:40:08Z", "author": {"login": "davidbenjamin"}, "path": "src/test/java/org/broadinstitute/hellbender/tools/walkers/vqsr/VariantRecalibratorIntegrationTest.java", "diffHunk": "@@ -406,6 +406,8 @@ public void testVariantRecalibratorSNPscattered(final String[] params) throws IO\n         doSNPTest(params, getLargeVQSRTestDataDir() + \"/snpTranches.scattered.txt\", getLargeVQSRTestDataDir() + \"snpRecal.vcf\"); //tranches file isn't in the expected/ directory because it's input to GatherTranchesIntegrationTest\n     }\n \n+    //One of the 8 positive Gaussians (index 4) has weight zero, which is fine, but the one at index 2 has a covariance", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "389d956feb94d9bbcd82e8cf0d2b46667bdf8db7"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f54aafd1b19ddd1d22462f621c371d9607fb06fb", "author": {"user": {"login": "ldgauthier", "name": null}}, "url": "https://github.com/broadinstitute/gatk/commit/f54aafd1b19ddd1d22462f621c371d9607fb06fb", "committedDate": "2020-02-04T19:55:34Z", "message": "We expect the variational Bayes to sometimes reduce the contribution of\none or more Gaussians to zero (hence *MAX* Gaussians), but this causes\nproblems in log10 space"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "67fd85d2441c53f993de45fd70275f99d9d97990", "author": {"user": {"login": "ldgauthier", "name": null}}, "url": "https://github.com/broadinstitute/gatk/commit/67fd85d2441c53f993de45fd70275f99d9d97990", "committedDate": "2020-02-04T17:42:20Z", "message": "Forgot to push :'-("}, "afterCommit": {"oid": "f54aafd1b19ddd1d22462f621c371d9607fb06fb", "author": {"user": {"login": "ldgauthier", "name": null}}, "url": "https://github.com/broadinstitute/gatk/commit/f54aafd1b19ddd1d22462f621c371d9607fb06fb", "committedDate": "2020-02-04T19:55:34Z", "message": "We expect the variational Bayes to sometimes reduce the contribution of\none or more Gaussians to zero (hence *MAX* Gaussians), but this causes\nproblems in log10 space"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzODEwOTAw", "url": "https://github.com/broadinstitute/gatk/pull/6425#pullrequestreview-353810900", "createdAt": "2020-02-05T15:33:00Z", "commit": {"oid": "f54aafd1b19ddd1d22462f621c371d9607fb06fb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2736, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}