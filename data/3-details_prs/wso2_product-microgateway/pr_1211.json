{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA4MDIyNTQ0", "number": 1211, "title": "Fix tokenContext \"/\"", "bodyText": "Purpose\n\nFix / at the start and end of the token context given in the runtime configuration file\nIssues\n\nFixes #1206\nAutomation tests\n\nUnit tests added: No\nIntegration tests added: No\n\nTested environments\n\nCatalina\n\nMaintainers: Check before merge\n\n Assigned 'Type' label\n Assigned the project\n Validated respective github issues\n Assigned milestone to the github issue(s)", "createdAt": "2020-04-23T16:08:53Z", "url": "https://github.com/wso2/product-microgateway/pull/1211", "merged": true, "mergeCommit": {"oid": "b821839eabcc43ea72377906010971a85d0ab2c9"}, "closed": true, "closedAt": "2020-06-01T04:46:19Z", "author": {"login": "AmaliMatharaarachchi"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcg2RZWAFqTQxMDc5MTE4OQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcm4y0qAFqTQyMTU4OTk4Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwNzkxMTg5", "url": "https://github.com/wso2/product-microgateway/pull/1211#pullrequestreview-410791189", "createdAt": "2020-05-13T10:25:32Z", "commit": {"oid": "f40214c6cb7fd891202eefbc16239abdd319b52b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxMDoyNTozMlrOGUrRrw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxMDoyNTozMlrOGUrRrw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDMzMzc0Mw==", "bodyText": "I think we need to fix this for other proxy resources like /authorizwe, /revoke and /userInfo as well", "url": "https://github.com/wso2/product-microgateway/pull/1211#discussion_r424333743", "createdAt": "2020-05-13T10:25:32Z", "author": {"login": "Rajith90"}, "path": "components/micro-gateway-cli/src/main/resources/templates/tokenServices.mustache", "diffHunk": "@@ -123,8 +123,14 @@ service tokenService on tokenListenerEndpoint, apiSecureListener {\n     resource function tokenResource(http:Caller caller, http:Request req) {\n         gateway:checkExpectHeaderPresent(req);\n         http:Client tokenEndpointClient = gateway:getTokenEndpoint();\n-        var response = tokenEndpointClient->forward(gateway:getConfigValue(gateway:KM_CONF_INSTANCE_ID, gateway:KM_TOKEN_CONTEXT, gateway:DEFAULT_KM_TOKEN_CONTEXT) +\n-                 <@untainted>req.rawPath, req);\n+        string tokenContext = gateway:getConfigValue(gateway:KM_CONF_INSTANCE_ID, gateway:KM_TOKEN_CONTEXT, gateway:DEFAULT_KM_TOKEN_CONTEXT);\n+        if (!tokenContext.startsWith(\"/\")) {\n+            tokenContext = \"/\" + tokenContext;\n+        }\n+        if (tokenContext.endsWith(\"/\")) {\n+            tokenContext = tokenContext.substring(0, tokenContext.length() - 1);\n+        }\n+        var response = tokenEndpointClient->forward(tokenContext + <@untainted>req.rawPath, req);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f40214c6cb7fd891202eefbc16239abdd319b52b"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ef81c667911148787843d899d6251d22b155d2c5", "author": {"user": {"login": "AmaliMatharaarachchi", "name": "Amali Matharaarachchi"}}, "url": "https://github.com/wso2/product-microgateway/commit/ef81c667911148787843d899d6251d22b155d2c5", "committedDate": "2020-05-29T10:33:43Z", "message": "Fix tokenContext \"/\""}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f40214c6cb7fd891202eefbc16239abdd319b52b", "author": {"user": {"login": "AmaliMatharaarachchi", "name": "Amali Matharaarachchi"}}, "url": "https://github.com/wso2/product-microgateway/commit/f40214c6cb7fd891202eefbc16239abdd319b52b", "committedDate": "2020-04-23T16:06:33Z", "message": "Fix tokenContext \"/\""}, "afterCommit": {"oid": "106ee70e453b5af983b0693e76a92c61f2177154", "author": {"user": {"login": "AmaliMatharaarachchi", "name": "Amali Matharaarachchi"}}, "url": "https://github.com/wso2/product-microgateway/commit/106ee70e453b5af983b0693e76a92c61f2177154", "committedDate": "2020-05-29T10:38:07Z", "message": "Fix review comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "63934f66f19b713a42be55672bfeaa8213d1c858", "author": {"user": {"login": "AmaliMatharaarachchi", "name": "Amali Matharaarachchi"}}, "url": "https://github.com/wso2/product-microgateway/commit/63934f66f19b713a42be55672bfeaa8213d1c858", "committedDate": "2020-05-29T15:22:57Z", "message": "Fix comments"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "106ee70e453b5af983b0693e76a92c61f2177154", "author": {"user": {"login": "AmaliMatharaarachchi", "name": "Amali Matharaarachchi"}}, "url": "https://github.com/wso2/product-microgateway/commit/106ee70e453b5af983b0693e76a92c61f2177154", "committedDate": "2020-05-29T10:38:07Z", "message": "Fix review comments"}, "afterCommit": {"oid": "63934f66f19b713a42be55672bfeaa8213d1c858", "author": {"user": {"login": "AmaliMatharaarachchi", "name": "Amali Matharaarachchi"}}, "url": "https://github.com/wso2/product-microgateway/commit/63934f66f19b713a42be55672bfeaa8213d1c858", "committedDate": "2020-05-29T15:22:57Z", "message": "Fix comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxNTg5OTgz", "url": "https://github.com/wso2/product-microgateway/pull/1211#pullrequestreview-421589983", "createdAt": "2020-06-01T04:45:24Z", "commit": {"oid": "63934f66f19b713a42be55672bfeaa8213d1c858"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1071, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}