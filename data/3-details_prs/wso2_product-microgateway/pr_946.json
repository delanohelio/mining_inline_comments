{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY1ODA4NDE3", "number": 946, "title": "Fix #919 - Support backword compatibility for configs", "bodyText": "Purpose\nThis will make the configuration backward compatible.\nSo ideally the version 3.0.x key manger config[1] will also be supported\n[1] -\n[keyManager]\nserverUrl=\"https://localhost:9443\"\nusername=\"admin\"\npassword=\"admin\"\ntokenContext=\"oauth2\"\ntimestampSkew=5000\nIssues\n\nFixes #919\nAutomation tests\n\nUnit tests added: Yes/No\nIntegration tests added: Yes/No\n\nTested environments\n\nNot Tested\n\nMaintainers: Check before merge\n\n Assigned 'Type' label\n Assigned the project\n Validated respective github issues\n Assigned milestone to the github issue(s)", "createdAt": "2020-01-22T11:40:30Z", "url": "https://github.com/wso2/product-microgateway/pull/946", "merged": true, "mergeCommit": {"oid": "6d1175ae49c76090d83d6ab655d1aa09ac0e07ae"}, "closed": true, "closedAt": "2020-01-24T09:38:30Z", "author": {"login": "Rajith90"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb80LwCgH2gAyMzY1ODA4NDE3OmU2ZjVmNGY1Y2FjYzMwNjBhZjI4ZmQ1YWI2YjE4NzE2MzgyMWY0YTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb9bqCqAH2gAyMzY1ODA4NDE3OmVkZTA2N2U5YmNmNTE2OGVjN2RhMThkMTVjMDY3MzBlZmE1ZjYyODI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e6f5f4f5cacc3060af28fd5ab6b187163821f4a8", "author": {"user": {"login": "Rajith90", "name": "Rajith Roshan"}}, "url": "https://github.com/wso2/product-microgateway/commit/e6f5f4f5cacc3060af28fd5ab6b187163821f4a8", "committedDate": "2020-01-22T11:38:17Z", "message": "Fix #919 - Support backword compatibility for configs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3MDc5MTQx", "url": "https://github.com/wso2/product-microgateway/pull/946#pullrequestreview-347079141", "createdAt": "2020-01-23T06:21:17Z", "commit": {"oid": "e6f5f4f5cacc3060af28fd5ab6b187163821f4a8"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwNjoyMToxN1rOFgz1oA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwNjoyMToxN1rOFgz1oA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTk0ODA2NA==", "bodyText": "With amali's PR #948 for default configs, we have constants for default values of username and password. Let's use those after merging that PR.", "url": "https://github.com/wso2/product-microgateway/pull/946#discussion_r369948064", "createdAt": "2020-01-23T06:21:17Z", "author": {"login": "praminda"}, "path": "components/micro-gateway-core/src/main/ballerina/src/gateway/listeners/api_gateway_listener.bal", "diffHunk": "@@ -123,11 +123,19 @@ public function getAuthHandlers() returns http:InboundAuthHandler[] {\n         },\n         verifyHostname: getConfigBooleanValue(HTTP_CLIENTS_INSTANCE_ID, ENABLE_HOSTNAME_VERIFICATION, true)\n     };\n+\n     http:OutboundAuthConfig? auth = ();\n+    // support backward compatibility in reading the basic auth credentials when connecting with KM.\n+    string username = getConfigValue(KM_CONF_INSTANCE_ID, USERNAME, \"\");\n+    string password = getConfigValue(KM_CONF_INSTANCE_ID, PASSWORD, \"\");\n+    if (username.length() == 0 && password.length() == 0) {\n+        username = getConfigValue(KM_CONF_SECURITY_BASIC_INSTANCE_ID, USERNAME, \"admin\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e6f5f4f5cacc3060af28fd5ab6b187163821f4a8"}, "originalPosition": 10}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "09c46dd8c7e0606a4a64b5468be0cfe02d1df512", "author": {"user": {"login": "Rajith90", "name": "Rajith Roshan"}}, "url": "https://github.com/wso2/product-microgateway/commit/09c46dd8c7e0606a4a64b5468be0cfe02d1df512", "committedDate": "2020-01-24T08:14:05Z", "message": "support default config values"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3Nzk5NjI4", "url": "https://github.com/wso2/product-microgateway/pull/946#pullrequestreview-347799628", "createdAt": "2020-01-24T08:18:27Z", "commit": {"oid": "09c46dd8c7e0606a4a64b5468be0cfe02d1df512"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3ODA2NTQ1", "url": "https://github.com/wso2/product-microgateway/pull/946#pullrequestreview-347806545", "createdAt": "2020-01-24T08:35:49Z", "commit": {"oid": "09c46dd8c7e0606a4a64b5468be0cfe02d1df512"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQwODozNTo1MFrOFhWvHQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQwODozNTo1MFrOFhWvHQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDUxOTgzNw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                string username = getConfigValue(KM_CONF_INSTANCE_ID, USERNAME, \"\");\n          \n          \n            \n                string username = getConfigValue(KM_CONF_INSTANCE_ID, USERNAME, DEFAULT_USERNAME);", "url": "https://github.com/wso2/product-microgateway/pull/946#discussion_r370519837", "createdAt": "2020-01-24T08:35:50Z", "author": {"login": "AmaliMatharaarachchi"}, "path": "components/micro-gateway-core/src/main/ballerina/src/gateway/listeners/api_gateway_listener.bal", "diffHunk": "@@ -120,11 +120,19 @@ public function getAuthHandlers() returns http:InboundAuthHandler[] {\n         },\n         verifyHostname: getConfigBooleanValue(HTTP_CLIENTS_INSTANCE_ID, ENABLE_HOSTNAME_VERIFICATION, true)\n     };\n+\n     http:OutboundAuthConfig? auth = ();\n-    if (getConfigBooleanValue(KM_CONF_SECURITY_BASIC_INSTANCE_ID, ENABLED, DEFAULT_KM_CONF_SECURITY_BASIC_ENABLED)) {\n+    // support backward compatibility in reading the basic auth credentials when connecting with KM.\n+    string username = getConfigValue(KM_CONF_INSTANCE_ID, USERNAME, \"\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "09c46dd8c7e0606a4a64b5468be0cfe02d1df512"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3ODA2ODMz", "url": "https://github.com/wso2/product-microgateway/pull/946#pullrequestreview-347806833", "createdAt": "2020-01-24T08:36:27Z", "commit": {"oid": "09c46dd8c7e0606a4a64b5468be0cfe02d1df512"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQwODozNjoyN1rOFhWwEw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQwODozNjoyN1rOFhWwEw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDUyMDA4Mw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                string password = getConfigValue(KM_CONF_INSTANCE_ID, PASSWORD, \"\");\n          \n          \n            \n                string password = getConfigValue(KM_CONF_INSTANCE_ID, PASSWORD, DEFAULT_PASSWORD);", "url": "https://github.com/wso2/product-microgateway/pull/946#discussion_r370520083", "createdAt": "2020-01-24T08:36:27Z", "author": {"login": "AmaliMatharaarachchi"}, "path": "components/micro-gateway-core/src/main/ballerina/src/gateway/listeners/api_gateway_listener.bal", "diffHunk": "@@ -120,11 +120,19 @@ public function getAuthHandlers() returns http:InboundAuthHandler[] {\n         },\n         verifyHostname: getConfigBooleanValue(HTTP_CLIENTS_INSTANCE_ID, ENABLE_HOSTNAME_VERIFICATION, true)\n     };\n+\n     http:OutboundAuthConfig? auth = ();\n-    if (getConfigBooleanValue(KM_CONF_SECURITY_BASIC_INSTANCE_ID, ENABLED, DEFAULT_KM_CONF_SECURITY_BASIC_ENABLED)) {\n+    // support backward compatibility in reading the basic auth credentials when connecting with KM.\n+    string username = getConfigValue(KM_CONF_INSTANCE_ID, USERNAME, \"\");\n+    string password = getConfigValue(KM_CONF_INSTANCE_ID, PASSWORD, \"\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "09c46dd8c7e0606a4a64b5468be0cfe02d1df512"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ3ODExNjEy", "url": "https://github.com/wso2/product-microgateway/pull/946#pullrequestreview-347811612", "createdAt": "2020-01-24T08:47:46Z", "commit": {"oid": "09c46dd8c7e0606a4a64b5468be0cfe02d1df512"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ede067e9bcf5168ec7da18d15c06730efa5f6282", "author": {"user": {"login": "Rajith90", "name": "Rajith Roshan"}}, "url": "https://github.com/wso2/product-microgateway/commit/ede067e9bcf5168ec7da18d15c06730efa5f6282", "committedDate": "2020-01-24T09:37:40Z", "message": "Update the branch"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1237, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}