{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgxNzI3MzI2", "number": 1066, "title": "Bug fixes", "bodyText": "Purpose\nBug fixes for the below-mentioned issues.\nIssues\nFixes #1058 , #1055 and #1037\nAutomation tests\n\nUnit tests added: No\nIntegration tests added: No\n\nTested environments\nOS: MacOS Mojave\nAnalytics: 3.1.0-beta\n\nMaintainers: Check before merge\n\n Assigned 'Type' label\n Assigned the project\n Validated respective github issues\n Assigned milestone to the github issue(s)", "createdAt": "2020-02-29T04:06:46Z", "url": "https://github.com/wso2/product-microgateway/pull/1066", "merged": true, "mergeCommit": {"oid": "c6b3ce70ead0c2bd9153aef79436d6c840b7b8a6"}, "closed": true, "closedAt": "2020-02-29T17:50:24Z", "author": {"login": "VirajSalaka"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcI8N42gH2gAyMzgxNzI3MzI2OmZiNjUxNWIwMWYyZWUzNWU3NjFmYjkwMDlkODU0YzM1NmYwNmQwZGM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdB6m-7AFqTQ3MzEwNzI5NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "fb6515b01f2ee35e761fb9009d854c356f06d0dc", "author": {"user": {"login": "VirajSalaka", "name": "Viraj Salaka"}}, "url": "https://github.com/wso2/product-microgateway/commit/fb6515b01f2ee35e761fb9009d854c356f06d0dc", "committedDate": "2020-02-29T03:46:57Z", "message": "bug fix: API creator field is not shown when request is throttled or failed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fcead91c0e07eb64a0aba31f6e3a0f5322fa9e32", "author": {"user": {"login": "VirajSalaka", "name": "Viraj Salaka"}}, "url": "https://github.com/wso2/product-microgateway/commit/fcead91c0e07eb64a0aba31f6e3a0f5322fa9e32", "committedDate": "2020-02-29T03:55:11Z", "message": "bug fix: Null pointer exception log is printed in analytics console due to the unavailability of IP"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b7732b3ebc3c99ce2fa31bea5f95a9dee84b1b53", "author": {"user": {"login": "VirajSalaka", "name": "Viraj Salaka"}}, "url": "https://github.com/wso2/product-microgateway/commit/b7732b3ebc3c99ce2fa31bea5f95a9dee84b1b53", "committedDate": "2020-02-29T03:59:13Z", "message": "bug fix: token request fails when analytics has been enabled"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ee891547b6ca7e5961def9bcae80ab3d245b3ac5", "author": {"user": {"login": "VirajSalaka", "name": "Viraj Salaka"}}, "url": "https://github.com/wso2/product-microgateway/commit/ee891547b6ca7e5961def9bcae80ab3d245b3ac5", "committedDate": "2020-02-29T04:10:24Z", "message": "Merge branch 'master' into bug-fixes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2Nzc1NjE4", "url": "https://github.com/wso2/product-microgateway/pull/1066#pullrequestreview-366775618", "createdAt": "2020-02-29T04:10:48Z", "commit": {"oid": "b7732b3ebc3c99ce2fa31bea5f95a9dee84b1b53"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOVQwNDoxMDo0OVrOFwHhHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOVQwNDoxMDo0OVrOFwHhHg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTk5OTEzNA==", "bodyText": "does this works properly", "url": "https://github.com/wso2/product-microgateway/pull/1066#discussion_r385999134", "createdAt": "2020-02-29T04:10:49Z", "author": {"login": "Rajith90"}, "path": "components/micro-gateway-core/src/main/ballerina/src/gateway/utils/utils.bal", "diffHunk": "@@ -157,6 +157,9 @@ public function getClientIp(http:Request request, http:Caller caller) returns (s\n         }\n     } else {\n         clientIp = caller.remoteAddress.host;\n+        if (clientIp == \"\") {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b7732b3ebc3c99ce2fa31bea5f95a9dee84b1b53"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2Nzc1NjUx", "url": "https://github.com/wso2/product-microgateway/pull/1066#pullrequestreview-366775651", "createdAt": "2020-02-29T04:11:52Z", "commit": {"oid": "ee891547b6ca7e5961def9bcae80ab3d245b3ac5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOVQwNDoxMTo1MlrOFwHhUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOVQwNDoxMTo1MlrOFwHhUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTk5OTE4Ng==", "bodyText": "can we move this to separate function, used in two places", "url": "https://github.com/wso2/product-microgateway/pull/1066#discussion_r385999186", "createdAt": "2020-02-29T04:11:52Z", "author": {"login": "Rajith90"}, "path": "components/micro-gateway-core/src/main/ballerina/src/gateway/utils/analytics_util.bal", "diffHunk": "@@ -73,6 +64,18 @@ function populateThrottleAnalyticsDTO(http:FilterContext context) returns (Throt\n         eventDto.subscriber = END_USER_ANONYMOUS;\n     }\n \n+    APIConfiguration? apiConfiguration = apiConfigAnnotationMap[context.getServiceName()];\n+    if (apiConfiguration is APIConfiguration) {\n+        eventDto.apiVersion = apiConfiguration.apiVersion;\n+        if (!stringutils:equalsIgnoreCase(\"\", <string>apiConfiguration.publisher)\n+                && stringutils:equalsIgnoreCase(\"\", <string>eventDto.apiCreator)) {\n+            eventDto.apiCreator = <string>apiConfiguration.publisher;\n+        } else if (stringutils:equalsIgnoreCase(\"\", <string>eventDto.apiCreator)) {\n+            //sets API creator if x-wso2-owner extension not specified.\n+            eventDto.apiCreator = UNKNOWN_VALUE;\n+        }\n+    }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ee891547b6ca7e5961def9bcae80ab3d245b3ac5"}, "originalPosition": 40}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2ODEwNDY0", "url": "https://github.com/wso2/product-microgateway/pull/1066#pullrequestreview-366810464", "createdAt": "2020-02-29T17:49:19Z", "commit": {"oid": "ee891547b6ca7e5961def9bcae80ab3d245b3ac5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b3f23e9599f0ea7174b9d9ec0d1b71177ad7171", "author": {"user": {"login": "Rajith90", "name": "Rajith Roshan"}}, "url": "https://github.com/wso2/product-microgateway/commit/9b3f23e9599f0ea7174b9d9ec0d1b71177ad7171", "committedDate": "2020-02-29T17:49:44Z", "message": "Merge branch 'master' into bug-fixes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDczMTA3Mjk0", "url": "https://github.com/wso2/product-microgateway/pull/1066#pullrequestreview-473107294", "createdAt": "2020-08-24T04:08:09Z", "commit": {"oid": "9b3f23e9599f0ea7174b9d9ec0d1b71177ad7171"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQwNDowODowOVrOHFT7fw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQwNDowODowOVrOHFT7fw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTMzMTQ1NQ==", "bodyText": "invalid indentation", "url": "https://github.com/wso2/product-microgateway/pull/1066#discussion_r475331455", "createdAt": "2020-08-24T04:08:09Z", "author": {"login": "praminda"}, "path": "components/micro-gateway-core/src/main/ballerina/src/gateway/utils/analytics_util.bal", "diffHunk": "@@ -127,7 +120,20 @@ function populateFaultAnalyticsDTO(http:FilterContext context, string err) retur\n         eventDto.applicationId = ANONYMOUS_APP_ID;\n         eventDto.userTenantDomain = ANONYMOUS_USER_TENANT_DOMAIN;\n     }\n-    metaInfo[\"correlationID\"] = <string>context.attributes[MESSAGE_ID];\n+\n+    APIConfiguration? apiConfig = apiConfigAnnotationMap[context.getServiceName()];\n+    if (apiConfig is APIConfiguration) {\n+        var api_Version = apiConfig.apiVersion;\n+        eventDto.apiVersion = api_Version;\n+        if (!stringutils:equalsIgnoreCase(\"\", <string>apiConfig.publisher)\n+                && stringutils:equalsIgnoreCase(\"\", <string>eventDto.apiCreator)) {\n+            eventDto.apiCreator = <string>apiConfig.publisher;\n+        } else if (stringutils:equalsIgnoreCase(\"\", <string>eventDto.apiCreator)) {\n+            //sets API creator if x-wso2-owner extension not specified.\n+            eventDto.apiCreator = UNKNOWN_VALUE;\n+        }\n+    }\n+metaInfo[\"correlationID\"] = <string>context.attributes[MESSAGE_ID];", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9b3f23e9599f0ea7174b9d9ec0d1b71177ad7171"}, "originalPosition": 88}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1176, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}