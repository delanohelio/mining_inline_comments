{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE5Mzg0NDc4", "number": 1236, "title": "Envoy config generator from swagger", "bodyText": "Purpose\n\nAs $subject, this function will generates the envoy artifacts which are listener, routes, clusters and endpoints for xds apis using swagger files.\nMultiple swagger files are supported.\nPS:\nEndpoint format:\n[protocol(optional)][host][port][basepath]\nEx1: https://petstore.swagger.io:8080/api/v3\nEx2: petstore.swagger.io:8080/api/v3\nIn the swagger files, endpoints should be included in the following ways.\nPriority 1:\nx-wso2-production-endpoints:\nurls:\n- 'https://petstore.swagger.io/api/v3'\ntype: https\nx-wso2-sandbox-endpoints:\nurls:\n- 'http://example.com:8080/api/v3'\ntype: http\nOpenAPI 3:\nservers:\n\nurl: 'https://petstore.swagger.io:8080/api/v3'\n\nSwagger2\nhost: \"petstore.swagger.io:8080\"\nbasePath: \"/api/v3\"\nIssues\n\nFixes #\nAutomation tests\n\nUnit tests added: Yes/No\nIntegration tests added: Yes/No\n\nTested environments\n\nNot Tested\n\nMaintainers: Check before merge\n\n Assigned 'Type' label\n Assigned the project\n Validated respective github issues\n Assigned milestone to the github issue(s)", "createdAt": "2020-05-18T09:44:56Z", "url": "https://github.com/wso2/product-microgateway/pull/1236", "merged": true, "mergeCommit": {"oid": "c7fb3f2bdef9c2e7eb1572b3c893e84e335c30c2"}, "closed": true, "closedAt": "2020-05-18T11:06:34Z", "author": {"login": "chashikajw"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcg3sDGgH2gAyNDE5Mzg0NDc4OmM0ZjY4NmM3OTYzNTkwNmUyNGVkNGM5ODY1NDc0ZDJjYWRjZGRmY2Q=", "endCursor": "Y3Vyc29yOnYyOpPPAAABd0yb8EAFqTU3ODk0OTI3Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c4f686c79635906e24ed4c9865474d2cadcddfcd", "author": {"user": {"login": "chashikajw", "name": "Chashika Weerathunga"}}, "url": "https://github.com/wso2/product-microgateway/commit/c4f686c79635906e24ed4c9865474d2cadcddfcd", "committedDate": "2020-05-13T12:04:33Z", "message": "implement mgw structs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b83cd9cb6d26a69286a14bd2d63a21beba18fcb5", "author": {"user": {"login": "chashikajw", "name": "Chashika Weerathunga"}}, "url": "https://github.com/wso2/product-microgateway/commit/b83cd9cb6d26a69286a14bd2d63a21beba18fcb5", "committedDate": "2020-05-13T12:15:56Z", "message": "implement multiple swagger reader"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fd110bc40ce7d86854a54e16a3abdda086380b89", "author": {"user": {"login": "chashikajw", "name": "Chashika Weerathunga"}}, "url": "https://github.com/wso2/product-microgateway/commit/fd110bc40ce7d86854a54e16a3abdda086380b89", "committedDate": "2020-05-14T16:42:32Z", "message": "add custom ports"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6b7dc6ac33b1e7194a2245bc2cd59d23d2aec0b1", "author": {"user": {"login": "chashikajw", "name": "Chashika Weerathunga"}}, "url": "https://github.com/wso2/product-microgateway/commit/6b7dc6ac33b1e7194a2245bc2cd59d23d2aec0b1", "committedDate": "2020-05-14T19:09:56Z", "message": "implement regex generator for path paramaters"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3f05010fec214a5eb2fb1ef75d750296c38816dc", "author": {"user": {"login": "chashikajw", "name": "Chashika Weerathunga"}}, "url": "https://github.com/wso2/product-microgateway/commit/3f05010fec214a5eb2fb1ef75d750296c38816dc", "committedDate": "2020-05-15T13:19:48Z", "message": "make cluster timeout as configs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "09996bf47763259498b9474472ce8b1be69448f0", "author": {"user": {"login": "chashikajw", "name": "Chashika Weerathunga"}}, "url": "https://github.com/wso2/product-microgateway/commit/09996bf47763259498b9474472ce8b1be69448f0", "committedDate": "2020-05-18T09:20:16Z", "message": "modify the regex"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzNDg5NDU1", "url": "https://github.com/wso2/product-microgateway/pull/1236#pullrequestreview-413489455", "createdAt": "2020-05-18T11:03:30Z", "commit": {"oid": "09996bf47763259498b9474472ce8b1be69448f0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTc4OTQ5Mjc2", "url": "https://github.com/wso2/product-microgateway/pull/1236#pullrequestreview-578949276", "createdAt": "2021-01-29T05:22:41Z", "commit": {"oid": "09996bf47763259498b9474472ce8b1be69448f0"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yOVQwNToyMjo0MVrOIcVrXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0yOVQwNToyNTo0NVrOIcVuaw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjU4NjIwNA==", "bodyText": "Formatting issue. Shall we fix this?", "url": "https://github.com/wso2/product-microgateway/pull/1236#discussion_r566586204", "createdAt": "2021-01-29T05:22:41Z", "author": {"login": "dinusha92"}, "path": "internal/pkg/oasparser/config/config.go", "diffHunk": "@@ -16,9 +16,12 @@\n  */\n package config\n \n+import \"time\"\n+\n const (\n-\tLISTENER_ADDRESS   string = \"0.0.0.0\"\n-\tLISTENER_PORT      uint32 = 10000\n-\tAPI_PORT           uint32 = 8080\n-\tMANAGER_STATPREFIX string = \"ingress_http\"\n+\tLISTENER_ADDRESS  string = \"0.0.0.0\"\n+\tLISTENER_PORT     uint32 = 10000\n+\tAPI_DEFAULT_PORT   uint32 = 8080\n+\tMANAGER_STATPREFIX    string = \"ingress_http\"\n+\tCLUSTER_CONNECT_TIMEOUT    = 5 * time.Second", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "09996bf47763259498b9474472ce8b1be69448f0"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjU4NjU2OA==", "bodyText": "Formatting issue.", "url": "https://github.com/wso2/product-microgateway/pull/1236#discussion_r566586568", "createdAt": "2021-01-29T05:24:12Z", "author": {"login": "dinusha92"}, "path": "internal/pkg/oasparser/constants/openApiConstants.go", "diffHunk": "@@ -16,5 +16,8 @@\n  */\n package constants\n \n-const PRODUCTION_ENDPOINTS string = \"x-wso2-production-endpoints\"\n-const SANDBOX_ENDPOINTS string = \"x-wso2-sandbox-endpoints\"\n+const (\n+\tPRODUCTION_ENDPOINTS string = \"x-wso2-production-endpoints\"\n+\tSANDBOX_ENDPOINTS string = \"x-wso2-sandbox-endpoints\"\n+)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "09996bf47763259498b9474472ce8b1be69448f0"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjU4NjgyNQ==", "bodyText": "What is the purpose of the commented code. If there's a reason shall we mention that in a comment? If not, let's remove this :)", "url": "https://github.com/wso2/product-microgateway/pull/1236#discussion_r566586825", "createdAt": "2021-01-29T05:25:12Z", "author": {"login": "dinusha92"}, "path": "internal/pkg/oasparser/envoyCodegen/routesWithClusters.go", "diffHunk": "@@ -173,47 +166,104 @@ func createCluster(address core.Address, clusterName string) v2.Cluster {\n \t\t\t\t},\n \t\t\t},\n \t\t},\n-\t\t//Hosts:                []*core.Address{h},\n \t}\n-\n+\t//fmt.Println(h.GetAddress())\n \treturn cluster\n }\n \n-func createRoute(HostUrl string, resourcePath string, clusterName string) v2route.Route {\n-\t//var targetRegex = \"/\"\n-\troute := v2route.Route{\n-\t\tMatch: &v2route.RouteMatch{\n-\t\t\tPathSpecifier: &v2route.RouteMatch_SafeRegex{\n-\t\t\t\tSafeRegex: &envoy_type_matcher.RegexMatcher{\n-\t\t\t\t\tEngineType: &envoy_type_matcher.RegexMatcher_GoogleRe2{\n-\t\t\t\t\t\tGoogleRe2: &envoy_type_matcher.RegexMatcher_GoogleRE2{\n-\t\t\t\t\t\t\tMaxProgramSize: nil,\n+func createRoute(HostUrl string, basepath string, resourcePath string, clusterName string) v2route.Route {\n+\tvar fullPath = basepath + resourcePath\n+\tvar route v2route.Route\n+\n+\troutepath, isHavingPathparameter := GenerateRegex(fullPath)\n+\n+\tRouteAction := &v2route.Route_Route{\n+\t\tRoute: &v2route.RouteAction{\n+\t\t\tHostRewriteSpecifier: &v2route.RouteAction_HostRewrite{\n+\t\t\t\tHostRewrite: HostUrl,\n+\t\t\t},\n+\t\t\tClusterSpecifier: &v2route.RouteAction_Cluster{\n+\t\t\t\tCluster: clusterName,\n+\t\t\t},\n+\t\t},\n+\t}\n+\n+\tif isHavingPathparameter {\n+\t\troute = v2route.Route{\n+\t\t\tMatch: &v2route.RouteMatch{\n+\t\t\t\tPathSpecifier: &v2route.RouteMatch_SafeRegex{\n+\t\t\t\t\tSafeRegex: &envoy_type_matcher.RegexMatcher{\n+\t\t\t\t\t\tEngineType: &envoy_type_matcher.RegexMatcher_GoogleRe2{\n+\t\t\t\t\t\t\tGoogleRe2: &envoy_type_matcher.RegexMatcher_GoogleRE2{\n+\t\t\t\t\t\t\t\tMaxProgramSize: nil,\n+\t\t\t\t\t\t\t},\n \t\t\t\t\t\t},\n+\t\t\t\t\t\tRegex: routepath,\n \t\t\t\t\t},\n-\t\t\t\t\tRegex: resourcePath,\n \t\t\t\t},\n+\t\t\t\t/*Headers: []*v2route.HeaderMatcher {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "09996bf47763259498b9474472ce8b1be69448f0"}, "originalPosition": 268}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NjU4Njk4Nw==", "bodyText": "License header missing.", "url": "https://github.com/wso2/product-microgateway/pull/1236#discussion_r566586987", "createdAt": "2021-01-29T05:25:45Z", "author": {"login": "dinusha92"}, "path": "internal/pkg/oasparser/models/apiDefinition/mgwResource.go", "diffHunk": "@@ -0,0 +1,33 @@\n+package apiDefinition", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "09996bf47763259498b9474472ce8b1be69448f0"}, "originalPosition": 1}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1084, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}