{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ4MjUwNzUy", "number": 1322, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxMzo0MDoxNVrOEN0qTQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxMzo1MDoyNlrOEN08Ww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyOTI5NzQxOnYy", "diffSide": "RIGHT", "path": "components/micro-gateway-core/src/main/ballerina/src/gateway/utils/jwt_util.bal", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxMzo0MDoxNVrOGwpBFw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxMzo0MDoxNVrOGwpBFw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzY1Njg1NQ==", "bodyText": "We can just return true here, right?", "url": "https://github.com/wso2/product-microgateway/pull/1322#discussion_r453656855", "createdAt": "2020-07-13T13:40:15Z", "author": {"login": "AmaliMatharaarachchi"}, "path": "components/micro-gateway-core/src/main/ballerina/src/gateway/utils/jwt_util.bal", "diffHunk": "@@ -181,7 +178,7 @@ public function handleSubscribedAPIs(string apiKeyToken, jwt:JwtPayload payload,\n                     + authenticationContext.subscriberTenantDomain);\n                 }\n                 invocationContext.attributes[AUTHENTICATION_CONTEXT] = authenticationContext;\n-                return true;\n+                isAllowed = true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9c6c908d7e0a2aeed6b02be44394a04ec5fa3ff1"}, "originalPosition": 51}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyOTMxMzA1OnYy", "diffSide": "RIGHT", "path": "components/micro-gateway-core/src/main/ballerina/src/gateway/utils/jwt_util.bal", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxMzo0MzozOVrOGwpKSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxMzo0MzozOVrOGwpKSw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzY1OTIxMQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    printDebug(JWT_UTIL, \"jwt found from the jwt cache\");\n          \n          \n            \n                    printDebug(JWT_UTIL, \"jwt found from the api key cache\");", "url": "https://github.com/wso2/product-microgateway/pull/1322#discussion_r453659211", "createdAt": "2020-07-13T13:43:39Z", "author": {"login": "AmaliMatharaarachchi"}, "path": "components/micro-gateway-core/src/main/ballerina/src/gateway/utils/jwt_util.bal", "diffHunk": "@@ -197,25 +194,44 @@ public function handleSubscribedAPIs(string apiKeyToken, jwt:JwtPayload payload,\n         + authenticationContext.subscriberTenantDomain);\n     }\n     invocationContext.attributes[AUTHENTICATION_CONTEXT] = authenticationContext;\n-    return false;\n+    return isAllowed;\n }\n \n-public function getDecodedJWTPayload(string jwtToken) returns @tainted (jwt:JwtPayload | error) {\n-    //decode jwt\n-    var cachedJwt = trap <jwt:InboundJwtCacheEntry>jwtCache.get(jwtToken);\n+public function getDecodedJWTPayloadOfAPIKey(string jwtToken) returns @tainted (jwt:JwtPayload | error) {\n+    var cachedJwt = trap <jwt:InboundJwtCacheEntry>apiKeyCache.get(jwtToken);\n     if (cachedJwt is jwt:InboundJwtCacheEntry) {\n         printDebug(JWT_UTIL, \"jwt found from the jwt cache\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9c6c908d7e0a2aeed6b02be44394a04ec5fa3ff1"}, "originalPosition": 69}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyOTM0MzYzOnYy", "diffSide": "RIGHT", "path": "tests/src/test/resources/confs/default-test-config.conf", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QxMzo1MDoyNlrOGwpdTg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQxMDoyMDozNFrOGxNgqA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzY2NDA3OA==", "bodyText": "validateSubscription is false by default right? If so, why do we need to add it here?", "url": "https://github.com/wso2/product-microgateway/pull/1322#discussion_r453664078", "createdAt": "2020-07-13T13:50:26Z", "author": {"login": "AmaliMatharaarachchi"}, "path": "tests/src/test/resources/confs/default-test-config.conf", "diffHunk": "@@ -5,6 +5,7 @@\n \n [[jwtTokenConfig]]\n   issuer=\"https://localhost:9443/oauth2/token\"\n+  validateSubscription = false", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9c6c908d7e0a2aeed6b02be44394a04ec5fa3ff1"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDI1NDc2MA==", "bodyText": "Now we have global config for subscriptions under security. This has been enabled in the test conf files. SO in order to override at the jwt issuer level we need to explicitly specify the subscription validation is false.", "url": "https://github.com/wso2/product-microgateway/pull/1322#discussion_r454254760", "createdAt": "2020-07-14T10:20:34Z", "author": {"login": "Rajith90"}, "path": "tests/src/test/resources/confs/default-test-config.conf", "diffHunk": "@@ -5,6 +5,7 @@\n \n [[jwtTokenConfig]]\n   issuer=\"https://localhost:9443/oauth2/token\"\n+  validateSubscription = false", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzY2NDA3OA=="}, "originalCommit": {"oid": "9c6c908d7e0a2aeed6b02be44394a04ec5fa3ff1"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1259, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}