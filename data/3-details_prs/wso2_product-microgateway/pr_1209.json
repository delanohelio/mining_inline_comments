{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA3Mjk0MTY3", "number": 1209, "title": "Fix #1207 - Issue when endpoint url contain special characters", "bodyText": "Purpose\nWhen production endpoints containing special characters are specified in the open API definition, microgateway route the\nrequest to a wrong endpoint. This issue happens for production endpoints like \"http://test.com?value1=foo&valu2=bar\"\nwhere it contains query parameters.\nIssues\n\nFixes #1207\nFixes #1210\nAutomation tests\n\nUnit tests added: No\nIntegration tests added: Yes\n\nTested environments\n\nNot Tested\n\nMaintainers: Check before merge\n\n Assigned 'Type' label\n Assigned the project\n Validated respective github issues\n Assigned milestone to the github issue(s)", "createdAt": "2020-04-22T13:33:37Z", "url": "https://github.com/wso2/product-microgateway/pull/1209", "merged": true, "mergeCommit": {"oid": "49276556de056f0edbbfba6cdc6a385210b3a308"}, "closed": true, "closedAt": "2020-04-27T13:13:41Z", "author": {"login": "Rajith90"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcaIScdAH2gAyNDA3Mjk0MTY3OjE2MTgxMGQ1MTg2MmZkMjFiNjc1NDc4NTBkMDBiYzdhNDM2MzM4NDQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcbq8HpgFqTQwMDcyOTc0OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "161810d51862fd21b67547850d00bc7a43633844", "author": {"user": {"login": "Rajith90", "name": "Rajith Roshan"}}, "url": "https://github.com/wso2/product-microgateway/commit/161810d51862fd21b67547850d00bc7a43633844", "committedDate": "2020-04-22T13:27:30Z", "message": "Fix #1207 - Issue when endpoint url contain special characters\n\nWhen production endpoints containing special characters are specified in the open API definition, microgateway route the\nrequest to a wrong endpoint. This issue happens for production endpoints like \"http://test.com?value1=foo&valu2=bar\"\nwhere it contains query parameters."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4NzIyMzkx", "url": "https://github.com/wso2/product-microgateway/pull/1209#pullrequestreview-398722391", "createdAt": "2020-04-23T02:47:44Z", "commit": {"oid": "161810d51862fd21b67547850d00bc7a43633844"}, "state": "COMMENTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QwMjo0Nzo0NFrOGKUIxQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QwMzowNzoxN1rOGKUh-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzQ2ODg2OQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            });\n          \n          \n            \n            });", "url": "https://github.com/wso2/product-microgateway/pull/1209#discussion_r413468869", "createdAt": "2020-04-23T02:47:44Z", "author": {"login": "praminda"}, "path": "components/micro-gateway-cli/src/main/resources/templates/httpEndpoint.mustache", "diffHunk": "@@ -1,4 +1,4 @@\n http:Client {{qualifiedServiceName}}_{{endpointUrlType}} = new (\n-{{#if endpoints.0.isEtcdEnabled}}gateway:etcdSetup(\"{{name}}_{{endpointUrlType}}_endpoint_0\",\"{{name}}_{{endpointUrlType}}_0_etcdKey\",\"{{endpoints.0.endpointUrl}}\",\"{{endpoints.0.etcdKey}}\"){{else}}gateway:retrieveConfig(\"{{name}}_{{endpointUrlType}}_endpoint_0\",\"{{endpoints.0.endpointUrl}}\"){{/if}},\n+{{#if endpoints.0.isEtcdEnabled}}gateway:etcdSetup(\"{{name}}_{{endpointUrlType}}_endpoint_0\",\"{{name}}_{{endpointUrlType}}_0_etcdKey\",\"{{{endpoints.0.endpointUrl}}}\",\"{{endpoints.0.etcdKey}}\"){{else}}gateway:retrieveConfig(\"{{name}}_{{endpointUrlType}}_endpoint_0\",\"{{{endpoints.0.endpointUrl}}}\"){{/if}},\n { {{>http2}}{{>http2settings}}{{>caching}}{{>basicAuth}}{{>secureSocket}}\n });", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "161810d51862fd21b67547850d00bc7a43633844"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzQ2ODkzNA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            });\n          \n          \n            \n            });", "url": "https://github.com/wso2/product-microgateway/pull/1209#discussion_r413468934", "createdAt": "2020-04-23T02:48:00Z", "author": {"login": "praminda"}, "path": "components/micro-gateway-cli/src/main/resources/templates/httpResourceEndpoint.mustache", "diffHunk": "@@ -1,5 +1,5 @@\n http:Client {{operationId}}_{{endpointUrlType}} = new (\n {{#if endpoints.0.isEtcdEnabled}}gateway:etcdSetup(\"{{name}}_{{endpointUrlType}}_endpoint_0\",\n-\"{{name}}_{{endpointUrlType}}_0_etcdKey\", \"{{endpoints.0.endpointUrl}}\", \"{{endpoints.0.etcdKey}}\"){{else}}gateway:retrieveConfig(\"{{name}}_{{endpointUrlType}}_endpoint_0\",\"{{endpoints.0.endpointUrl}}\"){{/if}},\n+\"{{name}}_{{endpointUrlType}}_0_etcdKey\", \"{{{endpoints.0.endpointUrl}}}\", \"{{endpoints.0.etcdKey}}\"){{else}}gateway:retrieveConfig(\"{{name}}_{{endpointUrlType}}_endpoint_0\",\"{{{endpoints.0.endpointUrl}}}\"){{/if}},\n { {{>http2}}{{>caching}}{{>basicAuth}}{{>secureSocket}}\n });", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "161810d51862fd21b67547850d00bc7a43633844"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzQ2OTk5MQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                @Test(description = \"Test Invoking the resource which  endpoint defined at resource level \"\n          \n          \n            \n                @Test(description = \"Test Invoking the resource which endpoint defined at resource level \"", "url": "https://github.com/wso2/product-microgateway/pull/1209#discussion_r413469991", "createdAt": "2020-04-23T02:51:23Z", "author": {"login": "praminda"}, "path": "tests/src/test/java/org/wso2/micro/gateway/tests/endpoints/ResourceLevelEndpointsTestCase.java", "diffHunk": "@@ -67,6 +67,19 @@ public void testPerResourceEndpoint() throws Exception {\n         Assert.assertEquals(response.getResponseCode(), 200, \"Response code mismatched\");\n     }\n \n+    @Test(description = \"Test Invoking the resource which  endpoint defined at resource level \"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "161810d51862fd21b67547850d00bc7a43633844"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzQ3MTE3NQ==", "bodyText": "Shall we remove this part since we don't validate the response content? Just to keep the swagger short and simple?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                      content:\n          \n          \n            \n                        application/xml:\n          \n          \n            \n                          schema:\n          \n          \n            \n                            type: array\n          \n          \n            \n                            items:\n          \n          \n            \n                              $ref: \"#/components/schemas/Pet\"\n          \n          \n            \n                        application/json:\n          \n          \n            \n                          schema:\n          \n          \n            \n                            type: array\n          \n          \n            \n                            items:\n          \n          \n            \n                              $ref: \"#/components/schemas/Pet\"", "url": "https://github.com/wso2/product-microgateway/pull/1209#discussion_r413471175", "createdAt": "2020-04-23T02:54:44Z", "author": {"login": "praminda"}, "path": "tests/src/test/resources/openAPIs/common_api.yaml", "diffHunk": "@@ -121,6 +121,49 @@ paths:\n           description: Invalid status value\n       security:\n         - petstore_auth: []\n+  /pet/findByStatusNew:\n+    get:\n+      tags:\n+        - pet\n+      summary: Finds Pets by status\n+      description: Multiple status values can be provided with comma separated strings\n+      operationId: findPetsByStatus\n+      x-wso2-production-endpoints:\n+        urls:\n+          - https://localhost:2380/v1/pet/findByStatusNew?value1=foo&value2=bar\n+      parameters:\n+        - name: status\n+          in: query\n+          description: Status values that need to be considered for filter\n+          required: true\n+          explode: true\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+              enum:\n+                - available\n+                - pending\n+                - sold\n+              default: available\n+      responses:\n+        \"200\":\n+          description: successful operation\n+          content:\n+            application/xml:\n+              schema:\n+                type: array\n+                items:\n+                  $ref: \"#/components/schemas/Pet\"\n+            application/json:\n+              schema:\n+                type: array\n+                items:\n+                  $ref: \"#/components/schemas/Pet\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "161810d51862fd21b67547850d00bc7a43633844"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzQ3NDc0OA==", "bodyText": "Just to keep things simple\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                      explode: true\n          \n          \n            \n                      schema:\n          \n          \n            \n                        type: array\n          \n          \n            \n                        items:\n          \n          \n            \n                          type: string\n          \n          \n            \n                          enum:\n          \n          \n            \n                            - available\n          \n          \n            \n                            - pending\n          \n          \n            \n                            - sold\n          \n          \n            \n                          default: available", "url": "https://github.com/wso2/product-microgateway/pull/1209#discussion_r413474748", "createdAt": "2020-04-23T03:05:34Z", "author": {"login": "praminda"}, "path": "tests/src/test/resources/openAPIs/common_api.yaml", "diffHunk": "@@ -121,6 +121,49 @@ paths:\n           description: Invalid status value\n       security:\n         - petstore_auth: []\n+  /pet/findByStatusNew:\n+    get:\n+      tags:\n+        - pet\n+      summary: Finds Pets by status\n+      description: Multiple status values can be provided with comma separated strings\n+      operationId: findPetsByStatus\n+      x-wso2-production-endpoints:\n+        urls:\n+          - https://localhost:2380/v1/pet/findByStatusNew?value1=foo&value2=bar\n+      parameters:\n+        - name: status\n+          in: query\n+          description: Status values that need to be considered for filter\n+          required: true\n+          explode: true\n+          schema:\n+            type: array\n+            items:\n+              type: string\n+              enum:\n+                - available\n+                - pending\n+                - sold\n+              default: available", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "161810d51862fd21b67547850d00bc7a43633844"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzQ3NTMyMw==", "bodyText": "Any reason to change the port? If there is an specific reason, better if you can put that in the PR description. It might be useful later.", "url": "https://github.com/wso2/product-microgateway/pull/1209#discussion_r413475323", "createdAt": "2020-04-23T03:07:17Z", "author": {"login": "praminda"}, "path": "tests/src/test/java/org/wso2/micro/gateway/tests/grpc/GrpcServer.java", "diffHunk": "@@ -31,7 +31,7 @@\n \n     public void start() throws IOException {\n         /* The port on which the server should run */\n-        int port = 50051;\n+        int port = 50075;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "161810d51862fd21b67547850d00bc7a43633844"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "550cbe3de9a4ab29b57f0e6666d445b731bd9e4c", "author": {"user": {"login": "Rajith90", "name": "Rajith Roshan"}}, "url": "https://github.com/wso2/product-microgateway/commit/550cbe3de9a4ab29b57f0e6666d445b731bd9e4c", "committedDate": "2020-04-23T14:19:39Z", "message": "Fix #1210 - Improve interceptors to get path parameter related details\n\nWith this commit request.getPathParams() method is intorduced to java interceptors to get path parameter details.\nAnd for ballerina interceptors users can get it as invocationContext.attributes[\"pathParams\"] and cast it to a map.\nWith this commit users can details api_name, api_version, matching_resource , using this properties from the invocation context as well."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "38b69f6194c62ddbc09d59c5fd8fca8a90f6c63c", "author": {"user": {"login": "Rajith90", "name": "Rajith Roshan"}}, "url": "https://github.com/wso2/product-microgateway/commit/38b69f6194c62ddbc09d59c5fd8fca8a90f6c63c", "committedDate": "2020-04-23T14:14:03Z", "message": "Fix #1207 - Improve interceptors to get path parameter related details\n\nWith this commit request.getPathParams() method is intorduced to java interceptors to get path parameter details.\nAnd for ballerina interceptors users can get it as invocationContext.attributes[\"pathParams\"] and cast it to a map.\nWith this commit users can details api_name, api_version, matching_resource , using this properties from the invocation context as well."}, "afterCommit": {"oid": "550cbe3de9a4ab29b57f0e6666d445b731bd9e4c", "author": {"user": {"login": "Rajith90", "name": "Rajith Roshan"}}, "url": "https://github.com/wso2/product-microgateway/commit/550cbe3de9a4ab29b57f0e6666d445b731bd9e4c", "committedDate": "2020-04-23T14:19:39Z", "message": "Fix #1210 - Improve interceptors to get path parameter related details\n\nWith this commit request.getPathParams() method is intorduced to java interceptors to get path parameter details.\nAnd for ballerina interceptors users can get it as invocationContext.attributes[\"pathParams\"] and cast it to a map.\nWith this commit users can details api_name, api_version, matching_resource , using this properties from the invocation context as well."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwNzI5NzQ5", "url": "https://github.com/wso2/product-microgateway/pull/1209#pullrequestreview-400729749", "createdAt": "2020-04-27T08:23:43Z", "commit": {"oid": "550cbe3de9a4ab29b57f0e6666d445b731bd9e4c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1069, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}