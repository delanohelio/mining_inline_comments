{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEyODY2OTg0", "number": 1223, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMFQwMzozNjo1MlrOD67ehA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMFQxNDowMDo1NFrOD6_Agg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzMTE4NDY4OnYy", "diffSide": "RIGHT", "path": "components/micro-gateway-cli/src/main/resources/templates/listeners.mustache", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMFQwMzozNjo1MlrOGTAKdQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMFQwMzozNjo1MlrOGTAKdQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjU3ODgwNQ==", "bodyText": "gateway:printDebug ???", "url": "https://github.com/wso2/product-microgateway/pull/1223#discussion_r422578805", "createdAt": "2020-05-10T03:36:52Z", "author": {"login": "praminda"}, "path": "components/micro-gateway-cli/src/main/resources/templates/listeners.mustache", "diffHunk": "@@ -133,7 +134,40 @@ public function getFilters() returns (http:RequestFilter|http:ResponseFilter) []\n     // Extension filter\n     ExtensionFilter extensionFilter = new;\n \n-    return [grpcFilter, preAuthnFilter, authorizationFilter, validationRequestFilter, throttleFilter,\n+    (http:RequestFilter|http:ResponseFilter)[] defaultFilters = [grpcFilter, preAuthnFilter, authorizationFilter, validationRequestFilter, throttleFilter,\n             analyticsFilter, validationResponseFilter, extensionFilter];\n+\n+    (http:RequestFilter|http:ResponseFilter)[] customFilters = [];\n+    int[] customFilterIndexes = [];\n+    (http:RequestFilter|http:ResponseFilter)[] allFilters = defaultFilters.slice(0,defaultFilters.length());\n+{{#containerConfig.filters}}\n+    {{name}} {{variableName}} = new;\n+    customFilterIndexes[{{@index}}] = {{position}};\n+    customFilters[{{@index}}] = {{variableName}};\n+    allFilters.push({{variableName}}) ;\n+{{/containerConfig.filters}}\n+\n+    int customFilterIndex = 0;\n+    int authFilterPosition = gateway:getAuthFilterPosition();\n+\n+    foreach var filterIndex in customFilterIndexes {\n+        shiftArray(allFilters, filterIndex, customFilters[customFilterIndex]);\n+        if(filterIndex <= authFilterPosition) {\n+            authFilterPosition = authFilterPosition + 1;\n+        }\n+        customFilterIndex = customFilterIndex +1;\n+    }\n+\n+    gateway:setAuthFilterPosition(authFilterPosition);\n+    log:printDebug(allFilters.toString());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f9de522bf956fb9e3dcf2af75f44f0e8ff2b5d4b"}, "originalPosition": 47}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzMTM0OTgzOnYy", "diffSide": "RIGHT", "path": "components/micro-gateway-cli/src/main/resources/templates/listeners.mustache", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMFQwNjo0OTo1NVrOGTBT1w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMFQwNjo0OTo1NVrOGTBT1w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjU5NzU5MQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if(filterIndex <= authFilterPosition) {\n          \n          \n            \n                    if (filterIndex <= authFilterPosition) {", "url": "https://github.com/wso2/product-microgateway/pull/1223#discussion_r422597591", "createdAt": "2020-05-10T06:49:55Z", "author": {"login": "praminda"}, "path": "components/micro-gateway-cli/src/main/resources/templates/listeners.mustache", "diffHunk": "@@ -133,7 +134,40 @@ public function getFilters() returns (http:RequestFilter|http:ResponseFilter) []\n     // Extension filter\n     ExtensionFilter extensionFilter = new;\n \n-    return [grpcFilter, preAuthnFilter, authorizationFilter, validationRequestFilter, throttleFilter,\n+    (http:RequestFilter|http:ResponseFilter)[] defaultFilters = [grpcFilter, preAuthnFilter, authorizationFilter, validationRequestFilter, throttleFilter,\n             analyticsFilter, validationResponseFilter, extensionFilter];\n+\n+    (http:RequestFilter|http:ResponseFilter)[] customFilters = [];\n+    int[] customFilterIndexes = [];\n+    (http:RequestFilter|http:ResponseFilter)[] allFilters = defaultFilters.slice(0,defaultFilters.length());\n+{{#containerConfig.filters}}\n+    {{name}} {{variableName}} = new;\n+    customFilterIndexes[{{@index}}] = {{position}};\n+    customFilters[{{@index}}] = {{variableName}};\n+    allFilters.push({{variableName}}) ;\n+{{/containerConfig.filters}}\n+\n+    int customFilterIndex = 0;\n+    int authFilterPosition = gateway:getAuthFilterPosition();\n+\n+    foreach var filterIndex in customFilterIndexes {\n+        shiftArray(allFilters, filterIndex, customFilters[customFilterIndex]);\n+        if(filterIndex <= authFilterPosition) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f9de522bf956fb9e3dcf2af75f44f0e8ff2b5d4b"}, "originalPosition": 40}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzMTM1MDEwOnYy", "diffSide": "RIGHT", "path": "components/micro-gateway-cli/src/main/resources/templates/listeners.mustache", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMFQwNjo1MDoxOFrOGTBT-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMFQwNjo1MDoxOFrOGTBT-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjU5NzYyNQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            function shiftArray((http:RequestFilter|http:ResponseFilter)[] allFilters, int position, (http:RequestFilter|http:ResponseFilter) customFilter){\n          \n          \n            \n            function shiftArray((http:RequestFilter|http:ResponseFilter)[] allFilters, int position, (http:RequestFilter|http:ResponseFilter) customFilter) {", "url": "https://github.com/wso2/product-microgateway/pull/1223#discussion_r422597625", "createdAt": "2020-05-10T06:50:18Z", "author": {"login": "praminda"}, "path": "components/micro-gateway-cli/src/main/resources/templates/listeners.mustache", "diffHunk": "@@ -133,7 +134,40 @@ public function getFilters() returns (http:RequestFilter|http:ResponseFilter) []\n     // Extension filter\n     ExtensionFilter extensionFilter = new;\n \n-    return [grpcFilter, preAuthnFilter, authorizationFilter, validationRequestFilter, throttleFilter,\n+    (http:RequestFilter|http:ResponseFilter)[] defaultFilters = [grpcFilter, preAuthnFilter, authorizationFilter, validationRequestFilter, throttleFilter,\n             analyticsFilter, validationResponseFilter, extensionFilter];\n+\n+    (http:RequestFilter|http:ResponseFilter)[] customFilters = [];\n+    int[] customFilterIndexes = [];\n+    (http:RequestFilter|http:ResponseFilter)[] allFilters = defaultFilters.slice(0,defaultFilters.length());\n+{{#containerConfig.filters}}\n+    {{name}} {{variableName}} = new;\n+    customFilterIndexes[{{@index}}] = {{position}};\n+    customFilters[{{@index}}] = {{variableName}};\n+    allFilters.push({{variableName}}) ;\n+{{/containerConfig.filters}}\n+\n+    int customFilterIndex = 0;\n+    int authFilterPosition = gateway:getAuthFilterPosition();\n+\n+    foreach var filterIndex in customFilterIndexes {\n+        shiftArray(allFilters, filterIndex, customFilters[customFilterIndex]);\n+        if(filterIndex <= authFilterPosition) {\n+            authFilterPosition = authFilterPosition + 1;\n+        }\n+        customFilterIndex = customFilterIndex +1;\n+    }\n+\n+    gateway:setAuthFilterPosition(authFilterPosition);\n+    log:printDebug(allFilters.toString());\n+    return allFilters;\n+}\n+\n+function shiftArray((http:RequestFilter|http:ResponseFilter)[] allFilters, int position, (http:RequestFilter|http:ResponseFilter) customFilter){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f9de522bf956fb9e3dcf2af75f44f0e8ff2b5d4b"}, "originalPosition": 51}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzMTc1NjcxOnYy", "diffSide": "RIGHT", "path": "components/micro-gateway-core/src/main/ballerina/src/gateway/constants/constants.bal", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMFQxMzo1NDo0MFrOGTEbxg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxMDo1NTo1OVrOGUsNgw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjY0ODc3NA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change", "url": "https://github.com/wso2/product-microgateway/pull/1223#discussion_r422648774", "createdAt": "2020-05-10T13:54:40Z", "author": {"login": "AmaliMatharaarachchi"}, "path": "components/micro-gateway-core/src/main/ballerina/src/gateway/constants/constants.bal", "diffHunk": "@@ -426,3 +426,5 @@ public const string API_PUBLISHER = \"api_publisher\";\n public const string API_NAME = \"api_name\";\n public const string MATCHING_RESOURCE = \"matching_resource\";\n \n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f9de522bf956fb9e3dcf2af75f44f0e8ff2b5d4b"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDM0OTA1OQ==", "bodyText": "This separation is required to define different set of constants. Each separated block defines set of constants related to a single feature or capability", "url": "https://github.com/wso2/product-microgateway/pull/1223#discussion_r424349059", "createdAt": "2020-05-13T10:55:59Z", "author": {"login": "Rajith90"}, "path": "components/micro-gateway-core/src/main/ballerina/src/gateway/constants/constants.bal", "diffHunk": "@@ -426,3 +426,5 @@ public const string API_PUBLISHER = \"api_publisher\";\n public const string API_NAME = \"api_name\";\n public const string MATCHING_RESOURCE = \"matching_resource\";\n \n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjY0ODc3NA=="}, "originalCommit": {"oid": "f9de522bf956fb9e3dcf2af75f44f0e8ff2b5d4b"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzMTc1OTYxOnYy", "diffSide": "RIGHT", "path": "components/micro-gateway-cli/src/main/resources/templates/listeners.mustache", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMFQxMzo1Nzo0MVrOGTEdLQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMFQxMzo1Nzo0MVrOGTEdLQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjY0OTEzMw==", "bodyText": "It's better to the limit line length. There are several occurrences of this below as well.", "url": "https://github.com/wso2/product-microgateway/pull/1223#discussion_r422649133", "createdAt": "2020-05-10T13:57:41Z", "author": {"login": "AmaliMatharaarachchi"}, "path": "components/micro-gateway-cli/src/main/resources/templates/listeners.mustache", "diffHunk": "@@ -133,7 +134,40 @@ public function getFilters() returns (http:RequestFilter|http:ResponseFilter) []\n     // Extension filter\n     ExtensionFilter extensionFilter = new;\n \n-    return [grpcFilter, preAuthnFilter, authorizationFilter, validationRequestFilter, throttleFilter,\n+    (http:RequestFilter|http:ResponseFilter)[] defaultFilters = [grpcFilter, preAuthnFilter, authorizationFilter, validationRequestFilter, throttleFilter,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f9de522bf956fb9e3dcf2af75f44f0e8ff2b5d4b"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYzMTc2MzIyOnYy", "diffSide": "RIGHT", "path": "components/micro-gateway-cli/src/main/resources/templates/listeners.mustache", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMFQxNDowMDo1NFrOGTEe6A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMFQxNDowMDo1NFrOGTEe6A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjY0OTU3Ng==", "bodyText": "It's better to provide meaningful variables for n and i", "url": "https://github.com/wso2/product-microgateway/pull/1223#discussion_r422649576", "createdAt": "2020-05-10T14:00:54Z", "author": {"login": "AmaliMatharaarachchi"}, "path": "components/micro-gateway-cli/src/main/resources/templates/listeners.mustache", "diffHunk": "@@ -133,7 +134,40 @@ public function getFilters() returns (http:RequestFilter|http:ResponseFilter) []\n     // Extension filter\n     ExtensionFilter extensionFilter = new;\n \n-    return [grpcFilter, preAuthnFilter, authorizationFilter, validationRequestFilter, throttleFilter,\n+    (http:RequestFilter|http:ResponseFilter)[] defaultFilters = [grpcFilter, preAuthnFilter, authorizationFilter, validationRequestFilter, throttleFilter,\n             analyticsFilter, validationResponseFilter, extensionFilter];\n+\n+    (http:RequestFilter|http:ResponseFilter)[] customFilters = [];\n+    int[] customFilterIndexes = [];\n+    (http:RequestFilter|http:ResponseFilter)[] allFilters = defaultFilters.slice(0,defaultFilters.length());\n+{{#containerConfig.filters}}\n+    {{name}} {{variableName}} = new;\n+    customFilterIndexes[{{@index}}] = {{position}};\n+    customFilters[{{@index}}] = {{variableName}};\n+    allFilters.push({{variableName}}) ;\n+{{/containerConfig.filters}}\n+\n+    int customFilterIndex = 0;\n+    int authFilterPosition = gateway:getAuthFilterPosition();\n+\n+    foreach var filterIndex in customFilterIndexes {\n+        shiftArray(allFilters, filterIndex, customFilters[customFilterIndex]);\n+        if(filterIndex <= authFilterPosition) {\n+            authFilterPosition = authFilterPosition + 1;\n+        }\n+        customFilterIndex = customFilterIndex +1;\n+    }\n+\n+    gateway:setAuthFilterPosition(authFilterPosition);\n+    log:printDebug(allFilters.toString());\n+    return allFilters;\n+}\n+\n+function shiftArray((http:RequestFilter|http:ResponseFilter)[] allFilters, int position, (http:RequestFilter|http:ResponseFilter) customFilter){\n+    int n = allFilters.length();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f9de522bf956fb9e3dcf2af75f44f0e8ff2b5d4b"}, "originalPosition": 52}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1216, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}