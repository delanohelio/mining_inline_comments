{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYwMzgzNTE2", "number": 1361, "title": "Read jmx_port from args and env", "bodyText": "Purpose\n\nStartup tool lib was only reading the jmx_port config from the config file. When config is provided as program arg or env variable it was not picked up.\nThis fix will enable looking up for both program args and env vars for the configuration. This is implemented in the tool lib to make logic generic for both *nix and windows platforms.\nIssues\n\nFixes #1201\nAutomation tests\n\nUnit tests added: No\nIntegration tests added: No\n\nTested environments\n\nMacOS\n\nMaintainers: Check before merge\n\n Assigned 'Type' label\n Assigned the project\n Validated respective github issues\n Assigned milestone to the github issue(s)", "createdAt": "2020-07-31T18:22:42Z", "url": "https://github.com/wso2/product-microgateway/pull/1361", "merged": true, "mergeCommit": {"oid": "7b58154eac1bcf00afa105b57fd067d5a834b0d8"}, "closed": true, "closedAt": "2020-08-07T04:40:52Z", "author": {"login": "praminda"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc6YIC-AH2gAyNDYwMzgzNTE2OjAwMjJhMmU0ZTdkZDkzOGZmMDMwYjk5ZjUzOTliMGI2NDc3MDRhZDY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc8crwAAFqTQ2MzAyNTgyNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0022a2e4e7dd938ff030b99f5399b0b647704ad6", "author": {"user": {"login": "praminda", "name": "Praminda"}}, "url": "https://github.com/wso2/product-microgateway/commit/0022a2e4e7dd938ff030b99f5399b0b647704ad6", "committedDate": "2020-07-31T18:00:12Z", "message": "pom: Update artifact names\n\nAll maven module didn't contained consistant artifact names"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "093c48477d7a2c099e006ae51d1322370fd6b8ab", "author": {"user": {"login": "praminda", "name": "Praminda"}}, "url": "https://github.com/wso2/product-microgateway/commit/093c48477d7a2c099e006ae51d1322370fd6b8ab", "committedDate": "2020-07-31T18:12:28Z", "message": "tool: Read config from args and env\n\nFixes #1201\n\nStartup tool library was only reading the jmx_port config from the\nconfig file. When config is provided as program arg or env varriable\nit was not picked up.\nThis fix will anable looking up for both program args and env vars\nfor the configuration. This is implemented in the tool lib to make\nit general for both *nix and wnidows platforms"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxMDE1NzI0", "url": "https://github.com/wso2/product-microgateway/pull/1361#pullrequestreview-461015724", "createdAt": "2020-08-04T17:19:27Z", "commit": {"oid": "093c48477d7a2c099e006ae51d1322370fd6b8ab"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyMjA2MDQx", "url": "https://github.com/wso2/product-microgateway/pull/1361#pullrequestreview-462206041", "createdAt": "2020-08-06T05:54:01Z", "commit": {"oid": "093c48477d7a2c099e006ae51d1322370fd6b8ab"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQwNTo1NDowMVrOG8kSiw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQwNTo1NDowMVrOG8kSiw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjE2MjMxNQ==", "bodyText": "Change name to populate???", "url": "https://github.com/wso2/product-microgateway/pull/1361#discussion_r466162315", "createdAt": "2020-08-06T05:54:01Z", "author": {"login": "praminda"}, "path": "components/micro-gateway-tools/src/main/java/org/wso2/micro/gateway/tools/GetConfig.java", "diffHunk": "@@ -38,4 +42,129 @@ public void getConfigurations(String confFilePath, String fileWritePath) throws\n         }\n     }\n \n+    /**\n+     * Read configuration from program arguments, env variables and toml configuration file.\n+     * Then these configuration values will be put into a newline separated file for easier reading from the\n+     * scripts.\n+     * @param args program argument list.\n+     *             0th index should be the path to config file.\n+     *             1st index should be the path to output file.\n+     *             rest of the arguments can contain any arbitrary commandline configuration properties\n+     * @throws IOException When toml config file reading fails\n+     */\n+    public void getConfigurations(String[] args) throws IOException {\n+        String confFilePath = args [0];\n+        String fileWritePath = args [1];\n+        Map<String, String> configs = new HashMap<>();\n+\n+        getConfigsFromArgs(args, configs);\n+        if (!isComplete(configs)) {\n+            getConfigsFromEnv(configs);\n+        }\n+\n+        if (!isComplete(configs)) {\n+            getConfigsFromFile(confFilePath, configs);\n+        }\n+\n+        if (isComplete(configs)) {\n+            writeToFile(configs, fileWritePath);\n+        }\n+    }\n+\n+    private Map<String, String> getConfigsFromFile(String confFilePath, Map<String, String> currentConfigs) {\n+        File configFile = new File (confFilePath);\n+        Toml toml = new Toml();\n+        toml.read(configFile);\n+        Config config = toml.to(Config.class);\n+        String isMetricsEnabled;\n+        String jmxPort;\n+\n+        if (config.getB7a() != null && config.getB7a().getObservability() != null &&\n+                config.getB7a().getObservability().getMetrics() != null) {\n+            isMetricsEnabled = String.valueOf(config.getB7a().getObservability().getMetrics().isEnabled());\n+            jmxPort = String.valueOf(config.getB7a().getObservability().getMetrics().getPrometheus().getJmxPort());\n+            currentConfigs.putIfAbsent(CONF_METRICS_ENABLED, isMetricsEnabled);\n+            currentConfigs.putIfAbsent(CONF_JMX_PORT, jmxPort);\n+        }\n+\n+        return currentConfigs;\n+    }\n+\n+    private Map<String, String> getConfigsFromEnv(Map<String, String> currentConfigs) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "093c48477d7a2c099e006ae51d1322370fd6b8ab"}, "originalPosition": 72}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "74ea64a14a34fade29b56194b7f81780acd9435b", "author": {"user": {"login": "praminda", "name": "Praminda"}}, "url": "https://github.com/wso2/product-microgateway/commit/74ea64a14a34fade29b56194b7f81780acd9435b", "committedDate": "2020-08-07T04:17:23Z", "message": "tool: Change get... method names\n\nThese methods doesn't perform basic get operations."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYzMDI1ODI1", "url": "https://github.com/wso2/product-microgateway/pull/1361#pullrequestreview-463025825", "createdAt": "2020-08-07T04:26:40Z", "commit": {"oid": "74ea64a14a34fade29b56194b7f81780acd9435b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 941, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}