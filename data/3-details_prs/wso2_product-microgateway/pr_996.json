{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc2MTIwNDAz", "number": 996, "title": "Provide support for gRPC", "bodyText": "Purpose\nProvide gateway functionalities (Proxying, Authentication, Authorization and Throttling) for the grpc servers\nIssues\nFixes #283\nAutomation tests\n\nUnit tests added: No\nIntegration tests added: No\n\nTested environments\n\nMacOS Mojave\n\nMaintainers: Check before merge\n\n Assigned 'Type' label\n Assigned the project\n Validated respective github issues\n Assigned milestone to the github issue(s)", "createdAt": "2020-02-17T12:52:48Z", "url": "https://github.com/wso2/product-microgateway/pull/996", "merged": true, "mergeCommit": {"oid": "070bfddbbb86ed7d951930afe0abb6b040e44271"}, "closed": true, "closedAt": "2020-02-17T14:46:33Z", "author": {"login": "VirajSalaka"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcEopG8gH2gAyMzc2MTIwNDAzOmQ0OTQwZjY2NmEyOWJmZDVhOTdhZWIyZTMwMWUwZTUyMzZkNWRjYTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdBbuWCgFqTQ3MjkzNDE5MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d4940f666a29bfd5a97aeb2e301e0e5236d5dca9", "author": {"user": {"login": "VirajSalaka", "name": "Viraj Salaka"}}, "url": "https://github.com/wso2/product-microgateway/commit/d4940f666a29bfd5a97aeb2e301e0e5236d5dca9", "committedDate": "2020-02-15T18:42:53Z", "message": "support grpc for microgateway"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "89322e2c078cc9cbd3408c80e5818e6bde6baa43", "author": {"user": {"login": "VirajSalaka", "name": "Viraj Salaka"}}, "url": "https://github.com/wso2/product-microgateway/commit/89322e2c078cc9cbd3408c80e5818e6bde6baa43", "committedDate": "2020-02-16T16:01:01Z", "message": "download the protoc executable instead of packaging with the toolkit distribution"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "27e6559cc26583687130682b0218a1425cc25001", "author": {"user": {"login": "VirajSalaka", "name": "Viraj Salaka"}}, "url": "https://github.com/wso2/product-microgateway/commit/27e6559cc26583687130682b0218a1425cc25001", "committedDate": "2020-02-16T17:40:38Z", "message": "change the wso2 options protobuf file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8e103a84cbdef29260aef34c44198b8a16ceafae", "author": {"user": {"login": "VirajSalaka", "name": "Viraj Salaka"}}, "url": "https://github.com/wso2/product-microgateway/commit/8e103a84cbdef29260aef34c44198b8a16ceafae", "committedDate": "2020-02-17T05:25:30Z", "message": "add APIKey scheme, bug fix basicAuth for protobuf, save proto desc file inside target gen directory"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "84b31e6ea2bb5eb684e9b9396d811d25e5be1a21", "author": {"user": {"login": "VirajSalaka", "name": "Viraj Salaka"}}, "url": "https://github.com/wso2/product-microgateway/commit/84b31e6ea2bb5eb684e9b9396d811d25e5be1a21", "committedDate": "2020-02-17T08:32:41Z", "message": "restructure wso2_options proto file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "29c6fd421940da1a992ce5ac154cc8138b7ee8a3", "author": {"user": {"login": "VirajSalaka", "name": "Viraj Salaka"}}, "url": "https://github.com/wso2/product-microgateway/commit/29c6fd421940da1a992ce5ac154cc8138b7ee8a3", "committedDate": "2020-02-17T11:09:20Z", "message": "change default http version to 2.0"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "438519450df039ecf96ff015bb4f9a74cff4da0b", "author": {"user": {"login": "VirajSalaka", "name": "Viraj Salaka"}}, "url": "https://github.com/wso2/product-microgateway/commit/438519450df039ecf96ff015bb4f9a74cff4da0b", "committedDate": "2020-02-17T12:32:01Z", "message": "Add debug logs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8c573616fe00f791f4923d096a5aac090d89af87", "author": {"user": {"login": "VirajSalaka", "name": "Viraj Salaka"}}, "url": "https://github.com/wso2/product-microgateway/commit/8c573616fe00f791f4923d096a5aac090d89af87", "committedDate": "2020-02-17T12:40:10Z", "message": "relocate the auto generated codes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3c8301cc771df7ff5164d121d83def8b87fca8fa", "author": {"user": {"login": "VirajSalaka", "name": "Viraj Salaka"}}, "url": "https://github.com/wso2/product-microgateway/commit/3c8301cc771df7ff5164d121d83def8b87fca8fa", "committedDate": "2020-02-17T12:52:08Z", "message": "fix startup error message from the tools Main"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d1852890f703b22e797e3c6cbf5c2235d3b3411", "author": {"user": {"login": "VirajSalaka", "name": "Viraj Salaka"}}, "url": "https://github.com/wso2/product-microgateway/commit/1d1852890f703b22e797e3c6cbf5c2235d3b3411", "committedDate": "2020-02-17T14:27:56Z", "message": "resolve merge conflicts"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5Nzc2NDU5", "url": "https://github.com/wso2/product-microgateway/pull/996#pullrequestreview-359776459", "createdAt": "2020-02-17T14:32:26Z", "commit": {"oid": "1d1852890f703b22e797e3c6cbf5c2235d3b3411"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcyOTM0MTkx", "url": "https://github.com/wso2/product-microgateway/pull/996#pullrequestreview-472934191", "createdAt": "2020-08-22T15:40:03Z", "commit": {"oid": "1d1852890f703b22e797e3c6cbf5c2235d3b3411"}, "state": "COMMENTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMlQxNTo0MDowM1rOHFF84A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMlQxNTo1OTo0MlrOHFGDhQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTEwMjQzMg==", "bodyText": "Add null check for subDirectories", "url": "https://github.com/wso2/product-microgateway/pull/996#discussion_r475102432", "createdAt": "2020-08-22T15:40:03Z", "author": {"login": "AmaliMatharaarachchi"}, "path": "components/micro-gateway-cli/src/main/java/org/wso2/apimgt/gateway/cli/cmd/BuildCmd.java", "diffHunk": "@@ -142,12 +146,28 @@ public void execute() {\n         }\n     }\n \n-    private boolean checkDirContentAvailability(String fileLocation) {\n+    private boolean isOpenAPIsAvailable(String fileLocation) {\n         File file = new File(fileLocation);\n         FilenameFilter filter = (f, name) -> (name.endsWith(\".yaml\") || name.endsWith(\".json\"));\n         String[] fileNames = file.list(filter);\n \n-        return file.list() != null && fileNames != null && fileNames.length > 0;\n+        return fileNames != null && fileNames.length > 0;\n+    }\n+\n+    private boolean isProtosAvailable(String fileLocation) {\n+        File file = new File(fileLocation);\n+        FilenameFilter protoFilter = (f, name) -> (name.endsWith(\".proto\"));\n+        String[] fileNames = file.list(protoFilter);\n+        if (fileNames != null && fileNames.length > 0) {\n+            return true;\n+        }\n+        //allow the users to have proto definitions inside a directory if required\n+        FileFilter dirFilter = (f) -> f.isDirectory();\n+        File[] subDirectories = file.listFiles(dirFilter);\n+        for (File dir : subDirectories) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1d1852890f703b22e797e3c6cbf5c2235d3b3411"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTEwMjU5OA==", "bodyText": "Can use method reference.\nFileFilter dirFilter = File::isDirectory;", "url": "https://github.com/wso2/product-microgateway/pull/996#discussion_r475102598", "createdAt": "2020-08-22T15:42:08Z", "author": {"login": "AmaliMatharaarachchi"}, "path": "components/micro-gateway-cli/src/main/java/org/wso2/apimgt/gateway/cli/cmd/BuildCmd.java", "diffHunk": "@@ -142,12 +146,28 @@ public void execute() {\n         }\n     }\n \n-    private boolean checkDirContentAvailability(String fileLocation) {\n+    private boolean isOpenAPIsAvailable(String fileLocation) {\n         File file = new File(fileLocation);\n         FilenameFilter filter = (f, name) -> (name.endsWith(\".yaml\") || name.endsWith(\".json\"));\n         String[] fileNames = file.list(filter);\n \n-        return file.list() != null && fileNames != null && fileNames.length > 0;\n+        return fileNames != null && fileNames.length > 0;\n+    }\n+\n+    private boolean isProtosAvailable(String fileLocation) {\n+        File file = new File(fileLocation);\n+        FilenameFilter protoFilter = (f, name) -> (name.endsWith(\".proto\"));\n+        String[] fileNames = file.list(protoFilter);\n+        if (fileNames != null && fileNames.length > 0) {\n+            return true;\n+        }\n+        //allow the users to have proto definitions inside a directory if required\n+        FileFilter dirFilter = (f) -> f.isDirectory();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1d1852890f703b22e797e3c6cbf5c2235d3b3411"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTEwMzUxOA==", "bodyText": "Shall we revisit todo items in this PR?", "url": "https://github.com/wso2/product-microgateway/pull/996#discussion_r475103518", "createdAt": "2020-08-22T15:52:45Z", "author": {"login": "AmaliMatharaarachchi"}, "path": "components/micro-gateway-cli/src/main/java/org/wso2/apimgt/gateway/cli/utils/CmdUtils.java", "diffHunk": "@@ -1127,6 +1150,29 @@ public static String getProjectSwaggerFilePath(String projectName, String apiId)\n                 CliConstants.API_SWAGGER;\n     }\n \n+    /**\n+     * get the path of the protoc executable.\n+     *\n+     * @return the absolute path of the protoc executable\n+     */\n+    public static String getProtocDirPath() {\n+        return getResourceFolderLocation() + File.separator + CliConstants.RESOURCES_GRPC_DIR;\n+    }\n+\n+    //todo: change the file location", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1d1852890f703b22e797e3c6cbf5c2235d3b3411"}, "originalPosition": 77}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTEwNDExNQ==", "bodyText": "Add a new line to EOF", "url": "https://github.com/wso2/product-microgateway/pull/996#discussion_r475104115", "createdAt": "2020-08-22T15:59:23Z", "author": {"login": "AmaliMatharaarachchi"}, "path": "components/micro-gateway-cli/src/main/resources/templates/http2.mustache", "diffHunk": "@@ -1,2 +1,2 @@\n \n-    httpVersion: gateway:getHttpVersion()\n\\ No newline at end of file\n+   httpVersion: gateway:getHttpVersion()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1d1852890f703b22e797e3c6cbf5c2235d3b3411"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTEwNDExNw==", "bodyText": "Add a new line to EOF", "url": "https://github.com/wso2/product-microgateway/pull/996#discussion_r475104117", "createdAt": "2020-08-22T15:59:33Z", "author": {"login": "AmaliMatharaarachchi"}, "path": "components/micro-gateway-cli/src/main/resources/templates/http2settings.mustache", "diffHunk": "@@ -0,0 +1 @@\n+{{#if isGrpc}} , http2Settings: { http2PriorKnowledge: true } {{/if}}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1d1852890f703b22e797e3c6cbf5c2235d3b3411"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTEwNDEzMw==", "bodyText": "Add a new line to EOF", "url": "https://github.com/wso2/product-microgateway/pull/996#discussion_r475104133", "createdAt": "2020-08-22T15:59:42Z", "author": {"login": "AmaliMatharaarachchi"}, "path": "components/micro-gateway-cli/src/main/resources/templates/httpEndpoint.mustache", "diffHunk": "@@ -1,4 +1,4 @@\n http:Client {{qualifiedServiceName}}_{{endpointUrlType}} = new (\n {{#if endpoints.0.isEtcdEnabled}}gateway:etcdSetup(\"{{name}}_{{endpointUrlType}}_endpoint_0\",\"{{name}}_{{endpointUrlType}}_0_etcdKey\",\"{{endpoints.0.endpointUrl}}\",\"{{endpoints.0.etcdKey}}\"){{else}}gateway:retrieveConfig(\"{{name}}_{{endpointUrlType}}_endpoint_0\",\"{{endpoints.0.endpointUrl}}\"){{/if}},\n-{ {{>http2}}{{>caching}}{{>basicAuth}}{{>secureSocket}}\n+{ {{>http2}}{{>http2settings}}{{>caching}}{{>basicAuth}}{{>secureSocket}}\n });", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1d1852890f703b22e797e3c6cbf5c2235d3b3411"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1156, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}