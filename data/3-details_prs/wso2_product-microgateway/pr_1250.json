{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIzMTk5Njc5", "number": 1250, "title": "Avoid overriding backend auth responses", "bodyText": "Purpose\n\nAvoid MGW from sending its own auth failure responses when backends and interceptors respond with auth failures.\nIssues\n\nFixes #1233\nAutomation tests\n\nUnit tests added: No\nIntegration tests added: Yes\n\nTested environments\n\nMacOS\n\nMaintainers: Check before merge\n\n Assigned 'Type' label\n Assigned the project\n Validated respective github issues\n Assigned milestone to the github issue(s)", "createdAt": "2020-05-26T13:17:15Z", "url": "https://github.com/wso2/product-microgateway/pull/1250", "merged": true, "mergeCommit": {"oid": "79e0994b389ff892e1e87e02bb75d19a68cf2f34"}, "closed": true, "closedAt": "2020-06-01T08:19:39Z", "author": {"login": "praminda"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABclC4PNgH2gAyNDIzMTk5Njc5OmYxM2JmZWM5MmVmZjg1MzY0NTY1OGY2NGEwMGRmNWMwNWI4OWNhNzU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcm7ebFAFqTQyMTY1NjQwOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f13bfec92eff853645658f64a00df5c05b89ca75", "author": {"user": {"login": "praminda", "name": "Praminda"}}, "url": "https://github.com/wso2/product-microgateway/commit/f13bfec92eff853645658f64a00df5c05b89ca75", "committedDate": "2020-05-26T11:22:31Z", "message": "core: Pass backend error responses to client\n\nissue: #1233\n\nIf backend endpoint reponded with authentication error responses\nsuch as 401 and 403, mgw was responding to client with its own\nauth error response messages. This shouldn't be the case and mgw\nshould pass the backend error message to the client."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "837ffd50cf1a5c5df689098b3e94186c48c70372", "author": {"user": {"login": "praminda", "name": "Praminda"}}, "url": "https://github.com/wso2/product-microgateway/commit/837ffd50cf1a5c5df689098b3e94186c48c70372", "committedDate": "2020-05-26T11:22:31Z", "message": "core: Pass interceptor response to client\n\nWhen interceptor responds with 401, 403 like error responses,\ngateway should avoid sending it's own response to the client.\nThis fix is an improvement to the fix done in 35a07d7 where\nthat fix fails to identify responses coming from an interceptor.\nWhen an interceptor responds to the client, the developer should\nset RESPOND_DONE property to the invocationContext before calling\nrespond(). Otherwise mgw will not be able to recognize the\nresponse as a response coming from an interceptor."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d9bd4766610ca7d50d3e0916cea12fbbcc37d646", "author": {"user": {"login": "praminda", "name": "Praminda"}}, "url": "https://github.com/wso2/product-microgateway/commit/d9bd4766610ca7d50d3e0916cea12fbbcc37d646", "committedDate": "2020-05-26T13:04:56Z", "message": "Add test case for #1233"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIwODM3MjYy", "url": "https://github.com/wso2/product-microgateway/pull/1250#pullrequestreview-420837262", "createdAt": "2020-05-29T10:32:48Z", "commit": {"oid": "d9bd4766610ca7d50d3e0916cea12fbbcc37d646"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQxMDozMjo0OFrOGcXgTg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQxMDozMjo0OFrOGcXgTg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjM5ODQxNA==", "bodyText": "Lets change the description properly", "url": "https://github.com/wso2/product-microgateway/pull/1250#discussion_r432398414", "createdAt": "2020-05-29T10:32:48Z", "author": {"login": "Rajith90"}, "path": "tests/src/test/java/org/wso2/micro/gateway/tests/endpoints/EndpointWithSecurityTestCase.java", "diffHunk": "@@ -52,6 +52,31 @@ public void testPerAPISecureEndpoint() throws Exception {\n         Assert.assertEquals(response.getResponseCode(), 200, \"Response code mismatched\");\n     }\n \n+    @Test(description = \"Test Invoking the resource which endpoint defined at API level using references\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d9bd4766610ca7d50d3e0916cea12fbbcc37d646"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIwODM3NDEx", "url": "https://github.com/wso2/product-microgateway/pull/1250#pullrequestreview-420837411", "createdAt": "2020-05-29T10:33:01Z", "commit": {"oid": "d9bd4766610ca7d50d3e0916cea12fbbcc37d646"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQxMDozMzowMlrOGcXgwQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOVQxMDozMzowMlrOGcXgwQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjM5ODUyOQ==", "bodyText": "Lets change the description properly", "url": "https://github.com/wso2/product-microgateway/pull/1250#discussion_r432398529", "createdAt": "2020-05-29T10:33:02Z", "author": {"login": "Rajith90"}, "path": "tests/src/test/java/org/wso2/micro/gateway/tests/endpoints/EndpointWithSecurityTestCase.java", "diffHunk": "@@ -52,6 +52,31 @@ public void testPerAPISecureEndpoint() throws Exception {\n         Assert.assertEquals(response.getResponseCode(), 200, \"Response code mismatched\");\n     }\n \n+    @Test(description = \"Test Invoking the resource which endpoint defined at API level using references\")\n+    public void testSecureEndpointWithAuthnFailure() throws Exception {\n+        Map<String, String> headers = new HashMap<>();\n+        //test endpoint with token\n+        headers.put(HttpHeaderNames.AUTHORIZATION.toString(), \"Bearer \" + jwtTokenProd);\n+        org.wso2.micro.gateway.tests.util.HttpResponse response = HttpClientRequest\n+                .doGet(getServiceURLHttp(\"petstore/v5/store/order/1\"), headers);\n+        Assert.assertNotNull(response);\n+        Assert.assertEquals(response.getData(), ResponseConstants.AUTHENTICATION_FAILURE_RESPONSE);\n+        Assert.assertEquals(response.getResponseCode(), 401, \"Response code mismatched\");\n+    }\n+\n+\n+    @Test(description = \"Test Invoking the resource which endpoint defined at API level using references\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d9bd4766610ca7d50d3e0916cea12fbbcc37d646"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "18074ac2814efe2125ca244854a0c296f8940af7", "author": {"user": {"login": "praminda", "name": "Praminda"}}, "url": "https://github.com/wso2/product-microgateway/commit/18074ac2814efe2125ca244854a0c296f8940af7", "committedDate": "2020-05-29T11:36:22Z", "message": "test: Update test description"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxNjU2NDA4", "url": "https://github.com/wso2/product-microgateway/pull/1250#pullrequestreview-421656408", "createdAt": "2020-06-01T07:52:50Z", "commit": {"oid": "18074ac2814efe2125ca244854a0c296f8940af7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1098, "cost": 1, "resetAt": "2021-11-02T10:47:05Z"}}}