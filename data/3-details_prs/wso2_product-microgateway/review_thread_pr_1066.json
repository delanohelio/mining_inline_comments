{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgxNzI3MzI2", "number": 1066, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOVQwNDoxMDo0OVrODkACow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQwNDowODowOVrOEbZhcg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM5MDc2MDAzOnYy", "diffSide": "RIGHT", "path": "components/micro-gateway-core/src/main/ballerina/src/gateway/utils/utils.bal", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOVQwNDoxMDo0OVrOFwHhHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOVQwNDoxNDozMFrOFwHh3g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTk5OTEzNA==", "bodyText": "does this works properly", "url": "https://github.com/wso2/product-microgateway/pull/1066#discussion_r385999134", "createdAt": "2020-02-29T04:10:49Z", "author": {"login": "Rajith90"}, "path": "components/micro-gateway-core/src/main/ballerina/src/gateway/utils/utils.bal", "diffHunk": "@@ -157,6 +157,9 @@ public function getClientIp(http:Request request, http:Caller caller) returns (s\n         }\n     } else {\n         clientIp = caller.remoteAddress.host;\n+        if (clientIp == \"\") {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b7732b3ebc3c99ce2fa31bea5f95a9dee84b1b53"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTk5OTMyNg==", "bodyText": "Yes. I have tested.", "url": "https://github.com/wso2/product-microgateway/pull/1066#discussion_r385999326", "createdAt": "2020-02-29T04:14:30Z", "author": {"login": "VirajSalaka"}, "path": "components/micro-gateway-core/src/main/ballerina/src/gateway/utils/utils.bal", "diffHunk": "@@ -157,6 +157,9 @@ public function getClientIp(http:Request request, http:Caller caller) returns (s\n         }\n     } else {\n         clientIp = caller.remoteAddress.host;\n+        if (clientIp == \"\") {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTk5OTEzNA=="}, "originalCommit": {"oid": "b7732b3ebc3c99ce2fa31bea5f95a9dee84b1b53"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM5MDc2MDUwOnYy", "diffSide": "RIGHT", "path": "components/micro-gateway-core/src/main/ballerina/src/gateway/utils/analytics_util.bal", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOVQwNDoxMTo1MlrOFwHhUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOVQwNDoxODoyM1rOFwHiuA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTk5OTE4Ng==", "bodyText": "can we move this to separate function, used in two places", "url": "https://github.com/wso2/product-microgateway/pull/1066#discussion_r385999186", "createdAt": "2020-02-29T04:11:52Z", "author": {"login": "Rajith90"}, "path": "components/micro-gateway-core/src/main/ballerina/src/gateway/utils/analytics_util.bal", "diffHunk": "@@ -73,6 +64,18 @@ function populateThrottleAnalyticsDTO(http:FilterContext context) returns (Throt\n         eventDto.subscriber = END_USER_ANONYMOUS;\n     }\n \n+    APIConfiguration? apiConfiguration = apiConfigAnnotationMap[context.getServiceName()];\n+    if (apiConfiguration is APIConfiguration) {\n+        eventDto.apiVersion = apiConfiguration.apiVersion;\n+        if (!stringutils:equalsIgnoreCase(\"\", <string>apiConfiguration.publisher)\n+                && stringutils:equalsIgnoreCase(\"\", <string>eventDto.apiCreator)) {\n+            eventDto.apiCreator = <string>apiConfiguration.publisher;\n+        } else if (stringutils:equalsIgnoreCase(\"\", <string>eventDto.apiCreator)) {\n+            //sets API creator if x-wso2-owner extension not specified.\n+            eventDto.apiCreator = UNKNOWN_VALUE;\n+        }\n+    }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ee891547b6ca7e5961def9bcae80ab3d245b3ac5"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTk5OTU0NA==", "bodyText": "It seems not possible since the DTO's are different in those two locations. And ballerina does not have the inhertance property AFAIK.", "url": "https://github.com/wso2/product-microgateway/pull/1066#discussion_r385999544", "createdAt": "2020-02-29T04:18:23Z", "author": {"login": "VirajSalaka"}, "path": "components/micro-gateway-core/src/main/ballerina/src/gateway/utils/analytics_util.bal", "diffHunk": "@@ -73,6 +64,18 @@ function populateThrottleAnalyticsDTO(http:FilterContext context) returns (Throt\n         eventDto.subscriber = END_USER_ANONYMOUS;\n     }\n \n+    APIConfiguration? apiConfiguration = apiConfigAnnotationMap[context.getServiceName()];\n+    if (apiConfiguration is APIConfiguration) {\n+        eventDto.apiVersion = apiConfiguration.apiVersion;\n+        if (!stringutils:equalsIgnoreCase(\"\", <string>apiConfiguration.publisher)\n+                && stringutils:equalsIgnoreCase(\"\", <string>eventDto.apiCreator)) {\n+            eventDto.apiCreator = <string>apiConfiguration.publisher;\n+        } else if (stringutils:equalsIgnoreCase(\"\", <string>eventDto.apiCreator)) {\n+            //sets API creator if x-wso2-owner extension not specified.\n+            eventDto.apiCreator = UNKNOWN_VALUE;\n+        }\n+    }\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTk5OTE4Ng=="}, "originalCommit": {"oid": "ee891547b6ca7e5961def9bcae80ab3d245b3ac5"}, "originalPosition": 40}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk3MTY1MTcwOnYy", "diffSide": "RIGHT", "path": "components/micro-gateway-core/src/main/ballerina/src/gateway/utils/analytics_util.bal", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQwNDowODowOVrOHFT7fw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNFQwNDowODowOVrOHFT7fw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTMzMTQ1NQ==", "bodyText": "invalid indentation", "url": "https://github.com/wso2/product-microgateway/pull/1066#discussion_r475331455", "createdAt": "2020-08-24T04:08:09Z", "author": {"login": "praminda"}, "path": "components/micro-gateway-core/src/main/ballerina/src/gateway/utils/analytics_util.bal", "diffHunk": "@@ -127,7 +120,20 @@ function populateFaultAnalyticsDTO(http:FilterContext context, string err) retur\n         eventDto.applicationId = ANONYMOUS_APP_ID;\n         eventDto.userTenantDomain = ANONYMOUS_USER_TENANT_DOMAIN;\n     }\n-    metaInfo[\"correlationID\"] = <string>context.attributes[MESSAGE_ID];\n+\n+    APIConfiguration? apiConfig = apiConfigAnnotationMap[context.getServiceName()];\n+    if (apiConfig is APIConfiguration) {\n+        var api_Version = apiConfig.apiVersion;\n+        eventDto.apiVersion = api_Version;\n+        if (!stringutils:equalsIgnoreCase(\"\", <string>apiConfig.publisher)\n+                && stringutils:equalsIgnoreCase(\"\", <string>eventDto.apiCreator)) {\n+            eventDto.apiCreator = <string>apiConfig.publisher;\n+        } else if (stringutils:equalsIgnoreCase(\"\", <string>eventDto.apiCreator)) {\n+            //sets API creator if x-wso2-owner extension not specified.\n+            eventDto.apiCreator = UNKNOWN_VALUE;\n+        }\n+    }\n+metaInfo[\"correlationID\"] = <string>context.attributes[MESSAGE_ID];", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9b3f23e9599f0ea7174b9d9ec0d1b71177ad7171"}, "originalPosition": 88}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1307, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}