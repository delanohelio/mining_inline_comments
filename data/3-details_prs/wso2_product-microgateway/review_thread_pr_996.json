{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc2MTIwNDAz", "number": 996, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMlQxNTo0MDowM1rOEbOdWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMlQxNTo1OTo0MlrOEbOi_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk2OTgzODk3OnYy", "diffSide": "RIGHT", "path": "components/micro-gateway-cli/src/main/java/org/wso2/apimgt/gateway/cli/cmd/BuildCmd.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMlQxNTo0MDowM1rOHFF84A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yM1QwNTowMToyN1rOHFKIaw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTEwMjQzMg==", "bodyText": "Add null check for subDirectories", "url": "https://github.com/wso2/product-microgateway/pull/996#discussion_r475102432", "createdAt": "2020-08-22T15:40:03Z", "author": {"login": "AmaliMatharaarachchi"}, "path": "components/micro-gateway-cli/src/main/java/org/wso2/apimgt/gateway/cli/cmd/BuildCmd.java", "diffHunk": "@@ -142,12 +146,28 @@ public void execute() {\n         }\n     }\n \n-    private boolean checkDirContentAvailability(String fileLocation) {\n+    private boolean isOpenAPIsAvailable(String fileLocation) {\n         File file = new File(fileLocation);\n         FilenameFilter filter = (f, name) -> (name.endsWith(\".yaml\") || name.endsWith(\".json\"));\n         String[] fileNames = file.list(filter);\n \n-        return file.list() != null && fileNames != null && fileNames.length > 0;\n+        return fileNames != null && fileNames.length > 0;\n+    }\n+\n+    private boolean isProtosAvailable(String fileLocation) {\n+        File file = new File(fileLocation);\n+        FilenameFilter protoFilter = (f, name) -> (name.endsWith(\".proto\"));\n+        String[] fileNames = file.list(protoFilter);\n+        if (fileNames != null && fileNames.length > 0) {\n+            return true;\n+        }\n+        //allow the users to have proto definitions inside a directory if required\n+        FileFilter dirFilter = (f) -> f.isDirectory();\n+        File[] subDirectories = file.listFiles(dirFilter);\n+        for (File dir : subDirectories) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1d1852890f703b22e797e3c6cbf5c2235d3b3411"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTE3MDkyMw==", "bodyText": "This is what the java doc says\nAn array of abstract pathnames denoting the files and\n     *          directories in the directory denoted by this abstract pathname.\n     *          The array will be empty if the directory is empty.  Returns\n     *          {@code null} if this abstract pathname does not denote a\n     *          directory, or if an I/O error occurs.\n\nHence the /grpc_definitions directory is gonna be there all the time, there is no chance of getting subdirectories null.\nWDYT?", "url": "https://github.com/wso2/product-microgateway/pull/996#discussion_r475170923", "createdAt": "2020-08-23T05:01:27Z", "author": {"login": "VirajSalaka"}, "path": "components/micro-gateway-cli/src/main/java/org/wso2/apimgt/gateway/cli/cmd/BuildCmd.java", "diffHunk": "@@ -142,12 +146,28 @@ public void execute() {\n         }\n     }\n \n-    private boolean checkDirContentAvailability(String fileLocation) {\n+    private boolean isOpenAPIsAvailable(String fileLocation) {\n         File file = new File(fileLocation);\n         FilenameFilter filter = (f, name) -> (name.endsWith(\".yaml\") || name.endsWith(\".json\"));\n         String[] fileNames = file.list(filter);\n \n-        return file.list() != null && fileNames != null && fileNames.length > 0;\n+        return fileNames != null && fileNames.length > 0;\n+    }\n+\n+    private boolean isProtosAvailable(String fileLocation) {\n+        File file = new File(fileLocation);\n+        FilenameFilter protoFilter = (f, name) -> (name.endsWith(\".proto\"));\n+        String[] fileNames = file.list(protoFilter);\n+        if (fileNames != null && fileNames.length > 0) {\n+            return true;\n+        }\n+        //allow the users to have proto definitions inside a directory if required\n+        FileFilter dirFilter = (f) -> f.isDirectory();\n+        File[] subDirectories = file.listFiles(dirFilter);\n+        for (File dir : subDirectories) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTEwMjQzMg=="}, "originalCommit": {"oid": "1d1852890f703b22e797e3c6cbf5c2235d3b3411"}, "originalPosition": 52}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk2OTg0MDQ3OnYy", "diffSide": "RIGHT", "path": "components/micro-gateway-cli/src/main/java/org/wso2/apimgt/gateway/cli/cmd/BuildCmd.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMlQxNTo0MjowOFrOHFF9hg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMlQxNTo0MjowOFrOHFF9hg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTEwMjU5OA==", "bodyText": "Can use method reference.\nFileFilter dirFilter = File::isDirectory;", "url": "https://github.com/wso2/product-microgateway/pull/996#discussion_r475102598", "createdAt": "2020-08-22T15:42:08Z", "author": {"login": "AmaliMatharaarachchi"}, "path": "components/micro-gateway-cli/src/main/java/org/wso2/apimgt/gateway/cli/cmd/BuildCmd.java", "diffHunk": "@@ -142,12 +146,28 @@ public void execute() {\n         }\n     }\n \n-    private boolean checkDirContentAvailability(String fileLocation) {\n+    private boolean isOpenAPIsAvailable(String fileLocation) {\n         File file = new File(fileLocation);\n         FilenameFilter filter = (f, name) -> (name.endsWith(\".yaml\") || name.endsWith(\".json\"));\n         String[] fileNames = file.list(filter);\n \n-        return file.list() != null && fileNames != null && fileNames.length > 0;\n+        return fileNames != null && fileNames.length > 0;\n+    }\n+\n+    private boolean isProtosAvailable(String fileLocation) {\n+        File file = new File(fileLocation);\n+        FilenameFilter protoFilter = (f, name) -> (name.endsWith(\".proto\"));\n+        String[] fileNames = file.list(protoFilter);\n+        if (fileNames != null && fileNames.length > 0) {\n+            return true;\n+        }\n+        //allow the users to have proto definitions inside a directory if required\n+        FileFilter dirFilter = (f) -> f.isDirectory();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1d1852890f703b22e797e3c6cbf5c2235d3b3411"}, "originalPosition": 50}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk2OTg0ODEwOnYy", "diffSide": "RIGHT", "path": "components/micro-gateway-cli/src/main/java/org/wso2/apimgt/gateway/cli/utils/CmdUtils.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMlQxNTo1Mjo0NVrOHFGBHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QwMzo0NDoyNFrOHTPiJA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTEwMzUxOA==", "bodyText": "Shall we revisit todo items in this PR?", "url": "https://github.com/wso2/product-microgateway/pull/996#discussion_r475103518", "createdAt": "2020-08-22T15:52:45Z", "author": {"login": "AmaliMatharaarachchi"}, "path": "components/micro-gateway-cli/src/main/java/org/wso2/apimgt/gateway/cli/utils/CmdUtils.java", "diffHunk": "@@ -1127,6 +1150,29 @@ public static String getProjectSwaggerFilePath(String projectName, String apiId)\n                 CliConstants.API_SWAGGER;\n     }\n \n+    /**\n+     * get the path of the protoc executable.\n+     *\n+     * @return the absolute path of the protoc executable\n+     */\n+    public static String getProtocDirPath() {\n+        return getResourceFolderLocation() + File.separator + CliConstants.RESOURCES_GRPC_DIR;\n+    }\n+\n+    //todo: change the file location", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1d1852890f703b22e797e3c6cbf5c2235d3b3411"}, "originalPosition": 77}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTkzOTQ5Mg==", "bodyText": "already fixed via a later added PR.", "url": "https://github.com/wso2/product-microgateway/pull/996#discussion_r489939492", "createdAt": "2020-09-17T03:44:24Z", "author": {"login": "VirajSalaka"}, "path": "components/micro-gateway-cli/src/main/java/org/wso2/apimgt/gateway/cli/utils/CmdUtils.java", "diffHunk": "@@ -1127,6 +1150,29 @@ public static String getProjectSwaggerFilePath(String projectName, String apiId)\n                 CliConstants.API_SWAGGER;\n     }\n \n+    /**\n+     * get the path of the protoc executable.\n+     *\n+     * @return the absolute path of the protoc executable\n+     */\n+    public static String getProtocDirPath() {\n+        return getResourceFolderLocation() + File.separator + CliConstants.RESOURCES_GRPC_DIR;\n+    }\n+\n+    //todo: change the file location", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTEwMzUxOA=="}, "originalCommit": {"oid": "1d1852890f703b22e797e3c6cbf5c2235d3b3411"}, "originalPosition": 77}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk2OTg1MzI4OnYy", "diffSide": "RIGHT", "path": "components/micro-gateway-cli/src/main/resources/templates/http2.mustache", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMlQxNTo1OToyM1rOHFGDcw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMlQxNTo1OToyM1rOHFGDcw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTEwNDExNQ==", "bodyText": "Add a new line to EOF", "url": "https://github.com/wso2/product-microgateway/pull/996#discussion_r475104115", "createdAt": "2020-08-22T15:59:23Z", "author": {"login": "AmaliMatharaarachchi"}, "path": "components/micro-gateway-cli/src/main/resources/templates/http2.mustache", "diffHunk": "@@ -1,2 +1,2 @@\n \n-    httpVersion: gateway:getHttpVersion()\n\\ No newline at end of file\n+   httpVersion: gateway:getHttpVersion()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1d1852890f703b22e797e3c6cbf5c2235d3b3411"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk2OTg1MzMwOnYy", "diffSide": "RIGHT", "path": "components/micro-gateway-cli/src/main/resources/templates/http2settings.mustache", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMlQxNTo1OTozM1rOHFGDdQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMlQxNTo1OTozM1rOHFGDdQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTEwNDExNw==", "bodyText": "Add a new line to EOF", "url": "https://github.com/wso2/product-microgateway/pull/996#discussion_r475104117", "createdAt": "2020-08-22T15:59:33Z", "author": {"login": "AmaliMatharaarachchi"}, "path": "components/micro-gateway-cli/src/main/resources/templates/http2settings.mustache", "diffHunk": "@@ -0,0 +1 @@\n+{{#if isGrpc}} , http2Settings: { http2PriorKnowledge: true } {{/if}}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1d1852890f703b22e797e3c6cbf5c2235d3b3411"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk2OTg1MzQzOnYy", "diffSide": "RIGHT", "path": "components/micro-gateway-cli/src/main/resources/templates/httpEndpoint.mustache", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMlQxNTo1OTo0MlrOHFGDhQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QwMzo0NTo1MFrOHTPlzg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTEwNDEzMw==", "bodyText": "Add a new line to EOF", "url": "https://github.com/wso2/product-microgateway/pull/996#discussion_r475104133", "createdAt": "2020-08-22T15:59:42Z", "author": {"login": "AmaliMatharaarachchi"}, "path": "components/micro-gateway-cli/src/main/resources/templates/httpEndpoint.mustache", "diffHunk": "@@ -1,4 +1,4 @@\n http:Client {{qualifiedServiceName}}_{{endpointUrlType}} = new (\n {{#if endpoints.0.isEtcdEnabled}}gateway:etcdSetup(\"{{name}}_{{endpointUrlType}}_endpoint_0\",\"{{name}}_{{endpointUrlType}}_0_etcdKey\",\"{{endpoints.0.endpointUrl}}\",\"{{endpoints.0.etcdKey}}\"){{else}}gateway:retrieveConfig(\"{{name}}_{{endpointUrlType}}_endpoint_0\",\"{{endpoints.0.endpointUrl}}\"){{/if}},\n-{ {{>http2}}{{>caching}}{{>basicAuth}}{{>secureSocket}}\n+{ {{>http2}}{{>http2settings}}{{>caching}}{{>basicAuth}}{{>secureSocket}}\n });", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1d1852890f703b22e797e3c6cbf5c2235d3b3411"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTE3MTExNg==", "bodyText": "In the mustache files, If we add a new line to EOF, the generated ballerina file gonna be lengthier. Hence we do not add that unless it is required to be there in the generated code.", "url": "https://github.com/wso2/product-microgateway/pull/996#discussion_r475171116", "createdAt": "2020-08-23T05:04:30Z", "author": {"login": "VirajSalaka"}, "path": "components/micro-gateway-cli/src/main/resources/templates/httpEndpoint.mustache", "diffHunk": "@@ -1,4 +1,4 @@\n http:Client {{qualifiedServiceName}}_{{endpointUrlType}} = new (\n {{#if endpoints.0.isEtcdEnabled}}gateway:etcdSetup(\"{{name}}_{{endpointUrlType}}_endpoint_0\",\"{{name}}_{{endpointUrlType}}_0_etcdKey\",\"{{endpoints.0.endpointUrl}}\",\"{{endpoints.0.etcdKey}}\"){{else}}gateway:retrieveConfig(\"{{name}}_{{endpointUrlType}}_endpoint_0\",\"{{endpoints.0.endpointUrl}}\"){{/if}},\n-{ {{>http2}}{{>caching}}{{>basicAuth}}{{>secureSocket}}\n+{ {{>http2}}{{>http2settings}}{{>caching}}{{>basicAuth}}{{>secureSocket}}\n });", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTEwNDEzMw=="}, "originalCommit": {"oid": "1d1852890f703b22e797e3c6cbf5c2235d3b3411"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTk0MDQzMA==", "bodyText": "already fixed via a later added PR.", "url": "https://github.com/wso2/product-microgateway/pull/996#discussion_r489940430", "createdAt": "2020-09-17T03:45:50Z", "author": {"login": "VirajSalaka"}, "path": "components/micro-gateway-cli/src/main/resources/templates/httpEndpoint.mustache", "diffHunk": "@@ -1,4 +1,4 @@\n http:Client {{qualifiedServiceName}}_{{endpointUrlType}} = new (\n {{#if endpoints.0.isEtcdEnabled}}gateway:etcdSetup(\"{{name}}_{{endpointUrlType}}_endpoint_0\",\"{{name}}_{{endpointUrlType}}_0_etcdKey\",\"{{endpoints.0.endpointUrl}}\",\"{{endpoints.0.etcdKey}}\"){{else}}gateway:retrieveConfig(\"{{name}}_{{endpointUrlType}}_endpoint_0\",\"{{endpoints.0.endpointUrl}}\"){{/if}},\n-{ {{>http2}}{{>caching}}{{>basicAuth}}{{>secureSocket}}\n+{ {{>http2}}{{>http2settings}}{{>caching}}{{>basicAuth}}{{>secureSocket}}\n });", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTEwNDEzMw=="}, "originalCommit": {"oid": "1d1852890f703b22e797e3c6cbf5c2235d3b3411"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1289, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}