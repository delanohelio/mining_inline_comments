{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzczMTI0NjMy", "number": 977, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQwNDo0OToyNFrODer3ug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQwNDo1MToyMlrODer4hA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzNTAyNjUwOnYy", "diffSide": "RIGHT", "path": "components/micro-gateway-cli/src/main/resources/templates/kubernetesDeployment.mustache", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQwNDo0OToyNFrOFn9axQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQwNTowMToyN1rOFn9h2A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQ0NTA2MQ==", "bodyText": "Build image if block is not closed properly and Avoid empty cmd attribute\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                buildImage:{{containerConfig.kubernetes.kubernetesDeployment.buildImage}},\n          \n          \n            \n                buildImage:{{containerConfig.kubernetes.kubernetesDeployment.buildImage}}{{/if}}{{#if containerConfig.kubernetes.kubernetesDeployment.cmd}},", "url": "https://github.com/wso2/product-microgateway/pull/977#discussion_r377445061", "createdAt": "2020-02-11T04:49:24Z", "author": {"login": "praminda"}, "path": "components/micro-gateway-cli/src/main/resources/templates/kubernetesDeployment.mustache", "diffHunk": "@@ -9,9 +9,11 @@\n     periodSeconds:{{containerConfig.kubernetes.kubernetesDeployment.periodSeconds}}{{/if}}{{#if containerConfig.kubernetes.kubernetesDeployment.livenessPort}},\n     livenessPort:{{containerConfig.kubernetes.kubernetesDeployment.livenessPort}}{{/if}}{{#if containerConfig.kubernetes.kubernetesDeployment.image}},\n     image:\"{{containerConfig.kubernetes.kubernetesDeployment.image}}\"{{/if}}{{#if containerConfig.kubernetes.kubernetesDeployment.imagePullPolicy}},\n-    imagePullPolicy:\"{{containerConfig.kubernetes.kubernetesDeployment.imagePullPolicy}}\"{{/if}}{{#if containerConfig.kubernetes.kubernetesDeployment.env}},\n+    imagePullPolicy:\"{{containerConfig.kubernetes.kubernetesDeployment.imagePullPolicy}}\"{{/if}}{{#if containerConfig.kubernetes.kubernetesDeployment.imagePullSecrets}},\n+    imagePullSecrets: [{{#containerConfig.kubernetes.kubernetesDeployment.imagePullSecrets}}\"{{.}}\"{{#unless @last}},{{/unless}}{{/containerConfig.kubernetes.kubernetesDeployment.imagePullSecrets}}]{{/if}}{{#if containerConfig.kubernetes.kubernetesDeployment.env}},\n     env:{{{containerConfig.kubernetes.kubernetesDeployment.env}}}{{/if}}{{#if containerConfig.kubernetes.kubernetesDeployment.buildImage}},\n-    buildImage:{{containerConfig.kubernetes.kubernetesDeployment.buildImage}}{{/if}}{{#if containerConfig.kubernetes.kubernetesDeployment.copyFiles.enable}},\n+    buildImage:{{containerConfig.kubernetes.kubernetesDeployment.buildImage}},", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "69f1feaaba88648db892a3b82ddf4e933ec681a7"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQ0NjM5Ng==", "bodyText": "build Image and cmd is inside the if block of build image. cmd does not have any purpose if the build image is disabled", "url": "https://github.com/wso2/product-microgateway/pull/977#discussion_r377446396", "createdAt": "2020-02-11T04:58:09Z", "author": {"login": "Rajith90"}, "path": "components/micro-gateway-cli/src/main/resources/templates/kubernetesDeployment.mustache", "diffHunk": "@@ -9,9 +9,11 @@\n     periodSeconds:{{containerConfig.kubernetes.kubernetesDeployment.periodSeconds}}{{/if}}{{#if containerConfig.kubernetes.kubernetesDeployment.livenessPort}},\n     livenessPort:{{containerConfig.kubernetes.kubernetesDeployment.livenessPort}}{{/if}}{{#if containerConfig.kubernetes.kubernetesDeployment.image}},\n     image:\"{{containerConfig.kubernetes.kubernetesDeployment.image}}\"{{/if}}{{#if containerConfig.kubernetes.kubernetesDeployment.imagePullPolicy}},\n-    imagePullPolicy:\"{{containerConfig.kubernetes.kubernetesDeployment.imagePullPolicy}}\"{{/if}}{{#if containerConfig.kubernetes.kubernetesDeployment.env}},\n+    imagePullPolicy:\"{{containerConfig.kubernetes.kubernetesDeployment.imagePullPolicy}}\"{{/if}}{{#if containerConfig.kubernetes.kubernetesDeployment.imagePullSecrets}},\n+    imagePullSecrets: [{{#containerConfig.kubernetes.kubernetesDeployment.imagePullSecrets}}\"{{.}}\"{{#unless @last}},{{/unless}}{{/containerConfig.kubernetes.kubernetesDeployment.imagePullSecrets}}]{{/if}}{{#if containerConfig.kubernetes.kubernetesDeployment.env}},\n     env:{{{containerConfig.kubernetes.kubernetesDeployment.env}}}{{/if}}{{#if containerConfig.kubernetes.kubernetesDeployment.buildImage}},\n-    buildImage:{{containerConfig.kubernetes.kubernetesDeployment.buildImage}}{{/if}}{{#if containerConfig.kubernetes.kubernetesDeployment.copyFiles.enable}},\n+    buildImage:{{containerConfig.kubernetes.kubernetesDeployment.buildImage}},", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQ0NTA2MQ=="}, "originalCommit": {"oid": "69f1feaaba88648db892a3b82ddf4e933ec681a7"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQ0Njg3Mg==", "bodyText": "And also it should have our default cmd , which executes the gateway shell script rather than the java -jar command", "url": "https://github.com/wso2/product-microgateway/pull/977#discussion_r377446872", "createdAt": "2020-02-11T05:01:27Z", "author": {"login": "Rajith90"}, "path": "components/micro-gateway-cli/src/main/resources/templates/kubernetesDeployment.mustache", "diffHunk": "@@ -9,9 +9,11 @@\n     periodSeconds:{{containerConfig.kubernetes.kubernetesDeployment.periodSeconds}}{{/if}}{{#if containerConfig.kubernetes.kubernetesDeployment.livenessPort}},\n     livenessPort:{{containerConfig.kubernetes.kubernetesDeployment.livenessPort}}{{/if}}{{#if containerConfig.kubernetes.kubernetesDeployment.image}},\n     image:\"{{containerConfig.kubernetes.kubernetesDeployment.image}}\"{{/if}}{{#if containerConfig.kubernetes.kubernetesDeployment.imagePullPolicy}},\n-    imagePullPolicy:\"{{containerConfig.kubernetes.kubernetesDeployment.imagePullPolicy}}\"{{/if}}{{#if containerConfig.kubernetes.kubernetesDeployment.env}},\n+    imagePullPolicy:\"{{containerConfig.kubernetes.kubernetesDeployment.imagePullPolicy}}\"{{/if}}{{#if containerConfig.kubernetes.kubernetesDeployment.imagePullSecrets}},\n+    imagePullSecrets: [{{#containerConfig.kubernetes.kubernetesDeployment.imagePullSecrets}}\"{{.}}\"{{#unless @last}},{{/unless}}{{/containerConfig.kubernetes.kubernetesDeployment.imagePullSecrets}}]{{/if}}{{#if containerConfig.kubernetes.kubernetesDeployment.env}},\n     env:{{{containerConfig.kubernetes.kubernetesDeployment.env}}}{{/if}}{{#if containerConfig.kubernetes.kubernetesDeployment.buildImage}},\n-    buildImage:{{containerConfig.kubernetes.kubernetesDeployment.buildImage}}{{/if}}{{#if containerConfig.kubernetes.kubernetesDeployment.copyFiles.enable}},\n+    buildImage:{{containerConfig.kubernetes.kubernetesDeployment.buildImage}},", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQ0NTA2MQ=="}, "originalCommit": {"oid": "69f1feaaba88648db892a3b82ddf4e933ec681a7"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMzNTAyODUyOnYy", "diffSide": "RIGHT", "path": "components/micro-gateway-cli/src/main/resources/templates/listeners.mustache", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQwNDo1MToyMlrOFn9cAA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xMVQwNDo1ODo0N1rOFn9gVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQ0NTM3Ng==", "bodyText": "Any reason for not using default constants?", "url": "https://github.com/wso2/product-microgateway/pull/977#discussion_r377445376", "createdAt": "2020-02-11T04:51:22Z", "author": {"login": "praminda"}, "path": "components/micro-gateway-cli/src/main/resources/templates/listeners.mustache", "diffHunk": "@@ -23,22 +23,22 @@ http:ListenerConfiguration secureServiceEndpointConfiguration = { {{>http2}},\n {{>docker}}\n {{>secureKubernetesIngress}}\n {{>kubernetesServiceHttps}}\n-listener gateway:APIGatewaySecureListener apiSecureListener = new(gateway:DEFAULT_HTTPS_PORT, secureServiceEndpointConfiguration);\n+listener gateway:APIGatewaySecureListener apiSecureListener = new(9095, secureServiceEndpointConfiguration);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "69f1feaaba88648db892a3b82ddf4e933ec681a7"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQ0NjQ4NQ==", "bodyText": "Kubernetes annotations are read at the compile time. So it mandatory to have the port value during the compile time", "url": "https://github.com/wso2/product-microgateway/pull/977#discussion_r377446485", "createdAt": "2020-02-11T04:58:47Z", "author": {"login": "Rajith90"}, "path": "components/micro-gateway-cli/src/main/resources/templates/listeners.mustache", "diffHunk": "@@ -23,22 +23,22 @@ http:ListenerConfiguration secureServiceEndpointConfiguration = { {{>http2}},\n {{>docker}}\n {{>secureKubernetesIngress}}\n {{>kubernetesServiceHttps}}\n-listener gateway:APIGatewaySecureListener apiSecureListener = new(gateway:DEFAULT_HTTPS_PORT, secureServiceEndpointConfiguration);\n+listener gateway:APIGatewaySecureListener apiSecureListener = new(9095, secureServiceEndpointConfiguration);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQ0NTM3Ng=="}, "originalCommit": {"oid": "69f1feaaba88648db892a3b82ddf4e933ec681a7"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1283, "cost": 1, "resetAt": "2021-11-13T14:23:39Z"}}}