{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU5NzQ2NTM0", "number": 17791, "title": "#17772 adding validations for binary files", "bodyText": "With this change the properties allowedFileTypes and maxFileLength when added to a Binary field into a content type are being respects.\nmaxFileLength supports conventions such as 1kb, 1mb, 1gb\nallowedFileTypes supports mime type with wildcards such as text/, application/, or specific ones such as application/pdf, separated by commas.\nSo, When checkin a contentlet with a binary fields, if these validations are in placed, will be fired and throw an exception if not compliance.\nIn addition, a small change has been made in order to support hooks by osgi when called the validateContentlet inside the checkin.", "createdAt": "2020-01-06T22:47:38Z", "url": "https://github.com/dotCMS/core/pull/17791", "merged": true, "mergeCommit": {"oid": "d9f739996b2776c6e5236bb87c9fc3a9a6abcc51"}, "closed": true, "closedAt": "2020-01-10T15:34:19Z", "author": {"login": "jdotcms"}, "timelineItems": {"totalCount": 47, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb30JhvAH2gAyMzU5NzQ2NTM0OmIzYWQyZWFhMDFjYTgyOGQxOTgyM2M1MTU4MjQ5MzlhOGExZDQwZDI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb4_2SMAFqTM0MTIxNTM3MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b3ad2eaa01ca828d19823c515824939a8a1d40d2", "author": {"user": {"login": "jdotcms", "name": "Jonathan"}}, "url": "https://github.com/dotCMS/core/commit/b3ad2eaa01ca828d19823c515824939a8a1d40d2", "committedDate": "2020-01-06T22:46:14Z", "message": "#17772 adding validations for binary files"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d0600bd67191bf6da6113fe777e37d4290bed482", "author": {"user": {"login": "jdotcms", "name": "Jonathan"}}, "url": "https://github.com/dotCMS/core/commit/d0600bd67191bf6da6113fe777e37d4290bed482", "committedDate": "2020-01-07T19:35:50Z", "message": "#17772 unit test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "449a815d74b58e21a4a852ebe1b868d6cbf93883", "author": {"user": {"login": "jdotcms", "name": "Jonathan"}}, "url": "https://github.com/dotCMS/core/commit/449a815d74b58e21a4a852ebe1b868d6cbf93883", "committedDate": "2020-01-07T20:09:20Z", "message": "#17772 feedback"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cf019ca5368e2dc37f95fe2fd85a91286b531b57", "author": {"user": {"login": "jdotcms", "name": "Jonathan"}}, "url": "https://github.com/dotCMS/core/commit/cf019ca5368e2dc37f95fe2fd85a91286b531b57", "committedDate": "2020-01-07T20:09:37Z", "message": "#17772 feedback"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM5NTEzMTIx", "url": "https://github.com/dotCMS/core/pull/17791#pullrequestreview-339513121", "createdAt": "2020-01-07T21:18:14Z", "commit": {"oid": "cf019ca5368e2dc37f95fe2fd85a91286b531b57"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QyMToxODoxNFrOFbGEdg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wN1QyMToxODoxNFrOFbGEdg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzk1NTMxOA==", "bodyText": "possible npes?\nWhy Long instead of long", "url": "https://github.com/dotCMS/core/pull/17791#discussion_r363955318", "createdAt": "2020-01-07T21:18:14Z", "author": {"login": "wezell"}, "path": "dotCMS/src/main/java/com/dotcms/util/ConversionUtils.java", "diffHunk": "@@ -137,6 +137,39 @@ public static long toLong (final Object input, final Long defaultLong) {\n \t\treturn resultLong;\n \t}\n \n+\t/**\n+\t * Converts 1kb to 1024\n+\t * Converts 1mb to 1024 * 1024\n+\t * Converts 1gb to 1024 * 1024 * 1024\n+\t * @param humanDisplaySize\n+\t * @param defaultLong\n+\t * @return long\n+\t */\n+\tpublic static long toLongFromByteCountHumanDisplaySize (final String humanDisplaySize, final Long defaultLong) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cf019ca5368e2dc37f95fe2fd85a91286b531b57"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8cd75eb00f5335b17c4d9ae92a463bbb56163532", "author": {"user": {"login": "jdotcms", "name": "Jonathan"}}, "url": "https://github.com/dotCMS/core/commit/8cd75eb00f5335b17c4d9ae92a463bbb56163532", "committedDate": "2020-01-07T23:01:35Z", "message": "#17772 feedback 2"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM5NTYzMDc3", "url": "https://github.com/dotCMS/core/pull/17791#pullrequestreview-339563077", "createdAt": "2020-01-07T23:03:42Z", "commit": {"oid": "8cd75eb00f5335b17c4d9ae92a463bbb56163532"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "86e2be6c1e19ef7c0b4f0ddbfa9a5c2e2cd5b828", "author": {"user": {"login": "jdotcms", "name": "Jonathan"}}, "url": "https://github.com/dotCMS/core/commit/86e2be6c1e19ef7c0b4f0ddbfa9a5c2e2cd5b828", "committedDate": "2020-01-08T18:18:56Z", "message": "#17772 adding feedback and fixes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwNjMwMzY3", "url": "https://github.com/dotCMS/core/pull/17791#pullrequestreview-340630367", "createdAt": "2020-01-09T16:03:00Z", "commit": {"oid": "86e2be6c1e19ef7c0b4f0ddbfa9a5c2e2cd5b828"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxNjowMzowMVrOFb7AsA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxNjowMzowMVrOFb7AsA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDgyMjcwNA==", "bodyText": "I might be wrong but I think the test case validates are exactly the same that test_validateContentlet_wrong_size_expect_DotContentletValidationException . MAX_FILE_LENGTH and ALLOWED_FILE_TYPES have the same value of the previous test", "url": "https://github.com/dotCMS/core/pull/17791#discussion_r364822704", "createdAt": "2020-01-09T16:03:01Z", "author": {"login": "nollymar"}, "path": "dotCMS/src/integration-test/java/com/dotmarketing/portlets/contentlet/business/ContentletAPITest.java", "diffHunk": "@@ -4530,6 +4522,150 @@ public void contentOnlyWithExpireFieldTest() throws Exception{\n \t\tcontentTypeApi.delete(contentType);\n     }\n \n+    /**\n+     * This test will:\n+     * --- Create a content type called \"Nested\".\n+     * --- Add  1 Text field called Title\n+     * --- Add  1 Binary field called File\n+     * --- Set an application/* as a {@link com.dotcms.contenttype.model.field.BinaryField#ALLOWED_FILE_TYPES}\n+     * --- Upload a wrong file\n+     * --- expecteds DotContentletValidationException\n+     *\n+     */\n+    @Test (expected = DotContentletValidationException.class)\n+    public void test_validateContentlet_wrong_size_expect_DotContentletValidationException() throws Exception {\n+\n+        ContentType contentType = null;\n+        com.dotcms.contenttype.model.field.Field textField   = null;\n+        com.dotcms.contenttype.model.field.Field binaryField = null;\n+\n+        Contentlet contentletA = null;\n+\n+        // Create Content Type.\n+        contentType = ContentTypeBuilder.builder(BaseContentType.CONTENT.immutableClass())\n+                .description(\"Nested\" + System.currentTimeMillis())\n+                .host(defaultHost.getIdentifier())\n+                .name(\"Nested\" + System.currentTimeMillis())\n+                .owner(\"owner\")\n+                .variable(\"nested\" + System.currentTimeMillis())\n+                .build();\n+\n+        contentType = contentTypeAPI.save(contentType);\n+\n+        // Save Fields. 1. Text\n+        // Creating Text Field: Title.\n+        textField = ImmutableTextField.builder()\n+                .name(\"Title\")\n+                .variable(\"title\")\n+                .contentTypeId(contentType.id())\n+                .dataType(DataTypes.TEXT)\n+                .build();\n+\n+        textField = fieldAPI.save(textField, user);\n+\n+        // Save Fields. 1. Binary\n+        // Creating Text Field: File.\n+        binaryField = ImmutableBinaryField.builder()\n+                .name(\"file\")\n+                .variable(\"file\")\n+                .contentTypeId(contentType.id())\n+                .build();\n+\n+\n+        binaryField = fieldAPI.save(binaryField, user);\n+\n+        FieldVariable maxLength      = ImmutableFieldVariable.builder().key(BinaryField.MAX_FILE_LENGTH).value(\"10\").fieldId(binaryField.id()).build();\n+        FieldVariable allowFileTypes = ImmutableFieldVariable.builder().key(BinaryField.ALLOWED_FILE_TYPES).value(\"application/*, text/*\").fieldId(binaryField.id()).build();\n+        binaryField.constructFieldVariables(Arrays.asList(maxLength, allowFileTypes));\n+        fieldAPI.save(maxLength, user);\n+        fieldAPI.save(allowFileTypes, user);\n+\n+        final File tempTestFile = File\n+                .createTempFile(\"csvTest_\" + new Date().getTime(), \".txt\");\n+        FileUtils.writeStringToFile(tempTestFile, \"Test hi this a test longer than ten characters\");\n+\n+        contentletA = new Contentlet();\n+        contentletA.setStructureInode(contentType.inode());\n+        contentletA.setLanguageId(languageAPI.getDefaultLanguage().getId());\n+        contentletA.setStringProperty(textField.variable(), \"A\");\n+        contentletA.setBinary(binaryField, tempTestFile);\n+        contentletA.setIndexPolicy(IndexPolicy.FORCE);\n+        contentletA.setIndexPolicyDependencies(IndexPolicy.FORCE);\n+        contentletA = contentletAPI.checkin(contentletA, user, false);\n+    }\n+\n+    /**\n+     * This test will:\n+     * --- Create a content type called \"Nested\".\n+     * --- Add  1 Text field called Title\n+     * --- Add  1 Binary field called File\n+     * --- Set an application/* as a {@link com.dotcms.contenttype.model.field.BinaryField#ALLOWED_FILE_TYPES}\n+     * --- Upload a wrong file\n+     * --- expecteds DotContentletValidationException\n+     *\n+     */\n+    @Test (expected = DotContentletValidationException.class)\n+    public void test_validateContentlet_wrong_mime_type_expect_DotContentletValidationException() throws Exception {\n+\n+        ContentType contentType = null;\n+        com.dotcms.contenttype.model.field.Field textField   = null;\n+        com.dotcms.contenttype.model.field.Field binaryField = null;\n+\n+        Contentlet contentletA = null;\n+\n+            // Create Content Type.\n+            contentType = ContentTypeBuilder.builder(BaseContentType.CONTENT.immutableClass())\n+                    .description(\"Nested\" + System.currentTimeMillis())\n+                    .host(defaultHost.getIdentifier())\n+                    .name(\"Nested\" + System.currentTimeMillis())\n+                    .owner(\"owner\")\n+                    .variable(\"nested\" + System.currentTimeMillis())\n+                    .build();\n+\n+            contentType = contentTypeAPI.save(contentType);\n+\n+            // Save Fields. 1. Text\n+            // Creating Text Field: Title.\n+            textField = ImmutableTextField.builder()\n+                    .name(\"Title\")\n+                    .variable(\"title\")\n+                    .contentTypeId(contentType.id())\n+                    .dataType(DataTypes.TEXT)\n+                    .build();\n+\n+            textField = fieldAPI.save(textField, user);\n+\n+            // Save Fields. 1. Binary\n+            // Creating Text Field: File.\n+            binaryField = ImmutableBinaryField.builder()\n+                    .name(\"file\")\n+                    .variable(\"file\")\n+                    .contentTypeId(contentType.id())\n+                    .build();\n+\n+\n+            binaryField = fieldAPI.save(binaryField, user);\n+\n+            FieldVariable maxLength      = ImmutableFieldVariable.builder().key(BinaryField.MAX_FILE_LENGTH).value(\"10\").fieldId(binaryField.id()).build();\n+            FieldVariable allowFileTypes = ImmutableFieldVariable.builder().key(BinaryField.ALLOWED_FILE_TYPES).value(\"application/*\").fieldId(binaryField.id()).build();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86e2be6c1e19ef7c0b4f0ddbfa9a5c2e2cd5b828"}, "originalPosition": 146}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwNjM0NDg2", "url": "https://github.com/dotCMS/core/pull/17791#pullrequestreview-340634486", "createdAt": "2020-01-09T16:08:31Z", "commit": {"oid": "86e2be6c1e19ef7c0b4f0ddbfa9a5c2e2cd5b828"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxNjowODozMlrOFb7Mlg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxNjowODozMlrOFb7Mlg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDgyNTc1MA==", "bodyText": "there is a typo in contentlett", "url": "https://github.com/dotCMS/core/pull/17791#discussion_r364825750", "createdAt": "2020-01-09T16:08:32Z", "author": {"login": "nollymar"}, "path": "dotCMS/src/main/webapp/WEB-INF/messages/Language.properties", "diffHunk": "@@ -2813,7 +2816,7 @@ org.dotcms.frontend.content.submission.not.proper.permissions = You do not have\n org.dotcms.frontend.content.submission.previous = Previous\n org.dotcms.frontend.content.submission.remove = Remove\n org.dotcms.frontend.content.submission.save = Save\n-org.dotcms.frontend.content.submission.structure.dont.exists = The Content Type selected does not exist.\n+message.contentlett.submission.structure.dont.exists = The Content Type selected does not exist.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86e2be6c1e19ef7c0b4f0ddbfa9a5c2e2cd5b828"}, "originalPosition": 22}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwNjM1MjQ0", "url": "https://github.com/dotCMS/core/pull/17791#pullrequestreview-340635244", "createdAt": "2020-01-09T16:09:35Z", "commit": {"oid": "86e2be6c1e19ef7c0b4f0ddbfa9a5c2e2cd5b828"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxNjowOTozNVrOFb7O5Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxNjowOTozNVrOFb7O5Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDgyNjM0MQ==", "bodyText": "this test can be rewritten using data providers with all the different cases and just one assert", "url": "https://github.com/dotCMS/core/pull/17791#discussion_r364826341", "createdAt": "2020-01-09T16:09:35Z", "author": {"login": "nollymar"}, "path": "dotCMS/src/test/java/com/dotcms/util/ConversionUtilsTest.java", "diffHunk": "@@ -13,6 +13,40 @@\n  */\n public class ConversionUtilsTest extends UnitTestBase {\n \n+    @Test\n+    public void toLongFromByteCountHumanDisplaySizeTest () {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86e2be6c1e19ef7c0b4f0ddbfa9a5c2e2cd5b828"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwNjM1OTcw", "url": "https://github.com/dotCMS/core/pull/17791#pullrequestreview-340635970", "createdAt": "2020-01-09T16:10:33Z", "commit": {"oid": "86e2be6c1e19ef7c0b4f0ddbfa9a5c2e2cd5b828"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxNjoxMDozM1rOFb7Q8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxNjoxMDozM1rOFb7Q8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDgyNjg2NA==", "bodyText": "there is a typo in expecteds", "url": "https://github.com/dotCMS/core/pull/17791#discussion_r364826864", "createdAt": "2020-01-09T16:10:33Z", "author": {"login": "nollymar"}, "path": "dotCMS/src/integration-test/java/com/dotmarketing/portlets/contentlet/business/ContentletAPITest.java", "diffHunk": "@@ -4530,6 +4522,150 @@ public void contentOnlyWithExpireFieldTest() throws Exception{\n \t\tcontentTypeApi.delete(contentType);\n     }\n \n+    /**\n+     * This test will:\n+     * --- Create a content type called \"Nested\".\n+     * --- Add  1 Text field called Title\n+     * --- Add  1 Binary field called File\n+     * --- Set an application/* as a {@link com.dotcms.contenttype.model.field.BinaryField#ALLOWED_FILE_TYPES}\n+     * --- Upload a wrong file\n+     * --- expecteds DotContentletValidationException\n+     *\n+     */\n+    @Test (expected = DotContentletValidationException.class)\n+    public void test_validateContentlet_wrong_size_expect_DotContentletValidationException() throws Exception {\n+\n+        ContentType contentType = null;\n+        com.dotcms.contenttype.model.field.Field textField   = null;\n+        com.dotcms.contenttype.model.field.Field binaryField = null;\n+\n+        Contentlet contentletA = null;\n+\n+        // Create Content Type.\n+        contentType = ContentTypeBuilder.builder(BaseContentType.CONTENT.immutableClass())\n+                .description(\"Nested\" + System.currentTimeMillis())\n+                .host(defaultHost.getIdentifier())\n+                .name(\"Nested\" + System.currentTimeMillis())\n+                .owner(\"owner\")\n+                .variable(\"nested\" + System.currentTimeMillis())\n+                .build();\n+\n+        contentType = contentTypeAPI.save(contentType);\n+\n+        // Save Fields. 1. Text\n+        // Creating Text Field: Title.\n+        textField = ImmutableTextField.builder()\n+                .name(\"Title\")\n+                .variable(\"title\")\n+                .contentTypeId(contentType.id())\n+                .dataType(DataTypes.TEXT)\n+                .build();\n+\n+        textField = fieldAPI.save(textField, user);\n+\n+        // Save Fields. 1. Binary\n+        // Creating Text Field: File.\n+        binaryField = ImmutableBinaryField.builder()\n+                .name(\"file\")\n+                .variable(\"file\")\n+                .contentTypeId(contentType.id())\n+                .build();\n+\n+\n+        binaryField = fieldAPI.save(binaryField, user);\n+\n+        FieldVariable maxLength      = ImmutableFieldVariable.builder().key(BinaryField.MAX_FILE_LENGTH).value(\"10\").fieldId(binaryField.id()).build();\n+        FieldVariable allowFileTypes = ImmutableFieldVariable.builder().key(BinaryField.ALLOWED_FILE_TYPES).value(\"application/*, text/*\").fieldId(binaryField.id()).build();\n+        binaryField.constructFieldVariables(Arrays.asList(maxLength, allowFileTypes));\n+        fieldAPI.save(maxLength, user);\n+        fieldAPI.save(allowFileTypes, user);\n+\n+        final File tempTestFile = File\n+                .createTempFile(\"csvTest_\" + new Date().getTime(), \".txt\");\n+        FileUtils.writeStringToFile(tempTestFile, \"Test hi this a test longer than ten characters\");\n+\n+        contentletA = new Contentlet();\n+        contentletA.setStructureInode(contentType.inode());\n+        contentletA.setLanguageId(languageAPI.getDefaultLanguage().getId());\n+        contentletA.setStringProperty(textField.variable(), \"A\");\n+        contentletA.setBinary(binaryField, tempTestFile);\n+        contentletA.setIndexPolicy(IndexPolicy.FORCE);\n+        contentletA.setIndexPolicyDependencies(IndexPolicy.FORCE);\n+        contentletA = contentletAPI.checkin(contentletA, user, false);\n+    }\n+\n+    /**\n+     * This test will:\n+     * --- Create a content type called \"Nested\".\n+     * --- Add  1 Text field called Title\n+     * --- Add  1 Binary field called File\n+     * --- Set an application/* as a {@link com.dotcms.contenttype.model.field.BinaryField#ALLOWED_FILE_TYPES}\n+     * --- Upload a wrong file\n+     * --- expecteds DotContentletValidationException", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86e2be6c1e19ef7c0b4f0ddbfa9a5c2e2cd5b828"}, "originalPosition": 100}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwNjM2MDU3", "url": "https://github.com/dotCMS/core/pull/17791#pullrequestreview-340636057", "createdAt": "2020-01-09T16:10:40Z", "commit": {"oid": "86e2be6c1e19ef7c0b4f0ddbfa9a5c2e2cd5b828"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxNjoxMDo0MFrOFb7RQw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxNjoxMDo0MFrOFb7RQw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDgyNjk0Nw==", "bodyText": "there is a typo in expecteds", "url": "https://github.com/dotCMS/core/pull/17791#discussion_r364826947", "createdAt": "2020-01-09T16:10:40Z", "author": {"login": "nollymar"}, "path": "dotCMS/src/integration-test/java/com/dotmarketing/portlets/contentlet/business/ContentletAPITest.java", "diffHunk": "@@ -4530,6 +4522,150 @@ public void contentOnlyWithExpireFieldTest() throws Exception{\n \t\tcontentTypeApi.delete(contentType);\n     }\n \n+    /**\n+     * This test will:\n+     * --- Create a content type called \"Nested\".\n+     * --- Add  1 Text field called Title\n+     * --- Add  1 Binary field called File\n+     * --- Set an application/* as a {@link com.dotcms.contenttype.model.field.BinaryField#ALLOWED_FILE_TYPES}\n+     * --- Upload a wrong file\n+     * --- expecteds DotContentletValidationException", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86e2be6c1e19ef7c0b4f0ddbfa9a5c2e2cd5b828"}, "originalPosition": 28}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwNjI1NzAz", "url": "https://github.com/dotCMS/core/pull/17791#pullrequestreview-340625703", "createdAt": "2020-01-09T15:57:05Z", "commit": {"oid": "86e2be6c1e19ef7c0b4f0ddbfa9a5c2e2cd5b828"}, "state": "COMMENTED", "comments": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxNTo1NzowNlrOFb6zKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxNjoxMzoyOFrOFb7XNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDgxOTI0Mg==", "bodyText": "I think is better idea move this logic to a private method something like: \"validateUniqueField\", I think is better than put a comment", "url": "https://github.com/dotCMS/core/pull/17791#discussion_r364819242", "createdAt": "2020-01-09T15:57:06Z", "author": {"login": "freddyucv"}, "path": "dotCMS/src/main/java/com/dotcms/content/elasticsearch/business/ESContentletAPIImpl.java", "diffHunk": "@@ -6215,6 +6114,8 @@ else if(field.getFieldType().equals(Field.FieldType.DATE_TIME.toString())){\n                     }\n                 }\n             }\n+\n+            // validate unique", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86e2be6c1e19ef7c0b4f0ddbfa9a5c2e2cd5b828"}, "originalPosition": 333}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDgxOTUwOA==", "bodyText": "same before", "url": "https://github.com/dotCMS/core/pull/17791#discussion_r364819508", "createdAt": "2020-01-09T15:57:33Z", "author": {"login": "freddyucv"}, "path": "dotCMS/src/main/java/com/dotcms/content/elasticsearch/business/ESContentletAPIImpl.java", "diffHunk": "@@ -6284,11 +6185,13 @@ else if(field.getFieldType().equals(Field.FieldType.DATE_TIME.toString())){\n                     Logger.warn(this,\"Unable to get contentlets for Content Type: \" + contentlet.getStructure().getName(), e);\n                 }\n             }\n+\n+            // validate text", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86e2be6c1e19ef7c0b4f0ddbfa9a5c2e2cd5b828"}, "originalPosition": 353}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDgxOTYzNQ==", "bodyText": "same before", "url": "https://github.com/dotCMS/core/pull/17791#discussion_r364819635", "createdAt": "2020-01-09T15:57:45Z", "author": {"login": "freddyucv"}, "path": "dotCMS/src/main/java/com/dotcms/content/elasticsearch/business/ESContentletAPIImpl.java", "diffHunk": "@@ -6302,11 +6205,13 @@ else if(field.getFieldType().equals(Field.FieldType.DATE_TIME.toString())){\n                     continue;\n                 }\n             }\n+\n+            // validate regex", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86e2be6c1e19ef7c0b4f0ddbfa9a5c2e2cd5b828"}, "originalPosition": 369}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDgxOTcxMg==", "bodyText": "same", "url": "https://github.com/dotCMS/core/pull/17791#discussion_r364819712", "createdAt": "2020-01-09T15:57:52Z", "author": {"login": "freddyucv"}, "path": "dotCMS/src/main/java/com/dotcms/content/elasticsearch/business/ESContentletAPIImpl.java", "diffHunk": "@@ -6329,12 +6234,216 @@ else if(field.getFieldType().equals(Field.FieldType.DATE_TIME.toString())){\n                     }\n                 }\n             }\n+\n+            // validate binary", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86e2be6c1e19ef7c0b4f0ddbfa9a5c2e2cd5b828"}, "originalPosition": 397}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDgyMDM4MA==", "bodyText": "maybe it is good idea move this logic to a Util class", "url": "https://github.com/dotCMS/core/pull/17791#discussion_r364820380", "createdAt": "2020-01-09T15:58:57Z", "author": {"login": "freddyucv"}, "path": "dotCMS/src/main/java/com/dotcms/content/elasticsearch/business/ESContentletAPIImpl.java", "diffHunk": "@@ -6329,12 +6234,216 @@ else if(field.getFieldType().equals(Field.FieldType.DATE_TIME.toString())){\n                     }\n                 }\n             }\n+\n+            // validate binary\n+            if(isFieldTypeBinary(field)) {\n+                this.validateBinary (File.class.cast(fieldValue), field.getFieldName(), field, contentType);\n+            }\n+\n         }\n         if(hasError){\n             throw cve;\n         }\n     }\n \n+    private String getMimeType (final File binary) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86e2be6c1e19ef7c0b4f0ddbfa9a5c2e2cd5b828"}, "originalPosition": 408}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDgyMTg0MQ==", "bodyText": "maybe we can move all this validateXXX method for a Util class or create a Validator class for each field type", "url": "https://github.com/dotCMS/core/pull/17791#discussion_r364821841", "createdAt": "2020-01-09T16:01:29Z", "author": {"login": "freddyucv"}, "path": "dotCMS/src/main/java/com/dotcms/content/elasticsearch/business/ESContentletAPIImpl.java", "diffHunk": "@@ -6329,12 +6234,216 @@ else if(field.getFieldType().equals(Field.FieldType.DATE_TIME.toString())){\n                     }\n                 }\n             }\n+\n+            // validate binary\n+            if(isFieldTypeBinary(field)) {\n+                this.validateBinary (File.class.cast(fieldValue), field.getFieldName(), field, contentType);\n+            }\n+\n         }\n         if(hasError){\n             throw cve;\n         }\n     }\n \n+    private String getMimeType (final File binary) {\n+\n+        final Path path = binary.toPath();\n+        String mimeType = Sneaky.sneak(() -> Files.probeContentType(path));\n+\n+        if  (!UtilMethods.isSet(mimeType)) {\n+\n+            mimeType = Config.CONTEXT.getMimeType(binary.getAbsolutePath());\n+\n+            if( !UtilMethods.isSet(mimeType)){\n+                try {\n+                    mimeType = new TikaUtils().detect(binary);\n+                } catch(Exception e) {\n+                    Logger.warn(this.getClass(), e.getMessage() +  e.getStackTrace()[0]);\n+                }\n+            }\n+        }\n+\n+        return mimeType;\n+    }\n+\n+    private void validateBinary(final File binary, final String fieldName, final Field legacyField, final ContentType contentType) {\n+\n+        final Map<String, com.dotcms.contenttype.model.field.Field> fieldMap = contentType.fieldMap();\n+\n+        if (fieldMap.containsKey(fieldName) && null != binary) {\n+\n+            final List<FieldVariable> fieldVariables = fieldMap.get(fieldName).fieldVariables();\n+\n+            if (UtilMethods.isSet(fieldVariables)) {\n+\n+                for (final FieldVariable fieldVariable : fieldVariables) {\n+\n+                    final String keyField = fieldVariable.key();\n+\n+                    if (BinaryField.ALLOWED_FILE_TYPES.equalsIgnoreCase(keyField)) {\n+\n+                        final String binaryMimeType   = this.getMimeType(binary);\n+                        final String allowedFileTypes = fieldVariable.value();\n+                        if (UtilMethods.isSet(allowedFileTypes) && UtilMethods.isSet(binaryMimeType)) {\n+\n+                            boolean allowed = false;\n+                            final MimeType fileMimeType = Sneaky.sneak(() -> new MimeType(binaryMimeType));\n+                            final String[] allowedFileTypeArray = StringUtil.split(allowedFileTypes);\n+                            for (final String allowFileType : allowedFileTypeArray) {\n+\n+                                final MimeType mimeType = Sneaky.sneak(() -> new MimeType(allowFileType));\n+                                allowed |= mimeType.match(fileMimeType);\n+                            }\n+\n+                            // if the extension of the file is not supported\n+                            if (!allowed) {\n+\n+                                final DotContentletValidationException cve = new DotContentletValidationException(\"message.contentlet.binary.type.notallowed\");\n+                                Logger.warn(this, \"Name of Binary field [\" + fieldName + \"] has an not allowed type: \" + binaryMimeType);\n+                                cve.addBadTypeField(legacyField);\n+                                throw cve;\n+                            }\n+                        }\n+                    }\n+\n+                    if (BinaryField.MAX_FILE_LENGTH.equalsIgnoreCase(keyField)) {\n+\n+                        final long fileLength        = binary.length();\n+                        final String maxLengthString = fieldVariable.value();\n+                        final long maxLength         = ConversionUtils.toLongFromByteCountHumanDisplaySize(maxLengthString, -1l);\n+\n+                        if (-1 != maxLength && // if the user sets a valid value\n+                                fileLength > maxLength) {\n+\n+                            final DotContentletValidationException cve = new DotContentletValidationException(\"message.contentlet.binary.invalidlength\");\n+                            Logger.warn(this, \"Name of Binary field [\" + fieldName + \"] has a length: \" + fileLength\n+                                    + \" but the max length is: \" + maxLength);\n+                            cve.addBadTypeField(legacyField);\n+                            throw cve;\n+                        }\n+                    }\n+                }\n+            }\n+        }\n+    } // validateBinary.\n+\n+    private void validateHtmlPage(Contentlet contentlet, String contentIdentifier, ContentType contentType) {\n+        if(contentlet.getHost()!=null && contentlet.getHost().equals(Host.SYSTEM_HOST) && (!UtilMethods.isSet(contentlet.getFolder()) || contentlet.getFolder().equals(FolderAPI.SYSTEM_FOLDER))){\n+            final DotContentletValidationException cve = new FileAssetValidationException(\"message.contentlet.fileasset.invalid.hostfolder\");\n+            Logger.warn(this, \"HTML Page [\" + contentIdentifier + \"] cannot be created directly under System \" +\n+                    \"Host\");\n+            cve.addBadTypeField(new LegacyFieldTransformer(contentType.fieldMap().get(FileAssetAPI\n+                    .HOST_FOLDER_FIELD)).asOldField());\n+            throw cve;\n+        }\n+        try{\n+            final Host site = APILocator.getHostAPI().find(contentlet.getHost(), APILocator.getUserAPI().getSystemUser(), false);\n+            Folder folder = null;\n+            if(UtilMethods.isSet(contentlet.getFolder())){\n+                folder=APILocator.getFolderAPI().find(contentlet.getFolder(), APILocator.getUserAPI().getSystemUser(), false);\n+            }\n+            else{\n+                folder=APILocator.getFolderAPI().findSystemFolder();\n+            }\n+\n+            //Get the URL from Identifier if it is not in Contentlet\n+            String url = contentlet.getStringProperty(HTMLPageAssetAPI.URL_FIELD);\n+\n+            if(!UtilMethods.isSet(url)){\n+\n+                if (InodeUtils.isSet(contentlet.getVersionId()) || InodeUtils.isSet(contentlet.getInode())) {\n+                    Identifier identifier = APILocator.getIdentifierAPI().find(contentlet);\n+                    if (UtilMethods.isSet(identifier) && UtilMethods.isSet(identifier.getAssetName())) {\n+\n+                        url = identifier.getAssetName();\n+                    }\n+                }\n+            }\n+\n+            if(UtilMethods.isSet(url)){\n+                contentlet.setProperty(HTMLPageAssetAPI.URL_FIELD, url);\n+                Identifier folderId = APILocator.getIdentifierAPI().find(folder);\n+                String path = folder.getInode().equals(FolderAPI.SYSTEM_FOLDER)?\"/\"+url:folderId.getPath()+url;\n+                Identifier htmlpage = APILocator.getIdentifierAPI().find(site, path);\n+                if(htmlpage!=null && InodeUtils.isSet(htmlpage.getId()) && !htmlpage.getId().equals(contentlet.getIdentifier()) ){\n+                    final String errorMsg = \"Page URL [\" + path + \"] already exists with content ID [\" + htmlpage\n+                            .getId() + \"]\";\n+                    final DotContentletValidationException cve = new FileAssetValidationException(errorMsg);\n+                    Logger.warn(this, errorMsg);\n+                    cve.addBadTypeField(new LegacyFieldTransformer(contentType.fieldMap().get(HTMLPageAssetAPI\n+                            .URL_FIELD)).asOldField());\n+                    throw cve;\n+                }\n+                UtilMethods.validateFileName(url);\n+            }\n+\n+        } catch (final DotDataException | DotSecurityException | IllegalArgumentException e) {\n+            final String errorMsg = \"Contentlet [\" + contentIdentifier + \"] has an invalid URL: \" + contentlet\n+                    .getStringProperty(HTMLPageAssetAPI.URL_FIELD);\n+            final DotContentletValidationException cve = new FileAssetValidationException(errorMsg);\n+            Logger.warn(this, errorMsg);\n+            cve.addBadTypeField(new LegacyFieldTransformer(contentType.fieldMap().get(HTMLPageAssetAPI\n+                    .URL_FIELD)).asOldField());\n+            throw cve;\n+        }\n+    }\n+\n+    private void validateFileAsset(final Contentlet contentlet, final String contentIdentifier, final ContentType contentType) {\n+\n+        if(contentlet.getHost()!=null && contentlet.getHost().equals(Host.SYSTEM_HOST) && (!UtilMethods.isSet(contentlet.getFolder()) || contentlet.getFolder().equals(FolderAPI.SYSTEM_FOLDER))){\n+            final DotContentletValidationException cve = new FileAssetValidationException(\"message.contentlet.fileasset.invalid.hostfolder\");\n+            Logger.warn(this, \"File Asset [\" + contentIdentifier + \"] cannot be created directly under System \" +\n+                    \"Host\");\n+            cve.addBadTypeField(new LegacyFieldTransformer(contentType.fieldMap().get(FileAssetAPI\n+                    .HOST_FOLDER_FIELD)).asOldField());\n+            throw cve;\n+        }\n+\n+        //Enforce validation only if the file name isn't the same we've already got\n+        if(hasNewIncomingFile(contentlet)){\n+            boolean fileNameExists = false;\n+            try {\n+                final Host site = APILocator.getHostAPI ().find(contentlet.getHost(), APILocator.getUserAPI().getSystemUser(), false);\n+                final Folder folder = UtilMethods.isSet(contentlet.getFolder())?\n+                        APILocator.getFolderAPI().find(contentlet.getFolder(), APILocator.getUserAPI().getSystemUser(), false):\n+                        APILocator.getFolderAPI().findSystemFolder();\n+\n+                String fileName = contentlet.getBinary(FileAssetAPI.BINARY_FIELD) != null ? contentlet.getBinary(FileAssetAPI.BINARY_FIELD).getName() : StringPool.BLANK;\n+                if(UtilMethods.isSet(contentlet.getStringProperty(\"fileName\"))){\n+                    fileName = contentlet.getStringProperty(\"fileName\");\n+                }\n+                if(UtilMethods.isSet(fileName)){\n+                    fileNameExists = APILocator.getFileAssetAPI().fileNameExists(site, folder, fileName, contentlet.getIdentifier());\n+                    if(!APILocator.getFolderAPI().matchFilter(folder, fileName)) {\n+                        final DotContentletValidationException cve = new FileAssetValidationException(\"message.file_asset.error.filename.filters\");\n+                        Logger.warn(this, \"File Asset [\" + contentIdentifier + \"] does not match specified folder\" +\n+                                \" file filters\");\n+                        cve.addBadTypeField(new LegacyFieldTransformer(contentType.fieldMap().get(FileAssetAPI\n+                                .HOST_FOLDER_FIELD)).asOldField());\n+                        throw cve;\n+                    }\n+                }\n+\n+            } catch (final Exception e) {\n+                if(e instanceof FileAssetValidationException) {\n+                    throw (FileAssetValidationException) e;\n+                }\n+                final String errorMsg = \"Unable to validate field: \" + FileAssetAPI.BINARY_FIELD + \" in \" +\n+                        \"contentlet [\" + contentIdentifier + \"]\";\n+                Logger.warn(this, errorMsg);\n+                throw new FileAssetValidationException(errorMsg, e);\n+            }\n+            if(fileNameExists){\n+                final DotContentletValidationException cve = new FileAssetValidationException(\"message.contentlet.fileasset.filename.already.exists\");\n+                Logger.warn(this, \"Name of File Asset [\" + contentIdentifier + \"] already exists\");\n+                cve.addBadTypeField(new LegacyFieldTransformer(contentType.fieldMap().get(FileAssetAPI\n+                        .HOST_FOLDER_FIELD)).asOldField());\n+                throw cve;\n+            }\n+        }\n+    }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86e2be6c1e19ef7c0b4f0ddbfa9a5c2e2cd5b828"}, "originalPosition": 605}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDgyNTM1MA==", "bodyText": "test?", "url": "https://github.com/dotCMS/core/pull/17791#discussion_r364825350", "createdAt": "2020-01-09T16:07:48Z", "author": {"login": "freddyucv"}, "path": "dotCMS/src/main/java/com/dotcms/rest/api/v1/temp/RemoteUrlForm.java", "diffHunk": "@@ -13,18 +14,19 @@\n \n   public RemoteUrlForm(@JsonProperty(\"remoteUrl\") final String remoteUrl, @JsonProperty(\"fileName\") final String fileName,\n       @JsonProperty(\"accessKey\") final String accessKey) {\n-    this(remoteUrl, fileName, accessKey, null,-1L);\n+    this(remoteUrl, fileName, accessKey, null,\"-1\");\n   }\n \n   @JsonCreator\n   public RemoteUrlForm(@JsonProperty(\"remoteUrl\") final String remoteUrl, @JsonProperty(\"fileName\") final String fileName,\n-      @JsonProperty(\"accessKey\") final String accessKey, @JsonProperty(\"urlTimeoutSeconds\") final Integer urlTimeout, @JsonProperty(TempFileResource.MAX_FILE_LENGTH_PARAM)final Long maxFileLength) {\n+      @JsonProperty(\"accessKey\") final String accessKey, @JsonProperty(\"urlTimeoutSeconds\") final Integer urlTimeout,\n+                       @JsonProperty(TempFileResource.MAX_FILE_LENGTH_PARAM)final String maxFileLength) {\n     super();\n     this.remoteUrl = remoteUrl;\n     this.fileName = fileName;\n     this.accessKey = accessKey;\n     this.urlTimeoutSeconds = urlTimeout != null && urlTimeout < 600 ? urlTimeout : 30;\n-    this.maxFileLength=(maxFileLength==null)?-1L : maxFileLength;\n+    this.maxFileLength=(maxFileLength==null)?-1L : ConversionUtils.toLongFromByteCountHumanDisplaySize(maxFileLength, -1l );", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86e2be6c1e19ef7c0b4f0ddbfa9a5c2e2cd5b828"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDgyODQ2OA==", "bodyText": "not explain how the parameters work", "url": "https://github.com/dotCMS/core/pull/17791#discussion_r364828468", "createdAt": "2020-01-09T16:13:28Z", "author": {"login": "freddyucv"}, "path": "dotCMS/src/main/java/com/dotcms/util/ConversionUtils.java", "diffHunk": "@@ -137,6 +137,39 @@ public static long toLong (final Object input, final Long defaultLong) {\n \t\treturn resultLong;\n \t}\n \n+\t/**\n+\t * Converts 1kb to 1024\n+\t * Converts 1mb to 1024 * 1024\n+\t * Converts 1gb to 1024 * 1024 * 1024\n+\t * @param humanDisplaySize\n+\t * @param defaultLong", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86e2be6c1e19ef7c0b4f0ddbfa9a5c2e2cd5b828"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwNjU1OTI1", "url": "https://github.com/dotCMS/core/pull/17791#pullrequestreview-340655925", "createdAt": "2020-01-09T16:38:00Z", "commit": {"oid": "86e2be6c1e19ef7c0b4f0ddbfa9a5c2e2cd5b828"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwNjU3NzE5", "url": "https://github.com/dotCMS/core/pull/17791#pullrequestreview-340657719", "createdAt": "2020-01-09T16:40:29Z", "commit": {"oid": "86e2be6c1e19ef7c0b4f0ddbfa9a5c2e2cd5b828"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxNjo0MDozMFrOFb8RmQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxNjo0MDozMFrOFb8RmQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDg0MzQxNw==", "bodyText": "good", "url": "https://github.com/dotCMS/core/pull/17791#discussion_r364843417", "createdAt": "2020-01-09T16:40:30Z", "author": {"login": "dsilvam"}, "path": "dotCMS/src/main/java/com/dotcms/content/elasticsearch/business/ESContentletAPIImpl.java", "diffHunk": "@@ -5916,166 +5920,60 @@ public void validateContentlet(final Contentlet contentlet, final List<Category>\n         final ContentType contentType = Sneaky.sneak(() -> APILocator.getContentTypeAPI(APILocator.systemUser()).find\n                 (contentTypeId));\n         if (BaseContentType.FILEASSET.getType() == contentType.baseType().getType()) {\n-            if(contentlet.getHost()!=null && contentlet.getHost().equals(Host.SYSTEM_HOST) && (!UtilMethods.isSet(contentlet.getFolder()) || contentlet.getFolder().equals(FolderAPI.SYSTEM_FOLDER))){\n-                final DotContentletValidationException cve = new FileAssetValidationException(\"message.contentlet.fileasset.invalid.hostfolder\");\n-                Logger.warn(this, \"File Asset [\" + contentIdentifier + \"] cannot be created directly under System \" +\n-                        \"Host\");\n-                cve.addBadTypeField(new LegacyFieldTransformer(contentType.fieldMap().get(FileAssetAPI\n-                        .HOST_FOLDER_FIELD)).asOldField());\n-                throw cve;\n-            }\n-\n-            //Enforce validation only if the file name isn't the same we've already got\n-            if(hasNewIncomingFile(contentlet)){\n-                boolean fileNameExists = false;\n-                try {\n-                    final Host site = APILocator.getHostAPI ().find(contentlet.getHost(), APILocator.getUserAPI().getSystemUser(), false);\n-                    final Folder folder = UtilMethods.isSet(contentlet.getFolder())?\n-                            APILocator.getFolderAPI().find(contentlet.getFolder(), APILocator.getUserAPI().getSystemUser(), false):\n-                            APILocator.getFolderAPI().findSystemFolder();\n-\n-                    String fileName = contentlet.getBinary(FileAssetAPI.BINARY_FIELD) != null ? contentlet.getBinary(FileAssetAPI.BINARY_FIELD).getName() : StringPool.BLANK;\n-                    if(UtilMethods.isSet(contentlet.getStringProperty(\"fileName\"))){\n-                        fileName = contentlet.getStringProperty(\"fileName\");\n-                    }\n-                    if(UtilMethods.isSet(fileName)){\n-                        fileNameExists = APILocator.getFileAssetAPI().fileNameExists(site, folder, fileName, contentlet.getIdentifier());\n-                        if(!APILocator.getFolderAPI().matchFilter(folder, fileName)) {\n-                            final DotContentletValidationException cve = new FileAssetValidationException(\"message.file_asset.error.filename.filters\");\n-                            Logger.warn(this, \"File Asset [\" + contentIdentifier + \"] does not match specified folder\" +\n-                                    \" file filters\");\n-                            cve.addBadTypeField(new LegacyFieldTransformer(contentType.fieldMap().get(FileAssetAPI\n-                                    .HOST_FOLDER_FIELD)).asOldField());\n-                            throw cve;\n-                        }\n-                    }\n-\n-                } catch (final Exception e) {\n-                    if(e instanceof FileAssetValidationException) {\n-                        throw (FileAssetValidationException) e;\n-                    }\n-                    final String errorMsg = \"Unable to validate field: \" + FileAssetAPI.BINARY_FIELD + \" in \" +\n-                            \"contentlet [\" + contentIdentifier + \"]\";\n-                    Logger.warn(this, errorMsg);\n-                    throw new FileAssetValidationException(errorMsg, e);\n-                }\n-                if(fileNameExists){\n-                    final DotContentletValidationException cve = new FileAssetValidationException(\"message.contentlet.fileasset.filename.already.exists\");\n-                    Logger.warn(this, \"Name of File Asset [\" + contentIdentifier + \"] already exists\");\n-                    cve.addBadTypeField(new LegacyFieldTransformer(contentType.fieldMap().get(FileAssetAPI\n-                            .HOST_FOLDER_FIELD)).asOldField());\n-                    throw cve;\n-                }\n-            }\n+            this.validateFileAsset(contentlet, contentIdentifier, contentType);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86e2be6c1e19ef7c0b4f0ddbfa9a5c2e2cd5b828"}, "originalPosition": 127}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwNjU3ODEx", "url": "https://github.com/dotCMS/core/pull/17791#pullrequestreview-340657811", "createdAt": "2020-01-09T16:40:37Z", "commit": {"oid": "86e2be6c1e19ef7c0b4f0ddbfa9a5c2e2cd5b828"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxNjo0MDozN1rOFb8R2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxNjo0MDozN1rOFb8R2Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDg0MzQ4MQ==", "bodyText": "good", "url": "https://github.com/dotCMS/core/pull/17791#discussion_r364843481", "createdAt": "2020-01-09T16:40:37Z", "author": {"login": "dsilvam"}, "path": "dotCMS/src/main/java/com/dotcms/content/elasticsearch/business/ESContentletAPIImpl.java", "diffHunk": "@@ -5916,166 +5920,60 @@ public void validateContentlet(final Contentlet contentlet, final List<Category>\n         final ContentType contentType = Sneaky.sneak(() -> APILocator.getContentTypeAPI(APILocator.systemUser()).find\n                 (contentTypeId));\n         if (BaseContentType.FILEASSET.getType() == contentType.baseType().getType()) {\n-            if(contentlet.getHost()!=null && contentlet.getHost().equals(Host.SYSTEM_HOST) && (!UtilMethods.isSet(contentlet.getFolder()) || contentlet.getFolder().equals(FolderAPI.SYSTEM_FOLDER))){\n-                final DotContentletValidationException cve = new FileAssetValidationException(\"message.contentlet.fileasset.invalid.hostfolder\");\n-                Logger.warn(this, \"File Asset [\" + contentIdentifier + \"] cannot be created directly under System \" +\n-                        \"Host\");\n-                cve.addBadTypeField(new LegacyFieldTransformer(contentType.fieldMap().get(FileAssetAPI\n-                        .HOST_FOLDER_FIELD)).asOldField());\n-                throw cve;\n-            }\n-\n-            //Enforce validation only if the file name isn't the same we've already got\n-            if(hasNewIncomingFile(contentlet)){\n-                boolean fileNameExists = false;\n-                try {\n-                    final Host site = APILocator.getHostAPI ().find(contentlet.getHost(), APILocator.getUserAPI().getSystemUser(), false);\n-                    final Folder folder = UtilMethods.isSet(contentlet.getFolder())?\n-                            APILocator.getFolderAPI().find(contentlet.getFolder(), APILocator.getUserAPI().getSystemUser(), false):\n-                            APILocator.getFolderAPI().findSystemFolder();\n-\n-                    String fileName = contentlet.getBinary(FileAssetAPI.BINARY_FIELD) != null ? contentlet.getBinary(FileAssetAPI.BINARY_FIELD).getName() : StringPool.BLANK;\n-                    if(UtilMethods.isSet(contentlet.getStringProperty(\"fileName\"))){\n-                        fileName = contentlet.getStringProperty(\"fileName\");\n-                    }\n-                    if(UtilMethods.isSet(fileName)){\n-                        fileNameExists = APILocator.getFileAssetAPI().fileNameExists(site, folder, fileName, contentlet.getIdentifier());\n-                        if(!APILocator.getFolderAPI().matchFilter(folder, fileName)) {\n-                            final DotContentletValidationException cve = new FileAssetValidationException(\"message.file_asset.error.filename.filters\");\n-                            Logger.warn(this, \"File Asset [\" + contentIdentifier + \"] does not match specified folder\" +\n-                                    \" file filters\");\n-                            cve.addBadTypeField(new LegacyFieldTransformer(contentType.fieldMap().get(FileAssetAPI\n-                                    .HOST_FOLDER_FIELD)).asOldField());\n-                            throw cve;\n-                        }\n-                    }\n-\n-                } catch (final Exception e) {\n-                    if(e instanceof FileAssetValidationException) {\n-                        throw (FileAssetValidationException) e;\n-                    }\n-                    final String errorMsg = \"Unable to validate field: \" + FileAssetAPI.BINARY_FIELD + \" in \" +\n-                            \"contentlet [\" + contentIdentifier + \"]\";\n-                    Logger.warn(this, errorMsg);\n-                    throw new FileAssetValidationException(errorMsg, e);\n-                }\n-                if(fileNameExists){\n-                    final DotContentletValidationException cve = new FileAssetValidationException(\"message.contentlet.fileasset.filename.already.exists\");\n-                    Logger.warn(this, \"Name of File Asset [\" + contentIdentifier + \"] already exists\");\n-                    cve.addBadTypeField(new LegacyFieldTransformer(contentType.fieldMap().get(FileAssetAPI\n-                            .HOST_FOLDER_FIELD)).asOldField());\n-                    throw cve;\n-                }\n-            }\n+            this.validateFileAsset(contentlet, contentIdentifier, contentType);\n         }\n \n         if (BaseContentType.HTMLPAGE.getType() == contentType.baseType().getType()) {\n-            if(contentlet.getHost()!=null && contentlet.getHost().equals(Host.SYSTEM_HOST) && (!UtilMethods.isSet(contentlet.getFolder()) || contentlet.getFolder().equals(FolderAPI.SYSTEM_FOLDER))){\n-                final DotContentletValidationException cve = new FileAssetValidationException(\"message.contentlet.fileasset.invalid.hostfolder\");\n-                Logger.warn(this, \"HTML Page [\" + contentIdentifier + \"] cannot be created directly under System \" +\n-                        \"Host\");\n-                cve.addBadTypeField(new LegacyFieldTransformer(contentType.fieldMap().get(FileAssetAPI\n-                        .HOST_FOLDER_FIELD)).asOldField());\n-                throw cve;\n-            }\n-            try{\n-                final Host site = APILocator.getHostAPI().find(contentlet.getHost(), APILocator.getUserAPI().getSystemUser(), false);\n-                Folder folder = null;\n-                if(UtilMethods.isSet(contentlet.getFolder())){\n-                    folder=APILocator.getFolderAPI().find(contentlet.getFolder(), APILocator.getUserAPI().getSystemUser(), false);\n-                }\n-                else{\n-                    folder=APILocator.getFolderAPI().findSystemFolder();\n-                }\n-\n-                //Get the URL from Identifier if it is not in Contentlet\n-                String url = contentlet.getStringProperty(HTMLPageAssetAPI.URL_FIELD);\n-\n-                if(!UtilMethods.isSet(url)){\n-\n-                    if (InodeUtils.isSet(contentlet.getVersionId()) || InodeUtils.isSet(contentlet.getInode())) {\n-                        Identifier identifier = APILocator.getIdentifierAPI().find(contentlet);\n-                        if (UtilMethods.isSet(identifier) && UtilMethods.isSet(identifier.getAssetName())) {\n-\n-                            url = identifier.getAssetName();\n-                        }\n-                    }\n-                }\n-\n-                if(UtilMethods.isSet(url)){\n-                    contentlet.setProperty(HTMLPageAssetAPI.URL_FIELD, url);\n-                    Identifier folderId = APILocator.getIdentifierAPI().find(folder);\n-                    String path = folder.getInode().equals(FolderAPI.SYSTEM_FOLDER)?\"/\"+url:folderId.getPath()+url;\n-                    Identifier htmlpage = APILocator.getIdentifierAPI().find(site, path);\n-                    if(htmlpage!=null && InodeUtils.isSet(htmlpage.getId()) && !htmlpage.getId().equals(contentlet.getIdentifier()) ){\n-                        final String errorMsg = \"Page URL [\" + path + \"] already exists with content ID [\" + htmlpage\n-                                .getId() + \"]\";\n-                        final DotContentletValidationException cve = new FileAssetValidationException(errorMsg);\n-                        Logger.warn(this, errorMsg);\n-                        cve.addBadTypeField(new LegacyFieldTransformer(contentType.fieldMap().get(HTMLPageAssetAPI\n-                                .URL_FIELD)).asOldField());\n-                        throw cve;\n-                    }\n-                    UtilMethods.validateFileName(url);\n-                }\n-\n-            } catch (final DotDataException | DotSecurityException | IllegalArgumentException e) {\n-                final String errorMsg = \"Contentlet [\" + contentIdentifier + \"] has an invalid URL: \" + contentlet\n-                        .getStringProperty(HTMLPageAssetAPI.URL_FIELD);\n-                final DotContentletValidationException cve = new FileAssetValidationException(errorMsg);\n-                Logger.warn(this, errorMsg);\n-                cve.addBadTypeField(new LegacyFieldTransformer(contentType.fieldMap().get(HTMLPageAssetAPI\n-                        .URL_FIELD)).asOldField());\n-                throw cve;\n-            }\n+            this.validateHtmlPage(contentlet, contentIdentifier, contentType);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86e2be6c1e19ef7c0b4f0ddbfa9a5c2e2cd5b828"}, "originalPosition": 189}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwNjg1ODUx", "url": "https://github.com/dotCMS/core/pull/17791#pullrequestreview-340685851", "createdAt": "2020-01-09T17:19:30Z", "commit": {"oid": "86e2be6c1e19ef7c0b4f0ddbfa9a5c2e2cd5b828"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fa1bd84b08529a7afe4f202616c2551234e43ab8", "author": {"user": {"login": "jdotcms", "name": "Jonathan"}}, "url": "https://github.com/dotCMS/core/commit/fa1bd84b08529a7afe4f202616c2551234e43ab8", "committedDate": "2020-01-09T18:14:19Z", "message": "#17772 adding fixes, refactoring and test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d8696da7c5e9a3f75b2f9df089d8006edc29f7cf", "author": {"user": {"login": "jdotcms", "name": "Jonathan"}}, "url": "https://github.com/dotCMS/core/commit/d8696da7c5e9a3f75b2f9df089d8006edc29f7cf", "committedDate": "2020-01-09T18:28:30Z", "message": "#17772 adding fixes, refactoring and test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwNzI5NTEz", "url": "https://github.com/dotCMS/core/pull/17791#pullrequestreview-340729513", "createdAt": "2020-01-09T18:35:44Z", "commit": {"oid": "d8696da7c5e9a3f75b2f9df089d8006edc29f7cf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxODozNTo0NFrOFb_iag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxODozNTo0NFrOFb_iag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDg5Njg3NA==", "bodyText": "Issue found: Avoid unused imports such as 'com.dotcms.datagen.TestDataUtils'", "url": "https://github.com/dotCMS/core/pull/17791#discussion_r364896874", "createdAt": "2020-01-09T18:35:44Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/util/MimeTypeUtilsTest.java", "diffHunk": "@@ -0,0 +1,86 @@\n+package com.dotcms.util;\n+\n+import com.dotcms.UnitTestBase;\n+import com.dotcms.contenttype.business.ContentTypeAPIImpl;\n+import com.dotcms.datagen.TestDataUtils;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d8696da7c5e9a3f75b2f9df089d8006edc29f7cf"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwNzI5NTI5", "url": "https://github.com/dotCMS/core/pull/17791#pullrequestreview-340729529", "createdAt": "2020-01-09T18:35:45Z", "commit": {"oid": "d8696da7c5e9a3f75b2f9df089d8006edc29f7cf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxODozNTo0NVrOFb_idg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxODozNTo0NVrOFb_idg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDg5Njg4Ng==", "bodyText": "Issue found: Avoid unused imports such as 'com.dotmarketing.portlets.workflows.model.WorkflowState'", "url": "https://github.com/dotCMS/core/pull/17791#discussion_r364896886", "createdAt": "2020-01-09T18:35:45Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/util/MimeTypeUtilsTest.java", "diffHunk": "@@ -0,0 +1,86 @@\n+package com.dotcms.util;\n+\n+import com.dotcms.UnitTestBase;\n+import com.dotcms.contenttype.business.ContentTypeAPIImpl;\n+import com.dotcms.datagen.TestDataUtils;\n+import com.dotcms.datagen.TestUserUtils;\n+import com.dotcms.repackage.org.apache.commons.io.FileUtils;\n+import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.business.Role;\n+import com.dotmarketing.business.RoleAPI;\n+import com.dotmarketing.portlets.workflows.actionlet.PublishContentActionlet;\n+import com.dotmarketing.portlets.workflows.actionlet.SaveContentActionlet;\n+import com.dotmarketing.portlets.workflows.actionlet.SaveContentAsDraftActionlet;\n+import com.dotmarketing.portlets.workflows.actionlet.UnpublishContentActionlet;\n+import com.dotmarketing.portlets.workflows.business.BaseWorkflowIntegrationTest;\n+import com.dotmarketing.portlets.workflows.model.WorkflowState;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d8696da7c5e9a3f75b2f9df089d8006edc29f7cf"}, "originalPosition": 16}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwNzI5NTQy", "url": "https://github.com/dotCMS/core/pull/17791#pullrequestreview-340729542", "createdAt": "2020-01-09T18:35:47Z", "commit": {"oid": "d8696da7c5e9a3f75b2f9df089d8006edc29f7cf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxODozNTo0N1rOFb_ihQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxODozNTo0N1rOFb_ihQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDg5NjkwMQ==", "bodyText": "Issue found: Unnecessary use of fully qualified name 'Assert.assertEquals' due to existing static import 'org.junit.Assert.*'", "url": "https://github.com/dotCMS/core/pull/17791#discussion_r364896901", "createdAt": "2020-01-09T18:35:47Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/util/MimeTypeUtilsTest.java", "diffHunk": "@@ -0,0 +1,86 @@\n+package com.dotcms.util;\n+\n+import com.dotcms.UnitTestBase;\n+import com.dotcms.contenttype.business.ContentTypeAPIImpl;\n+import com.dotcms.datagen.TestDataUtils;\n+import com.dotcms.datagen.TestUserUtils;\n+import com.dotcms.repackage.org.apache.commons.io.FileUtils;\n+import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.business.Role;\n+import com.dotmarketing.business.RoleAPI;\n+import com.dotmarketing.portlets.workflows.actionlet.PublishContentActionlet;\n+import com.dotmarketing.portlets.workflows.actionlet.SaveContentActionlet;\n+import com.dotmarketing.portlets.workflows.actionlet.SaveContentAsDraftActionlet;\n+import com.dotmarketing.portlets.workflows.actionlet.UnpublishContentActionlet;\n+import com.dotmarketing.portlets.workflows.business.BaseWorkflowIntegrationTest;\n+import com.dotmarketing.portlets.workflows.model.WorkflowState;\n+import com.dotmarketing.util.UUIDGenerator;\n+import com.liferay.util.StringPool;\n+import com.twelvemonkeys.imageio.plugins.jpeg.JPEGImageWriter;\n+import io.vavr.Tuple;\n+import io.vavr.Tuple2;\n+import org.junit.Assert;\n+import org.junit.BeforeClass;\n+import org.junit.Test;\n+\n+import javax.imageio.ImageIO;\n+import java.awt.*;\n+import java.awt.image.BufferedImage;\n+import java.io.File;\n+import java.io.IOException;\n+import java.util.*;\n+import java.util.stream.Collectors;\n+\n+import static com.dotcms.util.CollectionsUtils.*;\n+import static org.junit.Assert.*;\n+\n+/**\n+ * MimeTypeUtils unit test.\n+ * @author jsanca\n+ */\n+public class MimeTypeUtilsTest extends UnitTestBase {\n+\n+    @BeforeClass\n+    public static void prepare() throws Exception {\n+        //Setting web app environment\n+        IntegrationTestInitService.getInstance().init();\n+    }\n+\n+\n+    @Test\n+    public void test_getMimeType_text_plain() throws IOException {\n+\n+        final File tempTestFile = File\n+                .createTempFile(\"csvTest_\" + new Date().getTime(), \".txt\");\n+        FileUtils.writeStringToFile(tempTestFile, \"Test\");\n+\n+        final String mimeType = MimeTypeUtils.getMimeType(tempTestFile);\n+\n+        Assert.assertEquals(\"The mime type should be application/text\",\"text/plain\", mimeType);\n+    }\n+\n+    @Test\n+    public void test_getMimeType_image_png() throws IOException {\n+\n+        final File tempTestFile = File\n+                .createTempFile(\"image\" + new Date().getTime(), \".png\");\n+        final int width         = 200;\n+        final int height        = 200;\n+        final BufferedImage bufferedImage = new BufferedImage(width, height, BufferedImage.TYPE_INT_ARGB);\n+        final Graphics2D   graphics2D     = bufferedImage.createGraphics();\n+        final Font font                   = new Font(\"TimesRoman\", Font.BOLD, 20);\n+        final String message              = \"Test\";\n+        FontMetrics fontMetrics           = graphics2D.getFontMetrics();\n+        graphics2D.setFont(font);\n+        final int stringWidth             = fontMetrics.stringWidth(message);\n+        final int stringHeight            = fontMetrics.getAscent();\n+        graphics2D.setPaint(Color.black);\n+        graphics2D.drawString(message, (width - stringWidth) / 2, height / 2 + stringHeight / 4);\n+\n+        ImageIO.write(bufferedImage, \"PNG\", tempTestFile);\n+\n+        final String mimeType = MimeTypeUtils.getMimeType(tempTestFile);\n+\n+        Assert.assertEquals(\"The mime type should be image/png\",\"image/png\", mimeType);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d8696da7c5e9a3f75b2f9df089d8006edc29f7cf"}, "originalPosition": 84}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwNzI5NTUz", "url": "https://github.com/dotCMS/core/pull/17791#pullrequestreview-340729553", "createdAt": "2020-01-09T18:35:48Z", "commit": {"oid": "d8696da7c5e9a3f75b2f9df089d8006edc29f7cf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxODozNTo0OFrOFb_ikQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxODozNTo0OFrOFb_ikQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDg5NjkxMw==", "bodyText": "Issue found: Avoid unused imports such as 'com.liferay.util.StringPool'", "url": "https://github.com/dotCMS/core/pull/17791#discussion_r364896913", "createdAt": "2020-01-09T18:35:48Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/util/MimeTypeUtilsTest.java", "diffHunk": "@@ -0,0 +1,86 @@\n+package com.dotcms.util;\n+\n+import com.dotcms.UnitTestBase;\n+import com.dotcms.contenttype.business.ContentTypeAPIImpl;\n+import com.dotcms.datagen.TestDataUtils;\n+import com.dotcms.datagen.TestUserUtils;\n+import com.dotcms.repackage.org.apache.commons.io.FileUtils;\n+import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.business.Role;\n+import com.dotmarketing.business.RoleAPI;\n+import com.dotmarketing.portlets.workflows.actionlet.PublishContentActionlet;\n+import com.dotmarketing.portlets.workflows.actionlet.SaveContentActionlet;\n+import com.dotmarketing.portlets.workflows.actionlet.SaveContentAsDraftActionlet;\n+import com.dotmarketing.portlets.workflows.actionlet.UnpublishContentActionlet;\n+import com.dotmarketing.portlets.workflows.business.BaseWorkflowIntegrationTest;\n+import com.dotmarketing.portlets.workflows.model.WorkflowState;\n+import com.dotmarketing.util.UUIDGenerator;\n+import com.liferay.util.StringPool;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d8696da7c5e9a3f75b2f9df089d8006edc29f7cf"}, "originalPosition": 18}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwNzI5NTY5", "url": "https://github.com/dotCMS/core/pull/17791#pullrequestreview-340729569", "createdAt": "2020-01-09T18:35:49Z", "commit": {"oid": "d8696da7c5e9a3f75b2f9df089d8006edc29f7cf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxODozNTo1MFrOFb_inw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxODozNTo1MFrOFb_inw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDg5NjkyNw==", "bodyText": "Issue found: Unnecessary use of fully qualified name 'Assert.assertEquals' due to existing static import 'org.junit.Assert.*'", "url": "https://github.com/dotCMS/core/pull/17791#discussion_r364896927", "createdAt": "2020-01-09T18:35:50Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/util/MimeTypeUtilsTest.java", "diffHunk": "@@ -0,0 +1,86 @@\n+package com.dotcms.util;\n+\n+import com.dotcms.UnitTestBase;\n+import com.dotcms.contenttype.business.ContentTypeAPIImpl;\n+import com.dotcms.datagen.TestDataUtils;\n+import com.dotcms.datagen.TestUserUtils;\n+import com.dotcms.repackage.org.apache.commons.io.FileUtils;\n+import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.business.Role;\n+import com.dotmarketing.business.RoleAPI;\n+import com.dotmarketing.portlets.workflows.actionlet.PublishContentActionlet;\n+import com.dotmarketing.portlets.workflows.actionlet.SaveContentActionlet;\n+import com.dotmarketing.portlets.workflows.actionlet.SaveContentAsDraftActionlet;\n+import com.dotmarketing.portlets.workflows.actionlet.UnpublishContentActionlet;\n+import com.dotmarketing.portlets.workflows.business.BaseWorkflowIntegrationTest;\n+import com.dotmarketing.portlets.workflows.model.WorkflowState;\n+import com.dotmarketing.util.UUIDGenerator;\n+import com.liferay.util.StringPool;\n+import com.twelvemonkeys.imageio.plugins.jpeg.JPEGImageWriter;\n+import io.vavr.Tuple;\n+import io.vavr.Tuple2;\n+import org.junit.Assert;\n+import org.junit.BeforeClass;\n+import org.junit.Test;\n+\n+import javax.imageio.ImageIO;\n+import java.awt.*;\n+import java.awt.image.BufferedImage;\n+import java.io.File;\n+import java.io.IOException;\n+import java.util.*;\n+import java.util.stream.Collectors;\n+\n+import static com.dotcms.util.CollectionsUtils.*;\n+import static org.junit.Assert.*;\n+\n+/**\n+ * MimeTypeUtils unit test.\n+ * @author jsanca\n+ */\n+public class MimeTypeUtilsTest extends UnitTestBase {\n+\n+    @BeforeClass\n+    public static void prepare() throws Exception {\n+        //Setting web app environment\n+        IntegrationTestInitService.getInstance().init();\n+    }\n+\n+\n+    @Test\n+    public void test_getMimeType_text_plain() throws IOException {\n+\n+        final File tempTestFile = File\n+                .createTempFile(\"csvTest_\" + new Date().getTime(), \".txt\");\n+        FileUtils.writeStringToFile(tempTestFile, \"Test\");\n+\n+        final String mimeType = MimeTypeUtils.getMimeType(tempTestFile);\n+\n+        Assert.assertEquals(\"The mime type should be application/text\",\"text/plain\", mimeType);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d8696da7c5e9a3f75b2f9df089d8006edc29f7cf"}, "originalPosition": 59}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwNzI5NTc5", "url": "https://github.com/dotCMS/core/pull/17791#pullrequestreview-340729579", "createdAt": "2020-01-09T18:35:51Z", "commit": {"oid": "d8696da7c5e9a3f75b2f9df089d8006edc29f7cf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxODozNTo1MVrOFb_iqA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxODozNTo1MVrOFb_iqA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDg5NjkzNg==", "bodyText": "Issue found: Avoid unused imports such as 'io.vavr.Tuple2'", "url": "https://github.com/dotCMS/core/pull/17791#discussion_r364896936", "createdAt": "2020-01-09T18:35:51Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/util/MimeTypeUtilsTest.java", "diffHunk": "@@ -0,0 +1,86 @@\n+package com.dotcms.util;\n+\n+import com.dotcms.UnitTestBase;\n+import com.dotcms.contenttype.business.ContentTypeAPIImpl;\n+import com.dotcms.datagen.TestDataUtils;\n+import com.dotcms.datagen.TestUserUtils;\n+import com.dotcms.repackage.org.apache.commons.io.FileUtils;\n+import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.business.Role;\n+import com.dotmarketing.business.RoleAPI;\n+import com.dotmarketing.portlets.workflows.actionlet.PublishContentActionlet;\n+import com.dotmarketing.portlets.workflows.actionlet.SaveContentActionlet;\n+import com.dotmarketing.portlets.workflows.actionlet.SaveContentAsDraftActionlet;\n+import com.dotmarketing.portlets.workflows.actionlet.UnpublishContentActionlet;\n+import com.dotmarketing.portlets.workflows.business.BaseWorkflowIntegrationTest;\n+import com.dotmarketing.portlets.workflows.model.WorkflowState;\n+import com.dotmarketing.util.UUIDGenerator;\n+import com.liferay.util.StringPool;\n+import com.twelvemonkeys.imageio.plugins.jpeg.JPEGImageWriter;\n+import io.vavr.Tuple;\n+import io.vavr.Tuple2;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d8696da7c5e9a3f75b2f9df089d8006edc29f7cf"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwNzI5NTk1", "url": "https://github.com/dotCMS/core/pull/17791#pullrequestreview-340729595", "createdAt": "2020-01-09T18:35:52Z", "commit": {"oid": "d8696da7c5e9a3f75b2f9df089d8006edc29f7cf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxODozNTo1MlrOFb_isg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxODozNTo1MlrOFb_isg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDg5Njk0Ng==", "bodyText": "Issue found: Useless parentheses.", "url": "https://github.com/dotCMS/core/pull/17791#discussion_r364896946", "createdAt": "2020-01-09T18:35:52Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/test/java/com/dotcms/util/ConversionUtilsTest.java", "diffHunk": "@@ -13,6 +13,40 @@\n  */\n public class ConversionUtilsTest extends UnitTestBase {\n \n+    @Test\n+    public void toLongFromByteCountHumanDisplaySizeTest () {\n+\n+        long value = ConversionUtils.toLongFromByteCountHumanDisplaySize(\"0\", -1l);\n+        Assert.assertEquals(0l, value);\n+\n+        value = ConversionUtils.toLongFromByteCountHumanDisplaySize(\"10\", -1l);\n+        Assert.assertEquals(10l, value);\n+\n+        value = ConversionUtils.toLongFromByteCountHumanDisplaySize(\"900\", -1l);\n+        Assert.assertEquals(900l, value);\n+\n+        value = ConversionUtils.toLongFromByteCountHumanDisplaySize(\"9000\", -1l);\n+        Assert.assertEquals(9000l, value);\n+\n+        value = ConversionUtils.toLongFromByteCountHumanDisplaySize(\"1kb\", -1l);\n+        Assert.assertEquals(1024l, value);\n+\n+        value = ConversionUtils.toLongFromByteCountHumanDisplaySize(\"112kb\", -1l);\n+        Assert.assertEquals(112l * 1024l, value);\n+\n+        value = ConversionUtils.toLongFromByteCountHumanDisplaySize(\"3kb\", -1l);\n+        Assert.assertEquals( (3l * 1024l), value);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d8696da7c5e9a3f75b2f9df089d8006edc29f7cf"}, "originalPosition": 26}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwNzI5NjA3", "url": "https://github.com/dotCMS/core/pull/17791#pullrequestreview-340729607", "createdAt": "2020-01-09T18:35:53Z", "commit": {"oid": "d8696da7c5e9a3f75b2f9df089d8006edc29f7cf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxODozNTo1M1rOFb_iuw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxODozNTo1M1rOFb_iuw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDg5Njk1NQ==", "bodyText": "Issue found: All methods are static.  Consider using a utility class instead. Alternatively, you could add a private constructor or make the class abstract to silence this warning.", "url": "https://github.com/dotCMS/core/pull/17791#discussion_r364896955", "createdAt": "2020-01-09T18:35:53Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/main/java/com/dotcms/util/MimeTypeUtils.java", "diffHunk": "@@ -0,0 +1,44 @@\n+package com.dotcms.util;\n+\n+import com.dotcms.tika.TikaUtils;\n+import com.dotmarketing.util.Config;\n+import com.dotmarketing.util.Logger;\n+import com.dotmarketing.util.UtilMethods;\n+import com.rainerhahnekamp.sneakythrow.Sneaky;\n+\n+import java.io.File;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+\n+/**\n+ * Mime Type Utils\n+ * @author jsanca\n+ */\n+public class MimeTypeUtils {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d8696da7c5e9a3f75b2f9df089d8006edc29f7cf"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwNzI5NjE3", "url": "https://github.com/dotCMS/core/pull/17791#pullrequestreview-340729617", "createdAt": "2020-01-09T18:35:54Z", "commit": {"oid": "d8696da7c5e9a3f75b2f9df089d8006edc29f7cf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxODozNTo1NVrOFb_ixw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxODozNTo1NVrOFb_ixw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDg5Njk2Nw==", "bodyText": "Issue found: Avoid unused imports such as 'com.dotmarketing.portlets.contentlet.business.DotContentletValidationException'", "url": "https://github.com/dotCMS/core/pull/17791#discussion_r364896967", "createdAt": "2020-01-09T18:35:55Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/main/java/com/dotcms/rest/api/v1/temp/TempFileResource.java", "diffHunk": "@@ -1,5 +1,7 @@\n package com.dotcms.rest.api.v1.temp;\n \n+import com.dotcms.util.ConversionUtils;\n+import com.dotmarketing.portlets.contentlet.business.DotContentletValidationException;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d8696da7c5e9a3f75b2f9df089d8006edc29f7cf"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwNzI5NjMy", "url": "https://github.com/dotCMS/core/pull/17791#pullrequestreview-340729632", "createdAt": "2020-01-09T18:35:56Z", "commit": {"oid": "d8696da7c5e9a3f75b2f9df089d8006edc29f7cf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxODozNTo1NlrOFb_i0w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxODozNTo1NlrOFb_i0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDg5Njk3OQ==", "bodyText": "Issue found: Avoid unused imports such as 'com.dotmarketing.business.Role'", "url": "https://github.com/dotCMS/core/pull/17791#discussion_r364896979", "createdAt": "2020-01-09T18:35:56Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/util/MimeTypeUtilsTest.java", "diffHunk": "@@ -0,0 +1,86 @@\n+package com.dotcms.util;\n+\n+import com.dotcms.UnitTestBase;\n+import com.dotcms.contenttype.business.ContentTypeAPIImpl;\n+import com.dotcms.datagen.TestDataUtils;\n+import com.dotcms.datagen.TestUserUtils;\n+import com.dotcms.repackage.org.apache.commons.io.FileUtils;\n+import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.business.Role;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d8696da7c5e9a3f75b2f9df089d8006edc29f7cf"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwNzI5NjU1", "url": "https://github.com/dotCMS/core/pull/17791#pullrequestreview-340729655", "createdAt": "2020-01-09T18:35:57Z", "commit": {"oid": "d8696da7c5e9a3f75b2f9df089d8006edc29f7cf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxODozNTo1N1rOFb_i3g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxODozNTo1N1rOFb_i3g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDg5Njk5MA==", "bodyText": "Issue found: Avoid unused imports such as 'com.dotmarketing.util.UUIDGenerator'", "url": "https://github.com/dotCMS/core/pull/17791#discussion_r364896990", "createdAt": "2020-01-09T18:35:57Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/util/MimeTypeUtilsTest.java", "diffHunk": "@@ -0,0 +1,86 @@\n+package com.dotcms.util;\n+\n+import com.dotcms.UnitTestBase;\n+import com.dotcms.contenttype.business.ContentTypeAPIImpl;\n+import com.dotcms.datagen.TestDataUtils;\n+import com.dotcms.datagen.TestUserUtils;\n+import com.dotcms.repackage.org.apache.commons.io.FileUtils;\n+import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.business.Role;\n+import com.dotmarketing.business.RoleAPI;\n+import com.dotmarketing.portlets.workflows.actionlet.PublishContentActionlet;\n+import com.dotmarketing.portlets.workflows.actionlet.SaveContentActionlet;\n+import com.dotmarketing.portlets.workflows.actionlet.SaveContentAsDraftActionlet;\n+import com.dotmarketing.portlets.workflows.actionlet.UnpublishContentActionlet;\n+import com.dotmarketing.portlets.workflows.business.BaseWorkflowIntegrationTest;\n+import com.dotmarketing.portlets.workflows.model.WorkflowState;\n+import com.dotmarketing.util.UUIDGenerator;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d8696da7c5e9a3f75b2f9df089d8006edc29f7cf"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwNzI5NjY1", "url": "https://github.com/dotCMS/core/pull/17791#pullrequestreview-340729665", "createdAt": "2020-01-09T18:35:58Z", "commit": {"oid": "d8696da7c5e9a3f75b2f9df089d8006edc29f7cf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxODozNTo1OFrOFb_i5g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxODozNTo1OFrOFb_i5g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDg5Njk5OA==", "bodyText": "Issue found: Avoid unused imports such as 'com.dotmarketing.portlets.workflows.actionlet.SaveContentActionlet'", "url": "https://github.com/dotCMS/core/pull/17791#discussion_r364896998", "createdAt": "2020-01-09T18:35:58Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/util/MimeTypeUtilsTest.java", "diffHunk": "@@ -0,0 +1,86 @@\n+package com.dotcms.util;\n+\n+import com.dotcms.UnitTestBase;\n+import com.dotcms.contenttype.business.ContentTypeAPIImpl;\n+import com.dotcms.datagen.TestDataUtils;\n+import com.dotcms.datagen.TestUserUtils;\n+import com.dotcms.repackage.org.apache.commons.io.FileUtils;\n+import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.business.Role;\n+import com.dotmarketing.business.RoleAPI;\n+import com.dotmarketing.portlets.workflows.actionlet.PublishContentActionlet;\n+import com.dotmarketing.portlets.workflows.actionlet.SaveContentActionlet;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d8696da7c5e9a3f75b2f9df089d8006edc29f7cf"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwNzI5Njc4", "url": "https://github.com/dotCMS/core/pull/17791#pullrequestreview-340729678", "createdAt": "2020-01-09T18:35:59Z", "commit": {"oid": "d8696da7c5e9a3f75b2f9df089d8006edc29f7cf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxODozNjowMFrOFb_i9A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxODozNjowMFrOFb_i9A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDg5NzAxMg==", "bodyText": "Issue found: Avoid unused imports such as 'com.dotmarketing.portlets.workflows.actionlet.UnpublishContentActionlet'", "url": "https://github.com/dotCMS/core/pull/17791#discussion_r364897012", "createdAt": "2020-01-09T18:36:00Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/util/MimeTypeUtilsTest.java", "diffHunk": "@@ -0,0 +1,86 @@\n+package com.dotcms.util;\n+\n+import com.dotcms.UnitTestBase;\n+import com.dotcms.contenttype.business.ContentTypeAPIImpl;\n+import com.dotcms.datagen.TestDataUtils;\n+import com.dotcms.datagen.TestUserUtils;\n+import com.dotcms.repackage.org.apache.commons.io.FileUtils;\n+import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.business.Role;\n+import com.dotmarketing.business.RoleAPI;\n+import com.dotmarketing.portlets.workflows.actionlet.PublishContentActionlet;\n+import com.dotmarketing.portlets.workflows.actionlet.SaveContentActionlet;\n+import com.dotmarketing.portlets.workflows.actionlet.SaveContentAsDraftActionlet;\n+import com.dotmarketing.portlets.workflows.actionlet.UnpublishContentActionlet;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d8696da7c5e9a3f75b2f9df089d8006edc29f7cf"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwNzI5Njkx", "url": "https://github.com/dotCMS/core/pull/17791#pullrequestreview-340729691", "createdAt": "2020-01-09T18:36:01Z", "commit": {"oid": "d8696da7c5e9a3f75b2f9df089d8006edc29f7cf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxODozNjowMVrOFb_jAA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxODozNjowMVrOFb_jAA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDg5NzAyNA==", "bodyText": "Issue found: A method/constructor should not explicitly throw java.lang.Exception", "url": "https://github.com/dotCMS/core/pull/17791#discussion_r364897024", "createdAt": "2020-01-09T18:36:01Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/util/MimeTypeUtilsTest.java", "diffHunk": "@@ -0,0 +1,86 @@\n+package com.dotcms.util;\n+\n+import com.dotcms.UnitTestBase;\n+import com.dotcms.contenttype.business.ContentTypeAPIImpl;\n+import com.dotcms.datagen.TestDataUtils;\n+import com.dotcms.datagen.TestUserUtils;\n+import com.dotcms.repackage.org.apache.commons.io.FileUtils;\n+import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.business.Role;\n+import com.dotmarketing.business.RoleAPI;\n+import com.dotmarketing.portlets.workflows.actionlet.PublishContentActionlet;\n+import com.dotmarketing.portlets.workflows.actionlet.SaveContentActionlet;\n+import com.dotmarketing.portlets.workflows.actionlet.SaveContentAsDraftActionlet;\n+import com.dotmarketing.portlets.workflows.actionlet.UnpublishContentActionlet;\n+import com.dotmarketing.portlets.workflows.business.BaseWorkflowIntegrationTest;\n+import com.dotmarketing.portlets.workflows.model.WorkflowState;\n+import com.dotmarketing.util.UUIDGenerator;\n+import com.liferay.util.StringPool;\n+import com.twelvemonkeys.imageio.plugins.jpeg.JPEGImageWriter;\n+import io.vavr.Tuple;\n+import io.vavr.Tuple2;\n+import org.junit.Assert;\n+import org.junit.BeforeClass;\n+import org.junit.Test;\n+\n+import javax.imageio.ImageIO;\n+import java.awt.*;\n+import java.awt.image.BufferedImage;\n+import java.io.File;\n+import java.io.IOException;\n+import java.util.*;\n+import java.util.stream.Collectors;\n+\n+import static com.dotcms.util.CollectionsUtils.*;\n+import static org.junit.Assert.*;\n+\n+/**\n+ * MimeTypeUtils unit test.\n+ * @author jsanca\n+ */\n+public class MimeTypeUtilsTest extends UnitTestBase {\n+\n+    @BeforeClass\n+    public static void prepare() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d8696da7c5e9a3f75b2f9df089d8006edc29f7cf"}, "originalPosition": 44}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwNzI5NzA0", "url": "https://github.com/dotCMS/core/pull/17791#pullrequestreview-340729704", "createdAt": "2020-01-09T18:36:02Z", "commit": {"oid": "d8696da7c5e9a3f75b2f9df089d8006edc29f7cf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxODozNjowMlrOFb_jCg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxODozNjowMlrOFb_jCg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDg5NzAzNA==", "bodyText": "Issue found: Avoid unused imports such as 'org.junit.Assert'", "url": "https://github.com/dotCMS/core/pull/17791#discussion_r364897034", "createdAt": "2020-01-09T18:36:02Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/util/MimeTypeUtilsTest.java", "diffHunk": "@@ -0,0 +1,86 @@\n+package com.dotcms.util;\n+\n+import com.dotcms.UnitTestBase;\n+import com.dotcms.contenttype.business.ContentTypeAPIImpl;\n+import com.dotcms.datagen.TestDataUtils;\n+import com.dotcms.datagen.TestUserUtils;\n+import com.dotcms.repackage.org.apache.commons.io.FileUtils;\n+import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.business.Role;\n+import com.dotmarketing.business.RoleAPI;\n+import com.dotmarketing.portlets.workflows.actionlet.PublishContentActionlet;\n+import com.dotmarketing.portlets.workflows.actionlet.SaveContentActionlet;\n+import com.dotmarketing.portlets.workflows.actionlet.SaveContentAsDraftActionlet;\n+import com.dotmarketing.portlets.workflows.actionlet.UnpublishContentActionlet;\n+import com.dotmarketing.portlets.workflows.business.BaseWorkflowIntegrationTest;\n+import com.dotmarketing.portlets.workflows.model.WorkflowState;\n+import com.dotmarketing.util.UUIDGenerator;\n+import com.liferay.util.StringPool;\n+import com.twelvemonkeys.imageio.plugins.jpeg.JPEGImageWriter;\n+import io.vavr.Tuple;\n+import io.vavr.Tuple2;\n+import org.junit.Assert;\n+import org.junit.BeforeClass;\n+import org.junit.Test;\n+\n+import javax.imageio.ImageIO;\n+import java.awt.*;\n+import java.awt.image.BufferedImage;\n+import java.io.File;\n+import java.io.IOException;\n+import java.util.*;\n+import java.util.stream.Collectors;\n+\n+import static com.dotcms.util.CollectionsUtils.*;\n+import static org.junit.Assert.*;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d8696da7c5e9a3f75b2f9df089d8006edc29f7cf"}, "originalPosition": 35}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwNzI5NzE5", "url": "https://github.com/dotCMS/core/pull/17791#pullrequestreview-340729719", "createdAt": "2020-01-09T18:36:03Z", "commit": {"oid": "d8696da7c5e9a3f75b2f9df089d8006edc29f7cf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxODozNjowNFrOFb_jFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxODozNjowNFrOFb_jFA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDg5NzA0NA==", "bodyText": "Issue found: Avoid unused imports such as 'com.twelvemonkeys.imageio.plugins.jpeg.JPEGImageWriter'", "url": "https://github.com/dotCMS/core/pull/17791#discussion_r364897044", "createdAt": "2020-01-09T18:36:04Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/util/MimeTypeUtilsTest.java", "diffHunk": "@@ -0,0 +1,86 @@\n+package com.dotcms.util;\n+\n+import com.dotcms.UnitTestBase;\n+import com.dotcms.contenttype.business.ContentTypeAPIImpl;\n+import com.dotcms.datagen.TestDataUtils;\n+import com.dotcms.datagen.TestUserUtils;\n+import com.dotcms.repackage.org.apache.commons.io.FileUtils;\n+import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.business.Role;\n+import com.dotmarketing.business.RoleAPI;\n+import com.dotmarketing.portlets.workflows.actionlet.PublishContentActionlet;\n+import com.dotmarketing.portlets.workflows.actionlet.SaveContentActionlet;\n+import com.dotmarketing.portlets.workflows.actionlet.SaveContentAsDraftActionlet;\n+import com.dotmarketing.portlets.workflows.actionlet.UnpublishContentActionlet;\n+import com.dotmarketing.portlets.workflows.business.BaseWorkflowIntegrationTest;\n+import com.dotmarketing.portlets.workflows.model.WorkflowState;\n+import com.dotmarketing.util.UUIDGenerator;\n+import com.liferay.util.StringPool;\n+import com.twelvemonkeys.imageio.plugins.jpeg.JPEGImageWriter;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d8696da7c5e9a3f75b2f9df089d8006edc29f7cf"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwNzI5NzMx", "url": "https://github.com/dotCMS/core/pull/17791#pullrequestreview-340729731", "createdAt": "2020-01-09T18:36:05Z", "commit": {"oid": "d8696da7c5e9a3f75b2f9df089d8006edc29f7cf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxODozNjowNVrOFb_jHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxODozNjowNVrOFb_jHA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDg5NzA1Mg==", "bodyText": "Issue found: Avoid unused imports such as 'com.dotcms.util.ConversionUtils'", "url": "https://github.com/dotCMS/core/pull/17791#discussion_r364897052", "createdAt": "2020-01-09T18:36:05Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/main/java/com/dotcms/rest/api/v1/temp/TempFileResource.java", "diffHunk": "@@ -1,5 +1,7 @@\n package com.dotcms.rest.api.v1.temp;\n \n+import com.dotcms.util.ConversionUtils;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d8696da7c5e9a3f75b2f9df089d8006edc29f7cf"}, "originalPosition": 3}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwNzI5NzQz", "url": "https://github.com/dotCMS/core/pull/17791#pullrequestreview-340729743", "createdAt": "2020-01-09T18:36:06Z", "commit": {"oid": "d8696da7c5e9a3f75b2f9df089d8006edc29f7cf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxODozNjowNlrOFb_jIQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxODozNjowNlrOFb_jIQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDg5NzA1Nw==", "bodyText": "Issue found: Avoid unused imports such as 'io.vavr.Tuple'", "url": "https://github.com/dotCMS/core/pull/17791#discussion_r364897057", "createdAt": "2020-01-09T18:36:06Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/util/MimeTypeUtilsTest.java", "diffHunk": "@@ -0,0 +1,86 @@\n+package com.dotcms.util;\n+\n+import com.dotcms.UnitTestBase;\n+import com.dotcms.contenttype.business.ContentTypeAPIImpl;\n+import com.dotcms.datagen.TestDataUtils;\n+import com.dotcms.datagen.TestUserUtils;\n+import com.dotcms.repackage.org.apache.commons.io.FileUtils;\n+import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.business.Role;\n+import com.dotmarketing.business.RoleAPI;\n+import com.dotmarketing.portlets.workflows.actionlet.PublishContentActionlet;\n+import com.dotmarketing.portlets.workflows.actionlet.SaveContentActionlet;\n+import com.dotmarketing.portlets.workflows.actionlet.SaveContentAsDraftActionlet;\n+import com.dotmarketing.portlets.workflows.actionlet.UnpublishContentActionlet;\n+import com.dotmarketing.portlets.workflows.business.BaseWorkflowIntegrationTest;\n+import com.dotmarketing.portlets.workflows.model.WorkflowState;\n+import com.dotmarketing.util.UUIDGenerator;\n+import com.liferay.util.StringPool;\n+import com.twelvemonkeys.imageio.plugins.jpeg.JPEGImageWriter;\n+import io.vavr.Tuple;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d8696da7c5e9a3f75b2f9df089d8006edc29f7cf"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwNzI5NzUz", "url": "https://github.com/dotCMS/core/pull/17791#pullrequestreview-340729753", "createdAt": "2020-01-09T18:36:07Z", "commit": {"oid": "d8696da7c5e9a3f75b2f9df089d8006edc29f7cf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxODozNjowN1rOFb_jKA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxODozNjowN1rOFb_jKA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDg5NzA2NA==", "bodyText": "Issue found: Avoid unused imports such as 'com.dotmarketing.portlets.workflows.actionlet.PublishContentActionlet'", "url": "https://github.com/dotCMS/core/pull/17791#discussion_r364897064", "createdAt": "2020-01-09T18:36:07Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/util/MimeTypeUtilsTest.java", "diffHunk": "@@ -0,0 +1,86 @@\n+package com.dotcms.util;\n+\n+import com.dotcms.UnitTestBase;\n+import com.dotcms.contenttype.business.ContentTypeAPIImpl;\n+import com.dotcms.datagen.TestDataUtils;\n+import com.dotcms.datagen.TestUserUtils;\n+import com.dotcms.repackage.org.apache.commons.io.FileUtils;\n+import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.business.Role;\n+import com.dotmarketing.business.RoleAPI;\n+import com.dotmarketing.portlets.workflows.actionlet.PublishContentActionlet;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d8696da7c5e9a3f75b2f9df089d8006edc29f7cf"}, "originalPosition": 11}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwNzI5NzYw", "url": "https://github.com/dotCMS/core/pull/17791#pullrequestreview-340729760", "createdAt": "2020-01-09T18:36:08Z", "commit": {"oid": "d8696da7c5e9a3f75b2f9df089d8006edc29f7cf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxODozNjowOFrOFb_jLw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxODozNjowOFrOFb_jLw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDg5NzA3MQ==", "bodyText": "Issue found: Avoid unused imports such as 'com.dotmarketing.business.APILocator'", "url": "https://github.com/dotCMS/core/pull/17791#discussion_r364897071", "createdAt": "2020-01-09T18:36:08Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/util/MimeTypeUtilsTest.java", "diffHunk": "@@ -0,0 +1,86 @@\n+package com.dotcms.util;\n+\n+import com.dotcms.UnitTestBase;\n+import com.dotcms.contenttype.business.ContentTypeAPIImpl;\n+import com.dotcms.datagen.TestDataUtils;\n+import com.dotcms.datagen.TestUserUtils;\n+import com.dotcms.repackage.org.apache.commons.io.FileUtils;\n+import com.dotmarketing.business.APILocator;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d8696da7c5e9a3f75b2f9df089d8006edc29f7cf"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwNzI5Nzcx", "url": "https://github.com/dotCMS/core/pull/17791#pullrequestreview-340729771", "createdAt": "2020-01-09T18:36:09Z", "commit": {"oid": "d8696da7c5e9a3f75b2f9df089d8006edc29f7cf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxODozNjowOVrOFb_jOg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxODozNjowOVrOFb_jOg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDg5NzA4Mg==", "bodyText": "Issue found: Avoid unused imports such as 'com.dotmarketing.business.RoleAPI'", "url": "https://github.com/dotCMS/core/pull/17791#discussion_r364897082", "createdAt": "2020-01-09T18:36:09Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/util/MimeTypeUtilsTest.java", "diffHunk": "@@ -0,0 +1,86 @@\n+package com.dotcms.util;\n+\n+import com.dotcms.UnitTestBase;\n+import com.dotcms.contenttype.business.ContentTypeAPIImpl;\n+import com.dotcms.datagen.TestDataUtils;\n+import com.dotcms.datagen.TestUserUtils;\n+import com.dotcms.repackage.org.apache.commons.io.FileUtils;\n+import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.business.Role;\n+import com.dotmarketing.business.RoleAPI;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d8696da7c5e9a3f75b2f9df089d8006edc29f7cf"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwNzI5Nzgw", "url": "https://github.com/dotCMS/core/pull/17791#pullrequestreview-340729780", "createdAt": "2020-01-09T18:36:10Z", "commit": {"oid": "d8696da7c5e9a3f75b2f9df089d8006edc29f7cf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxODozNjoxMFrOFb_jQQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxODozNjoxMFrOFb_jQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDg5NzA4OQ==", "bodyText": "Issue found: Local variable 'fontMetrics' could be declared final", "url": "https://github.com/dotCMS/core/pull/17791#discussion_r364897089", "createdAt": "2020-01-09T18:36:10Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/util/MimeTypeUtilsTest.java", "diffHunk": "@@ -0,0 +1,86 @@\n+package com.dotcms.util;\n+\n+import com.dotcms.UnitTestBase;\n+import com.dotcms.contenttype.business.ContentTypeAPIImpl;\n+import com.dotcms.datagen.TestDataUtils;\n+import com.dotcms.datagen.TestUserUtils;\n+import com.dotcms.repackage.org.apache.commons.io.FileUtils;\n+import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.business.Role;\n+import com.dotmarketing.business.RoleAPI;\n+import com.dotmarketing.portlets.workflows.actionlet.PublishContentActionlet;\n+import com.dotmarketing.portlets.workflows.actionlet.SaveContentActionlet;\n+import com.dotmarketing.portlets.workflows.actionlet.SaveContentAsDraftActionlet;\n+import com.dotmarketing.portlets.workflows.actionlet.UnpublishContentActionlet;\n+import com.dotmarketing.portlets.workflows.business.BaseWorkflowIntegrationTest;\n+import com.dotmarketing.portlets.workflows.model.WorkflowState;\n+import com.dotmarketing.util.UUIDGenerator;\n+import com.liferay.util.StringPool;\n+import com.twelvemonkeys.imageio.plugins.jpeg.JPEGImageWriter;\n+import io.vavr.Tuple;\n+import io.vavr.Tuple2;\n+import org.junit.Assert;\n+import org.junit.BeforeClass;\n+import org.junit.Test;\n+\n+import javax.imageio.ImageIO;\n+import java.awt.*;\n+import java.awt.image.BufferedImage;\n+import java.io.File;\n+import java.io.IOException;\n+import java.util.*;\n+import java.util.stream.Collectors;\n+\n+import static com.dotcms.util.CollectionsUtils.*;\n+import static org.junit.Assert.*;\n+\n+/**\n+ * MimeTypeUtils unit test.\n+ * @author jsanca\n+ */\n+public class MimeTypeUtilsTest extends UnitTestBase {\n+\n+    @BeforeClass\n+    public static void prepare() throws Exception {\n+        //Setting web app environment\n+        IntegrationTestInitService.getInstance().init();\n+    }\n+\n+\n+    @Test\n+    public void test_getMimeType_text_plain() throws IOException {\n+\n+        final File tempTestFile = File\n+                .createTempFile(\"csvTest_\" + new Date().getTime(), \".txt\");\n+        FileUtils.writeStringToFile(tempTestFile, \"Test\");\n+\n+        final String mimeType = MimeTypeUtils.getMimeType(tempTestFile);\n+\n+        Assert.assertEquals(\"The mime type should be application/text\",\"text/plain\", mimeType);\n+    }\n+\n+    @Test\n+    public void test_getMimeType_image_png() throws IOException {\n+\n+        final File tempTestFile = File\n+                .createTempFile(\"image\" + new Date().getTime(), \".png\");\n+        final int width         = 200;\n+        final int height        = 200;\n+        final BufferedImage bufferedImage = new BufferedImage(width, height, BufferedImage.TYPE_INT_ARGB);\n+        final Graphics2D   graphics2D     = bufferedImage.createGraphics();\n+        final Font font                   = new Font(\"TimesRoman\", Font.BOLD, 20);\n+        final String message              = \"Test\";\n+        FontMetrics fontMetrics           = graphics2D.getFontMetrics();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d8696da7c5e9a3f75b2f9df089d8006edc29f7cf"}, "originalPosition": 73}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwNzI5Nzk0", "url": "https://github.com/dotCMS/core/pull/17791#pullrequestreview-340729794", "createdAt": "2020-01-09T18:36:11Z", "commit": {"oid": "d8696da7c5e9a3f75b2f9df089d8006edc29f7cf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxODozNjoxMVrOFb_jTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxODozNjoxMVrOFb_jTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDg5NzEwMA==", "bodyText": "Issue found: Avoid unused imports such as 'com.dotcms.datagen.TestUserUtils'", "url": "https://github.com/dotCMS/core/pull/17791#discussion_r364897100", "createdAt": "2020-01-09T18:36:11Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/util/MimeTypeUtilsTest.java", "diffHunk": "@@ -0,0 +1,86 @@\n+package com.dotcms.util;\n+\n+import com.dotcms.UnitTestBase;\n+import com.dotcms.contenttype.business.ContentTypeAPIImpl;\n+import com.dotcms.datagen.TestDataUtils;\n+import com.dotcms.datagen.TestUserUtils;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d8696da7c5e9a3f75b2f9df089d8006edc29f7cf"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwNzI5ODA4", "url": "https://github.com/dotCMS/core/pull/17791#pullrequestreview-340729808", "createdAt": "2020-01-09T18:36:12Z", "commit": {"oid": "d8696da7c5e9a3f75b2f9df089d8006edc29f7cf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxODozNjoxM1rOFb_jVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxODozNjoxM1rOFb_jVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDg5NzEwOA==", "bodyText": "Issue found: Avoid unused imports such as 'java.util.stream.Collectors'", "url": "https://github.com/dotCMS/core/pull/17791#discussion_r364897108", "createdAt": "2020-01-09T18:36:13Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/util/MimeTypeUtilsTest.java", "diffHunk": "@@ -0,0 +1,86 @@\n+package com.dotcms.util;\n+\n+import com.dotcms.UnitTestBase;\n+import com.dotcms.contenttype.business.ContentTypeAPIImpl;\n+import com.dotcms.datagen.TestDataUtils;\n+import com.dotcms.datagen.TestUserUtils;\n+import com.dotcms.repackage.org.apache.commons.io.FileUtils;\n+import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.business.Role;\n+import com.dotmarketing.business.RoleAPI;\n+import com.dotmarketing.portlets.workflows.actionlet.PublishContentActionlet;\n+import com.dotmarketing.portlets.workflows.actionlet.SaveContentActionlet;\n+import com.dotmarketing.portlets.workflows.actionlet.SaveContentAsDraftActionlet;\n+import com.dotmarketing.portlets.workflows.actionlet.UnpublishContentActionlet;\n+import com.dotmarketing.portlets.workflows.business.BaseWorkflowIntegrationTest;\n+import com.dotmarketing.portlets.workflows.model.WorkflowState;\n+import com.dotmarketing.util.UUIDGenerator;\n+import com.liferay.util.StringPool;\n+import com.twelvemonkeys.imageio.plugins.jpeg.JPEGImageWriter;\n+import io.vavr.Tuple;\n+import io.vavr.Tuple2;\n+import org.junit.Assert;\n+import org.junit.BeforeClass;\n+import org.junit.Test;\n+\n+import javax.imageio.ImageIO;\n+import java.awt.*;\n+import java.awt.image.BufferedImage;\n+import java.io.File;\n+import java.io.IOException;\n+import java.util.*;\n+import java.util.stream.Collectors;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d8696da7c5e9a3f75b2f9df089d8006edc29f7cf"}, "originalPosition": 32}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwNzI5ODIw", "url": "https://github.com/dotCMS/core/pull/17791#pullrequestreview-340729820", "createdAt": "2020-01-09T18:36:14Z", "commit": {"oid": "d8696da7c5e9a3f75b2f9df089d8006edc29f7cf"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxODozNjoxNFrOFb_jWg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxODozNjoxNFrOFb_jWg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDg5NzExNA==", "bodyText": "Issue found: Useless parentheses.", "url": "https://github.com/dotCMS/core/pull/17791#discussion_r364897114", "createdAt": "2020-01-09T18:36:14Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/test/java/com/dotcms/util/ConversionUtilsTest.java", "diffHunk": "@@ -13,6 +13,40 @@\n  */\n public class ConversionUtilsTest extends UnitTestBase {\n \n+    @Test\n+    public void toLongFromByteCountHumanDisplaySizeTest () {\n+\n+        long value = ConversionUtils.toLongFromByteCountHumanDisplaySize(\"0\", -1l);\n+        Assert.assertEquals(0l, value);\n+\n+        value = ConversionUtils.toLongFromByteCountHumanDisplaySize(\"10\", -1l);\n+        Assert.assertEquals(10l, value);\n+\n+        value = ConversionUtils.toLongFromByteCountHumanDisplaySize(\"900\", -1l);\n+        Assert.assertEquals(900l, value);\n+\n+        value = ConversionUtils.toLongFromByteCountHumanDisplaySize(\"9000\", -1l);\n+        Assert.assertEquals(9000l, value);\n+\n+        value = ConversionUtils.toLongFromByteCountHumanDisplaySize(\"1kb\", -1l);\n+        Assert.assertEquals(1024l, value);\n+\n+        value = ConversionUtils.toLongFromByteCountHumanDisplaySize(\"112kb\", -1l);\n+        Assert.assertEquals(112l * 1024l, value);\n+\n+        value = ConversionUtils.toLongFromByteCountHumanDisplaySize(\"3kb\", -1l);\n+        Assert.assertEquals( (3l * 1024l), value);\n+\n+        value = ConversionUtils.toLongFromByteCountHumanDisplaySize(\"2mb\", -1l);\n+        Assert.assertEquals( (2l * 1024l * 1024l), value);\n+\n+        value = ConversionUtils.toLongFromByteCountHumanDisplaySize(\"4gb\", -1l);\n+        Assert.assertEquals( (4l * 1024l * 1024l * 1024l), value);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d8696da7c5e9a3f75b2f9df089d8006edc29f7cf"}, "originalPosition": 32}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwNzMwMTY1", "url": "https://github.com/dotCMS/core/pull/17791#pullrequestreview-340730165", "createdAt": "2020-01-09T18:36:45Z", "commit": {"oid": "d8696da7c5e9a3f75b2f9df089d8006edc29f7cf"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQxMjE1Mzcx", "url": "https://github.com/dotCMS/core/pull/17791#pullrequestreview-341215371", "createdAt": "2020-01-10T14:58:00Z", "commit": {"oid": "d8696da7c5e9a3f75b2f9df089d8006edc29f7cf"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1268, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}