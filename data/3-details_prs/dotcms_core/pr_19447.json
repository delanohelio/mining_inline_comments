{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAzNTU2MDUx", "number": 19447, "title": "#19285 Using Max contentlet properties by Persona", "bodyText": "Max Contentlet container property now is working by Persona", "createdAt": "2020-10-14T18:18:08Z", "url": "https://github.com/dotCMS/core/pull/19447", "merged": true, "mergeCommit": {"oid": "65007b873defb034846bef3d070a26f9ea42677e"}, "closed": true, "closedAt": "2020-10-20T21:32:44Z", "author": {"login": "freddyucv"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdShT8BgH2gAyNTAzNTU2MDUxOjRjOWQ5ZGVmY2I0Njk0OTBmNDJjZjVlYWRmYWM4ZGM3OGUyODYwNjM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdUeoTvAFqTUxMzA5NzYzMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4c9d9defcb469490f42cf5eadfac8dc78e286063", "author": {"user": {"login": "freddyucv", "name": "Freddy Rodriguez"}}, "url": "https://github.com/dotCMS/core/commit/4c9d9defcb469490f42cf5eadfac8dc78e286063", "committedDate": "2020-10-14T18:16:31Z", "message": "#19285 Using Max contentlet properties by Persona"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA4NjE0MDg1", "url": "https://github.com/dotCMS/core/pull/19447#pullrequestreview-508614085", "createdAt": "2020-10-14T18:22:11Z", "commit": {"oid": "4c9d9defcb469490f42cf5eadfac8dc78e286063"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA4NjIzNjk2", "url": "https://github.com/dotCMS/core/pull/19447#pullrequestreview-508623696", "createdAt": "2020-10-14T18:35:01Z", "commit": {"oid": "4c9d9defcb469490f42cf5eadfac8dc78e286063"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxODozNTowMVrOHhgCyA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxODozNTowMVrOHhgCyA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDg5MDA1Ng==", "bodyText": "should return a Set?", "url": "https://github.com/dotCMS/core/pull/19447#discussion_r504890056", "createdAt": "2020-10-14T18:35:01Z", "author": {"login": "jdotcms"}, "path": "dotCMS/src/main/java/com/dotcms/rendering/velocity/services/PageRenderUtil.java", "diffHunk": "@@ -514,4 +510,40 @@ private String getPersonaTagToIncludeContent(final HttpServletRequest request, f\n \n         return hasPersonalizations ? currentPersonaTag : MultiTree.DOT_PERSONALIZATION_DEFAULT;\n     }\n+\n+    private static class ContainerUUIDPersona {\n+        Map<String, List<String>> containerUuidPersona     = Maps.newHashMap();\n+\n+        public void add(\n+                final Container container,\n+                final String uniqueUUIDForRender,\n+                final PersonalizedContentlet personalizedContentlet) {\n+\n+            get(container, uniqueUUIDForRender, personalizedContentlet)\n+                    .add(personalizedContentlet.getContentletId());\n+        }\n+\n+        private List<String> get(Container container, String uniqueUUIDForRender, PersonalizedContentlet personalizedContentlet) {\n+            return containerUuidPersona\n+                    .computeIfAbsent(\n+                            getKey(container, uniqueUUIDForRender, personalizedContentlet),\n+                            k -> Lists.newArrayList()\n+                    );\n+        }\n+\n+        private String getKey(Container container, String uniqueUUIDForRender, PersonalizedContentlet personalizedContentlet) {\n+            return container.getIdentifier() + uniqueUUIDForRender + personalizedContentlet.getPersonalization();\n+        }\n+\n+        public long getSize(\n+                final Container container,\n+                final String uniqueUUIDForRender,\n+                final PersonalizedContentlet personalizedContentlet) {\n+            return get(container, uniqueUUIDForRender, personalizedContentlet).size();\n+        }\n+\n+        public Iterable<? extends Map.Entry<String, List<String>>> entrySet() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4c9d9defcb469490f42cf5eadfac8dc78e286063"}, "originalPosition": 120}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA4NjIzODI1", "url": "https://github.com/dotCMS/core/pull/19447#pullrequestreview-508623825", "createdAt": "2020-10-14T18:35:13Z", "commit": {"oid": "4c9d9defcb469490f42cf5eadfac8dc78e286063"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxODozNToxNFrOHhgDLQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxODozNToxNFrOHhgDLQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDg5MDE1Nw==", "bodyText": "Add some doc", "url": "https://github.com/dotCMS/core/pull/19447#discussion_r504890157", "createdAt": "2020-10-14T18:35:14Z", "author": {"login": "jdotcms"}, "path": "dotCMS/src/main/java/com/dotcms/rendering/velocity/services/PageRenderUtil.java", "diffHunk": "@@ -514,4 +510,40 @@ private String getPersonaTagToIncludeContent(final HttpServletRequest request, f\n \n         return hasPersonalizations ? currentPersonaTag : MultiTree.DOT_PERSONALIZATION_DEFAULT;\n     }\n+\n+    private static class ContainerUUIDPersona {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4c9d9defcb469490f42cf5eadfac8dc78e286063"}, "originalPosition": 89}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bbd176303ed633ddea71b2af08cb868208201451", "author": {"user": {"login": "freddyucv", "name": "Freddy Rodriguez"}}, "url": "https://github.com/dotCMS/core/commit/bbd176303ed633ddea71b2af08cb868208201451", "committedDate": "2020-10-15T14:46:01Z", "message": "#19285 Doc and refactoring"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEzMDg0ODk2", "url": "https://github.com/dotCMS/core/pull/19447#pullrequestreview-513084896", "createdAt": "2020-10-20T19:58:33Z", "commit": {"oid": "bbd176303ed633ddea71b2af08cb868208201451"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "874cf5507ca3c965a400ea59ef55ad142d6dedb5", "author": {"user": {"login": "freddyucv", "name": "Freddy Rodriguez"}}, "url": "https://github.com/dotCMS/core/commit/874cf5507ca3c965a400ea59ef55ad142d6dedb5", "committedDate": "2020-10-20T20:09:04Z", "message": "Merge remote-tracking branch 'origin/master' into issue-19285-Legacy-containers-personalization-cache-issue"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEzMDk3NjMw", "url": "https://github.com/dotCMS/core/pull/19447#pullrequestreview-513097630", "createdAt": "2020-10-20T20:16:54Z", "commit": {"oid": "874cf5507ca3c965a400ea59ef55ad142d6dedb5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQyMDoxNjo1NFrOHlPXgg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQyMDoxNjo1NFrOHlPXgg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODgxMTEzOA==", "bodyText": "Codacy found an issue: A method/constructor should not explicitly throw java.lang.Exception", "url": "https://github.com/dotCMS/core/pull/19447#discussion_r508811138", "createdAt": "2020-10-20T20:16:54Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "diffHunk": "@@ -1653,6 +1658,103 @@ public void pageWithSidebarShouldRender() throws Exception{\n         assertTrue(firstIndex != -1 && secondIndex != -1 && firstIndex != secondIndex && thirdIndex == -1);\n     }\n \n+    /**\n+     * Method to test: {@link HTMLPageAssetRenderedAPI#getPageHtml(PageContext, HttpServletRequest, HttpServletResponse)}\n+     * When: A page has multiple personas version, and the container has a MAx contentlet equals to 1\n+     * Should: render the page\n+     */\n+    @Test\n+    public void pageWithMultiplePersona() throws Exception{", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "874cf5507ca3c965a400ea59ef55ad142d6dedb5"}, "originalPosition": 37}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1736, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}