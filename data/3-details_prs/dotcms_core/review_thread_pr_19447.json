{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAzNTU2MDUx", "number": 19447, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxODozNTowMVrOEtnJeA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQyMDoxNjo1NFrOEv9cCw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2MjYyNzc2OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/main/java/com/dotcms/rendering/velocity/services/PageRenderUtil.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxODozNTowMVrOHhgCyA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxNDo0NzowM1rOHiLlHA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDg5MDA1Ng==", "bodyText": "should return a Set?", "url": "https://github.com/dotCMS/core/pull/19447#discussion_r504890056", "createdAt": "2020-10-14T18:35:01Z", "author": {"login": "jdotcms"}, "path": "dotCMS/src/main/java/com/dotcms/rendering/velocity/services/PageRenderUtil.java", "diffHunk": "@@ -514,4 +510,40 @@ private String getPersonaTagToIncludeContent(final HttpServletRequest request, f\n \n         return hasPersonalizations ? currentPersonaTag : MultiTree.DOT_PERSONALIZATION_DEFAULT;\n     }\n+\n+    private static class ContainerUUIDPersona {\n+        Map<String, List<String>> containerUuidPersona     = Maps.newHashMap();\n+\n+        public void add(\n+                final Container container,\n+                final String uniqueUUIDForRender,\n+                final PersonalizedContentlet personalizedContentlet) {\n+\n+            get(container, uniqueUUIDForRender, personalizedContentlet)\n+                    .add(personalizedContentlet.getContentletId());\n+        }\n+\n+        private List<String> get(Container container, String uniqueUUIDForRender, PersonalizedContentlet personalizedContentlet) {\n+            return containerUuidPersona\n+                    .computeIfAbsent(\n+                            getKey(container, uniqueUUIDForRender, personalizedContentlet),\n+                            k -> Lists.newArrayList()\n+                    );\n+        }\n+\n+        private String getKey(Container container, String uniqueUUIDForRender, PersonalizedContentlet personalizedContentlet) {\n+            return container.getIdentifier() + uniqueUUIDForRender + personalizedContentlet.getPersonalization();\n+        }\n+\n+        public long getSize(\n+                final Container container,\n+                final String uniqueUUIDForRender,\n+                final PersonalizedContentlet personalizedContentlet) {\n+            return get(container, uniqueUUIDForRender, personalizedContentlet).size();\n+        }\n+\n+        public Iterable<? extends Map.Entry<String, List<String>>> entrySet() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4c9d9defcb469490f42cf5eadfac8dc78e286063"}, "originalPosition": 120}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTYwMzM1Ng==", "bodyText": "done bbd1763#diff-135d6f9eb01eb89ef742b83753636596a41a9e3ab757abd4347b57e80ae892e0R548", "url": "https://github.com/dotCMS/core/pull/19447#discussion_r505603356", "createdAt": "2020-10-15T14:47:03Z", "author": {"login": "freddyucv"}, "path": "dotCMS/src/main/java/com/dotcms/rendering/velocity/services/PageRenderUtil.java", "diffHunk": "@@ -514,4 +510,40 @@ private String getPersonaTagToIncludeContent(final HttpServletRequest request, f\n \n         return hasPersonalizations ? currentPersonaTag : MultiTree.DOT_PERSONALIZATION_DEFAULT;\n     }\n+\n+    private static class ContainerUUIDPersona {\n+        Map<String, List<String>> containerUuidPersona     = Maps.newHashMap();\n+\n+        public void add(\n+                final Container container,\n+                final String uniqueUUIDForRender,\n+                final PersonalizedContentlet personalizedContentlet) {\n+\n+            get(container, uniqueUUIDForRender, personalizedContentlet)\n+                    .add(personalizedContentlet.getContentletId());\n+        }\n+\n+        private List<String> get(Container container, String uniqueUUIDForRender, PersonalizedContentlet personalizedContentlet) {\n+            return containerUuidPersona\n+                    .computeIfAbsent(\n+                            getKey(container, uniqueUUIDForRender, personalizedContentlet),\n+                            k -> Lists.newArrayList()\n+                    );\n+        }\n+\n+        private String getKey(Container container, String uniqueUUIDForRender, PersonalizedContentlet personalizedContentlet) {\n+            return container.getIdentifier() + uniqueUUIDForRender + personalizedContentlet.getPersonalization();\n+        }\n+\n+        public long getSize(\n+                final Container container,\n+                final String uniqueUUIDForRender,\n+                final PersonalizedContentlet personalizedContentlet) {\n+            return get(container, uniqueUUIDForRender, personalizedContentlet).size();\n+        }\n+\n+        public Iterable<? extends Map.Entry<String, List<String>>> entrySet() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDg5MDA1Ng=="}, "originalCommit": {"oid": "4c9d9defcb469490f42cf5eadfac8dc78e286063"}, "originalPosition": 120}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE2MjYyODQ3OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/main/java/com/dotcms/rendering/velocity/services/PageRenderUtil.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxODozNToxNFrOHhgDLQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxNDo0Njo1MFrOHiLkVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDg5MDE1Nw==", "bodyText": "Add some doc", "url": "https://github.com/dotCMS/core/pull/19447#discussion_r504890157", "createdAt": "2020-10-14T18:35:14Z", "author": {"login": "jdotcms"}, "path": "dotCMS/src/main/java/com/dotcms/rendering/velocity/services/PageRenderUtil.java", "diffHunk": "@@ -514,4 +510,40 @@ private String getPersonaTagToIncludeContent(final HttpServletRequest request, f\n \n         return hasPersonalizations ? currentPersonaTag : MultiTree.DOT_PERSONALIZATION_DEFAULT;\n     }\n+\n+    private static class ContainerUUIDPersona {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4c9d9defcb469490f42cf5eadfac8dc78e286063"}, "originalPosition": 89}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTYwMzE1OA==", "bodyText": "done bbd1763#diff-135d6f9eb01eb89ef742b83753636596a41a9e3ab757abd4347b57e80ae892e0R517", "url": "https://github.com/dotCMS/core/pull/19447#discussion_r505603158", "createdAt": "2020-10-15T14:46:50Z", "author": {"login": "freddyucv"}, "path": "dotCMS/src/main/java/com/dotcms/rendering/velocity/services/PageRenderUtil.java", "diffHunk": "@@ -514,4 +510,40 @@ private String getPersonaTagToIncludeContent(final HttpServletRequest request, f\n \n         return hasPersonalizations ? currentPersonaTag : MultiTree.DOT_PERSONALIZATION_DEFAULT;\n     }\n+\n+    private static class ContainerUUIDPersona {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDg5MDE1Nw=="}, "originalCommit": {"oid": "4c9d9defcb469490f42cf5eadfac8dc78e286063"}, "originalPosition": 89}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE4NzI1MTMxOnYy", "diffSide": "RIGHT", "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQyMDoxNjo1NFrOHlPXgg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQyMDoxNjo1NFrOHlPXgg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODgxMTEzOA==", "bodyText": "Codacy found an issue: A method/constructor should not explicitly throw java.lang.Exception", "url": "https://github.com/dotCMS/core/pull/19447#discussion_r508811138", "createdAt": "2020-10-20T20:16:54Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "diffHunk": "@@ -1653,6 +1658,103 @@ public void pageWithSidebarShouldRender() throws Exception{\n         assertTrue(firstIndex != -1 && secondIndex != -1 && firstIndex != secondIndex && thirdIndex == -1);\n     }\n \n+    /**\n+     * Method to test: {@link HTMLPageAssetRenderedAPI#getPageHtml(PageContext, HttpServletRequest, HttpServletResponse)}\n+     * When: A page has multiple personas version, and the container has a MAx contentlet equals to 1\n+     * Should: render the page\n+     */\n+    @Test\n+    public void pageWithMultiplePersona() throws Exception{", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "874cf5507ca3c965a400ea59ef55ad142d6dedb5"}, "originalPosition": 37}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1767, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}