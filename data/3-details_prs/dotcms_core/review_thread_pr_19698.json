{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM3NDcwODYw", "number": 19698, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQyMjoyNToxM1rOFEPW8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQxNDozNTo0NVrOFFA4KA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM5OTkwMjU4OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/main/java/com/dotcms/rest/api/v1/authentication/ApiTokenResource.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQyMjoyNToxM1rOIESHJw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQyMzowMjo0MVrOIETqQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTM2MTk1OQ==", "bodyText": "Shouldn't this be the first evaluation?", "url": "https://github.com/dotCMS/core/pull/19698#discussion_r541361959", "createdAt": "2020-12-11T22:25:13Z", "author": {"login": "victoralfaro-dotcms"}, "path": "dotCMS/src/main/java/com/dotcms/rest/api/v1/authentication/ApiTokenResource.java", "diffHunk": "@@ -166,19 +160,27 @@ public final Response deleteApiToken(@Context final HttpServletRequest request,\n     @NoCache\n     @Consumes(MediaType.APPLICATION_JSON)\n     @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n-    public final Response issueApiToken(@Context final HttpServletRequest request,\n-                                   @Context final HttpServletResponse response,\n-                                   final ApiTokenForm formData) {\n+    public final Response issueApiToken(\n+            @Context final HttpServletRequest request,\n+            @Context final HttpServletResponse response,\n+            final ApiTokenForm formData) throws DotDataException, DotSecurityException {\n         \n         final InitDataObject initDataObject = this.webResource.init(null, true, request, true, null);\n         final User requestingUser = initDataObject.getUser();\n-        final User forUser = Try.of(()->APILocator.getUserAPI().loadUserById(formData.userId,requestingUser, false )).getOrNull();\n-        \n-        if(forUser == null) {\n+        final User forUser = formData.userId != null ? getUserById(formData, requestingUser) : requestingUser;\n+\n+        if (requestingUser != forUser && !requestingUser.isAdmin()) {\n+            throw new DotDataException(\"Just Admin user can request a Token for another user\");\n+        }\n \n+        if(forUser == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "580bf7483e1b994d91ca4713795d8d01a29bd94e"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTM4NzMyOA==", "bodyText": "done 95a2812", "url": "https://github.com/dotCMS/core/pull/19698#discussion_r541387328", "createdAt": "2020-12-11T23:02:41Z", "author": {"login": "freddyucv"}, "path": "dotCMS/src/main/java/com/dotcms/rest/api/v1/authentication/ApiTokenResource.java", "diffHunk": "@@ -166,19 +160,27 @@ public final Response deleteApiToken(@Context final HttpServletRequest request,\n     @NoCache\n     @Consumes(MediaType.APPLICATION_JSON)\n     @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n-    public final Response issueApiToken(@Context final HttpServletRequest request,\n-                                   @Context final HttpServletResponse response,\n-                                   final ApiTokenForm formData) {\n+    public final Response issueApiToken(\n+            @Context final HttpServletRequest request,\n+            @Context final HttpServletResponse response,\n+            final ApiTokenForm formData) throws DotDataException, DotSecurityException {\n         \n         final InitDataObject initDataObject = this.webResource.init(null, true, request, true, null);\n         final User requestingUser = initDataObject.getUser();\n-        final User forUser = Try.of(()->APILocator.getUserAPI().loadUserById(formData.userId,requestingUser, false )).getOrNull();\n-        \n-        if(forUser == null) {\n+        final User forUser = formData.userId != null ? getUserById(formData, requestingUser) : requestingUser;\n+\n+        if (requestingUser != forUser && !requestingUser.isAdmin()) {\n+            throw new DotDataException(\"Just Admin user can request a Token for another user\");\n+        }\n \n+        if(forUser == null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTM2MTk1OQ=="}, "originalCommit": {"oid": "580bf7483e1b994d91ca4713795d8d01a29bd94e"}, "originalPosition": 56}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQwODAxNTc2OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/main/java/com/dotcms/rest/api/v1/authentication/ApiTokenResource.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQxNDozNTo0NVrOIFTavQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQxNjo1Mzo0MlrOIFaJGw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjQzMTkzMw==", "bodyText": "update doc of the endpoint with new params of the form", "url": "https://github.com/dotCMS/core/pull/19698#discussion_r542431933", "createdAt": "2020-12-14T14:35:45Z", "author": {"login": "erickgonzalez"}, "path": "dotCMS/src/main/java/com/dotcms/rest/api/v1/authentication/ApiTokenResource.java", "diffHunk": "@@ -166,18 +160,26 @@ public final Response deleteApiToken(@Context final HttpServletRequest request,\n     @NoCache\n     @Consumes(MediaType.APPLICATION_JSON)\n     @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n-    public final Response issueApiToken(@Context final HttpServletRequest request,\n-                                   @Context final HttpServletResponse response,\n-                                   final ApiTokenForm formData) {\n+    public final Response issueApiToken(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "95a2812fa9c6ac8f3ec611d7223a4716794ad726"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjU0MjEwNw==", "bodyText": "done 047eca1", "url": "https://github.com/dotCMS/core/pull/19698#discussion_r542542107", "createdAt": "2020-12-14T16:53:42Z", "author": {"login": "freddyucv"}, "path": "dotCMS/src/main/java/com/dotcms/rest/api/v1/authentication/ApiTokenResource.java", "diffHunk": "@@ -166,18 +160,26 @@ public final Response deleteApiToken(@Context final HttpServletRequest request,\n     @NoCache\n     @Consumes(MediaType.APPLICATION_JSON)\n     @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n-    public final Response issueApiToken(@Context final HttpServletRequest request,\n-                                   @Context final HttpServletResponse response,\n-                                   final ApiTokenForm formData) {\n+    public final Response issueApiToken(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjQzMTkzMw=="}, "originalCommit": {"oid": "95a2812fa9c6ac8f3ec611d7223a4716794ad726"}, "originalPosition": 40}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1734, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}