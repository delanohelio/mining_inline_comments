{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc3MjAxNzM5", "number": 19205, "title": "#18988 _text fields should be optional", "bodyText": "With this change _text fields are indexed only if the CREATE_TEXT_INDEX_FIELD_FOR_NON_TEXT_FIELDS property is on", "createdAt": "2020-09-01T16:33:55Z", "url": "https://github.com/dotCMS/core/pull/19205", "merged": true, "mergeCommit": {"oid": "77e65587fdff15239df8b49836e3d15a097aabc9"}, "closed": true, "closedAt": "2020-09-08T19:11:50Z", "author": {"login": "nollymar"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdEqDRRgH2gAyNDc3MjAxNzM5Ojg0OWQwY2MwZTEzNjkzZDE5MDU0OTNkYTBhMzhjMGFhZGY1YTg1MDM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdG7HTAgFqTQ4NDM1NDcxMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "849d0cc0e13693d1905493da0a38c0aadf5a8503", "author": {"user": null}, "url": "https://github.com/dotCMS/core/commit/849d0cc0e13693d1905493da0a38c0aadf5a8503", "committedDate": "2020-09-01T16:32:31Z", "message": "#18988 _text fields are added to the index only if the CREATE_TEXT_INDEX_FIELD_FOR_NON_TEXT_FIELDS property is on"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ab4cd48a0213198af2796d026d6ac0acfc482bfc", "author": {"user": null}, "url": "https://github.com/dotCMS/core/commit/ab4cd48a0213198af2796d026d6ac0acfc482bfc", "committedDate": "2020-09-01T17:20:35Z", "message": "#18988 New ITs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4196eecad05b0802d9ea58bbc7d9539ed54f40f1", "author": {"user": null}, "url": "https://github.com/dotCMS/core/commit/4196eecad05b0802d9ea58bbc7d9539ed54f40f1", "committedDate": "2020-09-01T22:32:44Z", "message": "#18988 Fixing codacy suggestion and doc"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgwODgwNTUy", "url": "https://github.com/dotCMS/core/pull/19205#pullrequestreview-480880552", "createdAt": "2020-09-02T14:30:26Z", "commit": {"oid": "4196eecad05b0802d9ea58bbc7d9539ed54f40f1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgwODk2NTgw", "url": "https://github.com/dotCMS/core/pull/19205#pullrequestreview-480896580", "createdAt": "2020-09-02T14:45:50Z", "commit": {"oid": "4196eecad05b0802d9ea58bbc7d9539ed54f40f1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgwOTAwMDEy", "url": "https://github.com/dotCMS/core/pull/19205#pullrequestreview-480900012", "createdAt": "2020-09-02T14:49:14Z", "commit": {"oid": "4196eecad05b0802d9ea58bbc7d9539ed54f40f1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgwOTUxMzUw", "url": "https://github.com/dotCMS/core/pull/19205#pullrequestreview-480951350", "createdAt": "2020-09-02T15:38:35Z", "commit": {"oid": "4196eecad05b0802d9ea58bbc7d9539ed54f40f1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQxNTozODozNVrOHL1Uwg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQxNTozODozNVrOHL1Uwg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjE3MDA1MA==", "bodyText": "this could be reduce to\ncontentletMap.put(ESMappingConstants.PUBLISH_DATE,\n                        elasticSearchDateTimeFormat.format(UtilMethods.isSet(contentIdentifier.getSysPublishDate())?contentIdentifier.getSysPublishDate():versionInfo.getVersionTs()));\n\nUp to you", "url": "https://github.com/dotCMS/core/pull/19205#discussion_r482170050", "createdAt": "2020-09-02T15:38:35Z", "author": {"login": "jdotcms"}, "path": "dotCMS/src/main/java/com/dotcms/content/elasticsearch/business/ESMappingAPIImpl.java", "diffHunk": "@@ -286,29 +278,26 @@ public String toJson(final Contentlet contentlet) throws DotMappingException {\n \t\t\t//add workflow to map\n \t\t\tcontentletMap.putAll(getWorkflowInfoForContentlet(contentlet));\n \n-\t\t\tif(UtilMethods.isSet(contentIdentifier.getSysPublishDate())) {\n-\t\t\t\tcontentletMap.put(ESMappingConstants.PUBLISH_DATE, elasticSearchDateTimeFormat.format(contentIdentifier.getSysPublishDate()));\n-\t\t\t\tcontentletMap.put(ESMappingConstants.PUBLISH_DATE + TEXT,\n-\t\t\t\t\t\tdatetimeFormat.format(contentIdentifier.getSysPublishDate()));\n-\t\t\t}else {\n-\t\t\t\tcontentletMap.put(ESMappingConstants.PUBLISH_DATE, elasticSearchDateTimeFormat.format(versionInfo.getVersionTs()));\n-\t\t\t\tcontentletMap.put(ESMappingConstants.PUBLISH_DATE + TEXT,\n-\t\t\t\t\t\tdatetimeFormat.format(versionInfo.getVersionTs()));\n-\t\t\t}\n+            if (UtilMethods.isSet(contentIdentifier.getSysPublishDate())) {\n+                contentletMap.put(ESMappingConstants.PUBLISH_DATE,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4196eecad05b0802d9ea58bbc7d9539ed54f40f1"}, "originalPosition": 40}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgwOTUyMTM2", "url": "https://github.com/dotCMS/core/pull/19205#pullrequestreview-480952136", "createdAt": "2020-09-02T15:39:26Z", "commit": {"oid": "4196eecad05b0802d9ea58bbc7d9539ed54f40f1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQxNTozOToyNlrOHL1XMQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQxNTozOToyNlrOHL1XMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjE3MDY3Mw==", "bodyText": "same thing", "url": "https://github.com/dotCMS/core/pull/19205#discussion_r482170673", "createdAt": "2020-09-02T15:39:26Z", "author": {"login": "jdotcms"}, "path": "dotCMS/src/main/java/com/dotcms/content/elasticsearch/business/ESMappingAPIImpl.java", "diffHunk": "@@ -286,29 +278,26 @@ public String toJson(final Contentlet contentlet) throws DotMappingException {\n \t\t\t//add workflow to map\n \t\t\tcontentletMap.putAll(getWorkflowInfoForContentlet(contentlet));\n \n-\t\t\tif(UtilMethods.isSet(contentIdentifier.getSysPublishDate())) {\n-\t\t\t\tcontentletMap.put(ESMappingConstants.PUBLISH_DATE, elasticSearchDateTimeFormat.format(contentIdentifier.getSysPublishDate()));\n-\t\t\t\tcontentletMap.put(ESMappingConstants.PUBLISH_DATE + TEXT,\n-\t\t\t\t\t\tdatetimeFormat.format(contentIdentifier.getSysPublishDate()));\n-\t\t\t}else {\n-\t\t\t\tcontentletMap.put(ESMappingConstants.PUBLISH_DATE, elasticSearchDateTimeFormat.format(versionInfo.getVersionTs()));\n-\t\t\t\tcontentletMap.put(ESMappingConstants.PUBLISH_DATE + TEXT,\n-\t\t\t\t\t\tdatetimeFormat.format(versionInfo.getVersionTs()));\n-\t\t\t}\n+            if (UtilMethods.isSet(contentIdentifier.getSysPublishDate())) {\n+                contentletMap.put(ESMappingConstants.PUBLISH_DATE,\n+                        elasticSearchDateTimeFormat.format(contentIdentifier.getSysPublishDate()));\n+            } else {\n+                contentletMap.put(ESMappingConstants.PUBLISH_DATE,\n+                        elasticSearchDateTimeFormat.format(versionInfo.getVersionTs()));\n+            }\n \n-\t\t\tif(UtilMethods.isSet(contentIdentifier.getSysExpireDate())) {\n-\t\t\t\tcontentletMap.put(ESMappingConstants.EXPIRE_DATE, elasticSearchDateTimeFormat.format(contentIdentifier.getSysExpireDate()));\n-\t\t\t\tcontentletMap.put(ESMappingConstants.EXPIRE_DATE + TEXT,\n-\t\t\t\t\t\tdatetimeFormat.format(contentIdentifier.getSysExpireDate()));\n-\t\t\t}else {\n-\t\t\t\tcontentletMap.put(ESMappingConstants.EXPIRE_DATE, elasticSearchDateTimeFormat.format(29990101000000L));\n-\t\t\t\tcontentletMap.put(ESMappingConstants.EXPIRE_DATE + TEXT, \"29990101000000\");\n-\t\t\t}\n+            if (UtilMethods.isSet(contentIdentifier.getSysExpireDate())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4196eecad05b0802d9ea58bbc7d9539ed54f40f1"}, "originalPosition": 55}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgwOTUzMjM2", "url": "https://github.com/dotCMS/core/pull/19205#pullrequestreview-480953236", "createdAt": "2020-09-02T15:40:36Z", "commit": {"oid": "4196eecad05b0802d9ea58bbc7d9539ed54f40f1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQxNTo0MDozNlrOHL1akw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQxNTo0MDozNlrOHL1akw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjE3MTUzOQ==", "bodyText": "it is meaningless, rename it", "url": "https://github.com/dotCMS/core/pull/19205#discussion_r482171539", "createdAt": "2020-09-02T15:40:36Z", "author": {"login": "jdotcms"}, "path": "dotCMS/src/main/java/com/dotcms/content/elasticsearch/business/ESMappingAPIImpl.java", "diffHunk": "@@ -567,11 +612,14 @@ protected void loadPermissions(final Contentlet con, final Map<String,Object> m)\n \t\t}\n \t\tm.put(ESMappingConstants.PERMISSIONS, permissionsSt.toString());\n \t\tm.put(ESMappingConstants.OWNER_CAN_READ, ownerCanRead);\n-\t\tm.put(ESMappingConstants.OWNER_CAN_READ + TEXT, Boolean.toString(ownerCanRead));\n \t\tm.put(ESMappingConstants.OWNER_CAN_WRITE, ownerCanWrite);\n-\t\tm.put(ESMappingConstants.OWNER_CAN_WRITE + TEXT, Boolean.toString(ownerCanWrite));\n \t\tm.put(ESMappingConstants.OWNER_CAN_PUBLISH, ownerCanPub);\n-\t\tm.put(ESMappingConstants.OWNER_CAN_PUBLISH + TEXT, Boolean.toString(ownerCanPub));\n+\n+        if (Config.getBooleanProperty(\"CREATE_TEXT_INDEX_FIELD_FOR_NON_TEXT_FIELDS\", false)) {\n+            m.put(ESMappingConstants.OWNER_CAN_READ + TEXT, Boolean.toString(ownerCanRead));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4196eecad05b0802d9ea58bbc7d9539ed54f40f1"}, "originalPosition": 155}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgwOTU3NDUz", "url": "https://github.com/dotCMS/core/pull/19205#pullrequestreview-480957453", "createdAt": "2020-09-02T15:44:57Z", "commit": {"oid": "4196eecad05b0802d9ea58bbc7d9539ed54f40f1"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQxNTo0NDo1OFrOHL1mxA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQxNTo0NDo1OFrOHL1mxA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjE3NDY2MA==", "bodyText": "I think we need to treat methods with void returns as a code smell  especially if we are passing in an object that is intended to be mutated under the covers.  This to me is an coding anti-pattern.\nA better choice for this method for example  is to return an Optional that if it is present, gets added to the existing collection.  That allows for simpler testing and a clear understanding of what object is being changed when this method is called.", "url": "https://github.com/dotCMS/core/pull/19205#discussion_r482174660", "createdAt": "2020-09-02T15:44:58Z", "author": {"login": "wezell"}, "path": "dotCMS/src/main/java/com/dotcms/content/elasticsearch/business/ESMappingAPIImpl.java", "diffHunk": "@@ -384,6 +373,59 @@ public String toJson(final Contentlet contentlet) throws DotMappingException {\n \t\t}\n \t}\n \n+    /**\n+     * Fields with suffix _text will be indexed if the property `CREATE_TEXT_INDEX_FIELD_FOR_NON_TEXT_FIELDS` is on\n+     * @param contentletMap\n+     * @param contentlet\n+     * @param contentIdentifier\n+     * @param versionInfo\n+     * @param contentType\n+     * @throws DotSecurityException\n+     * @throws DotDataException\n+     */\n+    private void addTextFieldToMapIfNeeded(final Map<String, Object> contentletMap,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4196eecad05b0802d9ea58bbc7d9539ed54f40f1"}, "originalPosition": 86}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bfd22e09d4e0a6d5ef04032d781ae8f4524de09b", "author": {"user": null}, "url": "https://github.com/dotCMS/core/commit/bfd22e09d4e0a6d5ef04032d781ae8f4524de09b", "committedDate": "2020-09-02T17:50:37Z", "message": "#18988 Applying code review suggestions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7fc3b9d2e41b5bdf974fd89315837a5a1d1b0703", "author": {"user": null}, "url": "https://github.com/dotCMS/core/commit/7fc3b9d2e41b5bdf974fd89315837a5a1d1b0703", "committedDate": "2020-09-02T22:33:15Z", "message": "#18988 Applying code review suggestion"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgxNDIyMDgx", "url": "https://github.com/dotCMS/core/pull/19205#pullrequestreview-481422081", "createdAt": "2020-09-03T01:29:49Z", "commit": {"oid": "7fc3b9d2e41b5bdf974fd89315837a5a1d1b0703"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ffa4ffcb0acd07d4c288d2234fc187747d95146a", "author": {"user": null}, "url": "https://github.com/dotCMS/core/commit/ffa4ffcb0acd07d4c288d2234fc187747d95146a", "committedDate": "2020-09-04T20:35:05Z", "message": "#18988 Fixing IT that was broken with my previous change"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "59db67ded9276c46442fa45336efc99a767ffe7f", "author": {"user": null}, "url": "https://github.com/dotCMS/core/commit/59db67ded9276c46442fa45336efc99a767ffe7f", "committedDate": "2020-09-04T22:48:51Z", "message": "#18988 Fixing IT"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9c7dd8b91bed8c771ea66eb9291cc098ec7e3d05", "author": {"user": null}, "url": "https://github.com/dotCMS/core/commit/9c7dd8b91bed8c771ea66eb9291cc098ec7e3d05", "committedDate": "2020-09-08T17:26:03Z", "message": "#18988 Fixing IT"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg0MzU0NzEx", "url": "https://github.com/dotCMS/core/pull/19205#pullrequestreview-484354711", "createdAt": "2020-09-08T17:33:09Z", "commit": {"oid": "9c7dd8b91bed8c771ea66eb9291cc098ec7e3d05"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxNzozMzowOVrOHOnTxQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxNzozMzowOVrOHOnTxQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTA4NjE0OQ==", "bodyText": "Codacy found an issue: Avoid unused imports such as 'com.dotmarketing.util.Config'", "url": "https://github.com/dotCMS/core/pull/19205#discussion_r485086149", "createdAt": "2020-09-08T17:33:09Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/content/elasticsearch/util/ESMappingUtilHelperTest.java", "diffHunk": "@@ -43,6 +43,7 @@\n import com.dotmarketing.portlets.contentlet.model.Contentlet;\n import com.dotmarketing.portlets.languagesmanager.model.Language;\n import com.dotmarketing.portlets.structure.model.Relationship;\n+import com.dotmarketing.util.Config;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9c7dd8b91bed8c771ea66eb9291cc098ec7e3d05"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1830, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}