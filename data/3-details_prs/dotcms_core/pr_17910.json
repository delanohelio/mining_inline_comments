{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY3MDA4Mzk3", "number": 17910, "title": "#16852 reduce log, adapt tests to new return", "bodyText": "These changes are to reduce the log when importing content with a bad URL, we were showing the same error twice.", "createdAt": "2020-01-24T20:43:16Z", "url": "https://github.com/dotCMS/core/pull/17910", "merged": true, "mergeCommit": {"oid": "11c416dfa5bb890701146b931001e426f319c50f"}, "closed": true, "closedAt": "2020-01-27T15:49:10Z", "author": {"login": "erickgonzalez"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb9lEUjgH2gAyMzY3MDA4Mzk3OjBiY2NlY2YyNzJhNzEwZjMxMTczOWYzZDg0MGM0ZTYwMGUxNjE3MWY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb9nxwKgFqTM0ODI4MjYyOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0bccecf272a710f311739f3d840c4e600e16171f", "author": {"user": {"login": "erickgonzalez", "name": null}}, "url": "https://github.com/dotCMS/core/commit/0bccecf272a710f311739f3d840c4e600e16171f", "committedDate": "2020-01-24T20:35:31Z", "message": "#16852 reduce log, adapt tests to new return"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ4MjIyNjU0", "url": "https://github.com/dotCMS/core/pull/17910#pullrequestreview-348222654", "createdAt": "2020-01-24T21:02:40Z", "commit": {"oid": "0bccecf272a710f311739f3d840c4e600e16171f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQyMTowMjo0MFrOFhqUCg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQyMTowMjo0MFrOFhqUCg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg0MDU4Ng==", "bodyText": "is this line still needed?", "url": "https://github.com/dotCMS/core/pull/17910#discussion_r370840586", "createdAt": "2020-01-24T21:02:40Z", "author": {"login": "dsilvam"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rest/api/v1/temp/TempFileAPITest.java", "diffHunk": "@@ -19,25 +19,25 @@ public static void prepare() throws Exception {\n     }\n \n     @Test(expected = BadRequestException.class)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0bccecf272a710f311739f3d840c4e600e16171f"}, "originalPosition": 3}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ4MjIyNzA3", "url": "https://github.com/dotCMS/core/pull/17910#pullrequestreview-348222707", "createdAt": "2020-01-24T21:02:46Z", "commit": {"oid": "0bccecf272a710f311739f3d840c4e600e16171f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQyMTowMjo0N1rOFhqUQg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQyMTowMjo0N1rOFhqUQg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg0MDY0Mg==", "bodyText": "same as above", "url": "https://github.com/dotCMS/core/pull/17910#discussion_r370840642", "createdAt": "2020-01-24T21:02:47Z", "author": {"login": "dsilvam"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rest/api/v1/temp/TempFileAPITest.java", "diffHunk": "@@ -19,25 +19,25 @@ public static void prepare() throws Exception {\n     }\n \n     @Test(expected = BadRequestException.class)\n-    public void testValidURL_urlReturn400_throwsException() throws IOException {\n+    public void testValidURL_urlReturn400_throwsException() {\n         final String url =  \"https://raw.githubusercontent.com/url/throws/400.jpg\";\n-        APILocator.getTempFileAPI().validUrl(url);\n+        assertFalse(APILocator.getTempFileAPI().validUrl(url));\n     }\n \n     @Test(expected = BadRequestException.class)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0bccecf272a710f311739f3d840c4e600e16171f"}, "originalPosition": 11}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8da0d78457b5e4396bff27e50ad03c8d775e7ed8", "author": {"user": {"login": "erickgonzalez", "name": null}}, "url": "https://github.com/dotCMS/core/commit/8da0d78457b5e4396bff27e50ad03c8d775e7ed8", "committedDate": "2020-01-24T21:04:44Z", "message": "#16852 code review"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ4MjI5NzMy", "url": "https://github.com/dotCMS/core/pull/17910#pullrequestreview-348229732", "createdAt": "2020-01-24T21:17:23Z", "commit": {"oid": "8da0d78457b5e4396bff27e50ad03c8d775e7ed8"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQyMToyMDoxN1rOFhqt8Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQyMToyMDoxN1rOFhqt8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg0NzIxNw==", "bodyText": "remove this, the method is not throwing a IOException anymore", "url": "https://github.com/dotCMS/core/pull/17910#discussion_r370847217", "createdAt": "2020-01-24T21:20:17Z", "author": {"login": "freddyucv"}, "path": "dotCMS/src/main/java/com/dotcms/rest/api/v1/temp/TempFileAPI.java", "diffHunk": "@@ -217,17 +217,20 @@ public DotTempFile createTempFileFromUrl(final String incomingFileName,\n    * @return\n    * @throws IOException", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8da0d78457b5e4396bff27e50ad03c8d775e7ed8"}, "originalPosition": 2}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ4MjMxNDY3", "url": "https://github.com/dotCMS/core/pull/17910#pullrequestreview-348231467", "createdAt": "2020-01-24T21:21:12Z", "commit": {"oid": "8da0d78457b5e4396bff27e50ad03c8d775e7ed8"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQyMToyMToxMlrOFhqvNA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yNFQyMToyMjoxMlrOFhqw3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg0NzU0MA==", "bodyText": "If we don't want this error in the logs I would remove it instead of change it to warn, is not a warning, is an error.\nBut to be honest I don't see the problem on having the extra error log in there.", "url": "https://github.com/dotCMS/core/pull/17910#discussion_r370847540", "createdAt": "2020-01-24T21:21:12Z", "author": {"login": "jgambarios"}, "path": "dotCMS/src/main/java/com/dotmarketing/util/ImportUtil.java", "diffHunk": "@@ -1476,7 +1475,7 @@ private static void importLine ( String[] line, String currentHostId, Structure\n                 }\n             }\n         } catch (Exception e) {\n-            Logger.error(ImportUtil.class,e.getMessage(),e);\n+            Logger.warn(ImportUtil.class,e.getMessage());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8da0d78457b5e4396bff27e50ad03c8d775e7ed8"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg0Nzk2NA==", "bodyText": "We should handle the specific !=200 case instead of just catch any exception, we could be hiding real errors.", "url": "https://github.com/dotCMS/core/pull/17910#discussion_r370847964", "createdAt": "2020-01-24T21:22:12Z", "author": {"login": "jgambarios"}, "path": "dotCMS/src/main/java/com/dotcms/rest/api/v1/temp/TempFileAPI.java", "diffHunk": "@@ -217,17 +217,20 @@ public DotTempFile createTempFileFromUrl(final String incomingFileName,\n    * @return\n    * @throws IOException\n    */\n-  public boolean validUrl(final String url) throws IOException {\n+  public boolean validUrl(final String url) {\n \n     if(!(url.toLowerCase().startsWith(\"http://\") ||\n             url.toLowerCase().startsWith(\"https://\"))){\n       Logger.error(this, \"URL does not starts with http or https\");\n       return false;\n     }\n-\n-    final CircuitBreakerUrl urlGetter =\n-            CircuitBreakerUrl.builder().setMethod(Method.GET).setUrl(url).build();\n-    urlGetter.doString();\n+    try {\n+      final CircuitBreakerUrl urlGetter =\n+              CircuitBreakerUrl.builder().setMethod(Method.GET).setUrl(url).build();\n+      urlGetter.doString();\n+    } catch (Exception e) {//If response is not 200, url is invalid", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8da0d78457b5e4396bff27e50ad03c8d775e7ed8"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7b7a6eed4d7ea21ad1c93ce3d2c3f0857e98217a", "author": {"user": {"login": "erickgonzalez", "name": null}}, "url": "https://github.com/dotCMS/core/commit/7b7a6eed4d7ea21ad1c93ce3d2c3f0857e98217a", "committedDate": "2020-01-24T22:05:14Z", "message": "#16852 code review, better handling exceptions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ4MjUzMzM0", "url": "https://github.com/dotCMS/core/pull/17910#pullrequestreview-348253334", "createdAt": "2020-01-24T22:09:27Z", "commit": {"oid": "7b7a6eed4d7ea21ad1c93ce3d2c3f0857e98217a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ4MjgyNjI4", "url": "https://github.com/dotCMS/core/pull/17910#pullrequestreview-348282628", "createdAt": "2020-01-24T23:44:57Z", "commit": {"oid": "7b7a6eed4d7ea21ad1c93ce3d2c3f0857e98217a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1337, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}