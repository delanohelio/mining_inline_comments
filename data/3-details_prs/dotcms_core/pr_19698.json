{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM3NDcwODYw", "number": 19698, "title": "#19275 Fixing", "bodyText": "Fixing #19275 (comment)", "createdAt": "2020-12-11T22:11:40Z", "url": "https://github.com/dotCMS/core/pull/19698", "merged": true, "mergeCommit": {"oid": "8bda06314315b47ee4e9b5ec2e892a83fa3338f5"}, "closed": true, "closedAt": "2020-12-14T18:59:03Z", "author": {"login": "freddyucv"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdlPa5JgH2gAyNTM3NDcwODYwOjMzZjc1ZmQ3MWQyNzM2MDZhOTBmYjBhMjEyNzViYTZjNGQzYzJhMjM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdmIzeEgFqTU1MTYyMjg5MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "33f75fd71d273606a90fb0a21275ba6c4d3c2a23", "author": {"user": {"login": "freddyucv", "name": "Freddy Rodriguez"}}, "url": "https://github.com/dotCMS/core/commit/33f75fd71d273606a90fb0a21275ba6c4d3c2a23", "committedDate": "2020-12-11T22:10:23Z", "message": "#19275 Fixing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "580bf7483e1b994d91ca4713795d8d01a29bd94e", "author": {"user": {"login": "freddyucv", "name": "Freddy Rodriguez"}}, "url": "https://github.com/dotCMS/core/commit/580bf7483e1b994d91ca4713795d8d01a29bd94e", "committedDate": "2020-12-11T22:17:34Z", "message": "removing console.log"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUwNjE3OTUw", "url": "https://github.com/dotCMS/core/pull/19698#pullrequestreview-550617950", "createdAt": "2020-12-11T22:25:13Z", "commit": {"oid": "580bf7483e1b994d91ca4713795d8d01a29bd94e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQyMjoyNToxM1rOIESHJw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQyMjoyNToxM1rOIESHJw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTM2MTk1OQ==", "bodyText": "Shouldn't this be the first evaluation?", "url": "https://github.com/dotCMS/core/pull/19698#discussion_r541361959", "createdAt": "2020-12-11T22:25:13Z", "author": {"login": "victoralfaro-dotcms"}, "path": "dotCMS/src/main/java/com/dotcms/rest/api/v1/authentication/ApiTokenResource.java", "diffHunk": "@@ -166,19 +160,27 @@ public final Response deleteApiToken(@Context final HttpServletRequest request,\n     @NoCache\n     @Consumes(MediaType.APPLICATION_JSON)\n     @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n-    public final Response issueApiToken(@Context final HttpServletRequest request,\n-                                   @Context final HttpServletResponse response,\n-                                   final ApiTokenForm formData) {\n+    public final Response issueApiToken(\n+            @Context final HttpServletRequest request,\n+            @Context final HttpServletResponse response,\n+            final ApiTokenForm formData) throws DotDataException, DotSecurityException {\n         \n         final InitDataObject initDataObject = this.webResource.init(null, true, request, true, null);\n         final User requestingUser = initDataObject.getUser();\n-        final User forUser = Try.of(()->APILocator.getUserAPI().loadUserById(formData.userId,requestingUser, false )).getOrNull();\n-        \n-        if(forUser == null) {\n+        final User forUser = formData.userId != null ? getUserById(formData, requestingUser) : requestingUser;\n+\n+        if (requestingUser != forUser && !requestingUser.isAdmin()) {\n+            throw new DotDataException(\"Just Admin user can request a Token for another user\");\n+        }\n \n+        if(forUser == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "580bf7483e1b994d91ca4713795d8d01a29bd94e"}, "originalPosition": 56}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "95a2812fa9c6ac8f3ec611d7223a4716794ad726", "author": {"user": {"login": "freddyucv", "name": "Freddy Rodriguez"}}, "url": "https://github.com/dotCMS/core/commit/95a2812fa9c6ac8f3ec611d7223a4716794ad726", "committedDate": "2020-12-11T23:02:07Z", "message": "Refactoring"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUwNjMzNDUw", "url": "https://github.com/dotCMS/core/pull/19698#pullrequestreview-550633450", "createdAt": "2020-12-11T23:04:39Z", "commit": {"oid": "95a2812fa9c6ac8f3ec611d7223a4716794ad726"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUxNDI2OTgw", "url": "https://github.com/dotCMS/core/pull/19698#pullrequestreview-551426980", "createdAt": "2020-12-14T14:35:45Z", "commit": {"oid": "95a2812fa9c6ac8f3ec611d7223a4716794ad726"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQxNDozNTo0NVrOIFTavQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQxNDozNTo0NVrOIFTavQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjQzMTkzMw==", "bodyText": "update doc of the endpoint with new params of the form", "url": "https://github.com/dotCMS/core/pull/19698#discussion_r542431933", "createdAt": "2020-12-14T14:35:45Z", "author": {"login": "erickgonzalez"}, "path": "dotCMS/src/main/java/com/dotcms/rest/api/v1/authentication/ApiTokenResource.java", "diffHunk": "@@ -166,18 +160,26 @@ public final Response deleteApiToken(@Context final HttpServletRequest request,\n     @NoCache\n     @Consumes(MediaType.APPLICATION_JSON)\n     @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n-    public final Response issueApiToken(@Context final HttpServletRequest request,\n-                                   @Context final HttpServletResponse response,\n-                                   final ApiTokenForm formData) {\n+    public final Response issueApiToken(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "95a2812fa9c6ac8f3ec611d7223a4716794ad726"}, "originalPosition": 40}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "047eca133554e37b9db8a424b1bf434249c6826a", "author": {"user": {"login": "freddyucv", "name": "Freddy Rodriguez"}}, "url": "https://github.com/dotCMS/core/commit/047eca133554e37b9db8a424b1bf434249c6826a", "committedDate": "2020-12-14T16:53:19Z", "message": "Adding doc"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUxNjIyODkw", "url": "https://github.com/dotCMS/core/pull/19698#pullrequestreview-551622890", "createdAt": "2020-12-14T17:01:49Z", "commit": {"oid": "047eca133554e37b9db8a424b1bf434249c6826a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1696, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}