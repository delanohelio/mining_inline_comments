{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkwNTgwMTU3", "number": 19294, "title": "Issue 18550 migrate cvi away from hibernate", "bodyText": "", "createdAt": "2020-09-21T21:53:38Z", "url": "https://github.com/dotCMS/core/pull/19294", "merged": true, "mergeCommit": {"oid": "a3cda524b8220ca5801bfd8b402ed274b6cb8145"}, "closed": true, "closedAt": "2020-10-14T22:55:06Z", "author": {"login": "dsilvam"}, "timelineItems": {"totalCount": 55, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdJ575dAH2gAyNDkwNTgwMTU3OjM2OTEyZDhmMzg4YjdmMTk1ODZlZTRmN2IwMWRjZGQ2N2QwODc3Mzk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdSlG7yAFqTUwODgyMTM4Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "36912d8f388b7f19586ee4f7b01dcdd67d087739", "author": {"user": {"login": "dsilvam", "name": "Daniel Silva"}}, "url": "https://github.com/dotCMS/core/commit/36912d8f388b7f19586ee4f7b01dcdd67d087739", "committedDate": "2020-09-17T23:52:34Z", "message": "#18550 first draft"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "936a8f78bc53c593450acebce154e8b43ed1e12f", "author": {"user": {"login": "dsilvam", "name": "Daniel Silva"}}, "url": "https://github.com/dotCMS/core/commit/936a8f78bc53c593450acebce154e8b43ed1e12f", "committedDate": "2020-09-18T19:55:09Z", "message": "#18550 cast to String to preserve null"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8cd2b23a93eb1e5b7656bd43f595c824d2f73be1", "author": {"user": {"login": "dsilvam", "name": "Daniel Silva"}}, "url": "https://github.com/dotCMS/core/commit/8cd2b23a93eb1e5b7656bd43f595c824d2f73be1", "committedDate": "2020-09-18T21:29:27Z", "message": "#18550 try with new factory impl"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "714a2df9dbdd902761b54233c2ab5aa455c57635", "author": {"user": {"login": "dsilvam", "name": "Daniel Silva"}}, "url": "https://github.com/dotCMS/core/commit/714a2df9dbdd902761b54233c2ab5aa455c57635", "committedDate": "2020-09-21T21:51:51Z", "message": "#18550 create cvi migrated to dotconnect"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4db0bb7d3eff4a7fa7f922dfa267b47168038737", "author": {"user": {"login": "dsilvam", "name": "Daniel Silva"}}, "url": "https://github.com/dotCMS/core/commit/4db0bb7d3eff4a7fa7f922dfa267b47168038737", "committedDate": "2020-09-21T22:54:52Z", "message": "Merge branch 'master' of github.com:dotCMS/core into issue-18550-migrate-cvi-away-from-hibernate"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c591c3f92641afbdbe70a101b26631910a121fab", "author": {"user": {"login": "dsilvam", "name": "Daniel Silva"}}, "url": "https://github.com/dotCMS/core/commit/c591c3f92641afbdbe70a101b26631910a121fab", "committedDate": "2020-09-22T18:21:31Z", "message": "#18550 fix transformer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "abcf4378561372f74f236a033715aec5be7ab926", "author": {"user": {"login": "dsilvam", "name": "Daniel Silva"}}, "url": "https://github.com/dotCMS/core/commit/abcf4378561372f74f236a033715aec5be7ab926", "committedDate": "2020-09-23T18:19:18Z", "message": "#18550 return empty object instead of null, like hibernate did"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bc0f3a6fdc8bf885afeddf274bd9715696aa3e54", "author": {"user": {"login": "dsilvam", "name": "Daniel Silva"}}, "url": "https://github.com/dotCMS/core/commit/bc0f3a6fdc8bf885afeddf274bd9715696aa3e54", "committedDate": "2020-09-23T18:20:58Z", "message": "#18550 codacy feedback"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b479eede5513c69cf49022987ca547d0d9c94984", "author": {"user": {"login": "dsilvam", "name": "Daniel Silva"}}, "url": "https://github.com/dotCMS/core/commit/b479eede5513c69cf49022987ca547d0d9c94984", "committedDate": "2020-09-23T18:26:16Z", "message": "#18550 proper doc"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7cfda6869de41769141922c8b30af3c80184ef2b", "author": {"user": {"login": "dsilvam", "name": "Daniel Silva"}}, "url": "https://github.com/dotCMS/core/commit/7cfda6869de41769141922c8b30af3c80184ef2b", "committedDate": "2020-09-23T18:28:11Z", "message": "#18550 include deprecated annotation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "84e99da054e1f6f0ca096b63ca8c00abcf37ef77", "author": {"user": {"login": "dsilvam", "name": "Daniel Silva"}}, "url": "https://github.com/dotCMS/core/commit/84e99da054e1f6f0ca096b63ca8c00abcf37ef77", "committedDate": "2020-09-24T23:01:57Z", "message": "#18550 change signature of getContentletVersion info part I"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd5a404b04a9800d5f7d974333a217fe6bec6ce2", "author": {"user": {"login": "dsilvam", "name": "Daniel Silva"}}, "url": "https://github.com/dotCMS/core/commit/bd5a404b04a9800d5f7d974333a217fe6bec6ce2", "committedDate": "2020-09-25T21:48:39Z", "message": "#18550 custom ee jar to run tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "942c8b1eff343e3bfd06664156a2448fbaba0544", "author": {"user": {"login": "dsilvam", "name": "Daniel Silva"}}, "url": "https://github.com/dotCMS/core/commit/942c8b1eff343e3bfd06664156a2448fbaba0544", "committedDate": "2020-09-25T23:31:35Z", "message": "#18550 fix wrong return"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6275687cc07ad20d5d8fec1603b36ff7092e46aa", "author": {"user": {"login": "dsilvam", "name": "Daniel Silva"}}, "url": "https://github.com/dotCMS/core/commit/6275687cc07ad20d5d8fec1603b36ff7092e46aa", "committedDate": "2020-09-28T19:10:12Z", "message": "#18550 fixing beanutils call"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "91394a786f18119f4385cea389ea55b3f3f382f2", "author": {"user": {"login": "dsilvam", "name": "Daniel Silva"}}, "url": "https://github.com/dotCMS/core/commit/91394a786f18119f4385cea389ea55b3f3f382f2", "committedDate": "2020-09-28T19:48:47Z", "message": "#18550 fix red in jsps"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "25153c9fa1f3a1eebc0059839da30c30280c253c", "author": {"user": {"login": "dsilvam", "name": "Daniel Silva"}}, "url": "https://github.com/dotCMS/core/commit/25153c9fa1f3a1eebc0059839da30c30280c253c", "committedDate": "2020-09-28T21:39:10Z", "message": "#18550 fix usage of optional"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "46f648d95b888bb97b27a15f3f4f9d8a919a4eab", "author": {"user": {"login": "dsilvam", "name": "Daniel Silva"}}, "url": "https://github.com/dotCMS/core/commit/46f648d95b888bb97b27a15f3f4f9d8a919a4eab", "committedDate": "2020-09-28T22:57:41Z", "message": "#18550 fix behavior when CVI not present"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f63850e7e64a69e49cecb49902df68e7637e8c54", "author": {"user": {"login": "dsilvam", "name": "Daniel Silva"}}, "url": "https://github.com/dotCMS/core/commit/f63850e7e64a69e49cecb49902df68e7637e8c54", "committedDate": "2020-09-29T17:34:24Z", "message": "#18550 remove throws from method signature"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "29fd8c3a002dfb9be3ba3adaf76816eee61668f5", "author": {"user": {"login": "dsilvam", "name": "Daniel Silva"}}, "url": "https://github.com/dotCMS/core/commit/29fd8c3a002dfb9be3ba3adaf76816eee61668f5", "committedDate": "2020-09-29T22:38:09Z", "message": "#18550 remove commeted out code"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5NTgwNzQ1", "url": "https://github.com/dotCMS/core/pull/19294#pullrequestreview-499580745", "createdAt": "2020-09-30T15:55:10Z", "commit": {"oid": "29fd8c3a002dfb9be3ba3adaf76816eee61668f5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxNTo1NToxMFrOHakaCw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxNTo1NToxMFrOHakaCw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzYyMTUxNQ==", "bodyText": "Just curious, is it OK to throw an exception here? It's because I've seen some places the expression assertTrue(opt.isPresent()) is used in tests.", "url": "https://github.com/dotCMS/core/pull/19294#discussion_r497621515", "createdAt": "2020-09-30T15:55:10Z", "author": {"login": "victoralfaro-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/content/elasticsearch/business/ContentletIndexAPIImplTest.java", "diffHunk": "@@ -603,13 +604,19 @@ public void testSearch () throws Exception {\n \n         //*****************************************************************\n         //Build a site search result in order to add it to the index\n-        ContentletVersionInfo versionInfo = APILocator.getVersionableAPI().getContentletVersionInfo(testHtmlPage.getIdentifier(), testHtmlPage.getLanguageId());\n+        Optional<ContentletVersionInfo> versionInfo = APILocator.getVersionableAPI().getContentletVersionInfo(testHtmlPage.getIdentifier(), testHtmlPage.getLanguageId());\n+\n+        if(!versionInfo.isPresent()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "29fd8c3a002dfb9be3ba3adaf76816eee61668f5"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5NTk5OTc1", "url": "https://github.com/dotCMS/core/pull/19294#pullrequestreview-499599975", "createdAt": "2020-09-30T16:16:11Z", "commit": {"oid": "29fd8c3a002dfb9be3ba3adaf76816eee61668f5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxNjoxNjoxMVrOHalS2w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxNjoxNjoxMVrOHalS2w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzYzNjA1OQ==", "bodyText": "Can we use Optional.empty() instead?", "url": "https://github.com/dotCMS/core/pull/19294#discussion_r497636059", "createdAt": "2020-09-30T16:16:11Z", "author": {"login": "victoralfaro-dotcms"}, "path": "dotCMS/src/main/java/com/dotcms/content/elasticsearch/business/ESContentletAPIImpl.java", "diffHunk": "@@ -8074,15 +8077,15 @@ public boolean canLock(final Contentlet contentlet, final User user, final boole\n                     +\" does not have Edit Permissions to lock content: \" + (contentlet != null ? contentlet.getIdentifier() : \"Unknown\"));\n         }\n \n-        String lockedBy = null;\n+        Optional<String> lockedBy = null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "29fd8c3a002dfb9be3ba3adaf76816eee61668f5"}, "originalPosition": 97}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5NjIwNDA1", "url": "https://github.com/dotCMS/core/pull/19294#pullrequestreview-499620405", "createdAt": "2020-09-30T16:40:22Z", "commit": {"oid": "29fd8c3a002dfb9be3ba3adaf76816eee61668f5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxNjo0MDoyM1rOHamQAA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxNjo0MDoyM1rOHamQAA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzY1MTcxMg==", "bodyText": "Shouldn't we check also for info.getIdentifier()is set?", "url": "https://github.com/dotCMS/core/pull/19294#discussion_r497651712", "createdAt": "2020-09-30T16:40:23Z", "author": {"login": "victoralfaro-dotcms"}, "path": "dotCMS/src/main/java/com/dotmarketing/business/VersionableAPIImpl.java", "diffHunk": "@@ -543,22 +541,23 @@ public void setWorking(final Versionable versionable) throws DotDataException, D\n         if(identifier.getAssetType().equals(\"contentlet\")) {\n \n             final Contentlet contentlet = (Contentlet)versionable;\n-            ContentletVersionInfo info = versionableFactory\n+            Optional<ContentletVersionInfo> info = versionableFactory\n                     .getContentletVersionInfo(contentlet.getIdentifier(), contentlet.getLanguageId());\n \n-            if(info ==null || !UtilMethods.isSet(info.getIdentifier())) {\n+            if(!info.isPresent()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "29fd8c3a002dfb9be3ba3adaf76816eee61668f5"}, "originalPosition": 180}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5NjI2OTM1", "url": "https://github.com/dotCMS/core/pull/19294#pullrequestreview-499626935", "createdAt": "2020-09-30T16:48:34Z", "commit": {"oid": "29fd8c3a002dfb9be3ba3adaf76816eee61668f5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxNjo0ODozNFrOHamkDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxNjo0ODozNFrOHamkDg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzY1Njg0Ng==", "bodyText": "Shouldn't we check for contentletVersionInfo.get().getLiveInode() to be set?", "url": "https://github.com/dotCMS/core/pull/19294#discussion_r497656846", "createdAt": "2020-09-30T16:48:34Z", "author": {"login": "victoralfaro-dotcms"}, "path": "dotCMS/src/main/java/com/dotmarketing/business/VersionableAPIImpl.java", "diffHunk": "@@ -690,10 +707,11 @@ public boolean hasLiveVersion(final Versionable versionable) throws DotDataExcep\n \n \t\tif(versionable instanceof Contentlet) {\n \n-\t\t\tfinal ContentletVersionInfo contentletVersionInfo = this.getContentletVersionInfo\n+\t\t\tfinal Optional<ContentletVersionInfo> contentletVersionInfo = this.getContentletVersionInfo\n                     (versionable.getVersionId(), ((Contentlet) versionable).getLanguageId());\n \n-\t\t\treturn (contentletVersionInfo != null && UtilMethods.isSet(contentletVersionInfo.getLiveInode()));\n+\t\t\treturn (contentletVersionInfo.isPresent()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "29fd8c3a002dfb9be3ba3adaf76816eee61668f5"}, "originalPosition": 341}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "926fc58c8460252418bcb80ca49156f2729f63af", "author": {"user": {"login": "dsilvam", "name": "Daniel Silva"}}, "url": "https://github.com/dotCMS/core/commit/926fc58c8460252418bcb80ca49156f2729f63af", "committedDate": "2020-09-30T17:44:42Z", "message": "#18550 code-review"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5NjcyMDc0", "url": "https://github.com/dotCMS/core/pull/19294#pullrequestreview-499672074", "createdAt": "2020-09-30T17:46:14Z", "commit": {"oid": "926fc58c8460252418bcb80ca49156f2729f63af"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxNzo0NjoxNFrOHaovbg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxNzo0NjoxNFrOHaovbg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzY5MjUyNg==", "bodyText": "This will be removed after approvals", "url": "https://github.com/dotCMS/core/pull/19294#discussion_r497692526", "createdAt": "2020-09-30T17:46:14Z", "author": {"login": "dsilvam"}, "path": "dotCMS/gradle.properties", "diffHunk": "@@ -1,4 +1,4 @@\n-dotcmsReleaseVersion=master\n+dotcmsReleaseVersion=issue-18550-SNAPSHOT", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "926fc58c8460252418bcb80ca49156f2729f63af"}, "originalPosition": 2}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5NzA4ODI2", "url": "https://github.com/dotCMS/core/pull/19294#pullrequestreview-499708826", "createdAt": "2020-09-30T18:36:14Z", "commit": {"oid": "926fc58c8460252418bcb80ca49156f2729f63af"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxODozNjoxNFrOHaqc7Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxODozOTozMlrOHaqjxA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzcyMDU1Nw==", "bodyText": "Get rid of this file", "url": "https://github.com/dotCMS/core/pull/19294#discussion_r497720557", "createdAt": "2020-09-30T18:36:14Z", "author": {"login": "wezell"}, "path": "dotCMS/src/integration-test/resources/it-dotmarketing-config.properties", "diffHunk": "@@ -61,12 +61,12 @@ ASSET_PATH = /assets\n ##\tshared folder in unix/linux enviroments we encourage you to use symbolic links\n ##\tIf this variable is commented the system will work as usual using\n ##\tthe ASSET_PATH variable as the assets directory inside liferay web root\n-ASSET_REAL_PATH = /tomcat8/webapps/ROOT/assets\n+ASSET_REAL_PATH=/Users/danielsilva/Documents/test-data/assets\n ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "926fc58c8460252418bcb80ca49156f2729f63af"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzcyMDY3Ng==", "bodyText": "get rid of this file", "url": "https://github.com/dotCMS/core/pull/19294#discussion_r497720676", "createdAt": "2020-09-30T18:36:29Z", "author": {"login": "wezell"}, "path": "dotCMS/src/integration-test/resources/oracle-db-config.properties", "diffHunk": "@@ -1,6 +1,6 @@\n #Oracle Connection\n driverClassName=oracle.jdbc.OracleDriver\n-jdbcUrl=jdbc:oracle:thin:@database:1521:XE\n+jdbcUrl=jdbc:oracle:thin:@localhost:1521:XE", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "926fc58c8460252418bcb80ca49156f2729f63af"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzcyMDczOA==", "bodyText": "get rid of this file", "url": "https://github.com/dotCMS/core/pull/19294#discussion_r497720738", "createdAt": "2020-09-30T18:36:35Z", "author": {"login": "wezell"}, "path": "dotCMS/src/integration-test/resources/postgres-db-config.properties", "diffHunk": "@@ -1,8 +1,8 @@\n #Postgres Connection\n driverClassName=org.postgresql.Driver\n-jdbcUrl=jdbc:postgresql://database/dotcms\n+jdbcUrl=jdbc:postgresql://localhost/dotcms_test\n username=postgres\n-password=postgres\n+password=root", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "926fc58c8460252418bcb80ca49156f2729f63af"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzcyMTI5MA==", "bodyText": "if(verInfo.isPresent() ) should be enough", "url": "https://github.com/dotCMS/core/pull/19294#discussion_r497721290", "createdAt": "2020-09-30T18:37:40Z", "author": {"login": "wezell"}, "path": "dotCMS/src/main/java/com/dotcms/content/elasticsearch/business/ESContentFactoryImpl.java", "diffHunk": "@@ -613,15 +613,16 @@ protected void delete(List<Contentlet> contentlets, boolean deleteIdentifier) th\n             if(InodeUtils.isSet(con.getInode())){\n                 APILocator.getPermissionAPI().removePermissions(con);\n \n-                ContentletVersionInfo verInfo=APILocator.getVersionableAPI().getContentletVersionInfo(con.getIdentifier(), con.getLanguageId());\n-                if(verInfo!=null && UtilMethods.isSet(verInfo.getIdentifier())) {\n-                    if(UtilMethods.isSet(verInfo.getLiveInode()) && verInfo.getLiveInode().equals(con.getInode()))\n+                Optional<ContentletVersionInfo> verInfo=APILocator.getVersionableAPI().getContentletVersionInfo(con.getIdentifier(), con.getLanguageId());\n+\n+                if(verInfo.isPresent() && UtilMethods.isSet(verInfo.get().getIdentifier())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "926fc58c8460252418bcb80ca49156f2729f63af"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzcyMTQxNg==", "bodyText": "if(cvi.isPresent() ) should be enough", "url": "https://github.com/dotCMS/core/pull/19294#discussion_r497721416", "createdAt": "2020-09-30T18:37:52Z", "author": {"login": "wezell"}, "path": "dotCMS/src/main/java/com/dotcms/content/elasticsearch/business/ESContentFactoryImpl.java", "diffHunk": "@@ -1033,12 +1034,13 @@ protected Contentlet find(final String inode) throws ElasticsearchException, Dot\n \n \t@Override\n \tprotected Contentlet findContentletByIdentifier(String identifier, Boolean live, Long languageId) throws DotDataException {\n-        final ContentletVersionInfo cvi = APILocator.getVersionableAPI().getContentletVersionInfo(identifier, languageId);\n-        if(cvi == null  || UtilMethods.isEmpty(cvi.getIdentifier()) || (live && UtilMethods.isEmpty(cvi.getLiveInode()))) {\n+        final Optional<ContentletVersionInfo> cvi = APILocator.getVersionableAPI().getContentletVersionInfo(identifier, languageId);\n+        if(!cvi.isPresent() || UtilMethods.isEmpty(cvi.get().getIdentifier())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "926fc58c8460252418bcb80ca49156f2729f63af"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzcyMjMwOA==", "bodyText": "if(info.isPresent()) should be enough", "url": "https://github.com/dotCMS/core/pull/19294#discussion_r497722308", "createdAt": "2020-09-30T18:39:32Z", "author": {"login": "wezell"}, "path": "dotCMS/src/main/java/com/dotcms/publisher/util/DependencySet.java", "diffHunk": "@@ -188,9 +188,12 @@ private boolean addOrClean ( final String assetId, final Date assetModDate, fina\n \t\t\t\t\tif(!modifiedOnCurrentEnv && assetType.equals(\"content\")) {\n \t\t\t\t\t\t// check for versionInfo TS on content\n \t\t\t\t\t\tfor(Language lang : APILocator.getLanguageAPI().getLanguages()) {\n-\t\t\t\t\t\t\tContentletVersionInfo info=APILocator.getVersionableAPI().getContentletVersionInfo(assetId, lang.getId());\n-\t\t\t\t\t\t\tif(info!=null && InodeUtils.isSet(info.getIdentifier())) {\n-\t\t\t\t\t\t\t\tmodifiedOnCurrentEnv = modifiedOnCurrentEnv || (null == info.getVersionTs()) || asset.getPushDate().before(info.getVersionTs());\n+\t\t\t\t\t\t\tOptional<ContentletVersionInfo> info=APILocator.getVersionableAPI().getContentletVersionInfo(assetId, lang.getId());\n+\n+\t\t\t\t\t\t\tif(info.isPresent() && InodeUtils.isSet(info.get().getIdentifier())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "926fc58c8460252418bcb80ca49156f2729f63af"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ee96ba2802078e1ede43bec4e7bc252c07beed5e", "author": {"user": {"login": "dsilvam", "name": "Daniel Silva"}}, "url": "https://github.com/dotCMS/core/commit/ee96ba2802078e1ede43bec4e7bc252c07beed5e", "committedDate": "2020-09-30T22:40:27Z", "message": "Update gradle.properties"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f4b90a8830cc6f976d6d51fceeb08341f934edfc", "author": {"user": {"login": "dsilvam", "name": "Daniel Silva"}}, "url": "https://github.com/dotCMS/core/commit/f4b90a8830cc6f976d6d51fceeb08341f934edfc", "committedDate": "2020-09-30T22:44:20Z", "message": "Update it-dotcms-config-cluster.properties"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aca420390ecb3431add888fbc51b2ae29bed7e68", "author": {"user": {"login": "dsilvam", "name": "Daniel Silva"}}, "url": "https://github.com/dotCMS/core/commit/aca420390ecb3431add888fbc51b2ae29bed7e68", "committedDate": "2020-09-30T22:47:09Z", "message": "Update it-dotmarketing-config.properties"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "84b4e04796a2c8011707ecaabb49fd5bf855b528", "author": {"user": {"login": "dsilvam", "name": "Daniel Silva"}}, "url": "https://github.com/dotCMS/core/commit/84b4e04796a2c8011707ecaabb49fd5bf855b528", "committedDate": "2020-09-30T22:47:38Z", "message": "Update it-dotmarketing-config.properties"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c082973d88f62a27c33b760fd76fa0480648d59f", "author": {"user": {"login": "dsilvam", "name": "Daniel Silva"}}, "url": "https://github.com/dotCMS/core/commit/c082973d88f62a27c33b760fd76fa0480648d59f", "committedDate": "2020-09-30T22:48:28Z", "message": "Update it-dotmarketing-config.properties"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec12c93d4d62a04416012892a921a19882d6f704", "author": {"user": {"login": "dsilvam", "name": "Daniel Silva"}}, "url": "https://github.com/dotCMS/core/commit/ec12c93d4d62a04416012892a921a19882d6f704", "committedDate": "2020-09-30T22:49:00Z", "message": "Update oracle-db-config.properties"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "beb2f0f4fe0e9f0ff982e4d90a36ff37b7ce8db0", "author": {"user": {"login": "dsilvam", "name": "Daniel Silva"}}, "url": "https://github.com/dotCMS/core/commit/beb2f0f4fe0e9f0ff982e4d90a36ff37b7ce8db0", "committedDate": "2020-09-30T22:57:48Z", "message": "Update postgres-db-config.properties"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d38e5aa02c207b3e8400d1224a4d16647a013557", "author": {"user": {"login": "dsilvam", "name": "Daniel Silva"}}, "url": "https://github.com/dotCMS/core/commit/d38e5aa02c207b3e8400d1224a4d16647a013557", "committedDate": "2020-09-30T22:58:47Z", "message": "Update ESContentFactoryImpl.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "11788ae5c0757c9c8c63c29411833928b8ce88a2", "author": {"user": {"login": "dsilvam", "name": "Daniel Silva"}}, "url": "https://github.com/dotCMS/core/commit/11788ae5c0757c9c8c63c29411833928b8ce88a2", "committedDate": "2020-09-30T22:59:29Z", "message": "Update DependencySet.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f04092f9eacaba790294c7a9f81da6a42b275dee", "author": {"user": {"login": "dsilvam", "name": "Daniel Silva"}}, "url": "https://github.com/dotCMS/core/commit/f04092f9eacaba790294c7a9f81da6a42b275dee", "committedDate": "2020-09-30T23:02:14Z", "message": "Update it-dotcms-config-cluster.properties"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fa72fa10dd1f98d383a8f7838dc948f2874520c7", "author": {"user": {"login": "dsilvam", "name": "Daniel Silva"}}, "url": "https://github.com/dotCMS/core/commit/fa72fa10dd1f98d383a8f7838dc948f2874520c7", "committedDate": "2020-09-30T23:02:42Z", "message": "Update oracle-db-config.properties"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e454cf5e924c8b389fcd16f2412a95b924a3b168", "author": {"user": {"login": "dsilvam", "name": "Daniel Silva"}}, "url": "https://github.com/dotCMS/core/commit/e454cf5e924c8b389fcd16f2412a95b924a3b168", "committedDate": "2020-09-30T23:04:16Z", "message": "#18550 remove new linews"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7b1ec15358ab54a3d463c1a74035d39044273cb6", "author": {"user": {"login": "dsilvam", "name": "Daniel Silva"}}, "url": "https://github.com/dotCMS/core/commit/7b1ec15358ab54a3d463c1a74035d39044273cb6", "committedDate": "2020-10-01T16:29:22Z", "message": "Merge branch 'master' of github.com:dotCMS/core into issue-18550-migrate-cvi-away-from-hibernate"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bde7ec2537c2ff1f60e9797d29c840618ba204a4", "author": {"user": {"login": "dsilvam", "name": "Daniel Silva"}}, "url": "https://github.com/dotCMS/core/commit/bde7ec2537c2ff1f60e9797d29c840618ba204a4", "committedDate": "2020-10-01T17:48:17Z", "message": "#18550 git rid of CVI definition in hbm files"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "30027d11b303d769f277f39b9568721a4a9d4d82", "author": {"user": {"login": "dsilvam", "name": "Daniel Silva"}}, "url": "https://github.com/dotCMS/core/commit/30027d11b303d769f277f39b9568721a4a9d4d82", "committedDate": "2020-10-01T22:20:18Z", "message": "#18550 changes after removing CVI from hbm files"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a246caaee5276db5e9d9de6f78c1593d28ca2837", "author": {"user": {"login": "dsilvam", "name": "Daniel Silva"}}, "url": "https://github.com/dotCMS/core/commit/a246caaee5276db5e9d9de6f78c1593d28ca2837", "committedDate": "2020-10-02T16:49:25Z", "message": "#18550 migrate deleteContentByStructure to dotConnect"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "329efa2ec3bd5e10d08301d1252684526d7bf10a", "author": {"user": {"login": "dsilvam", "name": "Daniel Silva"}}, "url": "https://github.com/dotCMS/core/commit/329efa2ec3bd5e10d08301d1252684526d7bf10a", "committedDate": "2020-10-02T17:43:19Z", "message": "#18550 fat-contentlet db transformer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3c40d0a5927a21371100f21adb69d1aaa642e638", "author": {"user": {"login": "dsilvam", "name": "Daniel Silva"}}, "url": "https://github.com/dotCMS/core/commit/3c40d0a5927a21371100f21adb69d1aaa642e638", "committedDate": "2020-10-06T23:23:21Z", "message": "#18550 fix failing tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3fcd04d7ce4f1a5c946e7696d1b7fcd320555adc", "author": {"user": {"login": "dsilvam", "name": "Daniel Silva"}}, "url": "https://github.com/dotCMS/core/commit/3fcd04d7ce4f1a5c946e7696d1b7fcd320555adc", "committedDate": "2020-10-07T17:12:59Z", "message": "#18550 fix more failing tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f77653a721d1c3bad529648820bf271a2770231e", "author": {"user": {"login": "dsilvam", "name": "Daniel Silva"}}, "url": "https://github.com/dotCMS/core/commit/f77653a721d1c3bad529648820bf271a2770231e", "committedDate": "2020-10-08T16:27:22Z", "message": "#18550 create pp-filter fot test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3093bc549a9a30d8874ac979f7f22db10d9e0ad9", "author": {"user": {"login": "dsilvam", "name": "Daniel Silva"}}, "url": "https://github.com/dotCMS/core/commit/3093bc549a9a30d8874ac979f7f22db10d9e0ad9", "committedDate": "2020-10-08T20:18:19Z", "message": "#18550 replace hibernate call with new one"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "420525ede2b56c809481674d25c3a56d6625d558", "author": {"user": {"login": "dsilvam", "name": "Daniel Silva"}}, "url": "https://github.com/dotCMS/core/commit/420525ede2b56c809481674d25c3a56d6625d558", "committedDate": "2020-10-12T22:15:54Z", "message": "#18550 missing the owner of the contentlet"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5dcc89a585063c862c8c2093a6375d6dabddcbab", "author": {"user": {"login": "dsilvam", "name": "Daniel Silva"}}, "url": "https://github.com/dotCMS/core/commit/5dcc89a585063c862c8c2093a6375d6dabddcbab", "committedDate": "2020-10-14T19:01:41Z", "message": "#18550 remove unneeded validation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA4ODExNDk2", "url": "https://github.com/dotCMS/core/pull/19294#pullrequestreview-508811496", "createdAt": "2020-10-14T22:23:09Z", "commit": {"oid": "5dcc89a585063c862c8c2093a6375d6dabddcbab"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA4ODE1NDQx", "url": "https://github.com/dotCMS/core/pull/19294#pullrequestreview-508815441", "createdAt": "2020-10-14T22:31:58Z", "commit": {"oid": "5dcc89a585063c862c8c2093a6375d6dabddcbab"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d2980c0b63a2061c3d009865424c447d8d38fcf0", "author": {"user": {"login": "dsilvam", "name": "Daniel Silva"}}, "url": "https://github.com/dotCMS/core/commit/d2980c0b63a2061c3d009865424c447d8d38fcf0", "committedDate": "2020-10-14T22:33:26Z", "message": "Update gradle.properties"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA4ODIxMzYx", "url": "https://github.com/dotCMS/core/pull/19294#pullrequestreview-508821361", "createdAt": "2020-10-14T22:41:52Z", "commit": {"oid": "d2980c0b63a2061c3d009865424c447d8d38fcf0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQyMjo0MTo1M1rOHhozWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQyMjo0MTo1M1rOHhozWQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTAzMzU2MQ==", "bodyText": "Codacy found an issue: Avoid declaring a variable if it is unreferenced before a possible exit point.", "url": "https://github.com/dotCMS/core/pull/19294#discussion_r505033561", "createdAt": "2020-10-14T22:41:53Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/main/java/com/dotcms/rendering/velocity/directive/ContentletDetail.java", "diffHunk": "@@ -32,20 +33,25 @@ public String getName() {\n \n \n     private long resolveLang(final String identifier, final RenderParams params) {\n-        ContentletVersionInfo cv;\n+        Optional<ContentletVersionInfo> versionInfo;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d2980c0b63a2061c3d009865424c447d8d38fcf0"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA4ODIxMzc0", "url": "https://github.com/dotCMS/core/pull/19294#pullrequestreview-508821374", "createdAt": "2020-10-14T22:41:54Z", "commit": {"oid": "d2980c0b63a2061c3d009865424c447d8d38fcf0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQyMjo0MTo1NFrOHhozcw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQyMjo0MTo1NFrOHhozcw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTAzMzU4Nw==", "bodyText": "Codacy found an issue: Avoid unused imports such as 'java.util.Map.Entry'", "url": "https://github.com/dotCMS/core/pull/19294#discussion_r505033587", "createdAt": "2020-10-14T22:41:54Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/main/java/com/dotmarketing/portlets/contentlet/transform/FatContentletTransformer.java", "diffHunk": "@@ -0,0 +1,221 @@\n+package com.dotmarketing.portlets.contentlet.transform;\n+\n+import com.dotcms.util.ConversionUtils;\n+import com.dotcms.util.transform.DBTransformer;\n+import com.dotmarketing.portlets.contentlet.business.Contentlet;\n+import java.util.ArrayList;\n+import java.util.Date;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Map.Entry;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d2980c0b63a2061c3d009865424c447d8d38fcf0"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA4ODIxMzgz", "url": "https://github.com/dotCMS/core/pull/19294#pullrequestreview-508821383", "createdAt": "2020-10-14T22:41:55Z", "commit": {"oid": "d2980c0b63a2061c3d009865424c447d8d38fcf0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQyMjo0MTo1NVrOHhozfg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQyMjo0MTo1NVrOHhozfg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTAzMzU5OA==", "bodyText": "Codacy found an issue: Avoid catching generic exceptions such as NullPointerException, RuntimeException, Exception in try-catch block", "url": "https://github.com/dotCMS/core/pull/19294#discussion_r505033598", "createdAt": "2020-10-14T22:41:55Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/main/java/com/dotmarketing/business/VersionableFactoryImpl.java", "diffHunk": "@@ -278,92 +304,121 @@ protected void saveVersionInfo(VersionInfo info, boolean updateVersionTS) throws\n     }\n \n     @Override\n-    protected ContentletVersionInfo getContentletVersionInfo(String identifier, long lang) throws DotDataException, DotStateException {\n+    protected Optional<ContentletVersionInfo> getContentletVersionInfo(String identifier, long lang) throws DotDataException, DotStateException {\n         if (DbConnectionFactory.inTransaction()) {\n             return findContentletVersionInfoInDB(identifier, lang);\n         }\n-        ContentletVersionInfo contv = this.icache.getContentVersionInfo(identifier, lang);\n-        if(contv!=null && fourOhFour.equals(contv.getWorkingInode())) {\n-        \treturn null;\n-        }else if(contv!=null ){\n-        \treturn contv;\n+        ContentletVersionInfo contentVersionInfo = this.icache.getContentVersionInfo(identifier, lang);\n+        if(contentVersionInfo!=null && fourOhFour.equals(contentVersionInfo.getWorkingInode())) {\n+        \treturn Optional.empty();\n+        }else if(contentVersionInfo!=null ){\n+        \treturn Optional.of(contentVersionInfo);\n         }\n \n-    \tcontv = findContentletVersionInfoInDB(identifier, lang);\n-        if(contv!=null && UtilMethods.isSet(contv.getIdentifier())){\n-        \tthis.icache.addContentletVersionInfoToCache(contv);\n+    \tfinal Optional<ContentletVersionInfo> optionalInfo = findContentletVersionInfoInDB(identifier, lang);\n+        if(optionalInfo.isPresent()){\n+        \tthis.icache.addContentletVersionInfoToCache(optionalInfo.get());\n         }else{\n-        \tcontv = new ContentletVersionInfo();\n-        \tcontv.setIdentifier(identifier);\n-        \tcontv.setLang(lang);\n-        \tcontv.setWorkingInode(fourOhFour);\n-        \tthis.icache.addContentletVersionInfoToCache(contv);\n-\t\t\treturn null;\n+        \tcontentVersionInfo = new ContentletVersionInfo();\n+        \tcontentVersionInfo.setIdentifier(identifier);\n+        \tcontentVersionInfo.setLang(lang);\n+        \tcontentVersionInfo.setWorkingInode(fourOhFour);\n+        \tthis.icache.addContentletVersionInfoToCache(contentVersionInfo);\n+\t\t\treturn Optional.empty();\n         }\n \n-        return contv;\n+        return optionalInfo;\n     }\n \n     @Override\n-    protected ContentletVersionInfo findContentletVersionInfoInDB(String identifier, long lang)throws DotDataException, DotStateException {\n-    \tContentletVersionInfo contv = null;\n-    \t HibernateUtil dh = new HibernateUtil(ContentletVersionInfo.class);\n-         dh.setQuery(\"from \"+ContentletVersionInfo.class.getName()+\" where identifier=? and lang=?\");\n-         dh.setParam(identifier);\n-         dh.setParam(lang);\n-         Logger.debug(this.getClass(), \"getContentletVersionInfo query: \"+dh.getQuery());\n-         contv = (ContentletVersionInfo)dh.load();\n-         return contv;\n+    protected Optional<ContentletVersionInfo> findContentletVersionInfoInDB(String identifier, long lang)throws DotDataException, DotStateException {\n+\t\tfinal DotConnect dotConnect = new DotConnect()\n+\t\t\t\t.setSQL(\"SELECT * FROM contentlet_version_info WHERE identifier=? AND lang=?\")\n+\t\t\t\t.addParam(identifier)\n+\t\t\t\t.addParam(lang);\n+\n+\t\tList<ContentletVersionInfo> versionInfos = TransformerLocator\n+\t\t\t\t.createContentletVersionInfoTransformer(dotConnect.loadObjectResults()).asList();\n+\n+\t\treturn !versionInfos.isEmpty() ? Optional.of(versionInfos.get(0)) : Optional.empty();\n     }\n     @Override\n     protected List<ContentletVersionInfo> findAllContentletVersionInfos(final String identifier)throws DotDataException, DotStateException {\n+        final DotConnect dotConnect = new DotConnect()\n+                .setSQL(\"SELECT * FROM contentlet_version_info WHERE identifier=?\")\n+                .addParam(identifier);\n \n-         HibernateUtil dh = new HibernateUtil(ContentletVersionInfo.class);\n-         dh.setQuery(\"from \"+ContentletVersionInfo.class.getName()+\" where identifier=? \");\n-         dh.setParam(identifier);\n+        List<ContentletVersionInfo> versionInfos = TransformerLocator\n+                .createContentletVersionInfoTransformer(dotConnect.loadObjectResults()).asList();\n \n-         Logger.debug(this.getClass(), \"getContentletVersionInfo query: \"+dh.getQuery());\n-         return (List<ContentletVersionInfo>)dh.list();\n+\t\treturn versionInfos==null || versionInfos.isEmpty()\n+\t\t\t\t? Collections.emptyList()\n+\t\t\t\t: versionInfos;\n \n     }\n     @Override\n     protected void saveContentletVersionInfo(ContentletVersionInfo cvInfo, boolean updateVersionTS) throws DotDataException, DotStateException {\n-    \tIdentifier ident = this.iapi.find(cvInfo.getIdentifier());\n-    \tContentletVersionInfo vi= null;\n-    \tif(ident!=null && InodeUtils.isSet(ident.getId())){\n-    \t\tvi= findContentletVersionInfoInDB(ident.getId(), cvInfo.getLang());\n-    \t}\n-    \tboolean isNew = vi==null || !InodeUtils.isSet(vi.getIdentifier());\n-        try {\n-\t\t\tBeanUtils.copyProperties(vi, cvInfo);\n-\t\t} catch (Exception e) {\n-\t\t\tthrow new DotDataException(e.getMessage(),e);\n+\t\tboolean isNew = true;\n+\t\tif (UtilMethods.isSet(cvInfo.getIdentifier())) {\n+\t\t\ttry {\n+\t\t\t\tfinal Optional<ContentletVersionInfo> fromDB =\n+\t\t\t\t\t\tfindContentletVersionInfoInDB(cvInfo.getIdentifier(), cvInfo.getLang());\n+\t\t\t\tif (fromDB.isPresent()) {\n+\t\t\t\t\tisNew = false;\n+\t\t\t\t}\n+\t\t\t} catch (final Exception e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d2980c0b63a2061c3d009865424c447d8d38fcf0"}, "originalPosition": 193}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 626, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}