{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA3Nzg2NDUx", "number": 19482, "reviewThreads": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QwNDowMTo0OVrOExBf3g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QxNjo0MjozMVrOExSBLw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE5ODQwMjIyOnYy", "diffSide": "RIGHT", "path": "dotCMS/src/main/java/com/dotmarketing/portlets/templates/business/TemplateAPI.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QwNDowMTo0OVrOHm7Ynw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QwNDowMTo0OVrOHm7Ynw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDU4MDg5NQ==", "bodyText": "Codacy found an issue: A method/constructor should not explicitly throw java.lang.Exception", "url": "https://github.com/dotCMS/core/pull/19482#discussion_r510580895", "createdAt": "2020-10-23T04:01:49Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/main/java/com/dotmarketing/portlets/templates/business/TemplateAPI.java", "diffHunk": "@@ -220,7 +219,7 @@ Template copy(Template sourceTemplate, Host destinationHost, boolean forceOverwr\n \t * @throws Exception\n \t */\n \t@Deprecated\n-\tpublic boolean delete(Template template, User user, boolean respectFrontendRoles) throws DotSecurityException, Exception;\n+\tboolean delete(Template template, User user, boolean respectFrontendRoles) throws DotSecurityException, Exception;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc72abff3e2f9a7262d8a202866fc8d97c798e57"}, "originalPosition": 183}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE5ODQwMjMxOnYy", "diffSide": "RIGHT", "path": "dotCMS/src/main/java/com/dotmarketing/portlets/templates/business/TemplateAPIImpl.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QwNDowMTo1MFrOHm7YqA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QwNDowMTo1MFrOHm7YqA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDU4MDkwNA==", "bodyText": "Codacy found an issue: Avoid variables with short names like id", "url": "https://github.com/dotCMS/core/pull/19482#discussion_r510580904", "createdAt": "2020-10-23T04:01:50Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/main/java/com/dotmarketing/portlets/templates/business/TemplateAPIImpl.java", "diffHunk": "@@ -482,17 +467,14 @@ public Template find(String inode, User user,  boolean respectFrontEndRoles) thr\n \n \t}\n \n-\n-\n-\n-\tpublic Template findLiveTemplate(String id, User user, boolean respectFrontendRoles) throws DotDataException, DotSecurityException {\n+\tpublic Template findLiveTemplate(final String id, final User user, final boolean respectFrontendRoles) throws DotDataException, DotSecurityException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc72abff3e2f9a7262d8a202866fc8d97c798e57"}, "originalPosition": 242}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE5ODQwMjM1OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/integration-test/java/com/dotmarketing/portlets/templates/business/TemplateAPITest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QwNDowMTo1MVrOHm7YrA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QwNDowMTo1MVrOHm7YrA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDU4MDkwOA==", "bodyText": "Codacy found an issue: Avoid unused imports such as 'com.dotcms.contenttype.model.type.BaseContentType'", "url": "https://github.com/dotCMS/core/pull/19482#discussion_r510580908", "createdAt": "2020-10-23T04:01:51Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotmarketing/portlets/templates/business/TemplateAPITest.java", "diffHunk": "@@ -1,10 +1,14 @@\n package com.dotmarketing.portlets.templates.business;\n \n import com.dotcms.IntegrationTestBase;\n+import com.dotcms.content.elasticsearch.business.ESContentFactoryImpl;\n+import com.dotcms.contenttype.model.type.BaseContentType;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc72abff3e2f9a7262d8a202866fc8d97c798e57"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE5ODQwMjQwOnYy", "diffSide": "RIGHT", "path": "dotCMS/src/main/java/com/dotcms/rendering/velocity/viewtools/DotTemplateTool.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QwNDowMTo1MlrOHm7YsQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QwNDowMTo1MlrOHm7YsQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDU4MDkxMw==", "bodyText": "Codacy found an issue: Avoid throwing raw exception types.", "url": "https://github.com/dotCMS/core/pull/19482#discussion_r510580913", "createdAt": "2020-10-23T04:01:52Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/main/java/com/dotcms/rendering/velocity/viewtools/DotTemplateTool.java", "diffHunk": "@@ -132,15 +134,16 @@ public static void removeFromLayoutCache(final String templateInode){\n         layoutCache.invalidate(templateInode + true);\n     }\n \n-    private static DrawedBody getDrawedBody(String themeInode, User user) throws DotDataException, DotSecurityException {\n-        final Identifier ident = APILocator.getIdentifierAPI().findFromInode(themeInode);\n-        final Template template = APILocator.getTemplateAPI().findWorkingTemplate(ident.getId(), user, false);\n+    private static DrawedBody getDrawedBody(String themeInodeOrId, User user) throws DotDataException, DotSecurityException {\n+        final Template template = FactoryLocator.getTemplateFactory().find(themeInodeOrId);//If null themeInodeOrId is a Id\n+        final String identifier = template!=null ? template.getIdentifier() : themeInodeOrId;\n+        final Template workingTemplate = APILocator.getTemplateAPI().findWorkingTemplate(identifier, user, false);\n \n-        if (!template.isDrawed()){\n-            throw new RuntimeException(\"Template with inode: \" + themeInode + \" is not drawed\");\n+        if (!workingTemplate.isDrawed()){\n+            throw new RuntimeException(\"Template with inode: \" + themeInodeOrId + \" is not drawed\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc72abff3e2f9a7262d8a202866fc8d97c798e57"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE5ODQwMjQ0OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/integration-test/java/com/dotmarketing/portlets/templates/business/TemplateAPITest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QwNDowMTo1M1rOHm7YuA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QwNDowMTo1M1rOHm7YuA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDU4MDkyMA==", "bodyText": "Codacy found an issue: Avoid unused imports such as 'com.dotcms.content.elasticsearch.business.ESContentFactoryImpl'", "url": "https://github.com/dotCMS/core/pull/19482#discussion_r510580920", "createdAt": "2020-10-23T04:01:53Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotmarketing/portlets/templates/business/TemplateAPITest.java", "diffHunk": "@@ -1,10 +1,14 @@\n package com.dotmarketing.portlets.templates.business;\n \n import com.dotcms.IntegrationTestBase;\n+import com.dotcms.content.elasticsearch.business.ESContentFactoryImpl;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc72abff3e2f9a7262d8a202866fc8d97c798e57"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE5ODQwMjQ2OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/main/java/com/dotmarketing/portlets/templates/business/TemplateAPIImpl.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QwNDowMTo1NFrOHm7Yuw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QwNDowMTo1NFrOHm7Yuw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDU4MDkyMw==", "bodyText": "Codacy found an issue: Avoid variables with short names like id", "url": "https://github.com/dotCMS/core/pull/19482#discussion_r510580923", "createdAt": "2020-10-23T04:01:54Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/main/java/com/dotmarketing/portlets/templates/business/TemplateAPIImpl.java", "diffHunk": "@@ -455,23 +440,23 @@ public boolean delete(Template template, User user, boolean respectFrontendRoles\n \t\t}\n \t}\n \n-\tpublic Template findWorkingTemplate(String id, User user, boolean respectFrontendRoles) throws DotDataException, DotSecurityException {\n-\t\tVersionInfo info = APILocator.getVersionableAPI().getVersionInfo(id);\n+\tpublic Template findWorkingTemplate(final String id, final User user, final boolean respectFrontendRoles) throws DotDataException, DotSecurityException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc72abff3e2f9a7262d8a202866fc8d97c798e57"}, "originalPosition": 210}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE5ODQwMjQ4OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/main/java/com/dotmarketing/portlets/templates/business/TemplateSQL.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QwNDowMTo1NVrOHm7Yvw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QwNDowMTo1NVrOHm7Yvw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDU4MDkyNw==", "bodyText": "Codacy found an issue: All methods are static.  Consider using a utility class instead. Alternatively, you could add a private constructor or make the class abstract to silence this warning.", "url": "https://github.com/dotCMS/core/pull/19482#discussion_r510580927", "createdAt": "2020-10-23T04:01:55Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/main/java/com/dotmarketing/portlets/templates/business/TemplateSQL.java", "diffHunk": "@@ -0,0 +1,63 @@\n+package com.dotmarketing.portlets.templates.business;\n+\n+import com.dotmarketing.beans.Inode.Type;\n+\n+public class TemplateSQL {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc72abff3e2f9a7262d8a202866fc8d97c798e57"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE5ODQwMjUwOnYy", "diffSide": "RIGHT", "path": "dotCMS/src/main/java/com/dotcms/rendering/velocity/viewtools/DotTemplateTool.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QwNDowMTo1NlrOHm7Ywg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QwNDowMTo1NlrOHm7Ywg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDU4MDkzMA==", "bodyText": "Codacy found an issue: Avoid unused imports such as 'io.vavr.control.Try'", "url": "https://github.com/dotCMS/core/pull/19482#discussion_r510580930", "createdAt": "2020-10-23T04:01:56Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/main/java/com/dotcms/rendering/velocity/viewtools/DotTemplateTool.java", "diffHunk": "@@ -21,6 +22,7 @@\n import com.dotmarketing.util.UtilMethods;\n import com.liferay.portal.model.User;\n \n+import io.vavr.control.Try;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc72abff3e2f9a7262d8a202866fc8d97c798e57"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIwMTEwODk1OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/main/java/com/dotmarketing/portlets/templates/business/TemplateSQL.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QxNjo0MjozMVrOHnVglg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QxNjo0MjozMVrOHnVglg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTAwODkxOA==", "bodyText": "remove this", "url": "https://github.com/dotCMS/core/pull/19482#discussion_r511008918", "createdAt": "2020-10-23T16:42:31Z", "author": {"login": "nollymar"}, "path": "dotCMS/src/main/java/com/dotmarketing/portlets/templates/business/TemplateSQL.java", "diffHunk": "@@ -0,0 +1,63 @@\n+package com.dotmarketing.portlets.templates.business;\n+\n+import com.dotmarketing.beans.Inode.Type;\n+\n+public class TemplateSQL {\n+\n+    public static TemplateSQL getInstance(){ return new TemplateSQL(); }\n+\n+    public static final String FIND_TEMPLATES_BY_HOST_INODE =\n+            \"select template.*, template_1_.*  from \" + Type.TEMPLATE.getTableName() + \" template, inode template_1_, \" +\n+                    \"identifier template_identifier, \" + Type.TEMPLATE.getVersionTableName() + \" vi where \" +\n+                    \"template_identifier.host_inode = ? and template_identifier.id = template.identifier and \" +\n+                    \"template.inode = template_1_.inode and vi.identifier=template.identifier and \" +\n+                    \"template.inode=vi.working_inode \";\n+\n+    public static final String FIND_WORKING_TEMPLATE_BY_HOST_INODE_AND_TITLE =\n+            \"select template.*, template_1_.* from \" + Type.TEMPLATE.getTableName() + \" template, inode template_1_, \" +\n+                    \"identifier template_identifier, \" + Type.TEMPLATE.getVersionTableName() + \" vi where \" +\n+                    \"template_identifier.host_inode = ? and template_identifier.id = template.identifier and \" +\n+                    \"vi.identifier=template_identifier.id and template.title = ? and \" +\n+                    \"template.inode = template_1_.inode and \" +\n+                    \"template.inode=vi.working_inode \";\n+\n+//    public static final String SELECT_ALL_FIELDS = \"select inode, show_on_menu, title, mod_date, mod_user, \" +\n+//            \"sort_order, friendly_name, body, header, footer, image, identifier, drawed, drawed_body, \" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bc72abff3e2f9a7262d8a202866fc8d97c798e57"}, "originalPosition": 25}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1796, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}