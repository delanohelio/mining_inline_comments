{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg3NTA2MTAw", "number": 18134, "title": "#17848 Fixing error handling when an index is not found", "bodyText": "A 404 error status is thrown instead of 500 if the index is not found when ESIndexResource. getDocumentCount is called", "createdAt": "2020-03-12T22:35:34Z", "url": "https://github.com/dotCMS/core/pull/18134", "merged": true, "mergeCommit": {"oid": "637c9b1b0dbb54bcb72ddda60089ab1a3e0d5d1f"}, "closed": true, "closedAt": "2020-03-16T22:34:54Z", "author": {"login": "nollymar"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcNDhwYgH2gAyMzg3NTA2MTAwOmIyOGRhMjIwY2FjYjgzMWU1NTc1ODcwMTc1NDhiZTkzMzAyYTdhOGE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcOV0zNAFqTM3NTYyNDU2Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b28da220cacb831e557587017548be93302a7a8a", "author": {"user": null}, "url": "https://github.com/dotCMS/core/commit/b28da220cacb831e557587017548be93302a7a8a", "committedDate": "2020-03-12T22:33:41Z", "message": "#17848 Fixing error handling when an index is not found"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczOTQ3MTUy", "url": "https://github.com/dotCMS/core/pull/18134#pullrequestreview-373947152", "createdAt": "2020-03-12T22:41:06Z", "commit": {"oid": "b28da220cacb831e557587017548be93302a7a8a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQyMjo0MTowNlrOF1yU-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQyMjo0MTowNlrOF1yU-g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTk0MzQxOA==", "bodyText": "I think we should remove this catch also and let the Mappers catch these Exceptions", "url": "https://github.com/dotCMS/core/pull/18134#discussion_r391943418", "createdAt": "2020-03-12T22:41:06Z", "author": {"login": "freddyucv"}, "path": "dotCMS/src/main/java/com/dotcms/rest/api/v1/index/ESIndexResource.java", "diffHunk": "@@ -484,15 +484,18 @@ public Response getActive(@Context HttpServletRequest httpServletRequest, @Conte\n     @Path(\"/docscount/{params:.*}\")\n     @Produces(\"text/plain\")\n     public Response getDocumentCount(@Context HttpServletRequest httpServletRequest, @Context final HttpServletResponse httpServletResponse, @PathParam(\"params\") String params) {\n+\n+        InitDataObject init= null;\n         try {\n-            InitDataObject init=auth(params,httpServletRequest, httpServletResponse);\n+            init = auth(params,httpServletRequest, httpServletResponse);\n \n             //Creating an utility response object\n             ResourceResponse responseResource = new ResourceResponse( init.getParamsMap() );\n \n             String indexName = this.indexHelper.getIndexNameOrAlias(init.getParamsMap(),\"index\",\"alias\",this.indexAPI);\n             return responseResource.response( Long.toString( indexDocumentCount( indexName ) ) );\n-        } catch (Exception e) {\n+\n+        } catch (DotSecurityException | DotDataException e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b28da220cacb831e557587017548be93302a7a8a"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0NDgzMTAw", "url": "https://github.com/dotCMS/core/pull/18134#pullrequestreview-374483100", "createdAt": "2020-03-13T17:25:07Z", "commit": {"oid": "b28da220cacb831e557587017548be93302a7a8a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxNzoyNTowN1rOF2MScA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxNzoyNTowN1rOF2MScA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjM2ODc1Mg==", "bodyText": "I think the fall back should be INTERNAL_SERVER_ERROR", "url": "https://github.com/dotCMS/core/pull/18134#discussion_r392368752", "createdAt": "2020-03-13T17:25:07Z", "author": {"login": "dsilvam"}, "path": "dotCMS/src/main/java/com/dotcms/rest/exception/mapper/ElasticsearchStatusExceptionMapper.java", "diffHunk": "@@ -0,0 +1,29 @@\n+package com.dotcms.rest.exception.mapper;\n+\n+import com.dotmarketing.util.Logger;\n+import javax.ws.rs.core.Response;\n+import javax.ws.rs.core.Response.Status;\n+import org.elasticsearch.ElasticsearchStatusException;\n+import javax.ws.rs.ext.ExceptionMapper;\n+\n+public class ElasticsearchStatusExceptionMapper implements ExceptionMapper<ElasticsearchStatusException> {\n+\n+\n+    @Override\n+    public Response toResponse(ElasticsearchStatusException exception) {\n+\n+        //Log into our logs first.\n+        Logger.warn(this.getClass(), exception.getMessage(), exception);\n+\n+        //Create the message.\n+        String message = exception.getMessage();\n+\n+        //Creating the message in JSON format.\n+        String entity = ExceptionMapperUtil.getJsonErrorAsString(message);\n+\n+        //Return 4xx message to the client.\n+        return ExceptionMapperUtil.createResponse(entity, message,\n+                message.contains(\"index_not_found_exception\") ? Status.NOT_FOUND\n+                        : Status.BAD_REQUEST);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b28da220cacb831e557587017548be93302a7a8a"}, "originalPosition": 27}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c7bf43d88b1555deec08af60c08b34114cbbefcc", "author": {"user": null}, "url": "https://github.com/dotCMS/core/commit/c7bf43d88b1555deec08af60c08b34114cbbefcc", "committedDate": "2020-03-13T21:50:10Z", "message": "Merge branch 'master' of https://github.com/dotCMS/core into issue-17848-additional-fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "67abff06687fd337ae0d0c0d418d03a7c4c477c6", "author": {"user": null}, "url": "https://github.com/dotCMS/core/commit/67abff06687fd337ae0d0c0d418d03a7c4c477c6", "committedDate": "2020-03-13T21:53:02Z", "message": "#17848 Code review suggestion: remove DotSecurityException from catch to delegate exception handling to DotSecurityExceptionMapper"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cfc34680a4a35397f5873ad797e79732d2f3c8d7", "author": {"user": null}, "url": "https://github.com/dotCMS/core/commit/cfc34680a4a35397f5873ad797e79732d2f3c8d7", "committedDate": "2020-03-16T16:33:51Z", "message": "#17848 Applying code review suggestions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1NjI0NTY2", "url": "https://github.com/dotCMS/core/pull/18134#pullrequestreview-375624566", "createdAt": "2020-03-16T22:26:42Z", "commit": {"oid": "cfc34680a4a35397f5873ad797e79732d2f3c8d7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1179, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}