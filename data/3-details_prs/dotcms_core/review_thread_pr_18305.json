{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAyNzYzNTI2", "number": 18305, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxNTowOTo1OFrODxsRAA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxNToxMDo1OFrODxsS3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzNDMyMDY0OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/main/java/com/dotcms/content/elasticsearch/util/DotRestHighLevelClientProvider.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxNTowOTo1OVrOGFTbaw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxNzoyOTozMFrOGFZW1w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODIxNDM3OQ==", "bodyText": "\"https\" should be a constant", "url": "https://github.com/dotCMS/core/pull/18305#discussion_r408214379", "createdAt": "2020-04-14T15:09:59Z", "author": {"login": "freddyucv"}, "path": "dotCMS/src/main/java/com/dotcms/content/elasticsearch/util/DotRestHighLevelClientProvider.java", "diffHunk": "@@ -106,14 +110,24 @@ private BasicCredentialsProvider getCredentialsProvider() throws IOException, Ge\n \n     private RestClientBuilder getClientBuilder(final BasicCredentialsProvider credentialsProvider) {\n         final String esAuthType = getESAuthType();\n-\n+        final String esProtocol = Config.getStringProperty(\"ES_PROTOCOL\", \"https\");\n         final RestClientBuilder clientBuilder = RestClient\n                 .builder(new HttpHost(Config.getStringProperty(\"ES_HOSTNAME\", \"127.0.0.1\"),\n-                        Config.getIntProperty(\"ES_PORT\", 9200), sslContextFromPem != null ? \"https\" :\"http\"))\n+                        Config.getIntProperty(\"ES_PORT\", 9200), esProtocol))\n                 .setHttpClientConfigCallback((httpClientBuilder) -> {\n                     if (sslContextFromPem != null) {\n                         httpClientBuilder\n                                 .setSSLContext(sslContextFromPem);\n+                    } else if (\"https\".equals(esProtocol)){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "794acd9fbf2770cfd0363315ba61800e260cc41d"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODMxMTUxMQ==", "bodyText": "Done", "url": "https://github.com/dotCMS/core/pull/18305#discussion_r408311511", "createdAt": "2020-04-14T17:29:30Z", "author": {"login": "nollymar"}, "path": "dotCMS/src/main/java/com/dotcms/content/elasticsearch/util/DotRestHighLevelClientProvider.java", "diffHunk": "@@ -106,14 +110,24 @@ private BasicCredentialsProvider getCredentialsProvider() throws IOException, Ge\n \n     private RestClientBuilder getClientBuilder(final BasicCredentialsProvider credentialsProvider) {\n         final String esAuthType = getESAuthType();\n-\n+        final String esProtocol = Config.getStringProperty(\"ES_PROTOCOL\", \"https\");\n         final RestClientBuilder clientBuilder = RestClient\n                 .builder(new HttpHost(Config.getStringProperty(\"ES_HOSTNAME\", \"127.0.0.1\"),\n-                        Config.getIntProperty(\"ES_PORT\", 9200), sslContextFromPem != null ? \"https\" :\"http\"))\n+                        Config.getIntProperty(\"ES_PORT\", 9200), esProtocol))\n                 .setHttpClientConfigCallback((httpClientBuilder) -> {\n                     if (sslContextFromPem != null) {\n                         httpClientBuilder\n                                 .setSSLContext(sslContextFromPem);\n+                    } else if (\"https\".equals(esProtocol)){", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODIxNDM3OQ=="}, "originalCommit": {"oid": "794acd9fbf2770cfd0363315ba61800e260cc41d"}, "originalPosition": 50}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzNDMyNTQxOnYy", "diffSide": "RIGHT", "path": "dotCMS/src/main/java/com/dotcms/content/elasticsearch/util/DotRestHighLevelClientProvider.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxNToxMDo1OFrOGFTeYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxNjo1MDo1OVrOGFX3PQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODIxNTEzOQ==", "bodyText": "is it possible do any test?", "url": "https://github.com/dotCMS/core/pull/18305#discussion_r408215139", "createdAt": "2020-04-14T15:10:58Z", "author": {"login": "freddyucv"}, "path": "dotCMS/src/main/java/com/dotcms/content/elasticsearch/util/DotRestHighLevelClientProvider.java", "diffHunk": "@@ -106,14 +110,24 @@ private BasicCredentialsProvider getCredentialsProvider() throws IOException, Ge\n \n     private RestClientBuilder getClientBuilder(final BasicCredentialsProvider credentialsProvider) {\n         final String esAuthType = getESAuthType();\n-\n+        final String esProtocol = Config.getStringProperty(\"ES_PROTOCOL\", \"https\");\n         final RestClientBuilder clientBuilder = RestClient\n                 .builder(new HttpHost(Config.getStringProperty(\"ES_HOSTNAME\", \"127.0.0.1\"),\n-                        Config.getIntProperty(\"ES_PORT\", 9200), sslContextFromPem != null ? \"https\" :\"http\"))\n+                        Config.getIntProperty(\"ES_PORT\", 9200), esProtocol))\n                 .setHttpClientConfigCallback((httpClientBuilder) -> {\n                     if (sslContextFromPem != null) {\n                         httpClientBuilder\n                                 .setSSLContext(sslContextFromPem);\n+                    } else if (\"https\".equals(esProtocol)){\n+                        try {\n+                            httpClientBuilder.setSSLContext(SSLContexts\n+                                    .custom().loadTrustMaterial(new TrustSelfSignedStrategy()).build());\n+                        } catch (NoSuchAlgorithmException | KeyManagementException | KeyStoreException e) {\n+                            Logger.error(this.getClass(),\n+                                    \"Error setting TrustSelfSignedStrategy for Elastic RestHighLevelClient\",\n+                                    e);\n+                            throw new DotRuntimeException(e);\n+                        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "794acd9fbf2770cfd0363315ba61800e260cc41d"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODI4NzAzNw==", "bodyText": "how do you suggest to test it? The logic avoid sending certificates for validation when the ES connection is established", "url": "https://github.com/dotCMS/core/pull/18305#discussion_r408287037", "createdAt": "2020-04-14T16:50:59Z", "author": {"login": "nollymar"}, "path": "dotCMS/src/main/java/com/dotcms/content/elasticsearch/util/DotRestHighLevelClientProvider.java", "diffHunk": "@@ -106,14 +110,24 @@ private BasicCredentialsProvider getCredentialsProvider() throws IOException, Ge\n \n     private RestClientBuilder getClientBuilder(final BasicCredentialsProvider credentialsProvider) {\n         final String esAuthType = getESAuthType();\n-\n+        final String esProtocol = Config.getStringProperty(\"ES_PROTOCOL\", \"https\");\n         final RestClientBuilder clientBuilder = RestClient\n                 .builder(new HttpHost(Config.getStringProperty(\"ES_HOSTNAME\", \"127.0.0.1\"),\n-                        Config.getIntProperty(\"ES_PORT\", 9200), sslContextFromPem != null ? \"https\" :\"http\"))\n+                        Config.getIntProperty(\"ES_PORT\", 9200), esProtocol))\n                 .setHttpClientConfigCallback((httpClientBuilder) -> {\n                     if (sslContextFromPem != null) {\n                         httpClientBuilder\n                                 .setSSLContext(sslContextFromPem);\n+                    } else if (\"https\".equals(esProtocol)){\n+                        try {\n+                            httpClientBuilder.setSSLContext(SSLContexts\n+                                    .custom().loadTrustMaterial(new TrustSelfSignedStrategy()).build());\n+                        } catch (NoSuchAlgorithmException | KeyManagementException | KeyStoreException e) {\n+                            Logger.error(this.getClass(),\n+                                    \"Error setting TrustSelfSignedStrategy for Elastic RestHighLevelClient\",\n+                                    e);\n+                            throw new DotRuntimeException(e);\n+                        }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODIxNTEzOQ=="}, "originalCommit": {"oid": "794acd9fbf2770cfd0363315ba61800e260cc41d"}, "originalPosition": 59}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2204, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}