{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE2MzYyMDY5", "number": 18471, "title": "#18316 Removing duplicates from query", "bodyText": "This PR fixes several issues:\n\n-baseType:3 was being appended twice in lucene queries\n-contentType:forms was being appended even when not needed, ie.: when the lucene query contained a +contentType: blog\nFilter by -contentType:host was removed\nLogic to filter content types by License Level was moved to the ESContentFactoryImpl class\nwhen \"All\" content types were selected in the Content Search portlet, each content type was being appended in the lucene query instead of using *\nwhen filtering by title, the query builder was using multiple boost factors ^ for the same field, ie.: title:'engl'^15 title:engl^5", "createdAt": "2020-05-11T21:36:36Z", "url": "https://github.com/dotCMS/core/pull/18471", "merged": true, "mergeCommit": {"oid": "53f19077c6ffc17026d0f5c4bdeddd2f954aba3c"}, "closed": true, "closedAt": "2020-05-26T21:45:33Z", "author": {"login": "nollymar"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcgWj2uAH2gAyNDE2MzYyMDY5OjYxM2QwNzQyNGNjNTMzODBiZDUxY2Q4YzczODIyZjA4YjY5NGY4NGI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcji0YUgFqTQxNjQyNzkzNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "613d07424cc53380bd51cd8c73822f08b694f84b", "author": {"user": null}, "url": "https://github.com/dotCMS/core/commit/613d07424cc53380bd51cd8c73822f08b694f84b", "committedDate": "2020-05-11T21:28:44Z", "message": "#18316 Removing duplicates from query"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwMTA2MzUz", "url": "https://github.com/dotCMS/core/pull/18471#pullrequestreview-410106353", "createdAt": "2020-05-12T14:33:48Z", "commit": {"oid": "613d07424cc53380bd51cd8c73822f08b694f84b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwMTIxODcz", "url": "https://github.com/dotCMS/core/pull/18471#pullrequestreview-410121873", "createdAt": "2020-05-12T14:49:16Z", "commit": {"oid": "613d07424cc53380bd51cd8c73822f08b694f84b"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxNDo0OToxNlrOGUKcGg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMlQxNDo0OToyOVrOGUKcxw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzc5NTczOA==", "bodyText": "all the 'searchContentletsByUser' method code should go into a API", "url": "https://github.com/dotCMS/core/pull/18471#discussion_r423795738", "createdAt": "2020-05-12T14:49:16Z", "author": {"login": "freddyucv"}, "path": "dotCMS/src/main/java/com/dotmarketing/portlets/contentlet/ajax/ContentletAjax.java", "diffHunk": "@@ -892,10 +895,12 @@ else if( fieldbcontentname.startsWith(\"date\") ){\n \t\t\t\t\t\t\t        if(\"catchall\".equals(fieldName)) {\r\n \t\t\t\t\t\t\t           \r\n \t\t\t\t\t\t\t            luceneQuery.append(\" title:'\" + fieldValueStr + \"'^15 \");\r\n-\t\t\t\t\t\t\t            for(String x : fieldValueStr.split(\"[,|\\\\s+]\")) {\r\n-\t\t\t\t\t\t\t                luceneQuery.append(\" title:\" + x + \"^5 \");\r\n-\t\t\t\t\t\t\t                \r\n-\t\t\t\t\t\t\t            }\r\n+                                        final String[] titleSplit = fieldValueStr.split(\"[,|\\\\s+]\");\r\n+                                        if (titleSplit.length > 1) {\r\n+                                            for (final String term : titleSplit) {\r\n+                                                luceneQuery.append(\" title:\" + term + \"^5 \");\r\n+                                            }\r\n+                                        }\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "613d07424cc53380bd51cd8c73822f08b694f84b"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzc5NTkxMQ==", "bodyText": "any test?", "url": "https://github.com/dotCMS/core/pull/18471#discussion_r423795911", "createdAt": "2020-05-12T14:49:29Z", "author": {"login": "freddyucv"}, "path": "dotCMS/src/main/java/com/dotmarketing/portlets/contentlet/ajax/ContentletAjax.java", "diffHunk": "@@ -892,10 +895,12 @@ else if( fieldbcontentname.startsWith(\"date\") ){\n \t\t\t\t\t\t\t        if(\"catchall\".equals(fieldName)) {\r\n \t\t\t\t\t\t\t           \r\n \t\t\t\t\t\t\t            luceneQuery.append(\" title:'\" + fieldValueStr + \"'^15 \");\r\n-\t\t\t\t\t\t\t            for(String x : fieldValueStr.split(\"[,|\\\\s+]\")) {\r\n-\t\t\t\t\t\t\t                luceneQuery.append(\" title:\" + x + \"^5 \");\r\n-\t\t\t\t\t\t\t                \r\n-\t\t\t\t\t\t\t            }\r\n+                                        final String[] titleSplit = fieldValueStr.split(\"[,|\\\\s+]\");\r\n+                                        if (titleSplit.length > 1) {\r\n+                                            for (final String term : titleSplit) {\r\n+                                                luceneQuery.append(\" title:\" + term + \"^5 \");\r\n+                                            }\r\n+                                        }\r\n \t\t\t\t\t\t\t            luceneQuery.append(\" title_dotraw:*\" + fieldValueStr + \"*^5 \");\r\n \t\t\t\t\t\t\t        }\r\n \t\t\t\t\t\t\t        \r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "613d07424cc53380bd51cd8c73822f08b694f84b"}, "originalPosition": 37}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzNzU5OTc4", "url": "https://github.com/dotCMS/core/pull/18471#pullrequestreview-413759978", "createdAt": "2020-05-18T16:34:53Z", "commit": {"oid": "613d07424cc53380bd51cd8c73822f08b694f84b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7de434b39ad662f3cb34e56fd10baba1455a3216", "author": {"user": null}, "url": "https://github.com/dotCMS/core/commit/7de434b39ad662f3cb34e56fd10baba1455a3216", "committedDate": "2020-05-21T18:07:06Z", "message": "Merge branch 'master' of https://github.com/dotCMS/core into issue-18316-content-search-query-builder-improvements"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b06126f06568d35233ff55b13e11d74ee45ed14", "author": {"user": null}, "url": "https://github.com/dotCMS/core/commit/9b06126f06568d35233ff55b13e11d74ee45ed14", "committedDate": "2020-05-21T18:26:37Z", "message": "#18316 Moving logic to filter content types by license level was moved to the ESContentFactoryImpl"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ac7dd762a8759c0bd2c1b669dfdff7967e6ab067", "author": {"user": null}, "url": "https://github.com/dotCMS/core/commit/ac7dd762a8759c0bd2c1b669dfdff7967e6ab067", "committedDate": "2020-05-21T19:06:06Z", "message": "#18316 Adding ITs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE2NDI3OTM0", "url": "https://github.com/dotCMS/core/pull/18471#pullrequestreview-416427934", "createdAt": "2020-05-21T19:27:25Z", "commit": {"oid": "ac7dd762a8759c0bd2c1b669dfdff7967e6ab067"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1092, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}