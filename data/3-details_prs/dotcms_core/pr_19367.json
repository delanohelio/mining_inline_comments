{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk1OTc3NDcy", "number": 19367, "title": "#19362 now submitter can be configured by code", "bodyText": "Now dotSubmitter can be configured by code", "createdAt": "2020-10-01T05:48:18Z", "url": "https://github.com/dotCMS/core/pull/19367", "merged": true, "mergeCommit": {"oid": "afd2c74774907568d7381075605b08262262b2b7"}, "closed": true, "closedAt": "2020-10-02T14:36:51Z", "author": {"login": "jdotcms"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdOKzQugH2gAyNDk1OTc3NDcyOjEyYTQ5MDJmNzYzMWQyODJlNDc3OTAyYTYwODE2Y2JiZmYzNGIxMjA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdOYrnOAFqTUwMDc0NjI4OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "12a4902f7631d282e477902a60816cbbff34b120", "author": {"user": {"login": "jdotcms", "name": "Jonathan"}}, "url": "https://github.com/dotCMS/core/commit/12a4902f7631d282e477902a60816cbbff34b120", "committedDate": "2020-10-01T05:47:13Z", "message": "#19362 now submitter can be configured by code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0c523f0ca434202476e0bdea7cdad2fad90f4b2e", "author": {"user": {"login": "jdotcms", "name": "Jonathan"}}, "url": "https://github.com/dotCMS/core/commit/0c523f0ca434202476e0bdea7cdad2fad90f4b2e", "committedDate": "2020-10-01T06:07:25Z", "message": "#19362 now submitter can be configured by code"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAwNDA2NjQ2", "url": "https://github.com/dotCMS/core/pull/19367#pullrequestreview-500406646", "createdAt": "2020-10-01T14:27:38Z", "commit": {"oid": "0c523f0ca434202476e0bdea7cdad2fad90f4b2e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAwNTM0NjI1", "url": "https://github.com/dotCMS/core/pull/19367#pullrequestreview-500534625", "createdAt": "2020-10-01T16:44:31Z", "commit": {"oid": "0c523f0ca434202476e0bdea7cdad2fad90f4b2e"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxNjo0NDozMVrOHbS0iA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxNjo0NTozMFrOHbS2lg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODM4MTk2MA==", "bodyText": "I would rename SubmitterConfigCreator to SubmitterConfig and SubmitterConfigCreatorBuilder to SubmitterConfigBuilder", "url": "https://github.com/dotCMS/core/pull/19367#discussion_r498381960", "createdAt": "2020-10-01T16:44:31Z", "author": {"login": "wezell"}, "path": "dotCMS/src/main/java/com/dotcms/concurrent/DotConcurrentFactory.java", "diffHunk": "@@ -269,6 +275,28 @@ public DotSubmitter getSubmitter () {\n         return this.getSubmitter(DOT_SYSTEM_THREAD_POOL);\n     } // getSubmitter.\n \n+    /**\n+     * Register a submitter creator and gets the submitter\n+     * @param name    {@link String}\n+     * @param creator {@link SubmitterConfigCreator}\n+     * @return DotSubmitter\n+     */\n+    public DotSubmitter getSubmitter (final String name, final SubmitterConfigCreator creator) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0c523f0ca434202476e0bdea7cdad2fad90f4b2e"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODM4MjQ4Ng==", "bodyText": "why not use the primitives and avoid a possible npe?", "url": "https://github.com/dotCMS/core/pull/19367#discussion_r498382486", "createdAt": "2020-10-01T16:45:30Z", "author": {"login": "wezell"}, "path": "dotCMS/src/main/java/com/dotcms/concurrent/DotConcurrentFactory.java", "diffHunk": "@@ -342,6 +379,156 @@ public IdentifierStripedLock getIdentifierStripedLock(){\n        return this.identifierStripedLock;\n     }\n \n+    /**\n+     * {@link SubmitterConfigCreator} builder\n+     */\n+    public static class SubmitterConfigCreatorBuilder {\n+\n+        private ThreadFactory            threadFactory;\n+        private RejectedExecutionHandler rejectedExecutionHandler;\n+        private Boolean allowCoreThreadTimeOut;\n+        private Integer poolSize;\n+        private Integer maxPoolSize;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0c523f0ca434202476e0bdea7cdad2fad90f4b2e"}, "originalPosition": 73}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "534f7f36a30c82813a980123cf47b8cbbd7828db", "author": {"user": {"login": "erickgonzalez", "name": null}}, "url": "https://github.com/dotCMS/core/commit/534f7f36a30c82813a980123cf47b8cbbd7828db", "committedDate": "2020-10-01T17:23:15Z", "message": "#19362 rename class"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b46cb6a9022c38f9ad79369fa17eb0218e74c63e", "author": {"user": {"login": "erickgonzalez", "name": null}}, "url": "https://github.com/dotCMS/core/commit/b46cb6a9022c38f9ad79369fa17eb0218e74c63e", "committedDate": "2020-10-01T17:23:29Z", "message": "Merge branch 'master' of github.com:dotCMS/core into issue-19362-make-dotsubmitter-configurable"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAwNTY5MzY2", "url": "https://github.com/dotCMS/core/pull/19367#pullrequestreview-500569366", "createdAt": "2020-10-01T17:30:11Z", "commit": {"oid": "b46cb6a9022c38f9ad79369fa17eb0218e74c63e"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxNzozMDoxMlrOHbUWOA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxNzozMzoyN1rOHbUc4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQwNjk2OA==", "bodyText": "nitpick but why not instantiator or even factory instead of creator", "url": "https://github.com/dotCMS/core/pull/19367#discussion_r498406968", "createdAt": "2020-10-01T17:30:12Z", "author": {"login": "fabrizzio-dotCMS"}, "path": "dotCMS/src/main/java/com/dotcms/concurrent/DotConcurrentFactory.java", "diffHunk": "@@ -269,6 +275,28 @@ public DotSubmitter getSubmitter () {\n         return this.getSubmitter(DOT_SYSTEM_THREAD_POOL);\n     } // getSubmitter.\n \n+    /**\n+     * Register a submitter creator and gets the submitter", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b46cb6a9022c38f9ad79369fa17eb0218e74c63e"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQwODY3NA==", "bodyText": "why ignored?", "url": "https://github.com/dotCMS/core/pull/19367#discussion_r498408674", "createdAt": "2020-10-01T17:33:27Z", "author": {"login": "fabrizzio-dotCMS"}, "path": "dotCMS/src/integration-test/java/com/dotcms/concurrent/DotConcurrentFactoryTest.java", "diffHunk": "@@ -10,6 +12,163 @@\n \n public class DotConcurrentFactoryTest {\n \n+    @Ignore\n+    @Test\n+    public void testDefaultOne_Submitter_Config() throws JSONException{\n+\n+        final String submitterName = \"testsubmitter\";\n+        final DotConcurrentFactory dotConcurrentFactory =\n+                DotConcurrentFactory.getInstance();\n+\n+        final DotSubmitter submitter =\n+                dotConcurrentFactory.getSubmitter(submitterName,\n+                        new SubmitterConfigBuilder().poolSize(2)\n+                        .maxPoolSize(4).queueCapacity(500).build()\n+                );\n+\n+        System.out.println(submitter);\n+\n+        IntStream.range(0, 40).forEach(\n+                n -> {\n+\n+                    if (n % 10 == 0) {\n+\n+                        System.out.println(submitter);\n+                    }\n+                    submitter.execute(new PrintTask(\"Thread\" + n));\n+                }\n+        );\n+\n+        //check active thread, if zero then shut down the thread pool\n+        for (;;) {\n+            int count = submitter.getActiveCount();\n+            System.out.println(\"Active Threads : \" + count);\n+            try {\n+                Thread.sleep(1000);\n+            } catch (InterruptedException e) {\n+                e.printStackTrace();\n+            }\n+            if (count == 0) {\n+                //submitter.shutdown();\n+                break;\n+            }\n+        }\n+\n+        System.out.print(\"Staring a new one submitter\");\n+\n+        final DotSubmitter submitter2 =\n+                dotConcurrentFactory.getSubmitter(submitterName);\n+\n+        System.out.println(submitter2);\n+\n+        assertTrue(submitter == submitter2);\n+\n+        IntStream.range(0, 20).forEach(\n+                n -> {\n+                    submitter2.execute(new PrintTask(\"Thread\" + n));\n+                }\n+        );\n+\n+        //check active thread, if zero then shut down the thread pool\n+        for (;;) {\n+            int count = submitter2.getActiveCount();\n+            System.out.println(\"Active Threads : \" + count);\n+            try {\n+                Thread.sleep(1000);\n+            } catch (InterruptedException e) {\n+                e.printStackTrace();\n+            }\n+            if (count == 0) {\n+                submitter2.shutdown();\n+                break;\n+            }\n+        }\n+\n+    }\n+\n+    @Ignore", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b46cb6a9022c38f9ad79369fa17eb0218e74c63e"}, "originalPosition": 88}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3e78a8e9959e3b8a4d984ae9f648f16a2a76fb12", "author": {"user": {"login": "erickgonzalez", "name": null}}, "url": "https://github.com/dotCMS/core/commit/3e78a8e9959e3b8a4d984ae9f648f16a2a76fb12", "committedDate": "2020-10-01T20:22:08Z", "message": "#19362 feedback"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a1983e6dc62107cbd2b29637b8939bbc10665863", "author": {"user": {"login": "erickgonzalez", "name": null}}, "url": "https://github.com/dotCMS/core/commit/a1983e6dc62107cbd2b29637b8939bbc10665863", "committedDate": "2020-10-01T20:28:38Z", "message": "#19362 feedback"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAwNzQ2Mjg4", "url": "https://github.com/dotCMS/core/pull/19367#pullrequestreview-500746288", "createdAt": "2020-10-01T21:57:32Z", "commit": {"oid": "a1983e6dc62107cbd2b29637b8939bbc10665863"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 662, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}