{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM4ODg4NTQ5", "number": 18760, "title": "Issue 18563 create resource for bundle operations", "bodyText": "This PR includes the following:\n\nNew Resource for uploading Bundles (POST multipart api/bundle) with options for sync/async upload\nPostman tests for resource above\nIncluded the rest of properties for the GraphQL Page API, for the page properties\nPostman tests for the above\nMake all the Postman tests for PageResource to pass by:\n\nImporting a bundle with the context (pages to test)\nFixing all the urls\nFixing all the asserts\nIncluding a bunch of new asserts\nRenaming and reorganizing tests\n\n\nValidation to avoid NPE when contentletsIds was not sent to REST Page Layout API\nBetter exception message for non existing pages on Page Resource REST", "createdAt": "2020-06-24T00:16:03Z", "url": "https://github.com/dotCMS/core/pull/18760", "merged": true, "mergeCommit": {"oid": "bca720b97f5ed7fc9e5d76aa58d2e51c47b25bd8"}, "closed": true, "closedAt": "2020-07-02T19:24:38Z", "author": {"login": "dsilvam"}, "timelineItems": {"totalCount": 25, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcuOr1ggH2gAyNDM4ODg4NTQ5OjRhOWZjNWQ0ODdlYjYxODY3OGUwNzYxY2VkZGM5OTM0MGNmZjI2YTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcxC3HdgFqTQ0MTkxOTEzMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4a9fc5d487eb618678e0761ceddc99340cff26a9", "author": {"user": {"login": "dsilvam", "name": "Daniel Silva"}}, "url": "https://github.com/dotCMS/core/commit/4a9fc5d487eb618678e0761ceddc99340cff26a9", "committedDate": "2020-06-24T00:13:09Z", "message": "18563 Endpoint for upload bundles"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e35680713d77a9df6e354ae932ada320064b2a24", "author": {"user": {"login": "dsilvam", "name": "Daniel Silva"}}, "url": "https://github.com/dotCMS/core/commit/e35680713d77a9df6e354ae932ada320064b2a24", "committedDate": "2020-06-24T00:15:42Z", "message": "18563 clean imports"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5e6e78731c93380edc9f3768933ea1b5fc95922c", "author": {"user": {"login": "dsilvam", "name": "Daniel Silva"}}, "url": "https://github.com/dotCMS/core/commit/5e6e78731c93380edc9f3768933ea1b5fc95922c", "committedDate": "2020-06-24T00:16:23Z", "message": "Merge branch 'master' of github.com:dotCMS/core into issue-18563-create-resource-for-bundle-operations"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2NjkxNDM5", "url": "https://github.com/dotCMS/core/pull/18760#pullrequestreview-436691439", "createdAt": "2020-06-24T14:17:26Z", "commit": {"oid": "5e6e78731c93380edc9f3768933ea1b5fc95922c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxNDoxNzoyNlrOGoUM8Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxNDoxNzoyNlrOGoUM8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDkyNzIxNw==", "bodyText": "postman test?", "url": "https://github.com/dotCMS/core/pull/18760#discussion_r444927217", "createdAt": "2020-06-24T14:17:26Z", "author": {"login": "freddyucv"}, "path": "dotCMS/src/main/java/com/dotcms/rest/BundleResource.java", "diffHunk": "@@ -588,4 +620,71 @@ public Response deleteAllSuccess(@Context final HttpServletRequest request,\n                 \"Removing bundles in a separated process, the result of the operation will be notified\")).build();\n     } // deleteAllSuccess.\n \n+    @POST\n+    @JSONP\n+    @NoCache\n+    @Produces({MediaType.APPLICATION_JSON, MediaType.APPLICATION_XML, MediaType.TEXT_PLAIN})\n+    @Consumes(MediaType.MULTIPART_FORM_DATA)\n+    public final Response postMultipart(@Context final HttpServletRequest request, @Context final HttpServletResponse response,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5e6e78731c93380edc9f3768933ea1b5fc95922c"}, "originalPosition": 96}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2NzQ1MDg4", "url": "https://github.com/dotCMS/core/pull/18760#pullrequestreview-436745088", "createdAt": "2020-06-24T15:10:53Z", "commit": {"oid": "5e6e78731c93380edc9f3768933ea1b5fc95922c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5df8f1a14d36cf01fd553b655b39b90bc9af869d", "author": {"user": {"login": "dsilvam", "name": "Daniel Silva"}}, "url": "https://github.com/dotCMS/core/commit/5df8f1a14d36cf01fd553b655b39b90bc9af869d", "committedDate": "2020-06-25T00:06:52Z", "message": "#18563 fixes for page resource tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "82f976aa9d132c6f372441f08bfcda3fd8626dca", "author": {"user": {"login": "dsilvam", "name": "Daniel Silva"}}, "url": "https://github.com/dotCMS/core/commit/82f976aa9d132c6f372441f08bfcda3fd8626dca", "committedDate": "2020-06-25T16:48:44Z", "message": "Merge branch 'master' of github.com:dotCMS/core into issue-18563-create-resource-for-bundle-operations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "847b87ecd70876547d8dcc8d37f495d2206ae492", "author": {"user": {"login": "dsilvam", "name": "Daniel Silva"}}, "url": "https://github.com/dotCMS/core/commit/847b87ecd70876547d8dcc8d37f495d2206ae492", "committedDate": "2020-06-26T00:10:21Z", "message": "#18563 rename page resource postman tests, include new bundle with context"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "453cf5445a491b467617f39ab0abf276c714a38b", "author": {"user": {"login": "dsilvam", "name": "Daniel Silva"}}, "url": "https://github.com/dotCMS/core/commit/453cf5445a491b467617f39ab0abf276c714a38b", "committedDate": "2020-06-27T00:08:20Z", "message": "#18563 more fixing to Page-Resource postman tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0591dccddd1fbd47c55832cf44cd579150af5806", "author": {"user": {"login": "dsilvam", "name": "Daniel Silva"}}, "url": "https://github.com/dotCMS/core/commit/0591dccddd1fbd47c55832cf44cd579150af5806", "committedDate": "2020-06-29T23:20:22Z", "message": "#18563 More fixes for Page API Postman tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b300ae9a478ff71de90c4afbfdb50fccba802a5b", "author": {"user": {"login": "dsilvam", "name": "Daniel Silva"}}, "url": "https://github.com/dotCMS/core/commit/b300ae9a478ff71de90c4afbfdb50fccba802a5b", "committedDate": "2020-06-30T15:44:56Z", "message": "Merge branch 'master' of github.com:dotCMS/core into issue-18563-create-resource-for-bundle-operations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8fcae847b760ca8f47ac7da41be978c6449cbf40", "author": {"user": {"login": "dsilvam", "name": "Daniel Silva"}}, "url": "https://github.com/dotCMS/core/commit/8fcae847b760ca8f47ac7da41be978c6449cbf40", "committedDate": "2020-06-30T23:13:36Z", "message": "* More tests and fixes for PageResource\n* Postman tests for BundleResource uploadBundle\n* Postman tests for GraphQL Page API - page properties\n* Other fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a9b222b9df641e494d4786285593e37bb14ff12b", "author": {"user": {"login": "dsilvam", "name": "Daniel Silva"}}, "url": "https://github.com/dotCMS/core/commit/a9b222b9df641e494d4786285593e37bb14ff12b", "committedDate": "2020-06-30T23:18:29Z", "message": "#18563 missed Postman tests in previous commit"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6a3e187da237d71f5cd1a627f6e13f6510945c7e", "author": {"user": {"login": "dsilvam", "name": "Daniel Silva"}}, "url": "https://github.com/dotCMS/core/commit/6a3e187da237d71f5cd1a627f6e13f6510945c7e", "committedDate": "2020-07-01T04:40:42Z", "message": "Merge branch 'master' of github.com:dotCMS/core into issue-18563-create-resource-for-bundle-operations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "66d5df2f12ee1d14ceae2fc61a64c4645e785088", "author": {"user": {"login": "dsilvam", "name": "Daniel Silva"}}, "url": "https://github.com/dotCMS/core/commit/66d5df2f12ee1d14ceae2fc61a64c4645e785088", "committedDate": "2020-07-01T05:06:25Z", "message": "#18563 More mods for Page Resource Postman tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQwOTAxMTUw", "url": "https://github.com/dotCMS/core/pull/18760#pullrequestreview-440901150", "createdAt": "2020-07-01T14:05:06Z", "commit": {"oid": "66d5df2f12ee1d14ceae2fc61a64c4645e785088"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6d4fddeb85ca19ebe0f9bb6f78cd82b3bd4181f7", "author": {"user": {"login": "dsilvam", "name": "Daniel Silva"}}, "url": "https://github.com/dotCMS/core/commit/6d4fddeb85ca19ebe0f9bb6f78cd82b3bd4181f7", "committedDate": "2020-07-01T15:35:00Z", "message": "#18563 codacy feedback"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "42ef4b6e2f50b2e1ab1bdd438742b402a8d9be26", "author": {"user": {"login": "dsilvam", "name": "Daniel Silva"}}, "url": "https://github.com/dotCMS/core/commit/42ef4b6e2f50b2e1ab1bdd438742b402a8d9be26", "committedDate": "2020-07-01T16:18:31Z", "message": "#18563 force tests to run"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e78b09dc3921988c593089808d69bea99d1b4c13", "author": {"user": {"login": "dsilvam", "name": "Daniel Silva"}}, "url": "https://github.com/dotCMS/core/commit/e78b09dc3921988c593089808d69bea99d1b4c13", "committedDate": "2020-07-01T17:04:58Z", "message": "#18563 more fixes for postman"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e61b31745e3fc16c3bb47d803951c7a5620cbbe4", "author": {"user": {"login": "dsilvam", "name": "Daniel Silva"}}, "url": "https://github.com/dotCMS/core/commit/e61b31745e3fc16c3bb47d803951c7a5620cbbe4", "committedDate": "2020-07-01T17:50:05Z", "message": "Merge branch 'master' of github.com:dotCMS/core into issue-18563-create-resource-for-bundle-operations"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "945544aa3b7c374050c1379dd76d9ef7f9231764", "author": {"user": {"login": "dsilvam", "name": "Daniel Silva"}}, "url": "https://github.com/dotCMS/core/commit/945544aa3b7c374050c1379dd76d9ef7f9231764", "committedDate": "2020-07-02T16:02:47Z", "message": "$18563 Fix htmlpage tests and FieldBuilderTest. testValuesCheck"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxODY5MzQ4", "url": "https://github.com/dotCMS/core/pull/18760#pullrequestreview-441869348", "createdAt": "2020-07-02T16:54:15Z", "commit": {"oid": "945544aa3b7c374050c1379dd76d9ef7f9231764"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9fcf743d7a5e4ff07daef9682650befa28d41319", "author": {"user": {"login": "dsilvam", "name": "Daniel Silva"}}, "url": "https://github.com/dotCMS/core/commit/9fcf743d7a5e4ff07daef9682650befa28d41319", "committedDate": "2020-07-02T18:01:26Z", "message": "#18563 remove space at the end of url"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxOTE5MTIw", "url": "https://github.com/dotCMS/core/pull/18760#pullrequestreview-441919120", "createdAt": "2020-07-02T18:08:22Z", "commit": {"oid": "9fcf743d7a5e4ff07daef9682650befa28d41319"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQxODowODoyMlrOGsYR3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQxODowODoyMlrOGsYR3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTE4ODMxNg==", "bodyText": "Codacy found an issue: This call to String.startsWith can be rewritten using String.charAt(0)", "url": "https://github.com/dotCMS/core/pull/18760#discussion_r449188316", "createdAt": "2020-07-02T18:08:22Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/main/java/com/dotcms/rest/BundleResource.java", "diffHunk": "@@ -588,4 +621,77 @@ public Response deleteAllSuccess(@Context final HttpServletRequest request,\n                 \"Removing bundles in a separated process, the result of the operation will be notified\")).build();\n     } // deleteAllSuccess.\n \n+    @POST\n+    @JSONP\n+    @NoCache\n+    @Produces({MediaType.APPLICATION_JSON, MediaType.APPLICATION_XML, MediaType.TEXT_PLAIN})\n+    @Consumes(MediaType.MULTIPART_FORM_DATA)\n+    public final Response uploadBundle(@Context final HttpServletRequest request, @Context final HttpServletResponse response,\n+            FormDataMultiPart multipart,\n+            @Context UriInfo uriInfo, @QueryParam(\"sync\") boolean sync) throws DotPublisherException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requiredBackendUser(true)\n+                .requiredFrontendUser(false)\n+                .requestAndResponse(request, response)\n+                .rejectWhenNoUser(true)\n+                .init();\n+\n+        for (final BodyPart part : multipart.getBodyParts()) {\n+            try(InputStream inputStream = part.getEntity() instanceof InputStream ? (InputStream) part\n+                    .getEntity()\n+                    : Try.of(() -> part.getEntityAs(InputStream.class)).getOrNull()) {\n+\n+                if (inputStream == null) {\n+                    continue;\n+                }\n+                final ContentDisposition meta = part.getContentDisposition();\n+                if (meta == null) {\n+                    continue;\n+                }\n+                final String fileName = meta.getFileName();\n+                if (UtilMethods.isNotSet(fileName) || fileName.startsWith(\".\") || fileName", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9fcf743d7a5e4ff07daef9682650befa28d41319"}, "originalPosition": 121}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQxOTE5MTMw", "url": "https://github.com/dotCMS/core/pull/18760#pullrequestreview-441919130", "createdAt": "2020-07-02T18:08:23Z", "commit": {"oid": "9fcf743d7a5e4ff07daef9682650befa28d41319"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQxODowODoyM1rOGsYR5Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQxODowODoyM1rOGsYR5Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTE4ODMyNQ==", "bodyText": "Codacy found an issue: Avoid declaring a variable if it is unreferenced before a possible exit point.", "url": "https://github.com/dotCMS/core/pull/18760#discussion_r449188325", "createdAt": "2020-07-02T18:08:23Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/main/java/com/dotcms/rest/api/v1/page/PageResource.java", "diffHunk": "@@ -406,12 +407,12 @@ public final Response addContent(@Context final HttpServletRequest request,\n         Logger.debug(this, ()->String.format(\"Saving page's content: %s\",\n                 pageContainerForm != null ? pageContainerForm.getRequestJson() : null));\n \n+        final InitDataObject initData = webResource.init(request, response,true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9fcf743d7a5e4ff07daef9682650befa28d41319"}, "originalPosition": 36}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 774, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}