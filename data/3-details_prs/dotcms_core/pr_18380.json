{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEwMjY3NDc2", "number": 18380, "title": "Issue 18354 more normal", "bodyText": "", "createdAt": "2020-04-28T17:48:10Z", "url": "https://github.com/dotCMS/core/pull/18380", "merged": true, "mergeCommit": {"oid": "73c8b76abc2c79c794c626d1936d97cf08cc5399"}, "closed": true, "closedAt": "2020-04-29T19:29:21Z", "author": {"login": "wezell"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcazozDAH2gAyNDEwMjY3NDc2OmI3N2E5ZmE0NDEzZjgwZTZkNzA3MDQ3NGZmNDhiNjlhZjM0MzM2ZWI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABccbjuOgFqTQwMjg2NDM2Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b77a9fa4413f80e6d7070474ff48b69af34336eb", "author": {"user": {"login": "wezell", "name": "Will Ezell"}}, "url": "https://github.com/dotCMS/core/commit/b77a9fa4413f80e6d7070474ff48b69af34336eb", "committedDate": "2020-04-24T15:57:50Z", "message": "#18354 changes // for /"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7234d6110ff44eb9676103a8b8aa1cd7afbf7157", "author": {"user": {"login": "wezell", "name": "Will Ezell"}}, "url": "https://github.com/dotCMS/core/commit/7234d6110ff44eb9676103a8b8aa1cd7afbf7157", "committedDate": "2020-04-24T16:47:26Z", "message": "#18354 fixes ////"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAyMTk0Njg0", "url": "https://github.com/dotCMS/core/pull/18380#pullrequestreview-402194684", "createdAt": "2020-04-28T20:40:52Z", "commit": {"oid": "7234d6110ff44eb9676103a8b8aa1cd7afbf7157"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAyMjM5MTEw", "url": "https://github.com/dotCMS/core/pull/18380#pullrequestreview-402239110", "createdAt": "2020-04-28T21:52:22Z", "commit": {"oid": "7234d6110ff44eb9676103a8b8aa1cd7afbf7157"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQyMTo1MjoyMlrOGNoYcw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQyMTo1MjoyMlrOGNoYcw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjk0NjI5MQ==", "bodyText": "I think you could use something like\nreturn newNormal.replaceAll(Pattern.quote(\"//\"), StringPool.SLASH);", "url": "https://github.com/dotCMS/core/pull/18380#discussion_r416946291", "createdAt": "2020-04-28T21:52:22Z", "author": {"login": "jdotcms"}, "path": "dotCMS/src/main/java/com/dotcms/filters/NormalizationFilter.java", "diffHunk": "@@ -36,7 +36,12 @@ public String getRequestURI() {\n                  2. A \"..\" segment is removed only if it is preceded by a non-\"..\" segment.\n                  3. Normalization has no effect upon opaque URIs. (mailto:a@b.com)\n                  */\n-                return URI.create(super.getRequestURI()).normalize().toString();\n+                String newNormal = URI.create(super.getRequestURI()).normalize().toString();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7234d6110ff44eb9676103a8b8aa1cd7afbf7157"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAyNzI4OTM2", "url": "https://github.com/dotCMS/core/pull/18380#pullrequestreview-402728936", "createdAt": "2020-04-29T14:33:41Z", "commit": {"oid": "7234d6110ff44eb9676103a8b8aa1cd7afbf7157"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQxNDozMzo0MVrOGOB2ag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQxNDozMzo0MVrOGOB2ag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzM2MzU2Mg==", "bodyText": "miss test here", "url": "https://github.com/dotCMS/core/pull/18380#discussion_r417363562", "createdAt": "2020-04-29T14:33:41Z", "author": {"login": "freddyucv"}, "path": "dotCMS/src/main/java/com/dotcms/filters/NormalizationFilter.java", "diffHunk": "@@ -36,7 +36,12 @@ public String getRequestURI() {\n                  2. A \"..\" segment is removed only if it is preceded by a non-\"..\" segment.\n                  3. Normalization has no effect upon opaque URIs. (mailto:a@b.com)\n                  */\n-                return URI.create(super.getRequestURI()).normalize().toString();\n+                String newNormal = URI.create(super.getRequestURI()).normalize().toString();\n+                \n+                while(newNormal.indexOf(\"//\")>-1) {\n+                    newNormal = newNormal.replace(\"//\", \"/\");\n+                }\n+                return newNormal;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7234d6110ff44eb9676103a8b8aa1cd7afbf7157"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAyNzQyNDk0", "url": "https://github.com/dotCMS/core/pull/18380#pullrequestreview-402742494", "createdAt": "2020-04-29T14:47:02Z", "commit": {"oid": "7234d6110ff44eb9676103a8b8aa1cd7afbf7157"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b7c5c4079cf3dee767923d2147ea51692b76f10", "author": {"user": {"login": "wezell", "name": "Will Ezell"}}, "url": "https://github.com/dotCMS/core/commit/4b7c5c4079cf3dee767923d2147ea51692b76f10", "committedDate": "2020-04-29T16:56:29Z", "message": "#18354 more testing and better cleanup"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAyODY0Mjg3", "url": "https://github.com/dotCMS/core/pull/18380#pullrequestreview-402864287", "createdAt": "2020-04-29T17:02:19Z", "commit": {"oid": "4b7c5c4079cf3dee767923d2147ea51692b76f10"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQxNzowMjoxOVrOGOIaNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQxNzowMjoxOVrOGOIaNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzQ3MTAyOQ==", "bodyText": "Issue found: JUnit tests should include assert() or fail()", "url": "https://github.com/dotCMS/core/pull/18380#discussion_r417471029", "createdAt": "2020-04-29T17:02:19Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/test/java/com/dotcms/filters/NormalizationFilterTest.java", "diffHunk": "@@ -111,5 +135,73 @@ private void compare(final String originalURI, final String expectedNormalizedUR\n         assertNotNull(normalizedValueByFilter);\n         assertEquals(expectedNormalizedURI, normalizedValueByFilter);\n     }\n+    \n+    /**\n+     * Test to verify the {@link NormalizationFilter} is applying properly the normalization on\n+     * invalids URIs\n+     */\n+    @Test\n+    public void test_uri_normalizer_fixes_double_slashes() throws IOException, ServletException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b7c5c4079cf3dee767923d2147ea51692b76f10"}, "originalPosition": 96}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAyODY0Mjk2", "url": "https://github.com/dotCMS/core/pull/18380#pullrequestreview-402864296", "createdAt": "2020-04-29T17:02:20Z", "commit": {"oid": "4b7c5c4079cf3dee767923d2147ea51692b76f10"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQxNzowMjoyMFrOGOIaPA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQxNzowMjoyMFrOGOIaPA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzQ3MTAzNg==", "bodyText": "Issue found: String.indexOf(char) is faster than String.indexOf(String).", "url": "https://github.com/dotCMS/core/pull/18380#discussion_r417471036", "createdAt": "2020-04-29T17:02:20Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/test/java/com/dotcms/filters/NormalizationFilterTest.java", "diffHunk": "@@ -86,15 +109,16 @@ public void test_uri_normalization_valid_URI() throws IOException, ServletExcept\n         String originalURI = \"/folder/important/secret_file.dat\";\n         compare(originalURI, originalURI);\n \n+        // (query strings are not part of URI)\n         originalURI = \"/folder/folder1/forward_jsp.jsp?FORWARD_URL=http://google.com\";\n-        compare(originalURI, originalURI);\n+        compare(originalURI, originalURI.substring(0,originalURI.indexOf(\"?\")));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b7c5c4079cf3dee767923d2147ea51692b76f10"}, "originalPosition": 72}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAyODY0MzEy", "url": "https://github.com/dotCMS/core/pull/18380#pullrequestreview-402864312", "createdAt": "2020-04-29T17:02:21Z", "commit": {"oid": "4b7c5c4079cf3dee767923d2147ea51692b76f10"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQxNzowMjoyMVrOGOIaTQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQxNzowMjoyMVrOGOIaTQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzQ3MTA1Mw==", "bodyText": "Issue found: The String literal \"/folder/folder1/file.dat\" appears 4 times in this file; the first occurrence is on line 66", "url": "https://github.com/dotCMS/core/pull/18380#discussion_r417471053", "createdAt": "2020-04-29T17:02:21Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/test/java/com/dotcms/filters/NormalizationFilterTest.java", "diffHunk": "@@ -62,18 +63,40 @@ public void test_uri_normalization_invalid_URI() throws IOException, ServletExce\n \n         // Each \".\" segment is simply removed\n         originalURI = \"./folder/folder1/file.dat\";\n-        expectedNormalizedURI = \"folder/folder1/file.dat\";\n+        expectedNormalizedURI = \"/folder/folder1/file.dat\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b7c5c4079cf3dee767923d2147ea51692b76f10"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAyODY0MzI2", "url": "https://github.com/dotCMS/core/pull/18380#pullrequestreview-402864326", "createdAt": "2020-04-29T17:02:22Z", "commit": {"oid": "4b7c5c4079cf3dee767923d2147ea51692b76f10"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQxNzowMjoyMlrOGOIaVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQxNzowMjoyMlrOGOIaVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzQ3MTA2MA==", "bodyText": "Issue found: Avoid empty catch blocks", "url": "https://github.com/dotCMS/core/pull/18380#discussion_r417471060", "createdAt": "2020-04-29T17:02:22Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/main/java/com/dotcms/filters/NormalizationFilter.java", "diffHunk": "@@ -30,13 +37,35 @@ public void doFilter(ServletRequest servletRequest, ServletResponse servletRespo\n \n             @Override\n             public String getRequestURI() {\n+                try {\n+                    /* Normalization is the process of removing unnecessary \".\" and \"..\" segments from the path component of a hierarchical URI.\n+                     1. Each \".\" segment is simply removed.\n+                     2. A \"..\" segment is removed only if it is preceded by a non-\"..\" segment.\n+                     3. Normalization has no effect upon opaque URIs. (mailto:a@b.com)\n+                     */\n \n-                /* Normalization is the process of removing unnecessary \".\" and \"..\" segments from the path component of a hierarchical URI.\n-                 1. Each \".\" segment is simply removed.\n-                 2. A \"..\" segment is removed only if it is preceded by a non-\"..\" segment.\n-                 3. Normalization has no effect upon opaque URIs. (mailto:a@b.com)\n-                 */\n-                return URI.create(super.getRequestURI()).normalize().toString();\n+                    String newNormal = URI.create(super.getRequestURI()).normalize().toString();\n+                    newNormal = newNormal.startsWith(DOUBLEPEROIDS) ? newNormal.replace(DOUBLEPEROIDS, \"\") : newNormal;\n+                    newNormal = newNormal.startsWith(SLASH) ? newNormal : SLASH + newNormal;\n+\n+                    // this should not happen \n+                    newNormal = newNormal.indexOf(QUESTION )>-1 ? newNormal.substring(0,newNormal.indexOf(StringPool.QUESTION)) : newNormal;\n+                    while(newNormal.indexOf(DOUBLESLASH)>-1) {\n+                        newNormal = newNormal.replace(DOUBLESLASH, SLASH);\n+                    }\n+                    return newNormal;\n+                }\n+                catch(IllegalArgumentException ill) {\n+                    Logger.warnAndDebug(this.getClass(),ill);\n+                    HttpServletResponse response= (HttpServletResponse) servletResponse;\n+                    try {\n+                        response.sendError(HttpServletResponse.SC_FORBIDDEN);\n+                        response.flushBuffer();\n+                    }\n+                    catch(Exception e) {}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b7c5c4079cf3dee767923d2147ea51692b76f10"}, "originalPosition": 56}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAyODY0MzM3", "url": "https://github.com/dotCMS/core/pull/18380#pullrequestreview-402864337", "createdAt": "2020-04-29T17:02:23Z", "commit": {"oid": "4b7c5c4079cf3dee767923d2147ea51692b76f10"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQxNzowMjoyM1rOGOIaYQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQxNzowMjoyM1rOGOIaYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzQ3MTA3Mw==", "bodyText": "Issue found: JUnit tests should include assert() or fail()", "url": "https://github.com/dotCMS/core/pull/18380#discussion_r417471073", "createdAt": "2020-04-29T17:02:23Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/test/java/com/dotcms/filters/NormalizationFilterTest.java", "diffHunk": "@@ -111,5 +135,73 @@ private void compare(final String originalURI, final String expectedNormalizedUR\n         assertNotNull(normalizedValueByFilter);\n         assertEquals(expectedNormalizedURI, normalizedValueByFilter);\n     }\n+    \n+    /**\n+     * Test to verify the {@link NormalizationFilter} is applying properly the normalization on\n+     * invalids URIs\n+     */\n+    @Test\n+    public void test_uri_normalizer_fixes_double_slashes() throws IOException, ServletException {\n+\n+        \n+        // remove all //, replace with /\n+        String originalURI = \"//folder/important/secret_file.dat\";\n+        String expectedNormalizedURI = \"/folder/important/secret_file.dat\";\n+        compare(originalURI, expectedNormalizedURI);\n+\n+        // testing ///\n+        originalURI = \"///folder/important/secret_file.dat\";\n+        compare(originalURI, expectedNormalizedURI);\n+\n+        // testing ////\n+        originalURI = \"////folder/important/secret_file.dat\";\n+        compare(originalURI, expectedNormalizedURI);\n+        \n+\n+        \n+        // testing multiple ////\n+        originalURI = \"////folder/important///secret_file.dat\";\n+        compare(originalURI, expectedNormalizedURI);\n+        \n+        // testing // not at the root (query strings are not part of URI)\n+        originalURI = \"/test//folder/folder1//forward_jsp.jsp?FORWARD_URL=http://google.com\";\n+        expectedNormalizedURI = \"/test/folder/folder1/forward_jsp.jsp\";\n+        compare(originalURI, expectedNormalizedURI);\n+\n+        // A \"..\" segment is removed only if it is preceded by a non-\"..\" segment\n+        originalURI = \"///test/../folder/important//../secret_file.dat\";\n+        expectedNormalizedURI = \"/folder/secret_file.dat\";\n+        compare(originalURI, expectedNormalizedURI);\n+\n+        // Each \".\" segment is simply removed\n+        originalURI = \"./f/older//folder1//file.dat\";\n+        expectedNormalizedURI = \"/f/older/folder1/file.dat\";\n+        compare(originalURI, expectedNormalizedURI);\n+\n+        // Each \".\" segment is simply removed\n+        originalURI = \"./folder/./folder1/file.dat//..//\";\n+        expectedNormalizedURI = \"/folder/folder1/\";\n+        compare(originalURI, expectedNormalizedURI);\n+\n+        // starts with ..//\n+        originalURI = \"..//folder/./folder1//file.dat\";\n+        expectedNormalizedURI = \"/folder/folder1/file.dat\";\n+        compare(originalURI, expectedNormalizedURI);\n+    }\n+    \n+    \n+    /**\n+     * Test to verify the {@link NormalizationFilter} is applying properly the normalization on\n+     * invalids URIs\n+     */\n+    @Test\n+    public void test_uri_normalizer_invalid_uris() throws IOException, ServletException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b7c5c4079cf3dee767923d2147ea51692b76f10"}, "originalPosition": 150}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAyODY0MzUx", "url": "https://github.com/dotCMS/core/pull/18380#pullrequestreview-402864351", "createdAt": "2020-04-29T17:02:24Z", "commit": {"oid": "4b7c5c4079cf3dee767923d2147ea51692b76f10"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQxNzowMjoyNFrOGOIabQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQxNzowMjoyNFrOGOIabQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzQ3MTA4NQ==", "bodyText": "Issue found: Local variable 'originalURI' could be declared final", "url": "https://github.com/dotCMS/core/pull/18380#discussion_r417471085", "createdAt": "2020-04-29T17:02:24Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/test/java/com/dotcms/filters/NormalizationFilterTest.java", "diffHunk": "@@ -111,5 +135,73 @@ private void compare(final String originalURI, final String expectedNormalizedUR\n         assertNotNull(normalizedValueByFilter);\n         assertEquals(expectedNormalizedURI, normalizedValueByFilter);\n     }\n+    \n+    /**\n+     * Test to verify the {@link NormalizationFilter} is applying properly the normalization on\n+     * invalids URIs\n+     */\n+    @Test\n+    public void test_uri_normalizer_fixes_double_slashes() throws IOException, ServletException {\n+\n+        \n+        // remove all //, replace with /\n+        String originalURI = \"//folder/important/secret_file.dat\";\n+        String expectedNormalizedURI = \"/folder/important/secret_file.dat\";\n+        compare(originalURI, expectedNormalizedURI);\n+\n+        // testing ///\n+        originalURI = \"///folder/important/secret_file.dat\";\n+        compare(originalURI, expectedNormalizedURI);\n+\n+        // testing ////\n+        originalURI = \"////folder/important/secret_file.dat\";\n+        compare(originalURI, expectedNormalizedURI);\n+        \n+\n+        \n+        // testing multiple ////\n+        originalURI = \"////folder/important///secret_file.dat\";\n+        compare(originalURI, expectedNormalizedURI);\n+        \n+        // testing // not at the root (query strings are not part of URI)\n+        originalURI = \"/test//folder/folder1//forward_jsp.jsp?FORWARD_URL=http://google.com\";\n+        expectedNormalizedURI = \"/test/folder/folder1/forward_jsp.jsp\";\n+        compare(originalURI, expectedNormalizedURI);\n+\n+        // A \"..\" segment is removed only if it is preceded by a non-\"..\" segment\n+        originalURI = \"///test/../folder/important//../secret_file.dat\";\n+        expectedNormalizedURI = \"/folder/secret_file.dat\";\n+        compare(originalURI, expectedNormalizedURI);\n+\n+        // Each \".\" segment is simply removed\n+        originalURI = \"./f/older//folder1//file.dat\";\n+        expectedNormalizedURI = \"/f/older/folder1/file.dat\";\n+        compare(originalURI, expectedNormalizedURI);\n+\n+        // Each \".\" segment is simply removed\n+        originalURI = \"./folder/./folder1/file.dat//..//\";\n+        expectedNormalizedURI = \"/folder/folder1/\";\n+        compare(originalURI, expectedNormalizedURI);\n+\n+        // starts with ..//\n+        originalURI = \"..//folder/./folder1//file.dat\";\n+        expectedNormalizedURI = \"/folder/folder1/file.dat\";\n+        compare(originalURI, expectedNormalizedURI);\n+    }\n+    \n+    \n+    /**\n+     * Test to verify the {@link NormalizationFilter} is applying properly the normalization on\n+     * invalids URIs\n+     */\n+    @Test\n+    public void test_uri_normalizer_invalid_uris() throws IOException, ServletException {\n+        // testing escaped slashes - Filter barfs and returns /\n+        String originalURI = \"/\\\\///folder//important////secret_file.dat\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b7c5c4079cf3dee767923d2147ea51692b76f10"}, "originalPosition": 152}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAyODY0MzYz", "url": "https://github.com/dotCMS/core/pull/18380#pullrequestreview-402864363", "createdAt": "2020-04-29T17:02:25Z", "commit": {"oid": "4b7c5c4079cf3dee767923d2147ea51692b76f10"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQxNzowMjoyNVrOGOIaeg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQxNzowMjoyNVrOGOIaeg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzQ3MTA5OA==", "bodyText": "Issue found: Avoid catching generic exceptions such as NullPointerException, RuntimeException, Exception in try-catch block", "url": "https://github.com/dotCMS/core/pull/18380#discussion_r417471098", "createdAt": "2020-04-29T17:02:25Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/main/java/com/dotcms/filters/NormalizationFilter.java", "diffHunk": "@@ -30,13 +37,35 @@ public void doFilter(ServletRequest servletRequest, ServletResponse servletRespo\n \n             @Override\n             public String getRequestURI() {\n+                try {\n+                    /* Normalization is the process of removing unnecessary \".\" and \"..\" segments from the path component of a hierarchical URI.\n+                     1. Each \".\" segment is simply removed.\n+                     2. A \"..\" segment is removed only if it is preceded by a non-\"..\" segment.\n+                     3. Normalization has no effect upon opaque URIs. (mailto:a@b.com)\n+                     */\n \n-                /* Normalization is the process of removing unnecessary \".\" and \"..\" segments from the path component of a hierarchical URI.\n-                 1. Each \".\" segment is simply removed.\n-                 2. A \"..\" segment is removed only if it is preceded by a non-\"..\" segment.\n-                 3. Normalization has no effect upon opaque URIs. (mailto:a@b.com)\n-                 */\n-                return URI.create(super.getRequestURI()).normalize().toString();\n+                    String newNormal = URI.create(super.getRequestURI()).normalize().toString();\n+                    newNormal = newNormal.startsWith(DOUBLEPEROIDS) ? newNormal.replace(DOUBLEPEROIDS, \"\") : newNormal;\n+                    newNormal = newNormal.startsWith(SLASH) ? newNormal : SLASH + newNormal;\n+\n+                    // this should not happen \n+                    newNormal = newNormal.indexOf(QUESTION )>-1 ? newNormal.substring(0,newNormal.indexOf(StringPool.QUESTION)) : newNormal;\n+                    while(newNormal.indexOf(DOUBLESLASH)>-1) {\n+                        newNormal = newNormal.replace(DOUBLESLASH, SLASH);\n+                    }\n+                    return newNormal;\n+                }\n+                catch(IllegalArgumentException ill) {\n+                    Logger.warnAndDebug(this.getClass(),ill);\n+                    HttpServletResponse response= (HttpServletResponse) servletResponse;\n+                    try {\n+                        response.sendError(HttpServletResponse.SC_FORBIDDEN);\n+                        response.flushBuffer();\n+                    }\n+                    catch(Exception e) {}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b7c5c4079cf3dee767923d2147ea51692b76f10"}, "originalPosition": 56}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1035, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}