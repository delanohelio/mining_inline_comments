{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg4MDU1MjQz", "number": 18139, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQyMjoyNzo1MFrODohXbA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQyMjoyNzo1M1rODohXeQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzODE2MzAwOnYy", "diffSide": "RIGHT", "path": "dotCMS/src/main/java/com/dotcms/rendering/velocity/services/PageLoader.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQyMjoyNzo1MFrOF3H0cw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQyMjoyNzo1MFrOF3H0cw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM0NDExNQ==", "bodyText": "Issue found: StringBuffer (or StringBuilder).append is called consecutively without reusing the target variable.", "url": "https://github.com/dotCMS/core/pull/18139#discussion_r393344115", "createdAt": "2020-03-16T22:27:50Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/main/java/com/dotcms/rendering/velocity/services/PageLoader.java", "diffHunk": "@@ -197,6 +186,15 @@ public InputStream buildStream(IHTMLPage htmlPage, PageMode mode, final String f\n \n     }\n \n+    private void addWidgetPreExecuteCodeAndPageInfo(final HTMLPageAsset htmlPage, final PageMode mode,\n+            final StringBuilder stringBuilder, final User user) throws DotSecurityException, DotDataException {\n+        final PageRenderUtil pce = new PageRenderUtil(htmlPage, user, mode);\n+        // Add the pre-execute code of a widget to the page\n+        stringBuilder.append(pce.getWidgetPreExecute());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "abccab01613ea4669e7646a7aa8d01cf6041ec8d"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzODE2MzA4OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQyMjoyNzo1MlrOF3H0gQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQyMjoyNzo1MlrOF3H0gQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM0NDEyOQ==", "bodyText": "Issue found: Local variable 'contentType' could be declared final", "url": "https://github.com/dotCMS/core/pull/18139#discussion_r393344129", "createdAt": "2020-03-16T22:27:52Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "diffHunk": "@@ -1298,6 +1300,72 @@ public void shouldRenderUsingOtherSiteContainerAndNotAdvanceTemplate() throws Ex\n         Assert.assertTrue(html.contains(\"content2content1\"));\n     }\n \n+    //Data Provider for the Widget Pre-execute code test\n+    @DataProvider\n+    public static Object[] dataProviderWidgetPreExecuteCode() {\n+        return new Object[] {\n+                new WidgetPreExecuteCodeTestCase(PageMode.EDIT_MODE),\n+                new WidgetPreExecuteCodeTestCase(PageMode.PREVIEW_MODE),\n+                new WidgetPreExecuteCodeTestCase(PageMode.LIVE),\n+        };\n+    }\n+\n+    private static class WidgetPreExecuteCodeTestCase {\n+        final PageMode pageMode;\n+\n+        public WidgetPreExecuteCodeTestCase(final PageMode pageMode) {\n+            this.pageMode = pageMode;\n+        }\n+    }\n+\n+    @Test\n+    @UseDataProvider(\"dataProviderWidgetPreExecuteCode\")\n+    public void test_WidgetPreExecuteCodeShowRegardlessPageMode(final WidgetPreExecuteCodeTestCase testCase) throws Exception {\n+\n+        //Update the Preexecute Field to have some code in it\n+        final String preExcuteCode = \"PreExecute Code Displayed\";\n+        ContentType contentType = TestDataUtils.getWidgetLikeContentType();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "abccab01613ea4669e7646a7aa8d01cf6041ec8d"}, "originalPosition": 41}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQzODE2MzEzOnYy", "diffSide": "RIGHT", "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQyMjoyNzo1M1rOF3H0iQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNlQyMjoyNzo1M1rOF3H0iQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM0NDEzNw==", "bodyText": "Issue found: Local variable 'multiTree' could be declared final", "url": "https://github.com/dotCMS/core/pull/18139#discussion_r393344137", "createdAt": "2020-03-16T22:27:53Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "diffHunk": "@@ -1298,6 +1300,72 @@ public void shouldRenderUsingOtherSiteContainerAndNotAdvanceTemplate() throws Ex\n         Assert.assertTrue(html.contains(\"content2content1\"));\n     }\n \n+    //Data Provider for the Widget Pre-execute code test\n+    @DataProvider\n+    public static Object[] dataProviderWidgetPreExecuteCode() {\n+        return new Object[] {\n+                new WidgetPreExecuteCodeTestCase(PageMode.EDIT_MODE),\n+                new WidgetPreExecuteCodeTestCase(PageMode.PREVIEW_MODE),\n+                new WidgetPreExecuteCodeTestCase(PageMode.LIVE),\n+        };\n+    }\n+\n+    private static class WidgetPreExecuteCodeTestCase {\n+        final PageMode pageMode;\n+\n+        public WidgetPreExecuteCodeTestCase(final PageMode pageMode) {\n+            this.pageMode = pageMode;\n+        }\n+    }\n+\n+    @Test\n+    @UseDataProvider(\"dataProviderWidgetPreExecuteCode\")\n+    public void test_WidgetPreExecuteCodeShowRegardlessPageMode(final WidgetPreExecuteCodeTestCase testCase) throws Exception {\n+\n+        //Update the Preexecute Field to have some code in it\n+        final String preExcuteCode = \"PreExecute Code Displayed\";\n+        ContentType contentType = TestDataUtils.getWidgetLikeContentType();\n+        final Field preExecuteField = APILocator.getContentTypeFieldAPI().byContentTypeIdAndVar(contentType.id(),WidgetContentType.WIDGET_PRE_EXECUTE_FIELD_VAR);\n+        APILocator.getContentTypeFieldAPI()\n+                .save(FieldBuilder.builder(preExecuteField).values(preExcuteCode).build(), systemUser);\n+        // Assert that the widget has set the pre-execute field\n+        Assert.assertTrue(APILocator.getContentTypeFieldAPI()\n+                .byContentTypeIdAndVar(contentType.id(),WidgetContentType.WIDGET_PRE_EXECUTE_FIELD_VAR)\n+                .values().equals(preExcuteCode));\n+\n+        //Create Contentlet\n+        final Contentlet widgetContentlet = TestDataUtils.getWidgetContent(true,1,contentType.id());\n+        addAnonymousPermissions(widgetContentlet);\n+\n+        //Create Container, Template and Page\n+        final Container container = createContainer();\n+        final Template template = createTemplate(container);\n+\n+        final String pageName = \"testPage-\"+System.currentTimeMillis();\n+        final HTMLPageAsset page = createHtmlPageAsset(template, pageName, 1);\n+\n+        //Add contentlet to the page\n+        MultiTree multiTree = new MultiTree(page.getIdentifier(), container.getIdentifier(),widgetContentlet.getIdentifier() ,UUID,0);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "abccab01613ea4669e7646a7aa8d01cf6041ec8d"}, "originalPosition": 62}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2380, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}