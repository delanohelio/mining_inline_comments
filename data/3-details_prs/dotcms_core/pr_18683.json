{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM1ODU2MTc1", "number": 18683, "title": "Issue 18682 delayed delegates", "bodyText": "", "createdAt": "2020-06-17T13:34:11Z", "url": "https://github.com/dotCMS/core/pull/18683", "merged": true, "mergeCommit": {"oid": "7ae692aeec908c9b849bc59180b7ab26b9a699e6"}, "closed": true, "closedAt": "2020-06-22T18:07:49Z", "author": {"login": "wezell"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcsJv2xAH2gAyNDM1ODU2MTc1OjcyMzU0NmU4ZjlhYzc2M2UzODBkZjI5MjcwMmY2Mjk3OTQzODRjNzI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABct0idzgFqTQzNTE0NDc0NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "723546e8f9ac763e380df292702f629794384c72", "author": {"user": {"login": "wezell", "name": "Will Ezell"}}, "url": "https://github.com/dotCMS/core/commit/723546e8f9ac763e380df292702f629794384c72", "committedDate": "2020-06-17T13:20:10Z", "message": "#18682 runs 50 delegates at a time"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7b754ab23aeae22f23566c0bd9da3d79e40c3aee", "author": {"user": {"login": "wezell", "name": "Will Ezell"}}, "url": "https://github.com/dotCMS/core/commit/7b754ab23aeae22f23566c0bd9da3d79e40c3aee", "committedDate": "2020-06-17T13:32:08Z", "message": "#18682 added test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyNDM4NTA2", "url": "https://github.com/dotCMS/core/pull/18683#pullrequestreview-432438506", "createdAt": "2020-06-17T14:06:40Z", "commit": {"oid": "7b754ab23aeae22f23566c0bd9da3d79e40c3aee"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxNDowNjo0MVrOGlHdZw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxNDowNjo0MVrOGlHdZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTU3MjcxMQ==", "bodyText": "Issue found: Useless parentheses.", "url": "https://github.com/dotCMS/core/pull/18683#discussion_r441572711", "createdAt": "2020-06-17T14:06:41Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/concurrent/DotConcurrentFactoryTest.java", "diffHunk": "@@ -101,4 +103,44 @@ public void run() {\n         }\n \n     }\n+    \n+    \n+    \n+    \n+    /**\n+     * This tests that the delayed queue will run jobs in the future, efficiently\n+     * \n+     * @throws Exception\n+     */\n+    \n+    @Test\n+    public void test_delayed_queue() throws Exception{\n+        \n+        // will kill it from the cache in some time.\n+        final DotSubmitter submitter = DotConcurrentFactory.getInstance().getSubmitter();\n+        final AtomicInteger aInt=new AtomicInteger(0);\n+        \n+        // add 50 to the atomicInteger, 3 seconds in the future\n+        int runs = 50;\n+        for(int i=0;i<runs;i++) {\n+            submitter.delay(()-> aInt.addAndGet(1), 3, TimeUnit.SECONDS);\n+        }\n+        \n+        // None of the jobs have been run\n+        assert(aInt.get()==0);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7b754ab23aeae22f23566c0bd9da3d79e40c3aee"}, "originalPosition": 37}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyNDM4NTM2", "url": "https://github.com/dotCMS/core/pull/18683#pullrequestreview-432438536", "createdAt": "2020-06-17T14:06:42Z", "commit": {"oid": "7b754ab23aeae22f23566c0bd9da3d79e40c3aee"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxNDowNjo0MlrOGlHdfA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxNDowNjo0MlrOGlHdfA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTU3MjczMg==", "bodyText": "Issue found: JUnit tests should include assert() or fail()", "url": "https://github.com/dotCMS/core/pull/18683#discussion_r441572732", "createdAt": "2020-06-17T14:06:42Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/concurrent/DotConcurrentFactoryTest.java", "diffHunk": "@@ -101,4 +103,44 @@ public void run() {\n         }\n \n     }\n+    \n+    \n+    \n+    \n+    /**\n+     * This tests that the delayed queue will run jobs in the future, efficiently\n+     * \n+     * @throws Exception\n+     */\n+    \n+    @Test\n+    public void test_delayed_queue() throws Exception{", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7b754ab23aeae22f23566c0bd9da3d79e40c3aee"}, "originalPosition": 24}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyNDM4NTUz", "url": "https://github.com/dotCMS/core/pull/18683#pullrequestreview-432438553", "createdAt": "2020-06-17T14:06:43Z", "commit": {"oid": "7b754ab23aeae22f23566c0bd9da3d79e40c3aee"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxNDowNjo0M1rOGlHdiA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xN1QxNDowNjo0M1rOGlHdiA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTU3Mjc0NA==", "bodyText": "Issue found: Useless parentheses.", "url": "https://github.com/dotCMS/core/pull/18683#discussion_r441572744", "createdAt": "2020-06-17T14:06:43Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/concurrent/DotConcurrentFactoryTest.java", "diffHunk": "@@ -101,4 +103,44 @@ public void run() {\n         }\n \n     }\n+    \n+    \n+    \n+    \n+    /**\n+     * This tests that the delayed queue will run jobs in the future, efficiently\n+     * \n+     * @throws Exception\n+     */\n+    \n+    @Test\n+    public void test_delayed_queue() throws Exception{\n+        \n+        // will kill it from the cache in some time.\n+        final DotSubmitter submitter = DotConcurrentFactory.getInstance().getSubmitter();\n+        final AtomicInteger aInt=new AtomicInteger(0);\n+        \n+        // add 50 to the atomicInteger, 3 seconds in the future\n+        int runs = 50;\n+        for(int i=0;i<runs;i++) {\n+            submitter.delay(()-> aInt.addAndGet(1), 3, TimeUnit.SECONDS);\n+        }\n+        \n+        // None of the jobs have been run\n+        assert(aInt.get()==0);\n+        \n+        // rest.  I must rest\n+        Thread.sleep(6000);\n+        \n+        // all of the jobs have been run\n+        assert(aInt.get()==50);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7b754ab23aeae22f23566c0bd9da3d79e40c3aee"}, "originalPosition": 43}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMyNDk1ODM1", "url": "https://github.com/dotCMS/core/pull/18683#pullrequestreview-432495835", "createdAt": "2020-06-17T15:03:02Z", "commit": {"oid": "7b754ab23aeae22f23566c0bd9da3d79e40c3aee"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0MTEzMzcw", "url": "https://github.com/dotCMS/core/pull/18683#pullrequestreview-434113370", "createdAt": "2020-06-19T14:18:00Z", "commit": {"oid": "7b754ab23aeae22f23566c0bd9da3d79e40c3aee"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0MTEzNTEy", "url": "https://github.com/dotCMS/core/pull/18683#pullrequestreview-434113512", "createdAt": "2020-06-19T14:18:10Z", "commit": {"oid": "7b754ab23aeae22f23566c0bd9da3d79e40c3aee"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM1MTQ0NzQ0", "url": "https://github.com/dotCMS/core/pull/18683#pullrequestreview-435144744", "createdAt": "2020-06-22T17:45:23Z", "commit": {"oid": "7b754ab23aeae22f23566c0bd9da3d79e40c3aee"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 952, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}