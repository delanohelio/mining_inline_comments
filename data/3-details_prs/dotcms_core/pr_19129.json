{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcwMzA5ODM5", "number": 19129, "title": "#18968 test wasn't registered also fix use setProp instead of addProp\u2026", "bodyText": "internal method addProperty generates an array list\nThere's a huge difference between internal methods addProperty and setProperty we should use setProperty when loading env variables", "createdAt": "2020-08-19T17:25:05Z", "url": "https://github.com/dotCMS/core/pull/19129", "merged": true, "mergeCommit": {"oid": "a2458fc5da7e3777b90a997eabdbf376534bbd27"}, "closed": true, "closedAt": "2020-08-24T22:17:27Z", "author": {"login": "fabrizzio-dotCMS"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdAe-BgAH2gAyNDcwMzA5ODM5OjFiNGJiYzhmMDhjM2YwOTg2ZTZiNTZmYjJhZGViZGU2N2ExZjUwMDc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdCJR8rAFqTQ3Mzg2MTE1OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1b4bbc8f08c3f0986e6b56fb2adebde67a1f5007", "author": {"user": {"login": "fabrizzio-dotCMS", "name": "Fabrizzio Araya"}}, "url": "https://github.com/dotCMS/core/commit/1b4bbc8f08c3f0986e6b56fb2adebde67a1f5007", "committedDate": "2020-08-19T17:22:08Z", "message": "#18968 test wasn't registered also fix use setProp instead of addPropto avoid env props stored as arrays"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcwNzA0NDgz", "url": "https://github.com/dotCMS/core/pull/19129#pullrequestreview-470704483", "createdAt": "2020-08-19T17:50:02Z", "commit": {"oid": "1b4bbc8f08c3f0986e6b56fb2adebde67a1f5007"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxNzo1MDowMlrOHDS0VA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxNzo1MDowMlrOHDS0VA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzIxNjA4NA==", "bodyText": "why the synchronized ?", "url": "https://github.com/dotCMS/core/pull/19129#discussion_r473216084", "createdAt": "2020-08-19T17:50:02Z", "author": {"login": "nollymar"}, "path": "dotCMS/src/main/java/com/dotmarketing/util/Config.java", "diffHunk": "@@ -300,17 +300,13 @@ private static void _refreshProperties () {\n \n \n \tprivate final static String ENV_PREFIX=\"DOT_\";\n-\t\n-    private static void readEnvironmentVariables() {\n-        \n-        \n-        System.getenv().entrySet().stream().filter(e->e.getKey().startsWith(ENV_PREFIX)).forEach(e->\n-            props.addProperty(e.getKey(), e.getValue())\n-        );\n-        \n \n-\n-    }\n+\tprivate static void readEnvironmentVariables() {\n+\t\tsynchronized (Config.class) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b4bbc8f08c3f0986e6b56fb2adebde67a1f5007"}, "originalPosition": 16}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcxNjQ1NzQz", "url": "https://github.com/dotCMS/core/pull/19129#pullrequestreview-471645743", "createdAt": "2020-08-20T14:02:04Z", "commit": {"oid": "1b4bbc8f08c3f0986e6b56fb2adebde67a1f5007"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcyNTUwMDk0", "url": "https://github.com/dotCMS/core/pull/19129#pullrequestreview-472550094", "createdAt": "2020-08-21T14:43:31Z", "commit": {"oid": "1b4bbc8f08c3f0986e6b56fb2adebde67a1f5007"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQxNDo0MzozMVrOHEwBog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQxNDo0MzozOFrOHEwB3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDc0MzIwMg==", "bodyText": "Doc Test. E.g:\n    /**\n     * Method to rest: {@link GraphqlAPI#getSchema()}\n     * Given scenario: A bad relationship field which returns null when trying to get the\n     * {@link com.dotmarketing.portlets.structure.model.Relationship} out of it.\n     * Expected result: The schema should be able to generate but without that field present\n     */", "url": "https://github.com/dotCMS/core/pull/19129#discussion_r474743202", "createdAt": "2020-08-21T14:43:31Z", "author": {"login": "erickgonzalez"}, "path": "dotCMS/src/integration-test/java/com/dotmarketing/util/ConfigTest.java", "diffHunk": "@@ -48,54 +54,92 @@ private static void setTestEnvVariables() {\n         System.getenv().put(DOT_TESTING_STRING_WITH_SPACES, \"VALUE1 VALUE2\");\n         System.getenv().put(DOT_TESTING_STRING, \"VALUE_ABC\");\n         System.getenv().put(UNABLE_TO_READ_VAR, \"NOPE\");\n+        //This forces a re-load.\n+        Config.props = null;\n+        Config.initializeConfig();\n     }\n-    \n-    \n-    \n+\n+\n+\n     @Test\n     public void testing_string_with_comma() {\n \n         String value = Config.getStringProperty(\"TESTING_STRING_WITH_COMMA\");\n         assert(value.equals(Config.getStringProperty(\"testing.String.with_comma\")));\n \n-        \n+\n     }\n-    \n-    \n-    \n+\n+    /**\n+     * Small test to demo that the internal method addProperty generates an array list\n+     * There's a huge difference between addProperty and setProperty\n+     */\n+    @Test\n+    public void Test_Multiple_Calls_To_AddProperty_On_The_Same_Key() {\n+\n+        Config.props.addProperty(\"anyKey\",\"anyValue\");\n+        assertEquals (\"anyValue\",Config.props.getProperty(\"anyKey\"));\n+\n+        Config.props.addProperty(\"anyKey\",\"anyValue\");\n+        final List<String> values1 = Arrays.asList(\"anyValue\", \"anyValue\");\n+\n+        final Object property1 = Config.props.getProperty(\"anyKey\");\n+        final boolean equals1 = values1.equals(property1);\n+        assertTrue(equals1);\n+\n+        Config.props.addProperty(\"anyKey\",\"anyValue\");\n+        final List<String> values2 = Arrays.asList(\"anyValue\", \"anyValue\", \"anyValue\");\n+        final Object property2 = Config.props.getProperty(\"anyKey\");\n+        final boolean equals2 = values2.equals(property2);\n+        assertTrue(equals2);\n+    }\n+\n+    @Test", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b4bbc8f08c3f0986e6b56fb2adebde67a1f5007"}, "originalPosition": 107}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDc0MzI2MA==", "bodyText": "Doc Test. E.g:\n    /**\n     * Method to rest: {@link GraphqlAPI#getSchema()}\n     * Given scenario: A bad relationship field which returns null when trying to get the\n     * {@link com.dotmarketing.portlets.structure.model.Relationship} out of it.\n     * Expected result: The schema should be able to generate but without that field present\n     */", "url": "https://github.com/dotCMS/core/pull/19129#discussion_r474743260", "createdAt": "2020-08-21T14:43:38Z", "author": {"login": "erickgonzalez"}, "path": "dotCMS/src/integration-test/java/com/dotmarketing/util/ConfigTest.java", "diffHunk": "@@ -48,54 +54,92 @@ private static void setTestEnvVariables() {\n         System.getenv().put(DOT_TESTING_STRING_WITH_SPACES, \"VALUE1 VALUE2\");\n         System.getenv().put(DOT_TESTING_STRING, \"VALUE_ABC\");\n         System.getenv().put(UNABLE_TO_READ_VAR, \"NOPE\");\n+        //This forces a re-load.\n+        Config.props = null;\n+        Config.initializeConfig();\n     }\n-    \n-    \n-    \n+\n+\n+\n     @Test\n     public void testing_string_with_comma() {\n \n         String value = Config.getStringProperty(\"TESTING_STRING_WITH_COMMA\");\n         assert(value.equals(Config.getStringProperty(\"testing.String.with_comma\")));\n \n-        \n+\n     }\n-    \n-    \n-    \n+\n+    /**\n+     * Small test to demo that the internal method addProperty generates an array list\n+     * There's a huge difference between addProperty and setProperty\n+     */\n+    @Test", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b4bbc8f08c3f0986e6b56fb2adebde67a1f5007"}, "originalPosition": 87}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcyODA1OTg5", "url": "https://github.com/dotCMS/core/pull/19129#pullrequestreview-472805989", "createdAt": "2020-08-21T20:39:06Z", "commit": {"oid": "1b4bbc8f08c3f0986e6b56fb2adebde67a1f5007"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "42ee3a867182671e62437de05b95cc26972d9276", "author": {"user": {"login": "fabrizzio-dotCMS", "name": "Fabrizzio Araya"}}, "url": "https://github.com/dotCMS/core/commit/42ee3a867182671e62437de05b95cc26972d9276", "committedDate": "2020-08-24T20:07:11Z", "message": "#18968 docing up tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDczODYxMTU5", "url": "https://github.com/dotCMS/core/pull/19129#pullrequestreview-473861159", "createdAt": "2020-08-24T21:13:50Z", "commit": {"oid": "42ee3a867182671e62437de05b95cc26972d9276"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 756, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}