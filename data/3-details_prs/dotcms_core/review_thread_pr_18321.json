{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA1MjU0ODk3", "number": 18321, "reviewThreads": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzowNTo0OVrOD0Vl4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzowNjowMlrOD0VmXw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU2MjA2MzA2OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/VelocityUtilTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzowNTo0OVrOGJO4Ng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzowNTo0OVrOGJO4Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjMzNDEzNA==", "bodyText": "Issue found: Local variable 'context' could be declared final", "url": "https://github.com/dotCMS/core/pull/18321#discussion_r412334134", "createdAt": "2020-04-21T17:05:49Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/VelocityUtilTest.java", "diffHunk": "@@ -157,5 +158,36 @@ public void test_unable_to_modify_userid_in_velocity_session() throws Exception{\n         assertTrue(request.getSession().getAttribute(WebKeys.USER_ID) ==null);\n     }\n     \n+    \n+    /**\n+     * https://github.com/dotCMS/core/issues/18318\n+     * \n+     * The servlet context is too dangerous to expose to velocity and allows for arbitrary \n+     * code execution\n+     * \n+     * @throws Exception\n+     */\n+    \n+    @Test\n+    public void test_servlet_context_is_not_available_in_velocity() throws Exception {\n+\n+        final HttpServletRequest request = new MockSessionRequest(\n+                        new MockAttributeRequest(new MockHttpRequest(\"localhost\", \"/\").request()).request()).request();\n+\n+        final HttpServletResponse response = new MockHttpResponse().response();\n+\n+\n+        ChainedContext context = (ChainedContext) VelocityUtil.getWebContext(request, response);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "45f07f016dac37a72392abf8f58ba251a2e969f2"}, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU2MjA2MzE3OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/VelocityUtilTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzowNTo1MFrOGJO4SA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzowNTo1MFrOGJO4SA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjMzNDE1Mg==", "bodyText": "Issue found: Useless parentheses.", "url": "https://github.com/dotCMS/core/pull/18321#discussion_r412334152", "createdAt": "2020-04-21T17:05:50Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/VelocityUtilTest.java", "diffHunk": "@@ -157,5 +158,36 @@ public void test_unable_to_modify_userid_in_velocity_session() throws Exception{\n         assertTrue(request.getSession().getAttribute(WebKeys.USER_ID) ==null);\n     }\n     \n+    \n+    /**\n+     * https://github.com/dotCMS/core/issues/18318\n+     * \n+     * The servlet context is too dangerous to expose to velocity and allows for arbitrary \n+     * code execution\n+     * \n+     * @throws Exception\n+     */\n+    \n+    @Test\n+    public void test_servlet_context_is_not_available_in_velocity() throws Exception {\n+\n+        final HttpServletRequest request = new MockSessionRequest(\n+                        new MockAttributeRequest(new MockHttpRequest(\"localhost\", \"/\").request()).request()).request();\n+\n+        final HttpServletResponse response = new MockHttpResponse().response();\n+\n+\n+        ChainedContext context = (ChainedContext) VelocityUtil.getWebContext(request, response);\n+\n+        assert (context.getServletContext() == null);\n+        assert (context.get(\"application\") == null);\n+        assert (context.getRequest().getServletContext() == null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "45f07f016dac37a72392abf8f58ba251a2e969f2"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU2MjA2MzI0OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/main/java/org/apache/velocity/tools/view/context/ChainedContext.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzowNTo1MVrOGJO4UQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzowNTo1MVrOGJO4UQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjMzNDE2MQ==", "bodyText": "Issue found: Useless parentheses.", "url": "https://github.com/dotCMS/core/pull/18321#discussion_r412334161", "createdAt": "2020-04-21T17:05:51Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/main/java/org/apache/velocity/tools/view/context/ChainedContext.java", "diffHunk": "@@ -87,31 +86,34 @@ public ChainedContext(Context ctx,\n                           HttpServletResponse response,\r\n                           ServletContext application)\r\n     {\r\n-        this(ctx, null, request, response, application);\r\n+        this(ctx, null, request, response);\r\n     }\r\n \r\n \r\n     public ChainedContext(VelocityEngine velocity,\r\n                           HttpServletRequest request,\r\n-                          HttpServletResponse response,\r\n-                          ServletContext application)\r\n+                          HttpServletResponse response)\r\n     {\r\n-        this(null, velocity, request, response, application);\r\n+        this(null, velocity, request, response );\r\n+    }\r\n+    public ChainedContext(VelocityEngine velocity,\r\n+                    HttpServletRequest request,\r\n+                    HttpServletResponse response,ServletContext application)\r\n+    {\r\n+        this(null, velocity, request, response );\r\n     }\r\n-    \r\n     public ChainedContext(Context ctx,\r\n                           VelocityEngine velocity,\r\n                           HttpServletRequest request,\r\n-                          HttpServletResponse response,\r\n-                          ServletContext application)\r\n+                          HttpServletResponse response)\r\n     {\r\n         super(null, ctx);\r\n \r\n         this.velocity = velocity;\r\n-        this.request = request;\r\n+        this.request = (request instanceof VelocityRequestWrapper) ? request : new VelocityRequestWrapper(request);\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "45f07f016dac37a72392abf8f58ba251a2e969f2"}, "originalPosition": 53}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU2MjA2MzMxOnYy", "diffSide": "RIGHT", "path": "dotCMS/src/main/java/org/apache/velocity/tools/view/context/ChainedContext.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzowNTo1MlrOGJO4Xg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzowNTo1MlrOGJO4Xg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjMzNDE3NA==", "bodyText": "Issue found: Parameter 'response' is not assigned and could be declared final", "url": "https://github.com/dotCMS/core/pull/18321#discussion_r412334174", "createdAt": "2020-04-21T17:05:52Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/main/java/org/apache/velocity/tools/view/context/ChainedContext.java", "diffHunk": "@@ -87,31 +86,34 @@ public ChainedContext(Context ctx,\n                           HttpServletResponse response,\r\n                           ServletContext application)\r\n     {\r\n-        this(ctx, null, request, response, application);\r\n+        this(ctx, null, request, response);\r\n     }\r\n \r\n \r\n     public ChainedContext(VelocityEngine velocity,\r\n                           HttpServletRequest request,\r\n-                          HttpServletResponse response,\r\n-                          ServletContext application)\r\n+                          HttpServletResponse response)\r\n     {\r\n-        this(null, velocity, request, response, application);\r\n+        this(null, velocity, request, response );\r\n+    }\r\n+    public ChainedContext(VelocityEngine velocity,\r\n+                    HttpServletRequest request,\r\n+                    HttpServletResponse response,ServletContext application)\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "45f07f016dac37a72392abf8f58ba251a2e969f2"}, "originalPosition": 37}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU2MjA2MzM2OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/VelocityUtilTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzowNTo1M1rOGJO4ZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzowNTo1M1rOGJO4ZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjMzNDE4MQ==", "bodyText": "Issue found: Useless parentheses.", "url": "https://github.com/dotCMS/core/pull/18321#discussion_r412334181", "createdAt": "2020-04-21T17:05:53Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/VelocityUtilTest.java", "diffHunk": "@@ -157,5 +158,36 @@ public void test_unable_to_modify_userid_in_velocity_session() throws Exception{\n         assertTrue(request.getSession().getAttribute(WebKeys.USER_ID) ==null);\n     }\n     \n+    \n+    /**\n+     * https://github.com/dotCMS/core/issues/18318\n+     * \n+     * The servlet context is too dangerous to expose to velocity and allows for arbitrary \n+     * code execution\n+     * \n+     * @throws Exception\n+     */\n+    \n+    @Test\n+    public void test_servlet_context_is_not_available_in_velocity() throws Exception {\n+\n+        final HttpServletRequest request = new MockSessionRequest(\n+                        new MockAttributeRequest(new MockHttpRequest(\"localhost\", \"/\").request()).request()).request();\n+\n+        final HttpServletResponse response = new MockHttpResponse().response();\n+\n+\n+        ChainedContext context = (ChainedContext) VelocityUtil.getWebContext(request, response);\n+\n+        assert (context.getServletContext() == null);\n+        assert (context.get(\"application\") == null);\n+        assert (context.getRequest().getServletContext() == null);\n+        assert (context.getAttribute(\"application\") == null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "45f07f016dac37a72392abf8f58ba251a2e969f2"}, "originalPosition": 36}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU2MjA2MzM5OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/main/java/com/dotcms/rendering/velocity/viewtools/VelocitySessionWrapper.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzowNTo1NFrOGJO4bw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzowNTo1NFrOGJO4bw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjMzNDE5MQ==", "bodyText": "Issue found: Parameter 'obj' is not assigned and could be declared final", "url": "https://github.com/dotCMS/core/pull/18321#discussion_r412334191", "createdAt": "2020-04-21T17:05:54Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/main/java/com/dotcms/rendering/velocity/viewtools/VelocitySessionWrapper.java", "diffHunk": "@@ -112,5 +112,35 @@ public void setMaxInactiveInterval(int arg0) {\n \n     }\n \n+    @Override\n+    public int hashCode() {\n+        final int prime = 31;\n+        int result = 1;\n+        result = prime * result + ((session == null) ? 0 : session.hashCode());\n+        return result;\n+    }\n+\n+    @Override\n+    public boolean equals(Object obj) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "45f07f016dac37a72392abf8f58ba251a2e969f2"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU2MjA2MzQyOnYy", "diffSide": "RIGHT", "path": "dotCMS/src/main/java/com/dotcms/rendering/velocity/viewtools/VelocitySessionWrapper.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzowNTo1NVrOGJO4dQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzowNTo1NVrOGJO4dQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjMzNDE5Nw==", "bodyText": "Issue found: Local variable 'other' could be declared final", "url": "https://github.com/dotCMS/core/pull/18321#discussion_r412334197", "createdAt": "2020-04-21T17:05:55Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/main/java/com/dotcms/rendering/velocity/viewtools/VelocitySessionWrapper.java", "diffHunk": "@@ -112,5 +112,35 @@ public void setMaxInactiveInterval(int arg0) {\n \n     }\n \n+    @Override\n+    public int hashCode() {\n+        final int prime = 31;\n+        int result = 1;\n+        result = prime * result + ((session == null) ? 0 : session.hashCode());\n+        return result;\n+    }\n+\n+    @Override\n+    public boolean equals(Object obj) {\n+        if (this == obj)\n+            return true;\n+        if (obj == null)\n+            return false;\n+        if (getClass() != obj.getClass())\n+            return false;\n+        VelocitySessionWrapper other = (VelocitySessionWrapper) obj;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "45f07f016dac37a72392abf8f58ba251a2e969f2"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU2MjA2MzU4OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/VelocityUtilTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzowNTo1NlrOGJO4ig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzowNTo1NlrOGJO4ig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjMzNDIxOA==", "bodyText": "Issue found: Useless parentheses.", "url": "https://github.com/dotCMS/core/pull/18321#discussion_r412334218", "createdAt": "2020-04-21T17:05:56Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/VelocityUtilTest.java", "diffHunk": "@@ -157,5 +158,36 @@ public void test_unable_to_modify_userid_in_velocity_session() throws Exception{\n         assertTrue(request.getSession().getAttribute(WebKeys.USER_ID) ==null);\n     }\n     \n+    \n+    /**\n+     * https://github.com/dotCMS/core/issues/18318\n+     * \n+     * The servlet context is too dangerous to expose to velocity and allows for arbitrary \n+     * code execution\n+     * \n+     * @throws Exception\n+     */\n+    \n+    @Test\n+    public void test_servlet_context_is_not_available_in_velocity() throws Exception {\n+\n+        final HttpServletRequest request = new MockSessionRequest(\n+                        new MockAttributeRequest(new MockHttpRequest(\"localhost\", \"/\").request()).request()).request();\n+\n+        final HttpServletResponse response = new MockHttpResponse().response();\n+\n+\n+        ChainedContext context = (ChainedContext) VelocityUtil.getWebContext(request, response);\n+\n+        assert (context.getServletContext() == null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "45f07f016dac37a72392abf8f58ba251a2e969f2"}, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU2MjA2Mzc2OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/main/java/com/dotcms/rendering/velocity/viewtools/VelocitySessionWrapper.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzowNTo1N1rOGJO4og==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzowNTo1N1rOGJO4og==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjMzNDI0Mg==", "bodyText": "Issue found: This statement should have braces", "url": "https://github.com/dotCMS/core/pull/18321#discussion_r412334242", "createdAt": "2020-04-21T17:05:57Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/main/java/com/dotcms/rendering/velocity/viewtools/VelocitySessionWrapper.java", "diffHunk": "@@ -112,5 +112,35 @@ public void setMaxInactiveInterval(int arg0) {\n \n     }\n \n+    @Override\n+    public int hashCode() {\n+        final int prime = 31;\n+        int result = 1;\n+        result = prime * result + ((session == null) ? 0 : session.hashCode());\n+        return result;\n+    }\n+\n+    @Override\n+    public boolean equals(Object obj) {\n+        if (this == obj)\n+            return true;\n+        if (obj == null)\n+            return false;\n+        if (getClass() != obj.getClass())\n+            return false;\n+        VelocitySessionWrapper other = (VelocitySessionWrapper) obj;\n+        if (session == null) {\n+            if (other.session != null)\n+                return false;\n+        } else if (!session.equals(other.session))\n+            return false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "45f07f016dac37a72392abf8f58ba251a2e969f2"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU2MjA2MzgzOnYy", "diffSide": "RIGHT", "path": "dotCMS/src/main/java/org/apache/velocity/tools/view/context/ChainedContext.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzowNTo1OFrOGJO4qg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzowNTo1OFrOGJO4qg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjMzNDI1MA==", "bodyText": "Issue found: Parameter 'response' is not assigned and could be declared final", "url": "https://github.com/dotCMS/core/pull/18321#discussion_r412334250", "createdAt": "2020-04-21T17:05:58Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/main/java/org/apache/velocity/tools/view/context/ChainedContext.java", "diffHunk": "@@ -87,31 +86,34 @@ public ChainedContext(Context ctx,\n                           HttpServletResponse response,\r\n                           ServletContext application)\r\n     {\r\n-        this(ctx, null, request, response, application);\r\n+        this(ctx, null, request, response);\r\n     }\r\n \r\n \r\n     public ChainedContext(VelocityEngine velocity,\r\n                           HttpServletRequest request,\r\n-                          HttpServletResponse response,\r\n-                          ServletContext application)\r\n+                          HttpServletResponse response)\r\n     {\r\n-        this(null, velocity, request, response, application);\r\n+        this(null, velocity, request, response );\r\n+    }\r\n+    public ChainedContext(VelocityEngine velocity,\r\n+                    HttpServletRequest request,\r\n+                    HttpServletResponse response,ServletContext application)\r\n+    {\r\n+        this(null, velocity, request, response );\r\n     }\r\n-    \r\n     public ChainedContext(Context ctx,\r\n                           VelocityEngine velocity,\r\n                           HttpServletRequest request,\r\n-                          HttpServletResponse response,\r\n-                          ServletContext application)\r\n+                          HttpServletResponse response)\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "45f07f016dac37a72392abf8f58ba251a2e969f2"}, "originalPosition": 47}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU2MjA2Mzk1OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/main/java/com/dotcms/rendering/velocity/viewtools/VelocitySessionWrapper.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzowNTo1OVrOGJO4vA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzowNTo1OVrOGJO4vA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjMzNDI2OA==", "bodyText": "Issue found: This statement should have braces", "url": "https://github.com/dotCMS/core/pull/18321#discussion_r412334268", "createdAt": "2020-04-21T17:05:59Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/main/java/com/dotcms/rendering/velocity/viewtools/VelocitySessionWrapper.java", "diffHunk": "@@ -112,5 +112,35 @@ public void setMaxInactiveInterval(int arg0) {\n \n     }\n \n+    @Override\n+    public int hashCode() {\n+        final int prime = 31;\n+        int result = 1;\n+        result = prime * result + ((session == null) ? 0 : session.hashCode());\n+        return result;\n+    }\n+\n+    @Override\n+    public boolean equals(Object obj) {\n+        if (this == obj)\n+            return true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "45f07f016dac37a72392abf8f58ba251a2e969f2"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU2MjA2NDA4OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/VelocityUtilTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzowNjowMFrOGJO40A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzowNjowMFrOGJO40A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjMzNDI4OA==", "bodyText": "Issue found: Useless parentheses.", "url": "https://github.com/dotCMS/core/pull/18321#discussion_r412334288", "createdAt": "2020-04-21T17:06:00Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/VelocityUtilTest.java", "diffHunk": "@@ -157,5 +158,36 @@ public void test_unable_to_modify_userid_in_velocity_session() throws Exception{\n         assertTrue(request.getSession().getAttribute(WebKeys.USER_ID) ==null);\n     }\n     \n+    \n+    /**\n+     * https://github.com/dotCMS/core/issues/18318\n+     * \n+     * The servlet context is too dangerous to expose to velocity and allows for arbitrary \n+     * code execution\n+     * \n+     * @throws Exception\n+     */\n+    \n+    @Test\n+    public void test_servlet_context_is_not_available_in_velocity() throws Exception {\n+\n+        final HttpServletRequest request = new MockSessionRequest(\n+                        new MockAttributeRequest(new MockHttpRequest(\"localhost\", \"/\").request()).request()).request();\n+\n+        final HttpServletResponse response = new MockHttpResponse().response();\n+\n+\n+        ChainedContext context = (ChainedContext) VelocityUtil.getWebContext(request, response);\n+\n+        assert (context.getServletContext() == null);\n+        assert (context.get(\"application\") == null);\n+        assert (context.getRequest().getServletContext() == null);\n+        assert (context.getAttribute(\"application\") == null);\n+        assert (context.getVelocityContext().get(\"application\") == null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "45f07f016dac37a72392abf8f58ba251a2e969f2"}, "originalPosition": 37}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU2MjA2NDEzOnYy", "diffSide": "RIGHT", "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/VelocityUtilTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzowNjowMVrOGJO43A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzowNjowMVrOGJO43A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjMzNDMwMA==", "bodyText": "Issue found: JUnit tests should include assert() or fail()", "url": "https://github.com/dotCMS/core/pull/18321#discussion_r412334300", "createdAt": "2020-04-21T17:06:01Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/VelocityUtilTest.java", "diffHunk": "@@ -157,5 +158,36 @@ public void test_unable_to_modify_userid_in_velocity_session() throws Exception{\n         assertTrue(request.getSession().getAttribute(WebKeys.USER_ID) ==null);\n     }\n     \n+    \n+    /**\n+     * https://github.com/dotCMS/core/issues/18318\n+     * \n+     * The servlet context is too dangerous to expose to velocity and allows for arbitrary \n+     * code execution\n+     * \n+     * @throws Exception\n+     */\n+    \n+    @Test\n+    public void test_servlet_context_is_not_available_in_velocity() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "45f07f016dac37a72392abf8f58ba251a2e969f2"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU2MjA2NDIwOnYy", "diffSide": "RIGHT", "path": "dotCMS/src/main/java/org/apache/velocity/tools/view/context/ChainedContext.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzowNjowMlrOGJO46A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzowNjowMlrOGJO46A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjMzNDMxMg==", "bodyText": "Issue found: Avoid unused constructor parameters such as 'application'.", "url": "https://github.com/dotCMS/core/pull/18321#discussion_r412334312", "createdAt": "2020-04-21T17:06:02Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/main/java/org/apache/velocity/tools/view/context/ChainedContext.java", "diffHunk": "@@ -87,31 +86,34 @@ public ChainedContext(Context ctx,\n                           HttpServletResponse response,\r\n                           ServletContext application)\r\n     {\r\n-        this(ctx, null, request, response, application);\r\n+        this(ctx, null, request, response);\r\n     }\r\n \r\n \r\n     public ChainedContext(VelocityEngine velocity,\r\n                           HttpServletRequest request,\r\n-                          HttpServletResponse response,\r\n-                          ServletContext application)\r\n+                          HttpServletResponse response)\r\n     {\r\n-        this(null, velocity, request, response, application);\r\n+        this(null, velocity, request, response );\r\n+    }\r\n+    public ChainedContext(VelocityEngine velocity,\r\n+                    HttpServletRequest request,\r\n+                    HttpServletResponse response,ServletContext application)\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "45f07f016dac37a72392abf8f58ba251a2e969f2"}, "originalPosition": 37}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU2MjA2NDMxOnYy", "diffSide": "RIGHT", "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/VelocityUtilTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzowNjowMlrOGJO4-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzowNjowMlrOGJO4-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjMzNDMyOQ==", "bodyText": "Issue found: Useless parentheses.", "url": "https://github.com/dotCMS/core/pull/18321#discussion_r412334329", "createdAt": "2020-04-21T17:06:02Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/VelocityUtilTest.java", "diffHunk": "@@ -157,5 +158,36 @@ public void test_unable_to_modify_userid_in_velocity_session() throws Exception{\n         assertTrue(request.getSession().getAttribute(WebKeys.USER_ID) ==null);\n     }\n     \n+    \n+    /**\n+     * https://github.com/dotCMS/core/issues/18318\n+     * \n+     * The servlet context is too dangerous to expose to velocity and allows for arbitrary \n+     * code execution\n+     * \n+     * @throws Exception\n+     */\n+    \n+    @Test\n+    public void test_servlet_context_is_not_available_in_velocity() throws Exception {\n+\n+        final HttpServletRequest request = new MockSessionRequest(\n+                        new MockAttributeRequest(new MockHttpRequest(\"localhost\", \"/\").request()).request()).request();\n+\n+        final HttpServletResponse response = new MockHttpResponse().response();\n+\n+\n+        ChainedContext context = (ChainedContext) VelocityUtil.getWebContext(request, response);\n+\n+        assert (context.getServletContext() == null);\n+        assert (context.get(\"application\") == null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "45f07f016dac37a72392abf8f58ba251a2e969f2"}, "originalPosition": 34}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2219, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}