{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM1MzcwNzM1", "number": 18674, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNzo1MToyMVrOEGC74g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQxODoxMjowNFrOEMmgNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc0Nzc1MDEwOnYy", "diffSide": "RIGHT", "path": "dotCMS/src/main/java/com/dotcms/content/elasticsearch/business/ESMappingAPIImpl.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNzo1MToyMVrOGkmoUw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxNzo1MToyMVrOGkmoUw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTAzNDgzNQ==", "bodyText": "DotDataException", "url": "https://github.com/dotCMS/core/pull/18674#discussion_r441034835", "createdAt": "2020-06-16T17:51:21Z", "author": {"login": "dsilvam"}, "path": "dotCMS/src/main/java/com/dotcms/content/elasticsearch/business/ESMappingAPIImpl.java", "diffHunk": "@@ -189,10 +189,36 @@ public String toJson(final Contentlet contentlet) throws DotMappingException {\n             loadRelationshipFields(contentlet, contentletMap, sw);\n \n \t\t\tfinal Identifier contentIdentifier = APILocator.getIdentifierAPI().find(contentlet);\n+            if (null == contentIdentifier || !UtilMethods.isSet(contentIdentifier.getId())) {\n+                final String errorMsg = String.format(\"Identifier '%s' was not found via API.\", contentlet\n+                        .getIdentifier());\n+                throw new Exception(errorMsg);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d09516d072ee251ce53836eb28388470bd0b46b1"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxNjQ5MTk2OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/integration-test/java/com/dotcms/content/elasticsearch/business/ESMappingAPITest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQxODoxMjowMlrOGuzwaQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQxODoxMjowMlrOGuzwaQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTczNTY1Nw==", "bodyText": "Codacy found an issue: Avoid unused local variables such as 'versionInfo'.", "url": "https://github.com/dotCMS/core/pull/18674#discussion_r451735657", "createdAt": "2020-07-08T18:12:02Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/content/elasticsearch/business/ESMappingAPITest.java", "diffHunk": "@@ -143,6 +145,106 @@ public void test_toMap_fileasset_txt_shouldSuccess() throws Exception {\n \n     }\n \n+    /**\n+     * Method to Test: {@link ESMappingAPIImpl#toMap(Contentlet)}\n+     * When: The contentlet has a invalid host\n+     * Should: Throw a {@link DotDataException}\n+     *\n+     * @throws DotSecurityException\n+     * @throws DotDataException\n+     */\n+    @Test(expected = DotMappingException.class)\n+    public void whenContentletHasInvalidHostId(){\n+        final ESMappingAPIImpl esMappingAPI    = new ESMappingAPIImpl();\n+\n+        final ContentType contentType = new ContentTypeDataGen().nextPersisted();\n+        final Contentlet contentlet = new ContentletDataGen(contentType.id()).next();\n+\n+        contentlet.setHost(\"not_exist_host\");\n+\n+        esMappingAPI.toMap(contentlet);\n+    }\n+\n+    /**\n+     * Method to Test: {@link ESMappingAPIImpl#toMap(Contentlet)}\n+     * When: The contentlet has a invalid folder\n+     * Should: Throw a {@link DotDataException}\n+     *\n+     * @throws DotSecurityException\n+     * @throws DotDataException\n+     */\n+    @Test(expected = DotMappingException.class)\n+    public void whenContentletHasInvalidFolderId(){\n+        final ESMappingAPIImpl esMappingAPI    = new ESMappingAPIImpl();\n+\n+        final ContentType contentType = new ContentTypeDataGen().nextPersisted();\n+        final Contentlet contentlet = new ContentletDataGen(contentType.id()).next();\n+\n+        contentlet.setFolder(\"not_exist_folder\");\n+\n+        esMappingAPI.toMap(contentlet);\n+    }\n+\n+    /**\n+     * Method to Test: {@link ESMappingAPIImpl#toMap(Contentlet)}\n+     * When: The contentlet has a invalid content type\n+     * Should: Throw a {@link DotDataException}\n+     *\n+     * @throws DotSecurityException\n+     * @throws DotDataException\n+     */\n+    @Test(expected = DotMappingException.class)\n+    public void whenContentletHasInvalidContentTypeId(){\n+        final ESMappingAPIImpl esMappingAPI    = new ESMappingAPIImpl();\n+\n+        final ContentType contentType = new ContentTypeDataGen().nextPersisted();\n+        final Contentlet contentlet = new ContentletDataGen(contentType.id()).next();\n+\n+        contentlet.setContentTypeId(\"not_exist_content_type\");\n+\n+        esMappingAPI.toMap(contentlet);\n+    }\n+\n+    /**\n+     * Method to Test: {@link ESMappingAPIImpl#toMap(Contentlet)}\n+     * When: The contentlet has not {@link com.dotmarketing.beans.Identifier}\n+     * Should: Throw a {@link DotDataException}\n+     *\n+     * @throws DotSecurityException\n+     * @throws DotDataException\n+     */\n+    @Test(expected = DotMappingException.class)\n+    public void whenContentletHasNotIdentifier() {\n+        final ESMappingAPIImpl esMappingAPI    = new ESMappingAPIImpl();\n+\n+        final ContentType contentType = new ContentTypeDataGen().nextPersisted();\n+        final Contentlet contentlet = new ContentletDataGen(contentType.id()).next();\n+\n+        esMappingAPI.toMap(contentlet);\n+    }\n+\n+    /**\n+     * Method to Test: {@link ESMappingAPIImpl#toMap(Contentlet)}\n+     * When: The contentlet has not {@link ContentletVersionInfo}\n+     * Should: Throw a {@link DotDataException}\n+     *\n+     * @throws DotSecurityException\n+     * @throws DotDataException\n+     */\n+    @Test(expected = DotMappingException.class)\n+    public void whenContentletHasNotContentletVersionInfo() throws DotDataException {\n+        final ESMappingAPIImpl esMappingAPI    = new ESMappingAPIImpl();\n+\n+        final ContentType contentType = new ContentTypeDataGen().nextPersisted();\n+        final Contentlet contentlet = new ContentletDataGen(contentType.id()).nextPersisted();\n+\n+        final ContentletVersionInfo versionInfo = APILocator.getVersionableAPI()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9d2526a38591cb54642add73c8a84c65e659e82a"}, "originalPosition": 145}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgxNjQ5MjA2OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/integration-test/java/com/dotcms/content/elasticsearch/business/ESMappingAPITest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQxODoxMjowNFrOGuzweg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQxODoxMjowNFrOGuzweg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTczNTY3NA==", "bodyText": "Codacy found an issue: Avoid unused imports such as 'com.dotmarketing.business'", "url": "https://github.com/dotCMS/core/pull/18674#discussion_r451735674", "createdAt": "2020-07-08T18:12:04Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/content/elasticsearch/business/ESMappingAPITest.java", "diffHunk": "@@ -26,24 +27,24 @@\n import com.dotcms.contenttype.model.type.ContentTypeBuilder;\n import com.dotcms.contenttype.model.type.ImmutableFileAssetContentType;\n import com.dotcms.contenttype.model.type.SimpleContentType;\n-import com.dotcms.contenttype.util.KeyValueFieldUtil;\n+\n import com.dotcms.datagen.ContentTypeDataGen;\n import com.dotcms.datagen.ContentletDataGen;\n+import com.dotcms.contenttype.util.KeyValueFieldUtil;\n import com.dotcms.datagen.FieldDataGen;\n import com.dotcms.datagen.FileAssetDataGen;\n import com.dotcms.datagen.SiteDataGen;\n import com.dotcms.util.CollectionsUtils;\n import com.dotcms.util.IntegrationTestInitService;\n import com.dotmarketing.beans.Host;\n-import com.dotmarketing.business.APILocator;\n-import com.dotmarketing.business.RelationshipAPI;\n-import com.dotmarketing.business.UserAPI;\n+import com.dotmarketing.business.*;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9d2526a38591cb54642add73c8a84c65e659e82a"}, "originalPosition": 26}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2164, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}