{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc3MjAxNzM5", "number": 19205, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQxNTozODozNVrOEfg-WA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxNzozMzowOVrOEhWRNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAxNDgxNTYwOnYy", "diffSide": "RIGHT", "path": "dotCMS/src/main/java/com/dotcms/content/elasticsearch/business/ESMappingAPIImpl.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQxNTozODozNVrOHL1Uwg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQyMjozNToyMFrOHMMfZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjE3MDA1MA==", "bodyText": "this could be reduce to\ncontentletMap.put(ESMappingConstants.PUBLISH_DATE,\n                        elasticSearchDateTimeFormat.format(UtilMethods.isSet(contentIdentifier.getSysPublishDate())?contentIdentifier.getSysPublishDate():versionInfo.getVersionTs()));\n\nUp to you", "url": "https://github.com/dotCMS/core/pull/19205#discussion_r482170050", "createdAt": "2020-09-02T15:38:35Z", "author": {"login": "jdotcms"}, "path": "dotCMS/src/main/java/com/dotcms/content/elasticsearch/business/ESMappingAPIImpl.java", "diffHunk": "@@ -286,29 +278,26 @@ public String toJson(final Contentlet contentlet) throws DotMappingException {\n \t\t\t//add workflow to map\n \t\t\tcontentletMap.putAll(getWorkflowInfoForContentlet(contentlet));\n \n-\t\t\tif(UtilMethods.isSet(contentIdentifier.getSysPublishDate())) {\n-\t\t\t\tcontentletMap.put(ESMappingConstants.PUBLISH_DATE, elasticSearchDateTimeFormat.format(contentIdentifier.getSysPublishDate()));\n-\t\t\t\tcontentletMap.put(ESMappingConstants.PUBLISH_DATE + TEXT,\n-\t\t\t\t\t\tdatetimeFormat.format(contentIdentifier.getSysPublishDate()));\n-\t\t\t}else {\n-\t\t\t\tcontentletMap.put(ESMappingConstants.PUBLISH_DATE, elasticSearchDateTimeFormat.format(versionInfo.getVersionTs()));\n-\t\t\t\tcontentletMap.put(ESMappingConstants.PUBLISH_DATE + TEXT,\n-\t\t\t\t\t\tdatetimeFormat.format(versionInfo.getVersionTs()));\n-\t\t\t}\n+            if (UtilMethods.isSet(contentIdentifier.getSysPublishDate())) {\n+                contentletMap.put(ESMappingConstants.PUBLISH_DATE,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4196eecad05b0802d9ea58bbc7d9539ed54f40f1"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjU0OTYwNw==", "bodyText": "it could, but I think this way it's easier to read", "url": "https://github.com/dotCMS/core/pull/19205#discussion_r482549607", "createdAt": "2020-09-02T22:35:20Z", "author": {"login": "nollymar"}, "path": "dotCMS/src/main/java/com/dotcms/content/elasticsearch/business/ESMappingAPIImpl.java", "diffHunk": "@@ -286,29 +278,26 @@ public String toJson(final Contentlet contentlet) throws DotMappingException {\n \t\t\t//add workflow to map\n \t\t\tcontentletMap.putAll(getWorkflowInfoForContentlet(contentlet));\n \n-\t\t\tif(UtilMethods.isSet(contentIdentifier.getSysPublishDate())) {\n-\t\t\t\tcontentletMap.put(ESMappingConstants.PUBLISH_DATE, elasticSearchDateTimeFormat.format(contentIdentifier.getSysPublishDate()));\n-\t\t\t\tcontentletMap.put(ESMappingConstants.PUBLISH_DATE + TEXT,\n-\t\t\t\t\t\tdatetimeFormat.format(contentIdentifier.getSysPublishDate()));\n-\t\t\t}else {\n-\t\t\t\tcontentletMap.put(ESMappingConstants.PUBLISH_DATE, elasticSearchDateTimeFormat.format(versionInfo.getVersionTs()));\n-\t\t\t\tcontentletMap.put(ESMappingConstants.PUBLISH_DATE + TEXT,\n-\t\t\t\t\t\tdatetimeFormat.format(versionInfo.getVersionTs()));\n-\t\t\t}\n+            if (UtilMethods.isSet(contentIdentifier.getSysPublishDate())) {\n+                contentletMap.put(ESMappingConstants.PUBLISH_DATE,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjE3MDA1MA=="}, "originalCommit": {"oid": "4196eecad05b0802d9ea58bbc7d9539ed54f40f1"}, "originalPosition": 40}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAxNDgxOTU0OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/main/java/com/dotcms/content/elasticsearch/business/ESMappingAPIImpl.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQxNTozOToyNlrOHL1XMQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQxNTozOToyNlrOHL1XMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjE3MDY3Mw==", "bodyText": "same thing", "url": "https://github.com/dotCMS/core/pull/19205#discussion_r482170673", "createdAt": "2020-09-02T15:39:26Z", "author": {"login": "jdotcms"}, "path": "dotCMS/src/main/java/com/dotcms/content/elasticsearch/business/ESMappingAPIImpl.java", "diffHunk": "@@ -286,29 +278,26 @@ public String toJson(final Contentlet contentlet) throws DotMappingException {\n \t\t\t//add workflow to map\n \t\t\tcontentletMap.putAll(getWorkflowInfoForContentlet(contentlet));\n \n-\t\t\tif(UtilMethods.isSet(contentIdentifier.getSysPublishDate())) {\n-\t\t\t\tcontentletMap.put(ESMappingConstants.PUBLISH_DATE, elasticSearchDateTimeFormat.format(contentIdentifier.getSysPublishDate()));\n-\t\t\t\tcontentletMap.put(ESMappingConstants.PUBLISH_DATE + TEXT,\n-\t\t\t\t\t\tdatetimeFormat.format(contentIdentifier.getSysPublishDate()));\n-\t\t\t}else {\n-\t\t\t\tcontentletMap.put(ESMappingConstants.PUBLISH_DATE, elasticSearchDateTimeFormat.format(versionInfo.getVersionTs()));\n-\t\t\t\tcontentletMap.put(ESMappingConstants.PUBLISH_DATE + TEXT,\n-\t\t\t\t\t\tdatetimeFormat.format(versionInfo.getVersionTs()));\n-\t\t\t}\n+            if (UtilMethods.isSet(contentIdentifier.getSysPublishDate())) {\n+                contentletMap.put(ESMappingConstants.PUBLISH_DATE,\n+                        elasticSearchDateTimeFormat.format(contentIdentifier.getSysPublishDate()));\n+            } else {\n+                contentletMap.put(ESMappingConstants.PUBLISH_DATE,\n+                        elasticSearchDateTimeFormat.format(versionInfo.getVersionTs()));\n+            }\n \n-\t\t\tif(UtilMethods.isSet(contentIdentifier.getSysExpireDate())) {\n-\t\t\t\tcontentletMap.put(ESMappingConstants.EXPIRE_DATE, elasticSearchDateTimeFormat.format(contentIdentifier.getSysExpireDate()));\n-\t\t\t\tcontentletMap.put(ESMappingConstants.EXPIRE_DATE + TEXT,\n-\t\t\t\t\t\tdatetimeFormat.format(contentIdentifier.getSysExpireDate()));\n-\t\t\t}else {\n-\t\t\t\tcontentletMap.put(ESMappingConstants.EXPIRE_DATE, elasticSearchDateTimeFormat.format(29990101000000L));\n-\t\t\t\tcontentletMap.put(ESMappingConstants.EXPIRE_DATE + TEXT, \"29990101000000\");\n-\t\t\t}\n+            if (UtilMethods.isSet(contentIdentifier.getSysExpireDate())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4196eecad05b0802d9ea58bbc7d9539ed54f40f1"}, "originalPosition": 55}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAxNDgyNTAwOnYy", "diffSide": "RIGHT", "path": "dotCMS/src/main/java/com/dotcms/content/elasticsearch/business/ESMappingAPIImpl.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQxNTo0MDozNlrOHL1akw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQyMjozNTo1NVrOHMMiFg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjE3MTUzOQ==", "bodyText": "it is meaningless, rename it", "url": "https://github.com/dotCMS/core/pull/19205#discussion_r482171539", "createdAt": "2020-09-02T15:40:36Z", "author": {"login": "jdotcms"}, "path": "dotCMS/src/main/java/com/dotcms/content/elasticsearch/business/ESMappingAPIImpl.java", "diffHunk": "@@ -567,11 +612,14 @@ protected void loadPermissions(final Contentlet con, final Map<String,Object> m)\n \t\t}\n \t\tm.put(ESMappingConstants.PERMISSIONS, permissionsSt.toString());\n \t\tm.put(ESMappingConstants.OWNER_CAN_READ, ownerCanRead);\n-\t\tm.put(ESMappingConstants.OWNER_CAN_READ + TEXT, Boolean.toString(ownerCanRead));\n \t\tm.put(ESMappingConstants.OWNER_CAN_WRITE, ownerCanWrite);\n-\t\tm.put(ESMappingConstants.OWNER_CAN_WRITE + TEXT, Boolean.toString(ownerCanWrite));\n \t\tm.put(ESMappingConstants.OWNER_CAN_PUBLISH, ownerCanPub);\n-\t\tm.put(ESMappingConstants.OWNER_CAN_PUBLISH + TEXT, Boolean.toString(ownerCanPub));\n+\n+        if (Config.getBooleanProperty(\"CREATE_TEXT_INDEX_FIELD_FOR_NON_TEXT_FIELDS\", false)) {\n+            m.put(ESMappingConstants.OWNER_CAN_READ + TEXT, Boolean.toString(ownerCanRead));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4196eecad05b0802d9ea58bbc7d9539ed54f40f1"}, "originalPosition": 155}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjU0MDg5MA==", "bodyText": "@jdotcms what do you mean with \"m is missingless\"?", "url": "https://github.com/dotCMS/core/pull/19205#discussion_r482540890", "createdAt": "2020-09-02T22:28:09Z", "author": {"login": "nollymar"}, "path": "dotCMS/src/main/java/com/dotcms/content/elasticsearch/business/ESMappingAPIImpl.java", "diffHunk": "@@ -567,11 +612,14 @@ protected void loadPermissions(final Contentlet con, final Map<String,Object> m)\n \t\t}\n \t\tm.put(ESMappingConstants.PERMISSIONS, permissionsSt.toString());\n \t\tm.put(ESMappingConstants.OWNER_CAN_READ, ownerCanRead);\n-\t\tm.put(ESMappingConstants.OWNER_CAN_READ + TEXT, Boolean.toString(ownerCanRead));\n \t\tm.put(ESMappingConstants.OWNER_CAN_WRITE, ownerCanWrite);\n-\t\tm.put(ESMappingConstants.OWNER_CAN_WRITE + TEXT, Boolean.toString(ownerCanWrite));\n \t\tm.put(ESMappingConstants.OWNER_CAN_PUBLISH, ownerCanPub);\n-\t\tm.put(ESMappingConstants.OWNER_CAN_PUBLISH + TEXT, Boolean.toString(ownerCanPub));\n+\n+        if (Config.getBooleanProperty(\"CREATE_TEXT_INDEX_FIELD_FOR_NON_TEXT_FIELDS\", false)) {\n+            m.put(ESMappingConstants.OWNER_CAN_READ + TEXT, Boolean.toString(ownerCanRead));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjE3MTUzOQ=="}, "originalCommit": {"oid": "4196eecad05b0802d9ea58bbc7d9539ed54f40f1"}, "originalPosition": 155}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjU0MzM2Mg==", "bodyText": "I think he meant \"meaningless\" and that you should perhaps rename the variable \"map\"  or \"permissionsMap\" or something", "url": "https://github.com/dotCMS/core/pull/19205#discussion_r482543362", "createdAt": "2020-09-02T22:30:10Z", "author": {"login": "wezell"}, "path": "dotCMS/src/main/java/com/dotcms/content/elasticsearch/business/ESMappingAPIImpl.java", "diffHunk": "@@ -567,11 +612,14 @@ protected void loadPermissions(final Contentlet con, final Map<String,Object> m)\n \t\t}\n \t\tm.put(ESMappingConstants.PERMISSIONS, permissionsSt.toString());\n \t\tm.put(ESMappingConstants.OWNER_CAN_READ, ownerCanRead);\n-\t\tm.put(ESMappingConstants.OWNER_CAN_READ + TEXT, Boolean.toString(ownerCanRead));\n \t\tm.put(ESMappingConstants.OWNER_CAN_WRITE, ownerCanWrite);\n-\t\tm.put(ESMappingConstants.OWNER_CAN_WRITE + TEXT, Boolean.toString(ownerCanWrite));\n \t\tm.put(ESMappingConstants.OWNER_CAN_PUBLISH, ownerCanPub);\n-\t\tm.put(ESMappingConstants.OWNER_CAN_PUBLISH + TEXT, Boolean.toString(ownerCanPub));\n+\n+        if (Config.getBooleanProperty(\"CREATE_TEXT_INDEX_FIELD_FOR_NON_TEXT_FIELDS\", false)) {\n+            m.put(ESMappingConstants.OWNER_CAN_READ + TEXT, Boolean.toString(ownerCanRead));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjE3MTUzOQ=="}, "originalCommit": {"oid": "4196eecad05b0802d9ea58bbc7d9539ed54f40f1"}, "originalPosition": 155}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjU1MDI5NA==", "bodyText": "Done", "url": "https://github.com/dotCMS/core/pull/19205#discussion_r482550294", "createdAt": "2020-09-02T22:35:55Z", "author": {"login": "nollymar"}, "path": "dotCMS/src/main/java/com/dotcms/content/elasticsearch/business/ESMappingAPIImpl.java", "diffHunk": "@@ -567,11 +612,14 @@ protected void loadPermissions(final Contentlet con, final Map<String,Object> m)\n \t\t}\n \t\tm.put(ESMappingConstants.PERMISSIONS, permissionsSt.toString());\n \t\tm.put(ESMappingConstants.OWNER_CAN_READ, ownerCanRead);\n-\t\tm.put(ESMappingConstants.OWNER_CAN_READ + TEXT, Boolean.toString(ownerCanRead));\n \t\tm.put(ESMappingConstants.OWNER_CAN_WRITE, ownerCanWrite);\n-\t\tm.put(ESMappingConstants.OWNER_CAN_WRITE + TEXT, Boolean.toString(ownerCanWrite));\n \t\tm.put(ESMappingConstants.OWNER_CAN_PUBLISH, ownerCanPub);\n-\t\tm.put(ESMappingConstants.OWNER_CAN_PUBLISH + TEXT, Boolean.toString(ownerCanPub));\n+\n+        if (Config.getBooleanProperty(\"CREATE_TEXT_INDEX_FIELD_FOR_NON_TEXT_FIELDS\", false)) {\n+            m.put(ESMappingConstants.OWNER_CAN_READ + TEXT, Boolean.toString(ownerCanRead));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjE3MTUzOQ=="}, "originalCommit": {"oid": "4196eecad05b0802d9ea58bbc7d9539ed54f40f1"}, "originalPosition": 155}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAxNDg0NDgyOnYy", "diffSide": "RIGHT", "path": "dotCMS/src/main/java/com/dotcms/content/elasticsearch/business/ESMappingAPIImpl.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQxNTo0NDo1OFrOHL1mxA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQyMjoyODoxNVrOHML9xw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjE3NDY2MA==", "bodyText": "I think we need to treat methods with void returns as a code smell  especially if we are passing in an object that is intended to be mutated under the covers.  This to me is an coding anti-pattern.\nA better choice for this method for example  is to return an Optional that if it is present, gets added to the existing collection.  That allows for simpler testing and a clear understanding of what object is being changed when this method is called.", "url": "https://github.com/dotCMS/core/pull/19205#discussion_r482174660", "createdAt": "2020-09-02T15:44:58Z", "author": {"login": "wezell"}, "path": "dotCMS/src/main/java/com/dotcms/content/elasticsearch/business/ESMappingAPIImpl.java", "diffHunk": "@@ -384,6 +373,59 @@ public String toJson(final Contentlet contentlet) throws DotMappingException {\n \t\t}\n \t}\n \n+    /**\n+     * Fields with suffix _text will be indexed if the property `CREATE_TEXT_INDEX_FIELD_FOR_NON_TEXT_FIELDS` is on\n+     * @param contentletMap\n+     * @param contentlet\n+     * @param contentIdentifier\n+     * @param versionInfo\n+     * @param contentType\n+     * @throws DotSecurityException\n+     * @throws DotDataException\n+     */\n+    private void addTextFieldToMapIfNeeded(final Map<String, Object> contentletMap,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4196eecad05b0802d9ea58bbc7d9539ed54f40f1"}, "originalPosition": 86}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjU0MDk5OQ==", "bodyText": "done", "url": "https://github.com/dotCMS/core/pull/19205#discussion_r482540999", "createdAt": "2020-09-02T22:28:15Z", "author": {"login": "nollymar"}, "path": "dotCMS/src/main/java/com/dotcms/content/elasticsearch/business/ESMappingAPIImpl.java", "diffHunk": "@@ -384,6 +373,59 @@ public String toJson(final Contentlet contentlet) throws DotMappingException {\n \t\t}\n \t}\n \n+    /**\n+     * Fields with suffix _text will be indexed if the property `CREATE_TEXT_INDEX_FIELD_FOR_NON_TEXT_FIELDS` is on\n+     * @param contentletMap\n+     * @param contentlet\n+     * @param contentIdentifier\n+     * @param versionInfo\n+     * @param contentType\n+     * @throws DotSecurityException\n+     * @throws DotDataException\n+     */\n+    private void addTextFieldToMapIfNeeded(final Map<String, Object> contentletMap,", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjE3NDY2MA=="}, "originalCommit": {"oid": "4196eecad05b0802d9ea58bbc7d9539ed54f40f1"}, "originalPosition": 86}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAzNDAzMzE3OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/integration-test/java/com/dotcms/content/elasticsearch/util/ESMappingUtilHelperTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxNzozMzowOVrOHOnTxQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wOFQxNzozMzowOVrOHOnTxQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTA4NjE0OQ==", "bodyText": "Codacy found an issue: Avoid unused imports such as 'com.dotmarketing.util.Config'", "url": "https://github.com/dotCMS/core/pull/19205#discussion_r485086149", "createdAt": "2020-09-08T17:33:09Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/content/elasticsearch/util/ESMappingUtilHelperTest.java", "diffHunk": "@@ -43,6 +43,7 @@\n import com.dotmarketing.portlets.contentlet.model.Contentlet;\n import com.dotmarketing.portlets.languagesmanager.model.Language;\n import com.dotmarketing.portlets.structure.model.Relationship;\n+import com.dotmarketing.util.Config;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9c7dd8b91bed8c771ea66eb9291cc098ec7e3d05"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1846, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}