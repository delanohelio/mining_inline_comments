{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY3MDg0Nzk5", "number": 17915, "title": "#12739: Added allCategoriesInfo parameter for retrieve all categories info in Content REST API", "bodyText": "This PR adds the allCategoriesInfo parameter to Content REST API:\n/api/content/id/{ContentIdentifier}/allCategoriesInfo/1\n\nWhen the parameter is used, the full categories information is returned for the content. When the parameter is not used (the default behavior), only category names are included in the result.\nFor example, this info is generated when the parameter is used:\n{\n  \"contentlets\": [\n    {\n    ...\n    \"topic\": [\n        {\n          \"inode\": \"ede13663-ff06-4d01-ab99-a8976e995010\",\n          \"keywords\": \"\",\n          \"sortOrder\": 0,\n          \"description\": null,\n          \"categoryName\": \"Research\",\n          \"key\": \"research\"\n        },\n        {\n          \"inode\": \"bba0fcba-eb79-46dc-ae36-fe2f3d9cf1e7\",\n          \"keywords\": \"\",\n          \"sortOrder\": 0,\n          \"description\": null,\n          \"categoryName\": \"Retirement\",\n          \"key\": \"retirement\"\n        }\n      ]\n    ...\n    }\n  ]\n}", "createdAt": "2020-01-25T03:59:11Z", "url": "https://github.com/dotCMS/core/pull/17915", "merged": true, "mergeCommit": {"oid": "41584071ddcfba4438f5814fba2b2c678b2cc85a"}, "closed": true, "closedAt": "2020-02-06T20:00:44Z", "author": {"login": "dsolistorres"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb9rT-rgH2gAyMzY3MDg0Nzk5OjVjZWFkNDFmZDBmZWQ5MjZiZTc3YmYyMmQ4MGVmY2I0MzZhMTAxMGQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcBdCwkAH2gAyMzY3MDg0Nzk5OjRiN2ZjOGIxNDBjZWExYWIwM2Q1OTg4OTlmNmFiNmQwZTQ1YmNlZDQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5cead41fd0fed926be77bf22d80efcb436a1010d", "author": {"user": {"login": "dsolistorres", "name": "daniel.solis"}}, "url": "https://github.com/dotCMS/core/commit/5cead41fd0fed926be77bf22d80efcb436a1010d", "committedDate": "2020-01-25T03:52:03Z", "message": "dotCMS/core#12739: Added allCategoriesInfo parameter for retrieve all categories info in Content REST API"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "15cf27d07d6aa0efef8cee5f63772344f245c7b0", "author": {"user": {"login": "dsolistorres", "name": "daniel.solis"}}, "url": "https://github.com/dotCMS/core/commit/15cf27d07d6aa0efef8cee5f63772344f245c7b0", "committedDate": "2020-01-25T18:25:30Z", "message": "dotCMS/core#12739: Removed unused class from test method"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5099b08b780199e3bc2c8fd3ba23201fc6b8bea0", "author": {"user": {"login": "dsolistorres", "name": "daniel.solis"}}, "url": "https://github.com/dotCMS/core/commit/5099b08b780199e3bc2c8fd3ba23201fc6b8bea0", "committedDate": "2020-01-25T18:47:06Z", "message": "dotCMS/core#12739: Declared local variables as final for test method"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzMTA5ODM0", "url": "https://github.com/dotCMS/core/pull/17915#pullrequestreview-353109834", "createdAt": "2020-02-04T16:17:48Z", "commit": {"oid": "5cead41fd0fed926be77bf22d80efcb436a1010d"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxNjoxNzo0OFrOFlaT1Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxNjoxNzo0OFrOFlaT1Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDc3MjY5Mw==", "bodyText": "This is a great change and the code to include the categories is in the right place.", "url": "https://github.com/dotCMS/core/pull/17915#discussion_r374772693", "createdAt": "2020-02-04T16:17:48Z", "author": {"login": "wezell"}, "path": "dotCMS/src/main/java/com/dotmarketing/portlets/contentlet/util/ContentletUtil.java", "diffHunk": "@@ -142,33 +164,37 @@ public static String sanitizeFileName(String fileName){\n \t\t\t} else if(f instanceof CategoryField) {\r\n \r\n \t\t\t\tList<Category> cats = null;\r\n-\t\t\t\t\r\n \t\t\t\ttry {\r\n-\r\n \t\t\t\t\tcats = APILocator.getCategoryAPI().getParents(contentlet, user, true);\r\n \t\t\t\t} catch (Exception e) {\r\n \t\t\t\t\tLogger.error(ContentletUtil.class, String.format(\"Unable to get the Categories for given contentlet with inode= %s\", contentlet.getInode()));\r\n \t\t\t\t}\r\n \r\n \t\t\t\tif(cats!=null && !cats.isEmpty()) {\r\n \t\t\t\t\ttry {\r\n-\r\n \t\t\t\t\t\tfinal Category parentCategory        = APILocator.getCategoryAPI().find(f.values(), user, true);\r\n \t\t\t\t\t\tfinal List<Category> childCategories = new ArrayList<>();\r\n \r\n \t\t\t\t\t\tif(parentCategory != null) {\r\n \t\t\t\t\t\t\tfor (Category category : cats) {\r\n-\r\n \t\t\t\t\t\t\t\tif (APILocator.getCategoryAPI().isParent(category, parentCategory, user,true)) {\r\n-\r\n \t\t\t\t\t\t\t\t\tchildCategories.add(category);\r\n \t\t\t\t\t\t\t\t}\r\n \t\t\t\t\t\t\t}\r\n \t\t\t\t\t\t}\r\n \r\n \t\t\t\t\t\tif (!childCategories.isEmpty()){\r\n-\t\t\t\t\t\t\tString catsStr = childCategories.stream().map(Category::getCategoryName).collect(Collectors.joining(\", \"));\r\n-\t\t\t\t\t\t\tm.put(f.variable(), catsStr);\r\n+\t\t\t\t\t\t\tObject categoriesValue;\r\n+\t\t\t\t\t\t\tif (allCategoriesInfo) {\r\n+\t\t\t\t\t\t\t\tcategoriesValue = childCategories.stream()\r\n+\t\t\t\t\t\t\t\t\t\t.map(Category::getMap)\r\n+\t\t\t\t\t\t\t\t\t\t.collect(Collectors.toList());\r\n+\t\t\t\t\t\t\t} else {\r\n+\t\t\t\t\t\t\t\tcategoriesValue = childCategories.stream()\r\n+\t\t\t\t\t\t\t\t\t\t.map(Category::getCategoryName)\r\n+\t\t\t\t\t\t\t\t\t\t.collect(Collectors.joining(\", \"));\r\n+\t\t\t\t\t\t\t}\r\n+\t\t\t\t\t\t\tm.put(f.variable(), categoriesValue);\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5cead41fd0fed926be77bf22d80efcb436a1010d"}, "originalPosition": 93}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9bee24831e432e1aa2e7fe2ceb3ac02943739cb1", "author": {"user": {"login": "dsilvam", "name": "Daniel Silva"}}, "url": "https://github.com/dotCMS/core/commit/9bee24831e432e1aa2e7fe2ceb3ac02943739cb1", "committedDate": "2020-02-05T20:45:47Z", "message": "Merge branch 'master' of github.com:dotCMS/core into issue-12739-full-categories-info-for-content-rest-api"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b7fc8b140cea1ab03d598899f6ab6d0e45bced4", "author": {"user": {"login": "dsilvam", "name": "Daniel Silva"}}, "url": "https://github.com/dotCMS/core/commit/4b7fc8b140cea1ab03d598899f6ab6d0e45bced4", "committedDate": "2020-02-05T21:30:16Z", "message": "#12739 rename param"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1347, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}