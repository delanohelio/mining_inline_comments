{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEwMzQxNjgz", "number": 18383, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQxNDo0Mjo0MVrOD3qRLQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQxOTozNDozN1rOD3xZSQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU5NjkwNzk3OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/main/java/com/dotmarketing/util/UtilHTML.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQxNDo0Mjo0MVrOGOCTNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQxNDo0Mjo0MVrOGOCTNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzM3MDkzMw==", "bodyText": "any test?", "url": "https://github.com/dotCMS/core/pull/18383#discussion_r417370933", "createdAt": "2020-04-29T14:42:41Z", "author": {"login": "freddyucv"}, "path": "dotCMS/src/main/java/com/dotmarketing/util/UtilHTML.java", "diffHunk": "@@ -442,9 +442,10 @@ public static String getIconClass(final Contentlet contentlet) throws DotDataExc\n                 return IconType.VANITY_URL.iconName();\n             case DOTASSET:\n \n-                return \"uknIcon \" + UtilMethods.getFileExtension(\n-                \t\tTry.of(()-> contentlet.getBinary(\"asset\").getName())\n-\t\t\t\t\t\t\t\t.getOrElse(\"ukn\") )+ \"Icon\";\n+            \tfinal String dotUri  = Try.of(()-> contentlet.getBinary(\"asset\").getName()).getOrElse(\"ukn\");\n+            \tfinal String dotIcon = UtilMethods.getFileExtension(dotUri);\n+\n+\t\t\t\treturn dotUri.equals(dotIcon)? \"uknIcon\": dotIcon + \"Icon\";\n             default:\n                 return IconType.UNKNOWN.iconName();\n         }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ff23ac7a53b0f8d5a84caf965f346e5ad05a49d7"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU5NzY2NzgyOnYy", "diffSide": "RIGHT", "path": "dotCMS/src/main/java/com/dotmarketing/portlets/browser/ajax/BrowserAjax.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQxNzo0MTowN1rOGOJ36Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQxOTozNzoxOVrOGOOBbg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzQ5NTAxNw==", "bodyText": "Don't we have a transformer you can use for this @jdotcms ?", "url": "https://github.com/dotCMS/core/pull/18383#discussion_r417495017", "createdAt": "2020-04-29T17:41:07Z", "author": {"login": "dsilvam"}, "path": "dotCMS/src/main/java/com/dotmarketing/portlets/browser/ajax/BrowserAjax.java", "diffHunk": "@@ -648,6 +653,23 @@ else if(cont.getStructure().getStructureType()==Structure.STRUCTURE_TYPE_HTMLPAG\n \t\t\t    pageMap.put(\"mimeType\", \"application/dotpage\");\n \t            pageMap.put(\"pageURI\", ident.getURI());\n \t            return pageMap;\n+\t\t\t} else if(cont.getStructure().getStructureType()== BaseContentType.DOTASSET.getType()) {\n+\n+\t\t\t\tfinal java.io.File file = Try.of(()->cont.getBinary(DotAssetContentType.ASSET_FIELD_VAR)).getOrNull();\n+\t\t\t\tif (null != file) {\n+\t\t\t\t\tfinal String fileName = file.getName();\n+\t\t\t\t\tfinal String mimeType = servletContext.getMimeType(fileName.toLowerCase());\n+\n+\t\t\t\t\tfinal Map<String, Object> fileMap = cont.getMap();\n+\t\t\t\t\tfileMap.put(\"mimeType\", mimeType);\n+\t\t\t\t\tfileMap.put(\"path\",          \"/dA/\" + cont.getIdentifier() + StringPool.SLASH);\n+\t\t\t\t\tfileMap.put(\"type\", \"dotasset\");\n+\t\t\t\t\tfileMap.put(\"type\", \"dotasset\");\n+\t\t\t\t\tfileMap.put(\"name\",     fileName);\n+\t\t\t\t\tfileMap.put(\"fileName\", fileName);\n+\n+\t\t\t\t\treturn fileMap;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ff23ac7a53b0f8d5a84caf965f346e5ad05a49d7"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzU2Mjk5MA==", "bodyText": "if not exists any, Should we create a new transformer?", "url": "https://github.com/dotCMS/core/pull/18383#discussion_r417562990", "createdAt": "2020-04-29T19:37:19Z", "author": {"login": "freddyucv"}, "path": "dotCMS/src/main/java/com/dotmarketing/portlets/browser/ajax/BrowserAjax.java", "diffHunk": "@@ -648,6 +653,23 @@ else if(cont.getStructure().getStructureType()==Structure.STRUCTURE_TYPE_HTMLPAG\n \t\t\t    pageMap.put(\"mimeType\", \"application/dotpage\");\n \t            pageMap.put(\"pageURI\", ident.getURI());\n \t            return pageMap;\n+\t\t\t} else if(cont.getStructure().getStructureType()== BaseContentType.DOTASSET.getType()) {\n+\n+\t\t\t\tfinal java.io.File file = Try.of(()->cont.getBinary(DotAssetContentType.ASSET_FIELD_VAR)).getOrNull();\n+\t\t\t\tif (null != file) {\n+\t\t\t\t\tfinal String fileName = file.getName();\n+\t\t\t\t\tfinal String mimeType = servletContext.getMimeType(fileName.toLowerCase());\n+\n+\t\t\t\t\tfinal Map<String, Object> fileMap = cont.getMap();\n+\t\t\t\t\tfileMap.put(\"mimeType\", mimeType);\n+\t\t\t\t\tfileMap.put(\"path\",          \"/dA/\" + cont.getIdentifier() + StringPool.SLASH);\n+\t\t\t\t\tfileMap.put(\"type\", \"dotasset\");\n+\t\t\t\t\tfileMap.put(\"type\", \"dotasset\");\n+\t\t\t\t\tfileMap.put(\"name\",     fileName);\n+\t\t\t\t\tfileMap.put(\"fileName\", fileName);\n+\n+\t\t\t\t\treturn fileMap;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzQ5NTAxNw=="}, "originalCommit": {"oid": "ff23ac7a53b0f8d5a84caf965f346e5ad05a49d7"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU5ODA3NTYxOnYy", "diffSide": "RIGHT", "path": "dotCMS/src/integration-test/java/com/dotmarketing/util/UtilHTMLTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQxOTozNDozN1rOGON8Dw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQxOTozNDozN1rOGON8Dw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzU2MTYxNQ==", "bodyText": "Issue found: Local variable 'txtFile' could be declared final", "url": "https://github.com/dotCMS/core/pull/18383#discussion_r417561615", "createdAt": "2020-04-29T19:34:37Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotmarketing/util/UtilHTMLTest.java", "diffHunk": "@@ -0,0 +1,232 @@\n+package com.dotmarketing.util;\n+\n+import com.dotcms.contenttype.model.type.BaseContentType;\n+import com.dotcms.contenttype.model.type.ContentType;\n+import com.dotcms.contenttype.model.type.DotAssetContentType;\n+import com.dotcms.datagen.FileAssetDataGen;\n+import com.dotcms.datagen.FolderDataGen;\n+import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.exception.DotDataException;\n+import com.dotmarketing.exception.DotSecurityException;\n+import com.dotmarketing.portlets.contentlet.model.Contentlet;\n+import com.dotmarketing.portlets.folders.model.Folder;\n+import org.junit.Test;\n+\n+import java.io.File;\n+import java.io.IOException;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNotNull;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.when;\n+\n+/**\n+ * Unit test for {@link UtilHTML}\n+ */\n+public class UtilHTMLTest {\n+\n+    /**\n+     * Method to test: getIconClass\n+     * Given Scenario: Given an unknown base type\n+     * ExpectedResult: Unknown icon should be returned\n+     */\n+    @Test\n+    public void test_getIconClass_unknown () throws DotDataException {\n+\n+        final Contentlet contentlet = mock(Contentlet.class);\n+        final ContentType type      = mock(ContentType.class);\n+        final BaseContentType any   = BaseContentType.ANY;\n+        when(contentlet.getContentType()).thenReturn(type);\n+        when(type.baseType()).thenReturn(any);\n+\n+        final String iconClass = UtilHTML.getIconClass(contentlet);\n+        assertNotNull(iconClass);\n+        assertEquals(\"uknIcon\", iconClass);\n+    }\n+\n+    /**\n+     * Method to test: getIconClass\n+     * Given Scenario: Given a contentlet base type\n+     * ExpectedResult: contentIcon icon should be returned\n+     */\n+    @Test\n+    public void test_getIconClass_content () throws DotDataException {\n+\n+        final Contentlet contentlet = mock(Contentlet.class);\n+        final ContentType type      = mock(ContentType.class);\n+        final BaseContentType any   = BaseContentType.CONTENT;\n+        when(contentlet.getContentType()).thenReturn(type);\n+        when(type.baseType()).thenReturn(any);\n+\n+        final String iconClass = UtilHTML.getIconClass(contentlet);\n+        assertNotNull(iconClass);\n+        assertEquals(\"contentIcon\", iconClass);\n+    }\n+\n+    /**\n+     * Method to test: getIconClass\n+     * Given Scenario: Given a widget base type\n+     * ExpectedResult: gearIcon icon should be returned\n+     */\n+    @Test\n+    public void test_getIconClass_widget () throws DotDataException {\n+\n+        final Contentlet contentlet = mock(Contentlet.class);\n+        final ContentType type      = mock(ContentType.class);\n+        final BaseContentType any   = BaseContentType.WIDGET;\n+        when(contentlet.getContentType()).thenReturn(type);\n+        when(type.baseType()).thenReturn(any);\n+\n+        final String iconClass = UtilHTML.getIconClass(contentlet);\n+        assertNotNull(iconClass);\n+        assertEquals(\"gearIcon\", iconClass);\n+    }\n+\n+    /**\n+     * Method to test: getIconClass\n+     * Given Scenario: Given a form base type\n+     * ExpectedResult: formIcon icon should be returned\n+     */\n+    @Test\n+    public void test_getIconClass_form () throws DotDataException {\n+\n+        final Contentlet contentlet = mock(Contentlet.class);\n+        final ContentType type      = mock(ContentType.class);\n+        final BaseContentType any   = BaseContentType.FORM;\n+        when(contentlet.getContentType()).thenReturn(type);\n+        when(type.baseType()).thenReturn(any);\n+\n+        final String iconClass = UtilHTML.getIconClass(contentlet);\n+        assertNotNull(iconClass);\n+        assertEquals(\"formIcon\", iconClass);\n+    }\n+\n+    /**\n+     * Method to test: getIconClass\n+     * Given Scenario: Given a file  base type and txt file\n+     * ExpectedResult: txtIcon icon should be returned\n+     */\n+    @Test\n+    public void test_getIconClass_txt_file () throws DotDataException, IOException, DotSecurityException {\n+\n+        final Folder folder1 = new FolderDataGen().site(APILocator.systemHost()).nextPersisted();\n+        final Contentlet contentlet = FileAssetDataGen.createFileAsset(folder1, \"text1\", \".txt\");\n+\n+        final String iconClass = UtilHTML.getIconClass(contentlet);\n+        assertNotNull(iconClass);\n+        assertEquals(\"txtIcon\", iconClass);\n+    }\n+\n+    /**\n+     * Method to test: getIconClass\n+     * Given Scenario: Given a file  base type and vtl file\n+     * ExpectedResult: vtlIcon icon should be returned\n+     */\n+    @Test\n+    public void test_getIconClass_vtl_file () throws DotDataException, IOException, DotSecurityException {\n+\n+        final Folder folder1 = new FolderDataGen().site(APILocator.systemHost()).nextPersisted();\n+        final Contentlet contentlet = FileAssetDataGen.createFileAsset(folder1, \"text2\", \".vtl\");\n+\n+        final String iconClass = UtilHTML.getIconClass(contentlet);\n+        assertNotNull(iconClass);\n+        assertEquals(\"vtlIcon\", iconClass);\n+    }\n+\n+    /**\n+     * Method to test: getIconClass\n+     * Given Scenario: Given a page base type\n+     * ExpectedResult: pageIcon icon should be returned\n+     */\n+    @Test\n+    public void test_getIconClass_page () throws DotDataException {\n+\n+        final Contentlet contentlet = mock(Contentlet.class);\n+        final ContentType type      = mock(ContentType.class);\n+        final BaseContentType any   = BaseContentType.HTMLPAGE;\n+        when(contentlet.getContentType()).thenReturn(type);\n+        when(type.baseType()).thenReturn(any);\n+\n+        final String iconClass = UtilHTML.getIconClass(contentlet);\n+        assertNotNull(iconClass);\n+        assertEquals(\"pageIcon\", iconClass);\n+    }\n+\n+    /**\n+     * Method to test: getIconClass\n+     * Given Scenario: Given a key value base type\n+     * ExpectedResult: keyValueIcon icon should be returned\n+     */\n+    @Test\n+    public void test_getIconClass_keyvalue () throws DotDataException {\n+\n+        final Contentlet contentlet = mock(Contentlet.class);\n+        final ContentType type      = mock(ContentType.class);\n+        final BaseContentType any   = BaseContentType.KEY_VALUE;\n+        when(contentlet.getContentType()).thenReturn(type);\n+        when(type.baseType()).thenReturn(any);\n+\n+        final String iconClass = UtilHTML.getIconClass(contentlet);\n+        assertNotNull(iconClass);\n+        assertEquals(\"keyValueIcon\", iconClass);\n+    }\n+\n+    /**\n+     * Method to test: getIconClass\n+     * Given Scenario: Given a persona base type\n+     * ExpectedResult: personaIcon icon should be returned\n+     */\n+    @Test\n+    public void test_getIconClass_persona () throws DotDataException {\n+\n+        final Contentlet contentlet = mock(Contentlet.class);\n+        final ContentType type      = mock(ContentType.class);\n+        final BaseContentType any   = BaseContentType.PERSONA;\n+        when(contentlet.getContentType()).thenReturn(type);\n+        when(type.baseType()).thenReturn(any);\n+\n+        final String iconClass = UtilHTML.getIconClass(contentlet);\n+        assertNotNull(iconClass);\n+        assertEquals(\"personaIcon\", iconClass);\n+    }\n+\n+    /**\n+     * Method to test: getIconClass\n+     * Given Scenario: Given a vanity url base type\n+     * ExpectedResult: vanityIcon icon should be returned\n+     */\n+    @Test\n+    public void test_getIconClass_vanity () throws DotDataException {\n+\n+        final Contentlet contentlet = mock(Contentlet.class);\n+        final ContentType type      = mock(ContentType.class);\n+        final BaseContentType any   = BaseContentType.VANITY_URL;\n+        when(contentlet.getContentType()).thenReturn(type);\n+        when(type.baseType()).thenReturn(any);\n+\n+        final String iconClass = UtilHTML.getIconClass(contentlet);\n+        assertNotNull(iconClass);\n+        assertEquals(\"vanityIcon\", iconClass);\n+    }\n+\n+    /**\n+     * Method to test: getIconClass\n+     * Given Scenario: Given a dotasset base type and txt file\n+     * ExpectedResult: txtIcon icon should be returned\n+     */\n+    @Test\n+    public void test_getIconClass_dotasset_txt () throws DotDataException, IOException {\n+\n+        final Contentlet contentlet = mock(Contentlet.class);\n+        final ContentType type      = mock(ContentType.class);\n+        final BaseContentType any   = BaseContentType.DOTASSET;\n+        File txtFile                = FileUtil.createTemporalFile(\"testtxt\", \".txt\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0085f0fee0f365b6efc6e1d776a904262537b2c0"}, "originalPosition": 223}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2258, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}