{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIwMzQxNjc2", "number": 18522, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxNDoyMzoyN1rOD-PnvA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQyMDoxOTowNVrOD-YKGQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY2NTk0MjM2OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/main/java/com/dotcms/rest/api/v1/folder/FolderResource.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxNDoyMzoyN1rOGYOXog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQxNzozMDo0NVrOGYWcdg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODA1NDQzNA==", "bodyText": "here we should use the Exception Mapper", "url": "https://github.com/dotCMS/core/pull/18522#discussion_r428054434", "createdAt": "2020-05-20T14:23:27Z", "author": {"login": "freddyucv"}, "path": "dotCMS/src/main/java/com/dotcms/rest/api/v1/folder/FolderResource.java", "diffHunk": "@@ -70,41 +61,24 @@ public final Response createFolders(@Context final HttpServletRequest httpServle\n                                         @Context final HttpServletResponse httpServletResponse,\n                                         final List<String> paths,\n                                         @PathParam(\"siteName\") final String siteName) {\n-        Response response = null;\n-        final InitDataObject initData = this.webResource.init(null, httpServletRequest, httpServletResponse, true, null);\n+\n+        final InitDataObject initData =\n+                new WebResource.InitBuilder(webResource)\n+                        .requiredBackendUser(true)\n+                        .requiredFrontendUser(false)\n+                        .requestAndResponse(httpServletRequest, httpServletResponse)\n+                        .init();\n+\n         final User user = initData.getUser();\n-        final List<Map<String, Object>> folderResults;\n \n         try {\n-            Locale locale = LocaleUtil.getLocale(user, httpServletRequest);\n-            FolderHelper.FolderResults results = folderHelper.createFolders(paths, siteName, user);\n-            folderResults = results.folders\n-                    .stream()\n-                    .map(folder -> {\n-                        try {\n-                            return folder.getMap();\n-                        } catch (Exception e) {\n-                            Logger.error(this, \"Data Exception while converting to map\", e);\n-                            throw new DotRuntimeException(\"Data Exception while converting to map\", e);\n-                        }\n-                    })\n-                    .collect(Collectors.toList());\n-            ;\n+            final List<Map<String, Object>> createdFolders = folderHelper.createFolders(paths, siteName, user);\n \n-            response = Response.ok(new ResponseEntityView\n-                    (map(\"result\", folderResults),\n-                            results.getErrorEntities(), null,\n-                            this.i18NUtil.getMessagesMap(locale, \"Invalid-option-selected\",\n-                                    \"cancel\")\n-                    )).build(); // 200\n-        } catch (Exception e) { // this is an unknown error, so we report as a 500.\n-            Logger.error(this, \"Error handling Save Folder Post Request\", e);\n-            if (ExceptionUtil.causedBy(e, DotSecurityException.class)) {\n-                throw new ForbiddenException(e);\n-            }\n-            response = ExceptionMapperUtil.createResponse(e, Response.Status.INTERNAL_SERVER_ERROR);\n+            return Response.ok(new ResponseEntityView(createdFolders)).build(); // 200\n+        } catch (Exception e) {\n+            Logger.error(this.getClass(),\"Exception saving/creating folders.\", e);\n+            return ResponseUtil.mapExceptionResponse(e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4a6538db5e5df1a55f3ca7eb13d6e2d4248b5637"}, "originalPosition": 104}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODA4Njg4OQ==", "bodyText": "do you have an example of the exception mapper? Because I based on the AppsResource that is the latest resource created and this is how is handling the exceptions.", "url": "https://github.com/dotCMS/core/pull/18522#discussion_r428086889", "createdAt": "2020-05-20T15:04:33Z", "author": {"login": "erickgonzalez"}, "path": "dotCMS/src/main/java/com/dotcms/rest/api/v1/folder/FolderResource.java", "diffHunk": "@@ -70,41 +61,24 @@ public final Response createFolders(@Context final HttpServletRequest httpServle\n                                         @Context final HttpServletResponse httpServletResponse,\n                                         final List<String> paths,\n                                         @PathParam(\"siteName\") final String siteName) {\n-        Response response = null;\n-        final InitDataObject initData = this.webResource.init(null, httpServletRequest, httpServletResponse, true, null);\n+\n+        final InitDataObject initData =\n+                new WebResource.InitBuilder(webResource)\n+                        .requiredBackendUser(true)\n+                        .requiredFrontendUser(false)\n+                        .requestAndResponse(httpServletRequest, httpServletResponse)\n+                        .init();\n+\n         final User user = initData.getUser();\n-        final List<Map<String, Object>> folderResults;\n \n         try {\n-            Locale locale = LocaleUtil.getLocale(user, httpServletRequest);\n-            FolderHelper.FolderResults results = folderHelper.createFolders(paths, siteName, user);\n-            folderResults = results.folders\n-                    .stream()\n-                    .map(folder -> {\n-                        try {\n-                            return folder.getMap();\n-                        } catch (Exception e) {\n-                            Logger.error(this, \"Data Exception while converting to map\", e);\n-                            throw new DotRuntimeException(\"Data Exception while converting to map\", e);\n-                        }\n-                    })\n-                    .collect(Collectors.toList());\n-            ;\n+            final List<Map<String, Object>> createdFolders = folderHelper.createFolders(paths, siteName, user);\n \n-            response = Response.ok(new ResponseEntityView\n-                    (map(\"result\", folderResults),\n-                            results.getErrorEntities(), null,\n-                            this.i18NUtil.getMessagesMap(locale, \"Invalid-option-selected\",\n-                                    \"cancel\")\n-                    )).build(); // 200\n-        } catch (Exception e) { // this is an unknown error, so we report as a 500.\n-            Logger.error(this, \"Error handling Save Folder Post Request\", e);\n-            if (ExceptionUtil.causedBy(e, DotSecurityException.class)) {\n-                throw new ForbiddenException(e);\n-            }\n-            response = ExceptionMapperUtil.createResponse(e, Response.Status.INTERNAL_SERVER_ERROR);\n+            return Response.ok(new ResponseEntityView(createdFolders)).build(); // 200\n+        } catch (Exception e) {\n+            Logger.error(this.getClass(),\"Exception saving/creating folders.\", e);\n+            return ResponseUtil.mapExceptionResponse(e);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODA1NDQzNA=="}, "originalCommit": {"oid": "4a6538db5e5df1a55f3ca7eb13d6e2d4248b5637"}, "originalPosition": 104}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODE4Njc0Mg==", "bodyText": "done", "url": "https://github.com/dotCMS/core/pull/18522#discussion_r428186742", "createdAt": "2020-05-20T17:30:45Z", "author": {"login": "erickgonzalez"}, "path": "dotCMS/src/main/java/com/dotcms/rest/api/v1/folder/FolderResource.java", "diffHunk": "@@ -70,41 +61,24 @@ public final Response createFolders(@Context final HttpServletRequest httpServle\n                                         @Context final HttpServletResponse httpServletResponse,\n                                         final List<String> paths,\n                                         @PathParam(\"siteName\") final String siteName) {\n-        Response response = null;\n-        final InitDataObject initData = this.webResource.init(null, httpServletRequest, httpServletResponse, true, null);\n+\n+        final InitDataObject initData =\n+                new WebResource.InitBuilder(webResource)\n+                        .requiredBackendUser(true)\n+                        .requiredFrontendUser(false)\n+                        .requestAndResponse(httpServletRequest, httpServletResponse)\n+                        .init();\n+\n         final User user = initData.getUser();\n-        final List<Map<String, Object>> folderResults;\n \n         try {\n-            Locale locale = LocaleUtil.getLocale(user, httpServletRequest);\n-            FolderHelper.FolderResults results = folderHelper.createFolders(paths, siteName, user);\n-            folderResults = results.folders\n-                    .stream()\n-                    .map(folder -> {\n-                        try {\n-                            return folder.getMap();\n-                        } catch (Exception e) {\n-                            Logger.error(this, \"Data Exception while converting to map\", e);\n-                            throw new DotRuntimeException(\"Data Exception while converting to map\", e);\n-                        }\n-                    })\n-                    .collect(Collectors.toList());\n-            ;\n+            final List<Map<String, Object>> createdFolders = folderHelper.createFolders(paths, siteName, user);\n \n-            response = Response.ok(new ResponseEntityView\n-                    (map(\"result\", folderResults),\n-                            results.getErrorEntities(), null,\n-                            this.i18NUtil.getMessagesMap(locale, \"Invalid-option-selected\",\n-                                    \"cancel\")\n-                    )).build(); // 200\n-        } catch (Exception e) { // this is an unknown error, so we report as a 500.\n-            Logger.error(this, \"Error handling Save Folder Post Request\", e);\n-            if (ExceptionUtil.causedBy(e, DotSecurityException.class)) {\n-                throw new ForbiddenException(e);\n-            }\n-            response = ExceptionMapperUtil.createResponse(e, Response.Status.INTERNAL_SERVER_ERROR);\n+            return Response.ok(new ResponseEntityView(createdFolders)).build(); // 200\n+        } catch (Exception e) {\n+            Logger.error(this.getClass(),\"Exception saving/creating folders.\", e);\n+            return ResponseUtil.mapExceptionResponse(e);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODA1NDQzNA=="}, "originalCommit": {"oid": "4a6538db5e5df1a55f3ca7eb13d6e2d4248b5637"}, "originalPosition": 104}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY2NzM0MDk5OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/integration-test/java/com/dotcms/rest/api/v1/folder/FolderResourceTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQyMDoxOTowNFrOGYcXCg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQyMDoxOTowNFrOGYcXCg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODI4MzY1OA==", "bodyText": "Issue found: A method/constructor should not explicitly throw java.lang.Exception", "url": "https://github.com/dotCMS/core/pull/18522#discussion_r428283658", "createdAt": "2020-05-20T20:19:04Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rest/api/v1/folder/FolderResourceTest.java", "diffHunk": "@@ -0,0 +1,125 @@\n+package com.dotcms.rest.api.v1.folder;\n+\n+import com.dotcms.datagen.SiteDataGen;\n+import com.dotcms.datagen.TestUserUtils;\n+import com.dotcms.mock.request.MockAttributeRequest;\n+import com.dotcms.mock.request.MockHeaderRequest;\n+import com.dotcms.mock.request.MockHttpRequest;\n+import com.dotcms.mock.request.MockSessionRequest;\n+import com.dotcms.mock.response.MockHttpResponse;\n+import com.dotcms.rest.ResponseEntityView;\n+import com.dotcms.util.IntegrationTestInitService;\n+import com.dotmarketing.beans.Host;\n+import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.exception.DotDataException;\n+import com.dotmarketing.exception.DotSecurityException;\n+import com.dotmarketing.portlets.folders.business.FolderAPI;\n+import com.dotmarketing.portlets.folders.model.Folder;\n+import com.liferay.portal.model.User;\n+import com.liferay.util.Base64;\n+import java.util.Arrays;\n+import java.util.List;\n+import java.util.Map;\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+import javax.ws.rs.core.Response;\n+import javax.ws.rs.core.Response.Status;\n+import org.junit.Assert;\n+import org.junit.BeforeClass;\n+import org.junit.Test;\n+\n+public class FolderResourceTest {\n+\n+    static HttpServletResponse response;\n+    static FolderResource resource;\n+    static FolderAPI folderAPI;\n+\n+    @BeforeClass\n+    public static void prepare() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f7cd46a009f07407a7dc798256344bd0d800a91"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY2NzM0MTA1OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/main/java/com/dotcms/rest/api/v1/folder/FolderResource.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQyMDoxOTowNVrOGYcXFQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMFQyMDoxOTowNVrOGYcXFQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODI4MzY2OQ==", "bodyText": "Issue found: Avoid unused imports such as 'com.dotcms.rest.api.v1.authentication.ResponseUtil'", "url": "https://github.com/dotCMS/core/pull/18522#discussion_r428283669", "createdAt": "2020-05-20T20:19:05Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/main/java/com/dotcms/rest/api/v1/folder/FolderResource.java", "diffHunk": "@@ -1,27 +1,23 @@\n package com.dotcms.rest.api.v1.folder;\n \n-import static com.dotcms.util.CollectionsUtils.map;\n-\n import com.dotcms.exception.ExceptionUtil;\n import com.dotcms.repackage.com.google.common.annotations.VisibleForTesting;\n import com.dotcms.rest.InitDataObject;\n import com.dotcms.rest.ResponseEntityView;\n import com.dotcms.rest.WebResource;\n import com.dotcms.rest.annotation.NoCache;\n+import com.dotcms.rest.api.v1.authentication.ResponseUtil;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f7cd46a009f07407a7dc798256344bd0d800a91"}, "originalPosition": 11}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2084, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}