{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMyMDg4NTYx", "number": 18631, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQyMjowODowM1rOEEErKA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxNzowMToyN1rOEEYnUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyNzA2MzQ0OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/main/java/com/dotcms/rest/api/v2/languages/LanguagesResource.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQyMjowODowM1rOGheH3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQyMjowODowM1rOGheH3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzc0OTcyNA==", "bodyText": "Issue found: Useless parentheses.", "url": "https://github.com/dotCMS/core/pull/18631#discussion_r437749724", "createdAt": "2020-06-09T22:08:03Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/main/java/com/dotcms/rest/api/v2/languages/LanguagesResource.java", "diffHunk": "@@ -207,17 +216,59 @@ public Response getAllMessages (\n             @Context final HttpServletResponse response,\n             @PathParam(\"language\") final String language){\n \n-        final long languageId = \"default\".equalsIgnoreCase(language) ? APILocator.getLanguageAPI().getDefaultLanguage().getId() : LanguageUtil.getLanguageId(language);\n-        final Language language1 = APILocator.getLanguageAPI().getLanguage(languageId);\n-        if(!UtilMethods.isSet(language1)){\n-            final String message = \"Language with Id or Code: \"+ language + \" does not exist\";\n-            Logger.error(this,message);\n-            throw new IllegalArgumentException(message);\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requiredAnonAccess(AnonymousAccess.READ)\n+                .requestAndResponse(request, response)\n+                .rejectWhenNoUser(false).init();\n+\n+        final User user = initData.getUser();\n+\n+        final Locale locale = \"default\".equalsIgnoreCase(language) ? APILocator.getLanguageAPI().getDefaultLanguage().asLocale() : ConversionUtils.toLocale(language);\n+        final Locale[] locales = LanguageUtil.getAvailableLocales();\n+        for(int i=0;i<locales.length;i++){\n+            final Locale currentLocale = locales[i];\n+            if(currentLocale.getLanguage().equalsIgnoreCase(locale.getLanguage())){\n+                if(UtilMethods.isSet(locale.getCountry())){\n+                    if(currentLocale.getCountry().equalsIgnoreCase(locale.getCountry())){\n+                        break;\n+                    }\n+                }else{\n+                    break;\n+                }\n+\n+            } else if(i == (locales.length-1)){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "365706af43792831ae8748e758be4ed637b393b7"}, "originalPosition": 88}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyNzA2MzU5OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/main/java/com/dotcms/rest/api/v2/languages/LanguagesResource.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQyMjowODowNFrOGheH7Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQyMjowODowNFrOGheH7Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzc0OTc0MQ==", "bodyText": "Issue found: Avoid unused imports such as 'java.util.stream.Stream'", "url": "https://github.com/dotCMS/core/pull/18631#discussion_r437749741", "createdAt": "2020-06-09T22:08:04Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/main/java/com/dotcms/rest/api/v2/languages/LanguagesResource.java", "diffHunk": "@@ -26,13 +30,18 @@\n import com.liferay.portal.language.LanguageUtil;\n import com.liferay.portal.model.User;\n import com.rainerhahnekamp.sneakythrow.Sneaky;\n+import io.vavr.control.Try;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n import java.util.List;\n import java.util.Locale;\n import java.util.Map;\n+import java.util.TreeMap;\n+import java.util.stream.Collectors;\n+import java.util.stream.Stream;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "365706af43792831ae8748e758be4ed637b393b7"}, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyNzA2MzY2OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/main/java/com/dotcms/rest/api/v2/languages/LanguagesResource.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQyMjowODowNVrOGheH9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxNzowMTozOVrOGh-RtA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzc0OTc0OQ==", "bodyText": "Issue found: Local variable 'langId' could be declared final", "url": "https://github.com/dotCMS/core/pull/18631#discussion_r437749749", "createdAt": "2020-06-09T22:08:05Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/main/java/com/dotcms/rest/api/v2/languages/LanguagesResource.java", "diffHunk": "@@ -207,17 +216,59 @@ public Response getAllMessages (\n             @Context final HttpServletResponse response,\n             @PathParam(\"language\") final String language){\n \n-        final long languageId = \"default\".equalsIgnoreCase(language) ? APILocator.getLanguageAPI().getDefaultLanguage().getId() : LanguageUtil.getLanguageId(language);\n-        final Language language1 = APILocator.getLanguageAPI().getLanguage(languageId);\n-        if(!UtilMethods.isSet(language1)){\n-            final String message = \"Language with Id or Code: \"+ language + \" does not exist\";\n-            Logger.error(this,message);\n-            throw new IllegalArgumentException(message);\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requiredAnonAccess(AnonymousAccess.READ)\n+                .requestAndResponse(request, response)\n+                .rejectWhenNoUser(false).init();\n+\n+        final User user = initData.getUser();\n+\n+        final Locale locale = \"default\".equalsIgnoreCase(language) ? APILocator.getLanguageAPI().getDefaultLanguage().asLocale() : ConversionUtils.toLocale(language);\n+        final Locale[] locales = LanguageUtil.getAvailableLocales();\n+        for(int i=0;i<locales.length;i++){\n+            final Locale currentLocale = locales[i];\n+            if(currentLocale.getLanguage().equalsIgnoreCase(locale.getLanguage())){\n+                if(UtilMethods.isSet(locale.getCountry())){\n+                    if(currentLocale.getCountry().equalsIgnoreCase(locale.getCountry())){\n+                        break;\n+                    }\n+                }else{\n+                    break;\n+                }\n+\n+            } else if(i == (locales.length-1)){\n+                final String message = \"Locale: \"+ locale + \" not found in Portal.properties file\";\n+                Logger.error(this,message);\n+                throw new DoesNotExistException(message);\n+            }\n+        }\n+\n+        //Messages in the properties file\n+        final Map mapPropertiesFile = LanguageUtil.getAllMessagesByLocale(locale);\n+\n+        final Map result = new TreeMap(mapPropertiesFile);\n+\n+        final Language language1 = APILocator.getLanguageAPI().getLanguage(locale.getLanguage(),locale.getCountry());\n+        if(UtilMethods.isSet(language1)) {\n+            //Language Keys\n+            final Map mapLanguageKeys = APILocator.getLanguageAPI()\n+                    .getLanguageKeys(locale.getLanguage()).stream().collect(\n+                            Collectors.toMap(LanguageKey::getKey, LanguageKey::getValue));\n+\n+            result.putAll(mapLanguageKeys);\n+\n+            //Language Variable\n+            long langId = language1.getId();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "365706af43792831ae8748e758be4ed637b393b7"}, "originalPosition": 110}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODI3NjUzMg==", "bodyText": "yeah and rename to languageId", "url": "https://github.com/dotCMS/core/pull/18631#discussion_r438276532", "createdAt": "2020-06-10T17:01:39Z", "author": {"login": "jdotcms"}, "path": "dotCMS/src/main/java/com/dotcms/rest/api/v2/languages/LanguagesResource.java", "diffHunk": "@@ -207,17 +216,59 @@ public Response getAllMessages (\n             @Context final HttpServletResponse response,\n             @PathParam(\"language\") final String language){\n \n-        final long languageId = \"default\".equalsIgnoreCase(language) ? APILocator.getLanguageAPI().getDefaultLanguage().getId() : LanguageUtil.getLanguageId(language);\n-        final Language language1 = APILocator.getLanguageAPI().getLanguage(languageId);\n-        if(!UtilMethods.isSet(language1)){\n-            final String message = \"Language with Id or Code: \"+ language + \" does not exist\";\n-            Logger.error(this,message);\n-            throw new IllegalArgumentException(message);\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requiredAnonAccess(AnonymousAccess.READ)\n+                .requestAndResponse(request, response)\n+                .rejectWhenNoUser(false).init();\n+\n+        final User user = initData.getUser();\n+\n+        final Locale locale = \"default\".equalsIgnoreCase(language) ? APILocator.getLanguageAPI().getDefaultLanguage().asLocale() : ConversionUtils.toLocale(language);\n+        final Locale[] locales = LanguageUtil.getAvailableLocales();\n+        for(int i=0;i<locales.length;i++){\n+            final Locale currentLocale = locales[i];\n+            if(currentLocale.getLanguage().equalsIgnoreCase(locale.getLanguage())){\n+                if(UtilMethods.isSet(locale.getCountry())){\n+                    if(currentLocale.getCountry().equalsIgnoreCase(locale.getCountry())){\n+                        break;\n+                    }\n+                }else{\n+                    break;\n+                }\n+\n+            } else if(i == (locales.length-1)){\n+                final String message = \"Locale: \"+ locale + \" not found in Portal.properties file\";\n+                Logger.error(this,message);\n+                throw new DoesNotExistException(message);\n+            }\n+        }\n+\n+        //Messages in the properties file\n+        final Map mapPropertiesFile = LanguageUtil.getAllMessagesByLocale(locale);\n+\n+        final Map result = new TreeMap(mapPropertiesFile);\n+\n+        final Language language1 = APILocator.getLanguageAPI().getLanguage(locale.getLanguage(),locale.getCountry());\n+        if(UtilMethods.isSet(language1)) {\n+            //Language Keys\n+            final Map mapLanguageKeys = APILocator.getLanguageAPI()\n+                    .getLanguageKeys(locale.getLanguage()).stream().collect(\n+                            Collectors.toMap(LanguageKey::getKey, LanguageKey::getValue));\n+\n+            result.putAll(mapLanguageKeys);\n+\n+            //Language Variable\n+            long langId = language1.getId();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzc0OTc0OQ=="}, "originalCommit": {"oid": "365706af43792831ae8748e758be4ed637b393b7"}, "originalPosition": 110}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyNzA2MzcxOnYy", "diffSide": "RIGHT", "path": "dotCMS/src/main/java/com/dotcms/rest/api/v2/languages/LanguagesResource.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQyMjowODowNlrOGheH_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQyMjowODowNlrOGheH_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzc0OTc1Nw==", "bodyText": "Issue found: Avoid declaring a variable if it is unreferenced before a possible exit point.", "url": "https://github.com/dotCMS/core/pull/18631#discussion_r437749757", "createdAt": "2020-06-09T22:08:06Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/main/java/com/dotcms/rest/api/v2/languages/LanguagesResource.java", "diffHunk": "@@ -207,17 +216,59 @@ public Response getAllMessages (\n             @Context final HttpServletResponse response,\n             @PathParam(\"language\") final String language){\n \n-        final long languageId = \"default\".equalsIgnoreCase(language) ? APILocator.getLanguageAPI().getDefaultLanguage().getId() : LanguageUtil.getLanguageId(language);\n-        final Language language1 = APILocator.getLanguageAPI().getLanguage(languageId);\n-        if(!UtilMethods.isSet(language1)){\n-            final String message = \"Language with Id or Code: \"+ language + \" does not exist\";\n-            Logger.error(this,message);\n-            throw new IllegalArgumentException(message);\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requiredAnonAccess(AnonymousAccess.READ)\n+                .requestAndResponse(request, response)\n+                .rejectWhenNoUser(false).init();\n+\n+        final User user = initData.getUser();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "365706af43792831ae8748e758be4ed637b393b7"}, "originalPosition": 73}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczMDMzMDQyOnYy", "diffSide": "RIGHT", "path": "dotCMS/src/main/java/com/dotcms/rest/api/v2/languages/LanguagesResource.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxNzowMToyN1rOGh-RPA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxNzowMToyN1rOGh-RPA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODI3NjQxMg==", "bodyText": "rename to something else such as localeLanguage or languageResolved", "url": "https://github.com/dotCMS/core/pull/18631#discussion_r438276412", "createdAt": "2020-06-10T17:01:27Z", "author": {"login": "jdotcms"}, "path": "dotCMS/src/main/java/com/dotcms/rest/api/v2/languages/LanguagesResource.java", "diffHunk": "@@ -207,17 +216,59 @@ public Response getAllMessages (\n             @Context final HttpServletResponse response,\n             @PathParam(\"language\") final String language){\n \n-        final long languageId = \"default\".equalsIgnoreCase(language) ? APILocator.getLanguageAPI().getDefaultLanguage().getId() : LanguageUtil.getLanguageId(language);\n-        final Language language1 = APILocator.getLanguageAPI().getLanguage(languageId);\n-        if(!UtilMethods.isSet(language1)){\n-            final String message = \"Language with Id or Code: \"+ language + \" does not exist\";\n-            Logger.error(this,message);\n-            throw new IllegalArgumentException(message);\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requiredAnonAccess(AnonymousAccess.READ)\n+                .requestAndResponse(request, response)\n+                .rejectWhenNoUser(false).init();\n+\n+        final User user = initData.getUser();\n+\n+        final Locale locale = \"default\".equalsIgnoreCase(language) ? APILocator.getLanguageAPI().getDefaultLanguage().asLocale() : ConversionUtils.toLocale(language);\n+        final Locale[] locales = LanguageUtil.getAvailableLocales();\n+        for(int i=0;i<locales.length;i++){\n+            final Locale currentLocale = locales[i];\n+            if(currentLocale.getLanguage().equalsIgnoreCase(locale.getLanguage())){\n+                if(UtilMethods.isSet(locale.getCountry())){\n+                    if(currentLocale.getCountry().equalsIgnoreCase(locale.getCountry())){\n+                        break;\n+                    }\n+                }else{\n+                    break;\n+                }\n+\n+            } else if(i == (locales.length-1)){\n+                final String message = \"Locale: \"+ locale + \" not found in Portal.properties file\";\n+                Logger.error(this,message);\n+                throw new DoesNotExistException(message);\n+            }\n+        }\n+\n+        //Messages in the properties file\n+        final Map mapPropertiesFile = LanguageUtil.getAllMessagesByLocale(locale);\n+\n+        final Map result = new TreeMap(mapPropertiesFile);\n+\n+        final Language language1 = APILocator.getLanguageAPI().getLanguage(locale.getLanguage(),locale.getCountry());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "365706af43792831ae8748e758be4ed637b393b7"}, "originalPosition": 100}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2143, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}