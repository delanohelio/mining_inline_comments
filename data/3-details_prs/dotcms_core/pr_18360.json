{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA4Nzk1MDY5", "number": 18360, "title": "Issue 18218 warnings", "bodyText": "If one single required secret is removed through the delete endpoint.\nThat basically leaves the secret in an invalid state so we're now levering such info into the JSON info presented to the user.\nSee #18218 for full description.", "createdAt": "2020-04-24T22:38:48Z", "url": "https://github.com/dotCMS/core/pull/18360", "merged": true, "mergeCommit": {"oid": "44fda47a71168a2a60fdf3ead1a2fa6557a63344"}, "closed": true, "closedAt": "2020-04-27T18:24:22Z", "author": {"login": "fabrizzio-dotCMS"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABca5SxEAH2gAyNDA4Nzk1MDY5OjQzYTJjNTYyNWUxZDRlNzJhNzcxZGQzNjg1MmY1OTZmOTM1Y2I0NDc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcbygZygH2gAyNDA4Nzk1MDY5OmExYzEyNTk1MTFjODJlYjBhMTc4OTYwNzcxMTQxNmIzZTQzMDBiYTY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "43a2c5625e1d4e72a771dd36852f596f935cb447", "author": {"user": {"login": "fabrizzio-dotCMS", "name": "Fabrizzio Araya"}}, "url": "https://github.com/dotCMS/core/commit/43a2c5625e1d4e72a771dd36852f596f935cb447", "committedDate": "2020-04-24T22:33:12Z", "message": "#18218 apps secret  warning checks"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAxMDIzMzA4", "url": "https://github.com/dotCMS/core/pull/18360#pullrequestreview-401023308", "createdAt": "2020-04-27T14:44:13Z", "commit": {"oid": "43a2c5625e1d4e72a771dd36852f596f935cb447"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QxNDo0NDoxM1rOGMm8Uw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QxNDo0NDoxM1rOGMm8Uw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTg3NDEzMQ==", "bodyText": "I think we can create a class to handle this 'Map<String, Map<String, List>>', it can do the code more readable, this class could have methods like\n\nMap<String, List> getXXX(String)\nor Even List getXXX(String, String)", "url": "https://github.com/dotCMS/core/pull/18360#discussion_r415874131", "createdAt": "2020-04-27T14:44:13Z", "author": {"login": "freddyucv"}, "path": "dotCMS/src/main/java/com/dotcms/rest/api/v1/apps/AppsHelper.java", "diffHunk": "@@ -95,16 +96,32 @@\n             appDescriptors = appDescriptors.stream().filter(appDescriptor -> appDescriptor.getName().matches(regexFilter)).collect(\n                     Collectors.toList());\n         }\n-        final Set<String> hostIdentifiers = appsAPI.appKeysByHost().keySet();\n+        final Set<String> siteIdentifiers = appsAPI.appKeysByHost().keySet();\n         for (final AppDescriptor appDescriptor : appDescriptors) {\n             final String appKey = appDescriptor.getKey();\n-            final long configurationsCount = appsAPI\n-                    .filterSitesForAppKey(appKey, hostIdentifiers, user).size();\n-            views.add(new AppView(appDescriptor, configurationsCount));\n+            final int configurationsCount = appsAPI.filterSitesForAppKey(appKey, siteIdentifiers, user).size();\n+            final int sitesWithWarning = computeWarningsBySite(appDescriptor, siteIdentifiers, user);\n+            views.add(new AppView(appDescriptor, configurationsCount, sitesWithWarning));\n         }\n         return views.stream().sorted(compareByCountAndName).collect(CollectionsUtils.toImmutableList());\n     }\n \n+    /**\n+     * Computes the number of warnings regardless of site under the given app-descriptor\n+     * @param appDescriptor\n+     * @param sitesWithConfigurations\n+     * @param user\n+     * @return sum or warnings for the given app-descriptor. Regardless of site.\n+     * @throws DotDataException\n+     * @throws DotSecurityException\n+     */\n+    private int computeWarningsBySite(final AppDescriptor appDescriptor,\n+            final Set<String> sitesWithConfigurations, final User user)\n+            throws DotDataException, DotSecurityException {\n+        final Map<String, Map<String, List<String>>> warningsBySite = appsAPI.computeWarningsBySite(appDescriptor, sitesWithConfigurations, user);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "43a2c5625e1d4e72a771dd36852f596f935cb447"}, "originalPosition": 38}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9180638cc11b8c72060fc19c026ac442c63b5811", "author": {"user": {"login": "fabrizzio-dotCMS", "name": "Fabrizzio Araya"}}, "url": "https://github.com/dotCMS/core/commit/9180638cc11b8c72060fc19c026ac442c63b5811", "committedDate": "2020-04-27T15:02:21Z", "message": "#18218 lang keys"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bc94f7769567c7b97eacb106f5ff5cd88bb79ee1", "author": {"user": {"login": "fabrizzio-dotCMS", "name": "Fabrizzio Araya"}}, "url": "https://github.com/dotCMS/core/commit/bc94f7769567c7b97eacb106f5ff5cd88bb79ee1", "committedDate": "2020-04-27T15:50:36Z", "message": "Merge branch 'apps-feature-branch' into issue-18218-warnings"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAxMTM4NTE5", "url": "https://github.com/dotCMS/core/pull/18360#pullrequestreview-401138519", "createdAt": "2020-04-27T16:48:30Z", "commit": {"oid": "bc94f7769567c7b97eacb106f5ff5cd88bb79ee1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a1c1259511c82eb0a1789607711416b3e4300ba6", "author": {"user": {"login": "fabrizzio-dotCMS", "name": "Fabrizzio Araya"}}, "url": "https://github.com/dotCMS/core/commit/a1c1259511c82eb0a1789607711416b3e4300ba6", "committedDate": "2020-04-27T17:12:41Z", "message": "#18218  warnings fix broken test"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1021, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}