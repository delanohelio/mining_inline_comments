{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA1MjU0ODk3", "number": 18321, "title": "Issue 18318 limit access to app", "bodyText": "", "createdAt": "2020-04-17T17:30:10Z", "url": "https://github.com/dotCMS/core/pull/18321", "merged": true, "mergeCommit": {"oid": "4118b82a0f3d21adf2236b6f45dab448b102a1cc"}, "closed": true, "closedAt": "2020-04-21T18:30:34Z", "author": {"login": "wezell"}, "timelineItems": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcYi4SVgH2gAyNDA1MjU0ODk3OjFjNThjNjc5YTJkODU0NTVkZGMyZjY3MDdhYmYyNjZmZWQ2MjllZmM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcZ20LHgFqTM5NzUwMjQ5Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1c58c679a2d85455ddc2f6707abf266fed629efc", "author": {"user": {"login": "wezell", "name": "Will Ezell"}}, "url": "https://github.com/dotCMS/core/commit/1c58c679a2d85455ddc2f6707abf266fed629efc", "committedDate": "2020-04-17T15:18:31Z", "message": "#18318 removing ServletContext from Velocity"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "243c639c1ec33f2f795fa17dfc872b4d0b580dd0", "author": {"user": {"login": "wezell", "name": "Will Ezell"}}, "url": "https://github.com/dotCMS/core/commit/243c639c1ec33f2f795fa17dfc872b4d0b580dd0", "committedDate": "2020-04-17T16:26:36Z", "message": "#18318 no application or server context"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2MTAzODY4", "url": "https://github.com/dotCMS/core/pull/18321#pullrequestreview-396103868", "createdAt": "2020-04-20T02:26:18Z", "commit": {"oid": "243c639c1ec33f2f795fa17dfc872b4d0b580dd0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "45f07f016dac37a72392abf8f58ba251a2e969f2", "author": {"user": {"login": "dsilvam", "name": "Daniel Silva"}}, "url": "https://github.com/dotCMS/core/commit/45f07f016dac37a72392abf8f58ba251a2e969f2", "committedDate": "2020-04-21T16:05:46Z", "message": "Merge branch 'master' of github.com:dotCMS/core into issue-18318-limit-access-to-app"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3NDc1NTY5", "url": "https://github.com/dotCMS/core/pull/18321#pullrequestreview-397475569", "createdAt": "2020-04-21T16:33:58Z", "commit": {"oid": "243c639c1ec33f2f795fa17dfc872b4d0b580dd0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3NTAyMjg0", "url": "https://github.com/dotCMS/core/pull/18321#pullrequestreview-397502284", "createdAt": "2020-04-21T17:05:48Z", "commit": {"oid": "45f07f016dac37a72392abf8f58ba251a2e969f2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzowNTo0OVrOGJO4Ng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzowNTo0OVrOGJO4Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjMzNDEzNA==", "bodyText": "Issue found: Local variable 'context' could be declared final", "url": "https://github.com/dotCMS/core/pull/18321#discussion_r412334134", "createdAt": "2020-04-21T17:05:49Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/VelocityUtilTest.java", "diffHunk": "@@ -157,5 +158,36 @@ public void test_unable_to_modify_userid_in_velocity_session() throws Exception{\n         assertTrue(request.getSession().getAttribute(WebKeys.USER_ID) ==null);\n     }\n     \n+    \n+    /**\n+     * https://github.com/dotCMS/core/issues/18318\n+     * \n+     * The servlet context is too dangerous to expose to velocity and allows for arbitrary \n+     * code execution\n+     * \n+     * @throws Exception\n+     */\n+    \n+    @Test\n+    public void test_servlet_context_is_not_available_in_velocity() throws Exception {\n+\n+        final HttpServletRequest request = new MockSessionRequest(\n+                        new MockAttributeRequest(new MockHttpRequest(\"localhost\", \"/\").request()).request()).request();\n+\n+        final HttpServletResponse response = new MockHttpResponse().response();\n+\n+\n+        ChainedContext context = (ChainedContext) VelocityUtil.getWebContext(request, response);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "45f07f016dac37a72392abf8f58ba251a2e969f2"}, "originalPosition": 31}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3NTAyMzEy", "url": "https://github.com/dotCMS/core/pull/18321#pullrequestreview-397502312", "createdAt": "2020-04-21T17:05:50Z", "commit": {"oid": "45f07f016dac37a72392abf8f58ba251a2e969f2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzowNTo1MFrOGJO4SA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzowNTo1MFrOGJO4SA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjMzNDE1Mg==", "bodyText": "Issue found: Useless parentheses.", "url": "https://github.com/dotCMS/core/pull/18321#discussion_r412334152", "createdAt": "2020-04-21T17:05:50Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/VelocityUtilTest.java", "diffHunk": "@@ -157,5 +158,36 @@ public void test_unable_to_modify_userid_in_velocity_session() throws Exception{\n         assertTrue(request.getSession().getAttribute(WebKeys.USER_ID) ==null);\n     }\n     \n+    \n+    /**\n+     * https://github.com/dotCMS/core/issues/18318\n+     * \n+     * The servlet context is too dangerous to expose to velocity and allows for arbitrary \n+     * code execution\n+     * \n+     * @throws Exception\n+     */\n+    \n+    @Test\n+    public void test_servlet_context_is_not_available_in_velocity() throws Exception {\n+\n+        final HttpServletRequest request = new MockSessionRequest(\n+                        new MockAttributeRequest(new MockHttpRequest(\"localhost\", \"/\").request()).request()).request();\n+\n+        final HttpServletResponse response = new MockHttpResponse().response();\n+\n+\n+        ChainedContext context = (ChainedContext) VelocityUtil.getWebContext(request, response);\n+\n+        assert (context.getServletContext() == null);\n+        assert (context.get(\"application\") == null);\n+        assert (context.getRequest().getServletContext() == null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "45f07f016dac37a72392abf8f58ba251a2e969f2"}, "originalPosition": 35}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3NTAyMzI0", "url": "https://github.com/dotCMS/core/pull/18321#pullrequestreview-397502324", "createdAt": "2020-04-21T17:05:51Z", "commit": {"oid": "45f07f016dac37a72392abf8f58ba251a2e969f2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzowNTo1MVrOGJO4UQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzowNTo1MVrOGJO4UQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjMzNDE2MQ==", "bodyText": "Issue found: Useless parentheses.", "url": "https://github.com/dotCMS/core/pull/18321#discussion_r412334161", "createdAt": "2020-04-21T17:05:51Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/main/java/org/apache/velocity/tools/view/context/ChainedContext.java", "diffHunk": "@@ -87,31 +86,34 @@ public ChainedContext(Context ctx,\n                           HttpServletResponse response,\r\n                           ServletContext application)\r\n     {\r\n-        this(ctx, null, request, response, application);\r\n+        this(ctx, null, request, response);\r\n     }\r\n \r\n \r\n     public ChainedContext(VelocityEngine velocity,\r\n                           HttpServletRequest request,\r\n-                          HttpServletResponse response,\r\n-                          ServletContext application)\r\n+                          HttpServletResponse response)\r\n     {\r\n-        this(null, velocity, request, response, application);\r\n+        this(null, velocity, request, response );\r\n+    }\r\n+    public ChainedContext(VelocityEngine velocity,\r\n+                    HttpServletRequest request,\r\n+                    HttpServletResponse response,ServletContext application)\r\n+    {\r\n+        this(null, velocity, request, response );\r\n     }\r\n-    \r\n     public ChainedContext(Context ctx,\r\n                           VelocityEngine velocity,\r\n                           HttpServletRequest request,\r\n-                          HttpServletResponse response,\r\n-                          ServletContext application)\r\n+                          HttpServletResponse response)\r\n     {\r\n         super(null, ctx);\r\n \r\n         this.velocity = velocity;\r\n-        this.request = request;\r\n+        this.request = (request instanceof VelocityRequestWrapper) ? request : new VelocityRequestWrapper(request);\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "45f07f016dac37a72392abf8f58ba251a2e969f2"}, "originalPosition": 53}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3NTAyMzQy", "url": "https://github.com/dotCMS/core/pull/18321#pullrequestreview-397502342", "createdAt": "2020-04-21T17:05:52Z", "commit": {"oid": "45f07f016dac37a72392abf8f58ba251a2e969f2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzowNTo1MlrOGJO4Xg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzowNTo1MlrOGJO4Xg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjMzNDE3NA==", "bodyText": "Issue found: Parameter 'response' is not assigned and could be declared final", "url": "https://github.com/dotCMS/core/pull/18321#discussion_r412334174", "createdAt": "2020-04-21T17:05:52Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/main/java/org/apache/velocity/tools/view/context/ChainedContext.java", "diffHunk": "@@ -87,31 +86,34 @@ public ChainedContext(Context ctx,\n                           HttpServletResponse response,\r\n                           ServletContext application)\r\n     {\r\n-        this(ctx, null, request, response, application);\r\n+        this(ctx, null, request, response);\r\n     }\r\n \r\n \r\n     public ChainedContext(VelocityEngine velocity,\r\n                           HttpServletRequest request,\r\n-                          HttpServletResponse response,\r\n-                          ServletContext application)\r\n+                          HttpServletResponse response)\r\n     {\r\n-        this(null, velocity, request, response, application);\r\n+        this(null, velocity, request, response );\r\n+    }\r\n+    public ChainedContext(VelocityEngine velocity,\r\n+                    HttpServletRequest request,\r\n+                    HttpServletResponse response,ServletContext application)\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "45f07f016dac37a72392abf8f58ba251a2e969f2"}, "originalPosition": 37}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3NTAyMzU5", "url": "https://github.com/dotCMS/core/pull/18321#pullrequestreview-397502359", "createdAt": "2020-04-21T17:05:53Z", "commit": {"oid": "45f07f016dac37a72392abf8f58ba251a2e969f2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzowNTo1M1rOGJO4ZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzowNTo1M1rOGJO4ZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjMzNDE4MQ==", "bodyText": "Issue found: Useless parentheses.", "url": "https://github.com/dotCMS/core/pull/18321#discussion_r412334181", "createdAt": "2020-04-21T17:05:53Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/VelocityUtilTest.java", "diffHunk": "@@ -157,5 +158,36 @@ public void test_unable_to_modify_userid_in_velocity_session() throws Exception{\n         assertTrue(request.getSession().getAttribute(WebKeys.USER_ID) ==null);\n     }\n     \n+    \n+    /**\n+     * https://github.com/dotCMS/core/issues/18318\n+     * \n+     * The servlet context is too dangerous to expose to velocity and allows for arbitrary \n+     * code execution\n+     * \n+     * @throws Exception\n+     */\n+    \n+    @Test\n+    public void test_servlet_context_is_not_available_in_velocity() throws Exception {\n+\n+        final HttpServletRequest request = new MockSessionRequest(\n+                        new MockAttributeRequest(new MockHttpRequest(\"localhost\", \"/\").request()).request()).request();\n+\n+        final HttpServletResponse response = new MockHttpResponse().response();\n+\n+\n+        ChainedContext context = (ChainedContext) VelocityUtil.getWebContext(request, response);\n+\n+        assert (context.getServletContext() == null);\n+        assert (context.get(\"application\") == null);\n+        assert (context.getRequest().getServletContext() == null);\n+        assert (context.getAttribute(\"application\") == null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "45f07f016dac37a72392abf8f58ba251a2e969f2"}, "originalPosition": 36}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3NTAyMzcx", "url": "https://github.com/dotCMS/core/pull/18321#pullrequestreview-397502371", "createdAt": "2020-04-21T17:05:54Z", "commit": {"oid": "45f07f016dac37a72392abf8f58ba251a2e969f2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzowNTo1NFrOGJO4bw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzowNTo1NFrOGJO4bw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjMzNDE5MQ==", "bodyText": "Issue found: Parameter 'obj' is not assigned and could be declared final", "url": "https://github.com/dotCMS/core/pull/18321#discussion_r412334191", "createdAt": "2020-04-21T17:05:54Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/main/java/com/dotcms/rendering/velocity/viewtools/VelocitySessionWrapper.java", "diffHunk": "@@ -112,5 +112,35 @@ public void setMaxInactiveInterval(int arg0) {\n \n     }\n \n+    @Override\n+    public int hashCode() {\n+        final int prime = 31;\n+        int result = 1;\n+        result = prime * result + ((session == null) ? 0 : session.hashCode());\n+        return result;\n+    }\n+\n+    @Override\n+    public boolean equals(Object obj) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "45f07f016dac37a72392abf8f58ba251a2e969f2"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3NTAyMzgw", "url": "https://github.com/dotCMS/core/pull/18321#pullrequestreview-397502380", "createdAt": "2020-04-21T17:05:55Z", "commit": {"oid": "45f07f016dac37a72392abf8f58ba251a2e969f2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzowNTo1NVrOGJO4dQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzowNTo1NVrOGJO4dQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjMzNDE5Nw==", "bodyText": "Issue found: Local variable 'other' could be declared final", "url": "https://github.com/dotCMS/core/pull/18321#discussion_r412334197", "createdAt": "2020-04-21T17:05:55Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/main/java/com/dotcms/rendering/velocity/viewtools/VelocitySessionWrapper.java", "diffHunk": "@@ -112,5 +112,35 @@ public void setMaxInactiveInterval(int arg0) {\n \n     }\n \n+    @Override\n+    public int hashCode() {\n+        final int prime = 31;\n+        int result = 1;\n+        result = prime * result + ((session == null) ? 0 : session.hashCode());\n+        return result;\n+    }\n+\n+    @Override\n+    public boolean equals(Object obj) {\n+        if (this == obj)\n+            return true;\n+        if (obj == null)\n+            return false;\n+        if (getClass() != obj.getClass())\n+            return false;\n+        VelocitySessionWrapper other = (VelocitySessionWrapper) obj;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "45f07f016dac37a72392abf8f58ba251a2e969f2"}, "originalPosition": 20}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3NTAyMzkx", "url": "https://github.com/dotCMS/core/pull/18321#pullrequestreview-397502391", "createdAt": "2020-04-21T17:05:56Z", "commit": {"oid": "45f07f016dac37a72392abf8f58ba251a2e969f2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzowNTo1NlrOGJO4ig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzowNTo1NlrOGJO4ig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjMzNDIxOA==", "bodyText": "Issue found: Useless parentheses.", "url": "https://github.com/dotCMS/core/pull/18321#discussion_r412334218", "createdAt": "2020-04-21T17:05:56Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/VelocityUtilTest.java", "diffHunk": "@@ -157,5 +158,36 @@ public void test_unable_to_modify_userid_in_velocity_session() throws Exception{\n         assertTrue(request.getSession().getAttribute(WebKeys.USER_ID) ==null);\n     }\n     \n+    \n+    /**\n+     * https://github.com/dotCMS/core/issues/18318\n+     * \n+     * The servlet context is too dangerous to expose to velocity and allows for arbitrary \n+     * code execution\n+     * \n+     * @throws Exception\n+     */\n+    \n+    @Test\n+    public void test_servlet_context_is_not_available_in_velocity() throws Exception {\n+\n+        final HttpServletRequest request = new MockSessionRequest(\n+                        new MockAttributeRequest(new MockHttpRequest(\"localhost\", \"/\").request()).request()).request();\n+\n+        final HttpServletResponse response = new MockHttpResponse().response();\n+\n+\n+        ChainedContext context = (ChainedContext) VelocityUtil.getWebContext(request, response);\n+\n+        assert (context.getServletContext() == null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "45f07f016dac37a72392abf8f58ba251a2e969f2"}, "originalPosition": 33}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3NTAyNDEz", "url": "https://github.com/dotCMS/core/pull/18321#pullrequestreview-397502413", "createdAt": "2020-04-21T17:05:57Z", "commit": {"oid": "45f07f016dac37a72392abf8f58ba251a2e969f2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzowNTo1N1rOGJO4og==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzowNTo1N1rOGJO4og==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjMzNDI0Mg==", "bodyText": "Issue found: This statement should have braces", "url": "https://github.com/dotCMS/core/pull/18321#discussion_r412334242", "createdAt": "2020-04-21T17:05:57Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/main/java/com/dotcms/rendering/velocity/viewtools/VelocitySessionWrapper.java", "diffHunk": "@@ -112,5 +112,35 @@ public void setMaxInactiveInterval(int arg0) {\n \n     }\n \n+    @Override\n+    public int hashCode() {\n+        final int prime = 31;\n+        int result = 1;\n+        result = prime * result + ((session == null) ? 0 : session.hashCode());\n+        return result;\n+    }\n+\n+    @Override\n+    public boolean equals(Object obj) {\n+        if (this == obj)\n+            return true;\n+        if (obj == null)\n+            return false;\n+        if (getClass() != obj.getClass())\n+            return false;\n+        VelocitySessionWrapper other = (VelocitySessionWrapper) obj;\n+        if (session == null) {\n+            if (other.session != null)\n+                return false;\n+        } else if (!session.equals(other.session))\n+            return false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "45f07f016dac37a72392abf8f58ba251a2e969f2"}, "originalPosition": 25}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3NTAyNDIy", "url": "https://github.com/dotCMS/core/pull/18321#pullrequestreview-397502422", "createdAt": "2020-04-21T17:05:58Z", "commit": {"oid": "45f07f016dac37a72392abf8f58ba251a2e969f2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzowNTo1OFrOGJO4qg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzowNTo1OFrOGJO4qg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjMzNDI1MA==", "bodyText": "Issue found: Parameter 'response' is not assigned and could be declared final", "url": "https://github.com/dotCMS/core/pull/18321#discussion_r412334250", "createdAt": "2020-04-21T17:05:58Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/main/java/org/apache/velocity/tools/view/context/ChainedContext.java", "diffHunk": "@@ -87,31 +86,34 @@ public ChainedContext(Context ctx,\n                           HttpServletResponse response,\r\n                           ServletContext application)\r\n     {\r\n-        this(ctx, null, request, response, application);\r\n+        this(ctx, null, request, response);\r\n     }\r\n \r\n \r\n     public ChainedContext(VelocityEngine velocity,\r\n                           HttpServletRequest request,\r\n-                          HttpServletResponse response,\r\n-                          ServletContext application)\r\n+                          HttpServletResponse response)\r\n     {\r\n-        this(null, velocity, request, response, application);\r\n+        this(null, velocity, request, response );\r\n+    }\r\n+    public ChainedContext(VelocityEngine velocity,\r\n+                    HttpServletRequest request,\r\n+                    HttpServletResponse response,ServletContext application)\r\n+    {\r\n+        this(null, velocity, request, response );\r\n     }\r\n-    \r\n     public ChainedContext(Context ctx,\r\n                           VelocityEngine velocity,\r\n                           HttpServletRequest request,\r\n-                          HttpServletResponse response,\r\n-                          ServletContext application)\r\n+                          HttpServletResponse response)\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "45f07f016dac37a72392abf8f58ba251a2e969f2"}, "originalPosition": 47}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3NTAyNDM5", "url": "https://github.com/dotCMS/core/pull/18321#pullrequestreview-397502439", "createdAt": "2020-04-21T17:05:59Z", "commit": {"oid": "45f07f016dac37a72392abf8f58ba251a2e969f2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzowNTo1OVrOGJO4vA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzowNTo1OVrOGJO4vA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjMzNDI2OA==", "bodyText": "Issue found: This statement should have braces", "url": "https://github.com/dotCMS/core/pull/18321#discussion_r412334268", "createdAt": "2020-04-21T17:05:59Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/main/java/com/dotcms/rendering/velocity/viewtools/VelocitySessionWrapper.java", "diffHunk": "@@ -112,5 +112,35 @@ public void setMaxInactiveInterval(int arg0) {\n \n     }\n \n+    @Override\n+    public int hashCode() {\n+        final int prime = 31;\n+        int result = 1;\n+        result = prime * result + ((session == null) ? 0 : session.hashCode());\n+        return result;\n+    }\n+\n+    @Override\n+    public boolean equals(Object obj) {\n+        if (this == obj)\n+            return true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "45f07f016dac37a72392abf8f58ba251a2e969f2"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3NTAyNDQ4", "url": "https://github.com/dotCMS/core/pull/18321#pullrequestreview-397502448", "createdAt": "2020-04-21T17:06:00Z", "commit": {"oid": "45f07f016dac37a72392abf8f58ba251a2e969f2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzowNjowMFrOGJO40A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzowNjowMFrOGJO40A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjMzNDI4OA==", "bodyText": "Issue found: Useless parentheses.", "url": "https://github.com/dotCMS/core/pull/18321#discussion_r412334288", "createdAt": "2020-04-21T17:06:00Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/VelocityUtilTest.java", "diffHunk": "@@ -157,5 +158,36 @@ public void test_unable_to_modify_userid_in_velocity_session() throws Exception{\n         assertTrue(request.getSession().getAttribute(WebKeys.USER_ID) ==null);\n     }\n     \n+    \n+    /**\n+     * https://github.com/dotCMS/core/issues/18318\n+     * \n+     * The servlet context is too dangerous to expose to velocity and allows for arbitrary \n+     * code execution\n+     * \n+     * @throws Exception\n+     */\n+    \n+    @Test\n+    public void test_servlet_context_is_not_available_in_velocity() throws Exception {\n+\n+        final HttpServletRequest request = new MockSessionRequest(\n+                        new MockAttributeRequest(new MockHttpRequest(\"localhost\", \"/\").request()).request()).request();\n+\n+        final HttpServletResponse response = new MockHttpResponse().response();\n+\n+\n+        ChainedContext context = (ChainedContext) VelocityUtil.getWebContext(request, response);\n+\n+        assert (context.getServletContext() == null);\n+        assert (context.get(\"application\") == null);\n+        assert (context.getRequest().getServletContext() == null);\n+        assert (context.getAttribute(\"application\") == null);\n+        assert (context.getVelocityContext().get(\"application\") == null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "45f07f016dac37a72392abf8f58ba251a2e969f2"}, "originalPosition": 37}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3NTAyNDY2", "url": "https://github.com/dotCMS/core/pull/18321#pullrequestreview-397502466", "createdAt": "2020-04-21T17:06:00Z", "commit": {"oid": "45f07f016dac37a72392abf8f58ba251a2e969f2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzowNjowMVrOGJO43A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzowNjowMVrOGJO43A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjMzNDMwMA==", "bodyText": "Issue found: JUnit tests should include assert() or fail()", "url": "https://github.com/dotCMS/core/pull/18321#discussion_r412334300", "createdAt": "2020-04-21T17:06:01Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/VelocityUtilTest.java", "diffHunk": "@@ -157,5 +158,36 @@ public void test_unable_to_modify_userid_in_velocity_session() throws Exception{\n         assertTrue(request.getSession().getAttribute(WebKeys.USER_ID) ==null);\n     }\n     \n+    \n+    /**\n+     * https://github.com/dotCMS/core/issues/18318\n+     * \n+     * The servlet context is too dangerous to expose to velocity and allows for arbitrary \n+     * code execution\n+     * \n+     * @throws Exception\n+     */\n+    \n+    @Test\n+    public void test_servlet_context_is_not_available_in_velocity() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "45f07f016dac37a72392abf8f58ba251a2e969f2"}, "originalPosition": 23}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3NTAyNDc5", "url": "https://github.com/dotCMS/core/pull/18321#pullrequestreview-397502479", "createdAt": "2020-04-21T17:06:02Z", "commit": {"oid": "45f07f016dac37a72392abf8f58ba251a2e969f2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzowNjowMlrOGJO46A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzowNjowMlrOGJO46A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjMzNDMxMg==", "bodyText": "Issue found: Avoid unused constructor parameters such as 'application'.", "url": "https://github.com/dotCMS/core/pull/18321#discussion_r412334312", "createdAt": "2020-04-21T17:06:02Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/main/java/org/apache/velocity/tools/view/context/ChainedContext.java", "diffHunk": "@@ -87,31 +86,34 @@ public ChainedContext(Context ctx,\n                           HttpServletResponse response,\r\n                           ServletContext application)\r\n     {\r\n-        this(ctx, null, request, response, application);\r\n+        this(ctx, null, request, response);\r\n     }\r\n \r\n \r\n     public ChainedContext(VelocityEngine velocity,\r\n                           HttpServletRequest request,\r\n-                          HttpServletResponse response,\r\n-                          ServletContext application)\r\n+                          HttpServletResponse response)\r\n     {\r\n-        this(null, velocity, request, response, application);\r\n+        this(null, velocity, request, response );\r\n+    }\r\n+    public ChainedContext(VelocityEngine velocity,\r\n+                    HttpServletRequest request,\r\n+                    HttpServletResponse response,ServletContext application)\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "45f07f016dac37a72392abf8f58ba251a2e969f2"}, "originalPosition": 37}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3NTAyNDk3", "url": "https://github.com/dotCMS/core/pull/18321#pullrequestreview-397502497", "createdAt": "2020-04-21T17:06:02Z", "commit": {"oid": "45f07f016dac37a72392abf8f58ba251a2e969f2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzowNjowMlrOGJO4-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxNzowNjowMlrOGJO4-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjMzNDMyOQ==", "bodyText": "Issue found: Useless parentheses.", "url": "https://github.com/dotCMS/core/pull/18321#discussion_r412334329", "createdAt": "2020-04-21T17:06:02Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/VelocityUtilTest.java", "diffHunk": "@@ -157,5 +158,36 @@ public void test_unable_to_modify_userid_in_velocity_session() throws Exception{\n         assertTrue(request.getSession().getAttribute(WebKeys.USER_ID) ==null);\n     }\n     \n+    \n+    /**\n+     * https://github.com/dotCMS/core/issues/18318\n+     * \n+     * The servlet context is too dangerous to expose to velocity and allows for arbitrary \n+     * code execution\n+     * \n+     * @throws Exception\n+     */\n+    \n+    @Test\n+    public void test_servlet_context_is_not_available_in_velocity() throws Exception {\n+\n+        final HttpServletRequest request = new MockSessionRequest(\n+                        new MockAttributeRequest(new MockHttpRequest(\"localhost\", \"/\").request()).request()).request();\n+\n+        final HttpServletResponse response = new MockHttpResponse().response();\n+\n+\n+        ChainedContext context = (ChainedContext) VelocityUtil.getWebContext(request, response);\n+\n+        assert (context.getServletContext() == null);\n+        assert (context.get(\"application\") == null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "45f07f016dac37a72392abf8f58ba251a2e969f2"}, "originalPosition": 34}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 995, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}