{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY5NjcwMTIz", "number": 19122, "title": "Issue 18780 container error using templates from different sites", "bodyText": "Always save absolute path to drawed template\nWhen copy a site change the path from the original site to the new site as long as the copy containers option is checked\nUpdate all the relative path to absolute in advanced template with a update task", "createdAt": "2020-08-18T18:38:30Z", "url": "https://github.com/dotCMS/core/pull/19122", "merged": true, "mergeCommit": {"oid": "f4af01244b1a6b358190e153d958aa278524fe84"}, "closed": true, "closedAt": "2020-09-01T19:59:24Z", "author": {"login": "freddyucv"}, "timelineItems": {"totalCount": 32, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc9iw41AH2gAyNDY5NjcwMTIzOmViYjc5YWU3MDlkYTUxYzY2NzJjODE2YjIwM2QwOGMwNTY1OWFkNmI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdEtAgmgFqTQ4MDA3MTk0Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ebb79ae709da51c6672c816b203d08c05659ad6b", "author": {"user": {"login": "freddyucv", "name": "Freddy Rodriguez"}}, "url": "https://github.com/dotCMS/core/commit/ebb79ae709da51c6672c816b203d08c05659ad6b", "committedDate": "2020-08-10T14:05:38Z", "message": "#18780 Using absolute path to file container allways"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d6af1505810adcc7dc9552b29c1b07d452595eb7", "author": {"user": {"login": "freddyucv", "name": "Freddy Rodriguez"}}, "url": "https://github.com/dotCMS/core/commit/d6af1505810adcc7dc9552b29c1b07d452595eb7", "committedDate": "2020-08-10T14:37:20Z", "message": "Merge remote-tracking branch 'origin/master' into issue_18780_Container_error_using_templates_from_different_sites"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "754b5ee095ddb38a0ee61855446b0f1f62085ed3", "author": {"user": {"login": "freddyucv", "name": "Freddy Rodriguez"}}, "url": "https://github.com/dotCMS/core/commit/754b5ee095ddb38a0ee61855446b0f1f62085ed3", "committedDate": "2020-08-12T17:05:15Z", "message": "#18780 refactoring"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a7c2569b07d9eb696dedfa3cb67275a929b49182", "author": {"user": {"login": "freddyucv", "name": "Freddy Rodriguez"}}, "url": "https://github.com/dotCMS/core/commit/a7c2569b07d9eb696dedfa3cb67275a929b49182", "committedDate": "2020-08-18T18:35:55Z", "message": "resolving relative path"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5179ccf302016d69716c05c1bf114b60227337ba", "author": {"user": {"login": "freddyucv", "name": "Freddy Rodriguez"}}, "url": "https://github.com/dotCMS/core/commit/5179ccf302016d69716c05c1bf114b60227337ba", "committedDate": "2020-08-18T18:41:01Z", "message": "merge"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aea6e4413ca63922edc9854e396ea39fa453b87e", "author": {"user": {"login": "freddyucv", "name": "Freddy Rodriguez"}}, "url": "https://github.com/dotCMS/core/commit/aea6e4413ca63922edc9854e396ea39fa453b87e", "committedDate": "2020-08-24T19:32:39Z", "message": "#18780 Refactoring and fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2668c671ae267e820314e53ae2bc436d142ee87e", "author": {"user": {"login": "freddyucv", "name": "Freddy Rodriguez"}}, "url": "https://github.com/dotCMS/core/commit/2668c671ae267e820314e53ae2bc436d142ee87e", "committedDate": "2020-08-25T15:12:57Z", "message": "#18780 testing/refactoring"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e02441e9d9d5ac0695449c7b4fa5bcfccd2c6781", "author": {"user": {"login": "freddyucv", "name": "Freddy Rodriguez"}}, "url": "https://github.com/dotCMS/core/commit/e02441e9d9d5ac0695449c7b4fa5bcfccd2c6781", "committedDate": "2020-08-25T17:11:36Z", "message": "#18780 refactoring"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "403fcb4a98fb6e95603868e5f1e135e13b540c3d", "author": {"user": {"login": "freddyucv", "name": "Freddy Rodriguez"}}, "url": "https://github.com/dotCMS/core/commit/403fcb4a98fb6e95603868e5f1e135e13b540c3d", "committedDate": "2020-08-25T18:24:21Z", "message": "#18780 FIxing Test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc0NzUyMTk0", "url": "https://github.com/dotCMS/core/pull/19122#pullrequestreview-474752194", "createdAt": "2020-08-25T18:38:23Z", "commit": {"oid": "2668c671ae267e820314e53ae2bc436d142ee87e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxODozODoyNFrOHGk7mw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxODozODoyNFrOHGk7mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjY1ODU4Nw==", "bodyText": "remove", "url": "https://github.com/dotCMS/core/pull/19122#discussion_r476658587", "createdAt": "2020-08-25T18:38:24Z", "author": {"login": "dsilvam"}, "path": "dotCMS/src/main/java/com/dotmarketing/portlets/containers/ajax/ContainerAjaxDrawedTemplate.java", "diffHunk": "@@ -89,7 +90,10 @@\n                 contMap.put(\"source\", container.getSource().toString());\n                 if (container instanceof FileAssetContainer) {\n \n-                    contMap.put(\"path\", FileAssetContainer.class.cast(container).getPath());\n+                    contMap.put(\"path\",\n+                            FileAssetContainerUtil.getInstance()\n+                                    .getFullPath(FileAssetContainer.class.cast(container))\n+                    );\n                 }\n \n //                StringBuffer containerCode = new StringBuffer( cont.getCode() );", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2668c671ae267e820314e53ae2bc436d142ee87e"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc0NzUzMDAy", "url": "https://github.com/dotCMS/core/pull/19122#pullrequestreview-474753002", "createdAt": "2020-08-25T18:39:33Z", "commit": {"oid": "2668c671ae267e820314e53ae2bc436d142ee87e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxODo0MDowMVrOHGk_MA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxODo0MDowMVrOHGk_MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjY1OTUwNA==", "bodyText": "javadoc", "url": "https://github.com/dotCMS/core/pull/19122#discussion_r476659504", "createdAt": "2020-08-25T18:40:01Z", "author": {"login": "dsilvam"}, "path": "dotCMS/src/main/java/com/dotmarketing/portlets/containers/business/ContainerFactory.java", "diffHunk": "@@ -67,6 +67,9 @@\n \t */\r\n \tList<Container> findContainers(User user, boolean includeArchived, Map<String,Object> params, String hostId, String inode, String identifier, String parent, int offset, int limit, String orderBy) throws DotSecurityException, DotDataException;\r\n \r\n+\tContainer getContainerByFolderPath(String path, Host host, User user, boolean live,\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2668c671ae267e820314e53ae2bc436d142ee87e"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc0NzU0Nzk5", "url": "https://github.com/dotCMS/core/pull/19122#pullrequestreview-474754799", "createdAt": "2020-08-25T18:42:00Z", "commit": {"oid": "2668c671ae267e820314e53ae2bc436d142ee87e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxODo0MjowMFrOHGlDnA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxODo0MjowMFrOHGlDnA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjY2MDYzNg==", "bodyText": "remove", "url": "https://github.com/dotCMS/core/pull/19122#discussion_r476660636", "createdAt": "2020-08-25T18:42:00Z", "author": {"login": "dsilvam"}, "path": "dotCMS/src/main/java/com/dotmarketing/portlets/templates/design/bean/TemplateLayout.java", "diffHunk": "@@ -182,11 +186,70 @@ public String toString() {\n         }\n     }\n \n-    public boolean existsContainer(final String identifier, final String uuid){\n-        return this.getContainers().stream()\n-                .anyMatch(containerUUID ->\n-                        containerUUID.getIdentifier().equals(identifier) && isTheSameUUID(containerUUID.getUUID(), uuid)\n-                );\n+    public boolean existsContainer(final Container container, final String uuid){\n+        final FileAssetContainerUtil instance = FileAssetContainerUtil.getInstance();\n+        if (instance.isFileAssetContainer(container)) {\n+            final FileAssetContainer fileAssetContainer = (FileAssetContainer) container;\n+            final String containerPath = fileAssetContainer.getPath();\n+\n+            return this.getContainers().stream()\n+                    .anyMatch((ContainerUUID containerUUID) -> {\n+                        final String relativePath = instance.isFullPath(containerUUID.getIdentifier()) ?\n+                                instance.getRelativePath(containerUUID.getIdentifier()) :\n+                                containerUUID.getIdentifier();\n+\n+                        return relativePath.equals(containerPath)\n+                                    && isTheSameUUID(containerUUID.getUUID(), uuid);\n+                    }\n+                    );\n+        } else {\n+            return this.getContainers().stream()\n+                    .anyMatch(containerUUID ->\n+                            containerUUID.getIdentifier().equals(container.getIdentifier())\n+                                    && isTheSameUUID(containerUUID.getUUID(), uuid)\n+                    );\n+        }\n+\n+\n+    }\n+\n+    @JsonIgnore\n+    @NotNull", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2668c671ae267e820314e53ae2bc436d142ee87e"}, "originalPosition": 61}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc0NzU1MDg0", "url": "https://github.com/dotCMS/core/pull/19122#pullrequestreview-474755084", "createdAt": "2020-08-25T18:42:23Z", "commit": {"oid": "2668c671ae267e820314e53ae2bc436d142ee87e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxODo0MjoyM1rOHGlEfA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxODo0MjoyM1rOHGlEfA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjY2MDg2MA==", "bodyText": "javadoc", "url": "https://github.com/dotCMS/core/pull/19122#discussion_r476660860", "createdAt": "2020-08-25T18:42:23Z", "author": {"login": "dsilvam"}, "path": "dotCMS/src/main/java/com/dotmarketing/portlets/templates/design/bean/TemplateLayout.java", "diffHunk": "@@ -182,11 +186,70 @@ public String toString() {\n         }\n     }\n \n-    public boolean existsContainer(final String identifier, final String uuid){\n-        return this.getContainers().stream()\n-                .anyMatch(containerUUID ->\n-                        containerUUID.getIdentifier().equals(identifier) && isTheSameUUID(containerUUID.getUUID(), uuid)\n-                );\n+    public boolean existsContainer(final Container container, final String uuid){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2668c671ae267e820314e53ae2bc436d142ee87e"}, "originalPosition": 33}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc0NzU2Mjk2", "url": "https://github.com/dotCMS/core/pull/19122#pullrequestreview-474756296", "createdAt": "2020-08-25T18:44:09Z", "commit": {"oid": "2668c671ae267e820314e53ae2bc436d142ee87e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxODo0NDowOVrOHGlIdg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxODo0NDowOVrOHGlIdg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjY2MTg3OA==", "bodyText": "put at the end and naming according to the last task", "url": "https://github.com/dotCMS/core/pull/19122#discussion_r476661878", "createdAt": "2020-08-25T18:44:09Z", "author": {"login": "dsilvam"}, "path": "dotCMS/src/main/java/com/dotmarketing/util/TaskLocatorUtil.java", "diffHunk": "@@ -282,6 +282,7 @@ public static void removeFixTask(Class<?> clazz){\n         .add(Task05300UpdateIndexNameLength.class)\n         .add(Task05305AddPushPublishFilterColumn.class)\n \t\t.add(Task05350AddDotSaltClusterColumn.class)\n+\t\t.add(Task05370ChangeContainerPathToAbsolute.class)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2668c671ae267e820314e53ae2bc436d142ee87e"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fbaded83a3eb9b46bb0c29d64e15db5ac60a772c", "author": {"user": {"login": "freddyucv", "name": "Freddy Rodriguez"}}, "url": "https://github.com/dotCMS/core/commit/fbaded83a3eb9b46bb0c29d64e15db5ac60a772c", "committedDate": "2020-08-25T19:40:58Z", "message": "#18780 Refactoring"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6e9a0e7c827706205192d4960436840b5af586fd", "author": {"user": {"login": "freddyucv", "name": "Freddy Rodriguez"}}, "url": "https://github.com/dotCMS/core/commit/6e9a0e7c827706205192d4960436840b5af586fd", "committedDate": "2020-08-26T14:17:25Z", "message": "#18780 rename task upgrade"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8f16c9f56af578ae620c26a701dea5a0f0fbfdcc", "author": {"user": {"login": "freddyucv", "name": "Freddy Rodriguez"}}, "url": "https://github.com/dotCMS/core/commit/8f16c9f56af578ae620c26a701dea5a0f0fbfdcc", "committedDate": "2020-08-26T14:20:06Z", "message": "#18780 rename task upgrade"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2b865714ab51031294f678b74007052c2418dfaf", "author": {"user": {"login": "freddyucv", "name": "Freddy Rodriguez"}}, "url": "https://github.com/dotCMS/core/commit/2b865714ab51031294f678b74007052c2418dfaf", "committedDate": "2020-08-26T14:43:09Z", "message": "#18780 renaming task upgrade"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "faf203571d2ed10768b4bc5a6d0488a66e9993bf", "author": {"user": {"login": "freddyucv", "name": "Freddy Rodriguez"}}, "url": "https://github.com/dotCMS/core/commit/faf203571d2ed10768b4bc5a6d0488a66e9993bf", "committedDate": "2020-08-26T14:48:33Z", "message": "#18780 Fixing test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc1NTcyNzMy", "url": "https://github.com/dotCMS/core/pull/19122#pullrequestreview-475572732", "createdAt": "2020-08-26T14:53:51Z", "commit": {"oid": "faf203571d2ed10768b4bc5a6d0488a66e9993bf"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "94fff499b5b227e66ca3a2e33fd78dcaf0019e2a", "author": {"user": {"login": "freddyucv", "name": "Freddy Rodriguez"}}, "url": "https://github.com/dotCMS/core/commit/94fff499b5b227e66ca3a2e33fd78dcaf0019e2a", "committedDate": "2020-08-26T14:55:20Z", "message": "#18780 renaming Task Upgrade again"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "52d9f843ecff46cef00d4c52c33c583d32e0b14b", "author": {"user": {"login": "freddyucv", "name": "Freddy Rodriguez"}}, "url": "https://github.com/dotCMS/core/commit/52d9f843ecff46cef00d4c52c33c583d32e0b14b", "committedDate": "2020-08-26T15:19:27Z", "message": "#18780 Adding test in MainSuite"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b364b0775cf99da8be174cfc2849799aa5f5b6f1", "author": {"user": {"login": "freddyucv", "name": "Freddy Rodriguez"}}, "url": "https://github.com/dotCMS/core/commit/b364b0775cf99da8be174cfc2849799aa5f5b6f1", "committedDate": "2020-08-26T16:05:13Z", "message": "merge"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e571b6cd44fb64c1be400a82e1ac43884639011b", "author": {"user": {"login": "freddyucv", "name": "Freddy Rodriguez"}}, "url": "https://github.com/dotCMS/core/commit/e571b6cd44fb64c1be400a82e1ac43884639011b", "committedDate": "2020-08-26T16:48:23Z", "message": "renaming task upgrade"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ea68647f672bbc8014ff97dba6399d363aaebb50", "author": {"user": {"login": "freddyucv", "name": "Freddy Rodriguez"}}, "url": "https://github.com/dotCMS/core/commit/ea68647f672bbc8014ff97dba6399d363aaebb50", "committedDate": "2020-08-26T17:26:19Z", "message": "renaming task upgrade"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7f114ef96b84147d16d1a83baf842fb71b9c45bb", "author": {"user": {"login": "freddyucv", "name": "Freddy Rodriguez"}}, "url": "https://github.com/dotCMS/core/commit/7f114ef96b84147d16d1a83baf842fb71b9c45bb", "committedDate": "2020-08-26T21:10:46Z", "message": "Updating MainSuite"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c9770169ad105c36c244d7c78713be2caadcdb5a", "author": {"user": {"login": "freddyucv", "name": "Freddy Rodriguez"}}, "url": "https://github.com/dotCMS/core/commit/c9770169ad105c36c244d7c78713be2caadcdb5a", "committedDate": "2020-08-31T22:14:09Z", "message": "Merge branch 'master' into issue_18780_Container_error_using_templates_from_different_sites"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bc7be833a9c6ccbd54fd3ba2c3f93140688790f7", "author": {"user": {"login": "freddyucv", "name": "Freddy Rodriguez"}}, "url": "https://github.com/dotCMS/core/commit/bc7be833a9c6ccbd54fd3ba2c3f93140688790f7", "committedDate": "2020-09-01T07:21:22Z", "message": "#18780 merge"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "43981b122d0279dd084ec676f345c371b92429ca", "author": {"user": {"login": "freddyucv", "name": "Freddy Rodriguez"}}, "url": "https://github.com/dotCMS/core/commit/43981b122d0279dd084ec676f345c371b92429ca", "committedDate": "2020-09-01T11:12:55Z", "message": "testing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f7fb101f56ade892575faa55b734c8615db76a43", "author": {"user": {"login": "freddyucv", "name": "Freddy Rodriguez"}}, "url": "https://github.com/dotCMS/core/commit/f7fb101f56ade892575faa55b734c8615db76a43", "committedDate": "2020-09-01T11:14:02Z", "message": "testing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b02adcf2251218aad1236419dd33ec1de2e3c9a", "author": {"user": {"login": "freddyucv", "name": "Freddy Rodriguez"}}, "url": "https://github.com/dotCMS/core/commit/4b02adcf2251218aad1236419dd33ec1de2e3c9a", "committedDate": "2020-09-01T11:16:58Z", "message": "#18780 merge"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgwMDcxOTQ2", "url": "https://github.com/dotCMS/core/pull/19122#pullrequestreview-480071946", "createdAt": "2020-09-01T19:59:13Z", "commit": {"oid": "4b02adcf2251218aad1236419dd33ec1de2e3c9a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 750, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}