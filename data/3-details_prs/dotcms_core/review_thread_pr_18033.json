{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc5NjY1MDE0", "number": 18033, "reviewThreads": {"totalCount": 75, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNTo1NToyM1rODiwcrA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxNjoyNjoyOFrODjJXiQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3NzcxOTQ4OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/main/java/com/dotmarketing/portlets/containers/business/FileAssetContainerUtil.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNTo1NToyM1rOFuLqqw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxODozODowOFrOFuQiYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzk2OTk2Mw==", "bodyText": "when the path is relative use the current host", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r383969963", "createdAt": "2020-02-25T15:55:23Z", "author": {"login": "freddyucv"}, "path": "dotCMS/src/main/java/com/dotmarketing/portlets/containers/business/FileAssetContainerUtil.java", "diffHunk": "@@ -165,10 +171,18 @@ public String getContainerIdFromPath(final String fullPath) throws DotDataExcept\n         if (null == host) {\n \n             try {\n-                host = APILocator.getHostAPI().findDefaultHost(APILocator.systemUser(), false);\n-            } catch (DotDataException | DotSecurityException e) {\n-                host = APILocator.systemHost();\n+                host = WebAPILocator.getHostWebAPI()\n+                        .getCurrentHost(HttpServletRequestThreadLocal.INSTANCE.getRequest());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "163e1a1992ed016ead773a17bb7a0d561365c17e"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA0OTc2MQ==", "bodyText": "good", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384049761", "createdAt": "2020-02-25T18:38:08Z", "author": {"login": "jdotcms"}, "path": "dotCMS/src/main/java/com/dotmarketing/portlets/containers/business/FileAssetContainerUtil.java", "diffHunk": "@@ -165,10 +171,18 @@ public String getContainerIdFromPath(final String fullPath) throws DotDataExcept\n         if (null == host) {\n \n             try {\n-                host = APILocator.getHostAPI().findDefaultHost(APILocator.systemUser(), false);\n-            } catch (DotDataException | DotSecurityException e) {\n-                host = APILocator.systemHost();\n+                host = WebAPILocator.getHostWebAPI()\n+                        .getCurrentHost(HttpServletRequestThreadLocal.INSTANCE.getRequest());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzk2OTk2Mw=="}, "originalCommit": {"oid": "163e1a1992ed016ead773a17bb7a0d561365c17e"}, "originalPosition": 36}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3Nzc4OTg0OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNjoxMTo1NFrOFuMWeQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNjoxMTo1NFrOFuMWeQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzk4MTE3Nw==", "bodyText": "Issue found: A method/constructor should not explicitly throw java.lang.Exception", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r383981177", "createdAt": "2020-02-25T16:11:54Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "diffHunk": "@@ -79,9 +87,88 @@\n     private static Persona persona;\n     private static Visitor visitor;\n \n+    @DataProvider\n+    public static Object[][] cases() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "47e4e16f4c28c1515e7ad5a4903ec0befb86e80b"}, "originalPosition": 58}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3Nzc4OTk3OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/main/java/com/dotcms/util/pagination/ContainerPaginator.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNjoxMTo1NVrOFuMWjw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNjoxMTo1NVrOFuMWjw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzk4MTE5OQ==", "bodyText": "Issue found: Avoid unused imports such as 'com.dotmarketing.business.Permissionable'", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r383981199", "createdAt": "2020-02-25T16:11:55Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/main/java/com/dotcms/util/pagination/ContainerPaginator.java", "diffHunk": "@@ -4,26 +4,33 @@\n import com.dotmarketing.beans.Host;\n import com.dotmarketing.beans.Source;\n import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.business.Permissionable;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "47e4e16f4c28c1515e7ad5a4903ec0befb86e80b"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3Nzc5MDA2OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNjoxMTo1NlrOFuMWmg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNjoxMTo1NlrOFuMWmg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzk4MTIxMA==", "bodyText": "Issue found: A method/constructor should not explicitly throw java.lang.Exception", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r383981210", "createdAt": "2020-02-25T16:11:56Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "diffHunk": "@@ -532,18 +585,14 @@ public void ContentFallbackFalse_PageFallbackFalse_PageEnglish_ViewEnglishConten\n      *\n      */\n     @Test\n-    public void ContentFallbackFalse_PageFallbackFalse_PageEnglishAndSpanish_ViewEnglishContent1And2_ViewSpanishContent2And3() throws Exception{\n+    @UseDataProvider(\"cases\")\n+    public void ContentFallbackFalse_PageFallbackFalse_PageEnglishAndSpanish_ViewEnglishContent1And2_ViewSpanishContent2And3(final Container container, final Template template) throws Exception{", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "47e4e16f4c28c1515e7ad5a4903ec0befb86e80b"}, "originalPosition": 377}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3Nzc5MDE1OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNjoxMTo1OFrOFuMWpw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNjoxMTo1OFrOFuMWpw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzk4MTIyMw==", "bodyText": "Issue found: A method/constructor should not explicitly throw java.lang.Exception", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r383981223", "createdAt": "2020-02-25T16:11:58Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "diffHunk": "@@ -1132,6 +1162,151 @@ public void shouldReturnParserContainerUUID() throws Exception {\n         Assert.assertTrue(html.matches(regexExpected));\n     }\n \n+    /**\n+     * Method to test: {@link com.dotmarketing.portlets.htmlpageasset.business.render.HTMLPageAssetRenderedAPIImpl#getPageHtml(PageContext, HttpServletRequest, HttpServletResponse)}\n+     * Given Scenario: Create a page with File Container liked with relative path in the template\n+     * ExpectedResult: should work\n+     *\n+     * @throws Exception\n+     */\n+    @Test\n+    public void shouldRenderRelativeContainerPath() throws Exception {\n+\n+        final FileAssetContainer container = createFileContainer();\n+        final Template template = new TemplateDataGen().title(\"PageContextBuilderTemplate\"+System.currentTimeMillis())\n+                .host(site)\n+                .withContainer(container.getPath(), UUID)\n+                .nextPersisted();\n+        PublishFactory.publishAsset(template, systemUser, false, false);\n+\n+        final String pageName = \"testPage-\"+System.currentTimeMillis();\n+        final HTMLPageAsset pageEnglishVersion = createHtmlPageAsset(template, pageName, 1);\n+\n+        createMultiTree(pageEnglishVersion.getIdentifier(), container.getIdentifier());\n+\n+        final HttpServletRequest mockRequest = createHttpServletRequest(pageEnglishVersion);\n+        Mockito.when(mockRequest.getParameter(WebKeys.PAGE_MODE_PARAMETER)).thenReturn(PageMode.LIVE.toString());\n+\n+        final HttpServletResponse mockResponse = mock(HttpServletResponse.class);\n+        final HttpSession session = createHttpSession(mockRequest);\n+        Mockito.when(session.getAttribute(WebKeys.VISITOR)).thenReturn(null);\n+        Mockito.when(session.getAttribute(WebKeys.CMS_USER)).thenReturn(systemUser);\n+\n+        final String html = APILocator.getHTMLPageAssetRenderedAPI().getPageHtml(\n+                PageContextBuilder.builder()\n+                        .setUser(systemUser)\n+                        .setPageUri(pageEnglishVersion.getURI())\n+                        .setPageMode(PageMode.LIVE)\n+                        .build(),\n+                mockRequest, mockResponse);\n+\n+        Assert.assertEquals(\"content2content1\", html);\n+    }\n+\n+    /**\n+     * Method to test: {@link com.dotmarketing.portlets.htmlpageasset.business.render.HTMLPageAssetRenderedAPIImpl#getPageHtml(PageContext, HttpServletRequest, HttpServletResponse)}\n+     * Given Scenario: Create a page and a advance template using a File Container in another site\n+     * ExpectedResult: should work\n+     *\n+     * @throws Exception\n+     */\n+    @Test\n+    public void shouldRenderUsingOtherSiteContainer() throws Exception {\n+        final Host defaultHost = APILocator.getHostAPI().findDefaultHost(APILocator.systemUser(), true);\n+        final FileAssetContainer container = createFileContainer(defaultHost);\n+        final Template template = new TemplateDataGen().title(\"PageContextBuilderTemplate\"+System.currentTimeMillis())\n+                .host(site)\n+                .withContainer(\"//\" + defaultHost.getName()  + container.getPath(), UUID)\n+                .nextPersisted();\n+        PublishFactory.publishAsset(template, systemUser, false, false);\n+\n+        final String pageName = \"testPage-\"+System.currentTimeMillis();\n+        final HTMLPageAsset pageEnglishVersion = createHtmlPageAsset(template, pageName, 1);\n+\n+        createMultiTree(pageEnglishVersion.getIdentifier(), container.getIdentifier());\n+\n+        final HttpServletRequest mockRequest = createHttpServletRequest(pageEnglishVersion);\n+        Mockito.when(mockRequest.getParameter(WebKeys.PAGE_MODE_PARAMETER)).thenReturn(PageMode.LIVE.toString());\n+\n+        final HttpServletResponse mockResponse = mock(HttpServletResponse.class);\n+        final HttpSession session = createHttpSession(mockRequest);\n+        Mockito.when(session.getAttribute(WebKeys.VISITOR)).thenReturn(null);\n+        Mockito.when(session.getAttribute(WebKeys.CMS_USER)).thenReturn(systemUser);\n+\n+        final String html = APILocator.getHTMLPageAssetRenderedAPI().getPageHtml(\n+                PageContextBuilder.builder()\n+                        .setUser(systemUser)\n+                        .setPageUri(pageEnglishVersion.getURI())\n+                        .setPageMode(PageMode.LIVE)\n+                        .build(),\n+                mockRequest, mockResponse);\n+\n+        Assert.assertEquals(\"content2content1\", html);\n+    }\n+\n+    /**\n+     * Method to test: {@link com.dotmarketing.portlets.htmlpageasset.business.render.HTMLPageAssetRenderedAPIImpl#getPageHtml(PageContext, HttpServletRequest, HttpServletResponse)}\n+     * Given Scenario: Create a page and a not advance template using a File Container in another site\n+     * ExpectedResult: should work\n+     *\n+     * @throws Exception\n+     */\n+    @Test\n+    public void shouldRenderUsingOtherSiteContainerAndNotAdvanceTemplate() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "47e4e16f4c28c1515e7ad5a4903ec0befb86e80b"}, "originalPosition": 771}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3Nzc5MDIyOnYy", "diffSide": "RIGHT", "path": "dotCMS/src/main/java/com/dotcms/rendering/velocity/directive/TemplatePathStrategyResolver.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNjoxMTo1OVrOFuMWsQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNjoxMTo1OVrOFuMWsQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzk4MTIzMw==", "bodyText": "Issue found: Parameter 'uid' is not assigned and could be declared final", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r383981233", "createdAt": "2020-02-25T16:11:59Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/main/java/com/dotcms/rendering/velocity/directive/TemplatePathStrategyResolver.java", "diffHunk": "@@ -137,31 +138,31 @@ private boolean isPath (final String templatePath) {\n         }\n \n         private String getPath(final RenderParams params, final String path, final String uid) {\n-\n-\n-            final Host host     = params.currentHost;\n-            String templatePath = path;\n-\n-\n             try {\n-\n-                templatePath =(!templatePath.startsWith(HOST_INDICATOR))?\n-                        builder(FORWARD_SLASH, params.mode.name(), FORWARD_SLASH, HOST_INDICATOR,\n-                            this.getHost(host).getHostname(), path.startsWith(FORWARD_SLASH)? StringPool.BLANK:FORWARD_SLASH,\n-                            path, FORWARD_SLASH, uid, PERIOD, VelocityType.CONTAINER.fileExtension).toString():\n-\n-                        builder(FORWARD_SLASH, params.mode.name(), FORWARD_SLASH,\n-                            path, FORWARD_SLASH, uid, PERIOD, VelocityType.CONTAINER.fileExtension).toString();\n+                return FileAssetContainerUtil.getInstance().isFullPath(path) ?\n+                        getContainerResourcePathFromFullPath(params, path, uid) :\n+                        getContainerResourceFromRelativePath(params, path, uid);\n             } catch (Exception e) {\n \n-                Logger.warn(this.getClass(), \" - unable to resolve \" + templatePath + \" getting this: \"+ e.getMessage() );\n+                Logger.warn(this.getClass(), \" - unable to resolve \" + path + \" getting this: \"+ e.getMessage() );\n                 if(e.getStackTrace().length>0) {\n                     Logger.warn(this.getClass(), \" - at \" + e.getStackTrace()[0]);\n                 }\n                 throw new DotStateException(e);\n             }\n+        }\n+\n+        @NotNull\n+        private String getContainerResourceFromRelativePath(RenderParams params, String path, String uid) {\n+            return builder(FORWARD_SLASH, params.mode.name(), FORWARD_SLASH, HOST_INDICATOR,\n+                    params.currentHost.getHostname(), path.startsWith(FORWARD_SLASH)? StringPool.BLANK:FORWARD_SLASH,\n+                    path, FORWARD_SLASH, uid, PERIOD, VelocityType.CONTAINER.fileExtension).toString();\n+        }\n \n-            return templatePath;\n+        @NotNull\n+        private String getContainerResourcePathFromFullPath(RenderParams params, String path, String uid) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "47e4e16f4c28c1515e7ad5a4903ec0befb86e80b"}, "originalPosition": 50}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3Nzc5MDMzOnYy", "diffSide": "RIGHT", "path": "dotCMS/src/main/java/com/dotcms/rendering/velocity/services/ContainerLoader.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNjoxMjowMFrOFuMWwQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNjoxMjowMFrOFuMWwQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzk4MTI0OQ==", "bodyText": "Issue found: Avoid unused imports such as 'com.dotmarketing.exception.DotRuntimeException'", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r383981249", "createdAt": "2020-02-25T16:12:00Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/main/java/com/dotcms/rendering/velocity/services/ContainerLoader.java", "diffHunk": "@@ -10,6 +10,7 @@\n import com.dotmarketing.business.CacheLocator;\n import com.dotmarketing.business.DotStateException;\n import com.dotmarketing.exception.DotDataException;\n+import com.dotmarketing.exception.DotRuntimeException;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "47e4e16f4c28c1515e7ad5a4903ec0befb86e80b"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3Nzc5MDQwOnYy", "diffSide": "RIGHT", "path": "dotCMS/src/main/java/com/dotcms/util/pagination/ContainerPaginator.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNjoxMjowMlrOFuMWzA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNjoxMjowMlrOFuMWzA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzk4MTI2MA==", "bodyText": "Issue found: Avoid unused imports such as 'com.dotmarketing.portlets.containers.business.FileAssetContainerUtil'", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r383981260", "createdAt": "2020-02-25T16:12:02Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/main/java/com/dotcms/util/pagination/ContainerPaginator.java", "diffHunk": "@@ -4,26 +4,33 @@\n import com.dotmarketing.beans.Host;\n import com.dotmarketing.beans.Source;\n import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.business.Permissionable;\n+import com.dotmarketing.business.web.WebAPILocator;\n import com.dotmarketing.exception.DotDataException;\n import com.dotmarketing.exception.DotSecurityException;\n import com.dotmarketing.portlets.containers.business.ContainerAPI;\n+import com.dotmarketing.portlets.containers.business.FileAssetContainerUtil;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "47e4e16f4c28c1515e7ad5a4903ec0befb86e80b"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3Nzc5MDQ3OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNjoxMjowM1rOFuMW2Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNjoxMjowM1rOFuMW2Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzk4MTI3Mw==", "bodyText": "Issue found: A method/constructor should not explicitly throw java.lang.Exception", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r383981273", "createdAt": "2020-02-25T16:12:03Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "diffHunk": "@@ -677,20 +722,16 @@ public void ContentFallbackTrue_PageFallbackTrue_PageEnglishAndSpanish_ViewEngli\n      *\n      */\n     @Test (expected = HTMLPageAssetNotFoundException.class)\n-    public void ContentFallbackTrue_PageFallbackFalse_PageEnglish_ViewEnglishContent1And2_ViewSpanish404() throws Exception{\n+    @UseDataProvider(\"cases\")\n+    public void ContentFallbackTrue_PageFallbackFalse_PageEnglish_ViewEnglishContent1And2_ViewSpanish404(final Container container, final Template template) throws Exception{", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "47e4e16f4c28c1515e7ad5a4903ec0befb86e80b"}, "originalPosition": 439}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3Nzc5MDU0OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/main/java/com/dotcms/rendering/velocity/services/PageRenderUtil.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNjoxMjowNVrOFuMW5A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNjoxMjowNVrOFuMW5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzk4MTI4NA==", "bodyText": "Issue found: Avoid unused imports such as 'com.dotmarketing.portlets.containers.business'", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r383981284", "createdAt": "2020-02-25T16:12:05Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/main/java/com/dotcms/rendering/velocity/services/PageRenderUtil.java", "diffHunk": "@@ -27,17 +27,15 @@\n import com.dotmarketing.exception.DotSecurityException;\n import com.dotmarketing.factories.MultiTreeAPI;\n import com.dotmarketing.factories.PersonalizedContentlet;\n-import com.dotmarketing.portlets.containers.business.ContainerExceptionNotifier;\n-import com.dotmarketing.portlets.containers.business.ContainerFinderByIdOrPathStrategy;\n-import com.dotmarketing.portlets.containers.business.LiveContainerFinderByIdOrPathStrategyResolver;\n-import com.dotmarketing.portlets.containers.business.WorkingContainerFinderByIdOrPathStrategyResolver;\n+import com.dotmarketing.portlets.containers.business.*;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "47e4e16f4c28c1515e7ad5a4903ec0befb86e80b"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3Nzc5MDY2OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNjoxMjowNlrOFuMW-A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNjoxMjowNlrOFuMW-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzk4MTMwNA==", "bodyText": "Issue found: A method/constructor should not explicitly throw java.lang.Exception", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r383981304", "createdAt": "2020-02-25T16:12:06Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "diffHunk": "@@ -1082,33 +1125,20 @@ public void shouldReturnPageHTMLForLegacyUUIDAndMultiTree() throws Exception {\n      * @throws Exception\n      */\n     @Test\n-    public void shouldReturnParserContainerUUID() throws Exception {\n+    @UseDataProvider(\"cases\")\n+    public void shouldReturnParserContainerUUID(final Container container, final Template template) throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "47e4e16f4c28c1515e7ad5a4903ec0befb86e80b"}, "originalPosition": 642}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3Nzc5MDc1OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNjoxMjowOFrOFuMXBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNjoxMjowOFrOFuMXBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzk4MTMxOQ==", "bodyText": "Issue found: A method/constructor should not explicitly throw java.lang.Exception", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r383981319", "createdAt": "2020-02-25T16:12:08Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "diffHunk": "@@ -341,18 +408,14 @@ public void ContentFallbackFalse_PageFallbackTrue_PageEnglish_ViewEnglishContent\n      *\n      */\n     @Test\n-    public void ContentFallbackFalse_PageFallbackTrue_PageEnglishAndSpanish_ViewEnglishContent1And2_ViewSpanishContent2And3() throws Exception{\n+    @UseDataProvider(\"cases\")\n+    public void ContentFallbackFalse_PageFallbackTrue_PageEnglishAndSpanish_ViewEnglishContent1And2_ViewSpanishContent2And3(final Container container, final Template template) throws Exception{", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "47e4e16f4c28c1515e7ad5a4903ec0befb86e80b"}, "originalPosition": 294}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3Nzc5MDg1OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNjoxMjoxMFrOFuMXFQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNjoxMjoxMFrOFuMXFQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzk4MTMzMw==", "bodyText": "Issue found: Avoid unused imports such as 'com.dotmarketing.portlets.containers.business.FileAssetContainerUtil'", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r383981333", "createdAt": "2020-02-25T16:12:10Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "diffHunk": "@@ -23,12 +23,16 @@\n import com.dotmarketing.business.PermissionAPI;\n import com.dotmarketing.exception.DotDataException;\n import com.dotmarketing.exception.DotSecurityException;\n+import com.dotmarketing.exception.WebAssetException;\n import com.dotmarketing.factories.PublishFactory;\n import com.dotmarketing.factories.WebAssetFactory;\n+import com.dotmarketing.portlets.containers.business.FileAssetContainerUtil;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "47e4e16f4c28c1515e7ad5a4903ec0befb86e80b"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3Nzc5MDkxOnYy", "diffSide": "RIGHT", "path": "dotCMS/src/main/java/com/dotmarketing/portlets/containers/model/ContainerView.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNjoxMjoxMVrOFuMXHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNjoxMjoxMVrOFuMXHg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzk4MTM0Mg==", "bodyText": "Issue found: Private field 'container' could be made final; it is only initialized in the declaration or constructor.", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r383981342", "createdAt": "2020-02-25T16:12:11Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/main/java/com/dotmarketing/portlets/containers/model/ContainerView.java", "diffHunk": "@@ -0,0 +1,49 @@\n+package com.dotmarketing.portlets.containers.model;\n+\n+import com.dotmarketing.beans.Host;\n+\n+import com.dotmarketing.portlets.containers.business.FileAssetContainerUtil;\n+\n+import com.fasterxml.jackson.databind.annotation.JsonSerialize;\n+\n+\n+/**\n+ * It is a {@link Container} for UI, it make sure to return the container relative path from {@link ContainerView#host}\n+ */\n+@JsonSerialize(using = ContainerViewSerializer.class)\n+public class ContainerView {\n+    private Container container;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "47e4e16f4c28c1515e7ad5a4903ec0befb86e80b"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3Nzc5MDk4OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNjoxMjoxMlrOFuMXKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNjoxMjoxMlrOFuMXKg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzk4MTM1NA==", "bodyText": "Issue found: A method/constructor should not explicitly throw java.lang.Exception", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r383981354", "createdAt": "2020-02-25T16:12:12Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "diffHunk": "@@ -731,7 +772,8 @@ public void ContentFallbackTrue_PageFallbackFalse_PageEnglish_ViewEnglishContent\n      * @throws Exception\n      */\n     @Test\n-    public void constantField_notUpdatedCache_whenChanged() throws Exception{\n+    @UseDataProvider(\"cases\")\n+    public void constantField_notUpdatedCache_whenChanged(final Container container, final Template template) throws Exception{", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "47e4e16f4c28c1515e7ad5a4903ec0befb86e80b"}, "originalPosition": 473}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3Nzc5MTA4OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNjoxMjoxNFrOFuMXOA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNjoxMjoxNFrOFuMXOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzk4MTM2OA==", "bodyText": "Issue found: A method/constructor should not explicitly throw java.lang.Exception", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r383981368", "createdAt": "2020-02-25T16:12:14Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "diffHunk": "@@ -79,9 +87,88 @@\n     private static Persona persona;\n     private static Visitor visitor;\n \n+    @DataProvider\n+    public static Object[][] cases() throws Exception {\n+        if (systemUser == null) {\n+            prepareGlobalData();\n+        }\n+\n+        final Container container = createContainer();\n+        final Template templateContainer = createTemplate(container);\n+\n+        final Container fileContainer = createFileContainer();\n+        final Template templateFileContainer = createTemplate(fileContainer);\n+\n+        return new Object[][] {\n+                { container, templateContainer },\n+                { fileContainer, templateFileContainer}\n+        };\n+    }\n+\n+    private static Template createTemplate(final Container container) throws DotSecurityException, WebAssetException, DotDataException {\n+        final Template template = new TemplateDataGen().title(\"PageContextBuilderTemplate\"+System.currentTimeMillis())\n+                .host(site)\n+                .withContainer(container, UUID).nextPersisted();\n+        PublishFactory.publishAsset(template, systemUser, false, false);\n+        return template;\n+    }\n+\n+    private static Container createContainer() throws DotSecurityException, DotDataException, WebAssetException {\n+        Container container = new Container();\n+        final String containerName = \"containerHTMLPageRenderedTest\" + System.currentTimeMillis();\n+\n+        container.setFriendlyName(containerName);\n+        container.setTitle(containerName);\n+        container.setOwner(systemUser.getUserId());\n+        container.setMaxContentlets(5);\n+\n+        final List<ContainerStructure> csList = new ArrayList<ContainerStructure>();\n+        final ContainerStructure cs = new ContainerStructure();\n+        cs.setStructureId(contentGenericType.id());\n+        cs.setCode(\"$!{body}\");\n+        csList.add(cs);\n+\n+        container = APILocator.getContainerAPI().save(container, csList, site, systemUser, false);\n+        PublishFactory.publishAsset(container, systemUser, false, false);\n+\n+        return container;\n+    }\n+\n+    private static FileAssetContainer createFileContainer() throws DotSecurityException, DotDataException, WebAssetException {\n+        return createFileContainer(site);\n+    }\n+\n+    private static FileAssetContainer createFileContainer(final Host host)\n+            throws DotSecurityException, DotDataException, WebAssetException {\n+\n+        final String containerName = \"containerHTMLPageRenderedTest\" + System.currentTimeMillis();\n+        FileAssetContainer container = new ContainerAsFileDataGen()\n+                .host(host)\n+                .folderName(containerName)\n+                .contentType(contentGenericType, \"$!{body}\")\n+                .nextPersisted();\n+\n+        container = (FileAssetContainer) APILocator.getContainerAPI().find(container.getInode(), systemUser, true);\n+\n+        final Folder folder = APILocator.getFolderAPI().findFolderByPath(container.getPath(), host, systemUser, true);\n+        final List<FileAsset> containerFiles =\n+                APILocator.getFileAssetAPI().findFileAssetsByFolder(folder, systemUser, true);\n+\n+        for (final FileAsset containerFile : containerFiles) {\n+            ContentletDataGen.publish(containerFile);\n+        }\n+\n+        return container;\n+    }\n+\n     @BeforeClass\n     public static void prepare() throws Exception {\n \n+        IntegrationTestInitService.getInstance().init();\n+    }\n+\n+    public static void prepareGlobalData() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "47e4e16f4c28c1515e7ad5a4903ec0befb86e80b"}, "originalPosition": 137}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3Nzc5MTE5OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNjoxMjoxNVrOFuMXSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQyMjozNjo0N1rOFuX0Gg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzk4MTM4Nw==", "bodyText": "Issue found: A method/constructor should not explicitly throw java.lang.Exception", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r383981387", "createdAt": "2020-02-25T16:12:15Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "diffHunk": "@@ -475,20 +532,16 @@ public void ContentFallbackFalse_PageFallbackTrue_PageSpanish_ViewEnglish404_Vie\n      *\n      */\n     @Test (expected = HTMLPageAssetNotFoundException.class)\n-    public void ContentFallbackFalse_PageFallbackFalse_PageEnglish_ViewEnglishContent1And2_ViewSpanish404() throws Exception{\n+    @UseDataProvider(\"cases\")\n+    public void ContentFallbackFalse_PageFallbackFalse_PageEnglish_ViewEnglishContent1And2_ViewSpanish404(final Container container, final Template template) throws Exception{", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "47e4e16f4c28c1515e7ad5a4903ec0befb86e80b"}, "originalPosition": 352}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDE2ODk4Ng==", "bodyText": "same here", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384168986", "createdAt": "2020-02-25T22:36:47Z", "author": {"login": "nollymar"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "diffHunk": "@@ -475,20 +532,16 @@ public void ContentFallbackFalse_PageFallbackTrue_PageSpanish_ViewEnglish404_Vie\n      *\n      */\n     @Test (expected = HTMLPageAssetNotFoundException.class)\n-    public void ContentFallbackFalse_PageFallbackFalse_PageEnglish_ViewEnglishContent1And2_ViewSpanish404() throws Exception{\n+    @UseDataProvider(\"cases\")\n+    public void ContentFallbackFalse_PageFallbackFalse_PageEnglish_ViewEnglishContent1And2_ViewSpanish404(final Container container, final Template template) throws Exception{", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzk4MTM4Nw=="}, "originalCommit": {"oid": "47e4e16f4c28c1515e7ad5a4903ec0befb86e80b"}, "originalPosition": 352}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3Nzc5MTMyOnYy", "diffSide": "RIGHT", "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNjoxMjoxNlrOFuMXXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNjoxMjoxNlrOFuMXXQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzk4MTQwNQ==", "bodyText": "Issue found: Local variable 'template' could be declared final", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r383981405", "createdAt": "2020-02-25T16:12:16Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "diffHunk": "@@ -1132,6 +1162,151 @@ public void shouldReturnParserContainerUUID() throws Exception {\n         Assert.assertTrue(html.matches(regexExpected));\n     }\n \n+    /**\n+     * Method to test: {@link com.dotmarketing.portlets.htmlpageasset.business.render.HTMLPageAssetRenderedAPIImpl#getPageHtml(PageContext, HttpServletRequest, HttpServletResponse)}\n+     * Given Scenario: Create a page with File Container liked with relative path in the template\n+     * ExpectedResult: should work\n+     *\n+     * @throws Exception\n+     */\n+    @Test\n+    public void shouldRenderRelativeContainerPath() throws Exception {\n+\n+        final FileAssetContainer container = createFileContainer();\n+        final Template template = new TemplateDataGen().title(\"PageContextBuilderTemplate\"+System.currentTimeMillis())\n+                .host(site)\n+                .withContainer(container.getPath(), UUID)\n+                .nextPersisted();\n+        PublishFactory.publishAsset(template, systemUser, false, false);\n+\n+        final String pageName = \"testPage-\"+System.currentTimeMillis();\n+        final HTMLPageAsset pageEnglishVersion = createHtmlPageAsset(template, pageName, 1);\n+\n+        createMultiTree(pageEnglishVersion.getIdentifier(), container.getIdentifier());\n+\n+        final HttpServletRequest mockRequest = createHttpServletRequest(pageEnglishVersion);\n+        Mockito.when(mockRequest.getParameter(WebKeys.PAGE_MODE_PARAMETER)).thenReturn(PageMode.LIVE.toString());\n+\n+        final HttpServletResponse mockResponse = mock(HttpServletResponse.class);\n+        final HttpSession session = createHttpSession(mockRequest);\n+        Mockito.when(session.getAttribute(WebKeys.VISITOR)).thenReturn(null);\n+        Mockito.when(session.getAttribute(WebKeys.CMS_USER)).thenReturn(systemUser);\n+\n+        final String html = APILocator.getHTMLPageAssetRenderedAPI().getPageHtml(\n+                PageContextBuilder.builder()\n+                        .setUser(systemUser)\n+                        .setPageUri(pageEnglishVersion.getURI())\n+                        .setPageMode(PageMode.LIVE)\n+                        .build(),\n+                mockRequest, mockResponse);\n+\n+        Assert.assertEquals(\"content2content1\", html);\n+    }\n+\n+    /**\n+     * Method to test: {@link com.dotmarketing.portlets.htmlpageasset.business.render.HTMLPageAssetRenderedAPIImpl#getPageHtml(PageContext, HttpServletRequest, HttpServletResponse)}\n+     * Given Scenario: Create a page and a advance template using a File Container in another site\n+     * ExpectedResult: should work\n+     *\n+     * @throws Exception\n+     */\n+    @Test\n+    public void shouldRenderUsingOtherSiteContainer() throws Exception {\n+        final Host defaultHost = APILocator.getHostAPI().findDefaultHost(APILocator.systemUser(), true);\n+        final FileAssetContainer container = createFileContainer(defaultHost);\n+        final Template template = new TemplateDataGen().title(\"PageContextBuilderTemplate\"+System.currentTimeMillis())\n+                .host(site)\n+                .withContainer(\"//\" + defaultHost.getName()  + container.getPath(), UUID)\n+                .nextPersisted();\n+        PublishFactory.publishAsset(template, systemUser, false, false);\n+\n+        final String pageName = \"testPage-\"+System.currentTimeMillis();\n+        final HTMLPageAsset pageEnglishVersion = createHtmlPageAsset(template, pageName, 1);\n+\n+        createMultiTree(pageEnglishVersion.getIdentifier(), container.getIdentifier());\n+\n+        final HttpServletRequest mockRequest = createHttpServletRequest(pageEnglishVersion);\n+        Mockito.when(mockRequest.getParameter(WebKeys.PAGE_MODE_PARAMETER)).thenReturn(PageMode.LIVE.toString());\n+\n+        final HttpServletResponse mockResponse = mock(HttpServletResponse.class);\n+        final HttpSession session = createHttpSession(mockRequest);\n+        Mockito.when(session.getAttribute(WebKeys.VISITOR)).thenReturn(null);\n+        Mockito.when(session.getAttribute(WebKeys.CMS_USER)).thenReturn(systemUser);\n+\n+        final String html = APILocator.getHTMLPageAssetRenderedAPI().getPageHtml(\n+                PageContextBuilder.builder()\n+                        .setUser(systemUser)\n+                        .setPageUri(pageEnglishVersion.getURI())\n+                        .setPageMode(PageMode.LIVE)\n+                        .build(),\n+                mockRequest, mockResponse);\n+\n+        Assert.assertEquals(\"content2content1\", html);\n+    }\n+\n+    /**\n+     * Method to test: {@link com.dotmarketing.portlets.htmlpageasset.business.render.HTMLPageAssetRenderedAPIImpl#getPageHtml(PageContext, HttpServletRequest, HttpServletResponse)}\n+     * Given Scenario: Create a page and a not advance template using a File Container in another site\n+     * ExpectedResult: should work\n+     *\n+     * @throws Exception\n+     */\n+    @Test\n+    public void shouldRenderUsingOtherSiteContainerAndNotAdvanceTemplate() throws Exception {\n+        final Host defaultHost = APILocator.getHostAPI().findDefaultHost(APILocator.systemUser(), true);\n+        final FileAssetContainer container = createFileContainer(defaultHost);\n+\n+        final TemplateLayout templateLayout = new TemplateLayoutDataGen()\n+                .withContainer(\"//\" + defaultHost.getName()  + container.getPath())\n+                .next();\n+\n+        final Contentlet contentlet = new ThemeDataGen().nextPersisted();\n+        Template template = new TemplateDataGen()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "47e4e16f4c28c1515e7ad5a4903ec0befb86e80b"}, "originalPosition": 780}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3Nzc5MTM4OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNjoxMjoxN1rOFuMXaQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNjoxMjoxN1rOFuMXaQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzk4MTQxNw==", "bodyText": "Issue found: Local variable 'multiTree' could be declared final", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r383981417", "createdAt": "2020-02-25T16:12:17Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "diffHunk": "@@ -760,15 +802,15 @@ public void constantField_notUpdatedCache_whenChanged() throws Exception{\n             addAnonymousPermissions(contentlet);\n \n             final HTMLPageAsset pageEnglishVersion = new HTMLPageDataGen(folder, template)\n-                    .languageId(1).pageURL(\"testPageWidget\").title(\"testPageWidget\")\n+                    .languageId(1).pageURL(\"testPageWidget\"+ System.currentTimeMillis()).title(\"testPageWidget\")\n                     .nextPersisted();\n             pageEnglishVersion.setIndexPolicy(IndexPolicy.WAIT_FOR);\n             pageEnglishVersion.setIndexPolicyDependencies(IndexPolicy.WAIT_FOR);\n             contentlet.setBoolProperty(Contentlet.IS_TEST_MODE, true);\n             contentletAPI.publish(pageEnglishVersion, systemUser, false);\n             addAnonymousPermissions(pageEnglishVersion);\n \n-            MultiTree multiTree = new MultiTree(pageEnglishVersion.getIdentifier(), containerId,\n+            MultiTree multiTree = new MultiTree(pageEnglishVersion.getIdentifier(), container.getIdentifier(),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "47e4e16f4c28c1515e7ad5a4903ec0befb86e80b"}, "originalPosition": 491}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3Nzk0MDg5OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNzowNToyMlrOFuNzKw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNzowNToyMlrOFuNzKw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDAwNDkwNw==", "bodyText": "Issue found: A method/constructor should not explicitly throw java.lang.Exception", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384004907", "createdAt": "2020-02-25T17:05:22Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "diffHunk": "@@ -341,18 +406,14 @@ public void ContentFallbackFalse_PageFallbackTrue_PageEnglish_ViewEnglishContent\n      *\n      */\n     @Test\n-    public void ContentFallbackFalse_PageFallbackTrue_PageEnglishAndSpanish_ViewEnglishContent1And2_ViewSpanishContent2And3() throws Exception{\n+    @UseDataProvider(\"cases\")\n+    public void ContentFallbackFalse_PageFallbackTrue_PageEnglishAndSpanish_ViewEnglishContent1And2_ViewSpanishContent2And3(final Container container, final Template template) throws Exception{", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b575ead97282c128ee92adfbb3e90459d47c000b"}, "originalPosition": 293}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3Nzk0MDk0OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNzowNToyNFrOFuNzMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNzowNToyNFrOFuNzMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDAwNDkxNQ==", "bodyText": "Issue found: A method/constructor should not explicitly throw java.lang.Exception", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384004915", "createdAt": "2020-02-25T17:05:24Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "diffHunk": "@@ -416,22 +477,16 @@ public void ContentFallbackFalse_PageFallbackTrue_PageEnglishAndSpanish_ViewEngl\n      * @throws Exception\n      */\n     @Test (expected = HTMLPageAssetNotFoundException.class)\n-    public void ContentFallbackFalse_PageFallbackTrue_PageSpanish_ViewEnglish404_ViewSpanishContent2And3() throws Exception{\n+    @UseDataProvider(\"cases\")\n+    public void ContentFallbackFalse_PageFallbackTrue_PageSpanish_ViewEnglish404_ViewSpanishContent2And3(final Container container, final Template template) throws Exception{", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b575ead97282c128ee92adfbb3e90459d47c000b"}, "originalPosition": 324}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3Nzk0MTA2OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNzowNToyNVrOFuNzQA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNzowNToyNVrOFuNzQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDAwNDkyOA==", "bodyText": "Issue found: A method/constructor should not explicitly throw java.lang.Exception", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384004928", "createdAt": "2020-02-25T17:05:25Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "diffHunk": "@@ -475,20 +530,16 @@ public void ContentFallbackFalse_PageFallbackTrue_PageSpanish_ViewEnglish404_Vie\n      *\n      */\n     @Test (expected = HTMLPageAssetNotFoundException.class)\n-    public void ContentFallbackFalse_PageFallbackFalse_PageEnglish_ViewEnglishContent1And2_ViewSpanish404() throws Exception{\n+    @UseDataProvider(\"cases\")\n+    public void ContentFallbackFalse_PageFallbackFalse_PageEnglish_ViewEnglishContent1And2_ViewSpanish404(final Container container, final Template template) throws Exception{", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b575ead97282c128ee92adfbb3e90459d47c000b"}, "originalPosition": 351}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3Nzk0MTM2OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNzowNTozMFrOFuNzbw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNzowNTozMFrOFuNzbw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDAwNDk3NQ==", "bodyText": "Issue found: A method/constructor should not explicitly throw java.lang.Exception", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384004975", "createdAt": "2020-02-25T17:05:30Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "diffHunk": "@@ -1132,6 +1160,151 @@ public void shouldReturnParserContainerUUID() throws Exception {\n         Assert.assertTrue(html.matches(regexExpected));\n     }\n \n+    /**\n+     * Method to test: {@link com.dotmarketing.portlets.htmlpageasset.business.render.HTMLPageAssetRenderedAPIImpl#getPageHtml(PageContext, HttpServletRequest, HttpServletResponse)}\n+     * Given Scenario: Create a page with File Container liked with relative path in the template\n+     * ExpectedResult: should work\n+     *\n+     * @throws Exception\n+     */\n+    @Test\n+    public void shouldRenderRelativeContainerPath() throws Exception {\n+\n+        final FileAssetContainer container = createFileContainer();\n+        final Template template = new TemplateDataGen().title(\"PageContextBuilderTemplate\"+System.currentTimeMillis())\n+                .host(site)\n+                .withContainer(container.getPath(), UUID)\n+                .nextPersisted();\n+        PublishFactory.publishAsset(template, systemUser, false, false);\n+\n+        final String pageName = \"testPage-\"+System.currentTimeMillis();\n+        final HTMLPageAsset pageEnglishVersion = createHtmlPageAsset(template, pageName, 1);\n+\n+        createMultiTree(pageEnglishVersion.getIdentifier(), container.getIdentifier());\n+\n+        final HttpServletRequest mockRequest = createHttpServletRequest(pageEnglishVersion);\n+        Mockito.when(mockRequest.getParameter(WebKeys.PAGE_MODE_PARAMETER)).thenReturn(PageMode.LIVE.toString());\n+\n+        final HttpServletResponse mockResponse = mock(HttpServletResponse.class);\n+        final HttpSession session = createHttpSession(mockRequest);\n+        Mockito.when(session.getAttribute(WebKeys.VISITOR)).thenReturn(null);\n+        Mockito.when(session.getAttribute(WebKeys.CMS_USER)).thenReturn(systemUser);\n+\n+        final String html = APILocator.getHTMLPageAssetRenderedAPI().getPageHtml(\n+                PageContextBuilder.builder()\n+                        .setUser(systemUser)\n+                        .setPageUri(pageEnglishVersion.getURI())\n+                        .setPageMode(PageMode.LIVE)\n+                        .build(),\n+                mockRequest, mockResponse);\n+\n+        Assert.assertEquals(\"content2content1\", html);\n+    }\n+\n+    /**\n+     * Method to test: {@link com.dotmarketing.portlets.htmlpageasset.business.render.HTMLPageAssetRenderedAPIImpl#getPageHtml(PageContext, HttpServletRequest, HttpServletResponse)}\n+     * Given Scenario: Create a page and a advance template using a File Container in another site\n+     * ExpectedResult: should work\n+     *\n+     * @throws Exception\n+     */\n+    @Test\n+    public void shouldRenderUsingOtherSiteContainer() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b575ead97282c128ee92adfbb3e90459d47c000b"}, "originalPosition": 729}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3Nzk0MTcxOnYy", "diffSide": "RIGHT", "path": "dotCMS/src/integration-test/java/com/dotcms/datagen/ContainerAsFileDataGen.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNzowNTozMlrOFuNzkA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNzowNTozMlrOFuNzkA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDAwNTAwOA==", "bodyText": "Issue found: Private field 'content' could be made final; it is only initialized in the declaration or constructor.", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384005008", "createdAt": "2020-02-25T17:05:32Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/datagen/ContainerAsFileDataGen.java", "diffHunk": "@@ -20,16 +20,32 @@\n import java.util.Arrays;\n import java.util.List;\n import java.util.Set;\n+import java.util.stream.Collectors;\n \n public class ContainerAsFileDataGen extends AbstractDataGen<FileAssetContainer> {\n \n+    private class ContentTypeContent {\n+        private ContentType contentType;\n+        private String content;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b575ead97282c128ee92adfbb3e90459d47c000b"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3Nzk0MTg4OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNzowNTozNVrOFuNzsg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNzowNTozNVrOFuNzsg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDAwNTA0Mg==", "bodyText": "Issue found: The String literal \"PageContextBuilderTemplate\" appears 4 times in this file; the first occurrence is on line 108", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384005042", "createdAt": "2020-02-25T17:05:35Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "diffHunk": "@@ -79,9 +85,88 @@\n     private static Persona persona;\n     private static Visitor visitor;\n \n+    @DataProvider\n+    public static Object[][] cases() throws Exception {\n+        if (systemUser == null) {\n+            prepareGlobalData();\n+        }\n+\n+        final Container container = createContainer();\n+        final Template templateContainer = createTemplate(container);\n+\n+        final Container fileContainer = createFileContainer();\n+        final Template templateFileContainer = createTemplate(fileContainer);\n+\n+        return new Object[][] {\n+                { container, templateContainer },\n+                { fileContainer, templateFileContainer}\n+        };\n+    }\n+\n+    private static Template createTemplate(final Container container) throws DotSecurityException, WebAssetException, DotDataException {\n+        final Template template = new TemplateDataGen().title(\"PageContextBuilderTemplate\"+System.currentTimeMillis())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b575ead97282c128ee92adfbb3e90459d47c000b"}, "originalPosition": 75}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3Nzk0MjA3OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNzowNTozN1rOFuNzyQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNzowNTozN1rOFuNzyQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDAwNTA2NQ==", "bodyText": "Issue found: A method/constructor should not explicitly throw java.lang.Exception", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384005065", "createdAt": "2020-02-25T17:05:37Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "diffHunk": "@@ -976,7 +1016,11 @@ public void shouldReturnPageHTMLForPersona() throws Exception{\n      * @throws Exception\n      */\n     @Test\n-    public void shouldReturnPageHTMLForLegacyUUID() throws Exception {\n+    @UseDataProvider(\"cases\")\n+    public void shouldReturnPageHTMLForLegacyUUID(final Container container, final Template templateTestCase) throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b575ead97282c128ee92adfbb3e90459d47c000b"}, "originalPosition": 592}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3Nzk0MjE4OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNzowNTozOVrOFuNz1Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQyMjozNjo1OVrOFuX0Xw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDAwNTA3Nw==", "bodyText": "Issue found: A method/constructor should not explicitly throw java.lang.Exception", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384005077", "createdAt": "2020-02-25T17:05:39Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "diffHunk": "@@ -532,18 +583,14 @@ public void ContentFallbackFalse_PageFallbackFalse_PageEnglish_ViewEnglishConten\n      *\n      */\n     @Test\n-    public void ContentFallbackFalse_PageFallbackFalse_PageEnglishAndSpanish_ViewEnglishContent1And2_ViewSpanishContent2And3() throws Exception{\n+    @UseDataProvider(\"cases\")\n+    public void ContentFallbackFalse_PageFallbackFalse_PageEnglishAndSpanish_ViewEnglishContent1And2_ViewSpanishContent2And3(final Container container, final Template template) throws Exception{", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b575ead97282c128ee92adfbb3e90459d47c000b"}, "originalPosition": 376}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDE2OTA1NQ==", "bodyText": "same here", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384169055", "createdAt": "2020-02-25T22:36:59Z", "author": {"login": "nollymar"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "diffHunk": "@@ -532,18 +583,14 @@ public void ContentFallbackFalse_PageFallbackFalse_PageEnglish_ViewEnglishConten\n      *\n      */\n     @Test\n-    public void ContentFallbackFalse_PageFallbackFalse_PageEnglishAndSpanish_ViewEnglishContent1And2_ViewSpanishContent2And3() throws Exception{\n+    @UseDataProvider(\"cases\")\n+    public void ContentFallbackFalse_PageFallbackFalse_PageEnglishAndSpanish_ViewEnglishContent1And2_ViewSpanishContent2And3(final Container container, final Template template) throws Exception{", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDAwNTA3Nw=="}, "originalCommit": {"oid": "b575ead97282c128ee92adfbb3e90459d47c000b"}, "originalPosition": 376}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3Nzk0MjQ1OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/main/java/com/dotmarketing/business/web/HostWebAPI.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNzowNTo0M1rOFuNz_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQyMDozNjozMlrOFuUVQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDAwNTExNw==", "bodyText": "Issue found: Unnecessary modifier 'public' on method 'getCurrentHost': the method is declared in an interface type", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384005117", "createdAt": "2020-02-25T17:05:43Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/main/java/com/dotmarketing/business/web/HostWebAPI.java", "diffHunk": "@@ -31,6 +31,8 @@\n \t\r\n \tpublic Host getCurrentHost(HttpServletRequest req) throws DotDataException, DotSecurityException, PortalException, SystemException;\r\n \r\n+\tpublic Host getCurrentHost() throws DotDataException, DotSecurityException;\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b575ead97282c128ee92adfbb3e90459d47c000b"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA0NzA5Mg==", "bodyText": "Doc", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384047092", "createdAt": "2020-02-25T18:33:27Z", "author": {"login": "jdotcms"}, "path": "dotCMS/src/main/java/com/dotmarketing/business/web/HostWebAPI.java", "diffHunk": "@@ -31,6 +31,8 @@\n \t\r\n \tpublic Host getCurrentHost(HttpServletRequest req) throws DotDataException, DotSecurityException, PortalException, SystemException;\r\n \r\n+\tpublic Host getCurrentHost() throws DotDataException, DotSecurityException;\r", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDAwNTExNw=="}, "originalCommit": {"oid": "b575ead97282c128ee92adfbb3e90459d47c000b"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDExMTkzNw==", "bodyText": "done 286b9c0#diff-875569de59a68af429a7ac46a979b1d9R40", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384111937", "createdAt": "2020-02-25T20:36:32Z", "author": {"login": "freddyucv"}, "path": "dotCMS/src/main/java/com/dotmarketing/business/web/HostWebAPI.java", "diffHunk": "@@ -31,6 +31,8 @@\n \t\r\n \tpublic Host getCurrentHost(HttpServletRequest req) throws DotDataException, DotSecurityException, PortalException, SystemException;\r\n \r\n+\tpublic Host getCurrentHost() throws DotDataException, DotSecurityException;\r", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDAwNTExNw=="}, "originalCommit": {"oid": "b575ead97282c128ee92adfbb3e90459d47c000b"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3Nzk0MjYzOnYy", "diffSide": "RIGHT", "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNzowNTo0NlrOFuN0Ig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNzowNTo0NlrOFuN0Ig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDAwNTE1NA==", "bodyText": "Issue found: A method/constructor should not explicitly throw java.lang.Exception", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384005154", "createdAt": "2020-02-25T17:05:46Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "diffHunk": "@@ -79,9 +85,88 @@\n     private static Persona persona;\n     private static Visitor visitor;\n \n+    @DataProvider\n+    public static Object[][] cases() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b575ead97282c128ee92adfbb3e90459d47c000b"}, "originalPosition": 57}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3Nzk0Mjg2OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNzowNTo0OVrOFuN0QA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNzowNTo0OVrOFuN0QA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDAwNTE4NA==", "bodyText": "Issue found: A method/constructor should not explicitly throw java.lang.Exception", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384005184", "createdAt": "2020-02-25T17:05:49Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "diffHunk": "@@ -1132,6 +1160,151 @@ public void shouldReturnParserContainerUUID() throws Exception {\n         Assert.assertTrue(html.matches(regexExpected));\n     }\n \n+    /**\n+     * Method to test: {@link com.dotmarketing.portlets.htmlpageasset.business.render.HTMLPageAssetRenderedAPIImpl#getPageHtml(PageContext, HttpServletRequest, HttpServletResponse)}\n+     * Given Scenario: Create a page with File Container liked with relative path in the template\n+     * ExpectedResult: should work\n+     *\n+     * @throws Exception\n+     */\n+    @Test\n+    public void shouldRenderRelativeContainerPath() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b575ead97282c128ee92adfbb3e90459d47c000b"}, "originalPosition": 688}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3Nzk0MzE0OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNzowNTo1MFrOFuN0Vg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNzowNTo1MFrOFuN0Vg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDAwNTIwNg==", "bodyText": "Issue found: A method/constructor should not explicitly throw java.lang.Exception", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384005206", "createdAt": "2020-02-25T17:05:50Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "diffHunk": "@@ -1029,7 +1070,10 @@ public void shouldReturnPageHTMLForLegacyUUID() throws Exception {\n      * @throws Exception\n      */\n     @Test\n-    public void shouldReturnPageHTMLForLegacyUUIDAndMultiTree() throws Exception {\n+    @UseDataProvider(\"cases\")\n+    public void shouldReturnPageHTMLForLegacyUUIDAndMultiTree(final Container container, final Template templateTestCase) throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b575ead97282c128ee92adfbb3e90459d47c000b"}, "originalPosition": 617}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3ODA2ODg3OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/main/java/com/dotcms/rendering/velocity/directive/TemplatePathStrategyResolver.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxNzozNjowNFrOFuO-eA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQyMDozNjo1N1rOFuUWAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDAyNDE4NA==", "bodyText": "remove this, won't work on java 11", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384024184", "createdAt": "2020-02-25T17:36:04Z", "author": {"login": "jdotcms"}, "path": "dotCMS/src/main/java/com/dotcms/rendering/velocity/directive/TemplatePathStrategyResolver.java", "diffHunk": "@@ -137,31 +138,39 @@ private boolean isPath (final String templatePath) {\n         }\n \n         private String getPath(final RenderParams params, final String path, final String uid) {\n-\n-\n-            final Host host     = params.currentHost;\n-            String templatePath = path;\n-\n-\n             try {\n-\n-                templatePath =(!templatePath.startsWith(HOST_INDICATOR))?\n-                        builder(FORWARD_SLASH, params.mode.name(), FORWARD_SLASH, HOST_INDICATOR,\n-                            this.getHost(host).getHostname(), path.startsWith(FORWARD_SLASH)? StringPool.BLANK:FORWARD_SLASH,\n-                            path, FORWARD_SLASH, uid, PERIOD, VelocityType.CONTAINER.fileExtension).toString():\n-\n-                        builder(FORWARD_SLASH, params.mode.name(), FORWARD_SLASH,\n-                            path, FORWARD_SLASH, uid, PERIOD, VelocityType.CONTAINER.fileExtension).toString();\n+                return FileAssetContainerUtil.getInstance().isFullPath(path) ?\n+                        getContainerResourcePathFromFullPath(params, path, uid) :\n+                        getContainerResourceFromRelativePath(params, path, uid);\n             } catch (Exception e) {\n \n-                Logger.warn(this.getClass(), \" - unable to resolve \" + templatePath + \" getting this: \"+ e.getMessage() );\n+                Logger.warn(this.getClass(), \" - unable to resolve \" + path + \" getting this: \"+ e.getMessage() );\n                 if(e.getStackTrace().length>0) {\n                     Logger.warn(this.getClass(), \" - at \" + e.getStackTrace()[0]);\n                 }\n                 throw new DotStateException(e);\n             }\n+        }\n+\n+        @NotNull", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b575ead97282c128ee92adfbb3e90459d47c000b"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDExMjEyOQ==", "bodyText": "done 286b9c0#diff-852b80877a8a40dd946126a363d2dc76L155", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384112129", "createdAt": "2020-02-25T20:36:57Z", "author": {"login": "freddyucv"}, "path": "dotCMS/src/main/java/com/dotcms/rendering/velocity/directive/TemplatePathStrategyResolver.java", "diffHunk": "@@ -137,31 +138,39 @@ private boolean isPath (final String templatePath) {\n         }\n \n         private String getPath(final RenderParams params, final String path, final String uid) {\n-\n-\n-            final Host host     = params.currentHost;\n-            String templatePath = path;\n-\n-\n             try {\n-\n-                templatePath =(!templatePath.startsWith(HOST_INDICATOR))?\n-                        builder(FORWARD_SLASH, params.mode.name(), FORWARD_SLASH, HOST_INDICATOR,\n-                            this.getHost(host).getHostname(), path.startsWith(FORWARD_SLASH)? StringPool.BLANK:FORWARD_SLASH,\n-                            path, FORWARD_SLASH, uid, PERIOD, VelocityType.CONTAINER.fileExtension).toString():\n-\n-                        builder(FORWARD_SLASH, params.mode.name(), FORWARD_SLASH,\n-                            path, FORWARD_SLASH, uid, PERIOD, VelocityType.CONTAINER.fileExtension).toString();\n+                return FileAssetContainerUtil.getInstance().isFullPath(path) ?\n+                        getContainerResourcePathFromFullPath(params, path, uid) :\n+                        getContainerResourceFromRelativePath(params, path, uid);\n             } catch (Exception e) {\n \n-                Logger.warn(this.getClass(), \" - unable to resolve \" + templatePath + \" getting this: \"+ e.getMessage() );\n+                Logger.warn(this.getClass(), \" - unable to resolve \" + path + \" getting this: \"+ e.getMessage() );\n                 if(e.getStackTrace().length>0) {\n                     Logger.warn(this.getClass(), \" - at \" + e.getStackTrace()[0]);\n                 }\n                 throw new DotStateException(e);\n             }\n+        }\n+\n+        @NotNull", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDAyNDE4NA=="}, "originalCommit": {"oid": "b575ead97282c128ee92adfbb3e90459d47c000b"}, "originalPosition": 41}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3ODE1ODg2OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/integration-test/java/com/dotcms/datagen/TemplateDataGen.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxODoxNzowMFrOFuP0uA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxODoyOTo0MlrOFuQP2A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDAzODA3Mg==", "bodyText": "Isn't a more descriptive (business logic) name instead of \"UUID\" ?", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384038072", "createdAt": "2020-02-25T18:17:00Z", "author": {"login": "dsilvam"}, "path": "dotCMS/src/integration-test/java/com/dotcms/datagen/TemplateDataGen.java", "diffHunk": "@@ -167,6 +169,16 @@ public TemplateDataGen withContainer(final String containerId, final String UUID\n         return this;\n     }\n \n+    public TemplateDataGen withContainer(final Container container, final String UUID) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b575ead97282c128ee92adfbb3e90459d47c000b"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA0NTAxNg==", "bodyText": "Yes, but it already is named UUID everywhere", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384045016", "createdAt": "2020-02-25T18:29:42Z", "author": {"login": "freddyucv"}, "path": "dotCMS/src/integration-test/java/com/dotcms/datagen/TemplateDataGen.java", "diffHunk": "@@ -167,6 +169,16 @@ public TemplateDataGen withContainer(final String containerId, final String UUID\n         return this;\n     }\n \n+    public TemplateDataGen withContainer(final Container container, final String UUID) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDAzODA3Mg=="}, "originalCommit": {"oid": "b575ead97282c128ee92adfbb3e90459d47c000b"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3ODE5NTczOnYy", "diffSide": "RIGHT", "path": "dotCMS/src/main/java/com/dotcms/rendering/velocity/services/PageRenderUtil.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxODoyNzo1MVrOFuQLwA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQyMDozNzozNlrOFuUXGA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA0Mzk2OA==", "bodyText": "Not sure why use the implementation rather the interface", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384043968", "createdAt": "2020-02-25T18:27:51Z", "author": {"login": "jdotcms"}, "path": "dotCMS/src/main/java/com/dotcms/rendering/velocity/services/PageRenderUtil.java", "diffHunk": "@@ -81,7 +74,7 @@\n     private final TagAPI        tagAPI        = APILocator.getTagAPI();\n     private final PersonaAPI    personaAPI    = APILocator.getPersonaAPI();\n \n-    final IHTMLPage htmlPage;\n+    final HTMLPageAsset htmlPage;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b575ead97282c128ee92adfbb3e90459d47c000b"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA0NTUxMA==", "bodyText": "because I need get the site here\nhttps://github.com/dotCMS/core/pull/18033/files#diffc7538880be24298c9c76f10f1c8efaffR112", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384045510", "createdAt": "2020-02-25T18:30:34Z", "author": {"login": "freddyucv"}, "path": "dotCMS/src/main/java/com/dotcms/rendering/velocity/services/PageRenderUtil.java", "diffHunk": "@@ -81,7 +74,7 @@\n     private final TagAPI        tagAPI        = APILocator.getTagAPI();\n     private final PersonaAPI    personaAPI    = APILocator.getPersonaAPI();\n \n-    final IHTMLPage htmlPage;\n+    final HTMLPageAsset htmlPage;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA0Mzk2OA=="}, "originalCommit": {"oid": "b575ead97282c128ee92adfbb3e90459d47c000b"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDExMjQwOA==", "bodyText": "done 286b9c0#diff-c7538880be24298c9c76f10f1c8efaffR92\n286b9c0#diff-2c7c10f84439ab07f53fa4dda91df2dcR23", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384112408", "createdAt": "2020-02-25T20:37:36Z", "author": {"login": "freddyucv"}, "path": "dotCMS/src/main/java/com/dotcms/rendering/velocity/services/PageRenderUtil.java", "diffHunk": "@@ -81,7 +74,7 @@\n     private final TagAPI        tagAPI        = APILocator.getTagAPI();\n     private final PersonaAPI    personaAPI    = APILocator.getPersonaAPI();\n \n-    final IHTMLPage htmlPage;\n+    final HTMLPageAsset htmlPage;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA0Mzk2OA=="}, "originalCommit": {"oid": "b575ead97282c128ee92adfbb3e90459d47c000b"}, "originalPosition": 53}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3ODE5ODgwOnYy", "diffSide": "RIGHT", "path": "dotCMS/src/main/java/com/dotcms/util/pagination/ContainerPaginator.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxODoyODozN1rOFuQNkA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQyMDozNzo1NFrOFuUXoA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA0NDQzMg==", "bodyText": "Java 11 does not like, remove it", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384044432", "createdAt": "2020-02-25T18:28:37Z", "author": {"login": "jdotcms"}, "path": "dotCMS/src/main/java/com/dotcms/util/pagination/ContainerPaginator.java", "diffHunk": "@@ -4,42 +4,50 @@\n import com.dotmarketing.beans.Host;\n import com.dotmarketing.beans.Source;\n import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.business.web.HostWebAPI;\n+import com.dotmarketing.business.web.WebAPILocator;\n import com.dotmarketing.exception.DotDataException;\n import com.dotmarketing.exception.DotSecurityException;\n import com.dotmarketing.portlets.containers.business.ContainerAPI;\n import com.dotmarketing.portlets.containers.model.Container;\n+import com.dotmarketing.portlets.containers.model.ContainerView;\n import com.dotmarketing.util.PaginatedArrayList;\n import com.dotmarketing.util.UtilMethods;\n import com.liferay.portal.model.User;\n import com.liferay.util.StringPool;\n+import org.jetbrains.annotations.NotNull;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b575ead97282c128ee92adfbb3e90459d47c000b"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDExMjU0NA==", "bodyText": "done 286b9c0#diff-065ef3642f4836c3f53832552ac1ef02L18", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384112544", "createdAt": "2020-02-25T20:37:54Z", "author": {"login": "freddyucv"}, "path": "dotCMS/src/main/java/com/dotcms/util/pagination/ContainerPaginator.java", "diffHunk": "@@ -4,42 +4,50 @@\n import com.dotmarketing.beans.Host;\n import com.dotmarketing.beans.Source;\n import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.business.web.HostWebAPI;\n+import com.dotmarketing.business.web.WebAPILocator;\n import com.dotmarketing.exception.DotDataException;\n import com.dotmarketing.exception.DotSecurityException;\n import com.dotmarketing.portlets.containers.business.ContainerAPI;\n import com.dotmarketing.portlets.containers.model.Container;\n+import com.dotmarketing.portlets.containers.model.ContainerView;\n import com.dotmarketing.util.PaginatedArrayList;\n import com.dotmarketing.util.UtilMethods;\n import com.liferay.portal.model.User;\n import com.liferay.util.StringPool;\n+import org.jetbrains.annotations.NotNull;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA0NDQzMg=="}, "originalCommit": {"oid": "b575ead97282c128ee92adfbb3e90459d47c000b"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3ODIwNzk2OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/main/java/com/dotcms/util/pagination/ContainerPaginator.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxODozMTowNFrOFuQS9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxODozMToyOFrOFuQT1w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA0NTgxMw==", "bodyText": "Log me", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384045813", "createdAt": "2020-02-25T18:31:04Z", "author": {"login": "jdotcms"}, "path": "dotCMS/src/main/java/com/dotcms/util/pagination/ContainerPaginator.java", "diffHunk": "@@ -62,45 +70,74 @@ public ContainerPaginator(final ContainerAPI containerAPI) {\n                     (PaginatedArrayList<Container>) containerAPI.findContainers(user, false, params, hostId,\n                     null, null, null, offset, limit, orderByDirection);\n \n-            if (!UtilMethods.isSet(hostId)) {\n+            final PaginatedArrayList<Container> containers = !UtilMethods.isSet(hostId)\n+                    ? sortByTypeAndHost(direction, allContainers) : allContainers;\n \n-                final List<Container> fileContainers = new ArrayList<>();\n-                final List<Container> dbContainers   = new ArrayList<>();\n-\n-                for (final Container container : allContainers) {\n-\n-                    if (container.getSource() == Source.DB) {\n+            return createContainerView(containers);\n+        } catch (DotSecurityException | DotDataException e) {\n+            throw new PaginationException(e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b575ead97282c128ee92adfbb3e90459d47c000b"}, "originalPosition": 70}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA0NjAzOQ==", "bodyText": "Here the exception is been throwing", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384046039", "createdAt": "2020-02-25T18:31:28Z", "author": {"login": "freddyucv"}, "path": "dotCMS/src/main/java/com/dotcms/util/pagination/ContainerPaginator.java", "diffHunk": "@@ -62,45 +70,74 @@ public ContainerPaginator(final ContainerAPI containerAPI) {\n                     (PaginatedArrayList<Container>) containerAPI.findContainers(user, false, params, hostId,\n                     null, null, null, offset, limit, orderByDirection);\n \n-            if (!UtilMethods.isSet(hostId)) {\n+            final PaginatedArrayList<Container> containers = !UtilMethods.isSet(hostId)\n+                    ? sortByTypeAndHost(direction, allContainers) : allContainers;\n \n-                final List<Container> fileContainers = new ArrayList<>();\n-                final List<Container> dbContainers   = new ArrayList<>();\n-\n-                for (final Container container : allContainers) {\n-\n-                    if (container.getSource() == Source.DB) {\n+            return createContainerView(containers);\n+        } catch (DotSecurityException | DotDataException e) {\n+            throw new PaginationException(e);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA0NTgxMw=="}, "originalCommit": {"oid": "b575ead97282c128ee92adfbb3e90459d47c000b"}, "originalPosition": 70}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3ODIzMDQ5OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxODozNzozMlrOFuQg6g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQyMjozNDo1NFrOFuXwgg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA0OTM4Ng==", "bodyText": "I would add javadoc explaining better the given scenario and expected result", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384049386", "createdAt": "2020-02-25T18:37:32Z", "author": {"login": "dsilvam"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "diffHunk": "@@ -282,20 +335,16 @@ public static void restore() throws Exception{\n      *\n      */\n     @Test\n-    public void ContentFallbackFalse_PageFallbackTrue_PageEnglish_ViewEnglishContent1And2_ViewSpanishContent2And3() throws Exception{\n+    @UseDataProvider(\"cases\")\n+    public void ContentFallbackFalse_PageFallbackTrue_PageEnglish_ViewEnglishContent1And2_ViewSpanishContent2And3(final Container container, final Template template) throws Exception{", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b575ead97282c128ee92adfbb3e90459d47c000b"}, "originalPosition": 245}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA1Mjc4MQ==", "bodyText": "this test is not new", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384052781", "createdAt": "2020-02-25T18:43:52Z", "author": {"login": "freddyucv"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "diffHunk": "@@ -282,20 +335,16 @@ public static void restore() throws Exception{\n      *\n      */\n     @Test\n-    public void ContentFallbackFalse_PageFallbackTrue_PageEnglish_ViewEnglishContent1And2_ViewSpanishContent2And3() throws Exception{\n+    @UseDataProvider(\"cases\")\n+    public void ContentFallbackFalse_PageFallbackTrue_PageEnglish_ViewEnglishContent1And2_ViewSpanishContent2And3(final Container container, final Template template) throws Exception{", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA0OTM4Ng=="}, "originalCommit": {"oid": "b575ead97282c128ee92adfbb3e90459d47c000b"}, "originalPosition": 245}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDE2ODA2Ng==", "bodyText": "do you know what the test does? If so, I would add the javadoc because the name is very long and not clear", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384168066", "createdAt": "2020-02-25T22:34:54Z", "author": {"login": "nollymar"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "diffHunk": "@@ -282,20 +335,16 @@ public static void restore() throws Exception{\n      *\n      */\n     @Test\n-    public void ContentFallbackFalse_PageFallbackTrue_PageEnglish_ViewEnglishContent1And2_ViewSpanishContent2And3() throws Exception{\n+    @UseDataProvider(\"cases\")\n+    public void ContentFallbackFalse_PageFallbackTrue_PageEnglish_ViewEnglishContent1And2_ViewSpanishContent2And3(final Container container, final Template template) throws Exception{", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA0OTM4Ng=="}, "originalCommit": {"oid": "b575ead97282c128ee92adfbb3e90459d47c000b"}, "originalPosition": 245}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3ODIzMzE2OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxODozODoxNFrOFuQimg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxODo0Mzo1N1rOFuQuUw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA0OTgxOA==", "bodyText": "I would add javadoc explaining better the given scenario and expected result", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384049818", "createdAt": "2020-02-25T18:38:14Z", "author": {"login": "dsilvam"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "diffHunk": "@@ -341,18 +406,14 @@ public void ContentFallbackFalse_PageFallbackTrue_PageEnglish_ViewEnglishContent\n      *\n      */\n     @Test\n-    public void ContentFallbackFalse_PageFallbackTrue_PageEnglishAndSpanish_ViewEnglishContent1And2_ViewSpanishContent2And3() throws Exception{\n+    @UseDataProvider(\"cases\")\n+    public void ContentFallbackFalse_PageFallbackTrue_PageEnglishAndSpanish_ViewEnglishContent1And2_ViewSpanishContent2And3(final Container container, final Template template) throws Exception{", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b575ead97282c128ee92adfbb3e90459d47c000b"}, "originalPosition": 293}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA1MjgxOQ==", "bodyText": "this test is not new", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384052819", "createdAt": "2020-02-25T18:43:57Z", "author": {"login": "freddyucv"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "diffHunk": "@@ -341,18 +406,14 @@ public void ContentFallbackFalse_PageFallbackTrue_PageEnglish_ViewEnglishContent\n      *\n      */\n     @Test\n-    public void ContentFallbackFalse_PageFallbackTrue_PageEnglishAndSpanish_ViewEnglishContent1And2_ViewSpanishContent2And3() throws Exception{\n+    @UseDataProvider(\"cases\")\n+    public void ContentFallbackFalse_PageFallbackTrue_PageEnglishAndSpanish_ViewEnglishContent1And2_ViewSpanishContent2And3(final Container container, final Template template) throws Exception{", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA0OTgxOA=="}, "originalCommit": {"oid": "b575ead97282c128ee92adfbb3e90459d47c000b"}, "originalPosition": 293}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3ODIzNDUyOnYy", "diffSide": "RIGHT", "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxODozODozNVrOFuQjYA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQyMjozNjoyN1rOFuXzfQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA1MDAxNg==", "bodyText": "I would add javadoc explaining better the given scenario and expected result", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384050016", "createdAt": "2020-02-25T18:38:35Z", "author": {"login": "dsilvam"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "diffHunk": "@@ -416,22 +477,16 @@ public void ContentFallbackFalse_PageFallbackTrue_PageEnglishAndSpanish_ViewEngl\n      * @throws Exception\n      */\n     @Test (expected = HTMLPageAssetNotFoundException.class)\n-    public void ContentFallbackFalse_PageFallbackTrue_PageSpanish_ViewEnglish404_ViewSpanishContent2And3() throws Exception{\n+    @UseDataProvider(\"cases\")\n+    public void ContentFallbackFalse_PageFallbackTrue_PageSpanish_ViewEnglish404_ViewSpanishContent2And3(final Container container, final Template template) throws Exception{", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b575ead97282c128ee92adfbb3e90459d47c000b"}, "originalPosition": 324}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA1Mjg3NQ==", "bodyText": "this test is not new", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384052875", "createdAt": "2020-02-25T18:44:01Z", "author": {"login": "freddyucv"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "diffHunk": "@@ -416,22 +477,16 @@ public void ContentFallbackFalse_PageFallbackTrue_PageEnglishAndSpanish_ViewEngl\n      * @throws Exception\n      */\n     @Test (expected = HTMLPageAssetNotFoundException.class)\n-    public void ContentFallbackFalse_PageFallbackTrue_PageSpanish_ViewEnglish404_ViewSpanishContent2And3() throws Exception{\n+    @UseDataProvider(\"cases\")\n+    public void ContentFallbackFalse_PageFallbackTrue_PageSpanish_ViewEnglish404_ViewSpanishContent2And3(final Container container, final Template template) throws Exception{", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA1MDAxNg=="}, "originalCommit": {"oid": "b575ead97282c128ee92adfbb3e90459d47c000b"}, "originalPosition": 324}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDE2ODgyOQ==", "bodyText": "same here, if you know what the test does, please add the javadoc", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384168829", "createdAt": "2020-02-25T22:36:27Z", "author": {"login": "nollymar"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "diffHunk": "@@ -416,22 +477,16 @@ public void ContentFallbackFalse_PageFallbackTrue_PageEnglishAndSpanish_ViewEngl\n      * @throws Exception\n      */\n     @Test (expected = HTMLPageAssetNotFoundException.class)\n-    public void ContentFallbackFalse_PageFallbackTrue_PageSpanish_ViewEnglish404_ViewSpanishContent2And3() throws Exception{\n+    @UseDataProvider(\"cases\")\n+    public void ContentFallbackFalse_PageFallbackTrue_PageSpanish_ViewEnglish404_ViewSpanishContent2And3(final Container container, final Template template) throws Exception{", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA1MDAxNg=="}, "originalCommit": {"oid": "b575ead97282c128ee92adfbb3e90459d47c000b"}, "originalPosition": 324}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3ODIzNTA1OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxODozODo0NlrOFuQjvA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxODo0NDowNlrOFuQuvw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA1MDEwOA==", "bodyText": "I would add javadoc explaining better the given scenario and expected result", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384050108", "createdAt": "2020-02-25T18:38:46Z", "author": {"login": "dsilvam"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "diffHunk": "@@ -475,20 +530,16 @@ public void ContentFallbackFalse_PageFallbackTrue_PageSpanish_ViewEnglish404_Vie\n      *\n      */\n     @Test (expected = HTMLPageAssetNotFoundException.class)\n-    public void ContentFallbackFalse_PageFallbackFalse_PageEnglish_ViewEnglishContent1And2_ViewSpanish404() throws Exception{\n+    @UseDataProvider(\"cases\")\n+    public void ContentFallbackFalse_PageFallbackFalse_PageEnglish_ViewEnglishContent1And2_ViewSpanish404(final Container container, final Template template) throws Exception{", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b575ead97282c128ee92adfbb3e90459d47c000b"}, "originalPosition": 351}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA1MjkyNw==", "bodyText": "this test is not new", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384052927", "createdAt": "2020-02-25T18:44:06Z", "author": {"login": "freddyucv"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "diffHunk": "@@ -475,20 +530,16 @@ public void ContentFallbackFalse_PageFallbackTrue_PageSpanish_ViewEnglish404_Vie\n      *\n      */\n     @Test (expected = HTMLPageAssetNotFoundException.class)\n-    public void ContentFallbackFalse_PageFallbackFalse_PageEnglish_ViewEnglishContent1And2_ViewSpanish404() throws Exception{\n+    @UseDataProvider(\"cases\")\n+    public void ContentFallbackFalse_PageFallbackFalse_PageEnglish_ViewEnglishContent1And2_ViewSpanish404(final Container container, final Template template) throws Exception{", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA1MDEwOA=="}, "originalCommit": {"oid": "b575ead97282c128ee92adfbb3e90459d47c000b"}, "originalPosition": 351}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3ODI4NTc3OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/main/java/com/dotmarketing/portlets/containers/business/FileAssetContainerUtil.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxODo1Mjo1NFrOFuRCsw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQyMDozODoyMlrOFuUYYA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA1ODAzNQ==", "bodyText": "warnAndDebug?", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384058035", "createdAt": "2020-02-25T18:52:54Z", "author": {"login": "dsilvam"}, "path": "dotCMS/src/main/java/com/dotmarketing/portlets/containers/business/FileAssetContainerUtil.java", "diffHunk": "@@ -165,10 +171,18 @@ public String getContainerIdFromPath(final String fullPath) throws DotDataExcept\n         if (null == host) {\n \n             try {\n-                host = APILocator.getHostAPI().findDefaultHost(APILocator.systemUser(), false);\n-            } catch (DotDataException | DotSecurityException e) {\n-                host = APILocator.systemHost();\n+                host = WebAPILocator.getHostWebAPI()\n+                        .getCurrentHost(HttpServletRequestThreadLocal.INSTANCE.getRequest());\n+            } catch (DotSecurityException | PortalException | SystemException e) {\n+                Logger.debug(FileAssetContainerUtil.class, e.getMessage());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b575ead97282c128ee92adfbb3e90459d47c000b"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDExMjczNg==", "bodyText": "done 286b9c0#diff-1854786c11c9b31c822e5b175c0f47c4R177", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384112736", "createdAt": "2020-02-25T20:38:22Z", "author": {"login": "freddyucv"}, "path": "dotCMS/src/main/java/com/dotmarketing/portlets/containers/business/FileAssetContainerUtil.java", "diffHunk": "@@ -165,10 +171,18 @@ public String getContainerIdFromPath(final String fullPath) throws DotDataExcept\n         if (null == host) {\n \n             try {\n-                host = APILocator.getHostAPI().findDefaultHost(APILocator.systemUser(), false);\n-            } catch (DotDataException | DotSecurityException e) {\n-                host = APILocator.systemHost();\n+                host = WebAPILocator.getHostWebAPI()\n+                        .getCurrentHost(HttpServletRequestThreadLocal.INSTANCE.getRequest());\n+            } catch (DotSecurityException | PortalException | SystemException e) {\n+                Logger.debug(FileAssetContainerUtil.class, e.getMessage());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA1ODAzNQ=="}, "originalCommit": {"oid": "b575ead97282c128ee92adfbb3e90459d47c000b"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3ODI4NjM4OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/main/java/com/dotmarketing/portlets/containers/business/FileAssetContainerUtil.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxODo1MzowNVrOFuRDGw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQyMDozODozMlrOFuUYuw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA1ODEzOQ==", "bodyText": "warnAndDebug?", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384058139", "createdAt": "2020-02-25T18:53:05Z", "author": {"login": "dsilvam"}, "path": "dotCMS/src/main/java/com/dotmarketing/portlets/containers/business/FileAssetContainerUtil.java", "diffHunk": "@@ -165,10 +171,18 @@ public String getContainerIdFromPath(final String fullPath) throws DotDataExcept\n         if (null == host) {\n \n             try {\n-                host = APILocator.getHostAPI().findDefaultHost(APILocator.systemUser(), false);\n-            } catch (DotDataException | DotSecurityException e) {\n-                host = APILocator.systemHost();\n+                host = WebAPILocator.getHostWebAPI()\n+                        .getCurrentHost(HttpServletRequestThreadLocal.INSTANCE.getRequest());\n+            } catch (DotSecurityException | PortalException | SystemException e) {\n+                Logger.debug(FileAssetContainerUtil.class, e.getMessage());\n+                try {\n+                    host = APILocator.getHostAPI().findDefaultHost(APILocator.systemUser(), false);\n+                } catch (DotDataException | DotSecurityException ex) {\n+                    Logger.debug(FileAssetContainerUtil.class, e.getMessage());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b575ead97282c128ee92adfbb3e90459d47c000b"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDExMjgyNw==", "bodyText": "done 286b9c0#diff-1854786c11c9b31c822e5b175c0f47c4R181", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384112827", "createdAt": "2020-02-25T20:38:32Z", "author": {"login": "freddyucv"}, "path": "dotCMS/src/main/java/com/dotmarketing/portlets/containers/business/FileAssetContainerUtil.java", "diffHunk": "@@ -165,10 +171,18 @@ public String getContainerIdFromPath(final String fullPath) throws DotDataExcept\n         if (null == host) {\n \n             try {\n-                host = APILocator.getHostAPI().findDefaultHost(APILocator.systemUser(), false);\n-            } catch (DotDataException | DotSecurityException e) {\n-                host = APILocator.systemHost();\n+                host = WebAPILocator.getHostWebAPI()\n+                        .getCurrentHost(HttpServletRequestThreadLocal.INSTANCE.getRequest());\n+            } catch (DotSecurityException | PortalException | SystemException e) {\n+                Logger.debug(FileAssetContainerUtil.class, e.getMessage());\n+                try {\n+                    host = APILocator.getHostAPI().findDefaultHost(APILocator.systemUser(), false);\n+                } catch (DotDataException | DotSecurityException ex) {\n+                    Logger.debug(FileAssetContainerUtil.class, e.getMessage());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA1ODEzOQ=="}, "originalCommit": {"oid": "b575ead97282c128ee92adfbb3e90459d47c000b"}, "originalPosition": 42}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3ODMwNDk0OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/main/java/com/dotmarketing/portlets/htmlpageasset/business/render/page/PageView.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxODo1ODoxOVrOFuROjw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQyMDozOTo1MVrOFuUbFw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA2MTA3MQ==", "bodyText": "Instead of doing this, we should store the host id into the FileAssetContainer and compare with the current host", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384061071", "createdAt": "2020-02-25T18:58:19Z", "author": {"login": "jdotcms"}, "path": "dotCMS/src/main/java/com/dotmarketing/portlets/htmlpageasset/business/render/page/PageView.java", "diffHunk": "@@ -124,13 +130,27 @@ public Template getTemplate() {\n \n         containers.stream().forEach(containerRaw -> {\n \n-            if (containerRaw.getContainer() instanceof FileAssetContainer) {\n+            final Container container = containerRaw.getContainer();\n \n-                final String path = FileAssetContainer.class.cast(containerRaw.getContainer()).getPath();\n-                containerRawMap.put(path, containerRaw);\n+            if (container instanceof FileAssetContainer) {\n+                try {\n+                    final Host host = APILocator.getHostAPI().findParentHost(container, APILocator.systemUser(), false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b575ead97282c128ee92adfbb3e90459d47c000b"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDExMzQzMQ==", "bodyText": "done\n286b9c0#diff-96b7f9fe4f01ac03ce5bd6c461aa5d88R137\n286b9c0#diff-1854786c11c9b31c822e5b175c0f47c4R355", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384113431", "createdAt": "2020-02-25T20:39:51Z", "author": {"login": "freddyucv"}, "path": "dotCMS/src/main/java/com/dotmarketing/portlets/htmlpageasset/business/render/page/PageView.java", "diffHunk": "@@ -124,13 +130,27 @@ public Template getTemplate() {\n \n         containers.stream().forEach(containerRaw -> {\n \n-            if (containerRaw.getContainer() instanceof FileAssetContainer) {\n+            final Container container = containerRaw.getContainer();\n \n-                final String path = FileAssetContainer.class.cast(containerRaw.getContainer()).getPath();\n-                containerRawMap.put(path, containerRaw);\n+            if (container instanceof FileAssetContainer) {\n+                try {\n+                    final Host host = APILocator.getHostAPI().findParentHost(container, APILocator.systemUser(), false);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA2MTA3MQ=="}, "originalCommit": {"oid": "b575ead97282c128ee92adfbb3e90459d47c000b"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3ODMxMjAyOnYy", "diffSide": "RIGHT", "path": "dotCMS/src/main/java/com/dotcms/rendering/velocity/services/PageRenderUtil.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxOTowMDoyOFrOFuRTPQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQyMDo0MTozNVrOFuUeKQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA2MjI2OQ==", "bodyText": "Is this an outside case or are we using exceptions as control statements?", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384062269", "createdAt": "2020-02-25T19:00:28Z", "author": {"login": "wezell"}, "path": "dotCMS/src/main/java/com/dotcms/rendering/velocity/services/PageRenderUtil.java", "diffHunk": "@@ -367,8 +360,24 @@ private Container geContainerById(final String containerIdOrPath, final User use\n     }\n \n     private boolean needParseContainerPrefix(final Container container, final String uniqueId) {\n-        final String containerIdOrPath = (container instanceof FileAssetContainer) ?\n-                ((FileAssetContainer) container).getPath() : container.getIdentifier();\n+        String containerIdOrPath = null;\n+\n+        if (FileAssetContainerUtil.getInstance().isFileAssetContainer(container)) {\n+            final Host host;\n+            try {\n+                host = APILocator.getHostAPI().findParentHost(container, APILocator.systemUser(), false);\n+\n+                containerIdOrPath = this.site.getIdentifier().equals(host.getIdentifier()) ?\n+                        ((FileAssetContainer) container).getPath() :\n+                        FileAssetContainerUtil.getInstance().getFullPath((FileAssetContainer) container);\n+            } catch (DotDataException | DotSecurityException e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b575ead97282c128ee92adfbb3e90459d47c000b"}, "originalPosition": 103}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDExNDIxNw==", "bodyText": "this was remove 286b9c0#diff-c7538880be24298c9c76f10f1c8efaffL373", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384114217", "createdAt": "2020-02-25T20:41:35Z", "author": {"login": "freddyucv"}, "path": "dotCMS/src/main/java/com/dotcms/rendering/velocity/services/PageRenderUtil.java", "diffHunk": "@@ -367,8 +360,24 @@ private Container geContainerById(final String containerIdOrPath, final User use\n     }\n \n     private boolean needParseContainerPrefix(final Container container, final String uniqueId) {\n-        final String containerIdOrPath = (container instanceof FileAssetContainer) ?\n-                ((FileAssetContainer) container).getPath() : container.getIdentifier();\n+        String containerIdOrPath = null;\n+\n+        if (FileAssetContainerUtil.getInstance().isFileAssetContainer(container)) {\n+            final Host host;\n+            try {\n+                host = APILocator.getHostAPI().findParentHost(container, APILocator.systemUser(), false);\n+\n+                containerIdOrPath = this.site.getIdentifier().equals(host.getIdentifier()) ?\n+                        ((FileAssetContainer) container).getPath() :\n+                        FileAssetContainerUtil.getInstance().getFullPath((FileAssetContainer) container);\n+            } catch (DotDataException | DotSecurityException e) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA2MjI2OQ=="}, "originalCommit": {"oid": "b575ead97282c128ee92adfbb3e90459d47c000b"}, "originalPosition": 103}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3ODMxNTU3OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/main/java/com/dotmarketing/portlets/containers/model/ContainerViewSerializer.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxOTowMTozMVrOFuRViw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxOTowMTozMVrOFuRViw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA2Mjg1OQ==", "bodyText": "DotObjectMapperProvider.getInstance().getDefaultObjectMapper()", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384062859", "createdAt": "2020-02-25T19:01:31Z", "author": {"login": "jdotcms"}, "path": "dotCMS/src/main/java/com/dotmarketing/portlets/containers/model/ContainerViewSerializer.java", "diffHunk": "@@ -0,0 +1,50 @@\n+package com.dotmarketing.portlets.containers.model;\n+\n+import com.dotmarketing.exception.DotRuntimeException;\n+import com.fasterxml.jackson.core.JsonGenerator;\n+import com.fasterxml.jackson.databind.JsonSerializer;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.databind.ObjectWriter;\n+import com.fasterxml.jackson.databind.SerializerProvider;\n+\n+import java.io.CharArrayReader;\n+import java.io.IOException;\n+import java.util.Map;\n+import java.util.Objects;\n+\n+/**\n+ * {@link JsonSerializer} of {@link ContainerView}\n+ */\n+public class ContainerViewSerializer extends JsonSerializer<ContainerView> {\n+\n+    static final ObjectMapper MAPPER = new ObjectMapper();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b575ead97282c128ee92adfbb3e90459d47c000b"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3ODMxOTM4OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/main/java/com/dotmarketing/business/web/HostWebAPIImpl.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxOTowMjoyM1rOFuRXxg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQxOTowMjoyM1rOFuRXxg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA2MzQzMA==", "bodyText": "Do we handle the case where request is null?", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384063430", "createdAt": "2020-02-25T19:02:23Z", "author": {"login": "wezell"}, "path": "dotCMS/src/main/java/com/dotmarketing/business/web/HostWebAPIImpl.java", "diffHunk": "@@ -52,6 +53,11 @@ public Host getHost(HttpServletRequest request)  {\n \t  \r\n \t}\r\n \r\n+    public Host getCurrentHost() throws DotDataException, DotSecurityException {\r\n+        final HttpServletRequest request = HttpServletRequestThreadLocal.INSTANCE.getRequest();\r\n+        return this.getCurrentHost(request);\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b575ead97282c128ee92adfbb3e90459d47c000b"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3ODk4NDEyOnYy", "diffSide": "RIGHT", "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQyMjozNzoxM1rOFuX0sA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQyMjozNzoxM1rOFuX0sA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDE2OTEzNg==", "bodyText": "same here", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384169136", "createdAt": "2020-02-25T22:37:13Z", "author": {"login": "nollymar"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "diffHunk": "@@ -604,18 +651,14 @@ public void ContentFallbackFalse_PageFallbackFalse_PageEnglishAndSpanish_ViewEng\n      *\n      */\n     @Test\n-    public void ContentFallbackTrue_PageFallbackTrue_PageEnglishAndSpanish_ViewEnglishContent1And2_ViewSpanishContent1And2And3() throws Exception{\n+    @UseDataProvider(\"cases\")\n+    public void ContentFallbackTrue_PageFallbackTrue_PageEnglishAndSpanish_ViewEnglishContent1And2_ViewSpanishContent1And2And3(final Container container, final Template template) throws Exception{", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c30bff6f1ec2e934e4402d247dc42562b1918985"}, "originalPosition": 407}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3ODk4NDI5OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQyMjozNzoyM1rOFuX02w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQyMjozNzoyM1rOFuX02w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDE2OTE3OQ==", "bodyText": "and here", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384169179", "createdAt": "2020-02-25T22:37:23Z", "author": {"login": "nollymar"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "diffHunk": "@@ -677,20 +720,16 @@ public void ContentFallbackTrue_PageFallbackTrue_PageEnglishAndSpanish_ViewEngli\n      *\n      */\n     @Test (expected = HTMLPageAssetNotFoundException.class)\n-    public void ContentFallbackTrue_PageFallbackFalse_PageEnglish_ViewEnglishContent1And2_ViewSpanish404() throws Exception{\n+    @UseDataProvider(\"cases\")\n+    public void ContentFallbackTrue_PageFallbackFalse_PageEnglish_ViewEnglishContent1And2_ViewSpanish404(final Container container, final Template template) throws Exception{", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c30bff6f1ec2e934e4402d247dc42562b1918985"}, "originalPosition": 438}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3ODk4OTM2OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQyMjozOToxMVrOFuX3_A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQyMjozOToxMVrOFuX3_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDE2OTk4MA==", "bodyText": "do you mean a File Container linked?", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384169980", "createdAt": "2020-02-25T22:39:11Z", "author": {"login": "nollymar"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "diffHunk": "@@ -1132,6 +1160,151 @@ public void shouldReturnParserContainerUUID() throws Exception {\n         Assert.assertTrue(html.matches(regexExpected));\n     }\n \n+    /**\n+     * Method to test: {@link com.dotmarketing.portlets.htmlpageasset.business.render.HTMLPageAssetRenderedAPIImpl#getPageHtml(PageContext, HttpServletRequest, HttpServletResponse)}\n+     * Given Scenario: Create a page with File Container liked with relative path in the template", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c30bff6f1ec2e934e4402d247dc42562b1918985"}, "originalPosition": 682}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3OTAwNTQxOnYy", "diffSide": "RIGHT", "path": "dotCMS/src/main/java/com/dotcms/rendering/velocity/services/PageRenderUtil.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQyMjo0NTowOFrOFuYCJw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQyMjo0NTowOFrOFuYCJw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDE3MjU4Mw==", "bodyText": "I would make it more readable", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384172583", "createdAt": "2020-02-25T22:45:08Z", "author": {"login": "nollymar"}, "path": "dotCMS/src/main/java/com/dotcms/rendering/velocity/services/PageRenderUtil.java", "diffHunk": "@@ -101,6 +95,7 @@ public PageRenderUtil(\n             final long languageId,\n             final Host site) throws DotSecurityException, DotDataException {\n \n+        this.site = null == site? APILocator.getHostAPI().findDefaultHost(user, mode.respectAnonPerms):site;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c30bff6f1ec2e934e4402d247dc42562b1918985"}, "originalPosition": 51}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4MTgwMDA3OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxNjoyNTo1NlrOFuyoLA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxNjoyNTo1NlrOFuyoLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDYwODMwMA==", "bodyText": "Issue found: A method/constructor should not explicitly throw java.lang.Exception", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384608300", "createdAt": "2020-02-26T16:25:56Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "diffHunk": "@@ -512,38 +563,38 @@ public void ContentFallbackFalse_PageFallbackFalse_PageEnglish_ViewEnglishConten\n         mockRequest\n                 .setAttribute(WebKeys.HTMLPAGE_LANGUAGE, String.valueOf(spanishLanguage.getId()));\n         HttpServletRequestThreadLocal.INSTANCE.setRequest(mockRequest);\n-        html = APILocator.getHTMLPageAssetRenderedAPI().getPageHtml(\n+\n+        try {\n+            APILocator.getHTMLPageAssetRenderedAPI().getPageHtml(\n                 PageContextBuilder.builder()\n                         .setUser(systemUser)\n                         .setPageUri(pageEnglishVersion.getURI())\n                         .setPageMode(PageMode.LIVE)\n                         .build(),\n                 mockRequest, mockResponse);\n+            throw new AssertionError(\"HTMLPageAssetNotFoundException expected\");\n+        }catch(HTMLPageAssetNotFoundException e) {\n+            //expected\n+        }\n     }\n \n     /**\n-     * ContentFallback False\n-     * PageFallback False\n-     *\n-     * Page English & Spanish\n-     *\n-     * English -> 1 & 2\n-     * Spanish -> 2 & 3\n-     *\n+     * Method to test: {@link HTMLPageAssetRenderedAPI#getPageHtml(PageContext, HttpServletRequest, HttpServletResponse)}\n+     * When: DEFAULT_CONTENT_TO_DEFAULT_LANGUAGE is set to false and DEFAULT_PAGE_TO_DEFAULT_LANGUAGE is set to false\n+     *       And the page have version in ENG and ESP\n+     *       And the page have tree content, where: content1 is just in ENG version, content2 is in ENG and ESP version, content 3 is just in ESP version\n+     * Should: If the page is requests in ENG version it should be render with content1 and content2\n+     *         If the page is requests in ESP version it should be render with content3 and content2 (both in ESP version)\n      */\n     @Test\n-    public void ContentFallbackFalse_PageFallbackFalse_PageEnglishAndSpanish_ViewEnglishContent1And2_ViewSpanishContent2And3() throws Exception{\n+    @UseDataProvider(\"cases\")\n+    public void ContentFallbackFalse_PageFallbackFalse_PageEnglishAndSpanish_ViewEnglishContent1And2_ViewSpanishContent2And3(final Container container, final Template template) throws Exception{", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0cc3a840e9eeaefbd0d2c6dae588af700899698"}, "originalPosition": 529}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4MTgwMDE2OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxNjoyNTo1N1rOFuyoOg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxNjoyNTo1N1rOFuyoOg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDYwODMxNA==", "bodyText": "Issue found: Avoid empty catch blocks", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384608314", "createdAt": "2020-02-26T16:25:57Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "diffHunk": "@@ -714,13 +752,20 @@ public void ContentFallbackTrue_PageFallbackFalse_PageEnglish_ViewEnglishContent\n         mockRequest\n                 .setAttribute(WebKeys.HTMLPAGE_LANGUAGE, String.valueOf(spanishLanguage.getId()));\n         HttpServletRequestThreadLocal.INSTANCE.setRequest(mockRequest);\n-        html = APILocator.getHTMLPageAssetRenderedAPI().getPageHtml(\n-                PageContextBuilder.builder()\n-                        .setUser(systemUser)\n-                        .setPageUri(pageEnglishVersion.getURI())\n-                        .setPageMode(PageMode.LIVE)\n-                        .build(),\n-                mockRequest, mockResponse);\n+\n+        try{\n+            APILocator.getHTMLPageAssetRenderedAPI().getPageHtml(\n+                    PageContextBuilder.builder()\n+                            .setUser(systemUser)\n+                            .setPageUri(pageEnglishVersion.getURI())\n+                            .setPageMode(PageMode.LIVE)\n+                            .build(),\n+                    mockRequest, mockResponse);\n+\n+            throw new AssertionError(\"HTMLPageAssetNotFoundException expected\");\n+        }catch(HTMLPageAssetNotFoundException e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0cc3a840e9eeaefbd0d2c6dae588af700899698"}, "originalPosition": 674}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4MTgwMDI4OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxNjoyNTo1OFrOFuyoTw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxNjoyNTo1OFrOFuyoTw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDYwODMzNQ==", "bodyText": "Issue found: A method/constructor should not explicitly throw java.lang.Exception", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384608335", "createdAt": "2020-02-26T16:25:58Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "diffHunk": "@@ -327,32 +378,42 @@ public void ContentFallbackFalse_PageFallbackTrue_PageEnglish_ViewEnglishContent\n                         .setPageMode(PageMode.LIVE)\n                         .build(),\n                 mockRequest, mockResponse);\n-        Assert.assertTrue(\"ESP = \"+html , html.contains(\"content3content2Spa\"));\n+        Assert.assertTrue(\"ESP = \"+html , html.contains(\"content3Spacontent2Spa\"));\n+    }\n+\n+    @NotNull\n+    private HTMLPageAsset createHtmlPageAsset(\n+            final Template template,\n+            final String pageName,\n+            final long languageId)\n+\n+            throws DotSecurityException, DotDataException {\n+        final HTMLPageAsset pageEnglishVersion = new HTMLPageDataGen(folder,template).languageId(languageId).pageURL(pageName).title(pageName).nextPersisted();\n+        pageEnglishVersion.setIndexPolicy(IndexPolicy.WAIT_FOR);\n+        pageEnglishVersion.setIndexPolicyDependencies(IndexPolicy.WAIT_FOR);\n+        pageEnglishVersion.setBoolProperty(Contentlet.IS_TEST_MODE, true);\n+        contentletAPI.publish(pageEnglishVersion, systemUser, false);\n+        addAnonymousPermissions(pageEnglishVersion);\n+        return pageEnglishVersion;\n     }\n \n     /**\n-     * ContentFallback False\n-     * PageFallback True\n-     *\n-     * Page English & Spanish\n-     *\n-     * English -> 1 & 2\n-     * Spanish -> 2 & 3\n-     *\n+     * Method to test: {@link HTMLPageAssetRenderedAPI#getPageHtml(PageContext, HttpServletRequest, HttpServletResponse)}\n+     * When: DEFAULT_CONTENT_TO_DEFAULT_LANGUAGE is set to false and DEFAULT_PAGE_TO_DEFAULT_LANGUAGE is set to true\n+     *       And the page have version in ENG and ESP\n+     *       And the page have tree content, where: content1 is just in ENG version, content2 is in ENG and ESP version, content 3 is just in ESP version\n+     * Should: If the page is requests in ENG version it should be render with content1 and content2\n+     *         If the page is requests in ESP version it should be render with content3 and content2 (both in ESP version)\n      */\n     @Test\n-    public void ContentFallbackFalse_PageFallbackTrue_PageEnglishAndSpanish_ViewEnglishContent1And2_ViewSpanishContent2And3() throws Exception{\n+    @UseDataProvider(\"cases\")\n+    public void ContentFallbackFalse_PageFallbackTrue_PageEnglishAndSpanish_ViewEnglishContent1And2_ViewSpanishContent2And3(final Container container, final Template template) throws Exception{", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0cc3a840e9eeaefbd0d2c6dae588af700899698"}, "originalPosition": 341}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4MTgwMDM0OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxNjoyNTo1OVrOFuyoWg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxNjoyNTo1OVrOFuyoWg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDYwODM0Ng==", "bodyText": "Issue found: A method/constructor should not explicitly throw java.lang.Exception", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384608346", "createdAt": "2020-02-26T16:25:59Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "diffHunk": "@@ -1029,7 +1076,10 @@ public void shouldReturnPageHTMLForLegacyUUID() throws Exception {\n      * @throws Exception\n      */\n     @Test\n-    public void shouldReturnPageHTMLForLegacyUUIDAndMultiTree() throws Exception {\n+    @UseDataProvider(\"cases\")\n+    public void shouldReturnPageHTMLForLegacyUUIDAndMultiTree(final Container container, final Template templateTestCase) throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0cc3a840e9eeaefbd0d2c6dae588af700899698"}, "originalPosition": 831}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4MTgwMDQ3OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxNjoyNjowMVrOFuyoaw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxNjoyNjowMVrOFuyoaw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDYwODM2Mw==", "bodyText": "Issue found: The String literal \"cases\" appears 13 times in this file; the first occurrence is on line 323", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384608363", "createdAt": "2020-02-26T16:26:01Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "diffHunk": "@@ -272,31 +326,27 @@ public static void restore() throws Exception{\n     }\n \n     /**\n-     * ContentFallback False\n-     * PageFallback True\n-     *\n-     * Page English\n-     *\n-     * English -> 1 & 2\n-     * Spanish -> 2 & 3\n-     *\n+     * Method to test: {@link HTMLPageAssetRenderedAPI#getPageHtml(PageContext, HttpServletRequest, HttpServletResponse)}\n+     * When: DEFAULT_CONTENT_TO_DEFAULT_LANGUAGE is set to false and DEFAULT_PAGE_TO_DEFAULT_LANGUAGE is set to true\n+     *       And the page have version just in ENG\n+     *       And the page have tree content, where: content1 is just in ENG version, content2 is in ENG and ESP version, content 3 is just in ESP version\n+     * Should: If the page is requests in ENG version it should be render with content1 and content2\n+     *         If the page is requests in ESP version it should be render with content3 and content2 (both in ESP version)\n      */\n     @Test\n-    public void ContentFallbackFalse_PageFallbackTrue_PageEnglish_ViewEnglishContent1And2_ViewSpanishContent2And3() throws Exception{\n+    @UseDataProvider(\"cases\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0cc3a840e9eeaefbd0d2c6dae588af700899698"}, "originalPosition": 267}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4MTgwMDUzOnYy", "diffSide": "RIGHT", "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxNjoyNjowMlrOFuyodw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxNjoyNjowMlrOFuyodw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDYwODM3NQ==", "bodyText": "Issue found: A method/constructor should not explicitly throw java.lang.Exception", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384608375", "createdAt": "2020-02-26T16:26:02Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "diffHunk": "@@ -731,7 +776,8 @@ public void ContentFallbackTrue_PageFallbackFalse_PageEnglish_ViewEnglishContent\n      * @throws Exception\n      */\n     @Test\n-    public void constantField_notUpdatedCache_whenChanged() throws Exception{\n+    @UseDataProvider(\"cases\")\n+    public void constantField_notUpdatedCache_whenChanged(final Container container, final Template template) throws Exception{", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0cc3a840e9eeaefbd0d2c6dae588af700899698"}, "originalPosition": 686}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4MTgwMDczOnYy", "diffSide": "RIGHT", "path": "dotCMS/src/main/java/com/dotmarketing/portlets/htmlpageasset/business/render/page/PageView.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxNjoyNjowNVrOFuyonw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxNjoyNjowNVrOFuyonw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDYwODQxNQ==", "bodyText": "Issue found: Avoid unused imports such as 'com.dotmarketing.business.APILocator'", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384608415", "createdAt": "2020-02-26T16:26:05Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/main/java/com/dotmarketing/portlets/htmlpageasset/business/render/page/PageView.java", "diffHunk": "@@ -1,12 +1,18 @@\n package com.dotmarketing.portlets.htmlpageasset.business.render.page;\n \n import com.dotmarketing.beans.Host;\n+import com.dotmarketing.business.APILocator;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0cc3a840e9eeaefbd0d2c6dae588af700899698"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4MTgwMDgxOnYy", "diffSide": "RIGHT", "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxNjoyNjowNlrOFuyoqA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxNjoyNjowNlrOFuyoqA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDYwODQyNA==", "bodyText": "Issue found: A method/constructor should not explicitly throw java.lang.Exception", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384608424", "createdAt": "2020-02-26T16:26:06Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "diffHunk": "@@ -1132,6 +1166,151 @@ public void shouldReturnParserContainerUUID() throws Exception {\n         Assert.assertTrue(html.matches(regexExpected));\n     }\n \n+    /**\n+     * Method to test: {@link com.dotmarketing.portlets.htmlpageasset.business.render.HTMLPageAssetRenderedAPIImpl#getPageHtml(PageContext, HttpServletRequest, HttpServletResponse)}\n+     * Given Scenario: Create a page with File Container linked with relative path in the template\n+     * ExpectedResult: should work\n+     *\n+     * @throws Exception\n+     */\n+    @Test\n+    public void shouldRenderRelativeContainerPath() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0cc3a840e9eeaefbd0d2c6dae588af700899698"}, "originalPosition": 902}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4MTgwMDg1OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/main/java/com/dotmarketing/portlets/htmlpageasset/business/render/page/PageView.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxNjoyNjowOFrOFuyorw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxNjoyNjowOFrOFuyorw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDYwODQzMQ==", "bodyText": "Issue found: Avoid unused imports such as 'com.dotmarketing.exception.DotSecurityException'", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384608431", "createdAt": "2020-02-26T16:26:08Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/main/java/com/dotmarketing/portlets/htmlpageasset/business/render/page/PageView.java", "diffHunk": "@@ -1,12 +1,18 @@\n package com.dotmarketing.portlets.htmlpageasset.business.render.page;\n \n import com.dotmarketing.beans.Host;\n+import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.exception.DotDataException;\n+import com.dotmarketing.exception.DotSecurityException;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0cc3a840e9eeaefbd0d2c6dae588af700899698"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4MTgwMTAxOnYy", "diffSide": "RIGHT", "path": "dotCMS/src/main/java/com/dotmarketing/portlets/htmlpageasset/business/render/page/PageView.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxNjoyNjowOVrOFuyoxg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxNjoyNjowOVrOFuyoxg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDYwODQ1NA==", "bodyText": "Issue found: Avoid unused imports such as 'com.dotmarketing.util.Logger'", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384608454", "createdAt": "2020-02-26T16:26:09Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/main/java/com/dotmarketing/portlets/htmlpageasset/business/render/page/PageView.java", "diffHunk": "@@ -1,12 +1,18 @@\n package com.dotmarketing.portlets.htmlpageasset.business.render.page;\n \n import com.dotmarketing.beans.Host;\n+import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.exception.DotDataException;\n+import com.dotmarketing.exception.DotSecurityException;\n+import com.dotmarketing.portlets.containers.business.FileAssetContainerUtil;\n+import com.dotmarketing.portlets.containers.model.Container;\n import com.dotmarketing.portlets.containers.model.FileAssetContainer;\n import com.dotmarketing.portlets.contentlet.model.Contentlet;\n import com.dotmarketing.portlets.htmlpageasset.business.render.ContainerRaw;\n import com.dotmarketing.portlets.htmlpageasset.model.HTMLPageAsset;\n import com.dotmarketing.portlets.templates.design.bean.TemplateLayout;\n import com.dotmarketing.portlets.templates.model.Template;\n+import com.dotmarketing.util.Logger;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0cc3a840e9eeaefbd0d2c6dae588af700899698"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4MTgwMTEwOnYy", "diffSide": "RIGHT", "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxNjoyNjoxMVrOFuyo2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxNjoyNjoxMVrOFuyo2A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDYwODQ3Mg==", "bodyText": "Issue found: A method/constructor should not explicitly throw java.lang.Exception", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384608472", "createdAt": "2020-02-26T16:26:11Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "diffHunk": "@@ -272,31 +326,27 @@ public static void restore() throws Exception{\n     }\n \n     /**\n-     * ContentFallback False\n-     * PageFallback True\n-     *\n-     * Page English\n-     *\n-     * English -> 1 & 2\n-     * Spanish -> 2 & 3\n-     *\n+     * Method to test: {@link HTMLPageAssetRenderedAPI#getPageHtml(PageContext, HttpServletRequest, HttpServletResponse)}\n+     * When: DEFAULT_CONTENT_TO_DEFAULT_LANGUAGE is set to false and DEFAULT_PAGE_TO_DEFAULT_LANGUAGE is set to true\n+     *       And the page have version just in ENG\n+     *       And the page have tree content, where: content1 is just in ENG version, content2 is in ENG and ESP version, content 3 is just in ESP version\n+     * Should: If the page is requests in ENG version it should be render with content1 and content2\n+     *         If the page is requests in ESP version it should be render with content3 and content2 (both in ESP version)\n      */\n     @Test\n-    public void ContentFallbackFalse_PageFallbackTrue_PageEnglish_ViewEnglishContent1And2_ViewSpanishContent2And3() throws Exception{\n+    @UseDataProvider(\"cases\")\n+    public void ContentFallbackFalse_PageFallbackTrue_PageEnglish_ViewEnglishContent1And2_ViewSpanishContent2And3(\n+            final Container container, final Template template) throws Exception{", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0cc3a840e9eeaefbd0d2c6dae588af700899698"}, "originalPosition": 269}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4MTgwMTE5OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxNjoyNjoxMlrOFuyo6A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxNjoyNjoxMlrOFuyo6A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDYwODQ4OA==", "bodyText": "Issue found: A method/constructor should not explicitly throw java.lang.Exception", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384608488", "createdAt": "2020-02-26T16:26:12Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "diffHunk": "@@ -1132,6 +1166,151 @@ public void shouldReturnParserContainerUUID() throws Exception {\n         Assert.assertTrue(html.matches(regexExpected));\n     }\n \n+    /**\n+     * Method to test: {@link com.dotmarketing.portlets.htmlpageasset.business.render.HTMLPageAssetRenderedAPIImpl#getPageHtml(PageContext, HttpServletRequest, HttpServletResponse)}\n+     * Given Scenario: Create a page with File Container linked with relative path in the template\n+     * ExpectedResult: should work\n+     *\n+     * @throws Exception\n+     */\n+    @Test\n+    public void shouldRenderRelativeContainerPath() throws Exception {\n+\n+        final FileAssetContainer container = createFileContainer();\n+        final Template template = new TemplateDataGen().title(\"PageContextBuilderTemplate\"+System.currentTimeMillis())\n+                .host(site)\n+                .withContainer(container.getPath(), UUID)\n+                .nextPersisted();\n+        PublishFactory.publishAsset(template, systemUser, false, false);\n+\n+        final String pageName = \"testPage-\"+System.currentTimeMillis();\n+        final HTMLPageAsset pageEnglishVersion = createHtmlPageAsset(template, pageName, 1);\n+\n+        createMultiTree(pageEnglishVersion.getIdentifier(), container.getIdentifier());\n+\n+        final HttpServletRequest mockRequest = createHttpServletRequest(pageEnglishVersion);\n+        Mockito.when(mockRequest.getParameter(WebKeys.PAGE_MODE_PARAMETER)).thenReturn(PageMode.LIVE.toString());\n+\n+        final HttpServletResponse mockResponse = mock(HttpServletResponse.class);\n+        final HttpSession session = createHttpSession(mockRequest);\n+        Mockito.when(session.getAttribute(WebKeys.VISITOR)).thenReturn(null);\n+        Mockito.when(session.getAttribute(WebKeys.CMS_USER)).thenReturn(systemUser);\n+\n+        final String html = APILocator.getHTMLPageAssetRenderedAPI().getPageHtml(\n+                PageContextBuilder.builder()\n+                        .setUser(systemUser)\n+                        .setPageUri(pageEnglishVersion.getURI())\n+                        .setPageMode(PageMode.LIVE)\n+                        .build(),\n+                mockRequest, mockResponse);\n+\n+        Assert.assertEquals(\"content2content1\", html);\n+    }\n+\n+    /**\n+     * Method to test: {@link com.dotmarketing.portlets.htmlpageasset.business.render.HTMLPageAssetRenderedAPIImpl#getPageHtml(PageContext, HttpServletRequest, HttpServletResponse)}\n+     * Given Scenario: Create a page and a advance template using a File Container in another site\n+     * ExpectedResult: should work\n+     *\n+     * @throws Exception\n+     */\n+    @Test\n+    public void shouldRenderUsingOtherSiteContainer() throws Exception {\n+        final Host defaultHost = APILocator.getHostAPI().findDefaultHost(APILocator.systemUser(), true);\n+        final FileAssetContainer container = createFileContainer(defaultHost);\n+        final Template template = new TemplateDataGen().title(\"PageContextBuilderTemplate\"+System.currentTimeMillis())\n+                .host(site)\n+                .withContainer(\"//\" + defaultHost.getName()  + container.getPath(), UUID)\n+                .nextPersisted();\n+        PublishFactory.publishAsset(template, systemUser, false, false);\n+\n+        final String pageName = \"testPage-\"+System.currentTimeMillis();\n+        final HTMLPageAsset pageEnglishVersion = createHtmlPageAsset(template, pageName, 1);\n+\n+        createMultiTree(pageEnglishVersion.getIdentifier(), container.getIdentifier());\n+\n+        final HttpServletRequest mockRequest = createHttpServletRequest(pageEnglishVersion);\n+        Mockito.when(mockRequest.getParameter(WebKeys.PAGE_MODE_PARAMETER)).thenReturn(PageMode.LIVE.toString());\n+\n+        final HttpServletResponse mockResponse = mock(HttpServletResponse.class);\n+        final HttpSession session = createHttpSession(mockRequest);\n+        Mockito.when(session.getAttribute(WebKeys.VISITOR)).thenReturn(null);\n+        Mockito.when(session.getAttribute(WebKeys.CMS_USER)).thenReturn(systemUser);\n+\n+        final String html = APILocator.getHTMLPageAssetRenderedAPI().getPageHtml(\n+                PageContextBuilder.builder()\n+                        .setUser(systemUser)\n+                        .setPageUri(pageEnglishVersion.getURI())\n+                        .setPageMode(PageMode.LIVE)\n+                        .build(),\n+                mockRequest, mockResponse);\n+\n+        Assert.assertEquals(\"content2content1\", html);\n+    }\n+\n+    /**\n+     * Method to test: {@link com.dotmarketing.portlets.htmlpageasset.business.render.HTMLPageAssetRenderedAPIImpl#getPageHtml(PageContext, HttpServletRequest, HttpServletResponse)}\n+     * Given Scenario: Create a page and a not advance template using a File Container in another site\n+     * ExpectedResult: should work\n+     *\n+     * @throws Exception\n+     */\n+    @Test\n+    public void shouldRenderUsingOtherSiteContainerAndNotAdvanceTemplate() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0cc3a840e9eeaefbd0d2c6dae588af700899698"}, "originalPosition": 984}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4MTgwMTI0OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/main/java/com/dotmarketing/business/web/HostWebAPI.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxNjoyNjoxM1rOFuyo9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxNjoyNjoxM1rOFuyo9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDYwODUwMQ==", "bodyText": "Issue found: Unnecessary modifier 'public' on method 'getCurrentHost': the method is declared in an interface type", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384608501", "createdAt": "2020-02-26T16:26:13Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/main/java/com/dotmarketing/business/web/HostWebAPI.java", "diffHunk": "@@ -31,6 +32,14 @@\n \t\r\n \tpublic Host getCurrentHost(HttpServletRequest req) throws DotDataException, DotSecurityException, PortalException, SystemException;\r\n \r\n+\t/**\r\n+\t * Return the current host using the current request\r\n+\t * @return\r\n+\t * @throws DotDataException\r\n+\t * @throws DotSecurityException\r\n+\t */\r\n+\tpublic Host getCurrentHost() throws DotDataException, DotSecurityException;\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0cc3a840e9eeaefbd0d2c6dae588af700899698"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4MTgwMTI2OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxNjoyNjoxNVrOFuyo_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxNjoyNjoxNVrOFuyo_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDYwODUwOQ==", "bodyText": "Issue found: A method/constructor should not explicitly throw java.lang.Exception", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384608509", "createdAt": "2020-02-26T16:26:15Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "diffHunk": "@@ -1132,6 +1166,151 @@ public void shouldReturnParserContainerUUID() throws Exception {\n         Assert.assertTrue(html.matches(regexExpected));\n     }\n \n+    /**\n+     * Method to test: {@link com.dotmarketing.portlets.htmlpageasset.business.render.HTMLPageAssetRenderedAPIImpl#getPageHtml(PageContext, HttpServletRequest, HttpServletResponse)}\n+     * Given Scenario: Create a page with File Container linked with relative path in the template\n+     * ExpectedResult: should work\n+     *\n+     * @throws Exception\n+     */\n+    @Test\n+    public void shouldRenderRelativeContainerPath() throws Exception {\n+\n+        final FileAssetContainer container = createFileContainer();\n+        final Template template = new TemplateDataGen().title(\"PageContextBuilderTemplate\"+System.currentTimeMillis())\n+                .host(site)\n+                .withContainer(container.getPath(), UUID)\n+                .nextPersisted();\n+        PublishFactory.publishAsset(template, systemUser, false, false);\n+\n+        final String pageName = \"testPage-\"+System.currentTimeMillis();\n+        final HTMLPageAsset pageEnglishVersion = createHtmlPageAsset(template, pageName, 1);\n+\n+        createMultiTree(pageEnglishVersion.getIdentifier(), container.getIdentifier());\n+\n+        final HttpServletRequest mockRequest = createHttpServletRequest(pageEnglishVersion);\n+        Mockito.when(mockRequest.getParameter(WebKeys.PAGE_MODE_PARAMETER)).thenReturn(PageMode.LIVE.toString());\n+\n+        final HttpServletResponse mockResponse = mock(HttpServletResponse.class);\n+        final HttpSession session = createHttpSession(mockRequest);\n+        Mockito.when(session.getAttribute(WebKeys.VISITOR)).thenReturn(null);\n+        Mockito.when(session.getAttribute(WebKeys.CMS_USER)).thenReturn(systemUser);\n+\n+        final String html = APILocator.getHTMLPageAssetRenderedAPI().getPageHtml(\n+                PageContextBuilder.builder()\n+                        .setUser(systemUser)\n+                        .setPageUri(pageEnglishVersion.getURI())\n+                        .setPageMode(PageMode.LIVE)\n+                        .build(),\n+                mockRequest, mockResponse);\n+\n+        Assert.assertEquals(\"content2content1\", html);\n+    }\n+\n+    /**\n+     * Method to test: {@link com.dotmarketing.portlets.htmlpageasset.business.render.HTMLPageAssetRenderedAPIImpl#getPageHtml(PageContext, HttpServletRequest, HttpServletResponse)}\n+     * Given Scenario: Create a page and a advance template using a File Container in another site\n+     * ExpectedResult: should work\n+     *\n+     * @throws Exception\n+     */\n+    @Test\n+    public void shouldRenderUsingOtherSiteContainer() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0cc3a840e9eeaefbd0d2c6dae588af700899698"}, "originalPosition": 943}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4MTgwMTM4OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/main/java/com/dotmarketing/portlets/htmlpageasset/business/render/page/PageView.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxNjoyNjoxNlrOFuypDw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxNjoyNjoxNlrOFuypDw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDYwODUyNw==", "bodyText": "Issue found: Avoid unused imports such as 'com.dotmarketing.exception.DotDataException'", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384608527", "createdAt": "2020-02-26T16:26:16Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/main/java/com/dotmarketing/portlets/htmlpageasset/business/render/page/PageView.java", "diffHunk": "@@ -1,12 +1,18 @@\n package com.dotmarketing.portlets.htmlpageasset.business.render.page;\n \n import com.dotmarketing.beans.Host;\n+import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.exception.DotDataException;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0cc3a840e9eeaefbd0d2c6dae588af700899698"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4MTgwMTQ1OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxNjoyNjoxN1rOFuypGQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxNjoyNjoxN1rOFuypGQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDYwODUzNw==", "bodyText": "Issue found: A method/constructor should not explicitly throw java.lang.Exception", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384608537", "createdAt": "2020-02-26T16:26:17Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "diffHunk": "@@ -400,38 +461,28 @@ public void ContentFallbackFalse_PageFallbackTrue_PageEnglishAndSpanish_ViewEngl\n                         .setPageMode(PageMode.LIVE)\n                         .build(),\n                 mockRequest, mockResponse);\n-        Assert.assertTrue(\"ESP = \"+html , html.contains(\"content3content2Spa\"));\n+        Assert.assertTrue(\"ESP = \"+html , html.contains(\"content3Spacontent2Spa\"));\n \n     }\n \n     /**\n-     * ContentFallback False\n-     * PageFallback True\n-     *\n-     * Page Spanish\n-     *\n-     * English -> 404\n-     * Spanish -> 2 & 3\n-     *\n-     * @throws Exception\n+     * Method to test: {@link HTMLPageAssetRenderedAPI#getPageHtml(PageContext, HttpServletRequest, HttpServletResponse)}\n+     * When: DEFAULT_CONTENT_TO_DEFAULT_LANGUAGE is set to false and DEFAULT_PAGE_TO_DEFAULT_LANGUAGE is set to true\n+     *       And the page have version in ESP\n+     *       And the page have tree content, where: content1 is just in ENG version, content2 is in ENG and ESP version, content 3 is just in ESP version\n+     * Should: If the page is requests in ENG version it should be thrown a {@link HTMLPageAssetNotFoundException}\n+     *         If the page is requests in ESP version it should be render with content3 and content2 (both in ESP version)\n      */\n-    @Test (expected = HTMLPageAssetNotFoundException.class)\n-    public void ContentFallbackFalse_PageFallbackTrue_PageSpanish_ViewEnglish404_ViewSpanishContent2And3() throws Exception{\n+    @UseDataProvider(\"cases\")\n+    public void ContentFallbackFalse_PageFallbackTrue_PageSpanish_ViewEnglish404_ViewSpanishContent2And3(final Container container, final Template template) throws Exception{", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0cc3a840e9eeaefbd0d2c6dae588af700899698"}, "originalPosition": 395}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4MTgwMTU3OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/integration-test/java/com/dotcms/datagen/ContainerAsFileDataGen.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxNjoyNjoxOFrOFuypLQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxNjoyNjoxOFrOFuypLQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDYwODU1Nw==", "bodyText": "Issue found: Private field 'content' could be made final; it is only initialized in the declaration or constructor.", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384608557", "createdAt": "2020-02-26T16:26:18Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/datagen/ContainerAsFileDataGen.java", "diffHunk": "@@ -20,16 +20,32 @@\n import java.util.Arrays;\n import java.util.List;\n import java.util.Set;\n+import java.util.stream.Collectors;\n \n public class ContainerAsFileDataGen extends AbstractDataGen<FileAssetContainer> {\n \n+    private class ContentTypeContent {\n+        private ContentType contentType;\n+        private String content;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0cc3a840e9eeaefbd0d2c6dae588af700899698"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4MTgwMTY4OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxNjoyNjoyMFrOFuypPg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxNjoyNjoyMFrOFuypPg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDYwODU3NA==", "bodyText": "Issue found: A method/constructor should not explicitly throw java.lang.Exception", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384608574", "createdAt": "2020-02-26T16:26:20Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "diffHunk": "@@ -447,48 +498,48 @@ public void ContentFallbackFalse_PageFallbackTrue_PageSpanish_ViewEnglish404_Vie\n                         .setPageMode(PageMode.LIVE)\n                         .build(),\n                 mockRequest, mockResponse);\n-        Assert.assertTrue(\"ESP = \"+html , html.contains(\"content3content2Spa\"));\n+        Assert.assertTrue(\"ESP = \"+html , html.contains(\"content3Spacontent2Spa\"));\n \n         mockRequest = new MockSessionRequest(\n                 new MockAttributeRequest(new MockHttpRequest(\"localhost\", \"/\").request()).request())\n                 .request();\n         Mockito.when(mockRequest.getParameter(\"host_id\")).thenReturn(site.getIdentifier());\n         mockRequest.setAttribute(WebKeys.HTMLPAGE_LANGUAGE, \"1\");\n         HttpServletRequestThreadLocal.INSTANCE.setRequest(mockRequest);\n-        html = APILocator.getHTMLPageAssetRenderedAPI().getPageHtml(\n-                PageContextBuilder.builder()\n-                        .setUser(systemUser)\n-                        .setPageUri(pageSpanishVersion.getURI())\n-                        .setPageMode(PageMode.LIVE)\n-                        .build(),\n-                mockRequest, mockResponse);\n+\n+        try {\n+            APILocator.getHTMLPageAssetRenderedAPI().getPageHtml(\n+                    PageContextBuilder.builder()\n+                            .setUser(systemUser)\n+                            .setPageUri(pageSpanishVersion.getURI())\n+                            .setPageMode(PageMode.LIVE)\n+                            .build(),\n+                    mockRequest, mockResponse);\n+\n+            throw new AssertionError(\"HTMLPageAssetNotFoundException expected\");\n+        }catch(HTMLPageAssetNotFoundException e) {\n+            //expected\n+        }\n     }\n \n     /**\n-     * ContentFallback False\n-     * PageFallback False\n-     *\n-     * Page English\n-     *\n-     * English -> 1 & 2\n-     * Spanish -> 404\n-     *\n+     * Method to test: {@link HTMLPageAssetRenderedAPI#getPageHtml(PageContext, HttpServletRequest, HttpServletResponse)}\n+     * When: DEFAULT_CONTENT_TO_DEFAULT_LANGUAGE is set to false and DEFAULT_PAGE_TO_DEFAULT_LANGUAGE is set to false\n+     *       And the page have version in ENG\n+     *       And the page have tree content, where: content1 is just in ENG version, content2 is in ENG and ESP version, content 3 is just in ESP version\n+     * Should: If the page is requests in ENG version it should be render with content1 and content2\n+     *         If the page is requests in ESP version it should be thrown a {@link HTMLPageAssetNotFoundException}\n      */\n-    @Test (expected = HTMLPageAssetNotFoundException.class)\n-    public void ContentFallbackFalse_PageFallbackFalse_PageEnglish_ViewEnglishContent1And2_ViewSpanish404() throws Exception{\n+    @UseDataProvider(\"cases\")\n+    public void ContentFallbackFalse_PageFallbackFalse_PageEnglish_ViewEnglishContent1And2_ViewSpanish404(final Container container, final Template template) throws Exception{", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0cc3a840e9eeaefbd0d2c6dae588af700899698"}, "originalPosition": 471}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4MTgwMTc1OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxNjoyNjoyMVrOFuypTQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxNjoyNjoyMVrOFuypTQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDYwODU4OQ==", "bodyText": "Issue found: The String literal \"PageContextBuilderTemplate\" appears 4 times in this file; the first occurrence is on line 108", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384608589", "createdAt": "2020-02-26T16:26:21Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "diffHunk": "@@ -79,9 +86,88 @@\n     private static Persona persona;\n     private static Visitor visitor;\n \n+    @DataProvider\n+    public static Object[][] cases() throws Exception {\n+        if (systemUser == null) {\n+            prepareGlobalData();\n+        }\n+\n+        final Container container = createContainer();\n+        final Template templateContainer = createTemplate(container);\n+\n+        final Container fileContainer = createFileContainer();\n+        final Template templateFileContainer = createTemplate(fileContainer);\n+\n+        return new Object[][] {\n+                { container, templateContainer },\n+                { fileContainer, templateFileContainer}\n+        };\n+    }\n+\n+    private static Template createTemplate(final Container container) throws DotSecurityException, WebAssetException, DotDataException {\n+        final Template template = new TemplateDataGen().title(\"PageContextBuilderTemplate\"+System.currentTimeMillis())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0cc3a840e9eeaefbd0d2c6dae588af700899698"}, "originalPosition": 77}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4MTgwMTgxOnYy", "diffSide": "RIGHT", "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxNjoyNjoyMlrOFuypWg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxNjoyNjoyMlrOFuypWg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDYwODYwMg==", "bodyText": "Issue found: A method/constructor should not explicitly throw java.lang.Exception", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384608602", "createdAt": "2020-02-26T16:26:22Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "diffHunk": "@@ -79,9 +86,88 @@\n     private static Persona persona;\n     private static Visitor visitor;\n \n+    @DataProvider\n+    public static Object[][] cases() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0cc3a840e9eeaefbd0d2c6dae588af700899698"}, "originalPosition": 59}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4MTgwMTkzOnYy", "diffSide": "RIGHT", "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxNjoyNjoyM1rOFuypaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxNjoyNjoyM1rOFuypaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDYwODYxNg==", "bodyText": "Issue found: The String literal \"content3Spacontent2Spa\" appears 4 times in this file; the first occurrence is on line 381", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384608616", "createdAt": "2020-02-26T16:26:23Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "diffHunk": "@@ -327,32 +378,42 @@ public void ContentFallbackFalse_PageFallbackTrue_PageEnglish_ViewEnglishContent\n                         .setPageMode(PageMode.LIVE)\n                         .build(),\n                 mockRequest, mockResponse);\n-        Assert.assertTrue(\"ESP = \"+html , html.contains(\"content3content2Spa\"));\n+        Assert.assertTrue(\"ESP = \"+html , html.contains(\"content3Spacontent2Spa\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0cc3a840e9eeaefbd0d2c6dae588af700899698"}, "originalPosition": 303}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4MTgwMTk4OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxNjoyNjoyNFrOFuypcA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxNjoyNjoyNFrOFuypcA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDYwODYyNA==", "bodyText": "Issue found: A method/constructor should not explicitly throw java.lang.Exception", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384608624", "createdAt": "2020-02-26T16:26:24Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "diffHunk": "@@ -590,32 +641,26 @@ public void ContentFallbackFalse_PageFallbackFalse_PageEnglishAndSpanish_ViewEng\n                         .setPageMode(PageMode.LIVE)\n                         .build(),\n                 mockRequest, mockResponse);\n-        Assert.assertTrue(\"ESP = \"+html , html.contains(\"content3content2Spa\"));\n+        Assert.assertTrue(\"ESP = \"+html , html.contains(\"content3Spacontent2Spa\"));\n     }\n \n     /**\n-     * ContentFallback True\n-     * PageFallback True\n-     *\n-     * Page English & Spanish\n-     *\n-     * English -> 1 & 2\n-     * Spanish -> 1 & 2 & 3\n-     *\n+     * Method to test: {@link HTMLPageAssetRenderedAPI#getPageHtml(PageContext, HttpServletRequest, HttpServletResponse)}\n+     * When: DEFAULT_CONTENT_TO_DEFAULT_LANGUAGE is set to true and DEFAULT_PAGE_TO_DEFAULT_LANGUAGE is set to true\n+     *       And the page have version in ENG and ESP\n+     *       And the page have tree content, where: content1 is just in ENG version, content2 is in ENG and ESP version, content 3 is just in ESP version\n+     * Should: If the page is requests in ENG version it should be render with content1 and content2\n+     *         If the page is requests in ESP version it should be render with content1 (ENG version), content3 and content2 (both in ESP version)\n      */\n     @Test\n-    public void ContentFallbackTrue_PageFallbackTrue_PageEnglishAndSpanish_ViewEnglishContent1And2_ViewSpanishContent1And2And3() throws Exception{\n+    @UseDataProvider(\"cases\")\n+    public void ContentFallbackTrue_PageFallbackTrue_PageEnglishAndSpanish_ViewEnglishContent1And2_ViewSpanishContent1And2And3(final Container container, final Template template) throws Exception{", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0cc3a840e9eeaefbd0d2c6dae588af700899698"}, "originalPosition": 581}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4MTgwMjA5OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/main/java/com/dotmarketing/business/web/HostWebAPI.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxNjoyNjoyNVrOFuyphA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxNjoyNjoyNVrOFuyphA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDYwODY0NA==", "bodyText": "Issue found: Avoid unused imports such as 'java.util.Optional'", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384608644", "createdAt": "2020-02-26T16:26:25Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/main/java/com/dotmarketing/business/web/HostWebAPI.java", "diffHunk": "@@ -17,6 +17,7 @@\n \r\n import javax.servlet.http.HttpServletRequest;\r\n import javax.servlet.http.HttpSession;\r\n+import java.util.Optional;\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0cc3a840e9eeaefbd0d2c6dae588af700899698"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4MTgwMjI0OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/main/java/com/dotcms/rendering/velocity/services/PageRenderUtil.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxNjoyNjoyN1rOFuypmQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxNjoyNjoyN1rOFuypmQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDYwODY2NQ==", "bodyText": "Issue found: Avoid unused imports such as 'com.dotmarketing.portlets.containers.business'", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384608665", "createdAt": "2020-02-26T16:26:27Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/main/java/com/dotcms/rendering/velocity/services/PageRenderUtil.java", "diffHunk": "@@ -27,17 +25,15 @@\n import com.dotmarketing.exception.DotSecurityException;\n import com.dotmarketing.factories.MultiTreeAPI;\n import com.dotmarketing.factories.PersonalizedContentlet;\n-import com.dotmarketing.portlets.containers.business.ContainerExceptionNotifier;\n-import com.dotmarketing.portlets.containers.business.ContainerFinderByIdOrPathStrategy;\n-import com.dotmarketing.portlets.containers.business.LiveContainerFinderByIdOrPathStrategyResolver;\n-import com.dotmarketing.portlets.containers.business.WorkingContainerFinderByIdOrPathStrategyResolver;\n+import com.dotmarketing.portlets.containers.business.*;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0cc3a840e9eeaefbd0d2c6dae588af700899698"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM4MTgwMjMzOnYy", "diffSide": "RIGHT", "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxNjoyNjoyOFrOFuyppg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNlQxNjoyNjoyOFrOFuyppg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDYwODY3OA==", "bodyText": "Issue found: A method/constructor should not explicitly throw java.lang.Exception", "url": "https://github.com/dotCMS/core/pull/18033#discussion_r384608678", "createdAt": "2020-02-26T16:26:28Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/integration-test/java/com/dotcms/rendering/velocity/services/HTMLPageAssetRenderedTest.java", "diffHunk": "@@ -920,17 +964,14 @@ public void containerArchived_PageShouldResolve() throws Exception {\n      * @throws Exception\n      */\n     @Test\n-    public void shouldReturnPageHTMLForPersona() throws Exception{\n+    @UseDataProvider(\"cases\")\n+    public void shouldReturnPageHTMLForPersona(final Container container, final Template template) throws Exception{", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f0cc3a840e9eeaefbd0d2c6dae588af700899698"}, "originalPosition": 756}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2326, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}