{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMyMDg4NTYx", "number": 18631, "title": "Issue 18530 v2", "bodyText": "Apply feedback to the new endpoint that gets all the messages of the system.\nFeedback:\n\nChange name to api/v2/languages/{language}/keys\nIf the language requested exists in dotcms, get also the language keys and language variables\nUpdate tests", "createdAt": "2020-06-09T22:01:22Z", "url": "https://github.com/dotCMS/core/pull/18631", "merged": true, "mergeCommit": {"oid": "8612d82a83b678ce2d51eb0db03c54dda169fcb6"}, "closed": true, "closedAt": "2020-06-10T20:32:58Z", "author": {"login": "erickgonzalez"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcoZ6kRgH2gAyNDMyMDg4NTYxOmUyYjljZTdmN2IzMjEyMTIxMTUxYjBiZWY1Y2JmMzVhMjliZDI1YjE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcp_r-rAFqTQyODQwMzYyNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e2b9ce7f7b3212121151b0bef5cbf35a29bd25b1", "author": {"user": {"login": "erickgonzalez", "name": null}}, "url": "https://github.com/dotCMS/core/commit/e2b9ce7f7b3212121151b0bef5cbf35a29bd25b1", "committedDate": "2020-06-05T21:54:39Z", "message": "#18530 if param is locale use as it is"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "907c4bedb9a1aa5e6ed5cb627f3000d2ac9f0f54", "author": {"user": {"login": "erickgonzalez", "name": null}}, "url": "https://github.com/dotCMS/core/commit/907c4bedb9a1aa5e6ed5cb627f3000d2ac9f0f54", "committedDate": "2020-06-05T22:46:30Z", "message": "#18530 fix tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e961cec770b6ba5ee582063a10a4bc2dda2b074b", "author": {"user": {"login": "erickgonzalez", "name": null}}, "url": "https://github.com/dotCMS/core/commit/e961cec770b6ba5ee582063a10a4bc2dda2b074b", "committedDate": "2020-06-09T21:44:48Z", "message": "Merge branch 'master' of github.com:dotCMS/core into issue-18530-v2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c0500ffc3f06e03c2bbe1a8a791335da7b9400d1", "author": {"user": {"login": "erickgonzalez", "name": null}}, "url": "https://github.com/dotCMS/core/commit/c0500ffc3f06e03c2bbe1a8a791335da7b9400d1", "committedDate": "2020-06-09T21:45:54Z", "message": "#18530 change endpoint name, get also lang keys and vars"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "365706af43792831ae8748e758be4ed637b393b7", "author": {"user": {"login": "erickgonzalez", "name": null}}, "url": "https://github.com/dotCMS/core/commit/365706af43792831ae8748e758be4ed637b393b7", "committedDate": "2020-06-09T21:46:10Z", "message": "#18530 tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3NTc5NjA5", "url": "https://github.com/dotCMS/core/pull/18631#pullrequestreview-427579609", "createdAt": "2020-06-09T22:08:02Z", "commit": {"oid": "365706af43792831ae8748e758be4ed637b393b7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQyMjowODowM1rOGheH3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQyMjowODowM1rOGheH3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzc0OTcyNA==", "bodyText": "Issue found: Useless parentheses.", "url": "https://github.com/dotCMS/core/pull/18631#discussion_r437749724", "createdAt": "2020-06-09T22:08:03Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/main/java/com/dotcms/rest/api/v2/languages/LanguagesResource.java", "diffHunk": "@@ -207,17 +216,59 @@ public Response getAllMessages (\n             @Context final HttpServletResponse response,\n             @PathParam(\"language\") final String language){\n \n-        final long languageId = \"default\".equalsIgnoreCase(language) ? APILocator.getLanguageAPI().getDefaultLanguage().getId() : LanguageUtil.getLanguageId(language);\n-        final Language language1 = APILocator.getLanguageAPI().getLanguage(languageId);\n-        if(!UtilMethods.isSet(language1)){\n-            final String message = \"Language with Id or Code: \"+ language + \" does not exist\";\n-            Logger.error(this,message);\n-            throw new IllegalArgumentException(message);\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requiredAnonAccess(AnonymousAccess.READ)\n+                .requestAndResponse(request, response)\n+                .rejectWhenNoUser(false).init();\n+\n+        final User user = initData.getUser();\n+\n+        final Locale locale = \"default\".equalsIgnoreCase(language) ? APILocator.getLanguageAPI().getDefaultLanguage().asLocale() : ConversionUtils.toLocale(language);\n+        final Locale[] locales = LanguageUtil.getAvailableLocales();\n+        for(int i=0;i<locales.length;i++){\n+            final Locale currentLocale = locales[i];\n+            if(currentLocale.getLanguage().equalsIgnoreCase(locale.getLanguage())){\n+                if(UtilMethods.isSet(locale.getCountry())){\n+                    if(currentLocale.getCountry().equalsIgnoreCase(locale.getCountry())){\n+                        break;\n+                    }\n+                }else{\n+                    break;\n+                }\n+\n+            } else if(i == (locales.length-1)){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "365706af43792831ae8748e758be4ed637b393b7"}, "originalPosition": 88}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3NTc5NjE5", "url": "https://github.com/dotCMS/core/pull/18631#pullrequestreview-427579619", "createdAt": "2020-06-09T22:08:04Z", "commit": {"oid": "365706af43792831ae8748e758be4ed637b393b7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQyMjowODowNFrOGheH7Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQyMjowODowNFrOGheH7Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzc0OTc0MQ==", "bodyText": "Issue found: Avoid unused imports such as 'java.util.stream.Stream'", "url": "https://github.com/dotCMS/core/pull/18631#discussion_r437749741", "createdAt": "2020-06-09T22:08:04Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/main/java/com/dotcms/rest/api/v2/languages/LanguagesResource.java", "diffHunk": "@@ -26,13 +30,18 @@\n import com.liferay.portal.language.LanguageUtil;\n import com.liferay.portal.model.User;\n import com.rainerhahnekamp.sneakythrow.Sneaky;\n+import io.vavr.control.Try;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n import java.util.List;\n import java.util.Locale;\n import java.util.Map;\n+import java.util.TreeMap;\n+import java.util.stream.Collectors;\n+import java.util.stream.Stream;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "365706af43792831ae8748e758be4ed637b393b7"}, "originalPosition": 31}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3NTc5NjI3", "url": "https://github.com/dotCMS/core/pull/18631#pullrequestreview-427579627", "createdAt": "2020-06-09T22:08:05Z", "commit": {"oid": "365706af43792831ae8748e758be4ed637b393b7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQyMjowODowNVrOGheH9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQyMjowODowNVrOGheH9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzc0OTc0OQ==", "bodyText": "Issue found: Local variable 'langId' could be declared final", "url": "https://github.com/dotCMS/core/pull/18631#discussion_r437749749", "createdAt": "2020-06-09T22:08:05Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/main/java/com/dotcms/rest/api/v2/languages/LanguagesResource.java", "diffHunk": "@@ -207,17 +216,59 @@ public Response getAllMessages (\n             @Context final HttpServletResponse response,\n             @PathParam(\"language\") final String language){\n \n-        final long languageId = \"default\".equalsIgnoreCase(language) ? APILocator.getLanguageAPI().getDefaultLanguage().getId() : LanguageUtil.getLanguageId(language);\n-        final Language language1 = APILocator.getLanguageAPI().getLanguage(languageId);\n-        if(!UtilMethods.isSet(language1)){\n-            final String message = \"Language with Id or Code: \"+ language + \" does not exist\";\n-            Logger.error(this,message);\n-            throw new IllegalArgumentException(message);\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requiredAnonAccess(AnonymousAccess.READ)\n+                .requestAndResponse(request, response)\n+                .rejectWhenNoUser(false).init();\n+\n+        final User user = initData.getUser();\n+\n+        final Locale locale = \"default\".equalsIgnoreCase(language) ? APILocator.getLanguageAPI().getDefaultLanguage().asLocale() : ConversionUtils.toLocale(language);\n+        final Locale[] locales = LanguageUtil.getAvailableLocales();\n+        for(int i=0;i<locales.length;i++){\n+            final Locale currentLocale = locales[i];\n+            if(currentLocale.getLanguage().equalsIgnoreCase(locale.getLanguage())){\n+                if(UtilMethods.isSet(locale.getCountry())){\n+                    if(currentLocale.getCountry().equalsIgnoreCase(locale.getCountry())){\n+                        break;\n+                    }\n+                }else{\n+                    break;\n+                }\n+\n+            } else if(i == (locales.length-1)){\n+                final String message = \"Locale: \"+ locale + \" not found in Portal.properties file\";\n+                Logger.error(this,message);\n+                throw new DoesNotExistException(message);\n+            }\n+        }\n+\n+        //Messages in the properties file\n+        final Map mapPropertiesFile = LanguageUtil.getAllMessagesByLocale(locale);\n+\n+        final Map result = new TreeMap(mapPropertiesFile);\n+\n+        final Language language1 = APILocator.getLanguageAPI().getLanguage(locale.getLanguage(),locale.getCountry());\n+        if(UtilMethods.isSet(language1)) {\n+            //Language Keys\n+            final Map mapLanguageKeys = APILocator.getLanguageAPI()\n+                    .getLanguageKeys(locale.getLanguage()).stream().collect(\n+                            Collectors.toMap(LanguageKey::getKey, LanguageKey::getValue));\n+\n+            result.putAll(mapLanguageKeys);\n+\n+            //Language Variable\n+            long langId = language1.getId();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "365706af43792831ae8748e758be4ed637b393b7"}, "originalPosition": 110}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3NTc5NjM1", "url": "https://github.com/dotCMS/core/pull/18631#pullrequestreview-427579635", "createdAt": "2020-06-09T22:08:06Z", "commit": {"oid": "365706af43792831ae8748e758be4ed637b393b7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQyMjowODowNlrOGheH_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQyMjowODowNlrOGheH_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzc0OTc1Nw==", "bodyText": "Issue found: Avoid declaring a variable if it is unreferenced before a possible exit point.", "url": "https://github.com/dotCMS/core/pull/18631#discussion_r437749757", "createdAt": "2020-06-09T22:08:06Z", "author": {"login": "dev-dotcms"}, "path": "dotCMS/src/main/java/com/dotcms/rest/api/v2/languages/LanguagesResource.java", "diffHunk": "@@ -207,17 +216,59 @@ public Response getAllMessages (\n             @Context final HttpServletResponse response,\n             @PathParam(\"language\") final String language){\n \n-        final long languageId = \"default\".equalsIgnoreCase(language) ? APILocator.getLanguageAPI().getDefaultLanguage().getId() : LanguageUtil.getLanguageId(language);\n-        final Language language1 = APILocator.getLanguageAPI().getLanguage(languageId);\n-        if(!UtilMethods.isSet(language1)){\n-            final String message = \"Language with Id or Code: \"+ language + \" does not exist\";\n-            Logger.error(this,message);\n-            throw new IllegalArgumentException(message);\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requiredAnonAccess(AnonymousAccess.READ)\n+                .requestAndResponse(request, response)\n+                .rejectWhenNoUser(false).init();\n+\n+        final User user = initData.getUser();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "365706af43792831ae8748e758be4ed637b393b7"}, "originalPosition": 73}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4MTMyMzEw", "url": "https://github.com/dotCMS/core/pull/18631#pullrequestreview-428132310", "createdAt": "2020-06-10T14:47:16Z", "commit": {"oid": "365706af43792831ae8748e758be4ed637b393b7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4MjU3MjUz", "url": "https://github.com/dotCMS/core/pull/18631#pullrequestreview-428257253", "createdAt": "2020-06-10T17:01:26Z", "commit": {"oid": "365706af43792831ae8748e758be4ed637b393b7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxNzowMToyN1rOGh-RPA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMFQxNzowMToyN1rOGh-RPA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODI3NjQxMg==", "bodyText": "rename to something else such as localeLanguage or languageResolved", "url": "https://github.com/dotCMS/core/pull/18631#discussion_r438276412", "createdAt": "2020-06-10T17:01:27Z", "author": {"login": "jdotcms"}, "path": "dotCMS/src/main/java/com/dotcms/rest/api/v2/languages/LanguagesResource.java", "diffHunk": "@@ -207,17 +216,59 @@ public Response getAllMessages (\n             @Context final HttpServletResponse response,\n             @PathParam(\"language\") final String language){\n \n-        final long languageId = \"default\".equalsIgnoreCase(language) ? APILocator.getLanguageAPI().getDefaultLanguage().getId() : LanguageUtil.getLanguageId(language);\n-        final Language language1 = APILocator.getLanguageAPI().getLanguage(languageId);\n-        if(!UtilMethods.isSet(language1)){\n-            final String message = \"Language with Id or Code: \"+ language + \" does not exist\";\n-            Logger.error(this,message);\n-            throw new IllegalArgumentException(message);\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requiredAnonAccess(AnonymousAccess.READ)\n+                .requestAndResponse(request, response)\n+                .rejectWhenNoUser(false).init();\n+\n+        final User user = initData.getUser();\n+\n+        final Locale locale = \"default\".equalsIgnoreCase(language) ? APILocator.getLanguageAPI().getDefaultLanguage().asLocale() : ConversionUtils.toLocale(language);\n+        final Locale[] locales = LanguageUtil.getAvailableLocales();\n+        for(int i=0;i<locales.length;i++){\n+            final Locale currentLocale = locales[i];\n+            if(currentLocale.getLanguage().equalsIgnoreCase(locale.getLanguage())){\n+                if(UtilMethods.isSet(locale.getCountry())){\n+                    if(currentLocale.getCountry().equalsIgnoreCase(locale.getCountry())){\n+                        break;\n+                    }\n+                }else{\n+                    break;\n+                }\n+\n+            } else if(i == (locales.length-1)){\n+                final String message = \"Locale: \"+ locale + \" not found in Portal.properties file\";\n+                Logger.error(this,message);\n+                throw new DoesNotExistException(message);\n+            }\n+        }\n+\n+        //Messages in the properties file\n+        final Map mapPropertiesFile = LanguageUtil.getAllMessagesByLocale(locale);\n+\n+        final Map result = new TreeMap(mapPropertiesFile);\n+\n+        final Language language1 = APILocator.getLanguageAPI().getLanguage(locale.getLanguage(),locale.getCountry());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "365706af43792831ae8748e758be4ed637b393b7"}, "originalPosition": 100}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4NDAzNjI3", "url": "https://github.com/dotCMS/core/pull/18631#pullrequestreview-428403627", "createdAt": "2020-06-10T20:29:02Z", "commit": {"oid": "365706af43792831ae8748e758be4ed637b393b7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 917, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}