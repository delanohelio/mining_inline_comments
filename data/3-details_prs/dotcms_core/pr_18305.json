{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAyNzYzNTI2", "number": 18305, "title": "#18229 Setting TrustSelfSignedStrategy to avoid validating ssl certificates by default", "bodyText": "With this change, we don't validate tls certificates. It is equivalent to using the --insecure flag when running from curl", "createdAt": "2020-04-13T18:01:48Z", "url": "https://github.com/dotCMS/core/pull/18305", "merged": true, "mergeCommit": {"oid": "095952c9a5715ba68d8afb7209a50ff80d589a17"}, "closed": true, "closedAt": "2020-04-17T20:52:40Z", "author": {"login": "nollymar"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcXSv3lgH2gAyNDAyNzYzNTI2Ojc5NGFjZDlmYmYyNzcwY2ZkMDM2MzMxNWJhNjE4MDBlMjYwY2M0MWQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcYmO6qgH2gAyNDAyNzYzNTI2Ojc2MjJlNGJlNGQ2MmEwYTFlODg1M2Q1ZDg5N2VkODM5YTk5OGY2NTg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "794acd9fbf2770cfd0363315ba61800e260cc41d", "author": {"user": null}, "url": "https://github.com/dotCMS/core/commit/794acd9fbf2770cfd0363315ba61800e260cc41d", "committedDate": "2020-04-13T17:56:55Z", "message": "#18229 Setting TrustSelfSignedStrategy to avoid validating ssl certificates by default"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzMDI1MjQx", "url": "https://github.com/dotCMS/core/pull/18305#pullrequestreview-393025241", "createdAt": "2020-04-14T15:09:58Z", "commit": {"oid": "794acd9fbf2770cfd0363315ba61800e260cc41d"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxNTowOTo1OVrOGFTbaw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxNToxMDo1OFrOGFTeYw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODIxNDM3OQ==", "bodyText": "\"https\" should be a constant", "url": "https://github.com/dotCMS/core/pull/18305#discussion_r408214379", "createdAt": "2020-04-14T15:09:59Z", "author": {"login": "freddyucv"}, "path": "dotCMS/src/main/java/com/dotcms/content/elasticsearch/util/DotRestHighLevelClientProvider.java", "diffHunk": "@@ -106,14 +110,24 @@ private BasicCredentialsProvider getCredentialsProvider() throws IOException, Ge\n \n     private RestClientBuilder getClientBuilder(final BasicCredentialsProvider credentialsProvider) {\n         final String esAuthType = getESAuthType();\n-\n+        final String esProtocol = Config.getStringProperty(\"ES_PROTOCOL\", \"https\");\n         final RestClientBuilder clientBuilder = RestClient\n                 .builder(new HttpHost(Config.getStringProperty(\"ES_HOSTNAME\", \"127.0.0.1\"),\n-                        Config.getIntProperty(\"ES_PORT\", 9200), sslContextFromPem != null ? \"https\" :\"http\"))\n+                        Config.getIntProperty(\"ES_PORT\", 9200), esProtocol))\n                 .setHttpClientConfigCallback((httpClientBuilder) -> {\n                     if (sslContextFromPem != null) {\n                         httpClientBuilder\n                                 .setSSLContext(sslContextFromPem);\n+                    } else if (\"https\".equals(esProtocol)){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "794acd9fbf2770cfd0363315ba61800e260cc41d"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODIxNTEzOQ==", "bodyText": "is it possible do any test?", "url": "https://github.com/dotCMS/core/pull/18305#discussion_r408215139", "createdAt": "2020-04-14T15:10:58Z", "author": {"login": "freddyucv"}, "path": "dotCMS/src/main/java/com/dotcms/content/elasticsearch/util/DotRestHighLevelClientProvider.java", "diffHunk": "@@ -106,14 +110,24 @@ private BasicCredentialsProvider getCredentialsProvider() throws IOException, Ge\n \n     private RestClientBuilder getClientBuilder(final BasicCredentialsProvider credentialsProvider) {\n         final String esAuthType = getESAuthType();\n-\n+        final String esProtocol = Config.getStringProperty(\"ES_PROTOCOL\", \"https\");\n         final RestClientBuilder clientBuilder = RestClient\n                 .builder(new HttpHost(Config.getStringProperty(\"ES_HOSTNAME\", \"127.0.0.1\"),\n-                        Config.getIntProperty(\"ES_PORT\", 9200), sslContextFromPem != null ? \"https\" :\"http\"))\n+                        Config.getIntProperty(\"ES_PORT\", 9200), esProtocol))\n                 .setHttpClientConfigCallback((httpClientBuilder) -> {\n                     if (sslContextFromPem != null) {\n                         httpClientBuilder\n                                 .setSSLContext(sslContextFromPem);\n+                    } else if (\"https\".equals(esProtocol)){\n+                        try {\n+                            httpClientBuilder.setSSLContext(SSLContexts\n+                                    .custom().loadTrustMaterial(new TrustSelfSignedStrategy()).build());\n+                        } catch (NoSuchAlgorithmException | KeyManagementException | KeyStoreException e) {\n+                            Logger.error(this.getClass(),\n+                                    \"Error setting TrustSelfSignedStrategy for Elastic RestHighLevelClient\",\n+                                    e);\n+                            throw new DotRuntimeException(e);\n+                        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "794acd9fbf2770cfd0363315ba61800e260cc41d"}, "originalPosition": 59}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzMTI3NTI4", "url": "https://github.com/dotCMS/core/pull/18305#pullrequestreview-393127528", "createdAt": "2020-04-14T17:06:53Z", "commit": {"oid": "794acd9fbf2770cfd0363315ba61800e260cc41d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c6c856aa6fcb70afd8b76fce1348eb72d92fe327", "author": {"user": null}, "url": "https://github.com/dotCMS/core/commit/c6c856aa6fcb70afd8b76fce1348eb72d92fe327", "committedDate": "2020-04-14T17:28:52Z", "message": "#18229 Applying code review suggestions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzODg0OTAz", "url": "https://github.com/dotCMS/core/pull/18305#pullrequestreview-393884903", "createdAt": "2020-04-15T15:25:18Z", "commit": {"oid": "c6c856aa6fcb70afd8b76fce1348eb72d92fe327"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzOTEyNTQ4", "url": "https://github.com/dotCMS/core/pull/18305#pullrequestreview-393912548", "createdAt": "2020-04-15T15:55:53Z", "commit": {"oid": "c6c856aa6fcb70afd8b76fce1348eb72d92fe327"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e0b2cc5a44a34919cb74e95f3dff4c6f464963a1", "author": {"user": null}, "url": "https://github.com/dotCMS/core/commit/e0b2cc5a44a34919cb74e95f3dff4c6f464963a1", "committedDate": "2020-04-17T18:58:20Z", "message": "#18229 Adding more logging"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd74856e3703201711bb6b93b1679d4f679e946a", "author": {"user": null}, "url": "https://github.com/dotCMS/core/commit/bd74856e3703201711bb6b93b1679d4f679e946a", "committedDate": "2020-04-17T19:04:19Z", "message": "#18229 Adding more logging"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7622e4be4d62a0a1e8853d5d897ed839a998f658", "author": {"user": null}, "url": "https://github.com/dotCMS/core/commit/7622e4be4d62a0a1e8853d5d897ed839a998f658", "committedDate": "2020-04-17T19:12:57Z", "message": "#18229 Fixing typo and improving logs"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 978, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}