{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkyNjI1MzUz", "number": 19326, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQxNjoxNDowNVrOEnhQXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQxNjoxNDo0MFrOEnhRGA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA5ODc0NzgwOnYy", "diffSide": "RIGHT", "path": "dotCMS/src/main/java/com/dotmarketing/business/PermissionBitAPIImpl.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQxNjoxNDowNVrOHYKEdQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQxNjoxNDowNVrOHYKEdQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTA5Mjg1Mw==", "bodyText": "rename to role", "url": "https://github.com/dotCMS/core/pull/19326#discussion_r495092853", "createdAt": "2020-09-25T16:14:05Z", "author": {"login": "jdotcms"}, "path": "dotCMS/src/main/java/com/dotmarketing/business/PermissionBitAPIImpl.java", "diffHunk": "@@ -1415,24 +1415,35 @@ private boolean isHost(final Permissionable permissionable) {\n \r\n \t@Override\r\n     public boolean doesUserHavePermissions(PermissionableType permType, int permissionType, User user) throws DotDataException {\r\n-    \tif(user==null) return false;\r\n+    \treturn doesUserHavePermissions(null,permType,permissionType,user);\r\n+    }\r\n+\r\n+\t@Override\r\n+\tpublic boolean doesUserHavePermissions(final String assetId, final PermissionableType permType, final int permissionType, final User user) throws DotDataException {\r\n+\t\tif(user==null) return false;\r\n \r\n-    \tif(APILocator.getUserAPI().isCMSAdmin(user)) return true;\r\n+\t\tif(APILocator.getUserAPI().isCMSAdmin(user)) return true;\r\n \r\n-    \tBoolean hasPerm = false;\r\n-    \tRoleAPI roleAPI = APILocator.getRoleAPI();\r\n-\t\tList<com.dotmarketing.business.Role> roles = roleAPI.loadRolesForUser(user.getUserId(), false);\r\n-\t\tfor(com.dotmarketing.business.Role r : roles) {\r\n+\t\tBoolean hasPerm = false;\r\n+\t\tfinal RoleAPI roleAPI = APILocator.getRoleAPI();\r\n+\t\tfinal List<com.dotmarketing.business.Role> roles = roleAPI.loadRolesForUser(user.getUserId(), false);\r\n+\t\tfor(final com.dotmarketing.business.Role r : roles) {\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "97cd7ea03d7a3978f3f4f24817e9d98fa0987357"}, "originalPosition": 49}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA5ODc0ODIxOnYy", "diffSide": "RIGHT", "path": "dotCMS/src/main/java/com/dotmarketing/business/PermissionBitAPIImpl.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQxNjoxNDoxNFrOHYKEuA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQxNjoxNDoxNFrOHYKEuA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTA5MjkyMA==", "bodyText": "use curly brackets", "url": "https://github.com/dotCMS/core/pull/19326#discussion_r495092920", "createdAt": "2020-09-25T16:14:14Z", "author": {"login": "jdotcms"}, "path": "dotCMS/src/main/java/com/dotmarketing/business/PermissionBitAPIImpl.java", "diffHunk": "@@ -1415,24 +1415,35 @@ private boolean isHost(final Permissionable permissionable) {\n \r\n \t@Override\r\n     public boolean doesUserHavePermissions(PermissionableType permType, int permissionType, User user) throws DotDataException {\r\n-    \tif(user==null) return false;\r\n+    \treturn doesUserHavePermissions(null,permType,permissionType,user);\r\n+    }\r\n+\r\n+\t@Override\r\n+\tpublic boolean doesUserHavePermissions(final String assetId, final PermissionableType permType, final int permissionType, final User user) throws DotDataException {\r\n+\t\tif(user==null) return false;\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "97cd7ea03d7a3978f3f4f24817e9d98fa0987357"}, "originalPosition": 37}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA5ODc0ODc1OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/main/java/com/dotmarketing/business/PermissionBitAPIImpl.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQxNjoxNDoyNVrOHYKFDQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQxNjoxNDoyNVrOHYKFDQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTA5MzAwNQ==", "bodyText": "use curly brackets", "url": "https://github.com/dotCMS/core/pull/19326#discussion_r495093005", "createdAt": "2020-09-25T16:14:25Z", "author": {"login": "jdotcms"}, "path": "dotCMS/src/main/java/com/dotmarketing/business/PermissionBitAPIImpl.java", "diffHunk": "@@ -1415,24 +1415,35 @@ private boolean isHost(final Permissionable permissionable) {\n \r\n \t@Override\r\n     public boolean doesUserHavePermissions(PermissionableType permType, int permissionType, User user) throws DotDataException {\r\n-    \tif(user==null) return false;\r\n+    \treturn doesUserHavePermissions(null,permType,permissionType,user);\r\n+    }\r\n+\r\n+\t@Override\r\n+\tpublic boolean doesUserHavePermissions(final String assetId, final PermissionableType permType, final int permissionType, final User user) throws DotDataException {\r\n+\t\tif(user==null) return false;\r\n \r\n-    \tif(APILocator.getUserAPI().isCMSAdmin(user)) return true;\r\n+\t\tif(APILocator.getUserAPI().isCMSAdmin(user)) return true;\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "97cd7ea03d7a3978f3f4f24817e9d98fa0987357"}, "originalPosition": 40}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA5ODc0OTY4OnYy", "diffSide": "RIGHT", "path": "dotCMS/src/main/java/com/dotmarketing/business/PermissionBitAPIImpl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQxNjoxNDo0MFrOHYKFoQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQxNjo0MDo1M1rOHYK83w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTA5MzE1Mw==", "bodyText": "rename to permission", "url": "https://github.com/dotCMS/core/pull/19326#discussion_r495093153", "createdAt": "2020-09-25T16:14:40Z", "author": {"login": "jdotcms"}, "path": "dotCMS/src/main/java/com/dotmarketing/business/PermissionBitAPIImpl.java", "diffHunk": "@@ -1415,24 +1415,35 @@ private boolean isHost(final Permissionable permissionable) {\n \r\n \t@Override\r\n     public boolean doesUserHavePermissions(PermissionableType permType, int permissionType, User user) throws DotDataException {\r\n-    \tif(user==null) return false;\r\n+    \treturn doesUserHavePermissions(null,permType,permissionType,user);\r\n+    }\r\n+\r\n+\t@Override\r\n+\tpublic boolean doesUserHavePermissions(final String assetId, final PermissionableType permType, final int permissionType, final User user) throws DotDataException {\r\n+\t\tif(user==null) return false;\r\n \r\n-    \tif(APILocator.getUserAPI().isCMSAdmin(user)) return true;\r\n+\t\tif(APILocator.getUserAPI().isCMSAdmin(user)) return true;\r\n \r\n-    \tBoolean hasPerm = false;\r\n-    \tRoleAPI roleAPI = APILocator.getRoleAPI();\r\n-\t\tList<com.dotmarketing.business.Role> roles = roleAPI.loadRolesForUser(user.getUserId(), false);\r\n-\t\tfor(com.dotmarketing.business.Role r : roles) {\r\n+\t\tBoolean hasPerm = false;\r\n+\t\tfinal RoleAPI roleAPI = APILocator.getRoleAPI();\r\n+\t\tfinal List<com.dotmarketing.business.Role> roles = roleAPI.loadRolesForUser(user.getUserId(), false);\r\n+\t\tfor(final com.dotmarketing.business.Role r : roles) {\r\n \t\t\tList<Permission> perms = APILocator.getPermissionAPI().getPermissionsByRole(r, false);\r\n-\t\t\tfor (Permission p : perms) {\r\n+\t\t\tif(UtilMethods.isSet(assetId)) {\r\n+\t\t\t\tperms = perms.stream()\r\n+\t\t\t\t\t\t.filter(permission -> permission.getInode().equalsIgnoreCase(assetId))\r\n+\t\t\t\t\t\t.collect(\r\n+\t\t\t\t\t\t\t\tCollectors.toList());\r\n+\t\t\t}\r\n+\t\t\tfor (final Permission p : perms) {\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "97cd7ea03d7a3978f3f4f24817e9d98fa0987357"}, "originalPosition": 58}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTEwNzI5NQ==", "bodyText": "done", "url": "https://github.com/dotCMS/core/pull/19326#discussion_r495107295", "createdAt": "2020-09-25T16:40:53Z", "author": {"login": "erickgonzalez"}, "path": "dotCMS/src/main/java/com/dotmarketing/business/PermissionBitAPIImpl.java", "diffHunk": "@@ -1415,24 +1415,35 @@ private boolean isHost(final Permissionable permissionable) {\n \r\n \t@Override\r\n     public boolean doesUserHavePermissions(PermissionableType permType, int permissionType, User user) throws DotDataException {\r\n-    \tif(user==null) return false;\r\n+    \treturn doesUserHavePermissions(null,permType,permissionType,user);\r\n+    }\r\n+\r\n+\t@Override\r\n+\tpublic boolean doesUserHavePermissions(final String assetId, final PermissionableType permType, final int permissionType, final User user) throws DotDataException {\r\n+\t\tif(user==null) return false;\r\n \r\n-    \tif(APILocator.getUserAPI().isCMSAdmin(user)) return true;\r\n+\t\tif(APILocator.getUserAPI().isCMSAdmin(user)) return true;\r\n \r\n-    \tBoolean hasPerm = false;\r\n-    \tRoleAPI roleAPI = APILocator.getRoleAPI();\r\n-\t\tList<com.dotmarketing.business.Role> roles = roleAPI.loadRolesForUser(user.getUserId(), false);\r\n-\t\tfor(com.dotmarketing.business.Role r : roles) {\r\n+\t\tBoolean hasPerm = false;\r\n+\t\tfinal RoleAPI roleAPI = APILocator.getRoleAPI();\r\n+\t\tfinal List<com.dotmarketing.business.Role> roles = roleAPI.loadRolesForUser(user.getUserId(), false);\r\n+\t\tfor(final com.dotmarketing.business.Role r : roles) {\r\n \t\t\tList<Permission> perms = APILocator.getPermissionAPI().getPermissionsByRole(r, false);\r\n-\t\t\tfor (Permission p : perms) {\r\n+\t\t\tif(UtilMethods.isSet(assetId)) {\r\n+\t\t\t\tperms = perms.stream()\r\n+\t\t\t\t\t\t.filter(permission -> permission.getInode().equalsIgnoreCase(assetId))\r\n+\t\t\t\t\t\t.collect(\r\n+\t\t\t\t\t\t\t\tCollectors.toList());\r\n+\t\t\t}\r\n+\t\t\tfor (final Permission p : perms) {\r", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTA5MzE1Mw=="}, "originalCommit": {"oid": "97cd7ea03d7a3978f3f4f24817e9d98fa0987357"}, "originalPosition": 58}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1899, "cost": 1, "resetAt": "2021-11-12T13:16:51Z"}}}