{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI1MjcyMDI4", "number": 9008, "title": "Issue #8018: AST based operatorwrap", "bodyText": "Issue #8018\nText-based approach replaced with AST-based.\nDiff Regression projects: https://gist.githubusercontent.com/nmancus1/32ddbff9e69986ac2fcbbeff7def2f80/raw/8480445657f1d215e683dbb6b14c1577bbd44e6b/projects-to-test-on.properties\nDiff Regression config: https://gist.githubusercontent.com/pbludov/81b21835641d4f9f61ce70954a29dfcb/raw/a703de479422ac1bcd12e5a69b653217b3513a73/Issue-8018-operator-wrap-config.xml\nDiff Regression config (NL): https://gist.githubusercontent.com/pbludov/cb09980e6eef2a89b2298ed10c087fbc/raw/a141f53d13c3907349217758bea066fac3b49c63/Issue-8018-operator-wrap-config-nl.xml\nDiff Regression config (EOL): https://gist.githubusercontent.com/pbludov/a233b467c6c3b1ddfd06041fde6577a5/raw/37ba5305aaa37aa1d8623d84804b0a5ed1dad6b0/Issue-8018-operator-wrap-config-eol.xml\nRegression reports\n\nAll tokens, config = Checkstyle: https://checkstyle-diff-reports.s3.us-east-2.amazonaws.com/issue-8018-operator-wrap_2020121536/reports/diff/index.html\nAll tokens, config = EOL: https://checkstyle-diff-reports.s3.us-east-2.amazonaws.com/issue-8018-operator-wrap_2020203715/reports/diff/index.html\nAll tokens, config = NL: https://checkstyle-diff-reports.s3.us-east-2.amazonaws.com/issue-8018-operator-wrap_2020090445/reports/diff/index.html", "createdAt": "2020-11-22T11:55:52Z", "url": "https://github.com/checkstyle/checkstyle/pull/9008", "merged": true, "mergeCommit": {"oid": "74eb9219b6892f288cd293162666643b811ff5ff"}, "closed": true, "closedAt": "2020-12-27T11:23:39Z", "author": {"login": "pbludov"}, "timelineItems": {"totalCount": 21, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABde_ZwfgBqjQwMjQ3MjE2Nzc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdqNVd0ABqjQxNTAxMTU4MDA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "72832441a7a8ccf94e590deee67735b1705e1ad4", "author": {"user": {"login": "pbludov", "name": "Pavel Bludov"}}, "url": "https://github.com/checkstyle/checkstyle/commit/72832441a7a8ccf94e590deee67735b1705e1ad4", "committedDate": "2020-11-22T11:48:43Z", "message": "Issue #8018: AST based operatorwrap"}, "afterCommit": {"oid": "1b2494a52297706ff8e8a08cc05e301943d48c33", "author": {"user": {"login": "pbludov", "name": "Pavel Bludov"}}, "url": "https://github.com/checkstyle/checkstyle/commit/1b2494a52297706ff8e8a08cc05e301943d48c33", "committedDate": "2020-11-22T12:06:47Z", "message": "Issue #8018: AST based operatorwrap"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1b2494a52297706ff8e8a08cc05e301943d48c33", "author": {"user": {"login": "pbludov", "name": "Pavel Bludov"}}, "url": "https://github.com/checkstyle/checkstyle/commit/1b2494a52297706ff8e8a08cc05e301943d48c33", "committedDate": "2020-11-22T12:06:47Z", "message": "Issue #8018: AST based operatorwrap"}, "afterCommit": {"oid": "fe129509633603d553649ac28ae0ce5a95c001ad", "author": {"user": {"login": "pbludov", "name": "Pavel Bludov"}}, "url": "https://github.com/checkstyle/checkstyle/commit/fe129509633603d553649ac28ae0ce5a95c001ad", "committedDate": "2020-11-22T12:56:10Z", "message": "Issue #8018: AST based operatorwrap"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fe129509633603d553649ac28ae0ce5a95c001ad", "author": {"user": {"login": "pbludov", "name": "Pavel Bludov"}}, "url": "https://github.com/checkstyle/checkstyle/commit/fe129509633603d553649ac28ae0ce5a95c001ad", "committedDate": "2020-11-22T12:56:10Z", "message": "Issue #8018: AST based operatorwrap"}, "afterCommit": {"oid": "c7909b82e3384475d125c5d9b3d1ce5141cca330", "author": {"user": {"login": "pbludov", "name": "Pavel Bludov"}}, "url": "https://github.com/checkstyle/checkstyle/commit/c7909b82e3384475d125c5d9b3d1ce5141cca330", "committedDate": "2020-11-22T13:04:59Z", "message": "Issue #8018: AST based operatorwrap"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c7909b82e3384475d125c5d9b3d1ce5141cca330", "author": {"user": {"login": "pbludov", "name": "Pavel Bludov"}}, "url": "https://github.com/checkstyle/checkstyle/commit/c7909b82e3384475d125c5d9b3d1ce5141cca330", "committedDate": "2020-11-22T13:04:59Z", "message": "Issue #8018: AST based operatorwrap"}, "afterCommit": {"oid": "3c99eb9fa83a7387bd9086eed9801944ebbf0520", "author": {"user": {"login": "pbludov", "name": "Pavel Bludov"}}, "url": "https://github.com/checkstyle/checkstyle/commit/3c99eb9fa83a7387bd9086eed9801944ebbf0520", "committedDate": "2020-11-22T14:58:48Z", "message": "Issue #8018: AST based operatorwrap"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3c99eb9fa83a7387bd9086eed9801944ebbf0520", "author": {"user": {"login": "pbludov", "name": "Pavel Bludov"}}, "url": "https://github.com/checkstyle/checkstyle/commit/3c99eb9fa83a7387bd9086eed9801944ebbf0520", "committedDate": "2020-11-22T14:58:48Z", "message": "Issue #8018: AST based operatorwrap"}, "afterCommit": {"oid": "a0e1fe173f9a8727c94fc14aae6ee007856b505b", "author": {"user": {"login": "pbludov", "name": "Pavel Bludov"}}, "url": "https://github.com/checkstyle/checkstyle/commit/a0e1fe173f9a8727c94fc14aae6ee007856b505b", "committedDate": "2020-11-22T14:59:36Z", "message": "Issue #8018: AST based operatorwrap"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a0e1fe173f9a8727c94fc14aae6ee007856b505b", "author": {"user": {"login": "pbludov", "name": "Pavel Bludov"}}, "url": "https://github.com/checkstyle/checkstyle/commit/a0e1fe173f9a8727c94fc14aae6ee007856b505b", "committedDate": "2020-11-22T14:59:36Z", "message": "Issue #8018: AST based operatorwrap"}, "afterCommit": {"oid": "33dd7ad16598dcafb474a4f09de9a85655701022", "author": {"user": {"login": "pbludov", "name": "Pavel Bludov"}}, "url": "https://github.com/checkstyle/checkstyle/commit/33dd7ad16598dcafb474a4f09de9a85655701022", "committedDate": "2020-11-22T14:59:55Z", "message": "Issue #8018: AST based operatorwrap"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "33dd7ad16598dcafb474a4f09de9a85655701022", "author": {"user": {"login": "pbludov", "name": "Pavel Bludov"}}, "url": "https://github.com/checkstyle/checkstyle/commit/33dd7ad16598dcafb474a4f09de9a85655701022", "committedDate": "2020-11-22T14:59:55Z", "message": "Issue #8018: AST based operatorwrap"}, "afterCommit": {"oid": "09a32252e3fdf5210a835f644bda476285c47a07", "author": {"user": {"login": "pbludov", "name": "Pavel Bludov"}}, "url": "https://github.com/checkstyle/checkstyle/commit/09a32252e3fdf5210a835f644bda476285c47a07", "committedDate": "2020-11-22T16:47:32Z", "message": "Issue #8018: AST based operatorwrap"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "09a32252e3fdf5210a835f644bda476285c47a07", "author": {"user": {"login": "pbludov", "name": "Pavel Bludov"}}, "url": "https://github.com/checkstyle/checkstyle/commit/09a32252e3fdf5210a835f644bda476285c47a07", "committedDate": "2020-11-22T16:47:32Z", "message": "Issue #8018: AST based operatorwrap"}, "afterCommit": {"oid": "40c6b13427cb0a2824a48c452638416ea3e30911", "author": {"user": {"login": "pbludov", "name": "Pavel Bludov"}}, "url": "https://github.com/checkstyle/checkstyle/commit/40c6b13427cb0a2824a48c452638416ea3e30911", "committedDate": "2020-11-22T18:22:13Z", "message": "Issue #8018: AST based operatorwrap"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "40c6b13427cb0a2824a48c452638416ea3e30911", "author": {"user": {"login": "pbludov", "name": "Pavel Bludov"}}, "url": "https://github.com/checkstyle/checkstyle/commit/40c6b13427cb0a2824a48c452638416ea3e30911", "committedDate": "2020-11-22T18:22:13Z", "message": "Issue #8018: AST based operatorwrap"}, "afterCommit": {"oid": "02fe3768b17cc9d41e818b25c8cdda343ddd6bdc", "author": {"user": {"login": "pbludov", "name": "Pavel Bludov"}}, "url": "https://github.com/checkstyle/checkstyle/commit/02fe3768b17cc9d41e818b25c8cdda343ddd6bdc", "committedDate": "2020-11-22T20:17:43Z", "message": "Issue #8018: AST based operatorwrap"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM2NDY1NDYy", "url": "https://github.com/checkstyle/checkstyle/pull/9008#pullrequestreview-536465462", "createdAt": "2020-11-23T13:21:36Z", "commit": {"oid": "02fe3768b17cc9d41e818b25c8cdda343ddd6bdc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "02fe3768b17cc9d41e818b25c8cdda343ddd6bdc", "author": {"user": {"login": "pbludov", "name": "Pavel Bludov"}}, "url": "https://github.com/checkstyle/checkstyle/commit/02fe3768b17cc9d41e818b25c8cdda343ddd6bdc", "committedDate": "2020-11-22T20:17:43Z", "message": "Issue #8018: AST based operatorwrap"}, "afterCommit": {"oid": "bb53c5c14b18b943628c71752416d9575c477e15", "author": {"user": {"login": "pbludov", "name": "Pavel Bludov"}}, "url": "https://github.com/checkstyle/checkstyle/commit/bb53c5c14b18b943628c71752416d9575c477e15", "committedDate": "2020-11-25T04:39:40Z", "message": "Issue #8018: AST based operatorwrap"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM4NjQ1MjQx", "url": "https://github.com/checkstyle/checkstyle/pull/9008#pullrequestreview-538645241", "createdAt": "2020-11-25T16:02:38Z", "commit": {"oid": "bb53c5c14b18b943628c71752416d9575c477e15"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQxNjowMjozOFrOH56Huw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQxNjowMjozOFrOH56Huw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDQ4MzEzMQ==", "bodyText": "what is acc ?\nplease use full name.", "url": "https://github.com/checkstyle/checkstyle/pull/9008#discussion_r530483131", "createdAt": "2020-11-25T16:02:38Z", "author": {"login": "romani"}, "path": "src/main/java/com/puppycrawl/tools/checkstyle/checks/whitespace/OperatorWrapCheck.java", "diffHunk": "@@ -302,28 +304,150 @@ public void setOption(String optionStr) {\n \n     @Override\n     public void visitToken(DetailAST ast) {\n-        final DetailAST parent = ast.getParent();\n-        // we do not want to check colon for cases and defaults\n-        if (parent.getType() != TokenTypes.LITERAL_DEFAULT\n-                && parent.getType() != TokenTypes.LITERAL_CASE) {\n-            final String text = ast.getText();\n-            final int colNo = ast.getColumnNo();\n-            final int lineNo = ast.getLineNo();\n-            final String currentLine = getLine(lineNo - 1);\n-\n-            // Check if rest of line is whitespace, and not just the operator\n-            // by itself. This last bit is to handle the operator on a line by\n-            // itself.\n+        if (isOperatorNode(ast)) {\n             if (option == WrapOption.NL\n-                    && !text.equals(currentLine.trim())\n-                    && CommonUtil.isBlank(currentLine.substring(colNo + text.length()))) {\n-                log(ast, MSG_LINE_NEW, text);\n+                    && TokenUtil.areOnSameLine(ast, getLeftNode(ast))\n+                    && !TokenUtil.areOnSameLine(ast, getRightNode(ast))) {\n+                log(ast, MSG_LINE_NEW, ast.getText());\n             }\n             else if (option == WrapOption.EOL\n-                    && CommonUtil.hasWhitespaceBefore(colNo - 1, currentLine)) {\n-                log(ast, MSG_LINE_PREVIOUS, text);\n+                    && !TokenUtil.areOnSameLine(ast, getLeftNode(ast))) {\n+                log(ast, MSG_LINE_PREVIOUS, ast.getText());\n+            }\n+        }\n+    }\n+\n+    /**\n+     * Filters some false tokens that this check should ignore.\n+     *\n+     * @param node the node to check\n+     * @return {@code true} for all nodes this check should validate\n+     */\n+    private static boolean isOperatorNode(DetailAST node) {\n+        final boolean result;\n+        if (node.getType() == TokenTypes.COLON) {\n+            result = !isColonFromLabel(node);\n+        }\n+        else if (node.getType() == TokenTypes.STAR) {\n+            // Unlike the import statement, the multiply operator always has children\n+            result = node.hasChildren();\n+        }\n+        else {\n+            result = true;\n+        }\n+        return result;\n+    }\n+\n+    /**\n+     * Checks if a node is {@link TokenTypes#COLON} from a label, switch case of default.\n+     *\n+     * @param node the node to check\n+     * @return {@code true} if node matches\n+     */\n+    private static boolean isColonFromLabel(DetailAST node) {\n+        return TokenUtil.isOfType(node.getParent(), TokenTypes.LABELED_STAT,\n+            TokenTypes.LITERAL_CASE, TokenTypes.LITERAL_DEFAULT);\n+    }\n+\n+    /**\n+     * Checks if a node is {@link TokenTypes#ASSIGN} to a variable or resource.\n+     *\n+     * @param node the node to check\n+     * @return {@code true} if node matches\n+     */\n+    private static boolean isAssignToVariable(DetailAST node) {\n+        return TokenUtil.isOfType(node.getParent(), TokenTypes.VARIABLE_DEF, TokenTypes.RESOURCE);\n+    }\n+\n+    /**\n+     * Returns the left neighbour of a binary operator. This is the rightmost\n+     * grandchild of the left child or sibling. For the assign operator the return value is\n+     * the variable name.\n+     *\n+     * @param node the binary operator\n+     * @return nearest node from left\n+     */\n+    private static DetailAST getLeftNode(DetailAST node) {\n+        DetailAST result;\n+        if (node.getFirstChild() == null || isAssignToVariable(node)) {\n+            result = node.getPreviousSibling();\n+        }\n+        else {\n+            result = adjustParens(node.getFirstChild(), DetailAST::getNextSibling);\n+        }\n+        while (result.getLastChild() != null) {\n+            result = result.getLastChild();\n+        }\n+        return result;\n+    }\n+\n+    /**\n+     * Returns the right neighbour of a binary operator. This is the leftmost\n+     * grandchild of the right child or sibling. For the ternary operator this\n+     * is the node between {@code ?} and {@code :} .\n+     *\n+     * @param node the binary operator\n+     * @return nearest node from right\n+     */\n+    private static DetailAST getRightNode(DetailAST node) {\n+        DetailAST result;\n+        if (node.getLastChild() == null) {\n+            result = node.getNextSibling();\n+        }\n+        else {\n+            final DetailAST rightNode;\n+            if (node.getType() == TokenTypes.QUESTION) {\n+                rightNode = node.findFirstToken(TokenTypes.COLON).getPreviousSibling();\n+            }\n+            else {\n+                rightNode = node.getLastChild();\n+            }\n+            result = adjustParens(rightNode, DetailAST::getPreviousSibling);\n+        }\n+\n+        // The ARRAY_INIT AST is confusing. It should be\n+        // ARRAY_INIT\n+        // |--LCURLY (first child)\n+        // `--RCURLY (last child)\n+        // but there is no LCURLY for ARRAY_INIT\n+        if (result.getType() != TokenTypes.ARRAY_INIT) {\n+            while (result.getFirstChild() != null) {\n+                result = result.getFirstChild();\n+            }\n+        }\n+        return result;\n+    }\n+\n+    /**\n+     * Finds matching parentheses among siblings. If the given node is not\n+     * {@link TokenTypes#LPAREN} nor {@link TokenTypes#RPAREN}, the method adjusts nothing.\n+     * This method is for handling case like {@code\n+     *   (condition && (condition\n+     *     || condition2 || condition3) && condition4\n+     *     && condition3)\n+     * }\n+     *\n+     * @param node the node to adjust\n+     * @param step the node transformer, should be {@link DetailAST#getPreviousSibling}\n+     *             or {@link DetailAST#getNextSibling}\n+     * @return adjusted node\n+     */\n+    private static DetailAST adjustParens(DetailAST node, UnaryOperator<DetailAST> step) {\n+        DetailAST result = node;\n+        int acc = 0;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bb53c5c14b18b943628c71752416d9575c477e15"}, "originalPosition": 166}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bb53c5c14b18b943628c71752416d9575c477e15", "author": {"user": {"login": "pbludov", "name": "Pavel Bludov"}}, "url": "https://github.com/checkstyle/checkstyle/commit/bb53c5c14b18b943628c71752416d9575c477e15", "committedDate": "2020-11-25T04:39:40Z", "message": "Issue #8018: AST based operatorwrap"}, "afterCommit": {"oid": "f19e144dd9daf87d07b8344aa69d84574441b273", "author": {"user": {"login": "pbludov", "name": "Pavel Bludov"}}, "url": "https://github.com/checkstyle/checkstyle/commit/f19e144dd9daf87d07b8344aa69d84574441b273", "committedDate": "2020-11-28T11:43:29Z", "message": "Issue #8018: AST based operatorwrap"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f19e144dd9daf87d07b8344aa69d84574441b273", "author": {"user": {"login": "pbludov", "name": "Pavel Bludov"}}, "url": "https://github.com/checkstyle/checkstyle/commit/f19e144dd9daf87d07b8344aa69d84574441b273", "committedDate": "2020-11-28T11:43:29Z", "message": "Issue #8018: AST based operatorwrap"}, "afterCommit": {"oid": "a9fca361e025bee085f85ff2f950bf518a8d0980", "author": {"user": {"login": "pbludov", "name": "Pavel Bludov"}}, "url": "https://github.com/checkstyle/checkstyle/commit/a9fca361e025bee085f85ff2f950bf518a8d0980", "committedDate": "2020-11-29T08:47:35Z", "message": "Issue #8018: AST based operatorwrap"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a9fca361e025bee085f85ff2f950bf518a8d0980", "author": {"user": {"login": "pbludov", "name": "Pavel Bludov"}}, "url": "https://github.com/checkstyle/checkstyle/commit/a9fca361e025bee085f85ff2f950bf518a8d0980", "committedDate": "2020-11-29T08:47:35Z", "message": "Issue #8018: AST based operatorwrap"}, "afterCommit": {"oid": "a50e901c4feff326e0ad9e8cc34d03be03c0bd3c", "author": {"user": {"login": "pbludov", "name": "Pavel Bludov"}}, "url": "https://github.com/checkstyle/checkstyle/commit/a50e901c4feff326e0ad9e8cc34d03be03c0bd3c", "committedDate": "2020-12-05T11:15:57Z", "message": "Issue #8018: AST based operatorwrap"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a50e901c4feff326e0ad9e8cc34d03be03c0bd3c", "author": {"user": {"login": "pbludov", "name": "Pavel Bludov"}}, "url": "https://github.com/checkstyle/checkstyle/commit/a50e901c4feff326e0ad9e8cc34d03be03c0bd3c", "committedDate": "2020-12-05T11:15:57Z", "message": "Issue #8018: AST based operatorwrap"}, "afterCommit": {"oid": "adc711a4755f76d8a17358d113019fff4e5ceaa0", "author": {"user": {"login": "pbludov", "name": "Pavel Bludov"}}, "url": "https://github.com/checkstyle/checkstyle/commit/adc711a4755f76d8a17358d113019fff4e5ceaa0", "committedDate": "2020-12-05T11:19:40Z", "message": "Issue #8018: AST based operatorwrap"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU3NDU5NDcz", "url": "https://github.com/checkstyle/checkstyle/pull/9008#pullrequestreview-557459473", "createdAt": "2020-12-23T01:32:42Z", "commit": {"oid": "adc711a4755f76d8a17358d113019fff4e5ceaa0"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QwMTozMjo0MlrOIKOVTw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QwMTozNToxMFrOIKOXsg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzU5MTUwMw==", "bodyText": "description of method is not same a name of method.\nshould we name method more abstract ... like isTargetNode", "url": "https://github.com/checkstyle/checkstyle/pull/9008#discussion_r547591503", "createdAt": "2020-12-23T01:32:42Z", "author": {"login": "romani"}, "path": "src/main/java/com/puppycrawl/tools/checkstyle/checks/whitespace/OperatorWrapCheck.java", "diffHunk": "@@ -302,28 +304,150 @@ public void setOption(String optionStr) {\n \n     @Override\n     public void visitToken(DetailAST ast) {\n-        final DetailAST parent = ast.getParent();\n-        // we do not want to check colon for cases and defaults\n-        if (parent.getType() != TokenTypes.LITERAL_DEFAULT\n-                && parent.getType() != TokenTypes.LITERAL_CASE) {\n-            final String text = ast.getText();\n-            final int colNo = ast.getColumnNo();\n-            final int lineNo = ast.getLineNo();\n-            final String currentLine = getLine(lineNo - 1);\n-\n-            // Check if rest of line is whitespace, and not just the operator\n-            // by itself. This last bit is to handle the operator on a line by\n-            // itself.\n+        if (isOperatorNode(ast)) {\n             if (option == WrapOption.NL\n-                    && !text.equals(currentLine.trim())\n-                    && CommonUtil.isBlank(currentLine.substring(colNo + text.length()))) {\n-                log(ast, MSG_LINE_NEW, text);\n+                    && TokenUtil.areOnSameLine(ast, getLeftNode(ast))\n+                    && !TokenUtil.areOnSameLine(ast, getRightNode(ast))) {\n+                log(ast, MSG_LINE_NEW, ast.getText());\n             }\n             else if (option == WrapOption.EOL\n-                    && CommonUtil.hasWhitespaceBefore(colNo - 1, currentLine)) {\n-                log(ast, MSG_LINE_PREVIOUS, text);\n+                    && !TokenUtil.areOnSameLine(ast, getLeftNode(ast))) {\n+                log(ast, MSG_LINE_PREVIOUS, ast.getText());\n+            }\n+        }\n+    }\n+\n+    /**\n+     * Filters some false tokens that this check should ignore.\n+     *\n+     * @param node the node to check\n+     * @return {@code true} for all nodes this check should validate\n+     */\n+    private static boolean isOperatorNode(DetailAST node) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "adc711a4755f76d8a17358d113019fff4e5ceaa0"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzU5MjExNA==", "bodyText": "is it more readable form:\nif (isOperatorNode(ast)) {\n    if (option == WrapOption.NL) {\n        if (TokenUtil.areOnSameLine(ast, getLeftNode(ast))\n              && !TokenUtil.areOnSameLine(ast, getRightNode(ast))) {\n           log(ast, MSG_LINE_NEW, ast.getText());\n        }\n    }\n    else if (option == WrapOption.EOL) {\n      if (!TokenUtil.areOnSameLine(ast, getLeftNode(ast))) {\n        log(ast, MSG_LINE_PREVIOUS, ast.getText());\n      }\n    }\n}\n\n\nuser who debug certain option will not need to real long expressions at all.", "url": "https://github.com/checkstyle/checkstyle/pull/9008#discussion_r547592114", "createdAt": "2020-12-23T01:35:10Z", "author": {"login": "romani"}, "path": "src/main/java/com/puppycrawl/tools/checkstyle/checks/whitespace/OperatorWrapCheck.java", "diffHunk": "@@ -302,28 +304,150 @@ public void setOption(String optionStr) {\n \n     @Override\n     public void visitToken(DetailAST ast) {\n-        final DetailAST parent = ast.getParent();\n-        // we do not want to check colon for cases and defaults\n-        if (parent.getType() != TokenTypes.LITERAL_DEFAULT\n-                && parent.getType() != TokenTypes.LITERAL_CASE) {\n-            final String text = ast.getText();\n-            final int colNo = ast.getColumnNo();\n-            final int lineNo = ast.getLineNo();\n-            final String currentLine = getLine(lineNo - 1);\n-\n-            // Check if rest of line is whitespace, and not just the operator\n-            // by itself. This last bit is to handle the operator on a line by\n-            // itself.\n+        if (isOperatorNode(ast)) {\n             if (option == WrapOption.NL\n-                    && !text.equals(currentLine.trim())\n-                    && CommonUtil.isBlank(currentLine.substring(colNo + text.length()))) {\n-                log(ast, MSG_LINE_NEW, text);\n+                    && TokenUtil.areOnSameLine(ast, getLeftNode(ast))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "adc711a4755f76d8a17358d113019fff4e5ceaa0"}, "originalPosition": 36}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "adc711a4755f76d8a17358d113019fff4e5ceaa0", "author": {"user": {"login": "pbludov", "name": "Pavel Bludov"}}, "url": "https://github.com/checkstyle/checkstyle/commit/adc711a4755f76d8a17358d113019fff4e5ceaa0", "committedDate": "2020-12-05T11:19:40Z", "message": "Issue #8018: AST based operatorwrap"}, "afterCommit": {"oid": "7b370a84dfa2106d7f4018ab7486146211007347", "author": {"user": {"login": "pbludov", "name": "Pavel Bludov"}}, "url": "https://github.com/checkstyle/checkstyle/commit/7b370a84dfa2106d7f4018ab7486146211007347", "committedDate": "2020-12-24T19:16:44Z", "message": "Issue #8018: AST based operatorwrap"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU4OTAyMjU2", "url": "https://github.com/checkstyle/checkstyle/pull/9008#pullrequestreview-558902256", "createdAt": "2020-12-27T03:50:05Z", "commit": {"oid": "7b370a84dfa2106d7f4018ab7486146211007347"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yN1QwMzo1MDowNVrOILoA_A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yN1QwMzo1MDowNVrOILoA_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTA2MDg2MA==", "bodyText": "please make it like:\nif (option == WrapOption.NL && isNewLineModeViolation(ast)) {\nthe same method name update for other mode.", "url": "https://github.com/checkstyle/checkstyle/pull/9008#discussion_r549060860", "createdAt": "2020-12-27T03:50:05Z", "author": {"login": "romani"}, "path": "src/main/java/com/puppycrawl/tools/checkstyle/checks/whitespace/OperatorWrapCheck.java", "diffHunk": "@@ -302,28 +304,168 @@ public void setOption(String optionStr) {\n \n     @Override\n     public void visitToken(DetailAST ast) {\n-        final DetailAST parent = ast.getParent();\n-        // we do not want to check colon for cases and defaults\n-        if (parent.getType() != TokenTypes.LITERAL_DEFAULT\n-                && parent.getType() != TokenTypes.LITERAL_CASE) {\n-            final String text = ast.getText();\n-            final int colNo = ast.getColumnNo();\n-            final int lineNo = ast.getLineNo();\n-            final String currentLine = getLine(lineNo - 1);\n+        if (isTargetNode(ast)) {\n+            if (option == WrapOption.NL && isNewLineViolation(ast)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7b370a84dfa2106d7f4018ab7486146211007347"}, "originalPosition": 28}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "79c5bd239c2fef94f29115eb282dbbae3f4abf18", "author": {"user": {"login": "pbludov", "name": "Pavel Bludov"}}, "url": "https://github.com/checkstyle/checkstyle/commit/79c5bd239c2fef94f29115eb282dbbae3f4abf18", "committedDate": "2020-12-27T08:33:55Z", "message": "Issue #8018: AST based operatorwrap"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7b370a84dfa2106d7f4018ab7486146211007347", "author": {"user": {"login": "pbludov", "name": "Pavel Bludov"}}, "url": "https://github.com/checkstyle/checkstyle/commit/7b370a84dfa2106d7f4018ab7486146211007347", "committedDate": "2020-12-24T19:16:44Z", "message": "Issue #8018: AST based operatorwrap"}, "afterCommit": {"oid": "79c5bd239c2fef94f29115eb282dbbae3f4abf18", "author": {"user": {"login": "pbludov", "name": "Pavel Bludov"}}, "url": "https://github.com/checkstyle/checkstyle/commit/79c5bd239c2fef94f29115eb282dbbae3f4abf18", "committedDate": "2020-12-27T08:33:55Z", "message": "Issue #8018: AST based operatorwrap"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1427, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}