{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAyMzUzNTkw", "number": 8896, "title": "Issue #8341: add LambdaBodyLengthCheck", "bodyText": "Closes #8341\nDepends on #8897\nit is new module, so all mentors need to review.\nContrib PR: checkstyle/contribution#512\nDiff Regression projects: https://gist.githubusercontent.com/nmancus1/e3988f8092d919b5cbe70f5359c4d9e8/raw/a0f6f5860f8025c19868061dee6e0e40960b992f/projects-to-test-on.properties\nNew module config: https://gist.githubusercontent.com/strkkk/bf10f326cacdf50f8cb67f0023cd972b/raw/c9710499bd4d853d8d56b71aa55c10f8ab33a56e/lambda_body.xml", "createdAt": "2020-10-13T14:00:34Z", "url": "https://github.com/checkstyle/checkstyle/pull/8896", "merged": true, "mergeCommit": {"oid": "1d500f05b91773a40e35cac884eb697c661ec5a6"}, "closed": true, "closedAt": "2020-10-28T23:11:42Z", "author": {"login": "strkkk"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdSKG-6gBqjM4NzE5NDYwNzc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdXF6ylAFqTUxOTE1MDQwMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e91f1d35d444abe5b6eaf512a8b2e81d01d6fd09", "author": {"user": {"login": "strkkk", "name": "Andrei Paikin"}}, "url": "https://github.com/checkstyle/checkstyle/commit/e91f1d35d444abe5b6eaf512a8b2e81d01d6fd09", "committedDate": "2020-10-13T13:54:01Z", "message": "minor: refactor long lambdas"}, "afterCommit": {"oid": "c702f2180cf77ea24617e7663d9c3fd6cc76bbc0", "author": {"user": {"login": "strkkk", "name": "Andrei Paikin"}}, "url": "https://github.com/checkstyle/checkstyle/commit/c702f2180cf77ea24617e7663d9c3fd6cc76bbc0", "committedDate": "2020-10-13T15:04:17Z", "message": "Issue #8341: Add LambdaBodyLengthCheck"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c702f2180cf77ea24617e7663d9c3fd6cc76bbc0", "author": {"user": {"login": "strkkk", "name": "Andrei Paikin"}}, "url": "https://github.com/checkstyle/checkstyle/commit/c702f2180cf77ea24617e7663d9c3fd6cc76bbc0", "committedDate": "2020-10-13T15:04:17Z", "message": "Issue #8341: Add LambdaBodyLengthCheck"}, "afterCommit": {"oid": "6d691839156b97daa76607bc4be00f008ce33773", "author": {"user": {"login": "strkkk", "name": "Andrei Paikin"}}, "url": "https://github.com/checkstyle/checkstyle/commit/6d691839156b97daa76607bc4be00f008ce33773", "committedDate": "2020-10-15T13:52:58Z", "message": "Issue #8341: Add LambdaBodyLengthCheck"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5NDA2NjEx", "url": "https://github.com/checkstyle/checkstyle/pull/8896#pullrequestreview-509406611", "createdAt": "2020-10-15T13:55:48Z", "commit": {"oid": "6d691839156b97daa76607bc4be00f008ce33773"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxMzo1NTo0OFrOHiJGyg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxMzo1OTozOFrOHiJTTg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTU2MjgyNg==", "bodyText": "// line 2 what for this ?\ndo you mean // line 2 of lambda, if yes , please update a comment.", "url": "https://github.com/checkstyle/checkstyle/pull/8896#discussion_r505562826", "createdAt": "2020-10-15T13:55:48Z", "author": {"login": "romani"}, "path": "src/main/java/com/puppycrawl/tools/checkstyle/checks/sizes/LambdaBodyLengthCheck.java", "diffHunk": "@@ -0,0 +1,234 @@\n+////////////////////////////////////////////////////////////////////////////////\n+// checkstyle: Checks Java source code for adherence to a set of rules.\n+// Copyright (C) 2001-2020 the original author or authors.\n+//\n+// This library is free software; you can redistribute it and/or\n+// modify it under the terms of the GNU Lesser General Public\n+// License as published by the Free Software Foundation; either\n+// version 2.1 of the License, or (at your option) any later version.\n+//\n+// This library is distributed in the hope that it will be useful,\n+// but WITHOUT ANY WARRANTY; without even the implied warranty of\n+// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n+// Lesser General Public License for more details.\n+//\n+// You should have received a copy of the GNU Lesser General Public\n+// License along with this library; if not, write to the Free Software\n+// Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA\n+////////////////////////////////////////////////////////////////////////////////\n+\n+package com.puppycrawl.tools.checkstyle.checks.sizes;\n+\n+import com.puppycrawl.tools.checkstyle.StatelessCheck;\n+import com.puppycrawl.tools.checkstyle.api.AbstractCheck;\n+import com.puppycrawl.tools.checkstyle.api.DetailAST;\n+import com.puppycrawl.tools.checkstyle.api.TokenTypes;\n+\n+/**\n+ * <p>\n+ * Checks lambda body length.\n+ * </p>\n+ * <p>\n+ * Rationale: Similar to anonymous inner classes, if lambda body becomes very long\n+ * it is hard to understand and to see the flow of the method\n+ * where the lambda is defined. Therefore long lambda body\n+ * should usually be extracted to method.\n+ * </p>\n+ * <ul>\n+ * <li>\n+ * Property {@code max} - Specify the maximum number of lines allowed.\n+ * Type is {@code int}.\n+ * Default value is {@code 10}.\n+ * </li>\n+ * </ul>\n+ * <p>\n+ * To configure the check to accept lambda bodies with up to 10 lines:\n+ * </p>\n+ * <pre>\n+ * &lt;module name=\"LambdaBodyLength\"/&gt;\n+ * </pre>\n+ * <p>\n+ * Example:\n+ * </p>\n+ * <pre>\n+ * class Test {\n+ *   Runnable r = () -> { // violation, 11 lines\n+ *       System.out.println(2); // line 2\n+ *       System.out.println(3);\n+ *       System.out.println(4);\n+ *       System.out.println(5);\n+ *       System.out.println(6);\n+ *       System.out.println(7);\n+ *       System.out.println(8);\n+ *       System.out.println(9);\n+ *       System.out.println(10);\n+ *   }; // line 11\n+ *\n+ *   Runnable r2 = () -> // violation, 11 lines\n+ *       \"someString\".trim() // line 1\n+ *                   .trim()\n+ *                   .trim()\n+ *                   .trim()\n+ *                   .trim()\n+ *                   .trim()\n+ *                   .trim()\n+ *                   .trim()\n+ *                   .trim()\n+ *                   .trim()\n+ *                   .trim(); // line 11\n+ *\n+ *   Runnable r3 = () -> { // ok, 10 lines\n+ *       System.out.println(2); // line 2\n+ *       System.out.println(3);\n+ *       System.out.println(4);\n+ *       System.out.println(5);\n+ *       System.out.println(6);\n+ *       System.out.println(7);\n+ *       System.out.println(8);\n+ *       System.out.println(9);\n+ *   }; // line 10\n+ * }\n+ * </pre>\n+ * <p>\n+ * To configure the check to accept lambda bodies with max 5 lines:\n+ * </p>\n+ * <pre>\n+ * &lt;module name=\"LambdaBodyLength\"&gt;\n+ *   &lt;property name=\"max\" value=\"5\"/&gt;\n+ * &lt;/module&gt;\n+ * </pre>\n+ * <p>\n+ * Example:\n+ * </p>\n+ * <pre>\n+ * class Test {\n+ *   Runnable r = () -> { // violation, 6 lines\n+ *       System.out.println(2); // line 2", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6d691839156b97daa76607bc4be00f008ce33773"}, "originalPosition": 106}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTU2NjAzMA==", "bodyText": "we keep setters after fields usually, strange that non of Check of methods order is not complaining on this.", "url": "https://github.com/checkstyle/checkstyle/pull/8896#discussion_r505566030", "createdAt": "2020-10-15T13:59:38Z", "author": {"login": "romani"}, "path": "src/main/java/com/puppycrawl/tools/checkstyle/checks/sizes/LambdaBodyLengthCheck.java", "diffHunk": "@@ -0,0 +1,234 @@\n+////////////////////////////////////////////////////////////////////////////////\n+// checkstyle: Checks Java source code for adherence to a set of rules.\n+// Copyright (C) 2001-2020 the original author or authors.\n+//\n+// This library is free software; you can redistribute it and/or\n+// modify it under the terms of the GNU Lesser General Public\n+// License as published by the Free Software Foundation; either\n+// version 2.1 of the License, or (at your option) any later version.\n+//\n+// This library is distributed in the hope that it will be useful,\n+// but WITHOUT ANY WARRANTY; without even the implied warranty of\n+// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n+// Lesser General Public License for more details.\n+//\n+// You should have received a copy of the GNU Lesser General Public\n+// License along with this library; if not, write to the Free Software\n+// Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA\n+////////////////////////////////////////////////////////////////////////////////\n+\n+package com.puppycrawl.tools.checkstyle.checks.sizes;\n+\n+import com.puppycrawl.tools.checkstyle.StatelessCheck;\n+import com.puppycrawl.tools.checkstyle.api.AbstractCheck;\n+import com.puppycrawl.tools.checkstyle.api.DetailAST;\n+import com.puppycrawl.tools.checkstyle.api.TokenTypes;\n+\n+/**\n+ * <p>\n+ * Checks lambda body length.\n+ * </p>\n+ * <p>\n+ * Rationale: Similar to anonymous inner classes, if lambda body becomes very long\n+ * it is hard to understand and to see the flow of the method\n+ * where the lambda is defined. Therefore long lambda body\n+ * should usually be extracted to method.\n+ * </p>\n+ * <ul>\n+ * <li>\n+ * Property {@code max} - Specify the maximum number of lines allowed.\n+ * Type is {@code int}.\n+ * Default value is {@code 10}.\n+ * </li>\n+ * </ul>\n+ * <p>\n+ * To configure the check to accept lambda bodies with up to 10 lines:\n+ * </p>\n+ * <pre>\n+ * &lt;module name=\"LambdaBodyLength\"/&gt;\n+ * </pre>\n+ * <p>\n+ * Example:\n+ * </p>\n+ * <pre>\n+ * class Test {\n+ *   Runnable r = () -> { // violation, 11 lines\n+ *       System.out.println(2); // line 2\n+ *       System.out.println(3);\n+ *       System.out.println(4);\n+ *       System.out.println(5);\n+ *       System.out.println(6);\n+ *       System.out.println(7);\n+ *       System.out.println(8);\n+ *       System.out.println(9);\n+ *       System.out.println(10);\n+ *   }; // line 11\n+ *\n+ *   Runnable r2 = () -> // violation, 11 lines\n+ *       \"someString\".trim() // line 1\n+ *                   .trim()\n+ *                   .trim()\n+ *                   .trim()\n+ *                   .trim()\n+ *                   .trim()\n+ *                   .trim()\n+ *                   .trim()\n+ *                   .trim()\n+ *                   .trim()\n+ *                   .trim(); // line 11\n+ *\n+ *   Runnable r3 = () -> { // ok, 10 lines\n+ *       System.out.println(2); // line 2\n+ *       System.out.println(3);\n+ *       System.out.println(4);\n+ *       System.out.println(5);\n+ *       System.out.println(6);\n+ *       System.out.println(7);\n+ *       System.out.println(8);\n+ *       System.out.println(9);\n+ *   }; // line 10\n+ * }\n+ * </pre>\n+ * <p>\n+ * To configure the check to accept lambda bodies with max 5 lines:\n+ * </p>\n+ * <pre>\n+ * &lt;module name=\"LambdaBodyLength\"&gt;\n+ *   &lt;property name=\"max\" value=\"5\"/&gt;\n+ * &lt;/module&gt;\n+ * </pre>\n+ * <p>\n+ * Example:\n+ * </p>\n+ * <pre>\n+ * class Test {\n+ *   Runnable r = () -> { // violation, 6 lines\n+ *       System.out.println(2); // line 2\n+ *       System.out.println(3);\n+ *       System.out.println(4);\n+ *       System.out.println(5);\n+ *   };\n+ *\n+ *   Runnable r2 = () -> // violation, 6 lines\n+ *       \"someString\".trim()\n+ *                   .trim()\n+ *                   .trim()\n+ *                   .trim()\n+ *                   .trim()\n+ *                   .trim();\n+ *\n+ *   Runnable r3 = () -> { // ok, 5 lines\n+ *       System.out.println(2);\n+ *       System.out.println(3);\n+ *       System.out.println(4);\n+ *   };\n+ * }\n+ * </pre>\n+ * <p>\n+ * Parent is {@code com.puppycrawl.tools.checkstyle.TreeWalker}\n+ * </p>\n+ * <p>\n+ * Violation Message Keys:\n+ * </p>\n+ * <ul>\n+ * <li>\n+ * {@code maxLen.lambdaBody}\n+ * </li>\n+ * </ul>\n+ *\n+ * @since 8.37\n+ */\n+@StatelessCheck\n+public class LambdaBodyLengthCheck extends AbstractCheck {\n+\n+    /**\n+     * A key is pointing to the warning message text in \"messages.properties\"\n+     * file.\n+     */\n+    public static final String MSG_KEY = \"maxLen.lambdaBody\";\n+\n+    /** Default maximum number of lines. */\n+    private static final int DEFAULT_MAX = 10;\n+\n+    /** Specify the maximum number of lines allowed. */\n+    private int max = DEFAULT_MAX;\n+\n+    @Override\n+    public int[] getDefaultTokens() {\n+        return getRequiredTokens();\n+    }\n+\n+    @Override\n+    public int[] getAcceptableTokens() {\n+        return getRequiredTokens();\n+    }\n+\n+    @Override\n+    public int[] getRequiredTokens() {\n+        return new int[] {TokenTypes.LAMBDA};\n+    }\n+\n+    @Override\n+    public void visitToken(DetailAST ast) {\n+        if (ast.getParent().getType() != TokenTypes.SWITCH_RULE) {\n+            final int length = getLength(ast);\n+            if (length > max) {\n+                log(ast, MSG_KEY, length, max);\n+            }\n+        }\n+    }\n+\n+    private static int getLength(DetailAST ast) {\n+        final DetailAST lambdaBody = ast.getLastChild();\n+        final int length;\n+        if (lambdaBody.getType() == TokenTypes.SLIST) {\n+            length = lambdaBody.getLastChild().getLineNo() - lambdaBody.getLineNo();\n+        }\n+        else {\n+            length = getLastNodeLineNumber(lambdaBody) - getFirstNodeLineNumber(lambdaBody);\n+        }\n+        return length + 1;\n+    }\n+\n+    /**\n+     * Get last node line number.\n+     *\n+     * @param lambdaBody lambda body node.\n+     * @return last node line number.\n+     */\n+    private static int getLastNodeLineNumber(DetailAST lambdaBody) {\n+        DetailAST node = lambdaBody.getLastChild();\n+        int result = node.getLineNo();\n+        while (node != null) {\n+            result = node.getLineNo();\n+            node = node.getLastChild();\n+        }\n+        return result;\n+    }\n+\n+    /**\n+     * Get first node line number.\n+     *\n+     * @param lambdaBody lambda body node.\n+     * @return first node line number.\n+     */\n+    private static int getFirstNodeLineNumber(DetailAST lambdaBody) {\n+        DetailAST node = lambdaBody.getFirstChild();\n+        int result = node.getLineNo();\n+        while (node != null) {\n+            result = node.getLineNo();\n+            node = node.getFirstChild();\n+        }\n+        return result;\n+    }\n+\n+    /**\n+     * Setter to specify the maximum number of lines allowed.\n+     *\n+     * @param length the maximum length of lambda body.\n+     */\n+    public void setMax(int length) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6d691839156b97daa76607bc4be00f008ce33773"}, "originalPosition": 230}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6d691839156b97daa76607bc4be00f008ce33773", "author": {"user": {"login": "strkkk", "name": "Andrei Paikin"}}, "url": "https://github.com/checkstyle/checkstyle/commit/6d691839156b97daa76607bc4be00f008ce33773", "committedDate": "2020-10-15T13:52:58Z", "message": "Issue #8341: Add LambdaBodyLengthCheck"}, "afterCommit": {"oid": "b5a97e2c3a74e15a67a6387c20e81ebce0da8298", "author": {"user": {"login": "strkkk", "name": "Andrei Paikin"}}, "url": "https://github.com/checkstyle/checkstyle/commit/b5a97e2c3a74e15a67a6387c20e81ebce0da8298", "committedDate": "2020-10-16T08:40:53Z", "message": "Issue #8341: Add LambdaBodyLengthCheck"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwNDA4NzAz", "url": "https://github.com/checkstyle/checkstyle/pull/8896#pullrequestreview-510408703", "createdAt": "2020-10-16T12:08:49Z", "commit": {"oid": "b5a97e2c3a74e15a67a6387c20e81ebce0da8298"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxMjowODo0OVrOHi5GoA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxMjoyNDo0M1rOHi5y8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjM0OTIxNg==", "bodyText": "please use .concat(\"2\")..concat(\"3\") , same idea as in previous example, I like it , it is very visual.", "url": "https://github.com/checkstyle/checkstyle/pull/8896#discussion_r506349216", "createdAt": "2020-10-16T12:08:49Z", "author": {"login": "romani"}, "path": "src/main/java/com/puppycrawl/tools/checkstyle/checks/sizes/LambdaBodyLengthCheck.java", "diffHunk": "@@ -0,0 +1,234 @@\n+////////////////////////////////////////////////////////////////////////////////\n+// checkstyle: Checks Java source code for adherence to a set of rules.\n+// Copyright (C) 2001-2020 the original author or authors.\n+//\n+// This library is free software; you can redistribute it and/or\n+// modify it under the terms of the GNU Lesser General Public\n+// License as published by the Free Software Foundation; either\n+// version 2.1 of the License, or (at your option) any later version.\n+//\n+// This library is distributed in the hope that it will be useful,\n+// but WITHOUT ANY WARRANTY; without even the implied warranty of\n+// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n+// Lesser General Public License for more details.\n+//\n+// You should have received a copy of the GNU Lesser General Public\n+// License along with this library; if not, write to the Free Software\n+// Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA\n+////////////////////////////////////////////////////////////////////////////////\n+\n+package com.puppycrawl.tools.checkstyle.checks.sizes;\n+\n+import com.puppycrawl.tools.checkstyle.StatelessCheck;\n+import com.puppycrawl.tools.checkstyle.api.AbstractCheck;\n+import com.puppycrawl.tools.checkstyle.api.DetailAST;\n+import com.puppycrawl.tools.checkstyle.api.TokenTypes;\n+\n+/**\n+ * <p>\n+ * Checks lambda body length.\n+ * </p>\n+ * <p>\n+ * Rationale: Similar to anonymous inner classes, if lambda body becomes very long\n+ * it is hard to understand and to see the flow of the method\n+ * where the lambda is defined. Therefore long lambda body\n+ * should usually be extracted to method.\n+ * </p>\n+ * <ul>\n+ * <li>\n+ * Property {@code max} - Specify the maximum number of lines allowed.\n+ * Type is {@code int}.\n+ * Default value is {@code 10}.\n+ * </li>\n+ * </ul>\n+ * <p>\n+ * To configure the check to accept lambda bodies with up to 10 lines:\n+ * </p>\n+ * <pre>\n+ * &lt;module name=\"LambdaBodyLength\"/&gt;\n+ * </pre>\n+ * <p>\n+ * Example:\n+ * </p>\n+ * <pre>\n+ * class Test {\n+ *   Runnable r = () -&gt; { // violation, 11 lines\n+ *       System.out.println(2); // line 2 of lambda\n+ *       System.out.println(3);\n+ *       System.out.println(4);\n+ *       System.out.println(5);\n+ *       System.out.println(6);\n+ *       System.out.println(7);\n+ *       System.out.println(8);\n+ *       System.out.println(9);\n+ *       System.out.println(10);\n+ *   }; // line 11\n+ *\n+ *   Runnable r2 = () -&gt; // violation, 11 lines\n+ *       \"someString\".trim() // line 1 of lambda\n+ *                   .trim()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b5a97e2c3a74e15a67a6387c20e81ebce0da8298"}, "originalPosition": 69}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjM1NjA4Mg==", "bodyText": "please confirm that we count lines with curly braces in other Checks.\nUsers might find it not obvious that counting is different for cases with and without curly braces.\nthey are visually take the same size on screen, so might have same way of counting.", "url": "https://github.com/checkstyle/checkstyle/pull/8896#discussion_r506356082", "createdAt": "2020-10-16T12:18:44Z", "author": {"login": "romani"}, "path": "src/main/java/com/puppycrawl/tools/checkstyle/checks/sizes/LambdaBodyLengthCheck.java", "diffHunk": "@@ -0,0 +1,234 @@\n+////////////////////////////////////////////////////////////////////////////////\n+// checkstyle: Checks Java source code for adherence to a set of rules.\n+// Copyright (C) 2001-2020 the original author or authors.\n+//\n+// This library is free software; you can redistribute it and/or\n+// modify it under the terms of the GNU Lesser General Public\n+// License as published by the Free Software Foundation; either\n+// version 2.1 of the License, or (at your option) any later version.\n+//\n+// This library is distributed in the hope that it will be useful,\n+// but WITHOUT ANY WARRANTY; without even the implied warranty of\n+// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n+// Lesser General Public License for more details.\n+//\n+// You should have received a copy of the GNU Lesser General Public\n+// License along with this library; if not, write to the Free Software\n+// Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA\n+////////////////////////////////////////////////////////////////////////////////\n+\n+package com.puppycrawl.tools.checkstyle.checks.sizes;\n+\n+import com.puppycrawl.tools.checkstyle.StatelessCheck;\n+import com.puppycrawl.tools.checkstyle.api.AbstractCheck;\n+import com.puppycrawl.tools.checkstyle.api.DetailAST;\n+import com.puppycrawl.tools.checkstyle.api.TokenTypes;\n+\n+/**\n+ * <p>\n+ * Checks lambda body length.\n+ * </p>\n+ * <p>\n+ * Rationale: Similar to anonymous inner classes, if lambda body becomes very long\n+ * it is hard to understand and to see the flow of the method\n+ * where the lambda is defined. Therefore long lambda body\n+ * should usually be extracted to method.\n+ * </p>\n+ * <ul>\n+ * <li>\n+ * Property {@code max} - Specify the maximum number of lines allowed.\n+ * Type is {@code int}.\n+ * Default value is {@code 10}.\n+ * </li>\n+ * </ul>\n+ * <p>\n+ * To configure the check to accept lambda bodies with up to 10 lines:\n+ * </p>\n+ * <pre>\n+ * &lt;module name=\"LambdaBodyLength\"/&gt;\n+ * </pre>\n+ * <p>\n+ * Example:\n+ * </p>\n+ * <pre>\n+ * class Test {\n+ *   Runnable r = () -&gt; { // violation, 11 lines\n+ *       System.out.println(2); // line 2 of lambda", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b5a97e2c3a74e15a67a6387c20e81ebce0da8298"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjM1OTQ2MA==", "bodyText": "please use line number of lamba in argument of method , it is really cool idea to make it more visual.", "url": "https://github.com/checkstyle/checkstyle/pull/8896#discussion_r506359460", "createdAt": "2020-10-16T12:23:17Z", "author": {"login": "romani"}, "path": "src/test/resources-noncompilable/com/puppycrawl/tools/checkstyle/checks/sizes/lambdabodylength/InputLambdaBodyLengthSwitchExps.java", "diffHunk": "@@ -0,0 +1,34 @@\n+//non-compiled with javac: Compilable with Java14\n+package com.puppycrawl.tools.checkstyle.checks.sizes.lambdabodylength;\n+\n+import java.util.stream.Stream;\n+\n+/* Config: default\n+ */\n+public class InputLambdaBodyLengthSwitchExps {\n+\n+    boolean method1(Nums k, String string) {\n+        switch (k) {\n+        case ONE -> { // ok\n+            Stream.of(string.split(\" \"))\n+                .anyMatch(Word -> \"in\".equals(Word));\n+            System.out.println(1);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b5a97e2c3a74e15a67a6387c20e81ebce0da8298"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjM1OTk1MA==", "bodyText": "\"10\"", "url": "https://github.com/checkstyle/checkstyle/pull/8896#discussion_r506359950", "createdAt": "2020-10-16T12:23:55Z", "author": {"login": "romani"}, "path": "src/test/resources/com/puppycrawl/tools/checkstyle/checks/sizes/lambdabodylength/InputLambdaBodyLengthDefault.java", "diffHunk": "@@ -0,0 +1,100 @@\n+package com.puppycrawl.tools.checkstyle.checks.sizes.lambdabodylength;\n+\n+import java.util.List;\n+import java.util.function.*;\n+\n+/*\n+* Config = default\n+ */\n+public class InputLambdaBodyLengthDefault {\n+    {\n+        List<String> list = null;\n+        list.forEach(item -> { // violation\n+            System.out.println(1);\n+            System.out.println(2);\n+            System.out.println(3);\n+            System.out.println(4);\n+            System.out.println(5);\n+            System.out.println(6);\n+            System.out.println(7);\n+            System.out.println(8);\n+            System.out.println(9);\n+            System.out.println(10);\n+        });\n+        list.forEach(item -> System.out.println( // violation\n+            item.trim()\n+                .trim()\n+                .trim()\n+                .trim()\n+                .trim()\n+                .trim()\n+                .trim()\n+                .trim()\n+                .trim()\n+                .trim()\n+            )\n+        );\n+        list.forEach(item -> // violation\n+            System\n+\n+                .\n+\n+                    out\n+\n+                .\n+                    println\n+                        (\n+                            item\n+                        )\n+        );\n+        Supplier<Runnable> s = () -> // violation\n+            (\n+\n+            ) -> { // violation\n+\n+                // some lambda body code\n+\n+\n+\n+\n+\n+\n+\n+            };\n+        Supplier<String> s1 = () -> // violation, 11 lines\n+            \"1\"\n+                + \"2\"\n+                + \"3\"\n+                + \"4\"\n+                + \"5\"\n+                + \"6\"\n+                + \"7\"\n+                + \"8\"\n+                + \"9\"\n+                + \"0\"\n+                + \"1\"\n+            ;\n+        Supplier<String> s2 = () -> // ok, 10 lines\n+            \"1\"\n+                + \"2\"\n+                + \"3\"\n+                + \"4\"\n+                + \"5\"\n+                + \"6\"\n+                + \"7\"\n+                + \"8\"\n+                + \"9\"\n+                + \"0\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b5a97e2c3a74e15a67a6387c20e81ebce0da8298"}, "originalPosition": 87}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjM2MDU2Mw==", "bodyText": "please add line number in argument here too.\nPlease do this for all cases where applicable.", "url": "https://github.com/checkstyle/checkstyle/pull/8896#discussion_r506360563", "createdAt": "2020-10-16T12:24:43Z", "author": {"login": "romani"}, "path": "src/test/resources/com/puppycrawl/tools/checkstyle/checks/sizes/lambdabodylength/InputLambdaBodyLengthDefault.java", "diffHunk": "@@ -0,0 +1,100 @@\n+package com.puppycrawl.tools.checkstyle.checks.sizes.lambdabodylength;\n+\n+import java.util.List;\n+import java.util.function.*;\n+\n+/*\n+* Config = default\n+ */\n+public class InputLambdaBodyLengthDefault {\n+    {\n+        List<String> list = null;\n+        list.forEach(item -> { // violation\n+            System.out.println(1);\n+            System.out.println(2);\n+            System.out.println(3);\n+            System.out.println(4);\n+            System.out.println(5);\n+            System.out.println(6);\n+            System.out.println(7);\n+            System.out.println(8);\n+            System.out.println(9);\n+            System.out.println(10);\n+        });\n+        list.forEach(item -> System.out.println( // violation\n+            item.trim()\n+                .trim()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b5a97e2c3a74e15a67a6387c20e81ebce0da8298"}, "originalPosition": 26}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwNTAyNDM0", "url": "https://github.com/checkstyle/checkstyle/pull/8896#pullrequestreview-510502434", "createdAt": "2020-10-16T14:04:19Z", "commit": {"oid": "b5a97e2c3a74e15a67a6387c20e81ebce0da8298"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxNDowNDoxOVrOHi_5lQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNlQxNDowNToyOVrOHi__fw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjQ2MDU2NQ==", "bodyText": "Please change this loop to do { ... } while(). It is strange to see node != null after node.getLineNo().", "url": "https://github.com/checkstyle/checkstyle/pull/8896#discussion_r506460565", "createdAt": "2020-10-16T14:04:19Z", "author": {"login": "pbludov"}, "path": "src/main/java/com/puppycrawl/tools/checkstyle/checks/sizes/LambdaBodyLengthCheck.java", "diffHunk": "@@ -0,0 +1,234 @@\n+////////////////////////////////////////////////////////////////////////////////\n+// checkstyle: Checks Java source code for adherence to a set of rules.\n+// Copyright (C) 2001-2020 the original author or authors.\n+//\n+// This library is free software; you can redistribute it and/or\n+// modify it under the terms of the GNU Lesser General Public\n+// License as published by the Free Software Foundation; either\n+// version 2.1 of the License, or (at your option) any later version.\n+//\n+// This library is distributed in the hope that it will be useful,\n+// but WITHOUT ANY WARRANTY; without even the implied warranty of\n+// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n+// Lesser General Public License for more details.\n+//\n+// You should have received a copy of the GNU Lesser General Public\n+// License along with this library; if not, write to the Free Software\n+// Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA\n+////////////////////////////////////////////////////////////////////////////////\n+\n+package com.puppycrawl.tools.checkstyle.checks.sizes;\n+\n+import com.puppycrawl.tools.checkstyle.StatelessCheck;\n+import com.puppycrawl.tools.checkstyle.api.AbstractCheck;\n+import com.puppycrawl.tools.checkstyle.api.DetailAST;\n+import com.puppycrawl.tools.checkstyle.api.TokenTypes;\n+\n+/**\n+ * <p>\n+ * Checks lambda body length.\n+ * </p>\n+ * <p>\n+ * Rationale: Similar to anonymous inner classes, if lambda body becomes very long\n+ * it is hard to understand and to see the flow of the method\n+ * where the lambda is defined. Therefore long lambda body\n+ * should usually be extracted to method.\n+ * </p>\n+ * <ul>\n+ * <li>\n+ * Property {@code max} - Specify the maximum number of lines allowed.\n+ * Type is {@code int}.\n+ * Default value is {@code 10}.\n+ * </li>\n+ * </ul>\n+ * <p>\n+ * To configure the check to accept lambda bodies with up to 10 lines:\n+ * </p>\n+ * <pre>\n+ * &lt;module name=\"LambdaBodyLength\"/&gt;\n+ * </pre>\n+ * <p>\n+ * Example:\n+ * </p>\n+ * <pre>\n+ * class Test {\n+ *   Runnable r = () -&gt; { // violation, 11 lines\n+ *       System.out.println(2); // line 2 of lambda\n+ *       System.out.println(3);\n+ *       System.out.println(4);\n+ *       System.out.println(5);\n+ *       System.out.println(6);\n+ *       System.out.println(7);\n+ *       System.out.println(8);\n+ *       System.out.println(9);\n+ *       System.out.println(10);\n+ *   }; // line 11\n+ *\n+ *   Runnable r2 = () -&gt; // violation, 11 lines\n+ *       \"someString\".trim() // line 1 of lambda\n+ *                   .trim()\n+ *                   .trim()\n+ *                   .trim()\n+ *                   .trim()\n+ *                   .trim()\n+ *                   .trim()\n+ *                   .trim()\n+ *                   .trim()\n+ *                   .trim()\n+ *                   .trim(); // line 11\n+ *\n+ *   Runnable r3 = () -&gt; { // ok, 10 lines\n+ *       System.out.println(2); // line 2 of lambda\n+ *       System.out.println(3);\n+ *       System.out.println(4);\n+ *       System.out.println(5);\n+ *       System.out.println(6);\n+ *       System.out.println(7);\n+ *       System.out.println(8);\n+ *       System.out.println(9);\n+ *   }; // line 10\n+ * }\n+ * </pre>\n+ * <p>\n+ * To configure the check to accept lambda bodies with max 5 lines:\n+ * </p>\n+ * <pre>\n+ * &lt;module name=\"LambdaBodyLength\"&gt;\n+ *   &lt;property name=\"max\" value=\"5\"/&gt;\n+ * &lt;/module&gt;\n+ * </pre>\n+ * <p>\n+ * Example:\n+ * </p>\n+ * <pre>\n+ * class Test {\n+ *   Runnable r = () -&gt; { // violation, 6 lines\n+ *       System.out.println(2); // line 2 of lambda\n+ *       System.out.println(3);\n+ *       System.out.println(4);\n+ *       System.out.println(5);\n+ *   };\n+ *\n+ *   Runnable r2 = () -&gt; // violation, 6 lines\n+ *       \"someString\".trim()\n+ *                   .trim()\n+ *                   .trim()\n+ *                   .trim()\n+ *                   .trim()\n+ *                   .trim();\n+ *\n+ *   Runnable r3 = () -&gt; { // ok, 5 lines\n+ *       System.out.println(2);\n+ *       System.out.println(3);\n+ *       System.out.println(4);\n+ *   };\n+ * }\n+ * </pre>\n+ * <p>\n+ * Parent is {@code com.puppycrawl.tools.checkstyle.TreeWalker}\n+ * </p>\n+ * <p>\n+ * Violation Message Keys:\n+ * </p>\n+ * <ul>\n+ * <li>\n+ * {@code maxLen.lambdaBody}\n+ * </li>\n+ * </ul>\n+ *\n+ * @since 8.37\n+ */\n+@StatelessCheck\n+public class LambdaBodyLengthCheck extends AbstractCheck {\n+\n+    /**\n+     * A key is pointing to the warning message text in \"messages.properties\"\n+     * file.\n+     */\n+    public static final String MSG_KEY = \"maxLen.lambdaBody\";\n+\n+    /** Default maximum number of lines. */\n+    private static final int DEFAULT_MAX = 10;\n+\n+    /** Specify the maximum number of lines allowed. */\n+    private int max = DEFAULT_MAX;\n+\n+    /**\n+     * Setter to specify the maximum number of lines allowed.\n+     *\n+     * @param length the maximum length of lambda body.\n+     */\n+    public void setMax(int length) {\n+        max = length;\n+    }\n+\n+    @Override\n+    public int[] getDefaultTokens() {\n+        return getRequiredTokens();\n+    }\n+\n+    @Override\n+    public int[] getAcceptableTokens() {\n+        return getRequiredTokens();\n+    }\n+\n+    @Override\n+    public int[] getRequiredTokens() {\n+        return new int[] {TokenTypes.LAMBDA};\n+    }\n+\n+    @Override\n+    public void visitToken(DetailAST ast) {\n+        if (ast.getParent().getType() != TokenTypes.SWITCH_RULE) {\n+            final int length = getLength(ast);\n+            if (length > max) {\n+                log(ast, MSG_KEY, length, max);\n+            }\n+        }\n+    }\n+\n+    private static int getLength(DetailAST ast) {\n+        final DetailAST lambdaBody = ast.getLastChild();\n+        final int length;\n+        if (lambdaBody.getType() == TokenTypes.SLIST) {\n+            length = lambdaBody.getLastChild().getLineNo() - lambdaBody.getLineNo();\n+        }\n+        else {\n+            length = getLastNodeLineNumber(lambdaBody) - getFirstNodeLineNumber(lambdaBody);\n+        }\n+        return length + 1;\n+    }\n+\n+    /**\n+     * Get last node line number.\n+     *\n+     * @param lambdaBody lambda body node.\n+     * @return last node line number.\n+     */\n+    private static int getLastNodeLineNumber(DetailAST lambdaBody) {\n+        DetailAST node = lambdaBody.getLastChild();\n+        int result = node.getLineNo();\n+        while (node != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b5a97e2c3a74e15a67a6387c20e81ebce0da8298"}, "originalPosition": 211}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjQ2MjA3OQ==", "bodyText": "Same here", "url": "https://github.com/checkstyle/checkstyle/pull/8896#discussion_r506462079", "createdAt": "2020-10-16T14:05:29Z", "author": {"login": "pbludov"}, "path": "src/main/java/com/puppycrawl/tools/checkstyle/checks/sizes/LambdaBodyLengthCheck.java", "diffHunk": "@@ -0,0 +1,234 @@\n+////////////////////////////////////////////////////////////////////////////////\n+// checkstyle: Checks Java source code for adherence to a set of rules.\n+// Copyright (C) 2001-2020 the original author or authors.\n+//\n+// This library is free software; you can redistribute it and/or\n+// modify it under the terms of the GNU Lesser General Public\n+// License as published by the Free Software Foundation; either\n+// version 2.1 of the License, or (at your option) any later version.\n+//\n+// This library is distributed in the hope that it will be useful,\n+// but WITHOUT ANY WARRANTY; without even the implied warranty of\n+// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n+// Lesser General Public License for more details.\n+//\n+// You should have received a copy of the GNU Lesser General Public\n+// License along with this library; if not, write to the Free Software\n+// Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA\n+////////////////////////////////////////////////////////////////////////////////\n+\n+package com.puppycrawl.tools.checkstyle.checks.sizes;\n+\n+import com.puppycrawl.tools.checkstyle.StatelessCheck;\n+import com.puppycrawl.tools.checkstyle.api.AbstractCheck;\n+import com.puppycrawl.tools.checkstyle.api.DetailAST;\n+import com.puppycrawl.tools.checkstyle.api.TokenTypes;\n+\n+/**\n+ * <p>\n+ * Checks lambda body length.\n+ * </p>\n+ * <p>\n+ * Rationale: Similar to anonymous inner classes, if lambda body becomes very long\n+ * it is hard to understand and to see the flow of the method\n+ * where the lambda is defined. Therefore long lambda body\n+ * should usually be extracted to method.\n+ * </p>\n+ * <ul>\n+ * <li>\n+ * Property {@code max} - Specify the maximum number of lines allowed.\n+ * Type is {@code int}.\n+ * Default value is {@code 10}.\n+ * </li>\n+ * </ul>\n+ * <p>\n+ * To configure the check to accept lambda bodies with up to 10 lines:\n+ * </p>\n+ * <pre>\n+ * &lt;module name=\"LambdaBodyLength\"/&gt;\n+ * </pre>\n+ * <p>\n+ * Example:\n+ * </p>\n+ * <pre>\n+ * class Test {\n+ *   Runnable r = () -&gt; { // violation, 11 lines\n+ *       System.out.println(2); // line 2 of lambda\n+ *       System.out.println(3);\n+ *       System.out.println(4);\n+ *       System.out.println(5);\n+ *       System.out.println(6);\n+ *       System.out.println(7);\n+ *       System.out.println(8);\n+ *       System.out.println(9);\n+ *       System.out.println(10);\n+ *   }; // line 11\n+ *\n+ *   Runnable r2 = () -&gt; // violation, 11 lines\n+ *       \"someString\".trim() // line 1 of lambda\n+ *                   .trim()\n+ *                   .trim()\n+ *                   .trim()\n+ *                   .trim()\n+ *                   .trim()\n+ *                   .trim()\n+ *                   .trim()\n+ *                   .trim()\n+ *                   .trim()\n+ *                   .trim(); // line 11\n+ *\n+ *   Runnable r3 = () -&gt; { // ok, 10 lines\n+ *       System.out.println(2); // line 2 of lambda\n+ *       System.out.println(3);\n+ *       System.out.println(4);\n+ *       System.out.println(5);\n+ *       System.out.println(6);\n+ *       System.out.println(7);\n+ *       System.out.println(8);\n+ *       System.out.println(9);\n+ *   }; // line 10\n+ * }\n+ * </pre>\n+ * <p>\n+ * To configure the check to accept lambda bodies with max 5 lines:\n+ * </p>\n+ * <pre>\n+ * &lt;module name=\"LambdaBodyLength\"&gt;\n+ *   &lt;property name=\"max\" value=\"5\"/&gt;\n+ * &lt;/module&gt;\n+ * </pre>\n+ * <p>\n+ * Example:\n+ * </p>\n+ * <pre>\n+ * class Test {\n+ *   Runnable r = () -&gt; { // violation, 6 lines\n+ *       System.out.println(2); // line 2 of lambda\n+ *       System.out.println(3);\n+ *       System.out.println(4);\n+ *       System.out.println(5);\n+ *   };\n+ *\n+ *   Runnable r2 = () -&gt; // violation, 6 lines\n+ *       \"someString\".trim()\n+ *                   .trim()\n+ *                   .trim()\n+ *                   .trim()\n+ *                   .trim()\n+ *                   .trim();\n+ *\n+ *   Runnable r3 = () -&gt; { // ok, 5 lines\n+ *       System.out.println(2);\n+ *       System.out.println(3);\n+ *       System.out.println(4);\n+ *   };\n+ * }\n+ * </pre>\n+ * <p>\n+ * Parent is {@code com.puppycrawl.tools.checkstyle.TreeWalker}\n+ * </p>\n+ * <p>\n+ * Violation Message Keys:\n+ * </p>\n+ * <ul>\n+ * <li>\n+ * {@code maxLen.lambdaBody}\n+ * </li>\n+ * </ul>\n+ *\n+ * @since 8.37\n+ */\n+@StatelessCheck\n+public class LambdaBodyLengthCheck extends AbstractCheck {\n+\n+    /**\n+     * A key is pointing to the warning message text in \"messages.properties\"\n+     * file.\n+     */\n+    public static final String MSG_KEY = \"maxLen.lambdaBody\";\n+\n+    /** Default maximum number of lines. */\n+    private static final int DEFAULT_MAX = 10;\n+\n+    /** Specify the maximum number of lines allowed. */\n+    private int max = DEFAULT_MAX;\n+\n+    /**\n+     * Setter to specify the maximum number of lines allowed.\n+     *\n+     * @param length the maximum length of lambda body.\n+     */\n+    public void setMax(int length) {\n+        max = length;\n+    }\n+\n+    @Override\n+    public int[] getDefaultTokens() {\n+        return getRequiredTokens();\n+    }\n+\n+    @Override\n+    public int[] getAcceptableTokens() {\n+        return getRequiredTokens();\n+    }\n+\n+    @Override\n+    public int[] getRequiredTokens() {\n+        return new int[] {TokenTypes.LAMBDA};\n+    }\n+\n+    @Override\n+    public void visitToken(DetailAST ast) {\n+        if (ast.getParent().getType() != TokenTypes.SWITCH_RULE) {\n+            final int length = getLength(ast);\n+            if (length > max) {\n+                log(ast, MSG_KEY, length, max);\n+            }\n+        }\n+    }\n+\n+    private static int getLength(DetailAST ast) {\n+        final DetailAST lambdaBody = ast.getLastChild();\n+        final int length;\n+        if (lambdaBody.getType() == TokenTypes.SLIST) {\n+            length = lambdaBody.getLastChild().getLineNo() - lambdaBody.getLineNo();\n+        }\n+        else {\n+            length = getLastNodeLineNumber(lambdaBody) - getFirstNodeLineNumber(lambdaBody);\n+        }\n+        return length + 1;\n+    }\n+\n+    /**\n+     * Get last node line number.\n+     *\n+     * @param lambdaBody lambda body node.\n+     * @return last node line number.\n+     */\n+    private static int getLastNodeLineNumber(DetailAST lambdaBody) {\n+        DetailAST node = lambdaBody.getLastChild();\n+        int result = node.getLineNo();\n+        while (node != null) {\n+            result = node.getLineNo();\n+            node = node.getLastChild();\n+        }\n+        return result;\n+    }\n+\n+    /**\n+     * Get first node line number.\n+     *\n+     * @param lambdaBody lambda body node.\n+     * @return first node line number.\n+     */\n+    private static int getFirstNodeLineNumber(DetailAST lambdaBody) {\n+        DetailAST node = lambdaBody.getFirstChild();\n+        int result = node.getLineNo();\n+        while (node != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b5a97e2c3a74e15a67a6387c20e81ebce0da8298"}, "originalPosition": 227}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b5a97e2c3a74e15a67a6387c20e81ebce0da8298", "author": {"user": {"login": "strkkk", "name": "Andrei Paikin"}}, "url": "https://github.com/checkstyle/checkstyle/commit/b5a97e2c3a74e15a67a6387c20e81ebce0da8298", "committedDate": "2020-10-16T08:40:53Z", "message": "Issue #8341: Add LambdaBodyLengthCheck"}, "afterCommit": {"oid": "a7d8641103adf2abc63be45df91133019bbd3489", "author": {"user": {"login": "strkkk", "name": "Andrei Paikin"}}, "url": "https://github.com/checkstyle/checkstyle/commit/a7d8641103adf2abc63be45df91133019bbd3489", "committedDate": "2020-10-16T15:22:58Z", "message": "Issue #8341: Add LambdaBodyLengthCheck"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwNjAxNTQ0", "url": "https://github.com/checkstyle/checkstyle/pull/8896#pullrequestreview-510601544", "createdAt": "2020-10-16T15:58:07Z", "commit": {"oid": "a7d8641103adf2abc63be45df91133019bbd3489"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEzNjc0ODgz", "url": "https://github.com/checkstyle/checkstyle/pull/8896#pullrequestreview-513674883", "createdAt": "2020-10-21T13:24:50Z", "commit": {"oid": "a7d8641103adf2abc63be45df91133019bbd3489"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE0MzYzMjYy", "url": "https://github.com/checkstyle/checkstyle/pull/8896#pullrequestreview-514363262", "createdAt": "2020-10-22T05:10:08Z", "commit": {"oid": "a7d8641103adf2abc63be45df91133019bbd3489"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE3Mjc4MzEz", "url": "https://github.com/checkstyle/checkstyle/pull/8896#pullrequestreview-517278313", "createdAt": "2020-10-27T01:04:33Z", "commit": {"oid": "a7d8641103adf2abc63be45df91133019bbd3489"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QwMTowNDozM1rOHonurg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QwMTowNTo0M1rOHonvzQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjM1NjAxNA==", "bodyText": "How sure are we can always use last node? Some nodes like + re-arrange the tokens so the last may not always have the max line number.", "url": "https://github.com/checkstyle/checkstyle/pull/8896#discussion_r512356014", "createdAt": "2020-10-27T01:04:33Z", "author": {"login": "rnveach"}, "path": "src/main/java/com/puppycrawl/tools/checkstyle/checks/sizes/LambdaBodyLengthCheck.java", "diffHunk": "@@ -0,0 +1,234 @@\n+////////////////////////////////////////////////////////////////////////////////\n+// checkstyle: Checks Java source code for adherence to a set of rules.\n+// Copyright (C) 2001-2020 the original author or authors.\n+//\n+// This library is free software; you can redistribute it and/or\n+// modify it under the terms of the GNU Lesser General Public\n+// License as published by the Free Software Foundation; either\n+// version 2.1 of the License, or (at your option) any later version.\n+//\n+// This library is distributed in the hope that it will be useful,\n+// but WITHOUT ANY WARRANTY; without even the implied warranty of\n+// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n+// Lesser General Public License for more details.\n+//\n+// You should have received a copy of the GNU Lesser General Public\n+// License along with this library; if not, write to the Free Software\n+// Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA\n+////////////////////////////////////////////////////////////////////////////////\n+\n+package com.puppycrawl.tools.checkstyle.checks.sizes;\n+\n+import com.puppycrawl.tools.checkstyle.StatelessCheck;\n+import com.puppycrawl.tools.checkstyle.api.AbstractCheck;\n+import com.puppycrawl.tools.checkstyle.api.DetailAST;\n+import com.puppycrawl.tools.checkstyle.api.TokenTypes;\n+\n+/**\n+ * <p>\n+ * Checks lambda body length.\n+ * </p>\n+ * <p>\n+ * Rationale: Similar to anonymous inner classes, if lambda body becomes very long\n+ * it is hard to understand and to see the flow of the method\n+ * where the lambda is defined. Therefore long lambda body\n+ * should usually be extracted to method.\n+ * </p>\n+ * <ul>\n+ * <li>\n+ * Property {@code max} - Specify the maximum number of lines allowed.\n+ * Type is {@code int}.\n+ * Default value is {@code 10}.\n+ * </li>\n+ * </ul>\n+ * <p>\n+ * To configure the check to accept lambda bodies with up to 10 lines:\n+ * </p>\n+ * <pre>\n+ * &lt;module name=\"LambdaBodyLength\"/&gt;\n+ * </pre>\n+ * <p>\n+ * Example:\n+ * </p>\n+ * <pre>\n+ * class Test {\n+ *   Runnable r = () -&gt; { // violation, 11 lines\n+ *       System.out.println(2); // line 2 of lambda\n+ *       System.out.println(3);\n+ *       System.out.println(4);\n+ *       System.out.println(5);\n+ *       System.out.println(6);\n+ *       System.out.println(7);\n+ *       System.out.println(8);\n+ *       System.out.println(9);\n+ *       System.out.println(10);\n+ *   }; // line 11\n+ *\n+ *   Runnable r2 = () -&gt; // violation, 11 lines\n+ *       \"someString\".concat(\"1\") // line 1 of lambda\n+ *                   .concat(\"2\")\n+ *                   .concat(\"3\")\n+ *                   .concat(\"4\")\n+ *                   .concat(\"5\")\n+ *                   .concat(\"6\")\n+ *                   .concat(\"7\")\n+ *                   .concat(\"8\")\n+ *                   .concat(\"9\")\n+ *                   .concat(\"10\")\n+ *                   .concat(\"11\"); // line 11\n+ *\n+ *   Runnable r3 = () -&gt; { // ok, 10 lines\n+ *       System.out.println(2); // line 2 of lambda\n+ *       System.out.println(3);\n+ *       System.out.println(4);\n+ *       System.out.println(5);\n+ *       System.out.println(6);\n+ *       System.out.println(7);\n+ *       System.out.println(8);\n+ *       System.out.println(9);\n+ *   }; // line 10\n+ * }\n+ * </pre>\n+ * <p>\n+ * To configure the check to accept lambda bodies with max 5 lines:\n+ * </p>\n+ * <pre>\n+ * &lt;module name=\"LambdaBodyLength\"&gt;\n+ *   &lt;property name=\"max\" value=\"5\"/&gt;\n+ * &lt;/module&gt;\n+ * </pre>\n+ * <p>\n+ * Example:\n+ * </p>\n+ * <pre>\n+ * class Test {\n+ *   Runnable r = () -&gt; { // violation, 6 lines\n+ *       System.out.println(2); // line 2 of lambda\n+ *       System.out.println(3);\n+ *       System.out.println(4);\n+ *       System.out.println(5);\n+ *   };\n+ *\n+ *   Runnable r2 = () -&gt; // violation, 6 lines\n+ *       \"someString\".concat(\"1\")\n+ *                   .concat(\"2\")\n+ *                   .concat(\"3\")\n+ *                   .concat(\"4\")\n+ *                   .concat(\"5\")\n+ *                   .concat(\"6\");\n+ *\n+ *   Runnable r3 = () -&gt; { // ok, 5 lines\n+ *       System.out.println(2);\n+ *       System.out.println(3);\n+ *       System.out.println(4);\n+ *   };\n+ * }\n+ * </pre>\n+ * <p>\n+ * Parent is {@code com.puppycrawl.tools.checkstyle.TreeWalker}\n+ * </p>\n+ * <p>\n+ * Violation Message Keys:\n+ * </p>\n+ * <ul>\n+ * <li>\n+ * {@code maxLen.lambdaBody}\n+ * </li>\n+ * </ul>\n+ *\n+ * @since 8.37\n+ */\n+@StatelessCheck\n+public class LambdaBodyLengthCheck extends AbstractCheck {\n+\n+    /**\n+     * A key is pointing to the warning message text in \"messages.properties\"\n+     * file.\n+     */\n+    public static final String MSG_KEY = \"maxLen.lambdaBody\";\n+\n+    /** Default maximum number of lines. */\n+    private static final int DEFAULT_MAX = 10;\n+\n+    /** Specify the maximum number of lines allowed. */\n+    private int max = DEFAULT_MAX;\n+\n+    /**\n+     * Setter to specify the maximum number of lines allowed.\n+     *\n+     * @param length the maximum length of lambda body.\n+     */\n+    public void setMax(int length) {\n+        max = length;\n+    }\n+\n+    @Override\n+    public int[] getDefaultTokens() {\n+        return getRequiredTokens();\n+    }\n+\n+    @Override\n+    public int[] getAcceptableTokens() {\n+        return getRequiredTokens();\n+    }\n+\n+    @Override\n+    public int[] getRequiredTokens() {\n+        return new int[] {TokenTypes.LAMBDA};\n+    }\n+\n+    @Override\n+    public void visitToken(DetailAST ast) {\n+        if (ast.getParent().getType() != TokenTypes.SWITCH_RULE) {\n+            final int length = getLength(ast);\n+            if (length > max) {\n+                log(ast, MSG_KEY, length, max);\n+            }\n+        }\n+    }\n+\n+    private static int getLength(DetailAST ast) {\n+        final DetailAST lambdaBody = ast.getLastChild();\n+        final int length;\n+        if (lambdaBody.getType() == TokenTypes.SLIST) {\n+            length = lambdaBody.getLastChild().getLineNo() - lambdaBody.getLineNo();\n+        }\n+        else {\n+            length = getLastNodeLineNumber(lambdaBody) - getFirstNodeLineNumber(lambdaBody);\n+        }\n+        return length + 1;\n+    }\n+\n+    /**\n+     * Get last node line number.\n+     *\n+     * @param lambdaBody lambda body node.\n+     * @return last node line number.\n+     */\n+    private static int getLastNodeLineNumber(DetailAST lambdaBody) {\n+        DetailAST node = lambdaBody;\n+        int result;\n+        do {\n+            result = node.getLineNo();\n+            node = node.getLastChild();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a7d8641103adf2abc63be45df91133019bbd3489"}, "originalPosition": 213}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjM1NjIwNQ==", "bodyText": "please expand description to say we last child node in the tree.", "url": "https://github.com/checkstyle/checkstyle/pull/8896#discussion_r512356205", "createdAt": "2020-10-27T01:05:15Z", "author": {"login": "rnveach"}, "path": "src/main/java/com/puppycrawl/tools/checkstyle/checks/sizes/LambdaBodyLengthCheck.java", "diffHunk": "@@ -0,0 +1,234 @@\n+////////////////////////////////////////////////////////////////////////////////\n+// checkstyle: Checks Java source code for adherence to a set of rules.\n+// Copyright (C) 2001-2020 the original author or authors.\n+//\n+// This library is free software; you can redistribute it and/or\n+// modify it under the terms of the GNU Lesser General Public\n+// License as published by the Free Software Foundation; either\n+// version 2.1 of the License, or (at your option) any later version.\n+//\n+// This library is distributed in the hope that it will be useful,\n+// but WITHOUT ANY WARRANTY; without even the implied warranty of\n+// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n+// Lesser General Public License for more details.\n+//\n+// You should have received a copy of the GNU Lesser General Public\n+// License along with this library; if not, write to the Free Software\n+// Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA\n+////////////////////////////////////////////////////////////////////////////////\n+\n+package com.puppycrawl.tools.checkstyle.checks.sizes;\n+\n+import com.puppycrawl.tools.checkstyle.StatelessCheck;\n+import com.puppycrawl.tools.checkstyle.api.AbstractCheck;\n+import com.puppycrawl.tools.checkstyle.api.DetailAST;\n+import com.puppycrawl.tools.checkstyle.api.TokenTypes;\n+\n+/**\n+ * <p>\n+ * Checks lambda body length.\n+ * </p>\n+ * <p>\n+ * Rationale: Similar to anonymous inner classes, if lambda body becomes very long\n+ * it is hard to understand and to see the flow of the method\n+ * where the lambda is defined. Therefore long lambda body\n+ * should usually be extracted to method.\n+ * </p>\n+ * <ul>\n+ * <li>\n+ * Property {@code max} - Specify the maximum number of lines allowed.\n+ * Type is {@code int}.\n+ * Default value is {@code 10}.\n+ * </li>\n+ * </ul>\n+ * <p>\n+ * To configure the check to accept lambda bodies with up to 10 lines:\n+ * </p>\n+ * <pre>\n+ * &lt;module name=\"LambdaBodyLength\"/&gt;\n+ * </pre>\n+ * <p>\n+ * Example:\n+ * </p>\n+ * <pre>\n+ * class Test {\n+ *   Runnable r = () -&gt; { // violation, 11 lines\n+ *       System.out.println(2); // line 2 of lambda\n+ *       System.out.println(3);\n+ *       System.out.println(4);\n+ *       System.out.println(5);\n+ *       System.out.println(6);\n+ *       System.out.println(7);\n+ *       System.out.println(8);\n+ *       System.out.println(9);\n+ *       System.out.println(10);\n+ *   }; // line 11\n+ *\n+ *   Runnable r2 = () -&gt; // violation, 11 lines\n+ *       \"someString\".concat(\"1\") // line 1 of lambda\n+ *                   .concat(\"2\")\n+ *                   .concat(\"3\")\n+ *                   .concat(\"4\")\n+ *                   .concat(\"5\")\n+ *                   .concat(\"6\")\n+ *                   .concat(\"7\")\n+ *                   .concat(\"8\")\n+ *                   .concat(\"9\")\n+ *                   .concat(\"10\")\n+ *                   .concat(\"11\"); // line 11\n+ *\n+ *   Runnable r3 = () -&gt; { // ok, 10 lines\n+ *       System.out.println(2); // line 2 of lambda\n+ *       System.out.println(3);\n+ *       System.out.println(4);\n+ *       System.out.println(5);\n+ *       System.out.println(6);\n+ *       System.out.println(7);\n+ *       System.out.println(8);\n+ *       System.out.println(9);\n+ *   }; // line 10\n+ * }\n+ * </pre>\n+ * <p>\n+ * To configure the check to accept lambda bodies with max 5 lines:\n+ * </p>\n+ * <pre>\n+ * &lt;module name=\"LambdaBodyLength\"&gt;\n+ *   &lt;property name=\"max\" value=\"5\"/&gt;\n+ * &lt;/module&gt;\n+ * </pre>\n+ * <p>\n+ * Example:\n+ * </p>\n+ * <pre>\n+ * class Test {\n+ *   Runnable r = () -&gt; { // violation, 6 lines\n+ *       System.out.println(2); // line 2 of lambda\n+ *       System.out.println(3);\n+ *       System.out.println(4);\n+ *       System.out.println(5);\n+ *   };\n+ *\n+ *   Runnable r2 = () -&gt; // violation, 6 lines\n+ *       \"someString\".concat(\"1\")\n+ *                   .concat(\"2\")\n+ *                   .concat(\"3\")\n+ *                   .concat(\"4\")\n+ *                   .concat(\"5\")\n+ *                   .concat(\"6\");\n+ *\n+ *   Runnable r3 = () -&gt; { // ok, 5 lines\n+ *       System.out.println(2);\n+ *       System.out.println(3);\n+ *       System.out.println(4);\n+ *   };\n+ * }\n+ * </pre>\n+ * <p>\n+ * Parent is {@code com.puppycrawl.tools.checkstyle.TreeWalker}\n+ * </p>\n+ * <p>\n+ * Violation Message Keys:\n+ * </p>\n+ * <ul>\n+ * <li>\n+ * {@code maxLen.lambdaBody}\n+ * </li>\n+ * </ul>\n+ *\n+ * @since 8.37\n+ */\n+@StatelessCheck\n+public class LambdaBodyLengthCheck extends AbstractCheck {\n+\n+    /**\n+     * A key is pointing to the warning message text in \"messages.properties\"\n+     * file.\n+     */\n+    public static final String MSG_KEY = \"maxLen.lambdaBody\";\n+\n+    /** Default maximum number of lines. */\n+    private static final int DEFAULT_MAX = 10;\n+\n+    /** Specify the maximum number of lines allowed. */\n+    private int max = DEFAULT_MAX;\n+\n+    /**\n+     * Setter to specify the maximum number of lines allowed.\n+     *\n+     * @param length the maximum length of lambda body.\n+     */\n+    public void setMax(int length) {\n+        max = length;\n+    }\n+\n+    @Override\n+    public int[] getDefaultTokens() {\n+        return getRequiredTokens();\n+    }\n+\n+    @Override\n+    public int[] getAcceptableTokens() {\n+        return getRequiredTokens();\n+    }\n+\n+    @Override\n+    public int[] getRequiredTokens() {\n+        return new int[] {TokenTypes.LAMBDA};\n+    }\n+\n+    @Override\n+    public void visitToken(DetailAST ast) {\n+        if (ast.getParent().getType() != TokenTypes.SWITCH_RULE) {\n+            final int length = getLength(ast);\n+            if (length > max) {\n+                log(ast, MSG_KEY, length, max);\n+            }\n+        }\n+    }\n+\n+    private static int getLength(DetailAST ast) {\n+        final DetailAST lambdaBody = ast.getLastChild();\n+        final int length;\n+        if (lambdaBody.getType() == TokenTypes.SLIST) {\n+            length = lambdaBody.getLastChild().getLineNo() - lambdaBody.getLineNo();\n+        }\n+        else {\n+            length = getLastNodeLineNumber(lambdaBody) - getFirstNodeLineNumber(lambdaBody);\n+        }\n+        return length + 1;\n+    }\n+\n+    /**\n+     * Get last node line number.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a7d8641103adf2abc63be45df91133019bbd3489"}, "originalPosition": 203}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjM1NjI3NQ==", "bodyText": "Similar.", "url": "https://github.com/checkstyle/checkstyle/pull/8896#discussion_r512356275", "createdAt": "2020-10-27T01:05:32Z", "author": {"login": "rnveach"}, "path": "src/main/java/com/puppycrawl/tools/checkstyle/checks/sizes/LambdaBodyLengthCheck.java", "diffHunk": "@@ -0,0 +1,234 @@\n+////////////////////////////////////////////////////////////////////////////////\n+// checkstyle: Checks Java source code for adherence to a set of rules.\n+// Copyright (C) 2001-2020 the original author or authors.\n+//\n+// This library is free software; you can redistribute it and/or\n+// modify it under the terms of the GNU Lesser General Public\n+// License as published by the Free Software Foundation; either\n+// version 2.1 of the License, or (at your option) any later version.\n+//\n+// This library is distributed in the hope that it will be useful,\n+// but WITHOUT ANY WARRANTY; without even the implied warranty of\n+// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n+// Lesser General Public License for more details.\n+//\n+// You should have received a copy of the GNU Lesser General Public\n+// License along with this library; if not, write to the Free Software\n+// Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA\n+////////////////////////////////////////////////////////////////////////////////\n+\n+package com.puppycrawl.tools.checkstyle.checks.sizes;\n+\n+import com.puppycrawl.tools.checkstyle.StatelessCheck;\n+import com.puppycrawl.tools.checkstyle.api.AbstractCheck;\n+import com.puppycrawl.tools.checkstyle.api.DetailAST;\n+import com.puppycrawl.tools.checkstyle.api.TokenTypes;\n+\n+/**\n+ * <p>\n+ * Checks lambda body length.\n+ * </p>\n+ * <p>\n+ * Rationale: Similar to anonymous inner classes, if lambda body becomes very long\n+ * it is hard to understand and to see the flow of the method\n+ * where the lambda is defined. Therefore long lambda body\n+ * should usually be extracted to method.\n+ * </p>\n+ * <ul>\n+ * <li>\n+ * Property {@code max} - Specify the maximum number of lines allowed.\n+ * Type is {@code int}.\n+ * Default value is {@code 10}.\n+ * </li>\n+ * </ul>\n+ * <p>\n+ * To configure the check to accept lambda bodies with up to 10 lines:\n+ * </p>\n+ * <pre>\n+ * &lt;module name=\"LambdaBodyLength\"/&gt;\n+ * </pre>\n+ * <p>\n+ * Example:\n+ * </p>\n+ * <pre>\n+ * class Test {\n+ *   Runnable r = () -&gt; { // violation, 11 lines\n+ *       System.out.println(2); // line 2 of lambda\n+ *       System.out.println(3);\n+ *       System.out.println(4);\n+ *       System.out.println(5);\n+ *       System.out.println(6);\n+ *       System.out.println(7);\n+ *       System.out.println(8);\n+ *       System.out.println(9);\n+ *       System.out.println(10);\n+ *   }; // line 11\n+ *\n+ *   Runnable r2 = () -&gt; // violation, 11 lines\n+ *       \"someString\".concat(\"1\") // line 1 of lambda\n+ *                   .concat(\"2\")\n+ *                   .concat(\"3\")\n+ *                   .concat(\"4\")\n+ *                   .concat(\"5\")\n+ *                   .concat(\"6\")\n+ *                   .concat(\"7\")\n+ *                   .concat(\"8\")\n+ *                   .concat(\"9\")\n+ *                   .concat(\"10\")\n+ *                   .concat(\"11\"); // line 11\n+ *\n+ *   Runnable r3 = () -&gt; { // ok, 10 lines\n+ *       System.out.println(2); // line 2 of lambda\n+ *       System.out.println(3);\n+ *       System.out.println(4);\n+ *       System.out.println(5);\n+ *       System.out.println(6);\n+ *       System.out.println(7);\n+ *       System.out.println(8);\n+ *       System.out.println(9);\n+ *   }; // line 10\n+ * }\n+ * </pre>\n+ * <p>\n+ * To configure the check to accept lambda bodies with max 5 lines:\n+ * </p>\n+ * <pre>\n+ * &lt;module name=\"LambdaBodyLength\"&gt;\n+ *   &lt;property name=\"max\" value=\"5\"/&gt;\n+ * &lt;/module&gt;\n+ * </pre>\n+ * <p>\n+ * Example:\n+ * </p>\n+ * <pre>\n+ * class Test {\n+ *   Runnable r = () -&gt; { // violation, 6 lines\n+ *       System.out.println(2); // line 2 of lambda\n+ *       System.out.println(3);\n+ *       System.out.println(4);\n+ *       System.out.println(5);\n+ *   };\n+ *\n+ *   Runnable r2 = () -&gt; // violation, 6 lines\n+ *       \"someString\".concat(\"1\")\n+ *                   .concat(\"2\")\n+ *                   .concat(\"3\")\n+ *                   .concat(\"4\")\n+ *                   .concat(\"5\")\n+ *                   .concat(\"6\");\n+ *\n+ *   Runnable r3 = () -&gt; { // ok, 5 lines\n+ *       System.out.println(2);\n+ *       System.out.println(3);\n+ *       System.out.println(4);\n+ *   };\n+ * }\n+ * </pre>\n+ * <p>\n+ * Parent is {@code com.puppycrawl.tools.checkstyle.TreeWalker}\n+ * </p>\n+ * <p>\n+ * Violation Message Keys:\n+ * </p>\n+ * <ul>\n+ * <li>\n+ * {@code maxLen.lambdaBody}\n+ * </li>\n+ * </ul>\n+ *\n+ * @since 8.37\n+ */\n+@StatelessCheck\n+public class LambdaBodyLengthCheck extends AbstractCheck {\n+\n+    /**\n+     * A key is pointing to the warning message text in \"messages.properties\"\n+     * file.\n+     */\n+    public static final String MSG_KEY = \"maxLen.lambdaBody\";\n+\n+    /** Default maximum number of lines. */\n+    private static final int DEFAULT_MAX = 10;\n+\n+    /** Specify the maximum number of lines allowed. */\n+    private int max = DEFAULT_MAX;\n+\n+    /**\n+     * Setter to specify the maximum number of lines allowed.\n+     *\n+     * @param length the maximum length of lambda body.\n+     */\n+    public void setMax(int length) {\n+        max = length;\n+    }\n+\n+    @Override\n+    public int[] getDefaultTokens() {\n+        return getRequiredTokens();\n+    }\n+\n+    @Override\n+    public int[] getAcceptableTokens() {\n+        return getRequiredTokens();\n+    }\n+\n+    @Override\n+    public int[] getRequiredTokens() {\n+        return new int[] {TokenTypes.LAMBDA};\n+    }\n+\n+    @Override\n+    public void visitToken(DetailAST ast) {\n+        if (ast.getParent().getType() != TokenTypes.SWITCH_RULE) {\n+            final int length = getLength(ast);\n+            if (length > max) {\n+                log(ast, MSG_KEY, length, max);\n+            }\n+        }\n+    }\n+\n+    private static int getLength(DetailAST ast) {\n+        final DetailAST lambdaBody = ast.getLastChild();\n+        final int length;\n+        if (lambdaBody.getType() == TokenTypes.SLIST) {\n+            length = lambdaBody.getLastChild().getLineNo() - lambdaBody.getLineNo();\n+        }\n+        else {\n+            length = getLastNodeLineNumber(lambdaBody) - getFirstNodeLineNumber(lambdaBody);\n+        }\n+        return length + 1;\n+    }\n+\n+    /**\n+     * Get last node line number.\n+     *\n+     * @param lambdaBody lambda body node.\n+     * @return last node line number.\n+     */\n+    private static int getLastNodeLineNumber(DetailAST lambdaBody) {\n+        DetailAST node = lambdaBody;\n+        int result;\n+        do {\n+            result = node.getLineNo();\n+            node = node.getLastChild();\n+        } while (node != null);\n+        return result;\n+    }\n+\n+    /**\n+     * Get first node line number.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a7d8641103adf2abc63be45df91133019bbd3489"}, "originalPosition": 219}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjM1NjMwMQ==", "bodyText": "Similar.", "url": "https://github.com/checkstyle/checkstyle/pull/8896#discussion_r512356301", "createdAt": "2020-10-27T01:05:43Z", "author": {"login": "rnveach"}, "path": "src/main/java/com/puppycrawl/tools/checkstyle/checks/sizes/LambdaBodyLengthCheck.java", "diffHunk": "@@ -0,0 +1,234 @@\n+////////////////////////////////////////////////////////////////////////////////\n+// checkstyle: Checks Java source code for adherence to a set of rules.\n+// Copyright (C) 2001-2020 the original author or authors.\n+//\n+// This library is free software; you can redistribute it and/or\n+// modify it under the terms of the GNU Lesser General Public\n+// License as published by the Free Software Foundation; either\n+// version 2.1 of the License, or (at your option) any later version.\n+//\n+// This library is distributed in the hope that it will be useful,\n+// but WITHOUT ANY WARRANTY; without even the implied warranty of\n+// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n+// Lesser General Public License for more details.\n+//\n+// You should have received a copy of the GNU Lesser General Public\n+// License along with this library; if not, write to the Free Software\n+// Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA\n+////////////////////////////////////////////////////////////////////////////////\n+\n+package com.puppycrawl.tools.checkstyle.checks.sizes;\n+\n+import com.puppycrawl.tools.checkstyle.StatelessCheck;\n+import com.puppycrawl.tools.checkstyle.api.AbstractCheck;\n+import com.puppycrawl.tools.checkstyle.api.DetailAST;\n+import com.puppycrawl.tools.checkstyle.api.TokenTypes;\n+\n+/**\n+ * <p>\n+ * Checks lambda body length.\n+ * </p>\n+ * <p>\n+ * Rationale: Similar to anonymous inner classes, if lambda body becomes very long\n+ * it is hard to understand and to see the flow of the method\n+ * where the lambda is defined. Therefore long lambda body\n+ * should usually be extracted to method.\n+ * </p>\n+ * <ul>\n+ * <li>\n+ * Property {@code max} - Specify the maximum number of lines allowed.\n+ * Type is {@code int}.\n+ * Default value is {@code 10}.\n+ * </li>\n+ * </ul>\n+ * <p>\n+ * To configure the check to accept lambda bodies with up to 10 lines:\n+ * </p>\n+ * <pre>\n+ * &lt;module name=\"LambdaBodyLength\"/&gt;\n+ * </pre>\n+ * <p>\n+ * Example:\n+ * </p>\n+ * <pre>\n+ * class Test {\n+ *   Runnable r = () -&gt; { // violation, 11 lines\n+ *       System.out.println(2); // line 2 of lambda\n+ *       System.out.println(3);\n+ *       System.out.println(4);\n+ *       System.out.println(5);\n+ *       System.out.println(6);\n+ *       System.out.println(7);\n+ *       System.out.println(8);\n+ *       System.out.println(9);\n+ *       System.out.println(10);\n+ *   }; // line 11\n+ *\n+ *   Runnable r2 = () -&gt; // violation, 11 lines\n+ *       \"someString\".concat(\"1\") // line 1 of lambda\n+ *                   .concat(\"2\")\n+ *                   .concat(\"3\")\n+ *                   .concat(\"4\")\n+ *                   .concat(\"5\")\n+ *                   .concat(\"6\")\n+ *                   .concat(\"7\")\n+ *                   .concat(\"8\")\n+ *                   .concat(\"9\")\n+ *                   .concat(\"10\")\n+ *                   .concat(\"11\"); // line 11\n+ *\n+ *   Runnable r3 = () -&gt; { // ok, 10 lines\n+ *       System.out.println(2); // line 2 of lambda\n+ *       System.out.println(3);\n+ *       System.out.println(4);\n+ *       System.out.println(5);\n+ *       System.out.println(6);\n+ *       System.out.println(7);\n+ *       System.out.println(8);\n+ *       System.out.println(9);\n+ *   }; // line 10\n+ * }\n+ * </pre>\n+ * <p>\n+ * To configure the check to accept lambda bodies with max 5 lines:\n+ * </p>\n+ * <pre>\n+ * &lt;module name=\"LambdaBodyLength\"&gt;\n+ *   &lt;property name=\"max\" value=\"5\"/&gt;\n+ * &lt;/module&gt;\n+ * </pre>\n+ * <p>\n+ * Example:\n+ * </p>\n+ * <pre>\n+ * class Test {\n+ *   Runnable r = () -&gt; { // violation, 6 lines\n+ *       System.out.println(2); // line 2 of lambda\n+ *       System.out.println(3);\n+ *       System.out.println(4);\n+ *       System.out.println(5);\n+ *   };\n+ *\n+ *   Runnable r2 = () -&gt; // violation, 6 lines\n+ *       \"someString\".concat(\"1\")\n+ *                   .concat(\"2\")\n+ *                   .concat(\"3\")\n+ *                   .concat(\"4\")\n+ *                   .concat(\"5\")\n+ *                   .concat(\"6\");\n+ *\n+ *   Runnable r3 = () -&gt; { // ok, 5 lines\n+ *       System.out.println(2);\n+ *       System.out.println(3);\n+ *       System.out.println(4);\n+ *   };\n+ * }\n+ * </pre>\n+ * <p>\n+ * Parent is {@code com.puppycrawl.tools.checkstyle.TreeWalker}\n+ * </p>\n+ * <p>\n+ * Violation Message Keys:\n+ * </p>\n+ * <ul>\n+ * <li>\n+ * {@code maxLen.lambdaBody}\n+ * </li>\n+ * </ul>\n+ *\n+ * @since 8.37\n+ */\n+@StatelessCheck\n+public class LambdaBodyLengthCheck extends AbstractCheck {\n+\n+    /**\n+     * A key is pointing to the warning message text in \"messages.properties\"\n+     * file.\n+     */\n+    public static final String MSG_KEY = \"maxLen.lambdaBody\";\n+\n+    /** Default maximum number of lines. */\n+    private static final int DEFAULT_MAX = 10;\n+\n+    /** Specify the maximum number of lines allowed. */\n+    private int max = DEFAULT_MAX;\n+\n+    /**\n+     * Setter to specify the maximum number of lines allowed.\n+     *\n+     * @param length the maximum length of lambda body.\n+     */\n+    public void setMax(int length) {\n+        max = length;\n+    }\n+\n+    @Override\n+    public int[] getDefaultTokens() {\n+        return getRequiredTokens();\n+    }\n+\n+    @Override\n+    public int[] getAcceptableTokens() {\n+        return getRequiredTokens();\n+    }\n+\n+    @Override\n+    public int[] getRequiredTokens() {\n+        return new int[] {TokenTypes.LAMBDA};\n+    }\n+\n+    @Override\n+    public void visitToken(DetailAST ast) {\n+        if (ast.getParent().getType() != TokenTypes.SWITCH_RULE) {\n+            final int length = getLength(ast);\n+            if (length > max) {\n+                log(ast, MSG_KEY, length, max);\n+            }\n+        }\n+    }\n+\n+    private static int getLength(DetailAST ast) {\n+        final DetailAST lambdaBody = ast.getLastChild();\n+        final int length;\n+        if (lambdaBody.getType() == TokenTypes.SLIST) {\n+            length = lambdaBody.getLastChild().getLineNo() - lambdaBody.getLineNo();\n+        }\n+        else {\n+            length = getLastNodeLineNumber(lambdaBody) - getFirstNodeLineNumber(lambdaBody);\n+        }\n+        return length + 1;\n+    }\n+\n+    /**\n+     * Get last node line number.\n+     *\n+     * @param lambdaBody lambda body node.\n+     * @return last node line number.\n+     */\n+    private static int getLastNodeLineNumber(DetailAST lambdaBody) {\n+        DetailAST node = lambdaBody;\n+        int result;\n+        do {\n+            result = node.getLineNo();\n+            node = node.getLastChild();\n+        } while (node != null);\n+        return result;\n+    }\n+\n+    /**\n+     * Get first node line number.\n+     *\n+     * @param lambdaBody lambda body node.\n+     * @return first node line number.\n+     */\n+    private static int getFirstNodeLineNumber(DetailAST lambdaBody) {\n+        DetailAST node = lambdaBody;\n+        int result;\n+        do {\n+            result = node.getLineNo();\n+            node = node.getFirstChild();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a7d8641103adf2abc63be45df91133019bbd3489"}, "originalPosition": 229}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b55958f140df7f98e9530c089b6321b04d76ddc", "author": {"user": {"login": "strkkk", "name": "Andrei Paikin"}}, "url": "https://github.com/checkstyle/checkstyle/commit/4b55958f140df7f98e9530c089b6321b04d76ddc", "committedDate": "2020-10-27T14:05:44Z", "message": "Issue #8341: Add LambdaBodyLengthCheck"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a7d8641103adf2abc63be45df91133019bbd3489", "author": {"user": {"login": "strkkk", "name": "Andrei Paikin"}}, "url": "https://github.com/checkstyle/checkstyle/commit/a7d8641103adf2abc63be45df91133019bbd3489", "committedDate": "2020-10-16T15:22:58Z", "message": "Issue #8341: Add LambdaBodyLengthCheck"}, "afterCommit": {"oid": "4b55958f140df7f98e9530c089b6321b04d76ddc", "author": {"user": {"login": "strkkk", "name": "Andrei Paikin"}}, "url": "https://github.com/checkstyle/checkstyle/commit/4b55958f140df7f98e9530c089b6321b04d76ddc", "committedDate": "2020-10-27T14:05:44Z", "message": "Issue #8341: Add LambdaBodyLengthCheck"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE5MTUwNDAz", "url": "https://github.com/checkstyle/checkstyle/pull/8896#pullrequestreview-519150403", "createdAt": "2020-10-28T23:11:14Z", "commit": {"oid": "4b55958f140df7f98e9530c089b6321b04d76ddc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1351, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}