{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg3ODk3MjYx", "number": 7845, "title": "Issue #5089: LineLength measures Java characters, not Unicode characters", "bodyText": "This PR fixes Issue #5089, namely, LineLength() will now count codepoints (unicode characters) instead of 2 byte characters, thus correcting existing issue where unicode characters are counted as two, 2 byte characters.  I have added some test cases, and the diff report can be found here.", "createdAt": "2020-03-13T17:33:28Z", "url": "https://github.com/checkstyle/checkstyle/pull/7845", "merged": true, "mergeCommit": {"oid": "739cf8e48e912fbd8ef633171a5a95e9d36e8a36"}, "closed": true, "closedAt": "2020-03-15T19:16:29Z", "author": {"login": "nmancus1"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcNX63ugBqjMxMjg0MTc5OTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcN8p4kgFqTM3NDgxNjUzNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "dc1136ad2b59c7cba1f8cb28d0d07470f1fbe71f", "author": {"user": {"login": "nmancus1", "name": "Nick Mancuso"}}, "url": "https://github.com/checkstyle/checkstyle/commit/dc1136ad2b59c7cba1f8cb28d0d07470f1fbe71f", "committedDate": "2020-03-13T17:28:47Z", "message": "Issue #5089: LineLength measures Java characters, not Unicode characters"}, "afterCommit": {"oid": "3adfac79d9c518e9b6dc1f2bdb9bf4ea6984b92a", "author": {"user": {"login": "nmancus1", "name": "Nick Mancuso"}}, "url": "https://github.com/checkstyle/checkstyle/commit/3adfac79d9c518e9b6dc1f2bdb9bf4ea6984b92a", "committedDate": "2020-03-13T22:20:31Z", "message": "Issue #5089: LineLength measures Java characters, not Unicode characters"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0NjU4Mjkx", "url": "https://github.com/checkstyle/checkstyle/pull/7845#pullrequestreview-374658291", "createdAt": "2020-03-13T22:50:54Z", "commit": {"oid": "3adfac79d9c518e9b6dc1f2bdb9bf4ea6984b92a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0NzM3MjE2", "url": "https://github.com/checkstyle/checkstyle/pull/7845#pullrequestreview-374737216", "createdAt": "2020-03-14T16:20:15Z", "commit": {"oid": "3adfac79d9c518e9b6dc1f2bdb9bf4ea6984b92a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNFQxNjoyMDoxNVrOF2aZ1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNFQxNjoyMDoxNVrOF2aZ1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjYwMDAyMA==", "bodyText": "I can only reproduce the issue with maven and not in Eclipse. Since I can't debug, I am starting to add more print outs to see the issue. I removed changes to CommonUtil and the issue remained.\nMaven and Eclipse disagree on line index 4 and 6.\nEclipse says lengths are 2-6 bytes shorter than reported by maven.\nLooking at maven alone, old code and new code always reported a length of 103 so I am not seeing why there wasn't a violation to begin with,", "url": "https://github.com/checkstyle/checkstyle/pull/7845#discussion_r392600020", "createdAt": "2020-03-14T16:20:15Z", "author": {"login": "rnveach"}, "path": "src/main/java/com/puppycrawl/tools/checkstyle/checks/sizes/LineLengthCheck.java", "diffHunk": "@@ -130,7 +130,7 @@ protected void processFiltered(File file, FileText fileText) {\n         for (int i = 0; i < fileText.size(); i++) {\n             final String line = fileText.get(i);\n             final int realLength = CommonUtil.lengthExpandedTabs(\n-                line, line.length(), getTabWidth());\n+                line, line.codePointCount(0, line.length()), getTabWidth());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3adfac79d9c518e9b6dc1f2bdb9bf4ea6984b92a"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3adfac79d9c518e9b6dc1f2bdb9bf4ea6984b92a", "author": {"user": {"login": "nmancus1", "name": "Nick Mancuso"}}, "url": "https://github.com/checkstyle/checkstyle/commit/3adfac79d9c518e9b6dc1f2bdb9bf4ea6984b92a", "committedDate": "2020-03-13T22:20:31Z", "message": "Issue #5089: LineLength measures Java characters, not Unicode characters"}, "afterCommit": {"oid": "4513592170419f4441c2f09cfb182ac9b55f006a", "author": {"user": {"login": "nmancus1", "name": "Nick Mancuso"}}, "url": "https://github.com/checkstyle/checkstyle/commit/4513592170419f4441c2f09cfb182ac9b55f006a", "committedDate": "2020-03-15T11:48:02Z", "message": "Issue #5089: LineLength measures Java characters, not Unicode characters"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4513592170419f4441c2f09cfb182ac9b55f006a", "author": {"user": {"login": "nmancus1", "name": "Nick Mancuso"}}, "url": "https://github.com/checkstyle/checkstyle/commit/4513592170419f4441c2f09cfb182ac9b55f006a", "committedDate": "2020-03-15T11:48:02Z", "message": "Issue #5089: LineLength measures Java characters, not Unicode characters"}, "afterCommit": {"oid": "647b00688e42a58ee940f08fc13f21ab630969e8", "author": {"user": {"login": "nmancus1", "name": "Nick Mancuso"}}, "url": "https://github.com/checkstyle/checkstyle/commit/647b00688e42a58ee940f08fc13f21ab630969e8", "committedDate": "2020-03-15T11:56:43Z", "message": "Issue #5089: LineLength measures Java characters, not Unicode characters"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0NzkzOTU4", "url": "https://github.com/checkstyle/checkstyle/pull/7845#pullrequestreview-374793958", "createdAt": "2020-03-15T12:13:36Z", "commit": {"oid": "647b00688e42a58ee940f08fc13f21ab630969e8"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNVQxMjoxMzozNlrOF2ejEg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNVQxMjoxMzozNlrOF2ejEg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjY2NzkyMg==", "bodyText": "I don't see this is acceptable as it will clash with all other tests and not just this one. You don't even unset the property so you will be leaking into other tests. Even if you do unset, your not guaranteed your code will hit the unset even in the same test.\nThis has to be passed into the configuration object and set via checker property just like you set the max property for the check.", "url": "https://github.com/checkstyle/checkstyle/pull/7845#discussion_r392667922", "createdAt": "2020-03-15T12:13:36Z", "author": {"login": "rnveach"}, "path": "src/test/java/com/puppycrawl/tools/checkstyle/checks/sizes/LineLengthCheckTest.java", "diffHunk": "@@ -98,4 +100,21 @@ public void shouldNotLogLongLinks() throws Exception {\n         verify(checkConfig, getPath(\"InputLineLengthLongLink.java\"), expected);\n     }\n \n+    @Test\n+    public void countUnicodePointsOnce() throws Exception {\n+        final DefaultConfiguration checkConfig =\n+                createModuleConfig(LineLengthCheck.class);\n+        checkConfig.addAttribute(\"max\", \"100\");\n+        // we need to set charset to let test pass on windows where default charset is not UTF-8\n+        System.setProperty(\"file.encoding\", StandardCharsets.UTF_8.name());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "647b00688e42a58ee940f08fc13f21ab630969e8"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0Nzk0MTAw", "url": "https://github.com/checkstyle/checkstyle/pull/7845#pullrequestreview-374794100", "createdAt": "2020-03-15T12:15:40Z", "commit": {"oid": "647b00688e42a58ee940f08fc13f21ab630969e8"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNVQxMjoxNTo0MFrOF2ejpA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNVQxMjoxNjowOVrOF2ej3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjY2ODA2OA==", "bodyText": "In this case other tests will be affected.\nPlease see https://github.com/checkstyle/checkstyle/blob/master/src/test/java/com/puppycrawl/tools/checkstyle/checks/blocks/EmptyCatchBlockCheckTest.java#L92", "url": "https://github.com/checkstyle/checkstyle/pull/7845#discussion_r392668068", "createdAt": "2020-03-15T12:15:40Z", "author": {"login": "strkkk"}, "path": "src/test/java/com/puppycrawl/tools/checkstyle/checks/sizes/LineLengthCheckTest.java", "diffHunk": "@@ -98,4 +100,21 @@ public void shouldNotLogLongLinks() throws Exception {\n         verify(checkConfig, getPath(\"InputLineLengthLongLink.java\"), expected);\n     }\n \n+    @Test\n+    public void countUnicodePointsOnce() throws Exception {\n+        final DefaultConfiguration checkConfig =\n+                createModuleConfig(LineLengthCheck.class);\n+        checkConfig.addAttribute(\"max\", \"100\");\n+        // we need to set charset to let test pass on windows where default charset is not UTF-8\n+        System.setProperty(\"file.encoding\", StandardCharsets.UTF_8.name());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "647b00688e42a58ee940f08fc13f21ab630969e8"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjY2ODEyNQ==", "bodyText": "not only windows, every system with other default encoding", "url": "https://github.com/checkstyle/checkstyle/pull/7845#discussion_r392668125", "createdAt": "2020-03-15T12:16:09Z", "author": {"login": "strkkk"}, "path": "src/test/java/com/puppycrawl/tools/checkstyle/checks/sizes/LineLengthCheckTest.java", "diffHunk": "@@ -98,4 +100,21 @@ public void shouldNotLogLongLinks() throws Exception {\n         verify(checkConfig, getPath(\"InputLineLengthLongLink.java\"), expected);\n     }\n \n+    @Test\n+    public void countUnicodePointsOnce() throws Exception {\n+        final DefaultConfiguration checkConfig =\n+                createModuleConfig(LineLengthCheck.class);\n+        checkConfig.addAttribute(\"max\", \"100\");\n+        // we need to set charset to let test pass on windows where default charset is not UTF-8", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "647b00688e42a58ee940f08fc13f21ab630969e8"}, "originalPosition": 18}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "647b00688e42a58ee940f08fc13f21ab630969e8", "author": {"user": {"login": "nmancus1", "name": "Nick Mancuso"}}, "url": "https://github.com/checkstyle/checkstyle/commit/647b00688e42a58ee940f08fc13f21ab630969e8", "committedDate": "2020-03-15T11:56:43Z", "message": "Issue #5089: LineLength measures Java characters, not Unicode characters"}, "afterCommit": {"oid": "8473b7fd5cb38705082d25c8893a7e9d50853a5f", "author": {"user": {"login": "nmancus1", "name": "Nick Mancuso"}}, "url": "https://github.com/checkstyle/checkstyle/commit/8473b7fd5cb38705082d25c8893a7e9d50853a5f", "committedDate": "2020-03-15T14:29:41Z", "message": "Issue #5089: LineLength measures Java characters, not Unicode characters"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0ODA4MTMz", "url": "https://github.com/checkstyle/checkstyle/pull/7845#pullrequestreview-374808133", "createdAt": "2020-03-15T15:19:42Z", "commit": {"oid": "8473b7fd5cb38705082d25c8893a7e9d50853a5f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNVQxNToxOTo0MlrOF2fgeg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xNVQxNToxOTo0MlrOF2fgeg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjY4MzY0Mg==", "bodyText": "Why not createRootConfig(checkConfig)?", "url": "https://github.com/checkstyle/checkstyle/pull/7845#discussion_r392683642", "createdAt": "2020-03-15T15:19:42Z", "author": {"login": "rnveach"}, "path": "src/test/java/com/puppycrawl/tools/checkstyle/checks/sizes/LineLengthCheckTest.java", "diffHunk": "@@ -98,4 +100,23 @@ public void shouldNotLogLongLinks() throws Exception {\n         verify(checkConfig, getPath(\"InputLineLengthLongLink.java\"), expected);\n     }\n \n+    @Test\n+    public void countUnicodePointsOnce() throws Exception {\n+        final DefaultConfiguration checkConfig =\n+                createModuleConfig(LineLengthCheck.class);\n+        checkConfig.addAttribute(\"max\", \"100\");\n+        // we need to set charset to let test pass when default charset is not UTF-8\n+        final DefaultConfiguration checkerConfig = createRootConfig(null);\n+        checkerConfig.addAttribute(\"charset\", StandardCharsets.UTF_8.name());\n+        checkerConfig.addChild(checkConfig);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8473b7fd5cb38705082d25c8893a7e9d50853a5f"}, "originalPosition": 21}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "86041c61bdc6c435115f628e1e08d888bdd9937c", "author": {"user": {"login": "nmancus1", "name": "Nick Mancuso"}}, "url": "https://github.com/checkstyle/checkstyle/commit/86041c61bdc6c435115f628e1e08d888bdd9937c", "committedDate": "2020-03-15T16:10:26Z", "message": "Issue #5089: LineLength measures Java characters, not Unicode characters"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8473b7fd5cb38705082d25c8893a7e9d50853a5f", "author": {"user": {"login": "nmancus1", "name": "Nick Mancuso"}}, "url": "https://github.com/checkstyle/checkstyle/commit/8473b7fd5cb38705082d25c8893a7e9d50853a5f", "committedDate": "2020-03-15T14:29:41Z", "message": "Issue #5089: LineLength measures Java characters, not Unicode characters"}, "afterCommit": {"oid": "86041c61bdc6c435115f628e1e08d888bdd9937c", "author": {"user": {"login": "nmancus1", "name": "Nick Mancuso"}}, "url": "https://github.com/checkstyle/checkstyle/commit/86041c61bdc6c435115f628e1e08d888bdd9937c", "committedDate": "2020-03-15T16:10:26Z", "message": "Issue #5089: LineLength measures Java characters, not Unicode characters"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0ODEzODk3", "url": "https://github.com/checkstyle/checkstyle/pull/7845#pullrequestreview-374813897", "createdAt": "2020-03-15T16:30:15Z", "commit": {"oid": "86041c61bdc6c435115f628e1e08d888bdd9937c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0ODE2NTM1", "url": "https://github.com/checkstyle/checkstyle/pull/7845#pullrequestreview-374816535", "createdAt": "2020-03-15T17:07:09Z", "commit": {"oid": "86041c61bdc6c435115f628e1e08d888bdd9937c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 823, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}