{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk4Nzc0Mzk5", "number": 8035, "title": "Issue #6216: sync content of cli tool in xdoc and cli tool help output", "bodyText": "Resolves #6216\n\n\nAdds UT for manual sync with both way ignore lists( if we want to ignore an option present in xdoc from putting in Main.java and vice-versa).\n\n\nI added the UT in a new class because XdocsPagesTest.java already had a ClassFanOut of 25, and adding picocli.Commandline made it 26.\n\n\nAnother UT has been added to check the validity and consistency of the parameters/options present in the <source> description.", "createdAt": "2020-04-04T21:42:35Z", "url": "https://github.com/checkstyle/checkstyle/pull/8035", "merged": true, "mergeCommit": {"oid": "d55ceaeeda0d557320f5d81b531fdf2033f47e9c"}, "closed": true, "closedAt": "2020-04-29T14:21:08Z", "author": {"login": "gaurabdg"}, "timelineItems": {"totalCount": 28, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcUkoc4AFqTM4Nzc4NzkyOA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABccZP7PgFqTQwMjcxNjAwMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3Nzg3OTI4", "url": "https://github.com/checkstyle/checkstyle/pull/8035#pullrequestreview-387787928", "createdAt": "2020-04-05T07:05:13Z", "commit": {"oid": "fc57b8fe6441208e9fd330f9f1cd1a793caea0e1"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNVQwNzowNToxNFrOGA9bDw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNVQwNzowNToxNFrOGA9bDw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzY1OTUzNQ==", "bodyText": "Note that you change %n with \\n in the test. Please use %n as the end-of-line marker to fix windows build.", "url": "https://github.com/checkstyle/checkstyle/pull/8035#discussion_r403659535", "createdAt": "2020-04-05T07:05:14Z", "author": {"login": "pbludov"}, "path": "src/test/java/com/puppycrawl/tools/checkstyle/MainTest.java", "diffHunk": "@@ -78,60 +78,126 @@\n             + \"Try 'checkstyle --help' for more information.%n\");\n \n     private static final String USAGE = String.format(Locale.ROOT,\n-          \"Usage: checkstyle [-dEghjJtTV] [-b=<xpath>] [-c=<configurationFile>]\"\n-          + \" [-C=<checkerThreadsNumber>]%n\"\n-          + \"                  [-f=<format>] [-o=<outputPath>] [-p=<propertiesFile>]%n\"\n-          + \"                  [-s=<suppressionLineColumnNumber>] [-w=<tabWidth>]\"\n-          + \" [-W=<treeWalkerThreadsNumber>]%n\"\n-          + \"                  [-e=<exclude>]... [-x=<excludeRegex>]...\"\n-          + \" <files>...%n\"\n-          + \"Checkstyle verifies that the specified source code files adhere to the specified\"\n-          + \" rules. By default%n\"\n-          + \"violations are reported to standard out in plain format. Checkstyle requires a\"\n-          + \" configuration XML%n\"\n-          + \"file that configures the checks to apply.%n\"\n-          + \"      <files>...            One or more source files to verify%n\"\n-          + \"  -b, --branch-matching-xpath=<xpath>%n\"\n-          + \"                            Show Abstract Syntax Tree(AST) branches that match XPath%n\"\n-          + \"  -c=<configurationFile>    Sets the check configuration file to use.%n\"\n-          + \"  -C, --checker-threads-number=<checkerThreadsNumber>%n\"\n-          + \"                            (experimental) The number of Checker threads (must be\"\n-          + \" greater than zero)%n\"\n-          + \"  -d, --debug               Print all debug logging of CheckStyle utility%n\"\n-          + \"  -e, --exclude=<exclude>   Directory/File path to exclude from CheckStyle%n\"\n-          + \"  -E, --executeIgnoredModules%n\"\n-          + \"                            Allows ignored modules to be run.%n\"\n-          + \"  -f=<format>               Sets the output format. Valid values: xml, plain.\"\n-          + \" Defaults to plain%n\"\n-          + \"  -g, --generate-xpath-suppression%n\"\n-          + \"                            Generates to output a suppression xml to use to suppress\"\n-          + \" all violations%n\"\n-          + \"                              from user's config%n\"\n-          + \"  -h, --help                Show this help message and exit.%n\"\n-          + \"  -j, --javadocTree         Print Parse tree of the Javadoc comment%n\"\n-          + \"  -J, --treeWithJavadoc     Print full Abstract Syntax Tree of the file%n\"\n-          + \"  -o=<outputPath>           Sets the output file. Defaults to stdout%n\"\n-          + \"  -p=<propertiesFile>       Loads the properties file%n\"\n-          + \"  -s=<suppressionLineColumnNumber>%n\"\n-          + \"                            Print xpath suppressions at the file's line and column\"\n-          + \" position.%n\"\n-          + \"                              Argument is the line and column number (separated by\"\n-          + \" a : ) in the%n\"\n-          + \"                              file that the suppression should be generated for%n\"\n-          + \"  -t, --tree                Print Abstract Syntax Tree(AST) of the file%n\"\n-          + \"  -T, --treeWithComments    Print Abstract Syntax Tree(AST) of the file including\"\n-          + \" comments%n\"\n-          + \"  -V, --version             Print version information and exit.%n\"\n-          + \"  -w, --tabWidth=<tabWidth> Sets the length of the tab character. Used only with\"\n-          + \" \\\"-s\\\" option.%n\"\n-          + \"                              Default value is 8%n\"\n-          + \"  -W, --tree-walker-threads-number=<treeWalkerThreadsNumber>%n\"\n-          + \"                            (experimental) The number of TreeWalker threads (must be\"\n-          + \" greater than%n\"\n-          + \"                              zero)%n\"\n-          + \"  -x, --exclude-regexp=<excludeRegex>%n\"\n-          + \"                            Regular expression of directory/file to exclude from\"\n-          + \" CheckStyle%n\");\n+          \"Usage: checkstyle [-dEghjJtTV] [-b=<xpath>] [-c=<configurationFile>] \"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fc57b8fe6441208e9fd330f9f1cd1a793caea0e1"}, "originalPosition": 58}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fc57b8fe6441208e9fd330f9f1cd1a793caea0e1", "author": {"user": {"login": "gaurabdg", "name": "Gaurab Dasgupta"}}, "url": "https://github.com/checkstyle/checkstyle/commit/fc57b8fe6441208e9fd330f9f1cd1a793caea0e1", "committedDate": "2020-04-04T21:34:59Z", "message": "Issue #6216: sync content of cli tool in xdoc and cli tool help output"}, "afterCommit": {"oid": "4ba2131a6acfd754f06feda26d19da43b09ac4f3", "author": {"user": {"login": "gaurabdg", "name": "Gaurab Dasgupta"}}, "url": "https://github.com/checkstyle/checkstyle/commit/4ba2131a6acfd754f06feda26d19da43b09ac4f3", "committedDate": "2020-04-05T09:16:37Z", "message": "Issue #6216: sync content of cli tool in xdoc and cli tool help output"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3ODA0OTY0", "url": "https://github.com/checkstyle/checkstyle/pull/8035#pullrequestreview-387804964", "createdAt": "2020-04-05T10:44:29Z", "commit": {"oid": "4ba2131a6acfd754f06feda26d19da43b09ac4f3"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3ODE0ODA0", "url": "https://github.com/checkstyle/checkstyle/pull/8035#pullrequestreview-387814804", "createdAt": "2020-04-05T12:41:57Z", "commit": {"oid": "4ba2131a6acfd754f06feda26d19da43b09ac4f3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNVQxMjo0MTo1N1rOGA_r9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNVQxMjo0MTo1N1rOGA_r9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzY5NjYyOQ==", "bodyText": "Please extract this block to a private static helper method.", "url": "https://github.com/checkstyle/checkstyle/pull/8035#discussion_r403696629", "createdAt": "2020-04-05T12:41:57Z", "author": {"login": "pbludov"}, "path": "src/test/java/com/puppycrawl/tools/checkstyle/internal/CliOptionsXdocsSyncTest.java", "diffHunk": "@@ -0,0 +1,102 @@\n+////////////////////////////////////////////////////////////////////////////////\n+// checkstyle: Checks Java source code for adherence to a set of rules.\n+// Copyright (C) 2001-2020 the original author or authors.\n+//\n+// This library is free software; you can redistribute it and/or\n+// modify it under the terms of the GNU Lesser General Public\n+// License as published by the Free Software Foundation; either\n+// version 2.1 of the License, or (at your option) any later version.\n+//\n+// This library is distributed in the hope that it will be useful,\n+// but WITHOUT ANY WARRANTY; without even the implied warranty of\n+// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n+// Lesser General Public License for more details.\n+//\n+// You should have received a copy of the GNU Lesser General Public\n+// License along with this library; if not, write to the Free Software\n+// Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA\n+////////////////////////////////////////////////////////////////////////////////\n+\n+package com.puppycrawl.tools.checkstyle.internal;\n+\n+import static java.nio.charset.StandardCharsets.UTF_8;\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertNotNull;\n+\n+import java.lang.reflect.Field;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Set;\n+\n+import org.junit.jupiter.api.Test;\n+import org.w3c.dom.Document;\n+import org.w3c.dom.Node;\n+import org.w3c.dom.NodeList;\n+\n+import com.puppycrawl.tools.checkstyle.internal.utils.XmlUtil;\n+import picocli.CommandLine;\n+\n+public class CliOptionsXdocsSyncTest {\n+\n+    @Test\n+    public void validateCliDocSection() throws Exception {\n+        final Map<String, String> cmdDesc = new HashMap<>();\n+        final Set<String> ignoreXdocToMain = new HashSet<>();\n+        // used to ignore options present in xdocs but not in Main.java\n+        ignoreXdocToMain.add(\"-V\");\n+        ignoreXdocToMain.add(\"-h\");\n+\n+        final Path path = Paths.get(\"src/xdocs/cmdline.xml.vm\");\n+        final String input = new String(Files.readAllBytes(path), UTF_8);\n+\n+        final Document document = XmlUtil.getRawXml(path.getFileName().toString(), input, input);\n+        final NodeList sections = document.getElementsByTagName(\"section\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ba2131a6acfd754f06feda26d19da43b09ac4f3"}, "originalPosition": 59}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3ODE1MjA0", "url": "https://github.com/checkstyle/checkstyle/pull/8035#pullrequestreview-387815204", "createdAt": "2020-04-05T12:45:51Z", "commit": {"oid": "4ba2131a6acfd754f06feda26d19da43b09ac4f3"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNVQxMjo0NTo1MVrOGA_t3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNVQxMjo0ODoyN1rOGA_u5g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzY5NzExNw==", "bodyText": "Please use com.google.common.truth.Truth.assertWithMessage method for all assertions.", "url": "https://github.com/checkstyle/checkstyle/pull/8035#discussion_r403697117", "createdAt": "2020-04-05T12:45:51Z", "author": {"login": "pbludov"}, "path": "src/test/java/com/puppycrawl/tools/checkstyle/internal/CliOptionsXdocsSyncTest.java", "diffHunk": "@@ -0,0 +1,102 @@\n+////////////////////////////////////////////////////////////////////////////////\n+// checkstyle: Checks Java source code for adherence to a set of rules.\n+// Copyright (C) 2001-2020 the original author or authors.\n+//\n+// This library is free software; you can redistribute it and/or\n+// modify it under the terms of the GNU Lesser General Public\n+// License as published by the Free Software Foundation; either\n+// version 2.1 of the License, or (at your option) any later version.\n+//\n+// This library is distributed in the hope that it will be useful,\n+// but WITHOUT ANY WARRANTY; without even the implied warranty of\n+// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n+// Lesser General Public License for more details.\n+//\n+// You should have received a copy of the GNU Lesser General Public\n+// License along with this library; if not, write to the Free Software\n+// Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA\n+////////////////////////////////////////////////////////////////////////////////\n+\n+package com.puppycrawl.tools.checkstyle.internal;\n+\n+import static java.nio.charset.StandardCharsets.UTF_8;\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertNotNull;\n+\n+import java.lang.reflect.Field;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Set;\n+\n+import org.junit.jupiter.api.Test;\n+import org.w3c.dom.Document;\n+import org.w3c.dom.Node;\n+import org.w3c.dom.NodeList;\n+\n+import com.puppycrawl.tools.checkstyle.internal.utils.XmlUtil;\n+import picocli.CommandLine;\n+\n+public class CliOptionsXdocsSyncTest {\n+\n+    @Test\n+    public void validateCliDocSection() throws Exception {\n+        final Map<String, String> cmdDesc = new HashMap<>();\n+        final Set<String> ignoreXdocToMain = new HashSet<>();\n+        // used to ignore options present in xdocs but not in Main.java\n+        ignoreXdocToMain.add(\"-V\");\n+        ignoreXdocToMain.add(\"-h\");\n+\n+        final Path path = Paths.get(\"src/xdocs/cmdline.xml.vm\");\n+        final String input = new String(Files.readAllBytes(path), UTF_8);\n+\n+        final Document document = XmlUtil.getRawXml(path.getFileName().toString(), input, input);\n+        final NodeList sections = document.getElementsByTagName(\"section\");\n+        for (int i = 0; i < sections.getLength(); i++) {\n+            final Node subSection = sections.item(i);\n+            final Node name = subSection.getAttributes().getNamedItem(\"name\");\n+            if (\"Command line usage\".equals(name.getNodeValue())) {\n+                final List<Node> children =\n+                        new ArrayList<>(XmlUtil.getChildrenElements(subSection));\n+                for (Node node:children) {\n+                    if (\"ul\".equals(node.getNodeName())) {\n+                        final List<Node> listElements =\n+                                new ArrayList<>(XmlUtil.getChildrenElements(node));\n+                        for (Node element:listElements) {\n+                            final String txt = element.getTextContent()\n+                                    .trim().replaceAll(\"\\\\s+\", \" \");\n+                            cmdDesc.put(txt.substring(0, 2), txt.substring(3));\n+                        }\n+                    }\n+                }\n+            }\n+        }\n+\n+        final Class<?> cliOptionsClazz = Class.forName(\"com.puppycrawl.tools.checkstyle\"\n+                + \".Main$CliOptions\");\n+        final Field[] fields = cliOptionsClazz.getDeclaredFields();\n+        for (Field field:fields) {\n+            final CommandLine.Option optionsAnnotation =\n+                  field.getAnnotation(CommandLine.Option.class);\n+            if (optionsAnnotation != null) {\n+                final String option = optionsAnnotation.names()[0];\n+                final String descXdoc = cmdDesc.get(option);\n+                assertNotNull(descXdoc, \"CLI Option\" + option + \"present in Main.java not \"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ba2131a6acfd754f06feda26d19da43b09ac4f3"}, "originalPosition": 89}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzY5NzI1MQ==", "bodyText": "Please add spaces around :", "url": "https://github.com/checkstyle/checkstyle/pull/8035#discussion_r403697251", "createdAt": "2020-04-05T12:47:11Z", "author": {"login": "pbludov"}, "path": "src/test/java/com/puppycrawl/tools/checkstyle/internal/CliOptionsXdocsSyncTest.java", "diffHunk": "@@ -0,0 +1,102 @@\n+////////////////////////////////////////////////////////////////////////////////\n+// checkstyle: Checks Java source code for adherence to a set of rules.\n+// Copyright (C) 2001-2020 the original author or authors.\n+//\n+// This library is free software; you can redistribute it and/or\n+// modify it under the terms of the GNU Lesser General Public\n+// License as published by the Free Software Foundation; either\n+// version 2.1 of the License, or (at your option) any later version.\n+//\n+// This library is distributed in the hope that it will be useful,\n+// but WITHOUT ANY WARRANTY; without even the implied warranty of\n+// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n+// Lesser General Public License for more details.\n+//\n+// You should have received a copy of the GNU Lesser General Public\n+// License along with this library; if not, write to the Free Software\n+// Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA\n+////////////////////////////////////////////////////////////////////////////////\n+\n+package com.puppycrawl.tools.checkstyle.internal;\n+\n+import static java.nio.charset.StandardCharsets.UTF_8;\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertNotNull;\n+\n+import java.lang.reflect.Field;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Set;\n+\n+import org.junit.jupiter.api.Test;\n+import org.w3c.dom.Document;\n+import org.w3c.dom.Node;\n+import org.w3c.dom.NodeList;\n+\n+import com.puppycrawl.tools.checkstyle.internal.utils.XmlUtil;\n+import picocli.CommandLine;\n+\n+public class CliOptionsXdocsSyncTest {\n+\n+    @Test\n+    public void validateCliDocSection() throws Exception {\n+        final Map<String, String> cmdDesc = new HashMap<>();\n+        final Set<String> ignoreXdocToMain = new HashSet<>();\n+        // used to ignore options present in xdocs but not in Main.java\n+        ignoreXdocToMain.add(\"-V\");\n+        ignoreXdocToMain.add(\"-h\");\n+\n+        final Path path = Paths.get(\"src/xdocs/cmdline.xml.vm\");\n+        final String input = new String(Files.readAllBytes(path), UTF_8);\n+\n+        final Document document = XmlUtil.getRawXml(path.getFileName().toString(), input, input);\n+        final NodeList sections = document.getElementsByTagName(\"section\");\n+        for (int i = 0; i < sections.getLength(); i++) {\n+            final Node subSection = sections.item(i);\n+            final Node name = subSection.getAttributes().getNamedItem(\"name\");\n+            if (\"Command line usage\".equals(name.getNodeValue())) {\n+                final List<Node> children =\n+                        new ArrayList<>(XmlUtil.getChildrenElements(subSection));\n+                for (Node node:children) {\n+                    if (\"ul\".equals(node.getNodeName())) {\n+                        final List<Node> listElements =\n+                                new ArrayList<>(XmlUtil.getChildrenElements(node));\n+                        for (Node element:listElements) {\n+                            final String txt = element.getTextContent()\n+                                    .trim().replaceAll(\"\\\\s+\", \" \");\n+                            cmdDesc.put(txt.substring(0, 2), txt.substring(3));\n+                        }\n+                    }\n+                }\n+            }\n+        }\n+\n+        final Class<?> cliOptionsClazz = Class.forName(\"com.puppycrawl.tools.checkstyle\"\n+                + \".Main$CliOptions\");\n+        final Field[] fields = cliOptionsClazz.getDeclaredFields();\n+        for (Field field:fields) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ba2131a6acfd754f06feda26d19da43b09ac4f3"}, "originalPosition": 83}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzY5NzM4Mg==", "bodyText": "There is a variable for optionsAnnotation.names()[0]", "url": "https://github.com/checkstyle/checkstyle/pull/8035#discussion_r403697382", "createdAt": "2020-04-05T12:48:27Z", "author": {"login": "pbludov"}, "path": "src/test/java/com/puppycrawl/tools/checkstyle/internal/CliOptionsXdocsSyncTest.java", "diffHunk": "@@ -0,0 +1,102 @@\n+////////////////////////////////////////////////////////////////////////////////\n+// checkstyle: Checks Java source code for adherence to a set of rules.\n+// Copyright (C) 2001-2020 the original author or authors.\n+//\n+// This library is free software; you can redistribute it and/or\n+// modify it under the terms of the GNU Lesser General Public\n+// License as published by the Free Software Foundation; either\n+// version 2.1 of the License, or (at your option) any later version.\n+//\n+// This library is distributed in the hope that it will be useful,\n+// but WITHOUT ANY WARRANTY; without even the implied warranty of\n+// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n+// Lesser General Public License for more details.\n+//\n+// You should have received a copy of the GNU Lesser General Public\n+// License along with this library; if not, write to the Free Software\n+// Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA\n+////////////////////////////////////////////////////////////////////////////////\n+\n+package com.puppycrawl.tools.checkstyle.internal;\n+\n+import static java.nio.charset.StandardCharsets.UTF_8;\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertNotNull;\n+\n+import java.lang.reflect.Field;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.util.ArrayList;\n+import java.util.HashMap;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Set;\n+\n+import org.junit.jupiter.api.Test;\n+import org.w3c.dom.Document;\n+import org.w3c.dom.Node;\n+import org.w3c.dom.NodeList;\n+\n+import com.puppycrawl.tools.checkstyle.internal.utils.XmlUtil;\n+import picocli.CommandLine;\n+\n+public class CliOptionsXdocsSyncTest {\n+\n+    @Test\n+    public void validateCliDocSection() throws Exception {\n+        final Map<String, String> cmdDesc = new HashMap<>();\n+        final Set<String> ignoreXdocToMain = new HashSet<>();\n+        // used to ignore options present in xdocs but not in Main.java\n+        ignoreXdocToMain.add(\"-V\");\n+        ignoreXdocToMain.add(\"-h\");\n+\n+        final Path path = Paths.get(\"src/xdocs/cmdline.xml.vm\");\n+        final String input = new String(Files.readAllBytes(path), UTF_8);\n+\n+        final Document document = XmlUtil.getRawXml(path.getFileName().toString(), input, input);\n+        final NodeList sections = document.getElementsByTagName(\"section\");\n+        for (int i = 0; i < sections.getLength(); i++) {\n+            final Node subSection = sections.item(i);\n+            final Node name = subSection.getAttributes().getNamedItem(\"name\");\n+            if (\"Command line usage\".equals(name.getNodeValue())) {\n+                final List<Node> children =\n+                        new ArrayList<>(XmlUtil.getChildrenElements(subSection));\n+                for (Node node:children) {\n+                    if (\"ul\".equals(node.getNodeName())) {\n+                        final List<Node> listElements =\n+                                new ArrayList<>(XmlUtil.getChildrenElements(node));\n+                        for (Node element:listElements) {\n+                            final String txt = element.getTextContent()\n+                                    .trim().replaceAll(\"\\\\s+\", \" \");\n+                            cmdDesc.put(txt.substring(0, 2), txt.substring(3));\n+                        }\n+                    }\n+                }\n+            }\n+        }\n+\n+        final Class<?> cliOptionsClazz = Class.forName(\"com.puppycrawl.tools.checkstyle\"\n+                + \".Main$CliOptions\");\n+        final Field[] fields = cliOptionsClazz.getDeclaredFields();\n+        for (Field field:fields) {\n+            final CommandLine.Option optionsAnnotation =\n+                  field.getAnnotation(CommandLine.Option.class);\n+            if (optionsAnnotation != null) {\n+                final String option = optionsAnnotation.names()[0];\n+                final String descXdoc = cmdDesc.get(option);\n+                assertNotNull(descXdoc, \"CLI Option\" + option + \"present in Main.java not \"\n+                       + \"documented in cmdline.xml.vm\");\n+                assertEquals(descXdoc, optionsAnnotation.description()[0],\n+                        \"CLI options descriptions should match\");\n+                cmdDesc.remove(\n+                        optionsAnnotation.names()[0]);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ba2131a6acfd754f06feda26d19da43b09ac4f3"}, "originalPosition": 94}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4ba2131a6acfd754f06feda26d19da43b09ac4f3", "author": {"user": {"login": "gaurabdg", "name": "Gaurab Dasgupta"}}, "url": "https://github.com/checkstyle/checkstyle/commit/4ba2131a6acfd754f06feda26d19da43b09ac4f3", "committedDate": "2020-04-05T09:16:37Z", "message": "Issue #6216: sync content of cli tool in xdoc and cli tool help output"}, "afterCommit": {"oid": "c3340488190ccc9a9bfd7aafa21cba2c9588be07", "author": {"user": {"login": "gaurabdg", "name": "Gaurab Dasgupta"}}, "url": "https://github.com/checkstyle/checkstyle/commit/c3340488190ccc9a9bfd7aafa21cba2c9588be07", "committedDate": "2020-04-05T13:42:16Z", "message": "Issue #6216: sync content of cli tool in xdoc and cli tool help output"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c3340488190ccc9a9bfd7aafa21cba2c9588be07", "author": {"user": {"login": "gaurabdg", "name": "Gaurab Dasgupta"}}, "url": "https://github.com/checkstyle/checkstyle/commit/c3340488190ccc9a9bfd7aafa21cba2c9588be07", "committedDate": "2020-04-05T13:42:16Z", "message": "Issue #6216: sync content of cli tool in xdoc and cli tool help output"}, "afterCommit": {"oid": "a28f5f9958b660ca4fd1303b3f76f4f816528521", "author": {"user": {"login": "gaurabdg", "name": "Gaurab Dasgupta"}}, "url": "https://github.com/checkstyle/checkstyle/commit/a28f5f9958b660ca4fd1303b3f76f4f816528521", "committedDate": "2020-04-05T13:59:39Z", "message": "Issue #6216: sync content of cli tool in xdoc and cli tool help output"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3ODI4MzU3", "url": "https://github.com/checkstyle/checkstyle/pull/8035#pullrequestreview-387828357", "createdAt": "2020-04-05T15:04:15Z", "commit": {"oid": "a28f5f9958b660ca4fd1303b3f76f4f816528521"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNVQxNTowNDoxNVrOGBAv5Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNVQxNTowNDoxNVrOGBAv5Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzcxNDAyMQ==", "bodyText": "Looks like the space is not allowed here", "url": "https://github.com/checkstyle/checkstyle/pull/8035#discussion_r403714021", "createdAt": "2020-04-05T15:04:15Z", "author": {"login": "pbludov"}, "path": "src/xdocs/cmdline.xml.vm", "diffHunk": "@@ -52,7 +52,7 @@ java -D&lt;property&gt;=&lt;value&gt;  \\\n         checks to apply. Command line options are:\n       </p>\n \n-      <ul>\n+      <ul id=\"CLI Options\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a28f5f9958b660ca4fd1303b3f76f4f816528521"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a28f5f9958b660ca4fd1303b3f76f4f816528521", "author": {"user": {"login": "gaurabdg", "name": "Gaurab Dasgupta"}}, "url": "https://github.com/checkstyle/checkstyle/commit/a28f5f9958b660ca4fd1303b3f76f4f816528521", "committedDate": "2020-04-05T13:59:39Z", "message": "Issue #6216: sync content of cli tool in xdoc and cli tool help output"}, "afterCommit": {"oid": "4b97f7468eb917f34ca1419aa757ba53cab3b2d7", "author": {"user": {"login": "gaurabdg", "name": "Gaurab Dasgupta"}}, "url": "https://github.com/checkstyle/checkstyle/commit/4b97f7468eb917f34ca1419aa757ba53cab3b2d7", "committedDate": "2020-04-05T15:05:11Z", "message": "Issue #6216: sync content of cli tool in xdoc and cli tool help output"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3ODQ2MDQy", "url": "https://github.com/checkstyle/checkstyle/pull/8035#pullrequestreview-387846042", "createdAt": "2020-04-05T18:19:02Z", "commit": {"oid": "4b97f7468eb917f34ca1419aa757ba53cab3b2d7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3ODc2MTY5", "url": "https://github.com/checkstyle/checkstyle/pull/8035#pullrequestreview-387876169", "createdAt": "2020-04-05T23:48:02Z", "commit": {"oid": "4b97f7468eb917f34ca1419aa757ba53cab3b2d7"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNVQyMzo0ODowMlrOGBEeAQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNVQyMzo0OToyMFrOGBEewg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzc3NDk3Nw==", "bodyText": "Why did we add configurationFile to description?", "url": "https://github.com/checkstyle/checkstyle/pull/8035#discussion_r403774977", "createdAt": "2020-04-05T23:48:02Z", "author": {"login": "rnveach"}, "path": "src/main/java/com/puppycrawl/tools/checkstyle/Main.java", "diffHunk": "@@ -607,22 +607,31 @@ public boolean isLoggable(LogRecord record) {\n         private List<File> files;\n \n         /** Config file location. */\n-        @Option(names = \"-c\", description = \"Sets the check configuration file to use.\")\n+        @Option(names = \"-c\", description = \"configurationFile - specifies the location of the\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b97f7468eb917f34ca1419aa757ba53cab3b2d7"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzc3NTA5Mw==", "bodyText": "same.", "url": "https://github.com/checkstyle/checkstyle/pull/8035#discussion_r403775093", "createdAt": "2020-04-05T23:48:48Z", "author": {"login": "rnveach"}, "path": "src/main/java/com/puppycrawl/tools/checkstyle/Main.java", "diffHunk": "@@ -631,14 +640,17 @@ public boolean isLoggable(LogRecord record) {\n          *\n          * @noinspection CanBeFinal\n          */\n-        @Option(names = {\"-w\", \"--tabWidth\"}, description = \"Sets the length of the tab character. \"\n-                + \"Used only with \\\"-s\\\" option. Default value is ${DEFAULT-VALUE}\")\n+        @Option(names = {\"-w\", \"--tabWidth\"}, description = \" --tabWidth length - set the length\"\n+                + \" of the tab character. Used only with -s and -gxs options. Default value is 8.\")\n         private int tabWidth = CommonUtil.DEFAULT_TAB_WIDTH;\n \n         /** Switch whether to generate suppressions file or not. */\n         @Option(names = {\"-g\", \"--generate-xpath-suppression\"},\n-                description = \"Generates to output a suppression xml to use to suppress all\"\n-                        + \" violations from user's config\")\n+                description = \"--generate-xpath-suppression - generate to output a suppression\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b97f7468eb917f34ca1419aa757ba53cab3b2d7"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzc3NTE0Mg==", "bodyText": "same.", "url": "https://github.com/checkstyle/checkstyle/pull/8035#discussion_r403775142", "createdAt": "2020-04-05T23:49:02Z", "author": {"login": "rnveach"}, "path": "src/main/java/com/puppycrawl/tools/checkstyle/Main.java", "diffHunk": "@@ -647,33 +659,48 @@ public boolean isLoggable(LogRecord record) {\n          *\n          * @noinspection CanBeFinal\n          */\n-        @Option(names = \"-f\", description = \"Sets the output format. Valid values: \"\n-                + \"${COMPLETION-CANDIDATES}. Defaults to ${DEFAULT-VALUE}\")\n+        @Option(names = \"-f\", description = \"format - specify the output format. Options are\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b97f7468eb917f34ca1419aa757ba53cab3b2d7"}, "originalPosition": 66}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzc3NTE3MA==", "bodyText": "same and so on.", "url": "https://github.com/checkstyle/checkstyle/pull/8035#discussion_r403775170", "createdAt": "2020-04-05T23:49:20Z", "author": {"login": "rnveach"}, "path": "src/main/java/com/puppycrawl/tools/checkstyle/Main.java", "diffHunk": "@@ -647,33 +659,48 @@ public boolean isLoggable(LogRecord record) {\n          *\n          * @noinspection CanBeFinal\n          */\n-        @Option(names = \"-f\", description = \"Sets the output format. Valid values: \"\n-                + \"${COMPLETION-CANDIDATES}. Defaults to ${DEFAULT-VALUE}\")\n+        @Option(names = \"-f\", description = \"format - specify the output format. Options are\"\n+                + \" \\\"plain\\\" for the DefaultLogger and \\\"xml\\\" for the XMLLogger. Defaults\"\n+                + \" to \\\"plain\\\".\")\n         private OutputFormat format = DEFAULT_OUTPUT_FORMAT;\n \n         /** Option that controls whether to print the AST of the file. */\n         @Option(names = {\"-t\", \"--tree\"},\n-                description = \"Print Abstract Syntax Tree(AST) of the file\")\n+                description = \" --tree - print Abstract Syntax Tree(AST) of the checked file.\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4b97f7468eb917f34ca1419aa757ba53cab3b2d7"}, "originalPosition": 74}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4b97f7468eb917f34ca1419aa757ba53cab3b2d7", "author": {"user": {"login": "gaurabdg", "name": "Gaurab Dasgupta"}}, "url": "https://github.com/checkstyle/checkstyle/commit/4b97f7468eb917f34ca1419aa757ba53cab3b2d7", "committedDate": "2020-04-05T15:05:11Z", "message": "Issue #6216: sync content of cli tool in xdoc and cli tool help output"}, "afterCommit": {"oid": "86c2cb8c75899a8c117259e2308c8a0eee09bf34", "author": {"user": {"login": "gaurabdg", "name": "Gaurab Dasgupta"}}, "url": "https://github.com/checkstyle/checkstyle/commit/86c2cb8c75899a8c117259e2308c8a0eee09bf34", "committedDate": "2020-04-06T11:02:40Z", "message": "Issue #6216: sync content of cli tool in xdoc and cli tool help output"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4NTc1MzY2", "url": "https://github.com/checkstyle/checkstyle/pull/8035#pullrequestreview-388575366", "createdAt": "2020-04-06T20:03:19Z", "commit": {"oid": "86c2cb8c75899a8c117259e2308c8a0eee09bf34"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQyMDowMzoxOVrOGBnzwQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQyMDoxNzo1MFrOGBoR-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDM1Mzk4NQ==", "bodyText": "All descriptions should be proper sentences. Start with an uppercase letter and end with a period.\nPlease do the same for the rest.", "url": "https://github.com/checkstyle/checkstyle/pull/8035#discussion_r404353985", "createdAt": "2020-04-06T20:03:19Z", "author": {"login": "rnveach"}, "path": "src/main/java/com/puppycrawl/tools/checkstyle/Main.java", "diffHunk": "@@ -607,22 +607,31 @@ public boolean isLoggable(LogRecord record) {\n         private List<File> files;\n \n         /** Config file location. */\n-        @Option(names = \"-c\", description = \"Sets the check configuration file to use.\")\n+        @Option(names = \"-c\", description = \"specifies the location of the\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86c2cb8c75899a8c117259e2308c8a0eee09bf34"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDM1NTY5Nw==", "bodyText": "Why did we lose the original description? It looks like it has more as it defines the default description.", "url": "https://github.com/checkstyle/checkstyle/pull/8035#discussion_r404355697", "createdAt": "2020-04-06T20:06:41Z", "author": {"login": "rnveach"}, "path": "src/main/java/com/puppycrawl/tools/checkstyle/Main.java", "diffHunk": "@@ -607,22 +607,31 @@ public boolean isLoggable(LogRecord record) {\n         private List<File> files;\n \n         /** Config file location. */\n-        @Option(names = \"-c\", description = \"Sets the check configuration file to use.\")\n+        @Option(names = \"-c\", description = \"specifies the location of the\"\n+                + \" file that defines the configuration modules. The location can either be a\"\n+                + \" filesystem location, or a name passed to the ClassLoader.getResource() method.\")\n         private String configurationFile;\n \n         /** Output file location. */\n-        @Option(names = \"-o\", description = \"Sets the output file. Defaults to stdout\")\n+        @Option(names = \"-o\", description = \"specify the file to output to.\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86c2cb8c75899a8c117259e2308c8a0eee09bf34"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDM1NjE3Mw==", "bodyText": "Why did we lose the ()s around (separated by a : )?", "url": "https://github.com/checkstyle/checkstyle/pull/8035#discussion_r404356173", "createdAt": "2020-04-06T20:07:34Z", "author": {"login": "rnveach"}, "path": "src/main/java/com/puppycrawl/tools/checkstyle/Main.java", "diffHunk": "@@ -607,22 +607,31 @@ public boolean isLoggable(LogRecord record) {\n         private List<File> files;\n \n         /** Config file location. */\n-        @Option(names = \"-c\", description = \"Sets the check configuration file to use.\")\n+        @Option(names = \"-c\", description = \"specifies the location of the\"\n+                + \" file that defines the configuration modules. The location can either be a\"\n+                + \" filesystem location, or a name passed to the ClassLoader.getResource() method.\")\n         private String configurationFile;\n \n         /** Output file location. */\n-        @Option(names = \"-o\", description = \"Sets the output file. Defaults to stdout\")\n+        @Option(names = \"-o\", description = \"specify the file to output to.\")\n         private Path outputPath;\n \n         /** Properties file location. */\n-        @Option(names = \"-p\", description = \"Loads the properties file\")\n+        @Option(names = \"-p\", description = \"specify a properties file to use.\")\n         private File propertiesFile;\n \n         /** LineNo and columnNo for the suppression. */\n         @Option(names = \"-s\",\n-                description = \"Print xpath suppressions at the file's line and column position. \"\n-                        + \"Argument is the line and column number (separated by a : ) in the file \"\n-                        + \"that the suppression should be generated for\")\n+                description = \"print xpath suppressions at the file's line and\"\n+                        + \" column position. Line and column numbers are integer values\"\n+                        + \" separated by a :, specify location in the file the suppression\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86c2cb8c75899a8c117259e2308c8a0eee09bf34"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDM1NjcyOQ==", "bodyText": "There are a few places like this, why did we change \"Sets\" to \"Set\"?", "url": "https://github.com/checkstyle/checkstyle/pull/8035#discussion_r404356729", "createdAt": "2020-04-06T20:08:37Z", "author": {"login": "rnveach"}, "path": "src/main/java/com/puppycrawl/tools/checkstyle/Main.java", "diffHunk": "@@ -631,14 +640,17 @@ public boolean isLoggable(LogRecord record) {\n          *\n          * @noinspection CanBeFinal\n          */\n-        @Option(names = {\"-w\", \"--tabWidth\"}, description = \"Sets the length of the tab character. \"\n-                + \"Used only with \\\"-s\\\" option. Default value is ${DEFAULT-VALUE}\")\n+        @Option(names = {\"-w\", \"--tabWidth\"}, description = \"set the length\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86c2cb8c75899a8c117259e2308c8a0eee09bf34"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDM1NzA5MQ==", "bodyText": "There is no way to keep the ${DEFAULT-VALUE} in the Java code and convert it to it's text form in the xdoc?", "url": "https://github.com/checkstyle/checkstyle/pull/8035#discussion_r404357091", "createdAt": "2020-04-06T20:09:12Z", "author": {"login": "rnveach"}, "path": "src/main/java/com/puppycrawl/tools/checkstyle/Main.java", "diffHunk": "@@ -631,14 +640,17 @@ public boolean isLoggable(LogRecord record) {\n          *\n          * @noinspection CanBeFinal\n          */\n-        @Option(names = {\"-w\", \"--tabWidth\"}, description = \"Sets the length of the tab character. \"\n-                + \"Used only with \\\"-s\\\" option. Default value is ${DEFAULT-VALUE}\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86c2cb8c75899a8c117259e2308c8a0eee09bf34"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDM1NzM3OQ==", "bodyText": "I don't see the purpose of this change. The original code was easier to read. Nothing else seems different.", "url": "https://github.com/checkstyle/checkstyle/pull/8035#discussion_r404357379", "createdAt": "2020-04-06T20:09:46Z", "author": {"login": "rnveach"}, "path": "src/main/java/com/puppycrawl/tools/checkstyle/Main.java", "diffHunk": "@@ -693,12 +722,13 @@ public boolean isLoggable(LogRecord record) {\n          * @noinspection CanBeFinal\n          */\n         @Option(names = {\"-x\", \"--exclude-regexp\"},\n-                description = \"Regular expression of directory/file to exclude from CheckStyle\")\n+                description = \"Directory/file pattern to exclude from CheckStyle. \"\n+                        + \"Multiple excludes are allowed.\")\n         private List<Pattern> excludeRegex = new ArrayList<>();\n \n         /** Switch whether to execute ignored modules or not. */\n-        @Option(names = {\"-E\", \"--executeIgnoredModules\"},\n-                description = \"Allows ignored modules to be run.\")\n+        @Option(names = {\"-E\", \"--executeIgnoredModules\"}, description = \"Allows ignored modules\"\n+                + \" to be run.\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86c2cb8c75899a8c117259e2308c8a0eee09bf34"}, "originalPosition": 141}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDM1OTY0Nw==", "bodyText": "Why do we need to look at all sections when you have given the ul an exact ID? Why aren't we using document.getElementById?", "url": "https://github.com/checkstyle/checkstyle/pull/8035#discussion_r404359647", "createdAt": "2020-04-06T20:13:55Z", "author": {"login": "rnveach"}, "path": "src/test/java/com/puppycrawl/tools/checkstyle/internal/CliOptionsXdocsSyncTest.java", "diffHunk": "@@ -0,0 +1,111 @@\n+////////////////////////////////////////////////////////////////////////////////\n+// checkstyle: Checks Java source code for adherence to a set of rules.\n+// Copyright (C) 2001-2020 the original author or authors.\n+//\n+// This library is free software; you can redistribute it and/or\n+// modify it under the terms of the GNU Lesser General Public\n+// License as published by the Free Software Foundation; either\n+// version 2.1 of the License, or (at your option) any later version.\n+//\n+// This library is distributed in the hope that it will be useful,\n+// but WITHOUT ANY WARRANTY; without even the implied warranty of\n+// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n+// Lesser General Public License for more details.\n+//\n+// You should have received a copy of the GNU Lesser General Public\n+// License along with this library; if not, write to the Free Software\n+// Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA\n+////////////////////////////////////////////////////////////////////////////////\n+\n+package com.puppycrawl.tools.checkstyle.internal;\n+\n+import static com.google.common.truth.Truth.assertWithMessage;\n+import static java.nio.charset.StandardCharsets.UTF_8;\n+\n+import java.lang.reflect.Field;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.util.HashMap;\n+import java.util.HashSet;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+\n+import org.junit.jupiter.api.Test;\n+import org.w3c.dom.Document;\n+import org.w3c.dom.Node;\n+import org.w3c.dom.NodeList;\n+\n+import com.puppycrawl.tools.checkstyle.internal.utils.XmlUtil;\n+import picocli.CommandLine.Option;\n+\n+public class CliOptionsXdocsSyncTest {\n+\n+    @Test\n+    public void validateCliDocSection() throws Exception {\n+        final Map<String, String> cmdDesc = new HashMap<>();\n+        final Set<String> ignoreXdocToMain = new HashSet<>();\n+        // used to ignore options present in xdocs but not in Main.java\n+        ignoreXdocToMain.add(\"-V\");\n+        ignoreXdocToMain.add(\"-h\");\n+\n+        final NodeList sections = getSectionsFromXdoc(\"src/xdocs/cmdline.xml.vm\");\n+\n+        for (int i = 0; i < sections.getLength(); i++) {\n+            final Node subSection = sections.item(i);\n+            final Node name = subSection.getAttributes().getNamedItem(\"name\");\n+            if (\"Command line usage\".equals(name.getNodeValue())) {\n+                final Set<String> cmdOptions = getListById(subSection, \"CLI_Options\");\n+                for (String option : cmdOptions) {\n+                    final String text = option.trim().replaceAll(\"\\\\s+\", \" \");\n+                    cmdDesc.put(text.substring(0, 2), text.substring(text.indexOf(\" - \") + 3));\n+                }\n+            }\n+        }\n+\n+        final Class<?> cliOptionsClazz = Class.forName(\"com.puppycrawl.tools.checkstyle\"\n+                + \".Main$CliOptions\");\n+        final Field[] fields = cliOptionsClazz.getDeclaredFields();\n+        for (Field field : fields) {\n+            final Option optionsAnnotation = field.getAnnotation(Option.class);\n+            if (optionsAnnotation != null) {\n+                final String option = optionsAnnotation.names()[0];\n+                final String descXdoc = cmdDesc.get(option);\n+                final String descMain = optionsAnnotation.description()[0];\n+                assertWithMessage(\"CLI Option\" + option + \"present in \"\n+                        + \"Main.java not documented in cmdline.xml.vm\")\n+                        .that(descXdoc).isNotNull();\n+                assertWithMessage(\"CLI options descriptions in xdoc: \" + descXdoc\n+                        + \" should match that of in Main.java: \" + descMain)\n+                        .that(descXdoc.equals(descMain)).isTrue();\n+                cmdDesc.remove(option);\n+            }\n+        }\n+\n+        cmdDesc.entrySet().removeIf(entry -> ignoreXdocToMain.contains(entry.getKey()));\n+        assertWithMessage(\"CLI Options\" + cmdDesc + \"present in \"\n+                + \"cmdline.xml.vm not documented in Main.java\")\n+                .that(cmdDesc.isEmpty());\n+    }\n+\n+    private static NodeList getSectionsFromXdoc(String xdocPath) throws Exception {\n+        final Path path = Paths.get(xdocPath);\n+        final String input = new String(Files.readAllBytes(path), UTF_8);\n+\n+        final Document document = XmlUtil.getRawXml(path.getFileName().toString(), input, input);\n+        return document.getElementsByTagName(\"section\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86c2cb8c75899a8c117259e2308c8a0eee09bf34"}, "originalPosition": 97}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDM2MTcyMA==", "bodyText": "So we are specifically looking for options in our class and not what is being reported by picocli?", "url": "https://github.com/checkstyle/checkstyle/pull/8035#discussion_r404361720", "createdAt": "2020-04-06T20:17:50Z", "author": {"login": "rnveach"}, "path": "src/test/java/com/puppycrawl/tools/checkstyle/internal/CliOptionsXdocsSyncTest.java", "diffHunk": "@@ -0,0 +1,111 @@\n+////////////////////////////////////////////////////////////////////////////////\n+// checkstyle: Checks Java source code for adherence to a set of rules.\n+// Copyright (C) 2001-2020 the original author or authors.\n+//\n+// This library is free software; you can redistribute it and/or\n+// modify it under the terms of the GNU Lesser General Public\n+// License as published by the Free Software Foundation; either\n+// version 2.1 of the License, or (at your option) any later version.\n+//\n+// This library is distributed in the hope that it will be useful,\n+// but WITHOUT ANY WARRANTY; without even the implied warranty of\n+// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n+// Lesser General Public License for more details.\n+//\n+// You should have received a copy of the GNU Lesser General Public\n+// License along with this library; if not, write to the Free Software\n+// Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA\n+////////////////////////////////////////////////////////////////////////////////\n+\n+package com.puppycrawl.tools.checkstyle.internal;\n+\n+import static com.google.common.truth.Truth.assertWithMessage;\n+import static java.nio.charset.StandardCharsets.UTF_8;\n+\n+import java.lang.reflect.Field;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.util.HashMap;\n+import java.util.HashSet;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+\n+import org.junit.jupiter.api.Test;\n+import org.w3c.dom.Document;\n+import org.w3c.dom.Node;\n+import org.w3c.dom.NodeList;\n+\n+import com.puppycrawl.tools.checkstyle.internal.utils.XmlUtil;\n+import picocli.CommandLine.Option;\n+\n+public class CliOptionsXdocsSyncTest {\n+\n+    @Test\n+    public void validateCliDocSection() throws Exception {\n+        final Map<String, String> cmdDesc = new HashMap<>();\n+        final Set<String> ignoreXdocToMain = new HashSet<>();\n+        // used to ignore options present in xdocs but not in Main.java", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86c2cb8c75899a8c117259e2308c8a0eee09bf34"}, "originalPosition": 49}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4NTkxOTMy", "url": "https://github.com/checkstyle/checkstyle/pull/8035#pullrequestreview-388591932", "createdAt": "2020-04-06T20:28:15Z", "commit": {"oid": "86c2cb8c75899a8c117259e2308c8a0eee09bf34"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "86c2cb8c75899a8c117259e2308c8a0eee09bf34", "author": {"user": {"login": "gaurabdg", "name": "Gaurab Dasgupta"}}, "url": "https://github.com/checkstyle/checkstyle/commit/86c2cb8c75899a8c117259e2308c8a0eee09bf34", "committedDate": "2020-04-06T11:02:40Z", "message": "Issue #6216: sync content of cli tool in xdoc and cli tool help output"}, "afterCommit": {"oid": "72dbf994ae300649e17e11debe5aa6a70dd4d147", "author": {"user": {"login": "gaurabdg", "name": "Gaurab Dasgupta"}}, "url": "https://github.com/checkstyle/checkstyle/commit/72dbf994ae300649e17e11debe5aa6a70dd4d147", "committedDate": "2020-04-07T15:15:53Z", "message": "Issue #6216: sync content of cli tool in xdoc and cli tool help output"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "72dbf994ae300649e17e11debe5aa6a70dd4d147", "author": {"user": {"login": "gaurabdg", "name": "Gaurab Dasgupta"}}, "url": "https://github.com/checkstyle/checkstyle/commit/72dbf994ae300649e17e11debe5aa6a70dd4d147", "committedDate": "2020-04-07T15:15:53Z", "message": "Issue #6216: sync content of cli tool in xdoc and cli tool help output"}, "afterCommit": {"oid": "de27c6464d20fe459ca37c1174401bf8130428b7", "author": {"user": {"login": "gaurabdg", "name": "Gaurab Dasgupta"}}, "url": "https://github.com/checkstyle/checkstyle/commit/de27c6464d20fe459ca37c1174401bf8130428b7", "committedDate": "2020-04-08T11:09:16Z", "message": "Issue #6216: sync content of cli tool in xdoc and cli tool help output"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "de27c6464d20fe459ca37c1174401bf8130428b7", "author": {"user": {"login": "gaurabdg", "name": "Gaurab Dasgupta"}}, "url": "https://github.com/checkstyle/checkstyle/commit/de27c6464d20fe459ca37c1174401bf8130428b7", "committedDate": "2020-04-08T11:09:16Z", "message": "Issue #6216: sync content of cli tool in xdoc and cli tool help output"}, "afterCommit": {"oid": "7c5bd04491dc68cfe220443ce591d7f182ce5996", "author": {"user": {"login": "gaurabdg", "name": "Gaurab Dasgupta"}}, "url": "https://github.com/checkstyle/checkstyle/commit/7c5bd04491dc68cfe220443ce591d7f182ce5996", "committedDate": "2020-04-08T16:36:16Z", "message": "Issue #6216: sync content of cli tool in xdoc and cli tool help output"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7c5bd04491dc68cfe220443ce591d7f182ce5996", "author": {"user": {"login": "gaurabdg", "name": "Gaurab Dasgupta"}}, "url": "https://github.com/checkstyle/checkstyle/commit/7c5bd04491dc68cfe220443ce591d7f182ce5996", "committedDate": "2020-04-08T16:36:16Z", "message": "Issue #6216: sync content of cli tool in xdoc and cli tool help output"}, "afterCommit": {"oid": "5699d3d542cce71587947d15dc9dccfd92fa32ea", "author": {"user": {"login": "gaurabdg", "name": "Gaurab Dasgupta"}}, "url": "https://github.com/checkstyle/checkstyle/commit/5699d3d542cce71587947d15dc9dccfd92fa32ea", "committedDate": "2020-04-08T16:56:02Z", "message": "Issue #6216: sync content of cli tool in xdoc and cli tool help output"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5699d3d542cce71587947d15dc9dccfd92fa32ea", "author": {"user": {"login": "gaurabdg", "name": "Gaurab Dasgupta"}}, "url": "https://github.com/checkstyle/checkstyle/commit/5699d3d542cce71587947d15dc9dccfd92fa32ea", "committedDate": "2020-04-08T16:56:02Z", "message": "Issue #6216: sync content of cli tool in xdoc and cli tool help output"}, "afterCommit": {"oid": "91d50b4f407934fccece3a4cc2c0a0a56f981c4a", "author": {"user": {"login": "gaurabdg", "name": "Gaurab Dasgupta"}}, "url": "https://github.com/checkstyle/checkstyle/commit/91d50b4f407934fccece3a4cc2c0a0a56f981c4a", "committedDate": "2020-04-08T18:55:21Z", "message": "Issue #6216: sync content of cli tool in xdoc and cli tool help output"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "91d50b4f407934fccece3a4cc2c0a0a56f981c4a", "author": {"user": {"login": "gaurabdg", "name": "Gaurab Dasgupta"}}, "url": "https://github.com/checkstyle/checkstyle/commit/91d50b4f407934fccece3a4cc2c0a0a56f981c4a", "committedDate": "2020-04-08T18:55:21Z", "message": "Issue #6216: sync content of cli tool in xdoc and cli tool help output"}, "afterCommit": {"oid": "5772b6105a9ee0170da644535bdd80d811114a39", "author": {"user": {"login": "gaurabdg", "name": "Gaurab Dasgupta"}}, "url": "https://github.com/checkstyle/checkstyle/commit/5772b6105a9ee0170da644535bdd80d811114a39", "committedDate": "2020-04-08T22:33:15Z", "message": "Issue #6216: sync content of cli tool in xdoc and cli tool help output"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5772b6105a9ee0170da644535bdd80d811114a39", "author": {"user": {"login": "gaurabdg", "name": "Gaurab Dasgupta"}}, "url": "https://github.com/checkstyle/checkstyle/commit/5772b6105a9ee0170da644535bdd80d811114a39", "committedDate": "2020-04-08T22:33:15Z", "message": "Issue #6216: sync content of cli tool in xdoc and cli tool help output"}, "afterCommit": {"oid": "4446b8a21600826ee7dba67e56c6f2455db832bd", "author": {"user": {"login": "gaurabdg", "name": "Gaurab Dasgupta"}}, "url": "https://github.com/checkstyle/checkstyle/commit/4446b8a21600826ee7dba67e56c6f2455db832bd", "committedDate": "2020-04-18T12:16:03Z", "message": "Issue #6216: sync content of cli tool in xdoc and cli tool help output"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2MDE3ODQw", "url": "https://github.com/checkstyle/checkstyle/pull/8035#pullrequestreview-396017840", "createdAt": "2020-04-19T13:29:00Z", "commit": {"oid": "4446b8a21600826ee7dba67e56c6f2455db832bd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOVQxMzoyOTowMFrOGH3q1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xOVQxMzoyOTowMFrOGH3q1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDkwNTMwMA==", "bodyText": "it is sad that we leaked -C and -W to users, such options do not work.\nWe should remove them, probably should be done in separate issue.\n@rnveach , are you agree ?", "url": "https://github.com/checkstyle/checkstyle/pull/8035#discussion_r410905300", "createdAt": "2020-04-19T13:29:00Z", "author": {"login": "romani"}, "path": "src/xdocs/cmdline.xml.vm", "diffHunk": "@@ -148,13 +141,21 @@ java -D&lt;property&gt;=&lt;value&gt;  \\\n         </li>\n         <li>\n           <code>-b, --branch-matching-xpath xpathQuery</code>\n-           - Show Abstract Syntax Tree(AST) branches that match given XPath query.\n+           - Shows Abstract Syntax Tree(AST) branches that match given XPath query.\n         </li>\n         <li>\n           <code>-h, --help</code> - print usage help message and exit. Any other option is ignored.\n         </li>\n         <li>\n-          <code>--executeIgnoredModules</code> - Allows ignored modules to be run.\n+          <code>-E, --executeIgnoredModules</code> - Allows ignored modules to be run.\n+        </li>\n+        <li>\n+          <code>-C, --checker-threads-number</code> - (experimental) The number of Checker threads\n+          (must be greater than zero). Default is 1.\n+        </li>\n+        <li>\n+          <code>-W, --tree-walker-threads-number</code> - (experimental) The number of TreeWalker", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4446b8a21600826ee7dba67e56c6f2455db832bd"}, "originalPosition": 146}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5OTIyMzQ2", "url": "https://github.com/checkstyle/checkstyle/pull/8035#pullrequestreview-399922346", "createdAt": "2020-04-24T12:58:50Z", "commit": {"oid": "4446b8a21600826ee7dba67e56c6f2455db832bd"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxMjo1ODo1MFrOGLWfSQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxMjo1ODo1MFrOGLWfSQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDU1NTk3Nw==", "bodyText": "I feel a combination of how we specify options plus the original description sounds better.\nSets the property files to load.", "url": "https://github.com/checkstyle/checkstyle/pull/8035#discussion_r414555977", "createdAt": "2020-04-24T12:58:50Z", "author": {"login": "rnveach"}, "path": "src/xdocs/cmdline.xml.vm", "diffHunk": "@@ -63,76 +67,65 @@ java -D&lt;property&gt;=&lt;value&gt;  \\\n           passed to the ClassLoader.getResource() method.\n         </li>\n         <li>\n-          <code>-f format</code> - specify the output\n-          format. Options are <code> \"plain\"</code> for the <a\n-          href=\"apidocs/com/puppycrawl/tools/checkstyle/DefaultLogger.html\">DefaultLogger</a>\n-          and <code>\"xml\"</code> for the <a\n-          href=\"apidocs/com/puppycrawl/tools/checkstyle/XMLLogger.html\">XMLLogger</a>.\n-          Defaults to <code>\"plain\"</code>.\n+          <code>-f format</code> - Specifies the output\n+          format. Valid values: <code>xml</code>, <code>plain</code> for <a\n+          href=\"apidocs/com/puppycrawl/tools/checkstyle/XMLLogger.html\">XMLLogger</a>\n+          and <a href=\"apidocs/com/puppycrawl/tools/checkstyle/DefaultLogger\n+          .html\">DefaultLogger</a> respectively.\n+          Defaults to <code>plain</code>.\n         </li>\n         <li>\n-          <code>-p propertiesFile</code> - specify a\n-          properties file to use.\n+          <code>-p propertiesFile</code> - Loads the properties file.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4446b8a21600826ee7dba67e56c6f2455db832bd"}, "originalPosition": 48}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4446b8a21600826ee7dba67e56c6f2455db832bd", "author": {"user": {"login": "gaurabdg", "name": "Gaurab Dasgupta"}}, "url": "https://github.com/checkstyle/checkstyle/commit/4446b8a21600826ee7dba67e56c6f2455db832bd", "committedDate": "2020-04-18T12:16:03Z", "message": "Issue #6216: sync content of cli tool in xdoc and cli tool help output"}, "afterCommit": {"oid": "d4f10bc84c3e75fb793d110fe4e97ed84de45032", "author": {"user": {"login": "gaurabdg", "name": "Gaurab Dasgupta"}}, "url": "https://github.com/checkstyle/checkstyle/commit/d4f10bc84c3e75fb793d110fe4e97ed84de45032", "committedDate": "2020-04-25T16:42:13Z", "message": "Issue #6216: sync content of cli tool in xdoc and cli tool help output"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7d3a01d617f36d6b4da330ddf4a1767661fe10a1", "author": {"user": {"login": "gaurabdg", "name": "Gaurab Dasgupta"}}, "url": "https://github.com/checkstyle/checkstyle/commit/7d3a01d617f36d6b4da330ddf4a1767661fe10a1", "committedDate": "2020-04-26T08:13:45Z", "message": "Issue #6216: sync content of cli tool in xdoc and cli tool help output"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d4f10bc84c3e75fb793d110fe4e97ed84de45032", "author": {"user": {"login": "gaurabdg", "name": "Gaurab Dasgupta"}}, "url": "https://github.com/checkstyle/checkstyle/commit/d4f10bc84c3e75fb793d110fe4e97ed84de45032", "committedDate": "2020-04-25T16:42:13Z", "message": "Issue #6216: sync content of cli tool in xdoc and cli tool help output"}, "afterCommit": {"oid": "7d3a01d617f36d6b4da330ddf4a1767661fe10a1", "author": {"user": {"login": "gaurabdg", "name": "Gaurab Dasgupta"}}, "url": "https://github.com/checkstyle/checkstyle/commit/7d3a01d617f36d6b4da330ddf4a1767661fe10a1", "committedDate": "2020-04-26T08:13:45Z", "message": "Issue #6216: sync content of cli tool in xdoc and cli tool help output"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAxOTc0MTQw", "url": "https://github.com/checkstyle/checkstyle/pull/8035#pullrequestreview-401974140", "createdAt": "2020-04-28T15:49:02Z", "commit": {"oid": "7d3a01d617f36d6b4da330ddf4a1767661fe10a1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAyNzE2MDAy", "url": "https://github.com/checkstyle/checkstyle/pull/8035#pullrequestreview-402716002", "createdAt": "2020-04-29T14:20:59Z", "commit": {"oid": "7d3a01d617f36d6b4da330ddf4a1767661fe10a1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 663, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}