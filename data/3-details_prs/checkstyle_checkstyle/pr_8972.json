{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE3NDg0MzEz", "number": 8972, "title": "Issue #8873: RequireThis: Incorrectly triggers for record fields in compact constructor", "bodyText": "Fix #8873\nThis PR disables requireThis in COMPACT_CTOR_DEF, since this cannot be used in COMPACT_CTOR_DEF in Java 15 as mentioned here.\nAs mentioned here, not printing error message when ast is in COMPACT_CTOR_DEF solves the problem in #8873\nAlso, 4 violations in testRecordsAsTopLevel() are no longer violations, so I removed them.\nDiff Regression config: https://gist.githubusercontent.com/anhminhtran235/bf0e177285c39256dd7e3217d8dae9e1/raw/55ff82d4be5a21d610e83da86dba7835eea2560d/config.xml\nDiff Regression projects: https://gist.githubusercontent.com/anhminhtran235/2da94f96d35ab9471624c5b6c4421c66/raw/82b014453ca421085199b4635f6a13c26a62941d/projects-to-test-on.properties", "createdAt": "2020-11-09T05:37:10Z", "url": "https://github.com/checkstyle/checkstyle/pull/8972", "merged": true, "mergeCommit": {"oid": "1d856fec84daa24816f312cb360f6b150c674feb"}, "closed": true, "closedAt": "2020-11-22T14:35:15Z", "author": {"login": "anhminhtran235"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdauCt4ABqjM5NzE4OTE5OTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdeyuR7AFqTUzNjAwOTYzNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2de4f66e13ccade3bbf5fa15b1d79f45578991da", "author": {"user": {"login": "anhminhtran235", "name": null}}, "url": "https://github.com/checkstyle/checkstyle/commit/2de4f66e13ccade3bbf5fa15b1d79f45578991da", "committedDate": "2020-11-09T05:28:54Z", "message": "Issue #8873: RequireThis: Incorrectly triggers for record fields in compact constructor"}, "afterCommit": {"oid": "c78340062e05d5605717e5a05bd533c0900b9921", "author": {"user": {"login": "anhminhtran235", "name": null}}, "url": "https://github.com/checkstyle/checkstyle/commit/c78340062e05d5605717e5a05bd533c0900b9921", "committedDate": "2020-11-09T05:37:20Z", "message": "Issue #8873: RequireThis: Incorrectly triggers for record fields in compact constructor"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c78340062e05d5605717e5a05bd533c0900b9921", "author": {"user": {"login": "anhminhtran235", "name": null}}, "url": "https://github.com/checkstyle/checkstyle/commit/c78340062e05d5605717e5a05bd533c0900b9921", "committedDate": "2020-11-09T05:37:20Z", "message": "Issue #8873: RequireThis: Incorrectly triggers for record fields in compact constructor"}, "afterCommit": {"oid": "01d9c9ab0e354c8768632449c6dc692b879c9535", "author": {"user": {"login": "anhminhtran235", "name": null}}, "url": "https://github.com/checkstyle/checkstyle/commit/01d9c9ab0e354c8768632449c6dc692b879c9535", "committedDate": "2020-11-09T05:45:11Z", "message": "Issue #8873: RequireThis: Incorrectly triggers for record fields in compact constructor"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "01d9c9ab0e354c8768632449c6dc692b879c9535", "author": {"user": {"login": "anhminhtran235", "name": null}}, "url": "https://github.com/checkstyle/checkstyle/commit/01d9c9ab0e354c8768632449c6dc692b879c9535", "committedDate": "2020-11-09T05:45:11Z", "message": "Issue #8873: RequireThis: Incorrectly triggers for record fields in compact constructor"}, "afterCommit": {"oid": "1091d0bbf9f9cc6dfce8fcfe36c79cda40631a9f", "author": {"user": {"login": "anhminhtran235", "name": null}}, "url": "https://github.com/checkstyle/checkstyle/commit/1091d0bbf9f9cc6dfce8fcfe36c79cda40631a9f", "committedDate": "2020-11-09T05:47:34Z", "message": "Issue #8873: RequireThis: Incorrectly triggers for record fields in compact constructor"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1091d0bbf9f9cc6dfce8fcfe36c79cda40631a9f", "author": {"user": {"login": "anhminhtran235", "name": null}}, "url": "https://github.com/checkstyle/checkstyle/commit/1091d0bbf9f9cc6dfce8fcfe36c79cda40631a9f", "committedDate": "2020-11-09T05:47:34Z", "message": "Issue #8873: RequireThis: Incorrectly triggers for record fields in compact constructor"}, "afterCommit": {"oid": "ef269fb8e90eea21be8b1940748af33ad8c4f5a8", "author": {"user": {"login": "anhminhtran235", "name": null}}, "url": "https://github.com/checkstyle/checkstyle/commit/ef269fb8e90eea21be8b1940748af33ad8c4f5a8", "committedDate": "2020-11-09T18:50:38Z", "message": "Issue #8873: RequireThis: Incorrectly triggers for record fields in compact constructor"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ef269fb8e90eea21be8b1940748af33ad8c4f5a8", "author": {"user": {"login": "anhminhtran235", "name": null}}, "url": "https://github.com/checkstyle/checkstyle/commit/ef269fb8e90eea21be8b1940748af33ad8c4f5a8", "committedDate": "2020-11-09T18:50:38Z", "message": "Issue #8873: RequireThis: Incorrectly triggers for record fields in compact constructor"}, "afterCommit": {"oid": "0af470a174b09e5549785e7547808c5e88d1bdd4", "author": {"user": {"login": "anhminhtran235", "name": null}}, "url": "https://github.com/checkstyle/checkstyle/commit/0af470a174b09e5549785e7547808c5e88d1bdd4", "committedDate": "2020-11-10T18:33:53Z", "message": "Issue #8873: RequireThis: Incorrectly triggers for record fields in compact constructor"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI4ODIzNTAz", "url": "https://github.com/checkstyle/checkstyle/pull/8972#pullrequestreview-528823503", "createdAt": "2020-11-12T07:55:13Z", "commit": {"oid": "0af470a174b09e5549785e7547808c5e88d1bdd4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQwNzo1NToxM1rOHxuQ9w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQwNzo1NToxM1rOHxuQ9w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTkwMDI3OQ==", "bodyText": "This can be easily replaced with a loop. How deep this recursion can be?", "url": "https://github.com/checkstyle/checkstyle/pull/8972#discussion_r521900279", "createdAt": "2020-11-12T07:55:13Z", "author": {"login": "pbludov"}, "path": "src/main/java/com/puppycrawl/tools/checkstyle/checks/coding/RequireThisCheck.java", "diffHunk": "@@ -510,6 +511,21 @@ private AbstractFrame getFieldWithoutThis(DetailAST ast, int parentType) {\n         return frame;\n     }\n \n+    /**\n+     * Return whether ast is in a COMPACT_CTOR_DEF.\n+     *\n+     * @param ast The token to check\n+     * @return true if ast is in a COMPACT_CTOR_DEF, false otherwise\n+     */\n+    private static boolean isInCompactConstructor(DetailAST ast) {\n+        boolean isInCompactCtor = false;\n+        if (ast.getParent() != null) {\n+            isInCompactCtor = ast.getParent().getType() == TokenTypes.COMPACT_CTOR_DEF\n+                                || isInCompactConstructor(ast.getParent());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0af470a174b09e5549785e7547808c5e88d1bdd4"}, "originalPosition": 24}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0af470a174b09e5549785e7547808c5e88d1bdd4", "author": {"user": {"login": "anhminhtran235", "name": null}}, "url": "https://github.com/checkstyle/checkstyle/commit/0af470a174b09e5549785e7547808c5e88d1bdd4", "committedDate": "2020-11-10T18:33:53Z", "message": "Issue #8873: RequireThis: Incorrectly triggers for record fields in compact constructor"}, "afterCommit": {"oid": "cef905262dc4767010079404278aafe81218832e", "author": {"user": {"login": "anhminhtran235", "name": null}}, "url": "https://github.com/checkstyle/checkstyle/commit/cef905262dc4767010079404278aafe81218832e", "committedDate": "2020-11-12T16:24:18Z", "message": "Issue #8873: RequireThis: Incorrectly triggers for record fields in compact constructor"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwODc2Njg0", "url": "https://github.com/checkstyle/checkstyle/pull/8972#pullrequestreview-530876684", "createdAt": "2020-11-16T02:17:30Z", "commit": {"oid": "cef905262dc4767010079404278aafe81218832e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM1OTcyOTQw", "url": "https://github.com/checkstyle/checkstyle/pull/8972#pullrequestreview-535972940", "createdAt": "2020-11-21T15:16:16Z", "commit": {"oid": "cef905262dc4767010079404278aafe81218832e"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMVQxNToxNjoxNlrOH3vM3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMVQxNToxNjoxNlrOH3vM3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODIwNzA2OQ==", "bodyText": "This variable can be initialized with ast.getParent(), so the loop simplifies to\n DetailAST tempAst = ast.getParent();\n while (tempAst != null) {\n   if (tempAst.getType() == TokenTypes.COMPACT_CTOR_DEF) {\n   ...\nalso, tempAst can be renamed to parent for readability.", "url": "https://github.com/checkstyle/checkstyle/pull/8972#discussion_r528207069", "createdAt": "2020-11-21T15:16:16Z", "author": {"login": "pbludov"}, "path": "src/main/java/com/puppycrawl/tools/checkstyle/checks/coding/RequireThisCheck.java", "diffHunk": "@@ -510,6 +511,25 @@ private AbstractFrame getFieldWithoutThis(DetailAST ast, int parentType) {\n         return frame;\n     }\n \n+    /**\n+     * Return whether ast is in a COMPACT_CTOR_DEF.\n+     *\n+     * @param ast The token to check\n+     * @return true if ast is in a COMPACT_CTOR_DEF, false otherwise\n+     */\n+    private static boolean isInCompactConstructor(DetailAST ast) {\n+        boolean isInCompactCtor = false;\n+        DetailAST tempAst = ast;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cef905262dc4767010079404278aafe81218832e"}, "originalPosition": 22}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cef905262dc4767010079404278aafe81218832e", "author": {"user": {"login": "anhminhtran235", "name": null}}, "url": "https://github.com/checkstyle/checkstyle/commit/cef905262dc4767010079404278aafe81218832e", "committedDate": "2020-11-12T16:24:18Z", "message": "Issue #8873: RequireThis: Incorrectly triggers for record fields in compact constructor"}, "afterCommit": {"oid": "8ec7ca7c611b1424eb2fca2e8ff45e8bbf828b4e", "author": {"user": {"login": "anhminhtran235", "name": null}}, "url": "https://github.com/checkstyle/checkstyle/commit/8ec7ca7c611b1424eb2fca2e8ff45e8bbf828b4e", "committedDate": "2020-11-21T18:38:09Z", "message": "Issue #8873: RequireThis: Incorrectly triggers for record fields in compact constructor"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "455f3bd31e3efa5cef51d0532b3614b0e6d0362e", "author": {"user": {"login": "anhminhtran235", "name": null}}, "url": "https://github.com/checkstyle/checkstyle/commit/455f3bd31e3efa5cef51d0532b3614b0e6d0362e", "committedDate": "2020-11-21T18:42:01Z", "message": "Issue #8873: RequireThis: Incorrectly triggers for record fields in compact constructor"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8ec7ca7c611b1424eb2fca2e8ff45e8bbf828b4e", "author": {"user": {"login": "anhminhtran235", "name": null}}, "url": "https://github.com/checkstyle/checkstyle/commit/8ec7ca7c611b1424eb2fca2e8ff45e8bbf828b4e", "committedDate": "2020-11-21T18:38:09Z", "message": "Issue #8873: RequireThis: Incorrectly triggers for record fields in compact constructor"}, "afterCommit": {"oid": "455f3bd31e3efa5cef51d0532b3614b0e6d0362e", "author": {"user": {"login": "anhminhtran235", "name": null}}, "url": "https://github.com/checkstyle/checkstyle/commit/455f3bd31e3efa5cef51d0532b3614b0e6d0362e", "committedDate": "2020-11-21T18:42:01Z", "message": "Issue #8873: RequireThis: Incorrectly triggers for record fields in compact constructor"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM2MDAyNzY2", "url": "https://github.com/checkstyle/checkstyle/pull/8972#pullrequestreview-536002766", "createdAt": "2020-11-21T19:21:37Z", "commit": {"oid": "455f3bd31e3efa5cef51d0532b3614b0e6d0362e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM2MDA5NDk4", "url": "https://github.com/checkstyle/checkstyle/pull/8972#pullrequestreview-536009498", "createdAt": "2020-11-21T21:17:22Z", "commit": {"oid": "455f3bd31e3efa5cef51d0532b3614b0e6d0362e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMVQyMToxNzoyM1rOH3xcwg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yMVQyMToxNzoyM1rOH3xcwg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODI0MzkwNg==", "bodyText": "@romani @pbludov should we consider creating a javac15 CI run for input files, similar to javac14? \n  \n    \n      checkstyle/.ci/travis/travis.sh\n    \n    \n        Lines 118 to 130\n      in\n      be3dab2\n    \n    \n    \n    \n\n        \n          \n           javac14) \n        \n\n        \n          \n             files=($(grep -Rl --include='*.java' ': Compilable with Java14' \\ \n        \n\n        \n          \n                   src/test/resources-noncompilable || true)) \n        \n\n        \n          \n             if [[  ${#files[@]} -eq 0 ]]; then \n        \n\n        \n          \n               echo \"No Java14 files to process\" \n        \n\n        \n          \n             else \n        \n\n        \n          \n                 mkdir -p target \n        \n\n        \n          \n                 for file in \"${files[@]}\" \n        \n\n        \n          \n                 do \n        \n\n        \n          \n                   javac --release 14 --enable-preview -d target \"${file}\" \n        \n\n        \n          \n                 done \n        \n\n        \n          \n             fi \n        \n\n        \n          \n             ;; \n        \n    \n  \n\n Since the changes in this PR relate to jdk15 syntax, and we already have an open issue for jdk15 specific syntax (#8989), this might be a good idea.", "url": "https://github.com/checkstyle/checkstyle/pull/8972#discussion_r528243906", "createdAt": "2020-11-21T21:17:23Z", "author": {"login": "nmancus1"}, "path": "src/test/resources-noncompilable/com/puppycrawl/tools/checkstyle/checks/coding/requirethis/InputRequireThisRecordCompactCtors.java", "diffHunk": "@@ -0,0 +1,17 @@\n+//non-compiled with javac: Compilable with Java14", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "455f3bd31e3efa5cef51d0532b3614b0e6d0362e"}, "originalPosition": 1}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM2MDA5NjM1", "url": "https://github.com/checkstyle/checkstyle/pull/8972#pullrequestreview-536009635", "createdAt": "2020-11-21T21:20:46Z", "commit": {"oid": "455f3bd31e3efa5cef51d0532b3614b0e6d0362e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1394, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}