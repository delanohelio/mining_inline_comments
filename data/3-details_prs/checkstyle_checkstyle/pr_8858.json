{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk1MDE2NDUw", "number": 8858, "title": "Issue #8856: Local records fail to parse when annotated", "bodyText": "Issue #8856: Local records fail to parse when annotated\nIt is tempting to want to modify the grammar to this:\n|   m:modifiers! ( recordDefinition[#m] | classDefinition[#m] )\n\nBut even using syntactic predicates for both definitions, this causes too many ambiguities and issues.\nWe don't need to do this, though, since modifiers aren't allowed on local records:\n\u279c  src cat MyClass.java                                                                  \npublic class MyClass {\n    public void doThing() {\n        private record localRecord(){}\n    }\n}\n\u279c  src /usr/lib/jvm/java-14-openjdk/bin/javadoc --enable-preview --source 14 MyClass.java\nLoading source file MyClass.java...\nMyClass.java:3: error: illegal start of expression\n        private record localRecord(){}\n        ^\nMyClass.java:5: error: class, interface, enum, or record expected\n}\n^\n2 errors\n\nThis is why I didn't originally include modifiers on local records; but I failed to consider that since we have implemented annotations as part of the modifiers rule, and that this would affect local records.\nAt any rate, instead of creating the empty modifers AST, then attaching possible multiple annotations, then calling the recordDefinition rule and passing the modifiers AST, I simply used the annotations AST we already have (empty or not), and renamed it.\nFancy AST regression report: https://nmancus1.github.io/diff/\nFancy AST regression report: https://nmancus1.github.io/diff_configurate/", "createdAt": "2020-09-29T18:22:02Z", "url": "https://github.com/checkstyle/checkstyle/pull/8858", "merged": true, "mergeCommit": {"oid": "679472ce16a88d5da5589362cb49182deffcfc0a"}, "closed": true, "closedAt": "2020-10-06T13:38:52Z", "author": {"login": "nmancus1"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdNt35bAFqTQ5ODgzNjUwNA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdPYvolgBqjM4MzgxMDk2NDU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4ODM2NTA0", "url": "https://github.com/checkstyle/checkstyle/pull/8858#pullrequestreview-498836504", "createdAt": "2020-09-29T20:03:34Z", "commit": {"oid": "254ea6f907fd1589d145f28dd84237d95dfaafe6"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQyMDowMzozNVrOHZ_IvA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQyMDowMzozNVrOHZ_IvA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzAxMDg3Ng==", "bodyText": "Do we need this two lines?", "url": "https://github.com/checkstyle/checkstyle/pull/8858#discussion_r497010876", "createdAt": "2020-09-29T20:03:35Z", "author": {"login": "pbludov"}, "path": "src/test/resources-noncompilable/com/puppycrawl/tools/checkstyle/grammar/java14/InputJava14LocalRecordAnnotation.java", "diffHunk": "@@ -0,0 +1,27 @@\n+//non-compiled with javac: Compilable with Java14\n+package com.puppycrawl.tools.checkstyle.grammar.java14;\n+\n+class InputJava14LocalRecordAnnotation {\n+\n+    public void doThing() {\n+        // No error unless an annotation is present\n+        @ProblemCauser\n+        record Test(String hello, int world) {}\n+\n+        @ProblemCauser\n+        class TestClass {}\n+\n+        @ProblemCauser @Deprecated\n+        record Test2(String hello, int world) {}\n+\n+        @ProblemCauser @Deprecated\n+        class TestClass2 {}\n+\n+        final var item = new Test(\"hi there\", 22);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "254ea6f907fd1589d145f28dd84237d95dfaafe6"}, "originalPosition": 20}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "254ea6f907fd1589d145f28dd84237d95dfaafe6", "author": {"user": {"login": "nmancus1", "name": "Nick Mancuso"}}, "url": "https://github.com/checkstyle/checkstyle/commit/254ea6f907fd1589d145f28dd84237d95dfaafe6", "committedDate": "2020-09-29T17:48:16Z", "message": "Issue #8856: Local records fail to parse when annotated"}, "afterCommit": {"oid": "ea66e86d1ae31cafd54b518936d6e22531e2a64e", "author": {"user": {"login": "nmancus1", "name": "Nick Mancuso"}}, "url": "https://github.com/checkstyle/checkstyle/commit/ea66e86d1ae31cafd54b518936d6e22531e2a64e", "committedDate": "2020-09-29T20:33:04Z", "message": "Issue #8856: Local records fail to parse when annotated"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5MDk5NTAy", "url": "https://github.com/checkstyle/checkstyle/pull/8858#pullrequestreview-499099502", "createdAt": "2020-09-30T05:46:25Z", "commit": {"oid": "ea66e86d1ae31cafd54b518936d6e22531e2a64e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAxNjMyOTM2", "url": "https://github.com/checkstyle/checkstyle/pull/8858#pullrequestreview-501632936", "createdAt": "2020-10-04T15:17:35Z", "commit": {"oid": "ea66e86d1ae31cafd54b518936d6e22531e2a64e"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNFQxNToxNzozNVrOHcIQSA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNFQxNToxNzozNVrOHcIQSA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTI1NzQxNg==", "bodyText": "please add few test cases with visibility modifers like \"private/public\" to see how they are located in AST under same |--MODIFIERS\n\n  \n    \n      checkstyle/src/test/resources-noncompilable/com/puppycrawl/tools/checkstyle/grammar/java14/InputJava14Records.java\n    \n    \n         Line 39\n      in\n      3b73e34\n    \n    \n    \n    \n\n        \n          \n           public record Polar(double r, double theta) implements Coords {", "url": "https://github.com/checkstyle/checkstyle/pull/8858#discussion_r499257416", "createdAt": "2020-10-04T15:17:35Z", "author": {"login": "romani"}, "path": "src/test/resources-noncompilable/com/puppycrawl/tools/checkstyle/grammar/java14/InputJava14LocalRecordAnnotation.java", "diffHunk": "@@ -0,0 +1,24 @@\n+//non-compiled with javac: Compilable with Java14\n+package com.puppycrawl.tools.checkstyle.grammar.java14;\n+\n+class InputJava14LocalRecordAnnotation {\n+\n+    public void doThing() {\n+        // No error unless an annotation is present\n+        @ProblemCauser\n+        record Test(String hello, int world) {}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ea66e86d1ae31cafd54b518936d6e22531e2a64e"}, "originalPosition": 9}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "73503f6f6ff99257e6ac21f043652846a286c3aa", "author": {"user": {"login": "nmancus1", "name": "Nick Mancuso"}}, "url": "https://github.com/checkstyle/checkstyle/commit/73503f6f6ff99257e6ac21f043652846a286c3aa", "committedDate": "2020-10-05T00:30:33Z", "message": "Issue #8856: Local records fail to parse when annotated"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ea66e86d1ae31cafd54b518936d6e22531e2a64e", "author": {"user": {"login": "nmancus1", "name": "Nick Mancuso"}}, "url": "https://github.com/checkstyle/checkstyle/commit/ea66e86d1ae31cafd54b518936d6e22531e2a64e", "committedDate": "2020-09-29T20:33:04Z", "message": "Issue #8856: Local records fail to parse when annotated"}, "afterCommit": {"oid": "73503f6f6ff99257e6ac21f043652846a286c3aa", "author": {"user": {"login": "nmancus1", "name": "Nick Mancuso"}}, "url": "https://github.com/checkstyle/checkstyle/commit/73503f6f6ff99257e6ac21f043652846a286c3aa", "committedDate": "2020-10-05T00:30:33Z", "message": "Issue #8856: Local records fail to parse when annotated"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1455, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}