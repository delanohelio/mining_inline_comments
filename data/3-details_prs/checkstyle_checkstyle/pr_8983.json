{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIwNDI1Nzc0", "number": 8983, "title": "Issue #5362: Fix new keyword and their children not checked correctly.", "bodyText": "Fixes #5362\nDiff Regression projects: https://raw.githubusercontent.com/checkstyle/contribution/master/checkstyle-tester/projects-to-test-on.properties\nDiff Regression config: https://gist.githubusercontent.com/Abhishek-kumar09/0745ecf11934e0214b9187f9d4896e4a/raw/7e9f169832e45c826fb99e72b3ff08f32765243a/my_check.xml", "createdAt": "2020-11-13T08:13:22Z", "url": "https://github.com/checkstyle/checkstyle/pull/8983", "merged": true, "mergeCommit": {"oid": "432bafd49ed9d801f44a04ad710cc9372538e588"}, "closed": true, "closedAt": "2020-11-19T08:00:36Z", "author": {"login": "Abhishek-kumar09"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdcCucLgFqTUyOTg1NjAxOA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABddveM_ABqjQwMTExMjQ0MDI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI5ODU2MDE4", "url": "https://github.com/checkstyle/checkstyle/pull/8983#pullrequestreview-529856018", "createdAt": "2020-11-13T08:17:38Z", "commit": {"oid": "94c019fbcd5e5000d502d821f7e5bd77017b36bb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QwODoxNzozOVrOHyj58A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QwODoxNzozOVrOHyj58A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjc3OTEyMA==", "bodyText": "Had to change the pre-written file because it is more than 100 chars per lines due to addition of \"warn\" comment.", "url": "https://github.com/checkstyle/checkstyle/pull/8983#discussion_r522779120", "createdAt": "2020-11-13T08:17:39Z", "author": {"login": "Abhishek-kumar09"}, "path": "src/test/resources/com/puppycrawl/tools/checkstyle/checks/indentation/indentation/InputIndentationCorrectIfAndParameter.java", "diffHunk": "@@ -114,14 +116,15 @@ void fooMethodWithIf(String stringStringStringStringLooooongString, //indent:6 e\n         if (conditionSecond(10000000000.0, new //indent:8 exp:8\n             SecondClassLongNam7(\"Looooooooooooo\" //indent:12 exp:12\n             + \"oooooong\").getString(new InputIndentationCorrectIfAndParameter(), //indent:12 exp:12\n-            new SecondClassLongNam7(\"loooooooooong\"). //indent:12 exp:12\n+            new SecondClassLongNam7(\"loooooooooong\"). //indent:12 exp:14,16 warn\n             getInteger(new InputIndentationCorrectIfAndParameter(), \"lg\")), \"l\") //indent:12 exp:12\n             || conditionThird(2048) || conditionFourth(new //indent:12 exp:12\n             SecondClassLongNam7(\"Looooooooooooooo\" //indent:12 exp:12\n               + \"o\").gB(new InputIndentationCorrectIfAndParameter(), false))|| //indent:14 exp:>=12\n               conditionFifth(true, new SecondClassLongNam7(getString(2048, \"L\" //indent:14 exp:>=12\n               + \"ooooooooooooooooooooooooooooooooooooooooooong\")).gB( //indent:14 exp:>=12\n-              new InputIndentationCorrectIfAndParameter(),true))||co(false,new //indent:14 exp:>=12\n+              new InputIndentationCorrectIfAndParameter(),true))//indent:14 exp:16,18 warn\n+                || co(false, new //indent:16 exp:16", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "94c019fbcd5e5000d502d821f7e5bd77017b36bb"}, "originalPosition": 50}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwODMxODUy", "url": "https://github.com/checkstyle/checkstyle/pull/8983#pullrequestreview-530831852", "createdAt": "2020-11-15T20:23:49Z", "commit": {"oid": "94c019fbcd5e5000d502d821f7e5bd77017b36bb"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNVQyMDoyMzo1MFrOHzivxA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNVQyMDoyMzo1MFrOHzivxA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzgwODcwOA==", "bodyText": "Please add in name of class \"correct\", it is very valuable to keep such inputs.\nAs indentation is part of Google style please add  case from issue to Input of ITs, issue was reported by Google team, so we need to prove that it is ok  for Google style also.\nhttps://github.com/checkstyle/checkstyle/tree/master/src/it/resources/com/google/checkstyle/test/chapter4formatting/rule4841indentation", "url": "https://github.com/checkstyle/checkstyle/pull/8983#discussion_r523808708", "createdAt": "2020-11-15T20:23:50Z", "author": {"login": "romani"}, "path": "src/test/resources/com/puppycrawl/tools/checkstyle/checks/indentation/indentation/InputIndentationNewChildren.java", "diffHunk": "@@ -0,0 +1,39 @@\n+/* Config:                                                                    //indent:0 exp:0\n+ * This test-input is intended to be checked using following configuration:   //indent:1 exp:1\n+ *                                                                            //indent:1 exp:1\n+ * arrayInitIndent = 4                                                        //indent:1 exp:1\n+ * basicOffset = 4                                                            //indent:1 exp:1\n+ * braceAdjustment = 0                                                        //indent:1 exp:1\n+ * caseIndent = 4                                                             //indent:1 exp:1\n+ * forceStrictCondition = false                                               //indent:1 exp:1\n+ * lineWrappingIndentation = 8                                                //indent:1 exp:1\n+ * tabWidth = 4                                                               //indent:1 exp:1\n+ * throwsIndent = 8                                                           //indent:1 exp:1\n+ *                                                                            //indent:1 exp:1\n+ */                                                                           //indent:1 exp:1\n+\n+package com.puppycrawl.tools.checkstyle.checks.indentation.indentation; //indent:0 exp:0\n+\n+public class InputIndentationNewChildren { //indent:0 exp:0", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "94c019fbcd5e5000d502d821f7e5bd77017b36bb"}, "originalPosition": 17}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "94c019fbcd5e5000d502d821f7e5bd77017b36bb", "author": {"user": {"login": "Abhishek-kumar09", "name": "Abhishek Kumar"}}, "url": "https://github.com/checkstyle/checkstyle/commit/94c019fbcd5e5000d502d821f7e5bd77017b36bb", "committedDate": "2020-11-13T08:09:13Z", "message": "Issue #5362: Fix new keyword not checked and being raising wrong children indentation levels"}, "afterCommit": {"oid": "d6f47d3f340c60daa56e007b6ec2e84f17f6c30f", "author": {"user": {"login": "Abhishek-kumar09", "name": "Abhishek Kumar"}}, "url": "https://github.com/checkstyle/checkstyle/commit/d6f47d3f340c60daa56e007b6ec2e84f17f6c30f", "committedDate": "2020-11-16T10:43:12Z", "message": "Issue #5362: Fix new keyword not checked and being raising wrong children indentation levels"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMyNDM0ODQx", "url": "https://github.com/checkstyle/checkstyle/pull/8983#pullrequestreview-532434841", "createdAt": "2020-11-17T14:45:33Z", "commit": {"oid": "d6f47d3f340c60daa56e007b6ec2e84f17f6c30f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMyNDYxMzcz", "url": "https://github.com/checkstyle/checkstyle/pull/8983#pullrequestreview-532461373", "createdAt": "2020-11-17T15:09:10Z", "commit": {"oid": "d6f47d3f340c60daa56e007b6ec2e84f17f6c30f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNTowOToxMVrOH05dAA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNToyMDo0NVrOH06DDw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTIyOTMxMg==", "bodyText": "final DetailAST mainAst = getMainAst();\nfinal DetailAST firstChild = mainAst.getFirstChild();", "url": "https://github.com/checkstyle/checkstyle/pull/8983#discussion_r525229312", "createdAt": "2020-11-17T15:09:11Z", "author": {"login": "strkkk"}, "path": "src/main/java/com/puppycrawl/tools/checkstyle/checks/indentation/NewHandler.java", "diffHunk": "@@ -43,26 +48,57 @@ public NewHandler(IndentationCheck indentCheck,\n \n     @Override\n     public void checkIndentation() {\n-        final DetailAST type = getMainAst().getFirstChild();\n-        if (type != null) {\n-            checkExpressionSubtree(type, getIndent(), false, false);\n+        final DetailAST firstChild = getMainAst().getFirstChild();\n+        final DetailAST mainAst = getMainAst();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d6f47d3f340c60daa56e007b6ec2e84f17f6c30f"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTIyOTk2NA==", "bodyText": "getMainAst() you have this variable in scope, no need for method call", "url": "https://github.com/checkstyle/checkstyle/pull/8983#discussion_r525229964", "createdAt": "2020-11-17T15:09:54Z", "author": {"login": "strkkk"}, "path": "src/main/java/com/puppycrawl/tools/checkstyle/checks/indentation/NewHandler.java", "diffHunk": "@@ -43,26 +48,57 @@ public NewHandler(IndentationCheck indentCheck,\n \n     @Override\n     public void checkIndentation() {\n-        final DetailAST type = getMainAst().getFirstChild();\n-        if (type != null) {\n-            checkExpressionSubtree(type, getIndent(), false, false);\n+        final DetailAST firstChild = getMainAst().getFirstChild();\n+        final DetailAST mainAst = getMainAst();\n+\n+        // if new is on the line start and it is not the part of assignment.\n+        if (isOnStartOfLine(mainAst)\n+                && !getMainAst().getParent().getParent().getText().equals(ASSIGNMENT)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d6f47d3f340c60daa56e007b6ec2e84f17f6c30f"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTIzMTM5NA==", "bodyText": "getMainAst()\nI counted 4 invocations of this method, please extract to variable", "url": "https://github.com/checkstyle/checkstyle/pull/8983#discussion_r525231394", "createdAt": "2020-11-17T15:11:17Z", "author": {"login": "strkkk"}, "path": "src/main/java/com/puppycrawl/tools/checkstyle/checks/indentation/NewHandler.java", "diffHunk": "@@ -43,26 +48,57 @@ public NewHandler(IndentationCheck indentCheck,\n \n     @Override\n     public void checkIndentation() {\n-        final DetailAST type = getMainAst().getFirstChild();\n-        if (type != null) {\n-            checkExpressionSubtree(type, getIndent(), false, false);\n+        final DetailAST firstChild = getMainAst().getFirstChild();\n+        final DetailAST mainAst = getMainAst();\n+\n+        // if new is on the line start and it is not the part of assignment.\n+        if (isOnStartOfLine(mainAst)\n+                && !getMainAst().getParent().getParent().getText().equals(ASSIGNMENT)) {\n+            final int columnNo = expandedTabsColumnNo(mainAst);\n+            final IndentLevel level = getIndentImpl();\n+\n+            if (columnNo < level.getFirstIndentLevel()) {\n+                logError(mainAst, \"\", columnNo, level);\n+            }\n+        }\n+\n+        if (firstChild != null) {\n+            checkExpressionSubtree(firstChild, getIndent(), false, false);\n         }\n \n-        final DetailAST lparen = getMainAst().findFirstToken(TokenTypes.LPAREN);\n+        final DetailAST lparen = mainAst.findFirstToken(TokenTypes.LPAREN);\n         checkLeftParen(lparen);\n     }\n \n+    @Override\n+    public IndentLevel getSuggestedChildIndent(AbstractExpressionHandler child) {\n+        final IndentLevel childIndent;\n+        if (child.getMainAst().getType() == TokenTypes.OBJBLOCK) {\n+            childIndent = new IndentLevel(getIndent(), getBasicOffset());\n+        }\n+        else {\n+            childIndent = new IndentLevel(getIndent(),\n+                    getIndentCheck().getLineWrappingIndentation());\n+        }\n+        return childIndent;\n+    }\n+\n     @Override\n     protected IndentLevel getIndentImpl() {\n-        final IndentLevel result;\n+        IndentLevel result;\n         // if our expression isn't first on the line, just use the start\n         // of the line\n         if (getLineStart(getMainAst()) == getMainAst().getColumnNo()) {\n             result = super.getIndentImpl();\n+\n+            if (getMainAst().getParent().getParent().getText().equals(ASSIGNMENT)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d6f47d3f340c60daa56e007b6ec2e84f17f6c30f"}, "originalPosition": 64}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTIzNDQwMw==", "bodyText": "As for me, it will look a bit better with something like\nfinal int offset;\nif (child.getMainAst().getType() == TokenTypes.OBJBLOCK) {\n            offset= getBasicOffset();\n        }\n        else {\n            offset= getIndentCheck().getLineWrappingIndentation());\n        }\nreturn new IndentLevel(getIndent(), offset);", "url": "https://github.com/checkstyle/checkstyle/pull/8983#discussion_r525234403", "createdAt": "2020-11-17T15:15:04Z", "author": {"login": "strkkk"}, "path": "src/main/java/com/puppycrawl/tools/checkstyle/checks/indentation/NewHandler.java", "diffHunk": "@@ -43,26 +48,57 @@ public NewHandler(IndentationCheck indentCheck,\n \n     @Override\n     public void checkIndentation() {\n-        final DetailAST type = getMainAst().getFirstChild();\n-        if (type != null) {\n-            checkExpressionSubtree(type, getIndent(), false, false);\n+        final DetailAST firstChild = getMainAst().getFirstChild();\n+        final DetailAST mainAst = getMainAst();\n+\n+        // if new is on the line start and it is not the part of assignment.\n+        if (isOnStartOfLine(mainAst)\n+                && !getMainAst().getParent().getParent().getText().equals(ASSIGNMENT)) {\n+            final int columnNo = expandedTabsColumnNo(mainAst);\n+            final IndentLevel level = getIndentImpl();\n+\n+            if (columnNo < level.getFirstIndentLevel()) {\n+                logError(mainAst, \"\", columnNo, level);\n+            }\n+        }\n+\n+        if (firstChild != null) {\n+            checkExpressionSubtree(firstChild, getIndent(), false, false);\n         }\n \n-        final DetailAST lparen = getMainAst().findFirstToken(TokenTypes.LPAREN);\n+        final DetailAST lparen = mainAst.findFirstToken(TokenTypes.LPAREN);\n         checkLeftParen(lparen);\n     }\n \n+    @Override\n+    public IndentLevel getSuggestedChildIndent(AbstractExpressionHandler child) {\n+        final IndentLevel childIndent;\n+        if (child.getMainAst().getType() == TokenTypes.OBJBLOCK) {\n+            childIndent = new IndentLevel(getIndent(), getBasicOffset());\n+        }\n+        else {\n+            childIndent = new IndentLevel(getIndent(),\n+                    getIndentCheck().getLineWrappingIndentation());\n+        }\n+        return childIndent;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d6f47d3f340c60daa56e007b6ec2e84f17f6c30f"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTIzNTc3Mg==", "bodyText": "Also, you can move initialization of firstChild lower, closer to its first usage", "url": "https://github.com/checkstyle/checkstyle/pull/8983#discussion_r525235772", "createdAt": "2020-11-17T15:16:49Z", "author": {"login": "strkkk"}, "path": "src/main/java/com/puppycrawl/tools/checkstyle/checks/indentation/NewHandler.java", "diffHunk": "@@ -43,26 +48,57 @@ public NewHandler(IndentationCheck indentCheck,\n \n     @Override\n     public void checkIndentation() {\n-        final DetailAST type = getMainAst().getFirstChild();\n-        if (type != null) {\n-            checkExpressionSubtree(type, getIndent(), false, false);\n+        final DetailAST firstChild = getMainAst().getFirstChild();\n+        final DetailAST mainAst = getMainAst();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTIyOTMxMg=="}, "originalCommit": {"oid": "d6f47d3f340c60daa56e007b6ec2e84f17f6c30f"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTIzOTA1NQ==", "bodyText": "getParent().getParent().getText().equals(ASSIGNMENT)\nwhy dont check its type? Like getMainAst().getParent().getParent().getType() == TokenTypes.ASSIGN?", "url": "https://github.com/checkstyle/checkstyle/pull/8983#discussion_r525239055", "createdAt": "2020-11-17T15:20:45Z", "author": {"login": "strkkk"}, "path": "src/main/java/com/puppycrawl/tools/checkstyle/checks/indentation/NewHandler.java", "diffHunk": "@@ -43,26 +48,57 @@ public NewHandler(IndentationCheck indentCheck,\n \n     @Override\n     public void checkIndentation() {\n-        final DetailAST type = getMainAst().getFirstChild();\n-        if (type != null) {\n-            checkExpressionSubtree(type, getIndent(), false, false);\n+        final DetailAST firstChild = getMainAst().getFirstChild();\n+        final DetailAST mainAst = getMainAst();\n+\n+        // if new is on the line start and it is not the part of assignment.\n+        if (isOnStartOfLine(mainAst)\n+                && !getMainAst().getParent().getParent().getText().equals(ASSIGNMENT)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d6f47d3f340c60daa56e007b6ec2e84f17f6c30f"}, "originalPosition": 24}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d6f47d3f340c60daa56e007b6ec2e84f17f6c30f", "author": {"user": {"login": "Abhishek-kumar09", "name": "Abhishek Kumar"}}, "url": "https://github.com/checkstyle/checkstyle/commit/d6f47d3f340c60daa56e007b6ec2e84f17f6c30f", "committedDate": "2020-11-16T10:43:12Z", "message": "Issue #5362: Fix new keyword not checked and being raising wrong children indentation levels"}, "afterCommit": {"oid": "e621c2614f692022caf4de901af7882dac937dee", "author": {"user": {"login": "Abhishek-kumar09", "name": "Abhishek Kumar"}}, "url": "https://github.com/checkstyle/checkstyle/commit/e621c2614f692022caf4de901af7882dac937dee", "committedDate": "2020-11-17T18:11:43Z", "message": "Issue #5362: Fix new keyword not checked and being raising wrong children indentation levels"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMyNzY5MTI5", "url": "https://github.com/checkstyle/checkstyle/pull/8983#pullrequestreview-532769129", "createdAt": "2020-11-17T20:08:04Z", "commit": {"oid": "e621c2614f692022caf4de901af7882dac937dee"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QyMDowODowNFrOH1IcGw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QyMDowODowNFrOH1IcGw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTQ3NDg0Mw==", "bodyText": "javadoc", "url": "https://github.com/checkstyle/checkstyle/pull/8983#discussion_r525474843", "createdAt": "2020-11-17T20:08:04Z", "author": {"login": "strkkk"}, "path": "src/main/java/com/puppycrawl/tools/checkstyle/checks/indentation/NewHandler.java", "diffHunk": "@@ -39,33 +42,75 @@ public NewHandler(IndentationCheck indentCheck,\n                       DetailAST ast,\n                       AbstractExpressionHandler parent) {\n         super(indentCheck, \"operator new\", ast, parent);\n+        mainAst = ast;\n     }\n \n     @Override\n     public void checkIndentation() {\n-        final DetailAST type = getMainAst().getFirstChild();\n-        if (type != null) {\n-            checkExpressionSubtree(type, getIndent(), false, false);\n+        // if new is on the line start and it is not the part of assignment.\n+        if (isOnStartOfLine(mainAst)\n+                && !isNewKeywordFollowedByAssign()) {\n+            final int columnNo = expandedTabsColumnNo(mainAst);\n+            final IndentLevel level = getIndentImpl();\n+\n+            if (columnNo < level.getFirstIndentLevel()) {\n+                logError(mainAst, \"\", columnNo, level);\n+            }\n         }\n \n-        final DetailAST lparen = getMainAst().findFirstToken(TokenTypes.LPAREN);\n+        final DetailAST firstChild = mainAst.getFirstChild();\n+        if (firstChild != null) {\n+            checkExpressionSubtree(firstChild, getIndent(), false, false);\n+        }\n+\n+        final DetailAST lparen = mainAst.findFirstToken(TokenTypes.LPAREN);\n         checkLeftParen(lparen);\n     }\n \n+    @Override\n+    public IndentLevel getSuggestedChildIndent(AbstractExpressionHandler child) {\n+        final int offset;\n+        if (child.getMainAst().getType() == TokenTypes.OBJBLOCK) {\n+            offset = getBasicOffset();\n+        }\n+        else {\n+            offset = getLineWrappingIndent();\n+        }\n+        return new IndentLevel(getIndent(), offset);\n+    }\n+\n     @Override\n     protected IndentLevel getIndentImpl() {\n-        final IndentLevel result;\n+        IndentLevel result;\n         // if our expression isn't first on the line, just use the start\n         // of the line\n-        if (getLineStart(getMainAst()) == getMainAst().getColumnNo()) {\n+        if (getLineStart(mainAst) == mainAst.getColumnNo()) {\n             result = super.getIndentImpl();\n+\n+            if (isNewKeywordFollowedByAssign()) {\n+                result = new IndentLevel(result, getLineWrappingIndent());\n+            }\n         }\n         else {\n-            result = new IndentLevel(getLineStart(getMainAst()));\n+            result = new IndentLevel(getLineStart(mainAst));\n         }\n+\n         return result;\n     }\n \n+    /**\n+     * Is NewKeyword is placed after an Assignment.\n+     *\n+     * @return is new keyWord is follwed by Assignment.\n+     */\n+    private boolean isNewKeywordFollowedByAssign() {\n+        return mainAst.getParent().getParent().getType() == TokenTypes.ASSIGN;\n+    }\n+\n+    private int getLineWrappingIndent() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e621c2614f692022caf4de901af7882dac937dee"}, "originalPosition": 86}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e621c2614f692022caf4de901af7882dac937dee", "author": {"user": {"login": "Abhishek-kumar09", "name": "Abhishek Kumar"}}, "url": "https://github.com/checkstyle/checkstyle/commit/e621c2614f692022caf4de901af7882dac937dee", "committedDate": "2020-11-17T18:11:43Z", "message": "Issue #5362: Fix new keyword not checked and being raising wrong children indentation levels"}, "afterCommit": {"oid": "841bb5bcfb1421e4eed8790c1ff813f547c2554c", "author": {"user": {"login": "Abhishek-kumar09", "name": "Abhishek Kumar"}}, "url": "https://github.com/checkstyle/checkstyle/commit/841bb5bcfb1421e4eed8790c1ff813f547c2554c", "committedDate": "2020-11-17T21:29:39Z", "message": "Issue #5362: Fix new keyword not checked and being raising wrong children indentation levels"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMzMTQ5OTI5", "url": "https://github.com/checkstyle/checkstyle/pull/8983#pullrequestreview-533149929", "createdAt": "2020-11-18T07:00:52Z", "commit": {"oid": "841bb5bcfb1421e4eed8790c1ff813f547c2554c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMzNDc2NjUz", "url": "https://github.com/checkstyle/checkstyle/pull/8983#pullrequestreview-533476653", "createdAt": "2020-11-18T14:04:45Z", "commit": {"oid": "841bb5bcfb1421e4eed8790c1ff813f547c2554c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQxNDowNDo0NVrOH1vS1w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQxNDoxMzozNFrOH1vrnQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjExMTQ0Nw==", "bodyText": "This is a good candidate for TokenUtil.isOfType().", "url": "https://github.com/checkstyle/checkstyle/pull/8983#discussion_r526111447", "createdAt": "2020-11-18T14:04:45Z", "author": {"login": "nmancus1"}, "path": "src/main/java/com/puppycrawl/tools/checkstyle/checks/indentation/NewHandler.java", "diffHunk": "@@ -39,33 +42,81 @@ public NewHandler(IndentationCheck indentCheck,\n                       DetailAST ast,\n                       AbstractExpressionHandler parent) {\n         super(indentCheck, \"operator new\", ast, parent);\n+        mainAst = ast;\n     }\n \n     @Override\n     public void checkIndentation() {\n-        final DetailAST type = getMainAst().getFirstChild();\n-        if (type != null) {\n-            checkExpressionSubtree(type, getIndent(), false, false);\n+        // if new is on the line start and it is not the part of assignment.\n+        if (isOnStartOfLine(mainAst)\n+                && !isNewKeywordFollowedByAssign()) {\n+            final int columnNo = expandedTabsColumnNo(mainAst);\n+            final IndentLevel level = getIndentImpl();\n+\n+            if (columnNo < level.getFirstIndentLevel()) {\n+                logError(mainAst, \"\", columnNo, level);\n+            }\n+        }\n+\n+        final DetailAST firstChild = mainAst.getFirstChild();\n+        if (firstChild != null) {\n+            checkExpressionSubtree(firstChild, getIndent(), false, false);\n         }\n \n-        final DetailAST lparen = getMainAst().findFirstToken(TokenTypes.LPAREN);\n+        final DetailAST lparen = mainAst.findFirstToken(TokenTypes.LPAREN);\n         checkLeftParen(lparen);\n     }\n \n+    @Override\n+    public IndentLevel getSuggestedChildIndent(AbstractExpressionHandler child) {\n+        final int offset;\n+        if (child.getMainAst().getType() == TokenTypes.OBJBLOCK) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "841bb5bcfb1421e4eed8790c1ff813f547c2554c"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjExNzc4OQ==", "bodyText": "Is NewKeyword is placed after an Assignment.\nThis is a bit confusing.  Maybe Checks if the 'new' keyword is followed by an assignment?\n@return is new keyWord is follwed by Assignment. -> @return true if new keyword is followed by assignment", "url": "https://github.com/checkstyle/checkstyle/pull/8983#discussion_r526117789", "createdAt": "2020-11-18T14:13:34Z", "author": {"login": "nmancus1"}, "path": "src/main/java/com/puppycrawl/tools/checkstyle/checks/indentation/NewHandler.java", "diffHunk": "@@ -39,33 +42,81 @@ public NewHandler(IndentationCheck indentCheck,\n                       DetailAST ast,\n                       AbstractExpressionHandler parent) {\n         super(indentCheck, \"operator new\", ast, parent);\n+        mainAst = ast;\n     }\n \n     @Override\n     public void checkIndentation() {\n-        final DetailAST type = getMainAst().getFirstChild();\n-        if (type != null) {\n-            checkExpressionSubtree(type, getIndent(), false, false);\n+        // if new is on the line start and it is not the part of assignment.\n+        if (isOnStartOfLine(mainAst)\n+                && !isNewKeywordFollowedByAssign()) {\n+            final int columnNo = expandedTabsColumnNo(mainAst);\n+            final IndentLevel level = getIndentImpl();\n+\n+            if (columnNo < level.getFirstIndentLevel()) {\n+                logError(mainAst, \"\", columnNo, level);\n+            }\n+        }\n+\n+        final DetailAST firstChild = mainAst.getFirstChild();\n+        if (firstChild != null) {\n+            checkExpressionSubtree(firstChild, getIndent(), false, false);\n         }\n \n-        final DetailAST lparen = getMainAst().findFirstToken(TokenTypes.LPAREN);\n+        final DetailAST lparen = mainAst.findFirstToken(TokenTypes.LPAREN);\n         checkLeftParen(lparen);\n     }\n \n+    @Override\n+    public IndentLevel getSuggestedChildIndent(AbstractExpressionHandler child) {\n+        final int offset;\n+        if (child.getMainAst().getType() == TokenTypes.OBJBLOCK) {\n+            offset = getBasicOffset();\n+        }\n+        else {\n+            offset = getLineWrappingIndent();\n+        }\n+        return new IndentLevel(getIndent(), offset);\n+    }\n+\n     @Override\n     protected IndentLevel getIndentImpl() {\n-        final IndentLevel result;\n+        IndentLevel result;\n         // if our expression isn't first on the line, just use the start\n         // of the line\n-        if (getLineStart(getMainAst()) == getMainAst().getColumnNo()) {\n+        if (getLineStart(mainAst) == mainAst.getColumnNo()) {\n             result = super.getIndentImpl();\n+\n+            if (isNewKeywordFollowedByAssign()) {\n+                result = new IndentLevel(result, getLineWrappingIndent());\n+            }\n         }\n         else {\n-            result = new IndentLevel(getLineStart(getMainAst()));\n+            result = new IndentLevel(getLineStart(mainAst));\n         }\n+\n         return result;\n     }\n \n+    /**\n+     * Is NewKeyword is placed after an Assignment.\n+     *\n+     * @return is new keyWord is follwed by Assignment.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "841bb5bcfb1421e4eed8790c1ff813f547c2554c"}, "originalPosition": 80}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "823e5872899f5d4bc4a7a07ce8e4d22670556793", "author": {"user": {"login": "Abhishek-kumar09", "name": "Abhishek Kumar"}}, "url": "https://github.com/checkstyle/checkstyle/commit/823e5872899f5d4bc4a7a07ce8e4d22670556793", "committedDate": "2020-11-18T14:59:10Z", "message": "Issue #5362: Fix new keyword not checked and being raising wrong children indentation levels"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "841bb5bcfb1421e4eed8790c1ff813f547c2554c", "author": {"user": {"login": "Abhishek-kumar09", "name": "Abhishek Kumar"}}, "url": "https://github.com/checkstyle/checkstyle/commit/841bb5bcfb1421e4eed8790c1ff813f547c2554c", "committedDate": "2020-11-17T21:29:39Z", "message": "Issue #5362: Fix new keyword not checked and being raising wrong children indentation levels"}, "afterCommit": {"oid": "823e5872899f5d4bc4a7a07ce8e4d22670556793", "author": {"user": {"login": "Abhishek-kumar09", "name": "Abhishek Kumar"}}, "url": "https://github.com/checkstyle/checkstyle/commit/823e5872899f5d4bc4a7a07ce8e4d22670556793", "committedDate": "2020-11-18T14:59:10Z", "message": "Issue #5362: Fix new keyword not checked and being raising wrong children indentation levels"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1397, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}