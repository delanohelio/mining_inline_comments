{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg1MTEyMTgy", "number": 7790, "title": "Issue #7754: Update AbstractChecks to log DetailAST - OneTopLevelClass", "bodyText": "Resolve #7754: Update AbstractChecks to log DetailAST - OneTopLevelClass\nDiff report: https://wltan.github.io/checkstyle-reports/2020-03-08/onetoplevel/diff/\nThere is only one log call to fix: https://github.com/checkstyle/checkstyle/blob/master/src/main/java/com/puppycrawl/tools/checkstyle/checks/design/OneTopLevelClassCheck.java#L153\nNotes:\n\nI wasn't able to upload all of the \"deeper\" files due to the max file path length (on Windows). But I think all of the essential information should be there.\nAll of the discrepancies seem to be about the extra column number, which is expected as we now log the DetailAST node instead of just the line number.\nOur unit tests only cover violations at column 1, but other projects can have violations at other columns as well (e.g. apache-ant has a violation at column 2 instead as there is a whitespace in front of the declaration for whatever reason). I think we should update our tests to reflect this?", "createdAt": "2020-03-07T06:39:32Z", "url": "https://github.com/checkstyle/checkstyle/pull/7790", "merged": true, "mergeCommit": {"oid": "e73ec41c667a6aa5bf3213be9fb0a853d372a1c6"}, "closed": true, "closedAt": "2020-03-11T05:58:54Z", "author": {"login": "wltan"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcLUMmngBqjMxMDc2OTMzODI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcMV-SigBqjMxMTU3MjY4NTg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "00b9fa6ae1ea9350b30d9b5a08790501555344bc", "author": {"user": {"login": "wltan", "name": "Tan Wei Liang"}}, "url": "https://github.com/checkstyle/checkstyle/commit/00b9fa6ae1ea9350b30d9b5a08790501555344bc", "committedDate": "2020-03-06T15:33:46Z", "message": "Issue #7754: Update AbstractChecks to log DetailAST - OneTopLevelClass"}, "afterCommit": {"oid": "3a07e276750ba1d83fa95c6ef63e7348ee305099", "author": {"user": {"login": "wltan", "name": "Tan Wei Liang"}}, "url": "https://github.com/checkstyle/checkstyle/commit/3a07e276750ba1d83fa95c6ef63e7348ee305099", "committedDate": "2020-03-07T12:50:37Z", "message": "Issue #7754: Update AbstractChecks to log DetailAST - OneTopLevelClass"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwODEyOTUx", "url": "https://github.com/checkstyle/checkstyle/pull/7790#pullrequestreview-370812951", "createdAt": "2020-03-08T08:28:15Z", "commit": {"oid": "3a07e276750ba1d83fa95c6ef63e7348ee305099"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOFQwODoyODoxNVrOFzT3yg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOFQwODoyODoxNVrOFzT3yg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTM0NzI3NA==", "bodyText": "I doubt it should be like this. In very rare case, e.g.\nenum A {}; enum B{} no violation will be reported.\nPlease change it.", "url": "https://github.com/checkstyle/checkstyle/pull/7790#discussion_r389347274", "createdAt": "2020-03-08T08:28:15Z", "author": {"login": "strkkk"}, "path": "src/main/java/com/puppycrawl/tools/checkstyle/checks/design/OneTopLevelClassCheck.java", "diffHunk": "@@ -98,8 +99,9 @@\n      */\n     private boolean publicTypeFound;\n \n-    /** Mapping between type names and line numbers of the type declarations.*/\n-    private final SortedMap<Integer, String> lineNumberTypeMap = new TreeMap<>();\n+    /** Mapping between type names and DetailAST nodes of the type declarations.*/\n+    private final SortedMap<DetailAST, String> lineNumberTypeMap =\n+            new TreeMap<>(Comparator.comparingInt(DetailAST::getLineNo));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3a07e276750ba1d83fa95c6ef63e7348ee305099"}, "originalPosition": 16}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3a07e276750ba1d83fa95c6ef63e7348ee305099", "author": {"user": {"login": "wltan", "name": "Tan Wei Liang"}}, "url": "https://github.com/checkstyle/checkstyle/commit/3a07e276750ba1d83fa95c6ef63e7348ee305099", "committedDate": "2020-03-07T12:50:37Z", "message": "Issue #7754: Update AbstractChecks to log DetailAST - OneTopLevelClass"}, "afterCommit": {"oid": "c1b8f440c6d52f73e7f9fa63c01856de19f35ef5", "author": {"user": {"login": "wltan", "name": "Tan Wei Liang"}}, "url": "https://github.com/checkstyle/checkstyle/commit/c1b8f440c6d52f73e7f9fa63c01856de19f35ef5", "committedDate": "2020-03-08T10:23:11Z", "message": "Issue #7754: Update AbstractChecks to log DetailAST - OneTopLevelClass"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwODQ5MDkw", "url": "https://github.com/checkstyle/checkstyle/pull/7790#pullrequestreview-370849090", "createdAt": "2020-03-08T18:28:06Z", "commit": {"oid": "c1b8f440c6d52f73e7f9fa63c01856de19f35ef5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwODc3MzQ0", "url": "https://github.com/checkstyle/checkstyle/pull/7790#pullrequestreview-370877344", "createdAt": "2020-03-09T01:17:36Z", "commit": {"oid": "c1b8f440c6d52f73e7f9fa63c01856de19f35ef5"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQwMToxNzozNlrOFzYz_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQwMToxODoyMlrOFzY0Wg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyODIyMg==", "bodyText": "I am lost where the unique ordering is needed. Checkstyle will drop violations for the same line/column/message/check. It also already sorts violations on line/column. Can you explain what I am missing?", "url": "https://github.com/checkstyle/checkstyle/pull/7790#discussion_r389428222", "createdAt": "2020-03-09T01:17:36Z", "author": {"login": "rnveach"}, "path": "src/main/java/com/puppycrawl/tools/checkstyle/checks/design/OneTopLevelClassCheck.java", "diffHunk": "@@ -92,14 +93,19 @@\n      */\n     public static final String MSG_KEY = \"one.top.level.class\";\n \n+    /** Compare DetailAST nodes by line and then column number to make a unique ordering. */\n+    private static final Comparator<DetailAST> LINE_AND_COL_COMPARATOR =\n+            Comparator.comparingInt(DetailAST::getLineNo).thenComparingInt(DetailAST::getColumnNo);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c1b8f440c6d52f73e7f9fa63c01856de19f35ef5"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQyODMxNA==", "bodyText": "Undo unnecessary changes like this. I see others in the same diff.", "url": "https://github.com/checkstyle/checkstyle/pull/7790#discussion_r389428314", "createdAt": "2020-03-09T01:18:22Z", "author": {"login": "rnveach"}, "path": "src/test/java/com/puppycrawl/tools/checkstyle/checks/design/OneTopLevelClassCheckTest.java", "diffHunk": "@@ -132,43 +132,66 @@ public void testFileWithThreeTopLevelEnum() throws Exception {\n         final DefaultConfiguration checkConfig =\n                 createModuleConfig(OneTopLevelClassCheck.class);\n         final String[] expected = {\n-            \"3: \" + getCheckMessage(MSG_KEY, \"InputOneTopLevelClassEnum2inner1\"),\n-            \"11: \" + getCheckMessage(MSG_KEY, \"InputOneTopLevelClassEnum2inner2\"),\n+            \"3:1: \" + getCheckMessage(MSG_KEY, \"InputOneTopLevelClassEnum2inner1\"),\n+            \"11:1: \" + getCheckMessage(MSG_KEY, \"InputOneTopLevelClassEnum2inner2\"),\n         };\n         verify(checkConfig, getPath(\"InputOneTopLevelClassEnum2.java\"), expected);\n     }\n \n     @Test\n     public void testFileWithFewTopLevelClasses() throws Exception {\n         final DefaultConfiguration checkConfig =\n-            createModuleConfig(OneTopLevelClassCheck.class);\n+                createModuleConfig(OneTopLevelClassCheck.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c1b8f440c6d52f73e7f9fa63c01856de19f35ef5"}, "originalPosition": 59}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c1b8f440c6d52f73e7f9fa63c01856de19f35ef5", "author": {"user": {"login": "wltan", "name": "Tan Wei Liang"}}, "url": "https://github.com/checkstyle/checkstyle/commit/c1b8f440c6d52f73e7f9fa63c01856de19f35ef5", "committedDate": "2020-03-08T10:23:11Z", "message": "Issue #7754: Update AbstractChecks to log DetailAST - OneTopLevelClass"}, "afterCommit": {"oid": "c0801c72fa078b5ace7274f7033c9b6bb7394787", "author": {"user": {"login": "wltan", "name": "Tan Wei Liang"}}, "url": "https://github.com/checkstyle/checkstyle/commit/c0801c72fa078b5ace7274f7033c9b6bb7394787", "committedDate": "2020-03-09T02:02:36Z", "message": "Issue #7754: Update AbstractChecks to log DetailAST - OneTopLevelClass"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwODkxOTM2", "url": "https://github.com/checkstyle/checkstyle/pull/7790#pullrequestreview-370891936", "createdAt": "2020-03-09T02:40:26Z", "commit": {"oid": "c0801c72fa078b5ace7274f7033c9b6bb7394787"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1ae7d33e9d7a28738a120db8af23848058ed0246", "author": {"user": {"login": "wltan", "name": "Tan Wei Liang"}}, "url": "https://github.com/checkstyle/checkstyle/commit/1ae7d33e9d7a28738a120db8af23848058ed0246", "committedDate": "2020-03-09T13:14:17Z", "message": "Issue #7614: Update doc for OneTopLevelClass"}, "afterCommit": {"oid": "117346f32b859fc5205e983d50b6e3fdd2bd790d", "author": {"user": {"login": "wltan", "name": "Tan Wei Liang"}}, "url": "https://github.com/checkstyle/checkstyle/commit/117346f32b859fc5205e983d50b6e3fdd2bd790d", "committedDate": "2020-03-09T13:15:43Z", "message": "Issue #7754: Update AbstractChecks to log DetailAST - OneTopLevelClass"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8e98bb4edf222195d53d324576ddf42556972d88", "author": {"user": {"login": "wltan", "name": "Tan Wei Liang"}}, "url": "https://github.com/checkstyle/checkstyle/commit/8e98bb4edf222195d53d324576ddf42556972d88", "committedDate": "2020-03-10T17:28:06Z", "message": "Issue #7754: Update AbstractChecks to log DetailAST - OneTopLevelClass"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "117346f32b859fc5205e983d50b6e3fdd2bd790d", "author": {"user": {"login": "wltan", "name": "Tan Wei Liang"}}, "url": "https://github.com/checkstyle/checkstyle/commit/117346f32b859fc5205e983d50b6e3fdd2bd790d", "committedDate": "2020-03-09T13:15:43Z", "message": "Issue #7754: Update AbstractChecks to log DetailAST - OneTopLevelClass"}, "afterCommit": {"oid": "8e98bb4edf222195d53d324576ddf42556972d88", "author": {"user": {"login": "wltan", "name": "Tan Wei Liang"}}, "url": "https://github.com/checkstyle/checkstyle/commit/8e98bb4edf222195d53d324576ddf42556972d88", "committedDate": "2020-03-10T17:28:06Z", "message": "Issue #7754: Update AbstractChecks to log DetailAST - OneTopLevelClass"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1126, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}