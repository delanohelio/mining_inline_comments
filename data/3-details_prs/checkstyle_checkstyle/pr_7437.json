{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU4ODQyNjI1", "number": 7437, "title": "config: add .ci/bump-license-year-in-all-projects.sh", "bodyText": "based on mess of today in CI with year bump ....\n#7433\n#7434\nfrom https://github.com/checkstyle/checkstyle/wiki/How-to-make-a-release#before-starting\nones merged, wiki should be updated.\nsuch file should be copied to all other repositories (or use some wrapper with wget/curl of such script and execution of it)\nProbably updates like this are not required for review/CI so we cn make script that clone all dependent repositories and make changes in them and push. So some maintainer will launch one script and it will do all required updates.", "createdAt": "2020-01-03T00:57:30Z", "url": "https://github.com/checkstyle/checkstyle/pull/7437", "merged": true, "mergeCommit": {"oid": "51159e3f1219622b9b45e827976912f0dd6c8b25"}, "closed": true, "closedAt": "2020-01-04T00:28:08Z", "author": {"login": "romani"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb2lBsxgFqTMzNzkzMzY1OQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABb227EfAFqTMzODMxNDY2NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM3OTMzNjU5", "url": "https://github.com/checkstyle/checkstyle/pull/7437#pullrequestreview-337933659", "createdAt": "2020-01-03T02:34:28Z", "commit": {"oid": "027a9f372db8b4c2e30305cfe023877e9f31be5e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wM1QwMjozNDoyOFrOFZ5B1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wM1QwMjozNDoyOFrOFZ5B1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjY5MzA3Ng==", "bodyText": "header isn't in src directory.", "url": "https://github.com/checkstyle/checkstyle/pull/7437#discussion_r362693076", "createdAt": "2020-01-03T02:34:28Z", "author": {"login": "rnveach"}, "path": ".ci/bump_license_year.sh", "diffHunk": "@@ -0,0 +1,15 @@\n+#!/usr/bin/env bash\n+\n+set -e\n+\n+CURR_YEAR=$(date +\"%Y\")\n+JAVA_FILE=$(find ./src/main -type f -name *.java -print -quit)\n+echo \"Current year will be taken from $JAVA_FILE\"\n+PREV_YEAR=$(grep \"Copyright\" $JAVA_FILE | cut -d \" \" -f 4 | cut -d '-' -f 2)\n+OLD_PATTERN=\"// Copyright (C) 2001-$PREV_YEAR the original author or authors.\"\n+NEW_PATTERN=\"// Copyright (C) 2001-$CURR_YEAR the original author or authors.\"\n+find ./src -type f \\( -name *.java -o -name *.header -o -name *.g \\) \\", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "027a9f372db8b4c2e30305cfe023877e9f31be5e"}, "originalPosition": 11}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM3OTMzOTIz", "url": "https://github.com/checkstyle/checkstyle/pull/7437#pullrequestreview-337933923", "createdAt": "2020-01-03T02:36:50Z", "commit": {"oid": "027a9f372db8b4c2e30305cfe023877e9f31be5e"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wM1QwMjozNjo1MFrOFZ5C1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wM1QwMjozNzoyNFrOFZ5DAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjY5MzMzMg==", "bodyText": "Since this is a regular expression pattern, don't you have to sanitize the ()s and -?", "url": "https://github.com/checkstyle/checkstyle/pull/7437#discussion_r362693332", "createdAt": "2020-01-03T02:36:50Z", "author": {"login": "rnveach"}, "path": ".ci/bump_license_year.sh", "diffHunk": "@@ -0,0 +1,15 @@\n+#!/usr/bin/env bash\n+\n+set -e\n+\n+CURR_YEAR=$(date +\"%Y\")\n+JAVA_FILE=$(find ./src/main -type f -name *.java -print -quit)\n+echo \"Current year will be taken from $JAVA_FILE\"\n+PREV_YEAR=$(grep \"Copyright\" $JAVA_FILE | cut -d \" \" -f 4 | cut -d '-' -f 2)\n+OLD_PATTERN=\"// Copyright (C) 2001-$PREV_YEAR the original author or authors.\"\n+NEW_PATTERN=\"// Copyright (C) 2001-$CURR_YEAR the original author or authors.\"\n+find ./src -type f \\( -name *.java -o -name *.header -o -name *.g \\) \\\n+  -exec sed -i \"s|$OLD_PATTERN|$NEW_PATTERN|g\" {} +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "027a9f372db8b4c2e30305cfe023877e9f31be5e"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjY5MzM3OQ==", "bodyText": "Why can't script help with this and print it?", "url": "https://github.com/checkstyle/checkstyle/pull/7437#discussion_r362693379", "createdAt": "2020-01-03T02:37:24Z", "author": {"login": "rnveach"}, "path": ".ci/bump_license_year.sh", "diffHunk": "@@ -0,0 +1,15 @@\n+#!/usr/bin/env bash\n+\n+set -e\n+\n+CURR_YEAR=$(date +\"%Y\")\n+JAVA_FILE=$(find ./src/main -type f -name *.java -print -quit)\n+echo \"Current year will be taken from $JAVA_FILE\"\n+PREV_YEAR=$(grep \"Copyright\" $JAVA_FILE | cut -d \" \" -f 4 | cut -d '-' -f 2)\n+OLD_PATTERN=\"// Copyright (C) 2001-$PREV_YEAR the original author or authors.\"\n+NEW_PATTERN=\"// Copyright (C) 2001-$CURR_YEAR the original author or authors.\"\n+find ./src -type f \\( -name *.java -o -name *.header -o -name *.g \\) \\\n+  -exec sed -i \"s|$OLD_PATTERN|$NEW_PATTERN|g\" {} +\n+\n+echo \"Please Verify that output below is ONLY single line:\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "027a9f372db8b4c2e30305cfe023877e9f31be5e"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM4MjcwMDkz", "url": "https://github.com/checkstyle/checkstyle/pull/7437#pullrequestreview-338270093", "createdAt": "2020-01-03T20:52:51Z", "commit": {"oid": "df0d7c997c2a238f7af97a5c51b366401f6a709a"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wM1QyMDo1Mjo1MVrOFaJKmA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wM1QyMDo1NjoyMFrOFaJOkA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjk1NzQ2NA==", "bodyText": "Do you think we should have some pause and verify with a warning before doing the actual push? If diff is not a single line there is not way to stop the push.", "url": "https://github.com/checkstyle/checkstyle/pull/7437#discussion_r362957464", "createdAt": "2020-01-03T20:52:51Z", "author": {"login": "rnveach"}, "path": ".ci/bump-license-year-in-all-projects.sh", "diffHunk": "@@ -0,0 +1,44 @@\n+#!/usr/bin/env bash\n+\n+set -e\n+\n+CURR_YEAR=$(date +\"%Y\")\n+JAVA_FILE=$(find ./src/main -type f -name *.java -print -quit)\n+echo \"Current year will be taken from $JAVA_FILE\"\n+PREV_YEAR=$(grep \"Copyright\" $JAVA_FILE | cut -d \" \" -f 4 | cut -d '-' -f 2)\n+echo \"CURR_YEAR=$CURR_YEAR\"\n+echo \"PREV_YEAR=$PREV_YEAR\"\n+\n+./.ci/bump-license-year.sh $PREV_YEAR $CURR_YEAR .\n+git add . && git commit -m \"minor: bump year to $CURR_YEAR\" && git push origin master", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "df0d7c997c2a238f7af97a5c51b366401f6a709a"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjk1Nzc5MA==", "bodyText": "Why isn't cd and git command part of bump-license-year.sh? You pass all the necessary variables to do this.", "url": "https://github.com/checkstyle/checkstyle/pull/7437#discussion_r362957790", "createdAt": "2020-01-03T20:53:57Z", "author": {"login": "rnveach"}, "path": ".ci/bump-license-year-in-all-projects.sh", "diffHunk": "@@ -0,0 +1,44 @@\n+#!/usr/bin/env bash\n+\n+set -e\n+\n+CURR_YEAR=$(date +\"%Y\")\n+JAVA_FILE=$(find ./src/main -type f -name *.java -print -quit)\n+echo \"Current year will be taken from $JAVA_FILE\"\n+PREV_YEAR=$(grep \"Copyright\" $JAVA_FILE | cut -d \" \" -f 4 | cut -d '-' -f 2)\n+echo \"CURR_YEAR=$CURR_YEAR\"\n+echo \"PREV_YEAR=$PREV_YEAR\"\n+\n+./.ci/bump-license-year.sh $PREV_YEAR $CURR_YEAR .\n+git add . && git commit -m \"minor: bump year to $CURR_YEAR\" && git push origin master\n+\n+mkdir -p .ci-temp/bump-year\n+cd .ci-temp/bump-year\n+\n+git clone git@github.com:checkstyle/contribution.git\n+git clone git@github.com:checkstyle/sonar-checkstyle.git\n+git clone git@github.com:checkstyle/regression-tool.git\n+git clone git@github.com:sevntu-checkstyle/sevntu.checkstyle.git\n+git clone git@github.com:sevntu-checkstyle/methods-distance.git\n+\n+./../../.ci/bump-license-year.sh $PREV_YEAR $CURR_YEAR contribution\n+./../../.ci/bump-license-year.sh $PREV_YEAR $CURR_YEAR sonar-checkstyle\n+./../../.ci/bump-license-year.sh $PREV_YEAR $CURR_YEAR regression-tool\n+./../../.ci/bump-license-year.sh $PREV_YEAR $CURR_YEAR sevntu.checkstyle\n+./../../.ci/bump-license-year.sh $PREV_YEAR $CURR_YEAR methods-distance\n+\n+cd contribution\n+git add . && git commit -m \"minor: bump year to $CURR_YEAR\" && git push origin master", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "df0d7c997c2a238f7af97a5c51b366401f6a709a"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjk1ODQ4MA==", "bodyText": "Should this be Distinct?\nI think it would be better to make some wording like last time, like \"Diff should only be 1 line and should not continue if it is more than 1\".", "url": "https://github.com/checkstyle/checkstyle/pull/7437#discussion_r362958480", "createdAt": "2020-01-03T20:56:20Z", "author": {"login": "rnveach"}, "path": ".ci/bump-license-year.sh", "diffHunk": "@@ -0,0 +1,19 @@\n+#!/usr/bin/env bash\n+\n+set -e\n+\n+PREV_YEAR=$1\n+CURR_YEAR=$2\n+DIR=$3\n+\n+OLD_VALUE=\"// Copyright (C) 2001-$PREV_YEAR the original author or authors.\"\n+NEW_VALUE=\"// Copyright (C) 2001-$CURR_YEAR the original author or authors.\"\n+\n+find $DIR -type f \\( -name *.java -o -name *.header -o -name *.g \\) \\\n+  -exec sed -i \"s|$OLD_VALUE|$NEW_VALUE|g\" {} +\n+\n+BASEDIR=$(pwd)\n+echo \"Distict Diff in $DIR is:\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "df0d7c997c2a238f7af97a5c51b366401f6a709a"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d1cbafe6a1b38ffba6c17ed65b375af1f3dd0c57", "author": {"user": {"login": "romani", "name": "Roman Ivanov"}}, "url": "https://github.com/checkstyle/checkstyle/commit/d1cbafe6a1b38ffba6c17ed65b375af1f3dd0c57", "committedDate": "2020-01-03T21:35:28Z", "message": "config: add .ci/bump-license-year-in-all-projects.sh"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM4MzE0NjY0", "url": "https://github.com/checkstyle/checkstyle/pull/7437#pullrequestreview-338314664", "createdAt": "2020-01-03T23:26:15Z", "commit": {"oid": "d1cbafe6a1b38ffba6c17ed65b375af1f3dd0c57"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1190, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}