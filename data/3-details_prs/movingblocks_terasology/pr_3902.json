{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA2NDI5MzUw", "number": 3902, "title": "partial port of kinematicCharacterMover", "bodyText": "Here is a partial port of the KinematicCharacterMover. Player character should still move the same way without the changes in this file. I'll probably go through and tweaks some of the uses of Quat4f and replace them with their JOML alternatives. The kinematic character mover is an internal class to the engine so there is close to no impact on module space unless I start updated events that are emitted from the character mover.", "createdAt": "2020-04-21T04:25:39Z", "url": "https://github.com/MovingBlocks/Terasology/pull/3902", "merged": true, "mergeCommit": {"oid": "f683f12906677363da41fc261ca82566d20b8c2b"}, "closed": true, "closedAt": "2020-07-21T04:01:13Z", "author": {"login": "pollend"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcZr6OLAH2gAyNDA2NDI5MzUwOjkwMWYzYjlhYWQ2MzAyYzdlYTI0MmE0M2IwNWEyMzAwNTYxMmMzZjg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcfVZYkAFqTQwODQwMDU3NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "901f3b9aad6302c7ea242a43b05a23005612c3f8", "author": {"user": {"login": "pollend", "name": "Michael Pollind"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/901f3b9aad6302c7ea242a43b05a23005612c3f8", "committedDate": "2020-04-21T04:23:42Z", "message": "partial port of kinematicCharacterMover"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "317f3a34298adacba2989f8f3144f7186d70f249", "author": {"user": {"login": "pollend", "name": "Michael Pollind"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/317f3a34298adacba2989f8f3144f7186d70f249", "committedDate": "2020-04-21T16:06:22Z", "message": "added rotationYXZ in-place of quat4f"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "955713689cca131e211f1f55d226cd607cc691ac", "author": {"user": {"login": "pollend", "name": "Michael Pollind"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/955713689cca131e211f1f55d226cd607cc691ac", "committedDate": "2020-04-21T16:25:54Z", "message": "updated rotation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d22fb1b41497ea0d966a6af7608f462774333451", "author": {"user": {"login": "pollend", "name": "Michael Pollind"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/d22fb1b41497ea0d966a6af7608f462774333451", "committedDate": "2020-04-21T17:11:28Z", "message": "removed Vector3fUtil usage from KinematicCharacterMover"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e0e7b1b3680e00d14eead5e1fcef94e9de3b318a", "author": {"user": {"login": "pollend", "name": "Michael Pollind"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/e0e7b1b3680e00d14eead5e1fcef94e9de3b318a", "committedDate": "2020-04-21T17:51:35Z", "message": "ported CharacterMovmentSystemUtility"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4MTE2MTEw", "url": "https://github.com/MovingBlocks/Terasology/pull/3902#pullrequestreview-398116110", "createdAt": "2020-04-22T11:58:47Z", "commit": {"oid": "e0e7b1b3680e00d14eead5e1fcef94e9de3b318a"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxMTo1ODo0N1rOGJyhCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMlQxMjowMTo1N1rOGJypQg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjkxODAyNA==", "bodyText": "I suggest using the following for simplification. There is another instance of this below.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            rotation.rotationYXZ(TeraMath.DEG_TO_RAD * state.getYaw(), 0, 0);\n          \n          \n            \n                            rotation.rotationY(TeraMath.DEG_TO_RAD * state.getYaw());", "url": "https://github.com/MovingBlocks/Terasology/pull/3902#discussion_r412918024", "createdAt": "2020-04-22T11:58:47Z", "author": {"login": "kBlaszczyk"}, "path": "engine/src/main/java/org/terasology/logic/characters/KinematicCharacterMover.java", "diffHunk": "@@ -773,30 +777,28 @@ private void climb(final CharacterStateEvent state, CharacterMoveInputEvent inpu\n             } else {\n                 float pitchAmount = state.isGrounded() ? 45f : 90f;\n                 float pitch = input.getPitch() > 30f ? pitchAmount : -pitchAmount;\n-                rotation = new Quat4f(TeraMath.DEG_TO_RAD * state.getYaw(), TeraMath.DEG_TO_RAD * pitch, 0);\n-                rotation.rotate(desiredVelocity, desiredVelocity);\n+                rotation.rotationYXZ(TeraMath.DEG_TO_RAD * state.getYaw(), TeraMath.DEG_TO_RAD * pitch, 0);\n+                desiredVelocity.rotate(rotation);\n             }\n \n             // looking sidewards from ladder\n         } else if (angleToClimbDirection < Math.PI * 3.0 / 4.0) {\n             float rollAmount = state.isGrounded() ? 45f : 90f;\n             tmp = new Vector3f();\n-            rotation.rotate(climbDir3f, tmp);\n+            climbDir3f.rotate(rotation,tmp);\n             float leftOrRight = tmp.x;\n             float plusOrMinus = (leftOrRight < 0f ? -1.0f : 1.0f) * (climbDir3i.x != 0 ? -1.0f : 1.0f);\n             if (jumpOrCrouchActive) {\n-                rotation = new Quat4f(TeraMath.DEG_TO_RAD * state.getYaw(), 0, 0);\n+                rotation.rotationYXZ(TeraMath.DEG_TO_RAD * state.getYaw(), 0, 0);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e0e7b1b3680e00d14eead5e1fcef94e9de3b318a"}, "originalPosition": 429}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjkyMDEzMA==", "bodyText": "Could be simplified to:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    Quaternionf rotation = new Quaternionf().rotationYXZ(0f, TeraMath.DEG_TO_RAD * state.getPitch(), 0f);\n          \n          \n            \n                    Quaternionf rotation = new Quaternionf().rotationX(TeraMath.DEG_TO_RAD * state.getPitch());", "url": "https://github.com/MovingBlocks/Terasology/pull/3902#discussion_r412920130", "createdAt": "2020-04-22T12:01:57Z", "author": {"login": "kBlaszczyk"}, "path": "engine/src/main/java/org/terasology/logic/characters/CharacterMovementSystemUtility.java", "diffHunk": "@@ -63,27 +62,27 @@ public void setToState(EntityRef entity, CharacterStateEvent state) {\n         movementComp.footstepDelta = state.getFootstepDelta();\n         entity.saveComponent(movementComp);\n \n-        setPhysicsLocation(entity, state.getPosition());\n+        setPhysicsLocation(entity, JomlUtil.from(state.getPosition()));\n \n         // set the pitch to the character's gaze entity\n-        Quat4f rotation = new Quat4f(0f, TeraMath.DEG_TO_RAD * state.getPitch(), 0f);\n+        Quaternionf rotation = new Quaternionf().rotationYXZ(0f, TeraMath.DEG_TO_RAD * state.getPitch(), 0f);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e0e7b1b3680e00d14eead5e1fcef94e9de3b318a"}, "originalPosition": 26}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6309a39a8f40f56e0fd240939e604145c7e796b3", "author": {"user": {"login": "pollend", "name": "Michael Pollind"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/6309a39a8f40f56e0fd240939e604145c7e796b3", "committedDate": "2020-04-22T15:40:57Z", "message": "Update engine/src/main/java/org/terasology/logic/characters/CharacterMovementSystemUtility.java\n\nCo-Authored-By: Kevin Blaszczyk <kevin.blaszczyk@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8ae609a5f97be4740eb663ac6baa29ec4875e20e", "author": {"user": {"login": "pollend", "name": "Michael Pollind"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/8ae609a5f97be4740eb663ac6baa29ec4875e20e", "committedDate": "2020-04-22T15:41:03Z", "message": "Update engine/src/main/java/org/terasology/logic/characters/KinematicCharacterMover.java\n\nCo-Authored-By: Kevin Blaszczyk <kevin.blaszczyk@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk4NjMxMDgw", "url": "https://github.com/MovingBlocks/Terasology/pull/3902#pullrequestreview-398631080", "createdAt": "2020-04-22T22:21:01Z", "commit": {"oid": "8ae609a5f97be4740eb663ac6baa29ec4875e20e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "74e86151d8126c830699cc03241f04f376724da8", "author": {"user": {"login": "pollend", "name": "Michael Pollind"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/74e86151d8126c830699cc03241f04f376724da8", "committedDate": "2020-04-29T18:14:30Z", "message": "Merge remote-tracking branch 'upstream/develop' into feature/joml-kinematic-character-mover"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d9bfa0c4da9039f05e3817e9ed454a01184c291a", "author": {"user": {"login": "pollend", "name": "Michael Pollind"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/d9bfa0c4da9039f05e3817e9ed454a01184c291a", "committedDate": "2020-04-29T18:14:52Z", "message": "Merge branch 'feature/joml-kinematic-character-mover' of github.com:pollend/Terasology into feature/joml-kinematic-character-mover"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4NDAwNTc1", "url": "https://github.com/MovingBlocks/Terasology/pull/3902#pullrequestreview-408400575", "createdAt": "2020-05-08T17:33:28Z", "commit": {"oid": "d9bfa0c4da9039f05e3817e9ed454a01184c291a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1744, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}