{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ1NzU1MzU1", "number": 4335, "title": "feat(JOML): migrate chunkview and tests cases", "bodyText": "Migrate chunkview as post refactor with : #4326\nModule Changes\n\n Terasology/FlowingLiquids#24", "createdAt": "2020-12-27T02:30:21Z", "url": "https://github.com/MovingBlocks/Terasology/pull/4335", "merged": true, "mergeCommit": {"oid": "8b5c4ae627343c19046bca51a25e2c6646c04ee3"}, "closed": true, "closedAt": "2021-01-09T17:41:19Z", "author": {"login": "pollend"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdqIG3wAH2gAyNTQ1NzU1MzU1OmRjNDAzNjY3ZmI0NGNjYWYzZmU5NjNkYmI0Mjg0MDQ5OTlmMGI1MWI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdugZYNAH2gAyNTQ1NzU1MzU1OjNmYjhjZGE2MDY1MjI0ZTY2MzVlMDMyYTYxOTAxMjRjOTk5MDhkZDM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "dc403667fb44ccaf3fe963dbb428404999f0b51b", "author": {"user": {"login": "pollend", "name": "Michael Pollind"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/dc403667fb44ccaf3fe963dbb428404999f0b51b", "committedDate": "2020-12-27T02:28:48Z", "message": "feat(JOML): migrate chunkview and tests cases"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e530bd55679cc9eac0e3ea43ec797da8e08f3140", "author": {"user": {"login": "pollend", "name": "Michael Pollind"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/e530bd55679cc9eac0e3ea43ec797da8e08f3140", "committedDate": "2020-12-27T16:33:12Z", "message": "Merge branch 'develop' into feature/joml-migrate-chunkview"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "19949a66f052514d1bbde2569edb0b212792db56", "author": {"user": {"login": "skaldarnar", "name": "Tobias Nett"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/19949a66f052514d1bbde2569edb0b212792db56", "committedDate": "2020-12-30T19:46:25Z", "message": "Merge branch 'develop' into feature/joml-migrate-chunkview"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a8e0f2d2b370524e699ad6fe6afcbdea3f8af8e2", "author": {"user": {"login": "pollend", "name": "Michael Pollind"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/a8e0f2d2b370524e699ad6fe6afcbdea3f8af8e2", "committedDate": "2021-01-03T04:23:19Z", "message": "Merge branch 'develop' into feature/joml-migrate-chunkview"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "345396311095b2840420771d1592a7fbee6b8038", "author": {"user": {"login": "pollend", "name": "Michael Pollind"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/345396311095b2840420771d1592a7fbee6b8038", "committedDate": "2021-01-05T04:06:25Z", "message": "Merge branch 'develop' into feature/joml-migrate-chunkview"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY0Nzc1NTA1", "url": "https://github.com/MovingBlocks/Terasology/pull/4335#pullrequestreview-564775505", "createdAt": "2021-01-09T10:58:40Z", "commit": {"oid": "345396311095b2840420771d1592a7fbee6b8038"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wOVQxMDo1ODo0MVrOIQsSdg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wOVQxMToxMTo1NlrOIQsnBQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDM3Mzc1MA==", "bodyText": "Should this be Chunks.toRelative or something like that?", "url": "https://github.com/MovingBlocks/Terasology/pull/4335#discussion_r554373750", "createdAt": "2021-01-09T10:58:41Z", "author": {"login": "skaldarnar"}, "path": "engine/src/main/java/org/terasology/world/internal/ChunkViewCoreImpl.java", "diffHunk": "@@ -107,87 +109,77 @@ public byte getLight(Vector3i pos) {\n \n     @Override\n     public byte getSunlight(int blockX, int blockY, int blockZ) {\n-        if (!blockRegion.encompasses(blockX, blockY, blockZ)) {\n+        if (!blockRegion.contains(blockX, blockY, blockZ)) {\n             return 0;\n         }\n \n         int chunkIndex = relChunkIndex(blockX, blockY, blockZ);\n-        return chunks[chunkIndex].getSunlight(ChunkMath.calcRelativeBlockPos(blockX, blockY, blockZ, chunkFilterSize));\n+        return chunks[chunkIndex].getSunlight(JomlUtil.from(ChunkMath.calcRelativeBlockPos(blockX, blockY, blockZ, chunkFilterSize, new Vector3i())));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "345396311095b2840420771d1592a7fbee6b8038"}, "originalPosition": 88}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDM3MzkxMw==", "bodyText": "same here?", "url": "https://github.com/MovingBlocks/Terasology/pull/4335#discussion_r554373913", "createdAt": "2021-01-09T10:59:02Z", "author": {"login": "skaldarnar"}, "path": "engine/src/main/java/org/terasology/world/internal/ChunkViewCoreImpl.java", "diffHunk": "@@ -107,87 +109,77 @@ public byte getLight(Vector3i pos) {\n \n     @Override\n     public byte getSunlight(int blockX, int blockY, int blockZ) {\n-        if (!blockRegion.encompasses(blockX, blockY, blockZ)) {\n+        if (!blockRegion.contains(blockX, blockY, blockZ)) {\n             return 0;\n         }\n \n         int chunkIndex = relChunkIndex(blockX, blockY, blockZ);\n-        return chunks[chunkIndex].getSunlight(ChunkMath.calcRelativeBlockPos(blockX, blockY, blockZ, chunkFilterSize));\n+        return chunks[chunkIndex].getSunlight(JomlUtil.from(ChunkMath.calcRelativeBlockPos(blockX, blockY, blockZ, chunkFilterSize, new Vector3i())));\n     }\n \n     @Override\n     public byte getLight(int blockX, int blockY, int blockZ) {\n-        if (!blockRegion.encompasses(blockX, blockY, blockZ)) {\n+        if (!blockRegion.contains(blockX, blockY, blockZ)) {\n             return 0;\n         }\n \n         int chunkIndex = relChunkIndex(blockX, blockY, blockZ);\n-        return chunks[chunkIndex].getLight(ChunkMath.calcRelativeBlockPos(blockX, blockY, blockZ, chunkFilterSize));\n+        return chunks[chunkIndex].getLight(JomlUtil.from(ChunkMath.calcRelativeBlockPos(blockX, blockY, blockZ, chunkFilterSize, new Vector3i())));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "345396311095b2840420771d1592a7fbee6b8038"}, "originalPosition": 100}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDM3NzQzNA==", "bodyText": "Isn't this the same as:\nVector3i tmp = new Vector3i();\nBlockRegion expandedRegion = new BlockRegion(region).expand(1, 1, 1);\n\nVector3i minChunk = ChunkMath.calcChunkPos(expandedRegion.getMin(tmp), chunkPower);\nVector3i maxChunk = ChunkMath.calcChunkPos(expandedRegion.getMax(tmp), chunkPower);\nThis might get a bit esoteric here, but I'd love to write something like:\nBlockRegion chunkRegion = region.expand(1, 1, 1).map(corner -> ChunkMath.calcChunkPos(corner, chunkPower);\nAnd is there an alternative to ChunkMath.calcChunkPos(pos, power) in Chunks? I at least don't see one which takes vectors for both arguments when looking at Chunks.toChunkPos.", "url": "https://github.com/MovingBlocks/Terasology/pull/4335#discussion_r554377434", "createdAt": "2021-01-09T11:07:50Z", "author": {"login": "skaldarnar"}, "path": "engine/src/main/java/org/terasology/world/internal/ChunkViewCoreImpl.java", "diffHunk": "@@ -211,24 +203,24 @@ public void setExtraData(int index, int blockX, int blockY, int blockZ, int valu\n     }\n \n     @Override\n-    public void setDirtyAround(Vector3i blockPos) {\n-        for (Vector3i pos : ChunkMath.getChunkRegionAroundWorldPos(blockPos, 1)) {\n-            chunks[pos.x + offset.x + chunkRegion.size().x * (pos.z + offset.z)].setDirty(true);\n+    public void setDirtyAround(Vector3ic blockPos) {\n+        for (Vector3ic pos : ChunkMath.getChunkRegionAroundWorldPos(blockPos, 1)) {\n+            chunks[pos.x() + offset.x + chunkRegion.getSizeX() * (pos.z() + offset.z)].setDirty(true);\n         }\n     }\n \n     @Override\n-    public void setDirtyAround(Region3i region) {\n-        Vector3i minPos = new Vector3i(region.min());\n+    public void setDirtyAround(BlockRegionc region) {\n+        Vector3i minPos = region.getMin(new Vector3i());\n         minPos.sub(1, 1, 1);\n-        Vector3i maxPos = new Vector3i(region.max());\n+        Vector3i maxPos = region.getMax(new Vector3i());\n         maxPos.add(1, 1, 1);\n \n         Vector3i minChunk = ChunkMath.calcChunkPos(minPos, chunkPower);\n         Vector3i maxChunk = ChunkMath.calcChunkPos(maxPos, chunkPower);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "345396311095b2840420771d1592a7fbee6b8038"}, "originalPosition": 220}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDM3OTAxMw==", "bodyText": "On a second look, we introduced toChunkRegion(BlockRegion region, Vector3ic chunkPower, BlockRegion dest), which I guess can (or even should) be used here:\n        BlockRegion expandedRegion = new BlockRegion(region).expand(1, 1, 1);\n        for (Vector3ic pos : Chunks.toChunkRegion(expandedRegion, chunkPower, expandedRegion) {\n            chunks[pos.x() + offset.x + chunkRegion.getSizeX() * (pos.z() + offset.z)].setDirty(true);\n        }", "url": "https://github.com/MovingBlocks/Terasology/pull/4335#discussion_r554379013", "createdAt": "2021-01-09T11:11:56Z", "author": {"login": "skaldarnar"}, "path": "engine/src/main/java/org/terasology/world/internal/ChunkViewCoreImpl.java", "diffHunk": "@@ -211,24 +203,24 @@ public void setExtraData(int index, int blockX, int blockY, int blockZ, int valu\n     }\n \n     @Override\n-    public void setDirtyAround(Vector3i blockPos) {\n-        for (Vector3i pos : ChunkMath.getChunkRegionAroundWorldPos(blockPos, 1)) {\n-            chunks[pos.x + offset.x + chunkRegion.size().x * (pos.z + offset.z)].setDirty(true);\n+    public void setDirtyAround(Vector3ic blockPos) {\n+        for (Vector3ic pos : ChunkMath.getChunkRegionAroundWorldPos(blockPos, 1)) {\n+            chunks[pos.x() + offset.x + chunkRegion.getSizeX() * (pos.z() + offset.z)].setDirty(true);\n         }\n     }\n \n     @Override\n-    public void setDirtyAround(Region3i region) {\n-        Vector3i minPos = new Vector3i(region.min());\n+    public void setDirtyAround(BlockRegionc region) {\n+        Vector3i minPos = region.getMin(new Vector3i());\n         minPos.sub(1, 1, 1);\n-        Vector3i maxPos = new Vector3i(region.max());\n+        Vector3i maxPos = region.getMax(new Vector3i());\n         maxPos.add(1, 1, 1);\n \n         Vector3i minChunk = ChunkMath.calcChunkPos(minPos, chunkPower);\n         Vector3i maxChunk = ChunkMath.calcChunkPos(maxPos, chunkPower);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDM3NzQzNA=="}, "originalCommit": {"oid": "345396311095b2840420771d1592a7fbee6b8038"}, "originalPosition": 220}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c1f90d85d1ded69b89f9bd16ec9da8d8046fc1fc", "author": {"user": {"login": "skaldarnar", "name": "Tobias Nett"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/c1f90d85d1ded69b89f9bd16ec9da8d8046fc1fc", "committedDate": "2021-01-09T11:14:02Z", "message": "Merge branch 'develop' into feature/joml-migrate-chunkview"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e0de8f386095cc9fd78a6c0831ba475eb33c9408", "author": {"user": {"login": "skaldarnar", "name": "Tobias Nett"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/e0de8f386095cc9fd78a6c0831ba475eb33c9408", "committedDate": "2021-01-09T11:51:33Z", "message": "chore(joml): replace ChunkMath and ChunkConstants with `Chunks`"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTY0NzkzNTQ4", "url": "https://github.com/MovingBlocks/Terasology/pull/4335#pullrequestreview-564793548", "createdAt": "2021-01-09T16:18:58Z", "commit": {"oid": "e0de8f386095cc9fd78a6c0831ba475eb33c9408"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3fb8cda6065224e6635e032a6190124c99908dd3", "author": {"user": {"login": "pollend", "name": "Michael Pollind"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/3fb8cda6065224e6635e032a6190124c99908dd3", "committedDate": "2021-01-09T17:02:26Z", "message": "Merge branch 'develop' into feature/joml-migrate-chunkview"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1227, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}