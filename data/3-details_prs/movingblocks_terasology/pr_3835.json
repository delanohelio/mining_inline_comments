{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc4NjYyNDcy", "number": 3835, "title": "Gradle upgrade superset including Jenkins work and more!", "bodyText": "I've built this primarily on #3806 with great thanks to @DarkWeird !\nIt finishes some of the more quirky parts of the overall logistics, does other minor stuff, enhances support for testing things outside our \"live\" environment in Artifactory, Jenkins, and on GitHub, updates to use Jenkins pipelines properly and the Jenkins Templating Engine (for modules). Also pulled in a couple other PRs and tested other stuff yet.\nI believe this is merge-ready now and have new build jobs in the CBC Jenkins queued up to then start building everything fresh and neat in the new Jenkins, including a working Omega zip pulling in modules from new GitHub org mega-jobs automatically created by scanning for repos on GitHub - no more manually jobs in Jenkins and PRs will get tested for modules as well as the engine!\nThere are still improvements to make before we can use the new system for releases, primarily the approach remains hard coded to use the engine develop branch and snapshot versions for modules (much like before). Some tweaking needs to happen like consider develop a producer of snapshots and master a producer of released artifacts.. Not hard, just more work to do.\nHard to directly test some of this since Jenkins, but see #3806 for some of the central details and try to find any sort of Gradle task that appears broken. It is quite possible there could still be edge cases related to more rarely used stuff or rare combos involving user environments.\n\nMerges #3806 (which has links to more associated PRs)\nMerges #3833 (tested with Terasology/GooeyDefence#36)\nMerges #3814 (which in turn includes MovingBlocks/TeraConfig#8)\nInvolved updates to https://github.com/MovingBlocks/ModuleJteConfig (module mega-jobs)\nInvolves MovingBlocks/FacadeServer#30 although that may need more testing\nBumps version for engine and its embedded modules to 3.0.0 - this will require a bunch of module version bumps that'll be easiest to do in a big refactor done while merging this in a mega-workspace.\nMaintains the bundled version data used in the main menu and as part of the launcher (I think?) but can't yet test the launcher with new URLs as the CBC Jenkins still isn't exposed publicly (and has more complicated URLs in any case)\nOpens up properly attaching module build steps for maintaining the module browsing site (hi @majordwarf!) since those details can now be added to the JTE template Jenkinsfile.", "createdAt": "2020-02-23T04:43:11Z", "url": "https://github.com/MovingBlocks/Terasology/pull/3835", "merged": true, "mergeCommit": {"oid": "0e279fc37e2487aa045e4488c8a9332b61fa0207"}, "closed": true, "closedAt": "2020-03-03T05:34:35Z", "author": {"login": "Cervator"}, "timelineItems": {"totalCount": 37, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABbwCBHDgH2gAyMzc4NjYyNDcyOjZiYzdhZGVkZWQxZDhjMWE4YTNiMGFhZTAwYjFhODY1MDRjNDU4Yjc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcITFE2gFqTM2NTM5OTQ2NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6bc7adeded1d8c1a8a3b0aae00b1a86504c458b7", "author": {"user": {"login": "DarkWeird", "name": "Nail Khanipov"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/6bc7adeded1d8c1a8a3b0aae00b1a86504c458b7", "committedDate": "2019-12-13T18:24:19Z", "message": "init gradle 6.0"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "71b27878d20b0678b5a37938794c78542cedafa7", "author": {"user": {"login": "DarkWeird", "name": "Nail Khanipov"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/71b27878d20b0678b5a37938794c78542cedafa7", "committedDate": "2019-12-15T19:12:26Z", "message": "Fixed templates/build.gradle for using with gradle 6"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9708732703d9f6ea3414f54ecc1c24186d67c818", "author": {"user": {"login": "DarkWeird", "name": "Nail Khanipov"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/9708732703d9f6ea3414f54ecc1c24186d67c818", "committedDate": "2019-12-16T20:43:28Z", "message": "Fix engine build"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a7f50f9dca151dd728a3840d1e1da5a6a6c2967c", "author": {"user": {"login": "DarkWeird", "name": "Nail Khanipov"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/a7f50f9dca151dd728a3840d1e1da5a6a6c2967c", "committedDate": "2019-12-17T14:55:19Z", "message": "Add exclusion for jacoco, mockito generated classes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dc626d788439ccb48a67f85e7a6c29c065077f7c", "author": {"user": {"login": "DarkWeird", "name": "Nail Khanipov"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/dc626d788439ccb48a67f85e7a6c29c065077f7c", "committedDate": "2019-12-17T14:56:59Z", "message": "Reworked dependencies for \"whitelist\" libraries on compile-time\nand speedup compile"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1f515071c3de9da919a5902d196e6a42deb9e704", "author": {"user": {"login": "DarkWeird", "name": "Nail Khanipov"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/1f515071c3de9da919a5902d196e6a42deb9e704", "committedDate": "2019-12-17T19:51:36Z", "message": "Fix `gradlew game` run with new gradle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6ad689db5e4e725d1b7986a88343e68f712d27eb", "author": {"user": {"login": "DarkWeird", "name": "Nail Khanipov"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/6ad689db5e4e725d1b7986a88343e68f712d27eb", "committedDate": "2019-12-18T13:01:45Z", "message": "Fix server task\nFix tests after gradle upgrade"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b4d0b7ce1a2c983f07d7febecde559a55b236efe", "author": {"user": {"login": "DarkWeird", "name": "Nail Khanipov"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/b4d0b7ce1a2c983f07d7febecde559a55b236efe", "committedDate": "2019-12-18T14:54:36Z", "message": "Add groups for gradle tasks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b5193ee611c5b0054769f8f9d0dd4ecd8f0097bf", "author": {"user": {"login": "DarkWeird", "name": "Nail Khanipov"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/b5193ee611c5b0054769f8f9d0dd4ecd8f0097bf", "committedDate": "2019-12-21T17:40:39Z", "message": "Implements gradle's substitute for engine and modules"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0c35953e97639adc1afe9843f3a7ec28f575e311", "author": {"user": {"login": "DarkWeird", "name": "Nail Khanipov"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/0c35953e97639adc1afe9843f3a7ec28f575e311", "committedDate": "2019-12-24T19:06:13Z", "message": "Fix manifestClasspath\nFix gather libraries for distribution\nFix. move -Xmx options to jvmArgs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9f1e79df34ad241ca59d32d04c1474ec067575cf", "author": {"user": {"login": "DarkWeird", "name": "Nail Khanipov"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/9f1e79df34ad241ca59d32d04c1474ec067575cf", "committedDate": "2020-01-04T15:46:41Z", "message": "Remove configureondemand - it's incubating and don't work with version remapper (FacadeServer cannot building in workspace)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7f15c303b015ae25859d3c741d5f0edf1879d1c3", "author": {"user": {"login": "DarkWeird", "name": "Nail Khanipov"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/7f15c303b015ae25859d3c741d5f0edf1879d1c3", "committedDate": "2020-01-09T09:45:30Z", "message": "Simplify modules build.gradle\nMove workspace features from module to workspace\nUnify plugin style"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "61d355a91a58f33fccc754db25734eb438b57e3c", "author": {"user": {"login": "DarkWeird", "name": "Nail Khanipov"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/61d355a91a58f33fccc754db25734eb438b57e3c", "committedDate": "2020-01-26T16:33:34Z", "message": "Syncronize templates's build.gradle with Core's build.gradle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2dfd2ae80f2e4cf765eeebeb9915fa0a63ed8ff7", "author": {"user": {"login": "DarkWeird", "name": "Nail Khanipov"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/2dfd2ae80f2e4cf765eeebeb9915fa0a63ed8ff7", "committedDate": "2020-01-26T16:34:23Z", "message": "Add api dependency in engine for Light and Shadow"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5557cf61d4f11e2ff77a7b134cb16aaf72d9b087", "author": {"user": {"login": "DarkWeird", "name": "Nail Khanipov"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/5557cf61d4f11e2ff77a7b134cb16aaf72d9b087", "committedDate": "2020-01-26T16:35:31Z", "message": "Configure gradle's maven-plugin instead artifactory plugin"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b9d10e0df2e2467252b19c48fe498ba26fd2737a", "author": {"user": {"login": "DarkWeird", "name": "Nail Khanipov"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/b9d10e0df2e2467252b19c48fe498ba26fd2737a", "committedDate": "2020-01-26T16:43:50Z", "message": "Rename artifactory.gradle to maven.gradle\nCleanup maven.gradle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "666cbba7fa9b3ec3cf3e4cfcfddc8053d674be73", "author": {"user": {"login": "DarkWeird", "name": "Nail Khanipov"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/666cbba7fa9b3ec3cf3e4cfcfddc8053d674be73", "committedDate": "2020-01-26T16:46:20Z", "message": "Replace deprecated call."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0a3be99ab3c1c710f74e1c25770e28866b205375", "author": {"user": {"login": "DarkWeird", "name": "Nail Khanipov"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/0a3be99ab3c1c710f74e1c25770e28866b205375", "committedDate": "2020-01-26T16:54:08Z", "message": "Fix auth parameters for remote maven repository"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "129c1134a7fd3a68781c3df82f3d5a9c75ce51a9", "author": {"user": {"login": "Cervator", "name": "Rasmus Praestholm"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/129c1134a7fd3a68781c3df82f3d5a9c75ce51a9", "committedDate": "2020-02-01T19:41:36Z", "message": "Merge PR #3806 by @DarkWeird - Gradle 6 upgrade and related"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "186b04785d7c04267a0bfaa221e6d434e02cae89", "author": {"user": {"login": "Cervator", "name": "Rasmus Praestholm"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/186b04785d7c04267a0bfaa221e6d434e02cae89", "committedDate": "2020-02-02T04:29:07Z", "message": "Version bump to v3"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3de8958b9b767c2deb26fad558a4874fc6de1555", "author": {"user": {"login": "Cervator", "name": "Rasmus Praestholm"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/3de8958b9b767c2deb26fad558a4874fc6de1555", "committedDate": "2020-02-02T04:29:07Z", "message": "Minor tweaks, cleanup, and an arg fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b61970a8b2823f1cce91ecc77efd0168fe42c37c", "author": {"user": {"login": "Cervator", "name": "Rasmus Praestholm"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/b61970a8b2823f1cce91ecc77efd0168fe42c37c", "committedDate": "2020-02-02T04:29:07Z", "message": "Rename `maven.gradle` to `publish.gradle` to clarify. Two minor maybe-fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "229311d04674062a0ad5fb378b378554c234e756", "author": {"user": {"login": "Cervator", "name": "Rasmus Praestholm"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/229311d04674062a0ad5fb378b378554c234e756", "committedDate": "2020-02-02T15:53:22Z", "message": "Support redirecting Artifactory repo targeting via env vars (such as defined by a Jenkins Folder)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eb7dc59875ae845cfbc84c18dd6eaf44fadd8aae", "author": {"user": {"login": "Cervator", "name": "Rasmus Praestholm"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/eb7dc59875ae845cfbc84c18dd6eaf44fadd8aae", "committedDate": "2020-02-02T16:12:21Z", "message": "Helps to set a full URL"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1c10b04395d2b7876f65b2c2d17259b12f0fef43", "author": {"user": {"login": "Cervator", "name": "Rasmus Praestholm"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/1c10b04395d2b7876f65b2c2d17259b12f0fef43", "committedDate": "2020-02-02T16:36:23Z", "message": "Matching version here to the general engine number"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e6ec9ad6a19673aef2003337d1df3960bf7d2416", "author": {"user": {"login": "Cervator", "name": "Rasmus Praestholm"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/e6ec9ad6a19673aef2003337d1df3960bf7d2416", "committedDate": "2020-02-02T16:36:44Z", "message": "Experimental Jenkinsfile"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b7f1c3cab743211b270ac2508687435a9a615154", "author": {"user": {"login": "Cervator", "name": "Rasmus Praestholm"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/b7f1c3cab743211b270ac2508687435a9a615154", "committedDate": "2020-02-15T23:35:42Z", "message": "Some build dirs changed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f7c126fc8e3b210df6ab9a7dcb4cf83196ee32f8", "author": {"user": {"login": "Cervator", "name": "Rasmus Praestholm"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/f7c126fc8e3b210df6ab9a7dcb4cf83196ee32f8", "committedDate": "2020-02-15T23:51:55Z", "message": "Improve gradle.properties template and tweak Jenkins more"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ff180b2fcac31aab7b999be695954abb665d2d30", "author": {"user": {"login": "sin3point14", "name": null}}, "url": "https://github.com/MovingBlocks/Terasology/commit/ff180b2fcac31aab7b999be695954abb665d2d30", "committedDate": "2020-02-16T17:48:56Z", "message": "Expose JOML as a package to modules"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "40a00823dec2888a93de7bccadc06068ec71cc3c", "author": {"user": {"login": "Cervator", "name": "Rasmus Praestholm"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/40a00823dec2888a93de7bccadc06068ec71cc3c", "committedDate": "2020-02-22T22:04:37Z", "message": "Bump to TeraConfig over a Checkstyle config issue"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e764c59efabd22ec0499558f8108a080e31b76d9", "author": {"user": {"login": "Cervator", "name": "Rasmus Praestholm"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/e764c59efabd22ec0499558f8108a080e31b76d9", "committedDate": "2020-02-22T22:15:07Z", "message": "Merge Gradle rework\n\n# Conflicts:\n#\tengine/build.gradle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "84dbc8e22d363e80bf981839359a15141737d004", "author": {"user": {"login": "Cervator", "name": "Rasmus Praestholm"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/84dbc8e22d363e80bf981839359a15141737d004", "committedDate": "2020-02-22T23:23:01Z", "message": "Merge PR #3833 by @sin3point14 - whitelist JOML for modules"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "740d76a5dd850e436bb50c97cdc4b363c0ad6f72", "author": {"user": {"login": "Cervator", "name": "Rasmus Praestholm"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/740d76a5dd850e436bb50c97cdc4b363c0ad6f72", "committedDate": "2020-02-22T23:23:45Z", "message": "Add sin3point14 to game credits"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2ecb0d274a7b377d0702932aa3bf59c889824616", "author": {"user": {"login": "Cervator", "name": "Rasmus Praestholm"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/2ecb0d274a7b377d0702932aa3bf59c889824616", "committedDate": "2020-02-22T23:49:56Z", "message": "Minor tidying"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0e279fc37e2487aa045e4488c8a9332b61fa0207", "author": {"user": {"login": "Cervator", "name": "Rasmus Praestholm"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/0e279fc37e2487aa045e4488c8a9332b61fa0207", "committedDate": "2020-02-23T02:48:29Z", "message": "Plugin version issue - rely on Gradle default"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYzMTEzNjE4", "url": "https://github.com/MovingBlocks/Terasology/pull/3835#pullrequestreview-363113618", "createdAt": "2020-02-23T18:29:45Z", "commit": {"oid": "0e279fc37e2487aa045e4488c8a9332b61fa0207"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yM1QxODoyOTo0NlrOFtSIzw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yM1QxODoyOTo0NlrOFtSIzw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzAyNzQwNw==", "bodyText": "This block appears to be what can cause a stall with gradlew idea when org.gradle.parallel=true is set in gradle.properties - FYI @DarkWeird\nIf I comment this block out then the stall doesn't happen (but I'd assume module dependencies won't work). Probably relates to multiple threads working different modules for the ideaModule task yet this block iterates through all modules and for each goes and looks for every other module and substitutes stuff? That seems a classic case for ConcurrentModificationException being thrown when working with a Map just to come up with a possibly similar example :-)\nWe could still merge and advise to keep parallel processing off, with the intent to later get rid of gradlew idea entirely - but there could be a possibility of similar stalls in other Gradle logic that needs to iterate over modules?\nRunning Gradle in parallel mode is nice for efficiency but probably not really high priority yet. Could be more of an optimization thing to review later :-)", "url": "https://github.com/MovingBlocks/Terasology/pull/3835#discussion_r383027407", "createdAt": "2020-02-23T18:29:46Z", "author": {"login": "Cervator"}, "path": "build.gradle", "diffHunk": "@@ -185,16 +183,104 @@ clean.doLast {\n     println \"Cleaned root - don't forget to re-extract stuff! 'gradlew extractNatives extractConfig' will do so, or 'gradlew idea' (or eclipse)\"\n }\n \n-task protobufCompileWindows(type:Exec) {\n+task protobufCompileWindows(type: Exec) {\n     description = \"Run 'Protobuf Compiler' (Windows)\"\n     commandLine 'protobuf\\\\compiler\\\\protoc.exe', '--proto_path=engine\\\\src\\\\main\\\\protobuf', '--java_out', 'engine\\\\src\\\\main\\\\java', 'engine\\\\src\\\\main\\\\protobuf\\\\*'\n }\n \n-task protobufCompileLinux(type:Exec) {\n+task protobufCompileLinux(type: Exec) {\n     description = \"Run 'Protobuf Compiler' (Linux)\"\n     commandLine 'protobuf/compiler/protoc', '--proto_path=engine/src/main/protobuf', '--java_out', 'engine/src/main/java', \"engine/src/main/protobuf/EntityData.proto\", \"engine/src/main/protobuf/NetMessage.proto\"\n }\n \n+\n+\n+// Magic for replace remote dependency on local project (source)\n+// for Engine\n+allprojects {\n+    configurations.all {\n+        resolutionStrategy.dependencySubstitution {\n+            substitute module(\"org.terasology.engine:engine\") because \"we have sources!\" with project(\":engine\")\n+            substitute module(\"org.terasology.engine:engine-tests\") because \"we have sources!\" with project(\":engine-tests\")\n+        }\n+    }\n+}\n+\n+// Magic for replace remote dependency on local project (source)\n+// For exists modules\n+project(\":modules\").subprojects.forEach { proj ->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e279fc37e2487aa045e4488c8a9332b61fa0207"}, "originalPosition": 181}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY1Mzk5NDY1", "url": "https://github.com/MovingBlocks/Terasology/pull/3835#pullrequestreview-365399465", "createdAt": "2020-02-27T03:51:13Z", "commit": {"oid": "0e279fc37e2487aa045e4488c8a9332b61fa0207"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1679, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}