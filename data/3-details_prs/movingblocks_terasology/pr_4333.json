{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ1NzQ1OTk4", "number": 4333, "title": "feat(JOML): migrate world renderer", "bodyText": "", "createdAt": "2020-12-26T23:55:21Z", "url": "https://github.com/MovingBlocks/Terasology/pull/4333", "merged": true, "mergeCommit": {"oid": "8d2eec7233f770d20483bcfb55517a7b3e7c392f"}, "closed": true, "closedAt": "2020-12-31T11:21:29Z", "author": {"login": "pollend"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdqF3JggH2gAyNTQ1NzQ1OTk4OjkxYjUxMTJlNWU4MjVmZmFlNTFmODFlZWJmNTdhNGY3YmY3MjBlZTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdrhwtbgH2gAyNTQ1NzQ1OTk4OjIxZGQ3NTJkOTBhYzQ2ZTBjMzA4OGM4NWQzMjk0N2ZhOWQ3Y2NkMTk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "91b5112e5e825ffae51f81eebf57a4f7bf720ee3", "author": {"user": {"login": "pollend", "name": "Michael Pollind"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/91b5112e5e825ffae51f81eebf57a4f7bf720ee3", "committedDate": "2020-12-26T23:51:49Z", "message": "feat(JOML): migrate world renderer"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU4ODk2NDA4", "url": "https://github.com/MovingBlocks/Terasology/pull/4333#pullrequestreview-558896408", "createdAt": "2020-12-26T23:55:52Z", "commit": {"oid": "91b5112e5e825ffae51f81eebf57a4f7bf720ee3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yNlQyMzo1NTo1MlrOILm_rg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yNlQyMzo1NTo1MlrOILm_rg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTA0NDE0Mg==", "bodyText": "we don't have a subtract anymore so hopefully I implemented this correctly.", "url": "https://github.com/MovingBlocks/Terasology/pull/4333#discussion_r549044142", "createdAt": "2020-12-26T23:55:52Z", "author": {"login": "pollend"}, "path": "engine/src/main/java/org/terasology/rendering/world/RenderableWorldImpl.java", "diffHunk": "@@ -196,33 +196,31 @@ public void update() {\n      * @return True if the list was changed\n      */\n     @Override\n-    public boolean updateChunksInProximity(Region3i newRenderableRegion) {\n+    public boolean updateChunksInProximity(BlockRegion newRenderableRegion) {\n         if (!newRenderableRegion.equals(renderableRegion)) {\n-            Vector3i chunkPosition;\n             RenderableChunk chunk;\n+            for (Vector3ic toRemove : renderableRegion) {\n+                if (!newRenderableRegion.contains(toRemove)) {\n+                    Iterator<RenderableChunk> nearbyChunks = chunksInProximityOfCamera.iterator();\n+                    for (Iterator<RenderableChunk> it = nearbyChunks; it.hasNext(); ) {\n+                        chunk = it.next();\n+                        if (chunk.getPosition(new org.joml.Vector3i()).equals(toRemove)) {\n+                            chunk.disposeMesh();\n+                            nearbyChunks.remove();\n+                            break;\n+                        }\n \n-            Iterator<Vector3i> chunksToRemove = renderableRegion.subtract(newRenderableRegion);\n-            while (chunksToRemove.hasNext()) {\n-                chunkPosition = chunksToRemove.next();\n-                Iterator<RenderableChunk> nearbyChunks = chunksInProximityOfCamera.iterator();\n-                while (nearbyChunks.hasNext()) {\n-                    chunk = nearbyChunks.next();\n-                    if (chunk.getPosition().equals(chunkPosition)) {\n-                        chunk.disposeMesh();\n-                        nearbyChunks.remove();\n-                        break;\n                     }\n                 }\n             }\n-\n             boolean chunksHaveBeenAdded = false;\n-            Iterator<Vector3i> chunksToAdd = newRenderableRegion.subtract(renderableRegion);\n-            while (chunksToAdd.hasNext()) {\n-                chunkPosition = chunksToAdd.next();\n-                chunk = chunkProvider.getChunk(chunkPosition);\n-                if (chunk != null) {\n-                    chunksInProximityOfCamera.add(chunk);\n-                    chunksHaveBeenAdded = true;\n+            for (Vector3ic toAdd : newRenderableRegion) {\n+                if (!renderableRegion.contains(toAdd)) {\n+                    chunk = chunkProvider.getChunk(JomlUtil.from(toAdd));\n+                    if (chunk != null) {\n+                        chunksInProximityOfCamera.add(chunk);\n+                        chunksHaveBeenAdded = true;\n+                    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91b5112e5e825ffae51f81eebf57a4f7bf720ee3"}, "originalPosition": 131}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYwMjIyNDY0", "url": "https://github.com/MovingBlocks/Terasology/pull/4333#pullrequestreview-560222464", "createdAt": "2020-12-30T22:48:13Z", "commit": {"oid": "91b5112e5e825ffae51f81eebf57a4f7bf720ee3"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMFQyMjo0ODoxM1rOIM2nDQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMFQyMjo0ODo1MlrOIM2nhw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDM0ODU1Nw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        for (Vector3ic toAdd : newRenderableRegion) {\n          \n          \n            \n                        for (Vector3ic chunkPositionToAdd : newRenderableRegion) {", "url": "https://github.com/MovingBlocks/Terasology/pull/4333#discussion_r550348557", "createdAt": "2020-12-30T22:48:13Z", "author": {"login": "jdrueckert"}, "path": "engine/src/main/java/org/terasology/rendering/world/RenderableWorldImpl.java", "diffHunk": "@@ -196,33 +196,31 @@ public void update() {\n      * @return True if the list was changed\n      */\n     @Override\n-    public boolean updateChunksInProximity(Region3i newRenderableRegion) {\n+    public boolean updateChunksInProximity(BlockRegion newRenderableRegion) {\n         if (!newRenderableRegion.equals(renderableRegion)) {\n-            Vector3i chunkPosition;\n             RenderableChunk chunk;\n+            for (Vector3ic toRemove : renderableRegion) {\n+                if (!newRenderableRegion.contains(toRemove)) {\n+                    Iterator<RenderableChunk> nearbyChunks = chunksInProximityOfCamera.iterator();\n+                    for (Iterator<RenderableChunk> it = nearbyChunks; it.hasNext(); ) {\n+                        chunk = it.next();\n+                        if (chunk.getPosition(new org.joml.Vector3i()).equals(toRemove)) {\n+                            chunk.disposeMesh();\n+                            nearbyChunks.remove();\n+                            break;\n+                        }\n \n-            Iterator<Vector3i> chunksToRemove = renderableRegion.subtract(newRenderableRegion);\n-            while (chunksToRemove.hasNext()) {\n-                chunkPosition = chunksToRemove.next();\n-                Iterator<RenderableChunk> nearbyChunks = chunksInProximityOfCamera.iterator();\n-                while (nearbyChunks.hasNext()) {\n-                    chunk = nearbyChunks.next();\n-                    if (chunk.getPosition().equals(chunkPosition)) {\n-                        chunk.disposeMesh();\n-                        nearbyChunks.remove();\n-                        break;\n                     }\n                 }\n             }\n-\n             boolean chunksHaveBeenAdded = false;\n-            Iterator<Vector3i> chunksToAdd = newRenderableRegion.subtract(renderableRegion);\n-            while (chunksToAdd.hasNext()) {\n-                chunkPosition = chunksToAdd.next();\n-                chunk = chunkProvider.getChunk(chunkPosition);\n-                if (chunk != null) {\n-                    chunksInProximityOfCamera.add(chunk);\n-                    chunksHaveBeenAdded = true;\n+            for (Vector3ic toAdd : newRenderableRegion) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91b5112e5e825ffae51f81eebf57a4f7bf720ee3"}, "originalPosition": 125}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDM0ODYyMw==", "bodyText": "I think you did, yes.", "url": "https://github.com/MovingBlocks/Terasology/pull/4333#discussion_r550348623", "createdAt": "2020-12-30T22:48:33Z", "author": {"login": "jdrueckert"}, "path": "engine/src/main/java/org/terasology/rendering/world/RenderableWorldImpl.java", "diffHunk": "@@ -196,33 +196,31 @@ public void update() {\n      * @return True if the list was changed\n      */\n     @Override\n-    public boolean updateChunksInProximity(Region3i newRenderableRegion) {\n+    public boolean updateChunksInProximity(BlockRegion newRenderableRegion) {\n         if (!newRenderableRegion.equals(renderableRegion)) {\n-            Vector3i chunkPosition;\n             RenderableChunk chunk;\n+            for (Vector3ic toRemove : renderableRegion) {\n+                if (!newRenderableRegion.contains(toRemove)) {\n+                    Iterator<RenderableChunk> nearbyChunks = chunksInProximityOfCamera.iterator();\n+                    for (Iterator<RenderableChunk> it = nearbyChunks; it.hasNext(); ) {\n+                        chunk = it.next();\n+                        if (chunk.getPosition(new org.joml.Vector3i()).equals(toRemove)) {\n+                            chunk.disposeMesh();\n+                            nearbyChunks.remove();\n+                            break;\n+                        }\n \n-            Iterator<Vector3i> chunksToRemove = renderableRegion.subtract(newRenderableRegion);\n-            while (chunksToRemove.hasNext()) {\n-                chunkPosition = chunksToRemove.next();\n-                Iterator<RenderableChunk> nearbyChunks = chunksInProximityOfCamera.iterator();\n-                while (nearbyChunks.hasNext()) {\n-                    chunk = nearbyChunks.next();\n-                    if (chunk.getPosition().equals(chunkPosition)) {\n-                        chunk.disposeMesh();\n-                        nearbyChunks.remove();\n-                        break;\n                     }\n                 }\n             }\n-\n             boolean chunksHaveBeenAdded = false;\n-            Iterator<Vector3i> chunksToAdd = newRenderableRegion.subtract(renderableRegion);\n-            while (chunksToAdd.hasNext()) {\n-                chunkPosition = chunksToAdd.next();\n-                chunk = chunkProvider.getChunk(chunkPosition);\n-                if (chunk != null) {\n-                    chunksInProximityOfCamera.add(chunk);\n-                    chunksHaveBeenAdded = true;\n+            for (Vector3ic toAdd : newRenderableRegion) {\n+                if (!renderableRegion.contains(toAdd)) {\n+                    chunk = chunkProvider.getChunk(JomlUtil.from(toAdd));\n+                    if (chunk != null) {\n+                        chunksInProximityOfCamera.add(chunk);\n+                        chunksHaveBeenAdded = true;\n+                    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTA0NDE0Mg=="}, "originalCommit": {"oid": "91b5112e5e825ffae51f81eebf57a4f7bf720ee3"}, "originalPosition": 131}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDM0ODY3OQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        for (Vector3ic toRemove : renderableRegion) {\n          \n          \n            \n                        for (Vector3ic chunkPositionToRemove : renderableRegion) {", "url": "https://github.com/MovingBlocks/Terasology/pull/4333#discussion_r550348679", "createdAt": "2020-12-30T22:48:52Z", "author": {"login": "jdrueckert"}, "path": "engine/src/main/java/org/terasology/rendering/world/RenderableWorldImpl.java", "diffHunk": "@@ -196,33 +196,31 @@ public void update() {\n      * @return True if the list was changed\n      */\n     @Override\n-    public boolean updateChunksInProximity(Region3i newRenderableRegion) {\n+    public boolean updateChunksInProximity(BlockRegion newRenderableRegion) {\n         if (!newRenderableRegion.equals(renderableRegion)) {\n-            Vector3i chunkPosition;\n             RenderableChunk chunk;\n+            for (Vector3ic toRemove : renderableRegion) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91b5112e5e825ffae51f81eebf57a4f7bf720ee3"}, "originalPosition": 92}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "37d80df62ca4d8a23221b6385ea2c2b49e39a4e3", "author": {"user": {"login": "pollend", "name": "Michael Pollind"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/37d80df62ca4d8a23221b6385ea2c2b49e39a4e3", "committedDate": "2020-12-31T03:20:05Z", "message": "update position names"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYwMzIzODMz", "url": "https://github.com/MovingBlocks/Terasology/pull/4333#pullrequestreview-560323833", "createdAt": "2020-12-31T10:55:57Z", "commit": {"oid": "37d80df62ca4d8a23221b6385ea2c2b49e39a4e3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "21dd752d90ac46e0c3088c85d32947fa9d7ccd19", "author": {"user": {"login": "jdrueckert", "name": null}}, "url": "https://github.com/MovingBlocks/Terasology/commit/21dd752d90ac46e0c3088c85d32947fa9d7ccd19", "committedDate": "2020-12-31T10:56:03Z", "message": "Merge branch 'develop' into feature/joml-migrate-worldrenderable"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1225, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}