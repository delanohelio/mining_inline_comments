{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIyNzAxMzUx", "number": 3987, "title": "feat: BlockFamily API enhancement", "bodyText": "This PR enhances the BlockFamily interface to accept additional data for determining the orientation of new blocks.\nThe requirement was introduced by this PR: #3978.\nThe new data contains the players viewing direction and optionally the relative position, the player aimed at when placing the block (on the attachment side). This information can be used, for example, to turn blocks upside down when attached to the upper half of a block side.\nThe old getBlockForPlacement() method got deprecated in favor of the new one.\nTest\nPlace some Chests and Doors, and other blocks. Verify that their placement behavior has not changed.", "createdAt": "2020-05-25T11:27:56Z", "url": "https://github.com/MovingBlocks/Terasology/pull/3987", "merged": true, "mergeCommit": {"oid": "83108d735cdbfee7a083f10bc93614c17e31371e"}, "closed": true, "closedAt": "2020-05-28T21:12:06Z", "author": {"login": "kBlaszczyk"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABckuF_eAH2gAyNDIyNzAxMzUxOmU0MmUzMGI0ODk4ZjA4NzBkZGQ3NWJkMWNlMjc3ZWVhOGU2ZWUxZjE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcl0Xt9gFqTQyMDQ4OTQ1OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e42e30b4898f0870ddd75bd1ce277eea8e6ee1f1", "author": {"user": null}, "url": "https://github.com/MovingBlocks/Terasology/commit/e42e30b4898f0870ddd75bd1ce277eea8e6ee1f1", "committedDate": "2020-05-25T11:09:32Z", "message": "Add a new block placement method to BlockFamily\n\nThe new method gets passed more data to determine the resulting\nblock orientation. The old method got deprecated."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dfad910a54e81cb97e33b83fc41e7d8b639a59e8", "author": {"user": {"login": "kBlaszczyk", "name": "Kevin Blaszczyk"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/dfad910a54e81cb97e33b83fc41e7d8b639a59e8", "committedDate": "2020-05-25T11:09:32Z", "message": "Add BlockPlacementData to wrap the parameters passed to BlockFamily for block placement"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3NjQ4MzY3", "url": "https://github.com/MovingBlocks/Terasology/pull/3987#pullrequestreview-417648367", "createdAt": "2020-05-25T11:30:57Z", "commit": {"oid": "dfad910a54e81cb97e33b83fc41e7d8b639a59e8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxMTozMDo1N1rOGZ-IDg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yNVQxMTozMDo1N1rOGZ-IDg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTg4NTQ1NA==", "bodyText": "This is currently not null safe, I'm not sure if it has to be though.", "url": "https://github.com/MovingBlocks/Terasology/pull/3987#discussion_r429885454", "createdAt": "2020-05-25T11:30:57Z", "author": {"login": "kBlaszczyk"}, "path": "engine/src/main/java/org/terasology/world/block/family/BlockPlacementData.java", "diffHunk": "@@ -0,0 +1,57 @@\n+/*\n+ * Copyright 2020 MovingBlocks\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.terasology.world.block.family;\n+\n+import org.joml.Vector2f;\n+import org.joml.Vector2fc;\n+import org.joml.Vector3f;\n+import org.joml.Vector3fc;\n+import org.joml.Vector3i;\n+import org.joml.Vector3ic;\n+import org.terasology.math.Side;\n+\n+/**\n+ * BlockPlacementData represents data that is useful for determining the orientation of new block.\n+ * The data is supposed to be derived from the players state when placing the block.\n+ * BlockPlacementData is immutable.\n+ */\n+public class BlockPlacementData {\n+\n+    public final Vector3ic blockPosition;\n+    public final Side attachmentSide;\n+    public final Vector3fc viewingDirection;\n+    public final Vector2fc relativeAttachmentPosition;\n+\n+    /**\n+     * @param blockPosition     The block position, at which the block is going to be placed at.\n+     * @param attachmentSide    The side of the block which this block is being attached to, e.g. Top if the block is being placed on the ground\n+     */\n+    public BlockPlacementData(Vector3ic blockPosition, Side attachmentSide, Vector3fc viewingDirection) {\n+        this(blockPosition, attachmentSide, viewingDirection, new Vector2f());\n+    }\n+\n+    /**\n+     * @param blockPosition     The block position, at which the block is going to be placed at.\n+     * @param attachmentSide    The side of the block which this block is being attached to, e.g. Top if the block is being placed on the ground\n+     * @param relativeAttachmentPosition The position on the block surface that the user aimed at when placing the block. A value between (0, 0) and (1, 1).\n+     */\n+    public BlockPlacementData(Vector3ic blockPosition, Side attachmentSide, Vector3fc viewingDirection, Vector2fc relativeAttachmentPosition) {\n+        this.blockPosition = new Vector3i(blockPosition);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dfad910a54e81cb97e33b83fc41e7d8b639a59e8"}, "originalPosition": 52}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIwMzExNzI3", "url": "https://github.com/MovingBlocks/Terasology/pull/3987#pullrequestreview-420311727", "createdAt": "2020-05-28T16:57:08Z", "commit": {"oid": "dfad910a54e81cb97e33b83fc41e7d8b639a59e8"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxNjo1NzowOFrOGb-SMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxNjo1OTo1NlrOGb-Ynw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTk4NTIwMw==", "bodyText": "These public members should probably also have doc comments to explain what they are. Basically what you've used for the parameter descriptions.", "url": "https://github.com/MovingBlocks/Terasology/pull/3987#discussion_r431985203", "createdAt": "2020-05-28T16:57:08Z", "author": {"login": "skaldarnar"}, "path": "engine/src/main/java/org/terasology/world/block/family/BlockPlacementData.java", "diffHunk": "@@ -0,0 +1,57 @@\n+/*\n+ * Copyright 2020 MovingBlocks\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.terasology.world.block.family;\n+\n+import org.joml.Vector2f;\n+import org.joml.Vector2fc;\n+import org.joml.Vector3f;\n+import org.joml.Vector3fc;\n+import org.joml.Vector3i;\n+import org.joml.Vector3ic;\n+import org.terasology.math.Side;\n+\n+/**\n+ * BlockPlacementData represents data that is useful for determining the orientation of new block.\n+ * The data is supposed to be derived from the players state when placing the block.\n+ * BlockPlacementData is immutable.\n+ */\n+public class BlockPlacementData {\n+\n+    public final Vector3ic blockPosition;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dfad910a54e81cb97e33b83fc41e7d8b639a59e8"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTk4Njg0Nw==", "bodyText": "Good question. I'm tending to doing null-checks here to ensure that all values are non-null whenever something on usage side accesses them. I suspect that nobody will ever to a null-check there....\nCan use Guava's Preconditions here.", "url": "https://github.com/MovingBlocks/Terasology/pull/3987#discussion_r431986847", "createdAt": "2020-05-28T16:59:56Z", "author": {"login": "skaldarnar"}, "path": "engine/src/main/java/org/terasology/world/block/family/BlockPlacementData.java", "diffHunk": "@@ -0,0 +1,57 @@\n+/*\n+ * Copyright 2020 MovingBlocks\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.terasology.world.block.family;\n+\n+import org.joml.Vector2f;\n+import org.joml.Vector2fc;\n+import org.joml.Vector3f;\n+import org.joml.Vector3fc;\n+import org.joml.Vector3i;\n+import org.joml.Vector3ic;\n+import org.terasology.math.Side;\n+\n+/**\n+ * BlockPlacementData represents data that is useful for determining the orientation of new block.\n+ * The data is supposed to be derived from the players state when placing the block.\n+ * BlockPlacementData is immutable.\n+ */\n+public class BlockPlacementData {\n+\n+    public final Vector3ic blockPosition;\n+    public final Side attachmentSide;\n+    public final Vector3fc viewingDirection;\n+    public final Vector2fc relativeAttachmentPosition;\n+\n+    /**\n+     * @param blockPosition     The block position, at which the block is going to be placed at.\n+     * @param attachmentSide    The side of the block which this block is being attached to, e.g. Top if the block is being placed on the ground\n+     */\n+    public BlockPlacementData(Vector3ic blockPosition, Side attachmentSide, Vector3fc viewingDirection) {\n+        this(blockPosition, attachmentSide, viewingDirection, new Vector2f());\n+    }\n+\n+    /**\n+     * @param blockPosition     The block position, at which the block is going to be placed at.\n+     * @param attachmentSide    The side of the block which this block is being attached to, e.g. Top if the block is being placed on the ground\n+     * @param relativeAttachmentPosition The position on the block surface that the user aimed at when placing the block. A value between (0, 0) and (1, 1).\n+     */\n+    public BlockPlacementData(Vector3ic blockPosition, Side attachmentSide, Vector3fc viewingDirection, Vector2fc relativeAttachmentPosition) {\n+        this.blockPosition = new Vector3i(blockPosition);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTg4NTQ1NA=="}, "originalCommit": {"oid": "dfad910a54e81cb97e33b83fc41e7d8b639a59e8"}, "originalPosition": 52}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b398b66c7fbe0d99dc04cd16b6e2d46c27c8650d", "author": {"user": {"login": "kBlaszczyk", "name": "Kevin Blaszczyk"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/b398b66c7fbe0d99dc04cd16b6e2d46c27c8650d", "committedDate": "2020-05-28T17:26:26Z", "message": "Improve Javadoc in BlockPlacementData"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIwMzkwODYy", "url": "https://github.com/MovingBlocks/Terasology/pull/3987#pullrequestreview-420390862", "createdAt": "2020-05-28T18:43:52Z", "commit": {"oid": "b398b66c7fbe0d99dc04cd16b6e2d46c27c8650d"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxODo0Mzo1MlrOGcB9fw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQxODo0Mzo1MlrOGcB9fw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjA0NTQzOQ==", "bodyText": "I think that Preconditions.checkNotNull() will throw a NPE if the check fails.\nI'd say it's good enough for now, and I don't expect us to run into serious problems. At least debugging NPEs is quite a relaxing exercise \ud83d\ude05", "url": "https://github.com/MovingBlocks/Terasology/pull/3987#discussion_r432045439", "createdAt": "2020-05-28T18:43:52Z", "author": {"login": "skaldarnar"}, "path": "engine/src/main/java/org/terasology/world/block/family/BlockPlacementData.java", "diffHunk": "@@ -0,0 +1,57 @@\n+/*\n+ * Copyright 2020 MovingBlocks\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.terasology.world.block.family;\n+\n+import org.joml.Vector2f;\n+import org.joml.Vector2fc;\n+import org.joml.Vector3f;\n+import org.joml.Vector3fc;\n+import org.joml.Vector3i;\n+import org.joml.Vector3ic;\n+import org.terasology.math.Side;\n+\n+/**\n+ * BlockPlacementData represents data that is useful for determining the orientation of new block.\n+ * The data is supposed to be derived from the players state when placing the block.\n+ * BlockPlacementData is immutable.\n+ */\n+public class BlockPlacementData {\n+\n+    public final Vector3ic blockPosition;\n+    public final Side attachmentSide;\n+    public final Vector3fc viewingDirection;\n+    public final Vector2fc relativeAttachmentPosition;\n+\n+    /**\n+     * @param blockPosition     The block position, at which the block is going to be placed at.\n+     * @param attachmentSide    The side of the block which this block is being attached to, e.g. Top if the block is being placed on the ground\n+     */\n+    public BlockPlacementData(Vector3ic blockPosition, Side attachmentSide, Vector3fc viewingDirection) {\n+        this(blockPosition, attachmentSide, viewingDirection, new Vector2f());\n+    }\n+\n+    /**\n+     * @param blockPosition     The block position, at which the block is going to be placed at.\n+     * @param attachmentSide    The side of the block which this block is being attached to, e.g. Top if the block is being placed on the ground\n+     * @param relativeAttachmentPosition The position on the block surface that the user aimed at when placing the block. A value between (0, 0) and (1, 1).\n+     */\n+    public BlockPlacementData(Vector3ic blockPosition, Side attachmentSide, Vector3fc viewingDirection, Vector2fc relativeAttachmentPosition) {\n+        this.blockPosition = new Vector3i(blockPosition);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTg4NTQ1NA=="}, "originalCommit": {"oid": "dfad910a54e81cb97e33b83fc41e7d8b639a59e8"}, "originalPosition": 52}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ae640e7b8d58587b2c785f9c83868b593e1d830c", "author": {"user": {"login": "kBlaszczyk", "name": "Kevin Blaszczyk"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/ae640e7b8d58587b2c785f9c83868b593e1d830c", "committedDate": "2020-05-28T19:25:42Z", "message": "Add not-null-preconditions to BlockPlacementData arguments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIwNDQ0NDEz", "url": "https://github.com/MovingBlocks/Terasology/pull/3987#pullrequestreview-420444413", "createdAt": "2020-05-28T19:53:43Z", "commit": {"oid": "ae640e7b8d58587b2c785f9c83868b593e1d830c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIwNDg5NDU4", "url": "https://github.com/MovingBlocks/Terasology/pull/3987#pullrequestreview-420489458", "createdAt": "2020-05-28T21:02:15Z", "commit": {"oid": "ae640e7b8d58587b2c785f9c83868b593e1d830c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1580, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}