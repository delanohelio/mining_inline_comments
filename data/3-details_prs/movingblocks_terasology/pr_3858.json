{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg5NTE4ODAy", "number": 3858, "title": "Modified search to show if an asset is broken", "bodyText": "Contains\nFixed #3741 to harden the search for blocks. The console now shows which asset is broken when a search command is issued in the in game console .\nHow to test\nBreak an asset (eg : ladders) and write the command 'search stone' or search for any asset in the console. The search will return 0 results and return a message indicating that ladders is broken . Then fix it and run the same command and it should work.\nOutstanding before merging\nIf it works perfectly , can also be applied to prefabs and commands in the search", "createdAt": "2020-03-16T22:10:01Z", "url": "https://github.com/MovingBlocks/Terasology/pull/3858", "merged": true, "mergeCommit": {"oid": "1ef2530837abfb25a03f6063dc7f4817cfa0bd8e"}, "closed": true, "closedAt": "2020-03-29T00:34:38Z", "author": {"login": "vedant-shroff"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcOVe43AH2gAyMzg5NTE4ODAyOmI2ZjJhYjI1YTE0YzZmODdhNjU0MDhiNjA0ZWIzNjAxZjU4ZTQ2NTE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcSNR5bAFqTM4MzM1NjA4Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b6f2ab25a14c6f87a65408b604eb3601f58e4651", "author": {"user": {"login": "vedant-shroff", "name": null}}, "url": "https://github.com/MovingBlocks/Terasology/commit/b6f2ab25a14c6f87a65408b604eb3601f58e4651", "committedDate": "2020-03-16T22:02:46Z", "message": "modified asset search"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc4MTc2OTE4", "url": "https://github.com/MovingBlocks/Terasology/pull/3858#pullrequestreview-378176918", "createdAt": "2020-03-20T00:20:48Z", "commit": {"oid": "b6f2ab25a14c6f87a65408b604eb3601f58e4651"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQwMDoyMDo0OFrOF5EnBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yMFQwMDoyNjo0MVrOF5EsfA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTM4ODY3OQ==", "bodyText": "One of our style rules is to avoid star imports. IntelliJ defaults to using them however.\nYou'll need to go into settings and change the number of imports required before a star is used up to 99. It's pain that we can't automatically do that at the moment but oh well", "url": "https://github.com/MovingBlocks/Terasology/pull/3858#discussion_r395388679", "createdAt": "2020-03-20T00:20:48Z", "author": {"login": "syntaxi"}, "path": "engine/src/main/java/org/terasology/logic/console/commands/CoreCommands.java", "diffHunk": "@@ -83,15 +84,10 @@\n \n import java.io.IOException;\n import java.net.UnknownHostException;\n+import java.util.*;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b6f2ab25a14c6f87a65408b604eb3601f58e4651"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTM4OTA5Nw==", "bodyText": "We try and have all variables have useful names, even if they're not used much. Here I'd suggest something like matchingBlocks or even just outputList", "url": "https://github.com/MovingBlocks/Terasology/pull/3858#discussion_r395389097", "createdAt": "2020-03-20T00:22:41Z", "author": {"login": "syntaxi"}, "path": "engine/src/main/java/org/terasology/logic/console/commands/CoreCommands.java", "diffHunk": "@@ -253,10 +249,29 @@ public String search(@CommandParam(\"searched\") String searched) {\n      * @return List of blocks that match searched string\n      */\n     private List<String> findBlockMatches(String searchLowercase) {\n-        return assetManager.getAvailableAssets(BlockFamilyDefinition.class)\n-                .stream().<Optional<BlockFamilyDefinition>>map(urn -> assetManager.getAsset(urn, BlockFamilyDefinition.class))\n-                .filter(def -> def.isPresent() && def.get().isLoadable() && matchesSearch(searchLowercase, def.get()))\n-                .map(r -> new BlockUri(r.get().getUrn()).toString()).collect(Collectors.toList());\n+        ResourceUrn curUrn;\n+        List<String> l=new ArrayList<String>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b6f2ab25a14c6f87a65408b604eb3601f58e4651"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTM4OTI3NA==", "bodyText": "See my above comment about naming. (Although this variable could easily be joined with the following line", "url": "https://github.com/MovingBlocks/Terasology/pull/3858#discussion_r395389274", "createdAt": "2020-03-20T00:23:21Z", "author": {"login": "syntaxi"}, "path": "engine/src/main/java/org/terasology/logic/console/commands/CoreCommands.java", "diffHunk": "@@ -253,10 +249,29 @@ public String search(@CommandParam(\"searched\") String searched) {\n      * @return List of blocks that match searched string\n      */\n     private List<String> findBlockMatches(String searchLowercase) {\n-        return assetManager.getAvailableAssets(BlockFamilyDefinition.class)\n-                .stream().<Optional<BlockFamilyDefinition>>map(urn -> assetManager.getAsset(urn, BlockFamilyDefinition.class))\n-                .filter(def -> def.isPresent() && def.get().isLoadable() && matchesSearch(searchLowercase, def.get()))\n-                .map(r -> new BlockUri(r.get().getUrn()).toString()).collect(Collectors.toList());\n+        ResourceUrn curUrn;\n+        List<String> l=new ArrayList<String>();\n+        for (ResourceUrn urn : assetManager.getAvailableAssets(BlockFamilyDefinition.class)) {\n+            // Current urn for logging purposes to find the broken urn\n+            curUrn = urn;\n+            try{\n+                Optional<BlockFamilyDefinition> def = assetManager.getAsset(urn, BlockFamilyDefinition.class);\n+                if (def.isPresent() && def.get().isLoadable() && matchesSearch(searchLowercase, def.get())) {\n+                    String s = new BlockUri(def.get().getUrn()).toString();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b6f2ab25a14c6f87a65408b604eb3601f58e4651"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTM4OTYxMg==", "bodyText": "Would it be possible to instead of returning here, to just keep looping through the for block?\nThat way the broken assets will be skipped but the rest of the command will still work and the printing will still work.", "url": "https://github.com/MovingBlocks/Terasology/pull/3858#discussion_r395389612", "createdAt": "2020-03-20T00:24:49Z", "author": {"login": "syntaxi"}, "path": "engine/src/main/java/org/terasology/logic/console/commands/CoreCommands.java", "diffHunk": "@@ -253,10 +249,29 @@ public String search(@CommandParam(\"searched\") String searched) {\n      * @return List of blocks that match searched string\n      */\n     private List<String> findBlockMatches(String searchLowercase) {\n-        return assetManager.getAvailableAssets(BlockFamilyDefinition.class)\n-                .stream().<Optional<BlockFamilyDefinition>>map(urn -> assetManager.getAsset(urn, BlockFamilyDefinition.class))\n-                .filter(def -> def.isPresent() && def.get().isLoadable() && matchesSearch(searchLowercase, def.get()))\n-                .map(r -> new BlockUri(r.get().getUrn()).toString()).collect(Collectors.toList());\n+        ResourceUrn curUrn;\n+        List<String> l=new ArrayList<String>();\n+        for (ResourceUrn urn : assetManager.getAvailableAssets(BlockFamilyDefinition.class)) {\n+            // Current urn for logging purposes to find the broken urn\n+            curUrn = urn;\n+            try{\n+                Optional<BlockFamilyDefinition> def = assetManager.getAsset(urn, BlockFamilyDefinition.class);\n+                if (def.isPresent() && def.get().isLoadable() && matchesSearch(searchLowercase, def.get())) {\n+                    String s = new BlockUri(def.get().getUrn()).toString();\n+                    l.add(s);\n+                }\n+            }\n+            // If a prefab is broken , it will throw an exception\n+            catch(Exception e){\n+                List<String> EmptyList=new ArrayList<String>();\n+                console.addMessage(\"Note : Search may not return results if invalid assets are present\");\n+                console.addMessage(\"Error parsing : \"+curUrn.toString());\n+                console.addMessage(e.toString());\n+                return(EmptyList);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b6f2ab25a14c6f87a65408b604eb3601f58e4651"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTM5MDA3Ng==", "bodyText": "The cleanup of the method is appreciated, but this line seems like it has just been removed. Is it actually not needed, because it looks like it's used in spawning the prefab.", "url": "https://github.com/MovingBlocks/Terasology/pull/3858#discussion_r395390076", "createdAt": "2020-03-20T00:26:41Z", "author": {"login": "syntaxi"}, "path": "engine/src/main/java/org/terasology/logic/console/commands/CoreCommands.java", "diffHunk": "@@ -523,17 +538,16 @@ public String spawnPrefab(@Sender EntityRef sender, @CommandParam(\"prefabId\") St\n         } else {\n             dir.set(Direction.FORWARD.getVector3f());\n         }\n-        Quat4f rotation = Quat4f.shortestArcQuat(Direction.FORWARD.getVector3f(), dir);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b6f2ab25a14c6f87a65408b604eb3601f58e4651"}, "originalPosition": 63}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "86e5a9f4a2e899115ed01634f4a5abf2fe7bfdd7", "author": {"user": {"login": "vedant-shroff", "name": null}}, "url": "https://github.com/MovingBlocks/Terasology/commit/86e5a9f4a2e899115ed01634f4a5abf2fe7bfdd7", "committedDate": "2020-03-20T13:58:06Z", "message": "made required changes to search"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e417b18b83cb5595033880257124fff637c80eef", "author": {"user": {"login": "vedant-shroff", "name": null}}, "url": "https://github.com/MovingBlocks/Terasology/commit/e417b18b83cb5595033880257124fff637c80eef", "committedDate": "2020-03-20T13:59:37Z", "message": "minor code cleanup to search"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzMzU2MDgy", "url": "https://github.com/MovingBlocks/Terasology/pull/3858#pullrequestreview-383356082", "createdAt": "2020-03-28T22:45:02Z", "commit": {"oid": "e417b18b83cb5595033880257124fff637c80eef"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1703, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}