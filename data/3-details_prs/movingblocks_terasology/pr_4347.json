{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ2MjgzNjU3", "number": 4347, "title": "build(facades.PC): tidy distribution tasks", "bodyText": "This is a follow-up to #4343. I'm not aware of any open issues fixed by this, but it makes some build dependencies more consistent with the way #4343 manages them and addresses some TODOs that have been in the gradle files for a while.\n\nRemoves RemoteModuleGatherer, the code that puts .jar files in modules/ during gradle dependency resolution. It's unnecessary under the modules-on-the-classpath strategy used by #4343, figuring out a better way to provide those dependencies without breaking the sandbox is #4375.\nRemoves PC facade targets distApp and distModules, distPCZip, they are unused.\n\nthe gradle-standard distTar and distZip tasks are supported.\n\n\nKeeps distForLauncher so we don't need to change any of Launcher's assumptions about the zip file layout.\nRemoves some overrides to gradle/IntelliJ build directories that were counterproductive.\n\nCaveat\nIf you build a dist while you have module subprojects present, they will get lumped in on the classpath and not separated.\nI think that's not a showstopper because our release builds are made without modules and then a separate process adds them to the distribution later.\nHow to test\n\nmake some zips using :facades:PC:distZip and distForLauncher; make sure they are something you can unzip and start up (outside your development workspace) using the script included in its bin/\nin-game look at Extras / Credits and make sure it displays the credits file.\n\nOutstanding before merging\n\n merge gradle upgrade #4439\n do the start scripts need to be customized? (the only arg the old start scripts added was -Xmx)", "createdAt": "2020-12-29T00:52:30Z", "url": "https://github.com/MovingBlocks/Terasology/pull/4347", "merged": true, "mergeCommit": {"oid": "b0f80a7210c01035de9c0b1cb6eabef2da1cdb83"}, "closed": true, "closedAt": "2021-02-03T19:42:32Z", "author": {"login": "keturn"}, "timelineItems": {"totalCount": 64, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdqrQdYgH2gAyNTQ2MjgzNjU3Ojk5YmE3MzY2ZDZkNDBhZWNmYTFiMGRmYzZmNmUxY2NhMTg5MTRmZGU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABd2lhasAH2gAyNTQ2MjgzNjU3OjZlNTFlMDY3MTNjYzY5YjIzYjZjMDg5OTJiZDI1ZmJkZDA0NDZmMmM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "99ba7366d6d40aecfa1b0dfc6f6e1cca18914fde", "author": {"user": {"login": "keturn", "name": "Kevin Turner"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/99ba7366d6d40aecfa1b0dfc6f6e1cca18914fde", "committedDate": "2020-12-28T19:25:57Z", "message": "chore (build): remove unused distModules task"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cec2bf519aedb684c7abbce7fd4a646f3686e583", "author": {"user": {"login": "keturn", "name": "Kevin Turner"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/cec2bf519aedb684c7abbce7fd4a646f3686e583", "committedDate": "2020-12-28T19:31:13Z", "message": "chore (build): remove RemoteModuleGatherer\n\ngradle is smart enough to put runtime dependencies on the classpath"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5bac6606b32945ec866febb599d78b1c7478dcc4", "author": {"user": {"login": "keturn", "name": "Kevin Turner"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/5bac6606b32945ec866febb599d78b1c7478dcc4", "committedDate": "2020-12-28T19:38:07Z", "message": "chore (build): remove unnecessary IdeaModel overrides\n\nWhen we have resources for gestalt's asset loader we need to be particular about output directories. But the facade does not register gestalt assets itself.\n\nWe avoid some gradle/intellij build state collisions by not forcing these values."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d3a6b1a028d8828503f538321160fdea09c9289d", "author": {"user": {"login": "keturn", "name": "Kevin Turner"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/d3a6b1a028d8828503f538321160fdea09c9289d", "committedDate": "2020-12-28T20:12:12Z", "message": "chore (build): The PC facade gets to be named \"Terasology\""}}, {"__typename": "PullRequestCommit", "commit": {"oid": "79bacf3fa4104907f3aee2e40d1a77ed83597b91", "author": {"user": {"login": "keturn", "name": "Kevin Turner"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/79bacf3fa4104907f3aee2e40d1a77ed83597b91", "committedDate": "2020-12-28T21:14:24Z", "message": "chore(build): add README, LICENSE, NOTICE, and VERSION files to the main distribution"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "87eb506545043ac0ef2c0864254e6bb555ca3093", "author": {"user": {"login": "keturn", "name": "Kevin Turner"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/87eb506545043ac0ef2c0864254e6bb555ca3093", "committedDate": "2020-12-28T23:03:38Z", "message": "chore(build): refactor createVersionInfoFile to use specific gradle task type"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "007cc7459a10144420a6c42b931ce4804c2e69ea", "author": {"user": {"login": "keturn", "name": "Kevin Turner"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/007cc7459a10144420a6c42b931ce4804c2e69ea", "committedDate": "2020-12-29T00:18:35Z", "message": "chore (build): pass createVersionInfoFile to processResources\n\ninstead of writing to the build state directly. This helps gradle be consistent about which tasks are responsible for which outputs."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b1ff0bbfdfdee1beabf1c85a292c5635655682a6", "author": {"user": {"login": "keturn", "name": "Kevin Turner"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/b1ff0bbfdfdee1beabf1c85a292c5635655682a6", "committedDate": "2020-12-29T00:41:11Z", "message": "chore (build): add Credits.md as an engine resource in engine's build, not facade's"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU5MzY2MzM1", "url": "https://github.com/MovingBlocks/Terasology/pull/4347#pullrequestreview-559366335", "createdAt": "2020-12-29T03:28:00Z", "commit": {"oid": "b1ff0bbfdfdee1beabf1c85a292c5635655682a6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQwMzoyODowMVrOIMGKzg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yOVQwMzoyODowMVrOIMGKzg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU1NDg5NA==", "bodyText": "@Cervator This task had an \"only if $BUILD_URL is set\" condition on it. Is that important to keep? i.e. is a properties file with a bunch of missing entries worse than no properties file at all?", "url": "https://github.com/MovingBlocks/Terasology/pull/4347#discussion_r549554894", "createdAt": "2020-12-29T03:28:01Z", "author": {"login": "keturn"}, "path": "engine/build.gradle", "diffHunk": "@@ -216,26 +214,31 @@ group = 'org.terasology.engine'\n println \"Version for $project.name loaded as $version for group $group\"\n \n // This version info file actually goes inside the built jar and can be used at runtime\n-task createVersionInfoFile {\n-    inputs.property('dateTime', startDateTimeString)\n-    onlyIf { env.BUILD_URL != null }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b1ff0bbfdfdee1beabf1c85a292c5635655682a6"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "474faa4243fd52a3868e393e1ccce6e3eeb4978a", "author": {"user": {"login": "keturn", "name": "Kevin Turner"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/474faa4243fd52a3868e393e1ccce6e3eeb4978a", "committedDate": "2020-12-29T20:34:24Z", "message": "Merge branch 'fix/transient-deps' into chore/tidy-dist-tasks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e3cb11c481304cb61378160f93e8ae6024845ea2", "author": {"user": {"login": "keturn", "name": "Kevin Turner"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/e3cb11c481304cb61378160f93e8ae6024845ea2", "committedDate": "2020-12-29T21:00:15Z", "message": "chore(gradle): add some section headers\n\nI think this is a sign that this file is big enough to split up, but that'll make mess of the code review so we'll do that after."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c14644147048d3746664bc5b5b0e93a8ed172f09", "author": {"user": {"login": "keturn", "name": "Kevin Turner"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/c14644147048d3746664bc5b5b0e93a8ed172f09", "committedDate": "2021-01-03T01:35:06Z", "message": "Merge branch 'develop' into chore/tidy-dist-tasks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e4df5d904d8f0d13c5d12f54c4266ada86e9fb9b", "author": {"user": {"login": "keturn", "name": "Kevin Turner"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/e4df5d904d8f0d13c5d12f54c4266ada86e9fb9b", "committedDate": "2021-01-17T04:39:26Z", "message": "Merge remote-tracking branch 'origin/develop' into chore/tidy-dist-tasks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "61d35c9067b73e6f89bca73b11e23b0daf405e94", "author": {"user": {"login": "keturn", "name": "Kevin Turner"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/61d35c9067b73e6f89bca73b11e23b0daf405e94", "committedDate": "2021-01-17T04:52:21Z", "message": "doc(build): createVersionTask"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a7e661ba217ccd99fe1aaa051f6e57c64e237362", "author": {"user": {"login": "keturn", "name": "Kevin Turner"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/a7e661ba217ccd99fe1aaa051f6e57c64e237362", "committedDate": "2021-01-17T04:53:37Z", "message": "refactor (build): move jar task to distribution-related section"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d4ed1827d9e560752626e08a061ec9f0b5ba6f29", "author": {"user": {"login": "keturn", "name": "Kevin Turner"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/d4ed1827d9e560752626e08a061ec9f0b5ba6f29", "committedDate": "2021-01-17T04:55:26Z", "message": "chore(build): allow createVersionFile to run regardless of environment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b8b058055a3976a2e2bbf0c5afe051ab0b14a66c", "author": {"user": {"login": "keturn", "name": "Kevin Turner"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/b8b058055a3976a2e2bbf0c5afe051ab0b14a66c", "committedDate": "2021-01-17T05:25:01Z", "message": "chore (build): name facade's jar Terasology.jar\n\nLauncher invokes it by naming this file, not by class lookup."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c4c866da27e375f1faebbc8dfd6446db498272af", "author": {"user": {"login": "keturn", "name": "Kevin Turner"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/c4c866da27e375f1faebbc8dfd6446db498272af", "committedDate": "2021-01-17T18:46:43Z", "message": "refactor (build): move configurations to before dependencies where they're used"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2b8a149cefceaaf99bc0ef273ea1341fa44064e8", "author": {"user": {"login": "keturn", "name": "Kevin Turner"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/2b8a149cefceaaf99bc0ef273ea1341fa44064e8", "committedDate": "2021-01-17T19:12:17Z", "message": "chore (build): include native libs in distribution"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ffaacc735e3ad1ea1801ffc76f4e7347a3bf7fee", "author": {"user": {"login": "keturn", "name": "Kevin Turner"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/ffaacc735e3ad1ea1801ffc76f4e7347a3bf7fee", "committedDate": "2021-01-17T19:15:29Z", "message": "chore (build): replace dist tasks\n\nConfigure things so we can take advantage of more of gradle's defaults."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6f5af62a42025991aab0df9a4b1a70b7d1ec0ff3", "author": {"user": {"login": "keturn", "name": "Kevin Turner"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/6f5af62a42025991aab0df9a4b1a70b7d1ec0ff3", "committedDate": "2021-01-17T19:19:05Z", "message": "chore (build): remove old facade launch scripts\n\nThe exe versions were unmaintained and gradle provides startup scripts that are much better about compatibility than we were."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "867656f9ffafd100da7d4a9fc60ab43c28edb445", "author": {"user": {"login": "keturn", "name": "Kevin Turner"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/867656f9ffafd100da7d4a9fc60ab43c28edb445", "committedDate": "2021-01-17T19:19:44Z", "message": "Merge remote-tracking branch 'origin/develop' into chore/tidy-dist-tasks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "806add837c89199a77391a0d51fa5a98eda72a8c", "author": {"user": {"login": "keturn", "name": "Kevin Turner"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/806add837c89199a77391a0d51fa5a98eda72a8c", "committedDate": "2021-01-17T20:00:11Z", "message": "Merge remote-tracking branch 'origin/develop' into chore/tidy-dist-tasks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7189173ca1c973b37f75a30a818cb77ee9e57171", "author": {"user": {"login": "keturn", "name": "Kevin Turner"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/7189173ca1c973b37f75a30a818cb77ee9e57171", "committedDate": "2021-01-17T22:37:57Z", "message": "chore (build): keep jars in \"libs/\" not \"lib/\" in distForLauncher"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bb3c6c161525bc836264f8a75d289b8dd30fe3cb", "author": {"user": {"login": "keturn", "name": "Kevin Turner"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/bb3c6c161525bc836264f8a75d289b8dd30fe3cb", "committedDate": "2021-01-17T22:53:11Z", "message": "fix (build): do not ignore build output appearing in a source directory\n\nengine:processResources has been adjusted so this file needn't end up there."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "474a312704dfd521819b5c9fff06a9d1cf4dd02a", "author": {"user": {"login": "keturn", "name": "Kevin Turner"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/474a312704dfd521819b5c9fff06a9d1cf4dd02a", "committedDate": "2021-01-17T23:06:07Z", "message": "chore (build): remove unused var"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a4a966514f22d9cf1ff88fd248d782e9837767f0", "author": {"user": {"login": "keturn", "name": "Kevin Turner"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/a4a966514f22d9cf1ff88fd248d782e9837767f0", "committedDate": "2021-01-18T00:08:03Z", "message": "chore (build): leave dateTime out of locally-built versionInfo\n\nTo avoid gradle deciding that engine's build is always stale."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d84f8ee66ba268d0a49ce48dc8f4287027cf3d8", "author": {"user": {"login": "keturn", "name": "Kevin Turner"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/9d84f8ee66ba268d0a49ce48dc8f4287027cf3d8", "committedDate": "2021-01-18T00:13:20Z", "message": "Merge remote-tracking branch 'origin/develop' into chore/tidy-dist-tasks"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTcwMTEyNzgw", "url": "https://github.com/MovingBlocks/Terasology/pull/4347#pullrequestreview-570112780", "createdAt": "2021-01-18T00:24:51Z", "commit": {"oid": "9d84f8ee66ba268d0a49ce48dc8f4287027cf3d8"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTcwMTI5ODEx", "url": "https://github.com/MovingBlocks/Terasology/pull/4347#pullrequestreview-570129811", "createdAt": "2021-01-18T02:04:17Z", "commit": {"oid": "9d84f8ee66ba268d0a49ce48dc8f4287027cf3d8"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xOFQwMjowNDoxN1rOIVXwWg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0xOFQwMjowNDoyN1rOIVXwdA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTI4MDIxOA==", "bodyText": "This looks pretty fancy. I trust the comment but have no idea how the magic works.", "url": "https://github.com/MovingBlocks/Terasology/pull/4347#discussion_r559280218", "createdAt": "2021-01-18T02:04:17Z", "author": {"login": "Cervator"}, "path": "facades/PC/build.gradle.kts", "diffHunk": "@@ -217,103 +239,78 @@ tasks.register<Copy>(\"createVersionFile\") {\n     filter(FixCrLfFilter::class, \"eol\" to FixCrLfFilter.CrLf.newInstance(\"crlf\"))\n }\n \n-// TODO: This could probably be done more Gradley (engine project resource dir instead of direct path?) and with some variables\n-tasks.register<Copy>(\"copyCreditsFile\") {\n-    description = \"Copies the credits file into the engine's resource dir where it'll be read at runtime\"\n-    from(\"$rootDir/docs\")\n-    into(\"$rootDir/engine/src/main/resources\")\n-    include(\"Credits.md\")\n-}\n-\n-// Main application dist target. Does NOT include any modules.\n-tasks.register<Sync>(\"distApp\") {\n-    description = \"Creates an application package for distribution\"\n+tasks.register<Zip>(\"distForLauncher\") {\n     group = \"terasology dist\"\n+    description = \"Bundles the project to a Launcher-compatible layout.\"\n \n-    dependsOn(\"createVersionFile\")\n-    dependsOn(\"copyCreditsFile\")\n-    dependsOn(\":extractNatives\")\n-    dependsOn(\"jar\")\n-\n-    into(\"${distsDirectory.get().asFile}/app\")\n-    from (\"$rootDir/README.markdown\") {\n-        filter(FixCrLfFilter::class, \"eol\" to FixCrLfFilter.CrLf.newInstance(\"crlf\"))\n-        rename(\"README.markdown\", \"README\")\n-    }\n-    from (\"$rootDir/LICENSE\") {\n-        filter(FixCrLfFilter::class, \"eol\" to FixCrLfFilter.CrLf.newInstance(\"crlf\"))\n-    }\n-    from (\"$rootDir/NOTICE\") {\n-        filter(FixCrLfFilter::class, \"eol\" to FixCrLfFilter.CrLf.newInstance(\"crlf\"))\n-    }\n-    from(\"launchScripts\") {\n-        exclude(\"TeraEd.exe\")\n-    }\n-\n-    from(\"$buildDir/$versionFileName\") {}\n+    archiveFileName.set(\"Terasology.zip\")\n \n-    into(subDirLibs) {\n-        from(configurations.runtimeClasspath)\n-        from(tasks.getByPath(\":engine:jar\"))\n-        from(\"$buildDir/libs\") {\n-            include(\"*.jar\")\n-            rename {\n-                \"Terasology.jar\"\n+    // Launcher expects `libs/Terasology.jar`, no containing folder\n+    // TODO: fix launcher so it can take either structure. It should be able to do without ambiguity.\n+    val defaultLibraryDirectory = \"lib\"\n+    val launcherLibraryDirectory = \"libs\"\n+\n+    this.with(distributions.getByName(\"main\").contents {\n+        eachFile {\n+            val pathSegments = relativePath.segments\n+\n+            when (pathSegments[0]) {\n+                defaultLibraryDirectory -> {\n+                    // Redirect things from lib/ to libs/\n+                    val tail = pathSegments.sliceArray(1 until pathSegments.size)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9d84f8ee66ba268d0a49ce48dc8f4287027cf3d8"}, "originalPosition": 201}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1OTI4MDI0NA==", "bodyText": "I guess this doesn't get in the way of anything? Like runtime hot reloading or stuff like that. Not really sure what this would affect. Assets changing at runtime is one thing but unsure if that'd be affected.", "url": "https://github.com/MovingBlocks/Terasology/pull/4347#discussion_r559280244", "createdAt": "2021-01-18T02:04:27Z", "author": {"login": "Cervator"}, "path": "facades/PC/build.gradle.kts", "diffHunk": "@@ -69,22 +67,27 @@ val displayVersion = versionBase\n \n \n application {\n+    applicationName = \"Terasology\"\n     mainClass.set(extra.get(\"mainClassName\") as String)\n }\n \n-// Adjust as the Gradle 6 upgrade changed this path a bit\n-sourceSets {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9d84f8ee66ba268d0a49ce48dc8f4287027cf3d8"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3a678f8135df9e323b45d60c90139c3a401cd455", "author": {"user": {"login": "keturn", "name": "Kevin Turner"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/3a678f8135df9e323b45d60c90139c3a401cd455", "committedDate": "2021-01-19T20:19:09Z", "message": "chore (build): initial import of start scripts as distributed by gradle\n\nfrom https://github.com/gradle/gradle/tree/f38a522/subprojects/plugins/src/main/resources/org/gradle/api/internal/plugins"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "78a4846b23247110e26442effe7c2527222c6923", "author": {"user": {"login": "keturn", "name": "Kevin Turner"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/78a4846b23247110e26442effe7c2527222c6923", "committedDate": "2021-01-19T20:22:51Z", "message": "chore (build): rename scripts so the syntax highlighting is kinda right\n\nIssue for proper support of this template format is https://youtrack.jetbrains.com/issue/IDEABKL-6135"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "01ae5db1f26f48cf0ee614c982d3d99611406f68", "author": {"user": {"login": "keturn", "name": "Kevin Turner"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/01ae5db1f26f48cf0ee614c982d3d99611406f68", "committedDate": "2021-01-19T20:27:31Z", "message": "fix (build): don't set CLASSPATH in script, use the jar with the classpath in its manifest [Windows]\n\notherwise cmd.exe fails with \"the line is too long\" errors.\nhttps://github.com/gradle/gradle/issues/1989"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "957cd1891f9c6f0babd7b218625f50a05ea61680", "author": {"user": {"login": "keturn", "name": "Kevin Turner"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/957cd1891f9c6f0babd7b218625f50a05ea61680", "committedDate": "2021-01-19T20:46:46Z", "message": "fix (build): clean up after wayword auto-copyright-header-insertion"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5248ea5a945a4aad9c2cf0f5b484dde90159d161", "author": {"user": {"login": "keturn", "name": "Kevin Turner"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/5248ea5a945a4aad9c2cf0f5b484dde90159d161", "committedDate": "2021-01-19T20:49:42Z", "message": "fix (build): don't set CLASSPATH in script, use the jar with the classpath in its manifest [Unix]\n\nUnix shells have a longer line length limit than cmd.exe, but using the jar manifest will be more consistent with Windows and Launcher."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5bb9dd4a2d640fb275b833328813c980b2089100", "author": {"user": {"login": "keturn", "name": "Kevin Turner"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/5bb9dd4a2d640fb275b833328813c980b2089100", "committedDate": "2021-01-19T20:57:02Z", "message": "fix (build): use the jar-classpath start scripts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec9691fa2bede56d43aa37e230056bd20aa57eed", "author": {"user": {"login": "keturn", "name": "Kevin Turner"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/ec9691fa2bede56d43aa37e230056bd20aa57eed", "committedDate": "2021-01-19T21:01:29Z", "message": "Merge remote-tracking branch 'origin/develop' into chore/tidy-dist-tasks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1afeec9df306df29bf17d0cf7ad0ccb0bda297a6", "author": {"user": {"login": "keturn", "name": "Kevin Turner"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/1afeec9df306df29bf17d0cf7ad0ccb0bda297a6", "committedDate": "2021-01-19T21:12:23Z", "message": "chore (build): correct reference to upstream"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "15a8c93b44eaacb74e8b0b6d4279ebf63dc3fd85", "author": {"user": {"login": "keturn", "name": "Kevin Turner"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/15a8c93b44eaacb74e8b0b6d4279ebf63dc3fd85", "committedDate": "2021-01-29T21:51:49Z", "message": "Merge remote-tracking branch 'origin/develop' into chore/tidy-dist-tasks\n\n# Conflicts:\n#\tengine/build.gradle"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "14565ece2112a361a7df21078b06a553321b6d26", "author": {"user": {"login": "keturn", "name": "Kevin Turner"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/14565ece2112a361a7df21078b06a553321b6d26", "committedDate": "2021-01-29T22:04:23Z", "message": "chore (build): remove unused variables (post-merge clean-up)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d476cd6232b45dc0dab5014fa382697edb8188d4", "author": {"user": {"login": "keturn", "name": "Kevin Turner"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/d476cd6232b45dc0dab5014fa382697edb8188d4", "committedDate": "2021-01-30T00:50:47Z", "message": "fix (build): merge clean-up"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6b7694a7085bbcf73eb9900bdb20093ea89fd79d", "author": {"user": {"login": "keturn", "name": "Kevin Turner"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/6b7694a7085bbcf73eb9900bdb20093ea89fd79d", "committedDate": "2021-01-30T00:57:07Z", "message": "chore (build): gradle 6.7 \u2192 6.8.1"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b23dc19c6ee6c309fc2c27e3a316e8372623f240", "author": {"user": {"login": "keturn", "name": "Kevin Turner"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/b23dc19c6ee6c309fc2c27e3a316e8372623f240", "committedDate": "2021-01-30T01:01:53Z", "message": "fix (build): jar.version property deprecated by gradle\n\nand was probably accidental in the first place"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a2533e00448a9ca3a391d02923af99ca98fe59b8", "author": {"user": {"login": "keturn", "name": "Kevin Turner"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/a2533e00448a9ca3a391d02923af99ca98fe59b8", "committedDate": "2021-01-30T01:11:28Z", "message": "Merge branch 'chore/gradle-68' into chore/tidy-dist-tasks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "73888474d0a28a36ef63d19b1711d381b328e19e", "author": {"user": {"login": "keturn", "name": "Kevin Turner"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/73888474d0a28a36ef63d19b1711d381b328e19e", "committedDate": "2021-01-30T04:27:02Z", "message": "test(build): add testDistForLauncher and testDistZip\n\nSome checks to make sure files end up where they are expected."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d9d8aacf5777e87512cf2df55d810829bc2ea22", "author": {"user": {"login": "keturn", "name": "Kevin Turner"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/1d9d8aacf5777e87512cf2df55d810829bc2ea22", "committedDate": "2021-01-30T04:39:45Z", "message": "fix(build): keep start scripts inside distZip's root directory"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTc5NzI5Mjg1", "url": "https://github.com/MovingBlocks/Terasology/pull/4347#pullrequestreview-579729285", "createdAt": "2021-01-30T04:48:51Z", "commit": {"oid": "1d9d8aacf5777e87512cf2df55d810829bc2ea22"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0zMFQwNDo0ODo1MVrOIc6-4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0zMFQwNDo0ODo1MVrOIc6-4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NzE5NzQxMA==", "bodyText": "That's not pretty.\nWe're using precompiled script plugins to cut down on the amount of config we have to use. It sets the gradle plugin name nicely, but this import path is gross. I wonder if that's something we can change without giving up its convenience.\nOr is there a way we can have our Task class auto-imported like the core gradle Tasks seem to be?", "url": "https://github.com/MovingBlocks/Terasology/pull/4347#discussion_r567197410", "createdAt": "2021-01-30T04:48:51Z", "author": {"login": "keturn"}, "path": "facades/PC/build.gradle.kts", "diffHunk": "@@ -3,14 +3,15 @@\n \n // The PC facade is responsible for the primary distribution - a plain Java application runnable on PCs\n \n+import Terasology_dist_gradle.ValidateZipDistribution", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1d9d8aacf5777e87512cf2df55d810829bc2ea22"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1de903aff4163322dae0fc44b8f4a8711b60b730", "author": {"user": {"login": "DarkWeird", "name": "Nail Khanipov"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/1de903aff4163322dae0fc44b8f4a8711b60b730", "committedDate": "2021-01-30T09:34:20Z", "message": "Merge branch 'develop' into chore/gradle-68"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0e82184408ae6f49c66c44f9915aba93d2ec5d34", "author": {"user": {"login": "keturn", "name": "Kevin Turner"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/0e82184408ae6f49c66c44f9915aba93d2ec5d34", "committedDate": "2021-01-30T17:49:18Z", "message": "fix(build): use .flatMap to unwrap Provider<Provider<>>\n\nas recommended by https://discuss.gradle.org/t/un-nesting-provider-provider/38904"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4402383b57ae869e46fd3ff8d028d05eb3087e89", "author": {"user": {"login": "keturn", "name": "Kevin Turner"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/4402383b57ae869e46fd3ff8d028d05eb3087e89", "committedDate": "2021-01-30T17:49:55Z", "message": "Merge remote-tracking branch 'origin/develop' into chore/tidy-dist-tasks"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTc5Nzk5MDQ0", "url": "https://github.com/MovingBlocks/Terasology/pull/4347#pullrequestreview-579799044", "createdAt": "2021-01-30T19:24:38Z", "commit": {"oid": "4402383b57ae869e46fd3ff8d028d05eb3087e89"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0zMFQxOToyNDozOFrOIdBWEg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0zMFQxOToyNDozOFrOIdBWEg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NzMwMTY1MA==", "bodyText": "It would be worthwhile to add a bit of documentation for this Task subclass.", "url": "https://github.com/MovingBlocks/Terasology/pull/4347#discussion_r567301650", "createdAt": "2021-01-30T19:24:38Z", "author": {"login": "keturn"}, "path": "buildSrc/src/main/kotlin/terasology-dist.gradle.kts", "diffHunk": "@@ -0,0 +1,40 @@\n+// Copyright 2021 The Terasology Foundation\n+// SPDX-License-Identifier: Apache-2.0\n+\n+@Suppress(\"UnstableApiUsage\")\n+open class ValidateZipDistribution @Inject constructor(objects: ObjectFactory) : DefaultTask() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4402383b57ae869e46fd3ff8d028d05eb3087e89"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c2cdbdd52c83cd6cdb6831230072993174254e98", "author": {"user": {"login": "keturn", "name": "Kevin Turner"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/c2cdbdd52c83cd6cdb6831230072993174254e98", "committedDate": "2021-01-31T20:17:18Z", "message": "doc(build): document ValidateZipDistribution class"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "50dee4eda909b8d82b8b5e43a5f12d32e5988ea5", "author": {"user": {"login": "keturn", "name": "Kevin Turner"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/50dee4eda909b8d82b8b5e43a5f12d32e5988ea5", "committedDate": "2021-01-31T20:17:51Z", "message": "Merge remote-tracking branch 'origin/develop' into chore/tidy-dist-tasks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e61978ba41555180f33582dc378e29869582f1cf", "author": {"user": {"login": "keturn", "name": "Kevin Turner"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/e61978ba41555180f33582dc378e29869582f1cf", "committedDate": "2021-02-02T08:41:25Z", "message": "Merge branch 'develop' into chore/tidy-dist-tasks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "de53ea48c3b544ced66038b4afbfac935378128a", "author": {"user": {"login": "keturn", "name": "Kevin Turner"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/de53ea48c3b544ced66038b4afbfac935378128a", "committedDate": "2021-02-02T18:08:50Z", "message": "Merge branch 'develop' into chore/gradle-68"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1aba539c65e0c22bce7f22238ba12f2f9750075f", "author": {"user": {"login": "keturn", "name": "Kevin Turner"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/1aba539c65e0c22bce7f22238ba12f2f9750075f", "committedDate": "2021-02-02T20:39:20Z", "message": "Merge remote-tracking branch 'origin/develop' into chore/gradle-68"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1f98da6834703dd3b33839a789e8c1c8d53ec367", "author": {"user": {"login": "keturn", "name": "Kevin Turner"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/1f98da6834703dd3b33839a789e8c1c8d53ec367", "committedDate": "2021-02-02T20:40:35Z", "message": "Merge branch 'chore/gradle-68' into chore/tidy-dist-tasks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "512e8cfe201c98a494ea965a542024b2ccf307d2", "author": {"user": {"login": "keturn", "name": "Kevin Turner"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/512e8cfe201c98a494ea965a542024b2ccf307d2", "committedDate": "2021-02-02T21:09:10Z", "message": "build(PC): get access to kotlin.test as api dependency instead of explicit delegation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTgyMDA5NzUy", "url": "https://github.com/MovingBlocks/Terasology/pull/4347#pullrequestreview-582009752", "createdAt": "2021-02-03T05:14:50Z", "commit": {"oid": "512e8cfe201c98a494ea965a542024b2ccf307d2"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTgyNzA2NTY4", "url": "https://github.com/MovingBlocks/Terasology/pull/4347#pullrequestreview-582706568", "createdAt": "2021-02-03T19:05:44Z", "commit": {"oid": "512e8cfe201c98a494ea965a542024b2ccf307d2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wM1QxOTowNTo0NFrOIfSCcQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wM1QxOTowNTo0NFrOIfSCcQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2OTY3MjMwNQ==", "bodyText": "#4454 (comment)\nGIT_BRANCH no longer used for this", "url": "https://github.com/MovingBlocks/Terasology/pull/4347#discussion_r569672305", "createdAt": "2021-02-03T19:05:44Z", "author": {"login": "keturn"}, "path": "facades/PC/build.gradle.kts", "diffHunk": "@@ -200,12 +200,41 @@ tasks.register<JavaExec>(\"server\") {\n     args(\"-headless\", \"-homedir=$localServerDataPath\")\n }\n \n-// Preps a version file to bundle with PC dists. This eventually goes into the root of a zip file\n-tasks.register<Copy>(\"createVersionFile\") {\n+\n+/*********************************\n+ * Distribution\n+ *\n+ * See also publish.gradle, included near the top.\n+ */\n+\n+tasks.named<Jar>(\"jar\") {\n+    // Launcher expects the main class to be in the file with this name.\n+    archiveFileName.set(\"Terasology.jar\")\n+\n+    manifest {\n+        //TODO: Maybe later add the engine's version number into here?\n+        attributes[\"Main-Class\"] = mainClassName\n+        // A classpath in the manifest avoids the problem of having to put a classpath on the command line and\n+        // \"line is too long\" errors: https://github.com/gradle/gradle/issues/1989\n+        attributes[\"Class-Path\"] = configurations[\"runtimeClasspath\"].joinToString(\" \") { it.name }\n+        attributes[\"Implementation-Title\"] = \"Terasology-\" + project.name\n+        attributes[\"Implementation-Version\"] = \"\"\"${env[\"BUILD_NUMBER\"]}, ${env[\"GIT_BRANCH\"]}, ${env[\"BUILD_ID\"]}\"\"\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "512e8cfe201c98a494ea965a542024b2ccf307d2"}, "originalPosition": 132}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5087712c3aef40202ed595df4e34bcf0ef764156", "author": {"user": {"login": "keturn", "name": "Kevin Turner"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/5087712c3aef40202ed595df4e34bcf0ef764156", "committedDate": "2021-02-03T19:13:29Z", "message": "Merge remote-tracking branch 'origin/develop' into chore/gradle-68"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "683e8ca77a04f8b1415f2da3e243958ea2980dd1", "author": {"user": {"login": "keturn", "name": "Kevin Turner"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/683e8ca77a04f8b1415f2da3e243958ea2980dd1", "committedDate": "2021-02-03T19:13:50Z", "message": "Merge branch 'chore/gradle-68' into chore/tidy-dist-tasks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "976b0ac976cdd48d6cef9b3624bcf13023b7df70", "author": {"user": {"login": "keturn", "name": "Kevin Turner"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/976b0ac976cdd48d6cef9b3624bcf13023b7df70", "committedDate": "2021-02-03T19:17:39Z", "message": "CI: include testDist task"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6e51e06713cc69b23b6c08992bd25fbdd0446f2c", "author": {"user": {"login": "keturn", "name": "Kevin Turner"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/6e51e06713cc69b23b6c08992bd25fbdd0446f2c", "committedDate": "2021-02-03T19:32:08Z", "message": "build(PC): GIT_BRANCH is no longer used for build information"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1240, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}