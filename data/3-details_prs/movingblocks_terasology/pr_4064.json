{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQzOTI2MzEz", "number": 4064, "title": "fix(GameProvider): prevent creating game with duplicate name", "bodyText": "Contains\nFixes #3982\nCustom game name works like Default game name prefix (\"Game\") now.\nIf you create game with name as previously created new game will have name \" \"\nIf previously created game name already have index, then that index will be incremented.\nHow to test\n\ncreate game with name \"X\"\nexit to main menu\ncreate game with name \"X\" again\ncheck save games. You have save games \"X\" and \"X 1\" now.", "createdAt": "2020-07-03T08:29:02Z", "url": "https://github.com/MovingBlocks/Terasology/pull/4064", "merged": true, "mergeCommit": {"oid": "0072af3c438c8b485ba1cefe32d2be62ada1bf37"}, "closed": true, "closedAt": "2020-07-23T18:46:37Z", "author": {"login": "DarkWeird"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcxPEBAAH2gAyNDQzOTI2MzEzOjU4YmZhNWExM2Y4ODdlYjVmYTkxNGU4NmM0ZmNmNGYyZDQ2NTBiMDc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc3zqdRgH2gAyNDQzOTI2MzEzOjE0MGMzZGY3OTA5ZTkzMzVmNDdkZTQwZjIzMTMxZmQ5OGJiYzVkNzU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "58bfa5a13f887eb5fa914e86c4fcf4f2d4650b07", "author": {"user": {"login": "DarkWeird", "name": "Nail Khanipov"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/58bfa5a13f887eb5fa914e86c4fcf4f2d4650b07", "committedDate": "2020-07-03T08:21:20Z", "message": "fix(new_game_name): Fix error with creating game, which have equals name as exists save"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2Njg1ODY0", "url": "https://github.com/MovingBlocks/Terasology/pull/4064#pullrequestreview-446685864", "createdAt": "2020-07-10T20:35:21Z", "commit": {"oid": "58bfa5a13f887eb5fa914e86c4fcf4f2d4650b07"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQyMDozNToyMVrOGwE5yg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQyMDo0ODoxOVrOGwFNMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzA2NTE2Mg==", "bodyText": "isn't this check included in the next one?", "url": "https://github.com/MovingBlocks/Terasology/pull/4064#discussion_r453065162", "createdAt": "2020-07-10T20:35:21Z", "author": {"login": "skaldarnar"}, "path": "engine-tests/src/test/java/org/terasology/rendering/nui/layers/mainMenu/savedGames/GameProviderTest.java", "diffHunk": "@@ -162,6 +178,15 @@ public void getNextGameNameDefaultNoSavesTest() {\n         assertEquals(GAME_1, name);\n     }\n \n+    @Test\n+    public void getNextGameNameCustomNoSavesTest() {\n+        String gameName = \"Custom\";\n+        final String name = GameProvider.getNextGameName(gameName);\n+\n+        assertNotNull(name);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "58bfa5a13f887eb5fa914e86c4fcf4f2d4650b07"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzA2NjE0OQ==", "bodyText": "What do you think of creating a method for this called mimicSaveGame(customSavesFolder, gameName)?", "url": "https://github.com/MovingBlocks/Terasology/pull/4064#discussion_r453066149", "createdAt": "2020-07-10T20:37:58Z", "author": {"login": "skaldarnar"}, "path": "engine-tests/src/test/java/org/terasology/rendering/nui/layers/mainMenu/savedGames/GameProviderTest.java", "diffHunk": "@@ -175,6 +200,21 @@ public void getNextGameNameNumberTest() throws IOException {\n         assertEquals(\"Game 2\", name);\n     }\n \n+    @ParameterizedTest(name = \"getNextGameName(\\\"{0}\\\") -> \\\"{1}\\\"\")\n+    @MethodSource(\"nextGameNamesProvider\")\n+    public void getNextGameNameNumberCustomNameTest(String gameName, String nextGameName) throws IOException {\n+\n+        Path customSaveFolder = TMP_SAVES_FOLDER_PATH.resolve(gameName);\n+        Files.createDirectories(customSaveFolder);\n+        Path manifestFilePath = customSaveFolder.resolve(GameManifest.DEFAULT_FILE_NAME);\n+        writeToFile(manifestFilePath, MANIFEST_EXAMPLE.replace(GAME_1, gameName));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "58bfa5a13f887eb5fa914e86c4fcf4f2d4650b07"}, "originalPosition": 75}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzA2NjcwOA==", "bodyText": "Why is this necessary? shouldn't this be covered by getNextGameName(gameName)?", "url": "https://github.com/MovingBlocks/Terasology/pull/4064#discussion_r453066708", "createdAt": "2020-07-10T20:39:34Z", "author": {"login": "skaldarnar"}, "path": "engine/src/main/java/org/terasology/rendering/nui/layers/mainMenu/savedGames/GameProvider.java", "diffHunk": "@@ -110,21 +111,42 @@ public static boolean isSavesFolderEmpty() {\n     }\n \n     /**\n-     * Generates the game name based on the game number of the last saved game\n+     * Generates the game name based on the game number of the last saved game Uses {@link\n+     * GameProvider#DEFAULT_GAME_NAME_PREFIX} for resolve.\n      */\n     public static String getNextGameName() {\n+        String nextGameName = getNextGameName(DEFAULT_GAME_NAME_PREFIX);\n+        if (nextGameName.equals(DEFAULT_GAME_NAME_PREFIX)) {\n+            return nextGameName + 1;\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "58bfa5a13f887eb5fa914e86c4fcf4f2d4650b07"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzA3MDEyOQ==", "bodyText": "This prefix match and handling looks a bit shaky to me. We probably should define way more tests to define what we expect here...", "url": "https://github.com/MovingBlocks/Terasology/pull/4064#discussion_r453070129", "createdAt": "2020-07-10T20:48:19Z", "author": {"login": "skaldarnar"}, "path": "engine/src/main/java/org/terasology/rendering/nui/layers/mainMenu/savedGames/GameProvider.java", "diffHunk": "@@ -110,21 +111,42 @@ public static boolean isSavesFolderEmpty() {\n     }\n \n     /**\n-     * Generates the game name based on the game number of the last saved game\n+     * Generates the game name based on the game number of the last saved game Uses {@link\n+     * GameProvider#DEFAULT_GAME_NAME_PREFIX} for resolve.\n      */\n     public static String getNextGameName() {\n+        String nextGameName = getNextGameName(DEFAULT_GAME_NAME_PREFIX);\n+        if (nextGameName.equals(DEFAULT_GAME_NAME_PREFIX)) {\n+            return nextGameName + 1;\n+        }\n+        return nextGameName;\n+    }\n+\n+    /**\n+     * Generates the game name based on the game number of the last saved game\n+     *\n+     * @param gameName will to use as game prefix, if saves contains this game name\n+     * @return next game name with number. Example: \"Game\" -> \"Game 1\", \"Game 1 -> Game 2\"\n+     */\n+    public static String getNextGameName(String gameName) {\n         int gameNumber = 1;\n+        String name = gameName;\n         for (GameInfo info : GameProvider.getSavedGames()) {\n-            if (info.getManifest().getTitle().startsWith(DEFAULT_GAME_NAME_PREFIX)) {\n-                String remainder = info.getManifest().getTitle().substring(DEFAULT_GAME_NAME_PREFIX.length());\n+            if (info.getManifest().getTitle().startsWith(name)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "58bfa5a13f887eb5fa914e86c4fcf4f2d4650b07"}, "originalPosition": 47}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0641ed142b7c85b52543df2b48eec1c4231855fd", "author": {"user": {"login": "skaldarnar", "name": "Tobias Nett"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/0641ed142b7c85b52543df2b48eec1c4231855fd", "committedDate": "2020-07-10T22:40:58Z", "message": "add NumberedGameName data container to model numbered game names"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f4e103ec88c4090e5658e5876a853536e9a4f2ba", "author": {"user": {"login": "skaldarnar", "name": "Tobias Nett"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/f4e103ec88c4090e5658e5876a853536e9a4f2ba", "committedDate": "2020-07-10T22:49:51Z", "message": "use NumberedGameName to determine next game name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6754e8da2ee619e06decbecb988a54a52c3d00a8", "author": {"user": {"login": "skaldarnar", "name": "Tobias Nett"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/6754e8da2ee619e06decbecb988a54a52c3d00a8", "committedDate": "2020-07-10T23:00:17Z", "message": "fix: apply matcher and throw IAE in case of unexpected parsing error"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "90e33dbc012b8934830d1fc9e5b9e0d3a963e50d", "author": {"user": {"login": "DarkWeird", "name": "Nail Khanipov"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/90e33dbc012b8934830d1fc9e5b9e0d3a963e50d", "committedDate": "2020-07-13T19:43:22Z", "message": "chore(new-game-name): Cleanup code, add Test, rename default GameName in tests."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f0b1fcc90563bee74f82e89479e51159a432a954", "author": {"user": {"login": "DarkWeird", "name": "Nail Khanipov"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/f0b1fcc90563bee74f82e89479e51159a432a954", "committedDate": "2020-07-13T20:01:08Z", "message": "fix: wait more for savegames tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUyODA2NTg1", "url": "https://github.com/MovingBlocks/Terasology/pull/4064#pullrequestreview-452806585", "createdAt": "2020-07-21T20:31:54Z", "commit": {"oid": "f0b1fcc90563bee74f82e89479e51159a432a954"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d7c94d6e4530be6cc396b03d12dbe67f7b6f3e1e", "author": {"user": {"login": "skaldarnar", "name": "Tobias Nett"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/d7c94d6e4530be6cc396b03d12dbe67f7b6f3e1e", "committedDate": "2020-07-21T20:58:10Z", "message": "fix: even more waiting..."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d2ec69d49445dcdcf0ce507dda80932e9028c7be", "author": {"user": {"login": "jdrueckert", "name": null}}, "url": "https://github.com/MovingBlocks/Terasology/commit/d2ec69d49445dcdcf0ce507dda80932e9028c7be", "committedDate": "2020-07-23T16:23:21Z", "message": "fix(tests): try longer sleep to save games properly"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7e679c2476312fb459c3e5872c136ebc0aa14ee9", "author": {"user": {"login": "jdrueckert", "name": null}}, "url": "https://github.com/MovingBlocks/Terasology/commit/7e679c2476312fb459c3e5872c136ebc0aa14ee9", "committedDate": "2020-07-23T16:45:49Z", "message": "fix(tests): reduce sleep time and integrate in mimicGameName"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ffac0cb2c248bf8a10cc42380ff01d0e7698e744", "author": {"user": {"login": "jdrueckert", "name": null}}, "url": "https://github.com/MovingBlocks/Terasology/commit/ffac0cb2c248bf8a10cc42380ff01d0e7698e744", "committedDate": "2020-07-23T16:54:54Z", "message": "fix: `InterruptedException` can be thrown"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "272f197deec1e44e679b084fc1e077eb264caba7", "author": {"user": {"login": "jdrueckert", "name": null}}, "url": "https://github.com/MovingBlocks/Terasology/commit/272f197deec1e44e679b084fc1e077eb264caba7", "committedDate": "2020-07-23T17:21:35Z", "message": "fix: keep it simple stupid: use delay constant"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4a264c7cc3e9f2a2e5d07ce5c7d2d41f73d5afe8", "author": {"user": {"login": "jdrueckert", "name": null}}, "url": "https://github.com/MovingBlocks/Terasology/commit/4a264c7cc3e9f2a2e5d07ce5c7d2d41f73d5afe8", "committedDate": "2020-07-23T17:46:47Z", "message": "fix: increase timestamp delay a bit more"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "01feafd42ac60da4fa2eff8e6efd0609a428e7a0", "author": {"user": {"login": "jdrueckert", "name": null}}, "url": "https://github.com/MovingBlocks/Terasology/commit/01feafd42ac60da4fa2eff8e6efd0609a428e7a0", "committedDate": "2020-07-23T18:05:11Z", "message": "fix: increase timestamp delay some more"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "140c3df7909e9335f47de40f23131fd98bbc5d75", "author": {"user": {"login": "jdrueckert", "name": null}}, "url": "https://github.com/MovingBlocks/Terasology/commit/140c3df7909e9335f47de40f23131fd98bbc5d75", "committedDate": "2020-07-23T18:23:27Z", "message": "fix: increase timestamp delay even more"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1364, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}