{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIyMjk2ODUz", "number": 3978, "title": "feat: Ceiling BlockFamily", "bodyText": "This PR adds a new rotation family that causes blocks to always face the player, supporting upright and upside down block placement.\nThe family behaves similar to the HorizontalFamily, but puts blocks upside down in case they are being attached to the bottom side of another block. Its purpose is to be used for stairs and other things that need to be attached to the ceiling upside down. Unfortunately, it is currently impossible actually use this block family for stairs, since stairs are a block shape, and the engine doesn't support assigning block families to shapes. Addressing this problem is another issue though.\nImplementing this block families behavior was previously not possible, due to limitations in the BlockFamily interface. Its getBlockForPlacement() method was supposed to determine the orientation of a new block based on the attachment side, and an additional \"direction side\".\nThese don't provide enough information to have a block face the player in every scenario, in which this would be the desired behavior. I fixed this by replacing the \"direction side\" parameter with a Vector3f, intended to be used for passing the player's viewing direction.\nThis gives the block family more information to determine the block orientation. The previously passed \"direction side\" can be derived from the viewing direction, doing so is now the block family's responsibility.\nTest\nAssign the new block family to a furnace by adding the following line to the furnace.block json file.\n\"family\": \"ceilingSupportingHorizontal\",\nAdd furnaces to your inventory using give furnace 10 and attach them to different block sides. Verify they behave as described above.\nNotable\nThis PR is based on this one #3771, it's fixing misbehavior and is supposed to replace the other.\nThe 'Furnishings'-module is incompatible to this PR.\nThe fix can be found here: #1.", "createdAt": "2020-05-23T16:33:26Z", "url": "https://github.com/MovingBlocks/Terasology/pull/3978", "merged": true, "mergeCommit": {"oid": "f130438ae93d01b483aef6a40590e1273ae56bc6"}, "closed": true, "closedAt": "2020-05-30T22:49:23Z", "author": {"login": "kBlaszczyk"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABckL-y3AFqTQxNzMwMTYwNg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcmfF3UAFqTQyMTQ0ODcyNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3MzAxNjA2", "url": "https://github.com/MovingBlocks/Terasology/pull/3978#pullrequestreview-417301606", "createdAt": "2020-05-23T19:09:55Z", "commit": {"oid": "09e99909e70558a66a60d95f6b50fa3ff5e1e189"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yM1QxOTowOTo1NVrOGZq6lQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yM1QxOToyNDozMlrOGZq-VQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU3MDcwOQ==", "bodyText": "At least the method signature changes, so we can spot breaking families easily. I don't see an easy way to make this work in a backwards compatible way, so let's do this step!\nI'll check the Omega workspace for a full list of breaking block families \ud83d\ude48", "url": "https://github.com/MovingBlocks/Terasology/pull/3978#discussion_r429570709", "createdAt": "2020-05-23T19:09:55Z", "author": {"login": "skaldarnar"}, "path": "engine/src/main/java/org/terasology/world/block/family/BlockFamily.java", "diffHunk": "@@ -42,12 +43,12 @@\n     /**\n      * Get the block that is appropriate for placement in the given situation\n      *\n-     * @param location            The location where the block is going to be placed.\n-     * @param attachmentSide      The side of the block which this block is being attached to, e.g. Top if the block is being placed on the ground\n-     * @param direction           A secondary direction after the attachment side that determines the facing of the block.\n+     * @param location          The location where the block is going to be placed\n+     * @param attachmentSide    The side of the block which this block is being attached to, e.g. Top if the block is being placed on the ground\n+     * @param viewingDirection  The player's viewing direction\n      * @return The appropriate block\n      */\n-    Block getBlockForPlacement(Vector3i location, Side attachmentSide, Side direction);\n+    Block getBlockForPlacement(Vector3i location, Side attachmentSide, Vector3fc viewingDirection);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "09e99909e70558a66a60d95f6b50fa3ff5e1e189"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU3MTExOQ==", "bodyText": "This is a bit more clunky than what you've done HorizontalFamily. What's the difference?\nSide secondaryDirection = Side.inDirection(-viewingDirection.x(), 0, -viewingDirection.z());\nAs I cannot spot any other changes around the Side direction in both cases, shouldn't those two be the same?", "url": "https://github.com/MovingBlocks/Terasology/pull/3978#discussion_r429571119", "createdAt": "2020-05-23T19:16:06Z", "author": {"login": "skaldarnar"}, "path": "engine/src/main/java/org/terasology/world/block/family/FreeformFamily.java", "diffHunk": "@@ -75,7 +79,10 @@ public FreeformFamily(BlockFamilyDefinition blockFamilyDefinition, BlockBuilderH\n \n \n     @Override\n-    public Block getBlockForPlacement(Vector3i location, Side attachmentSide, Side direction) {\n+    public Block getBlockForPlacement(Vector3i location, Side attachmentSide, Vector3fc viewingDirection) {\n+        Vector3f attachmentSideNormal = new org.joml.Vector3f(attachmentSide.direction());\n+        Side direction = ChunkMath.getSecondaryPlacementDirection(JomlUtil.from(viewingDirection), JomlUtil.from(attachmentSideNormal));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "09e99909e70558a66a60d95f6b50fa3ff5e1e189"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU3MTY2OQ==", "bodyText": "What's this about - just better naming? Please move/copy the JavaDoc over to the non-deprecated method if you want to leave this change in.", "url": "https://github.com/MovingBlocks/Terasology/pull/3978#discussion_r429571669", "createdAt": "2020-05-23T19:24:32Z", "author": {"login": "skaldarnar"}, "path": "engine/src/main/java/org/terasology/math/Rotation.java", "diffHunk": "@@ -218,8 +218,15 @@ public int hashCode() {\n      * Returns all possible rotations for each yaw, pitch & roll combination, including duplicates.\n      *\n      * @return All possible rotations for each yaw, pitch & roll combination.\n+     *\n+     * @deprecated use `allRotations` instead\n      */\n+    @Deprecated\n     public static Iterable<Rotation> allValues() {\n+        return allRotations();\n+    }\n+\n+    public static Iterable<Rotation> allRotations() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "09e99909e70558a66a60d95f6b50fa3ff5e1e189"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e3ebeb3de4f4d6af54f7f51498b8d4c5372b57e8", "author": {"user": null}, "url": "https://github.com/MovingBlocks/Terasology/commit/e3ebeb3de4f4d6af54f7f51498b8d4c5372b57e8", "committedDate": "2020-05-29T20:40:58Z", "message": "Add in a family that almost works."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5a075726e67fc122dd86faf7f6b36105674a3e5d", "author": {"user": {"login": "skaldarnar", "name": "Tobias Nett"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/5a075726e67fc122dd86faf7f6b36105674a3e5d", "committedDate": "2020-05-29T21:32:29Z", "message": "* Add Rotation.allRotations() and deprecate allValues()\n* Add in new documentation for the BlockBuilderHelper class."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4ad020b96b50e490eabfa675432a49ed1d0b3c11", "author": {"user": {"login": "kBlaszczyk", "name": "Kevin Blaszczyk"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/4ad020b96b50e490eabfa675432a49ed1d0b3c11", "committedDate": "2020-05-30T11:53:02Z", "message": "Add BlockFamily providing upside down block rotation"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "09e99909e70558a66a60d95f6b50fa3ff5e1e189", "author": {"user": {"login": "kBlaszczyk", "name": "Kevin Blaszczyk"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/09e99909e70558a66a60d95f6b50fa3ff5e1e189", "committedDate": "2020-05-23T16:25:19Z", "message": "Rename block family."}, "afterCommit": {"oid": "4ad020b96b50e490eabfa675432a49ed1d0b3c11", "author": {"user": {"login": "kBlaszczyk", "name": "Kevin Blaszczyk"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/4ad020b96b50e490eabfa675432a49ed1d0b3c11", "committedDate": "2020-05-30T11:53:02Z", "message": "Add BlockFamily providing upside down block rotation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxNDAxNzU1", "url": "https://github.com/MovingBlocks/Terasology/pull/3978#pullrequestreview-421401755", "createdAt": "2020-05-30T12:28:45Z", "commit": {"oid": "4ad020b96b50e490eabfa675432a49ed1d0b3c11"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxNDA5NTc4", "url": "https://github.com/MovingBlocks/Terasology/pull/3978#pullrequestreview-421409578", "createdAt": "2020-05-30T14:36:34Z", "commit": {"oid": "4ad020b96b50e490eabfa675432a49ed1d0b3c11"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMFQxNDozNjozNFrOGcy10w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMFQxNDozODo1OFrOGcy2ZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjg0NjI5MQ==", "bodyText": "What does this do? We are in an interface, where should we inherit from?", "url": "https://github.com/MovingBlocks/Terasology/pull/3978#discussion_r432846291", "createdAt": "2020-05-30T14:36:34Z", "author": {"login": "skaldarnar"}, "path": "engine/src/main/java/org/terasology/world/block/BlockBuilderHelper.java", "diffHunk": "@@ -21,23 +21,101 @@\n import org.terasology.world.block.loader.SectionDefinitionData;\n import org.terasology.world.block.shapes.BlockShape;\n \n+/**\n+ * A helper class for building and registering blocks with specific properties.\n+ * Intended for use with Block Family related code.\n+ * <p>\n+ * The core features of this helper is to convert from definition data, into a Block\n+ * and to register this block into the engine for use.\n+ */\n public interface BlockBuilderHelper {\n \n+    /**\n+     * {@inheritDoc}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ad020b96b50e490eabfa675432a49ed1d0b3c11"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjg0NjM0OQ==", "bodyText": "Let's remove this change if not used...", "url": "https://github.com/MovingBlocks/Terasology/pull/3978#discussion_r432846349", "createdAt": "2020-05-30T14:37:27Z", "author": {"login": "skaldarnar"}, "path": "engine/src/main/java/org/terasology/math/Rotation.java", "diffHunk": "@@ -218,8 +218,15 @@ public int hashCode() {\n      * Returns all possible rotations for each yaw, pitch & roll combination, including duplicates.\n      *\n      * @return All possible rotations for each yaw, pitch & roll combination.\n+     *\n+     * @deprecated use `allRotations` instead\n      */\n+    @Deprecated\n     public static Iterable<Rotation> allValues() {\n+        return allRotations();\n+    }\n+\n+    public static Iterable<Rotation> allRotations() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU3MTY2OQ=="}, "originalCommit": {"oid": "09e99909e70558a66a60d95f6b50fa3ff5e1e189"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjg0NjQzNw==", "bodyText": "What are \"reasonable defaults\"? What kind of defaults are we talking about/defaults for what?", "url": "https://github.com/MovingBlocks/Terasology/pull/3978#discussion_r432846437", "createdAt": "2020-05-30T14:38:58Z", "author": {"login": "skaldarnar"}, "path": "engine/src/main/java/org/terasology/world/block/BlockBuilderHelper.java", "diffHunk": "@@ -21,23 +21,101 @@\n import org.terasology.world.block.loader.SectionDefinitionData;\n import org.terasology.world.block.shapes.BlockShape;\n \n+/**\n+ * A helper class for building and registering blocks with specific properties.\n+ * Intended for use with Block Family related code.\n+ * <p>\n+ * The core features of this helper is to convert from definition data, into a Block\n+ * and to register this block into the engine for use.\n+ */\n public interface BlockBuilderHelper {\n \n+    /**\n+     * {@inheritDoc}\n+     *\n+     * @see #constructSimpleBlock(BlockFamilyDefinition, BlockShape, String, BlockUri, BlockFamily)\n+     */\n     Block constructSimpleBlock(BlockFamilyDefinition definition, BlockUri uri, BlockFamily blockFamily);\n \n+    /**\n+     * {@inheritDoc}\n+     *\n+     * @see #constructSimpleBlock(BlockFamilyDefinition, BlockShape, String, BlockUri, BlockFamily)\n+     */\n     Block constructSimpleBlock(BlockFamilyDefinition definition, BlockShape shape, BlockUri uri, BlockFamily blockFamily);\n \n+    /**\n+     * {@inheritDoc}\n+     *\n+     * @see #constructSimpleBlock(BlockFamilyDefinition, BlockShape, String, BlockUri, BlockFamily)\n+     */\n     Block constructSimpleBlock(BlockFamilyDefinition definition, String section, BlockUri uri, BlockFamily blockFamily);\n \n+    /**\n+     * Constructs a basic block from the data provided. This block is assumed to have no rotations, and to use reasonable defaults", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ad020b96b50e490eabfa675432a49ed1d0b3c11"}, "originalPosition": 35}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d7f2582d8e8000f0c8297f6f540f9603671c4438", "author": {"user": {"login": "kBlaszczyk", "name": "Kevin Blaszczyk"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/d7f2582d8e8000f0c8297f6f540f9603671c4438", "committedDate": "2020-05-30T14:52:33Z", "message": "Fix Javadoc in BlockBuilderHelper"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "122ebc375526daf709fa8077df074cbc958ffd85", "author": {"user": {"login": "kBlaszczyk", "name": "Kevin Blaszczyk"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/122ebc375526daf709fa8077df074cbc958ffd85", "committedDate": "2020-05-30T14:54:56Z", "message": "Revert change in Rotation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxNDQ4NzI1", "url": "https://github.com/MovingBlocks/Terasology/pull/3978#pullrequestreview-421448725", "createdAt": "2020-05-30T22:48:40Z", "commit": {"oid": "122ebc375526daf709fa8077df074cbc958ffd85"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1570, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}