{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE5NjYzMzUy", "number": 3968, "title": "feat: Particle pool rendering", "bodyText": "Contains\nThis PR improves the rendering of particle pools.\nInstead of rendering each particle individually, all particles in a particle pool are rendered at once.\nThe particle quads are generated on the GPU using a geometry shader. The rendering result should be practically identical to the previous implementation.\nI added support for geometry shaders in GLSLShader. The class demanded version 1.2 shaders to be used. Since my implementation relies on OpenGL 3.3, I also added support for arbitrary shader versions. 1.2 is still used as the default in case no version is provided in a shader.\nNote that the current implementation requires the version definition (\"#version xxx\") to be the very first line of the shader file.\nI turned ParticlePool into a \"drawable\", which means it can now be rendered like a mesh. Note that this makes the class dependent on OpenGL.\nHow to test\nDestroy some blocks and verify that the block particles are being rendered as expected. You can also use the WeatherManager module and take a look at the weather particles.", "createdAt": "2020-05-18T18:17:10Z", "url": "https://github.com/MovingBlocks/Terasology/pull/3968", "merged": true, "mergeCommit": {"oid": "ecc802154408797f7cee995e1e7c12d809d94d41"}, "closed": true, "closedAt": "2020-06-01T17:38:31Z", "author": {"login": "kBlaszczyk"}, "timelineItems": {"totalCount": 19, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcikRW9gFqTQxMzgzODY2OA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcjtWppAFqTQxNjcxMTM4Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzODM4NjY4", "url": "https://github.com/MovingBlocks/Terasology/pull/3968#pullrequestreview-413838668", "createdAt": "2020-05-18T18:29:32Z", "commit": {"oid": "2cdeb9b68e5f1497d2965f29e17c3f32fb215db6"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxODoyOTozMlrOGXC23w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQxODozMzozM1rOGXC-pA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjgxNzI0Nw==", "bodyText": "The only reason for me to not do this automatically in the constructor is that the glMethods are breaking the unit tests, because they run without an OpenGL context.", "url": "https://github.com/MovingBlocks/Terasology/pull/3968#discussion_r426817247", "createdAt": "2020-05-18T18:29:32Z", "author": {"login": "kBlaszczyk"}, "path": "engine/src/main/java/org/terasology/particles/ParticlePool.java", "diffHunk": "@@ -225,6 +240,74 @@ public void storeTemporaryDataAt(final int index, final int rawMask) {\n         }\n     }\n \n+    /**\n+     * Initializes this particle pool for rendering.\n+     * The method should be called right after object creation.\n+     */\n+    public void initRendering() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2cdeb9b68e5f1497d2965f29e17c3f32fb215db6"}, "originalPosition": 89}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjgxOTIzNg==", "bodyText": "The compilation validation moved into compileShader().", "url": "https://github.com/MovingBlocks/Terasology/pull/3968#discussion_r426819236", "createdAt": "2020-05-18T18:33:33Z", "author": {"login": "kBlaszczyk"}, "path": "engine/src/main/java/org/terasology/rendering/opengl/GLSLShader.java", "diffHunk": "@@ -257,23 +261,17 @@ private void registerAllShaderPermutations() {\n         Set<Set<ShaderProgramFeature>> allPermutations = Sets.powerSet(availableFeatures);\n \n         for (Set<ShaderProgramFeature> permutation : allPermutations) {\n+            int featureHash = ShaderProgramFeature.getBitset(permutation);\n+\n             int fragShaderId = compileShader(GL20.GL_FRAGMENT_SHADER, permutation);\n             int vertShaderId = compileShader(GL20.GL_VERTEX_SHADER, permutation);\n-\n-            if (compileSuccess(fragShaderId) && compileSuccess(vertShaderId)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2cdeb9b68e5f1497d2965f29e17c3f32fb215db6"}, "originalPosition": 36}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "38a620f5a946f94d9e4bea89010358cb0423db34", "author": {"user": {"login": "kBlaszczyk", "name": "Kevin Blaszczyk"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/38a620f5a946f94d9e4bea89010358cb0423db34", "committedDate": "2020-05-21T20:09:17Z", "message": "Add shader to render particle position buffer."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "be6c9e1a9a63f03440dea2e5159e07a0d2862501", "author": {"user": {"login": "kBlaszczyk", "name": "Kevin Blaszczyk"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/be6c9e1a9a63f03440dea2e5159e07a0d2862501", "committedDate": "2020-05-21T20:09:17Z", "message": "Make particle pool renderable."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e809de6c719d1b68b7b1c3de8aa10e8216883078", "author": {"user": {"login": "kBlaszczyk", "name": "Kevin Blaszczyk"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/e809de6c719d1b68b7b1c3de8aa10e8216883078", "committedDate": "2020-05-21T20:09:17Z", "message": "Render all particles in a pool in one go"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0b96d3dc8a62b8b7c6985af618264ee21defc7bb", "author": {"user": {"login": "kBlaszczyk", "name": "Kevin Blaszczyk"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/0b96d3dc8a62b8b7c6985af618264ee21defc7bb", "committedDate": "2020-05-21T20:09:17Z", "message": "Render particles as quads using a geometry shader."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ff3f2ebec0f851035d3a07ac143a462c9b19a5aa", "author": {"user": {"login": "kBlaszczyk", "name": "Kevin Blaszczyk"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/ff3f2ebec0f851035d3a07ac143a462c9b19a5aa", "committedDate": "2020-05-21T20:09:17Z", "message": "Add alpha blending when rendering particles"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dcbc5f2333542ae712fb7d390bcaafe3807a2e4d", "author": {"user": {"login": "kBlaszczyk", "name": "Kevin Blaszczyk"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/dcbc5f2333542ae712fb7d390bcaafe3807a2e4d", "committedDate": "2020-05-21T20:09:17Z", "message": "Render particles using textures."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c93fa502db8358175b0f78f895ffa372b62fe17a", "author": {"user": {"login": "kBlaszczyk", "name": "Kevin Blaszczyk"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/c93fa502db8358175b0f78f895ffa372b62fe17a", "committedDate": "2020-05-21T20:09:17Z", "message": "Fix view projection matrix usage."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "528f9bee689e00d3a2883f2644ec68de94d010ce", "author": {"user": {"login": "kBlaszczyk", "name": "Kevin Blaszczyk"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/528f9bee689e00d3a2883f2644ec68de94d010ce", "committedDate": "2020-05-21T20:09:17Z", "message": "Support scaling the particles' quads"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f4bebabcd3e938240a9f35124c6d406d49792a3e", "author": {"user": {"login": "kBlaszczyk", "name": "Kevin Blaszczyk"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/f4bebabcd3e938240a9f35124c6d406d49792a3e", "committedDate": "2020-05-21T20:09:17Z", "message": "Support texture offsets and colors for particles"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fe4d783ad63eed989ba05022a322962f660ce208", "author": {"user": {"login": "kBlaszczyk", "name": "Kevin Blaszczyk"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/fe4d783ad63eed989ba05022a322962f660ce208", "committedDate": "2020-05-21T20:09:17Z", "message": "Add support for custom shader versions to GLSLShader"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "92be8c015c05cb9faae339ca59430202685da09c", "author": {"user": {"login": "kBlaszczyk", "name": "Kevin Blaszczyk"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/92be8c015c05cb9faae339ca59430202685da09c", "committedDate": "2020-05-21T20:09:17Z", "message": "Replace old particle shaders."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5285f40754caeda9fb75e8e723ea15e5d147c6d9", "author": {"user": {"login": "kBlaszczyk", "name": "Kevin Blaszczyk"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/5285f40754caeda9fb75e8e723ea15e5d147c6d9", "committedDate": "2020-05-21T20:09:17Z", "message": "Fix texture offsets in particle shader"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d944a3f269aff568de9298c430046fb67852478", "author": {"user": {"login": "kBlaszczyk", "name": "Kevin Blaszczyk"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/8d944a3f269aff568de9298c430046fb67852478", "committedDate": "2020-05-21T20:09:17Z", "message": "Clean up the branch"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2cdeb9b68e5f1497d2965f29e17c3f32fb215db6", "author": {"user": {"login": "kBlaszczyk", "name": "Kevin Blaszczyk"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/2cdeb9b68e5f1497d2965f29e17c3f32fb215db6", "committedDate": "2020-05-18T18:15:14Z", "message": "Clean up the branch"}, "afterCommit": {"oid": "7eff136b815dfa167c659ec33ed5197f6e1310e9", "author": {"user": {"login": "kBlaszczyk", "name": "Kevin Blaszczyk"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/7eff136b815dfa167c659ec33ed5197f6e1310e9", "committedDate": "2020-05-21T20:19:51Z", "message": "Add new required OpenGL capabilities to LwjglGraphics"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE2NDY1MjYz", "url": "https://github.com/MovingBlocks/Terasology/pull/3968#pullrequestreview-416465263", "createdAt": "2020-05-21T20:24:14Z", "commit": {"oid": "7eff136b815dfa167c659ec33ed5197f6e1310e9"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "33a77efe7ed251b3735463d6f8b26f5ea51dc8f3", "author": {"user": {"login": "kBlaszczyk", "name": "Kevin Blaszczyk"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/33a77efe7ed251b3735463d6f8b26f5ea51dc8f3", "committedDate": "2020-05-21T21:00:12Z", "message": "Add new required OpenGL capabilities to LwjglGraphics"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7eff136b815dfa167c659ec33ed5197f6e1310e9", "author": {"user": {"login": "kBlaszczyk", "name": "Kevin Blaszczyk"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/7eff136b815dfa167c659ec33ed5197f6e1310e9", "committedDate": "2020-05-21T20:19:51Z", "message": "Add new required OpenGL capabilities to LwjglGraphics"}, "afterCommit": {"oid": "33a77efe7ed251b3735463d6f8b26f5ea51dc8f3", "author": {"user": {"login": "kBlaszczyk", "name": "Kevin Blaszczyk"}}, "url": "https://github.com/MovingBlocks/Terasology/commit/33a77efe7ed251b3735463d6f8b26f5ea51dc8f3", "committedDate": "2020-05-21T21:00:12Z", "message": "Add new required OpenGL capabilities to LwjglGraphics"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE2NzExMzg2", "url": "https://github.com/MovingBlocks/Terasology/pull/3968#pullrequestreview-416711386", "createdAt": "2020-05-22T07:43:54Z", "commit": {"oid": "33a77efe7ed251b3735463d6f8b26f5ea51dc8f3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1552, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}