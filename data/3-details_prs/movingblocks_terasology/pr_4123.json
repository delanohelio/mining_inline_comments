{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY2ODU4OTUz", "number": 4123, "title": "Adds new method in AbstractValueModifiableEvent to obtain result value without capping", "bodyText": "Adds a new getResultValueWithoutCapping() method which returns result value without capping the negative values to zero.\nWith this PR, the event shall support all values both positive and negative.\nFormula for calculating the result value int the new getResultValueWithoutCapping() method would be:\n\nresult = ( + \u03a3 ) * \u03a0  + \u03a3 \n\ninstead of the one in the original getResultValue() :\n\nresult = max(0, ( + \u03a3 ) * \u03a0  + \u03a3 )\n\nIn short: This means the event now has two methods for calculating the result values:\n\nevent.getResultValue()    // always positive\nevent.getResultValueWithoutCapping()  // can also be negative\n\nTo Test : see #4123 (comment)\nUpdated : Detailed testing instructions : Terasology/ClimateConditions#29 (comment)", "createdAt": "2020-08-12T15:48:36Z", "url": "https://github.com/MovingBlocks/Terasology/pull/4123", "merged": true, "mergeCommit": {"oid": "5782cd35f725e4c5b882bd313b7a41c5ba1d7740"}, "closed": true, "closedAt": "2020-08-23T15:26:06Z", "author": {"login": "ktksan"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc-g8s1gH2gAyNDY2ODU4OTUzOmU5ZTdhYzkzMDg2MmYzZGVmZDkwYmNhMzhjMDViYzkxOGNkOTM0OWQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdBvtC9AFqTQ3MzAyMDQwMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e9e7ac930862f3defd90bca38c05bc918cd9349d", "author": {"user": {"login": "ktksan", "name": null}}, "url": "https://github.com/MovingBlocks/Terasology/commit/e9e7ac930862f3defd90bca38c05bc918cd9349d", "committedDate": "2020-08-13T14:32:39Z", "message": "Add separate method for negative result value calculation"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "28907d147874a09a6f08d139626de8f7d56b5ba7", "author": {"user": {"login": "ktksan", "name": null}}, "url": "https://github.com/MovingBlocks/Terasology/commit/28907d147874a09a6f08d139626de8f7d56b5ba7", "committedDate": "2020-08-13T14:28:07Z", "message": "Add separate method for negative result value calculation"}, "afterCommit": {"oid": "e9e7ac930862f3defd90bca38c05bc918cd9349d", "author": {"user": {"login": "ktksan", "name": null}}, "url": "https://github.com/MovingBlocks/Terasology/commit/e9e7ac930862f3defd90bca38c05bc918cd9349d", "committedDate": "2020-08-13T14:32:39Z", "message": "Add separate method for negative result value calculation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY4MDEwNTIz", "url": "https://github.com/MovingBlocks/Terasology/pull/4123#pullrequestreview-468010523", "createdAt": "2020-08-15T18:34:25Z", "commit": {"oid": "e9e7ac930862f3defd90bca38c05bc918cd9349d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNVQxODozNDoyNVrOHBM5rQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xNVQxODo0MDoxMlrOHBM7jw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTAyMTk5Nw==", "bodyText": "Rather than duplicate the calculation (invites bugs) would it make sense to have getResultValue call getResultValueWithoutCapping then simply cap and return the result?", "url": "https://github.com/MovingBlocks/Terasology/pull/4123#discussion_r471021997", "createdAt": "2020-08-15T18:34:25Z", "author": {"login": "Cervator"}, "path": "engine/src/main/java/org/terasology/entitySystem/event/AbstractValueModifiableEvent.java", "diffHunk": "@@ -76,6 +78,27 @@ public float getResultValue() {\n         return Math.max(0, (baseValue + modifiers.sum()) * product(multipliers) + postModifiers.sum());\n     }\n \n+    /**\n+     * This is a temporary method to be used in events where negative value support is essential for calculating the\n+     * result value.\n+     *\n+     * Calculates the result value from the base value and given modifiers and multipliers.\n+     * <p>\n+     * The value is calculated based on the following formula:\n+     * <pre>\n+     * result = (<baseValue> + \u03a3 <modifier>) * \u03a0 <multiplier> + \u03a3 <postModifier>\n+     * </pre>\n+     *\n+     * <emph>Negative result values are allowed here.</emph>\n+     */\n+    public float getResultValueWithoutCapping() {\n+        //TODO: Based on an extended discussion from : https://github.com/MovingBlocks/Terasology/pull/4063\n+        // This is a temporary method which should be merged with the getResultValue() after all its uses are\n+        // checked out and corrected for(if needed).\n+        return (baseValue + modifiers.sum()) * product(multipliers) + postModifiers.sum();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e9e7ac930862f3defd90bca38c05bc918cd9349d"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTAyMjQ3OQ==", "bodyText": "If you just have one method call the other you could probably also save the duplication in the javadoc with a @see tag or whichever the appropriate one is. Not that it is necessarily bad to be thorough but it is such a typical bug when you have two similar things then end up forgetting a spot :-)", "url": "https://github.com/MovingBlocks/Terasology/pull/4123#discussion_r471022479", "createdAt": "2020-08-15T18:40:12Z", "author": {"login": "Cervator"}, "path": "engine/src/main/java/org/terasology/entitySystem/event/AbstractValueModifiableEvent.java", "diffHunk": "@@ -76,6 +78,27 @@ public float getResultValue() {\n         return Math.max(0, (baseValue + modifiers.sum()) * product(multipliers) + postModifiers.sum());\n     }\n \n+    /**\n+     * This is a temporary method to be used in events where negative value support is essential for calculating the\n+     * result value.\n+     *\n+     * Calculates the result value from the base value and given modifiers and multipliers.\n+     * <p>\n+     * The value is calculated based on the following formula:\n+     * <pre>\n+     * result = (<baseValue> + \u03a3 <modifier>) * \u03a0 <multiplier> + \u03a3 <postModifier>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e9e7ac930862f3defd90bca38c05bc918cd9349d"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c231f3a4ce4b26c452163400229fa18b1d97ea10", "author": {"user": {"login": "ktksan", "name": null}}, "url": "https://github.com/MovingBlocks/Terasology/commit/c231f3a4ce4b26c452163400229fa18b1d97ea10", "committedDate": "2020-08-16T13:16:14Z", "message": "Reduce code duplication"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "227d39006e4c99028f383d31333a42bb1e203221", "author": {"user": {"login": "ktksan", "name": null}}, "url": "https://github.com/MovingBlocks/Terasology/commit/227d39006e4c99028f383d31333a42bb1e203221", "committedDate": "2020-08-16T13:24:36Z", "message": "use @see for javadocs"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcyOTk0MjAx", "url": "https://github.com/MovingBlocks/Terasology/pull/4123#pullrequestreview-472994201", "createdAt": "2020-08-23T09:08:00Z", "commit": {"oid": "227d39006e4c99028f383d31333a42bb1e203221"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcyOTk0NjE1", "url": "https://github.com/MovingBlocks/Terasology/pull/4123#pullrequestreview-472994615", "createdAt": "2020-08-23T09:14:24Z", "commit": {"oid": "227d39006e4c99028f383d31333a42bb1e203221"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDczMDIwNDAz", "url": "https://github.com/MovingBlocks/Terasology/pull/4123#pullrequestreview-473020403", "createdAt": "2020-08-23T15:25:54Z", "commit": {"oid": "227d39006e4c99028f383d31333a42bb1e203221"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1416, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}