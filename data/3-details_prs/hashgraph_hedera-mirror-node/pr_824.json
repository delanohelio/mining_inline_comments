{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMzMzIyMjEz", "number": 824, "title": "Followup of #817", "bodyText": "Detailed description:\n\nChange Long to EntityId in Transaction and Entities. Added EntityIdConverter for the same.\nUse only id field in EntityId for EqualsAndHashCode since that is sufficient\nAdd InvalidEntityException. Thrown for invalid entities when encoding/decoding\nHandle the case for invalid entityId (contract/topic/file id) in a failed transaction. Added test.\n\nSigned-off-by: Apekshit Sharma apekshit.sharma@hedera.com\nWhich issue(s) this PR fixes:\nFixes #570\nPart of #820\nSpecial notes for your reviewer:\nChecklist\n\n Documentation added\n Tests updated", "createdAt": "2020-06-11T20:42:51Z", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/824", "merged": true, "mergeCommit": {"oid": "1cb905576e6ce08a9d61293846ae7295590eb279"}, "closed": true, "closedAt": "2020-06-12T16:06:03Z", "author": {"login": "apeksharma"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcqU9OygBqjM0MzU5ODI4Mjg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcqkw0-gFqTQyOTg0NDg3Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b2854de7d39ad0b65390e08847078266540ca1a2", "author": {"user": {"login": "apeksharma", "name": "Apekshit Sharma"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/b2854de7d39ad0b65390e08847078266540ca1a2", "committedDate": "2020-06-11T20:41:46Z", "message": "Followup of #817\n\nSigned-off-by: Apekshit Sharma <apekshit.sharma@hedera.com>"}, "afterCommit": {"oid": "0810e19c46afe0962338411401636ad2d21a841d", "author": {"user": {"login": "apeksharma", "name": "Apekshit Sharma"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/0810e19c46afe0962338411401636ad2d21a841d", "committedDate": "2020-06-11T21:15:16Z", "message": "Followup of #817\n\nSigned-off-by: Apekshit Sharma <apekshit.sharma@hedera.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0810e19c46afe0962338411401636ad2d21a841d", "author": {"user": {"login": "apeksharma", "name": "Apekshit Sharma"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/0810e19c46afe0962338411401636ad2d21a841d", "committedDate": "2020-06-11T21:15:16Z", "message": "Followup of #817\n\nSigned-off-by: Apekshit Sharma <apekshit.sharma@hedera.com>"}, "afterCommit": {"oid": "bf75af66650d35ef8d42d62e922588b6c3d45963", "author": {"user": {"login": "apeksharma", "name": "Apekshit Sharma"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/bf75af66650d35ef8d42d62e922588b6c3d45963", "committedDate": "2020-06-11T22:24:22Z", "message": "Followup of #817\n\nSigned-off-by: Apekshit Sharma <apekshit.sharma@hedera.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "be218a0ac990baa8720a410acb86183e5740190f", "author": {"user": {"login": "apeksharma", "name": "Apekshit Sharma"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/be218a0ac990baa8720a410acb86183e5740190f", "committedDate": "2020-06-11T22:50:46Z", "message": "Followup of #817\n\nSigned-off-by: Apekshit Sharma <apekshit.sharma@hedera.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bf75af66650d35ef8d42d62e922588b6c3d45963", "author": {"user": {"login": "apeksharma", "name": "Apekshit Sharma"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/bf75af66650d35ef8d42d62e922588b6c3d45963", "committedDate": "2020-06-11T22:24:22Z", "message": "Followup of #817\n\nSigned-off-by: Apekshit Sharma <apekshit.sharma@hedera.com>"}, "afterCommit": {"oid": "be218a0ac990baa8720a410acb86183e5740190f", "author": {"user": {"login": "apeksharma", "name": "Apekshit Sharma"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/be218a0ac990baa8720a410acb86183e5740190f", "committedDate": "2020-06-11T22:50:46Z", "message": "Followup of #817\n\nSigned-off-by: Apekshit Sharma <apekshit.sharma@hedera.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI5NDM1Mjg3", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/824#pullrequestreview-429435287", "createdAt": "2020-06-12T03:17:41Z", "commit": {"oid": "be218a0ac990baa8720a410acb86183e5740190f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQwMzoxNzo0MVrOGi1uUw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQwMzoyMTowOFrOGi1xpQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTE4NDk3OQ==", "bodyText": "Should extend ImporterException", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/824#discussion_r439184979", "createdAt": "2020-06-12T03:17:41Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/exception/InvalidEntityException.java", "diffHunk": "@@ -0,0 +1,30 @@\n+package com.hedera.mirror.importer.exception;\n+\n+/*-\n+ * \u200c\n+ * Hedera Mirror Node\n+ * \u200b\n+ * Copyright (C) 2019 - 2020 Hedera Hashgraph, LLC\n+ * \u200b\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ * \u200d\n+ */\n+\n+public class InvalidEntityException extends RuntimeException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "be218a0ac990baa8720a410acb86183e5740190f"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTE4NTE0Mg==", "bodyText": "Please log the consensusNs as well. It should probably just be at warn level as it's due to customer input and not alert worthy.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/824#discussion_r439185142", "createdAt": "2020-06-12T03:18:31Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/record/entity/EntityRecordItemListener.java", "diffHunk": "@@ -95,7 +96,13 @@ public void onItem(RecordItem recordItem) throws ImporterException {\n         TransactionHandler transactionHandler = transactionHandlerFactory.create(body);\n \n         long consensusNs = Utility.timeStampInNanos(txRecord.getConsensusTimestamp());\n-        EntityId entityId = transactionHandler.getEntity(recordItem);\n+        EntityId entityId;\n+        try {\n+            entityId = transactionHandler.getEntity(recordItem);\n+        } catch (InvalidEntityException e) { // transaction can have invalid topic/contract/file id\n+            log.error(e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "be218a0ac990baa8720a410acb86183e5740190f"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTE4NTgyOQ==", "bodyText": "nit: Should use highest level interface that still meets your requirements (Dependency Inversion Principle). Recommend Collection. Also can be initialized here.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/824#discussion_r439185829", "createdAt": "2020-06-12T03:21:08Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/record/entity/sql/SqlEntityListener.java", "diffHunk": "@@ -56,6 +57,9 @@\n     private final DataSource dataSource;\n     private final RecordFileRepository recordFileRepository;\n     private long batch_count = 0;\n+    // Keeps track of entityIds seen in the current file being processed. This is for optimizing inserts into\n+    // t_entities table so that insertion of node and treasury ids are not tried for every transaction.\n+    private HashSet<EntityId> entityIds;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "be218a0ac990baa8720a410acb86183e5740190f"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI5NDQ0ODQx", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/824#pullrequestreview-429444841", "createdAt": "2020-06-12T03:54:42Z", "commit": {"oid": "be218a0ac990baa8720a410acb86183e5740190f"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d8d1be4bbcc48f6906ff8b63845e2a72d8f30137", "author": {"user": {"login": "apeksharma", "name": "Apekshit Sharma"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/d8d1be4bbcc48f6906ff8b63845e2a72d8f30137", "committedDate": "2020-06-12T04:57:13Z", "message": "address review comments\n\nSigned-off-by: Apekshit Sharma <apekshit.sharma@hedera.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bd997f67b1939f9e95976a1dba73a6fe7b72ca91", "author": {"user": {"login": "apeksharma", "name": "Apekshit Sharma"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/bd997f67b1939f9e95976a1dba73a6fe7b72ca91", "committedDate": "2020-06-12T04:54:08Z", "message": "address review comments\n\nSigned-off-by: Apekshit Sharma <apekshit.sharma@hedera.com>"}, "afterCommit": {"oid": "d8d1be4bbcc48f6906ff8b63845e2a72d8f30137", "author": {"user": {"login": "apeksharma", "name": "Apekshit Sharma"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/d8d1be4bbcc48f6906ff8b63845e2a72d8f30137", "committedDate": "2020-06-12T04:57:13Z", "message": "address review comments\n\nSigned-off-by: Apekshit Sharma <apekshit.sharma@hedera.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI5Nzg2MTcw", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/824#pullrequestreview-429786170", "createdAt": "2020-06-12T14:26:21Z", "commit": {"oid": "d8d1be4bbcc48f6906ff8b63845e2a72d8f30137"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI5ODQ0ODc3", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/824#pullrequestreview-429844877", "createdAt": "2020-06-12T15:40:49Z", "commit": {"oid": "d8d1be4bbcc48f6906ff8b63845e2a72d8f30137"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3192, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}