{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEwMTMwNDM2", "number": 1197, "title": "HTS: Add HTS REST API tests to monitor", "bodyText": "Detailed description:\n\nAdd HTS REST API tests to monitor\nAdd option to enable / disable tests for a specific resource\nFix incorrect timestamp query parameter handling in token balances API\n\nWhich issue(s) this PR fixes:\nFixes #1150\nSpecial notes for your reviewer:\nChecklist\n\n Documentation added\n Tests updated", "createdAt": "2020-10-26T15:54:36Z", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1197", "merged": true, "mergeCommit": {"oid": "880979e9e91d51dc9c95c38db59b3c35bfc7b3d9"}, "closed": true, "closedAt": "2020-10-27T20:10:43Z", "author": {"login": "xin-hedera"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdVedWHgH2gAyNTEwMTMwNDM2OjI0NzlhMTU0ZmUzODlmMGRiODkyZTUxNmJmZjdiMGU4MmJhZjhjZDA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdWsomIAFqTUxNzk4MjE1Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2479a154fe389f0db892e516bff7b0e82baf8cd0", "author": {"user": {"login": "xin-hedera", "name": "Xin Li"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/2479a154fe389f0db892e516bff7b0e82baf8cd0", "committedDate": "2020-10-23T22:38:51Z", "message": "add token tests to monitor_apis\n\nSigned-off-by: Xin Li <xin.li@swirlds.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c22ccf906f4a3d92abf676efb0b6b815e5cbb9b8", "author": {"user": {"login": "xin-hedera", "name": "Xin Li"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/c22ccf906f4a3d92abf676efb0b6b815e5cbb9b8", "committedDate": "2020-10-26T15:03:19Z", "message": "Merge branch 'master' into monitor-tokens"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c2959916c75f3238240442af900277af2da5856", "author": {"user": {"login": "xin-hedera", "name": "Xin Li"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/5c2959916c75f3238240442af900277af2da5856", "committedDate": "2020-10-26T15:49:21Z", "message": "rename function, update README\n\nSigned-off-by: Xin Li <xin.li@swirlds.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2OTQ5MDA2", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1197#pullrequestreview-516949006", "createdAt": "2020-10-26T16:19:47Z", "commit": {"oid": "5c2959916c75f3238240442af900277af2da5856"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxNjoxOTo0N1rOHoXerQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxNjoyMTo1N1rOHoXksA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjA4OTc3Mw==", "bodyText": "You should note in the description and file name that there's no matching result.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1197#discussion_r512089773", "createdAt": "2020-10-26T16:19:47Z", "author": {"login": "Nana-EC"}, "path": "hedera-mirror-rest/__tests__/specs/token-balances-13-timestamp-range.spec.json", "diffHunk": "@@ -0,0 +1,142 @@\n+{\n+  \"description\": \"Token balances api calls for all account balances referencing the latest snapshot in a timestamp range\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5c2959916c75f3238240442af900277af2da5856"}, "originalPosition": 2}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjA5MDE1Ng==", "bodyText": "This is good, we should add another spec file with a valid response for greater coverage of the timestamp range filter", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1197#discussion_r512090156", "createdAt": "2020-10-26T16:20:21Z", "author": {"login": "Nana-EC"}, "path": "hedera-mirror-rest/__tests__/specs/token-balances-13-timestamp-range.spec.json", "diffHunk": "@@ -0,0 +1,142 @@\n+{\n+  \"description\": \"Token balances api calls for all account balances referencing the latest snapshot in a timestamp range\",\n+  \"setup\": {\n+    \"accounts\": [\n+      {\n+        \"entity_num\": 4\n+      },\n+      {\n+        \"entity_num\": 5\n+      },\n+      {\n+        \"entity_num\": 6\n+      },\n+      {\n+        \"entity_num\": 7\n+      }\n+    ],\n+    \"tokens\": [\n+      {\n+        \"token_id\": \"0.20.1\",\n+        \"symbol\": \"TOKEN1\"\n+      },\n+      {\n+        \"token_id\": \"0.20.2\",\n+        \"symbol\": \"TOKEN2\"\n+      },\n+      {\n+        \"token_id\": \"0.20.3\",\n+        \"symbol\": \"TOKEN3\"\n+      },\n+      {\n+        \"token_id\": \"0.20.4\",\n+        \"symbol\": \"TOKEN4\"\n+      },\n+      {\n+        \"token_id\": \"0.20.5\",\n+        \"symbol\": \"TOKEN5\"\n+      }\n+    ],\n+    \"balances\": [\n+      {\n+        \"timestamp\": 1566560001000000000,\n+        \"id\": 4,\n+        \"balance\": 40\n+      },\n+      {\n+        \"timestamp\": 1566560001000000000,\n+        \"id\": 5,\n+        \"balance\": 50\n+      },\n+      {\n+        \"timestamp\": 1566560001000000000,\n+        \"id\": 6,\n+        \"balance\": 60\n+      },\n+      {\n+        \"timestamp\": 1566560003000000000,\n+        \"id\": 4,\n+        \"balance\": 444,\n+        \"tokens\": [\n+          {\n+            \"token_realm\": 20,\n+            \"token_num\": 1,\n+            \"balance\": 4\n+          },\n+          {\n+            \"token_realm\": 20,\n+            \"token_num\": 2,\n+            \"balance\": 44\n+          }\n+        ]\n+      },\n+      {\n+        \"timestamp\": 1566560003000000000,\n+        \"id\": 5,\n+        \"balance\": 555,\n+        \"tokens\": [\n+          {\n+            \"token_realm\": 20,\n+            \"token_num\": 1,\n+            \"balance\": 5\n+          },\n+          {\n+            \"token_realm\": 20,\n+            \"token_num\": 2,\n+            \"balance\": 55\n+          }\n+        ]\n+      },\n+      {\n+        \"timestamp\": 1566560003000000000,\n+        \"id\": 6,\n+        \"balance\": 666,\n+        \"tokens\": [\n+          {\n+            \"token_realm\": 20,\n+            \"token_num\": 1,\n+            \"balance\": 6\n+          },\n+          {\n+            \"token_realm\": 20,\n+            \"token_num\": 2,\n+            \"balance\": 66\n+          }\n+        ]\n+      },\n+      {\n+        \"timestamp\": 1566560003000000000,\n+        \"id\": 7,\n+        \"balance\": 777\n+      },\n+      {\n+        \"timestamp\": 1566560007000000000,\n+        \"id\": 5,\n+        \"balance\": 5\n+      },\n+      {\n+        \"timestamp\": 1566560007000000000,\n+        \"id\": 6,\n+        \"balance\": 6,\n+        \"tokens\": [\n+          {\n+            \"token_realm\": 0,\n+            \"token_num\": 90000,\n+            \"balance\": 662\n+          }\n+        ]\n+      }\n+    ],\n+    \"transactions\": [],\n+    \"cryptotransfers\": []\n+  },\n+  \"url\": \"/api/v1/tokens/0.20.1/balances?timestamp=gt:1566560003.000000000&timestamp=lt:1566560004.000000000\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5c2959916c75f3238240442af900277af2da5856"}, "originalPosition": 133}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjA5MTMxMg==", "bodyText": "Should accounts be in this list?", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1197#discussion_r512091312", "createdAt": "2020-10-26T16:21:57Z", "author": {"login": "Nana-EC"}, "path": "hedera-mirror-rest/monitoring/README.md", "diffHunk": "@@ -51,38 +51,56 @@ nano config/serverlist.json // Insert the mirror node deployments you want to mo\n \n To customize per-resource configuration:\n \n-- `freshnessThreshold` (in seconds) for `balance`, `transaction`, and `topic` can be adjusted independently if needed.\n-   Set to 0 to disable freshness check for a resource\n-- `intervalMultiplier` for all resources. The tests for a resource will run every `interval * intervalMultiplier` seconds.\n-   For `stateproof`, it defaults to 10, so the tests run at a lower frequency to reduce cost\n-- `limit` threshold for `account`, `balance`, `transatcion`, and `topic` can be adjusted independently if needed, e.g.,\n-  for environments with lower traffic volume\n+- set `enabled` to `true` or `false` to enable / disable tests for a resource\n+- `freshnessThreshold` (in seconds) for `balance`, `transaction`, `topic`, and `token` (balances of a token) can be", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5c2959916c75f3238240442af900277af2da5856"}, "originalPosition": 11}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE3ODczOTEy", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1197#pullrequestreview-517873912", "createdAt": "2020-10-27T16:00:08Z", "commit": {"oid": "5c2959916c75f3238240442af900277af2da5856"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxNjowMDowOFrOHpEC6Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yN1QxNjozNjowN1rOHpFzcg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjgxOTk0NQ==", "bodyText": "transaction", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1197#discussion_r512819945", "createdAt": "2020-10-27T16:00:08Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-rest/monitoring/README.md", "diffHunk": "@@ -51,38 +51,56 @@ nano config/serverlist.json // Insert the mirror node deployments you want to mo\n \n To customize per-resource configuration:\n \n-- `freshnessThreshold` (in seconds) for `balance`, `transaction`, and `topic` can be adjusted independently if needed.\n-   Set to 0 to disable freshness check for a resource\n-- `intervalMultiplier` for all resources. The tests for a resource will run every `interval * intervalMultiplier` seconds.\n-   For `stateproof`, it defaults to 10, so the tests run at a lower frequency to reduce cost\n-- `limit` threshold for `account`, `balance`, `transatcion`, and `topic` can be adjusted independently if needed, e.g.,\n-  for environments with lower traffic volume\n+- set `enabled` to `true` or `false` to enable / disable tests for a resource\n+- `freshnessThreshold` (in seconds) for `balance`, `transaction`, `topic`, and `token` (balances of a token) can be\n+   adjusted independently if needed. Set to 0 to disable freshness check for a resource\n+- `intervalMultiplier` for all resources. The tests for a resource will run every `interval * intervalMultiplier`\n+   seconds. For `stateproof`, it defaults to 10, so the tests run at a lower frequency to reduce cost\n+- `limit` threshold for `account`, `balance`, `transatcion`, `topic`, and `token` can be adjusted independently if", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5c2959916c75f3238240442af900277af2da5856"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjg0ODc1NA==", "bodyText": "Should check if enabled flag is present as well to not break existing configs.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1197#discussion_r512848754", "createdAt": "2020-10-27T16:36:07Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-rest/monitoring/monitor_apis/monitor_tests.js", "diffHunk": "@@ -46,7 +47,8 @@ const counters = {};\n const runTests = (name, address) => {\n   const counter = name in counters ? counters[name] : 0;\n   const skippedResource = [];\n-  const testModules = allTestModules.filter((testModule) => {\n+  const enabledTestModules = allTestModules.filter((testModule) => config[testModule.resource].enabled);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5c2959916c75f3238240442af900277af2da5856"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a6d717083f7fde1e3c1c0c6fa6d9471a25154f23", "author": {"user": {"login": "xin-hedera", "name": "Xin Li"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/a6d717083f7fde1e3c1c0c6fa6d9471a25154f23", "committedDate": "2020-10-27T17:23:30Z", "message": "address review feedback\n\nSigned-off-by: Xin Li <xin.li@swirlds.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE3OTc1NzAw", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1197#pullrequestreview-517975700", "createdAt": "2020-10-27T17:36:23Z", "commit": {"oid": "a6d717083f7fde1e3c1c0c6fa6d9471a25154f23"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE3OTgyMTUz", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1197#pullrequestreview-517982153", "createdAt": "2020-10-27T17:43:44Z", "commit": {"oid": "a6d717083f7fde1e3c1c0c6fa6d9471a25154f23"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3466, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}