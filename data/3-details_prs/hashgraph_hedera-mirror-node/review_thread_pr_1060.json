{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg5MzU2ODM5", "number": 1060, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxNTo1ODozNVrOElBxCg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxNjoyNjoyOVrOElvtrA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA3MjYxNzA2OnYy", "diffSide": "RIGHT", "path": "hedera-mirror-rest/monitoring/README.md", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxNTo1ODozNVrOHUS-uw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQxNTo1ODozNVrOHUS-uw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTA0NDUzOQ==", "bodyText": "Adjust to two spaces indentation", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1060#discussion_r491044539", "createdAt": "2020-09-18T15:58:35Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-rest/monitoring/README.md", "diffHunk": "@@ -39,6 +39,22 @@ git clone git@github.com:hashgraph/hedera-mirror-node.git\n cd hedera-mirror-node/hedera-mirror-rest/monitoring\n ```\n \n+To configure a smaller `maxLimit` threshold for individual resources (`account`, `balance`, or `transaction`), for example,\n+for environments with lower traffic volume, add the following section to `application.yml`:\n+\n+```yaml\n+hedera:\n+  mirror:\n+    rest:\n+      monitor:\n+        account:\n+                maxLimit: 100", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "264ec6b7927d568f99f5100d80c963665b1cca96"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA3MzQ1MzkyOnYy", "diffSide": "RIGHT", "path": "hedera-mirror-rest/monitoring/monitor_apis/transaction_tests.js", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQyMDozMTowMlrOHUbAng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xOFQyMDozMTowMlrOHUbAng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTE3NjA5NA==", "bodyText": "changed from the last revision, directly compare the timestamp string", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1060#discussion_r491176094", "createdAt": "2020-09-18T20:31:02Z", "author": {"login": "xin-hedera"}, "path": "hedera-mirror-rest/monitoring/monitor_apis/transaction_tests.js", "diffHunk": "@@ -169,32 +170,40 @@ const getTransactionsWithAccountCheck = async (server, classResults) => {\n  * @param {Object} classResults shared class results object capturing tests for given endpoint\n  */\n const getTransactionsWithOrderParam = async (server, classResults) => {\n-  var currentTestResult = acctestutils.getMonitorTestResult();\n+  const currentTestResult = acctestutils.getMonitorTestResult();\n \n-  let url = acctestutils.getUrl(server, `${transactionsPath}?order=asc`);\n+  const query = {order: 'asc'};\n+  const {maxLimit, isGlobal} = acctestutils.getMaxLimit(resource);\n+  if (!isGlobal) {\n+    query.limit = maxLimit;\n+  }\n+\n+  const url = acctestutils.getUrl(server, transactionsPath, query);\n   currentTestResult.url = url;\n-  let transactions = await getTransactions(url, currentTestResult);\n+  const transactions = await getTransactions(url, currentTestResult);\n \n   if (undefined === transactions) {\n-    var message = `transactions is undefined`;\n+    const message = `transactions is undefined`;\n     currentTestResult.failureMessages.push(message);\n     acctestutils.addTestResult(classResults, currentTestResult, false);\n     return;\n   }\n \n   if (transactions.length !== maxLimit) {\n-    var message = `transactions.length of ${transactions.length} is less than limit ${maxLimit}`;\n+    const message = `transactions.length of ${transactions.length} is less than limit ${maxLimit}`;\n     currentTestResult.failureMessages.push(message);\n     acctestutils.addTestResult(classResults, currentTestResult, false);\n     return;\n   }\n \n-  let prevSeconds = 0;\n-  for (let txn of transactions) {\n-    if (acctestutils.secNsToSeconds(txn.seconds) < prevSeconds) {\n-      check = false;\n+  let previousConsensusTimestamp = '0';\n+  for (const txn of transactions) {\n+    if (txn.consensus_timestamp <= previousConsensusTimestamp) {\n+      currentTestResult.failureMessages.push('consensus timestamps are not in ascending order');\n+      acctestutils.addTestResult(classResults, currentTestResult, false);\n+      return;\n     }\n-    prevSeconds = acctestutils.secNsToSeconds(txn.seconds);\n+    previousConsensusTimestamp = txn.consensus_timestamp;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5846464b84d27d298131537b3155c289ab8a8e56"}, "originalPosition": 197}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4MDEyNzMyOnYy", "diffSide": "RIGHT", "path": "hedera-mirror-rest/monitoring/monitor_apis/monitortest_utils.js", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxNjoyMTo1OVrOHVYzsA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxNjo0NDo1MlrOHVZrhw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjE4ODU5Mg==", "bodyText": "It's quite strange that we're using the config reader from hedera-mirror-rest and that the monitor_api has two different config formats (e.g. application.yaml and serverlist.json). We should remove this dependency and just use serverlist.json.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1060#discussion_r492188592", "createdAt": "2020-09-21T16:21:59Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-rest/monitoring/monitor_apis/monitortest_utils.js", "diffHunk": "@@ -17,10 +17,11 @@\n  * limitations under the License.\n  * \u200d\n  */\n-const math = require('mathjs');\n-const config = require('../../config.js');\n-const fetch = require('node-fetch');\n+\n const AbortController = require('abort-controller');\n+const config = require('../../config');", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5846464b84d27d298131537b3155c289ab8a8e56"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjIwMjg4Nw==", "bodyText": "Please also add defaults to serverlist.json", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1060#discussion_r492202887", "createdAt": "2020-09-21T16:44:52Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-rest/monitoring/monitor_apis/monitortest_utils.js", "diffHunk": "@@ -17,10 +17,11 @@\n  * limitations under the License.\n  * \u200d\n  */\n-const math = require('mathjs');\n-const config = require('../../config.js');\n-const fetch = require('node-fetch');\n+\n const AbortController = require('abort-controller');\n+const config = require('../../config');", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjE4ODU5Mg=="}, "originalCommit": {"oid": "5846464b84d27d298131537b3155c289ab8a8e56"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4MDE0NTA4OnYy", "diffSide": "RIGHT", "path": "hedera-mirror-rest/monitoring/monitor_apis/account_tests.js", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxNjoyNjoyOVrOHVY-pw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMVQxNzowODo1NVrOHVahqg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjE5MTM5OQ==", "bodyText": "This conditional logic seems unnecessary and breaks encapsulation of the maxLimit properties. We should always have a limit set and include that in the query, regardless if it's the global or not. We should default in the code if it's not in config.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1060#discussion_r492191399", "createdAt": "2020-09-21T16:26:29Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-rest/monitoring/monitor_apis/account_tests.js", "diffHunk": "@@ -66,67 +68,65 @@ const checkMandatoryParams = (entry) => {\n  * @param {Object} classResults shared class results object capturing tests for given endpoint\n  */\n const getAccountsWithAccountCheck = async (server, classResults) => {\n-  var currentTestResult = acctestutils.getMonitorTestResult();\n+  const currentTestResult = acctestutils.getMonitorTestResult();\n+\n+  const query = {};\n+  const {maxLimit, isGlobal} = acctestutils.getMaxLimit(resource);\n+  if (!isGlobal) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5846464b84d27d298131537b3155c289ab8a8e56"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjIxNjc0Ng==", "bodyText": "the flag is used to honor the default maxLimit if there is no resource specific maxLimit\nthe original test checks whether the rest service honors the maxLimit set in application.yml, hence limit=? query should not be added", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1060#discussion_r492216746", "createdAt": "2020-09-21T17:08:55Z", "author": {"login": "xin-hedera"}, "path": "hedera-mirror-rest/monitoring/monitor_apis/account_tests.js", "diffHunk": "@@ -66,67 +68,65 @@ const checkMandatoryParams = (entry) => {\n  * @param {Object} classResults shared class results object capturing tests for given endpoint\n  */\n const getAccountsWithAccountCheck = async (server, classResults) => {\n-  var currentTestResult = acctestutils.getMonitorTestResult();\n+  const currentTestResult = acctestutils.getMonitorTestResult();\n+\n+  const query = {};\n+  const {maxLimit, isGlobal} = acctestutils.getMaxLimit(resource);\n+  if (!isGlobal) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjE5MTM5OQ=="}, "originalCommit": {"oid": "5846464b84d27d298131537b3155c289ab8a8e56"}, "originalPosition": 38}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1465, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}