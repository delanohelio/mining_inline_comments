{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE3MTAxMzQ1", "number": 755, "title": "Add transactionHash to /transactions REST api", "bodyText": "Detailed description:\nAdditional changes:\n\nMake SQL queries pretty\nsome variable renames\n\nSigned-off-by: Apekshit Sharma apekshit.sharma@hedera.com\nWhich issue(s) this PR fixes:\nPart of #720\nSpecial notes for your reviewer:\nChecklist\n\n Documentation added\n Tests updated", "createdAt": "2020-05-13T04:04:30Z", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/755", "merged": true, "mergeCommit": {"oid": "4bc76203a0de4d03c6fdd1fdc205e2de547a8abd"}, "closed": true, "closedAt": "2020-05-14T04:19:38Z", "author": {"login": "apeksharma"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcgw1wUgBqjMzMzAyMTkxMDA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcg_tN4AFqTQxMTMwNjcyOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e8440bc25f54b521a5abf9cbe5d06d4d249a711a", "author": {"user": {"login": "apeksharma", "name": "Apekshit Sharma"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/e8440bc25f54b521a5abf9cbe5d06d4d249a711a", "committedDate": "2020-05-13T03:46:45Z", "message": "Add transactionHash to /transactions REST api\n\nAdditional changes:\n- Make SQL queries pretty\n- some variable renames\n\nSigned-off-by: Apekshit Sharma <apekshit.sharma@hedera.com>"}, "afterCommit": {"oid": "0888583b40ce2be8df903b0affa8582e5169223b", "author": {"user": {"login": "apeksharma", "name": "Apekshit Sharma"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/0888583b40ce2be8df903b0affa8582e5169223b", "committedDate": "2020-05-13T04:05:40Z", "message": "Add transactionHash to /transactions REST api\n\nAdditional changes:\n- Make SQL queries pretty\n- some variable renames\n\nSigned-off-by: Apekshit Sharma <apekshit.sharma@hedera.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwNTczNzMz", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/755#pullrequestreview-410573733", "createdAt": "2020-05-13T04:07:59Z", "commit": {"oid": "0888583b40ce2be8df903b0affa8582e5169223b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwNDowNzo1OVrOGUgwLA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QwNDowNzo1OVrOGUgwLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDE2MTMyNA==", "bodyText": "clauses on ctl.amount are duplicate. transactions.getTransactionsInnerQuery also adds them to the query.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/755#discussion_r424161324", "createdAt": "2020-05-13T04:07:59Z", "author": {"login": "apeksharma"}, "path": "hedera-mirror-rest/accounts.js", "diffHunk": "@@ -234,10 +234,7 @@ const getOneAccount = async (req, res) => {\n \n   const creditDebit = utils.parseCreditDebitParams(req);\n \n-  const accountQuery =\n-    'realm_num = ?\\n' +\n-    '    and entity_num = ? ' +\n-    (creditDebit === 'credit' ? ' and ctl.amount > 0 ' : creditDebit === 'debit' ? ' and ctl.amount < 0 ' : '');", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0888583b40ce2be8df903b0affa8582e5169223b"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3153ffd9308c876f193467ba50dd8523ceb48454", "author": {"user": {"login": "apeksharma", "name": "Apekshit Sharma"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/3153ffd9308c876f193467ba50dd8523ceb48454", "committedDate": "2020-05-13T04:14:15Z", "message": "Add transactionHash to /transactions REST api\n\nAdditional changes:\n- Make SQL queries pretty\n- some variable renames\n\nSigned-off-by: Apekshit Sharma <apekshit.sharma@hedera.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0888583b40ce2be8df903b0affa8582e5169223b", "author": {"user": {"login": "apeksharma", "name": "Apekshit Sharma"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/0888583b40ce2be8df903b0affa8582e5169223b", "committedDate": "2020-05-13T04:05:40Z", "message": "Add transactionHash to /transactions REST api\n\nAdditional changes:\n- Make SQL queries pretty\n- some variable renames\n\nSigned-off-by: Apekshit Sharma <apekshit.sharma@hedera.com>"}, "afterCommit": {"oid": "3153ffd9308c876f193467ba50dd8523ceb48454", "author": {"user": {"login": "apeksharma", "name": "Apekshit Sharma"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/3153ffd9308c876f193467ba50dd8523ceb48454", "committedDate": "2020-05-13T04:14:15Z", "message": "Add transactionHash to /transactions REST api\n\nAdditional changes:\n- Make SQL queries pretty\n- some variable renames\n\nSigned-off-by: Apekshit Sharma <apekshit.sharma@hedera.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExMTQ2MTQ3", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/755#pullrequestreview-411146147", "createdAt": "2020-05-13T17:29:31Z", "commit": {"oid": "3153ffd9308c876f193467ba50dd8523ceb48454"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNzoyOTozMlrOGU8I5Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNzozMzo0OFrOGU8THA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDYxMDAyMQ==", "bodyText": "q: Where was this needed? Andshouldn't the default be a valid hash?", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/755#discussion_r424610021", "createdAt": "2020-05-13T17:29:32Z", "author": {"login": "Nana-EC"}, "path": "hedera-mirror-rest/__tests__/mockpool.js", "diffHunk": "@@ -194,6 +194,7 @@ class Pool {\n         Number(accountNum.low) + (accountNum.high == accountNum.low ? 0 : i % (accountNum.high - accountNum.low));\n       row.amount = i * 1000;\n       row.charged_tx_fee = 100 + i;\n+      row.transaction_hash = '';", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3153ffd9308c876f193467ba50dd8523ceb48454"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDYxMjYzNg==", "bodyText": "q: Why the '' on some the placeholders in some of the queries?", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/755#discussion_r424612636", "createdAt": "2020-05-13T17:33:48Z", "author": {"login": "Nana-EC"}, "path": "hedera-mirror-rest/__tests__/integrationDomainOps.js", "diffHunk": "@@ -160,14 +161,18 @@ const addTransaction = async function (transaction) {\n       transfers: [],\n       non_fee_transfers: [],\n       charged_tx_fee: NODE_FEE + NETWORK_FEE + SERVICE_FEE,\n+      transaction_hash: 'hash',\n     },\n     transaction\n   );\n \n   transaction.consensus_timestamp = math.bignumber(transaction.consensus_timestamp);\n \n   await sqlConnection.query(\n-    'insert into t_transactions (consensus_ns, valid_start_ns, fk_payer_acc_id, fk_node_acc_id, result, type, valid_duration_seconds, max_fee, charged_tx_fee) values ($1, $2, $3, $4, $5, $6, $7, $8, $9);',\n+    `INSERT INTO t_transactions (\n+        consensus_ns, valid_start_ns, fk_payer_acc_id, fk_node_acc_id, result, type,\n+        valid_duration_seconds, max_fee, charged_tx_fee, transaction_hash)\n+       VALUES (\\$1, \\$2, \\$3, \\$4, \\$5, \\$6, \\$7, \\$8, \\$9, \\$10);`,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3153ffd9308c876f193467ba50dd8523ceb48454"}, "originalPosition": 46}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "03674e5957140b5499cc956d7125612615be069e", "author": {"user": {"login": "apeksharma", "name": "Apekshit Sharma"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/03674e5957140b5499cc956d7125612615be069e", "committedDate": "2020-05-13T18:32:14Z", "message": "address review\n\nSigned-off-by: Apekshit Sharma <apekshit.sharma@hedera.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExMjE2Mjc2", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/755#pullrequestreview-411216276", "createdAt": "2020-05-13T19:03:31Z", "commit": {"oid": "03674e5957140b5499cc956d7125612615be069e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExMzA2NzI5", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/755#pullrequestreview-411306729", "createdAt": "2020-05-13T21:18:14Z", "commit": {"oid": "03674e5957140b5499cc956d7125612615be069e"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QyMToxODoxNFrOGVD4cA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QyMToyMjoxMlrOGVD_vQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDczNjg4MA==", "bodyText": "I'm not sure I agree with the prettifying. We've been trying to write SQL lower case in migrations and elsewhere as a standardization. I had discussed this with Nana previously and he agreed that's what he preferred as well. I'm okay with format of SQL other than the case.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/755#discussion_r424736880", "createdAt": "2020-05-13T21:18:14Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-rest/__tests__/integrationDomainOps.js", "diffHunk": "@@ -122,8 +121,10 @@ const addAccount = async function (account) {\n   }\n \n   let res = await sqlConnection.query(\n-    'insert into t_entities (fk_entity_type_id, entity_shard, entity_realm, entity_num, exp_time_ns, deleted, ed25519_public_key_hex, auto_renew_period, key) ' +\n-      'values ($1, $2, $3, $4, $5, $6, $7, $8, $9) returning id;',\n+    `INSERT INTO t_entities (", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "03674e5957140b5499cc956d7125612615be069e"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDczODc0OQ==", "bodyText": "q: We usually store byte[] as base64 encoded, but should this one field be hex to match Kabuto? Also, it seems like hex is usually used more for hash output by a lot of commands. Am okay either way, just want to discuss first.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/755#discussion_r424738749", "createdAt": "2020-05-13T21:22:12Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-rest/__tests__/specs/accounts-10-account-transactions.spec.json", "diffHunk": "@@ -67,6 +67,7 @@\n         \"name\": \"CRYPTOTRANSFER\",\n         \"node\": \"0.0.3\",\n         \"result\": \"SUCCESS\",\n+        \"transaction_hash\": \"aGFzaA==\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "03674e5957140b5499cc956d7125612615be069e"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3135, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}