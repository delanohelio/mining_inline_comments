{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc3NDIyMjc5", "number": 545, "title": "Set additional netty properties and memory limits ", "bodyText": "Detailed description:\nWe recently experienced undesirable effects of traffic in testnet which prompted us to visit our grips service configurations around security and performance.\nThis change sets further Netty properties to aid security and performance as well as sets the Jim memory thresholds for the service at deployment\n\nSet flowControlWindow, maxMessageSize and maxMetadataSize Netty properties\nSet max heap\n\nWhich issue(s) this PR fixes:\nPartially addresses #536\nSpecial notes for your reviewer:\nChecklist\n\n Documentation added\n Tests updated", "createdAt": "2020-02-19T22:10:19Z", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/545", "merged": true, "mergeCommit": {"oid": "7cd3a512707cb7d0633791ed619ef81ca4372c8c"}, "closed": true, "closedAt": "2020-02-21T04:53:57Z", "author": {"login": "Nana-EC"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcF97KYAH2gAyMzc3NDIyMjc5OmJlMTQ5MTI5YmM5OWI0ZDI1OTdmYmFkYTU0YTlkNTAwMTdhZTk1ODc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcGYYHAgFqTM2MjM5NTU4Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "be149129bc99b4d2597fbada54a9d50017ae9587", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/be149129bc99b4d2597fbada54a9d50017ae9587", "committedDate": "2020-02-19T22:04:32Z", "message": "Set additional netty properties to protect grpc and ensure good connections. Also increased memory limits\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cb85b953313a0d106c260745b1c1da2e29828d4e", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/cb85b953313a0d106c260745b1c1da2e29828d4e", "committedDate": "2020-02-19T22:58:12Z", "message": "Removed keep alive netty props and updated configuration.md\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "14efef27055c09b4f676137193c42cdbd1151938", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/14efef27055c09b4f676137193c42cdbd1151938", "committedDate": "2020-02-20T19:14:19Z", "message": "merge w master 2/20/20\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6789db30f3b6f16e28abcc1ae49db8d74c496d93", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/6789db30f3b6f16e28abcc1ae49db8d74c496d93", "committedDate": "2020-02-20T19:39:24Z", "message": "Updated max heap from 12 to 10 gb. Gives us more buffer should we ever need it\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyMzk4NTQy", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/545#pullrequestreview-362398542", "createdAt": "2020-02-21T04:52:36Z", "commit": {"oid": "6789db30f3b6f16e28abcc1ae49db8d74c496d93"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyMzk1NTg3", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/545#pullrequestreview-362395587", "createdAt": "2020-02-21T04:39:16Z", "commit": {"oid": "6789db30f3b6f16e28abcc1ae49db8d74c496d93"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQwNDozOToxNlrOFsreUQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQwNDo0MTowNFrOFsrfnw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjM5MzkzNw==", "bodyText": "maxInboundMessageSize doesn't seem to be netty property, it's looks like grpc property?", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/545#discussion_r382393937", "createdAt": "2020-02-21T04:39:16Z", "author": {"login": "apeksharma"}, "path": "hedera-mirror-grpc/src/main/java/com/hedera/mirror/grpc/config/GrpcConfiguration.java", "diffHunk": "@@ -53,7 +53,11 @@ CompositeHealthContributor grpcServices(GrpcServiceDiscoverer grpcServiceDiscove\n \n     @Bean\n     public GrpcServerConfigurer grpcServerConfigurer(GrpcProperties grpcProperties) {\n+        NettyProperties nettyProperties = grpcProperties.getNetty();\n         return serverBuilder -> ((NettyServerBuilder) serverBuilder)\n-                .maxConcurrentCallsPerConnection(grpcProperties.getNetty().getMaxConcurrentCallsPerConnection());\n+                .flowControlWindow(nettyProperties.getFlowControlWindow())\n+                .maxConcurrentCallsPerConnection(nettyProperties.getMaxConcurrentCallsPerConnection())\n+                .maxInboundMessageSize(nettyProperties.getMaxMessageSize())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6789db30f3b6f16e28abcc1ae49db8d74c496d93"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjM5NDI3MQ==", "bodyText": "let's name these exactly as grpc's/netty's internal property names. Will save us from having to keep extra mapping in mind when debugging things.\nI understand setting min for these two 'size' configs is weird since we'll never set them to low values like 10 or even 100. But a value like 8 seems mysterious. Why 8, why not 9 or 7? has to do something with int/long size?\nI'd suggest setting the Mins values to 0 to avoid attracting unneeded curiousness.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/545#discussion_r382394271", "createdAt": "2020-02-21T04:41:04Z", "author": {"login": "apeksharma"}, "path": "hedera-mirror-grpc/src/main/java/com/hedera/mirror/grpc/config/NettyProperties.java", "diffHunk": "@@ -27,6 +27,15 @@\n @Data\n @Validated\n public class NettyProperties {\n+    @Min(1024) // 64 kb\n+    private int flowControlWindow = 64 * 1024;\n+\n     @Min(1)\n     private int maxConcurrentCallsPerConnection = 5;\n+\n+    @Min(8) // 6 kb\n+    private int maxMessageSize = 6 * 1024;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6789db30f3b6f16e28abcc1ae49db8d74c496d93"}, "originalPosition": 11}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3256, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}