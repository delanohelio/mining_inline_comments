{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg3NTQzMjE5", "number": 1053, "title": "Fix race condition in check-state-proof", "bodyText": "Detailed description:\n\nFix HTTP not found warnings about UnhandledPromiseRejection\nFix race condition in file/directory creation by using synchronous IO\nChange validation output to more clearly indicate state proof is valid\nChange logs to be more streamlined\n\nWhich issue(s) this PR fixes:\nFixes #1052\nSpecial notes for your reviewer:\n\nUnsuccessful output with http:\n\n$ node index.js -t 0.0.88-1600124832-528679001 -h http://localhost:80\n\n   \u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n   \u2502                                                \u2502\n   \u2502   Hedera Transaction State Proof Checker CLI   \u2502\n   \u2502                                                \u2502\n   \u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\n\nInitializing state proof for transaction ID 0.0.88-1600124832-528679001 from source: http://localhost:80/api/v1/transactions/0.0.88-1600124832-528679001/stateproof\nRequesting stateproof files from http://localhost:80/api/v1/transactions/0.0.88-1600124832-528679001/stateproof...\nError fetching http://localhost:80/api/v1/transactions/0.0.88-1600124832-528679001/stateproof: Error: Not Found\n\n\nSuccessful output with http:\n\n$ node --unhandled-rejections=strict index.js -t 0.0.88-1600124832-528679000 -h http://localhost:80 --unhandled-rejections=strict\n\n   \u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n   \u2502                                                \u2502\n   \u2502   Hedera Transaction State Proof Checker CLI   \u2502\n   \u2502                                                \u2502\n   \u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\n\nInitializing state proof for transaction ID 0.0.88-1600124832-528679000 from file: http://localhost:80/api/v1/transactions/0.0.88-1600124832-528679000/stateproof\nRequesting stateproof files from http://localhost:80/api/v1/transactions/0.0.88-1600124832-528679000/stateproof...\nSupporting files and API response for the state proof will be stored in the directory 0_0_88_1600124832_528679000\n4 node(s) found in address book\nParsed 1 address books\nParsed record, found 1 transactions\nParsed 4 signature files\nMatching transaction was found in record file\nVerify signatures passed for node 0.0.4\nVerify signatures passed for node 0.0.3\nVerify signatures passed for node 0.0.6\nVerify signatures passed for node 0.0.5\nRecord file hash was successfully matched with signature files\n-----------------------------------------------\nThe state proof is cryptographically valid\n-----------------------------------------------\n\n*Unsuccessful output with file:\n$ node index.js -t 0.0.88-1600124832-528679001 -f 0_0_88_1600124832_528679000/apiResponse.json\n\n   \u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n   \u2502                                                \u2502\n   \u2502   Hedera Transaction State Proof Checker CLI   \u2502\n   \u2502                                                \u2502\n   \u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\n\nInitializing state proof for transaction ID 0.0.88-1600124832-528679001 from file: 0_0_88_1600124832_528679000/apiResponse.json\nSupporting files and API response for the state proof will be stored in the directory 0_0_88_1600124832_528679001\n4 node(s) found in address book\nParsed 1 address books\nParsed record, found 1 transactions\nParsed 4 signature files\nTransaction ID 0_0_88_1600124832_528679001 not present in record file. Available transaction IDs: 0_0_88_1600124832_528679000\n-----------------------------------------------\nThe state proof is cryptographically invalid\n-----------------------------------------------\n\n\nSuccessful output with file:\n\nnode index.js -t 0.0.88-1600124832-528679000 -f 0_0_88_1600124832_528679000/apiResponse.json\n\n   \u256d\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256e\n   \u2502                                                \u2502\n   \u2502   Hedera Transaction State Proof Checker CLI   \u2502\n   \u2502                                                \u2502\n   \u2570\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u256f\n\nInitializing state proof for transaction ID 0.0.88-1600124832-528679000 from file: 0_0_88_1600124832_528679000/apiResponse.json\nSupporting files and API response for the state proof will be stored in the directory 0_0_88_1600124832_528679000\n4 node(s) found in address book\nParsed 1 address books\nParsed record, found 1 transactions\nParsed 4 signature files\nMatching transaction was found in record file\nVerify signatures passed for node 0.0.4\nVerify signatures passed for node 0.0.3\nVerify signatures passed for node 0.0.6\nVerify signatures passed for node 0.0.5\nRecord file hash was successfully matched with signature files\n-----------------------------------------------\nThe state proof is cryptographically valid\n-----------------------------------------------\n\nChecklist\n\n Documentation added\n Tests updated", "createdAt": "2020-09-15T20:24:34Z", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1053", "merged": true, "mergeCommit": {"oid": "66e9f4694bbcccd62ac8eca2e8ffe50159cd1c30"}, "closed": true, "closedAt": "2020-09-15T22:15:49Z", "author": {"login": "steven-sheehy"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdJNvkwgH2gAyNDg3NTQzMjE5OjM3MmI2MDM4NDY1ZmE1MWUwZjBiOGY2YjUzNDhlNmUzOTI2MGYyNzk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdJPWNHgFqTQ4OTE0NTE4OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "372b6038465fa51e0f0b8f6b5348e6e39260f279", "author": {"user": {"login": "steven-sheehy", "name": "Steven Sheehy"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/372b6038465fa51e0f0b8f6b5348e6e39260f279", "committedDate": "2020-09-15T20:23:17Z", "message": "Fix race condition in check-state-proof\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "484a9760dc9e370ea703f9bdb78cd40d25ad6a40", "author": {"user": {"login": "steven-sheehy", "name": "Steven Sheehy"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/484a9760dc9e370ea703f9bdb78cd40d25ad6a40", "committedDate": "2020-09-15T20:41:15Z", "message": "Change file back to source\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5MDY3Mzk0", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1053#pullrequestreview-489067394", "createdAt": "2020-09-15T21:01:14Z", "commit": {"oid": "484a9760dc9e370ea703f9bdb78cd40d25ad6a40"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5MDY4ODU4", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1053#pullrequestreview-489068858", "createdAt": "2020-09-15T21:03:24Z", "commit": {"oid": "484a9760dc9e370ea703f9bdb78cd40d25ad6a40"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5MTM0NjAx", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1053#pullrequestreview-489134601", "createdAt": "2020-09-15T21:53:43Z", "commit": {"oid": "484a9760dc9e370ea703f9bdb78cd40d25ad6a40"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQyMTo1Mzo0NFrOHSWWAg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNVQyMTo1Mzo0NFrOHSWWAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTAwMjQ5OA==", "bodyText": "when host is undefined and local/previewnet/testnet/mainnet hosts are used won't this result in http://https....", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1053#discussion_r489002498", "createdAt": "2020-09-15T21:53:44Z", "author": {"login": "Nana-EC"}, "path": "hedera-mirror-rest/check-state-proof/startUp.js", "diffHunk": "@@ -97,11 +97,11 @@ const startUpScreen = () => {\n       host = options.host;\n     }\n \n-    url = `${host}/api/v1/transactions/${transactionId}/stateproof`;\n+    url = `http://${host}/api/v1/transactions/${transactionId}/stateproof`;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "484a9760dc9e370ea703f9bdb78cd40d25ad6a40"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "675803fc5cb760b555fd8d3c0e4e45422377c8be", "author": {"user": {"login": "steven-sheehy", "name": "Steven Sheehy"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/675803fc5cb760b555fd8d3c0e4e45422377c8be", "committedDate": "2020-09-15T22:09:05Z", "message": "Fix host\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg5MTQ1MTg5", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1053#pullrequestreview-489145189", "createdAt": "2020-09-15T22:15:23Z", "commit": {"oid": "675803fc5cb760b555fd8d3c0e4e45422377c8be"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3530, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}