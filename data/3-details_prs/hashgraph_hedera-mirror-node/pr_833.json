{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM2MjM4MDcw", "number": 833, "title": "Fix shared poller OOM", "bodyText": "Detailed description:\n\nAdd new network OTHER for DevOps' use with pre-prod environments\nAdd topicRunningHashV2AddedTimestamp value for mainnet\nAdd a script to push images to Marketplace registry\nAdd ability for Loki to run without fullnameOverride (upstream PR)\nAdd ability to set log levels without restart (via curl, not persistent across restarts)\nFix Java max heap parameter not taking effect, causing the OOM\nFix not crashing on OOM so the process can recover\nFix async logging not enabled\nFix JPA Criteria based TopicMessageRepository.findByFilter() using literals for primitives instead of bind parameters, exploding Hibernate's and JDBC's query plan cache\nFix listener tests not using messages in the future\nFix Hibernate storing topic messages in its session unnecessarily by marking queries as read-only\nOptimize shared poller flow by not allocating unnecessary objects like Comparator, Instant, ConsensusTopicResponse, etc.\nRemove shared poller's buffer\nRemove hedera.mirror.grpc.listener.bufferInitial property\nRemove hedera.mirror.grpc.listener.bufferSize property\n\nWhich issue(s) this PR fixes:\nFixes #827\nSpecial notes for your reviewer:\nSee https://www.baeldung.com/spring-boot-changing-log-level-at-runtime#2-using-the-loggers-endpoint for help on setting log levels dynamically.\nBefore\n\nAfter\n\nFor same test scenario with 101 concurrent subscribers, the modified GRPC never went past 230MB and seems to be more consistent in its memory use while the previous code went up until 450MB.\nChecklist\n\n Documentation added\n Tests updated", "createdAt": "2020-06-18T05:31:03Z", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/833", "merged": true, "mergeCommit": {"oid": "8737919a04b800c3b244a9e9deb4987cc3ebf0e3"}, "closed": true, "closedAt": "2020-06-22T16:02:32Z", "author": {"login": "steven-sheehy"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcsXoVEgH2gAyNDM2MjM4MDcwOjg3ZTg4ZDVlYTA2MzBlNjVmNjVlYjAyM2EwYzFlZTU3YTU4NmE3ZjY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcty75WgH2gAyNDM2MjM4MDcwOmY1MjNhZDdhNDhkZTg5N2Y1NjA2N2YwY2UyMGYzZWE1NzVlYTQ1OTg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "87e88d5ea0630e65f65eb023a0c1ee57a586a7f6", "author": {"user": {"login": "steven-sheehy", "name": "Steven Sheehy"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/87e88d5ea0630e65f65eb023a0c1ee57a586a7f6", "committedDate": "2020-06-18T05:30:37Z", "message": "Fix shared poller OOM\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2c9e5f8f51f87ed342048430c7de347a631cf97e", "author": {"user": {"login": "steven-sheehy", "name": "Steven Sheehy"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/2c9e5f8f51f87ed342048430c7de347a631cf97e", "committedDate": "2020-06-18T19:36:14Z", "message": "Fix Marketplace\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDMzNjU5MTk2", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/833#pullrequestreview-433659196", "createdAt": "2020-06-18T21:26:34Z", "commit": {"oid": "2c9e5f8f51f87ed342048430c7de347a631cf97e"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQyMToyNjozNFrOGmAyKA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOFQyMToyNjozNFrOGmAyKA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjUxMTkxMg==", "bodyText": "You should be able to reduce this to just `docker push \"${registry}/deployer\" since you tagged it during build. All the tags should pushed along", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/833#discussion_r442511912", "createdAt": "2020-06-18T21:26:34Z", "author": {"login": "Nana-EC"}, "path": "charts/marketplace/gcp/release.sh", "diffHunk": "@@ -0,0 +1,46 @@\n+#!/usr/bin/env bash\n+set -ex\n+\n+if [[ \"$#\" -ne 1 ]]; then\n+  echo \"You must provide the Mirror Node image tag\"\n+  exit 1\n+fi\n+\n+tag=\"${1}\"\n+tag_minor=\"${tag%\\.*}\"\n+bats_tag=\"latest\"\n+postgresql_tag=\"latest\"\n+registry=\"gcr.io/mirror-node-public/hedera-mirror-node\"\n+\n+function retag() {\n+  local source=${1}\n+  local image=${2}\n+  local target=\"${registry}/${image}\"\n+\n+  # Main image\n+  if [[ -z \"${image}\" ]]; then\n+    target=\"${registry}\"\n+  fi\n+\n+  docker pull \"${source}\"\n+  docker tag \"${source}\" \"${target}:${tag}\"\n+  docker tag \"${source}\" \"${target}:${tag_minor}\"\n+  docker push \"${target}:${tag}\"\n+  docker push \"${target}:${tag_minor}\"\n+}\n+\n+# Build Marketplace deployer image\n+docker build -f ./Dockerfile -t \"${registry}/deployer:${tag}\" -t \"${registry}/deployer:${tag_minor}\" --build-arg tag=${tag} ../..\n+docker push \"${registry}/deployer:${tag}\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c9e5f8f51f87ed342048430c7de347a631cf97e"}, "originalPosition": 34}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f523ad7a48de897f56067f0ce20f3ea575ea4598", "author": {"user": {"login": "steven-sheehy", "name": "Steven Sheehy"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/f523ad7a48de897f56067f0ce20f3ea575ea4598", "committedDate": "2020-06-22T15:53:21Z", "message": "Merge master\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3199, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}