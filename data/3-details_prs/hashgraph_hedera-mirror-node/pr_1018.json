{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc5NzYwNzU5", "number": 1018, "title": "return only the current address book from state proof alpha REST API", "bodyText": "Detailed description:\n\nUpdate state proof alpha REST API to only return the address book at the time of the queried transaction\nUpdate test data and integration test spec to validate the change\nUpdate design doc\n\nWhich issue(s) this PR fixes:\nSpecial notes for your reviewer:\nChecklist\n\n Documentation added\n Tests updated", "createdAt": "2020-09-04T14:51:04Z", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1018", "merged": true, "mergeCommit": {"oid": "8b7fd2bb058c17c43f866013f38371f790222e32"}, "closed": true, "closedAt": "2020-09-04T15:52:52Z", "author": {"login": "xin-hedera"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdFmWHGAH2gAyNDc5NzYwNzU5OjNiMTg5ZWE3MmU1ZTlhNWRiOTdiYzAyNjAwM2M3NTY0ZWU1M2YzZmM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdFnOzBgFqTQ4Mjc2NzAyMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3b189ea72e5e9a5db97bc026003c7564ee53f3fc", "author": {"user": {"login": "xin-hedera", "name": "Xin Li"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/3b189ea72e5e9a5db97bc026003c7564ee53f3fc", "committedDate": "2020-09-04T14:47:24Z", "message": "state proof alpha api to only return the address book current to the queried transaction\n\nSigned-off-by: Xin Li <xin.li@swirlds.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgyNzI4ODg5", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1018#pullrequestreview-482728889", "createdAt": "2020-09-04T15:04:50Z", "commit": {"oid": "3b189ea72e5e9a5db97bc026003c7564ee53f3fc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQxNTowNDo1MFrOHNRR3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQxNTowNDo1MFrOHNRR3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzY3NjYzNw==", "bodyText": "Would be better to make this a configuration option so we don't have to undo this change in the future. Something like hedera.mirror.rest.stateproof.addressBookHistory=false.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1018#discussion_r483676637", "createdAt": "2020-09-04T15:04:50Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-rest/stateproof.js", "diffHunk": "@@ -116,10 +117,18 @@ let getAddressBooksAndNodeAccountIdsByConsensusNs = async (consensusNs) => {\n          ON ab.start_consensus_timestamp = abe.consensus_timestamp\n        WHERE start_consensus_timestamp <= $1\n          AND file_id = 102\n-       GROUP BY start_consensus_timestamp\n-       ORDER BY start_consensus_timestamp`;\n+       GROUP BY start_consensus_timestamp`;\n+  if (!onlyCurrent) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b189ea72e5e9a5db97bc026003c7564ee53f3fc"}, "originalPosition": 24}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgyNzMyOTI3", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1018#pullrequestreview-482732927", "createdAt": "2020-09-04T15:10:21Z", "commit": {"oid": "3b189ea72e5e9a5db97bc026003c7564ee53f3fc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQxNToxMDoyMVrOHNRd7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQxNToxMDoyMVrOHNRd7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzY3OTcyNw==", "bodyText": "oops, this is by mistake. will revert back to logger.trace", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1018#discussion_r483679727", "createdAt": "2020-09-04T15:10:21Z", "author": {"login": "xin-hedera"}, "path": "hedera-mirror-rest/stateproof.js", "diffHunk": "@@ -116,10 +117,18 @@ let getAddressBooksAndNodeAccountIdsByConsensusNs = async (consensusNs) => {\n          ON ab.start_consensus_timestamp = abe.consensus_timestamp\n        WHERE start_consensus_timestamp <= $1\n          AND file_id = 102\n-       GROUP BY start_consensus_timestamp\n-       ORDER BY start_consensus_timestamp`;\n+       GROUP BY start_consensus_timestamp`;\n+  if (!onlyCurrent) {\n+    sqlQuery += `\n+      ORDER BY start_consensus_timestamp`;\n+  } else {\n+    sqlQuery += `\n+      ORDER BY start_consensus_timestamp DESC\n+      LIMIT 1`;\n+  }\n+\n   if (logger.isTraceEnabled()) {\n-    logger.trace(`getAddressBooksAndNodeAccountIDsByConsensusNs: ${sqlQuery}, ${JSON.stringify(sqlParams)}`);\n+    logger.info(`getAddressBooksAndNodeAccountIDsByConsensusNs: ${sqlQuery}, ${JSON.stringify(sqlParams)}`);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b189ea72e5e9a5db97bc026003c7564ee53f3fc"}, "originalPosition": 35}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ca912379d540e77ac411e5cda3747c1de6e84c7b", "author": {"user": {"login": "xin-hedera", "name": "Xin Li"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/ca912379d540e77ac411e5cda3747c1de6e84c7b", "committedDate": "2020-09-04T15:45:16Z", "message": "add config.stateproof.addressBookHistory, add test spec with 2 address books returned\n\nSigned-off-by: Xin Li <xin.li@swirlds.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgyNzY3MDIz", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1018#pullrequestreview-482767023", "createdAt": "2020-09-04T15:49:19Z", "commit": {"oid": "ca912379d540e77ac411e5cda3747c1de6e84c7b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3670, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}