{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAzOTMzNjAw", "number": 690, "title": "REST API swagger metrics", "bodyText": "Detailed description:\nWe should collect metrics for REST API calls and make them available via a metrics aggregator\nThis change\n\nmakes use of swagger-stats adding 3 endpoints\n\n\n/swagger/ui (ux in new version) - dashboard (pic below)\n/swagger/stats - statistics\n/swagger/metrics - Prometheus metrics\n\n\nAdds a metrics middleware file that sets up swagger config.\nAdds authentication support to metrics endpoint\n\nswagger-stats amongst other things provides:\n\nMetrics in Prometheus format, so you may use Prometheus and Grafana to setup API monitoring and alerting\nStoring details about each API Request/Response in Elasticsearch, so you may use Kibana to perform analysis of API usage over\nSee https://swaggerstats.io/guide/intro.html for full list\n\nWhich issue(s) this PR fixes:\nFixes #661\nSpecial notes for your reviewer:\nLocal run example\n\nGrafana connection is documented here - https://swaggerstats.io/guide/prometheus.html#metrics\n#691 will address whether gateway metrics are sufficient or if the Prometheus formatted metrics emitted by swagger should be hooked int the Kubernetes Grafana board\nChecklist\n\n Documentation added\n Tests updated", "createdAt": "2020-04-15T18:59:29Z", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/690", "merged": true, "mergeCommit": {"oid": "deefad70de842329a21c2fa1d8dc4102291268d0"}, "closed": true, "closedAt": "2020-04-17T22:50:16Z", "author": {"login": "Nana-EC"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcX8oGvgH2gAyNDAzOTMzNjAwOjdhODE4NmI2OGZlNTRiNDM2NDg5NDlhNDA3YmQ4ZDU2ZmIxNDBjMzU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcYqLsZgFqTM5NTgyODc4Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "7a8186b68fe54b43648949a407bd8d56fb140c35", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/7a8186b68fe54b43648949a407bd8d56fb140c35", "committedDate": "2020-04-15T18:44:27Z", "message": "REST API swagger metrics\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk0OTg0NjYz", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/690#pullrequestreview-394984663", "createdAt": "2020-04-16T20:43:48Z", "commit": {"oid": "7a8186b68fe54b43648949a407bd8d56fb140c35"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQyMDo0Mzo0OFrOGG2cxQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQyMDo1Mjo0NVrOGG2ufg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTgzNjc0MQ==", "bodyText": "We should not mix metrics user and database user. Let's create a separate username and password in config.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/690#discussion_r409836741", "createdAt": "2020-04-16T20:43:48Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-rest/middleware/metricsHandler.js", "diffHunk": "@@ -0,0 +1,52 @@\n+/*-\n+ * \u200c\n+ * Hedera Mirror Node\n+ * \u200b\n+ * Copyright (C) 2019 - 2020 Hedera Hashgraph, LLC\n+ * \u200b\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ * \u200d\n+ */\n+'use strict';\n+\n+const config = require('../config');\n+const swStats = require('swagger-stats');\n+\n+// Load your swagger specification\n+// const apiSpec = require('./swagger.json');\n+\n+const metricsHandler = () => {\n+  return swStats.getMiddleware({\n+    name: process.env.npm_package_name,\n+    version: process.env.npm_package_version,\n+    authentication: true,\n+    onAuthenticate: onMetricsAuthenticate,\n+    uriPath: '/swagger',\n+    // swaggerSpec: apiSpec,\n+    // metricsPrefix: 'mirror-rest-'\n+  });\n+};\n+\n+const onMetricsAuthenticate = async (req, username, password) => {\n+  return new Promise(function (resolve, reject) {\n+    const match = username === config.db.apiUsername && password === config.db.apiPassword;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7a8186b68fe54b43648949a407bd8d56fb140c35"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTgzNjg5Mg==", "bodyText": "Commented config in this file can be removed until needed. YAGNI", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/690#discussion_r409836892", "createdAt": "2020-04-16T20:44:06Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-rest/middleware/metricsHandler.js", "diffHunk": "@@ -0,0 +1,52 @@\n+/*-\n+ * \u200c\n+ * Hedera Mirror Node\n+ * \u200b\n+ * Copyright (C) 2019 - 2020 Hedera Hashgraph, LLC\n+ * \u200b\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ * \u200d\n+ */\n+'use strict';\n+\n+const config = require('../config');\n+const swStats = require('swagger-stats');\n+\n+// Load your swagger specification\n+// const apiSpec = require('./swagger.json');\n+\n+const metricsHandler = () => {\n+  return swStats.getMiddleware({\n+    name: process.env.npm_package_name,\n+    version: process.env.npm_package_version,\n+    authentication: true,\n+    onAuthenticate: onMetricsAuthenticate,\n+    uriPath: '/swagger',\n+    // swaggerSpec: apiSpec,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7a8186b68fe54b43648949a407bd8d56fb140c35"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTg0MTI3OA==", "bodyText": "q: Does catching this error here swallow it instead of failing authentication?", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/690#discussion_r409841278", "createdAt": "2020-04-16T20:52:45Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-rest/middleware/metricsHandler.js", "diffHunk": "@@ -0,0 +1,52 @@\n+/*-\n+ * \u200c\n+ * Hedera Mirror Node\n+ * \u200b\n+ * Copyright (C) 2019 - 2020 Hedera Hashgraph, LLC\n+ * \u200b\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ * \u200d\n+ */\n+'use strict';\n+\n+const config = require('../config');\n+const swStats = require('swagger-stats');\n+\n+// Load your swagger specification\n+// const apiSpec = require('./swagger.json');\n+\n+const metricsHandler = () => {\n+  return swStats.getMiddleware({\n+    name: process.env.npm_package_name,\n+    version: process.env.npm_package_version,\n+    authentication: true,\n+    onAuthenticate: onMetricsAuthenticate,\n+    uriPath: '/swagger',\n+    // swaggerSpec: apiSpec,\n+    // metricsPrefix: 'mirror-rest-'\n+  });\n+};\n+\n+const onMetricsAuthenticate = async (req, username, password) => {\n+  return new Promise(function (resolve, reject) {\n+    const match = username === config.db.apiUsername && password === config.db.apiPassword;\n+    resolve(match);\n+  }).catch((err) => {\n+    logger.debug(`Auth error: ${err}`);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7a8186b68fe54b43648949a407bd8d56fb140c35"}, "originalPosition": 45}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk0MTEyOTk4", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/690#pullrequestreview-394112998", "createdAt": "2020-04-15T20:32:05Z", "commit": {"oid": "7a8186b68fe54b43648949a407bd8d56fb140c35"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQyMDozOTo0MFrOGGKr_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNVQyMDozOTo0MFrOGGKr_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTExOTc0Mw==", "bodyText": "which port does it use? Can we make swagger use different port then rest of the apis?\nWe shouldn't expose internal stats and metrics on a public port.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/690#discussion_r409119743", "createdAt": "2020-04-15T20:39:40Z", "author": {"login": "apeksharma"}, "path": "hedera-mirror-rest/middleware/metricsHandler.js", "diffHunk": "@@ -0,0 +1,52 @@\n+/*-\n+ * \u200c\n+ * Hedera Mirror Node\n+ * \u200b\n+ * Copyright (C) 2019 - 2020 Hedera Hashgraph, LLC\n+ * \u200b\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ * \u200d\n+ */\n+'use strict';\n+\n+const config = require('../config');\n+const swStats = require('swagger-stats');", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7a8186b68fe54b43648949a407bd8d56fb140c35"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "02bee3a64678b8959093904acff7fd855fc57f52", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/02bee3a64678b8959093904acff7fd855fc57f52", "committedDate": "2020-04-17T07:12:52Z", "message": " Addressed feedback on  config and comments\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1NTYxNDA0", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/690#pullrequestreview-395561404", "createdAt": "2020-04-17T15:37:26Z", "commit": {"oid": "02bee3a64678b8959093904acff7fd855fc57f52"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QxNTozNzoyN1rOGHS-iA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QxNTo0MTo1OVrOGHTIlw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDMwNDEzNg==", "bodyText": "I don't think this needs to be exported.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/690#discussion_r410304136", "createdAt": "2020-04-17T15:37:27Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-rest/middleware/metricsHandler.js", "diffHunk": "@@ -0,0 +1,51 @@\n+/*-\n+ * \u200c\n+ * Hedera Mirror Node\n+ * \u200b\n+ * Copyright (C) 2019 - 2020 Hedera Hashgraph, LLC\n+ * \u200b\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ * \u200d\n+ */\n+'use strict';\n+\n+const config = require('../config');\n+const swStats = require('swagger-stats');\n+\n+// Load your swagger specification\n+// const apiSpec = require('./swagger.json');\n+\n+const metricsHandler = () => {\n+  return swStats.getMiddleware({\n+    name: process.env.npm_package_name,\n+    version: process.env.npm_package_version,\n+    authentication: true,\n+    onAuthenticate: onMetricsAuthenticate,\n+    uriPath: '/swagger',\n+  });\n+};\n+\n+const onMetricsAuthenticate = async (req, username, password) => {\n+  return new Promise(function (resolve, reject) {\n+    const match = username === config.swagger.swaggerUsername && password === config.swagger.swaggerPassword;\n+    resolve(match);\n+  }).catch((err) => {\n+    logger.debug(`Auth error: ${err}`);\n+    throw err;\n+  });\n+};\n+\n+module.exports = {\n+  metricsHandler,\n+  onMetricsAuthenticate,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "02bee3a64678b8959093904acff7fd855fc57f52"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDMwNDMzNQ==", "bodyText": "Would prefer hedera.mirror.api.metrics.username/password", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/690#discussion_r410304335", "createdAt": "2020-04-17T15:37:52Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-rest/config/application.yml", "diffHunk": "@@ -14,3 +14,6 @@ hedera:\n       name: mirror_node\n       port: 5432\n     shard: 0\n+    swagger:\n+      swaggerPassword: swagger_metrics_pass", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "02bee3a64678b8959093904acff7fd855fc57f52"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDMwNjcxMQ==", "bodyText": "Conditionally enabling based upon hedera.mirror.api.metrics.enabled would be nice", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/690#discussion_r410306711", "createdAt": "2020-04-17T15:41:59Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-rest/server.js", "diffHunk": "@@ -90,6 +91,9 @@ app.use(bodyParser.json());\n app.use(compression());\n app.use(cors());\n \n+// metrics middleware\n+app.use(metricsHandler());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "02bee3a64678b8959093904acff7fd855fc57f52"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7e2a328748149cad0ff558b2576d8f7f6e8c7374", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/7e2a328748149cad0ff558b2576d8f7f6e8c7374", "committedDate": "2020-04-17T17:56:51Z", "message": "Added metric configs and updated documentation\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1Njc5ODc3", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/690#pullrequestreview-395679877", "createdAt": "2020-04-17T18:26:10Z", "commit": {"oid": "7e2a328748149cad0ff558b2576d8f7f6e8c7374"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1Njg0NTM5", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/690#pullrequestreview-395684539", "createdAt": "2020-04-17T18:33:24Z", "commit": {"oid": "7e2a328748149cad0ff558b2576d8f7f6e8c7374"}, "state": "DISMISSED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QxODozMzoyNFrOGHY4Fw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QxODozMzoyNFrOGHY4Fw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQwMDc5MQ==", "bodyText": "default values here, in operations.md, and in application.yml do not match.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/690#discussion_r410400791", "createdAt": "2020-04-17T18:33:24Z", "author": {"login": "apeksharma"}, "path": "docs/configuration.md", "diffHunk": "@@ -43,6 +43,11 @@ value, it is recommended to only populate overridden properties in the custom `a\n | `hedera.mirror.api.log.level`                               | debug                   | The logging level. Can be trace, debug, info, warn, error or fatal.                            |\n | `hedera.mirror.api.port`                                    | 5551                    | The REST API port                                                                              |\n | `hedera.mirror.api.includeHostInLink`                       | false                   | Whether to include the host:port in the next links returned by the REST API                    |\n+| `hedera.mirror.api.metrics.enabled`                         | true                    | Whether metrics are enabled for the REST API                                                   |\n+| `hedera.mirror.api.metrics.config.authentication`           | true                    | Whether access to metrics for the REST API is authenticated                                    |\n+| `hedera.mirror.api.metrics.config.username`                 | mirror_api_metrics      | The REST API metrics username to access the dashboard                                          |\n+| `hedera.mirror.api.metrics.config.password`                 | mirror_api_metrics_pass | The REST API metrics password to access the dashboard                                          |\n+| `hedera.mirror.api.metrics.config.uriPath`                  | './swagger'             | The REST API metrics uri path                                                                  |", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7e2a328748149cad0ff558b2576d8f7f6e8c7374"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7f92bae15cb96b951cbf8e8cd8cd6559f80e57a3", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/7f92bae15cb96b951cbf8e8cd8cd6559f80e57a3", "committedDate": "2020-04-17T21:28:10Z", "message": "Push docker images on master and cleanup old images (#683)\n\n* Push docker images on master and cleanup\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Used circle.docker.tag in deploy\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Use creationTime instead of useCurrentTimestamp\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Fixed bad substitution and updated prettyignore\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Added lastest tag config updated delete_before logic\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* echoed image tag lists\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Added loop logic for multiple tags\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Try delete old images logic\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Added echo for each image\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Update  multiline comment\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Remove gcloud delete\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Remove digest echo for delete command\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Update for loop formatting\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Update reference logic\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Use circleci v2.1 reuseable commands\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Hold off on commands and references. Verify split loop and list\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Single line tags list and fix commands indentation\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Comment out non cleanup jobs\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Fix image path variable references\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Add config list print\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Remove untagged old test master images\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Restore service account and project set\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Verify image tag filtering list\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* echo final filter command to verify time param\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Fixed filter string format issue\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Add echo for delete command\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* dry run of 19 hours\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Cleanup layout Leave delete commented out\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Force new image push 1\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Dry run for 7 days\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Fixed array loop and test 1 hour ago cleanup\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Test 2 hour ago cleanup\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* 4 hours ago test\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* 6 hours test\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* 6 hours test 2\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* 14 hours test 1\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* 14 hours test 2\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* 14 hours test 3\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Use csv formatting to get digest and timestamp\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Escape cahrs for v2.1\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* removed braces\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Modify date format\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Removed UTC config\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Add echo for bash env check\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Test filter timestamp formats\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Test filter timestamp formats 2\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* 7 days ago test\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* 2 days ago test\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Removed test branch logic\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Addressed feedback and added publsih test logic\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Removed branch publish test logic\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Add untag logic and modify delete to delete untagged\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* 24 hours untag test\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* 24 hours untag test 2\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Fix tag filter\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Real untag clean up 24 hours\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Add quiet option to untag\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Pull sha format for delete, no need for timestamp\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* 3 hours ago test\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Address fedback and remove brnach logic\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>\r\n\r\n* Removed tag filter for cleanup_images\r\n\r\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3dec608421c218c75e5d70bc3d9eb7c03ae40a19", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/3dec608421c218c75e5d70bc3d9eb7c03ae40a19", "committedDate": "2020-04-17T22:33:41Z", "message": "REST API swagger metrics\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "68778434acee53682adaa9558d38546f8718e9d5", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/68778434acee53682adaa9558d38546f8718e9d5", "committedDate": "2020-04-17T22:33:41Z", "message": " Addressed feedback on  config and comments\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4f8408505e5ef550925f20c4ad268af5e2e56a0c", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/4f8408505e5ef550925f20c4ad268af5e2e56a0c", "committedDate": "2020-04-17T22:33:41Z", "message": "Added metric configs and updated documentation\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f775b4be2305e4bf9f517d826b6759d034965426", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/f775b4be2305e4bf9f517d826b6759d034965426", "committedDate": "2020-04-17T22:33:55Z", "message": "Merge branch 'rest-metrics' of https://github.com/hashgraph/hedera-mirror-node into rest-metrics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7d14fd87f78b8ab1d8d6ee3a7e1e36a8ba82b52a", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/7d14fd87f78b8ab1d8d6ee3a7e1e36a8ba82b52a", "committedDate": "2020-04-17T22:36:51Z", "message": "Correct deafult value ref\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1ODEzNjE3", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/690#pullrequestreview-395813617", "createdAt": "2020-04-17T22:47:19Z", "commit": {"oid": "7d14fd87f78b8ab1d8d6ee3a7e1e36a8ba82b52a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1ODI4Nzgy", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/690#pullrequestreview-395828782", "createdAt": "2020-04-17T23:49:03Z", "commit": {"oid": "7d14fd87f78b8ab1d8d6ee3a7e1e36a8ba82b52a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QyMzo0OTowM1rOGHgA6w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QyMzo0OTowM1rOGHgA6w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDUxNzczOQ==", "bodyText": "nit: if it was fixed in configuration.md, might as well have fixed it here.\nNo biggy.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/690#discussion_r410517739", "createdAt": "2020-04-17T23:49:03Z", "author": {"login": "apeksharma"}, "path": "docs/operations.md", "diffHunk": "@@ -182,3 +182,11 @@ for port in {6551..6560}; do curl -s \"http://127.0.0.1:${port}/api/v1/transactio\n ```\n \n To setup live monitoring, see [monitoring](../hedera-mirror-rest/monitoring/README.md) documentation.\n+\n+### Metrics\n+The REST API has metrics as provided by [Swagger Stats](https://swaggerstats.io).\n+Using this 3 endpoints are made available\n+- `http://<ip>:<port>/<metricsPath>` - Metrics dashboard\n+- `http://<ip>:<port>/<metricsPath>/stats` - Aggregated statistics\n+- `http://<ip>:<port>/<metricsPath>/metrics` - Prometheus formatted metrics\n+Where `<metricsPath>` is defined by hedera.mirror.api.metrics.config.uriPath, current default is 'swagger'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7d14fd87f78b8ab1d8d6ee3a7e1e36a8ba82b52a"}, "originalPosition": 11}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3076, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}