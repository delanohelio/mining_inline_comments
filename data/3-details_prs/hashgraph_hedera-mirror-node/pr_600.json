{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg3OTI2MTA4", "number": 600, "title": "Remove fk_rec_file_id from t_transactions", "bodyText": "Detailed description:\n\nfk_rec_file_id in t_transactions was deprecated and its value is always 0. Removing the column.\nNo need of 2-part insert using f_file_create/complete.\nJust checking for presense on file start and inserting row on file complete is sufficient.\nEarlier, fk_rec_file_id was foreign key, so many tests for transactions needed to added\na row to t_record_files. That foreign key was dropped recently, so update tests to remove chaff.\nChanges in REST code are limited to tests\n\nBRD uses t_record_files table to simulate blocks internally. So we can't just remove it.\nWe have two possible options going forward:\n\nRemove t_record_files tables. We have no regular need of finding which file a txn belongs to.\nIf needed for debugging, one can use txn's epoch datetime and do prefix ls on S3.\nWill need to understand how BRD uses t_record_files and if it is just as easy to simulate blocks\nusing t_transactions.\nIf we keep the table around, to support lookup of all txns associated with a file, we can add\ntwo columns filled by consensus timestamps of first and last transaction in the file.\n\nSigned-off-by: Apekshit Sharma apekshit.sharma@hedera.com\nWhich issue(s) this PR fixes:\nFollowup of #566\nSpecial notes for your reviewer:\nFollowup from #585 (comment)\nChecklist\n\n Documentation added\n Tests updated", "createdAt": "2020-03-13T18:48:06Z", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/600", "merged": true, "mergeCommit": {"oid": "c7ab9ce4a51b91065533c56be57ab203d4e7288a"}, "closed": true, "closedAt": "2020-03-16T21:21:08Z", "author": {"login": "apeksharma"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcNVG5LAH2gAyMzg3OTI2MTA4OjFlYjc3NWMwN2EyNjE3MzRlYzNmNTY4NDFjZmI0YzU4MThiY2UzYWQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcOU0_OAFqTM3NTU4ODY5NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1eb775c07a261734ec3f56841cfb4c5818bce3ad", "author": {"user": {"login": "apeksharma", "name": "Apekshit Sharma"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/1eb775c07a261734ec3f56841cfb4c5818bce3ad", "committedDate": "2020-03-13T19:02:38Z", "message": "Remove file_id from t_record_files\n\n- fk_rec_file_id in t_transactions was deprecated and its value is always 0. Removing the column.\n- No need of 2-part insert using f_file_create/complete.\n  Just checking for presense on file start and inserting row on file complete is sufficient.\n- Earlier, fk_rec_file_id was foreign key, so many tests for transactions needed to added\n  a row to t_record_files. That foreign key was dropped recently, so update tests to remove chaff.\n- Changes in REST code are limited to tests\n\nBRD uses t_record_files table to simulate blocks internally. So we can't just remove it.\nWe have two possible options going forward:\n1. Remove t_record_files tables. We have no regular need of finding which file a txn belongs to.\nIf needed for debugging, one can use txn's epoch datetime and do prefix ls on S3.\nWill need to understand how BRD uses t_record_files and if it is just as easy to simulate blocks\nusing t_transactions.\n2. If we keep the table around, to support lookup of all txns associated with a file, we can add\ntwo columns filled by consensus timestamps of first and last transaction in the file.\n\nSigned-off-by: Apekshit Sharma <apekshit.sharma@hedera.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "af2728b6eaeea7454430298d73e2876693e0a68b", "author": {"user": {"login": "apeksharma", "name": "Apekshit Sharma"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/af2728b6eaeea7454430298d73e2876693e0a68b", "committedDate": "2020-03-13T19:06:29Z", "message": "fix rest tests\n\nSigned-off-by: Apekshit Sharma <apekshit.sharma@hedera.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "389a70dba7db41f64590b7248b38d75db17de4ad", "author": {"user": {"login": "apeksharma", "name": "Apekshit Sharma"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/389a70dba7db41f64590b7248b38d75db17de4ad", "committedDate": "2020-03-13T18:59:52Z", "message": "fix rest tests\n\nSigned-off-by: Apekshit Sharma <apekshit.sharma@hedera.com>"}, "afterCommit": {"oid": "af2728b6eaeea7454430298d73e2876693e0a68b", "author": {"user": {"login": "apeksharma", "name": "Apekshit Sharma"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/af2728b6eaeea7454430298d73e2876693e0a68b", "committedDate": "2020-03-13T19:06:29Z", "message": "fix rest tests\n\nSigned-off-by: Apekshit Sharma <apekshit.sharma@hedera.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0NTQ1Nzgx", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/600#pullrequestreview-374545781", "createdAt": "2020-03-13T19:05:12Z", "commit": {"oid": "389a70dba7db41f64590b7248b38d75db17de4ad"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxOTowNToxMlrOF2PS1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxOToxODozNlrOF2PpJg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjQxODAwNA==", "bodyText": "We shouldn't remove the id, it is useful for replication and may be useful to third parties. Plus it's good practice to have an ID on a table unless you have a natural ID.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/600#discussion_r392418004", "createdAt": "2020-03-13T19:05:12Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/domain/RecordFile.java", "diffHunk": "@@ -39,9 +36,6 @@\n public class RecordFile {\n \n     @Id\n-    @GeneratedValue(strategy = GenerationType.IDENTITY)\n-    private Long id;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "389a70dba7db41f64590b7248b38d75db17de4ad"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjQxODM5Ng==", "bodyText": "I don't see a database migration to remove this column.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/600#discussion_r392418396", "createdAt": "2020-03-13T19:06:10Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/domain/Transaction.java", "diffHunk": "@@ -64,11 +64,6 @@\n     @ManyToOne(cascade = CascadeType.PERSIST)\n     private Entities entity;\n \n-    // Deprecated, value set to 0 until removed.\n-    @Column(name = \"fk_rec_file_id\")\n-    @Deprecated(forRemoval = true, since = \"v0.7.0\")\n-    private Long recordFileId;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "389a70dba7db41f64590b7248b38d75db17de4ad"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjQyMDIzOA==", "bodyText": "Revert. This was done by your request that the test database not conflict with a local db of the same name.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/600#discussion_r392420238", "createdAt": "2020-03-13T19:10:23Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-importer/src/test/resources/application-default.yml", "diffHunk": "@@ -1,7 +1,7 @@\n hedera:\n   mirror:\n     db:\n-      name: mirror_node_test\n+      name: mirror_node", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "af2728b6eaeea7454430298d73e2876693e0a68b"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjQyMzcxOA==", "bodyText": "I would prefer this be void and an exception be thrown if for any reason the processing should not continue.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/600#discussion_r392423718", "createdAt": "2020-03-13T19:18:36Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/StreamFileListener.java", "diffHunk": "@@ -1,20 +1,18 @@\n package com.hedera.mirror.importer.parser;\n \n-import java.util.Optional;\n-\n import com.hedera.mirror.importer.exception.ImporterException;\n import com.hedera.mirror.importer.parser.domain.StreamFileData;\n \n public interface StreamFileListener<T> {\n     /**\n      * Called when starting to process a new stream file.\n      *\n-     * @return non-empty <T> if the file processing should continue; empty to skip the file.\n+     * @return true if the file processing should continue; false to skip the file.\n      * @throws ImporterException\n      */\n-    Optional<T> onStart(StreamFileData streamFileData) throws ImporterException;\n+    boolean onStart(StreamFileData streamFileData) throws ImporterException;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "af2728b6eaeea7454430298d73e2876693e0a68b"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "72a8652dfe2604095d6c0fa833025cca31b1f56c", "author": {"user": {"login": "apeksharma", "name": "Apekshit Sharma"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/72a8652dfe2604095d6c0fa833025cca31b1f56c", "committedDate": "2020-03-13T19:30:53Z", "message": "add the migration file\n\nSigned-off-by: Apekshit Sharma <apekshit.sharma@hedera.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1e26635a28ca617daa7eb38e36eddebe7e52b689", "author": {"user": {"login": "apeksharma", "name": "Apekshit Sharma"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/1e26635a28ca617daa7eb38e36eddebe7e52b689", "committedDate": "2020-03-13T19:26:19Z", "message": "add the migration file\n\nSigned-off-by: Apekshit Sharma <apekshit.sharma@hedera.com>"}, "afterCommit": {"oid": "72a8652dfe2604095d6c0fa833025cca31b1f56c", "author": {"user": {"login": "apeksharma", "name": "Apekshit Sharma"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/72a8652dfe2604095d6c0fa833025cca31b1f56c", "committedDate": "2020-03-13T19:30:53Z", "message": "add the migration file\n\nSigned-off-by: Apekshit Sharma <apekshit.sharma@hedera.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "21665a0b63f6aab86be0f194c4566047ea4ba860", "author": {"user": {"login": "apeksharma", "name": "Apekshit Sharma"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/21665a0b63f6aab86be0f194c4566047ea4ba860", "committedDate": "2020-03-13T19:43:03Z", "message": "fix rest tests\n\nSigned-off-by: Apekshit Sharma <apekshit.sharma@hedera.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b169bf25e39c33e4c7be6541bc0448b188796247", "author": {"user": {"login": "apeksharma", "name": "Apekshit Sharma"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/b169bf25e39c33e4c7be6541bc0448b188796247", "committedDate": "2020-03-16T20:18:01Z", "message": "address review comments\n\nSigned-off-by: Apekshit Sharma <apekshit.sharma@hedera.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "491496cc844a832ea1491073d196f06002a1923b", "author": {"user": {"login": "apeksharma", "name": "Apekshit Sharma"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/491496cc844a832ea1491073d196f06002a1923b", "committedDate": "2020-03-16T20:37:45Z", "message": "minor changes\n\nSigned-off-by: Apekshit Sharma <apekshit.sharma@hedera.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ccf7e913acb23b8d7968b690c0dddd267e657a2d", "author": {"user": {"login": "apeksharma", "name": "Apekshit Sharma"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/ccf7e913acb23b8d7968b690c0dddd267e657a2d", "committedDate": "2020-03-16T20:44:47Z", "message": "Merge branch 'master' into parser_133"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1NTgwOTIx", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/600#pullrequestreview-375580921", "createdAt": "2020-03-16T21:03:32Z", "commit": {"oid": "ccf7e913acb23b8d7968b690c0dddd267e657a2d"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a124ccdc0b6432214376a9185857b8a8519da604", "author": {"user": {"login": "apeksharma", "name": "Apekshit Sharma"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/a124ccdc0b6432214376a9185857b8a8519da604", "committedDate": "2020-03-16T21:07:32Z", "message": "Merge branch 'master' into parser_133"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1NTg4MDk1", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/600#pullrequestreview-375588095", "createdAt": "2020-03-16T21:15:56Z", "commit": {"oid": "a124ccdc0b6432214376a9185857b8a8519da604"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1NTg4Njk0", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/600#pullrequestreview-375588694", "createdAt": "2020-03-16T21:17:00Z", "commit": {"oid": "a124ccdc0b6432214376a9185857b8a8519da604"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3331, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}