{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM5NzM5NjAw", "number": 1359, "reviewThreads": {"totalCount": 45, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQxOTozMzo0MFrOFFLCBQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQxNjozNDoyM1rOFIOIgw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQwOTY3OTQxOnYy", "diffSide": "RIGHT", "path": "charts/hedera-mirror/values.yaml", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQxOTozMzo0MFrOIFjDgw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQyMTo0OTozMFrOIHapEw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjY4ODEzMQ==", "bodyText": "Hmm, should I move this into the importer chart as a property?", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r542688131", "createdAt": "2020-12-14T19:33:40Z", "author": {"login": "Nana-EC"}, "path": "charts/hedera-mirror/values.yaml", "diffHunk": "@@ -15,6 +15,8 @@ global:\n     username: mirror_api\n     password: mirror_api_pass\n   useReleaseForNameLabel: false  # Set the name label to the release name for Marketplace\n+  extaddressbook:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2e362275c44942a3e932cce1cc440f1374a058b9"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjc4MDk1MQ==", "bodyText": "What is it? How is it used? What's an ext?", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r542780951", "createdAt": "2020-12-14T21:01:13Z", "author": {"login": "steven-sheehy"}, "path": "charts/hedera-mirror/values.yaml", "diffHunk": "@@ -15,6 +15,8 @@ global:\n     username: mirror_api\n     password: mirror_api_pass\n   useReleaseForNameLabel: false  # Set the name label to the release name for Marketplace\n+  extaddressbook:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjY4ODEzMQ=="}, "originalCommit": {"oid": "2e362275c44942a3e932cce1cc440f1374a058b9"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzA3NTcyOA==", "bodyText": "This is an external address book (i.e. not in class path) that is used for non demo/testnet/mainnet network.\nIn this scenario the address book is place at the intialAddressBook path for reading\nProbably better way to state this would be\nimporter:\n  initialAddressBook:\n    enabled: true", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r543075728", "createdAt": "2020-12-15T06:18:03Z", "author": {"login": "Nana-EC"}, "path": "charts/hedera-mirror/values.yaml", "diffHunk": "@@ -15,6 +15,8 @@ global:\n     username: mirror_api\n     password: mirror_api_pass\n   useReleaseForNameLabel: false  # Set the name label to the release name for Marketplace\n+  extaddressbook:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjY4ODEzMQ=="}, "originalCommit": {"oid": "2e362275c44942a3e932cce1cc440f1374a058b9"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mzc0NjAwMA==", "bodyText": "Went with above for simplicity.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r543746000", "createdAt": "2020-12-15T22:53:18Z", "author": {"login": "Nana-EC"}, "path": "charts/hedera-mirror/values.yaml", "diffHunk": "@@ -15,6 +15,8 @@ global:\n     username: mirror_api\n     password: mirror_api_pass\n   useReleaseForNameLabel: false  # Set the name label to the release name for Marketplace\n+  extaddressbook:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjY4ODEzMQ=="}, "originalCommit": {"oid": "2e362275c44942a3e932cce1cc440f1374a058b9"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY0NzQ0Mw==", "bodyText": "Removed this, so is no longer applicable", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r544647443", "createdAt": "2020-12-16T21:49:30Z", "author": {"login": "Nana-EC"}, "path": "charts/hedera-mirror/values.yaml", "diffHunk": "@@ -15,6 +15,8 @@ global:\n     username: mirror_api\n     password: mirror_api_pass\n   useReleaseForNameLabel: false  # Set the name label to the release name for Marketplace\n+  extaddressbook:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjY4ODEzMQ=="}, "originalCommit": {"oid": "2e362275c44942a3e932cce1cc440f1374a058b9"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQwOTY4NjM4OnYy", "diffSide": "RIGHT", "path": "charts/hedera-mirror/values.yaml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQxOTozNDo0NVrOIFjIOQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQyMjo1Mzo0NFrOIGjoqg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjY4OTMzNw==", "bodyText": "Might remove timescaledb.postgresql.databases to ensure that all db and user creation logic is done in some script", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r542689337", "createdAt": "2020-12-14T19:34:45Z", "author": {"login": "Nana-EC"}, "path": "charts/hedera-mirror/values.yaml", "diffHunk": "@@ -169,3 +171,19 @@ redis:\n \n rest:\n   enabled: true\n+\n+timescaledb:\n+  credentials:\n+    accessNode:\n+      superuser: mirror_node_pass\n+    dataNode:\n+      superuser: mirror_node_pass\n+  enabled: false\n+  persistentVolume:\n+    size: 10Gi\n+  #  postgresql:\n+  #    databases: [\"postgres\", \"mirror_node\"]", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2e362275c44942a3e932cce1cc440f1374a058b9"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mzc0NjIxOA==", "bodyText": "Removed and went with default postgres", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r543746218", "createdAt": "2020-12-15T22:53:44Z", "author": {"login": "Nana-EC"}, "path": "charts/hedera-mirror/values.yaml", "diffHunk": "@@ -169,3 +171,19 @@ redis:\n \n rest:\n   enabled: true\n+\n+timescaledb:\n+  credentials:\n+    accessNode:\n+      superuser: mirror_node_pass\n+    dataNode:\n+      superuser: mirror_node_pass\n+  enabled: false\n+  persistentVolume:\n+    size: 10Gi\n+  #  postgresql:\n+  #    databases: [\"postgres\", \"mirror_node\"]", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjY4OTMzNw=="}, "originalCommit": {"oid": "2e362275c44942a3e932cce1cc440f1374a058b9"}, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxMDIxMzE4OnYy", "diffSide": "RIGHT", "path": "charts/hedera-mirror/values.yaml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQyMDo1NToxOFrOIFoUxw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQyMjo1NTowMVrOIGjrUw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjc3NDQ3MQ==", "bodyText": "This should be a lot higher. We have 500Gi for postgresql", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r542774471", "createdAt": "2020-12-14T20:55:18Z", "author": {"login": "steven-sheehy"}, "path": "charts/hedera-mirror/values.yaml", "diffHunk": "@@ -169,3 +171,19 @@ redis:\n \n rest:\n   enabled: true\n+\n+timescaledb:\n+  credentials:\n+    accessNode:\n+      superuser: mirror_node_pass\n+    dataNode:\n+      superuser: mirror_node_pass\n+  enabled: false\n+  persistentVolume:\n+    size: 10Gi", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2e362275c44942a3e932cce1cc440f1374a058b9"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mzc0Njg5OQ==", "bodyText": "Went with 500Gi to start with. I think like a few other configs the tweaking/tuning can be done later along with testing.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r543746899", "createdAt": "2020-12-15T22:55:01Z", "author": {"login": "Nana-EC"}, "path": "charts/hedera-mirror/values.yaml", "diffHunk": "@@ -169,3 +171,19 @@ redis:\n \n rest:\n   enabled: true\n+\n+timescaledb:\n+  credentials:\n+    accessNode:\n+      superuser: mirror_node_pass\n+    dataNode:\n+      superuser: mirror_node_pass\n+  enabled: false\n+  persistentVolume:\n+    size: 10Gi", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjc3NDQ3MQ=="}, "originalCommit": {"oid": "2e362275c44942a3e932cce1cc440f1374a058b9"}, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxMDIxNjk4OnYy", "diffSide": "RIGHT", "path": "charts/hedera-mirror/values.yaml", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQyMDo1NTo1NlrOIFoXUw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQyMjo1NToyMlrOIGjsJQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjc3NTEyMw==", "bodyText": "You should research and specify resource constraints as we do for every other dependency.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r542775123", "createdAt": "2020-12-14T20:55:56Z", "author": {"login": "steven-sheehy"}, "path": "charts/hedera-mirror/values.yaml", "diffHunk": "@@ -169,3 +171,19 @@ redis:\n \n rest:\n   enabled: true\n+\n+timescaledb:\n+  credentials:\n+    accessNode:\n+      superuser: mirror_node_pass\n+    dataNode:\n+      superuser: mirror_node_pass\n+  enabled: false", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2e362275c44942a3e932cce1cc440f1374a058b9"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzA4MjQ4NA==", "bodyText": "Adding initial go based on current Postgres constraints", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r543082484", "createdAt": "2020-12-15T06:34:56Z", "author": {"login": "Nana-EC"}, "path": "charts/hedera-mirror/values.yaml", "diffHunk": "@@ -169,3 +171,19 @@ redis:\n \n rest:\n   enabled: true\n+\n+timescaledb:\n+  credentials:\n+    accessNode:\n+      superuser: mirror_node_pass\n+    dataNode:\n+      superuser: mirror_node_pass\n+  enabled: false", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjc3NTEyMw=="}, "originalCommit": {"oid": "2e362275c44942a3e932cce1cc440f1374a058b9"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mzc0NzEwOQ==", "bodyText": "Added some initial constraints. Further tweaking could be done later", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r543747109", "createdAt": "2020-12-15T22:55:22Z", "author": {"login": "Nana-EC"}, "path": "charts/hedera-mirror/values.yaml", "diffHunk": "@@ -169,3 +171,19 @@ redis:\n \n rest:\n   enabled: true\n+\n+timescaledb:\n+  credentials:\n+    accessNode:\n+      superuser: mirror_node_pass\n+    dataNode:\n+      superuser: mirror_node_pass\n+  enabled: false", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjc3NTEyMw=="}, "originalCommit": {"oid": "2e362275c44942a3e932cce1cc440f1374a058b9"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxMDIyMDM0OnYy", "diffSide": "RIGHT", "path": "charts/hedera-mirror/values.yaml", "isResolved": true, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQyMDo1NjoyNlrOIFoZng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQyMTo1MDowM1rOIHaqVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjc3NTcxMA==", "bodyText": "Why would we not want timescaledb to have its own service account?", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r542775710", "createdAt": "2020-12-14T20:56:26Z", "author": {"login": "steven-sheehy"}, "path": "charts/hedera-mirror/values.yaml", "diffHunk": "@@ -169,3 +171,19 @@ redis:\n \n rest:\n   enabled: true\n+\n+timescaledb:\n+  credentials:\n+    accessNode:\n+      superuser: mirror_node_pass\n+    dataNode:\n+      superuser: mirror_node_pass\n+  enabled: false\n+  persistentVolume:\n+    size: 10Gi\n+  #  postgresql:\n+  #    databases: [\"postgres\", \"mirror_node\"]\n+  serviceAccount:\n+    create: false", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2e362275c44942a3e932cce1cc440f1374a058b9"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzA3Mjg1OA==", "bodyText": "There was a bug here where the chart failed to install because of a name conflict.\nMeant to circle back with a custom name.\nWill add in next commit", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r543072858", "createdAt": "2020-12-15T06:10:34Z", "author": {"login": "Nana-EC"}, "path": "charts/hedera-mirror/values.yaml", "diffHunk": "@@ -169,3 +171,19 @@ redis:\n \n rest:\n   enabled: true\n+\n+timescaledb:\n+  credentials:\n+    accessNode:\n+      superuser: mirror_node_pass\n+    dataNode:\n+      superuser: mirror_node_pass\n+  enabled: false\n+  persistentVolume:\n+    size: 10Gi\n+  #  postgresql:\n+  #    databases: [\"postgres\", \"mirror_node\"]\n+  serviceAccount:\n+    create: false", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjc3NTcxMA=="}, "originalCommit": {"oid": "2e362275c44942a3e932cce1cc440f1374a058b9"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mzc0NzMyOA==", "bodyText": "Service account added with custom name to avoid resource name conflict", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r543747328", "createdAt": "2020-12-15T22:55:44Z", "author": {"login": "Nana-EC"}, "path": "charts/hedera-mirror/values.yaml", "diffHunk": "@@ -169,3 +171,19 @@ redis:\n \n rest:\n   enabled: true\n+\n+timescaledb:\n+  credentials:\n+    accessNode:\n+      superuser: mirror_node_pass\n+    dataNode:\n+      superuser: mirror_node_pass\n+  enabled: false\n+  persistentVolume:\n+    size: 10Gi\n+  #  postgresql:\n+  #    databases: [\"postgres\", \"mirror_node\"]\n+  serviceAccount:\n+    create: false", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjc3NTcxMA=="}, "originalCommit": {"oid": "2e362275c44942a3e932cce1cc440f1374a058b9"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mzc3MjIzNw==", "bodyText": "I don't see how there could've been a name conflict unless a prior install didn't get deleted properly. Hardcoding the name actually makes it more likely there will be a resource name conflict as it doesn't include the namespace or release name in the name this way.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r543772237", "createdAt": "2020-12-15T23:51:48Z", "author": {"login": "steven-sheehy"}, "path": "charts/hedera-mirror/values.yaml", "diffHunk": "@@ -169,3 +171,19 @@ redis:\n \n rest:\n   enabled: true\n+\n+timescaledb:\n+  credentials:\n+    accessNode:\n+      superuser: mirror_node_pass\n+    dataNode:\n+      superuser: mirror_node_pass\n+  enabled: false\n+  persistentVolume:\n+    size: 10Gi\n+  #  postgresql:\n+  #    databases: [\"postgres\", \"mirror_node\"]\n+  serviceAccount:\n+    create: false", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjc3NTcxMA=="}, "originalCommit": {"oid": "2e362275c44942a3e932cce1cc440f1374a058b9"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDUwODg4OA==", "bodyText": "I think I may have tracked down the issue. charts/hedera-mirror/charts still contained the timescale single chart so that may have been deploying that service account and potentially other resources. Looking into this", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r544508888", "createdAt": "2020-12-16T18:01:23Z", "author": {"login": "Nana-EC"}, "path": "charts/hedera-mirror/values.yaml", "diffHunk": "@@ -169,3 +171,19 @@ redis:\n \n rest:\n   enabled: true\n+\n+timescaledb:\n+  credentials:\n+    accessNode:\n+      superuser: mirror_node_pass\n+    dataNode:\n+      superuser: mirror_node_pass\n+  enabled: false\n+  persistentVolume:\n+    size: 10Gi\n+  #  postgresql:\n+  #    databases: [\"postgres\", \"mirror_node\"]\n+  serviceAccount:\n+    create: false", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjc3NTcxMA=="}, "originalCommit": {"oid": "2e362275c44942a3e932cce1cc440f1374a058b9"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY0Nzc2Ng==", "bodyText": "Yep, the single chart was the issue. Remove that and there's no longer a conflict", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r544647766", "createdAt": "2020-12-16T21:50:03Z", "author": {"login": "Nana-EC"}, "path": "charts/hedera-mirror/values.yaml", "diffHunk": "@@ -169,3 +171,19 @@ redis:\n \n rest:\n   enabled: true\n+\n+timescaledb:\n+  credentials:\n+    accessNode:\n+      superuser: mirror_node_pass\n+    dataNode:\n+      superuser: mirror_node_pass\n+  enabled: false\n+  persistentVolume:\n+    size: 10Gi\n+  #  postgresql:\n+  #    databases: [\"postgres\", \"mirror_node\"]\n+  serviceAccount:\n+    create: false", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjc3NTcxMA=="}, "originalCommit": {"oid": "2e362275c44942a3e932cce1cc440f1374a058b9"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxMDIzMzk0OnYy", "diffSide": "RIGHT", "path": "charts/hedera-mirror-importer/templates/statefulset.yaml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQyMDo1ODoyOVrOIFoiSA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQyMDo1ODoyOVrOIFoiSA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjc3NzkyOA==", "bodyText": "Revert indentation breakage", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r542777928", "createdAt": "2020-12-14T20:58:29Z", "author": {"login": "steven-sheehy"}, "path": "charts/hedera-mirror-importer/templates/statefulset.yaml", "diffHunk": "@@ -79,13 +79,19 @@ spec:\n         {{- toYaml .Values.tolerations | nindent 8 }}\n       volumes:\n         - name: config\n-          secret:\n+          projected:\n             defaultMode: 420\n-            secretName: {{ include \"hedera-mirror-importer.fullname\" . }}\n-{{- if not .Values.persistence.enabled }}\n-        - name: data\n-          emptyDir: {}\n-{{- else }}\n+            sources:\n+              - secret:\n+                  name: {{ include \"hedera-mirror-importer.fullname\" . }}\n+              {{- if .Values.global.extaddressbook.enabled }}\n+              - secret:\n+                  name: mirror-importer-addressbook\n+              {{- end}}\n+  {{- if not .Values.persistence.enabled }}\n+  - name: data", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2e362275c44942a3e932cce1cc440f1374a058b9"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxMDMwOTAzOnYy", "diffSide": "RIGHT", "path": "charts/hedera-mirror/values.yaml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQyMTowOTo1NVrOIFpSJw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQyMjo1NjozN1rOIGjuzA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjc5MDE4Mw==", "bodyText": "Chart mentions some values are not production ready and should be tweaked. We should tweak:\nhttps://github.com/timescale/timescaledb-kubernetes/blob/abec6247e78b685d4dc075ed877ba02d0eac72f8/charts/timescaledb-multinode/values.yaml#L72", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r542790183", "createdAt": "2020-12-14T21:09:55Z", "author": {"login": "steven-sheehy"}, "path": "charts/hedera-mirror/values.yaml", "diffHunk": "@@ -169,3 +171,19 @@ redis:\n \n rest:\n   enabled: true\n+\n+timescaledb:\n+  credentials:\n+    accessNode:\n+      superuser: mirror_node_pass\n+    dataNode:\n+      superuser: mirror_node_pass\n+  enabled: false\n+  persistentVolume:\n+    size: 10Gi\n+  #  postgresql:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2e362275c44942a3e932cce1cc440f1374a058b9"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mzc0Nzc4OA==", "bodyText": "Tweaked. Likely to have further tweaking in following tasks", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r543747788", "createdAt": "2020-12-15T22:56:37Z", "author": {"login": "Nana-EC"}, "path": "charts/hedera-mirror/values.yaml", "diffHunk": "@@ -169,3 +171,19 @@ redis:\n \n rest:\n   enabled: true\n+\n+timescaledb:\n+  credentials:\n+    accessNode:\n+      superuser: mirror_node_pass\n+    dataNode:\n+      superuser: mirror_node_pass\n+  enabled: false\n+  persistentVolume:\n+    size: 10Gi\n+  #  postgresql:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjc5MDE4Mw=="}, "originalCommit": {"oid": "2e362275c44942a3e932cce1cc440f1374a058b9"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxMDQ5OTY3OnYy", "diffSide": "RIGHT", "path": "charts/hedera-mirror-importer/templates/statefulset.yaml", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQyMTozODoyNFrOIFrJ9w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQyMjo1Njo0NVrOIGjvFw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjgyMDg1NQ==", "bodyText": "suggestion: it's good to have a comment in importer charts values about explicit addressbook file name if network is OTHER", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r542820855", "createdAt": "2020-12-14T21:38:24Z", "author": {"login": "xin-hedera"}, "path": "charts/hedera-mirror-importer/templates/statefulset.yaml", "diffHunk": "@@ -79,13 +79,19 @@ spec:\n         {{- toYaml .Values.tolerations | nindent 8 }}\n       volumes:\n         - name: config\n-          secret:\n+          projected:\n             defaultMode: 420\n-            secretName: {{ include \"hedera-mirror-importer.fullname\" . }}\n-{{- if not .Values.persistence.enabled }}\n-        - name: data\n-          emptyDir: {}\n-{{- else }}\n+            sources:\n+              - secret:\n+                  name: {{ include \"hedera-mirror-importer.fullname\" . }}\n+              {{- if .Values.global.extaddressbook.enabled }}\n+              - secret:\n+                  name: mirror-importer-addressbook", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2e362275c44942a3e932cce1cc440f1374a058b9"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzA3NDkyMg==", "bodyText": "Will add a comment", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r543074922", "createdAt": "2020-12-15T06:15:55Z", "author": {"login": "Nana-EC"}, "path": "charts/hedera-mirror-importer/templates/statefulset.yaml", "diffHunk": "@@ -79,13 +79,19 @@ spec:\n         {{- toYaml .Values.tolerations | nindent 8 }}\n       volumes:\n         - name: config\n-          secret:\n+          projected:\n             defaultMode: 420\n-            secretName: {{ include \"hedera-mirror-importer.fullname\" . }}\n-{{- if not .Values.persistence.enabled }}\n-        - name: data\n-          emptyDir: {}\n-{{- else }}\n+            sources:\n+              - secret:\n+                  name: {{ include \"hedera-mirror-importer.fullname\" . }}\n+              {{- if .Values.global.extaddressbook.enabled }}\n+              - secret:\n+                  name: mirror-importer-addressbook", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjgyMDg1NQ=="}, "originalCommit": {"oid": "2e362275c44942a3e932cce1cc440f1374a058b9"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mzc0Nzg2Mw==", "bodyText": "Added comment", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r543747863", "createdAt": "2020-12-15T22:56:45Z", "author": {"login": "Nana-EC"}, "path": "charts/hedera-mirror-importer/templates/statefulset.yaml", "diffHunk": "@@ -79,13 +79,19 @@ spec:\n         {{- toYaml .Values.tolerations | nindent 8 }}\n       volumes:\n         - name: config\n-          secret:\n+          projected:\n             defaultMode: 420\n-            secretName: {{ include \"hedera-mirror-importer.fullname\" . }}\n-{{- if not .Values.persistence.enabled }}\n-        - name: data\n-          emptyDir: {}\n-{{- else }}\n+            sources:\n+              - secret:\n+                  name: {{ include \"hedera-mirror-importer.fullname\" . }}\n+              {{- if .Values.global.extaddressbook.enabled }}\n+              - secret:\n+                  name: mirror-importer-addressbook", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjgyMDg1NQ=="}, "originalCommit": {"oid": "2e362275c44942a3e932cce1cc440f1374a058b9"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxNjc3NzU0OnYy", "diffSide": "RIGHT", "path": "charts/hedera-mirror/values.yaml", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQyMzowNjowM1rOIGkAXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQwMToxOTozM1rOIGnSrA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mzc1MjI4NQ==", "bodyText": "But available memory is max 1Gi per your resource constraints. This looks like it is requesting more than is available.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r543752285", "createdAt": "2020-12-15T23:06:03Z", "author": {"login": "steven-sheehy"}, "path": "charts/hedera-mirror/values.yaml", "diffHunk": "@@ -169,3 +169,33 @@ redis:\n \n rest:\n   enabled: true\n+\n+timescaledb:\n+  credentials:\n+    accessNode:\n+      superuser: mirror_node_pass\n+    dataNode:\n+      superuser: mirror_node_pass\n+  enabled: false\n+  persistentVolume:\n+    size: 500Gi\n+  resources:\n+    limits:\n+      cpu: 1500m\n+      memory: 1000Mi\n+    requests:\n+      cpu: 250m\n+      memory: 500Mi\n+  postgresql:\n+    databases:\n+      - postgres\n+    parameters:\n+      max_wal_size: 8GB  # recommended to be 80% of the Volume Size\n+      min_wal_size: 2GB  # 80% of the WAL Volume Size\n+      shared_buffers: 2GB # recommended to be 25% of available instance memory", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5f8b4703067cb81e2f9e45683b9cdc432d63c99d"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mzc5ODQ4MA==", "bodyText": "Will tweak to be more consistent with constraint", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r543798480", "createdAt": "2020-12-16T00:59:08Z", "author": {"login": "Nana-EC"}, "path": "charts/hedera-mirror/values.yaml", "diffHunk": "@@ -169,3 +169,33 @@ redis:\n \n rest:\n   enabled: true\n+\n+timescaledb:\n+  credentials:\n+    accessNode:\n+      superuser: mirror_node_pass\n+    dataNode:\n+      superuser: mirror_node_pass\n+  enabled: false\n+  persistentVolume:\n+    size: 500Gi\n+  resources:\n+    limits:\n+      cpu: 1500m\n+      memory: 1000Mi\n+    requests:\n+      cpu: 250m\n+      memory: 500Mi\n+  postgresql:\n+    databases:\n+      - postgres\n+    parameters:\n+      max_wal_size: 8GB  # recommended to be 80% of the Volume Size\n+      min_wal_size: 2GB  # 80% of the WAL Volume Size\n+      shared_buffers: 2GB # recommended to be 25% of available instance memory", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mzc1MjI4NQ=="}, "originalCommit": {"oid": "5f8b4703067cb81e2f9e45683b9cdc432d63c99d"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzgwNjEyNA==", "bodyText": "Or up max memory. 1Gi sounds way too low", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r543806124", "createdAt": "2020-12-16T01:19:33Z", "author": {"login": "steven-sheehy"}, "path": "charts/hedera-mirror/values.yaml", "diffHunk": "@@ -169,3 +169,33 @@ redis:\n \n rest:\n   enabled: true\n+\n+timescaledb:\n+  credentials:\n+    accessNode:\n+      superuser: mirror_node_pass\n+    dataNode:\n+      superuser: mirror_node_pass\n+  enabled: false\n+  persistentVolume:\n+    size: 500Gi\n+  resources:\n+    limits:\n+      cpu: 1500m\n+      memory: 1000Mi\n+    requests:\n+      cpu: 250m\n+      memory: 500Mi\n+  postgresql:\n+    databases:\n+      - postgres\n+    parameters:\n+      max_wal_size: 8GB  # recommended to be 80% of the Volume Size\n+      min_wal_size: 2GB  # 80% of the WAL Volume Size\n+      shared_buffers: 2GB # recommended to be 25% of available instance memory", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mzc1MjI4NQ=="}, "originalCommit": {"oid": "5f8b4703067cb81e2f9e45683b9cdc432d63c99d"}, "originalPosition": 36}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxNjc3ODk0OnYy", "diffSide": "RIGHT", "path": "charts/hedera-mirror-importer/templates/statefulset.yaml", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQyMzowNjoyOFrOIGkBHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQyMTo1MDoyOFrOIHarbw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mzc1MjQ3OA==", "bodyText": "nit: This indentation doesn't match its corresponding if/else", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r543752478", "createdAt": "2020-12-15T23:06:28Z", "author": {"login": "steven-sheehy"}, "path": "charts/hedera-mirror-importer/templates/statefulset.yaml", "diffHunk": "@@ -98,4 +104,4 @@ spec:\n         {{- if .Values.persistence.storageClass }}\n         storageClassName: \"{{ .Values.persistence.storageClass }}\"\n         {{- end }}\n-{{- end }}\n+  {{- end }}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5f8b4703067cb81e2f9e45683b9cdc432d63c99d"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mzc5OTcxNQ==", "bodyText": "IntelliJ keeps indenting this. Will try to fix once I've employed the suggested extraVolume and extraVolumeMounts", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r543799715", "createdAt": "2020-12-16T01:02:24Z", "author": {"login": "Nana-EC"}, "path": "charts/hedera-mirror-importer/templates/statefulset.yaml", "diffHunk": "@@ -98,4 +104,4 @@ spec:\n         {{- if .Values.persistence.storageClass }}\n         storageClassName: \"{{ .Values.persistence.storageClass }}\"\n         {{- end }}\n-{{- end }}\n+  {{- end }}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mzc1MjQ3OA=="}, "originalCommit": {"oid": "5f8b4703067cb81e2f9e45683b9cdc432d63c99d"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzgwNTg1MA==", "bodyText": "Yeah, I don't use intellij to edit helm files. I use vs or vi. Intellij just doesn't understand helm.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r543805850", "createdAt": "2020-12-16T01:18:48Z", "author": {"login": "steven-sheehy"}, "path": "charts/hedera-mirror-importer/templates/statefulset.yaml", "diffHunk": "@@ -98,4 +104,4 @@ spec:\n         {{- if .Values.persistence.storageClass }}\n         storageClassName: \"{{ .Values.persistence.storageClass }}\"\n         {{- end }}\n-{{- end }}\n+  {{- end }}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mzc1MjQ3OA=="}, "originalCommit": {"oid": "5f8b4703067cb81e2f9e45683b9cdc432d63c99d"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY0ODA0Nw==", "bodyText": "Should be fixed now", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r544648047", "createdAt": "2020-12-16T21:50:28Z", "author": {"login": "Nana-EC"}, "path": "charts/hedera-mirror-importer/templates/statefulset.yaml", "diffHunk": "@@ -98,4 +104,4 @@ spec:\n         {{- if .Values.persistence.storageClass }}\n         storageClassName: \"{{ .Values.persistence.storageClass }}\"\n         {{- end }}\n-{{- end }}\n+  {{- end }}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mzc1MjQ3OA=="}, "originalCommit": {"oid": "5f8b4703067cb81e2f9e45683b9cdc432d63c99d"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxNjg3MDc4OnYy", "diffSide": "RIGHT", "path": "charts/hedera-mirror-importer/templates/statefulset.yaml", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQyMzozNjowOVrOIGk0Dw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQyMTo1MDo0NlrOIHasGw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mzc2NTUxOQ==", "bodyText": "This doesn't really add the OTHER address book as it still requires you to add a secret manually external to this chart AND configure the path via the values.yaml. I also don't think it's necessary to complicate the config volume by mixing it with the address book. There is a better option:\nAdd extraVolumes and extraVolumeMounts as a lot of charts do to add arbitrary secrets, configmaps, etc. to the chart via values.yaml. Then the user would populate the initialAddressBook via the standard config property. The benefit of this approach is pretty widely used by community charts and it is generic and can support adding any arbitrary data in the future that we or users may need.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r543765519", "createdAt": "2020-12-15T23:36:09Z", "author": {"login": "steven-sheehy"}, "path": "charts/hedera-mirror-importer/templates/statefulset.yaml", "diffHunk": "@@ -79,13 +79,19 @@ spec:\n         {{- toYaml .Values.tolerations | nindent 8 }}\n       volumes:\n         - name: config\n-          secret:\n+          projected:\n             defaultMode: 420\n-            secretName: {{ include \"hedera-mirror-importer.fullname\" . }}\n-{{- if not .Values.persistence.enabled }}\n+            sources:\n+              - secret:\n+                  name: {{ include \"hedera-mirror-importer.fullname\" . }}\n+              {{- if .Values.initialAddressBook.enabled }}\n+              - secret:\n+                  name: mirror-importer-addressbook # if enabled add filesystem path to initial address book for OTHER networks", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5f8b4703067cb81e2f9e45683b9cdc432d63c99d"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mzc5NzQ5MQ==", "bodyText": "Sure, will look into the extraVolume and extraVolumeMounts.\nRegarding the extra configs yes, the operator will still have to set the network: OTHER and initialAddressBook path and deploy the secret manually.\nThis makes sense since we do expect deployment of that nature to be more detailed.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r543797491", "createdAt": "2020-12-16T00:56:37Z", "author": {"login": "Nana-EC"}, "path": "charts/hedera-mirror-importer/templates/statefulset.yaml", "diffHunk": "@@ -79,13 +79,19 @@ spec:\n         {{- toYaml .Values.tolerations | nindent 8 }}\n       volumes:\n         - name: config\n-          secret:\n+          projected:\n             defaultMode: 420\n-            secretName: {{ include \"hedera-mirror-importer.fullname\" . }}\n-{{- if not .Values.persistence.enabled }}\n+            sources:\n+              - secret:\n+                  name: {{ include \"hedera-mirror-importer.fullname\" . }}\n+              {{- if .Values.initialAddressBook.enabled }}\n+              - secret:\n+                  name: mirror-importer-addressbook # if enabled add filesystem path to initial address book for OTHER networks", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mzc2NTUxOQ=="}, "originalCommit": {"oid": "5f8b4703067cb81e2f9e45683b9cdc432d63c99d"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY0ODIxOQ==", "bodyText": "Implemented use of extraVolumes and extraVolumeMounts configs", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r544648219", "createdAt": "2020-12-16T21:50:46Z", "author": {"login": "Nana-EC"}, "path": "charts/hedera-mirror-importer/templates/statefulset.yaml", "diffHunk": "@@ -79,13 +79,19 @@ spec:\n         {{- toYaml .Values.tolerations | nindent 8 }}\n       volumes:\n         - name: config\n-          secret:\n+          projected:\n             defaultMode: 420\n-            secretName: {{ include \"hedera-mirror-importer.fullname\" . }}\n-{{- if not .Values.persistence.enabled }}\n+            sources:\n+              - secret:\n+                  name: {{ include \"hedera-mirror-importer.fullname\" . }}\n+              {{- if .Values.initialAddressBook.enabled }}\n+              - secret:\n+                  name: mirror-importer-addressbook # if enabled add filesystem path to initial address book for OTHER networks", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mzc2NTUxOQ=="}, "originalCommit": {"oid": "5f8b4703067cb81e2f9e45683b9cdc432d63c99d"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQyMjgxNjE3OnYy", "diffSide": "RIGHT", "path": "charts/hedera-mirror/templates/job-timescaledb-init.yaml", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQyMjoyNDoyNFrOIHbz6Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQxNzo0OTo1M1rOIJgvgw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY2NjYwMQ==", "bodyText": "We should use the same image to connect as a client as we do for the TimescaleDB server. It also has psql in it.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r544666601", "createdAt": "2020-12-16T22:24:24Z", "author": {"login": "steven-sheehy"}, "path": "charts/hedera-mirror/templates/job-timescaledb-init.yaml", "diffHunk": "@@ -0,0 +1,92 @@\n+apiVersion: batch/v1\n+kind: Job\n+metadata:\n+  labels:\n+    {{- include \"hedera-mirror.labels\" . | nindent 4 }}\n+  name: {{ printf \"%s-timescaledb-init-job\" .Release.Name }}\n+  namespace: {{ include \"hedera-mirror.namespace\" . }}\n+  annotations:\n+    \"helm.sh/hook-delete-policy\": hook-succeeded\n+spec:\n+  backoffLimit: 4\n+  template:\n+    spec:\n+      containers:\n+        - name: init-mirrornode-db\n+          image: postgres:11-alpine", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eee7f65b34cdc872ad59e1f08f22e2e8e2baba47"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDcwOTkyMA==", "bodyText": "I was matching the logic of the other timescale jobs but I can set it to timescaledev/timescaledb-ha:pg12-ts2.0.0-rc3", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r544709920", "createdAt": "2020-12-16T23:59:36Z", "author": {"login": "Nana-EC"}, "path": "charts/hedera-mirror/templates/job-timescaledb-init.yaml", "diffHunk": "@@ -0,0 +1,92 @@\n+apiVersion: batch/v1\n+kind: Job\n+metadata:\n+  labels:\n+    {{- include \"hedera-mirror.labels\" . | nindent 4 }}\n+  name: {{ printf \"%s-timescaledb-init-job\" .Release.Name }}\n+  namespace: {{ include \"hedera-mirror.namespace\" . }}\n+  annotations:\n+    \"helm.sh/hook-delete-policy\": hook-succeeded\n+spec:\n+  backoffLimit: 4\n+  template:\n+    spec:\n+      containers:\n+        - name: init-mirrornode-db\n+          image: postgres:11-alpine", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY2NjYwMQ=="}, "originalCommit": {"oid": "eee7f65b34cdc872ad59e1f08f22e2e8e2baba47"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njg0NDU0Nw==", "bodyText": "Updated", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r546844547", "createdAt": "2020-12-21T17:49:53Z", "author": {"login": "Nana-EC"}, "path": "charts/hedera-mirror/templates/job-timescaledb-init.yaml", "diffHunk": "@@ -0,0 +1,92 @@\n+apiVersion: batch/v1\n+kind: Job\n+metadata:\n+  labels:\n+    {{- include \"hedera-mirror.labels\" . | nindent 4 }}\n+  name: {{ printf \"%s-timescaledb-init-job\" .Release.Name }}\n+  namespace: {{ include \"hedera-mirror.namespace\" . }}\n+  annotations:\n+    \"helm.sh/hook-delete-policy\": hook-succeeded\n+spec:\n+  backoffLimit: 4\n+  template:\n+    spec:\n+      containers:\n+        - name: init-mirrornode-db\n+          image: postgres:11-alpine", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY2NjYwMQ=="}, "originalCommit": {"oid": "eee7f65b34cdc872ad59e1f08f22e2e8e2baba47"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQyMjgyMzkxOnYy", "diffSide": "RIGHT", "path": "charts/hedera-mirror/templates/job-timescaledb-init.yaml", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQyMjoyNjozNVrOIHb4cA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQxOToyNTowOVrOIJjXLQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY2Nzc2MA==", "bodyText": "Should set -o errexit -o pipefail", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r544667760", "createdAt": "2020-12-16T22:26:35Z", "author": {"login": "steven-sheehy"}, "path": "charts/hedera-mirror/templates/job-timescaledb-init.yaml", "diffHunk": "@@ -0,0 +1,92 @@\n+apiVersion: batch/v1\n+kind: Job\n+metadata:\n+  labels:\n+    {{- include \"hedera-mirror.labels\" . | nindent 4 }}\n+  name: {{ printf \"%s-timescaledb-init-job\" .Release.Name }}\n+  namespace: {{ include \"hedera-mirror.namespace\" . }}\n+  annotations:\n+    \"helm.sh/hook-delete-policy\": hook-succeeded\n+spec:\n+  backoffLimit: 4\n+  template:\n+    spec:\n+      containers:\n+        - name: init-mirrornode-db\n+          image: postgres:11-alpine\n+          command:\n+            - sh\n+            - -c\n+            - >", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eee7f65b34cdc872ad59e1f08f22e2e8e2baba47"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njg4MDg3NQ==", "bodyText": "Hitting issues on the pipe fail option\nset: Illegal option -o pipefail\n\nWill look into it", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r546880875", "createdAt": "2020-12-21T19:11:05Z", "author": {"login": "Nana-EC"}, "path": "charts/hedera-mirror/templates/job-timescaledb-init.yaml", "diffHunk": "@@ -0,0 +1,92 @@\n+apiVersion: batch/v1\n+kind: Job\n+metadata:\n+  labels:\n+    {{- include \"hedera-mirror.labels\" . | nindent 4 }}\n+  name: {{ printf \"%s-timescaledb-init-job\" .Release.Name }}\n+  namespace: {{ include \"hedera-mirror.namespace\" . }}\n+  annotations:\n+    \"helm.sh/hook-delete-policy\": hook-succeeded\n+spec:\n+  backoffLimit: 4\n+  template:\n+    spec:\n+      containers:\n+        - name: init-mirrornode-db\n+          image: postgres:11-alpine\n+          command:\n+            - sh\n+            - -c\n+            - >", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY2Nzc2MA=="}, "originalCommit": {"oid": "eee7f65b34cdc872ad59e1f08f22e2e8e2baba47"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njg4NzQ2OQ==", "bodyText": "pipefial shouldn't be needed with updated call logic that call the file secret", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r546887469", "createdAt": "2020-12-21T19:25:09Z", "author": {"login": "Nana-EC"}, "path": "charts/hedera-mirror/templates/job-timescaledb-init.yaml", "diffHunk": "@@ -0,0 +1,92 @@\n+apiVersion: batch/v1\n+kind: Job\n+metadata:\n+  labels:\n+    {{- include \"hedera-mirror.labels\" . | nindent 4 }}\n+  name: {{ printf \"%s-timescaledb-init-job\" .Release.Name }}\n+  namespace: {{ include \"hedera-mirror.namespace\" . }}\n+  annotations:\n+    \"helm.sh/hook-delete-policy\": hook-succeeded\n+spec:\n+  backoffLimit: 4\n+  template:\n+    spec:\n+      containers:\n+        - name: init-mirrornode-db\n+          image: postgres:11-alpine\n+          command:\n+            - sh\n+            - -c\n+            - >", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY2Nzc2MA=="}, "originalCommit": {"oid": "eee7f65b34cdc872ad59e1f08f22e2e8e2baba47"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQyMjgzMjkwOnYy", "diffSide": "RIGHT", "path": "charts/hedera-mirror/templates/job-timescaledb-init.yaml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQyMjoyOTowN1rOIHb9mw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQxNzo1MDowMlrOIJgvyg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY2OTA4Mw==", "bodyText": "This assumes the release name is mirror. Need to substitute the actual release name to work in our dev, for example.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r544669083", "createdAt": "2020-12-16T22:29:07Z", "author": {"login": "steven-sheehy"}, "path": "charts/hedera-mirror/templates/job-timescaledb-init.yaml", "diffHunk": "@@ -0,0 +1,92 @@\n+apiVersion: batch/v1\n+kind: Job\n+metadata:\n+  labels:\n+    {{- include \"hedera-mirror.labels\" . | nindent 4 }}\n+  name: {{ printf \"%s-timescaledb-init-job\" .Release.Name }}\n+  namespace: {{ include \"hedera-mirror.namespace\" . }}\n+  annotations:\n+    \"helm.sh/hook-delete-policy\": hook-succeeded\n+spec:\n+  backoffLimit: 4\n+  template:\n+    spec:\n+      containers:\n+        - name: init-mirrornode-db\n+          image: postgres:11-alpine\n+          command:\n+            - sh\n+            - -c\n+            - >\n+              while ! pg_isready -U postgres -h mirror-timescaledb-data; do sleep 1; done;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eee7f65b34cdc872ad59e1f08f22e2e8e2baba47"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njg0NDYxOA==", "bodyText": "Updated", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r546844618", "createdAt": "2020-12-21T17:50:02Z", "author": {"login": "Nana-EC"}, "path": "charts/hedera-mirror/templates/job-timescaledb-init.yaml", "diffHunk": "@@ -0,0 +1,92 @@\n+apiVersion: batch/v1\n+kind: Job\n+metadata:\n+  labels:\n+    {{- include \"hedera-mirror.labels\" . | nindent 4 }}\n+  name: {{ printf \"%s-timescaledb-init-job\" .Release.Name }}\n+  namespace: {{ include \"hedera-mirror.namespace\" . }}\n+  annotations:\n+    \"helm.sh/hook-delete-policy\": hook-succeeded\n+spec:\n+  backoffLimit: 4\n+  template:\n+    spec:\n+      containers:\n+        - name: init-mirrornode-db\n+          image: postgres:11-alpine\n+          command:\n+            - sh\n+            - -c\n+            - >\n+              while ! pg_isready -U postgres -h mirror-timescaledb-data; do sleep 1; done;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY2OTA4Mw=="}, "originalCommit": {"oid": "eee7f65b34cdc872ad59e1f08f22e2e8e2baba47"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQyMjg1MDM0OnYy", "diffSide": "RIGHT", "path": "charts/hedera-mirror/templates/job-timescaledb-init.yaml", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQyMjozMzo0M1rOIHcHcA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQxNzo1MDoxMFrOIJgwCg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY3MTYwMA==", "bodyText": "Bad practice to store SQL in environment variables and it's more secure to store passwords in secrets and mount them as files. For this reason, we should create a init.sql secret and mount it as a volume to the job and execute that. It's also cleaner since you can just use helm to inject the values directly to the secret and not have an additional variable mapping. Similar to how we do this in secret-postgresql.yaml.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r544671600", "createdAt": "2020-12-16T22:33:43Z", "author": {"login": "steven-sheehy"}, "path": "charts/hedera-mirror/templates/job-timescaledb-init.yaml", "diffHunk": "@@ -0,0 +1,92 @@\n+apiVersion: batch/v1\n+kind: Job\n+metadata:\n+  labels:\n+    {{- include \"hedera-mirror.labels\" . | nindent 4 }}\n+  name: {{ printf \"%s-timescaledb-init-job\" .Release.Name }}\n+  namespace: {{ include \"hedera-mirror.namespace\" . }}\n+  annotations:\n+    \"helm.sh/hook-delete-policy\": hook-succeeded\n+spec:\n+  backoffLimit: 4\n+  template:\n+    spec:\n+      containers:\n+        - name: init-mirrornode-db\n+          image: postgres:11-alpine\n+          command:\n+            - sh\n+            - -c\n+            - >\n+              while ! pg_isready -U postgres -h mirror-timescaledb-data; do sleep 1; done;\n+              echo \"${CREATE_USER_DB_SQL_COMMAND}\" | psql --file=- --echo-queries -d \"${ACCESS_SVC_CONNSTR_POSTGRES}\" \\\n+                  --set ON_ERROR_STOP=1 \\\n+                  --set dbname=\"${DBNAME}\" \\\n+                  --set dbuser=\"${DBUSER}\" \\\n+                  --set dbpassword=\"${DBUSERPASSWORD}\"\n+              echo \"${CREATE_API_USERS_SQL_COMMAND}\" | psql --file=- --echo-queries -d \"${ACCESS_SVC_CONNSTR_MAIN_USER}\" \\\n+                  --set ON_ERROR_STOP=1 \\\n+                  --set grpcuser=\"${GRPCUSER}\" \\\n+                  --set grpcpassword=\"${GRPCUSERPASSWORD}\" \\\n+                  --set restuser=\"${RESTUSER}\" \\\n+                  --set restpassword=\"${RESTPASSWORD}\"\n+          env:\n+            - name: DBNAME\n+              value: {{ .Values.importer.config.hedera.mirror.importer.db.name | quote }}\n+            - name: DBUSER\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: dbuser\n+            - name: DBUSERPASSWORD\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: dbpassword\n+            - name: GRPCUSER\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: grpcuser\n+            - name: GRPCUSERPASSWORD\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: grpcpassword\n+            - name: RESTUSER\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: restuser\n+            - name: RESTPASSWORD\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: restpassword\n+            - name: ACCESS_SVC_CONNSTR_POSTGRES\n+              value: host=mirror-timescaledb user=postgres connect_timeout=3 sslmode=disable password={{ .Values.timescaledb.credentials.accessNode.superuser }}\n+            - name: ACCESS_SVC_CONNSTR_MAIN_USER\n+              value: host=mirror-timescaledb user={{ .Values.importer.config.hedera.mirror.importer.db.username }} connect_timeout=3 sslmode=disable password={{ .Values.importer.config.hedera.mirror.importer.db.password }}\n+            - name: CREATE_USER_DB_SQL_COMMAND\n+              value: |\n+                SELECT format('CREATE DATABASE %I', :'dbname')", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eee7f65b34cdc872ad59e1f08f22e2e8e2baba47"}, "originalPosition": 72}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDcwMTMxOQ==", "bodyText": "Yes I had that approach initially and went this was as I was trying to make the approach similar to what timescale does for data nodes db creation, but I agree a secret sql is preferred as it's more secure", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r544701319", "createdAt": "2020-12-16T23:37:41Z", "author": {"login": "Nana-EC"}, "path": "charts/hedera-mirror/templates/job-timescaledb-init.yaml", "diffHunk": "@@ -0,0 +1,92 @@\n+apiVersion: batch/v1\n+kind: Job\n+metadata:\n+  labels:\n+    {{- include \"hedera-mirror.labels\" . | nindent 4 }}\n+  name: {{ printf \"%s-timescaledb-init-job\" .Release.Name }}\n+  namespace: {{ include \"hedera-mirror.namespace\" . }}\n+  annotations:\n+    \"helm.sh/hook-delete-policy\": hook-succeeded\n+spec:\n+  backoffLimit: 4\n+  template:\n+    spec:\n+      containers:\n+        - name: init-mirrornode-db\n+          image: postgres:11-alpine\n+          command:\n+            - sh\n+            - -c\n+            - >\n+              while ! pg_isready -U postgres -h mirror-timescaledb-data; do sleep 1; done;\n+              echo \"${CREATE_USER_DB_SQL_COMMAND}\" | psql --file=- --echo-queries -d \"${ACCESS_SVC_CONNSTR_POSTGRES}\" \\\n+                  --set ON_ERROR_STOP=1 \\\n+                  --set dbname=\"${DBNAME}\" \\\n+                  --set dbuser=\"${DBUSER}\" \\\n+                  --set dbpassword=\"${DBUSERPASSWORD}\"\n+              echo \"${CREATE_API_USERS_SQL_COMMAND}\" | psql --file=- --echo-queries -d \"${ACCESS_SVC_CONNSTR_MAIN_USER}\" \\\n+                  --set ON_ERROR_STOP=1 \\\n+                  --set grpcuser=\"${GRPCUSER}\" \\\n+                  --set grpcpassword=\"${GRPCUSERPASSWORD}\" \\\n+                  --set restuser=\"${RESTUSER}\" \\\n+                  --set restpassword=\"${RESTPASSWORD}\"\n+          env:\n+            - name: DBNAME\n+              value: {{ .Values.importer.config.hedera.mirror.importer.db.name | quote }}\n+            - name: DBUSER\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: dbuser\n+            - name: DBUSERPASSWORD\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: dbpassword\n+            - name: GRPCUSER\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: grpcuser\n+            - name: GRPCUSERPASSWORD\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: grpcpassword\n+            - name: RESTUSER\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: restuser\n+            - name: RESTPASSWORD\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: restpassword\n+            - name: ACCESS_SVC_CONNSTR_POSTGRES\n+              value: host=mirror-timescaledb user=postgres connect_timeout=3 sslmode=disable password={{ .Values.timescaledb.credentials.accessNode.superuser }}\n+            - name: ACCESS_SVC_CONNSTR_MAIN_USER\n+              value: host=mirror-timescaledb user={{ .Values.importer.config.hedera.mirror.importer.db.username }} connect_timeout=3 sslmode=disable password={{ .Values.importer.config.hedera.mirror.importer.db.password }}\n+            - name: CREATE_USER_DB_SQL_COMMAND\n+              value: |\n+                SELECT format('CREATE DATABASE %I', :'dbname')", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY3MTYwMA=="}, "originalCommit": {"oid": "eee7f65b34cdc872ad59e1f08f22e2e8e2baba47"}, "originalPosition": 72}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njg0NDY4Mg==", "bodyText": "Fixed", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r546844682", "createdAt": "2020-12-21T17:50:10Z", "author": {"login": "Nana-EC"}, "path": "charts/hedera-mirror/templates/job-timescaledb-init.yaml", "diffHunk": "@@ -0,0 +1,92 @@\n+apiVersion: batch/v1\n+kind: Job\n+metadata:\n+  labels:\n+    {{- include \"hedera-mirror.labels\" . | nindent 4 }}\n+  name: {{ printf \"%s-timescaledb-init-job\" .Release.Name }}\n+  namespace: {{ include \"hedera-mirror.namespace\" . }}\n+  annotations:\n+    \"helm.sh/hook-delete-policy\": hook-succeeded\n+spec:\n+  backoffLimit: 4\n+  template:\n+    spec:\n+      containers:\n+        - name: init-mirrornode-db\n+          image: postgres:11-alpine\n+          command:\n+            - sh\n+            - -c\n+            - >\n+              while ! pg_isready -U postgres -h mirror-timescaledb-data; do sleep 1; done;\n+              echo \"${CREATE_USER_DB_SQL_COMMAND}\" | psql --file=- --echo-queries -d \"${ACCESS_SVC_CONNSTR_POSTGRES}\" \\\n+                  --set ON_ERROR_STOP=1 \\\n+                  --set dbname=\"${DBNAME}\" \\\n+                  --set dbuser=\"${DBUSER}\" \\\n+                  --set dbpassword=\"${DBUSERPASSWORD}\"\n+              echo \"${CREATE_API_USERS_SQL_COMMAND}\" | psql --file=- --echo-queries -d \"${ACCESS_SVC_CONNSTR_MAIN_USER}\" \\\n+                  --set ON_ERROR_STOP=1 \\\n+                  --set grpcuser=\"${GRPCUSER}\" \\\n+                  --set grpcpassword=\"${GRPCUSERPASSWORD}\" \\\n+                  --set restuser=\"${RESTUSER}\" \\\n+                  --set restpassword=\"${RESTPASSWORD}\"\n+          env:\n+            - name: DBNAME\n+              value: {{ .Values.importer.config.hedera.mirror.importer.db.name | quote }}\n+            - name: DBUSER\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: dbuser\n+            - name: DBUSERPASSWORD\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: dbpassword\n+            - name: GRPCUSER\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: grpcuser\n+            - name: GRPCUSERPASSWORD\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: grpcpassword\n+            - name: RESTUSER\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: restuser\n+            - name: RESTPASSWORD\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: restpassword\n+            - name: ACCESS_SVC_CONNSTR_POSTGRES\n+              value: host=mirror-timescaledb user=postgres connect_timeout=3 sslmode=disable password={{ .Values.timescaledb.credentials.accessNode.superuser }}\n+            - name: ACCESS_SVC_CONNSTR_MAIN_USER\n+              value: host=mirror-timescaledb user={{ .Values.importer.config.hedera.mirror.importer.db.username }} connect_timeout=3 sslmode=disable password={{ .Values.importer.config.hedera.mirror.importer.db.password }}\n+            - name: CREATE_USER_DB_SQL_COMMAND\n+              value: |\n+                SELECT format('CREATE DATABASE %I', :'dbname')", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY3MTYwMA=="}, "originalCommit": {"oid": "eee7f65b34cdc872ad59e1f08f22e2e8e2baba47"}, "originalPosition": 72}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQyMjg1MjI3OnYy", "diffSide": "RIGHT", "path": "charts/hedera-mirror/templates/job-timescaledb-init.yaml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQyMjozNDoxNVrOIHcIfw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQyMzozMTozN1rOIHdyEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY3MTg3MQ==", "bodyText": "Shouldn't the timescale specific postgres image already do this?", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r544671871", "createdAt": "2020-12-16T22:34:15Z", "author": {"login": "steven-sheehy"}, "path": "charts/hedera-mirror/templates/job-timescaledb-init.yaml", "diffHunk": "@@ -0,0 +1,92 @@\n+apiVersion: batch/v1\n+kind: Job\n+metadata:\n+  labels:\n+    {{- include \"hedera-mirror.labels\" . | nindent 4 }}\n+  name: {{ printf \"%s-timescaledb-init-job\" .Release.Name }}\n+  namespace: {{ include \"hedera-mirror.namespace\" . }}\n+  annotations:\n+    \"helm.sh/hook-delete-policy\": hook-succeeded\n+spec:\n+  backoffLimit: 4\n+  template:\n+    spec:\n+      containers:\n+        - name: init-mirrornode-db\n+          image: postgres:11-alpine\n+          command:\n+            - sh\n+            - -c\n+            - >\n+              while ! pg_isready -U postgres -h mirror-timescaledb-data; do sleep 1; done;\n+              echo \"${CREATE_USER_DB_SQL_COMMAND}\" | psql --file=- --echo-queries -d \"${ACCESS_SVC_CONNSTR_POSTGRES}\" \\\n+                  --set ON_ERROR_STOP=1 \\\n+                  --set dbname=\"${DBNAME}\" \\\n+                  --set dbuser=\"${DBUSER}\" \\\n+                  --set dbpassword=\"${DBUSERPASSWORD}\"\n+              echo \"${CREATE_API_USERS_SQL_COMMAND}\" | psql --file=- --echo-queries -d \"${ACCESS_SVC_CONNSTR_MAIN_USER}\" \\\n+                  --set ON_ERROR_STOP=1 \\\n+                  --set grpcuser=\"${GRPCUSER}\" \\\n+                  --set grpcpassword=\"${GRPCUSERPASSWORD}\" \\\n+                  --set restuser=\"${RESTUSER}\" \\\n+                  --set restpassword=\"${RESTPASSWORD}\"\n+          env:\n+            - name: DBNAME\n+              value: {{ .Values.importer.config.hedera.mirror.importer.db.name | quote }}\n+            - name: DBUSER\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: dbuser\n+            - name: DBUSERPASSWORD\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: dbpassword\n+            - name: GRPCUSER\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: grpcuser\n+            - name: GRPCUSERPASSWORD\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: grpcpassword\n+            - name: RESTUSER\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: restuser\n+            - name: RESTPASSWORD\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: restpassword\n+            - name: ACCESS_SVC_CONNSTR_POSTGRES\n+              value: host=mirror-timescaledb user=postgres connect_timeout=3 sslmode=disable password={{ .Values.timescaledb.credentials.accessNode.superuser }}\n+            - name: ACCESS_SVC_CONNSTR_MAIN_USER\n+              value: host=mirror-timescaledb user={{ .Values.importer.config.hedera.mirror.importer.db.username }} connect_timeout=3 sslmode=disable password={{ .Values.importer.config.hedera.mirror.importer.db.password }}\n+            - name: CREATE_USER_DB_SQL_COMMAND\n+              value: |\n+                SELECT format('CREATE DATABASE %I', :'dbname')\n+                WHERE NOT EXISTS (\n+                   SELECT\n+                     FROM pg_database\n+                    WHERE datname=:'dbname'\n+                )\n+                \\gexec\n+                create user :dbuser with createrole password :'dbpassword';\n+                alter user :dbuser with superuser;\n+            - name: CREATE_API_USERS_SQL_COMMAND\n+              value: |\n+                CREATE EXTENSION IF NOT EXISTS timescaledb;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eee7f65b34cdc872ad59e1f08f22e2e8e2baba47"}, "originalPosition": 83}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY5ODg5Nw==", "bodyText": "That was my initial expectation but it seems that the extension is per db.\nSO it's there for the postgres db but not the new db created", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r544698897", "createdAt": "2020-12-16T23:31:37Z", "author": {"login": "Nana-EC"}, "path": "charts/hedera-mirror/templates/job-timescaledb-init.yaml", "diffHunk": "@@ -0,0 +1,92 @@\n+apiVersion: batch/v1\n+kind: Job\n+metadata:\n+  labels:\n+    {{- include \"hedera-mirror.labels\" . | nindent 4 }}\n+  name: {{ printf \"%s-timescaledb-init-job\" .Release.Name }}\n+  namespace: {{ include \"hedera-mirror.namespace\" . }}\n+  annotations:\n+    \"helm.sh/hook-delete-policy\": hook-succeeded\n+spec:\n+  backoffLimit: 4\n+  template:\n+    spec:\n+      containers:\n+        - name: init-mirrornode-db\n+          image: postgres:11-alpine\n+          command:\n+            - sh\n+            - -c\n+            - >\n+              while ! pg_isready -U postgres -h mirror-timescaledb-data; do sleep 1; done;\n+              echo \"${CREATE_USER_DB_SQL_COMMAND}\" | psql --file=- --echo-queries -d \"${ACCESS_SVC_CONNSTR_POSTGRES}\" \\\n+                  --set ON_ERROR_STOP=1 \\\n+                  --set dbname=\"${DBNAME}\" \\\n+                  --set dbuser=\"${DBUSER}\" \\\n+                  --set dbpassword=\"${DBUSERPASSWORD}\"\n+              echo \"${CREATE_API_USERS_SQL_COMMAND}\" | psql --file=- --echo-queries -d \"${ACCESS_SVC_CONNSTR_MAIN_USER}\" \\\n+                  --set ON_ERROR_STOP=1 \\\n+                  --set grpcuser=\"${GRPCUSER}\" \\\n+                  --set grpcpassword=\"${GRPCUSERPASSWORD}\" \\\n+                  --set restuser=\"${RESTUSER}\" \\\n+                  --set restpassword=\"${RESTPASSWORD}\"\n+          env:\n+            - name: DBNAME\n+              value: {{ .Values.importer.config.hedera.mirror.importer.db.name | quote }}\n+            - name: DBUSER\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: dbuser\n+            - name: DBUSERPASSWORD\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: dbpassword\n+            - name: GRPCUSER\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: grpcuser\n+            - name: GRPCUSERPASSWORD\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: grpcpassword\n+            - name: RESTUSER\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: restuser\n+            - name: RESTPASSWORD\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: restpassword\n+            - name: ACCESS_SVC_CONNSTR_POSTGRES\n+              value: host=mirror-timescaledb user=postgres connect_timeout=3 sslmode=disable password={{ .Values.timescaledb.credentials.accessNode.superuser }}\n+            - name: ACCESS_SVC_CONNSTR_MAIN_USER\n+              value: host=mirror-timescaledb user={{ .Values.importer.config.hedera.mirror.importer.db.username }} connect_timeout=3 sslmode=disable password={{ .Values.importer.config.hedera.mirror.importer.db.password }}\n+            - name: CREATE_USER_DB_SQL_COMMAND\n+              value: |\n+                SELECT format('CREATE DATABASE %I', :'dbname')\n+                WHERE NOT EXISTS (\n+                   SELECT\n+                     FROM pg_database\n+                    WHERE datname=:'dbname'\n+                )\n+                \\gexec\n+                create user :dbuser with createrole password :'dbpassword';\n+                alter user :dbuser with superuser;\n+            - name: CREATE_API_USERS_SQL_COMMAND\n+              value: |\n+                CREATE EXTENSION IF NOT EXISTS timescaledb;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY3MTg3MQ=="}, "originalCommit": {"oid": "eee7f65b34cdc872ad59e1f08f22e2e8e2baba47"}, "originalPosition": 83}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQyMjg3MTk2OnYy", "diffSide": "RIGHT", "path": "charts/hedera-mirror/templates/job-timescaledb-init.yaml", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQyMjozOTozNlrOIHcTtw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQyMzozMjo1MVrOIHd0Hw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY3NDc0Mw==", "bodyText": "I thought we were going to switch away from using public as the schema?", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r544674743", "createdAt": "2020-12-16T22:39:36Z", "author": {"login": "steven-sheehy"}, "path": "charts/hedera-mirror/templates/job-timescaledb-init.yaml", "diffHunk": "@@ -0,0 +1,92 @@\n+apiVersion: batch/v1\n+kind: Job\n+metadata:\n+  labels:\n+    {{- include \"hedera-mirror.labels\" . | nindent 4 }}\n+  name: {{ printf \"%s-timescaledb-init-job\" .Release.Name }}\n+  namespace: {{ include \"hedera-mirror.namespace\" . }}\n+  annotations:\n+    \"helm.sh/hook-delete-policy\": hook-succeeded\n+spec:\n+  backoffLimit: 4\n+  template:\n+    spec:\n+      containers:\n+        - name: init-mirrornode-db\n+          image: postgres:11-alpine\n+          command:\n+            - sh\n+            - -c\n+            - >\n+              while ! pg_isready -U postgres -h mirror-timescaledb-data; do sleep 1; done;\n+              echo \"${CREATE_USER_DB_SQL_COMMAND}\" | psql --file=- --echo-queries -d \"${ACCESS_SVC_CONNSTR_POSTGRES}\" \\\n+                  --set ON_ERROR_STOP=1 \\\n+                  --set dbname=\"${DBNAME}\" \\\n+                  --set dbuser=\"${DBUSER}\" \\\n+                  --set dbpassword=\"${DBUSERPASSWORD}\"\n+              echo \"${CREATE_API_USERS_SQL_COMMAND}\" | psql --file=- --echo-queries -d \"${ACCESS_SVC_CONNSTR_MAIN_USER}\" \\\n+                  --set ON_ERROR_STOP=1 \\\n+                  --set grpcuser=\"${GRPCUSER}\" \\\n+                  --set grpcpassword=\"${GRPCUSERPASSWORD}\" \\\n+                  --set restuser=\"${RESTUSER}\" \\\n+                  --set restpassword=\"${RESTPASSWORD}\"\n+          env:\n+            - name: DBNAME\n+              value: {{ .Values.importer.config.hedera.mirror.importer.db.name | quote }}\n+            - name: DBUSER\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: dbuser\n+            - name: DBUSERPASSWORD\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: dbpassword\n+            - name: GRPCUSER\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: grpcuser\n+            - name: GRPCUSERPASSWORD\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: grpcpassword\n+            - name: RESTUSER\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: restuser\n+            - name: RESTPASSWORD\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: restpassword\n+            - name: ACCESS_SVC_CONNSTR_POSTGRES\n+              value: host=mirror-timescaledb user=postgres connect_timeout=3 sslmode=disable password={{ .Values.timescaledb.credentials.accessNode.superuser }}\n+            - name: ACCESS_SVC_CONNSTR_MAIN_USER\n+              value: host=mirror-timescaledb user={{ .Values.importer.config.hedera.mirror.importer.db.username }} connect_timeout=3 sslmode=disable password={{ .Values.importer.config.hedera.mirror.importer.db.password }}\n+            - name: CREATE_USER_DB_SQL_COMMAND\n+              value: |\n+                SELECT format('CREATE DATABASE %I', :'dbname')\n+                WHERE NOT EXISTS (\n+                   SELECT\n+                     FROM pg_database\n+                    WHERE datname=:'dbname'\n+                )\n+                \\gexec\n+                create user :dbuser with createrole password :'dbpassword';\n+                alter user :dbuser with superuser;\n+            - name: CREATE_API_USERS_SQL_COMMAND\n+              value: |\n+                CREATE EXTENSION IF NOT EXISTS timescaledb;\n+\n+                create user :grpcuser with login password :'grpcpassword';\n+                create user :restuser with login password :'restpassword';\n+                alter default privileges in schema public grant select on tables to :grpcuser;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eee7f65b34cdc872ad59e1f08f22e2e8e2baba47"}, "originalPosition": 87}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY5OTQyMw==", "bodyText": "Yes we are. I'll do it in the following PR that's in draft. Wanted to get base case covered since I believe I hit some schema related issues the last time regarding search and access for users.\nBut yep we'll use a new schema", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r544699423", "createdAt": "2020-12-16T23:32:51Z", "author": {"login": "Nana-EC"}, "path": "charts/hedera-mirror/templates/job-timescaledb-init.yaml", "diffHunk": "@@ -0,0 +1,92 @@\n+apiVersion: batch/v1\n+kind: Job\n+metadata:\n+  labels:\n+    {{- include \"hedera-mirror.labels\" . | nindent 4 }}\n+  name: {{ printf \"%s-timescaledb-init-job\" .Release.Name }}\n+  namespace: {{ include \"hedera-mirror.namespace\" . }}\n+  annotations:\n+    \"helm.sh/hook-delete-policy\": hook-succeeded\n+spec:\n+  backoffLimit: 4\n+  template:\n+    spec:\n+      containers:\n+        - name: init-mirrornode-db\n+          image: postgres:11-alpine\n+          command:\n+            - sh\n+            - -c\n+            - >\n+              while ! pg_isready -U postgres -h mirror-timescaledb-data; do sleep 1; done;\n+              echo \"${CREATE_USER_DB_SQL_COMMAND}\" | psql --file=- --echo-queries -d \"${ACCESS_SVC_CONNSTR_POSTGRES}\" \\\n+                  --set ON_ERROR_STOP=1 \\\n+                  --set dbname=\"${DBNAME}\" \\\n+                  --set dbuser=\"${DBUSER}\" \\\n+                  --set dbpassword=\"${DBUSERPASSWORD}\"\n+              echo \"${CREATE_API_USERS_SQL_COMMAND}\" | psql --file=- --echo-queries -d \"${ACCESS_SVC_CONNSTR_MAIN_USER}\" \\\n+                  --set ON_ERROR_STOP=1 \\\n+                  --set grpcuser=\"${GRPCUSER}\" \\\n+                  --set grpcpassword=\"${GRPCUSERPASSWORD}\" \\\n+                  --set restuser=\"${RESTUSER}\" \\\n+                  --set restpassword=\"${RESTPASSWORD}\"\n+          env:\n+            - name: DBNAME\n+              value: {{ .Values.importer.config.hedera.mirror.importer.db.name | quote }}\n+            - name: DBUSER\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: dbuser\n+            - name: DBUSERPASSWORD\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: dbpassword\n+            - name: GRPCUSER\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: grpcuser\n+            - name: GRPCUSERPASSWORD\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: grpcpassword\n+            - name: RESTUSER\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: restuser\n+            - name: RESTPASSWORD\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: restpassword\n+            - name: ACCESS_SVC_CONNSTR_POSTGRES\n+              value: host=mirror-timescaledb user=postgres connect_timeout=3 sslmode=disable password={{ .Values.timescaledb.credentials.accessNode.superuser }}\n+            - name: ACCESS_SVC_CONNSTR_MAIN_USER\n+              value: host=mirror-timescaledb user={{ .Values.importer.config.hedera.mirror.importer.db.username }} connect_timeout=3 sslmode=disable password={{ .Values.importer.config.hedera.mirror.importer.db.password }}\n+            - name: CREATE_USER_DB_SQL_COMMAND\n+              value: |\n+                SELECT format('CREATE DATABASE %I', :'dbname')\n+                WHERE NOT EXISTS (\n+                   SELECT\n+                     FROM pg_database\n+                    WHERE datname=:'dbname'\n+                )\n+                \\gexec\n+                create user :dbuser with createrole password :'dbpassword';\n+                alter user :dbuser with superuser;\n+            - name: CREATE_API_USERS_SQL_COMMAND\n+              value: |\n+                CREATE EXTENSION IF NOT EXISTS timescaledb;\n+\n+                create user :grpcuser with login password :'grpcpassword';\n+                create user :restuser with login password :'restpassword';\n+                alter default privileges in schema public grant select on tables to :grpcuser;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY3NDc0Mw=="}, "originalCommit": {"oid": "eee7f65b34cdc872ad59e1f08f22e2e8e2baba47"}, "originalPosition": 87}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQyMjg4MTY5OnYy", "diffSide": "RIGHT", "path": "charts/hedera-mirror/templates/job-timescaledb-init.yaml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQyMjo0MjoxMlrOIHcZVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQxNzo1MDoyOVrOIJgwmQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY3NjE4MA==", "bodyText": "Since we have a chance to do things over, we should fix the security mistake of allowing the importer user to create roles. We should reduce his permissions to just read/write of mirrornode database.\nAdditionally, this should be called importeruser not dbuser to make that clear it's not some admin user.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r544676180", "createdAt": "2020-12-16T22:42:12Z", "author": {"login": "steven-sheehy"}, "path": "charts/hedera-mirror/templates/job-timescaledb-init.yaml", "diffHunk": "@@ -0,0 +1,92 @@\n+apiVersion: batch/v1\n+kind: Job\n+metadata:\n+  labels:\n+    {{- include \"hedera-mirror.labels\" . | nindent 4 }}\n+  name: {{ printf \"%s-timescaledb-init-job\" .Release.Name }}\n+  namespace: {{ include \"hedera-mirror.namespace\" . }}\n+  annotations:\n+    \"helm.sh/hook-delete-policy\": hook-succeeded\n+spec:\n+  backoffLimit: 4\n+  template:\n+    spec:\n+      containers:\n+        - name: init-mirrornode-db\n+          image: postgres:11-alpine\n+          command:\n+            - sh\n+            - -c\n+            - >\n+              while ! pg_isready -U postgres -h mirror-timescaledb-data; do sleep 1; done;\n+              echo \"${CREATE_USER_DB_SQL_COMMAND}\" | psql --file=- --echo-queries -d \"${ACCESS_SVC_CONNSTR_POSTGRES}\" \\\n+                  --set ON_ERROR_STOP=1 \\\n+                  --set dbname=\"${DBNAME}\" \\\n+                  --set dbuser=\"${DBUSER}\" \\\n+                  --set dbpassword=\"${DBUSERPASSWORD}\"\n+              echo \"${CREATE_API_USERS_SQL_COMMAND}\" | psql --file=- --echo-queries -d \"${ACCESS_SVC_CONNSTR_MAIN_USER}\" \\\n+                  --set ON_ERROR_STOP=1 \\\n+                  --set grpcuser=\"${GRPCUSER}\" \\\n+                  --set grpcpassword=\"${GRPCUSERPASSWORD}\" \\\n+                  --set restuser=\"${RESTUSER}\" \\\n+                  --set restpassword=\"${RESTPASSWORD}\"\n+          env:\n+            - name: DBNAME\n+              value: {{ .Values.importer.config.hedera.mirror.importer.db.name | quote }}\n+            - name: DBUSER\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: dbuser\n+            - name: DBUSERPASSWORD\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: dbpassword\n+            - name: GRPCUSER\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: grpcuser\n+            - name: GRPCUSERPASSWORD\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: grpcpassword\n+            - name: RESTUSER\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: restuser\n+            - name: RESTPASSWORD\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: restpassword\n+            - name: ACCESS_SVC_CONNSTR_POSTGRES\n+              value: host=mirror-timescaledb user=postgres connect_timeout=3 sslmode=disable password={{ .Values.timescaledb.credentials.accessNode.superuser }}\n+            - name: ACCESS_SVC_CONNSTR_MAIN_USER\n+              value: host=mirror-timescaledb user={{ .Values.importer.config.hedera.mirror.importer.db.username }} connect_timeout=3 sslmode=disable password={{ .Values.importer.config.hedera.mirror.importer.db.password }}\n+            - name: CREATE_USER_DB_SQL_COMMAND\n+              value: |\n+                SELECT format('CREATE DATABASE %I', :'dbname')\n+                WHERE NOT EXISTS (\n+                   SELECT\n+                     FROM pg_database\n+                    WHERE datname=:'dbname'\n+                )\n+                \\gexec\n+                create user :dbuser with createrole password :'dbpassword';", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eee7f65b34cdc872ad59e1f08f22e2e8e2baba47"}, "originalPosition": 79}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njg0NDgyNQ==", "bodyText": "Updated", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r546844825", "createdAt": "2020-12-21T17:50:29Z", "author": {"login": "Nana-EC"}, "path": "charts/hedera-mirror/templates/job-timescaledb-init.yaml", "diffHunk": "@@ -0,0 +1,92 @@\n+apiVersion: batch/v1\n+kind: Job\n+metadata:\n+  labels:\n+    {{- include \"hedera-mirror.labels\" . | nindent 4 }}\n+  name: {{ printf \"%s-timescaledb-init-job\" .Release.Name }}\n+  namespace: {{ include \"hedera-mirror.namespace\" . }}\n+  annotations:\n+    \"helm.sh/hook-delete-policy\": hook-succeeded\n+spec:\n+  backoffLimit: 4\n+  template:\n+    spec:\n+      containers:\n+        - name: init-mirrornode-db\n+          image: postgres:11-alpine\n+          command:\n+            - sh\n+            - -c\n+            - >\n+              while ! pg_isready -U postgres -h mirror-timescaledb-data; do sleep 1; done;\n+              echo \"${CREATE_USER_DB_SQL_COMMAND}\" | psql --file=- --echo-queries -d \"${ACCESS_SVC_CONNSTR_POSTGRES}\" \\\n+                  --set ON_ERROR_STOP=1 \\\n+                  --set dbname=\"${DBNAME}\" \\\n+                  --set dbuser=\"${DBUSER}\" \\\n+                  --set dbpassword=\"${DBUSERPASSWORD}\"\n+              echo \"${CREATE_API_USERS_SQL_COMMAND}\" | psql --file=- --echo-queries -d \"${ACCESS_SVC_CONNSTR_MAIN_USER}\" \\\n+                  --set ON_ERROR_STOP=1 \\\n+                  --set grpcuser=\"${GRPCUSER}\" \\\n+                  --set grpcpassword=\"${GRPCUSERPASSWORD}\" \\\n+                  --set restuser=\"${RESTUSER}\" \\\n+                  --set restpassword=\"${RESTPASSWORD}\"\n+          env:\n+            - name: DBNAME\n+              value: {{ .Values.importer.config.hedera.mirror.importer.db.name | quote }}\n+            - name: DBUSER\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: dbuser\n+            - name: DBUSERPASSWORD\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: dbpassword\n+            - name: GRPCUSER\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: grpcuser\n+            - name: GRPCUSERPASSWORD\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: grpcpassword\n+            - name: RESTUSER\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: restuser\n+            - name: RESTPASSWORD\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: restpassword\n+            - name: ACCESS_SVC_CONNSTR_POSTGRES\n+              value: host=mirror-timescaledb user=postgres connect_timeout=3 sslmode=disable password={{ .Values.timescaledb.credentials.accessNode.superuser }}\n+            - name: ACCESS_SVC_CONNSTR_MAIN_USER\n+              value: host=mirror-timescaledb user={{ .Values.importer.config.hedera.mirror.importer.db.username }} connect_timeout=3 sslmode=disable password={{ .Values.importer.config.hedera.mirror.importer.db.password }}\n+            - name: CREATE_USER_DB_SQL_COMMAND\n+              value: |\n+                SELECT format('CREATE DATABASE %I', :'dbname')\n+                WHERE NOT EXISTS (\n+                   SELECT\n+                     FROM pg_database\n+                    WHERE datname=:'dbname'\n+                )\n+                \\gexec\n+                create user :dbuser with createrole password :'dbpassword';", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY3NjE4MA=="}, "originalCommit": {"oid": "eee7f65b34cdc872ad59e1f08f22e2e8e2baba47"}, "originalPosition": 79}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQyMjg4NTkzOnYy", "diffSide": "RIGHT", "path": "charts/hedera-mirror/templates/secret-timescaledb.yaml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQyMjo0MzozMlrOIHcb1Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQxNzo1MDozNlrOIJgwzA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY3NjgyMQ==", "bodyText": "Remove in favor of init.sql", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r544676821", "createdAt": "2020-12-16T22:43:32Z", "author": {"login": "steven-sheehy"}, "path": "charts/hedera-mirror/templates/secret-timescaledb.yaml", "diffHunk": "@@ -0,0 +1,17 @@\n+{{- if .Values.timescaledb.enabled -}}\n+apiVersion: v1\n+kind: Secret\n+metadata:\n+  labels:\n+    {{- include \"hedera-mirror.labels\" . | nindent 4 }}\n+  name: {{ printf \"%s-timescaledb-init\" .Release.Name  }}\n+  namespace: {{ include \"hedera-mirror.namespace\" . }}\n+type: Opaque\n+stringData:\n+  dbuser: \"{{ .Values.importer.config.hedera.mirror.importer.db.username }}\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eee7f65b34cdc872ad59e1f08f22e2e8e2baba47"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njg0NDg3Ng==", "bodyText": "Removed", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r546844876", "createdAt": "2020-12-21T17:50:36Z", "author": {"login": "Nana-EC"}, "path": "charts/hedera-mirror/templates/secret-timescaledb.yaml", "diffHunk": "@@ -0,0 +1,17 @@\n+{{- if .Values.timescaledb.enabled -}}\n+apiVersion: v1\n+kind: Secret\n+metadata:\n+  labels:\n+    {{- include \"hedera-mirror.labels\" . | nindent 4 }}\n+  name: {{ printf \"%s-timescaledb-init\" .Release.Name  }}\n+  namespace: {{ include \"hedera-mirror.namespace\" . }}\n+type: Opaque\n+stringData:\n+  dbuser: \"{{ .Values.importer.config.hedera.mirror.importer.db.username }}\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY3NjgyMQ=="}, "originalCommit": {"oid": "eee7f65b34cdc872ad59e1f08f22e2e8e2baba47"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQyMjg4NzYwOnYy", "diffSide": "RIGHT", "path": "charts/hedera-mirror/templates/job-timescaledb-init.yaml", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQyMjo0NDowM1rOIHcc3A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQxNzo1MDo0OVrOIJgxKQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY3NzA4NA==", "bodyText": "Consider enabling pg_stat_statements if not enabled by default.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r544677084", "createdAt": "2020-12-16T22:44:03Z", "author": {"login": "steven-sheehy"}, "path": "charts/hedera-mirror/templates/job-timescaledb-init.yaml", "diffHunk": "@@ -0,0 +1,92 @@\n+apiVersion: batch/v1\n+kind: Job\n+metadata:\n+  labels:\n+    {{- include \"hedera-mirror.labels\" . | nindent 4 }}\n+  name: {{ printf \"%s-timescaledb-init-job\" .Release.Name }}\n+  namespace: {{ include \"hedera-mirror.namespace\" . }}\n+  annotations:\n+    \"helm.sh/hook-delete-policy\": hook-succeeded\n+spec:\n+  backoffLimit: 4\n+  template:\n+    spec:\n+      containers:\n+        - name: init-mirrornode-db\n+          image: postgres:11-alpine\n+          command:\n+            - sh\n+            - -c\n+            - >\n+              while ! pg_isready -U postgres -h mirror-timescaledb-data; do sleep 1; done;\n+              echo \"${CREATE_USER_DB_SQL_COMMAND}\" | psql --file=- --echo-queries -d \"${ACCESS_SVC_CONNSTR_POSTGRES}\" \\\n+                  --set ON_ERROR_STOP=1 \\\n+                  --set dbname=\"${DBNAME}\" \\\n+                  --set dbuser=\"${DBUSER}\" \\\n+                  --set dbpassword=\"${DBUSERPASSWORD}\"\n+              echo \"${CREATE_API_USERS_SQL_COMMAND}\" | psql --file=- --echo-queries -d \"${ACCESS_SVC_CONNSTR_MAIN_USER}\" \\\n+                  --set ON_ERROR_STOP=1 \\\n+                  --set grpcuser=\"${GRPCUSER}\" \\\n+                  --set grpcpassword=\"${GRPCUSERPASSWORD}\" \\\n+                  --set restuser=\"${RESTUSER}\" \\\n+                  --set restpassword=\"${RESTPASSWORD}\"\n+          env:\n+            - name: DBNAME\n+              value: {{ .Values.importer.config.hedera.mirror.importer.db.name | quote }}\n+            - name: DBUSER\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: dbuser\n+            - name: DBUSERPASSWORD\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: dbpassword\n+            - name: GRPCUSER\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: grpcuser\n+            - name: GRPCUSERPASSWORD\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: grpcpassword\n+            - name: RESTUSER\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: restuser\n+            - name: RESTPASSWORD\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: restpassword\n+            - name: ACCESS_SVC_CONNSTR_POSTGRES\n+              value: host=mirror-timescaledb user=postgres connect_timeout=3 sslmode=disable password={{ .Values.timescaledb.credentials.accessNode.superuser }}\n+            - name: ACCESS_SVC_CONNSTR_MAIN_USER\n+              value: host=mirror-timescaledb user={{ .Values.importer.config.hedera.mirror.importer.db.username }} connect_timeout=3 sslmode=disable password={{ .Values.importer.config.hedera.mirror.importer.db.password }}\n+            - name: CREATE_USER_DB_SQL_COMMAND\n+              value: |\n+                SELECT format('CREATE DATABASE %I', :'dbname')\n+                WHERE NOT EXISTS (\n+                   SELECT\n+                     FROM pg_database\n+                    WHERE datname=:'dbname'\n+                )\n+                \\gexec\n+                create user :dbuser with createrole password :'dbpassword';\n+                alter user :dbuser with superuser;\n+            - name: CREATE_API_USERS_SQL_COMMAND\n+              value: |\n+                CREATE EXTENSION IF NOT EXISTS timescaledb;\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eee7f65b34cdc872ad59e1f08f22e2e8e2baba47"}, "originalPosition": 84}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY5OTgwMw==", "bodyText": "Good idea", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r544699803", "createdAt": "2020-12-16T23:33:53Z", "author": {"login": "Nana-EC"}, "path": "charts/hedera-mirror/templates/job-timescaledb-init.yaml", "diffHunk": "@@ -0,0 +1,92 @@\n+apiVersion: batch/v1\n+kind: Job\n+metadata:\n+  labels:\n+    {{- include \"hedera-mirror.labels\" . | nindent 4 }}\n+  name: {{ printf \"%s-timescaledb-init-job\" .Release.Name }}\n+  namespace: {{ include \"hedera-mirror.namespace\" . }}\n+  annotations:\n+    \"helm.sh/hook-delete-policy\": hook-succeeded\n+spec:\n+  backoffLimit: 4\n+  template:\n+    spec:\n+      containers:\n+        - name: init-mirrornode-db\n+          image: postgres:11-alpine\n+          command:\n+            - sh\n+            - -c\n+            - >\n+              while ! pg_isready -U postgres -h mirror-timescaledb-data; do sleep 1; done;\n+              echo \"${CREATE_USER_DB_SQL_COMMAND}\" | psql --file=- --echo-queries -d \"${ACCESS_SVC_CONNSTR_POSTGRES}\" \\\n+                  --set ON_ERROR_STOP=1 \\\n+                  --set dbname=\"${DBNAME}\" \\\n+                  --set dbuser=\"${DBUSER}\" \\\n+                  --set dbpassword=\"${DBUSERPASSWORD}\"\n+              echo \"${CREATE_API_USERS_SQL_COMMAND}\" | psql --file=- --echo-queries -d \"${ACCESS_SVC_CONNSTR_MAIN_USER}\" \\\n+                  --set ON_ERROR_STOP=1 \\\n+                  --set grpcuser=\"${GRPCUSER}\" \\\n+                  --set grpcpassword=\"${GRPCUSERPASSWORD}\" \\\n+                  --set restuser=\"${RESTUSER}\" \\\n+                  --set restpassword=\"${RESTPASSWORD}\"\n+          env:\n+            - name: DBNAME\n+              value: {{ .Values.importer.config.hedera.mirror.importer.db.name | quote }}\n+            - name: DBUSER\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: dbuser\n+            - name: DBUSERPASSWORD\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: dbpassword\n+            - name: GRPCUSER\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: grpcuser\n+            - name: GRPCUSERPASSWORD\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: grpcpassword\n+            - name: RESTUSER\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: restuser\n+            - name: RESTPASSWORD\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: restpassword\n+            - name: ACCESS_SVC_CONNSTR_POSTGRES\n+              value: host=mirror-timescaledb user=postgres connect_timeout=3 sslmode=disable password={{ .Values.timescaledb.credentials.accessNode.superuser }}\n+            - name: ACCESS_SVC_CONNSTR_MAIN_USER\n+              value: host=mirror-timescaledb user={{ .Values.importer.config.hedera.mirror.importer.db.username }} connect_timeout=3 sslmode=disable password={{ .Values.importer.config.hedera.mirror.importer.db.password }}\n+            - name: CREATE_USER_DB_SQL_COMMAND\n+              value: |\n+                SELECT format('CREATE DATABASE %I', :'dbname')\n+                WHERE NOT EXISTS (\n+                   SELECT\n+                     FROM pg_database\n+                    WHERE datname=:'dbname'\n+                )\n+                \\gexec\n+                create user :dbuser with createrole password :'dbpassword';\n+                alter user :dbuser with superuser;\n+            - name: CREATE_API_USERS_SQL_COMMAND\n+              value: |\n+                CREATE EXTENSION IF NOT EXISTS timescaledb;\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY3NzA4NA=="}, "originalCommit": {"oid": "eee7f65b34cdc872ad59e1f08f22e2e8e2baba47"}, "originalPosition": 84}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njg0NDk2OQ==", "bodyText": "Done", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r546844969", "createdAt": "2020-12-21T17:50:49Z", "author": {"login": "Nana-EC"}, "path": "charts/hedera-mirror/templates/job-timescaledb-init.yaml", "diffHunk": "@@ -0,0 +1,92 @@\n+apiVersion: batch/v1\n+kind: Job\n+metadata:\n+  labels:\n+    {{- include \"hedera-mirror.labels\" . | nindent 4 }}\n+  name: {{ printf \"%s-timescaledb-init-job\" .Release.Name }}\n+  namespace: {{ include \"hedera-mirror.namespace\" . }}\n+  annotations:\n+    \"helm.sh/hook-delete-policy\": hook-succeeded\n+spec:\n+  backoffLimit: 4\n+  template:\n+    spec:\n+      containers:\n+        - name: init-mirrornode-db\n+          image: postgres:11-alpine\n+          command:\n+            - sh\n+            - -c\n+            - >\n+              while ! pg_isready -U postgres -h mirror-timescaledb-data; do sleep 1; done;\n+              echo \"${CREATE_USER_DB_SQL_COMMAND}\" | psql --file=- --echo-queries -d \"${ACCESS_SVC_CONNSTR_POSTGRES}\" \\\n+                  --set ON_ERROR_STOP=1 \\\n+                  --set dbname=\"${DBNAME}\" \\\n+                  --set dbuser=\"${DBUSER}\" \\\n+                  --set dbpassword=\"${DBUSERPASSWORD}\"\n+              echo \"${CREATE_API_USERS_SQL_COMMAND}\" | psql --file=- --echo-queries -d \"${ACCESS_SVC_CONNSTR_MAIN_USER}\" \\\n+                  --set ON_ERROR_STOP=1 \\\n+                  --set grpcuser=\"${GRPCUSER}\" \\\n+                  --set grpcpassword=\"${GRPCUSERPASSWORD}\" \\\n+                  --set restuser=\"${RESTUSER}\" \\\n+                  --set restpassword=\"${RESTPASSWORD}\"\n+          env:\n+            - name: DBNAME\n+              value: {{ .Values.importer.config.hedera.mirror.importer.db.name | quote }}\n+            - name: DBUSER\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: dbuser\n+            - name: DBUSERPASSWORD\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: dbpassword\n+            - name: GRPCUSER\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: grpcuser\n+            - name: GRPCUSERPASSWORD\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: grpcpassword\n+            - name: RESTUSER\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: restuser\n+            - name: RESTPASSWORD\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: restpassword\n+            - name: ACCESS_SVC_CONNSTR_POSTGRES\n+              value: host=mirror-timescaledb user=postgres connect_timeout=3 sslmode=disable password={{ .Values.timescaledb.credentials.accessNode.superuser }}\n+            - name: ACCESS_SVC_CONNSTR_MAIN_USER\n+              value: host=mirror-timescaledb user={{ .Values.importer.config.hedera.mirror.importer.db.username }} connect_timeout=3 sslmode=disable password={{ .Values.importer.config.hedera.mirror.importer.db.password }}\n+            - name: CREATE_USER_DB_SQL_COMMAND\n+              value: |\n+                SELECT format('CREATE DATABASE %I', :'dbname')\n+                WHERE NOT EXISTS (\n+                   SELECT\n+                     FROM pg_database\n+                    WHERE datname=:'dbname'\n+                )\n+                \\gexec\n+                create user :dbuser with createrole password :'dbpassword';\n+                alter user :dbuser with superuser;\n+            - name: CREATE_API_USERS_SQL_COMMAND\n+              value: |\n+                CREATE EXTENSION IF NOT EXISTS timescaledb;\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY3NzA4NA=="}, "originalCommit": {"oid": "eee7f65b34cdc872ad59e1f08f22e2e8e2baba47"}, "originalPosition": 84}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQyMjg5MzYwOnYy", "diffSide": "RIGHT", "path": "charts/hedera-mirror/templates/job-timescaledb-init.yaml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQyMjo0NTo0OFrOIHcgUQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQxNzo1MTowN1rOIJgxoQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY3Nzk2OQ==", "bodyText": "Should consider create viewer role for reuse like in secret-postgresql.sql.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r544677969", "createdAt": "2020-12-16T22:45:48Z", "author": {"login": "steven-sheehy"}, "path": "charts/hedera-mirror/templates/job-timescaledb-init.yaml", "diffHunk": "@@ -0,0 +1,92 @@\n+apiVersion: batch/v1\n+kind: Job\n+metadata:\n+  labels:\n+    {{- include \"hedera-mirror.labels\" . | nindent 4 }}\n+  name: {{ printf \"%s-timescaledb-init-job\" .Release.Name }}\n+  namespace: {{ include \"hedera-mirror.namespace\" . }}\n+  annotations:\n+    \"helm.sh/hook-delete-policy\": hook-succeeded\n+spec:\n+  backoffLimit: 4\n+  template:\n+    spec:\n+      containers:\n+        - name: init-mirrornode-db\n+          image: postgres:11-alpine\n+          command:\n+            - sh\n+            - -c\n+            - >\n+              while ! pg_isready -U postgres -h mirror-timescaledb-data; do sleep 1; done;\n+              echo \"${CREATE_USER_DB_SQL_COMMAND}\" | psql --file=- --echo-queries -d \"${ACCESS_SVC_CONNSTR_POSTGRES}\" \\\n+                  --set ON_ERROR_STOP=1 \\\n+                  --set dbname=\"${DBNAME}\" \\\n+                  --set dbuser=\"${DBUSER}\" \\\n+                  --set dbpassword=\"${DBUSERPASSWORD}\"\n+              echo \"${CREATE_API_USERS_SQL_COMMAND}\" | psql --file=- --echo-queries -d \"${ACCESS_SVC_CONNSTR_MAIN_USER}\" \\\n+                  --set ON_ERROR_STOP=1 \\\n+                  --set grpcuser=\"${GRPCUSER}\" \\\n+                  --set grpcpassword=\"${GRPCUSERPASSWORD}\" \\\n+                  --set restuser=\"${RESTUSER}\" \\\n+                  --set restpassword=\"${RESTPASSWORD}\"\n+          env:\n+            - name: DBNAME\n+              value: {{ .Values.importer.config.hedera.mirror.importer.db.name | quote }}\n+            - name: DBUSER\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: dbuser\n+            - name: DBUSERPASSWORD\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: dbpassword\n+            - name: GRPCUSER\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: grpcuser\n+            - name: GRPCUSERPASSWORD\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: grpcpassword\n+            - name: RESTUSER\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: restuser\n+            - name: RESTPASSWORD\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: restpassword\n+            - name: ACCESS_SVC_CONNSTR_POSTGRES\n+              value: host=mirror-timescaledb user=postgres connect_timeout=3 sslmode=disable password={{ .Values.timescaledb.credentials.accessNode.superuser }}\n+            - name: ACCESS_SVC_CONNSTR_MAIN_USER\n+              value: host=mirror-timescaledb user={{ .Values.importer.config.hedera.mirror.importer.db.username }} connect_timeout=3 sslmode=disable password={{ .Values.importer.config.hedera.mirror.importer.db.password }}\n+            - name: CREATE_USER_DB_SQL_COMMAND\n+              value: |\n+                SELECT format('CREATE DATABASE %I', :'dbname')\n+                WHERE NOT EXISTS (\n+                   SELECT\n+                     FROM pg_database\n+                    WHERE datname=:'dbname'\n+                )\n+                \\gexec\n+                create user :dbuser with createrole password :'dbpassword';\n+                alter user :dbuser with superuser;\n+            - name: CREATE_API_USERS_SQL_COMMAND\n+              value: |\n+                CREATE EXTENSION IF NOT EXISTS timescaledb;\n+\n+                create user :grpcuser with login password :'grpcpassword';\n+                create user :restuser with login password :'restpassword';\n+                alter default privileges in schema public grant select on tables to :grpcuser;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eee7f65b34cdc872ad59e1f08f22e2e8e2baba47"}, "originalPosition": 87}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njg0NTA4OQ==", "bodyText": "Used a viewer role", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r546845089", "createdAt": "2020-12-21T17:51:07Z", "author": {"login": "Nana-EC"}, "path": "charts/hedera-mirror/templates/job-timescaledb-init.yaml", "diffHunk": "@@ -0,0 +1,92 @@\n+apiVersion: batch/v1\n+kind: Job\n+metadata:\n+  labels:\n+    {{- include \"hedera-mirror.labels\" . | nindent 4 }}\n+  name: {{ printf \"%s-timescaledb-init-job\" .Release.Name }}\n+  namespace: {{ include \"hedera-mirror.namespace\" . }}\n+  annotations:\n+    \"helm.sh/hook-delete-policy\": hook-succeeded\n+spec:\n+  backoffLimit: 4\n+  template:\n+    spec:\n+      containers:\n+        - name: init-mirrornode-db\n+          image: postgres:11-alpine\n+          command:\n+            - sh\n+            - -c\n+            - >\n+              while ! pg_isready -U postgres -h mirror-timescaledb-data; do sleep 1; done;\n+              echo \"${CREATE_USER_DB_SQL_COMMAND}\" | psql --file=- --echo-queries -d \"${ACCESS_SVC_CONNSTR_POSTGRES}\" \\\n+                  --set ON_ERROR_STOP=1 \\\n+                  --set dbname=\"${DBNAME}\" \\\n+                  --set dbuser=\"${DBUSER}\" \\\n+                  --set dbpassword=\"${DBUSERPASSWORD}\"\n+              echo \"${CREATE_API_USERS_SQL_COMMAND}\" | psql --file=- --echo-queries -d \"${ACCESS_SVC_CONNSTR_MAIN_USER}\" \\\n+                  --set ON_ERROR_STOP=1 \\\n+                  --set grpcuser=\"${GRPCUSER}\" \\\n+                  --set grpcpassword=\"${GRPCUSERPASSWORD}\" \\\n+                  --set restuser=\"${RESTUSER}\" \\\n+                  --set restpassword=\"${RESTPASSWORD}\"\n+          env:\n+            - name: DBNAME\n+              value: {{ .Values.importer.config.hedera.mirror.importer.db.name | quote }}\n+            - name: DBUSER\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: dbuser\n+            - name: DBUSERPASSWORD\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: dbpassword\n+            - name: GRPCUSER\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: grpcuser\n+            - name: GRPCUSERPASSWORD\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: grpcpassword\n+            - name: RESTUSER\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: restuser\n+            - name: RESTPASSWORD\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: restpassword\n+            - name: ACCESS_SVC_CONNSTR_POSTGRES\n+              value: host=mirror-timescaledb user=postgres connect_timeout=3 sslmode=disable password={{ .Values.timescaledb.credentials.accessNode.superuser }}\n+            - name: ACCESS_SVC_CONNSTR_MAIN_USER\n+              value: host=mirror-timescaledb user={{ .Values.importer.config.hedera.mirror.importer.db.username }} connect_timeout=3 sslmode=disable password={{ .Values.importer.config.hedera.mirror.importer.db.password }}\n+            - name: CREATE_USER_DB_SQL_COMMAND\n+              value: |\n+                SELECT format('CREATE DATABASE %I', :'dbname')\n+                WHERE NOT EXISTS (\n+                   SELECT\n+                     FROM pg_database\n+                    WHERE datname=:'dbname'\n+                )\n+                \\gexec\n+                create user :dbuser with createrole password :'dbpassword';\n+                alter user :dbuser with superuser;\n+            - name: CREATE_API_USERS_SQL_COMMAND\n+              value: |\n+                CREATE EXTENSION IF NOT EXISTS timescaledb;\n+\n+                create user :grpcuser with login password :'grpcpassword';\n+                create user :restuser with login password :'restpassword';\n+                alter default privileges in schema public grant select on tables to :grpcuser;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY3Nzk2OQ=="}, "originalCommit": {"oid": "eee7f65b34cdc872ad59e1f08f22e2e8e2baba47"}, "originalPosition": 87}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQyMjg5MzgxOnYy", "diffSide": "RIGHT", "path": "charts/hedera-mirror/templates/job-timescaledb-init.yaml", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQyMjo0NTo1NVrOIHcgdQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQxNzoxODoyNVrOIJfz4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY3ODAwNQ==", "bodyText": "I think you're missing a grant connect.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r544678005", "createdAt": "2020-12-16T22:45:55Z", "author": {"login": "steven-sheehy"}, "path": "charts/hedera-mirror/templates/job-timescaledb-init.yaml", "diffHunk": "@@ -0,0 +1,92 @@\n+apiVersion: batch/v1\n+kind: Job\n+metadata:\n+  labels:\n+    {{- include \"hedera-mirror.labels\" . | nindent 4 }}\n+  name: {{ printf \"%s-timescaledb-init-job\" .Release.Name }}\n+  namespace: {{ include \"hedera-mirror.namespace\" . }}\n+  annotations:\n+    \"helm.sh/hook-delete-policy\": hook-succeeded\n+spec:\n+  backoffLimit: 4\n+  template:\n+    spec:\n+      containers:\n+        - name: init-mirrornode-db\n+          image: postgres:11-alpine\n+          command:\n+            - sh\n+            - -c\n+            - >\n+              while ! pg_isready -U postgres -h mirror-timescaledb-data; do sleep 1; done;\n+              echo \"${CREATE_USER_DB_SQL_COMMAND}\" | psql --file=- --echo-queries -d \"${ACCESS_SVC_CONNSTR_POSTGRES}\" \\\n+                  --set ON_ERROR_STOP=1 \\\n+                  --set dbname=\"${DBNAME}\" \\\n+                  --set dbuser=\"${DBUSER}\" \\\n+                  --set dbpassword=\"${DBUSERPASSWORD}\"\n+              echo \"${CREATE_API_USERS_SQL_COMMAND}\" | psql --file=- --echo-queries -d \"${ACCESS_SVC_CONNSTR_MAIN_USER}\" \\\n+                  --set ON_ERROR_STOP=1 \\\n+                  --set grpcuser=\"${GRPCUSER}\" \\\n+                  --set grpcpassword=\"${GRPCUSERPASSWORD}\" \\\n+                  --set restuser=\"${RESTUSER}\" \\\n+                  --set restpassword=\"${RESTPASSWORD}\"\n+          env:\n+            - name: DBNAME\n+              value: {{ .Values.importer.config.hedera.mirror.importer.db.name | quote }}\n+            - name: DBUSER\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: dbuser\n+            - name: DBUSERPASSWORD\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: dbpassword\n+            - name: GRPCUSER\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: grpcuser\n+            - name: GRPCUSERPASSWORD\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: grpcpassword\n+            - name: RESTUSER\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: restuser\n+            - name: RESTPASSWORD\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: restpassword\n+            - name: ACCESS_SVC_CONNSTR_POSTGRES\n+              value: host=mirror-timescaledb user=postgres connect_timeout=3 sslmode=disable password={{ .Values.timescaledb.credentials.accessNode.superuser }}\n+            - name: ACCESS_SVC_CONNSTR_MAIN_USER\n+              value: host=mirror-timescaledb user={{ .Values.importer.config.hedera.mirror.importer.db.username }} connect_timeout=3 sslmode=disable password={{ .Values.importer.config.hedera.mirror.importer.db.password }}\n+            - name: CREATE_USER_DB_SQL_COMMAND\n+              value: |\n+                SELECT format('CREATE DATABASE %I', :'dbname')\n+                WHERE NOT EXISTS (\n+                   SELECT\n+                     FROM pg_database\n+                    WHERE datname=:'dbname'\n+                )\n+                \\gexec\n+                create user :dbuser with createrole password :'dbpassword';\n+                alter user :dbuser with superuser;\n+            - name: CREATE_API_USERS_SQL_COMMAND\n+              value: |\n+                CREATE EXTENSION IF NOT EXISTS timescaledb;\n+\n+                create user :grpcuser with login password :'grpcpassword';", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eee7f65b34cdc872ad59e1f08f22e2e8e2baba47"}, "originalPosition": 85}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjgyOTI4MQ==", "bodyText": "Seems to function without it", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r546829281", "createdAt": "2020-12-21T17:18:25Z", "author": {"login": "Nana-EC"}, "path": "charts/hedera-mirror/templates/job-timescaledb-init.yaml", "diffHunk": "@@ -0,0 +1,92 @@\n+apiVersion: batch/v1\n+kind: Job\n+metadata:\n+  labels:\n+    {{- include \"hedera-mirror.labels\" . | nindent 4 }}\n+  name: {{ printf \"%s-timescaledb-init-job\" .Release.Name }}\n+  namespace: {{ include \"hedera-mirror.namespace\" . }}\n+  annotations:\n+    \"helm.sh/hook-delete-policy\": hook-succeeded\n+spec:\n+  backoffLimit: 4\n+  template:\n+    spec:\n+      containers:\n+        - name: init-mirrornode-db\n+          image: postgres:11-alpine\n+          command:\n+            - sh\n+            - -c\n+            - >\n+              while ! pg_isready -U postgres -h mirror-timescaledb-data; do sleep 1; done;\n+              echo \"${CREATE_USER_DB_SQL_COMMAND}\" | psql --file=- --echo-queries -d \"${ACCESS_SVC_CONNSTR_POSTGRES}\" \\\n+                  --set ON_ERROR_STOP=1 \\\n+                  --set dbname=\"${DBNAME}\" \\\n+                  --set dbuser=\"${DBUSER}\" \\\n+                  --set dbpassword=\"${DBUSERPASSWORD}\"\n+              echo \"${CREATE_API_USERS_SQL_COMMAND}\" | psql --file=- --echo-queries -d \"${ACCESS_SVC_CONNSTR_MAIN_USER}\" \\\n+                  --set ON_ERROR_STOP=1 \\\n+                  --set grpcuser=\"${GRPCUSER}\" \\\n+                  --set grpcpassword=\"${GRPCUSERPASSWORD}\" \\\n+                  --set restuser=\"${RESTUSER}\" \\\n+                  --set restpassword=\"${RESTPASSWORD}\"\n+          env:\n+            - name: DBNAME\n+              value: {{ .Values.importer.config.hedera.mirror.importer.db.name | quote }}\n+            - name: DBUSER\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: dbuser\n+            - name: DBUSERPASSWORD\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: dbpassword\n+            - name: GRPCUSER\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: grpcuser\n+            - name: GRPCUSERPASSWORD\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: grpcpassword\n+            - name: RESTUSER\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: restuser\n+            - name: RESTPASSWORD\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: restpassword\n+            - name: ACCESS_SVC_CONNSTR_POSTGRES\n+              value: host=mirror-timescaledb user=postgres connect_timeout=3 sslmode=disable password={{ .Values.timescaledb.credentials.accessNode.superuser }}\n+            - name: ACCESS_SVC_CONNSTR_MAIN_USER\n+              value: host=mirror-timescaledb user={{ .Values.importer.config.hedera.mirror.importer.db.username }} connect_timeout=3 sslmode=disable password={{ .Values.importer.config.hedera.mirror.importer.db.password }}\n+            - name: CREATE_USER_DB_SQL_COMMAND\n+              value: |\n+                SELECT format('CREATE DATABASE %I', :'dbname')\n+                WHERE NOT EXISTS (\n+                   SELECT\n+                     FROM pg_database\n+                    WHERE datname=:'dbname'\n+                )\n+                \\gexec\n+                create user :dbuser with createrole password :'dbpassword';\n+                alter user :dbuser with superuser;\n+            - name: CREATE_API_USERS_SQL_COMMAND\n+              value: |\n+                CREATE EXTENSION IF NOT EXISTS timescaledb;\n+\n+                create user :grpcuser with login password :'grpcpassword';", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY3ODAwNQ=="}, "originalCommit": {"oid": "eee7f65b34cdc872ad59e1f08f22e2e8e2baba47"}, "originalPosition": 85}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQyMjkwMjM4OnYy", "diffSide": "RIGHT", "path": "charts/hedera-mirror/templates/job-timescaledb-init.yaml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQyMjo0ODoyNVrOIHclPg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQxNzo1MToxN1rOIJgx_Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY3OTIzMA==", "bodyText": "All users should be created by superuser. All users should be created in mirrornode database.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r544679230", "createdAt": "2020-12-16T22:48:25Z", "author": {"login": "steven-sheehy"}, "path": "charts/hedera-mirror/templates/job-timescaledb-init.yaml", "diffHunk": "@@ -0,0 +1,92 @@\n+apiVersion: batch/v1\n+kind: Job\n+metadata:\n+  labels:\n+    {{- include \"hedera-mirror.labels\" . | nindent 4 }}\n+  name: {{ printf \"%s-timescaledb-init-job\" .Release.Name }}\n+  namespace: {{ include \"hedera-mirror.namespace\" . }}\n+  annotations:\n+    \"helm.sh/hook-delete-policy\": hook-succeeded\n+spec:\n+  backoffLimit: 4\n+  template:\n+    spec:\n+      containers:\n+        - name: init-mirrornode-db\n+          image: postgres:11-alpine\n+          command:\n+            - sh\n+            - -c\n+            - >\n+              while ! pg_isready -U postgres -h mirror-timescaledb-data; do sleep 1; done;\n+              echo \"${CREATE_USER_DB_SQL_COMMAND}\" | psql --file=- --echo-queries -d \"${ACCESS_SVC_CONNSTR_POSTGRES}\" \\\n+                  --set ON_ERROR_STOP=1 \\\n+                  --set dbname=\"${DBNAME}\" \\\n+                  --set dbuser=\"${DBUSER}\" \\\n+                  --set dbpassword=\"${DBUSERPASSWORD}\"\n+              echo \"${CREATE_API_USERS_SQL_COMMAND}\" | psql --file=- --echo-queries -d \"${ACCESS_SVC_CONNSTR_MAIN_USER}\" \\", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eee7f65b34cdc872ad59e1f08f22e2e8e2baba47"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njg0NTE4MQ==", "bodyText": "Done", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r546845181", "createdAt": "2020-12-21T17:51:17Z", "author": {"login": "Nana-EC"}, "path": "charts/hedera-mirror/templates/job-timescaledb-init.yaml", "diffHunk": "@@ -0,0 +1,92 @@\n+apiVersion: batch/v1\n+kind: Job\n+metadata:\n+  labels:\n+    {{- include \"hedera-mirror.labels\" . | nindent 4 }}\n+  name: {{ printf \"%s-timescaledb-init-job\" .Release.Name }}\n+  namespace: {{ include \"hedera-mirror.namespace\" . }}\n+  annotations:\n+    \"helm.sh/hook-delete-policy\": hook-succeeded\n+spec:\n+  backoffLimit: 4\n+  template:\n+    spec:\n+      containers:\n+        - name: init-mirrornode-db\n+          image: postgres:11-alpine\n+          command:\n+            - sh\n+            - -c\n+            - >\n+              while ! pg_isready -U postgres -h mirror-timescaledb-data; do sleep 1; done;\n+              echo \"${CREATE_USER_DB_SQL_COMMAND}\" | psql --file=- --echo-queries -d \"${ACCESS_SVC_CONNSTR_POSTGRES}\" \\\n+                  --set ON_ERROR_STOP=1 \\\n+                  --set dbname=\"${DBNAME}\" \\\n+                  --set dbuser=\"${DBUSER}\" \\\n+                  --set dbpassword=\"${DBUSERPASSWORD}\"\n+              echo \"${CREATE_API_USERS_SQL_COMMAND}\" | psql --file=- --echo-queries -d \"${ACCESS_SVC_CONNSTR_MAIN_USER}\" \\", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY3OTIzMA=="}, "originalCommit": {"oid": "eee7f65b34cdc872ad59e1f08f22e2e8e2baba47"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQyMjkwNjU0OnYy", "diffSide": "RIGHT", "path": "charts/hedera-mirror-importer/templates/statefulset.yaml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQyMjo0OTozN1rOIHcnnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQxNzo1MToyM1rOIJgyMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY3OTgzNw==", "bodyText": "Use nindent", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r544679837", "createdAt": "2020-12-16T22:49:37Z", "author": {"login": "steven-sheehy"}, "path": "charts/hedera-mirror-importer/templates/statefulset.yaml", "diffHunk": "@@ -66,6 +66,9 @@ spec:\n               mountPath: /usr/etc/hedera-mirror-importer\n             - name: data\n               mountPath: /var/lib/hedera-mirror-importer\n+{{- if .Values.extraVolumeMounts }}\n+{{ toYaml .Values.extraVolumeMounts | indent 12 }}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eee7f65b34cdc872ad59e1f08f22e2e8e2baba47"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njg0NTIzNQ==", "bodyText": "Updated", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r546845235", "createdAt": "2020-12-21T17:51:23Z", "author": {"login": "Nana-EC"}, "path": "charts/hedera-mirror-importer/templates/statefulset.yaml", "diffHunk": "@@ -66,6 +66,9 @@ spec:\n               mountPath: /usr/etc/hedera-mirror-importer\n             - name: data\n               mountPath: /var/lib/hedera-mirror-importer\n+{{- if .Values.extraVolumeMounts }}\n+{{ toYaml .Values.extraVolumeMounts | indent 12 }}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY3OTgzNw=="}, "originalCommit": {"oid": "eee7f65b34cdc872ad59e1f08f22e2e8e2baba47"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQyMjkxMjAyOnYy", "diffSide": "RIGHT", "path": "charts/README.md", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQyMjo1MToxOFrOIHcqxg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQxNzo1MTo0MFrOIJgyrg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY4MDY0Ng==", "bodyText": "This change is unnecessary. Helm delete already deletes services and endpoints. This command is to cleanup things not deleted by Helm like PVCs. The -l release=\"${RELEASE}\" might be okay to keep if you see a benefit in that.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r544680646", "createdAt": "2020-12-16T22:51:18Z", "author": {"login": "steven-sheehy"}, "path": "charts/README.md", "diffHunk": "@@ -66,12 +106,40 @@ To remove all the Kubernetes components associated with the chart and delete the\n $ helm delete \"${RELEASE}\"\n ```\n \n+\n The above command does not delete any of the underlying persistent volumes. To delete all the data associated with this release:\n \n ```shell script\n-$ kubectl delete $(kubectl get pvc -o name)\n+$ kubectl delete $(kubectl get pvc, ep, service -l release=\"${RELEASE}\" -o name)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eee7f65b34cdc872ad59e1f08f22e2e8e2baba47"}, "originalPosition": 64}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njg0NTM1OA==", "bodyText": "Reverted but added the -l release=\"${RELEASE}\"", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r546845358", "createdAt": "2020-12-21T17:51:40Z", "author": {"login": "Nana-EC"}, "path": "charts/README.md", "diffHunk": "@@ -66,12 +106,40 @@ To remove all the Kubernetes components associated with the chart and delete the\n $ helm delete \"${RELEASE}\"\n ```\n \n+\n The above command does not delete any of the underlying persistent volumes. To delete all the data associated with this release:\n \n ```shell script\n-$ kubectl delete $(kubectl get pvc -o name)\n+$ kubectl delete $(kubectl get pvc, ep, service -l release=\"${RELEASE}\" -o name)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY4MDY0Ng=="}, "originalCommit": {"oid": "eee7f65b34cdc872ad59e1f08f22e2e8e2baba47"}, "originalPosition": 64}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQyMjkxMjQxOnYy", "diffSide": "RIGHT", "path": "charts/README.md", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQyMjo1MToyNlrOIHcq-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQxNzo1MjowMlrOIJgzZg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY4MDY5OQ==", "bodyText": "Spurious newline", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r544680699", "createdAt": "2020-12-16T22:51:26Z", "author": {"login": "steven-sheehy"}, "path": "charts/README.md", "diffHunk": "@@ -66,12 +106,40 @@ To remove all the Kubernetes components associated with the chart and delete the\n $ helm delete \"${RELEASE}\"\n ```\n \n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eee7f65b34cdc872ad59e1f08f22e2e8e2baba47"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njg0NTU0Mg==", "bodyText": "Removed", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r546845542", "createdAt": "2020-12-21T17:52:02Z", "author": {"login": "Nana-EC"}, "path": "charts/README.md", "diffHunk": "@@ -66,12 +106,40 @@ To remove all the Kubernetes components associated with the chart and delete the\n $ helm delete \"${RELEASE}\"\n ```\n \n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY4MDY5OQ=="}, "originalCommit": {"oid": "eee7f65b34cdc872ad59e1f08f22e2e8e2baba47"}, "originalPosition": 59}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQyMjkyNjM3OnYy", "diffSide": "RIGHT", "path": "charts/README.md", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQyMjo1NToxN1rOIHcy5Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQxNzo1MjowOVrOIJgzpQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY4MjcyNQ==", "bodyText": "This step is duplicated twice", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r544682725", "createdAt": "2020-12-16T22:55:17Z", "author": {"login": "steven-sheehy"}, "path": "charts/README.md", "diffHunk": "@@ -22,10 +22,50 @@ export RELEASE=\"mirror1\"\n \n To install the wrapper chart:\n \n-```shell script\n-$ helm repo add hedera https://hashgraph.github.io/hedera-mirror-node/charts\n-$ helm upgrade --install \"${RELEASE}\" hedera/hedera-mirror\n-```\n+1. Add the Hedera Mirror Node Repo\n+    ```shell script\n+    $ helm repo add hedera https://hashgraph.github.io/hedera-mirror-node/charts\n+    ```\n+\n+2. (Optional): Configure Network & AddressBook\n+    When running against a network other than the demo/testnent/mainnet network, the network must be updated and an initialAddressBook file must be provided.\n+\n+    e.g. To use an addressbook from a file located at `/Downloads/perf.bin`:\n+    First create the addressBook file as a secret from the local file:\n+    ```shell script\n+    $ kubectl create secret generic mirror-importer-addressbook --from-file=perf.bin=/Downloads/perf.bin --save-config=true\n+    ```\n+\n+    Then update the `values/yaml` file to set the `network`, `initialAddressBook`, `extraVolumes` and `extraVolumeMounts` configs.\n+    ```yaml\n+    importer:\n+      config:\n+        hedera:\n+          mirror:\n+            importer:\n+              initialAddressBook: \"/usr/etc/addressbook/perf.bin\"\n+              network: \"OTHER\"\n+      extraVolumes:\n+         - name: addressbook-secret-volume\n+           secret:\n+             defaultMode: 420\n+             secretName: mirror-importer-addressbook\n+      extraVolumeMounts:\n+         - name: addressbook-secret-volume\n+           mountPath: /usr/etc/addressbook\n+    ```\n+    > **_Note_** Ensure the configured `mountPath` matches the path in `initialAddressBook`\n+\n+    Then create the addressBook file as a secret from a local file e.g. `/Downloads/perf.bin`.\n+    ```shell script\n+    $ kubectl create secret generic mirror-importer-addressbook --from-file=perf.bin=/Downloads/perf.bin --save-config=true", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "753bfea9308fd242918b45042949012bee0c82cf"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njg0NTYwNQ==", "bodyText": "Removed", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r546845605", "createdAt": "2020-12-21T17:52:09Z", "author": {"login": "Nana-EC"}, "path": "charts/README.md", "diffHunk": "@@ -22,10 +22,50 @@ export RELEASE=\"mirror1\"\n \n To install the wrapper chart:\n \n-```shell script\n-$ helm repo add hedera https://hashgraph.github.io/hedera-mirror-node/charts\n-$ helm upgrade --install \"${RELEASE}\" hedera/hedera-mirror\n-```\n+1. Add the Hedera Mirror Node Repo\n+    ```shell script\n+    $ helm repo add hedera https://hashgraph.github.io/hedera-mirror-node/charts\n+    ```\n+\n+2. (Optional): Configure Network & AddressBook\n+    When running against a network other than the demo/testnent/mainnet network, the network must be updated and an initialAddressBook file must be provided.\n+\n+    e.g. To use an addressbook from a file located at `/Downloads/perf.bin`:\n+    First create the addressBook file as a secret from the local file:\n+    ```shell script\n+    $ kubectl create secret generic mirror-importer-addressbook --from-file=perf.bin=/Downloads/perf.bin --save-config=true\n+    ```\n+\n+    Then update the `values/yaml` file to set the `network`, `initialAddressBook`, `extraVolumes` and `extraVolumeMounts` configs.\n+    ```yaml\n+    importer:\n+      config:\n+        hedera:\n+          mirror:\n+            importer:\n+              initialAddressBook: \"/usr/etc/addressbook/perf.bin\"\n+              network: \"OTHER\"\n+      extraVolumes:\n+         - name: addressbook-secret-volume\n+           secret:\n+             defaultMode: 420\n+             secretName: mirror-importer-addressbook\n+      extraVolumeMounts:\n+         - name: addressbook-secret-volume\n+           mountPath: /usr/etc/addressbook\n+    ```\n+    > **_Note_** Ensure the configured `mountPath` matches the path in `initialAddressBook`\n+\n+    Then create the addressBook file as a secret from a local file e.g. `/Downloads/perf.bin`.\n+    ```shell script\n+    $ kubectl create secret generic mirror-importer-addressbook --from-file=perf.bin=/Downloads/perf.bin --save-config=true", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY4MjcyNQ=="}, "originalCommit": {"oid": "753bfea9308fd242918b45042949012bee0c82cf"}, "originalPosition": 44}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQyMjkzNTc1OnYy", "diffSide": "RIGHT", "path": "charts/README.md", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQyMjo1Nzo1NlrOIHc4Vg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQxNzo1MjoxNlrOIJgz1A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY4NDExOA==", "bodyText": "Extra spacing under these extraVolumes and extraVolumeMounts. Not sure it causes rendering issues if copied.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r544684118", "createdAt": "2020-12-16T22:57:56Z", "author": {"login": "steven-sheehy"}, "path": "charts/README.md", "diffHunk": "@@ -22,10 +22,50 @@ export RELEASE=\"mirror1\"\n \n To install the wrapper chart:\n \n-```shell script\n-$ helm repo add hedera https://hashgraph.github.io/hedera-mirror-node/charts\n-$ helm upgrade --install \"${RELEASE}\" hedera/hedera-mirror\n-```\n+1. Add the Hedera Mirror Node Repo\n+    ```shell script\n+    $ helm repo add hedera https://hashgraph.github.io/hedera-mirror-node/charts\n+    ```\n+\n+2. (Optional): Configure Network & AddressBook\n+    When running against a network other than the demo/testnent/mainnet network, the network must be updated and an initialAddressBook file must be provided.\n+\n+    e.g. To use an addressbook from a file located at `/Downloads/perf.bin`:\n+    First create the addressBook file as a secret from the local file:\n+    ```shell script\n+    $ kubectl create secret generic mirror-importer-addressbook --from-file=perf.bin=/Downloads/perf.bin --save-config=true\n+    ```\n+\n+    Then update the `values/yaml` file to set the `network`, `initialAddressBook`, `extraVolumes` and `extraVolumeMounts` configs.\n+    ```yaml\n+    importer:\n+      config:\n+        hedera:\n+          mirror:\n+            importer:\n+              initialAddressBook: \"/usr/etc/addressbook/perf.bin\"\n+              network: \"OTHER\"\n+      extraVolumes:\n+         - name: addressbook-secret-volume", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "753bfea9308fd242918b45042949012bee0c82cf"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njg0NTY1Mg==", "bodyText": "Removed", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r546845652", "createdAt": "2020-12-21T17:52:16Z", "author": {"login": "Nana-EC"}, "path": "charts/README.md", "diffHunk": "@@ -22,10 +22,50 @@ export RELEASE=\"mirror1\"\n \n To install the wrapper chart:\n \n-```shell script\n-$ helm repo add hedera https://hashgraph.github.io/hedera-mirror-node/charts\n-$ helm upgrade --install \"${RELEASE}\" hedera/hedera-mirror\n-```\n+1. Add the Hedera Mirror Node Repo\n+    ```shell script\n+    $ helm repo add hedera https://hashgraph.github.io/hedera-mirror-node/charts\n+    ```\n+\n+2. (Optional): Configure Network & AddressBook\n+    When running against a network other than the demo/testnent/mainnet network, the network must be updated and an initialAddressBook file must be provided.\n+\n+    e.g. To use an addressbook from a file located at `/Downloads/perf.bin`:\n+    First create the addressBook file as a secret from the local file:\n+    ```shell script\n+    $ kubectl create secret generic mirror-importer-addressbook --from-file=perf.bin=/Downloads/perf.bin --save-config=true\n+    ```\n+\n+    Then update the `values/yaml` file to set the `network`, `initialAddressBook`, `extraVolumes` and `extraVolumeMounts` configs.\n+    ```yaml\n+    importer:\n+      config:\n+        hedera:\n+          mirror:\n+            importer:\n+              initialAddressBook: \"/usr/etc/addressbook/perf.bin\"\n+              network: \"OTHER\"\n+      extraVolumes:\n+         - name: addressbook-secret-volume", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY4NDExOA=="}, "originalCommit": {"oid": "753bfea9308fd242918b45042949012bee0c82cf"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQyMjkzNzM0OnYy", "diffSide": "RIGHT", "path": "charts/README.md", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQyMjo1ODoyNVrOIHc5Qw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQxNzo1MjoyOVrOIJg0KQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY4NDM1NQ==", "bodyText": "values.yaml", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r544684355", "createdAt": "2020-12-16T22:58:25Z", "author": {"login": "steven-sheehy"}, "path": "charts/README.md", "diffHunk": "@@ -22,10 +22,50 @@ export RELEASE=\"mirror1\"\n \n To install the wrapper chart:\n \n-```shell script\n-$ helm repo add hedera https://hashgraph.github.io/hedera-mirror-node/charts\n-$ helm upgrade --install \"${RELEASE}\" hedera/hedera-mirror\n-```\n+1. Add the Hedera Mirror Node Repo\n+    ```shell script\n+    $ helm repo add hedera https://hashgraph.github.io/hedera-mirror-node/charts\n+    ```\n+\n+2. (Optional): Configure Network & AddressBook\n+    When running against a network other than the demo/testnent/mainnet network, the network must be updated and an initialAddressBook file must be provided.\n+\n+    e.g. To use an addressbook from a file located at `/Downloads/perf.bin`:\n+    First create the addressBook file as a secret from the local file:\n+    ```shell script\n+    $ kubectl create secret generic mirror-importer-addressbook --from-file=perf.bin=/Downloads/perf.bin --save-config=true\n+    ```\n+\n+    Then update the `values/yaml` file to set the `network`, `initialAddressBook`, `extraVolumes` and `extraVolumeMounts` configs.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "753bfea9308fd242918b45042949012bee0c82cf"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njg0NTczNw==", "bodyText": "Updated", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r546845737", "createdAt": "2020-12-21T17:52:29Z", "author": {"login": "Nana-EC"}, "path": "charts/README.md", "diffHunk": "@@ -22,10 +22,50 @@ export RELEASE=\"mirror1\"\n \n To install the wrapper chart:\n \n-```shell script\n-$ helm repo add hedera https://hashgraph.github.io/hedera-mirror-node/charts\n-$ helm upgrade --install \"${RELEASE}\" hedera/hedera-mirror\n-```\n+1. Add the Hedera Mirror Node Repo\n+    ```shell script\n+    $ helm repo add hedera https://hashgraph.github.io/hedera-mirror-node/charts\n+    ```\n+\n+2. (Optional): Configure Network & AddressBook\n+    When running against a network other than the demo/testnent/mainnet network, the network must be updated and an initialAddressBook file must be provided.\n+\n+    e.g. To use an addressbook from a file located at `/Downloads/perf.bin`:\n+    First create the addressBook file as a secret from the local file:\n+    ```shell script\n+    $ kubectl create secret generic mirror-importer-addressbook --from-file=perf.bin=/Downloads/perf.bin --save-config=true\n+    ```\n+\n+    Then update the `values/yaml` file to set the `network`, `initialAddressBook`, `extraVolumes` and `extraVolumeMounts` configs.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY4NDM1NQ=="}, "originalCommit": {"oid": "753bfea9308fd242918b45042949012bee0c82cf"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQyMjk0MjkwOnYy", "diffSide": "RIGHT", "path": "charts/README.md", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQyMzowMDowNVrOIHc8qQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQxNzo1Mjo0NlrOIJg0ww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY4NTIyNQ==", "bodyText": "I prefer the TLDR of the previous approach of repo add & install. There are hundreds of potential options to list in between repo add and install that we can't list all. Instead, I think we should add a separate configuration section with this address book information.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r544685225", "createdAt": "2020-12-16T23:00:05Z", "author": {"login": "steven-sheehy"}, "path": "charts/README.md", "diffHunk": "@@ -22,10 +22,50 @@ export RELEASE=\"mirror1\"\n \n To install the wrapper chart:\n \n-```shell script\n-$ helm repo add hedera https://hashgraph.github.io/hedera-mirror-node/charts\n-$ helm upgrade --install \"${RELEASE}\" hedera/hedera-mirror\n-```\n+1. Add the Hedera Mirror Node Repo\n+    ```shell script\n+    $ helm repo add hedera https://hashgraph.github.io/hedera-mirror-node/charts", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "753bfea9308fd242918b45042949012bee0c82cf"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njg0NTg5MQ==", "bodyText": "Reverted and added a configuration sub sub section", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r546845891", "createdAt": "2020-12-21T17:52:46Z", "author": {"login": "Nana-EC"}, "path": "charts/README.md", "diffHunk": "@@ -22,10 +22,50 @@ export RELEASE=\"mirror1\"\n \n To install the wrapper chart:\n \n-```shell script\n-$ helm repo add hedera https://hashgraph.github.io/hedera-mirror-node/charts\n-$ helm upgrade --install \"${RELEASE}\" hedera/hedera-mirror\n-```\n+1. Add the Hedera Mirror Node Repo\n+    ```shell script\n+    $ helm repo add hedera https://hashgraph.github.io/hedera-mirror-node/charts", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY4NTIyNQ=="}, "originalCommit": {"oid": "753bfea9308fd242918b45042949012bee0c82cf"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQyNjc5NzczOnYy", "diffSide": "RIGHT", "path": "charts/README.md", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QxNjo1Mjo1NlrOIH_B-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQxNzo1Mjo1M1rOIJg08A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTI0MzY0MQ==", "bodyText": "add newline before this paragraph\ntypo testnent -> testnet\nprefer initial address book to initialAddressBook", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r545243641", "createdAt": "2020-12-17T16:52:56Z", "author": {"login": "xin-hedera"}, "path": "charts/README.md", "diffHunk": "@@ -22,10 +22,50 @@ export RELEASE=\"mirror1\"\n \n To install the wrapper chart:\n \n-```shell script\n-$ helm repo add hedera https://hashgraph.github.io/hedera-mirror-node/charts\n-$ helm upgrade --install \"${RELEASE}\" hedera/hedera-mirror\n-```\n+1. Add the Hedera Mirror Node Repo\n+    ```shell script\n+    $ helm repo add hedera https://hashgraph.github.io/hedera-mirror-node/charts\n+    ```\n+\n+2. (Optional): Configure Network & AddressBook\n+    When running against a network other than the demo/testnent/mainnet network, the network must be updated and an initialAddressBook file must be provided.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "753bfea9308fd242918b45042949012bee0c82cf"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njg0NTkzNg==", "bodyText": "Updated", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r546845936", "createdAt": "2020-12-21T17:52:53Z", "author": {"login": "Nana-EC"}, "path": "charts/README.md", "diffHunk": "@@ -22,10 +22,50 @@ export RELEASE=\"mirror1\"\n \n To install the wrapper chart:\n \n-```shell script\n-$ helm repo add hedera https://hashgraph.github.io/hedera-mirror-node/charts\n-$ helm upgrade --install \"${RELEASE}\" hedera/hedera-mirror\n-```\n+1. Add the Hedera Mirror Node Repo\n+    ```shell script\n+    $ helm repo add hedera https://hashgraph.github.io/hedera-mirror-node/charts\n+    ```\n+\n+2. (Optional): Configure Network & AddressBook\n+    When running against a network other than the demo/testnent/mainnet network, the network must be updated and an initialAddressBook file must be provided.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTI0MzY0MQ=="}, "originalCommit": {"oid": "753bfea9308fd242918b45042949012bee0c82cf"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQyNjgyOTU5OnYy", "diffSide": "RIGHT", "path": "charts/README.md", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QxNjo1OTo0MFrOIH_VTg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQwMToxOToyM1rOIJrDTA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTI0ODU5MA==", "bodyText": "better this way:\nThen create a local values.yaml file to ...", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r545248590", "createdAt": "2020-12-17T16:59:40Z", "author": {"login": "xin-hedera"}, "path": "charts/README.md", "diffHunk": "@@ -22,10 +22,50 @@ export RELEASE=\"mirror1\"\n \n To install the wrapper chart:\n \n-```shell script\n-$ helm repo add hedera https://hashgraph.github.io/hedera-mirror-node/charts\n-$ helm upgrade --install \"${RELEASE}\" hedera/hedera-mirror\n-```\n+1. Add the Hedera Mirror Node Repo\n+    ```shell script\n+    $ helm repo add hedera https://hashgraph.github.io/hedera-mirror-node/charts\n+    ```\n+\n+2. (Optional): Configure Network & AddressBook\n+    When running against a network other than the demo/testnent/mainnet network, the network must be updated and an initialAddressBook file must be provided.\n+\n+    e.g. To use an addressbook from a file located at `/Downloads/perf.bin`:\n+    First create the addressBook file as a secret from the local file:\n+    ```shell script\n+    $ kubectl create secret generic mirror-importer-addressbook --from-file=perf.bin=/Downloads/perf.bin --save-config=true\n+    ```\n+\n+    Then update the `values/yaml` file to set the `network`, `initialAddressBook`, `extraVolumes` and `extraVolumeMounts` configs.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "753bfea9308fd242918b45042949012bee0c82cf"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjgzNjcxMA==", "bodyText": "The values.yaml file already exists though. Or do you mean a separately named files in which they'd also have to be sure to add the necessary properties  like the way values-prod.yaml does.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r546836710", "createdAt": "2020-12-21T17:33:22Z", "author": {"login": "Nana-EC"}, "path": "charts/README.md", "diffHunk": "@@ -22,10 +22,50 @@ export RELEASE=\"mirror1\"\n \n To install the wrapper chart:\n \n-```shell script\n-$ helm repo add hedera https://hashgraph.github.io/hedera-mirror-node/charts\n-$ helm upgrade --install \"${RELEASE}\" hedera/hedera-mirror\n-```\n+1. Add the Hedera Mirror Node Repo\n+    ```shell script\n+    $ helm repo add hedera https://hashgraph.github.io/hedera-mirror-node/charts\n+    ```\n+\n+2. (Optional): Configure Network & AddressBook\n+    When running against a network other than the demo/testnent/mainnet network, the network must be updated and an initialAddressBook file must be provided.\n+\n+    e.g. To use an addressbook from a file located at `/Downloads/perf.bin`:\n+    First create the addressBook file as a secret from the local file:\n+    ```shell script\n+    $ kubectl create secret generic mirror-importer-addressbook --from-file=perf.bin=/Downloads/perf.bin --save-config=true\n+    ```\n+\n+    Then update the `values/yaml` file to set the `network`, `initialAddressBook`, `extraVolumes` and `extraVolumeMounts` configs.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTI0ODU5MA=="}, "originalCommit": {"oid": "753bfea9308fd242918b45042949012bee0c82cf"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjkwMDg4Mg==", "bodyText": "I think Xin is saying not to recommend users update the existing values.yaml but to create their own custom yaml file like custom.yaml. If so, I would agree with that.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r546900882", "createdAt": "2020-12-21T19:54:53Z", "author": {"login": "steven-sheehy"}, "path": "charts/README.md", "diffHunk": "@@ -22,10 +22,50 @@ export RELEASE=\"mirror1\"\n \n To install the wrapper chart:\n \n-```shell script\n-$ helm repo add hedera https://hashgraph.github.io/hedera-mirror-node/charts\n-$ helm upgrade --install \"${RELEASE}\" hedera/hedera-mirror\n-```\n+1. Add the Hedera Mirror Node Repo\n+    ```shell script\n+    $ helm repo add hedera https://hashgraph.github.io/hedera-mirror-node/charts\n+    ```\n+\n+2. (Optional): Configure Network & AddressBook\n+    When running against a network other than the demo/testnent/mainnet network, the network must be updated and an initialAddressBook file must be provided.\n+\n+    e.g. To use an addressbook from a file located at `/Downloads/perf.bin`:\n+    First create the addressBook file as a secret from the local file:\n+    ```shell script\n+    $ kubectl create secret generic mirror-importer-addressbook --from-file=perf.bin=/Downloads/perf.bin --save-config=true\n+    ```\n+\n+    Then update the `values/yaml` file to set the `network`, `initialAddressBook`, `extraVolumes` and `extraVolumeMounts` configs.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTI0ODU5MA=="}, "originalCommit": {"oid": "753bfea9308fd242918b45042949012bee0c82cf"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzAxMzQ1Mg==", "bodyText": "Noting a new file works for me", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r547013452", "createdAt": "2020-12-22T01:19:23Z", "author": {"login": "Nana-EC"}, "path": "charts/README.md", "diffHunk": "@@ -22,10 +22,50 @@ export RELEASE=\"mirror1\"\n \n To install the wrapper chart:\n \n-```shell script\n-$ helm repo add hedera https://hashgraph.github.io/hedera-mirror-node/charts\n-$ helm upgrade --install \"${RELEASE}\" hedera/hedera-mirror\n-```\n+1. Add the Hedera Mirror Node Repo\n+    ```shell script\n+    $ helm repo add hedera https://hashgraph.github.io/hedera-mirror-node/charts\n+    ```\n+\n+2. (Optional): Configure Network & AddressBook\n+    When running against a network other than the demo/testnent/mainnet network, the network must be updated and an initialAddressBook file must be provided.\n+\n+    e.g. To use an addressbook from a file located at `/Downloads/perf.bin`:\n+    First create the addressBook file as a secret from the local file:\n+    ```shell script\n+    $ kubectl create secret generic mirror-importer-addressbook --from-file=perf.bin=/Downloads/perf.bin --save-config=true\n+    ```\n+\n+    Then update the `values/yaml` file to set the `network`, `initialAddressBook`, `extraVolumes` and `extraVolumeMounts` configs.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTI0ODU5MA=="}, "originalCommit": {"oid": "753bfea9308fd242918b45042949012bee0c82cf"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQyNzIwOTMxOnYy", "diffSide": "RIGHT", "path": "charts/hedera-mirror-importer/templates/statefulset.yaml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QxODoyNDozM1rOIIC3_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQxNzo1MzowMlrOIJg1QA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTMwNjYyMQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            {{ toYaml .Values.extraVolumeMounts | indent 12 }}\n          \n          \n            \n            {{- toYaml .Values.extraVolumeMounts | nindent 12 }}", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r545306621", "createdAt": "2020-12-17T18:24:33Z", "author": {"login": "xin-hedera"}, "path": "charts/hedera-mirror-importer/templates/statefulset.yaml", "diffHunk": "@@ -66,6 +66,9 @@ spec:\n               mountPath: /usr/etc/hedera-mirror-importer\n             - name: data\n               mountPath: /var/lib/hedera-mirror-importer\n+{{- if .Values.extraVolumeMounts }}\n+{{ toYaml .Values.extraVolumeMounts | indent 12 }}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "753bfea9308fd242918b45042949012bee0c82cf"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njg0NjAxNg==", "bodyText": "Updated", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r546846016", "createdAt": "2020-12-21T17:53:02Z", "author": {"login": "Nana-EC"}, "path": "charts/hedera-mirror-importer/templates/statefulset.yaml", "diffHunk": "@@ -66,6 +66,9 @@ spec:\n               mountPath: /usr/etc/hedera-mirror-importer\n             - name: data\n               mountPath: /var/lib/hedera-mirror-importer\n+{{- if .Values.extraVolumeMounts }}\n+{{ toYaml .Values.extraVolumeMounts | indent 12 }}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTMwNjYyMQ=="}, "originalCommit": {"oid": "753bfea9308fd242918b45042949012bee0c82cf"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQyNzIxMzc0OnYy", "diffSide": "RIGHT", "path": "charts/hedera-mirror-importer/templates/statefulset.yaml", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QxODoyNTozNlrOIIC6lA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQxNzo1MzoxMFrOIJg1fQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTMwNzI4NA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            {{- if .Values.extraVolumes }}\n          \n          \n            \n            {{ toYaml .Values.extraVolumes | nindent 8}}\n          \n          \n            \n            {{- end }}\n          \n          \n            \n            {{- if .Values.extraVolumes }}\n          \n          \n            \n            {{- toYaml .Values.extraVolumes | nindent 8 }}\n          \n          \n            \n            {{- end }}\n          \n      \n    \n    \n  \n\nalso this block is placed at the wrong place, should be before:\n{{- if not .Values.persistence.enabled }}", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r545307284", "createdAt": "2020-12-17T18:25:36Z", "author": {"login": "xin-hedera"}, "path": "charts/hedera-mirror-importer/templates/statefulset.yaml", "diffHunk": "@@ -86,6 +89,9 @@ spec:\n         - name: data\n           emptyDir: {}\n {{- else }}\n+{{- if .Values.extraVolumes }}\n+{{ toYaml .Values.extraVolumes | nindent 8}}\n+{{- end }}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "753bfea9308fd242918b45042949012bee0c82cf"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTMxMjM5NA==", "bodyText": "Good catch. Those collapsed diffs make it hard to see.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r545312394", "createdAt": "2020-12-17T18:33:37Z", "author": {"login": "steven-sheehy"}, "path": "charts/hedera-mirror-importer/templates/statefulset.yaml", "diffHunk": "@@ -86,6 +89,9 @@ spec:\n         - name: data\n           emptyDir: {}\n {{- else }}\n+{{- if .Values.extraVolumes }}\n+{{ toYaml .Values.extraVolumes | nindent 8}}\n+{{- end }}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTMwNzI4NA=="}, "originalCommit": {"oid": "753bfea9308fd242918b45042949012bee0c82cf"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njg0NjA3Nw==", "bodyText": "Updated", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r546846077", "createdAt": "2020-12-21T17:53:10Z", "author": {"login": "Nana-EC"}, "path": "charts/hedera-mirror-importer/templates/statefulset.yaml", "diffHunk": "@@ -86,6 +89,9 @@ spec:\n         - name: data\n           emptyDir: {}\n {{- else }}\n+{{- if .Values.extraVolumes }}\n+{{ toYaml .Values.extraVolumes | nindent 8}}\n+{{- end }}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTMwNzI4NA=="}, "originalCommit": {"oid": "753bfea9308fd242918b45042949012bee0c82cf"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQzODM4MzAyOnYy", "diffSide": "RIGHT", "path": "charts/hedera-mirror/templates/job-timescaledb-init.yaml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQxOTozNjo1NFrOIJjq-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQwMjo1NzozMFrOIJspBQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njg5MjUzOQ==", "bodyText": "host needs to be templated with release name. Since it's used in multiple places, might be good to move to function in helpers", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r546892539", "createdAt": "2020-12-21T19:36:54Z", "author": {"login": "steven-sheehy"}, "path": "charts/hedera-mirror/templates/job-timescaledb-init.yaml", "diffHunk": "@@ -0,0 +1,39 @@\n+apiVersion: batch/v1\n+kind: Job\n+metadata:\n+  labels:\n+    {{- include \"hedera-mirror.labels\" . | nindent 4 }}\n+  name: {{ printf \"%s-timescaledb-init-job\" .Release.Name }}\n+  namespace: {{ include \"hedera-mirror.namespace\" . }}\n+  annotations:\n+    \"helm.sh/hook-delete-policy\": hook-succeeded\n+spec:\n+  backoffLimit: 4\n+  template:\n+    spec:\n+      containers:\n+        - name: init-mirrornode-db\n+          image: timescaledev/timescaledb-ha:pg12-ts2.0.0-rc3\n+          command:\n+            - sh\n+            - -c\n+            - |\n+              set -e\n+\n+              while ! pg_isready -U postgres -h {{ printf \"%s-timescaledb-data\" .Release.Name }}; do sleep 1; done;\n+              psql --echo-queries -d \"${ACCESS_SVC_CONNSTR_POSTGRES}\" --set ON_ERROR_STOP=1 -f ${DB_INIT_FILE}\n+          env:\n+            - name: ACCESS_SVC_CONNSTR_POSTGRES\n+              value: host=mirror-timescaledb user=postgres connect_timeout=3 sslmode=disable password={{ .Values.timescaledb.credentials.accessNode.superuser }}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "05d6ccfdc0a361280e620f90ac50ea2f9c4f2258"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzAzOTQ5Mw==", "bodyText": "Updated using a helpers function", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r547039493", "createdAt": "2020-12-22T02:57:30Z", "author": {"login": "Nana-EC"}, "path": "charts/hedera-mirror/templates/job-timescaledb-init.yaml", "diffHunk": "@@ -0,0 +1,39 @@\n+apiVersion: batch/v1\n+kind: Job\n+metadata:\n+  labels:\n+    {{- include \"hedera-mirror.labels\" . | nindent 4 }}\n+  name: {{ printf \"%s-timescaledb-init-job\" .Release.Name }}\n+  namespace: {{ include \"hedera-mirror.namespace\" . }}\n+  annotations:\n+    \"helm.sh/hook-delete-policy\": hook-succeeded\n+spec:\n+  backoffLimit: 4\n+  template:\n+    spec:\n+      containers:\n+        - name: init-mirrornode-db\n+          image: timescaledev/timescaledb-ha:pg12-ts2.0.0-rc3\n+          command:\n+            - sh\n+            - -c\n+            - |\n+              set -e\n+\n+              while ! pg_isready -U postgres -h {{ printf \"%s-timescaledb-data\" .Release.Name }}; do sleep 1; done;\n+              psql --echo-queries -d \"${ACCESS_SVC_CONNSTR_POSTGRES}\" --set ON_ERROR_STOP=1 -f ${DB_INIT_FILE}\n+          env:\n+            - name: ACCESS_SVC_CONNSTR_POSTGRES\n+              value: host=mirror-timescaledb user=postgres connect_timeout=3 sslmode=disable password={{ .Values.timescaledb.credentials.accessNode.superuser }}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njg5MjUzOQ=="}, "originalCommit": {"oid": "05d6ccfdc0a361280e620f90ac50ea2f9c4f2258"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQzODM4NzY2OnYy", "diffSide": "RIGHT", "path": "charts/hedera-mirror/templates/job-timescaledb-init.yaml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQxOTozODoyN1rOIJjtkg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQwMjo1NzozOFrOIJspHg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njg5MzIwMg==", "bodyText": "if timescale enabled", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r546893202", "createdAt": "2020-12-21T19:38:27Z", "author": {"login": "steven-sheehy"}, "path": "charts/hedera-mirror/templates/job-timescaledb-init.yaml", "diffHunk": "@@ -0,0 +1,39 @@\n+apiVersion: batch/v1", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "05d6ccfdc0a361280e620f90ac50ea2f9c4f2258"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzAzOTUxOA==", "bodyText": "Added", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r547039518", "createdAt": "2020-12-22T02:57:38Z", "author": {"login": "Nana-EC"}, "path": "charts/hedera-mirror/templates/job-timescaledb-init.yaml", "diffHunk": "@@ -0,0 +1,39 @@\n+apiVersion: batch/v1", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njg5MzIwMg=="}, "originalCommit": {"oid": "05d6ccfdc0a361280e620f90ac50ea2f9c4f2258"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQzODM5MTU2OnYy", "diffSide": "RIGHT", "path": "charts/hedera-mirror/templates/secret-timescaledb.yaml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQxOTozOTo0N1rOIJjvyg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQwMjo1Nzo0N1rOIJspPA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njg5Mzc3MA==", "bodyText": "Some variable names all lower, some camel case. Would be good to standardize on camel case.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r546893770", "createdAt": "2020-12-21T19:39:47Z", "author": {"login": "steven-sheehy"}, "path": "charts/hedera-mirror/templates/secret-timescaledb.yaml", "diffHunk": "@@ -0,0 +1,30 @@\n+{{- if .Values.timescaledb.enabled -}}\n+apiVersion: v1\n+kind: Secret\n+metadata:\n+  labels:\n+    {{- include \"hedera-mirror.labels\" . | nindent 4 }}\n+  name: {{ printf \"%s-timescaledb-init\" .Release.Name  }}\n+  namespace: {{ include \"hedera-mirror.namespace\" . }}\n+type: Opaque\n+stringData:\n+  init.sql: |-\n+    {{- $dbname := .Values.importer.config.hedera.mirror.importer.db.name }}\n+    {{- $importeruser := .Values.importer.config.hedera.mirror.importer.db.username }}\n+    {{- $importerpassword := .Values.importer.config.hedera.mirror.importer.db.password }}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "05d6ccfdc0a361280e620f90ac50ea2f9c4f2258"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzAzOTU0OA==", "bodyText": "Standardized", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r547039548", "createdAt": "2020-12-22T02:57:47Z", "author": {"login": "Nana-EC"}, "path": "charts/hedera-mirror/templates/secret-timescaledb.yaml", "diffHunk": "@@ -0,0 +1,30 @@\n+{{- if .Values.timescaledb.enabled -}}\n+apiVersion: v1\n+kind: Secret\n+metadata:\n+  labels:\n+    {{- include \"hedera-mirror.labels\" . | nindent 4 }}\n+  name: {{ printf \"%s-timescaledb-init\" .Release.Name  }}\n+  namespace: {{ include \"hedera-mirror.namespace\" . }}\n+type: Opaque\n+stringData:\n+  init.sql: |-\n+    {{- $dbname := .Values.importer.config.hedera.mirror.importer.db.name }}\n+    {{- $importeruser := .Values.importer.config.hedera.mirror.importer.db.username }}\n+    {{- $importerpassword := .Values.importer.config.hedera.mirror.importer.db.password }}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njg5Mzc3MA=="}, "originalCommit": {"oid": "05d6ccfdc0a361280e620f90ac50ea2f9c4f2258"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQzODQxMDkyOnYy", "diffSide": "RIGHT", "path": "charts/README.md", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQxOTo0NjoyMlrOIJj7AQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQwMjo1Nzo1NVrOIJspYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njg5NjY0MQ==", "bodyText": "This section would make more sense in the configuration section above instead of a random separate section. So you'd have sections that look like:\n\nInstall\nConfigure\n\nTimescaleDB\nCustom address book\n\n\nTesting", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r546896641", "createdAt": "2020-12-21T19:46:22Z", "author": {"login": "steven-sheehy"}, "path": "charts/README.md", "diffHunk": "@@ -64,13 +97,31 @@ To remove all the Kubernetes components associated with the chart and delete the\n \n ```shell script\n $ helm delete \"${RELEASE}\"\n+$ kubectl delete $(kubectl get pvc -l release=\"${RELEASE}\" -o name)\n+$ kubectl delete pvc data-\"${RELEASE}\"-importer-0\n ```\n \n-The above command does not delete any of the underlying persistent volumes. To delete all the data associated with this release:\n+## Install (TimescaleDB, mirror db v2 schema)\n+In an effort to increase performance and ingestion the v2 db schema of the mirror node will utilize [TimescaleDB](https://docs.timescale.com/latest/main) to take on a more time series aligned approach.\n \n-```shell script\n-$ kubectl delete $(kubectl get pvc -o name)\n-```\n+To deploy the mirror chart using TimescaleDB instead of PostgreSQL take the following steps\n+1. Set the following config values in `values.yaml` as noted below", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "05d6ccfdc0a361280e620f90ac50ea2f9c4f2258"}, "originalPosition": 64}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzAzOTU4NQ==", "bodyText": "Reorganized", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r547039585", "createdAt": "2020-12-22T02:57:55Z", "author": {"login": "Nana-EC"}, "path": "charts/README.md", "diffHunk": "@@ -64,13 +97,31 @@ To remove all the Kubernetes components associated with the chart and delete the\n \n ```shell script\n $ helm delete \"${RELEASE}\"\n+$ kubectl delete $(kubectl get pvc -l release=\"${RELEASE}\" -o name)\n+$ kubectl delete pvc data-\"${RELEASE}\"-importer-0\n ```\n \n-The above command does not delete any of the underlying persistent volumes. To delete all the data associated with this release:\n+## Install (TimescaleDB, mirror db v2 schema)\n+In an effort to increase performance and ingestion the v2 db schema of the mirror node will utilize [TimescaleDB](https://docs.timescale.com/latest/main) to take on a more time series aligned approach.\n \n-```shell script\n-$ kubectl delete $(kubectl get pvc -o name)\n-```\n+To deploy the mirror chart using TimescaleDB instead of PostgreSQL take the following steps\n+1. Set the following config values in `values.yaml` as noted below", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njg5NjY0MQ=="}, "originalCommit": {"oid": "05d6ccfdc0a361280e620f90ac50ea2f9c4f2258"}, "originalPosition": 64}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQzODQyMTExOnYy", "diffSide": "LEFT", "path": "charts/README.md", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQxOTo0ODo1M1rOIJkBzg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQwMjo1ODowNVrOIJspqg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njg5ODM4Mg==", "bodyText": "We should keep the delete chart separate from the delete data like it was. Deleting the chart is recoverable but deleting the data is not and we should warn users sufficiently about the seriousness of the action.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r546898382", "createdAt": "2020-12-21T19:48:53Z", "author": {"login": "steven-sheehy"}, "path": "charts/README.md", "diffHunk": "@@ -64,13 +97,31 @@ To remove all the Kubernetes components associated with the chart and delete the\n \n ```shell script\n $ helm delete \"${RELEASE}\"\n+$ kubectl delete $(kubectl get pvc -l release=\"${RELEASE}\" -o name)\n+$ kubectl delete pvc data-\"${RELEASE}\"-importer-0\n ```\n \n-The above command does not delete any of the underlying persistent volumes. To delete all the data associated with this release:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "05d6ccfdc0a361280e620f90ac50ea2f9c4f2258"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzAzOTY1OA==", "bodyText": "Separated", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r547039658", "createdAt": "2020-12-22T02:58:05Z", "author": {"login": "Nana-EC"}, "path": "charts/README.md", "diffHunk": "@@ -64,13 +97,31 @@ To remove all the Kubernetes components associated with the chart and delete the\n \n ```shell script\n $ helm delete \"${RELEASE}\"\n+$ kubectl delete $(kubectl get pvc -l release=\"${RELEASE}\" -o name)\n+$ kubectl delete pvc data-\"${RELEASE}\"-importer-0\n ```\n \n-The above command does not delete any of the underlying persistent volumes. To delete all the data associated with this release:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njg5ODM4Mg=="}, "originalCommit": {"oid": "05d6ccfdc0a361280e620f90ac50ea2f9c4f2258"}, "originalPosition": 56}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQzODQzMDUwOnYy", "diffSide": "RIGHT", "path": "charts/README.md", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQxOTo1MjoyOFrOIJkHrw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQwMjo1ODoxNVrOIJsp7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njg5OTg4Nw==", "bodyText": "I take that back, release is not a standard label applied to all kubernetes objects, hence why you're having to add an explicit delete for the importer pvc. I think the original kubectl delete $(kubectl get pvc -o name) would be simpler and more future-proof.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r546899887", "createdAt": "2020-12-21T19:52:28Z", "author": {"login": "steven-sheehy"}, "path": "charts/README.md", "diffHunk": "@@ -64,13 +97,31 @@ To remove all the Kubernetes components associated with the chart and delete the\n \n ```shell script\n $ helm delete \"${RELEASE}\"\n+$ kubectl delete $(kubectl get pvc -l release=\"${RELEASE}\" -o name)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "05d6ccfdc0a361280e620f90ac50ea2f9c4f2258"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzAzOTcyNw==", "bodyText": "Good catch, updated", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r547039727", "createdAt": "2020-12-22T02:58:15Z", "author": {"login": "Nana-EC"}, "path": "charts/README.md", "diffHunk": "@@ -64,13 +97,31 @@ To remove all the Kubernetes components associated with the chart and delete the\n \n ```shell script\n $ helm delete \"${RELEASE}\"\n+$ kubectl delete $(kubectl get pvc -l release=\"${RELEASE}\" -o name)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njg5OTg4Nw=="}, "originalCommit": {"oid": "05d6ccfdc0a361280e620f90ac50ea2f9c4f2258"}, "originalPosition": 52}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQzODQ0MjM5OnYy", "diffSide": "RIGHT", "path": "charts/hedera-mirror/templates/secret-timescaledb.yaml", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQxOTo1Njo0NlrOIJkO6g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQwMjo1ODo0NFrOIJsqUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjkwMTczOA==", "bodyText": "Does this job run on every helm release? If so, this init.sql needs to be made safe to be re-ran multiple times by adding if not exists or other mechanisms to keep it from failing on subsequent executions.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r546901738", "createdAt": "2020-12-21T19:56:46Z", "author": {"login": "steven-sheehy"}, "path": "charts/hedera-mirror/templates/secret-timescaledb.yaml", "diffHunk": "@@ -0,0 +1,30 @@\n+{{- if .Values.timescaledb.enabled -}}\n+apiVersion: v1\n+kind: Secret\n+metadata:\n+  labels:\n+    {{- include \"hedera-mirror.labels\" . | nindent 4 }}\n+  name: {{ printf \"%s-timescaledb-init\" .Release.Name  }}\n+  namespace: {{ include \"hedera-mirror.namespace\" . }}\n+type: Opaque\n+stringData:\n+  init.sql: |-\n+    {{- $dbname := .Values.importer.config.hedera.mirror.importer.db.name }}\n+    {{- $importeruser := .Values.importer.config.hedera.mirror.importer.db.username }}\n+    {{- $importerpassword := .Values.importer.config.hedera.mirror.importer.db.password }}\n+    {{- $grpcUsername := .Values.grpc.config.hedera.mirror.grpc.db.username }}\n+    {{- $grpcPassword := .Values.grpc.config.hedera.mirror.grpc.db.password }}\n+    {{- $restuser := .Values.global.rest.username }}\n+    {{- $restpassword := .Values.global.rest.password }}\n+    create database {{ $dbname }};", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "05d6ccfdc0a361280e620f90ac50ea2f9c4f2258"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzAyNjMzOA==", "bodyText": "No, it runs once. The job won't run again after it's completed unless it's deleted and another release is pushed", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r547026338", "createdAt": "2020-12-22T02:07:48Z", "author": {"login": "Nana-EC"}, "path": "charts/hedera-mirror/templates/secret-timescaledb.yaml", "diffHunk": "@@ -0,0 +1,30 @@\n+{{- if .Values.timescaledb.enabled -}}\n+apiVersion: v1\n+kind: Secret\n+metadata:\n+  labels:\n+    {{- include \"hedera-mirror.labels\" . | nindent 4 }}\n+  name: {{ printf \"%s-timescaledb-init\" .Release.Name  }}\n+  namespace: {{ include \"hedera-mirror.namespace\" . }}\n+type: Opaque\n+stringData:\n+  init.sql: |-\n+    {{- $dbname := .Values.importer.config.hedera.mirror.importer.db.name }}\n+    {{- $importeruser := .Values.importer.config.hedera.mirror.importer.db.username }}\n+    {{- $importerpassword := .Values.importer.config.hedera.mirror.importer.db.password }}\n+    {{- $grpcUsername := .Values.grpc.config.hedera.mirror.grpc.db.username }}\n+    {{- $grpcPassword := .Values.grpc.config.hedera.mirror.grpc.db.password }}\n+    {{- $restuser := .Values.global.rest.username }}\n+    {{- $restpassword := .Values.global.rest.password }}\n+    create database {{ $dbname }};", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjkwMTczOA=="}, "originalCommit": {"oid": "05d6ccfdc0a361280e620f90ac50ea2f9c4f2258"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzAzNjc3OQ==", "bodyText": "I think adding a post-install hook should work. That should ensure 1. it runs after resources are created, 2. It runs only on install", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r547036779", "createdAt": "2020-12-22T02:47:16Z", "author": {"login": "Nana-EC"}, "path": "charts/hedera-mirror/templates/secret-timescaledb.yaml", "diffHunk": "@@ -0,0 +1,30 @@\n+{{- if .Values.timescaledb.enabled -}}\n+apiVersion: v1\n+kind: Secret\n+metadata:\n+  labels:\n+    {{- include \"hedera-mirror.labels\" . | nindent 4 }}\n+  name: {{ printf \"%s-timescaledb-init\" .Release.Name  }}\n+  namespace: {{ include \"hedera-mirror.namespace\" . }}\n+type: Opaque\n+stringData:\n+  init.sql: |-\n+    {{- $dbname := .Values.importer.config.hedera.mirror.importer.db.name }}\n+    {{- $importeruser := .Values.importer.config.hedera.mirror.importer.db.username }}\n+    {{- $importerpassword := .Values.importer.config.hedera.mirror.importer.db.password }}\n+    {{- $grpcUsername := .Values.grpc.config.hedera.mirror.grpc.db.username }}\n+    {{- $grpcPassword := .Values.grpc.config.hedera.mirror.grpc.db.password }}\n+    {{- $restuser := .Values.global.rest.username }}\n+    {{- $restpassword := .Values.global.rest.password }}\n+    create database {{ $dbname }};", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjkwMTczOA=="}, "originalCommit": {"oid": "05d6ccfdc0a361280e620f90ac50ea2f9c4f2258"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzAzOTgyNg==", "bodyText": "Added post-install and verified upgrades don't call the job again", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r547039826", "createdAt": "2020-12-22T02:58:44Z", "author": {"login": "Nana-EC"}, "path": "charts/hedera-mirror/templates/secret-timescaledb.yaml", "diffHunk": "@@ -0,0 +1,30 @@\n+{{- if .Values.timescaledb.enabled -}}\n+apiVersion: v1\n+kind: Secret\n+metadata:\n+  labels:\n+    {{- include \"hedera-mirror.labels\" . | nindent 4 }}\n+  name: {{ printf \"%s-timescaledb-init\" .Release.Name  }}\n+  namespace: {{ include \"hedera-mirror.namespace\" . }}\n+type: Opaque\n+stringData:\n+  init.sql: |-\n+    {{- $dbname := .Values.importer.config.hedera.mirror.importer.db.name }}\n+    {{- $importeruser := .Values.importer.config.hedera.mirror.importer.db.username }}\n+    {{- $importerpassword := .Values.importer.config.hedera.mirror.importer.db.password }}\n+    {{- $grpcUsername := .Values.grpc.config.hedera.mirror.grpc.db.username }}\n+    {{- $grpcPassword := .Values.grpc.config.hedera.mirror.grpc.db.password }}\n+    {{- $restuser := .Values.global.rest.username }}\n+    {{- $restpassword := .Values.global.rest.password }}\n+    create database {{ $dbname }};", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjkwMTczOA=="}, "originalCommit": {"oid": "05d6ccfdc0a361280e620f90ac50ea2f9c4f2258"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQzODg3Nzc1OnYy", "diffSide": "RIGHT", "path": "charts/README.md", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQyMjo0NToyM1rOIJoMuQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQwMjo1OTowNFrOIJsqug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njk2NjcxMw==", "bodyText": "this block failed to render properly, you can check it out by \"View file\", guess it's caused by the leading spaces.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r546966713", "createdAt": "2020-12-21T22:45:23Z", "author": {"login": "xin-hedera"}, "path": "charts/README.md", "diffHunk": "@@ -22,10 +22,43 @@ export RELEASE=\"mirror1\"\n \n To install the wrapper chart:\n \n-```shell script\n-$ helm repo add hedera https://hashgraph.github.io/hedera-mirror-node/charts\n-$ helm upgrade --install \"${RELEASE}\" hedera/hedera-mirror\n-```\n+    ```shell script\n+    $ helm repo add hedera https://hashgraph.github.io/hedera-mirror-node/charts\n+    $ helm upgrade --install \"${RELEASE}\" hedera/hedera-mirror\n+    ```", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "05d6ccfdc0a361280e620f90ac50ea2f9c4f2258"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzAzOTkzMA==", "bodyText": "Fixed", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r547039930", "createdAt": "2020-12-22T02:59:04Z", "author": {"login": "Nana-EC"}, "path": "charts/README.md", "diffHunk": "@@ -22,10 +22,43 @@ export RELEASE=\"mirror1\"\n \n To install the wrapper chart:\n \n-```shell script\n-$ helm repo add hedera https://hashgraph.github.io/hedera-mirror-node/charts\n-$ helm upgrade --install \"${RELEASE}\" hedera/hedera-mirror\n-```\n+    ```shell script\n+    $ helm repo add hedera https://hashgraph.github.io/hedera-mirror-node/charts\n+    $ helm upgrade --install \"${RELEASE}\" hedera/hedera-mirror\n+    ```", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njk2NjcxMw=="}, "originalCommit": {"oid": "05d6ccfdc0a361280e620f90ac50ea2f9c4f2258"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQzODkyMDY4OnYy", "diffSide": "RIGHT", "path": "charts/hedera-mirror/values.yaml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQyMjo1OTozMFrOIJomAA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQwMjo1ODo1OFrOIJsqmQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njk3MzE4NA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  cpu: 2Gi\n          \n          \n            \n                  cpu: 2", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r546973184", "createdAt": "2020-12-21T22:59:30Z", "author": {"login": "xin-hedera"}, "path": "charts/hedera-mirror/values.yaml", "diffHunk": "@@ -169,3 +177,30 @@ redis:\n \n rest:\n   enabled: true\n+\n+timescaledb:\n+  credentials:\n+    accessNode:\n+      superuser: mirror_node_pass\n+    dataNode:\n+      superuser: mirror_node_pass\n+  enabled: false\n+  persistentVolume:\n+    size: 500Gi\n+  resources:\n+    limits:\n+      cpu: 2Gi", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "05d6ccfdc0a361280e620f90ac50ea2f9c4f2258"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzAzOTg5Nw==", "bodyText": "Updated", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r547039897", "createdAt": "2020-12-22T02:58:58Z", "author": {"login": "Nana-EC"}, "path": "charts/hedera-mirror/values.yaml", "diffHunk": "@@ -169,3 +177,30 @@ redis:\n \n rest:\n   enabled: true\n+\n+timescaledb:\n+  credentials:\n+    accessNode:\n+      superuser: mirror_node_pass\n+    dataNode:\n+      superuser: mirror_node_pass\n+  enabled: false\n+  persistentVolume:\n+    size: 500Gi\n+  resources:\n+    limits:\n+      cpu: 2Gi", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njk3MzE4NA=="}, "originalCommit": {"oid": "05d6ccfdc0a361280e620f90ac50ea2f9c4f2258"}, "originalPosition": 40}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ0MTYyNTgzOnYy", "diffSide": "RIGHT", "path": "charts/hedera-mirror/templates/secret-timescaledb.yaml", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQxNjoyODoxM1rOIKBF7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQxNjoyODoxM1rOIKBF7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzM3NDU3NQ==", "bodyText": "alter default privileges in schema public grant select on tables to viewer;", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r547374575", "createdAt": "2020-12-22T16:28:13Z", "author": {"login": "steven-sheehy"}, "path": "charts/hedera-mirror/templates/secret-timescaledb.yaml", "diffHunk": "@@ -0,0 +1,30 @@\n+{{- if .Values.timescaledb.enabled -}}\n+apiVersion: v1\n+kind: Secret\n+metadata:\n+  labels:\n+    {{- include \"hedera-mirror.labels\" . | nindent 4 }}\n+  name: {{ printf \"%s-timescaledb-init\" .Release.Name  }}\n+  namespace: {{ include \"hedera-mirror.namespace\" . }}\n+type: Opaque\n+stringData:\n+  init.sql: |-\n+    {{- $dbName := .Values.importer.config.hedera.mirror.importer.db.name }}\n+    {{- $importerUser := .Values.importer.config.hedera.mirror.importer.db.username }}\n+    {{- $importerPassword := .Values.importer.config.hedera.mirror.importer.db.password }}\n+    {{- $grpcUsername := .Values.grpc.config.hedera.mirror.grpc.db.username }}\n+    {{- $grpcPassword := .Values.grpc.config.hedera.mirror.grpc.db.password }}\n+    {{- $restUser := .Values.global.rest.username }}\n+    {{- $restPassword := .Values.global.rest.password }}\n+    create database {{ $dbName }};\n+    \\c {{ $dbName }};\n+    create extension if not exists timescaledb cascade;\n+    create user {{ $importerUser }} with login password '{{ $importerPassword }}';\n+    create role viewer;\n+    create user {{ $grpcUsername }} with login password '{{ $grpcPassword }}' in role viewer;\n+    create user {{ $restUser }} with login password '{{ $restPassword }}' in role viewer;\n+    grant select on all tables in schema public to {{ $importerUser }};\n+    grant select on all tables in schema public to viewer;\n+    alter default privileges for role {{ $importerUser }} in schema public grant select on tables to viewer;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4cd0162c9a19eb2f8491b77b6cc2531b7e294b89"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ0MTY0NDgzOnYy", "diffSide": "RIGHT", "path": "charts/hedera-mirror/templates/secret-timescaledb.yaml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQxNjozNDoyM1rOIKBR-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQxODowMjozNlrOIKD8ww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzM3NzY1OQ==", "bodyText": "This does not create a read only user. Because the viewer role inherits from public, he has permissions to create objects. This is also why it works without grant connect currently.\nWe need to revisit these permissions completely. We should revoke all permissions from public first. Then we should create readonly and readwrite roles then assign those to users appropriately. Maybe we can do this in a follow up.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r547377659", "createdAt": "2020-12-22T16:34:23Z", "author": {"login": "steven-sheehy"}, "path": "charts/hedera-mirror/templates/secret-timescaledb.yaml", "diffHunk": "@@ -0,0 +1,30 @@\n+{{- if .Values.timescaledb.enabled -}}\n+apiVersion: v1\n+kind: Secret\n+metadata:\n+  labels:\n+    {{- include \"hedera-mirror.labels\" . | nindent 4 }}\n+  name: {{ printf \"%s-timescaledb-init\" .Release.Name  }}\n+  namespace: {{ include \"hedera-mirror.namespace\" . }}\n+type: Opaque\n+stringData:\n+  init.sql: |-\n+    {{- $dbName := .Values.importer.config.hedera.mirror.importer.db.name }}\n+    {{- $importerUser := .Values.importer.config.hedera.mirror.importer.db.username }}\n+    {{- $importerPassword := .Values.importer.config.hedera.mirror.importer.db.password }}\n+    {{- $grpcUsername := .Values.grpc.config.hedera.mirror.grpc.db.username }}\n+    {{- $grpcPassword := .Values.grpc.config.hedera.mirror.grpc.db.password }}\n+    {{- $restUser := .Values.global.rest.username }}\n+    {{- $restPassword := .Values.global.rest.password }}\n+    create database {{ $dbName }};\n+    \\c {{ $dbName }};\n+    create extension if not exists timescaledb cascade;\n+    create user {{ $importerUser }} with login password '{{ $importerPassword }}';\n+    create role viewer;\n+    create user {{ $grpcUsername }} with login password '{{ $grpcPassword }}' in role viewer;\n+    create user {{ $restUser }} with login password '{{ $restPassword }}' in role viewer;\n+    grant select on all tables in schema public to {{ $importerUser }};\n+    grant select on all tables in schema public to viewer;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4cd0162c9a19eb2f8491b77b6cc2531b7e294b89"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzQyMTM3OQ==", "bodyText": "I'm my next PR, I'm creating the tables in a new schema.\nI can open a ticket to focus on fixing the privileges for the users outside of these PR.\nThese will also be easier to confirm as they'll follow or be in conjunction with testing.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r547421379", "createdAt": "2020-12-22T18:02:36Z", "author": {"login": "Nana-EC"}, "path": "charts/hedera-mirror/templates/secret-timescaledb.yaml", "diffHunk": "@@ -0,0 +1,30 @@\n+{{- if .Values.timescaledb.enabled -}}\n+apiVersion: v1\n+kind: Secret\n+metadata:\n+  labels:\n+    {{- include \"hedera-mirror.labels\" . | nindent 4 }}\n+  name: {{ printf \"%s-timescaledb-init\" .Release.Name  }}\n+  namespace: {{ include \"hedera-mirror.namespace\" . }}\n+type: Opaque\n+stringData:\n+  init.sql: |-\n+    {{- $dbName := .Values.importer.config.hedera.mirror.importer.db.name }}\n+    {{- $importerUser := .Values.importer.config.hedera.mirror.importer.db.username }}\n+    {{- $importerPassword := .Values.importer.config.hedera.mirror.importer.db.password }}\n+    {{- $grpcUsername := .Values.grpc.config.hedera.mirror.grpc.db.username }}\n+    {{- $grpcPassword := .Values.grpc.config.hedera.mirror.grpc.db.password }}\n+    {{- $restUser := .Values.global.rest.username }}\n+    {{- $restPassword := .Values.global.rest.password }}\n+    create database {{ $dbName }};\n+    \\c {{ $dbName }};\n+    create extension if not exists timescaledb cascade;\n+    create user {{ $importerUser }} with login password '{{ $importerPassword }}';\n+    create role viewer;\n+    create user {{ $grpcUsername }} with login password '{{ $grpcPassword }}' in role viewer;\n+    create user {{ $restUser }} with login password '{{ $restPassword }}' in role viewer;\n+    grant select on all tables in schema public to {{ $importerUser }};\n+    grant select on all tables in schema public to viewer;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzM3NzY1OQ=="}, "originalCommit": {"oid": "4cd0162c9a19eb2f8491b77b6cc2531b7e294b89"}, "originalPosition": 27}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1344, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}