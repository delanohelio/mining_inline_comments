{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM5NzM5NjAw", "number": 1359, "title": "TimescaleDB: Helm", "bodyText": "Detailed description:\nTo utilize timescale in our helm chart the chart needs to be updated\n\nAdd TimeScaleDB v2 multimode chart to mirror chart dependencies.\nConfigure timescaledb default values in chart values.yml\nUpdate chart values.yml with address book filepath\nUpdated importer StatefulSet to pull in the address book secret and add the addressbook.bin to filesystem\nAdd necessary configmaps and secrets to support db init\n\nWhich issue(s) this PR fixes:\nFixes #1313\nSpecial notes for your reviewer:\nChecklist\n\n Documentation added\n Tests updated", "createdAt": "2020-12-14T19:13:23Z", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359", "merged": true, "mergeCommit": {"oid": "11ae2e9754f200cb53469c6d6364cd66ba10960f"}, "closed": true, "closedAt": "2020-12-22T19:06:21Z", "author": {"login": "Nana-EC"}, "timelineItems": {"totalCount": 49, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdmLCTrAFqTU1MTgyNzM4OA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdovVCDgFqTU1NzMwMDc4OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUxODI3Mzg4", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#pullrequestreview-551827388", "createdAt": "2020-12-14T19:33:40Z", "commit": {"oid": "2e362275c44942a3e932cce1cc440f1374a058b9"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQxOTozMzo0MFrOIFjDgw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQxOTozNDo0NVrOIFjIOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjY4ODEzMQ==", "bodyText": "Hmm, should I move this into the importer chart as a property?", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r542688131", "createdAt": "2020-12-14T19:33:40Z", "author": {"login": "Nana-EC"}, "path": "charts/hedera-mirror/values.yaml", "diffHunk": "@@ -15,6 +15,8 @@ global:\n     username: mirror_api\n     password: mirror_api_pass\n   useReleaseForNameLabel: false  # Set the name label to the release name for Marketplace\n+  extaddressbook:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2e362275c44942a3e932cce1cc440f1374a058b9"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjY4OTMzNw==", "bodyText": "Might remove timescaledb.postgresql.databases to ensure that all db and user creation logic is done in some script", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r542689337", "createdAt": "2020-12-14T19:34:45Z", "author": {"login": "Nana-EC"}, "path": "charts/hedera-mirror/values.yaml", "diffHunk": "@@ -169,3 +171,19 @@ redis:\n \n rest:\n   enabled: true\n+\n+timescaledb:\n+  credentials:\n+    accessNode:\n+      superuser: mirror_node_pass\n+    dataNode:\n+      superuser: mirror_node_pass\n+  enabled: false\n+  persistentVolume:\n+    size: 10Gi\n+  #  postgresql:\n+  #    databases: [\"postgres\", \"mirror_node\"]", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2e362275c44942a3e932cce1cc440f1374a058b9"}, "originalPosition": 33}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUxODg0OTEy", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#pullrequestreview-551884912", "createdAt": "2020-12-14T20:55:18Z", "commit": {"oid": "2e362275c44942a3e932cce1cc440f1374a058b9"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQyMDo1NToxOFrOIFoUxw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQyMTowOTo1NVrOIFpSJw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjc3NDQ3MQ==", "bodyText": "This should be a lot higher. We have 500Gi for postgresql", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r542774471", "createdAt": "2020-12-14T20:55:18Z", "author": {"login": "steven-sheehy"}, "path": "charts/hedera-mirror/values.yaml", "diffHunk": "@@ -169,3 +171,19 @@ redis:\n \n rest:\n   enabled: true\n+\n+timescaledb:\n+  credentials:\n+    accessNode:\n+      superuser: mirror_node_pass\n+    dataNode:\n+      superuser: mirror_node_pass\n+  enabled: false\n+  persistentVolume:\n+    size: 10Gi", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2e362275c44942a3e932cce1cc440f1374a058b9"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjc3NTEyMw==", "bodyText": "You should research and specify resource constraints as we do for every other dependency.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r542775123", "createdAt": "2020-12-14T20:55:56Z", "author": {"login": "steven-sheehy"}, "path": "charts/hedera-mirror/values.yaml", "diffHunk": "@@ -169,3 +171,19 @@ redis:\n \n rest:\n   enabled: true\n+\n+timescaledb:\n+  credentials:\n+    accessNode:\n+      superuser: mirror_node_pass\n+    dataNode:\n+      superuser: mirror_node_pass\n+  enabled: false", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2e362275c44942a3e932cce1cc440f1374a058b9"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjc3NTcxMA==", "bodyText": "Why would we not want timescaledb to have its own service account?", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r542775710", "createdAt": "2020-12-14T20:56:26Z", "author": {"login": "steven-sheehy"}, "path": "charts/hedera-mirror/values.yaml", "diffHunk": "@@ -169,3 +171,19 @@ redis:\n \n rest:\n   enabled: true\n+\n+timescaledb:\n+  credentials:\n+    accessNode:\n+      superuser: mirror_node_pass\n+    dataNode:\n+      superuser: mirror_node_pass\n+  enabled: false\n+  persistentVolume:\n+    size: 10Gi\n+  #  postgresql:\n+  #    databases: [\"postgres\", \"mirror_node\"]\n+  serviceAccount:\n+    create: false", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2e362275c44942a3e932cce1cc440f1374a058b9"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjc3NzkyOA==", "bodyText": "Revert indentation breakage", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r542777928", "createdAt": "2020-12-14T20:58:29Z", "author": {"login": "steven-sheehy"}, "path": "charts/hedera-mirror-importer/templates/statefulset.yaml", "diffHunk": "@@ -79,13 +79,19 @@ spec:\n         {{- toYaml .Values.tolerations | nindent 8 }}\n       volumes:\n         - name: config\n-          secret:\n+          projected:\n             defaultMode: 420\n-            secretName: {{ include \"hedera-mirror-importer.fullname\" . }}\n-{{- if not .Values.persistence.enabled }}\n-        - name: data\n-          emptyDir: {}\n-{{- else }}\n+            sources:\n+              - secret:\n+                  name: {{ include \"hedera-mirror-importer.fullname\" . }}\n+              {{- if .Values.global.extaddressbook.enabled }}\n+              - secret:\n+                  name: mirror-importer-addressbook\n+              {{- end}}\n+  {{- if not .Values.persistence.enabled }}\n+  - name: data", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2e362275c44942a3e932cce1cc440f1374a058b9"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjc4MDk1MQ==", "bodyText": "What is it? How is it used? What's an ext?", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r542780951", "createdAt": "2020-12-14T21:01:13Z", "author": {"login": "steven-sheehy"}, "path": "charts/hedera-mirror/values.yaml", "diffHunk": "@@ -15,6 +15,8 @@ global:\n     username: mirror_api\n     password: mirror_api_pass\n   useReleaseForNameLabel: false  # Set the name label to the release name for Marketplace\n+  extaddressbook:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjY4ODEzMQ=="}, "originalCommit": {"oid": "2e362275c44942a3e932cce1cc440f1374a058b9"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjc5MDE4Mw==", "bodyText": "Chart mentions some values are not production ready and should be tweaked. We should tweak:\nhttps://github.com/timescale/timescaledb-kubernetes/blob/abec6247e78b685d4dc075ed877ba02d0eac72f8/charts/timescaledb-multinode/values.yaml#L72", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r542790183", "createdAt": "2020-12-14T21:09:55Z", "author": {"login": "steven-sheehy"}, "path": "charts/hedera-mirror/values.yaml", "diffHunk": "@@ -169,3 +171,19 @@ redis:\n \n rest:\n   enabled: true\n+\n+timescaledb:\n+  credentials:\n+    accessNode:\n+      superuser: mirror_node_pass\n+    dataNode:\n+      superuser: mirror_node_pass\n+  enabled: false\n+  persistentVolume:\n+    size: 10Gi\n+  #  postgresql:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2e362275c44942a3e932cce1cc440f1374a058b9"}, "originalPosition": 32}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUxOTE0NDY5", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#pullrequestreview-551914469", "createdAt": "2020-12-14T21:38:23Z", "commit": {"oid": "2e362275c44942a3e932cce1cc440f1374a058b9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQyMTozODoyNFrOIFrJ9w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQyMTozODoyNFrOIFrJ9w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjgyMDg1NQ==", "bodyText": "suggestion: it's good to have a comment in importer charts values about explicit addressbook file name if network is OTHER", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r542820855", "createdAt": "2020-12-14T21:38:24Z", "author": {"login": "xin-hedera"}, "path": "charts/hedera-mirror-importer/templates/statefulset.yaml", "diffHunk": "@@ -79,13 +79,19 @@ spec:\n         {{- toYaml .Values.tolerations | nindent 8 }}\n       volumes:\n         - name: config\n-          secret:\n+          projected:\n             defaultMode: 420\n-            secretName: {{ include \"hedera-mirror-importer.fullname\" . }}\n-{{- if not .Values.persistence.enabled }}\n-        - name: data\n-          emptyDir: {}\n-{{- else }}\n+            sources:\n+              - secret:\n+                  name: {{ include \"hedera-mirror-importer.fullname\" . }}\n+              {{- if .Values.global.extaddressbook.enabled }}\n+              - secret:\n+                  name: mirror-importer-addressbook", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2e362275c44942a3e932cce1cc440f1374a058b9"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUzMDUzODY1", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#pullrequestreview-553053865", "createdAt": "2020-12-15T23:06:03Z", "commit": {"oid": "5f8b4703067cb81e2f9e45683b9cdc432d63c99d"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQyMzowNjowM1rOIGkAXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQyMzo1MTo0OFrOIGlOTQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mzc1MjI4NQ==", "bodyText": "But available memory is max 1Gi per your resource constraints. This looks like it is requesting more than is available.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r543752285", "createdAt": "2020-12-15T23:06:03Z", "author": {"login": "steven-sheehy"}, "path": "charts/hedera-mirror/values.yaml", "diffHunk": "@@ -169,3 +169,33 @@ redis:\n \n rest:\n   enabled: true\n+\n+timescaledb:\n+  credentials:\n+    accessNode:\n+      superuser: mirror_node_pass\n+    dataNode:\n+      superuser: mirror_node_pass\n+  enabled: false\n+  persistentVolume:\n+    size: 500Gi\n+  resources:\n+    limits:\n+      cpu: 1500m\n+      memory: 1000Mi\n+    requests:\n+      cpu: 250m\n+      memory: 500Mi\n+  postgresql:\n+    databases:\n+      - postgres\n+    parameters:\n+      max_wal_size: 8GB  # recommended to be 80% of the Volume Size\n+      min_wal_size: 2GB  # 80% of the WAL Volume Size\n+      shared_buffers: 2GB # recommended to be 25% of available instance memory", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5f8b4703067cb81e2f9e45683b9cdc432d63c99d"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mzc1MjQ3OA==", "bodyText": "nit: This indentation doesn't match its corresponding if/else", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r543752478", "createdAt": "2020-12-15T23:06:28Z", "author": {"login": "steven-sheehy"}, "path": "charts/hedera-mirror-importer/templates/statefulset.yaml", "diffHunk": "@@ -98,4 +104,4 @@ spec:\n         {{- if .Values.persistence.storageClass }}\n         storageClassName: \"{{ .Values.persistence.storageClass }}\"\n         {{- end }}\n-{{- end }}\n+  {{- end }}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5f8b4703067cb81e2f9e45683b9cdc432d63c99d"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mzc2NTUxOQ==", "bodyText": "This doesn't really add the OTHER address book as it still requires you to add a secret manually external to this chart AND configure the path via the values.yaml. I also don't think it's necessary to complicate the config volume by mixing it with the address book. There is a better option:\nAdd extraVolumes and extraVolumeMounts as a lot of charts do to add arbitrary secrets, configmaps, etc. to the chart via values.yaml. Then the user would populate the initialAddressBook via the standard config property. The benefit of this approach is pretty widely used by community charts and it is generic and can support adding any arbitrary data in the future that we or users may need.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r543765519", "createdAt": "2020-12-15T23:36:09Z", "author": {"login": "steven-sheehy"}, "path": "charts/hedera-mirror-importer/templates/statefulset.yaml", "diffHunk": "@@ -79,13 +79,19 @@ spec:\n         {{- toYaml .Values.tolerations | nindent 8 }}\n       volumes:\n         - name: config\n-          secret:\n+          projected:\n             defaultMode: 420\n-            secretName: {{ include \"hedera-mirror-importer.fullname\" . }}\n-{{- if not .Values.persistence.enabled }}\n+            sources:\n+              - secret:\n+                  name: {{ include \"hedera-mirror-importer.fullname\" . }}\n+              {{- if .Values.initialAddressBook.enabled }}\n+              - secret:\n+                  name: mirror-importer-addressbook # if enabled add filesystem path to initial address book for OTHER networks", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5f8b4703067cb81e2f9e45683b9cdc432d63c99d"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mzc3MjIzNw==", "bodyText": "I don't see how there could've been a name conflict unless a prior install didn't get deleted properly. Hardcoding the name actually makes it more likely there will be a resource name conflict as it doesn't include the namespace or release name in the name this way.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r543772237", "createdAt": "2020-12-15T23:51:48Z", "author": {"login": "steven-sheehy"}, "path": "charts/hedera-mirror/values.yaml", "diffHunk": "@@ -169,3 +171,19 @@ redis:\n \n rest:\n   enabled: true\n+\n+timescaledb:\n+  credentials:\n+    accessNode:\n+      superuser: mirror_node_pass\n+    dataNode:\n+      superuser: mirror_node_pass\n+  enabled: false\n+  persistentVolume:\n+    size: 10Gi\n+  #  postgresql:\n+  #    databases: [\"postgres\", \"mirror_node\"]\n+  serviceAccount:\n+    create: false", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mjc3NTcxMA=="}, "originalCommit": {"oid": "2e362275c44942a3e932cce1cc440f1374a058b9"}, "originalPosition": 35}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU0MTMzODQ4", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#pullrequestreview-554133848", "createdAt": "2020-12-16T22:24:24Z", "commit": {"oid": "eee7f65b34cdc872ad59e1f08f22e2e8e2baba47"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 19, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQyMjoyNDoyNFrOIHbz6Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQyMzowMDowNVrOIHc8qQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY2NjYwMQ==", "bodyText": "We should use the same image to connect as a client as we do for the TimescaleDB server. It also has psql in it.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r544666601", "createdAt": "2020-12-16T22:24:24Z", "author": {"login": "steven-sheehy"}, "path": "charts/hedera-mirror/templates/job-timescaledb-init.yaml", "diffHunk": "@@ -0,0 +1,92 @@\n+apiVersion: batch/v1\n+kind: Job\n+metadata:\n+  labels:\n+    {{- include \"hedera-mirror.labels\" . | nindent 4 }}\n+  name: {{ printf \"%s-timescaledb-init-job\" .Release.Name }}\n+  namespace: {{ include \"hedera-mirror.namespace\" . }}\n+  annotations:\n+    \"helm.sh/hook-delete-policy\": hook-succeeded\n+spec:\n+  backoffLimit: 4\n+  template:\n+    spec:\n+      containers:\n+        - name: init-mirrornode-db\n+          image: postgres:11-alpine", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eee7f65b34cdc872ad59e1f08f22e2e8e2baba47"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY2Nzc2MA==", "bodyText": "Should set -o errexit -o pipefail", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r544667760", "createdAt": "2020-12-16T22:26:35Z", "author": {"login": "steven-sheehy"}, "path": "charts/hedera-mirror/templates/job-timescaledb-init.yaml", "diffHunk": "@@ -0,0 +1,92 @@\n+apiVersion: batch/v1\n+kind: Job\n+metadata:\n+  labels:\n+    {{- include \"hedera-mirror.labels\" . | nindent 4 }}\n+  name: {{ printf \"%s-timescaledb-init-job\" .Release.Name }}\n+  namespace: {{ include \"hedera-mirror.namespace\" . }}\n+  annotations:\n+    \"helm.sh/hook-delete-policy\": hook-succeeded\n+spec:\n+  backoffLimit: 4\n+  template:\n+    spec:\n+      containers:\n+        - name: init-mirrornode-db\n+          image: postgres:11-alpine\n+          command:\n+            - sh\n+            - -c\n+            - >", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eee7f65b34cdc872ad59e1f08f22e2e8e2baba47"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY2OTA4Mw==", "bodyText": "This assumes the release name is mirror. Need to substitute the actual release name to work in our dev, for example.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r544669083", "createdAt": "2020-12-16T22:29:07Z", "author": {"login": "steven-sheehy"}, "path": "charts/hedera-mirror/templates/job-timescaledb-init.yaml", "diffHunk": "@@ -0,0 +1,92 @@\n+apiVersion: batch/v1\n+kind: Job\n+metadata:\n+  labels:\n+    {{- include \"hedera-mirror.labels\" . | nindent 4 }}\n+  name: {{ printf \"%s-timescaledb-init-job\" .Release.Name }}\n+  namespace: {{ include \"hedera-mirror.namespace\" . }}\n+  annotations:\n+    \"helm.sh/hook-delete-policy\": hook-succeeded\n+spec:\n+  backoffLimit: 4\n+  template:\n+    spec:\n+      containers:\n+        - name: init-mirrornode-db\n+          image: postgres:11-alpine\n+          command:\n+            - sh\n+            - -c\n+            - >\n+              while ! pg_isready -U postgres -h mirror-timescaledb-data; do sleep 1; done;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eee7f65b34cdc872ad59e1f08f22e2e8e2baba47"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY3MTYwMA==", "bodyText": "Bad practice to store SQL in environment variables and it's more secure to store passwords in secrets and mount them as files. For this reason, we should create a init.sql secret and mount it as a volume to the job and execute that. It's also cleaner since you can just use helm to inject the values directly to the secret and not have an additional variable mapping. Similar to how we do this in secret-postgresql.yaml.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r544671600", "createdAt": "2020-12-16T22:33:43Z", "author": {"login": "steven-sheehy"}, "path": "charts/hedera-mirror/templates/job-timescaledb-init.yaml", "diffHunk": "@@ -0,0 +1,92 @@\n+apiVersion: batch/v1\n+kind: Job\n+metadata:\n+  labels:\n+    {{- include \"hedera-mirror.labels\" . | nindent 4 }}\n+  name: {{ printf \"%s-timescaledb-init-job\" .Release.Name }}\n+  namespace: {{ include \"hedera-mirror.namespace\" . }}\n+  annotations:\n+    \"helm.sh/hook-delete-policy\": hook-succeeded\n+spec:\n+  backoffLimit: 4\n+  template:\n+    spec:\n+      containers:\n+        - name: init-mirrornode-db\n+          image: postgres:11-alpine\n+          command:\n+            - sh\n+            - -c\n+            - >\n+              while ! pg_isready -U postgres -h mirror-timescaledb-data; do sleep 1; done;\n+              echo \"${CREATE_USER_DB_SQL_COMMAND}\" | psql --file=- --echo-queries -d \"${ACCESS_SVC_CONNSTR_POSTGRES}\" \\\n+                  --set ON_ERROR_STOP=1 \\\n+                  --set dbname=\"${DBNAME}\" \\\n+                  --set dbuser=\"${DBUSER}\" \\\n+                  --set dbpassword=\"${DBUSERPASSWORD}\"\n+              echo \"${CREATE_API_USERS_SQL_COMMAND}\" | psql --file=- --echo-queries -d \"${ACCESS_SVC_CONNSTR_MAIN_USER}\" \\\n+                  --set ON_ERROR_STOP=1 \\\n+                  --set grpcuser=\"${GRPCUSER}\" \\\n+                  --set grpcpassword=\"${GRPCUSERPASSWORD}\" \\\n+                  --set restuser=\"${RESTUSER}\" \\\n+                  --set restpassword=\"${RESTPASSWORD}\"\n+          env:\n+            - name: DBNAME\n+              value: {{ .Values.importer.config.hedera.mirror.importer.db.name | quote }}\n+            - name: DBUSER\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: dbuser\n+            - name: DBUSERPASSWORD\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: dbpassword\n+            - name: GRPCUSER\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: grpcuser\n+            - name: GRPCUSERPASSWORD\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: grpcpassword\n+            - name: RESTUSER\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: restuser\n+            - name: RESTPASSWORD\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: restpassword\n+            - name: ACCESS_SVC_CONNSTR_POSTGRES\n+              value: host=mirror-timescaledb user=postgres connect_timeout=3 sslmode=disable password={{ .Values.timescaledb.credentials.accessNode.superuser }}\n+            - name: ACCESS_SVC_CONNSTR_MAIN_USER\n+              value: host=mirror-timescaledb user={{ .Values.importer.config.hedera.mirror.importer.db.username }} connect_timeout=3 sslmode=disable password={{ .Values.importer.config.hedera.mirror.importer.db.password }}\n+            - name: CREATE_USER_DB_SQL_COMMAND\n+              value: |\n+                SELECT format('CREATE DATABASE %I', :'dbname')", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eee7f65b34cdc872ad59e1f08f22e2e8e2baba47"}, "originalPosition": 72}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY3MTg3MQ==", "bodyText": "Shouldn't the timescale specific postgres image already do this?", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r544671871", "createdAt": "2020-12-16T22:34:15Z", "author": {"login": "steven-sheehy"}, "path": "charts/hedera-mirror/templates/job-timescaledb-init.yaml", "diffHunk": "@@ -0,0 +1,92 @@\n+apiVersion: batch/v1\n+kind: Job\n+metadata:\n+  labels:\n+    {{- include \"hedera-mirror.labels\" . | nindent 4 }}\n+  name: {{ printf \"%s-timescaledb-init-job\" .Release.Name }}\n+  namespace: {{ include \"hedera-mirror.namespace\" . }}\n+  annotations:\n+    \"helm.sh/hook-delete-policy\": hook-succeeded\n+spec:\n+  backoffLimit: 4\n+  template:\n+    spec:\n+      containers:\n+        - name: init-mirrornode-db\n+          image: postgres:11-alpine\n+          command:\n+            - sh\n+            - -c\n+            - >\n+              while ! pg_isready -U postgres -h mirror-timescaledb-data; do sleep 1; done;\n+              echo \"${CREATE_USER_DB_SQL_COMMAND}\" | psql --file=- --echo-queries -d \"${ACCESS_SVC_CONNSTR_POSTGRES}\" \\\n+                  --set ON_ERROR_STOP=1 \\\n+                  --set dbname=\"${DBNAME}\" \\\n+                  --set dbuser=\"${DBUSER}\" \\\n+                  --set dbpassword=\"${DBUSERPASSWORD}\"\n+              echo \"${CREATE_API_USERS_SQL_COMMAND}\" | psql --file=- --echo-queries -d \"${ACCESS_SVC_CONNSTR_MAIN_USER}\" \\\n+                  --set ON_ERROR_STOP=1 \\\n+                  --set grpcuser=\"${GRPCUSER}\" \\\n+                  --set grpcpassword=\"${GRPCUSERPASSWORD}\" \\\n+                  --set restuser=\"${RESTUSER}\" \\\n+                  --set restpassword=\"${RESTPASSWORD}\"\n+          env:\n+            - name: DBNAME\n+              value: {{ .Values.importer.config.hedera.mirror.importer.db.name | quote }}\n+            - name: DBUSER\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: dbuser\n+            - name: DBUSERPASSWORD\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: dbpassword\n+            - name: GRPCUSER\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: grpcuser\n+            - name: GRPCUSERPASSWORD\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: grpcpassword\n+            - name: RESTUSER\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: restuser\n+            - name: RESTPASSWORD\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: restpassword\n+            - name: ACCESS_SVC_CONNSTR_POSTGRES\n+              value: host=mirror-timescaledb user=postgres connect_timeout=3 sslmode=disable password={{ .Values.timescaledb.credentials.accessNode.superuser }}\n+            - name: ACCESS_SVC_CONNSTR_MAIN_USER\n+              value: host=mirror-timescaledb user={{ .Values.importer.config.hedera.mirror.importer.db.username }} connect_timeout=3 sslmode=disable password={{ .Values.importer.config.hedera.mirror.importer.db.password }}\n+            - name: CREATE_USER_DB_SQL_COMMAND\n+              value: |\n+                SELECT format('CREATE DATABASE %I', :'dbname')\n+                WHERE NOT EXISTS (\n+                   SELECT\n+                     FROM pg_database\n+                    WHERE datname=:'dbname'\n+                )\n+                \\gexec\n+                create user :dbuser with createrole password :'dbpassword';\n+                alter user :dbuser with superuser;\n+            - name: CREATE_API_USERS_SQL_COMMAND\n+              value: |\n+                CREATE EXTENSION IF NOT EXISTS timescaledb;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eee7f65b34cdc872ad59e1f08f22e2e8e2baba47"}, "originalPosition": 83}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY3NDc0Mw==", "bodyText": "I thought we were going to switch away from using public as the schema?", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r544674743", "createdAt": "2020-12-16T22:39:36Z", "author": {"login": "steven-sheehy"}, "path": "charts/hedera-mirror/templates/job-timescaledb-init.yaml", "diffHunk": "@@ -0,0 +1,92 @@\n+apiVersion: batch/v1\n+kind: Job\n+metadata:\n+  labels:\n+    {{- include \"hedera-mirror.labels\" . | nindent 4 }}\n+  name: {{ printf \"%s-timescaledb-init-job\" .Release.Name }}\n+  namespace: {{ include \"hedera-mirror.namespace\" . }}\n+  annotations:\n+    \"helm.sh/hook-delete-policy\": hook-succeeded\n+spec:\n+  backoffLimit: 4\n+  template:\n+    spec:\n+      containers:\n+        - name: init-mirrornode-db\n+          image: postgres:11-alpine\n+          command:\n+            - sh\n+            - -c\n+            - >\n+              while ! pg_isready -U postgres -h mirror-timescaledb-data; do sleep 1; done;\n+              echo \"${CREATE_USER_DB_SQL_COMMAND}\" | psql --file=- --echo-queries -d \"${ACCESS_SVC_CONNSTR_POSTGRES}\" \\\n+                  --set ON_ERROR_STOP=1 \\\n+                  --set dbname=\"${DBNAME}\" \\\n+                  --set dbuser=\"${DBUSER}\" \\\n+                  --set dbpassword=\"${DBUSERPASSWORD}\"\n+              echo \"${CREATE_API_USERS_SQL_COMMAND}\" | psql --file=- --echo-queries -d \"${ACCESS_SVC_CONNSTR_MAIN_USER}\" \\\n+                  --set ON_ERROR_STOP=1 \\\n+                  --set grpcuser=\"${GRPCUSER}\" \\\n+                  --set grpcpassword=\"${GRPCUSERPASSWORD}\" \\\n+                  --set restuser=\"${RESTUSER}\" \\\n+                  --set restpassword=\"${RESTPASSWORD}\"\n+          env:\n+            - name: DBNAME\n+              value: {{ .Values.importer.config.hedera.mirror.importer.db.name | quote }}\n+            - name: DBUSER\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: dbuser\n+            - name: DBUSERPASSWORD\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: dbpassword\n+            - name: GRPCUSER\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: grpcuser\n+            - name: GRPCUSERPASSWORD\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: grpcpassword\n+            - name: RESTUSER\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: restuser\n+            - name: RESTPASSWORD\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: restpassword\n+            - name: ACCESS_SVC_CONNSTR_POSTGRES\n+              value: host=mirror-timescaledb user=postgres connect_timeout=3 sslmode=disable password={{ .Values.timescaledb.credentials.accessNode.superuser }}\n+            - name: ACCESS_SVC_CONNSTR_MAIN_USER\n+              value: host=mirror-timescaledb user={{ .Values.importer.config.hedera.mirror.importer.db.username }} connect_timeout=3 sslmode=disable password={{ .Values.importer.config.hedera.mirror.importer.db.password }}\n+            - name: CREATE_USER_DB_SQL_COMMAND\n+              value: |\n+                SELECT format('CREATE DATABASE %I', :'dbname')\n+                WHERE NOT EXISTS (\n+                   SELECT\n+                     FROM pg_database\n+                    WHERE datname=:'dbname'\n+                )\n+                \\gexec\n+                create user :dbuser with createrole password :'dbpassword';\n+                alter user :dbuser with superuser;\n+            - name: CREATE_API_USERS_SQL_COMMAND\n+              value: |\n+                CREATE EXTENSION IF NOT EXISTS timescaledb;\n+\n+                create user :grpcuser with login password :'grpcpassword';\n+                create user :restuser with login password :'restpassword';\n+                alter default privileges in schema public grant select on tables to :grpcuser;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eee7f65b34cdc872ad59e1f08f22e2e8e2baba47"}, "originalPosition": 87}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY3NjE4MA==", "bodyText": "Since we have a chance to do things over, we should fix the security mistake of allowing the importer user to create roles. We should reduce his permissions to just read/write of mirrornode database.\nAdditionally, this should be called importeruser not dbuser to make that clear it's not some admin user.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r544676180", "createdAt": "2020-12-16T22:42:12Z", "author": {"login": "steven-sheehy"}, "path": "charts/hedera-mirror/templates/job-timescaledb-init.yaml", "diffHunk": "@@ -0,0 +1,92 @@\n+apiVersion: batch/v1\n+kind: Job\n+metadata:\n+  labels:\n+    {{- include \"hedera-mirror.labels\" . | nindent 4 }}\n+  name: {{ printf \"%s-timescaledb-init-job\" .Release.Name }}\n+  namespace: {{ include \"hedera-mirror.namespace\" . }}\n+  annotations:\n+    \"helm.sh/hook-delete-policy\": hook-succeeded\n+spec:\n+  backoffLimit: 4\n+  template:\n+    spec:\n+      containers:\n+        - name: init-mirrornode-db\n+          image: postgres:11-alpine\n+          command:\n+            - sh\n+            - -c\n+            - >\n+              while ! pg_isready -U postgres -h mirror-timescaledb-data; do sleep 1; done;\n+              echo \"${CREATE_USER_DB_SQL_COMMAND}\" | psql --file=- --echo-queries -d \"${ACCESS_SVC_CONNSTR_POSTGRES}\" \\\n+                  --set ON_ERROR_STOP=1 \\\n+                  --set dbname=\"${DBNAME}\" \\\n+                  --set dbuser=\"${DBUSER}\" \\\n+                  --set dbpassword=\"${DBUSERPASSWORD}\"\n+              echo \"${CREATE_API_USERS_SQL_COMMAND}\" | psql --file=- --echo-queries -d \"${ACCESS_SVC_CONNSTR_MAIN_USER}\" \\\n+                  --set ON_ERROR_STOP=1 \\\n+                  --set grpcuser=\"${GRPCUSER}\" \\\n+                  --set grpcpassword=\"${GRPCUSERPASSWORD}\" \\\n+                  --set restuser=\"${RESTUSER}\" \\\n+                  --set restpassword=\"${RESTPASSWORD}\"\n+          env:\n+            - name: DBNAME\n+              value: {{ .Values.importer.config.hedera.mirror.importer.db.name | quote }}\n+            - name: DBUSER\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: dbuser\n+            - name: DBUSERPASSWORD\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: dbpassword\n+            - name: GRPCUSER\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: grpcuser\n+            - name: GRPCUSERPASSWORD\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: grpcpassword\n+            - name: RESTUSER\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: restuser\n+            - name: RESTPASSWORD\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: restpassword\n+            - name: ACCESS_SVC_CONNSTR_POSTGRES\n+              value: host=mirror-timescaledb user=postgres connect_timeout=3 sslmode=disable password={{ .Values.timescaledb.credentials.accessNode.superuser }}\n+            - name: ACCESS_SVC_CONNSTR_MAIN_USER\n+              value: host=mirror-timescaledb user={{ .Values.importer.config.hedera.mirror.importer.db.username }} connect_timeout=3 sslmode=disable password={{ .Values.importer.config.hedera.mirror.importer.db.password }}\n+            - name: CREATE_USER_DB_SQL_COMMAND\n+              value: |\n+                SELECT format('CREATE DATABASE %I', :'dbname')\n+                WHERE NOT EXISTS (\n+                   SELECT\n+                     FROM pg_database\n+                    WHERE datname=:'dbname'\n+                )\n+                \\gexec\n+                create user :dbuser with createrole password :'dbpassword';", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eee7f65b34cdc872ad59e1f08f22e2e8e2baba47"}, "originalPosition": 79}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY3NjgyMQ==", "bodyText": "Remove in favor of init.sql", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r544676821", "createdAt": "2020-12-16T22:43:32Z", "author": {"login": "steven-sheehy"}, "path": "charts/hedera-mirror/templates/secret-timescaledb.yaml", "diffHunk": "@@ -0,0 +1,17 @@\n+{{- if .Values.timescaledb.enabled -}}\n+apiVersion: v1\n+kind: Secret\n+metadata:\n+  labels:\n+    {{- include \"hedera-mirror.labels\" . | nindent 4 }}\n+  name: {{ printf \"%s-timescaledb-init\" .Release.Name  }}\n+  namespace: {{ include \"hedera-mirror.namespace\" . }}\n+type: Opaque\n+stringData:\n+  dbuser: \"{{ .Values.importer.config.hedera.mirror.importer.db.username }}\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eee7f65b34cdc872ad59e1f08f22e2e8e2baba47"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY3NzA4NA==", "bodyText": "Consider enabling pg_stat_statements if not enabled by default.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r544677084", "createdAt": "2020-12-16T22:44:03Z", "author": {"login": "steven-sheehy"}, "path": "charts/hedera-mirror/templates/job-timescaledb-init.yaml", "diffHunk": "@@ -0,0 +1,92 @@\n+apiVersion: batch/v1\n+kind: Job\n+metadata:\n+  labels:\n+    {{- include \"hedera-mirror.labels\" . | nindent 4 }}\n+  name: {{ printf \"%s-timescaledb-init-job\" .Release.Name }}\n+  namespace: {{ include \"hedera-mirror.namespace\" . }}\n+  annotations:\n+    \"helm.sh/hook-delete-policy\": hook-succeeded\n+spec:\n+  backoffLimit: 4\n+  template:\n+    spec:\n+      containers:\n+        - name: init-mirrornode-db\n+          image: postgres:11-alpine\n+          command:\n+            - sh\n+            - -c\n+            - >\n+              while ! pg_isready -U postgres -h mirror-timescaledb-data; do sleep 1; done;\n+              echo \"${CREATE_USER_DB_SQL_COMMAND}\" | psql --file=- --echo-queries -d \"${ACCESS_SVC_CONNSTR_POSTGRES}\" \\\n+                  --set ON_ERROR_STOP=1 \\\n+                  --set dbname=\"${DBNAME}\" \\\n+                  --set dbuser=\"${DBUSER}\" \\\n+                  --set dbpassword=\"${DBUSERPASSWORD}\"\n+              echo \"${CREATE_API_USERS_SQL_COMMAND}\" | psql --file=- --echo-queries -d \"${ACCESS_SVC_CONNSTR_MAIN_USER}\" \\\n+                  --set ON_ERROR_STOP=1 \\\n+                  --set grpcuser=\"${GRPCUSER}\" \\\n+                  --set grpcpassword=\"${GRPCUSERPASSWORD}\" \\\n+                  --set restuser=\"${RESTUSER}\" \\\n+                  --set restpassword=\"${RESTPASSWORD}\"\n+          env:\n+            - name: DBNAME\n+              value: {{ .Values.importer.config.hedera.mirror.importer.db.name | quote }}\n+            - name: DBUSER\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: dbuser\n+            - name: DBUSERPASSWORD\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: dbpassword\n+            - name: GRPCUSER\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: grpcuser\n+            - name: GRPCUSERPASSWORD\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: grpcpassword\n+            - name: RESTUSER\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: restuser\n+            - name: RESTPASSWORD\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: restpassword\n+            - name: ACCESS_SVC_CONNSTR_POSTGRES\n+              value: host=mirror-timescaledb user=postgres connect_timeout=3 sslmode=disable password={{ .Values.timescaledb.credentials.accessNode.superuser }}\n+            - name: ACCESS_SVC_CONNSTR_MAIN_USER\n+              value: host=mirror-timescaledb user={{ .Values.importer.config.hedera.mirror.importer.db.username }} connect_timeout=3 sslmode=disable password={{ .Values.importer.config.hedera.mirror.importer.db.password }}\n+            - name: CREATE_USER_DB_SQL_COMMAND\n+              value: |\n+                SELECT format('CREATE DATABASE %I', :'dbname')\n+                WHERE NOT EXISTS (\n+                   SELECT\n+                     FROM pg_database\n+                    WHERE datname=:'dbname'\n+                )\n+                \\gexec\n+                create user :dbuser with createrole password :'dbpassword';\n+                alter user :dbuser with superuser;\n+            - name: CREATE_API_USERS_SQL_COMMAND\n+              value: |\n+                CREATE EXTENSION IF NOT EXISTS timescaledb;\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eee7f65b34cdc872ad59e1f08f22e2e8e2baba47"}, "originalPosition": 84}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY3Nzk2OQ==", "bodyText": "Should consider create viewer role for reuse like in secret-postgresql.sql.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r544677969", "createdAt": "2020-12-16T22:45:48Z", "author": {"login": "steven-sheehy"}, "path": "charts/hedera-mirror/templates/job-timescaledb-init.yaml", "diffHunk": "@@ -0,0 +1,92 @@\n+apiVersion: batch/v1\n+kind: Job\n+metadata:\n+  labels:\n+    {{- include \"hedera-mirror.labels\" . | nindent 4 }}\n+  name: {{ printf \"%s-timescaledb-init-job\" .Release.Name }}\n+  namespace: {{ include \"hedera-mirror.namespace\" . }}\n+  annotations:\n+    \"helm.sh/hook-delete-policy\": hook-succeeded\n+spec:\n+  backoffLimit: 4\n+  template:\n+    spec:\n+      containers:\n+        - name: init-mirrornode-db\n+          image: postgres:11-alpine\n+          command:\n+            - sh\n+            - -c\n+            - >\n+              while ! pg_isready -U postgres -h mirror-timescaledb-data; do sleep 1; done;\n+              echo \"${CREATE_USER_DB_SQL_COMMAND}\" | psql --file=- --echo-queries -d \"${ACCESS_SVC_CONNSTR_POSTGRES}\" \\\n+                  --set ON_ERROR_STOP=1 \\\n+                  --set dbname=\"${DBNAME}\" \\\n+                  --set dbuser=\"${DBUSER}\" \\\n+                  --set dbpassword=\"${DBUSERPASSWORD}\"\n+              echo \"${CREATE_API_USERS_SQL_COMMAND}\" | psql --file=- --echo-queries -d \"${ACCESS_SVC_CONNSTR_MAIN_USER}\" \\\n+                  --set ON_ERROR_STOP=1 \\\n+                  --set grpcuser=\"${GRPCUSER}\" \\\n+                  --set grpcpassword=\"${GRPCUSERPASSWORD}\" \\\n+                  --set restuser=\"${RESTUSER}\" \\\n+                  --set restpassword=\"${RESTPASSWORD}\"\n+          env:\n+            - name: DBNAME\n+              value: {{ .Values.importer.config.hedera.mirror.importer.db.name | quote }}\n+            - name: DBUSER\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: dbuser\n+            - name: DBUSERPASSWORD\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: dbpassword\n+            - name: GRPCUSER\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: grpcuser\n+            - name: GRPCUSERPASSWORD\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: grpcpassword\n+            - name: RESTUSER\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: restuser\n+            - name: RESTPASSWORD\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: restpassword\n+            - name: ACCESS_SVC_CONNSTR_POSTGRES\n+              value: host=mirror-timescaledb user=postgres connect_timeout=3 sslmode=disable password={{ .Values.timescaledb.credentials.accessNode.superuser }}\n+            - name: ACCESS_SVC_CONNSTR_MAIN_USER\n+              value: host=mirror-timescaledb user={{ .Values.importer.config.hedera.mirror.importer.db.username }} connect_timeout=3 sslmode=disable password={{ .Values.importer.config.hedera.mirror.importer.db.password }}\n+            - name: CREATE_USER_DB_SQL_COMMAND\n+              value: |\n+                SELECT format('CREATE DATABASE %I', :'dbname')\n+                WHERE NOT EXISTS (\n+                   SELECT\n+                     FROM pg_database\n+                    WHERE datname=:'dbname'\n+                )\n+                \\gexec\n+                create user :dbuser with createrole password :'dbpassword';\n+                alter user :dbuser with superuser;\n+            - name: CREATE_API_USERS_SQL_COMMAND\n+              value: |\n+                CREATE EXTENSION IF NOT EXISTS timescaledb;\n+\n+                create user :grpcuser with login password :'grpcpassword';\n+                create user :restuser with login password :'restpassword';\n+                alter default privileges in schema public grant select on tables to :grpcuser;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eee7f65b34cdc872ad59e1f08f22e2e8e2baba47"}, "originalPosition": 87}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY3ODAwNQ==", "bodyText": "I think you're missing a grant connect.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r544678005", "createdAt": "2020-12-16T22:45:55Z", "author": {"login": "steven-sheehy"}, "path": "charts/hedera-mirror/templates/job-timescaledb-init.yaml", "diffHunk": "@@ -0,0 +1,92 @@\n+apiVersion: batch/v1\n+kind: Job\n+metadata:\n+  labels:\n+    {{- include \"hedera-mirror.labels\" . | nindent 4 }}\n+  name: {{ printf \"%s-timescaledb-init-job\" .Release.Name }}\n+  namespace: {{ include \"hedera-mirror.namespace\" . }}\n+  annotations:\n+    \"helm.sh/hook-delete-policy\": hook-succeeded\n+spec:\n+  backoffLimit: 4\n+  template:\n+    spec:\n+      containers:\n+        - name: init-mirrornode-db\n+          image: postgres:11-alpine\n+          command:\n+            - sh\n+            - -c\n+            - >\n+              while ! pg_isready -U postgres -h mirror-timescaledb-data; do sleep 1; done;\n+              echo \"${CREATE_USER_DB_SQL_COMMAND}\" | psql --file=- --echo-queries -d \"${ACCESS_SVC_CONNSTR_POSTGRES}\" \\\n+                  --set ON_ERROR_STOP=1 \\\n+                  --set dbname=\"${DBNAME}\" \\\n+                  --set dbuser=\"${DBUSER}\" \\\n+                  --set dbpassword=\"${DBUSERPASSWORD}\"\n+              echo \"${CREATE_API_USERS_SQL_COMMAND}\" | psql --file=- --echo-queries -d \"${ACCESS_SVC_CONNSTR_MAIN_USER}\" \\\n+                  --set ON_ERROR_STOP=1 \\\n+                  --set grpcuser=\"${GRPCUSER}\" \\\n+                  --set grpcpassword=\"${GRPCUSERPASSWORD}\" \\\n+                  --set restuser=\"${RESTUSER}\" \\\n+                  --set restpassword=\"${RESTPASSWORD}\"\n+          env:\n+            - name: DBNAME\n+              value: {{ .Values.importer.config.hedera.mirror.importer.db.name | quote }}\n+            - name: DBUSER\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: dbuser\n+            - name: DBUSERPASSWORD\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: dbpassword\n+            - name: GRPCUSER\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: grpcuser\n+            - name: GRPCUSERPASSWORD\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: grpcpassword\n+            - name: RESTUSER\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: restuser\n+            - name: RESTPASSWORD\n+              valueFrom:\n+                secretKeyRef:\n+                  name: {{ printf \"%s-timescaledb-init\" .Release.Name }}\n+                  key: restpassword\n+            - name: ACCESS_SVC_CONNSTR_POSTGRES\n+              value: host=mirror-timescaledb user=postgres connect_timeout=3 sslmode=disable password={{ .Values.timescaledb.credentials.accessNode.superuser }}\n+            - name: ACCESS_SVC_CONNSTR_MAIN_USER\n+              value: host=mirror-timescaledb user={{ .Values.importer.config.hedera.mirror.importer.db.username }} connect_timeout=3 sslmode=disable password={{ .Values.importer.config.hedera.mirror.importer.db.password }}\n+            - name: CREATE_USER_DB_SQL_COMMAND\n+              value: |\n+                SELECT format('CREATE DATABASE %I', :'dbname')\n+                WHERE NOT EXISTS (\n+                   SELECT\n+                     FROM pg_database\n+                    WHERE datname=:'dbname'\n+                )\n+                \\gexec\n+                create user :dbuser with createrole password :'dbpassword';\n+                alter user :dbuser with superuser;\n+            - name: CREATE_API_USERS_SQL_COMMAND\n+              value: |\n+                CREATE EXTENSION IF NOT EXISTS timescaledb;\n+\n+                create user :grpcuser with login password :'grpcpassword';", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eee7f65b34cdc872ad59e1f08f22e2e8e2baba47"}, "originalPosition": 85}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY3OTIzMA==", "bodyText": "All users should be created by superuser. All users should be created in mirrornode database.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r544679230", "createdAt": "2020-12-16T22:48:25Z", "author": {"login": "steven-sheehy"}, "path": "charts/hedera-mirror/templates/job-timescaledb-init.yaml", "diffHunk": "@@ -0,0 +1,92 @@\n+apiVersion: batch/v1\n+kind: Job\n+metadata:\n+  labels:\n+    {{- include \"hedera-mirror.labels\" . | nindent 4 }}\n+  name: {{ printf \"%s-timescaledb-init-job\" .Release.Name }}\n+  namespace: {{ include \"hedera-mirror.namespace\" . }}\n+  annotations:\n+    \"helm.sh/hook-delete-policy\": hook-succeeded\n+spec:\n+  backoffLimit: 4\n+  template:\n+    spec:\n+      containers:\n+        - name: init-mirrornode-db\n+          image: postgres:11-alpine\n+          command:\n+            - sh\n+            - -c\n+            - >\n+              while ! pg_isready -U postgres -h mirror-timescaledb-data; do sleep 1; done;\n+              echo \"${CREATE_USER_DB_SQL_COMMAND}\" | psql --file=- --echo-queries -d \"${ACCESS_SVC_CONNSTR_POSTGRES}\" \\\n+                  --set ON_ERROR_STOP=1 \\\n+                  --set dbname=\"${DBNAME}\" \\\n+                  --set dbuser=\"${DBUSER}\" \\\n+                  --set dbpassword=\"${DBUSERPASSWORD}\"\n+              echo \"${CREATE_API_USERS_SQL_COMMAND}\" | psql --file=- --echo-queries -d \"${ACCESS_SVC_CONNSTR_MAIN_USER}\" \\", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eee7f65b34cdc872ad59e1f08f22e2e8e2baba47"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY3OTgzNw==", "bodyText": "Use nindent", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r544679837", "createdAt": "2020-12-16T22:49:37Z", "author": {"login": "steven-sheehy"}, "path": "charts/hedera-mirror-importer/templates/statefulset.yaml", "diffHunk": "@@ -66,6 +66,9 @@ spec:\n               mountPath: /usr/etc/hedera-mirror-importer\n             - name: data\n               mountPath: /var/lib/hedera-mirror-importer\n+{{- if .Values.extraVolumeMounts }}\n+{{ toYaml .Values.extraVolumeMounts | indent 12 }}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eee7f65b34cdc872ad59e1f08f22e2e8e2baba47"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY4MDY0Ng==", "bodyText": "This change is unnecessary. Helm delete already deletes services and endpoints. This command is to cleanup things not deleted by Helm like PVCs. The -l release=\"${RELEASE}\" might be okay to keep if you see a benefit in that.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r544680646", "createdAt": "2020-12-16T22:51:18Z", "author": {"login": "steven-sheehy"}, "path": "charts/README.md", "diffHunk": "@@ -66,12 +106,40 @@ To remove all the Kubernetes components associated with the chart and delete the\n $ helm delete \"${RELEASE}\"\n ```\n \n+\n The above command does not delete any of the underlying persistent volumes. To delete all the data associated with this release:\n \n ```shell script\n-$ kubectl delete $(kubectl get pvc -o name)\n+$ kubectl delete $(kubectl get pvc, ep, service -l release=\"${RELEASE}\" -o name)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eee7f65b34cdc872ad59e1f08f22e2e8e2baba47"}, "originalPosition": 64}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY4MDY5OQ==", "bodyText": "Spurious newline", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r544680699", "createdAt": "2020-12-16T22:51:26Z", "author": {"login": "steven-sheehy"}, "path": "charts/README.md", "diffHunk": "@@ -66,12 +106,40 @@ To remove all the Kubernetes components associated with the chart and delete the\n $ helm delete \"${RELEASE}\"\n ```\n \n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "eee7f65b34cdc872ad59e1f08f22e2e8e2baba47"}, "originalPosition": 59}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY4MjcyNQ==", "bodyText": "This step is duplicated twice", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r544682725", "createdAt": "2020-12-16T22:55:17Z", "author": {"login": "steven-sheehy"}, "path": "charts/README.md", "diffHunk": "@@ -22,10 +22,50 @@ export RELEASE=\"mirror1\"\n \n To install the wrapper chart:\n \n-```shell script\n-$ helm repo add hedera https://hashgraph.github.io/hedera-mirror-node/charts\n-$ helm upgrade --install \"${RELEASE}\" hedera/hedera-mirror\n-```\n+1. Add the Hedera Mirror Node Repo\n+    ```shell script\n+    $ helm repo add hedera https://hashgraph.github.io/hedera-mirror-node/charts\n+    ```\n+\n+2. (Optional): Configure Network & AddressBook\n+    When running against a network other than the demo/testnent/mainnet network, the network must be updated and an initialAddressBook file must be provided.\n+\n+    e.g. To use an addressbook from a file located at `/Downloads/perf.bin`:\n+    First create the addressBook file as a secret from the local file:\n+    ```shell script\n+    $ kubectl create secret generic mirror-importer-addressbook --from-file=perf.bin=/Downloads/perf.bin --save-config=true\n+    ```\n+\n+    Then update the `values/yaml` file to set the `network`, `initialAddressBook`, `extraVolumes` and `extraVolumeMounts` configs.\n+    ```yaml\n+    importer:\n+      config:\n+        hedera:\n+          mirror:\n+            importer:\n+              initialAddressBook: \"/usr/etc/addressbook/perf.bin\"\n+              network: \"OTHER\"\n+      extraVolumes:\n+         - name: addressbook-secret-volume\n+           secret:\n+             defaultMode: 420\n+             secretName: mirror-importer-addressbook\n+      extraVolumeMounts:\n+         - name: addressbook-secret-volume\n+           mountPath: /usr/etc/addressbook\n+    ```\n+    > **_Note_** Ensure the configured `mountPath` matches the path in `initialAddressBook`\n+\n+    Then create the addressBook file as a secret from a local file e.g. `/Downloads/perf.bin`.\n+    ```shell script\n+    $ kubectl create secret generic mirror-importer-addressbook --from-file=perf.bin=/Downloads/perf.bin --save-config=true", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "753bfea9308fd242918b45042949012bee0c82cf"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY4NDExOA==", "bodyText": "Extra spacing under these extraVolumes and extraVolumeMounts. Not sure it causes rendering issues if copied.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r544684118", "createdAt": "2020-12-16T22:57:56Z", "author": {"login": "steven-sheehy"}, "path": "charts/README.md", "diffHunk": "@@ -22,10 +22,50 @@ export RELEASE=\"mirror1\"\n \n To install the wrapper chart:\n \n-```shell script\n-$ helm repo add hedera https://hashgraph.github.io/hedera-mirror-node/charts\n-$ helm upgrade --install \"${RELEASE}\" hedera/hedera-mirror\n-```\n+1. Add the Hedera Mirror Node Repo\n+    ```shell script\n+    $ helm repo add hedera https://hashgraph.github.io/hedera-mirror-node/charts\n+    ```\n+\n+2. (Optional): Configure Network & AddressBook\n+    When running against a network other than the demo/testnent/mainnet network, the network must be updated and an initialAddressBook file must be provided.\n+\n+    e.g. To use an addressbook from a file located at `/Downloads/perf.bin`:\n+    First create the addressBook file as a secret from the local file:\n+    ```shell script\n+    $ kubectl create secret generic mirror-importer-addressbook --from-file=perf.bin=/Downloads/perf.bin --save-config=true\n+    ```\n+\n+    Then update the `values/yaml` file to set the `network`, `initialAddressBook`, `extraVolumes` and `extraVolumeMounts` configs.\n+    ```yaml\n+    importer:\n+      config:\n+        hedera:\n+          mirror:\n+            importer:\n+              initialAddressBook: \"/usr/etc/addressbook/perf.bin\"\n+              network: \"OTHER\"\n+      extraVolumes:\n+         - name: addressbook-secret-volume", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "753bfea9308fd242918b45042949012bee0c82cf"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY4NDM1NQ==", "bodyText": "values.yaml", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r544684355", "createdAt": "2020-12-16T22:58:25Z", "author": {"login": "steven-sheehy"}, "path": "charts/README.md", "diffHunk": "@@ -22,10 +22,50 @@ export RELEASE=\"mirror1\"\n \n To install the wrapper chart:\n \n-```shell script\n-$ helm repo add hedera https://hashgraph.github.io/hedera-mirror-node/charts\n-$ helm upgrade --install \"${RELEASE}\" hedera/hedera-mirror\n-```\n+1. Add the Hedera Mirror Node Repo\n+    ```shell script\n+    $ helm repo add hedera https://hashgraph.github.io/hedera-mirror-node/charts\n+    ```\n+\n+2. (Optional): Configure Network & AddressBook\n+    When running against a network other than the demo/testnent/mainnet network, the network must be updated and an initialAddressBook file must be provided.\n+\n+    e.g. To use an addressbook from a file located at `/Downloads/perf.bin`:\n+    First create the addressBook file as a secret from the local file:\n+    ```shell script\n+    $ kubectl create secret generic mirror-importer-addressbook --from-file=perf.bin=/Downloads/perf.bin --save-config=true\n+    ```\n+\n+    Then update the `values/yaml` file to set the `network`, `initialAddressBook`, `extraVolumes` and `extraVolumeMounts` configs.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "753bfea9308fd242918b45042949012bee0c82cf"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY4NTIyNQ==", "bodyText": "I prefer the TLDR of the previous approach of repo add & install. There are hundreds of potential options to list in between repo add and install that we can't list all. Instead, I think we should add a separate configuration section with this address book information.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r544685225", "createdAt": "2020-12-16T23:00:05Z", "author": {"login": "steven-sheehy"}, "path": "charts/README.md", "diffHunk": "@@ -22,10 +22,50 @@ export RELEASE=\"mirror1\"\n \n To install the wrapper chart:\n \n-```shell script\n-$ helm repo add hedera https://hashgraph.github.io/hedera-mirror-node/charts\n-$ helm upgrade --install \"${RELEASE}\" hedera/hedera-mirror\n-```\n+1. Add the Hedera Mirror Node Repo\n+    ```shell script\n+    $ helm repo add hedera https://hashgraph.github.io/hedera-mirror-node/charts", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "753bfea9308fd242918b45042949012bee0c82cf"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU0Nzk1MTA2", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#pullrequestreview-554795106", "createdAt": "2020-12-17T16:52:56Z", "commit": {"oid": "753bfea9308fd242918b45042949012bee0c82cf"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QxNjo1Mjo1NlrOIH_B-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xN1QxODoyNTozNlrOIIC6lA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTI0MzY0MQ==", "bodyText": "add newline before this paragraph\ntypo testnent -> testnet\nprefer initial address book to initialAddressBook", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r545243641", "createdAt": "2020-12-17T16:52:56Z", "author": {"login": "xin-hedera"}, "path": "charts/README.md", "diffHunk": "@@ -22,10 +22,50 @@ export RELEASE=\"mirror1\"\n \n To install the wrapper chart:\n \n-```shell script\n-$ helm repo add hedera https://hashgraph.github.io/hedera-mirror-node/charts\n-$ helm upgrade --install \"${RELEASE}\" hedera/hedera-mirror\n-```\n+1. Add the Hedera Mirror Node Repo\n+    ```shell script\n+    $ helm repo add hedera https://hashgraph.github.io/hedera-mirror-node/charts\n+    ```\n+\n+2. (Optional): Configure Network & AddressBook\n+    When running against a network other than the demo/testnent/mainnet network, the network must be updated and an initialAddressBook file must be provided.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "753bfea9308fd242918b45042949012bee0c82cf"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTI0ODU5MA==", "bodyText": "better this way:\nThen create a local values.yaml file to ...", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r545248590", "createdAt": "2020-12-17T16:59:40Z", "author": {"login": "xin-hedera"}, "path": "charts/README.md", "diffHunk": "@@ -22,10 +22,50 @@ export RELEASE=\"mirror1\"\n \n To install the wrapper chart:\n \n-```shell script\n-$ helm repo add hedera https://hashgraph.github.io/hedera-mirror-node/charts\n-$ helm upgrade --install \"${RELEASE}\" hedera/hedera-mirror\n-```\n+1. Add the Hedera Mirror Node Repo\n+    ```shell script\n+    $ helm repo add hedera https://hashgraph.github.io/hedera-mirror-node/charts\n+    ```\n+\n+2. (Optional): Configure Network & AddressBook\n+    When running against a network other than the demo/testnent/mainnet network, the network must be updated and an initialAddressBook file must be provided.\n+\n+    e.g. To use an addressbook from a file located at `/Downloads/perf.bin`:\n+    First create the addressBook file as a secret from the local file:\n+    ```shell script\n+    $ kubectl create secret generic mirror-importer-addressbook --from-file=perf.bin=/Downloads/perf.bin --save-config=true\n+    ```\n+\n+    Then update the `values/yaml` file to set the `network`, `initialAddressBook`, `extraVolumes` and `extraVolumeMounts` configs.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "753bfea9308fd242918b45042949012bee0c82cf"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTMwNjYyMQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            {{ toYaml .Values.extraVolumeMounts | indent 12 }}\n          \n          \n            \n            {{- toYaml .Values.extraVolumeMounts | nindent 12 }}", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r545306621", "createdAt": "2020-12-17T18:24:33Z", "author": {"login": "xin-hedera"}, "path": "charts/hedera-mirror-importer/templates/statefulset.yaml", "diffHunk": "@@ -66,6 +66,9 @@ spec:\n               mountPath: /usr/etc/hedera-mirror-importer\n             - name: data\n               mountPath: /var/lib/hedera-mirror-importer\n+{{- if .Values.extraVolumeMounts }}\n+{{ toYaml .Values.extraVolumeMounts | indent 12 }}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "753bfea9308fd242918b45042949012bee0c82cf"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTMwNzI4NA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            {{- if .Values.extraVolumes }}\n          \n          \n            \n            {{ toYaml .Values.extraVolumes | nindent 8}}\n          \n          \n            \n            {{- end }}\n          \n          \n            \n            {{- if .Values.extraVolumes }}\n          \n          \n            \n            {{- toYaml .Values.extraVolumes | nindent 8 }}\n          \n          \n            \n            {{- end }}\n          \n      \n    \n    \n  \n\nalso this block is placed at the wrong place, should be before:\n{{- if not .Values.persistence.enabled }}", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r545307284", "createdAt": "2020-12-17T18:25:36Z", "author": {"login": "xin-hedera"}, "path": "charts/hedera-mirror-importer/templates/statefulset.yaml", "diffHunk": "@@ -86,6 +89,9 @@ spec:\n         - name: data\n           emptyDir: {}\n {{- else }}\n+{{- if .Values.extraVolumes }}\n+{{ toYaml .Values.extraVolumes | nindent 8}}\n+{{- end }}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "753bfea9308fd242918b45042949012bee0c82cf"}, "originalPosition": 16}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU2NjE3NTIw", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#pullrequestreview-556617520", "createdAt": "2020-12-21T19:36:54Z", "commit": {"oid": "05d6ccfdc0a361280e620f90ac50ea2f9c4f2258"}, "state": "COMMENTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQxOTozNjo1NFrOIJjq-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQxOTo1NDo1M1rOIJkLkg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njg5MjUzOQ==", "bodyText": "host needs to be templated with release name. Since it's used in multiple places, might be good to move to function in helpers", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r546892539", "createdAt": "2020-12-21T19:36:54Z", "author": {"login": "steven-sheehy"}, "path": "charts/hedera-mirror/templates/job-timescaledb-init.yaml", "diffHunk": "@@ -0,0 +1,39 @@\n+apiVersion: batch/v1\n+kind: Job\n+metadata:\n+  labels:\n+    {{- include \"hedera-mirror.labels\" . | nindent 4 }}\n+  name: {{ printf \"%s-timescaledb-init-job\" .Release.Name }}\n+  namespace: {{ include \"hedera-mirror.namespace\" . }}\n+  annotations:\n+    \"helm.sh/hook-delete-policy\": hook-succeeded\n+spec:\n+  backoffLimit: 4\n+  template:\n+    spec:\n+      containers:\n+        - name: init-mirrornode-db\n+          image: timescaledev/timescaledb-ha:pg12-ts2.0.0-rc3\n+          command:\n+            - sh\n+            - -c\n+            - |\n+              set -e\n+\n+              while ! pg_isready -U postgres -h {{ printf \"%s-timescaledb-data\" .Release.Name }}; do sleep 1; done;\n+              psql --echo-queries -d \"${ACCESS_SVC_CONNSTR_POSTGRES}\" --set ON_ERROR_STOP=1 -f ${DB_INIT_FILE}\n+          env:\n+            - name: ACCESS_SVC_CONNSTR_POSTGRES\n+              value: host=mirror-timescaledb user=postgres connect_timeout=3 sslmode=disable password={{ .Values.timescaledb.credentials.accessNode.superuser }}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "05d6ccfdc0a361280e620f90ac50ea2f9c4f2258"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njg5MzIwMg==", "bodyText": "if timescale enabled", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r546893202", "createdAt": "2020-12-21T19:38:27Z", "author": {"login": "steven-sheehy"}, "path": "charts/hedera-mirror/templates/job-timescaledb-init.yaml", "diffHunk": "@@ -0,0 +1,39 @@\n+apiVersion: batch/v1", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "05d6ccfdc0a361280e620f90ac50ea2f9c4f2258"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njg5Mzc3MA==", "bodyText": "Some variable names all lower, some camel case. Would be good to standardize on camel case.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r546893770", "createdAt": "2020-12-21T19:39:47Z", "author": {"login": "steven-sheehy"}, "path": "charts/hedera-mirror/templates/secret-timescaledb.yaml", "diffHunk": "@@ -0,0 +1,30 @@\n+{{- if .Values.timescaledb.enabled -}}\n+apiVersion: v1\n+kind: Secret\n+metadata:\n+  labels:\n+    {{- include \"hedera-mirror.labels\" . | nindent 4 }}\n+  name: {{ printf \"%s-timescaledb-init\" .Release.Name  }}\n+  namespace: {{ include \"hedera-mirror.namespace\" . }}\n+type: Opaque\n+stringData:\n+  init.sql: |-\n+    {{- $dbname := .Values.importer.config.hedera.mirror.importer.db.name }}\n+    {{- $importeruser := .Values.importer.config.hedera.mirror.importer.db.username }}\n+    {{- $importerpassword := .Values.importer.config.hedera.mirror.importer.db.password }}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "05d6ccfdc0a361280e620f90ac50ea2f9c4f2258"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njg5NjY0MQ==", "bodyText": "This section would make more sense in the configuration section above instead of a random separate section. So you'd have sections that look like:\n\nInstall\nConfigure\n\nTimescaleDB\nCustom address book\n\n\nTesting", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r546896641", "createdAt": "2020-12-21T19:46:22Z", "author": {"login": "steven-sheehy"}, "path": "charts/README.md", "diffHunk": "@@ -64,13 +97,31 @@ To remove all the Kubernetes components associated with the chart and delete the\n \n ```shell script\n $ helm delete \"${RELEASE}\"\n+$ kubectl delete $(kubectl get pvc -l release=\"${RELEASE}\" -o name)\n+$ kubectl delete pvc data-\"${RELEASE}\"-importer-0\n ```\n \n-The above command does not delete any of the underlying persistent volumes. To delete all the data associated with this release:\n+## Install (TimescaleDB, mirror db v2 schema)\n+In an effort to increase performance and ingestion the v2 db schema of the mirror node will utilize [TimescaleDB](https://docs.timescale.com/latest/main) to take on a more time series aligned approach.\n \n-```shell script\n-$ kubectl delete $(kubectl get pvc -o name)\n-```\n+To deploy the mirror chart using TimescaleDB instead of PostgreSQL take the following steps\n+1. Set the following config values in `values.yaml` as noted below", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "05d6ccfdc0a361280e620f90ac50ea2f9c4f2258"}, "originalPosition": 64}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njg5ODM4Mg==", "bodyText": "We should keep the delete chart separate from the delete data like it was. Deleting the chart is recoverable but deleting the data is not and we should warn users sufficiently about the seriousness of the action.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r546898382", "createdAt": "2020-12-21T19:48:53Z", "author": {"login": "steven-sheehy"}, "path": "charts/README.md", "diffHunk": "@@ -64,13 +97,31 @@ To remove all the Kubernetes components associated with the chart and delete the\n \n ```shell script\n $ helm delete \"${RELEASE}\"\n+$ kubectl delete $(kubectl get pvc -l release=\"${RELEASE}\" -o name)\n+$ kubectl delete pvc data-\"${RELEASE}\"-importer-0\n ```\n \n-The above command does not delete any of the underlying persistent volumes. To delete all the data associated with this release:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "05d6ccfdc0a361280e620f90ac50ea2f9c4f2258"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njg5OTg4Nw==", "bodyText": "I take that back, release is not a standard label applied to all kubernetes objects, hence why you're having to add an explicit delete for the importer pvc. I think the original kubectl delete $(kubectl get pvc -o name) would be simpler and more future-proof.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r546899887", "createdAt": "2020-12-21T19:52:28Z", "author": {"login": "steven-sheehy"}, "path": "charts/README.md", "diffHunk": "@@ -64,13 +97,31 @@ To remove all the Kubernetes components associated with the chart and delete the\n \n ```shell script\n $ helm delete \"${RELEASE}\"\n+$ kubectl delete $(kubectl get pvc -l release=\"${RELEASE}\" -o name)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "05d6ccfdc0a361280e620f90ac50ea2f9c4f2258"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjkwMDg4Mg==", "bodyText": "I think Xin is saying not to recommend users update the existing values.yaml but to create their own custom yaml file like custom.yaml. If so, I would agree with that.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r546900882", "createdAt": "2020-12-21T19:54:53Z", "author": {"login": "steven-sheehy"}, "path": "charts/README.md", "diffHunk": "@@ -22,10 +22,50 @@ export RELEASE=\"mirror1\"\n \n To install the wrapper chart:\n \n-```shell script\n-$ helm repo add hedera https://hashgraph.github.io/hedera-mirror-node/charts\n-$ helm upgrade --install \"${RELEASE}\" hedera/hedera-mirror\n-```\n+1. Add the Hedera Mirror Node Repo\n+    ```shell script\n+    $ helm repo add hedera https://hashgraph.github.io/hedera-mirror-node/charts\n+    ```\n+\n+2. (Optional): Configure Network & AddressBook\n+    When running against a network other than the demo/testnent/mainnet network, the network must be updated and an initialAddressBook file must be provided.\n+\n+    e.g. To use an addressbook from a file located at `/Downloads/perf.bin`:\n+    First create the addressBook file as a secret from the local file:\n+    ```shell script\n+    $ kubectl create secret generic mirror-importer-addressbook --from-file=perf.bin=/Downloads/perf.bin --save-config=true\n+    ```\n+\n+    Then update the `values/yaml` file to set the `network`, `initialAddressBook`, `extraVolumes` and `extraVolumeMounts` configs.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTI0ODU5MA=="}, "originalCommit": {"oid": "753bfea9308fd242918b45042949012bee0c82cf"}, "originalPosition": 22}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU2NjI4MzUz", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#pullrequestreview-556628353", "createdAt": "2020-12-21T19:56:46Z", "commit": {"oid": "05d6ccfdc0a361280e620f90ac50ea2f9c4f2258"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQxOTo1Njo0NlrOIJkO6g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQxOTo1Njo0NlrOIJkO6g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjkwMTczOA==", "bodyText": "Does this job run on every helm release? If so, this init.sql needs to be made safe to be re-ran multiple times by adding if not exists or other mechanisms to keep it from failing on subsequent executions.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r546901738", "createdAt": "2020-12-21T19:56:46Z", "author": {"login": "steven-sheehy"}, "path": "charts/hedera-mirror/templates/secret-timescaledb.yaml", "diffHunk": "@@ -0,0 +1,30 @@\n+{{- if .Values.timescaledb.enabled -}}\n+apiVersion: v1\n+kind: Secret\n+metadata:\n+  labels:\n+    {{- include \"hedera-mirror.labels\" . | nindent 4 }}\n+  name: {{ printf \"%s-timescaledb-init\" .Release.Name  }}\n+  namespace: {{ include \"hedera-mirror.namespace\" . }}\n+type: Opaque\n+stringData:\n+  init.sql: |-\n+    {{- $dbname := .Values.importer.config.hedera.mirror.importer.db.name }}\n+    {{- $importeruser := .Values.importer.config.hedera.mirror.importer.db.username }}\n+    {{- $importerpassword := .Values.importer.config.hedera.mirror.importer.db.password }}\n+    {{- $grpcUsername := .Values.grpc.config.hedera.mirror.grpc.db.username }}\n+    {{- $grpcPassword := .Values.grpc.config.hedera.mirror.grpc.db.password }}\n+    {{- $restuser := .Values.global.rest.username }}\n+    {{- $restpassword := .Values.global.rest.password }}\n+    create database {{ $dbname }};", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "05d6ccfdc0a361280e620f90ac50ea2f9c4f2258"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU2NzA5NTky", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#pullrequestreview-556709592", "createdAt": "2020-12-21T22:45:22Z", "commit": {"oid": "05d6ccfdc0a361280e620f90ac50ea2f9c4f2258"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQyMjo0NToyM1rOIJoMuQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMVQyMjo1OTozMFrOIJomAA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njk2NjcxMw==", "bodyText": "this block failed to render properly, you can check it out by \"View file\", guess it's caused by the leading spaces.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r546966713", "createdAt": "2020-12-21T22:45:23Z", "author": {"login": "xin-hedera"}, "path": "charts/README.md", "diffHunk": "@@ -22,10 +22,43 @@ export RELEASE=\"mirror1\"\n \n To install the wrapper chart:\n \n-```shell script\n-$ helm repo add hedera https://hashgraph.github.io/hedera-mirror-node/charts\n-$ helm upgrade --install \"${RELEASE}\" hedera/hedera-mirror\n-```\n+    ```shell script\n+    $ helm repo add hedera https://hashgraph.github.io/hedera-mirror-node/charts\n+    $ helm upgrade --install \"${RELEASE}\" hedera/hedera-mirror\n+    ```", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "05d6ccfdc0a361280e620f90ac50ea2f9c4f2258"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Njk3MzE4NA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  cpu: 2Gi\n          \n          \n            \n                  cpu: 2", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r546973184", "createdAt": "2020-12-21T22:59:30Z", "author": {"login": "xin-hedera"}, "path": "charts/hedera-mirror/values.yaml", "diffHunk": "@@ -169,3 +177,30 @@ redis:\n \n rest:\n   enabled: true\n+\n+timescaledb:\n+  credentials:\n+    accessNode:\n+      superuser: mirror_node_pass\n+    dataNode:\n+      superuser: mirror_node_pass\n+  enabled: false\n+  persistentVolume:\n+    size: 500Gi\n+  resources:\n+    limits:\n+      cpu: 2Gi", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "05d6ccfdc0a361280e620f90ac50ea2f9c4f2258"}, "originalPosition": 40}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3506b3b4cef79acc40c4c20c58fd17d314d50317", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/3506b3b4cef79acc40c4c20c58fd17d314d50317", "committedDate": "2020-12-22T03:00:41Z", "message": "Add v2 migrations flyway migrations for timescaledb\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ffcdcbe6d6aeb67e8ed64aa1b5c0ad165ca0540e", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/ffcdcbe6d6aeb67e8ed64aa1b5c0ad165ca0540e", "committedDate": "2020-12-22T03:00:41Z", "message": "Added test support to flip between v1 and v2 dbs\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a1d34baac11ed565271f266c5136a9f4a8366e7d", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/a1d34baac11ed565271f266c5136a9f4a8366e7d", "committedDate": "2020-12-22T03:00:42Z", "message": "Added config documentation and moved topicRunningHashV2AddedTimestamp config into FlywayConfiguration\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8af08e4be7b697949d75e62d1ae36ae0c044b921", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/8af08e4be7b697949d75e62d1ae36ae0c044b921", "committedDate": "2020-12-22T03:00:42Z", "message": "Utilize flyway migrations locations and fix grpc and rest tests to support timescaledb\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f736b1542d1e2ac19e6a395161356614d1b11b37", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/f736b1542d1e2ac19e6a395161356614d1b11b37", "committedDate": "2020-12-22T03:00:42Z", "message": "Add v2 directory of migrations and revert AbstractDownloaderTest change\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6ea70c7e5c4e9e5bb64c03fb265e7ce284f32f29", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/6ea70c7e5c4e9e5bb64c03fb265e7ce284f32f29", "committedDate": "2020-12-22T03:00:42Z", "message": "Updated config docs and removed FlywayProperties and updated locations\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "412a8435385fe1a441c6b8508eb02bac283f35aa", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/412a8435385fe1a441c6b8508eb02bac283f35aa", "committedDate": "2020-12-22T03:00:42Z", "message": "Revert config additions for simplicity\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5974f70e9ad6e40043f749760300227917d29ed1", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/5974f70e9ad6e40043f749760300227917d29ed1", "committedDate": "2020-12-22T03:00:42Z", "message": "Reverted db usernam config removal and updated circle config w flyway props\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db62f49fcc74f9c901460c91447536d33d48f46e", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/db62f49fcc74f9c901460c91447536d33d48f46e", "committedDate": "2020-12-22T03:00:42Z", "message": "Update v1 script location for grpc test in circle ci\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cf21c2b2a190fbc9f10c1d2a55c644f26b3a8089", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/cf21c2b2a190fbc9f10c1d2a55c644f26b3a8089", "committedDate": "2020-12-22T03:00:42Z", "message": "Address feedback on timesacle db init migrations regarding domains, placeholders and distributed hyper tables\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c9256d4df78b2f0fb0096a3520dca85445d15dc", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/5c9256d4df78b2f0fb0096a3520dca85445d15dc", "committedDate": "2020-12-22T03:00:42Z", "message": "Fix up constraints and add compression policy\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "44feed2641c90f0013f1b04e252175b139455058", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/44feed2641c90f0013f1b04e252175b139455058", "committedDate": "2020-12-22T03:00:42Z", "message": "Fix rest tests\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "acd86ea6c26cd07f1659c870eccaa38fc2ad06ac", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/acd86ea6c26cd07f1659c870eccaa38fc2ad06ac", "committedDate": "2020-12-22T03:00:42Z", "message": "Added compression for most tables\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5798fcc3acb82d4c4bedb134611770894124c3d3", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/5798fcc3acb82d4c4bedb134611770894124c3d3", "committedDate": "2020-12-22T03:00:42Z", "message": "CLeaned up configuration\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "40ec0d04c922a30247582839554795ef79f0df4a", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/40ec0d04c922a30247582839554795ef79f0df4a", "committedDate": "2020-12-22T03:00:42Z", "message": "Restore circle ci flyway locations config\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5124f62d97c7f07cdff8c66bfd57af52dfc05774", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/5124f62d97c7f07cdff8c66bfd57af52dfc05774", "committedDate": "2020-12-22T03:00:42Z", "message": "Removed V2_0_4__Address_Book and utility function\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "86f6e5d450aabd1a69d9bfb3c7805aff0c13bfdb", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/86f6e5d450aabd1a69d9bfb3c7805aff0c13bfdb", "committedDate": "2020-12-22T03:00:42Z", "message": "Try moving flyway locations to test bootstrap\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "295416d44b4e009703d89e5ba50de54cbd939fa7", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/295416d44b4e009703d89e5ba50de54cbd939fa7", "committedDate": "2020-12-22T03:00:42Z", "message": "Addressed feedback on compression and missing hyper tables\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f088fa14cb4418d64f6a37ad7767e54a3bb2416c", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/f088fa14cb4418d64f6a37ad7767e54a3bb2416c", "committedDate": "2020-12-22T03:00:43Z", "message": "Removed config repetition for flyway migrations\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f1faed07e2ddb1bc44d498fd6349186d1b5eb453", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/f1faed07e2ddb1bc44d498fd6349186d1b5eb453", "committedDate": "2020-12-22T03:00:43Z", "message": "Made address_book a hyper table and added compression\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2768c8d67955189da0fd7f18cf26405b7eef9ce7", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/2768c8d67955189da0fd7f18cf26405b7eef9ce7", "committedDate": "2020-12-22T03:00:43Z", "message": "Updated hyper table comments\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a7fb09f55649a6072c7662061e92d99c9dcda335", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/a7fb09f55649a6072c7662061e92d99c9dcda335", "committedDate": "2020-12-22T03:00:43Z", "message": "Utilize flyway migrations locations and fix grpc and rest tests to support timescaledb\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2825bec305d929a71ff7a00dff623edf5ce58cc2", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/2825bec305d929a71ff7a00dff623edf5ce58cc2", "committedDate": "2020-12-22T03:02:10Z", "message": "Added timescaledb v2 chart\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "79b2fecf24693e2556a5b25f0fa0e677d32a24e4", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/79b2fecf24693e2556a5b25f0fa0e677d32a24e4", "committedDate": "2020-12-22T03:02:10Z", "message": "Turn on monitor\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3cd9dcd84ccaa5c619d077c5506f33184f92cd9b", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/3cd9dcd84ccaa5c619d077c5506f33184f92cd9b", "committedDate": "2020-12-22T03:02:10Z", "message": "Increased postgres db size\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a906051681aab48f53d3e47ef8b1da58cea346be", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/a906051681aab48f53d3e47ef8b1da58cea346be", "committedDate": "2020-12-22T03:02:10Z", "message": "Removed v2 ref form values\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d5d7a3af2e2a12a2c1fec831d572bc9f33269b1a", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/d5d7a3af2e2a12a2c1fec831d572bc9f33269b1a", "committedDate": "2020-12-22T03:02:10Z", "message": "Fix merge conflicts\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7d47db8660a9197795ea590acc5f9e1acbce7ea1", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/7d47db8660a9197795ea590acc5f9e1acbce7ea1", "committedDate": "2020-12-22T03:02:10Z", "message": "Fix indents in compression migration\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b9d3e895e668e43045886dcb06c60c06b4a73ac6", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/b9d3e895e668e43045886dcb06c60c06b4a73ac6", "committedDate": "2020-12-22T03:02:30Z", "message": "Addressed feedback 1\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8df50746cb624687599bf54fbc0dfa52406c22cd", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/8df50746cb624687599bf54fbc0dfa52406c22cd", "committedDate": "2020-12-22T03:02:30Z", "message": "Add timescaledb init job and secret and update readme\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "06c966c213f9a12d11ded7f330bd582ea3e53ce1", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/06c966c213f9a12d11ded7f330bd582ea3e53ce1", "committedDate": "2020-12-22T03:02:31Z", "message": "Streamlined volume mount and removed extra settings\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "00e355e75b30b34c980807933bfd4db3048ab41c", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/00e355e75b30b34c980807933bfd4db3048ab41c", "committedDate": "2020-12-22T03:02:31Z", "message": "Updated default limits on resources\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e9fb7ae0971865f5f62671eac869bf8ec20dacae", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/e9fb7ae0971865f5f62671eac869bf8ec20dacae", "committedDate": "2020-12-22T03:02:31Z", "message": "Updated job-timescaledb-init to use init.sql file from  secret-timescaledb\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "35c903d9cf300dda891f818ea3543bed2b965b52", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/35c903d9cf300dda891f818ea3543bed2b965b52", "committedDate": "2020-12-22T03:02:31Z", "message": "Set errexit on db init script call\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "efa28fb57c2fc33a9dd1005f808d0ee118f50c2a", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/efa28fb57c2fc33a9dd1005f808d0ee118f50c2a", "committedDate": "2020-12-22T03:02:31Z", "message": "Use a post-install hook and update docs\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1a4b8b147a90e9a37b0af57f98b7386b388b4e25", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/1a4b8b147a90e9a37b0af57f98b7386b388b4e25", "committedDate": "2020-12-22T02:48:18Z", "message": "Use a post-install hook and update docs\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}, "afterCommit": {"oid": "efa28fb57c2fc33a9dd1005f808d0ee118f50c2a", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/efa28fb57c2fc33a9dd1005f808d0ee118f50c2a", "committedDate": "2020-12-22T03:02:31Z", "message": "Use a post-install hook and update docs\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4cd0162c9a19eb2f8491b77b6cc2531b7e294b89", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/4cd0162c9a19eb2f8491b77b6cc2531b7e294b89", "committedDate": "2020-12-22T03:08:23Z", "message": "Removed extra space on install commands\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU3MjA1NDk4", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#pullrequestreview-557205498", "createdAt": "2020-12-22T16:28:13Z", "commit": {"oid": "4cd0162c9a19eb2f8491b77b6cc2531b7e294b89"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQxNjoyODoxM1rOIKBF7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yMlQxNjozNDoyM1rOIKBR-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzM3NDU3NQ==", "bodyText": "alter default privileges in schema public grant select on tables to viewer;", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r547374575", "createdAt": "2020-12-22T16:28:13Z", "author": {"login": "steven-sheehy"}, "path": "charts/hedera-mirror/templates/secret-timescaledb.yaml", "diffHunk": "@@ -0,0 +1,30 @@\n+{{- if .Values.timescaledb.enabled -}}\n+apiVersion: v1\n+kind: Secret\n+metadata:\n+  labels:\n+    {{- include \"hedera-mirror.labels\" . | nindent 4 }}\n+  name: {{ printf \"%s-timescaledb-init\" .Release.Name  }}\n+  namespace: {{ include \"hedera-mirror.namespace\" . }}\n+type: Opaque\n+stringData:\n+  init.sql: |-\n+    {{- $dbName := .Values.importer.config.hedera.mirror.importer.db.name }}\n+    {{- $importerUser := .Values.importer.config.hedera.mirror.importer.db.username }}\n+    {{- $importerPassword := .Values.importer.config.hedera.mirror.importer.db.password }}\n+    {{- $grpcUsername := .Values.grpc.config.hedera.mirror.grpc.db.username }}\n+    {{- $grpcPassword := .Values.grpc.config.hedera.mirror.grpc.db.password }}\n+    {{- $restUser := .Values.global.rest.username }}\n+    {{- $restPassword := .Values.global.rest.password }}\n+    create database {{ $dbName }};\n+    \\c {{ $dbName }};\n+    create extension if not exists timescaledb cascade;\n+    create user {{ $importerUser }} with login password '{{ $importerPassword }}';\n+    create role viewer;\n+    create user {{ $grpcUsername }} with login password '{{ $grpcPassword }}' in role viewer;\n+    create user {{ $restUser }} with login password '{{ $restPassword }}' in role viewer;\n+    grant select on all tables in schema public to {{ $importerUser }};\n+    grant select on all tables in schema public to viewer;\n+    alter default privileges for role {{ $importerUser }} in schema public grant select on tables to viewer;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4cd0162c9a19eb2f8491b77b6cc2531b7e294b89"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzM3NzY1OQ==", "bodyText": "This does not create a read only user. Because the viewer role inherits from public, he has permissions to create objects. This is also why it works without grant connect currently.\nWe need to revisit these permissions completely. We should revoke all permissions from public first. Then we should create readonly and readwrite roles then assign those to users appropriately. Maybe we can do this in a follow up.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#discussion_r547377659", "createdAt": "2020-12-22T16:34:23Z", "author": {"login": "steven-sheehy"}, "path": "charts/hedera-mirror/templates/secret-timescaledb.yaml", "diffHunk": "@@ -0,0 +1,30 @@\n+{{- if .Values.timescaledb.enabled -}}\n+apiVersion: v1\n+kind: Secret\n+metadata:\n+  labels:\n+    {{- include \"hedera-mirror.labels\" . | nindent 4 }}\n+  name: {{ printf \"%s-timescaledb-init\" .Release.Name  }}\n+  namespace: {{ include \"hedera-mirror.namespace\" . }}\n+type: Opaque\n+stringData:\n+  init.sql: |-\n+    {{- $dbName := .Values.importer.config.hedera.mirror.importer.db.name }}\n+    {{- $importerUser := .Values.importer.config.hedera.mirror.importer.db.username }}\n+    {{- $importerPassword := .Values.importer.config.hedera.mirror.importer.db.password }}\n+    {{- $grpcUsername := .Values.grpc.config.hedera.mirror.grpc.db.username }}\n+    {{- $grpcPassword := .Values.grpc.config.hedera.mirror.grpc.db.password }}\n+    {{- $restUser := .Values.global.rest.username }}\n+    {{- $restPassword := .Values.global.rest.password }}\n+    create database {{ $dbName }};\n+    \\c {{ $dbName }};\n+    create extension if not exists timescaledb cascade;\n+    create user {{ $importerUser }} with login password '{{ $importerPassword }}';\n+    create role viewer;\n+    create user {{ $grpcUsername }} with login password '{{ $grpcPassword }}' in role viewer;\n+    create user {{ $restUser }} with login password '{{ $restPassword }}' in role viewer;\n+    grant select on all tables in schema public to {{ $importerUser }};\n+    grant select on all tables in schema public to viewer;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4cd0162c9a19eb2f8491b77b6cc2531b7e294b89"}, "originalPosition": 27}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU3MjczNTk3", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#pullrequestreview-557273597", "createdAt": "2020-12-22T18:15:07Z", "commit": {"oid": "4cd0162c9a19eb2f8491b77b6cc2531b7e294b89"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU3MzAwNzg5", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1359#pullrequestreview-557300789", "createdAt": "2020-12-22T19:02:44Z", "commit": {"oid": "4cd0162c9a19eb2f8491b77b6cc2531b7e294b89"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3433, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}