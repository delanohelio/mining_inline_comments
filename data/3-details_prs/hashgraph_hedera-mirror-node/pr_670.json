{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAxMDIxMzY4", "number": 670, "title": "Remove Events", "bodyText": "Detailed description:\n\nRemoves EventStreamFileDownloader, EventStreamFileParser, and associated code\nRemoves events.js and eventAnalytics.js\nRemoved t_events table and other unused database components\nRemoved unused functions in Utility.\nRemoves is<type>File() functions.\nThe ones for balances and event were not being used (after removing unused functions).\nGoing forward, rather than calling Utility.function() from Downloader.java\n(or abstracted out parser code in future) which then does regex match and\nif-else on filename to call appropriate record/event/balance function, we'll\nuse abstract functions in Downloader/Parser and implementations would directly\ncall correct utility function.\n\n\nWhich issue(s) this PR fixes:\nFixes #572\nSpecial notes for your reviewer:\nChecklist\n\n Documentation added\n Tests updated", "createdAt": "2020-04-08T18:58:14Z", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/670", "merged": true, "mergeCommit": {"oid": "a8092951c8e54116d2c92f873c95ac94f2bdb460"}, "closed": true, "closedAt": "2020-04-08T21:56:51Z", "author": {"login": "apeksharma"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcVs1KdgBqjMyMTU0NzQ4MTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcVu-GIgFqTM5MDM1Mjg2OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a82abecf68fce13dd7c08ba855d1f0bb50437a0b", "author": {"user": {"login": "apeksharma", "name": "Apekshit Sharma"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/a82abecf68fce13dd7c08ba855d1f0bb50437a0b", "committedDate": "2020-04-08T19:05:10Z", "message": "update docs\n\nSigned-off-by: Apekshit Sharma <apekshit.sharma@hedera.com>"}, "afterCommit": {"oid": "bdb89379e6128d94128a6d62209c7dd4522275b9", "author": {"user": {"login": "apeksharma", "name": "Apekshit Sharma"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/bdb89379e6128d94128a6d62209c7dd4522275b9", "committedDate": "2020-04-08T19:09:44Z", "message": "update docs\n\nSigned-off-by: Apekshit Sharma <apekshit.sharma@hedera.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwMjU0Njk0", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/670#pullrequestreview-390254694", "createdAt": "2020-04-08T19:08:52Z", "commit": {"oid": "a82abecf68fce13dd7c08ba855d1f0bb50437a0b"}, "state": "COMMENTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxOTowODo1MlrOGC9Gkg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQxOToxOToxNVrOGC9cgw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTc1MTQ0Mg==", "bodyText": "The filter isn't even needed. Looks like legacy of old code. Should be removed (if everyone's okay).", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/670#discussion_r405751442", "createdAt": "2020-04-08T19:08:52Z", "author": {"login": "apeksharma"}, "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/record/RecordFileParser.java", "diffHunk": "@@ -299,7 +296,7 @@ public void parse() {\n \n                 // add directory prefix to get full path\n                 List<String> fullPaths = Arrays.asList(files).stream()\n-                        .filter(f -> Utility.isRecordFile(f))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a82abecf68fce13dd7c08ba855d1f0bb50437a0b"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTc1Mjk5NA==", "bodyText": "better to encapsulate each stream's file helpers separately in future", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/670#discussion_r405752994", "createdAt": "2020-04-08T19:11:47Z", "author": {"login": "apeksharma"}, "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/util/FileDelimiter.java", "diffHunk": "@@ -22,13 +22,6 @@\n \n public class FileDelimiter {\n     public static final String HASH_ALGORITHM = \"SHA-384\";\n-    public static final byte EVENT_TYPE_PREV_HASH = 1;       // next 48 bytes are hash384 or previous files", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a82abecf68fce13dd7c08ba855d1f0bb50437a0b"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTc1NDU1MA==", "bodyText": "removing if-else and pattern matching on files in favor of directly calling appropriate utility functions from fns overridden by downloader implementations.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/670#discussion_r405754550", "createdAt": "2020-04-08T19:14:32Z", "author": {"login": "apeksharma"}, "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/util/Utility.java", "diffHunk": "@@ -119,110 +103,18 @@ public static boolean hashMatch(byte[] hash, File rcdFile) {\n     }\n \n     /**\n-     * Calculate SHA384 hash of a binary file\n+     * Calculate SHA384 hash of a balance file\n      *\n      * @param fileName file name\n      * @return byte array of hash value of null if calculating has failed\n      */\n-    public static byte[] getFileHash(String fileName) {\n-        MessageDigest md;\n-        if (getFileExtension(fileName).contentEquals(\"rcd\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bdb89379e6128d94128a6d62209c7dd4522275b9"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTc1NTUxNg==", "bodyText": "removed this for now since a lot of code here and in EventStreamFileParser (removed) seems sharable when done correctly", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/670#discussion_r405755516", "createdAt": "2020-04-08T19:16:15Z", "author": {"login": "apeksharma"}, "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/util/Utility.java", "diffHunk": "@@ -119,110 +103,18 @@ public static boolean hashMatch(byte[] hash, File rcdFile) {\n     }\n \n     /**\n-     * Calculate SHA384 hash of a binary file\n+     * Calculate SHA384 hash of a balance file\n      *\n      * @param fileName file name\n      * @return byte array of hash value of null if calculating has failed\n      */\n-    public static byte[] getFileHash(String fileName) {\n-        MessageDigest md;\n-        if (getFileExtension(fileName).contentEquals(\"rcd\")) {\n-            return getRecordFileHash(fileName);\n-        } else if (getFileExtension(fileName).contentEquals(\"evt\")) {\n-            return getEventFileHash(fileName);\n-        } else {\n-            try {\n-                md = MessageDigest.getInstance(FileDelimiter.HASH_ALGORITHM);\n-\n-                byte[] array = Files.readAllBytes(Paths.get(fileName));\n-                return md.digest(array);\n-            } catch (NoSuchAlgorithmException | IOException e) {\n-                log.error(\"Exception {}\", e);\n-                return null;\n-            }\n-        }\n-    }\n-\n-    /**\n-     * Calculate SHA384 hash of an event file\n-     *\n-     * @param filename file name\n-     * @return byte array of hash value of null if calculating has failed\n-     */\n-    private static byte[] getEventFileHash(String filename) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bdb89379e6128d94128a6d62209c7dd4522275b9"}, "originalPosition": 77}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTc1NjE1NQ==", "bodyText": "next 3 functions are dead code.\ngetAccountIDStringFromFilePath isn't needed due to changes in Downloader at top of this PR.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/670#discussion_r405756155", "createdAt": "2020-04-08T19:17:34Z", "author": {"login": "apeksharma"}, "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/util/Utility.java", "diffHunk": "@@ -396,98 +282,6 @@ public static String bytesToHex(byte[] bytes) {\n         return Hex.encodeHexString(bytes);\n     }\n \n-    /**", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bdb89379e6128d94128a6d62209c7dd4522275b9"}, "originalPosition": 197}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTc1NzA1OQ==", "bodyText": "i undid them once, the IDE did it again. PITA :D\nlet's leave them for now until we do .editorconfig following which there can be one big auto formatting PR.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/670#discussion_r405757059", "createdAt": "2020-04-08T19:19:15Z", "author": {"login": "apeksharma"}, "path": "hedera-mirror-rest/server.js", "diffHunk": "@@ -58,15 +56,15 @@ if (port === undefined || isNaN(Number(port))) {\n log4js.configure({\n   appenders: {\n     everything: {\n-      type: 'stdout',", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bdb89379e6128d94128a6d62209c7dd4522275b9"}, "originalPosition": 15}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "956eae6864e131d24502dd3cca3c057b2c5fd558", "author": {"user": {"login": "apeksharma", "name": "Apekshit Sharma"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/956eae6864e131d24502dd3cca3c057b2c5fd558", "committedDate": "2020-04-08T20:00:19Z", "message": "Remove EventStream downloader and parser\n\n- Removed unused functions in Utility.\n- Leaving t_events table (so no db migration is needed)\n- Removed is<type>File() functions.\n  The ones for balances and event were not being used.\n  Going forward, rather than calling Utility.function() from Downloader.java\n  (or abstracted out parser code in future) which then does regex match and\n  if-else on filename to call appropriate record/event/balance function, we'll\n  use abstract functions in Downloader/Parser and implementations would directly\n  call correct utility function.\n\nSigned-off-by: Apekshit Sharma <apekshit.sharma@hedera.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9a919f0539ee78236a7e08e6644963661e9c7dcc", "author": {"user": {"login": "apeksharma", "name": "Apekshit Sharma"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/9a919f0539ee78236a7e08e6644963661e9c7dcc", "committedDate": "2020-04-08T20:00:35Z", "message": "update docs\n\nSigned-off-by: Apekshit Sharma <apekshit.sharma@hedera.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwMzAyNzk5", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/670#pullrequestreview-390302799", "createdAt": "2020-04-08T20:22:08Z", "commit": {"oid": "bdb89379e6128d94128a6d62209c7dd4522275b9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQyMDoyMjowOFrOGC_gtQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQyMDoyMjowOFrOGC_gtQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTc5MDkwMQ==", "bodyText": "I guess it's just an extra check in case someone puts some unknown file in /valid? I'm okay either way keeping or removing.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/670#discussion_r405790901", "createdAt": "2020-04-08T20:22:08Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/record/RecordFileParser.java", "diffHunk": "@@ -299,7 +296,7 @@ public void parse() {\n \n                 // add directory prefix to get full path\n                 List<String> fullPaths = Arrays.asList(files).stream()\n-                        .filter(f -> Utility.isRecordFile(f))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTc1MTQ0Mg=="}, "originalCommit": {"oid": "a82abecf68fce13dd7c08ba855d1f0bb50437a0b"}, "originalPosition": 40}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwMzI0Njk5", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/670#pullrequestreview-390324699", "createdAt": "2020-04-08T20:54:57Z", "commit": {"oid": "bdb89379e6128d94128a6d62209c7dd4522275b9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQyMDo1NDo1N1rOGDAnVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wOFQyMDo1NDo1N1rOGDAnVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTgwODk4Mg==", "bodyText": "Removed.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/670#discussion_r405808982", "createdAt": "2020-04-08T20:54:57Z", "author": {"login": "apeksharma"}, "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/record/RecordFileParser.java", "diffHunk": "@@ -299,7 +296,7 @@ public void parse() {\n \n                 // add directory prefix to get full path\n                 List<String> fullPaths = Arrays.asList(files).stream()\n-                        .filter(f -> Utility.isRecordFile(f))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTc1MTQ0Mg=="}, "originalCommit": {"oid": "a82abecf68fce13dd7c08ba855d1f0bb50437a0b"}, "originalPosition": 40}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bdb89379e6128d94128a6d62209c7dd4522275b9", "author": {"user": {"login": "apeksharma", "name": "Apekshit Sharma"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/bdb89379e6128d94128a6d62209c7dd4522275b9", "committedDate": "2020-04-08T19:09:44Z", "message": "update docs\n\nSigned-off-by: Apekshit Sharma <apekshit.sharma@hedera.com>"}, "afterCommit": {"oid": "08bf49a940ba7cb596c557020eb315ea6f61135d", "author": {"user": {"login": "apeksharma", "name": "Apekshit Sharma"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/08bf49a940ba7cb596c557020eb315ea6f61135d", "committedDate": "2020-04-08T21:06:54Z", "message": "Db migration to remove unused components\n\nSigned-off-by: Apekshit Sharma <apekshit.sharma@hedera.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "122e9c949f56baa67c9313ce648b82077e482c57", "author": {"user": {"login": "apeksharma", "name": "Apekshit Sharma"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/122e9c949f56baa67c9313ce648b82077e482c57", "committedDate": "2020-04-08T21:12:02Z", "message": "Db migration to remove unused components\n\nSigned-off-by: Apekshit Sharma <apekshit.sharma@hedera.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "08bf49a940ba7cb596c557020eb315ea6f61135d", "author": {"user": {"login": "apeksharma", "name": "Apekshit Sharma"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/08bf49a940ba7cb596c557020eb315ea6f61135d", "committedDate": "2020-04-08T21:06:54Z", "message": "Db migration to remove unused components\n\nSigned-off-by: Apekshit Sharma <apekshit.sharma@hedera.com>"}, "afterCommit": {"oid": "122e9c949f56baa67c9313ce648b82077e482c57", "author": {"user": {"login": "apeksharma", "name": "Apekshit Sharma"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/122e9c949f56baa67c9313ce648b82077e482c57", "committedDate": "2020-04-08T21:12:02Z", "message": "Db migration to remove unused components\n\nSigned-off-by: Apekshit Sharma <apekshit.sharma@hedera.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "358b5bca84b14905c0b927214589cb003e6449ce", "author": {"user": {"login": "apeksharma", "name": "Apekshit Sharma"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/358b5bca84b14905c0b927214589cb003e6449ce", "committedDate": "2020-04-08T21:19:10Z", "message": "remove codes from t_application_status\n\nSigned-off-by: Apekshit Sharma <apekshit.sharma@hedera.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkwMzUyODY5", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/670#pullrequestreview-390352869", "createdAt": "2020-04-08T21:41:57Z", "commit": {"oid": "358b5bca84b14905c0b927214589cb003e6449ce"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3060, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}