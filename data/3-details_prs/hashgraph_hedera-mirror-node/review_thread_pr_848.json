{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQxMTY0OTkx", "number": 848, "reviewThreads": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQwMzoxODo1MVrOEJhS7Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQwMTowOTozOVrOEJ5B9g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4NDE4MTU3OnYy", "diffSide": "RIGHT", "path": "hedera-mirror-grpc/src/main/java/com/hedera/mirror/grpc/service/TopicMessageServiceImpl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQwMzoxODo1MVrOGqDfLA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQyMDoyMDozMFrOGrNBEw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njc1MDUwOA==", "bodyText": "Since there's no dynamic tags, you should register this in constructor for performance reasons.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/848#discussion_r446750508", "createdAt": "2020-06-29T03:18:51Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-grpc/src/main/java/com/hedera/mirror/grpc/service/TopicMessageServiceImpl.java", "diffHunk": "@@ -207,6 +214,9 @@ void onNext(TopicMessage topicMessage) {\n             }\n \n             lastTopicMessage = topicMessage;\n+            consensusToPublishMetric\n+                    .register(meterRegistry)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6921c612aad83f2b116d99b9cfbc3215b76bfbff"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzk1NTIxOQ==", "bodyText": "Moved to @PostConstruct of CompositeTopicListener", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/848#discussion_r447955219", "createdAt": "2020-06-30T20:20:30Z", "author": {"login": "Nana-EC"}, "path": "hedera-mirror-grpc/src/main/java/com/hedera/mirror/grpc/service/TopicMessageServiceImpl.java", "diffHunk": "@@ -207,6 +214,9 @@ void onNext(TopicMessage topicMessage) {\n             }\n \n             lastTopicMessage = topicMessage;\n+            consensusToPublishMetric\n+                    .register(meterRegistry)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njc1MDUwOA=="}, "originalCommit": {"oid": "6921c612aad83f2b116d99b9cfbc3215b76bfbff"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4NDE4NjMyOnYy", "diffSide": "RIGHT", "path": "hedera-mirror-grpc/src/main/java/com/hedera/mirror/grpc/service/TopicMessageServiceImpl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQwMzoyMjowN1rOGqDhyg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQyMDoyMDozOFrOGrNBWg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njc1MTE3OA==", "bodyText": "Putting this metric in topic message service means it runs for both historic messages and incoming, producing inaccurate results. Since this metric should really track when it was first published, it should be placed inside the CompositeTopicListener.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/848#discussion_r446751178", "createdAt": "2020-06-29T03:22:07Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-grpc/src/main/java/com/hedera/mirror/grpc/service/TopicMessageServiceImpl.java", "diffHunk": "@@ -53,6 +56,10 @@\n     private final TopicListener topicListener;\n     private final EntityRepository entityRepository;\n     private final TopicMessageRetriever topicMessageRetriever;\n+    private final MeterRegistry meterRegistry;\n+    private final Timer.Builder consensusToPublishMetric = Timer.builder(\"hedera.mirror.message.latency\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6921c612aad83f2b116d99b9cfbc3215b76bfbff"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzk1NTI5MA==", "bodyText": "Good point. Moving logic to CompositeTopicListener", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/848#discussion_r447955290", "createdAt": "2020-06-30T20:20:38Z", "author": {"login": "Nana-EC"}, "path": "hedera-mirror-grpc/src/main/java/com/hedera/mirror/grpc/service/TopicMessageServiceImpl.java", "diffHunk": "@@ -53,6 +56,10 @@\n     private final TopicListener topicListener;\n     private final EntityRepository entityRepository;\n     private final TopicMessageRetriever topicMessageRetriever;\n+    private final MeterRegistry meterRegistry;\n+    private final Timer.Builder consensusToPublishMetric = Timer.builder(\"hedera.mirror.message.latency\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njc1MTE3OA=="}, "originalCommit": {"oid": "6921c612aad83f2b116d99b9cfbc3215b76bfbff"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4NDE5OTA1OnYy", "diffSide": "RIGHT", "path": "hedera-mirror-grpc/src/main/java/com/hedera/mirror/grpc/service/TopicMessageServiceImpl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQwMzozMTowOFrOGqDo4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQyMDoyMDo1OFrOGrNCAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njc1Mjk5Mw==", "bodyText": "I did a lot of work to reduce construction of temporary objects in this flow recently. It would be better to use System.currentTimeMillis() - topicMessage.getConsensusTimestampInstant().toEpochMillis(). Please verify accuracy of calculation. Potentially also System.nanoTime() - topicMessage.getConsensusTimestamp().\nNote that's nanoTime and not nanaTime. :D", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/848#discussion_r446752993", "createdAt": "2020-06-29T03:31:08Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-grpc/src/main/java/com/hedera/mirror/grpc/service/TopicMessageServiceImpl.java", "diffHunk": "@@ -207,6 +214,9 @@ void onNext(TopicMessage topicMessage) {\n             }\n \n             lastTopicMessage = topicMessage;\n+            consensusToPublishMetric\n+                    .register(meterRegistry)\n+                    .record(Duration.between(topicMessage.getConsensusTimestampInstant(), Instant.now()));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6921c612aad83f2b116d99b9cfbc3215b76bfbff"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzk1NTQ1OA==", "bodyText": "Fair point. Went with milliseconds since we're expecting the latency in the range of 6-12 seconds. Nano feels like extra accuracy.\nLet me know if I'm missing something on the needs for nanoTime (not meTime)", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/848#discussion_r447955458", "createdAt": "2020-06-30T20:20:58Z", "author": {"login": "Nana-EC"}, "path": "hedera-mirror-grpc/src/main/java/com/hedera/mirror/grpc/service/TopicMessageServiceImpl.java", "diffHunk": "@@ -207,6 +214,9 @@ void onNext(TopicMessage topicMessage) {\n             }\n \n             lastTopicMessage = topicMessage;\n+            consensusToPublishMetric\n+                    .register(meterRegistry)\n+                    .record(Duration.between(topicMessage.getConsensusTimestampInstant(), Instant.now()));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njc1Mjk5Mw=="}, "originalCommit": {"oid": "6921c612aad83f2b116d99b9cfbc3215b76bfbff"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4NDIwMTM4OnYy", "diffSide": "RIGHT", "path": "hedera-mirror-grpc/src/main/java/com/hedera/mirror/grpc/service/TopicMessageServiceImpl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQwMzozMjoyM1rOGqDp_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQyMDoyMTowNFrOGrNCLw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njc1MzI3OA==", "bodyText": "Would prefer hedera.mirror.topicmessage.latency for clarity.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/848#discussion_r446753278", "createdAt": "2020-06-29T03:32:23Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-grpc/src/main/java/com/hedera/mirror/grpc/service/TopicMessageServiceImpl.java", "diffHunk": "@@ -53,6 +56,10 @@\n     private final TopicListener topicListener;\n     private final EntityRepository entityRepository;\n     private final TopicMessageRetriever topicMessageRetriever;\n+    private final MeterRegistry meterRegistry;\n+    private final Timer.Builder consensusToPublishMetric = Timer.builder(\"hedera.mirror.message.latency\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6921c612aad83f2b116d99b9cfbc3215b76bfbff"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzk1NTUwMw==", "bodyText": "Agreed. Updated", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/848#discussion_r447955503", "createdAt": "2020-06-30T20:21:04Z", "author": {"login": "Nana-EC"}, "path": "hedera-mirror-grpc/src/main/java/com/hedera/mirror/grpc/service/TopicMessageServiceImpl.java", "diffHunk": "@@ -53,6 +56,10 @@\n     private final TopicListener topicListener;\n     private final EntityRepository entityRepository;\n     private final TopicMessageRetriever topicMessageRetriever;\n+    private final MeterRegistry meterRegistry;\n+    private final Timer.Builder consensusToPublishMetric = Timer.builder(\"hedera.mirror.message.latency\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njc1MzI3OA=="}, "originalCommit": {"oid": "6921c612aad83f2b116d99b9cfbc3215b76bfbff"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4NDIwNTg4OnYy", "diffSide": "RIGHT", "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/record/RecordFileParser.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQwMzozNTozNFrOGqDsgA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQyMDoyMToyMVrOGrNCzQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njc1MzkyMA==", "bodyText": "I would not use the term push because it's not a) synchronously pushing when you record and b) only elastic actually pushes while prometheus pulls. Recommend record instead of push.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/848#discussion_r446753920", "createdAt": "2020-06-29T03:35:34Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/record/RecordFileParser.java", "diffHunk": "@@ -101,6 +106,8 @@ public RecordFileParser(ApplicationStatusRepository applicationStatusRepository,\n      */\n     public void loadRecordFile(StreamFileData streamFileData) {\n         Instant startTime = Instant.now();\n+        pushParserFallBehindMetric(streamFileData.getFilename(), startTime);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6921c612aad83f2b116d99b9cfbc3215b76bfbff"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzk1NTY2MQ==", "bodyText": "Updated to to 'record' not 'push'", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/848#discussion_r447955661", "createdAt": "2020-06-30T20:21:21Z", "author": {"login": "Nana-EC"}, "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/record/RecordFileParser.java", "diffHunk": "@@ -101,6 +106,8 @@ public RecordFileParser(ApplicationStatusRepository applicationStatusRepository,\n      */\n     public void loadRecordFile(StreamFileData streamFileData) {\n         Instant startTime = Instant.now();\n+        pushParserFallBehindMetric(streamFileData.getFilename(), startTime);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njc1MzkyMA=="}, "originalCommit": {"oid": "6921c612aad83f2b116d99b9cfbc3215b76bfbff"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4NDIwODA5OnYy", "diffSide": "RIGHT", "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/record/RecordFileParser.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQwMzozNzoxNlrOGqDtuQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQyMDoyMToyOFrOGrNDBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njc1NDIzMw==", "bodyText": "Instead of parsing the filename, we should use the RecordFile object which has already retrieved the consensus timestamp. In fact, can just rf.loadend - rf.consensusend, don't need to pass in start time and convert to instants and durations.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/848#discussion_r446754233", "createdAt": "2020-06-29T03:37:16Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/record/RecordFileParser.java", "diffHunk": "@@ -188,6 +195,19 @@ private void loadRecordFiles(List<String> fileNames) {\n         }\n     }\n \n+    private void pushParserFallBehindMetric(String filePath, Instant startTime) {\n+        try {\n+            String fileName = Utility.getFileName(filePath);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6921c612aad83f2b116d99b9cfbc3215b76bfbff"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzk1NTcxOQ==", "bodyText": "Fair point. Didn't realize the timestamp was that of the 1st transaction consensus.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/848#discussion_r447955719", "createdAt": "2020-06-30T20:21:28Z", "author": {"login": "Nana-EC"}, "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/record/RecordFileParser.java", "diffHunk": "@@ -188,6 +195,19 @@ private void loadRecordFiles(List<String> fileNames) {\n         }\n     }\n \n+    private void pushParserFallBehindMetric(String filePath, Instant startTime) {\n+        try {\n+            String fileName = Utility.getFileName(filePath);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njc1NDIzMw=="}, "originalCommit": {"oid": "6921c612aad83f2b116d99b9cfbc3215b76bfbff"}, "originalPosition": 34}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4NDIwODMwOnYy", "diffSide": "RIGHT", "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/record/RecordFileParser.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQwMzozNzozMFrOGqDt3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQyMDoyMTozNFrOGrNDLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njc1NDI2OQ==", "bodyText": "Register in constructor", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/848#discussion_r446754269", "createdAt": "2020-06-29T03:37:30Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/record/RecordFileParser.java", "diffHunk": "@@ -188,6 +195,19 @@ private void loadRecordFiles(List<String> fileNames) {\n         }\n     }\n \n+    private void pushParserFallBehindMetric(String filePath, Instant startTime) {\n+        try {\n+            String fileName = Utility.getFileName(filePath);\n+            String fileTimeStamp = fileName.replace(\".rcd\", \"\").replace('_', ':');\n+            Instant fileCreateTime = Instant.parse(fileTimeStamp);\n+            parserFallBehindMetric\n+                    .register(meterRegistry)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6921c612aad83f2b116d99b9cfbc3215b76bfbff"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzk1NTc1Ng==", "bodyText": "Moved to constructor", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/848#discussion_r447955756", "createdAt": "2020-06-30T20:21:34Z", "author": {"login": "Nana-EC"}, "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/record/RecordFileParser.java", "diffHunk": "@@ -188,6 +195,19 @@ private void loadRecordFiles(List<String> fileNames) {\n         }\n     }\n \n+    private void pushParserFallBehindMetric(String filePath, Instant startTime) {\n+        try {\n+            String fileName = Utility.getFileName(filePath);\n+            String fileTimeStamp = fileName.replace(\".rcd\", \"\").replace('_', ':');\n+            Instant fileCreateTime = Instant.parse(fileTimeStamp);\n+            parserFallBehindMetric\n+                    .register(meterRegistry)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njc1NDI2OQ=="}, "originalCommit": {"oid": "6921c612aad83f2b116d99b9cfbc3215b76bfbff"}, "originalPosition": 38}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4NDIwOTY0OnYy", "diffSide": "RIGHT", "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/record/RecordFileParser.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQwMzozODoyNFrOGqDumA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQyMDoyMTo0NVrOGrNDlw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njc1NDQ1Ng==", "bodyText": "The description states milliseconds but we only have second granularity. Can we do ms here?", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/848#discussion_r446754456", "createdAt": "2020-06-29T03:38:24Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/record/RecordFileParser.java", "diffHunk": "@@ -188,6 +195,19 @@ private void loadRecordFiles(List<String> fileNames) {\n         }\n     }\n \n+    private void pushParserFallBehindMetric(String filePath, Instant startTime) {\n+        try {\n+            String fileName = Utility.getFileName(filePath);\n+            String fileTimeStamp = fileName.replace(\".rcd\", \"\").replace('_', ':');\n+            Instant fileCreateTime = Instant.parse(fileTimeStamp);\n+            parserFallBehindMetric\n+                    .register(meterRegistry)\n+                    .record(Duration.between(fileCreateTime, startTime).getSeconds(), TimeUnit.SECONDS);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6921c612aad83f2b116d99b9cfbc3215b76bfbff"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzk1NTg2Mw==", "bodyText": "I'll be converting the recordFileEnd to ms and the consensus time to ms so we can get ms granularity.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/848#discussion_r447955863", "createdAt": "2020-06-30T20:21:45Z", "author": {"login": "Nana-EC"}, "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/record/RecordFileParser.java", "diffHunk": "@@ -188,6 +195,19 @@ private void loadRecordFiles(List<String> fileNames) {\n         }\n     }\n \n+    private void pushParserFallBehindMetric(String filePath, Instant startTime) {\n+        try {\n+            String fileName = Utility.getFileName(filePath);\n+            String fileTimeStamp = fileName.replace(\".rcd\", \"\").replace('_', ':');\n+            Instant fileCreateTime = Instant.parse(fileTimeStamp);\n+            parserFallBehindMetric\n+                    .register(meterRegistry)\n+                    .record(Duration.between(fileCreateTime, startTime).getSeconds(), TimeUnit.SECONDS);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njc1NDQ1Ng=="}, "originalCommit": {"oid": "6921c612aad83f2b116d99b9cfbc3215b76bfbff"}, "originalPosition": 39}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4NzgzMDAwOnYy", "diffSide": "RIGHT", "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/record/RecordFileParser.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQyMzoyMzowOFrOGql5Yw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQyMDoyMTo1MlrOGrNDzg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzMxNDI3NQ==", "bodyText": "Inaccurate description. Not serialization but consensus timestamp of first transaction.\nAlso, I think it might be more accurate to compare against last consensus timestamp in file instead of first.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/848#discussion_r447314275", "createdAt": "2020-06-29T23:23:08Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/record/RecordFileParser.java", "diffHunk": "@@ -89,6 +90,10 @@ public RecordFileParser(ApplicationStatusRepository applicationStatusRepository,\n                 .description(\"The duration in seconds it took to parse the file and store it in the database\")\n                 .tag(\"type\", parserProperties.getStreamType().toString());\n \n+        parserFallBehindMetric = Timer.builder(\"hedera.mirror.file.age\")\n+                .description(\"The difference in ms between the serialization of the file and when the mirror node \" +", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aa2afb1213a7467bef331b1bdaef3eea83a03795"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzk1NTkxOA==", "bodyText": "Good clarification. Yeah last consensus time will help ignore the time the network takes to serialize all the transactions to file. Probably the closest time to the end of file write.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/848#discussion_r447955918", "createdAt": "2020-06-30T20:21:52Z", "author": {"login": "Nana-EC"}, "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/record/RecordFileParser.java", "diffHunk": "@@ -89,6 +90,10 @@ public RecordFileParser(ApplicationStatusRepository applicationStatusRepository,\n                 .description(\"The duration in seconds it took to parse the file and store it in the database\")\n                 .tag(\"type\", parserProperties.getStreamType().toString());\n \n+        parserFallBehindMetric = Timer.builder(\"hedera.mirror.file.age\")\n+                .description(\"The difference in ms between the serialization of the file and when the mirror node \" +", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzMxNDI3NQ=="}, "originalCommit": {"oid": "aa2afb1213a7467bef331b1bdaef3eea83a03795"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4NzgzNTUwOnYy", "diffSide": "RIGHT", "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/record/entity/sql/SqlEntityListener.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yOVQyMzoyNTo0MFrOGql8kw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQyMDoyMjozNFrOGrNFGQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzMxNTA5MQ==", "bodyText": "Move tag and register to constructor or @PostConstruct (not onStart())", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/848#discussion_r447315091", "createdAt": "2020-06-29T23:25:40Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/record/entity/sql/SqlEntityListener.java", "diffHunk": "@@ -193,13 +211,28 @@ private void executeBatches() {\n                             \"claims: {}, topic messages: {}, non-fee transfers: {}\",\n                     transactions, entityIds, transferLists, fileData, contractResult, liveHashes, topicMessages,\n                     nonFeeTransfers);\n+            batchInsertMetric.tag(\"entity\", \"transactions\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aa2afb1213a7467bef331b1bdaef3eea83a03795"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzk1NjI0OQ==", "bodyText": "Agreed, but removing this change till after PgCopy logic goes in as it deletes a lot of code from this file.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/848#discussion_r447956249", "createdAt": "2020-06-30T20:22:34Z", "author": {"login": "Nana-EC"}, "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/record/entity/sql/SqlEntityListener.java", "diffHunk": "@@ -193,13 +211,28 @@ private void executeBatches() {\n                             \"claims: {}, topic messages: {}, non-fee transfers: {}\",\n                     transactions, entityIds, transferLists, fileData, contractResult, liveHashes, topicMessages,\n                     nonFeeTransfers);\n+            batchInsertMetric.tag(\"entity\", \"transactions\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzMxNTA5MQ=="}, "originalCommit": {"oid": "aa2afb1213a7467bef331b1bdaef3eea83a03795"}, "originalPosition": 55}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4NzkyOTkwOnYy", "diffSide": "RIGHT", "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/record/RecordFileParser.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQwMDowNjozNVrOGqmxRQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQyMDoyMjo0MVrOGrNFSQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzMyODU4MQ==", "bodyText": "Would prefer hedera.mirror.parse.delay to closer match related hedera.mirror.parse.duration", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/848#discussion_r447328581", "createdAt": "2020-06-30T00:06:35Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/record/RecordFileParser.java", "diffHunk": "@@ -89,6 +90,10 @@ public RecordFileParser(ApplicationStatusRepository applicationStatusRepository,\n                 .description(\"The duration in seconds it took to parse the file and store it in the database\")\n                 .tag(\"type\", parserProperties.getStreamType().toString());\n \n+        parserFallBehindMetric = Timer.builder(\"hedera.mirror.file.age\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aa2afb1213a7467bef331b1bdaef3eea83a03795"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzk1NjI5Nw==", "bodyText": "Updated", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/848#discussion_r447956297", "createdAt": "2020-06-30T20:22:41Z", "author": {"login": "Nana-EC"}, "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/record/RecordFileParser.java", "diffHunk": "@@ -89,6 +90,10 @@ public RecordFileParser(ApplicationStatusRepository applicationStatusRepository,\n                 .description(\"The duration in seconds it took to parse the file and store it in the database\")\n                 .tag(\"type\", parserProperties.getStreamType().toString());\n \n+        parserFallBehindMetric = Timer.builder(\"hedera.mirror.file.age\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzMyODU4MQ=="}, "originalCommit": {"oid": "aa2afb1213a7467bef331b1bdaef3eea83a03795"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4Nzk0MDE0OnYy", "diffSide": "RIGHT", "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/record/entity/sql/SqlEntityListener.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQwMDoxMToyNFrOGqm24g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQyMDoyMzowNVrOGrNGIw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzMzMDAxOA==", "bodyText": "Move to constructor or @PostConstruct. Constructor would be preferable to make final.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/848#discussion_r447330018", "createdAt": "2020-06-30T00:11:24Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/record/entity/sql/SqlEntityListener.java", "diffHunk": "@@ -75,13 +79,27 @@\n     private PreparedStatement sqlInsertTopicMessage;\n     private Connection connection;\n \n+    // Metrics\n+    private final MeterRegistry meterRegistry;\n+    private Timer.Builder batchInsertMetric;\n+    private Timer.Builder validStartTimeToDBInsertMetric;\n+    private int validStartTimeOfFirstTransactionInBatch = Instant.now().getNano();\n+\n     @Override\n     public void onStart(StreamFileData streamFileData) {\n         String fileName = streamFileData.getFilename();\n         entityIds = new HashSet<>();\n         if (recordFileRepository.findByName(fileName).size() > 0) {\n             throw new DuplicateFileException(\"File already exists in the database: \" + fileName);\n         }\n+\n+        batchInsertMetric = Timer.builder(\"hedera.mirror.db.batch.insert\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aa2afb1213a7467bef331b1bdaef3eea83a03795"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzk1NjUxNQ==", "bodyText": "Agreed, but removing this change till after PgCopy logic goes in as it deletes a lot of code from this file.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/848#discussion_r447956515", "createdAt": "2020-06-30T20:23:05Z", "author": {"login": "Nana-EC"}, "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/record/entity/sql/SqlEntityListener.java", "diffHunk": "@@ -75,13 +79,27 @@\n     private PreparedStatement sqlInsertTopicMessage;\n     private Connection connection;\n \n+    // Metrics\n+    private final MeterRegistry meterRegistry;\n+    private Timer.Builder batchInsertMetric;\n+    private Timer.Builder validStartTimeToDBInsertMetric;\n+    private int validStartTimeOfFirstTransactionInBatch = Instant.now().getNano();\n+\n     @Override\n     public void onStart(StreamFileData streamFileData) {\n         String fileName = streamFileData.getFilename();\n         entityIds = new HashSet<>();\n         if (recordFileRepository.findByName(fileName).size() > 0) {\n             throw new DuplicateFileException(\"File already exists in the database: \" + fileName);\n         }\n+\n+        batchInsertMetric = Timer.builder(\"hedera.mirror.db.batch.insert\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzMzMDAxOA=="}, "originalCommit": {"oid": "aa2afb1213a7467bef331b1bdaef3eea83a03795"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4Nzk0NjgzOnYy", "diffSide": "RIGHT", "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/record/entity/sql/SqlEntityListener.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQwMDoxNDoxN1rOGqm6kQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQyMDoyMzoxMVrOGrNGUQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzMzMDk2MQ==", "bodyText": "Move tag and register to constructor or @PostConstruct (not onStart())", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/848#discussion_r447330961", "createdAt": "2020-06-30T00:14:17Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/record/entity/sql/SqlEntityListener.java", "diffHunk": "@@ -193,13 +211,28 @@ private void executeBatches() {\n                             \"claims: {}, topic messages: {}, non-fee transfers: {}\",\n                     transactions, entityIds, transferLists, fileData, contractResult, liveHashes, topicMessages,\n                     nonFeeTransfers);\n+            batchInsertMetric.tag(\"entity\", \"transactions\")\n+                    .register(meterRegistry)\n+                    .record(transactions.timeTakenInMs, TimeUnit.MILLISECONDS);\n         } catch (SQLException e) {\n             log.error(\"Error committing sql insert batch \", e);\n             throw new ParserSQLException(e);\n         }\n         batch_count = 0;\n     }\n \n+    private ExecuteBatchResult executeTransactionInsertBatch(PreparedStatement ps) throws SQLException {\n+        var executeResult = executeBatch(ps);\n+\n+        validStartTimeToDBInsertMetric.tag(\"entity\", \"transactions\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aa2afb1213a7467bef331b1bdaef3eea83a03795"}, "originalPosition": 68}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzk1NjU2MQ==", "bodyText": "Agreed, but removing this change till after PgCopy logic goes in as it deletes a lot of code from this file.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/848#discussion_r447956561", "createdAt": "2020-06-30T20:23:11Z", "author": {"login": "Nana-EC"}, "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/record/entity/sql/SqlEntityListener.java", "diffHunk": "@@ -193,13 +211,28 @@ private void executeBatches() {\n                             \"claims: {}, topic messages: {}, non-fee transfers: {}\",\n                     transactions, entityIds, transferLists, fileData, contractResult, liveHashes, topicMessages,\n                     nonFeeTransfers);\n+            batchInsertMetric.tag(\"entity\", \"transactions\")\n+                    .register(meterRegistry)\n+                    .record(transactions.timeTakenInMs, TimeUnit.MILLISECONDS);\n         } catch (SQLException e) {\n             log.error(\"Error committing sql insert batch \", e);\n             throw new ParserSQLException(e);\n         }\n         batch_count = 0;\n     }\n \n+    private ExecuteBatchResult executeTransactionInsertBatch(PreparedStatement ps) throws SQLException {\n+        var executeResult = executeBatch(ps);\n+\n+        validStartTimeToDBInsertMetric.tag(\"entity\", \"transactions\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzMzMDk2MQ=="}, "originalCommit": {"oid": "aa2afb1213a7467bef331b1bdaef3eea83a03795"}, "originalPosition": 68}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4ODAwODc0OnYy", "diffSide": "RIGHT", "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/record/entity/sql/SqlEntityListener.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQwMDozOTozN1rOGqnb-A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQyMDoyMzoxNlrOGrNGfg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzMzOTUxMg==", "bodyText": "I don't think this is correct. Instant.now().get(ChronoField.NANO_OF_SECOND) would just return the 9 digit nanosecond part of the current time, not the number of nano seconds from epoch.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/848#discussion_r447339512", "createdAt": "2020-06-30T00:39:37Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/record/entity/sql/SqlEntityListener.java", "diffHunk": "@@ -193,13 +211,28 @@ private void executeBatches() {\n                             \"claims: {}, topic messages: {}, non-fee transfers: {}\",\n                     transactions, entityIds, transferLists, fileData, contractResult, liveHashes, topicMessages,\n                     nonFeeTransfers);\n+            batchInsertMetric.tag(\"entity\", \"transactions\")\n+                    .register(meterRegistry)\n+                    .record(transactions.timeTakenInMs, TimeUnit.MILLISECONDS);\n         } catch (SQLException e) {\n             log.error(\"Error committing sql insert batch \", e);\n             throw new ParserSQLException(e);\n         }\n         batch_count = 0;\n     }\n \n+    private ExecuteBatchResult executeTransactionInsertBatch(PreparedStatement ps) throws SQLException {\n+        var executeResult = executeBatch(ps);\n+\n+        validStartTimeToDBInsertMetric.tag(\"entity\", \"transactions\")\n+                .register(meterRegistry)\n+                .record((Instant.now()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aa2afb1213a7467bef331b1bdaef3eea83a03795"}, "originalPosition": 70}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzk1NjYwNg==", "bodyText": "Agreed, but removing this change till after PgCopy logic goes in as it deletes a lot of code from this file.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/848#discussion_r447956606", "createdAt": "2020-06-30T20:23:16Z", "author": {"login": "Nana-EC"}, "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/record/entity/sql/SqlEntityListener.java", "diffHunk": "@@ -193,13 +211,28 @@ private void executeBatches() {\n                             \"claims: {}, topic messages: {}, non-fee transfers: {}\",\n                     transactions, entityIds, transferLists, fileData, contractResult, liveHashes, topicMessages,\n                     nonFeeTransfers);\n+            batchInsertMetric.tag(\"entity\", \"transactions\")\n+                    .register(meterRegistry)\n+                    .record(transactions.timeTakenInMs, TimeUnit.MILLISECONDS);\n         } catch (SQLException e) {\n             log.error(\"Error committing sql insert batch \", e);\n             throw new ParserSQLException(e);\n         }\n         batch_count = 0;\n     }\n \n+    private ExecuteBatchResult executeTransactionInsertBatch(PreparedStatement ps) throws SQLException {\n+        var executeResult = executeBatch(ps);\n+\n+        validStartTimeToDBInsertMetric.tag(\"entity\", \"transactions\")\n+                .register(meterRegistry)\n+                .record((Instant.now()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzMzOTUxMg=="}, "originalCommit": {"oid": "aa2afb1213a7467bef331b1bdaef3eea83a03795"}, "originalPosition": 70}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc4ODA3MDMwOnYy", "diffSide": "RIGHT", "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/record/entity/sql/SqlEntityListener.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQwMTowOTozOVrOGqn-YQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0zMFQyMDoyMzoyMFrOGrNGnA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzM0ODMyMQ==", "bodyText": "This should not record just once per batch but for every transaction. Should use System.nanoTime() -  transaction.getValidStartNs() (double check this). In which case, this can probably move to RecordFileParser and implemented similar to the other latency metric.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/848#discussion_r447348321", "createdAt": "2020-06-30T01:09:39Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/record/entity/sql/SqlEntityListener.java", "diffHunk": "@@ -193,13 +211,28 @@ private void executeBatches() {\n                             \"claims: {}, topic messages: {}, non-fee transfers: {}\",\n                     transactions, entityIds, transferLists, fileData, contractResult, liveHashes, topicMessages,\n                     nonFeeTransfers);\n+            batchInsertMetric.tag(\"entity\", \"transactions\")\n+                    .register(meterRegistry)\n+                    .record(transactions.timeTakenInMs, TimeUnit.MILLISECONDS);\n         } catch (SQLException e) {\n             log.error(\"Error committing sql insert batch \", e);\n             throw new ParserSQLException(e);\n         }\n         batch_count = 0;\n     }\n \n+    private ExecuteBatchResult executeTransactionInsertBatch(PreparedStatement ps) throws SQLException {\n+        var executeResult = executeBatch(ps);\n+\n+        validStartTimeToDBInsertMetric.tag(\"entity\", \"transactions\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aa2afb1213a7467bef331b1bdaef3eea83a03795"}, "originalPosition": 68}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzk1NjYzNg==", "bodyText": "Agreed, but removing this change till after PgCopy logic goes in as it deletes a lot of code from this file.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/848#discussion_r447956636", "createdAt": "2020-06-30T20:23:20Z", "author": {"login": "Nana-EC"}, "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/record/entity/sql/SqlEntityListener.java", "diffHunk": "@@ -193,13 +211,28 @@ private void executeBatches() {\n                             \"claims: {}, topic messages: {}, non-fee transfers: {}\",\n                     transactions, entityIds, transferLists, fileData, contractResult, liveHashes, topicMessages,\n                     nonFeeTransfers);\n+            batchInsertMetric.tag(\"entity\", \"transactions\")\n+                    .register(meterRegistry)\n+                    .record(transactions.timeTakenInMs, TimeUnit.MILLISECONDS);\n         } catch (SQLException e) {\n             log.error(\"Error committing sql insert batch \", e);\n             throw new ParserSQLException(e);\n         }\n         batch_count = 0;\n     }\n \n+    private ExecuteBatchResult executeTransactionInsertBatch(PreparedStatement ps) throws SQLException {\n+        var executeResult = executeBatch(ps);\n+\n+        validStartTimeToDBInsertMetric.tag(\"entity\", \"transactions\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzM0ODMyMQ=="}, "originalCommit": {"oid": "aa2afb1213a7467bef331b1bdaef3eea83a03795"}, "originalPosition": 68}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 888, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}