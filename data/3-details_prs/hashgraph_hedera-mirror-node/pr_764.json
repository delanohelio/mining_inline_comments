{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE4OTM3MzQw", "number": 764, "title": "Add consensusTimestamp attribute to PubSub messages", "bodyText": "Detailed description:\nThe attribute is used by Dataflow pipeline to dedupe messages internally\nWhich issue(s) this PR fixes:\nSpecial notes for your reviewer:\nChecklist\n\n Documentation added\n Tests updated", "createdAt": "2020-05-16T08:52:15Z", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/764", "merged": true, "mergeCommit": {"oid": "cee186c6fecb341d4979352dc549b38385a42680"}, "closed": true, "closedAt": "2020-05-17T07:25:06Z", "author": {"login": "apeksharma"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABch7fT_gFqTQxMzA5ODQzNg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABch_WYfgFqTQxMzExNTUyNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzMDk4NDM2", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/764#pullrequestreview-413098436", "createdAt": "2020-05-16T18:30:39Z", "commit": {"oid": "a99026fda77e2b9d74d28a76c08657d9f526e78b"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNlQxODozMDo0MFrOGWb5Ow==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNlQxOTowMzo0N1rOGWcDVw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjE3ODg3NQ==", "bodyText": "nit: You're using Assertj, but you're not really using it:\nassertThat(headers).describedAs(\"Headers contain consensus timestamp\")\n  .hasSize(3)\n  .containsEntry(\"consensusTimestamp\", CONSENSUS_TIMESTAMP);", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/764#discussion_r426178875", "createdAt": "2020-05-16T18:30:40Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-importer/src/test/java/com/hedera/mirror/importer/parser/record/pubsub/PubSubRecordItemListenerTest.java", "diffHunk": "@@ -213,6 +214,9 @@ private void assertPubSubMessage(EntityId expectedEntity, Transaction expectedTr\n         } else {\n             assertThat(actual.getNonFeeTransfers()).isEqualTo(expectedNonFeeTransfers);\n         }\n+        MessageHeaders headers = argument.getValue().getHeaders();\n+        assertThat(headers.size()).isEqualTo(3); // +2 are default attributes 'id' and 'timestamp' (publish)\n+        assertThat(headers.get(\"consensusTimestamp\")).isEqualTo(CONSENSUS_TIMESTAMP);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a99026fda77e2b9d74d28a76c08657d9f526e78b"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjE4MTQ2Mw==", "bodyText": "This is quite convoluted. Would recommend converting them both to domain message:\nList<PubSubMessage> expected = null;\nList<com.google.pubsub.v1.PubsubMessage> actual = null;\n        assertThat(actual).describedAs(\"blah\")\n                .hasSize(expected.size())\n                .zipSatisfy(expected, (a, e) -> {\n                    assertThat(a.getAttributesMap()).containsEntry(\"consensusTimestamp\", e.getConsensusTimestamp().toString());\n                    assertThat(convert(a.getData())).isEqualTo(e);\n                });", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/764#discussion_r426181463", "createdAt": "2020-05-16T19:03:47Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-importer/src/test/java/com/hedera/mirror/importer/parser/record/pubsub/PubSubRecordParserTest.java", "diffHunk": "@@ -73,6 +78,26 @@ public void testPubSubExporter() throws Exception {\n         // then\n         List<String> expectedMessages =\n                 Files.readAllLines(testResourcesPath.resolve(\"pubsub-messages.txt\"));\n-        assertThat(getAllMessages(NUM_TXNS)).isEqualTo(expectedMessages);\n+        List<PubsubMessage> pubsubMessages = getAllMessages(NUM_TXNS);\n+        List<String> messages = pubsubMessages.stream()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a99026fda77e2b9d74d28a76c08657d9f526e78b"}, "originalPosition": 26}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3426595860e98cd3a43c0318a8f0cdc007008981", "author": {"user": {"login": "apeksharma", "name": "Apekshit Sharma"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/3426595860e98cd3a43c0318a8f0cdc007008981", "committedDate": "2020-05-16T22:24:48Z", "message": "Add consensusTimestamp attribute to PubSub messages\n\nSigned-off-by: Apekshit Sharma <apekshit.sharma@hedera.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32802754dba65ecab63c65afc6765c702fe95027", "author": {"user": {"login": "apeksharma", "name": "Apekshit Sharma"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/32802754dba65ecab63c65afc6765c702fe95027", "committedDate": "2020-05-16T22:46:48Z", "message": "address review\n\nSigned-off-by: Apekshit Sharma <apekshit.sharma@hedera.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "a99026fda77e2b9d74d28a76c08657d9f526e78b", "author": {"user": {"login": "apeksharma", "name": "Apekshit Sharma"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/a99026fda77e2b9d74d28a76c08657d9f526e78b", "committedDate": "2020-05-16T08:50:00Z", "message": "Add consensusTimestamp attribute to PubSub messages\n\nSigned-off-by: Apekshit Sharma <apekshit.sharma@hedera.com>"}, "afterCommit": {"oid": "32802754dba65ecab63c65afc6765c702fe95027", "author": {"user": {"login": "apeksharma", "name": "Apekshit Sharma"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/32802754dba65ecab63c65afc6765c702fe95027", "committedDate": "2020-05-16T22:46:48Z", "message": "address review\n\nSigned-off-by: Apekshit Sharma <apekshit.sharma@hedera.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEzMTE1NTI2", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/764#pullrequestreview-413115526", "createdAt": "2020-05-16T23:34:03Z", "commit": {"oid": "32802754dba65ecab63c65afc6765c702fe95027"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3146, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}