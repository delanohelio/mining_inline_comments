{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc4MDQ4Mjgx", "number": 549, "title": "Updated performance tests to use DbClient ", "bodyText": "Detailed description:\nRecently I realized the performance tests weren't working because the db inserts and deletes weren't working.\nIt seems with our r2dbc update the enforcement for transactional statements was enforced.\nAs such I took the opportunity to\n\nupdate the ConnectionHandler to use DatabaseClient.\nAdded the logic to ensure a topic entity exists before adding to it. This is since the gRPC layer added a check for it\nApplied PR feedback to update the acceptance test hcs feature scenarios\n\nSpecial notes for your reviewer:\nChecklist\n\n Documentation added\n Tests updated", "createdAt": "2020-02-21T00:41:13Z", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/549", "merged": true, "mergeCommit": {"oid": "4f4cc49879622363268c2d9aaf3f28c22286f7e1"}, "closed": true, "closedAt": "2020-02-21T21:27:05Z", "author": {"login": "Nana-EC"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcGUrCKAH2gAyMzc4MDQ4MjgxOjhiNjIwM2YyNmQ5NzFmOGZhMTJlMjc4Mjk5NzY3NGQ3NmRjYmQyZWY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcGmlgLgFqTM2MjkyNzA3MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8b6203f26d971f8fa12e2782997674d76dcbd2ef", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/8b6203f26d971f8fa12e2782997674d76dcbd2ef", "committedDate": "2020-02-21T00:34:44Z", "message": "Updated performance tests to use DbClient and update feature scenarios text\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6749714f3ee4cc632eb32e1bc50c5305e466f0be", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/6749714f3ee4cc632eb32e1bc50c5305e466f0be", "committedDate": "2020-02-21T00:41:49Z", "message": "Updated logging in connectionhandler\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyNDAwNTM2", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/549#pullrequestreview-362400536", "createdAt": "2020-02-21T05:01:34Z", "commit": {"oid": "6749714f3ee4cc632eb32e1bc50c5305e466f0be"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQwNTowMTozNFrOFsrwFg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yMVQwNTowNTowN1rOFsrzRA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjM5ODQ4Ng==", "bodyText": "You don't need to insert all fields, just the required ones (entity_num, entity_realm, entity_shared, fk_entity_type_id). Id is auto generated. This keeps it from being too coupled.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/549#discussion_r382398486", "createdAt": "2020-02-21T05:01:34Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-grpc/src/test/java/com/hedera/mirror/grpc/jmeter/ConnectionHandler.java", "diffHunk": "@@ -66,9 +64,54 @@ private PostgresqlConnectionFactory getConnectionFactory() {\n         return connectionFactory;\n     }\n \n-    private PostgresqlConnection getConnection() {\n-        log.debug(\"Obtain PostgresqlConnection\");\n-        return getConnectionFactory().create().block(Duration.ofMillis(500));\n+    private DatabaseClient getClient() {\n+        return DatabaseClient.create(getConnectionFactory());\n+    }\n+\n+    public long createTopic() {\n+        long topicNum = getNextAvailableTopicID();\n+\n+        String entityInsertSql = \"insert into t_entities\"\n+                + \" (id, entity_num, entity_realm, entity_shard, fk_entity_type_id, key, ed25519_public_key_hex)\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6749714f3ee4cc632eb32e1bc50c5305e466f0be"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjM5OTMwMA==", "bodyText": "These two can be combined with an INSERT ... ON CONFLICT DO NOTHING", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/549#discussion_r382399300", "createdAt": "2020-02-21T05:05:07Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-grpc/src/test/java/com/hedera/mirror/grpc/jmeter/ConnectionHandler.java", "diffHunk": "@@ -77,6 +120,10 @@ public void insertTopicMessage(int newTopicsMessageCount, long topicNum, Instant\n             return;\n         }\n \n+        if (!topicExists(topicNum)) {\n+            topicNum = createTopic();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6749714f3ee4cc632eb32e1bc50c5305e466f0be"}, "originalPosition": 95}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f0c8bbf1abd790be8ff9c040afa1615285c6e0e9", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/f0c8bbf1abd790be8ff9c040afa1615285c6e0e9", "committedDate": "2020-02-21T17:58:13Z", "message": "Merge branch 'master' into integrationtestsfix\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "775271515c14271eda328d68eab4a52eb5bd6122", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/775271515c14271eda328d68eab4a52eb5bd6122", "committedDate": "2020-02-21T21:21:13Z", "message": "Addressed feedback by minimizing logic in create\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYyOTI3MDcx", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/549#pullrequestreview-362927071", "createdAt": "2020-02-21T21:26:59Z", "commit": {"oid": "775271515c14271eda328d68eab4a52eb5bd6122"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3262, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}