{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk2NDkyNzc1", "number": 637, "title": "Kubernetes", "bodyText": "Detailed description:\nOverall\n\nAdds GRPC, REST and Importer sub charts with a wrapper chart hedera-mirror. This allows clients to install just a single component or every component via the wrapper.\nAdds a highly available PostgreSQL 11.x using pgpool for load balancing and repmgr for automatic failover\nAdds Grafana with a handful of useful dashboards including a JVM specific one\nAdds Prometheus to store metrics and viewable via Grafana\nAdds Loki for centralized logging viewable via Grafana\nDon't run prettier/husky on charts and markdown files\n\nREST API\n\nAdd ability to automatically scale based upon metrics (Currently just CPU usage exceeds 80%, will need app metrics to properly calculate)\nFix inconsistent error responses by adding a standard error handler for all APIs\nFix error when DB is down to be 503 and a standard JSON error response\nFix returning 404 for database errors in some REST APIs\nFix logs too verbose by setting query logging to trace level\nChange log to stdout as containers require. Ops also wanted this so they could rotate logs using PM2\n\nGRPC API\n\nAdd ability to automatically scale based upon metrics (Currently just CPU usage exceeds 80%, will need additional metrics to properly calculate)\nAdd ability to export metrics to either Elasticsearch or Prometheus\nAdd hot reload of configuration properties via Kubernetes ConfigMaps\nAdd process thread and memory metrics\nFix shared poller not retrying with backoff when database is down (e.g. busy retry)\n\nImporter\n\nAdd high availability so multiple importers can run concurrently and only the leader downloads files\nAdd ability to export metrics to either Elasticsearch or Prometheus\nAdd hot reload of configuration properties via Kubernetes ConfigMaps\nAdd process thread and memory metrics\nFix importer db connection info warning about application name too long\n\nWhich issue(s) this PR fixes:\nFixes #346\nSpecial notes for your reviewer:\n\nThere's a couple of places where passwords are being stored in ConfigMaps and directly in values due to a limitation in the upstream chart. I will submit a PR upstream to address so it uses secrets.\nOther passwords are hardcoded to password or other values and should be overridden during client installations.\n\nTodo in follow up PRs:\n\nPriority classes\nMore documentation\nHelm chart tests\nE2E chart test in CI\nAdd an API gateway\nEnable network policies\nEnable pod security policies\nMarketplace\nInvestigate CockroachDB\nContinuous Deployment\nMigration plan\n\nChecklist\n\n Documentation added\n Tests updated", "createdAt": "2020-03-31T17:47:14Z", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/637", "merged": true, "mergeCommit": {"oid": "9bfb70a0f2fbc3dd2af2a94c840ed7c511d8469a"}, "closed": true, "closedAt": "2020-04-06T19:43:36Z", "author": {"login": "steven-sheehy"}, "timelineItems": {"totalCount": 32, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcS4HOvAH2gAyMzk2NDkyNzc1OmJjYWQxYTkxNjA0Y2Y2NGMwYTdlZWE3MWVkYzEwNWRlYTFmYzdiNGM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcVD7XZgFqTM4ODUzMjg0Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "bcad1a91604cf64c0a7eea71edc105dea1fc7b4c", "author": {"user": {"login": "steven-sheehy", "name": "Steven Sheehy"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/bcad1a91604cf64c0a7eea71edc105dea1fc7b4c", "committedDate": "2020-03-31T00:39:18Z", "message": "Add initial Helm chart with importer and GRPC\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c5555890a0a5e70b304297e057f1e8066f95b305", "author": {"user": {"login": "steven-sheehy", "name": "Steven Sheehy"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/c5555890a0a5e70b304297e057f1e8066f95b305", "committedDate": "2020-03-31T00:39:19Z", "message": "Add REST API to Helm chart\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "20b94c87ed21658cf56fa7fd86370b884c8b70d5", "author": {"user": {"login": "steven-sheehy", "name": "Steven Sheehy"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/20b94c87ed21658cf56fa7fd86370b884c8b70d5", "committedDate": "2020-03-31T00:39:19Z", "message": "Fix prettier corrupting helm files\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9af005f75b0d3c7085ce9601410d19b08ddbeac8", "author": {"user": {"login": "steven-sheehy", "name": "Steven Sheehy"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/9af005f75b0d3c7085ce9601410d19b08ddbeac8", "committedDate": "2020-03-31T00:39:19Z", "message": "Add HA to importer\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "72e2c77a748ee97e2d66c5c0b47c6896343cc014", "author": {"user": {"login": "steven-sheehy", "name": "Steven Sheehy"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/72e2c77a748ee97e2d66c5c0b47c6896343cc014", "committedDate": "2020-03-31T00:39:20Z", "message": "Add Prometheus\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9914303efdafb9a86e3e60c179dd5b7edc612c9a", "author": {"user": {"login": "steven-sheehy", "name": "Steven Sheehy"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/9914303efdafb9a86e3e60c179dd5b7edc612c9a", "committedDate": "2020-03-31T00:39:20Z", "message": "Add Prometheus Adapter\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "446a7b3ea41ebd70288407123e097ccf5a3b57da", "author": {"user": {"login": "steven-sheehy", "name": "Steven Sheehy"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/446a7b3ea41ebd70288407123e097ccf5a3b57da", "committedDate": "2020-03-31T00:39:20Z", "message": "Add Horizontal Pod Autoscaling to GRPC and REST\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2dd13662043e538d360ac2820d2499408097483a", "author": {"user": {"login": "steven-sheehy", "name": "Steven Sheehy"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/2dd13662043e538d360ac2820d2499408097483a", "committedDate": "2020-03-31T00:39:20Z", "message": "Add centralized logging via Loki\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fe7ecc6155b65ecbf41e2e358a627bc5ce5f1f2c", "author": {"user": {"login": "steven-sheehy", "name": "Steven Sheehy"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/fe7ecc6155b65ecbf41e2e358a627bc5ce5f1f2c", "committedDate": "2020-03-31T00:39:20Z", "message": "Add ability to refresh properties from configmap\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b0d8662b441a156425d3830859dc735b6e2e0257", "author": {"user": {"login": "steven-sheehy", "name": "Steven Sheehy"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/b0d8662b441a156425d3830859dc735b6e2e0257", "committedDate": "2020-03-31T00:48:58Z", "message": "Return proper response/code for REST when db is down\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f6534281253c997968d6a4278a4cc0049ab9cd79", "author": {"user": {"login": "steven-sheehy", "name": "Steven Sheehy"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/f6534281253c997968d6a4278a4cc0049ab9cd79", "committedDate": "2020-03-31T00:49:04Z", "message": "Fix busy retry in shared poller\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c173755fb6caedbb03cd3c7eabc8dd47b94a4ec", "author": {"user": {"login": "steven-sheehy", "name": "Steven Sheehy"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/5c173755fb6caedbb03cd3c7eabc8dd47b94a4ec", "committedDate": "2020-03-31T03:24:43Z", "message": "Switch to postgresql-ha chart\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "985a57f6fee2f1d7f1e471a6fc4c94f78e0c0cfa", "author": {"user": {"login": "steven-sheehy", "name": "Steven Sheehy"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/985a57f6fee2f1d7f1e471a6fc4c94f78e0c0cfa", "committedDate": "2020-03-31T17:32:41Z", "message": "Fix scaling down deployments on upgrade\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d2273ad7fbc6f02bead01432f8991ba4f18323f", "author": {"user": {"login": "steven-sheehy", "name": "Steven Sheehy"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/3d2273ad7fbc6f02bead01432f8991ba4f18323f", "committedDate": "2020-03-31T17:46:14Z", "message": "Disable AlertManager for now\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6f89c9d0f1edc18da1afc60d0808a9c51b78b2bb", "author": {"user": {"login": "steven-sheehy", "name": "Steven Sheehy"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/6f89c9d0f1edc18da1afc60d0808a9c51b78b2bb", "committedDate": "2020-03-31T21:45:24Z", "message": "Merge remote-tracking branch 'origin/master' into kubernetes\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "46f9cb510d7d4f113092bfbcda67f3497a3d62c9", "author": {"user": {"login": "steven-sheehy", "name": "Steven Sheehy"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/46f9cb510d7d4f113092bfbcda67f3497a3d62c9", "committedDate": "2020-04-01T04:23:54Z", "message": "Add dependent chart artifacts\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d9eb0d0a7189604fb245e4139ac9761cb4922e00", "author": {"user": {"login": "steven-sheehy", "name": "Steven Sheehy"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/d9eb0d0a7189604fb245e4139ac9761cb4922e00", "committedDate": "2020-04-01T04:09:46Z", "message": "Add dependent chart artifacts\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>"}, "afterCommit": {"oid": "46f9cb510d7d4f113092bfbcda67f3497a3d62c9", "author": {"user": {"login": "steven-sheehy", "name": "Steven Sheehy"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/46f9cb510d7d4f113092bfbcda67f3497a3d62c9", "committedDate": "2020-04-01T04:23:54Z", "message": "Add dependent chart artifacts\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "62ed93b2d11eec7f3c983aab3e4510ed02f8c546", "author": {"user": {"login": "steven-sheehy", "name": "Steven Sheehy"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/62ed93b2d11eec7f3c983aab3e4510ed02f8c546", "committedDate": "2020-04-01T04:38:36Z", "message": "Fix tests\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>"}, "afterCommit": {"oid": "4c1cce8e1ba69dff56b3a7cbc5bb2e29e05805ba", "author": {"user": {"login": "steven-sheehy", "name": "Steven Sheehy"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/4c1cce8e1ba69dff56b3a7cbc5bb2e29e05805ba", "committedDate": "2020-04-01T04:48:21Z", "message": "Fix tests\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4c1cce8e1ba69dff56b3a7cbc5bb2e29e05805ba", "author": {"user": {"login": "steven-sheehy", "name": "Steven Sheehy"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/4c1cce8e1ba69dff56b3a7cbc5bb2e29e05805ba", "committedDate": "2020-04-01T04:48:21Z", "message": "Fix tests\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>"}, "afterCommit": {"oid": "52ef9d0735684611c8aad62f7625a5576f759fe1", "author": {"user": {"login": "steven-sheehy", "name": "Steven Sheehy"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/52ef9d0735684611c8aad62f7625a5576f759fe1", "committedDate": "2020-04-01T04:52:13Z", "message": "Fix tests\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3a9b53bde87a9836e2c62068383d6c6eb83afab0", "author": {"user": {"login": "steven-sheehy", "name": "Steven Sheehy"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/3a9b53bde87a9836e2c62068383d6c6eb83afab0", "committedDate": "2020-04-01T04:55:24Z", "message": "Fix tests\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "52ef9d0735684611c8aad62f7625a5576f759fe1", "author": {"user": {"login": "steven-sheehy", "name": "Steven Sheehy"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/52ef9d0735684611c8aad62f7625a5576f759fe1", "committedDate": "2020-04-01T04:52:13Z", "message": "Fix tests\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>"}, "afterCommit": {"oid": "3a9b53bde87a9836e2c62068383d6c6eb83afab0", "author": {"user": {"login": "steven-sheehy", "name": "Steven Sheehy"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/3a9b53bde87a9836e2c62068383d6c6eb83afab0", "committedDate": "2020-04-01T04:55:24Z", "message": "Fix tests\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "40490d48ed4210450ac93848958711806c42ad09", "author": {"user": {"login": "steven-sheehy", "name": "Steven Sheehy"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/40490d48ed4210450ac93848958711806c42ad09", "committedDate": "2020-04-01T20:56:40Z", "message": "Bump version to 0.8.1\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f12766af499366c252b00bab86cf996817615c29", "author": {"user": {"login": "steven-sheehy", "name": "Steven Sheehy"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/f12766af499366c252b00bab86cf996817615c29", "committedDate": "2020-04-01T20:56:52Z", "message": "Merge remote-tracking branch 'origin/master' into kubernetes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2MDE0NzA2", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/637#pullrequestreview-386014706", "createdAt": "2020-04-01T23:21:45Z", "commit": {"oid": "f12766af499366c252b00bab86cf996817615c29"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQyMzoyMTo0NVrOF_WDug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wMVQyMzozMjowMFrOF_WQdA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTk2NjAxMA==", "bodyText": "nit: The above command.\nI read \"This command\" as referring to the command below", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/637#discussion_r401966010", "createdAt": "2020-04-01T23:21:45Z", "author": {"login": "Nana-EC"}, "path": "charts/README.md", "diffHunk": "@@ -0,0 +1,34 @@\n+# Helm Chart\n+\n+Installs the Hedera Mirror Node Helm wrapper chart. This chart will install the three mirror node components:\n+\n+- [Hedera Mirror Importer](hedera-mirror-importer)\n+- [Hedera Mirror GRPC API](hedera-mirror-importer)\n+- [Hedera Mirror REST API](hedera-mirror-importer)\n+\n+## Requirements\n+\n+- [Helm 3](https://helm.sh)\n+- [Kubernetes 1.17+](https://kubernetes.io)\n+\n+## Install\n+\n+To install the wrapper chart with a release name of `mirror`:\n+\n+```shell script\n+$ helm upgrade --install mirror charts/hedera-mirror\n+```\n+\n+## Uninstall\n+\n+To remove all the Kubernetes components associated with the chart and delete the release:\n+\n+```shell script\n+$ helm delete mirror\n+```\n+\n+This command does not delete any of the underlying persistent volumes. To delete all the data associated with this release:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f12766af499366c252b00bab86cf996817615c29"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTk2NjQ5Ng==", "bodyText": "q: Did you want to add a diagnostics section or add to the current diagnostics section the kubectl comments for viewing service status and basic logs", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/637#discussion_r401966496", "createdAt": "2020-04-01T23:23:16Z", "author": {"login": "Nana-EC"}, "path": "charts/README.md", "diffHunk": "@@ -0,0 +1,34 @@\n+# Helm Chart\n+\n+Installs the Hedera Mirror Node Helm wrapper chart. This chart will install the three mirror node components:\n+\n+- [Hedera Mirror Importer](hedera-mirror-importer)\n+- [Hedera Mirror GRPC API](hedera-mirror-importer)\n+- [Hedera Mirror REST API](hedera-mirror-importer)\n+\n+## Requirements\n+\n+- [Helm 3](https://helm.sh)\n+- [Kubernetes 1.17+](https://kubernetes.io)\n+\n+## Install\n+\n+To install the wrapper chart with a release name of `mirror`:\n+\n+```shell script\n+$ helm upgrade --install mirror charts/hedera-mirror\n+```\n+\n+## Uninstall\n+\n+To remove all the Kubernetes components associated with the chart and delete the release:\n+\n+```shell script\n+$ helm delete mirror\n+```\n+\n+This command does not delete any of the underlying persistent volumes. To delete all the data associated with this release:\n+\n+```shell script\n+$ kubectl delete $(kubectl get pvc -o name)\n+```", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f12766af499366c252b00bab86cf996817615c29"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTk2OTI2OA==", "bodyText": "q: is there somewhere this is specified once and centrally so places like this can call them and not have string hard coded?", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/637#discussion_r401969268", "createdAt": "2020-04-01T23:32:00Z", "author": {"login": "Nana-EC"}, "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/record/PostgresWritingRecordParsedItemHandler.java", "diffHunk": "@@ -101,7 +101,7 @@ private void initConnectionAndStatements() throws ParserSQLException {\n         try {\n             connection = dataSource.getConnection();\n             connection.setAutoCommit(false); // do not auto-commit\n-            connection.setClientInfo(\"ApplicationName\", getClass().getCanonicalName());\n+            connection.setClientInfo(\"ApplicationName\", \"hedera-mirror-importer\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f12766af499366c252b00bab86cf996817615c29"}, "originalPosition": 37}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "06d0456e80c1f5d1d242f219acb6bb3e8c485f6b", "author": {"user": {"login": "steven-sheehy", "name": "Steven Sheehy"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/06d0456e80c1f5d1d242f219acb6bb3e8c485f6b", "committedDate": "2020-04-02T16:13:07Z", "message": "Bump Flyway connectRetries to avoid crashing importer on initial start\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "204ca5f7f71469c7012baf4e898e5cbbab768046", "author": {"user": {"login": "steven-sheehy", "name": "Steven Sheehy"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/204ca5f7f71469c7012baf4e898e5cbbab768046", "committedDate": "2020-04-02T16:39:16Z", "message": "Review feedback\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg2ODY4MDgw", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/637#pullrequestreview-386868080", "createdAt": "2020-04-03T00:37:02Z", "commit": {"oid": "204ca5f7f71469c7012baf4e898e5cbbab768046"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3NTg2NDAy", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/637#pullrequestreview-387586402", "createdAt": "2020-04-03T21:17:56Z", "commit": {"oid": "204ca5f7f71469c7012baf4e898e5cbbab768046"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3NjAzMDYw", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/637#pullrequestreview-387603060", "createdAt": "2020-04-03T21:55:15Z", "commit": {"oid": "204ca5f7f71469c7012baf4e898e5cbbab768046"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3Njc5MTg3", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/637#pullrequestreview-387679187", "createdAt": "2020-04-04T08:15:05Z", "commit": {"oid": "204ca5f7f71469c7012baf4e898e5cbbab768046"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg3Njc5MjI2", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/637#pullrequestreview-387679226", "createdAt": "2020-04-04T08:15:39Z", "commit": {"oid": "204ca5f7f71469c7012baf4e898e5cbbab768046"}, "state": "COMMENTED", "comments": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNFQwODoxNTozOVrOGAwIdw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQwODoyMToxM1rOGBMskw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzQ0MTc4Mw==", "bodyText": "links need fixing.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/637#discussion_r403441783", "createdAt": "2020-04-04T08:15:39Z", "author": {"login": "apeksharma"}, "path": "charts/README.md", "diffHunk": "@@ -0,0 +1,65 @@\n+# Helm Chart\n+\n+Installs the Hedera Mirror Node Helm wrapper chart. This chart will install the three mirror node components:\n+\n+- [Hedera Mirror Importer](hedera-mirror-importer)\n+- [Hedera Mirror GRPC API](hedera-mirror-importer)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "204ca5f7f71469c7012baf4e898e5cbbab768046"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzQ0MjI1OQ==", "bodyText": "We should consistently use either \"Hedera\" or \"Hedera Hashgraph\".\nWe use \"Hedera Mirror Node\" everywhere else including project's readme, so would prefer that.\nSame in Chart.yaml for rest api.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/637#discussion_r403442259", "createdAt": "2020-04-04T08:21:14Z", "author": {"login": "apeksharma"}, "path": "charts/hedera-mirror-grpc/Chart.yaml", "diffHunk": "@@ -0,0 +1,9 @@\n+apiVersion: v1\n+appVersion: 0.8.1\n+description: GRPC API for Hedera Hashgraph Mirror Nodes", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "204ca5f7f71469c7012baf4e898e5cbbab768046"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzQ0MzQ3Ng==", "bodyText": "Earlier, prod logs were in /opt/restapi/logs, what command will i need to see the logs now?\nLet's update docs too.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/637#discussion_r403443476", "createdAt": "2020-04-04T08:35:53Z", "author": {"login": "apeksharma"}, "path": "hedera-mirror-rest/server.js", "diffHunk": "@@ -58,8 +58,7 @@ if (port === undefined || isNaN(Number(port))) {\n log4js.configure({\n   appenders: {\n     everything: {\n-      type: 'file',\n-      filename: '../logs/hedera_mirrornode_api_' + port + '.log' // ensure port is a legit number above\n+      type: 'stdout'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "204ca5f7f71469c7012baf4e898e5cbbab768046"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzg0Nzk4OQ==", "bodyText": "Please add extra lines for improving readability here. For eg. https://github.com/helm/charts/blob/master/stable/chartmuseum/templates/NOTES.txt\nSimilarly for other NOTES.txt.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/637#discussion_r403847989", "createdAt": "2020-04-06T06:07:00Z", "author": {"login": "apeksharma"}, "path": "charts/hedera-mirror-grpc/templates/NOTES.txt", "diffHunk": "@@ -0,0 +1,13 @@\n+Get the GRPC service endpoint by running these commands:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "204ca5f7f71469c7012baf4e898e5cbbab768046"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzg3NDEzOA==", "bodyText": "please add a comment here why importer is headless service", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/637#discussion_r403874138", "createdAt": "2020-04-06T07:14:38Z", "author": {"login": "apeksharma"}, "path": "charts/hedera-mirror-importer/templates/service-headless.yaml", "diffHunk": "@@ -0,0 +1,13 @@\n+apiVersion: v1", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "204ca5f7f71469c7012baf4e898e5cbbab768046"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzg3NTkwOQ==", "bodyText": "nice.\nIs auto-scaling configurable on user params too? Say we find that grpc or rest is network bound rather than cpu, can it use a user metrics (say exposed on a port) to auto scale. Just curious.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/637#discussion_r403875909", "createdAt": "2020-04-06T07:18:26Z", "author": {"login": "apeksharma"}, "path": "charts/hedera-mirror-grpc/values.yaml", "diffHunk": "@@ -0,0 +1,104 @@\n+affinity:\n+  podAntiAffinity:\n+    preferredDuringSchedulingIgnoredDuringExecution:\n+      - weight: 100\n+        podAffinityTerm:\n+          topologyKey: kubernetes.io/hostname\n+          labelSelector:\n+            matchLabels:\n+              app.kubernetes.io/name: grpc\n+\n+annotations: {}\n+\n+config: {}\n+\n+fullnameOverride: \"\"\n+\n+global:\n+  namespaceOverride: \"\"\n+\n+hpa:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "204ca5f7f71469c7012baf4e898e5cbbab768046"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzg4MjgwNA==", "bodyText": "Should the name be hedera-mirror-grpc.serviceAccountName?\nIf service account is never used without rbac.enabled, we should be able to remove the serviceAccount.create?\nBoth true or false case be covered by single flag.\nrbac.enabled=false and serviceAccount.create=true seems not useful\nrbac.enabled=true and serviceAccount.create=false can lead to failure if new name is specified.\nRight now the 2x2x2 cases arising from rbac.enabled = {true,false}, serviceAccount.create={true,false}, and serviceAccount.name = {set/not set},\nand 2x2 case to just determine final value for serviceAccount.name .....seems more complex than needed.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/637#discussion_r403882804", "createdAt": "2020-04-06T07:32:07Z", "author": {"login": "apeksharma"}, "path": "charts/hedera-mirror-grpc/templates/rolebinding.yaml", "diffHunk": "@@ -0,0 +1,16 @@\n+{{- if .Values.rbac.enabled -}}\n+apiVersion: rbac.authorization.k8s.io/v1\n+kind: RoleBinding\n+metadata:\n+  labels:\n+    {{- include \"hedera-mirror-grpc.labels\" . | nindent 4 }}\n+  name: {{ include \"hedera-mirror-grpc.fullname\" . }}\n+  namespace: {{ include \"hedera-mirror-grpc.namespace\" . }}\n+roleRef:\n+  apiGroup: rbac.authorization.k8s.io\n+  kind: Role\n+  name: {{ include \"hedera-mirror-grpc.fullname\" . }}\n+subjects:\n+- kind: ServiceAccount", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "204ca5f7f71469c7012baf4e898e5cbbab768046"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzkwMzI1Mg==", "bodyText": "We should flag protect postgres' resource creation since they won't be initialized in prod and we are not going to migrate off cloud sql anytime soon. The flag itself can be true by default to have single command deployment (for anyone playing with mirror node).", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/637#discussion_r403903252", "createdAt": "2020-04-06T08:10:00Z", "author": {"login": "apeksharma"}, "path": "charts/hedera-mirror/templates/configmap.yaml", "diffHunk": "@@ -0,0 +1,24 @@\n+# This file is temporarily a ConfigMap until I can make changes with the upstream chart", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "204ca5f7f71469c7012baf4e898e5cbbab768046"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzkwOTc3OQ==", "bodyText": "why do we need to checkin tgz files?\nDidn't see them checked-in in couple projects i saw.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/637#discussion_r403909779", "createdAt": "2020-04-06T08:21:13Z", "author": {"login": "apeksharma"}, "path": "charts/hedera-mirror/requirements.lock", "diffHunk": "@@ -0,0 +1,24 @@\n+dependencies:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "204ca5f7f71469c7012baf4e898e5cbbab768046"}, "originalPosition": 1}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4NTMyODQz", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/637#pullrequestreview-388532843", "createdAt": "2020-04-06T18:59:45Z", "commit": {"oid": "204ca5f7f71469c7012baf4e898e5cbbab768046"}, "state": "APPROVED", "comments": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQxODo1OTo0NVrOGBlroA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wNlQxOTozMjoyNlrOGBmyHw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDMxOTEzNg==", "bodyText": "all point to importer", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/637#discussion_r404319136", "createdAt": "2020-04-06T18:59:45Z", "author": {"login": "apeksharma"}, "path": "charts/README.md", "diffHunk": "@@ -0,0 +1,65 @@\n+# Helm Chart\n+\n+Installs the Hedera Mirror Node Helm wrapper chart. This chart will install the three mirror node components:\n+\n+- [Hedera Mirror Importer](hedera-mirror-importer)\n+- [Hedera Mirror GRPC API](hedera-mirror-importer)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzQ0MTc4Mw=="}, "originalCommit": {"oid": "204ca5f7f71469c7012baf4e898e5cbbab768046"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDMxOTU5MA==", "bodyText": "that'd be good :)", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/637#discussion_r404319590", "createdAt": "2020-04-06T19:00:36Z", "author": {"login": "apeksharma"}, "path": "charts/hedera-mirror-grpc/Chart.yaml", "diffHunk": "@@ -0,0 +1,9 @@\n+apiVersion: v1\n+appVersion: 0.8.1\n+description: GRPC API for Hedera Hashgraph Mirror Nodes", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzQ0MjI1OQ=="}, "originalCommit": {"oid": "204ca5f7f71469c7012baf4e898e5cbbab768046"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDMyMDU4Ng==", "bodyText": "i see. Thanks for the explanation.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/637#discussion_r404320586", "createdAt": "2020-04-06T19:02:26Z", "author": {"login": "apeksharma"}, "path": "charts/hedera-mirror-grpc/templates/rolebinding.yaml", "diffHunk": "@@ -0,0 +1,16 @@\n+{{- if .Values.rbac.enabled -}}\n+apiVersion: rbac.authorization.k8s.io/v1\n+kind: RoleBinding\n+metadata:\n+  labels:\n+    {{- include \"hedera-mirror-grpc.labels\" . | nindent 4 }}\n+  name: {{ include \"hedera-mirror-grpc.fullname\" . }}\n+  namespace: {{ include \"hedera-mirror-grpc.namespace\" . }}\n+roleRef:\n+  apiGroup: rbac.authorization.k8s.io\n+  kind: Role\n+  name: {{ include \"hedera-mirror-grpc.fullname\" . }}\n+subjects:\n+- kind: ServiceAccount", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzg4MjgwNA=="}, "originalCommit": {"oid": "204ca5f7f71469c7012baf4e898e5cbbab768046"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDMyMjIyMw==", "bodyText": "Missed that flag. All good.\nI don't mind extra configmaps as long as pods are not deployed when postgres is disabled.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/637#discussion_r404322223", "createdAt": "2020-04-06T19:05:21Z", "author": {"login": "apeksharma"}, "path": "charts/hedera-mirror/templates/configmap.yaml", "diffHunk": "@@ -0,0 +1,24 @@\n+# This file is temporarily a ConfigMap until I can make changes with the upstream chart", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzkwMzI1Mg=="}, "originalCommit": {"oid": "204ca5f7f71469c7012baf4e898e5cbbab768046"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDMyNjk5Mw==", "bodyText": "Fair enough reason to keep them. Please add it to README (or requirements.yaml. Some please where explorative souls can find it)\nI just believe in commenting the hack out of anything non-obvious, or debatable, or out of ordinary. :D\nIn this case, if it falls in debatable category, would appreciate if we add one.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/637#discussion_r404326993", "createdAt": "2020-04-06T19:13:48Z", "author": {"login": "apeksharma"}, "path": "charts/hedera-mirror/requirements.lock", "diffHunk": "@@ -0,0 +1,24 @@\n+dependencies:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzkwOTc3OQ=="}, "originalCommit": {"oid": "204ca5f7f71469c7012baf4e898e5cbbab768046"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDMyODY2MQ==", "bodyText": "Does it make sense since there is only one instance? If yes, please add a comment to the file too.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/637#discussion_r404328661", "createdAt": "2020-04-06T19:16:46Z", "author": {"login": "apeksharma"}, "path": "charts/hedera-mirror-importer/values.yaml", "diffHunk": "@@ -0,0 +1,111 @@\n+affinity:\n+  podAntiAffinity:\n+    preferredDuringSchedulingIgnoredDuringExecution:\n+      - weight: 100\n+        podAffinityTerm:\n+          topologyKey: kubernetes.io/hostname\n+          labelSelector:\n+            matchLabels:\n+              app.kubernetes.io/name: importer\n+\n+annotations: {}\n+\n+config:\n+  hedera:\n+    mirror:\n+      dataPath: /var/lib/hedera-mirror-importer\n+\n+fullnameOverride: \"\"\n+\n+global:\n+  namespaceOverride: \"\"\n+\n+image:\n+  pullPolicy: IfNotPresent\n+  repository: gcr.io/mirrornode/hedera-mirror-importer\n+  tag: 0.8.1\n+\n+imagePullSecrets: []\n+\n+labels:\n+  role: app\n+\n+livenessProbe:\n+  httpGet:\n+    path: /actuator/health\n+    port: http\n+  initialDelaySeconds: 60\n+  periodSeconds: 30\n+  timeoutSeconds: 2\n+\n+nameOverride: \"\"\n+\n+networkPolicy:\n+  enabled: false\n+\n+nodeSelector: {}\n+\n+persistence:\n+  accessModes:\n+    - ReadWriteOnce\n+  annotations: {}\n+  enabled: true\n+  size: 10Gi\n+  storageClass: standard\n+\n+podManagementPolicy: OrderedReady\n+\n+podSecurityContext:\n+  fsGroup: 1000\n+\n+priorityClassName: \"\"\n+\n+rbac:\n+  enabled: true\n+\n+readinessProbe:\n+  httpGet:\n+    path: /actuator/health\n+    port: http\n+  initialDelaySeconds: 60\n+  timeoutSeconds: 2\n+\n+replicas: 1\n+\n+resources:\n+  limits:\n+    cpu: 500m\n+    memory: 750Mi\n+  requests:\n+    cpu: 200m\n+    memory: 256Mi\n+\n+revisionHistoryLimit: 3\n+\n+securityContext:\n+  capabilities:\n+    drop: [ALL]\n+  readOnlyRootFilesystem: true\n+  runAsGroup: 1000\n+  runAsNonRoot: true\n+  runAsUser: 1000\n+\n+service:\n+  port: 8080\n+  type: ClusterIP\n+\n+serviceAccount:\n+  create: true\n+  # The name of the service account to use. If not set and create is true, a name is generated using the fullname template\n+  name:\n+\n+serviceMonitor:\n+  enabled: true\n+  interval: 30s\n+\n+terminationGracePeriodSeconds: 30\n+\n+tolerations: []\n+\n+updateStrategy:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "204ca5f7f71469c7012baf4e898e5cbbab768046"}, "originalPosition": 110}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDMzMTI5Mw==", "bodyText": "beta version made me nervous. But seems like it has been in beta since 1.15 and the requirements to graduate are some extra testing and additional features. So i guess it's okay.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/637#discussion_r404331293", "createdAt": "2020-04-06T19:21:31Z", "author": {"login": "apeksharma"}, "path": "charts/hedera-mirror-importer/templates/pdb.yaml", "diffHunk": "@@ -0,0 +1,12 @@\n+apiVersion: policy/v1beta1", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "204ca5f7f71469c7012baf4e898e5cbbab768046"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDMzNzE4Mw==", "bodyText": "Please add class comment.\nIf there's a default example/source from where the code was forked, it'd be good to add that too. Just makes reviewing (or understanding code in general for anyone in future), lot easier.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/637#discussion_r404337183", "createdAt": "2020-04-06T19:32:26Z", "author": {"login": "apeksharma"}, "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/leader/LeaderAspect.java", "diffHunk": "@@ -0,0 +1,68 @@\n+package com.hedera.mirror.importer.leader;\n+/*-\n+ * \u200c\n+ * Hedera Mirror Node\n+ * \u200b\n+ * Copyright (C) 2019 - 2020 Hedera Hashgraph, LLC\n+ * \u200b\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ * \u200d\n+ */\n+\n+import lombok.extern.log4j.Log4j2;\n+import org.aspectj.lang.ProceedingJoinPoint;\n+import org.aspectj.lang.annotation.Around;\n+import org.aspectj.lang.annotation.Aspect;\n+import org.springframework.context.event.EventListener;\n+import org.springframework.core.annotation.Order;\n+import org.springframework.integration.leader.event.OnGrantedEvent;\n+import org.springframework.integration.leader.event.OnRevokedEvent;\n+\n+@Aspect\n+@Log4j2\n+@Order(1)\n+public class LeaderAspect {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "204ca5f7f71469c7012baf4e898e5cbbab768046"}, "originalPosition": 34}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3362, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}