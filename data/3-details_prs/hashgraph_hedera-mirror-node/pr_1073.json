{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkxMTY2MDY5", "number": 1073, "title": "HTS: DB schema changes", "bodyText": "Detailed description:\nTo support HTS the database must be able to\n\nPersist HTS Token transactions from record stream rcd files from the mainnet and persist information to the database\nPersist account token balances from balance stream  CSV files from the mainnet and persist to the database\n\nThis PR\n\nAdds token entity type to t_entity_types table\nUpdates t_transaction_types with token transaction types and unchecked submit\nUpdates t_transaction_results with token transaction type results\nAddstoken table to hold token properties\nAdds token_account table to capture token-account info such as frozen, kyc and wipe status\nAdds token_balance table to capture token account balances\nAdds token_transfer to capture token only transfers\n\nWhich issue(s) this PR fixes:\nFixes #1048\nSpecial notes for your reviewer:\n\nThe service may see some additional changes on the transaction type, these can be added before sprint end\nThese changes are captured in #1061\n\nChecklist\n\n Documentation added\n Tests updated", "createdAt": "2020-09-22T20:05:09Z", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1073", "merged": true, "mergeCommit": {"oid": "57ada0e2ed99873bab8d879c64c3f79e6ed482e6"}, "closed": true, "closedAt": "2020-09-23T23:07:19Z", "author": {"login": "Nana-EC"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdLdj81gH2gAyNDkxMTY2MDY5Ojk5MGEzOTU0MjhkYzUyOWI5NTAxZDk4OGQxNDA3OGNmMjdiNjQ3OTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdL0xPbgFqTQ5NTEwNDM5Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "990a395428dc529b9501d988d14078cf27b64792", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/990a395428dc529b9501d988d14078cf27b64792", "committedDate": "2020-09-22T19:56:55Z", "message": "DB Schema CHanges to Support HTS\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkzODQ1ODk5", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1073#pullrequestreview-493845899", "createdAt": "2020-09-22T21:04:51Z", "commit": {"oid": "990a395428dc529b9501d988d14078cf27b64792"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQyMTowNDo1MVrOHWMV_A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQyMTowNDo1MVrOHWMV_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzAzMjk1Ng==", "bodyText": "Should be on consensus_timestamp only\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 on token_transfer (token_id desc, account_id desc, consensus_timestamp desc);\n          \n          \n            \n                 on token_transfer (consensus_timestamp desc);", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1073#discussion_r493032956", "createdAt": "2020-09-22T21:04:51Z", "author": {"login": "Nana-EC"}, "path": "hedera-mirror-importer/src/main/resources/db/migration/V1.30.1__hts_support.sql", "diffHunk": "@@ -0,0 +1,117 @@\n+-------------------\n+-- Support hts transactions\n+-------------------\n+\n+-- Add new token entity type\n+insert into t_entity_types (id, name) values (5, 'token');\n+\n+-- Add new hts transaction body types\n+insert into t_transaction_types (proto_id, name) values\n+    (28, 'UNCHECKEDSUBMIT'),\n+    (29, 'TOKENCREATE'),\n+    (30, 'TOKENTRANSFER'),\n+    (31, 'TOKENFREEZE'),\n+    (32, 'TOKENUNFREEZE'),\n+    (33, 'TOKENGRANTKYC'),\n+    (34, 'TOKENREVOKEKYC'),\n+    (35, 'TOKENDELETE'),\n+    (36, 'TOKENUPDATE'),\n+    (37, 'TOKENMINT'),\n+    (38, 'TOKENBURN'),\n+    (39, 'TOKENWIPE');\n+\n+-- Add hts transaction result types\n+insert into t_transaction_results (proto_id, result) values\n+    (165, 'ACCOUNT_FROZEN_FOR_TOKEN'),\n+    (166, 'TOKENS_PER_ACCOUNT_LIMIT_EXCEEDED'),\n+    (167, 'INVALID_TOKEN_ID'),\n+    (168, 'INVALID_TOKEN_DIVISIBILITY'),\n+    (169, 'INVALID_TOKEN_FLOAT'),\n+    (170, 'INVALID_TREASURY_ACCOUNT_FOR_TOKEN'),\n+    (171, 'INVALID_TOKEN_SYMBOL'),\n+    (172, 'TOKEN_HAS_NO_FREEZE_KEY'),\n+    (173, 'TRANSFERS_NOT_ZERO_SUM_FOR_TOKEN'),\n+    (174, 'MISSING_TOKEN_SYMBOL'),\n+    (175, 'TOKEN_SYMBOL_TOO_LONG'),\n+    (176, 'TOKEN_SYMBOL_ALREADY_IN_USE'),\n+    (177, 'INVALID_TOKEN_REF'),\n+    (178, 'ACCOUNT_KYC_NOT_GRANTED_FOR_TOKEN'),\n+    (179, 'TOKEN_HAS_NO_KYC_KEY'),\n+    (180, 'INSUFFICIENT_TOKEN_BALANCE'),\n+    (181, 'TOKEN_WAS_DELETED'),\n+    (182, 'TOKEN_HAS_NO_SUPPLY_KEY'),\n+    (183, 'TOKEN_HAS_NO_WIPE_KEY'),\n+    (184, 'INVALID_TOKEN_MINT_AMOUNT'),\n+    (185, 'INVALID_TOKEN_BURN_AMOUNT'),\n+    (186, 'ACCOUNT_HAS_NO_TOKEN_RELATIONSHIP'),\n+    (187, 'CANNOT_WIPE_TOKEN_TREASURY_ACCOUNT'),\n+    (188, 'INVALID_KYC_KEY'),\n+    (189, 'INVALID_WIPE_KEY'),\n+    (190, 'INVALID_FREEZE_KEY'),\n+    (191, 'INVALID_SUPPLY_KEY'),\n+    (192, 'INVALID_TOKEN_EXPIRY'),\n+    (193, 'TOKEN_HAS_EXPIRED'),\n+    (194, 'TOKEN_IS_IMMUTABlE');\n+\n+-- Add token table to hold token properties\n+create table if not exists token\n+(\n+    token_id            entity_id               primary key,\n+    create_timestamp    bigint                  not null,\n+    divisibility        bigint                  not null,\n+    freeze_default      boolean                 not null,\n+    freeze_key          bytea,\n+    initial_supply      bigint                  not null,\n+    kyc_default         boolean                 not null,\n+    kyc_key             bytea,\n+    modify_timestamp    bigint,\n+    supply_key          bytea,\n+    symbol              character varying(100)  not null,\n+    treasury_account_id entity_id               not null,\n+    wipe_key            bytea\n+);\n+\n+--- Add token_account table to capture token-account info such as frozen, kyc and wipe status\n+create table if not exists token_account\n+(\n+    id                  serial              primary key,\n+    account_id          entity_id           not null,\n+    create_timestamp    bigint              not null,\n+    frozen              boolean             not null,\n+    kyc                 boolean             not null,\n+    modify_timestamp    bigint              not null,\n+    token_id            entity_id           not null,\n+    wiped               boolean             not null default false\n+);\n+\n+create unique index if not exists token_account__token_account on token_account(token_id, account_id);\n+\n+create index if not exists token_account__token_account_timestamp\n+     on token_account (token_id desc, account_id desc, create_timestamp desc);\n+\n+--- Add token_balance table to capture token account balances\n+create table if not exists token_balance\n+(\n+    consensus_timestamp bigint              primary key not null,\n+    account_id          entity_id           not null,\n+    balance             bigint              not null,\n+    token_id            entity_id           not null\n+);\n+\n+create index if not exists token_balance__token_account_timestamp\n+     on token_balance (token_id desc, account_id desc, consensus_timestamp desc);\n+\n+--- Add token_transfer\n+create table if not exists token_transfer\n+(\n+    token_id            entity_id,\n+    account_id          entity_id,\n+    consensus_timestamp bigint,\n+    amount              hbar_tinybars\n+);\n+\n+create index if not exists token_transfer__timestamp\n+     on token_transfer (token_id desc, account_id desc, consensus_timestamp desc);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "990a395428dc529b9501d988d14078cf27b64792"}, "originalPosition": 114}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkzODQ2NjI3", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1073#pullrequestreview-493846627", "createdAt": "2020-09-22T21:05:59Z", "commit": {"oid": "990a395428dc529b9501d988d14078cf27b64792"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQyMTowNTo1OVrOHWMYHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQyMTowNTo1OVrOHWMYHA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzAzMzUwMA==", "bodyText": "Thought I had removed this to be left for Importer tasks to add.\nWill remove", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1073#discussion_r493033500", "createdAt": "2020-09-22T21:05:59Z", "author": {"login": "Nana-EC"}, "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/converter/TokenIdConverter.java", "diffHunk": "@@ -0,0 +1,35 @@\n+package com.hedera.mirror.importer.converter;\n+\n+/*-\n+ * \u200c\n+ * Hedera Mirror Node\n+ * \u200b\n+ * Copyright (C) 2019 - 2020 Hedera Hashgraph, LLC\n+ * \u200b\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ * \u200d\n+ */\n+\n+import javax.inject.Named;\n+import org.springframework.boot.context.properties.ConfigurationPropertiesBinding;\n+\n+import com.hedera.mirror.importer.domain.EntityTypeEnum;\n+\n+@Named\n+@javax.persistence.Converter\n+@ConfigurationPropertiesBinding\n+public class TokenIdConverter extends AbstractEntityIdConverter {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "990a395428dc529b9501d988d14078cf27b64792"}, "originalPosition": 31}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkzODUyMDgx", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1073#pullrequestreview-493852081", "createdAt": "2020-09-22T21:14:47Z", "commit": {"oid": "990a395428dc529b9501d988d14078cf27b64792"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQyMToxNDo0OFrOHWMoxA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQyMToyNjo1NVrOHWM_UA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzAzNzc2NA==", "bodyText": "Audit timestamps are usual in past tense, like Spring JPA's Auditable interface. Would prefer created_timestamp and modified_timestamp", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1073#discussion_r493037764", "createdAt": "2020-09-22T21:14:48Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-importer/src/main/resources/db/migration/V1.30.1__hts_support.sql", "diffHunk": "@@ -0,0 +1,117 @@\n+-------------------\n+-- Support hts transactions\n+-------------------\n+\n+-- Add new token entity type\n+insert into t_entity_types (id, name) values (5, 'token');\n+\n+-- Add new hts transaction body types\n+insert into t_transaction_types (proto_id, name) values\n+    (28, 'UNCHECKEDSUBMIT'),\n+    (29, 'TOKENCREATE'),\n+    (30, 'TOKENTRANSFER'),\n+    (31, 'TOKENFREEZE'),\n+    (32, 'TOKENUNFREEZE'),\n+    (33, 'TOKENGRANTKYC'),\n+    (34, 'TOKENREVOKEKYC'),\n+    (35, 'TOKENDELETE'),\n+    (36, 'TOKENUPDATE'),\n+    (37, 'TOKENMINT'),\n+    (38, 'TOKENBURN'),\n+    (39, 'TOKENWIPE');\n+\n+-- Add hts transaction result types\n+insert into t_transaction_results (proto_id, result) values\n+    (165, 'ACCOUNT_FROZEN_FOR_TOKEN'),\n+    (166, 'TOKENS_PER_ACCOUNT_LIMIT_EXCEEDED'),\n+    (167, 'INVALID_TOKEN_ID'),\n+    (168, 'INVALID_TOKEN_DIVISIBILITY'),\n+    (169, 'INVALID_TOKEN_FLOAT'),\n+    (170, 'INVALID_TREASURY_ACCOUNT_FOR_TOKEN'),\n+    (171, 'INVALID_TOKEN_SYMBOL'),\n+    (172, 'TOKEN_HAS_NO_FREEZE_KEY'),\n+    (173, 'TRANSFERS_NOT_ZERO_SUM_FOR_TOKEN'),\n+    (174, 'MISSING_TOKEN_SYMBOL'),\n+    (175, 'TOKEN_SYMBOL_TOO_LONG'),\n+    (176, 'TOKEN_SYMBOL_ALREADY_IN_USE'),\n+    (177, 'INVALID_TOKEN_REF'),\n+    (178, 'ACCOUNT_KYC_NOT_GRANTED_FOR_TOKEN'),\n+    (179, 'TOKEN_HAS_NO_KYC_KEY'),\n+    (180, 'INSUFFICIENT_TOKEN_BALANCE'),\n+    (181, 'TOKEN_WAS_DELETED'),\n+    (182, 'TOKEN_HAS_NO_SUPPLY_KEY'),\n+    (183, 'TOKEN_HAS_NO_WIPE_KEY'),\n+    (184, 'INVALID_TOKEN_MINT_AMOUNT'),\n+    (185, 'INVALID_TOKEN_BURN_AMOUNT'),\n+    (186, 'ACCOUNT_HAS_NO_TOKEN_RELATIONSHIP'),\n+    (187, 'CANNOT_WIPE_TOKEN_TREASURY_ACCOUNT'),\n+    (188, 'INVALID_KYC_KEY'),\n+    (189, 'INVALID_WIPE_KEY'),\n+    (190, 'INVALID_FREEZE_KEY'),\n+    (191, 'INVALID_SUPPLY_KEY'),\n+    (192, 'INVALID_TOKEN_EXPIRY'),\n+    (193, 'TOKEN_HAS_EXPIRED'),\n+    (194, 'TOKEN_IS_IMMUTABlE');\n+\n+-- Add token table to hold token properties\n+create table if not exists token\n+(\n+    token_id            entity_id               primary key,\n+    create_timestamp    bigint                  not null,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "990a395428dc529b9501d988d14078cf27b64792"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzAzODI1Mg==", "bodyText": "modified_timestamp should be not null and default to created_timestamp via code. This is pretty standard logic.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1073#discussion_r493038252", "createdAt": "2020-09-22T21:15:41Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-importer/src/main/resources/db/migration/V1.30.1__hts_support.sql", "diffHunk": "@@ -0,0 +1,117 @@\n+-------------------\n+-- Support hts transactions\n+-------------------\n+\n+-- Add new token entity type\n+insert into t_entity_types (id, name) values (5, 'token');\n+\n+-- Add new hts transaction body types\n+insert into t_transaction_types (proto_id, name) values\n+    (28, 'UNCHECKEDSUBMIT'),\n+    (29, 'TOKENCREATE'),\n+    (30, 'TOKENTRANSFER'),\n+    (31, 'TOKENFREEZE'),\n+    (32, 'TOKENUNFREEZE'),\n+    (33, 'TOKENGRANTKYC'),\n+    (34, 'TOKENREVOKEKYC'),\n+    (35, 'TOKENDELETE'),\n+    (36, 'TOKENUPDATE'),\n+    (37, 'TOKENMINT'),\n+    (38, 'TOKENBURN'),\n+    (39, 'TOKENWIPE');\n+\n+-- Add hts transaction result types\n+insert into t_transaction_results (proto_id, result) values\n+    (165, 'ACCOUNT_FROZEN_FOR_TOKEN'),\n+    (166, 'TOKENS_PER_ACCOUNT_LIMIT_EXCEEDED'),\n+    (167, 'INVALID_TOKEN_ID'),\n+    (168, 'INVALID_TOKEN_DIVISIBILITY'),\n+    (169, 'INVALID_TOKEN_FLOAT'),\n+    (170, 'INVALID_TREASURY_ACCOUNT_FOR_TOKEN'),\n+    (171, 'INVALID_TOKEN_SYMBOL'),\n+    (172, 'TOKEN_HAS_NO_FREEZE_KEY'),\n+    (173, 'TRANSFERS_NOT_ZERO_SUM_FOR_TOKEN'),\n+    (174, 'MISSING_TOKEN_SYMBOL'),\n+    (175, 'TOKEN_SYMBOL_TOO_LONG'),\n+    (176, 'TOKEN_SYMBOL_ALREADY_IN_USE'),\n+    (177, 'INVALID_TOKEN_REF'),\n+    (178, 'ACCOUNT_KYC_NOT_GRANTED_FOR_TOKEN'),\n+    (179, 'TOKEN_HAS_NO_KYC_KEY'),\n+    (180, 'INSUFFICIENT_TOKEN_BALANCE'),\n+    (181, 'TOKEN_WAS_DELETED'),\n+    (182, 'TOKEN_HAS_NO_SUPPLY_KEY'),\n+    (183, 'TOKEN_HAS_NO_WIPE_KEY'),\n+    (184, 'INVALID_TOKEN_MINT_AMOUNT'),\n+    (185, 'INVALID_TOKEN_BURN_AMOUNT'),\n+    (186, 'ACCOUNT_HAS_NO_TOKEN_RELATIONSHIP'),\n+    (187, 'CANNOT_WIPE_TOKEN_TREASURY_ACCOUNT'),\n+    (188, 'INVALID_KYC_KEY'),\n+    (189, 'INVALID_WIPE_KEY'),\n+    (190, 'INVALID_FREEZE_KEY'),\n+    (191, 'INVALID_SUPPLY_KEY'),\n+    (192, 'INVALID_TOKEN_EXPIRY'),\n+    (193, 'TOKEN_HAS_EXPIRED'),\n+    (194, 'TOKEN_IS_IMMUTABlE');\n+\n+-- Add token table to hold token properties\n+create table if not exists token\n+(\n+    token_id            entity_id               primary key,\n+    create_timestamp    bigint                  not null,\n+    divisibility        bigint                  not null,\n+    freeze_default      boolean                 not null,\n+    freeze_key          bytea,\n+    initial_supply      bigint                  not null,\n+    kyc_default         boolean                 not null,\n+    kyc_key             bytea,\n+    modify_timestamp    bigint,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "990a395428dc529b9501d988d14078cf27b64792"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzAzOTExMw==", "bodyText": "Can these two have an explicit default? I'm pretty sure since it's a required boolean that it will be defaulted to false implicitly so good to put an explicit.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1073#discussion_r493039113", "createdAt": "2020-09-22T21:17:26Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-importer/src/main/resources/db/migration/V1.30.1__hts_support.sql", "diffHunk": "@@ -0,0 +1,117 @@\n+-------------------\n+-- Support hts transactions\n+-------------------\n+\n+-- Add new token entity type\n+insert into t_entity_types (id, name) values (5, 'token');\n+\n+-- Add new hts transaction body types\n+insert into t_transaction_types (proto_id, name) values\n+    (28, 'UNCHECKEDSUBMIT'),\n+    (29, 'TOKENCREATE'),\n+    (30, 'TOKENTRANSFER'),\n+    (31, 'TOKENFREEZE'),\n+    (32, 'TOKENUNFREEZE'),\n+    (33, 'TOKENGRANTKYC'),\n+    (34, 'TOKENREVOKEKYC'),\n+    (35, 'TOKENDELETE'),\n+    (36, 'TOKENUPDATE'),\n+    (37, 'TOKENMINT'),\n+    (38, 'TOKENBURN'),\n+    (39, 'TOKENWIPE');\n+\n+-- Add hts transaction result types\n+insert into t_transaction_results (proto_id, result) values\n+    (165, 'ACCOUNT_FROZEN_FOR_TOKEN'),\n+    (166, 'TOKENS_PER_ACCOUNT_LIMIT_EXCEEDED'),\n+    (167, 'INVALID_TOKEN_ID'),\n+    (168, 'INVALID_TOKEN_DIVISIBILITY'),\n+    (169, 'INVALID_TOKEN_FLOAT'),\n+    (170, 'INVALID_TREASURY_ACCOUNT_FOR_TOKEN'),\n+    (171, 'INVALID_TOKEN_SYMBOL'),\n+    (172, 'TOKEN_HAS_NO_FREEZE_KEY'),\n+    (173, 'TRANSFERS_NOT_ZERO_SUM_FOR_TOKEN'),\n+    (174, 'MISSING_TOKEN_SYMBOL'),\n+    (175, 'TOKEN_SYMBOL_TOO_LONG'),\n+    (176, 'TOKEN_SYMBOL_ALREADY_IN_USE'),\n+    (177, 'INVALID_TOKEN_REF'),\n+    (178, 'ACCOUNT_KYC_NOT_GRANTED_FOR_TOKEN'),\n+    (179, 'TOKEN_HAS_NO_KYC_KEY'),\n+    (180, 'INSUFFICIENT_TOKEN_BALANCE'),\n+    (181, 'TOKEN_WAS_DELETED'),\n+    (182, 'TOKEN_HAS_NO_SUPPLY_KEY'),\n+    (183, 'TOKEN_HAS_NO_WIPE_KEY'),\n+    (184, 'INVALID_TOKEN_MINT_AMOUNT'),\n+    (185, 'INVALID_TOKEN_BURN_AMOUNT'),\n+    (186, 'ACCOUNT_HAS_NO_TOKEN_RELATIONSHIP'),\n+    (187, 'CANNOT_WIPE_TOKEN_TREASURY_ACCOUNT'),\n+    (188, 'INVALID_KYC_KEY'),\n+    (189, 'INVALID_WIPE_KEY'),\n+    (190, 'INVALID_FREEZE_KEY'),\n+    (191, 'INVALID_SUPPLY_KEY'),\n+    (192, 'INVALID_TOKEN_EXPIRY'),\n+    (193, 'TOKEN_HAS_EXPIRED'),\n+    (194, 'TOKEN_IS_IMMUTABlE');\n+\n+-- Add token table to hold token properties\n+create table if not exists token\n+(\n+    token_id            entity_id               primary key,\n+    create_timestamp    bigint                  not null,\n+    divisibility        bigint                  not null,\n+    freeze_default      boolean                 not null,\n+    freeze_key          bytea,\n+    initial_supply      bigint                  not null,\n+    kyc_default         boolean                 not null,\n+    kyc_key             bytea,\n+    modify_timestamp    bigint,\n+    supply_key          bytea,\n+    symbol              character varying(100)  not null,\n+    treasury_account_id entity_id               not null,\n+    wipe_key            bytea\n+);\n+\n+--- Add token_account table to capture token-account info such as frozen, kyc and wipe status\n+create table if not exists token_account\n+(\n+    id                  serial              primary key,\n+    account_id          entity_id           not null,\n+    create_timestamp    bigint              not null,\n+    frozen              boolean             not null,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "990a395428dc529b9501d988d14078cf27b64792"}, "originalPosition": 80}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzA0MjMxOQ==", "bodyText": "This index's fields are identical to the one above.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1073#discussion_r493042319", "createdAt": "2020-09-22T21:24:08Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-importer/src/main/resources/db/migration/V1.30.1__hts_support.sql", "diffHunk": "@@ -0,0 +1,117 @@\n+-------------------\n+-- Support hts transactions\n+-------------------\n+\n+-- Add new token entity type\n+insert into t_entity_types (id, name) values (5, 'token');\n+\n+-- Add new hts transaction body types\n+insert into t_transaction_types (proto_id, name) values\n+    (28, 'UNCHECKEDSUBMIT'),\n+    (29, 'TOKENCREATE'),\n+    (30, 'TOKENTRANSFER'),\n+    (31, 'TOKENFREEZE'),\n+    (32, 'TOKENUNFREEZE'),\n+    (33, 'TOKENGRANTKYC'),\n+    (34, 'TOKENREVOKEKYC'),\n+    (35, 'TOKENDELETE'),\n+    (36, 'TOKENUPDATE'),\n+    (37, 'TOKENMINT'),\n+    (38, 'TOKENBURN'),\n+    (39, 'TOKENWIPE');\n+\n+-- Add hts transaction result types\n+insert into t_transaction_results (proto_id, result) values\n+    (165, 'ACCOUNT_FROZEN_FOR_TOKEN'),\n+    (166, 'TOKENS_PER_ACCOUNT_LIMIT_EXCEEDED'),\n+    (167, 'INVALID_TOKEN_ID'),\n+    (168, 'INVALID_TOKEN_DIVISIBILITY'),\n+    (169, 'INVALID_TOKEN_FLOAT'),\n+    (170, 'INVALID_TREASURY_ACCOUNT_FOR_TOKEN'),\n+    (171, 'INVALID_TOKEN_SYMBOL'),\n+    (172, 'TOKEN_HAS_NO_FREEZE_KEY'),\n+    (173, 'TRANSFERS_NOT_ZERO_SUM_FOR_TOKEN'),\n+    (174, 'MISSING_TOKEN_SYMBOL'),\n+    (175, 'TOKEN_SYMBOL_TOO_LONG'),\n+    (176, 'TOKEN_SYMBOL_ALREADY_IN_USE'),\n+    (177, 'INVALID_TOKEN_REF'),\n+    (178, 'ACCOUNT_KYC_NOT_GRANTED_FOR_TOKEN'),\n+    (179, 'TOKEN_HAS_NO_KYC_KEY'),\n+    (180, 'INSUFFICIENT_TOKEN_BALANCE'),\n+    (181, 'TOKEN_WAS_DELETED'),\n+    (182, 'TOKEN_HAS_NO_SUPPLY_KEY'),\n+    (183, 'TOKEN_HAS_NO_WIPE_KEY'),\n+    (184, 'INVALID_TOKEN_MINT_AMOUNT'),\n+    (185, 'INVALID_TOKEN_BURN_AMOUNT'),\n+    (186, 'ACCOUNT_HAS_NO_TOKEN_RELATIONSHIP'),\n+    (187, 'CANNOT_WIPE_TOKEN_TREASURY_ACCOUNT'),\n+    (188, 'INVALID_KYC_KEY'),\n+    (189, 'INVALID_WIPE_KEY'),\n+    (190, 'INVALID_FREEZE_KEY'),\n+    (191, 'INVALID_SUPPLY_KEY'),\n+    (192, 'INVALID_TOKEN_EXPIRY'),\n+    (193, 'TOKEN_HAS_EXPIRED'),\n+    (194, 'TOKEN_IS_IMMUTABlE');\n+\n+-- Add token table to hold token properties\n+create table if not exists token\n+(\n+    token_id            entity_id               primary key,\n+    create_timestamp    bigint                  not null,\n+    divisibility        bigint                  not null,\n+    freeze_default      boolean                 not null,\n+    freeze_key          bytea,\n+    initial_supply      bigint                  not null,\n+    kyc_default         boolean                 not null,\n+    kyc_key             bytea,\n+    modify_timestamp    bigint,\n+    supply_key          bytea,\n+    symbol              character varying(100)  not null,\n+    treasury_account_id entity_id               not null,\n+    wipe_key            bytea\n+);\n+\n+--- Add token_account table to capture token-account info such as frozen, kyc and wipe status\n+create table if not exists token_account\n+(\n+    id                  serial              primary key,\n+    account_id          entity_id           not null,\n+    create_timestamp    bigint              not null,\n+    frozen              boolean             not null,\n+    kyc                 boolean             not null,\n+    modify_timestamp    bigint              not null,\n+    token_id            entity_id           not null,\n+    wiped               boolean             not null default false\n+);\n+\n+create unique index if not exists token_account__token_account on token_account(token_id, account_id);\n+\n+create index if not exists token_account__token_account_timestamp\n+     on token_account (token_id desc, account_id desc, create_timestamp desc);\n+\n+--- Add token_balance table to capture token account balances\n+create table if not exists token_balance\n+(\n+    consensus_timestamp bigint              primary key not null,\n+    account_id          entity_id           not null,\n+    balance             bigint              not null,\n+    token_id            entity_id           not null\n+);\n+\n+create index if not exists token_balance__token_account_timestamp\n+     on token_balance (token_id desc, account_id desc, consensus_timestamp desc);\n+\n+--- Add token_transfer\n+create table if not exists token_transfer\n+(\n+    token_id            entity_id,\n+    account_id          entity_id,\n+    consensus_timestamp bigint,\n+    amount              hbar_tinybars\n+);\n+\n+create index if not exists token_transfer__timestamp\n+     on token_transfer (token_id desc, account_id desc, consensus_timestamp desc);\n+\n+create index if not exists token_transfer__token_account_timestamp", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "990a395428dc529b9501d988d14078cf27b64792"}, "originalPosition": 116}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzA0MzUzNg==", "bodyText": "Are we sure this index is needed? It's a superset of the other index making it pretty wasteful.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1073#discussion_r493043536", "createdAt": "2020-09-22T21:26:55Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-importer/src/main/resources/db/migration/V1.30.1__hts_support.sql", "diffHunk": "@@ -0,0 +1,117 @@\n+-------------------\n+-- Support hts transactions\n+-------------------\n+\n+-- Add new token entity type\n+insert into t_entity_types (id, name) values (5, 'token');\n+\n+-- Add new hts transaction body types\n+insert into t_transaction_types (proto_id, name) values\n+    (28, 'UNCHECKEDSUBMIT'),\n+    (29, 'TOKENCREATE'),\n+    (30, 'TOKENTRANSFER'),\n+    (31, 'TOKENFREEZE'),\n+    (32, 'TOKENUNFREEZE'),\n+    (33, 'TOKENGRANTKYC'),\n+    (34, 'TOKENREVOKEKYC'),\n+    (35, 'TOKENDELETE'),\n+    (36, 'TOKENUPDATE'),\n+    (37, 'TOKENMINT'),\n+    (38, 'TOKENBURN'),\n+    (39, 'TOKENWIPE');\n+\n+-- Add hts transaction result types\n+insert into t_transaction_results (proto_id, result) values\n+    (165, 'ACCOUNT_FROZEN_FOR_TOKEN'),\n+    (166, 'TOKENS_PER_ACCOUNT_LIMIT_EXCEEDED'),\n+    (167, 'INVALID_TOKEN_ID'),\n+    (168, 'INVALID_TOKEN_DIVISIBILITY'),\n+    (169, 'INVALID_TOKEN_FLOAT'),\n+    (170, 'INVALID_TREASURY_ACCOUNT_FOR_TOKEN'),\n+    (171, 'INVALID_TOKEN_SYMBOL'),\n+    (172, 'TOKEN_HAS_NO_FREEZE_KEY'),\n+    (173, 'TRANSFERS_NOT_ZERO_SUM_FOR_TOKEN'),\n+    (174, 'MISSING_TOKEN_SYMBOL'),\n+    (175, 'TOKEN_SYMBOL_TOO_LONG'),\n+    (176, 'TOKEN_SYMBOL_ALREADY_IN_USE'),\n+    (177, 'INVALID_TOKEN_REF'),\n+    (178, 'ACCOUNT_KYC_NOT_GRANTED_FOR_TOKEN'),\n+    (179, 'TOKEN_HAS_NO_KYC_KEY'),\n+    (180, 'INSUFFICIENT_TOKEN_BALANCE'),\n+    (181, 'TOKEN_WAS_DELETED'),\n+    (182, 'TOKEN_HAS_NO_SUPPLY_KEY'),\n+    (183, 'TOKEN_HAS_NO_WIPE_KEY'),\n+    (184, 'INVALID_TOKEN_MINT_AMOUNT'),\n+    (185, 'INVALID_TOKEN_BURN_AMOUNT'),\n+    (186, 'ACCOUNT_HAS_NO_TOKEN_RELATIONSHIP'),\n+    (187, 'CANNOT_WIPE_TOKEN_TREASURY_ACCOUNT'),\n+    (188, 'INVALID_KYC_KEY'),\n+    (189, 'INVALID_WIPE_KEY'),\n+    (190, 'INVALID_FREEZE_KEY'),\n+    (191, 'INVALID_SUPPLY_KEY'),\n+    (192, 'INVALID_TOKEN_EXPIRY'),\n+    (193, 'TOKEN_HAS_EXPIRED'),\n+    (194, 'TOKEN_IS_IMMUTABlE');\n+\n+-- Add token table to hold token properties\n+create table if not exists token\n+(\n+    token_id            entity_id               primary key,\n+    create_timestamp    bigint                  not null,\n+    divisibility        bigint                  not null,\n+    freeze_default      boolean                 not null,\n+    freeze_key          bytea,\n+    initial_supply      bigint                  not null,\n+    kyc_default         boolean                 not null,\n+    kyc_key             bytea,\n+    modify_timestamp    bigint,\n+    supply_key          bytea,\n+    symbol              character varying(100)  not null,\n+    treasury_account_id entity_id               not null,\n+    wipe_key            bytea\n+);\n+\n+--- Add token_account table to capture token-account info such as frozen, kyc and wipe status\n+create table if not exists token_account\n+(\n+    id                  serial              primary key,\n+    account_id          entity_id           not null,\n+    create_timestamp    bigint              not null,\n+    frozen              boolean             not null,\n+    kyc                 boolean             not null,\n+    modify_timestamp    bigint              not null,\n+    token_id            entity_id           not null,\n+    wiped               boolean             not null default false\n+);\n+\n+create unique index if not exists token_account__token_account on token_account(token_id, account_id);\n+\n+create index if not exists token_account__token_account_timestamp", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "990a395428dc529b9501d988d14078cf27b64792"}, "originalPosition": 89}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkzODkzMTM3", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1073#pullrequestreview-493893137", "createdAt": "2020-09-22T22:36:23Z", "commit": {"oid": "990a395428dc529b9501d988d14078cf27b64792"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQyMjozNjoyM1rOHWOtzQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQyMjozODoyNlrOHWOwoQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzA3MTgyMQ==", "bodyText": "Add associated\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                account_id          entity_id           not null,\n          \n          \n            \n                account_id          entity_id           not null,\n          \n          \n            \n                associated          boolean           not null,", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1073#discussion_r493071821", "createdAt": "2020-09-22T22:36:23Z", "author": {"login": "Nana-EC"}, "path": "hedera-mirror-importer/src/main/resources/db/migration/V1.30.1__hts_support.sql", "diffHunk": "@@ -0,0 +1,117 @@\n+-------------------\n+-- Support hts transactions\n+-------------------\n+\n+-- Add new token entity type\n+insert into t_entity_types (id, name) values (5, 'token');\n+\n+-- Add new hts transaction body types\n+insert into t_transaction_types (proto_id, name) values\n+    (28, 'UNCHECKEDSUBMIT'),\n+    (29, 'TOKENCREATE'),\n+    (30, 'TOKENTRANSFER'),\n+    (31, 'TOKENFREEZE'),\n+    (32, 'TOKENUNFREEZE'),\n+    (33, 'TOKENGRANTKYC'),\n+    (34, 'TOKENREVOKEKYC'),\n+    (35, 'TOKENDELETE'),\n+    (36, 'TOKENUPDATE'),\n+    (37, 'TOKENMINT'),\n+    (38, 'TOKENBURN'),\n+    (39, 'TOKENWIPE');\n+\n+-- Add hts transaction result types\n+insert into t_transaction_results (proto_id, result) values\n+    (165, 'ACCOUNT_FROZEN_FOR_TOKEN'),\n+    (166, 'TOKENS_PER_ACCOUNT_LIMIT_EXCEEDED'),\n+    (167, 'INVALID_TOKEN_ID'),\n+    (168, 'INVALID_TOKEN_DIVISIBILITY'),\n+    (169, 'INVALID_TOKEN_FLOAT'),\n+    (170, 'INVALID_TREASURY_ACCOUNT_FOR_TOKEN'),\n+    (171, 'INVALID_TOKEN_SYMBOL'),\n+    (172, 'TOKEN_HAS_NO_FREEZE_KEY'),\n+    (173, 'TRANSFERS_NOT_ZERO_SUM_FOR_TOKEN'),\n+    (174, 'MISSING_TOKEN_SYMBOL'),\n+    (175, 'TOKEN_SYMBOL_TOO_LONG'),\n+    (176, 'TOKEN_SYMBOL_ALREADY_IN_USE'),\n+    (177, 'INVALID_TOKEN_REF'),\n+    (178, 'ACCOUNT_KYC_NOT_GRANTED_FOR_TOKEN'),\n+    (179, 'TOKEN_HAS_NO_KYC_KEY'),\n+    (180, 'INSUFFICIENT_TOKEN_BALANCE'),\n+    (181, 'TOKEN_WAS_DELETED'),\n+    (182, 'TOKEN_HAS_NO_SUPPLY_KEY'),\n+    (183, 'TOKEN_HAS_NO_WIPE_KEY'),\n+    (184, 'INVALID_TOKEN_MINT_AMOUNT'),\n+    (185, 'INVALID_TOKEN_BURN_AMOUNT'),\n+    (186, 'ACCOUNT_HAS_NO_TOKEN_RELATIONSHIP'),\n+    (187, 'CANNOT_WIPE_TOKEN_TREASURY_ACCOUNT'),\n+    (188, 'INVALID_KYC_KEY'),\n+    (189, 'INVALID_WIPE_KEY'),\n+    (190, 'INVALID_FREEZE_KEY'),\n+    (191, 'INVALID_SUPPLY_KEY'),\n+    (192, 'INVALID_TOKEN_EXPIRY'),\n+    (193, 'TOKEN_HAS_EXPIRED'),\n+    (194, 'TOKEN_IS_IMMUTABlE');\n+\n+-- Add token table to hold token properties\n+create table if not exists token\n+(\n+    token_id            entity_id               primary key,\n+    create_timestamp    bigint                  not null,\n+    divisibility        bigint                  not null,\n+    freeze_default      boolean                 not null,\n+    freeze_key          bytea,\n+    initial_supply      bigint                  not null,\n+    kyc_default         boolean                 not null,\n+    kyc_key             bytea,\n+    modify_timestamp    bigint,\n+    supply_key          bytea,\n+    symbol              character varying(100)  not null,\n+    treasury_account_id entity_id               not null,\n+    wipe_key            bytea\n+);\n+\n+--- Add token_account table to capture token-account info such as frozen, kyc and wipe status\n+create table if not exists token_account\n+(\n+    id                  serial              primary key,\n+    account_id          entity_id           not null,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "990a395428dc529b9501d988d14078cf27b64792"}, "originalPosition": 78}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzA3MjE4OA==", "bodyText": "Updated 192 onwards with\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                (192, 'INVALID_TOKEN_EXPIRY'),\n          \n          \n            \n                (192, 'TOKEN_NAME_ALREADY_IN_USE'),\n          \n          \n            \n                    (193, 'MISSING_TOKEN_NAME'),\n          \n          \n            \n                    (194, 'TOKEN_NAME_TOO_LONG'),\n          \n          \n            \n                    (195, 'INVALID_WIPING_AMOUNT'),\n          \n          \n            \n                    (196, 'TOKEN_IS_IMMUTABlE'),\n          \n          \n            \n                    (197, 'TOKEN_ALREADY_ASSOCIATED_TO_ACCOUNT')", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1073#discussion_r493072188", "createdAt": "2020-09-22T22:37:23Z", "author": {"login": "Nana-EC"}, "path": "hedera-mirror-importer/src/main/resources/db/migration/V1.30.1__hts_support.sql", "diffHunk": "@@ -0,0 +1,117 @@\n+-------------------\n+-- Support hts transactions\n+-------------------\n+\n+-- Add new token entity type\n+insert into t_entity_types (id, name) values (5, 'token');\n+\n+-- Add new hts transaction body types\n+insert into t_transaction_types (proto_id, name) values\n+    (28, 'UNCHECKEDSUBMIT'),\n+    (29, 'TOKENCREATE'),\n+    (30, 'TOKENTRANSFER'),\n+    (31, 'TOKENFREEZE'),\n+    (32, 'TOKENUNFREEZE'),\n+    (33, 'TOKENGRANTKYC'),\n+    (34, 'TOKENREVOKEKYC'),\n+    (35, 'TOKENDELETE'),\n+    (36, 'TOKENUPDATE'),\n+    (37, 'TOKENMINT'),\n+    (38, 'TOKENBURN'),\n+    (39, 'TOKENWIPE');\n+\n+-- Add hts transaction result types\n+insert into t_transaction_results (proto_id, result) values\n+    (165, 'ACCOUNT_FROZEN_FOR_TOKEN'),\n+    (166, 'TOKENS_PER_ACCOUNT_LIMIT_EXCEEDED'),\n+    (167, 'INVALID_TOKEN_ID'),\n+    (168, 'INVALID_TOKEN_DIVISIBILITY'),\n+    (169, 'INVALID_TOKEN_FLOAT'),\n+    (170, 'INVALID_TREASURY_ACCOUNT_FOR_TOKEN'),\n+    (171, 'INVALID_TOKEN_SYMBOL'),\n+    (172, 'TOKEN_HAS_NO_FREEZE_KEY'),\n+    (173, 'TRANSFERS_NOT_ZERO_SUM_FOR_TOKEN'),\n+    (174, 'MISSING_TOKEN_SYMBOL'),\n+    (175, 'TOKEN_SYMBOL_TOO_LONG'),\n+    (176, 'TOKEN_SYMBOL_ALREADY_IN_USE'),\n+    (177, 'INVALID_TOKEN_REF'),\n+    (178, 'ACCOUNT_KYC_NOT_GRANTED_FOR_TOKEN'),\n+    (179, 'TOKEN_HAS_NO_KYC_KEY'),\n+    (180, 'INSUFFICIENT_TOKEN_BALANCE'),\n+    (181, 'TOKEN_WAS_DELETED'),\n+    (182, 'TOKEN_HAS_NO_SUPPLY_KEY'),\n+    (183, 'TOKEN_HAS_NO_WIPE_KEY'),\n+    (184, 'INVALID_TOKEN_MINT_AMOUNT'),\n+    (185, 'INVALID_TOKEN_BURN_AMOUNT'),\n+    (186, 'ACCOUNT_HAS_NO_TOKEN_RELATIONSHIP'),\n+    (187, 'CANNOT_WIPE_TOKEN_TREASURY_ACCOUNT'),\n+    (188, 'INVALID_KYC_KEY'),\n+    (189, 'INVALID_WIPE_KEY'),\n+    (190, 'INVALID_FREEZE_KEY'),\n+    (191, 'INVALID_SUPPLY_KEY'),\n+    (192, 'INVALID_TOKEN_EXPIRY'),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "990a395428dc529b9501d988d14078cf27b64792"}, "originalPosition": 52}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzA3MjU0NQ==", "bodyText": "Add\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                TOKENWIPE(39);\n          \n          \n            \n                TOKENWIPE(39),\n          \n          \n            \n                TOKENASSOCIATE(40),\n          \n          \n            \n                TOKENDISSOCIATE(41);", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1073#discussion_r493072545", "createdAt": "2020-09-22T22:38:26Z", "author": {"login": "Nana-EC"}, "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/domain/TransactionTypeEnum.java", "diffHunk": "@@ -52,7 +52,19 @@\n     CONSENSUSCREATETOPIC(24),\n     CONSENSUSUPDATETOPIC(25),\n     CONSENSUSDELETETOPIC(26),\n-    CONSENSUSSUBMITMESSAGE(27);\n+    CONSENSUSSUBMITMESSAGE(27),\n+    UNCHECKEDSUBMIT(28),\n+    TOKENCREATE(29),\n+    TOKENTRANSFER(30),\n+    TOKENFREEZE(31),\n+    TOKENUNFREEZE(32),\n+    TOKENGRANTKYC(33),\n+    TOKENREVOKEKYC(34),\n+    TOKENDELETE(35),\n+    TOKENUPDATE(36),\n+    TOKENMINT(37),\n+    TOKENBURN(38),\n+    TOKENWIPE(39);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "990a395428dc529b9501d988d14078cf27b64792"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "71fb7e82196d2b0318f1544d5c91c913c0f187bc", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/71fb7e82196d2b0318f1544d5c91c913c0f187bc", "committedDate": "2020-09-23T00:13:00Z", "message": "Added transaction types and responses and addressed feedback\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk0Nzg5ODU3", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1073#pullrequestreview-494789857", "createdAt": "2020-09-23T15:32:56Z", "commit": {"oid": "71fb7e82196d2b0318f1544d5c91c913c0f187bc"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxNTozMjo1NlrOHW0cdw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxNTo1MTozM1rOHW1RbQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzY4OTk3NQ==", "bodyText": "Q: are token associate & token dissociate WIP items? I didn't see them in the published proto", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1073#discussion_r493689975", "createdAt": "2020-09-23T15:32:56Z", "author": {"login": "xin-hedera"}, "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/domain/TransactionTypeEnum.java", "diffHunk": "@@ -52,7 +52,21 @@\n     CONSENSUSCREATETOPIC(24),\n     CONSENSUSUPDATETOPIC(25),\n     CONSENSUSDELETETOPIC(26),\n-    CONSENSUSSUBMITMESSAGE(27);\n+    CONSENSUSSUBMITMESSAGE(27),\n+    UNCHECKEDSUBMIT(28),\n+    TOKENCREATE(29),\n+    TOKENTRANSFER(30),\n+    TOKENFREEZE(31),\n+    TOKENUNFREEZE(32),\n+    TOKENGRANTKYC(33),\n+    TOKENREVOKEKYC(34),\n+    TOKENDELETE(35),\n+    TOKENUPDATE(36),\n+    TOKENMINT(37),\n+    TOKENBURN(38),\n+    TOKENWIPE(39),\n+    TOKENASSOCIATE(40),\n+    TOKENDISSOCIATE(41);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "71fb7e82196d2b0318f1544d5c91c913c0f187bc"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzY5OTY2OQ==", "bodyText": "can't use consensus_timestamp as primary key since it's not unique, there can be many rows with same consensus timestamp\nsimilar to account_balance, the primary key should be a combination key of consensus_timestamp, account_id, and token_id", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1073#discussion_r493699669", "createdAt": "2020-09-23T15:46:17Z", "author": {"login": "xin-hedera"}, "path": "hedera-mirror-importer/src/main/resources/db/migration/V1.30.1__hts_support.sql", "diffHunk": "@@ -0,0 +1,121 @@\n+-------------------\n+-- Support hts transactions\n+-------------------\n+\n+-- Add new token entity type\n+insert into t_entity_types (id, name) values (5, 'token');\n+\n+-- Add new hts transaction body types\n+insert into t_transaction_types (proto_id, name) values\n+    (28, 'UNCHECKEDSUBMIT'),\n+    (29, 'TOKENCREATE'),\n+    (30, 'TOKENTRANSFER'),\n+    (31, 'TOKENFREEZE'),\n+    (32, 'TOKENUNFREEZE'),\n+    (33, 'TOKENGRANTKYC'),\n+    (34, 'TOKENREVOKEKYC'),\n+    (35, 'TOKENDELETE'),\n+    (36, 'TOKENUPDATE'),\n+    (37, 'TOKENMINT'),\n+    (38, 'TOKENBURN'),\n+    (39, 'TOKENWIPE'),\n+    (40, 'TOKENASSOCIATE'),\n+    (41, 'TOKENDISSOCIATE');\n+\n+-- Add hts transaction result types\n+insert into t_transaction_results (proto_id, result) values\n+    (165, 'ACCOUNT_FROZEN_FOR_TOKEN'),\n+    (166, 'TOKENS_PER_ACCOUNT_LIMIT_EXCEEDED'),\n+    (167, 'INVALID_TOKEN_ID'),\n+    (168, 'INVALID_TOKEN_DIVISIBILITY'),\n+    (169, 'INVALID_TOKEN_FLOAT'),\n+    (170, 'INVALID_TREASURY_ACCOUNT_FOR_TOKEN'),\n+    (171, 'INVALID_TOKEN_SYMBOL'),\n+    (172, 'TOKEN_HAS_NO_FREEZE_KEY'),\n+    (173, 'TRANSFERS_NOT_ZERO_SUM_FOR_TOKEN'),\n+    (174, 'MISSING_TOKEN_SYMBOL'),\n+    (175, 'TOKEN_SYMBOL_TOO_LONG'),\n+    (176, 'TOKEN_SYMBOL_ALREADY_IN_USE'),\n+    (177, 'INVALID_TOKEN_REF'),\n+    (178, 'ACCOUNT_KYC_NOT_GRANTED_FOR_TOKEN'),\n+    (179, 'TOKEN_HAS_NO_KYC_KEY'),\n+    (180, 'INSUFFICIENT_TOKEN_BALANCE'),\n+    (181, 'TOKEN_WAS_DELETED'),\n+    (182, 'TOKEN_HAS_NO_SUPPLY_KEY'),\n+    (183, 'TOKEN_HAS_NO_WIPE_KEY'),\n+    (184, 'INVALID_TOKEN_MINT_AMOUNT'),\n+    (185, 'INVALID_TOKEN_BURN_AMOUNT'),\n+    (186, 'ACCOUNT_HAS_NO_TOKEN_RELATIONSHIP'),\n+    (187, 'CANNOT_WIPE_TOKEN_TREASURY_ACCOUNT'),\n+    (188, 'INVALID_KYC_KEY'),\n+    (189, 'INVALID_WIPE_KEY'),\n+    (190, 'INVALID_FREEZE_KEY'),\n+    (191, 'INVALID_SUPPLY_KEY'),\n+    (192, 'TOKEN_NAME_ALREADY_IN_USE'),\n+    (193, 'MISSING_TOKEN_NAME'),\n+    (194, 'TOKEN_NAME_TOO_LONG'),\n+    (195, 'INVALID_WIPING_AMOUNT'),\n+    (196, 'TOKEN_IS_IMMUTABlE'),\n+    (197, 'TOKEN_ALREADY_ASSOCIATED_TO_ACCOUNT');\n+\n+-- Add token table to hold token properties\n+create table if not exists token\n+(\n+    token_id            entity_id               primary key,\n+    created_timestamp   bigint                  not null,\n+    divisibility        bigint                  not null,\n+    freeze_default      boolean                 not null,\n+    freeze_key          bytea,\n+    initial_supply      bigint                  not null,\n+    kyc_default         boolean                 not null,\n+    kyc_key             bytea,\n+    modified_timestamp  bigint                  not null,\n+    supply_key          bytea,\n+    symbol              character varying(100)  not null,\n+    treasury_account_id entity_id               not null,\n+    wipe_key            bytea\n+);\n+\n+--- Add token_account table to capture token-account info such as frozen, kyc and wipe status\n+create table if not exists token_account\n+(\n+    id                  serial              primary key,\n+    account_id          entity_id           not null,\n+    associated          boolean             not null default false,\n+    created_timestamp   bigint              not null,\n+    frozen              boolean             not null,\n+    kyc                 boolean             not null,\n+    modified_timestamp  bigint              not null,\n+    token_id            entity_id           not null,\n+    wiped               boolean             not null default false\n+);\n+\n+create unique index if not exists token_account__token_account on token_account(token_id, account_id);\n+\n+\n+--- Add token_balance table to capture token account balances\n+create table if not exists token_balance\n+(\n+    consensus_timestamp bigint              primary key not null,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "71fb7e82196d2b0318f1544d5c91c913c0f187bc"}, "originalPosition": 99}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzcwMzUzMw==", "bodyText": "Q: same as above, TOKEN_ALREADY_ASSOCIATED_TO_ACCOUNT is not in published proto", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1073#discussion_r493703533", "createdAt": "2020-09-23T15:51:33Z", "author": {"login": "xin-hedera"}, "path": "hedera-mirror-importer/src/main/resources/db/migration/V1.30.1__hts_support.sql", "diffHunk": "@@ -0,0 +1,121 @@\n+-------------------\n+-- Support hts transactions\n+-------------------\n+\n+-- Add new token entity type\n+insert into t_entity_types (id, name) values (5, 'token');\n+\n+-- Add new hts transaction body types\n+insert into t_transaction_types (proto_id, name) values\n+    (28, 'UNCHECKEDSUBMIT'),\n+    (29, 'TOKENCREATE'),\n+    (30, 'TOKENTRANSFER'),\n+    (31, 'TOKENFREEZE'),\n+    (32, 'TOKENUNFREEZE'),\n+    (33, 'TOKENGRANTKYC'),\n+    (34, 'TOKENREVOKEKYC'),\n+    (35, 'TOKENDELETE'),\n+    (36, 'TOKENUPDATE'),\n+    (37, 'TOKENMINT'),\n+    (38, 'TOKENBURN'),\n+    (39, 'TOKENWIPE'),\n+    (40, 'TOKENASSOCIATE'),\n+    (41, 'TOKENDISSOCIATE');\n+\n+-- Add hts transaction result types\n+insert into t_transaction_results (proto_id, result) values\n+    (165, 'ACCOUNT_FROZEN_FOR_TOKEN'),\n+    (166, 'TOKENS_PER_ACCOUNT_LIMIT_EXCEEDED'),\n+    (167, 'INVALID_TOKEN_ID'),\n+    (168, 'INVALID_TOKEN_DIVISIBILITY'),\n+    (169, 'INVALID_TOKEN_FLOAT'),\n+    (170, 'INVALID_TREASURY_ACCOUNT_FOR_TOKEN'),\n+    (171, 'INVALID_TOKEN_SYMBOL'),\n+    (172, 'TOKEN_HAS_NO_FREEZE_KEY'),\n+    (173, 'TRANSFERS_NOT_ZERO_SUM_FOR_TOKEN'),\n+    (174, 'MISSING_TOKEN_SYMBOL'),\n+    (175, 'TOKEN_SYMBOL_TOO_LONG'),\n+    (176, 'TOKEN_SYMBOL_ALREADY_IN_USE'),\n+    (177, 'INVALID_TOKEN_REF'),\n+    (178, 'ACCOUNT_KYC_NOT_GRANTED_FOR_TOKEN'),\n+    (179, 'TOKEN_HAS_NO_KYC_KEY'),\n+    (180, 'INSUFFICIENT_TOKEN_BALANCE'),\n+    (181, 'TOKEN_WAS_DELETED'),\n+    (182, 'TOKEN_HAS_NO_SUPPLY_KEY'),\n+    (183, 'TOKEN_HAS_NO_WIPE_KEY'),\n+    (184, 'INVALID_TOKEN_MINT_AMOUNT'),\n+    (185, 'INVALID_TOKEN_BURN_AMOUNT'),\n+    (186, 'ACCOUNT_HAS_NO_TOKEN_RELATIONSHIP'),\n+    (187, 'CANNOT_WIPE_TOKEN_TREASURY_ACCOUNT'),\n+    (188, 'INVALID_KYC_KEY'),\n+    (189, 'INVALID_WIPE_KEY'),\n+    (190, 'INVALID_FREEZE_KEY'),\n+    (191, 'INVALID_SUPPLY_KEY'),\n+    (192, 'TOKEN_NAME_ALREADY_IN_USE'),\n+    (193, 'MISSING_TOKEN_NAME'),\n+    (194, 'TOKEN_NAME_TOO_LONG'),\n+    (195, 'INVALID_WIPING_AMOUNT'),\n+    (196, 'TOKEN_IS_IMMUTABlE'),\n+    (197, 'TOKEN_ALREADY_ASSOCIATED_TO_ACCOUNT');", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "71fb7e82196d2b0318f1544d5c91c913c0f187bc"}, "originalPosition": 59}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd7e80dff2f44a4acdca51016011465a2ea16ce7", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/bd7e80dff2f44a4acdca51016011465a2ea16ce7", "committedDate": "2020-09-23T16:44:01Z", "message": "Reverted transaction types and codes to match current master\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk0OTc5NTI5", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1073#pullrequestreview-494979529", "createdAt": "2020-09-23T19:25:09Z", "commit": {"oid": "bd7e80dff2f44a4acdca51016011465a2ea16ce7"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxOToyNTowOVrOHW9qag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QxOToyNjo0NlrOHW9uNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mzg0MTAwMg==", "bodyText": "This index is a subset of the below index. Can you reorder the below index to have consensus_timestamp as first and drop this index?", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1073#discussion_r493841002", "createdAt": "2020-09-23T19:25:09Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-importer/src/main/resources/db/migration/V1.30.1__hts_support.sql", "diffHunk": "@@ -0,0 +1,120 @@\n+-------------------\n+-- Support hts transactions\n+-------------------\n+\n+-- Add new token entity type\n+insert into t_entity_types (id, name) values (5, 'token');\n+\n+-- Add new hts transaction body types\n+insert into t_transaction_types (proto_id, name) values\n+    (28, 'UNCHECKEDSUBMIT'),\n+    (29, 'TOKENCREATE'),\n+    (30, 'TOKENTRANSFER'),\n+    (31, 'TOKENFREEZE'),\n+    (32, 'TOKENUNFREEZE'),\n+    (33, 'TOKENGRANTKYC'),\n+    (34, 'TOKENREVOKEKYC'),\n+    (35, 'TOKENDELETE'),\n+    (36, 'TOKENUPDATE'),\n+    (37, 'TOKENMINT'),\n+    (38, 'TOKENBURN'),\n+    (39, 'TOKENWIPE');\n+\n+-- Add hts transaction result types\n+insert into t_transaction_results (proto_id, result) values\n+    (165, 'ACCOUNT_FROZEN_FOR_TOKEN'),\n+    (166, 'TOKENS_PER_ACCOUNT_LIMIT_EXCEEDED'),\n+    (167, 'INVALID_TOKEN_ID'),\n+    (168, 'INVALID_TOKEN_DIVISIBILITY'),\n+    (169, 'INVALID_TOKEN_FLOAT'),\n+    (170, 'INVALID_TREASURY_ACCOUNT_FOR_TOKEN'),\n+    (171, 'INVALID_TOKEN_SYMBOL'),\n+    (172, 'TOKEN_HAS_NO_FREEZE_KEY'),\n+    (173, 'TRANSFERS_NOT_ZERO_SUM_FOR_TOKEN'),\n+    (174, 'MISSING_TOKEN_SYMBOL'),\n+    (175, 'TOKEN_SYMBOL_TOO_LONG'),\n+    (176, 'TOKEN_SYMBOL_ALREADY_IN_USE'),\n+    (177, 'INVALID_TOKEN_REF'),\n+    (178, 'ACCOUNT_KYC_NOT_GRANTED_FOR_TOKEN'),\n+    (179, 'TOKEN_HAS_NO_KYC_KEY'),\n+    (180, 'INSUFFICIENT_TOKEN_BALANCE'),\n+    (181, 'TOKEN_WAS_DELETED'),\n+    (182, 'TOKEN_HAS_NO_SUPPLY_KEY'),\n+    (183, 'TOKEN_HAS_NO_WIPE_KEY'),\n+    (184, 'INVALID_TOKEN_MINT_AMOUNT'),\n+    (185, 'INVALID_TOKEN_BURN_AMOUNT'),\n+    (186, 'ACCOUNT_HAS_NO_TOKEN_RELATIONSHIP'),\n+    (187, 'CANNOT_WIPE_TOKEN_TREASURY_ACCOUNT'),\n+    (188, 'INVALID_KYC_KEY'),\n+    (189, 'INVALID_WIPE_KEY'),\n+    (190, 'INVALID_FREEZE_KEY'),\n+    (191, 'INVALID_SUPPLY_KEY'),\n+    (192, 'TOKEN_NAME_ALREADY_IN_USE'),\n+    (193, 'MISSING_TOKEN_NAME'),\n+    (194, 'TOKEN_NAME_TOO_LONG'),\n+    (195, 'INVALID_WIPING_AMOUNT'),\n+    (196, 'TOKEN_IS_IMMUTABlE');\n+\n+-- Add token table to hold token properties\n+create table if not exists token\n+(\n+    token_id            entity_id               primary key,\n+    created_timestamp   bigint                  not null,\n+    divisibility        bigint                  not null,\n+    freeze_default      boolean                 not null,\n+    freeze_key          bytea,\n+    initial_supply      bigint                  not null,\n+    kyc_default         boolean                 not null,\n+    kyc_key             bytea,\n+    modified_timestamp  bigint                  not null,\n+    supply_key          bytea,\n+    symbol              character varying(100)  not null,\n+    treasury_account_id entity_id               not null,\n+    wipe_key            bytea\n+);\n+\n+--- Add token_account table to capture token-account info such as frozen, kyc and wipe status\n+create table if not exists token_account\n+(\n+    id                  serial              primary key,\n+    account_id          entity_id           not null,\n+    created_timestamp   bigint              not null,\n+    frozen              boolean             not null default false,\n+    kyc                 boolean             not null default false,\n+    modified_timestamp  bigint              not null,\n+    token_id            entity_id           not null,\n+    wiped               boolean             not null default false\n+);\n+\n+create unique index if not exists token_account__token_account on token_account(token_id, account_id);\n+\n+\n+--- Add token_balance table to capture token account balances\n+create table if not exists token_balance\n+(\n+    consensus_timestamp bigint              not null,\n+    account_id          entity_id           not null,\n+    balance             bigint              not null,\n+    token_id            entity_id           not null\n+);\n+\n+alter table if exists token_balance\n+    add constraint token_balance__pk primary key (consensus_timestamp, token_id, account_id);\n+\n+create index if not exists token_balance__token_account_timestamp\n+     on token_balance (token_id desc, account_id desc, consensus_timestamp desc);\n+\n+--- Add token_transfer\n+create table if not exists token_transfer\n+(\n+    token_id            entity_id,\n+    account_id          entity_id,\n+    consensus_timestamp bigint,\n+    amount              hbar_tinybars\n+);\n+\n+create index if not exists token_transfer__timestamp\n+     on token_transfer (consensus_timestamp desc);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd7e80dff2f44a4acdca51016011465a2ea16ce7"}, "originalPosition": 117}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mzg0MTMzMQ==", "bodyText": "These required booleans can have explicit defaults as well.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1073#discussion_r493841331", "createdAt": "2020-09-23T19:25:42Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-importer/src/main/resources/db/migration/V1.30.1__hts_support.sql", "diffHunk": "@@ -0,0 +1,120 @@\n+-------------------\n+-- Support hts transactions\n+-------------------\n+\n+-- Add new token entity type\n+insert into t_entity_types (id, name) values (5, 'token');\n+\n+-- Add new hts transaction body types\n+insert into t_transaction_types (proto_id, name) values\n+    (28, 'UNCHECKEDSUBMIT'),\n+    (29, 'TOKENCREATE'),\n+    (30, 'TOKENTRANSFER'),\n+    (31, 'TOKENFREEZE'),\n+    (32, 'TOKENUNFREEZE'),\n+    (33, 'TOKENGRANTKYC'),\n+    (34, 'TOKENREVOKEKYC'),\n+    (35, 'TOKENDELETE'),\n+    (36, 'TOKENUPDATE'),\n+    (37, 'TOKENMINT'),\n+    (38, 'TOKENBURN'),\n+    (39, 'TOKENWIPE');\n+\n+-- Add hts transaction result types\n+insert into t_transaction_results (proto_id, result) values\n+    (165, 'ACCOUNT_FROZEN_FOR_TOKEN'),\n+    (166, 'TOKENS_PER_ACCOUNT_LIMIT_EXCEEDED'),\n+    (167, 'INVALID_TOKEN_ID'),\n+    (168, 'INVALID_TOKEN_DIVISIBILITY'),\n+    (169, 'INVALID_TOKEN_FLOAT'),\n+    (170, 'INVALID_TREASURY_ACCOUNT_FOR_TOKEN'),\n+    (171, 'INVALID_TOKEN_SYMBOL'),\n+    (172, 'TOKEN_HAS_NO_FREEZE_KEY'),\n+    (173, 'TRANSFERS_NOT_ZERO_SUM_FOR_TOKEN'),\n+    (174, 'MISSING_TOKEN_SYMBOL'),\n+    (175, 'TOKEN_SYMBOL_TOO_LONG'),\n+    (176, 'TOKEN_SYMBOL_ALREADY_IN_USE'),\n+    (177, 'INVALID_TOKEN_REF'),\n+    (178, 'ACCOUNT_KYC_NOT_GRANTED_FOR_TOKEN'),\n+    (179, 'TOKEN_HAS_NO_KYC_KEY'),\n+    (180, 'INSUFFICIENT_TOKEN_BALANCE'),\n+    (181, 'TOKEN_WAS_DELETED'),\n+    (182, 'TOKEN_HAS_NO_SUPPLY_KEY'),\n+    (183, 'TOKEN_HAS_NO_WIPE_KEY'),\n+    (184, 'INVALID_TOKEN_MINT_AMOUNT'),\n+    (185, 'INVALID_TOKEN_BURN_AMOUNT'),\n+    (186, 'ACCOUNT_HAS_NO_TOKEN_RELATIONSHIP'),\n+    (187, 'CANNOT_WIPE_TOKEN_TREASURY_ACCOUNT'),\n+    (188, 'INVALID_KYC_KEY'),\n+    (189, 'INVALID_WIPE_KEY'),\n+    (190, 'INVALID_FREEZE_KEY'),\n+    (191, 'INVALID_SUPPLY_KEY'),\n+    (192, 'TOKEN_NAME_ALREADY_IN_USE'),\n+    (193, 'MISSING_TOKEN_NAME'),\n+    (194, 'TOKEN_NAME_TOO_LONG'),\n+    (195, 'INVALID_WIPING_AMOUNT'),\n+    (196, 'TOKEN_IS_IMMUTABlE');\n+\n+-- Add token table to hold token properties\n+create table if not exists token\n+(\n+    token_id            entity_id               primary key,\n+    created_timestamp   bigint                  not null,\n+    divisibility        bigint                  not null,\n+    freeze_default      boolean                 not null,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd7e80dff2f44a4acdca51016011465a2ea16ce7"}, "originalPosition": 64}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mzg0MTk3NA==", "bodyText": "A constraint also creates an index, otherwise it can't validate the constraint efficiently. This index can be dropped.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1073#discussion_r493841974", "createdAt": "2020-09-23T19:26:46Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-importer/src/main/resources/db/migration/V1.30.1__hts_support.sql", "diffHunk": "@@ -0,0 +1,120 @@\n+-------------------\n+-- Support hts transactions\n+-------------------\n+\n+-- Add new token entity type\n+insert into t_entity_types (id, name) values (5, 'token');\n+\n+-- Add new hts transaction body types\n+insert into t_transaction_types (proto_id, name) values\n+    (28, 'UNCHECKEDSUBMIT'),\n+    (29, 'TOKENCREATE'),\n+    (30, 'TOKENTRANSFER'),\n+    (31, 'TOKENFREEZE'),\n+    (32, 'TOKENUNFREEZE'),\n+    (33, 'TOKENGRANTKYC'),\n+    (34, 'TOKENREVOKEKYC'),\n+    (35, 'TOKENDELETE'),\n+    (36, 'TOKENUPDATE'),\n+    (37, 'TOKENMINT'),\n+    (38, 'TOKENBURN'),\n+    (39, 'TOKENWIPE');\n+\n+-- Add hts transaction result types\n+insert into t_transaction_results (proto_id, result) values\n+    (165, 'ACCOUNT_FROZEN_FOR_TOKEN'),\n+    (166, 'TOKENS_PER_ACCOUNT_LIMIT_EXCEEDED'),\n+    (167, 'INVALID_TOKEN_ID'),\n+    (168, 'INVALID_TOKEN_DIVISIBILITY'),\n+    (169, 'INVALID_TOKEN_FLOAT'),\n+    (170, 'INVALID_TREASURY_ACCOUNT_FOR_TOKEN'),\n+    (171, 'INVALID_TOKEN_SYMBOL'),\n+    (172, 'TOKEN_HAS_NO_FREEZE_KEY'),\n+    (173, 'TRANSFERS_NOT_ZERO_SUM_FOR_TOKEN'),\n+    (174, 'MISSING_TOKEN_SYMBOL'),\n+    (175, 'TOKEN_SYMBOL_TOO_LONG'),\n+    (176, 'TOKEN_SYMBOL_ALREADY_IN_USE'),\n+    (177, 'INVALID_TOKEN_REF'),\n+    (178, 'ACCOUNT_KYC_NOT_GRANTED_FOR_TOKEN'),\n+    (179, 'TOKEN_HAS_NO_KYC_KEY'),\n+    (180, 'INSUFFICIENT_TOKEN_BALANCE'),\n+    (181, 'TOKEN_WAS_DELETED'),\n+    (182, 'TOKEN_HAS_NO_SUPPLY_KEY'),\n+    (183, 'TOKEN_HAS_NO_WIPE_KEY'),\n+    (184, 'INVALID_TOKEN_MINT_AMOUNT'),\n+    (185, 'INVALID_TOKEN_BURN_AMOUNT'),\n+    (186, 'ACCOUNT_HAS_NO_TOKEN_RELATIONSHIP'),\n+    (187, 'CANNOT_WIPE_TOKEN_TREASURY_ACCOUNT'),\n+    (188, 'INVALID_KYC_KEY'),\n+    (189, 'INVALID_WIPE_KEY'),\n+    (190, 'INVALID_FREEZE_KEY'),\n+    (191, 'INVALID_SUPPLY_KEY'),\n+    (192, 'TOKEN_NAME_ALREADY_IN_USE'),\n+    (193, 'MISSING_TOKEN_NAME'),\n+    (194, 'TOKEN_NAME_TOO_LONG'),\n+    (195, 'INVALID_WIPING_AMOUNT'),\n+    (196, 'TOKEN_IS_IMMUTABlE');\n+\n+-- Add token table to hold token properties\n+create table if not exists token\n+(\n+    token_id            entity_id               primary key,\n+    created_timestamp   bigint                  not null,\n+    divisibility        bigint                  not null,\n+    freeze_default      boolean                 not null,\n+    freeze_key          bytea,\n+    initial_supply      bigint                  not null,\n+    kyc_default         boolean                 not null,\n+    kyc_key             bytea,\n+    modified_timestamp  bigint                  not null,\n+    supply_key          bytea,\n+    symbol              character varying(100)  not null,\n+    treasury_account_id entity_id               not null,\n+    wipe_key            bytea\n+);\n+\n+--- Add token_account table to capture token-account info such as frozen, kyc and wipe status\n+create table if not exists token_account\n+(\n+    id                  serial              primary key,\n+    account_id          entity_id           not null,\n+    created_timestamp   bigint              not null,\n+    frozen              boolean             not null default false,\n+    kyc                 boolean             not null default false,\n+    modified_timestamp  bigint              not null,\n+    token_id            entity_id           not null,\n+    wiped               boolean             not null default false\n+);\n+\n+create unique index if not exists token_account__token_account on token_account(token_id, account_id);\n+\n+\n+--- Add token_balance table to capture token account balances\n+create table if not exists token_balance\n+(\n+    consensus_timestamp bigint              not null,\n+    account_id          entity_id           not null,\n+    balance             bigint              not null,\n+    token_id            entity_id           not null\n+);\n+\n+alter table if exists token_balance\n+    add constraint token_balance__pk primary key (consensus_timestamp, token_id, account_id);\n+\n+create index if not exists token_balance__token_account_timestamp", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd7e80dff2f44a4acdca51016011465a2ea16ce7"}, "originalPosition": 104}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3f1e8985996618fa4e0ee81e6d3bb3e2f75c5dd7", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/3f1e8985996618fa4e0ee81e6d3bb3e2f75c5dd7", "committedDate": "2020-09-23T20:29:51Z", "message": "Dropped subset token_transfer index and added boolean defaults\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4ae45dbeaedb7aa25dbb431a453602d9e67b53b2", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/4ae45dbeaedb7aa25dbb431a453602d9e67b53b2", "committedDate": "2020-09-23T21:40:43Z", "message": "Dropped additional token_balance index\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1MDY5NTU1", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1073#pullrequestreview-495069555", "createdAt": "2020-09-23T21:42:24Z", "commit": {"oid": "4ae45dbeaedb7aa25dbb431a453602d9e67b53b2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk1MTA0Mzkz", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1073#pullrequestreview-495104393", "createdAt": "2020-09-23T22:59:15Z", "commit": {"oid": "4ae45dbeaedb7aa25dbb431a453602d9e67b53b2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3549, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}