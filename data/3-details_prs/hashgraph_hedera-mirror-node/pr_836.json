{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM4MDY3NzEw", "number": 836, "title": "Kubernetes Test Run Job Logic", "bodyText": "Detailed description:\nAs we reach scale it's important to be able to deploy and run the acceptance and performance tests in the cloud so we are not limited by local machine performance.\nThis PR adds a few Kubernetes Job templates that utilize the Hedera-mirror-test image to run tests in a pod container in a Kubernetes cluster\n\nAdds a hedera-mirror-test/src/test/resources/k8s/hcs-load-publish.yml file that can be used to run the @PublishOnly acceptance test to publish HCS messages to a desired topic\nAdds a hedera-mirror-test/src/test/resources/k8s/hcs-load-subscribe.yml file that can be used to run the SubscribeOnly performance test to listen to messages for specific topics\nUpdates the Hedera-mirror-test README to explain how configuration should be populated\n\nWhich issue(s) this PR fixes:\nFixes #841\nSpecial notes for your reviewer:\nChecklist\n\n Documentation added\n Tests updated", "createdAt": "2020-06-22T16:59:52Z", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/836", "merged": true, "mergeCommit": {"oid": "afa2bccaa82e7bee83dd0bad8a6c45aeb66cbb9a"}, "closed": true, "closedAt": "2020-06-24T14:26:18Z", "author": {"login": "Nana-EC"}, "timelineItems": {"totalCount": 26, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABct3f51AFqTQzNTI1NDE0Nw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcua2WtAFqTQzNjY5NzY0Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM1MjU0MTQ3", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/836#pullrequestreview-435254147", "createdAt": "2020-06-22T20:35:38Z", "commit": {"oid": "9bc5461ba80312aed3b083b1b56cdfe221f99dc9"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQyMDozOToyMlrOGnQLaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yMlQyMToxMjowN1rOGnRLQw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzgxMjcxMg==", "bodyText": "Should be a Secret since it contains keys. Use stringData instead of data for secret", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/836#discussion_r443812712", "createdAt": "2020-06-22T20:39:22Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-test/src/test/resources/k8s/hcs-perf-publish-test.yml", "diffHunk": "@@ -0,0 +1,52 @@\n+apiVersion: v1\n+kind: ConfigMap", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9bc5461ba80312aed3b083b1b56cdfe221f99dc9"}, "originalPosition": 2}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzgxMzYxMQ==", "bodyText": "Shouldn't use always for checked in manifests. Can remove as it defaults to IfNotPresent", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/836#discussion_r443813611", "createdAt": "2020-06-22T20:40:59Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-test/src/test/resources/k8s/hcs-perf-publish-test.yml", "diffHunk": "@@ -0,0 +1,52 @@\n+apiVersion: v1\n+kind: ConfigMap\n+metadata:\n+  name: hcs-perf-publish-config\n+data:\n+  application-yaml: |-\n+    hedera:\n+      mirror:\n+        test:\n+          acceptance:\n+            messageTimeout: 60s\n+            nodeId: 0.0.3\n+            nodeAddress: testnet\n+            mirrornodeAddress: hcs.testnet.mirrornode.hedera.com:5600\n+            operatorid:\n+            operatorkey:\n+            existingTopicNum:\n+            emitBackgroundMessages: true\n+---\n+apiVersion: batch/v1\n+kind: Job\n+metadata:\n+  name: hcs-perf-publish-test\n+spec:\n+  completions: 1\n+  parallelism: 1\n+  template:\n+    metadata:\n+      name: hcs-perf-publish-test\n+    spec:\n+      restartPolicy: Never\n+      containers:\n+        - image: gcr.io/mirrornode/hedera-mirror-test:0.13.0-rc1\n+          imagePullPolicy: Always", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9bc5461ba80312aed3b083b1b56cdfe221f99dc9"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzgxNTM5NQ==", "bodyText": "Should add pod anti affinity rules to schedule pods on different nodes:\naffinity:\n  podAntiAffinity:\n    preferredDuringSchedulingIgnoredDuringExecution:\n      - weight: 100\n        podAffinityTerm:\n          topologyKey: kubernetes.io/hostname\n          labelSelector:\n            matchLabels:\n              app.kubernetes.io/name: test", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/836#discussion_r443815395", "createdAt": "2020-06-22T20:44:27Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-test/src/test/resources/k8s/hcs-perf-publish-test.yml", "diffHunk": "@@ -0,0 +1,52 @@\n+apiVersion: v1\n+kind: ConfigMap\n+metadata:\n+  name: hcs-perf-publish-config\n+data:\n+  application-yaml: |-\n+    hedera:\n+      mirror:\n+        test:\n+          acceptance:\n+            messageTimeout: 60s\n+            nodeId: 0.0.3\n+            nodeAddress: testnet\n+            mirrornodeAddress: hcs.testnet.mirrornode.hedera.com:5600\n+            operatorid:\n+            operatorkey:\n+            existingTopicNum:\n+            emitBackgroundMessages: true\n+---\n+apiVersion: batch/v1\n+kind: Job\n+metadata:\n+  name: hcs-perf-publish-test\n+spec:\n+  completions: 1\n+  parallelism: 1\n+  template:\n+    metadata:\n+      name: hcs-perf-publish-test\n+    spec:\n+      restartPolicy: Never", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9bc5461ba80312aed3b083b1b56cdfe221f99dc9"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzgxOTA2MA==", "bodyText": "Should add pod label app.kubernetes.io/name: test for use with affinity to spec.template.metadata.labels.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/836#discussion_r443819060", "createdAt": "2020-06-22T20:51:48Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-test/src/test/resources/k8s/hcs-perf-publish-test.yml", "diffHunk": "@@ -0,0 +1,52 @@\n+apiVersion: v1\n+kind: ConfigMap\n+metadata:\n+  name: hcs-perf-publish-config\n+data:\n+  application-yaml: |-\n+    hedera:\n+      mirror:\n+        test:\n+          acceptance:\n+            messageTimeout: 60s\n+            nodeId: 0.0.3\n+            nodeAddress: testnet\n+            mirrornodeAddress: hcs.testnet.mirrornode.hedera.com:5600\n+            operatorid:\n+            operatorkey:\n+            existingTopicNum:\n+            emitBackgroundMessages: true\n+---\n+apiVersion: batch/v1\n+kind: Job\n+metadata:\n+  name: hcs-perf-publish-test\n+spec:\n+  completions: 1\n+  parallelism: 1\n+  template:\n+    metadata:\n+      name: hcs-perf-publish-test", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9bc5461ba80312aed3b083b1b56cdfe221f99dc9"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzgxOTQzNg==", "bodyText": "Does replacer replace this version?", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/836#discussion_r443819436", "createdAt": "2020-06-22T20:52:31Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-test/src/test/resources/k8s/hcs-perf-publish-test.yml", "diffHunk": "@@ -0,0 +1,52 @@\n+apiVersion: v1\n+kind: ConfigMap\n+metadata:\n+  name: hcs-perf-publish-config\n+data:\n+  application-yaml: |-\n+    hedera:\n+      mirror:\n+        test:\n+          acceptance:\n+            messageTimeout: 60s\n+            nodeId: 0.0.3\n+            nodeAddress: testnet\n+            mirrornodeAddress: hcs.testnet.mirrornode.hedera.com:5600\n+            operatorid:\n+            operatorkey:\n+            existingTopicNum:\n+            emitBackgroundMessages: true\n+---\n+apiVersion: batch/v1\n+kind: Job\n+metadata:\n+  name: hcs-perf-publish-test\n+spec:\n+  completions: 1\n+  parallelism: 1\n+  template:\n+    metadata:\n+      name: hcs-perf-publish-test\n+    spec:\n+      restartPolicy: Never\n+      containers:\n+        - image: gcr.io/mirrornode/hedera-mirror-test:0.13.0-rc1", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9bc5461ba80312aed3b083b1b56cdfe221f99dc9"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzgxOTQ5MA==", "bodyText": "0.13.2", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/836#discussion_r443819490", "createdAt": "2020-06-22T20:52:39Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-test/src/test/resources/k8s/hcs-perf-publish-test.yml", "diffHunk": "@@ -0,0 +1,52 @@\n+apiVersion: v1\n+kind: ConfigMap\n+metadata:\n+  name: hcs-perf-publish-config\n+data:\n+  application-yaml: |-\n+    hedera:\n+      mirror:\n+        test:\n+          acceptance:\n+            messageTimeout: 60s\n+            nodeId: 0.0.3\n+            nodeAddress: testnet\n+            mirrornodeAddress: hcs.testnet.mirrornode.hedera.com:5600\n+            operatorid:\n+            operatorkey:\n+            existingTopicNum:\n+            emitBackgroundMessages: true\n+---\n+apiVersion: batch/v1\n+kind: Job\n+metadata:\n+  name: hcs-perf-publish-test\n+spec:\n+  completions: 1\n+  parallelism: 1\n+  template:\n+    metadata:\n+      name: hcs-perf-publish-test\n+    spec:\n+      restartPolicy: Never\n+      containers:\n+        - image: gcr.io/mirrornode/hedera-mirror-test:0.13.0-rc1", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9bc5461ba80312aed3b083b1b56cdfe221f99dc9"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzgyMzA4Mg==", "bodyText": "Container name can be simpler like test since that's easier to remember and it's already within the context of job/pod name.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/836#discussion_r443823082", "createdAt": "2020-06-22T20:59:49Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-test/src/test/resources/k8s/hcs-perf-publish-test.yml", "diffHunk": "@@ -0,0 +1,52 @@\n+apiVersion: v1\n+kind: ConfigMap\n+metadata:\n+  name: hcs-perf-publish-config\n+data:\n+  application-yaml: |-\n+    hedera:\n+      mirror:\n+        test:\n+          acceptance:\n+            messageTimeout: 60s\n+            nodeId: 0.0.3\n+            nodeAddress: testnet\n+            mirrornodeAddress: hcs.testnet.mirrornode.hedera.com:5600\n+            operatorid:\n+            operatorkey:\n+            existingTopicNum:\n+            emitBackgroundMessages: true\n+---\n+apiVersion: batch/v1\n+kind: Job\n+metadata:\n+  name: hcs-perf-publish-test\n+spec:\n+  completions: 1\n+  parallelism: 1\n+  template:\n+    metadata:\n+      name: hcs-perf-publish-test\n+    spec:\n+      restartPolicy: Never\n+      containers:\n+        - image: gcr.io/mirrornode/hedera-mirror-test:0.13.0-rc1\n+          imagePullPolicy: Always\n+          name: publish-test-img", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9bc5461ba80312aed3b083b1b56cdfe221f99dc9"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzgyNDI2Mw==", "bodyText": "This is a bit strange. Does an application.yaml pick up if you put it in /usr/etc/hedera-mirror-node/hedera-mirror-test/ instead? Placing file within codebase seems wrong. Consider using SPRING_CONFIG_ADDITIONAL_LOCATION env variable to configure path outside of codebase.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/836#discussion_r443824263", "createdAt": "2020-06-22T21:02:07Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-test/src/test/resources/k8s/hcs-perf-publish-test.yml", "diffHunk": "@@ -0,0 +1,52 @@\n+apiVersion: v1\n+kind: ConfigMap\n+metadata:\n+  name: hcs-perf-publish-config\n+data:\n+  application-yaml: |-\n+    hedera:\n+      mirror:\n+        test:\n+          acceptance:\n+            messageTimeout: 60s\n+            nodeId: 0.0.3\n+            nodeAddress: testnet\n+            mirrornodeAddress: hcs.testnet.mirrornode.hedera.com:5600\n+            operatorid:\n+            operatorkey:\n+            existingTopicNum:\n+            emitBackgroundMessages: true\n+---\n+apiVersion: batch/v1\n+kind: Job\n+metadata:\n+  name: hcs-perf-publish-test\n+spec:\n+  completions: 1\n+  parallelism: 1\n+  template:\n+    metadata:\n+      name: hcs-perf-publish-test\n+    spec:\n+      restartPolicy: Never\n+      containers:\n+        - image: gcr.io/mirrornode/hedera-mirror-test:0.13.0-rc1\n+          imagePullPolicy: Always\n+          name: publish-test-img\n+          env:\n+            - name: testProfile\n+              value: \"acceptance\"\n+            - name: cucumberFlags\n+              value: \"@PublishOnly\"\n+          volumeMounts:\n+            - name: publish-config-volume\n+              mountPath: /usr/etc/hedera-mirror-node/hedera-mirror-test/src/test/resources/application-default.yml", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9bc5461ba80312aed3b083b1b56cdfe221f99dc9"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzgyNDQyOA==", "bodyText": "Name the key in ConfigMap as application-default.yaml then you don't need this items section and subPath in volumeMounts", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/836#discussion_r443824428", "createdAt": "2020-06-22T21:02:30Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-test/src/test/resources/k8s/hcs-perf-publish-test.yml", "diffHunk": "@@ -0,0 +1,52 @@\n+apiVersion: v1\n+kind: ConfigMap\n+metadata:\n+  name: hcs-perf-publish-config\n+data:\n+  application-yaml: |-\n+    hedera:\n+      mirror:\n+        test:\n+          acceptance:\n+            messageTimeout: 60s\n+            nodeId: 0.0.3\n+            nodeAddress: testnet\n+            mirrornodeAddress: hcs.testnet.mirrornode.hedera.com:5600\n+            operatorid:\n+            operatorkey:\n+            existingTopicNum:\n+            emitBackgroundMessages: true\n+---\n+apiVersion: batch/v1\n+kind: Job\n+metadata:\n+  name: hcs-perf-publish-test\n+spec:\n+  completions: 1\n+  parallelism: 1\n+  template:\n+    metadata:\n+      name: hcs-perf-publish-test\n+    spec:\n+      restartPolicy: Never\n+      containers:\n+        - image: gcr.io/mirrornode/hedera-mirror-test:0.13.0-rc1\n+          imagePullPolicy: Always\n+          name: publish-test-img\n+          env:\n+            - name: testProfile\n+              value: \"acceptance\"\n+            - name: cucumberFlags\n+              value: \"@PublishOnly\"\n+          volumeMounts:\n+            - name: publish-config-volume\n+              mountPath: /usr/etc/hedera-mirror-node/hedera-mirror-test/src/test/resources/application-default.yml\n+              subPath: application-default.yml\n+      volumes:\n+        - name: publish-config-volume\n+          configMap:\n+            defaultMode: 0555\n+            name: hcs-perf-publish-config\n+            items:\n+              - key: application-yaml", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9bc5461ba80312aed3b083b1b56cdfe221f99dc9"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzgyNjAyMQ==", "bodyText": "420 would be more appropriate", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/836#discussion_r443826021", "createdAt": "2020-06-22T21:05:47Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-test/src/test/resources/k8s/hcs-perf-publish-test.yml", "diffHunk": "@@ -0,0 +1,52 @@\n+apiVersion: v1\n+kind: ConfigMap\n+metadata:\n+  name: hcs-perf-publish-config\n+data:\n+  application-yaml: |-\n+    hedera:\n+      mirror:\n+        test:\n+          acceptance:\n+            messageTimeout: 60s\n+            nodeId: 0.0.3\n+            nodeAddress: testnet\n+            mirrornodeAddress: hcs.testnet.mirrornode.hedera.com:5600\n+            operatorid:\n+            operatorkey:\n+            existingTopicNum:\n+            emitBackgroundMessages: true\n+---\n+apiVersion: batch/v1\n+kind: Job\n+metadata:\n+  name: hcs-perf-publish-test\n+spec:\n+  completions: 1\n+  parallelism: 1\n+  template:\n+    metadata:\n+      name: hcs-perf-publish-test\n+    spec:\n+      restartPolicy: Never\n+      containers:\n+        - image: gcr.io/mirrornode/hedera-mirror-test:0.13.0-rc1\n+          imagePullPolicy: Always\n+          name: publish-test-img\n+          env:\n+            - name: testProfile\n+              value: \"acceptance\"\n+            - name: cucumberFlags\n+              value: \"@PublishOnly\"\n+          volumeMounts:\n+            - name: publish-config-volume\n+              mountPath: /usr/etc/hedera-mirror-node/hedera-mirror-test/src/test/resources/application-default.yml\n+              subPath: application-default.yml\n+      volumes:\n+        - name: publish-config-volume\n+          configMap:\n+            defaultMode: 0555", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9bc5461ba80312aed3b083b1b56cdfe221f99dc9"}, "originalPosition": 48}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzgyNjU2MQ==", "bodyText": "A container level securityContext would be good so we're not running as root (same level as env):\nsecurityContext:\n  capabilities:\n    drop: [ALL]\n  readOnlyRootFilesystem: true\n  runAsGroup: 1000\n  runAsNonRoot: true\n  runAsUser: 1000", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/836#discussion_r443826561", "createdAt": "2020-06-22T21:06:59Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-test/src/test/resources/k8s/hcs-perf-publish-test.yml", "diffHunk": "@@ -0,0 +1,52 @@\n+apiVersion: v1\n+kind: ConfigMap\n+metadata:\n+  name: hcs-perf-publish-config\n+data:\n+  application-yaml: |-\n+    hedera:\n+      mirror:\n+        test:\n+          acceptance:\n+            messageTimeout: 60s\n+            nodeId: 0.0.3\n+            nodeAddress: testnet\n+            mirrornodeAddress: hcs.testnet.mirrornode.hedera.com:5600\n+            operatorid:\n+            operatorkey:\n+            existingTopicNum:\n+            emitBackgroundMessages: true\n+---\n+apiVersion: batch/v1\n+kind: Job\n+metadata:\n+  name: hcs-perf-publish-test\n+spec:\n+  completions: 1\n+  parallelism: 1\n+  template:\n+    metadata:\n+      name: hcs-perf-publish-test\n+    spec:\n+      restartPolicy: Never\n+      containers:\n+        - image: gcr.io/mirrornode/hedera-mirror-test:0.13.0-rc1\n+          imagePullPolicy: Always\n+          name: publish-test-img\n+          env:\n+            - name: testProfile\n+              value: \"acceptance\"\n+            - name: cucumberFlags\n+              value: \"@PublishOnly\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9bc5461ba80312aed3b083b1b56cdfe221f99dc9"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzgyODA5Mw==", "bodyText": "All the same comments to hcs-perf-publish-test.yml apply to this file as well.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/836#discussion_r443828093", "createdAt": "2020-06-22T21:10:12Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-test/src/test/resources/k8s/hcs-perf-subscribe-test.yml", "diffHunk": "@@ -0,0 +1,56 @@\n+apiVersion: v1", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9bc5461ba80312aed3b083b1b56cdfe221f99dc9"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzgyOTA1OQ==", "bodyText": "I don't think this file is useful. It's not runnable as is and is quite a bit of config to get right. Would be better to just keep the concrete test cases that need minor tweaking to IPs, keys, etc.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/836#discussion_r443829059", "createdAt": "2020-06-22T21:12:07Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-test/README.md", "diffHunk": "@@ -181,25 +209,96 @@ The initial jmx test plan files under `hedera-mirror-test/src/test/jmeter/` foll\n 4.  DB_Cleanup_Sampler - Cleans up the db\n     -   (See DB_Setup_Sampler options)\n \n+> **_Note:_** Subscribe_Only tests only cover section 3. No db operations are carried out.\n+\n+\n # 3 Containerized Run\n \n The hedera-mirror-test module offers a containerized distribution of the [acceptance](#acceptance-test-execution) and [performance](#performance-test-execution) tests.\n \n-## Image creation\n+## Kubernetes Cluster Run\n+\n+The repo provides a default Kubernetes [Job](https://kubernetes.io/docs/concepts/workloads/controllers/job/) and [ConfigMap](https://kubernetes.io/docs/concepts/configuration/configmap/) spec template in a single file under `hedera-mirror-test/src/test/resources/k8s/run-test.yml`\n+Running this file as follows will deploy a Kubernetes [pod](https://kubernetes.io/docs/concepts/workloads/pods/pod/) with a container that runs the acceptance or performance tests in the cloud.\n+\n+    kubectl apply -f hedera-mirror-test/src/test/resources/k8s/run-test.yml", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9bc5461ba80312aed3b083b1b56cdfe221f99dc9"}, "originalPosition": 67}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7fe329dec50b57c6526038b5c6fbe79d385a07fe", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/7fe329dec50b57c6526038b5c6fbe79d385a07fe", "committedDate": "2020-06-23T20:12:25Z", "message": "Added publish and load k8 jobs\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "218a3847f9faeb58e4f91f93426902cc39940d12", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/218a3847f9faeb58e4f91f93426902cc39940d12", "committedDate": "2020-06-23T20:12:25Z", "message": "k8s deployment config file correction\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e155b95607609c5b6ae5b4afc7fa1639a9e7abc8", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/e155b95607609c5b6ae5b4afc7fa1639a9e7abc8", "committedDate": "2020-06-23T20:12:25Z", "message": "Set 2 parallel runs for historic and incoming messages for subscriber job\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "523035cdcb268c01c5a11e7c78319b25e3b088ab", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/523035cdcb268c01c5a11e7c78319b25e3b088ab", "committedDate": "2020-06-23T20:12:25Z", "message": "Configure for perf testing\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6a4d83ec571446a532a479f82cac8bd735159ed8", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/6a4d83ec571446a532a479f82cac8bd735159ed8", "committedDate": "2020-06-23T20:12:25Z", "message": "Temp test configs\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c6abbde4aca621243180e16eb7b93e9d8d9c5eb0", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/c6abbde4aca621243180e16eb7b93e9d8d9c5eb0", "committedDate": "2020-06-23T20:12:25Z", "message": "Moved job files to test resources dir\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "61cb9d1cc0e525bd6ca584169383e285eecaf47a", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/61cb9d1cc0e525bd6ca584169383e285eecaf47a", "committedDate": "2020-06-23T20:12:25Z", "message": "Renamed files and added default template\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8fc1ad777518eb88c3b6d4e10e343b06239e6853", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/8fc1ad777518eb88c3b6d4e10e343b06239e6853", "committedDate": "2020-06-23T20:12:25Z", "message": "Added test documentaion for k8s runs\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5877fd475f8863f34bea5fe19eda4d75c945d397", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/5877fd475f8863f34bea5fe19eda4d75c945d397", "committedDate": "2020-06-23T20:12:26Z", "message": "Adopted secrets for publish job and other feedback suggestions\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "45553e57a1a9e7ad026156ebea1cc569c1f50d76", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/45553e57a1a9e7ad026156ebea1cc569c1f50d76", "committedDate": "2020-06-23T20:12:26Z", "message": "Removed documentation section\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9e21e75adb68647f7eccb42a30704833991bcfed", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/9e21e75adb68647f7eccb42a30704833991bcfed", "committedDate": "2020-06-23T20:12:26Z", "message": "Added publish and load k8 jobs\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "be19ad4b534869e92d84b6e89931cbfa1f8aa14e", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/be19ad4b534869e92d84b6e89931cbfa1f8aa14e", "committedDate": "2020-06-23T20:12:26Z", "message": "k8s deployment config file correction\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d30b020fcbaabd1619bad6031c6a6de4ef60f3a1", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/d30b020fcbaabd1619bad6031c6a6de4ef60f3a1", "committedDate": "2020-06-23T20:12:26Z", "message": "Set 2 parallel runs for historic and incoming messages for subscriber job\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d1945459998e3dadaeb60b6d480720ecc952c60", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/3d1945459998e3dadaeb60b6d480720ecc952c60", "committedDate": "2020-06-23T20:12:26Z", "message": "Configure for perf testing\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9b38f5de67ee4fc987476050bf0cf0db26173a2b", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/9b38f5de67ee4fc987476050bf0cf0db26173a2b", "committedDate": "2020-06-23T20:12:26Z", "message": "Temp test configs\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "49ca5b178d171ba602c5c0ef11b845c73da995b4", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/49ca5b178d171ba602c5c0ef11b845c73da995b4", "committedDate": "2020-06-23T20:12:26Z", "message": "Moved job files to test resources dir\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8bdf295d4b2ec4271173ec91cd39aee4c9fe4654", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/8bdf295d4b2ec4271173ec91cd39aee4c9fe4654", "committedDate": "2020-06-23T20:15:07Z", "message": "Renamed files and added default template\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e556201782986ad332d71807008d260c9ea97aee", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/e556201782986ad332d71807008d260c9ea97aee", "committedDate": "2020-06-23T20:15:07Z", "message": "Added test documentaion for k8s runs\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "129397816f41cd8ba5b6b63de8074660ffde95ff", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/129397816f41cd8ba5b6b63de8074660ffde95ff", "committedDate": "2020-06-23T20:15:07Z", "message": "Adopted secrets for publish job and other feedback suggestions\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "52e2b360a6406d354b0c1aa1b410ec75bf0eefb3", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/52e2b360a6406d354b0c1aa1b410ec75bf0eefb3", "committedDate": "2020-06-23T20:15:07Z", "message": "Removed documentation section\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f25029e8c627a409ebc8ea4ab080d88c837507b5", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/f25029e8c627a409ebc8ea4ab080d88c837507b5", "committedDate": "2020-06-23T20:10:57Z", "message": "Merge branch 'k8-hcs-perf' of https://github.com/hashgraph/hedera-mirror-node into k8-hcs-perf\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}, "afterCommit": {"oid": "52e2b360a6406d354b0c1aa1b410ec75bf0eefb3", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/52e2b360a6406d354b0c1aa1b410ec75bf0eefb3", "committedDate": "2020-06-23T20:15:07Z", "message": "Removed documentation section\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1cac6e99c57d2e5e0bb2ee5b3ee58c5ae8a8822f", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/1cac6e99c57d2e5e0bb2ee5b3ee58c5ae8a8822f", "committedDate": "2020-06-23T20:27:33Z", "message": "Updated docker image tag\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2MTU0Njc1", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/836#pullrequestreview-436154675", "createdAt": "2020-06-23T21:01:17Z", "commit": {"oid": "1cac6e99c57d2e5e0bb2ee5b3ee58c5ae8a8822f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QyMTowMToxN1rOGn6f4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QyMzoyMjo0OFrOGn92RQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDUwNjA4Mg==", "bodyText": "This label does not match the label in the affinity, making affinity non-effective. This one should be app.kubernetes.io/name as it is the standard label.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/836#discussion_r444506082", "createdAt": "2020-06-23T21:01:17Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-test/src/test/resources/k8s/hcs-perf-subscribe-test.yml", "diffHunk": "@@ -0,0 +1,68 @@\n+apiVersion: v1\n+kind: ConfigMap\n+metadata:\n+  name: hcs-perf-subscribe-config\n+data:\n+  user-props: |-\n+    hedera.mirror.test.performance.host=hcs.testnet.mirrornode.hedera.com\n+    hedera.mirror.test.performance.port=5600\n+    hedera.mirror.test.performance.clientCount=1\n+    hedera.mirror.test.performance.sharedChannel=false\n+    hedera.mirror.test.performance.clientTopicId[0]=47020\n+    hedera.mirror.test.performance.clientStartTime[0]=\n+    hedera.mirror.test.performance.clientEndTime[0]=0\n+    hedera.mirror.test.performance.clientLimit[0]=0\n+    hedera.mirror.test.performance.clientRealmNum[0]=0\n+    hedera.mirror.test.performance.clientHistoricMessagesCount[0]=0\n+    hedera.mirror.test.performance.clientIncomingMessageCount[0]=10\n+    hedera.mirror.test.performance.clientSubscribeTimeoutSeconds[0]=60\n+    hedera.mirror.test.performance.clientMilliSecWaitBefore[0]=0\n+    hedera.mirror.test.performance.clientUseMAPI[0]=true\n+---\n+apiVersion: batch/v1\n+kind: Job\n+metadata:\n+  name: hcs-perf-subscribe-test\n+  labels:\n+    app.kubernetes.io/name: test\n+spec:\n+  completions: 3\n+  parallelism: 3\n+  template:\n+    metadata:\n+      name: hcs-perf-subscribe-test\n+      labels:\n+        app: test", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1cac6e99c57d2e5e0bb2ee5b3ee58c5ae8a8822f"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDUxMTgzMw==", "bodyText": "This label does not match the label in the affinity, making affinity non-effective. This one should be app.kubernetes.io/name as it is the standard label.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/836#discussion_r444511833", "createdAt": "2020-06-23T21:12:49Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-test/src/test/resources/k8s/hcs-perf-publish-test.yml", "diffHunk": "@@ -0,0 +1,63 @@\n+apiVersion: v1\n+kind: Secret\n+metadata:\n+  name: hcs-perf-publish-secret\n+stringData:\n+  application-default.yml: |-\n+    hedera:\n+      mirror:\n+        test:\n+          acceptance:\n+            messageTimeout: 60s\n+            nodeId: 0.0.3\n+            nodeAddress: testnet\n+            mirrornodeAddress: hcs.testnet.mirrornode.hedera.com:5600\n+            operatorid:\n+            operatorkey:\n+            existingTopicNum:\n+            emitBackgroundMessages: true\n+---\n+apiVersion: batch/v1\n+kind: Job\n+metadata:\n+  name: hcs-perf-publish-test\n+  labels:\n+    app.kubernetes.io/name: test\n+spec:\n+  completions: 1\n+  parallelism: 1\n+  template:\n+    metadata:\n+      name: hcs-perf-publish-test\n+      labels:\n+        app: test", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1cac6e99c57d2e5e0bb2ee5b3ee58c5ae8a8822f"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDU2MDk2NQ==", "bodyText": "As mentioned, you don't need items. Just name your key in secret as user.properties. Likewise you don't need subpath in mount as by default it will mount all files in secret in dir:\nvolumeMounts:\n- name: subscribe-config-volume\n  mountPath: /usr/etc/hedera-mirror-test", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/836#discussion_r444560965", "createdAt": "2020-06-23T23:22:48Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-test/src/test/resources/k8s/hcs-perf-subscribe-test.yml", "diffHunk": "@@ -0,0 +1,68 @@\n+apiVersion: v1\n+kind: ConfigMap\n+metadata:\n+  name: hcs-perf-subscribe-config\n+data:\n+  user-props: |-\n+    hedera.mirror.test.performance.host=hcs.testnet.mirrornode.hedera.com\n+    hedera.mirror.test.performance.port=5600\n+    hedera.mirror.test.performance.clientCount=1\n+    hedera.mirror.test.performance.sharedChannel=false\n+    hedera.mirror.test.performance.clientTopicId[0]=47020\n+    hedera.mirror.test.performance.clientStartTime[0]=\n+    hedera.mirror.test.performance.clientEndTime[0]=0\n+    hedera.mirror.test.performance.clientLimit[0]=0\n+    hedera.mirror.test.performance.clientRealmNum[0]=0\n+    hedera.mirror.test.performance.clientHistoricMessagesCount[0]=0\n+    hedera.mirror.test.performance.clientIncomingMessageCount[0]=10\n+    hedera.mirror.test.performance.clientSubscribeTimeoutSeconds[0]=60\n+    hedera.mirror.test.performance.clientMilliSecWaitBefore[0]=0\n+    hedera.mirror.test.performance.clientUseMAPI[0]=true\n+---\n+apiVersion: batch/v1\n+kind: Job\n+metadata:\n+  name: hcs-perf-subscribe-test\n+  labels:\n+    app.kubernetes.io/name: test\n+spec:\n+  completions: 3\n+  parallelism: 3\n+  template:\n+    metadata:\n+      name: hcs-perf-subscribe-test\n+      labels:\n+        app: test\n+    spec:\n+      affinity:\n+        podAntiAffinity:\n+          preferredDuringSchedulingIgnoredDuringExecution:\n+            - weight: 100\n+              podAffinityTerm:\n+                topologyKey: kubernetes.io/hostname\n+                labelSelector:\n+                  matchLabels:\n+                    app.kubernetes.io/name: test\n+      restartPolicy: Never\n+      containers:\n+        - image: gcr.io/mirrornode/hedera-mirror-test:0.13.2\n+          name: test\n+          env:\n+            - name: testProfile\n+              value: \"performance\"\n+            - name: subscribeThreadCount\n+              value: \"4\"\n+            - name: jmeter.test\n+              value: \"E2E_Subscribe_Only.jmx\"\n+          volumeMounts:\n+            - name: subscribe-config-volume\n+              mountPath: /usr/etc/hedera-mirror-node/hedera-mirror-test/user.properties\n+              subPath: user.properties\n+      volumes:\n+        - name: subscribe-config-volume\n+          configMap:\n+            defaultMode: 420\n+            name: hcs-perf-subscribe-config\n+            items:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1cac6e99c57d2e5e0bb2ee5b3ee58c5ae8a8822f"}, "originalPosition": 66}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cfa65034886dfcce3ebf44518252b35e66b5308c", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/cfa65034886dfcce3ebf44518252b35e66b5308c", "committedDate": "2020-06-24T08:00:22Z", "message": "Configured external propoerty files\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2Njk3NjQy", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/836#pullrequestreview-436697642", "createdAt": "2020-06-24T14:23:30Z", "commit": {"oid": "cfa65034886dfcce3ebf44518252b35e66b5308c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3208, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}