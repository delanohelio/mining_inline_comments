{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkyMjEyMzcw", "number": 617, "title": "Increase rest api integration coverage to match api offerings 2", "bodyText": "Detailed description:\nAs noted in #412 \"We keep having regressions in the REST API because we don't have good test coverage. We have an integration test framework but it is not filled out with specs for all URLs and combinations of parameters.\"\nThis PR increases the integration test coverage by providing parity coverage with The REST API endpoints and parameter options.\nSpecifically balance and transaction specs were added.\n\nAdded negative and empty response integration spec files  for accounts, balances and transactions.\nUpdated integrationDomainOps.js to support specifying more entity fields\nUpdated utils.js to centralize error message formats as accounts and transactions weren't sending json for some error scenarios\n\nWhich issue(s) this PR fixes:\nFixes #412\nSpecial notes for your reviewer:\nChecklist\n\n Documentation added\n Tests updated", "createdAt": "2020-03-23T07:43:31Z", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/617", "merged": true, "mergeCommit": {"oid": "173b4787d72cd425299fcb152ec0103fd7acfd61"}, "closed": true, "closedAt": "2020-03-24T18:26:41Z", "author": {"login": "Nana-EC"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcP8yEGAH2gAyMzkyMjEyMzcwOmMwMzljY2Y0NjUzZjUzZjMwYmM2MTU5NjdhNTQxMjRhODIzMmI5NTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcQ3GUWgFqTM4MDU4MTUwNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "c039ccf4653f53f30bc615967a54124a8232b953", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/c039ccf4653f53f30bc615967a54124a8232b953", "committedDate": "2020-03-21T22:23:56Z", "message": "Added negative and empty repsonse account integration spec files\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "80e338a00bf61ef10deb5da4e8e65018563d690f", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/80e338a00bf61ef10deb5da4e8e65018563d690f", "committedDate": "2020-03-23T07:30:28Z", "message": "Standardized error repsonses to JSON and added negative and all params specs for balances and transactions\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "554ca708243a9977f82da9bf7873546588fb75cc", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/554ca708243a9977f82da9bf7873546588fb75cc", "committedDate": "2020-03-23T07:36:33Z", "message": "Updated descriptions\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5NzQ5OTky", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/617#pullrequestreview-379749992", "createdAt": "2020-03-23T19:27:01Z", "commit": {"oid": "554ca708243a9977f82da9bf7873546588fb75cc"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QxOToyNzowMlrOF6UwcQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QyMTowODozMlrOF6YLKw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjcwMTgwOQ==", "bodyText": "Would be nice if all status codes could be standardized to use utils.httpStatusCodes", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/617#discussion_r396701809", "createdAt": "2020-03-23T19:27:02Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-rest/transactions.js", "diffHunk": "@@ -307,7 +305,7 @@ const getOneTransaction = function(req, res) {\n \n     if (error) {\n       logger.error('getOneTransaction error: ' + JSON.stringify(error, Object.getOwnPropertyNames(error)));\n-      res.status(404).send('Not found');\n+      res.status(404).send(utils.createSingleErrorJsonResponse('Not found'));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "554ca708243a9977f82da9bf7873546588fb75cc"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjcwNDI3MQ==", "bodyText": "This doesn't encapsulate the building of the error object so if it changes you have to update multiple places. Would be better to consolidate various format/single/multiple error construction to a single method:\nconst createErrorResponse = (messages) => {\n  return {\n    _status: {\n      messages: messages\n    }\n  };\n};", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/617#discussion_r396704271", "createdAt": "2020-03-23T19:31:15Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-rest/utils.js", "diffHunk": "@@ -141,20 +141,33 @@ const validateReq = function(req) {\n     }\n   }\n \n+  let errorMessages = errorMessageFormat();\n+  errorMessages._status.messages = badParams;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "554ca708243a9977f82da9bf7873546588fb75cc"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjcwODA4MA==", "bodyText": "What happens if you repeat a valid parameter twice? Last one in? Might be good to add such a test.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/617#discussion_r396708080", "createdAt": "2020-03-23T19:38:08Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-rest/__tests__/specs/accounts-08-invalid-param-values.spec.json", "diffHunk": "@@ -0,0 +1,32 @@\n+{\n+  \"description\": \"Account api invalid parameters\",\n+  \"setup\": {\n+    \"accounts\": [],\n+    \"balances\": [],\n+    \"transactions\": [],\n+    \"cryptotransfers\": []\n+  },\n+  \"url\": \"/api/v1/accounts?account.id=lte:0.1&account.balance=gt:-2&account.publickey=-2&timestamp=-1.2&order=any\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "554ca708243a9977f82da9bf7873546588fb75cc"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjcwOTczMA==", "bodyText": "500 is internal server error. This should probably just be 404 not found", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/617#discussion_r396709730", "createdAt": "2020-03-23T19:40:33Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-rest/__tests__/specs/accounts-11-invalid-entity-id.spec.json", "diffHunk": "@@ -0,0 +1,53 @@\n+{\n+  \"description\": \"Account api calls for invalid account id using path url\",\n+  \"setup\": {\n+    \"accounts\": [\n+      {\n+        \"entity_num\": 3\n+      },\n+      {\n+        \"entity_num\": 7\n+      },\n+      {\n+        \"entity_num\": 8\n+      },\n+      {\n+        \"entity_num\": 98\n+      }\n+    ],\n+    \"balances\": [\n+      {\n+        \"timestamp\": 2345,\n+        \"id\": 7,\n+        \"balance\": 70\n+      },\n+      {\n+        \"timestamp\": 2345,\n+        \"id\": 8,\n+        \"balance\": 80\n+      }\n+    ],\n+    \"transactions\": [],\n+    \"cryptotransfers\": [\n+      {\n+        \"consensus_timestamp\": \"1234567890000000001\",\n+        \"payerAccountId\": \"0.0.7\",\n+        \"recipientAccountId\": \"0.0.8\",\n+        \"amount\": 25,\n+        \"nodeAccountId\": \"0.0.3\",\n+        \"treasuryAccountId\": \"0.0.98\"\n+      }\n+    ]\n+  },\n+  \"url\": \"/api/v1/accounts/0.0.5\",\n+  \"responseStatus\": 500,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "554ca708243a9977f82da9bf7873546588fb75cc"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjcxMDIwOA==", "bodyText": "nit: \"...all params\" like filename", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/617#discussion_r396710208", "createdAt": "2020-03-23T19:41:09Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-rest/__tests__/specs/balances-06-all-params.spec.json", "diffHunk": "@@ -0,0 +1,124 @@\n+{\n+  \"description\": \"Balances api call using all queries\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "554ca708243a9977f82da9bf7873546588fb75cc"}, "originalPosition": 2}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjcxMjM5MA==", "bodyText": "Should have another test that has limit and next populated", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/617#discussion_r396712390", "createdAt": "2020-03-23T19:43:44Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-rest/__tests__/specs/balances-06-all-params.spec.json", "diffHunk": "@@ -0,0 +1,124 @@\n+{\n+  \"description\": \"Balances api call using all queries\",\n+  \"setup\": {\n+    \"accounts\": [\n+      {\n+        \"entity_num\": 17,\n+        \"entity_realm\": 1,\n+        \"entity_shard\": 0,\n+        \"public_key\": \"6ceecd8bb224da4914d53f292e5624f6f4cf8c134c920e1cac8d06f879df5819\",\n+        \"exp_time_ns\": 123456781,\n+        \"auto_renew_period\": 11111,\n+        \"key\": [1, 1, 1]\n+      },\n+      {\n+        \"entity_num\": 18,\n+        \"entity_realm\": 1,\n+        \"entity_shard\": 0,\n+        \"public_key\": \"519a008fabde4d28d68293c71fcdcdcca38d8fae6102a832b31e802f257fd1d9\",\n+        \"exp_time_ns\": 123456782,\n+        \"auto_renew_period\": 22222,\n+        \"key\": [2, 2, 2]\n+      },\n+      {\n+        \"entity_num\": 19,\n+        \"entity_realm\": 1,\n+        \"entity_shard\": 0,\n+        \"public_key\": \"3c3d546321ff6f63d701d2ec5c277095874e19f4a235bee1e6bb19258bf362be\",\n+        \"exp_time_ns\": 123456783,\n+        \"auto_renew_period\": 33333,\n+        \"key\": [3, 3, 3]\n+      },\n+      {\n+        \"entity_num\": 20,\n+        \"entity_realm\": 1,\n+        \"entity_shard\": 0,\n+        \"public_key\": \"c7e81a0c1444c6e5b5c1bfb1a02ae5faae44c11e621f286d21242cc584280692\",\n+        \"exp_time_ns\": 123456784,\n+        \"auto_renew_period\": 44444,\n+        \"key\": [4, 4, 4]\n+      },\n+      {\n+        \"entity_num\": 21,\n+        \"entity_realm\": 1,\n+        \"entity_shard\": 0,\n+        \"public_key\": \"5f58f33c65992676de86ac8f5b4b8b4b45c636f12cec8a274d820a3fe1778a3e\",\n+        \"exp_time_ns\": 123456785,\n+        \"auto_renew_period\": 55555,\n+        \"key\": [5, 5, 5]\n+      }\n+    ],\n+    \"balances\": [\n+      {\n+        \"timestamp\": 1566560001000000000,\n+        \"id\": 17,\n+        \"realm_num\": 1,\n+        \"balance\": 70\n+      },\n+      {\n+        \"timestamp\": 1566560001000000000,\n+        \"id\": 18,\n+        \"realm_num\": 1,\n+        \"balance\": 80\n+      },\n+      {\n+        \"timestamp\": 1566560001000000000,\n+        \"id\": 19,\n+        \"realm_num\": 1,\n+        \"balance\": 90\n+      },\n+      {\n+        \"timestamp\": 1566560001000000000,\n+        \"id\": 20,\n+        \"realm_num\": 1,\n+        \"balance\": 100\n+      },\n+      {\n+        \"timestamp\": 1566560001000000000,\n+        \"id\": 21,\n+        \"realm_num\": 1,\n+        \"balance\": 110\n+      },\n+      {\n+        \"timestamp\": 1566560003000000000,\n+        \"id\": 18,\n+        \"realm_num\": 1,\n+        \"balance\": 800\n+      },\n+      {\n+        \"timestamp\": 1566560003000000000,\n+        \"id\": 19,\n+        \"realm_num\": 1,\n+        \"balance\": 900\n+      },\n+      {\n+        \"timestamp\": 1566560003000000000,\n+        \"id\": 20,\n+        \"realm_num\": 1,\n+        \"balance\": 1000\n+      },\n+      {\n+        \"timestamp\": 1566560009000000000,\n+        \"id\": 19,\n+        \"realm_num\": 1,\n+        \"balance\": 999\n+      }\n+    ],\n+    \"transactions\": [],\n+    \"cryptotransfers\": []\n+  },\n+  \"url\": \"/api/v1/balances?account.id=gte:0.1.18&account.id=lt:0.1.20&account.balance=gt:45&account.publickey=3c3d546321ff6f63d701d2ec5c277095874e19f4a235bee1e6bb19258bf362be&timestamp=1566560003.000000000&order=asc\",\n+  \"responseStatus\": 200,\n+  \"responseJson\": {\n+    \"timestamp\": \"1566560003.000000000\",\n+    \"balances\": [\n+      {\n+        \"account\": \"0.1.19\",\n+        \"balance\": 900\n+      }\n+    ],\n+    \"links\": {\n+      \"next\": null", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "554ca708243a9977f82da9bf7873546588fb75cc"}, "originalPosition": 121}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc1NzgwMw==", "bodyText": "Should be a 400 since input is bad", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/617#discussion_r396757803", "createdAt": "2020-03-23T21:08:32Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-rest/__tests__/specs/transactions-12-invalid-transaction-id.spec.json", "diffHunk": "@@ -0,0 +1,42 @@\n+{\n+  \"description\": \"Transaction api calls with invalid transaction id value\",\n+  \"setup\": {\n+    \"accounts\": [\n+      {\n+        \"entity_num\": 3\n+      },\n+      {\n+        \"entity_num\": 9\n+      },\n+      {\n+        \"entity_num\": 10\n+      },\n+      {\n+        \"entity_num\": 98\n+      }\n+    ],\n+    \"balances\": [],\n+    \"transactions\": [],\n+    \"cryptotransfers\": [\n+      {\n+        \"consensus_timestamp\": \"1234567890000000001\",\n+        \"payerAccountId\": \"0.0.10\",\n+        \"recipientAccountId\": \"0.0.9\",\n+        \"amount\": 10,\n+        \"nodeAccountId\": \"0.0.3\",\n+        \"treasuryAccountId\": \"0.0.98\"\n+      }\n+    ]\n+  },\n+  \"url\": \"/api/v1/transactions/0.1.10-9999999999.000000000\",\n+  \"responseStatus\": 404,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "554ca708243a9977f82da9bf7873546588fb75cc"}, "originalPosition": 32}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "53dcdebd6b43bbdd748d9c3c6284db367f9fb894", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/53dcdebd6b43bbdd748d9c3c6284db367f9fb894", "committedDate": "2020-03-23T23:04:07Z", "message": "Merged w master 3/23/20\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a1a7821d8877a0b255e1dce3f980f130a62a556d", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/a1a7821d8877a0b255e1dce3f980f130a62a556d", "committedDate": "2020-03-24T00:34:48Z", "message": "Addressed feedback, added more requested tests\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwMzczNTgx", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/617#pullrequestreview-380373581", "createdAt": "2020-03-24T14:38:04Z", "commit": {"oid": "a1a7821d8877a0b255e1dce3f980f130a62a556d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxNDozODowNVrOF6zUtA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNFQxNDozODowNVrOF6zUtA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzIwMjYxMg==", "bodyText": "You should add a test for account/0.0.5 not found returning 404. The code currently returns 500 inappropriately.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/617#discussion_r397202612", "createdAt": "2020-03-24T14:38:05Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-rest/__tests__/specs/accounts-11-invalid-entity-id.spec.json", "diffHunk": "@@ -39,13 +39,13 @@\n       }\n     ]\n   },\n-  \"url\": \"/api/v1/accounts/0.0.5\",\n-  \"responseStatus\": 500,\n+  \"url\": \"/api/v1/accounts/0.5\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a1a7821d8877a0b255e1dce3f980f130a62a556d"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "55ccc6c399f40439483476fe9ffeebe0fcab34b7", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/55ccc6c399f40439483476fe9ffeebe0fcab34b7", "committedDate": "2020-03-24T18:00:17Z", "message": "Updated repeated param specs\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f3f5b4e0c60d7f3c77ec4bb163beb6d0d2259470", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/f3f5b4e0c60d7f3c77ec4bb163beb6d0d2259470", "committedDate": "2020-03-24T18:19:06Z", "message": " Renamed transactions-14-repeated-invalid-valid-param.spec.json\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwNTgxNTA1", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/617#pullrequestreview-380581505", "createdAt": "2020-03-24T18:20:33Z", "commit": {"oid": "f3f5b4e0c60d7f3c77ec4bb163beb6d0d2259470"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3353, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}