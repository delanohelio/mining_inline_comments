{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk0MzI4NTk3", "number": 1086, "title": "HTS: Minor updates to design and schema", "bodyText": "Detailed description:\nMinor updates to HTS design doc and db schema\n\nUpdates doc with references for associated, token name, token mint and burn transaction handlers\nUpdates cleanup.sql to clear token tables after tests\nAdds ed25519 public keys for token table\nUpdates protobuf to v.0.9.0-alpha5\n\nWhich issue(s) this PR fixes:\nFixes #\nSpecial notes for your reviewer:\nChecklist\n\n Documentation added\n Tests updated", "createdAt": "2020-09-28T18:35:08Z", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1086", "merged": true, "mergeCommit": {"oid": "29b563a33ec9250a026cafaaef1501e6a81324bb"}, "closed": true, "closedAt": "2020-09-29T21:50:36Z", "author": {"login": "Nana-EC"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdNX767gH2gAyNDk0MzI4NTk3OjI4YjM2MDU2NTQ3YzM1OWQxYWJiN2I5YjJiZmQ5MmMzZmJlMGM0YWM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdNvVBYgFqTQ5ODkxNzM3MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "28b36056547c359d1abb7b9b2bfd92c3fbe0c4ac", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/28b36056547c359d1abb7b9b2bfd92c3fbe0c4ac", "committedDate": "2020-09-28T18:31:31Z", "message": "Minor updates to HTS Design and DBSchema\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3e41286b0bdbf1c08c0086b36584afad180d778e", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/3e41286b0bdbf1c08c0086b36584afad180d778e", "committedDate": "2020-09-28T19:39:21Z", "message": "Updated protobuf to v.0.9.0-alpha5\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3ODg5NDg0", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1086#pullrequestreview-497889484", "createdAt": "2020-09-28T20:56:18Z", "commit": {"oid": "3e41286b0bdbf1c08c0086b36584afad180d778e"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQyMDo1NjoxOFrOHZPTsQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQyMDo1NjoxOFrOHZPTsQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjIyNzI0OQ==", "bodyText": "should we suffix the new ed25519 public key columns with _hex like in t_entities table? That way, it's clear the key is hex encoded", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1086#discussion_r496227249", "createdAt": "2020-09-28T20:56:18Z", "author": {"login": "xin-hedera"}, "path": "hedera-mirror-importer/src/main/resources/db/migration/V1.30.1__hts_support.sql", "diffHunk": "@@ -61,14 +61,19 @@ create table if not exists token\n     token_id            entity_id               primary key,\n     created_timestamp   bigint                  not null,\n     divisibility        bigint                  not null,\n+    ed25519_freeze_key  varchar                 null,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3e41286b0bdbf1c08c0086b36584afad180d778e"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3OTIxNjg3", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1086#pullrequestreview-497921687", "createdAt": "2020-09-28T21:43:02Z", "commit": {"oid": "3e41286b0bdbf1c08c0086b36584afad180d778e"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b9b3c6dbb8220c0ccaede1d54f3d52aedf6d28e5", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/b9b3c6dbb8220c0ccaede1d54f3d52aedf6d28e5", "committedDate": "2020-09-28T22:13:53Z", "message": "Added _hex to keys for clarity\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3OTQ2MzA4", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1086#pullrequestreview-497946308", "createdAt": "2020-09-28T22:37:29Z", "commit": {"oid": "b9b3c6dbb8220c0ccaede1d54f3d52aedf6d28e5"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3OTUwMTA1", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1086#pullrequestreview-497950105", "createdAt": "2020-09-28T22:47:21Z", "commit": {"oid": "b9b3c6dbb8220c0ccaede1d54f3d52aedf6d28e5"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQyMjo0NzoyMVrOHZSWsg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQyMzozOTowMFrOHZTWXg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjI3NzE3MA==", "bodyText": "I would prefer the encodings (hex and ed25519) at the end and moved so they are sorted next to the corresponding field. Example:\nfreeze_key\nfreeze_key_ed25519_hex", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1086#discussion_r496277170", "createdAt": "2020-09-28T22:47:21Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-importer/src/main/resources/db/migration/V1.30.1__hts_support.sql", "diffHunk": "@@ -58,26 +58,32 @@ insert into t_transaction_results (proto_id, result) values\n -- Add token table to hold token properties\n create table if not exists token\n (\n-    token_id            entity_id               primary key,\n-    created_timestamp   bigint                  not null,\n-    divisibility        bigint                  not null,\n-    freeze_default      boolean                 not null default false,\n-    freeze_key          bytea,\n-    initial_supply      bigint                  not null,\n-    kyc_default         boolean                 not null default false,\n-    kyc_key             bytea,\n-    modified_timestamp  bigint                  not null,\n-    supply_key          bytea,\n-    symbol              character varying(100)  not null,\n-    treasury_account_id entity_id               not null,\n-    wipe_key            bytea\n+    token_id                entity_id               primary key,\n+    created_timestamp       bigint                  not null,\n+    divisibility            bigint                  not null,\n+    ed25519_freeze_key_hex  varchar                 null,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b9b3c6dbb8220c0ccaede1d54f3d52aedf6d28e5"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjI4MjcwMw==", "bodyText": "Please sync the ResponseCode.proto. You're missing the recent changes in alpha5.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1086#discussion_r496282703", "createdAt": "2020-09-28T23:04:25Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-importer/src/main/resources/db/migration/V1.30.1__hts_support.sql", "diffHunk": "@@ -58,26 +58,32 @@ insert into t_transaction_results (proto_id, result) values\n -- Add token table to hold token properties\n create table if not exists token", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b9b3c6dbb8220c0ccaede1d54f3d52aedf6d28e5"}, "originalPosition": 2}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjI4OTI2MQ==", "bodyText": "This field is no longer and looks to have been replaced by decimals. Please do a thorough review of alpha5", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1086#discussion_r496289261", "createdAt": "2020-09-28T23:25:45Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-importer/src/main/resources/db/migration/V1.30.1__hts_support.sql", "diffHunk": "@@ -58,26 +58,32 @@ insert into t_transaction_results (proto_id, result) values\n -- Add token table to hold token properties\n create table if not exists token\n (\n-    token_id            entity_id               primary key,\n-    created_timestamp   bigint                  not null,\n-    divisibility        bigint                  not null,\n-    freeze_default      boolean                 not null default false,\n-    freeze_key          bytea,\n-    initial_supply      bigint                  not null,\n-    kyc_default         boolean                 not null default false,\n-    kyc_key             bytea,\n-    modified_timestamp  bigint                  not null,\n-    supply_key          bytea,\n-    symbol              character varying(100)  not null,\n-    treasury_account_id entity_id               not null,\n-    wipe_key            bytea\n+    token_id                entity_id               primary key,\n+    created_timestamp       bigint                  not null,\n+    divisibility            bigint                  not null,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b9b3c6dbb8220c0ccaede1d54f3d52aedf6d28e5"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjI5MDI4Ng==", "bodyText": "How will this field get populated? It doesn't seem to be on any transaction. I only see it on GetTokenInfo.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1086#discussion_r496290286", "createdAt": "2020-09-28T23:29:00Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-importer/src/main/resources/db/migration/V1.30.1__hts_support.sql", "diffHunk": "@@ -58,26 +58,32 @@ insert into t_transaction_results (proto_id, result) values\n -- Add token table to hold token properties\n create table if not exists token\n (\n-    token_id            entity_id               primary key,\n-    created_timestamp   bigint                  not null,\n-    divisibility        bigint                  not null,\n-    freeze_default      boolean                 not null default false,\n-    freeze_key          bytea,\n-    initial_supply      bigint                  not null,\n-    kyc_default         boolean                 not null default false,\n-    kyc_key             bytea,\n-    modified_timestamp  bigint                  not null,\n-    supply_key          bytea,\n-    symbol              character varying(100)  not null,\n-    treasury_account_id entity_id               not null,\n-    wipe_key            bytea\n+    token_id                entity_id               primary key,\n+    created_timestamp       bigint                  not null,\n+    divisibility            bigint                  not null,\n+    ed25519_freeze_key_hex  varchar                 null,\n+    ed25519_kyc_key_hex     varchar                 null,\n+    ed25519_supply_key_hex  varchar                 null,\n+    ed25519_wipe_key_hex    varchar                 null,\n+    freeze_default          boolean                 not null default false,\n+    freeze_key              bytea,\n+    initial_supply          bigint                  not null,\n+    kyc_key                 bytea,\n+    modified_timestamp      bigint                  not null,\n+    name                    character varying(100)  not null,\n+    supply_key              bytea,\n+    symbol                  character varying(32)   not null,\n+    total_supply            bigint                  not null default 0,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b9b3c6dbb8220c0ccaede1d54f3d52aedf6d28e5"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjI5MTIwMw==", "bodyText": "We should switch kyc to enum TokenKycStatus and freeze to TokenFreezeStatus enum", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1086#discussion_r496291203", "createdAt": "2020-09-28T23:31:56Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-importer/src/main/resources/db/migration/V1.30.1__hts_support.sql", "diffHunk": "@@ -58,26 +58,32 @@ insert into t_transaction_results (proto_id, result) values\n -- Add token table to hold token properties\n create table if not exists token\n (\n-    token_id            entity_id               primary key,\n-    created_timestamp   bigint                  not null,\n-    divisibility        bigint                  not null,\n-    freeze_default      boolean                 not null default false,\n-    freeze_key          bytea,\n-    initial_supply      bigint                  not null,\n-    kyc_default         boolean                 not null default false,\n-    kyc_key             bytea,\n-    modified_timestamp  bigint                  not null,\n-    supply_key          bytea,\n-    symbol              character varying(100)  not null,\n-    treasury_account_id entity_id               not null,\n-    wipe_key            bytea\n+    token_id                entity_id               primary key,\n+    created_timestamp       bigint                  not null,\n+    divisibility            bigint                  not null,\n+    ed25519_freeze_key_hex  varchar                 null,\n+    ed25519_kyc_key_hex     varchar                 null,\n+    ed25519_supply_key_hex  varchar                 null,\n+    ed25519_wipe_key_hex    varchar                 null,\n+    freeze_default          boolean                 not null default false,\n+    freeze_key              bytea,\n+    initial_supply          bigint                  not null,\n+    kyc_key                 bytea,\n+    modified_timestamp      bigint                  not null,\n+    name                    character varying(100)  not null,\n+    supply_key              bytea,\n+    symbol                  character varying(32)   not null,\n+    total_supply            bigint                  not null default 0,\n+    treasury_account_id     entity_id               not null,\n+    wipe_key                bytea\n );\n \n --- Add token_account table to capture token-account info such as frozen, kyc and wipe status\n create table if not exists token_account\n (\n     id                  serial              primary key,\n     account_id          entity_id           not null,\n+    associated          boolean             not null default false,\n     created_timestamp   bigint              not null,\n     frozen              boolean             not null default false,\n     kyc                 boolean             not null default false,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b9b3c6dbb8220c0ccaede1d54f3d52aedf6d28e5"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjI5MzQ3MA==", "bodyText": "I don't see a wipe boolean anymore. How does this get populated?", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1086#discussion_r496293470", "createdAt": "2020-09-28T23:39:00Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-importer/src/main/resources/db/migration/V1.30.1__hts_support.sql", "diffHunk": "@@ -58,26 +58,32 @@ insert into t_transaction_results (proto_id, result) values\n -- Add token table to hold token properties\n create table if not exists token\n (\n-    token_id            entity_id               primary key,\n-    created_timestamp   bigint                  not null,\n-    divisibility        bigint                  not null,\n-    freeze_default      boolean                 not null default false,\n-    freeze_key          bytea,\n-    initial_supply      bigint                  not null,\n-    kyc_default         boolean                 not null default false,\n-    kyc_key             bytea,\n-    modified_timestamp  bigint                  not null,\n-    supply_key          bytea,\n-    symbol              character varying(100)  not null,\n-    treasury_account_id entity_id               not null,\n-    wipe_key            bytea\n+    token_id                entity_id               primary key,\n+    created_timestamp       bigint                  not null,\n+    divisibility            bigint                  not null,\n+    ed25519_freeze_key_hex  varchar                 null,\n+    ed25519_kyc_key_hex     varchar                 null,\n+    ed25519_supply_key_hex  varchar                 null,\n+    ed25519_wipe_key_hex    varchar                 null,\n+    freeze_default          boolean                 not null default false,\n+    freeze_key              bytea,\n+    initial_supply          bigint                  not null,\n+    kyc_key                 bytea,\n+    modified_timestamp      bigint                  not null,\n+    name                    character varying(100)  not null,\n+    supply_key              bytea,\n+    symbol                  character varying(32)   not null,\n+    total_supply            bigint                  not null default 0,\n+    treasury_account_id     entity_id               not null,\n+    wipe_key                bytea\n );\n \n --- Add token_account table to capture token-account info such as frozen, kyc and wipe status\n create table if not exists token_account", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b9b3c6dbb8220c0ccaede1d54f3d52aedf6d28e5"}, "originalPosition": 38}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "71b818af1fefd01b68fbf4ada912cbbeaf4d85dd", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/71b818af1fefd01b68fbf4ada912cbbeaf4d85dd", "committedDate": "2020-09-29T14:17:53Z", "message": "Updated doc, transaction types and migration based on updates from alpha5\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4NTgzNzIw", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1086#pullrequestreview-498583720", "createdAt": "2020-09-29T15:06:46Z", "commit": {"oid": "71b818af1fefd01b68fbf4ada912cbbeaf4d85dd"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNTowNjo0NlrOHZx-jw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxNToyNToyNlrOHZy9Lw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njc5NTI3OQ==", "bodyText": "Just freeze_status and kyc_status like in TokenRelationship. All these fields are already related to the token so no need to prefix it as it's assumed.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1086#discussion_r496795279", "createdAt": "2020-09-29T15:06:46Z", "author": {"login": "steven-sheehy"}, "path": "docs/design/hts.md", "diffHunk": "@@ -71,14 +71,13 @@ To support the goals the following database schema changes should be made\n     -   `account_id`\n     -   `associated`\n     -   `created_timestamp`\n-    -   `frozen`\n-    -   `kyc`\n     -   `modified_timestamp`\n+    -   `token_freeze_status` (FreezeNotApplicable = 0, Frozen = 1, Unfrozen = 2)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "71b818af1fefd01b68fbf4ada912cbbeaf4d85dd"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjgxMTMxMQ==", "bodyText": "I've asked Michael to adjust the field name to match the transaction body name. So this will soon be TOKENCREATE and TOKENDELETE. Some others are changing too.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1086#discussion_r496811311", "createdAt": "2020-09-29T15:25:26Z", "author": {"login": "steven-sheehy"}, "path": "docs/design/hts.md", "diffHunk": "@@ -91,13 +90,13 @@ To support the goals the following database schema changes should be made\n ```sql\n     insert into t_transaction_types (proto_id, name) values\n          (28, 'UNCHECKEDSUBMIT'),\n-         (29, 'TOKENCREATE'),\n-         (30, 'TOKENTRANSFER'),\n+         (29, 'TOKENCREATION'),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "71b818af1fefd01b68fbf4ada912cbbeaf4d85dd"}, "originalPosition": 24}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4f68e2ac1ab7ac2cba7c9a45d3cc65da6b4b2acd", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/4f68e2ac1ab7ac2cba7c9a45d3cc65da6b4b2acd", "committedDate": "2020-09-29T20:43:02Z", "message": "Updated doc and schema for token status and remove wipe column\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4OTE3Mzcw", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1086#pullrequestreview-498917370", "createdAt": "2020-09-29T21:46:45Z", "commit": {"oid": "4f68e2ac1ab7ac2cba7c9a45d3cc65da6b4b2acd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3560, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}