{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ5Nzc2OTU2", "number": 869, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQyMjo0NToxOVrOEO5YbA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QwMDo1OTo0M1rOEPW4zw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0MDU1NjYwOnYy", "diffSide": "RIGHT", "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/record/entity/sql/SqlEntityListener.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQyMjo0NToxOVrOGyT3oQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QwMDowNjoyOFrOGzA5AA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTQwNzUyMQ==", "bodyText": "nit: just do , topic notifications: {} as a standalone like the rest so it reads easier", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/869#discussion_r455407521", "createdAt": "2020-07-15T22:45:19Z", "author": {"login": "Nana-EC"}, "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/record/entity/sql/SqlEntityListener.java", "diffHunk": "@@ -190,10 +199,11 @@ private void executeBatches() {\n             var contractResult = executeBatch(sqlInsertContractResult);\n             var liveHashes = executeBatch(sqlInsertLiveHashes);\n             var topicMessages = executeBatch(sqlInsertTopicMessage);\n+            var topicMessageNotifications = executeBatch(sqlNotifyTopicMessage);\n             log.info(\"Inserted transactions: {}, entities: {}, transfer lists: {}, files: {}, contracts: {}, \" +\n-                            \"claims: {}, topic messages: {}, non-fee transfers: {}\",\n+                            \"claims: {}, topic messages: {}+({}ms), non-fee transfers: {}\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "de44afc65211482f7551f7771d8fcff8470ae5e0"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjE0NTE1Mg==", "bodyText": "Done", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/869#discussion_r456145152", "createdAt": "2020-07-17T00:06:28Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/record/entity/sql/SqlEntityListener.java", "diffHunk": "@@ -190,10 +199,11 @@ private void executeBatches() {\n             var contractResult = executeBatch(sqlInsertContractResult);\n             var liveHashes = executeBatch(sqlInsertLiveHashes);\n             var topicMessages = executeBatch(sqlInsertTopicMessage);\n+            var topicMessageNotifications = executeBatch(sqlNotifyTopicMessage);\n             log.info(\"Inserted transactions: {}, entities: {}, transfer lists: {}, files: {}, contracts: {}, \" +\n-                            \"claims: {}, topic messages: {}, non-fee transfers: {}\",\n+                            \"claims: {}, topic messages: {}+({}ms), non-fee transfers: {}\",", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTQwNzUyMQ=="}, "originalCommit": {"oid": "de44afc65211482f7551f7771d8fcff8470ae5e0"}, "originalPosition": 53}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0MDU2MjMxOnYy", "diffSide": "RIGHT", "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/record/entity/sql/SqlEntityListener.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQyMjo0Nzo1MFrOGyT69Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQxNToxNjoyOVrOGyv1xg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTQwODM3Mw==", "bodyText": "I believe we current base64 encode the message and running hash. I think that logic is missing from here.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/869#discussion_r455408373", "createdAt": "2020-07-15T22:47:50Z", "author": {"login": "Nana-EC"}, "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/record/entity/sql/SqlEntityListener.java", "diffHunk": "@@ -323,6 +333,18 @@ public void onTopicMessage(TopicMessage topicMessage) throws ImporterException {\n         } catch (SQLException e) {\n             throw new ParserSQLException(e);\n         }\n+\n+        try {\n+            if (properties.isNotifyTopicMessage()) {\n+                String json = OBJECT_MAPPER.writeValueAsString(topicMessage);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ef2546fa7afdc737407d08f2cae02bd5810f144d"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTQxODczMg==", "bodyText": "It's not, jackson automatically encodes bytes to base64 string by default.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/869#discussion_r455418732", "createdAt": "2020-07-15T23:17:56Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/record/entity/sql/SqlEntityListener.java", "diffHunk": "@@ -323,6 +333,18 @@ public void onTopicMessage(TopicMessage topicMessage) throws ImporterException {\n         } catch (SQLException e) {\n             throw new ParserSQLException(e);\n         }\n+\n+        try {\n+            if (properties.isNotifyTopicMessage()) {\n+                String json = OBJECT_MAPPER.writeValueAsString(topicMessage);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTQwODM3Mw=="}, "originalCommit": {"oid": "ef2546fa7afdc737407d08f2cae02bd5810f144d"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTg2NTc5OA==", "bodyText": "Ah good.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/869#discussion_r455865798", "createdAt": "2020-07-16T15:16:29Z", "author": {"login": "Nana-EC"}, "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/record/entity/sql/SqlEntityListener.java", "diffHunk": "@@ -323,6 +333,18 @@ public void onTopicMessage(TopicMessage topicMessage) throws ImporterException {\n         } catch (SQLException e) {\n             throw new ParserSQLException(e);\n         }\n+\n+        try {\n+            if (properties.isNotifyTopicMessage()) {\n+                String json = OBJECT_MAPPER.writeValueAsString(topicMessage);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTQwODM3Mw=="}, "originalCommit": {"oid": "ef2546fa7afdc737407d08f2cae02bd5810f144d"}, "originalPosition": 67}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0MzgwODAwOnYy", "diffSide": "RIGHT", "path": "hedera-mirror-importer/src/test/java/com/hedera/mirror/importer/parser/record/RecordFileParserPerformanceTest.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQxNjoyNDo1N1rOGyywgg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QwMDowNjo1OFrOGzA5nQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTkxMzYwMg==", "bodyText": "20 may be still low. the longest run I saw in CircleCI run is 27.x secs, so in other PRs it's set to 30.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/869#discussion_r455913602", "createdAt": "2020-07-16T16:24:57Z", "author": {"login": "xin-hedera"}, "path": "hedera-mirror-importer/src/test/java/com/hedera/mirror/importer/parser/record/RecordFileParserPerformanceTest.java", "diffHunk": "@@ -69,7 +69,7 @@ void before() {\n         parserProperties.init();\n     }\n \n-    @Timeout(10)\n+    @Timeout(20)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ef2546fa7afdc737407d08f2cae02bd5810f144d"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjAxNTA1Nw==", "bodyText": "Sure, will probably remove as it's covered by yours.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/869#discussion_r456015057", "createdAt": "2020-07-16T19:16:52Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-importer/src/test/java/com/hedera/mirror/importer/parser/record/RecordFileParserPerformanceTest.java", "diffHunk": "@@ -69,7 +69,7 @@ void before() {\n         parserProperties.init();\n     }\n \n-    @Timeout(10)\n+    @Timeout(20)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTkxMzYwMg=="}, "originalCommit": {"oid": "ef2546fa7afdc737407d08f2cae02bd5810f144d"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjAxNTQ0Mw==", "bodyText": "The hope was that the performance improvements in this PR would make it 20, but it doesn't seem to be the case.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/869#discussion_r456015443", "createdAt": "2020-07-16T19:17:35Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-importer/src/test/java/com/hedera/mirror/importer/parser/record/RecordFileParserPerformanceTest.java", "diffHunk": "@@ -69,7 +69,7 @@ void before() {\n         parserProperties.init();\n     }\n \n-    @Timeout(10)\n+    @Timeout(20)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTkxMzYwMg=="}, "originalCommit": {"oid": "ef2546fa7afdc737407d08f2cae02bd5810f144d"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjE0NTMwOQ==", "bodyText": "Removed", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/869#discussion_r456145309", "createdAt": "2020-07-17T00:06:58Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-importer/src/test/java/com/hedera/mirror/importer/parser/record/RecordFileParserPerformanceTest.java", "diffHunk": "@@ -69,7 +69,7 @@ void before() {\n         parserProperties.init();\n     }\n \n-    @Timeout(10)\n+    @Timeout(20)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTkxMzYwMg=="}, "originalCommit": {"oid": "ef2546fa7afdc737407d08f2cae02bd5810f144d"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg0NTM5MDg3OnYy", "diffSide": "RIGHT", "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/record/entity/sql/SqlProperties.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QwMDo1OTo0M1rOGzBygA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xN1QwMTowMjozNFrOGzB1Pw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjE1OTg3Mg==", "bodyText": "nit: we can document this now right. But we can do it in master for v0.16", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/869#discussion_r456159872", "createdAt": "2020-07-17T00:59:43Z", "author": {"login": "Nana-EC"}, "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/record/entity/sql/SqlProperties.java", "diffHunk": "@@ -32,4 +32,7 @@\n      */\n     @Min(1)\n     private int batchSize = 2000;\n+\n+    // Not documenting this for now since it may be temporary pending further refactorings", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ffa551bb21bff2b16cb0014f17ce84521b0154d"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjE2MDU3NQ==", "bodyText": "I don't want to document because it will go away/change when we implement other publishers", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/869#discussion_r456160575", "createdAt": "2020-07-17T01:02:34Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/record/entity/sql/SqlProperties.java", "diffHunk": "@@ -32,4 +32,7 @@\n      */\n     @Min(1)\n     private int batchSize = 2000;\n+\n+    // Not documenting this for now since it may be temporary pending further refactorings", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjE1OTg3Mg=="}, "originalCommit": {"oid": "4ffa551bb21bff2b16cb0014f17ce84521b0154d"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 907, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}