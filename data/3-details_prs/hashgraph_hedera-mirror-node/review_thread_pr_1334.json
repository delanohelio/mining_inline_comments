{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM0NTU0MTk1", "number": 1334, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxNjozODo1MVrOFCdXbg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxNjo0NjoyMlrOFCdrgg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM4MTIyNjA2OnYy", "diffSide": "RIGHT", "path": "hedera-mirror-rest/transactions.js", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxNjozODo1MVrOIBoQdQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxODozOTozOVrOIBwMIQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODU3OTA2MQ==", "bodyText": "q: why use a string replace on an existing query vs calling utils.parseTimestampQueryParam()?", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1334#discussion_r538579061", "createdAt": "2020-12-08T16:38:51Z", "author": {"login": "Nana-EC"}, "path": "hedera-mirror-rest/transactions.js", "diffHunk": "@@ -195,8 +195,9 @@ const getTransactionsInnerQuery = function (\n   transactionTypeQuery,\n   order\n ) {\n-  const whereClause = buildWhereClause(resultTypeQuery, transactionTypeQuery);\n-  const ctlWhereClause = buildWhereClause(accountQuery, tsQuery, creditDebitQuery);\n+  const whereClause = buildWhereClause(tsQuery, resultTypeQuery, transactionTypeQuery);\n+  const ctlTsQuery = tsQuery.replace(/t\\.consensus_ns/g, 'ctl.consensus_timestamp');", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5afa2d3d92e249ec76a508194dd78503cf54513e"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODU5NTgxMw==", "bodyText": "neither approach is good\n\nthe one in the PR, as you pointed out\nadd a ctlTsQuery param to the signature of getTransactionsInnerQuery, make it explicit. however, ctlTsQuery and tsQuery are supposed to be the same other than the column names. It's error prone because getTransactionsInnerQuery can be called with different expressions in tsQuery and ctlTsQuery", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1334#discussion_r538595813", "createdAt": "2020-12-08T16:53:38Z", "author": {"login": "xin-hedera"}, "path": "hedera-mirror-rest/transactions.js", "diffHunk": "@@ -195,8 +195,9 @@ const getTransactionsInnerQuery = function (\n   transactionTypeQuery,\n   order\n ) {\n-  const whereClause = buildWhereClause(resultTypeQuery, transactionTypeQuery);\n-  const ctlWhereClause = buildWhereClause(accountQuery, tsQuery, creditDebitQuery);\n+  const whereClause = buildWhereClause(tsQuery, resultTypeQuery, transactionTypeQuery);\n+  const ctlTsQuery = tsQuery.replace(/t\\.consensus_ns/g, 'ctl.consensus_timestamp');", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODU3OTA2MQ=="}, "originalCommit": {"oid": "5afa2d3d92e249ec76a508194dd78503cf54513e"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODcwOTAyNQ==", "bodyText": "I see. I guess we should look into improving this in master code then", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1334#discussion_r538709025", "createdAt": "2020-12-08T18:39:39Z", "author": {"login": "Nana-EC"}, "path": "hedera-mirror-rest/transactions.js", "diffHunk": "@@ -195,8 +195,9 @@ const getTransactionsInnerQuery = function (\n   transactionTypeQuery,\n   order\n ) {\n-  const whereClause = buildWhereClause(resultTypeQuery, transactionTypeQuery);\n-  const ctlWhereClause = buildWhereClause(accountQuery, tsQuery, creditDebitQuery);\n+  const whereClause = buildWhereClause(tsQuery, resultTypeQuery, transactionTypeQuery);\n+  const ctlTsQuery = tsQuery.replace(/t\\.consensus_ns/g, 'ctl.consensus_timestamp');", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODU3OTA2MQ=="}, "originalCommit": {"oid": "5afa2d3d92e249ec76a508194dd78503cf54513e"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM4MTI3NzQ2OnYy", "diffSide": "RIGHT", "path": "hedera-mirror-rest/transactions.js", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxNjo0NjoyMlrOIBoxVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQxNjo0NjoyMlrOIBoxVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODU4NzQ3Ng==", "bodyText": "nit: doesn't have to be in this PR but should we have a utils method that takes in an array of params and combines them using the above concat logic.\nThat way this line and the line 218 in accounts and other places could just call that and code doesn't grow longer for each new set of params.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1334#discussion_r538587476", "createdAt": "2020-12-08T16:46:22Z", "author": {"login": "Nana-EC"}, "path": "hedera-mirror-rest/transactions.js", "diffHunk": "@@ -218,11 +219,11 @@ const reqToSql = function (req) {\n   const parsedQueryParams = req.query;\n   const [creditDebitQuery] = utils.parseCreditDebitParams(parsedQueryParams, 'ctl.amount');\n   const [accountQuery, accountParams] = utils.parseAccountIdQueryParam(parsedQueryParams, 'ctl.entity_id');\n-  const [tsQuery, tsParams] = utils.parseTimestampQueryParam(parsedQueryParams, 'ctl.consensus_timestamp');\n+  const [tsQuery, tsParams] = utils.parseTimestampQueryParam(parsedQueryParams, 't.consensus_ns');\n   const resultTypeQuery = utils.parseResultParams(req, 't.result');\n   const transactionTypeQuery = utils.getTransactionTypeQuery(parsedQueryParams);\n   const {query, params, order, limit} = utils.parseLimitAndOrderParams(req);\n-  const sqlParams = accountParams.concat(tsParams).concat(params);\n+  const sqlParams = accountParams.concat(tsParams).concat(tsParams).concat(params);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5afa2d3d92e249ec76a508194dd78503cf54513e"}, "originalPosition": 31}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1309, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}