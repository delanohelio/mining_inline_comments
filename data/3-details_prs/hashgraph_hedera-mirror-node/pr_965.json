{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY4ODU0MzMw", "number": 965, "title": "Fix the issue gRPC notify thread blocked", "bodyText": "Detailed description:\nAdd backpressure buffer with ERROR strategy to notifying and shared polling topic listeners. When overflow happens, the controller will send a gRPC error after all buffered messages and disconnect the client.\nWhich issue(s) this PR fixes:\nFixes #945\nSpecial notes for your reviewer:\nChecklist\n\n Documentation added\n Tests updated", "createdAt": "2020-08-17T14:05:18Z", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/965", "merged": true, "mergeCommit": {"oid": "e3016470c11ca77dbbf2889bfee29273720986d9"}, "closed": true, "closedAt": "2020-08-19T14:58:52Z", "author": {"login": "xin-hedera"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc_NdZPgH2gAyNDY4ODU0MzMwOjY0MDJhYzJkOGQzOTcxOGNkMjczZjlkYzQ3ZjM3ODUzYzdlYzg4YzE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdAc3s0gFqTQ3MDU0MjQ2MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6402ac2d8d39718cd273f9dc47f37853c7ec88c1", "author": {"user": {"login": "xin-hedera", "name": "Xin Li"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/6402ac2d8d39718cd273f9dc47f37853c7ec88c1", "committedDate": "2020-08-15T18:24:11Z", "message": "add backPressure buffer to flux created by NotifyingTopicListener with configurable max buffer size\n\nSigned-off-by: Xin Li <xin.li@swirlds.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ff532ff2f8cf0a713fbfd49a9c1cbab2f4122b9e", "author": {"user": {"login": "xin-hedera", "name": "Xin Li"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/ff532ff2f8cf0a713fbfd49a9c1cbab2f4122b9e", "committedDate": "2020-08-17T14:00:13Z", "message": "add backpressure buffer with error strategy to shared polling topic listener, update test cases\n\nSigned-off-by: Xin Li <xin.li@swirlds.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "691c549541b1b9cf757e55148bb6e54397ffc065", "author": {"user": {"login": "xin-hedera", "name": "Xin Li"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/691c549541b1b9cf757e55148bb6e54397ffc065", "committedDate": "2020-08-17T19:54:41Z", "message": "update integration test to also verify normal subscribers are not affected by the slow subscriber\n\nSigned-off-by: Xin Li <xin.li@swirlds.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY4NzkwNjQ2", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/965#pullrequestreview-468790646", "createdAt": "2020-08-17T19:56:55Z", "commit": {"oid": "691c549541b1b9cf757e55148bb6e54397ffc065"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxOTo1Njo1NVrOHB4z4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxOTo1Njo1NVrOHB4z4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTc0MTQxMA==", "bodyText": "10s gives me issue in my env with shared polling topic listener slowSubscriberOverflowException test case, so aggressively make it further in the future", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/965#discussion_r471741410", "createdAt": "2020-08-17T19:56:55Z", "author": {"login": "xin-hedera"}, "path": "hedera-mirror-grpc/src/test/java/com/hedera/mirror/grpc/listener/AbstractTopicListenerTest.java", "diffHunk": "@@ -39,7 +39,7 @@\n \n public abstract class AbstractTopicListenerTest extends GrpcIntegrationTest {\n \n-    protected final Instant future = Instant.now().plusSeconds(10L);\n+    protected final Instant future = Instant.now().plusSeconds(30L);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "691c549541b1b9cf757e55148bb6e54397ffc065"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e06624d81b8ed238d2e2c73e8c38af7a8f1d0b52", "author": {"user": {"login": "xin-hedera", "name": "Xin Li"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/e06624d81b8ed238d2e2c73e8c38af7a8f1d0b52", "committedDate": "2020-08-18T00:15:10Z", "message": "chore, replace number with variable\n\nSigned-off-by: Xin Li <xin.li@swirlds.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY5NjUyMDI0", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/965#pullrequestreview-469652024", "createdAt": "2020-08-18T17:01:59Z", "commit": {"oid": "e06624d81b8ed238d2e2c73e8c38af7a8f1d0b52"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY5NjU4MzI3", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/965#pullrequestreview-469658327", "createdAt": "2020-08-18T17:08:55Z", "commit": {"oid": "e06624d81b8ed238d2e2c73e8c38af7a8f1d0b52"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQxNzowODo1NlrOHCeBtA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQxNzoyNToyNlrOHCeptg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjM1MTE1Ng==", "bodyText": "I was thinking RESOURCE_EXHAUSTED applied more towards server side resources. What do you think about using DEADLINE_EXCEEDED?", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/965#discussion_r472351156", "createdAt": "2020-08-18T17:08:56Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-grpc/src/main/java/com/hedera/mirror/grpc/controller/ConsensusController.java", "diffHunk": "@@ -70,6 +72,7 @@\n                 .onErrorMap(TimeoutException.class, e -> error(e, Status.RESOURCE_EXHAUSTED))\n                 .onErrorMap(TopicNotFoundException.class, e -> error(e, Status.NOT_FOUND))\n                 .onErrorMap(TransientDataAccessException.class, e -> error(e, Status.RESOURCE_EXHAUSTED))\n+                .onErrorMap(Exceptions::isOverflow, e -> error(e, Status.RESOURCE_EXHAUSTED, OVERFLOW_ERROR))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e06624d81b8ed238d2e2c73e8c38af7a8f1d0b52"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjM2MTM5OA==", "bodyText": "Why was this changed? 0 is default for number primitives so it's better to test a non-zero value like 1001", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/965#discussion_r472361398", "createdAt": "2020-08-18T17:25:26Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-grpc/src/test/java/com/hedera/mirror/grpc/listener/NotifyingTopicListenerTest.java", "diffHunk": "@@ -87,7 +87,7 @@ void json() {\n                 .runningHash(new byte[] {4, 5, 6})\n                 .runningHashVersion(2)\n                 .sequenceNumber(1L)\n-                .topicNum(1001)\n+                .topicNum(0)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e06624d81b8ed238d2e2c73e8c38af7a8f1d0b52"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "965178a91c80ec4cb7539b8845cae0dd7f446875", "author": {"user": {"login": "xin-hedera", "name": "Xin Li"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/965178a91c80ec4cb7539b8845cae0dd7f446875", "committedDate": "2020-08-19T01:52:38Z", "message": "change gRPC status code for OverflowException to DEADLINE_EXCEEDED\n\nSigned-off-by: Xin Li <xin.li@swirlds.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "449ce2b3c64bea13ceb9daf45fa18d3f8a4bd7fb", "author": {"user": {"login": "xin-hedera", "name": "Xin Li"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/449ce2b3c64bea13ceb9daf45fa18d3f8a4bd7fb", "committedDate": "2020-08-19T14:16:22Z", "message": "use non-default topic number in test case\n\nSigned-off-by: Xin Li <xin.li@swirlds.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcwNTQyNDYx", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/965#pullrequestreview-470542461", "createdAt": "2020-08-19T14:55:25Z", "commit": {"oid": "449ce2b3c64bea13ceb9daf45fa18d3f8a4bd7fb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3043, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}