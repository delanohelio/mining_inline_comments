{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU5MTA3OTg4", "number": 482, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wM1QyMToxMjo0MVrODVwKnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wM1QyMToxNDo0MFrODVwL0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI0MTM1ODM3OnYy", "diffSide": "RIGHT", "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/record/RecordFileLogger.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wM1QyMToxMjo0MVrOFaJf9A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wM1QyMjowOToyOFrOFaKZ7g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjk2MjkzMg==", "bodyText": "nit: you have this same logic repeated below.\nDid you want to move it into a single method so future edits don't miss one of the locations.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/482#discussion_r362962932", "createdAt": "2020-01-03T21:12:41Z", "author": {"login": "Nana-EC"}, "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/record/RecordFileLogger.java", "diffHunk": "@@ -558,23 +558,19 @@ private static Entities storeConsensusCreateTopic(TransactionBody body,\n         Entities entity = getEntity(transactionRecord.getReceipt().getTopicID());\n         var transactionBody = body.getConsensusCreateTopic();\n \n-        if (transactionBody.hasExpirationTime()) {\n-            Timestamp expirationTime = transactionBody.getExpirationTime();\n-            entity.setExpiryTimeNs(Utility.timestampInNanosMax(expirationTime));\n-            entity.setExpiryTimeSeconds(expirationTime.getSeconds());\n-            entity.setExpiryTimeNanos((long) expirationTime.getNanos());\n+        if (transactionBody.hasAutoRenewAccount()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21e671231bda853b4e5052b059946ecd7899ae70"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjk2NTI3Ng==", "bodyText": "No other part of the two methods can be combined, just autorenewaccount and autorenewperiod. I don't think it's worthwhile for that and we'll probably be breaking them into separate transaction handler classes soon.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/482#discussion_r362965276", "createdAt": "2020-01-03T21:21:29Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/record/RecordFileLogger.java", "diffHunk": "@@ -558,23 +558,19 @@ private static Entities storeConsensusCreateTopic(TransactionBody body,\n         Entities entity = getEntity(transactionRecord.getReceipt().getTopicID());\n         var transactionBody = body.getConsensusCreateTopic();\n \n-        if (transactionBody.hasExpirationTime()) {\n-            Timestamp expirationTime = transactionBody.getExpirationTime();\n-            entity.setExpiryTimeNs(Utility.timestampInNanosMax(expirationTime));\n-            entity.setExpiryTimeSeconds(expirationTime.getSeconds());\n-            entity.setExpiryTimeNanos((long) expirationTime.getNanos());\n+        if (transactionBody.hasAutoRenewAccount()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjk2MjkzMg=="}, "originalCommit": {"oid": "21e671231bda853b4e5052b059946ecd7899ae70"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjk3Nzc3NA==", "bodyText": "Okay", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/482#discussion_r362977774", "createdAt": "2020-01-03T22:09:28Z", "author": {"login": "Nana-EC"}, "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/record/RecordFileLogger.java", "diffHunk": "@@ -558,23 +558,19 @@ private static Entities storeConsensusCreateTopic(TransactionBody body,\n         Entities entity = getEntity(transactionRecord.getReceipt().getTopicID());\n         var transactionBody = body.getConsensusCreateTopic();\n \n-        if (transactionBody.hasExpirationTime()) {\n-            Timestamp expirationTime = transactionBody.getExpirationTime();\n-            entity.setExpiryTimeNs(Utility.timestampInNanosMax(expirationTime));\n-            entity.setExpiryTimeSeconds(expirationTime.getSeconds());\n-            entity.setExpiryTimeNanos((long) expirationTime.getNanos());\n+        if (transactionBody.hasAutoRenewAccount()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjk2MjkzMg=="}, "originalCommit": {"oid": "21e671231bda853b4e5052b059946ecd7899ae70"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI0MTM2MTQ3OnYy", "diffSide": "RIGHT", "path": "hedera-mirror-importer/src/main/resources/db/migration/V1.17.4__hcs_proto_changes.sql", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wM1QyMToxNDo0MFrOFaJh6A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wM1QyMjozNjo0MlrOFaKyOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjk2MzQzMg==", "bodyText": "Should this have an upper bound also? Just in case someone runs migration out of flow when there exists proto_id's greater than the current range?", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/482#discussion_r362963432", "createdAt": "2020-01-03T21:14:40Z", "author": {"login": "Nana-EC"}, "path": "hedera-mirror-importer/src/main/resources/db/migration/V1.17.4__hcs_proto_changes.sql", "diffHunk": "@@ -0,0 +1,17 @@\n+alter table t_entities drop column topic_valid_start_time;\n+alter table t_entities drop column admin_key__deprecated;\n+alter table t_entities drop column exp_time_seconds;\n+alter table t_entities drop column exp_time_nanos;\n+alter table t_entities add column auto_renew_account_id bigint null;\n+alter table t_entities add constraint autorenew_account foreign key (auto_renew_account_id) references t_entities(id);\n+\n+delete from t_transaction_results where proto_id >= 150;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21e671231bda853b4e5052b059946ecd7899ae70"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjk2NDgxNg==", "bodyText": "It's not really necessary, the whole point of migrations are they are not ran out of order.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/482#discussion_r362964816", "createdAt": "2020-01-03T21:19:42Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-importer/src/main/resources/db/migration/V1.17.4__hcs_proto_changes.sql", "diffHunk": "@@ -0,0 +1,17 @@\n+alter table t_entities drop column topic_valid_start_time;\n+alter table t_entities drop column admin_key__deprecated;\n+alter table t_entities drop column exp_time_seconds;\n+alter table t_entities drop column exp_time_nanos;\n+alter table t_entities add column auto_renew_account_id bigint null;\n+alter table t_entities add constraint autorenew_account foreign key (auto_renew_account_id) references t_entities(id);\n+\n+delete from t_transaction_results where proto_id >= 150;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjk2MzQzMg=="}, "originalCommit": {"oid": "21e671231bda853b4e5052b059946ecd7899ae70"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjk3NzcwNg==", "bodyText": "Granted. Just bothers me that a flow exists to delete all the rows above a certain range. It's best practice to remove exactly what you want, unless you really don't care for anything that could exist above the range.\nI'll leave it to you though.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/482#discussion_r362977706", "createdAt": "2020-01-03T22:09:14Z", "author": {"login": "Nana-EC"}, "path": "hedera-mirror-importer/src/main/resources/db/migration/V1.17.4__hcs_proto_changes.sql", "diffHunk": "@@ -0,0 +1,17 @@\n+alter table t_entities drop column topic_valid_start_time;\n+alter table t_entities drop column admin_key__deprecated;\n+alter table t_entities drop column exp_time_seconds;\n+alter table t_entities drop column exp_time_nanos;\n+alter table t_entities add column auto_renew_account_id bigint null;\n+alter table t_entities add constraint autorenew_account foreign key (auto_renew_account_id) references t_entities(id);\n+\n+delete from t_transaction_results where proto_id >= 150;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjk2MzQzMg=="}, "originalCommit": {"oid": "21e671231bda853b4e5052b059946ecd7899ae70"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjk4Mzk5Mg==", "bodyText": "Added", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/482#discussion_r362983992", "createdAt": "2020-01-03T22:36:42Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-importer/src/main/resources/db/migration/V1.17.4__hcs_proto_changes.sql", "diffHunk": "@@ -0,0 +1,17 @@\n+alter table t_entities drop column topic_valid_start_time;\n+alter table t_entities drop column admin_key__deprecated;\n+alter table t_entities drop column exp_time_seconds;\n+alter table t_entities drop column exp_time_nanos;\n+alter table t_entities add column auto_renew_account_id bigint null;\n+alter table t_entities add constraint autorenew_account foreign key (auto_renew_account_id) references t_entities(id);\n+\n+delete from t_transaction_results where proto_id >= 150;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjk2MzQzMg=="}, "originalCommit": {"oid": "21e671231bda853b4e5052b059946ecd7899ae70"}, "originalPosition": 8}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1116, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}