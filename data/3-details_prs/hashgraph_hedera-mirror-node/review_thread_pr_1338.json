{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM0ODMwNzA2", "number": 1338, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxNjoxMDoxNFrOFDAbzA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxNjoxMDoxNFrOFDAbzA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM4Njk3MTY0OnYy", "diffSide": "RIGHT", "path": "hedera-mirror-rest/transactions.js", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxNjoxMDoxNFrOICcvtA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOVQxODoxNTozOFrOICisiA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTQzOTAyOA==", "bodyText": "Is this intentional to have tsParams concatenated twice?", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1338#discussion_r539439028", "createdAt": "2020-12-09T16:10:14Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-rest/transactions.js", "diffHunk": "@@ -218,11 +219,11 @@ const reqToSql = function (req) {\n   const parsedQueryParams = req.query;\n   const [creditDebitQuery] = utils.parseCreditDebitParams(parsedQueryParams, 'ctl.amount');\n   const [accountQuery, accountParams] = utils.parseAccountIdQueryParam(parsedQueryParams, 'ctl.entity_id');\n-  const [tsQuery, tsParams] = utils.parseTimestampQueryParam(parsedQueryParams, 'ctl.consensus_timestamp');\n+  const [tsQuery, tsParams] = utils.parseTimestampQueryParam(parsedQueryParams, 't.consensus_ns');\n   const resultTypeQuery = utils.parseResultParams(req, 't.result');\n   const transactionTypeQuery = utils.getTransactionTypeQuery(parsedQueryParams);\n   const {query, params, order, limit} = utils.parseLimitAndOrderParams(req);\n-  const sqlParams = accountParams.concat(tsParams).concat(params);\n+  const sqlParams = accountParams.concat(tsParams).concat(tsParams).concat(params);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7d14baccb397273a80b3f5e3ec141c0bba849040"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTQ1MjY3Nw==", "bodyText": "yes. because the same timestamp conditions now apply to both crytpo_transfer.consensus_timestamp and transaction.consensus_ns and later the mysql style query & params are translated to postgres style. the translator has no idea that those timestamp param values are the same\nit's also why in the first attempt, I tested and thought putting timestamp conditions on transaction.consensus_ns is enough to avoid:\n\nconvert the condition column name in getTransactionsInnerQuery\nconcat tsParams twice\n\nI suggest we handle it in a bigger refactoring.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1338#discussion_r539452677", "createdAt": "2020-12-09T16:26:29Z", "author": {"login": "xin-hedera"}, "path": "hedera-mirror-rest/transactions.js", "diffHunk": "@@ -218,11 +219,11 @@ const reqToSql = function (req) {\n   const parsedQueryParams = req.query;\n   const [creditDebitQuery] = utils.parseCreditDebitParams(parsedQueryParams, 'ctl.amount');\n   const [accountQuery, accountParams] = utils.parseAccountIdQueryParam(parsedQueryParams, 'ctl.entity_id');\n-  const [tsQuery, tsParams] = utils.parseTimestampQueryParam(parsedQueryParams, 'ctl.consensus_timestamp');\n+  const [tsQuery, tsParams] = utils.parseTimestampQueryParam(parsedQueryParams, 't.consensus_ns');\n   const resultTypeQuery = utils.parseResultParams(req, 't.result');\n   const transactionTypeQuery = utils.getTransactionTypeQuery(parsedQueryParams);\n   const {query, params, order, limit} = utils.parseLimitAndOrderParams(req);\n-  const sqlParams = accountParams.concat(tsParams).concat(params);\n+  const sqlParams = accountParams.concat(tsParams).concat(tsParams).concat(params);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTQzOTAyOA=="}, "originalCommit": {"oid": "7d14baccb397273a80b3f5e3ec141c0bba849040"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTUzNjUyMA==", "bodyText": "Ah, I was confused because I was thinking it was the query which included the column name, but it's just the timestamp itself passed twice. Makes sense.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1338#discussion_r539536520", "createdAt": "2020-12-09T18:15:38Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-rest/transactions.js", "diffHunk": "@@ -218,11 +219,11 @@ const reqToSql = function (req) {\n   const parsedQueryParams = req.query;\n   const [creditDebitQuery] = utils.parseCreditDebitParams(parsedQueryParams, 'ctl.amount');\n   const [accountQuery, accountParams] = utils.parseAccountIdQueryParam(parsedQueryParams, 'ctl.entity_id');\n-  const [tsQuery, tsParams] = utils.parseTimestampQueryParam(parsedQueryParams, 'ctl.consensus_timestamp');\n+  const [tsQuery, tsParams] = utils.parseTimestampQueryParam(parsedQueryParams, 't.consensus_ns');\n   const resultTypeQuery = utils.parseResultParams(req, 't.result');\n   const transactionTypeQuery = utils.getTransactionTypeQuery(parsedQueryParams);\n   const {query, params, order, limit} = utils.parseLimitAndOrderParams(req);\n-  const sqlParams = accountParams.concat(tsParams).concat(params);\n+  const sqlParams = accountParams.concat(tsParams).concat(tsParams).concat(params);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTQzOTAyOA=="}, "originalCommit": {"oid": "7d14baccb397273a80b3f5e3ec141c0bba849040"}, "originalPosition": 31}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1314, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}