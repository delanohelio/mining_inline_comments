{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU5MTA3OTg4", "number": 482, "title": "HCS proto changes", "bodyText": "Detailed description:\n\nRemoves t_entities.admin_key__deprecated\nRemoves t_entities.exp_time_seconds\nRemoves t_entities.exp_time_nanos\nRemoves t_entities.topic_valid_start_time\nAdds t_entities.auto_renew_account_id\nAdds new HCS protobuf response codes\nFixes previous HCS protobuf response codes that had changed from Mike's branch\nRenames ConsensusService to ConsensusController to avoid confusion with business logic service layer (see code comment)\nBumps Spring Boot bugfix version\nPull in latest HCS services protobuf with above changes\n\nWhich issue(s) this PR fixes:\nFixes #440\nFixes #325\nSpecial notes for your reviewer:\nChecklist\n\n Documentation added\n Tests updated", "createdAt": "2020-01-03T20:08:48Z", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/482", "merged": true, "mergeCommit": {"oid": "be8ff52e8a913f0c0890277bfd9ef5320670a34b"}, "closed": true, "closedAt": "2020-01-03T22:40:17Z", "author": {"login": "steven-sheehy"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb20G6NgH2gAyMzU5MTA3OTg4OmYyNmQyZTdkZDFiNDhhMWY1ZGFjMWRjZGFhZmMxYTg1YWI4ZjI2ODY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb22OptgFqTMzODMwMzk1MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f26d2e7dd1b48a1f5dac1dcdaafc1a85ab8f2686", "author": {"user": {"login": "steven-sheehy", "name": "Steven Sheehy"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/f26d2e7dd1b48a1f5dac1dcdaafc1a85ab8f2686", "committedDate": "2020-01-03T20:09:27Z", "message": "Rename ConsensusService to ConsensusController\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6e75dc6e8939c15a11799db731232afba18e37d9", "author": {"user": {"login": "steven-sheehy", "name": "Steven Sheehy"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/6e75dc6e8939c15a11799db731232afba18e37d9", "committedDate": "2020-01-03T20:09:27Z", "message": "Remove t_entities.topic_valid_start_time\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0edf7dbc6e419c35e4054467ed1771e07727b28a", "author": {"user": {"login": "steven-sheehy", "name": "Steven Sheehy"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/0edf7dbc6e419c35e4054467ed1771e07727b28a", "committedDate": "2020-01-03T20:09:27Z", "message": "Add auto renew account to entities\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "06ff38b0ade4d04d95ea6c384064b76843fe5d7f", "author": {"user": {"login": "steven-sheehy", "name": "Steven Sheehy"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/06ff38b0ade4d04d95ea6c384064b76843fe5d7f", "committedDate": "2020-01-03T20:09:27Z", "message": "Update HCS transaction response codes\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2031c44359c6aca97a2aa683e6afa872077b91fd", "author": {"user": {"login": "steven-sheehy", "name": "Steven Sheehy"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/2031c44359c6aca97a2aa683e6afa872077b91fd", "committedDate": "2020-01-03T20:17:50Z", "message": "Remove deprecated entity fields\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f781cb70f278aca77d4835c6597849074ed9134f", "author": {"user": {"login": "steven-sheehy", "name": "Steven Sheehy"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/f781cb70f278aca77d4835c6597849074ed9134f", "committedDate": "2020-01-03T19:56:03Z", "message": "Remove deprecated entity fields\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>"}, "afterCommit": {"oid": "2031c44359c6aca97a2aa683e6afa872077b91fd", "author": {"user": {"login": "steven-sheehy", "name": "Steven Sheehy"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/2031c44359c6aca97a2aa683e6afa872077b91fd", "committedDate": "2020-01-03T20:17:50Z", "message": "Remove deprecated entity fields\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "21e671231bda853b4e5052b059946ecd7899ae70", "author": {"user": {"login": "steven-sheehy", "name": "Steven Sheehy"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/21e671231bda853b4e5052b059946ecd7899ae70", "committedDate": "2020-01-03T20:20:36Z", "message": "Fix doc rendering\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM4Mjc3MjYz", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/482#pullrequestreview-338277263", "createdAt": "2020-01-03T21:12:41Z", "commit": {"oid": "21e671231bda853b4e5052b059946ecd7899ae70"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wM1QyMToxMjo0MVrOFaJf9A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wM1QyMToxNDo0MFrOFaJh6A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjk2MjkzMg==", "bodyText": "nit: you have this same logic repeated below.\nDid you want to move it into a single method so future edits don't miss one of the locations.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/482#discussion_r362962932", "createdAt": "2020-01-03T21:12:41Z", "author": {"login": "Nana-EC"}, "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/record/RecordFileLogger.java", "diffHunk": "@@ -558,23 +558,19 @@ private static Entities storeConsensusCreateTopic(TransactionBody body,\n         Entities entity = getEntity(transactionRecord.getReceipt().getTopicID());\n         var transactionBody = body.getConsensusCreateTopic();\n \n-        if (transactionBody.hasExpirationTime()) {\n-            Timestamp expirationTime = transactionBody.getExpirationTime();\n-            entity.setExpiryTimeNs(Utility.timestampInNanosMax(expirationTime));\n-            entity.setExpiryTimeSeconds(expirationTime.getSeconds());\n-            entity.setExpiryTimeNanos((long) expirationTime.getNanos());\n+        if (transactionBody.hasAutoRenewAccount()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21e671231bda853b4e5052b059946ecd7899ae70"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjk2MzQzMg==", "bodyText": "Should this have an upper bound also? Just in case someone runs migration out of flow when there exists proto_id's greater than the current range?", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/482#discussion_r362963432", "createdAt": "2020-01-03T21:14:40Z", "author": {"login": "Nana-EC"}, "path": "hedera-mirror-importer/src/main/resources/db/migration/V1.17.4__hcs_proto_changes.sql", "diffHunk": "@@ -0,0 +1,17 @@\n+alter table t_entities drop column topic_valid_start_time;\n+alter table t_entities drop column admin_key__deprecated;\n+alter table t_entities drop column exp_time_seconds;\n+alter table t_entities drop column exp_time_nanos;\n+alter table t_entities add column auto_renew_account_id bigint null;\n+alter table t_entities add constraint autorenew_account foreign key (auto_renew_account_id) references t_entities(id);\n+\n+delete from t_transaction_results where proto_id >= 150;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "21e671231bda853b4e5052b059946ecd7899ae70"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM4Mjk2NDU2", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/482#pullrequestreview-338296456", "createdAt": "2020-01-03T22:09:52Z", "commit": {"oid": "21e671231bda853b4e5052b059946ecd7899ae70"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dde8287b010b0fda9b88e113dde07c6a98a8c1c1", "author": {"user": {"login": "steven-sheehy", "name": "Steven Sheehy"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/dde8287b010b0fda9b88e113dde07c6a98a8c1c1", "committedDate": "2020-01-03T22:36:14Z", "message": "Review feedback\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM4MzAzOTUw", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/482#pullrequestreview-338303950", "createdAt": "2020-01-03T22:37:43Z", "commit": {"oid": "dde8287b010b0fda9b88e113dde07c6a98a8c1c1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3216, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}