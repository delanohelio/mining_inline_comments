{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEzMDc0MzUz", "number": 1204, "title": "Add redis sentinel configuration for importer", "bodyText": "Detailed description:\nAdd redis sentinel configuration to importer so it can publish topic messages to the master node.\nWhich issue(s) this PR fixes:\nSpecial notes for your reviewer:\nBy default, hedera-mirror charts configure redis chart to run in master-slave with sentinel enabled. However, hedera-mirror-importer charts configures importer to connect to the redis k8s service directly, which may route the topic messages to a read-only slave so all topic messages pubs are lost. The PR addresses the issue by configuring spring redis sentinel properties when needed.\nChecklist\n\n Documentation added\n Tests updated", "createdAt": "2020-10-30T15:11:34Z", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1204", "merged": true, "mergeCommit": {"oid": "53815ea58ea0206711cb1ddda14dc12614f60c85"}, "closed": true, "closedAt": "2020-11-02T18:35:58Z", "author": {"login": "xin-hedera"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdXoLgkAH2gAyNTEzMDc0MzUzOjRlZDQzMmY2NWExNDM1YWY4MWRlNjUyOTY2ZDBlOWNmOGQzYThmODE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdYnjYvAFqTUyMTgxODM2OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4ed432f65a1435af81de652966d0e9cf8d3a8f81", "author": {"user": {"login": "xin-hedera", "name": "Xin Li"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/4ed432f65a1435af81de652966d0e9cf8d3a8f81", "committedDate": "2020-10-30T15:06:16Z", "message": "add redis sentinel configuration for importer\n\nSigned-off-by: Xin Li <xin.li@swirlds.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIwODE1MzY0", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1204#pullrequestreview-520815364", "createdAt": "2020-10-30T16:05:02Z", "commit": {"oid": "4ed432f65a1435af81de652966d0e9cf8d3a8f81"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxNjowNTowMlrOHrV1wg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0zMFQxNjo0NToxNVrOHrXU5w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTIwODY0Mg==", "bodyText": "I think we can probably hardcode this in the application.yaml to avoid having to populate the env variable.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1204#discussion_r515208642", "createdAt": "2020-10-30T16:05:02Z", "author": {"login": "steven-sheehy"}, "path": "charts/hedera-mirror/values.yaml", "diffHunk": "@@ -36,6 +36,10 @@ importer:\n             password: mirror_node_pass\n             username: mirror_node\n   enabled: true\n+  redis:\n+    sentinel:\n+      enabled: true\n+      masterSet: mirror", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ed432f65a1435af81de652966d0e9cf8d3a8f81"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTIzMTc0OQ==", "bodyText": "I think we should default this to true so we don't have to turn it on in parent.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1204#discussion_r515231749", "createdAt": "2020-10-30T16:43:18Z", "author": {"login": "steven-sheehy"}, "path": "charts/hedera-mirror-importer/values.yaml", "diffHunk": "@@ -84,6 +84,11 @@ readinessProbe:\n   initialDelaySeconds: 60\n   timeoutSeconds: 2\n \n+redis:\n+  sentinel:\n+    enabled: false", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ed432f65a1435af81de652966d0e9cf8d3a8f81"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTIzMjk5OQ==", "bodyText": "I think it's safe to always set this variable, so can move sentinel enable check to be just around the sentinel variables. I believe it will construct the URI to sentinel only if the sentinel variables are populated.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1204#discussion_r515232999", "createdAt": "2020-10-30T16:45:15Z", "author": {"login": "steven-sheehy"}, "path": "charts/hedera-mirror-importer/templates/statefulset.yaml", "diffHunk": "@@ -35,8 +35,17 @@ spec:\n               value: \"true\"\n             - name: SPRING_CONFIG_ADDITIONAL_LOCATION\n               value: \"file:/usr/etc/hedera-mirror-importer/\"\n+            {{- if not .Values.redis.sentinel.enabled }}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4ed432f65a1435af81de652966d0e9cf8d3a8f81"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "769288840b1f3fefba2b333d83c0df943c64dea7", "author": {"user": {"login": "xin-hedera", "name": "Xin Li"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/769288840b1f3fefba2b333d83c0df943c64dea7", "committedDate": "2020-11-02T15:18:15Z", "message": "address review feedback\n\nSigned-off-by: Xin Li <xin.li@swirlds.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxODE4MzY4", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1204#pullrequestreview-521818368", "createdAt": "2020-11-02T16:56:22Z", "commit": {"oid": "769288840b1f3fefba2b333d83c0df943c64dea7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3473, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}