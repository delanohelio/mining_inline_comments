{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY4ODE5NTQz", "number": 513, "reviewThreads": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQxNjozNDoxOVrODb-xJw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQyMDozMDowN1rODcDPvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMwNjY2NTM1OnYy", "diffSide": "RIGHT", "path": ".circleci/config.yml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQxNjozNDoxOVrOFjxq2A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQxOTowODo0N1rOFkVEjw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzA1ODI2NA==", "bodyText": "We do want images for pre-release tags. I think any format of tag is fine /.*/", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/513#discussion_r373058264", "createdAt": "2020-01-30T16:34:19Z", "author": {"login": "steven-sheehy"}, "path": ".circleci/config.yml", "diffHunk": "@@ -31,6 +51,15 @@ workflows:\n               ignore: /.*/\n             tags:\n               only: /^v.*/\n+      - release_docker_images:\n+          requires:\n+            - build_maven\n+            - build_rest\n+          filters:\n+            branches:\n+              ignore: /.*/\n+            tags:\n+              only: /^v.\\d*.\\d*.\\d*/ # Do not push docker images to registry for rc, alpha, beta, etc.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "495ae0b8239e17338384e723b35ab11ed3fbb4ea"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzYzODI4Nw==", "bodyText": "done.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/513#discussion_r373638287", "createdAt": "2020-01-31T19:08:47Z", "author": {"login": "apeksharma"}, "path": ".circleci/config.yml", "diffHunk": "@@ -31,6 +51,15 @@ workflows:\n               ignore: /.*/\n             tags:\n               only: /^v.*/\n+      - release_docker_images:\n+          requires:\n+            - build_maven\n+            - build_rest\n+          filters:\n+            branches:\n+              ignore: /.*/\n+            tags:\n+              only: /^v.\\d*.\\d*.\\d*/ # Do not push docker images to registry for rc, alpha, beta, etc.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzA1ODI2NA=="}, "originalCommit": {"oid": "495ae0b8239e17338384e723b35ab11ed3fbb4ea"}, "originalPosition": 39}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMwNjY2OTYwOnYy", "diffSide": "RIGHT", "path": ".circleci/config.yml", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQxNjozNTozNVrOFjxtiA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQyMDoyNzoxMlrOFkXEEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzA1ODk1Mg==", "bodyText": "We also want images pushed on every commit to master, but only the latest docker tag should be updated. Released versions should not be overwritten on commits to master.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/513#discussion_r373058952", "createdAt": "2020-01-30T16:35:35Z", "author": {"login": "steven-sheehy"}, "path": ".circleci/config.yml", "diffHunk": "@@ -31,6 +51,15 @@ workflows:\n               ignore: /.*/\n             tags:\n               only: /^v.*/\n+      - release_docker_images:\n+          requires:\n+            - build_maven\n+            - build_rest\n+          filters:\n+            branches:\n+              ignore: /.*/", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "495ae0b8239e17338384e723b35ab11ed3fbb4ea"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzE5MzMwOQ==", "bodyText": "pushing on every commit to master seems too much. We'll accumulate too many images and then will need to clean them up periodically. Is there a common case where we'll need non-tagged images in registry?", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/513#discussion_r373193309", "createdAt": "2020-01-30T21:06:13Z", "author": {"login": "apeksharma"}, "path": ".circleci/config.yml", "diffHunk": "@@ -31,6 +51,15 @@ workflows:\n               ignore: /.*/\n             tags:\n               only: /^v.*/\n+      - release_docker_images:\n+          requires:\n+            - build_maven\n+            - build_rest\n+          filters:\n+            branches:\n+              ignore: /.*/", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzA1ODk1Mg=="}, "originalCommit": {"oid": "495ae0b8239e17338384e723b35ab11ed3fbb4ea"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzE5NDc2Mw==", "bodyText": "I think you're misunderstanding some concept. You don't accumulate images because you're overwriting the latest tag. This is the purpose of the latest tag, to always point at the latest code. Having latest master images is actually more important right now for us than tagged images as it will allow us to use those images via CI to performance test or continuously deploy to dev env", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/513#discussion_r373194763", "createdAt": "2020-01-30T21:09:39Z", "author": {"login": "steven-sheehy"}, "path": ".circleci/config.yml", "diffHunk": "@@ -31,6 +51,15 @@ workflows:\n               ignore: /.*/\n             tags:\n               only: /^v.*/\n+      - release_docker_images:\n+          requires:\n+            - build_maven\n+            - build_rest\n+          filters:\n+            branches:\n+              ignore: /.*/", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzA1ODk1Mg=="}, "originalCommit": {"oid": "495ae0b8239e17338384e723b35ab11ed3fbb4ea"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzY0MzU5MQ==", "bodyText": "We'll accumulate images in registry since tagging new image doesn't remove old images that had that tag. (https://console.cloud.google.com/gcr/images/mirrornode/GLOBAL/hedera-mirror-rest?project=mirrornode&supportedpurview=project&gcrImageListsize=30)\nFor perf/stability/regression tests in nightly/other periodic fashion, it's probably best to adapt CI to it after we have designed and finalized it.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/513#discussion_r373643591", "createdAt": "2020-01-31T19:21:07Z", "author": {"login": "apeksharma"}, "path": ".circleci/config.yml", "diffHunk": "@@ -31,6 +51,15 @@ workflows:\n               ignore: /.*/\n             tags:\n               only: /^v.*/\n+      - release_docker_images:\n+          requires:\n+            - build_maven\n+            - build_rest\n+          filters:\n+            branches:\n+              ignore: /.*/", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzA1ODk1Mg=="}, "originalCommit": {"oid": "495ae0b8239e17338384e723b35ab11ed3fbb4ea"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzY3MDkyOA==", "bodyText": "Hmm, this is specific to GCR then. GitLab and Docker Hub don't keep around untagged images. Ok, we can delay to a future task", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/513#discussion_r373670928", "createdAt": "2020-01-31T20:27:12Z", "author": {"login": "steven-sheehy"}, "path": ".circleci/config.yml", "diffHunk": "@@ -31,6 +51,15 @@ workflows:\n               ignore: /.*/\n             tags:\n               only: /^v.*/\n+      - release_docker_images:\n+          requires:\n+            - build_maven\n+            - build_rest\n+          filters:\n+            branches:\n+              ignore: /.*/", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzA1ODk1Mg=="}, "originalCommit": {"oid": "495ae0b8239e17338384e723b35ab11ed3fbb4ea"}, "originalPosition": 37}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMwNjY4NDg5OnYy", "diffSide": "RIGHT", "path": "pom.xml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQxNjozOTo1OFrOFjx3Wg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQxOToxNjowNVrOFj2xrw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzA2MTQ2Ng==", "bodyText": "Q: Will this make images publicly available? Or will users still be limited in their ability to pull down images?", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/513#discussion_r373061466", "createdAt": "2020-01-30T16:39:58Z", "author": {"login": "Nana-EC"}, "path": "pom.xml", "diffHunk": "@@ -54,7 +54,7 @@\n \n     <properties>\n         <disruptor.version>3.4.2</disruptor.version> <!-- Used for asynchronous logging -->\n-        <docker.repository>docker.pkg.github.com/hashgraph/hedera-mirror-node</docker.repository>\n+        <docker.push.repository>gcr.io/mirrornode</docker.push.repository>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "495ae0b8239e17338384e723b35ab11ed3fbb4ea"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzE0MTkzNQ==", "bodyText": "all public. https://console.cloud.google.com/gcr/images/mirrornode?project=mirrornode&supportedpurview=project", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/513#discussion_r373141935", "createdAt": "2020-01-30T19:16:05Z", "author": {"login": "apeksharma"}, "path": "pom.xml", "diffHunk": "@@ -54,7 +54,7 @@\n \n     <properties>\n         <disruptor.version>3.4.2</disruptor.version> <!-- Used for asynchronous logging -->\n-        <docker.repository>docker.pkg.github.com/hashgraph/hedera-mirror-node</docker.repository>\n+        <docker.push.repository>gcr.io/mirrornode</docker.push.repository>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzA2MTQ2Ng=="}, "originalCommit": {"oid": "495ae0b8239e17338384e723b35ab11ed3fbb4ea"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMwNjgyNTYxOnYy", "diffSide": "RIGHT", "path": ".circleci/config.yml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQxNzoyMDozMVrOFjzQjw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQxOTozMToxNlrOFkVqrw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzA4NDMwMw==", "bodyText": "Prefer just publish_images as docker is not the only image format (OCI) or the only container runtime (containerd, CRI-O, etc). Publish since we want it to run on master as well not just releases", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/513#discussion_r373084303", "createdAt": "2020-01-30T17:20:31Z", "author": {"login": "steven-sheehy"}, "path": ".circleci/config.yml", "diffHunk": "@@ -154,3 +168,24 @@ jobs:\n       - *attach_workspace\n       - store_artifacts:\n           path: /tmp/workspace/artifacts\n+\n+  release_docker_images:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "495ae0b8239e17338384e723b35ab11ed3fbb4ea"}, "originalPosition": 98}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzY0ODA0Nw==", "bodyText": "done.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/513#discussion_r373648047", "createdAt": "2020-01-31T19:31:16Z", "author": {"login": "apeksharma"}, "path": ".circleci/config.yml", "diffHunk": "@@ -154,3 +168,24 @@ jobs:\n       - *attach_workspace\n       - store_artifacts:\n           path: /tmp/workspace/artifacts\n+\n+  release_docker_images:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzA4NDMwMw=="}, "originalCommit": {"oid": "495ae0b8239e17338384e723b35ab11ed3fbb4ea"}, "originalPosition": 98}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMwNjk4OTU2OnYy", "diffSide": "RIGHT", "path": ".circleci/config.yml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQxODoxNDo1OVrOFj04yQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQxOTozMjo0OFrOFkVtSg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzExMDk4NQ==", "bodyText": "Why are we adding arch? Maven artifacts are not architecture/OS specific.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/513#discussion_r373110985", "createdAt": "2020-01-30T18:14:59Z", "author": {"login": "steven-sheehy"}, "path": ".circleci/config.yml", "diffHunk": "@@ -5,6 +5,26 @@ references:\n   attach_workspace: &attach_workspace\n     attach_workspace:\n       at: *workspace_root\n+  persist_artifacts: &persist_artifacts\n+    persist_to_workspace:\n+      root: *workspace_root\n+      paths:\n+        - artifacts\n+  pom_checksum: &pom_checksum\n+    run:\n+      name: Calculate checksum of all pom.xml\n+      command: find . -type f -name \"pom.xml\" | sort -u | xargs sha512sum > pom.xml.checksum\n+  restore_maven_cache: &restore_maven_cache\n+    restore_cache:\n+      keys:\n+        - maven-v2-{{ arch }}-{{ .Branch }}-{{ checksum \"pom.xml.checksum\" }}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "495ae0b8239e17338384e723b35ab11ed3fbb4ea"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzY0ODcxNA==", "bodyText": "for different executors. Otherwise it cases issue with perms. Let me put a comment there in case someone in future has same thought.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/513#discussion_r373648714", "createdAt": "2020-01-31T19:32:48Z", "author": {"login": "apeksharma"}, "path": ".circleci/config.yml", "diffHunk": "@@ -5,6 +5,26 @@ references:\n   attach_workspace: &attach_workspace\n     attach_workspace:\n       at: *workspace_root\n+  persist_artifacts: &persist_artifacts\n+    persist_to_workspace:\n+      root: *workspace_root\n+      paths:\n+        - artifacts\n+  pom_checksum: &pom_checksum\n+    run:\n+      name: Calculate checksum of all pom.xml\n+      command: find . -type f -name \"pom.xml\" | sort -u | xargs sha512sum > pom.xml.checksum\n+  restore_maven_cache: &restore_maven_cache\n+    restore_cache:\n+      keys:\n+        - maven-v2-{{ arch }}-{{ .Branch }}-{{ checksum \"pom.xml.checksum\" }}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzExMDk4NQ=="}, "originalCommit": {"oid": "495ae0b8239e17338384e723b35ab11ed3fbb4ea"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMwNzM1NzEyOnYy", "diffSide": "RIGHT", "path": ".circleci/config.yml", "isResolved": true, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQyMDoxNToxM1rOFj4itg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQyMDoyOToyNVrOFkXHNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzE3MDg3MA==", "bodyText": "Did you try docker type with setup_remote_docker to see if docker-in-docker works? Would avoid having to spin up VM and install java on it and can use docker caching with docker_layer_caching option.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/513#discussion_r373170870", "createdAt": "2020-01-30T20:15:13Z", "author": {"login": "steven-sheehy"}, "path": ".circleci/config.yml", "diffHunk": "@@ -154,3 +168,24 @@ jobs:\n       - *attach_workspace\n       - store_artifacts:\n           path: /tmp/workspace/artifacts\n+\n+  release_docker_images:\n+    machine:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "495ae0b8239e17338384e723b35ab11ed3fbb4ea"}, "originalPosition": 99}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzE5NzA0NA==", "bodyText": "yeah, tried docker in docker. Couldn't find a trusted image with java11 and docker cli installed. Also, reading around : https://jpetazzo.github.io/2015/09/03/do-not-use-docker-in-docker-for-ci/.\nAlternate to d-i-d is machine. That's the original way of building docker images in CircleCI and more dev env like.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/513#discussion_r373197044", "createdAt": "2020-01-30T21:14:56Z", "author": {"login": "apeksharma"}, "path": ".circleci/config.yml", "diffHunk": "@@ -154,3 +168,24 @@ jobs:\n       - *attach_workspace\n       - store_artifacts:\n           path: /tmp/workspace/artifacts\n+\n+  release_docker_images:\n+    machine:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzE3MDg3MA=="}, "originalCommit": {"oid": "495ae0b8239e17338384e723b35ab11ed3fbb4ea"}, "originalPosition": 99}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzIxNjMwNw==", "bodyText": "You don't need docker cli installed. jib and docker-maven-plugin both just need a remote docker API to connect to. They don't shell out. I've read that link before. It's old and does not give good advice. CircleCI has DinD support with caching so it's not hacky or a security risk. Machine is not dnd, but d-in-vm.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/513#discussion_r373216307", "createdAt": "2020-01-30T21:59:13Z", "author": {"login": "steven-sheehy"}, "path": ".circleci/config.yml", "diffHunk": "@@ -154,3 +168,24 @@ jobs:\n       - *attach_workspace\n       - store_artifacts:\n           path: /tmp/workspace/artifacts\n+\n+  release_docker_images:\n+    machine:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzE3MDg3MA=="}, "originalCommit": {"oid": "495ae0b8239e17338384e723b35ab11ed3fbb4ea"}, "originalPosition": 99}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzY1MzkyNQ==", "bodyText": "https://app.circleci.com/jobs/github/hashgraph/hedera-mirror-node/2096\nhttps://github.com/GoogleContainerTools/jib/tree/master/jib-maven-plugin#build-to-docker-daemon\nmaybe we can skip dockerBuild and avoid it.\nBut i'd rather move to new task then keep optimizing this. machine works correctly, runs ~4min, looks good. We can improve it in future if needed.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/513#discussion_r373653925", "createdAt": "2020-01-31T19:44:52Z", "author": {"login": "apeksharma"}, "path": ".circleci/config.yml", "diffHunk": "@@ -154,3 +168,24 @@ jobs:\n       - *attach_workspace\n       - store_artifacts:\n           path: /tmp/workspace/artifacts\n+\n+  release_docker_images:\n+    machine:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzE3MDg3MA=="}, "originalCommit": {"oid": "495ae0b8239e17338384e723b35ab11ed3fbb4ea"}, "originalPosition": 99}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzY3MTczNA==", "bodyText": "jib can build without docker daemon at all if you use build goal, the problem is the rest uses docker-maven-plugin and that requires a daemon. We can revisit this later.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/513#discussion_r373671734", "createdAt": "2020-01-31T20:29:25Z", "author": {"login": "steven-sheehy"}, "path": ".circleci/config.yml", "diffHunk": "@@ -154,3 +168,24 @@ jobs:\n       - *attach_workspace\n       - store_artifacts:\n           path: /tmp/workspace/artifacts\n+\n+  release_docker_images:\n+    machine:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzE3MDg3MA=="}, "originalCommit": {"oid": "495ae0b8239e17338384e723b35ab11ed3fbb4ea"}, "originalPosition": 99}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMwNzM2Nzk2OnYy", "diffSide": "RIGHT", "path": ".circleci/config.yml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQyMDoxOTowNVrOFj4pWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQyMToxNzowOFrOFj6M1w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzE3MjU2OQ==", "bodyText": "How are these credentials generated? Are they your own so that if you leave the company the CI will break? We should have Ops create a service account with push and pull privileges for use here, if so.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/513#discussion_r373172569", "createdAt": "2020-01-30T20:19:05Z", "author": {"login": "steven-sheehy"}, "path": ".circleci/config.yml", "diffHunk": "@@ -154,3 +168,24 @@ jobs:\n       - *attach_workspace\n       - store_artifacts:\n           path: /tmp/workspace/artifacts\n+\n+  release_docker_images:\n+    machine:\n+      image: ubuntu-1604:201903-01\n+    environment:\n+      MAVEN_CLI_OPTS: --batch-mode --no-transfer-progress --show-version -Dorg.slf4j.simpleLogger.log.org.apache.maven.cli.transfer.Slf4jMavenTransferListener=warn\n+      JAVA_HOME: /usr/lib/jvm/java-11-openjdk-amd64\n+    steps:\n+      - checkout\n+      - run:\n+          name: Install OpenJDK 11\n+          command: |\n+            sudo add-apt-repository ppa:openjdk-r/ppa \\\n+            && sudo apt-get update -q \\\n+            && sudo apt install -y openjdk-11-jdk\n+      - *pom_checksum\n+      - *restore_maven_cache\n+      - run:\n+          name: Running maven deploy\n+          command: ./mvnw ${MAVEN_CLI_OPTS} deploy -Ddocker.push.username=_json_key -Ddocker.push.password=\"${GCR_JSON_KEY_FILE}\" -DskipTests", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ce846b6453abe73c976ee7fe7da153fa3ad57c6"}, "originalPosition": 116}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzE5ODAzOQ==", "bodyText": "gcr service account from Brad.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/513#discussion_r373198039", "createdAt": "2020-01-30T21:17:08Z", "author": {"login": "apeksharma"}, "path": ".circleci/config.yml", "diffHunk": "@@ -154,3 +168,24 @@ jobs:\n       - *attach_workspace\n       - store_artifacts:\n           path: /tmp/workspace/artifacts\n+\n+  release_docker_images:\n+    machine:\n+      image: ubuntu-1604:201903-01\n+    environment:\n+      MAVEN_CLI_OPTS: --batch-mode --no-transfer-progress --show-version -Dorg.slf4j.simpleLogger.log.org.apache.maven.cli.transfer.Slf4jMavenTransferListener=warn\n+      JAVA_HOME: /usr/lib/jvm/java-11-openjdk-amd64\n+    steps:\n+      - checkout\n+      - run:\n+          name: Install OpenJDK 11\n+          command: |\n+            sudo add-apt-repository ppa:openjdk-r/ppa \\\n+            && sudo apt-get update -q \\\n+            && sudo apt install -y openjdk-11-jdk\n+      - *pom_checksum\n+      - *restore_maven_cache\n+      - run:\n+          name: Running maven deploy\n+          command: ./mvnw ${MAVEN_CLI_OPTS} deploy -Ddocker.push.username=_json_key -Ddocker.push.password=\"${GCR_JSON_KEY_FILE}\" -DskipTests", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzE3MjU2OQ=="}, "originalCommit": {"oid": "2ce846b6453abe73c976ee7fe7da153fa3ad57c6"}, "originalPosition": 116}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMwNzM5NDM1OnYy", "diffSide": "RIGHT", "path": ".circleci/config.yml", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQyMDoyODozOFrOFj45wA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQxOTo0ODoyMFrOFkWHkw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzE3Njc2OA==", "bodyText": "This looks to be triggering for your PR branch and not just tags, causing the github checks to fail", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/513#discussion_r373176768", "createdAt": "2020-01-30T20:28:38Z", "author": {"login": "steven-sheehy"}, "path": ".circleci/config.yml", "diffHunk": "@@ -31,6 +51,15 @@ workflows:\n               ignore: /.*/\n             tags:\n               only: /^v.*/\n+      - release_docker_images:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ce846b6453abe73c976ee7fe7da153fa3ad57c6"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzE5OTEzNg==", "bodyText": "I can't find any run in last 24 hrs where it's getting triggered for the PR branch. Where are you seeing it? Link would help.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/513#discussion_r373199136", "createdAt": "2020-01-30T21:19:42Z", "author": {"login": "apeksharma"}, "path": ".circleci/config.yml", "diffHunk": "@@ -31,6 +51,15 @@ workflows:\n               ignore: /.*/\n             tags:\n               only: /^v.*/\n+      - release_docker_images:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzE3Njc2OA=="}, "originalCommit": {"oid": "2ce846b6453abe73c976ee7fe7da153fa3ad57c6"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzIxNjc0Nw==", "bodyText": "It's right here on this page in the github checks section: #513", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/513#discussion_r373216747", "createdAt": "2020-01-30T22:00:13Z", "author": {"login": "steven-sheehy"}, "path": ".circleci/config.yml", "diffHunk": "@@ -31,6 +51,15 @@ workflows:\n               ignore: /.*/\n             tags:\n               only: /^v.*/\n+      - release_docker_images:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzE3Njc2OA=="}, "originalCommit": {"oid": "2ce846b6453abe73c976ee7fe7da153fa3ad57c6"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzY1NTQ0Mw==", "bodyText": "It's probably from tags i push to test the changes on CI. Default job run triggered from branch push don't trigger image build.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/513#discussion_r373655443", "createdAt": "2020-01-31T19:48:20Z", "author": {"login": "apeksharma"}, "path": ".circleci/config.yml", "diffHunk": "@@ -31,6 +51,15 @@ workflows:\n               ignore: /.*/\n             tags:\n               only: /^v.*/\n+      - release_docker_images:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzE3Njc2OA=="}, "originalCommit": {"oid": "2ce846b6453abe73c976ee7fe7da153fa3ad57c6"}, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMwNzM5OTAxOnYy", "diffSide": "RIGHT", "path": ".circleci/config.yml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQyMDozMDowN1rOFj48eA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMFQyMToyMToyMlrOFj6UFA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzE3NzQ2NA==", "bodyText": "I think both the name and the password should be stored in circleci environment in case they need to change in the future. The name should also be more generic and not GCR specific in case we change registries. Recommend ${REGISTRY_USERNAME} and ${REGISTRY_PASSWORD}", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/513#discussion_r373177464", "createdAt": "2020-01-30T20:30:07Z", "author": {"login": "steven-sheehy"}, "path": ".circleci/config.yml", "diffHunk": "@@ -154,3 +168,24 @@ jobs:\n       - *attach_workspace\n       - store_artifacts:\n           path: /tmp/workspace/artifacts\n+\n+  release_docker_images:\n+    machine:\n+      image: ubuntu-1604:201903-01\n+    environment:\n+      MAVEN_CLI_OPTS: --batch-mode --no-transfer-progress --show-version -Dorg.slf4j.simpleLogger.log.org.apache.maven.cli.transfer.Slf4jMavenTransferListener=warn\n+      JAVA_HOME: /usr/lib/jvm/java-11-openjdk-amd64\n+    steps:\n+      - checkout\n+      - run:\n+          name: Install OpenJDK 11\n+          command: |\n+            sudo add-apt-repository ppa:openjdk-r/ppa \\\n+            && sudo apt-get update -q \\\n+            && sudo apt install -y openjdk-11-jdk\n+      - *pom_checksum\n+      - *restore_maven_cache\n+      - run:\n+          name: Running maven deploy\n+          command: ./mvnw ${MAVEN_CLI_OPTS} deploy -Ddocker.push.username=_json_key -Ddocker.push.password=\"${GCR_JSON_KEY_FILE}\" -DskipTests", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2ce846b6453abe73c976ee7fe7da153fa3ad57c6"}, "originalPosition": 116}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzE5OTg5Mg==", "bodyText": "outdated since auth method changed.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/513#discussion_r373199892", "createdAt": "2020-01-30T21:21:22Z", "author": {"login": "apeksharma"}, "path": ".circleci/config.yml", "diffHunk": "@@ -154,3 +168,24 @@ jobs:\n       - *attach_workspace\n       - store_artifacts:\n           path: /tmp/workspace/artifacts\n+\n+  release_docker_images:\n+    machine:\n+      image: ubuntu-1604:201903-01\n+    environment:\n+      MAVEN_CLI_OPTS: --batch-mode --no-transfer-progress --show-version -Dorg.slf4j.simpleLogger.log.org.apache.maven.cli.transfer.Slf4jMavenTransferListener=warn\n+      JAVA_HOME: /usr/lib/jvm/java-11-openjdk-amd64\n+    steps:\n+      - checkout\n+      - run:\n+          name: Install OpenJDK 11\n+          command: |\n+            sudo add-apt-repository ppa:openjdk-r/ppa \\\n+            && sudo apt-get update -q \\\n+            && sudo apt install -y openjdk-11-jdk\n+      - *pom_checksum\n+      - *restore_maven_cache\n+      - run:\n+          name: Running maven deploy\n+          command: ./mvnw ${MAVEN_CLI_OPTS} deploy -Ddocker.push.username=_json_key -Ddocker.push.password=\"${GCR_JSON_KEY_FILE}\" -DskipTests", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzE3NzQ2NA=="}, "originalCommit": {"oid": "2ce846b6453abe73c976ee7fe7da153fa3ad57c6"}, "originalPosition": 116}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1128, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}