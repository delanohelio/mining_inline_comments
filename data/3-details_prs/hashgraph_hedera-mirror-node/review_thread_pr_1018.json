{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc5NzYwNzU5", "number": 1018, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQxNTowNDo1MFrOEga3KQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQxNToxMDoyMVrOEga-7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAyNDI5OTkzOnYy", "diffSide": "RIGHT", "path": "hedera-mirror-rest/stateproof.js", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQxNTowNDo1MFrOHNRR3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQxNTo0NjoyOVrOHNTEqA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzY3NjYzNw==", "bodyText": "Would be better to make this a configuration option so we don't have to undo this change in the future. Something like hedera.mirror.rest.stateproof.addressBookHistory=false.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1018#discussion_r483676637", "createdAt": "2020-09-04T15:04:50Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-rest/stateproof.js", "diffHunk": "@@ -116,10 +117,18 @@ let getAddressBooksAndNodeAccountIdsByConsensusNs = async (consensusNs) => {\n          ON ab.start_consensus_timestamp = abe.consensus_timestamp\n        WHERE start_consensus_timestamp <= $1\n          AND file_id = 102\n-       GROUP BY start_consensus_timestamp\n-       ORDER BY start_consensus_timestamp`;\n+       GROUP BY start_consensus_timestamp`;\n+  if (!onlyCurrent) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b189ea72e5e9a5db97bc026003c7564ee53f3fc"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzY3ODIxOQ==", "bodyText": "sure. just have a little concern that if we should expose such an option or not. I'll implement it.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1018#discussion_r483678219", "createdAt": "2020-09-04T15:07:42Z", "author": {"login": "xin-hedera"}, "path": "hedera-mirror-rest/stateproof.js", "diffHunk": "@@ -116,10 +117,18 @@ let getAddressBooksAndNodeAccountIdsByConsensusNs = async (consensusNs) => {\n          ON ab.start_consensus_timestamp = abe.consensus_timestamp\n        WHERE start_consensus_timestamp <= $1\n          AND file_id = 102\n-       GROUP BY start_consensus_timestamp\n-       ORDER BY start_consensus_timestamp`;\n+       GROUP BY start_consensus_timestamp`;\n+  if (!onlyCurrent) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzY3NjYzNw=="}, "originalCommit": {"oid": "3b189ea72e5e9a5db97bc026003c7564ee53f3fc"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzcwNjAyNA==", "bodyText": "added the option and it's not documented in configuration.md", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1018#discussion_r483706024", "createdAt": "2020-09-04T15:46:29Z", "author": {"login": "xin-hedera"}, "path": "hedera-mirror-rest/stateproof.js", "diffHunk": "@@ -116,10 +117,18 @@ let getAddressBooksAndNodeAccountIdsByConsensusNs = async (consensusNs) => {\n          ON ab.start_consensus_timestamp = abe.consensus_timestamp\n        WHERE start_consensus_timestamp <= $1\n          AND file_id = 102\n-       GROUP BY start_consensus_timestamp\n-       ORDER BY start_consensus_timestamp`;\n+       GROUP BY start_consensus_timestamp`;\n+  if (!onlyCurrent) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzY3NjYzNw=="}, "originalCommit": {"oid": "3b189ea72e5e9a5db97bc026003c7564ee53f3fc"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAyNDMxOTgwOnYy", "diffSide": "RIGHT", "path": "hedera-mirror-rest/stateproof.js", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQxNToxMDoyMVrOHNRd7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wNFQxNToxMDoyMVrOHNRd7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzY3OTcyNw==", "bodyText": "oops, this is by mistake. will revert back to logger.trace", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1018#discussion_r483679727", "createdAt": "2020-09-04T15:10:21Z", "author": {"login": "xin-hedera"}, "path": "hedera-mirror-rest/stateproof.js", "diffHunk": "@@ -116,10 +117,18 @@ let getAddressBooksAndNodeAccountIdsByConsensusNs = async (consensusNs) => {\n          ON ab.start_consensus_timestamp = abe.consensus_timestamp\n        WHERE start_consensus_timestamp <= $1\n          AND file_id = 102\n-       GROUP BY start_consensus_timestamp\n-       ORDER BY start_consensus_timestamp`;\n+       GROUP BY start_consensus_timestamp`;\n+  if (!onlyCurrent) {\n+    sqlQuery += `\n+      ORDER BY start_consensus_timestamp`;\n+  } else {\n+    sqlQuery += `\n+      ORDER BY start_consensus_timestamp DESC\n+      LIMIT 1`;\n+  }\n+\n   if (logger.isTraceEnabled()) {\n-    logger.trace(`getAddressBooksAndNodeAccountIDsByConsensusNs: ${sqlQuery}, ${JSON.stringify(sqlParams)}`);\n+    logger.info(`getAddressBooksAndNodeAccountIDsByConsensusNs: ${sqlQuery}, ${JSON.stringify(sqlParams)}`);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3b189ea72e5e9a5db97bc026003c7564ee53f3fc"}, "originalPosition": 35}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1624, "cost": 1, "resetAt": "2021-11-12T20:28:25Z"}}}