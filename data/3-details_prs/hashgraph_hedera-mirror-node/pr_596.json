{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg3NDg5ODI4", "number": 596, "title": "Configuration to delete parsed files", "bodyText": "Detailed description:\nSigned-off-by: Apekshit Sharma apekshit.sharma@hedera.com\nWhich issue(s) this PR fixes:\npartially fixes #259\nSpecial notes for your reviewer:\nChecklist\n\n Documentation added\n Tests updated", "createdAt": "2020-03-12T21:41:10Z", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/596", "merged": true, "mergeCommit": {"oid": "4971da9319a3e49a7dc6a546f75893047d29286b"}, "closed": true, "closedAt": "2020-03-13T15:44:58Z", "author": {"login": "apeksharma"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcNCx46ABqjMxMjQ2MDI5NDE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcNSRd2AFqTM3NDQwNjc0Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "31b7b910a42d3a18504fd883a42ba7a1f6b350ce", "author": {"user": {"login": "apeksharma", "name": "Apekshit Sharma"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/31b7b910a42d3a18504fd883a42ba7a1f6b350ce", "committedDate": "2020-03-12T21:34:26Z", "message": "Configuration to delete parsed files\n\nSigned-off-by: Apekshit Sharma <apekshit.sharma@hedera.com>"}, "afterCommit": {"oid": "42875c07c680e23a2f61c46f04ade38e571808bd", "author": {"user": {"login": "apeksharma", "name": "Apekshit Sharma"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/42875c07c680e23a2f61c46f04ade38e571808bd", "committedDate": "2020-03-12T21:40:41Z", "message": "Configuration to delete parsed files\n\nSigned-off-by: Apekshit Sharma <apekshit.sharma@hedera.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczOTQxODk1", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/596#pullrequestreview-373941895", "createdAt": "2020-03-12T22:26:47Z", "commit": {"oid": "42875c07c680e23a2f61c46f04ade38e571808bd"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQyMjoyNjo0OFrOF1yDUw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQyMjoyODoxNFrOF1yFOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTkzODg5OQ==", "bodyText": "Should this method be something that lives in Utility class. Taking in a boolean of whether to move or delete and the name\ne.g.\npublic void moveOrDeleteParsedFile(boolean move, String fileName) {\n        if (moved) {\n             Utility.moveFileToParsedDir(fileName, \"/parsedBalanceFiles/\");\n         } else {\n             Utility.deleteParsedFile(fileName);\n         }\n}\n\nThat way The FileParser classes only have to call\n\nUtility. moveOrDeleteParsedFile(parserProperties.isKeepFiles(), PARSED_DIR)", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/596#discussion_r391938899", "createdAt": "2020-03-12T22:26:48Z", "author": {"login": "Nana-EC"}, "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/balance/BalanceFileParser.java", "diffHunk": "@@ -97,23 +94,26 @@ private void processAllFilesForHistory() {\n \n     private void processLastBalanceFile() {\n         Stopwatch stopwatch = Stopwatch.createStarted();\n-\n         try {\n             File balanceFile = getLatestBalanceFile();\n-\n             if (balanceFile == null) {\n                 return;\n             }\n-\n             log.debug(\"Processing last balance file {}\", balanceFile);\n-\n             if (new AccountBalancesFileLoader((BalanceParserProperties) parserProperties, balanceFile.toPath())\n                     .loadAccountBalances()) {\n-                // move it\n-                Utility.moveFileToParsedDir(balanceFile.getCanonicalPath(), \"/parsedBalanceFiles/\");\n+                moveOrDeleteParsedFile(balanceFile.getCanonicalPath());\n             }\n         } catch (Exception e) {\n             log.error(\"Error processing balances files after {}\", stopwatch, e);\n         }\n     }\n+\n+    private void moveOrDeleteParsedFile(String fileName) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "42875c07c680e23a2f61c46f04ade38e571808bd"}, "originalPosition": 46}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTkzOTM4NQ==", "bodyText": "The code defaults to true but this file says it's false. You should clarify which one is right. I think we're going for false by default now no?", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/596#discussion_r391939385", "createdAt": "2020-03-12T22:28:14Z", "author": {"login": "Nana-EC"}, "path": "docs/configuration.md", "diffHunk": "@@ -114,10 +114,13 @@ value, it is recommended to only populate overridden properties in the custom `a\n | `hedera.mirror.parser.balance.batchSize`                   | 2000                    | The number of balances to insert before committing                                             |\n | `hedera.mirror.parser.balance.enabled`                     | true                    | Whether to enable balance file parsing                                                         |\n | `hedera.mirror.parser.balance.fileBufferSize`              | 200000                  | The size of the buffer to use when reading in the balance file                                 |\n+| `hedera.mirror.parser.balance.keepFiles`                   | false                   | Whether to keep parsed files after successful parsing. If false, files are deleted.            |", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "42875c07c680e23a2f61c46f04ade38e571808bd"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e6fe9a91f3fbc375fb77a8c820994e93dc57080c", "author": {"user": {"login": "apeksharma", "name": "Apekshit Sharma"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/e6fe9a91f3fbc375fb77a8c820994e93dc57080c", "committedDate": "2020-03-12T22:41:16Z", "message": "Configuration to delete parsed files\n\nSigned-off-by: Apekshit Sharma <apekshit.sharma@hedera.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fad5d48b06c80f6d1103625b127418292c4c4f19", "author": {"user": {"login": "apeksharma", "name": "Apekshit Sharma"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/fad5d48b06c80f6d1103625b127418292c4c4f19", "committedDate": "2020-03-12T23:36:20Z", "message": "address reviews\n\nSigned-off-by: Apekshit Sharma <apekshit.sharma@hedera.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "42875c07c680e23a2f61c46f04ade38e571808bd", "author": {"user": {"login": "apeksharma", "name": "Apekshit Sharma"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/42875c07c680e23a2f61c46f04ade38e571808bd", "committedDate": "2020-03-12T21:40:41Z", "message": "Configuration to delete parsed files\n\nSigned-off-by: Apekshit Sharma <apekshit.sharma@hedera.com>"}, "afterCommit": {"oid": "fad5d48b06c80f6d1103625b127418292c4c4f19", "author": {"user": {"login": "apeksharma", "name": "Apekshit Sharma"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/fad5d48b06c80f6d1103625b127418292c4c4f19", "committedDate": "2020-03-12T23:36:20Z", "message": "address reviews\n\nSigned-off-by: Apekshit Sharma <apekshit.sharma@hedera.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0NDA2NzQy", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/596#pullrequestreview-374406742", "createdAt": "2020-03-13T15:44:28Z", "commit": {"oid": "fad5d48b06c80f6d1103625b127418292c4c4f19"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3322, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}