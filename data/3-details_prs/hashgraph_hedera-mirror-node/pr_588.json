{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg2MzI3MTk2", "number": 588, "title": "Slight performance and acceptance test improvements and corrections", "bodyText": "Detailed description:\nMinor improvements in a few files and some spelling corrections.\n\nUpdated SingleTopicHCClient to support now() subscribe time for incoming messages scenario.\nUpdated HCSSamplerResult to note when last message was received and log this on success/failure. This helps when a stalled client is encountered\nSpelling corrections in README and jmx files\nRemoved subscribe test parameters from jmx files as these were moved to user.properties\nUpdated hcs.feature @subscribeonly scenario to support specifying start time\n\nSpecial notes for your reviewer:\nThe JMeter layout is still in transition. For subscribe scenarios the test properties are in user.properties. For db related properties that populate or cleanup these are still in imx files.\nAlso number of threads specification is still done in imx files.\nIn a future ticket we'd want to explore using a yaml file instead to capture everything.\nThere's also some room to see if a non-jmeter option exists for performance that will allow for use within the modules and not force coupling.\nChecklist\n\n Documentation added\n Tests updated", "createdAt": "2020-03-10T19:39:35Z", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/588", "merged": true, "mergeCommit": {"oid": "74fa36b13968369ed6fac7d83064c2e54849643d"}, "closed": true, "closedAt": "2020-03-11T20:53:08Z", "author": {"login": "Nana-EC"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcMXJ9UAH2gAyMzg2MzI3MTk2OmY5ZmI5MWVmYjBjYTI0YjcyMmM1MWY5Mjk2ODJiNGMyMmY2ZGFjODQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcMtfLCgFqTM3MzExNzE4Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f9fb91efb0ca24b722c51f929682b4c22f6dac84", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/f9fb91efb0ca24b722c51f929682b4c22f6dac84", "committedDate": "2020-03-10T18:51:52Z", "message": "Slight performance and acceptants test improvements and corrections\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2f45bd96fdb0de4514195ef4a223acf7a6053c95", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/2f45bd96fdb0de4514195ef4a223acf7a6053c95", "committedDate": "2020-03-10T20:15:43Z", "message": "Shorten error message and undo assert time change\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "184587d65ff9411aecf50e5bebe149a411ced405", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/184587d65ff9411aecf50e5bebe149a411ced405", "committedDate": "2020-03-10T20:59:37Z", "message": "Moved subscribe error to complete message\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyODQ0ODAw", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/588#pullrequestreview-372844800", "createdAt": "2020-03-11T15:03:40Z", "commit": {"oid": "184587d65ff9411aecf50e5bebe149a411ced405"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxNTowMzo0MFrOF07C-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQxNToxMDo0NFrOF07XBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTAzNzY5MQ==", "bodyText": "Negative for now() is a bit weird. I would suggest changing it to boxed type and allowing null for now:\nLong startTime = propHandler.getLongClientTestParam(\"StartTime\", 0, null);", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/588#discussion_r391037691", "createdAt": "2020-03-11T15:03:40Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-grpc/src/test/java/com/hedera/mirror/grpc/jmeter/client/SingleTopicHCSClient.java", "diffHunk": "@@ -63,11 +64,20 @@ public void setupTest(JavaSamplerContext context) {\n         int port = propHandler.getIntTestParam(\"port\", \"5600\");\n         boolean sharedChannel = Boolean.valueOf(propHandler.getTestParam(\"sharedChannel\", \"false\"));\n         long startTime = propHandler.getLongClientTestParam(\"StartTime\", 0, \"0\");\n+        int nanoStartTime = 0;\n+\n+        // allow for subscribe from now\n+        if (startTime < 0) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "184587d65ff9411aecf50e5bebe149a411ced405"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTAzOTA3MQ==", "bodyText": "Should be \"failed: \" to avoid concatenating without a space in between", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/588#discussion_r391039071", "createdAt": "2020-03-11T15:05:35Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-grpc/src/test/java/com/hedera/mirror/grpc/jmeter/sampler/result/HCSSamplerResult.java", "diffHunk": "@@ -71,13 +73,15 @@ public void onNext(T result) {\n     }\n \n     public void onComplete() {\n-        log.info(\"Observed {} historic and {} incoming messages in {} ({}/s): {}\", historicalMessageCount,\n-                incomingMessageCount, stopwatch, getMessageRate(), success ? \"success\" : \"failed\");\n+        String errorMessage = subscribeError == null ? \"\" : \" : with \" + subscribeError.getMessage();\n+        log.info(\"Observed {} historic and {} incoming messages in {} ({}/s): {}. Last message received {} ago\",\n+                historicalMessageCount,\n+                incomingMessageCount, stopwatch, getMessageRate(), success ? \"success\" :\n+                        \"failed\" + errorMessage, lastMessage);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "184587d65ff9411aecf50e5bebe149a411ced405"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTA0MDY4MQ==", "bodyText": "Succes/failure with error should be at end of message.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/588#discussion_r391040681", "createdAt": "2020-03-11T15:07:50Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-grpc/src/test/java/com/hedera/mirror/grpc/jmeter/sampler/result/HCSSamplerResult.java", "diffHunk": "@@ -71,13 +73,15 @@ public void onNext(T result) {\n     }\n \n     public void onComplete() {\n-        log.info(\"Observed {} historic and {} incoming messages in {} ({}/s): {}\", historicalMessageCount,\n-                incomingMessageCount, stopwatch, getMessageRate(), success ? \"success\" : \"failed\");\n+        String errorMessage = subscribeError == null ? \"\" : \" : with \" + subscribeError.getMessage();\n+        log.info(\"Observed {} historic and {} incoming messages in {} ({}/s): {}. Last message received {} ago\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "184587d65ff9411aecf50e5bebe149a411ced405"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTA0MjgyMw==", "bodyText": "Should use normal English for scenario. Also should use timestamp in place of date:\nAnd I provide a starting timestamp <startTimestamp>", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/588#discussion_r391042823", "createdAt": "2020-03-11T15:10:44Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-test/src/test/resources/features/hcs/hcs.feature", "diffHunk": "@@ -26,12 +26,12 @@ Feature: HCS Base Coverage Feature\n     @SubscribeOnly @Acceptance\n     Scenario Outline: Validate topic message subscription only\n         Given I provide a topic id <topicId>\n-        When I provide a number of messages <numMessages> I want to receive\n-        And I subscribe with a filter to retrieve messages\n+        And I provide a startDate <startDate> and a number of messages <numMessages> I want to receive", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "184587d65ff9411aecf50e5bebe149a411ced405"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "57a7f7680bff9585aece5dcade8b30f683c33db8", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/57a7f7680bff9585aece5dcade8b30f683c33db8", "committedDate": "2020-03-11T20:05:26Z", "message": "Updated PropertiesHandler to support nullable Long and Int types. Updated Sampler result logs and BDD feature test names to read better\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczMDk4NDQx", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/588#pullrequestreview-373098441", "createdAt": "2020-03-11T20:22:50Z", "commit": {"oid": "57a7f7680bff9585aece5dcade8b30f683c33db8"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQyMDoyMjo1MFrOF1Hzgg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMVQyMDoyMjo1MFrOF1Hzgg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTI0NjcyMg==", "bodyText": "imo, nanos precision seems unnecessary. Or maybe am missing some nuance?\n(just a note, not changes needed)", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/588#discussion_r391246722", "createdAt": "2020-03-11T20:22:50Z", "author": {"login": "apeksharma"}, "path": "hedera-mirror-grpc/src/test/java/com/hedera/mirror/grpc/jmeter/client/SingleTopicHCSClient.java", "diffHunk": "@@ -60,18 +60,27 @@ private static synchronized void setChannel(String host, int port) {\n     public void setupTest(JavaSamplerContext context) {\n         propHandler = new PropertiesHandler(context);\n         String host = propHandler.getTestParam(\"host\", \"localhost\");\n-        int port = propHandler.getIntTestParam(\"port\", \"5600\");\n+        int port = propHandler.getIntTestParam(\"port\", 5600);\n         boolean sharedChannel = Boolean.valueOf(propHandler.getTestParam(\"sharedChannel\", \"false\"));\n-        long startTime = propHandler.getLongClientTestParam(\"StartTime\", 0, \"0\");\n-        long endTimeSecs = propHandler.getLongClientTestParam(\"EndTime\", 0, \"0\");\n-        long limit = propHandler.getLongClientTestParam(\"Limit\", 0, \"100\");\n+        Long startTime = propHandler.getLongClientTestParam(\"StartTime\", 0, null);\n+        int nanoStartTime = 0;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "57a7f7680bff9585aece5dcade8b30f683c33db8"}, "originalPosition": 30}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczMTE3MTg2", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/588#pullrequestreview-373117186", "createdAt": "2020-03-11T20:52:57Z", "commit": {"oid": "57a7f7680bff9585aece5dcade8b30f683c33db8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3313, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}