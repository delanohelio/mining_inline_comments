{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE4NjA3MjIx", "number": 1254, "title": "Refactor importer to handle token transfers in crypto transfer", "bodyText": "Detailed description:\nAs a result of hedera-services 718, token transfers no longer exist as their own transaction, and instead are handled in crypto transfers.  Furthermore, hedera-services 756 has altered TokenUpdates in ways that break the current mirror node implementation. These code changes will allow the mirror node to consume token transfers and token updates in the new format.\n\n\nRemove references to TokenTransfers proto and related methods\n\n\nAlter EntityRecordItemListener to look for Crypto Transfer to populate token transfers\n\n\nAlter REST transaction queries to join token_transfers table on transaction type 14 (crypto transfer)\n\n\nRefactor Token autoRenewal, expiry, and tokenID usage to reflect the changes to the protobuf\n\n\nAdd a migration to drop the TOKENTRANSFERS transaction type\n\n\nUpdate tests and documentation\n\n\nWhich issue(s) this PR fixes:\nFixes #1176\nFixes #1256\nSpecial notes for your reviewer:\nChecklist\n\n Documentation added\n Tests updated", "createdAt": "2020-11-10T16:22:57Z", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1254", "merged": true, "mergeCommit": {"oid": "4cd345c282fc81a9dd15a5f1b0322bd134314d54"}, "closed": true, "closedAt": "2020-11-16T16:53:32Z", "author": {"login": "ijungmann"}, "timelineItems": {"totalCount": 27, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdbLxIwgH2gAyNTE4NjA3MjIxOjg3MjQwYzNkZDUxZWY1OTNmOGQ5Zjk1Zjk3ZjIyNDljZmMyZWJjYjM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABddHzfcgFqTUzMTUwNzA2MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "87240c3dd51ef593f8d9f95f97f2249cfc2ebcb3", "author": {"user": {"login": "ijungmann", "name": "Ian Jungmann"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/87240c3dd51ef593f8d9f95f97f2249cfc2ebcb3", "committedDate": "2020-11-10T16:15:49Z", "message": "Refactor importer to handle token transfers in crypto transfer\n\nSigned-off-by: Ian Jungmann <ian.jungmann@hedera.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8e3f64829e472a81ea5eb5aa0c0c8beba36dc8f7", "author": {"user": {"login": "ijungmann", "name": "Ian Jungmann"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/8e3f64829e472a81ea5eb5aa0c0c8beba36dc8f7", "committedDate": "2020-11-11T06:40:27Z", "message": "Rework token transfer handling\n\nSigned-off-by: Ian Jungmann <ian.jungmann@hedera.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "899e63a578927ca95a957a1c864164d9780f9ba3", "author": {"user": {"login": "ijungmann", "name": "Ian Jungmann"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/899e63a578927ca95a957a1c864164d9780f9ba3", "committedDate": "2020-11-11T06:42:17Z", "message": "Change transactions.js query for token transfers, and fix tests\n\nSigned-off-by: Ian Jungmann <ian.jungmann@hedera.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "95f8b86431324adc03b12488d73bf710e2034c67", "author": {"user": {"login": "ijungmann", "name": "Ian Jungmann"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/95f8b86431324adc03b12488d73bf710e2034c67", "committedDate": "2020-11-11T21:04:34Z", "message": "Revert entity listener token test to only validate tokens\n\nSigned-off-by: Ian Jungmann <ian.jungmann@hedera.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b6f119c4d96ce4c6088f1fa5ab62c648d635f43", "author": {"user": {"login": "ijungmann", "name": "Ian Jungmann"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/5b6f119c4d96ce4c6088f1fa5ab62c648d635f43", "committedDate": "2020-11-11T21:14:27Z", "message": "Add migration to delete token transfers transaction type\n\nSigned-off-by: Ian Jungmann <ian.jungmann@hedera.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e7b8249f86bae261dab3c355d6092e7c715cc6c9", "author": {"user": {"login": "ijungmann", "name": "Ian Jungmann"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/e7b8249f86bae261dab3c355d6092e7c715cc6c9", "committedDate": "2020-11-11T22:25:24Z", "message": "Update docs first draft\n\nSigned-off-by: Ian Jungmann <ian.jungmann@hedera.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d84b70cce3417d8ce1437771e3dd94fca06d618", "author": {"user": {"login": "ijungmann", "name": "Ian Jungmann"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/3d84b70cce3417d8ce1437771e3dd94fca06d618", "committedDate": "2020-11-12T00:24:01Z", "message": "Rework rest integration tests to be closer to original intent\n\nSigned-off-by: Ian Jungmann <ian.jungmann@hedera.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ffed69d37d94c5d108bacb4b8245167b2d105619", "author": {"user": {"login": "ijungmann", "name": "Ian Jungmann"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/ffed69d37d94c5d108bacb4b8245167b2d105619", "committedDate": "2020-11-12T00:29:20Z", "message": "Add a comment to record item listener\n\nSigned-off-by: Ian Jungmann <ian.jungmann@hedera.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI4NzY0OTcy", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1254#pullrequestreview-528764972", "createdAt": "2020-11-12T05:44:43Z", "commit": {"oid": "ffed69d37d94c5d108bacb4b8245167b2d105619"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQwNTo0NDo0NFrOHxrZAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQwNjowNDo1MVrOHxrv5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTg1MzE4Nw==", "bodyText": "We implemented a convention a few sprints back of using a new minor version on new sprints.\nSo this should be V1.31.1 - just like my PR :)\nWe'll see whoever gets in first.\nThe other person just has to update their version, due to flyway checksum since we can't skip versions.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1254#discussion_r521853187", "createdAt": "2020-11-12T05:44:44Z", "author": {"login": "Nana-EC"}, "path": "hedera-mirror-importer/src/main/resources/db/migration/V1.32.0__delete_token_transfers_transaction_type.sql", "diffHunk": "@@ -0,0 +1,6 @@\n+-------------------\n+-- delete token transfers transaction type", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ffed69d37d94c5d108bacb4b8245167b2d105619"}, "originalPosition": 2}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTg1OTA0NA==", "bodyText": "Shouldn't we move the addTokenTransferTransaction() logic into addCryptoTransaction()?\naddCryptoTransaction() does a check for 'transfers' so the equivalent would be a check for tokenTransfers.\nThe result would be the json setup would no longer use the tokenTransfers[] and both crypto and token transfers would be under cryptoTransfers[].\nUnless I'm missing something as is a single crypto transfer with both crypto and token transfer would end up getting represented as 2 transactions instead of 1.\nconst addCryptoTransaction = async (cryptoTransfer) => {\n  if (!('senderAccountId' in cryptoTransfer)) {\n    cryptoTransfer.senderAccountId = cryptoTransfer.payerAccountId;\n  }\n\n  if (!('transfers' in cryptoTransfer)) {\n    cryptoTransfer.transfers = [\n      {account: cryptoTransfer.senderAccountId, amount: -NETWORK_FEE - cryptoTransfer.amount},\n      {account: cryptoTransfer.recipientAccountId, amount: cryptoTransfer.amount},\n      {account: cryptoTransfer.treasuryAccountId, amount: NETWORK_FEE},\n    ];\n  }\n  if (!('tokenTransfers' in cryptoTransfer)) {\n    cryptoTransfer.tokenTransfer = [\n    {account: tokenTransfer.payerAccountId, amount: -NETWORK_FEE - NODE_FEE},\n    {account: tokenTransfer.treasuryAccountId, amount: NETWORK_FEE},\n    {account: tokenTransfer.nodeAccountId, amount: NODE_FEE},\n    ];\n  }\n  await addTransaction(cryptoTransfer);\n};\n\nYou'd also have to updated addTransaction()\nWhat do you think?", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1254#discussion_r521859044", "createdAt": "2020-11-12T06:04:51Z", "author": {"login": "Nana-EC"}, "path": "hedera-mirror-rest/__tests__/integrationDomainOps.js", "diffHunk": "@@ -295,7 +295,6 @@ const addTokenTransferTransaction = async (tokenTransfer) => {\n     {account: tokenTransfer.treasuryAccountId, amount: NETWORK_FEE},", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ffed69d37d94c5d108bacb4b8245167b2d105619"}, "originalPosition": 1}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI5NDUwOTU5", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1254#pullrequestreview-529450959", "createdAt": "2020-11-12T20:04:08Z", "commit": {"oid": "ffed69d37d94c5d108bacb4b8245167b2d105619"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQyMDowNDowOFrOHyMAsA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMlQyMDowNDowOFrOHyMAsA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjM4NzYzMg==", "bodyText": "Should this be 0.9.0-rc.2?", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1254#discussion_r522387632", "createdAt": "2020-11-12T20:04:08Z", "author": {"login": "steven-sheehy"}, "path": "pom.xml", "diffHunk": "@@ -62,7 +62,7 @@\n         <embedded.testcontainers.version>1.85</embedded.testcontainers.version>\n         <grpc-spring-boot.version>2.10.1.RELEASE</grpc-spring-boot.version>\n         <grpc.version>1.33.1</grpc.version>\n-        <hedera-protobuf.version>0.9.0-alpha5</hedera-protobuf.version>\n+        <hedera-protobuf.version>0.9.0-alpha.6</hedera-protobuf.version>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ffed69d37d94c5d108bacb4b8245167b2d105619"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1609cc38e9fb618a37cb4789406430847c84e147", "author": {"user": {"login": "ijungmann", "name": "Ian Jungmann"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/1609cc38e9fb618a37cb4789406430847c84e147", "committedDate": "2020-11-12T21:31:57Z", "message": "Bump protobuf to 0.9.0-rc.2\n\nSigned-off-by: Ian Jungmann <ian.jungmann@hedera.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dbca7d7f5af154559989a46267a3e171ac9efa37", "author": {"user": {"login": "ijungmann", "name": "Ian Jungmann"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/dbca7d7f5af154559989a46267a3e171ac9efa37", "committedDate": "2020-11-12T21:35:01Z", "message": "Merge branch 'master' into support-token-transfer-in-crypto-transfer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8558c70b3b64c3fc72719d3b4c046ab15308d183", "author": {"user": {"login": "ijungmann", "name": "Ian Jungmann"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/8558c70b3b64c3fc72719d3b4c046ab15308d183", "committedDate": "2020-11-12T21:54:48Z", "message": "Rename delete token transfer migration\n\nSigned-off-by: Ian Jungmann <ian.jungmann@hedera.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7ddc0b541518e91dc6d73c67361a2d98e13a71a4", "author": {"user": {"login": "ijungmann", "name": "Ian Jungmann"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/7ddc0b541518e91dc6d73c67361a2d98e13a71a4", "committedDate": "2020-11-13T00:24:28Z", "message": "Refactor REST tests to not have separate tokenTransfers section\n\nSigned-off-by: Ian Jungmann <ian.jungmann@hedera.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "99be1e1358a5b4a42d146e58a30473b9ce617e5d", "author": {"user": {"login": "ijungmann", "name": "Ian Jungmann"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/99be1e1358a5b4a42d146e58a30473b9ce617e5d", "committedDate": "2020-11-13T00:42:46Z", "message": "Rework integration tests further\n\nSigned-off-by: Ian Jungmann <ian.jungmann@hedera.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ac0e733d941f6bf3e6d8447218725262d31e4751", "author": {"user": {"login": "ijungmann", "name": "Ian Jungmann"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/ac0e733d941f6bf3e6d8447218725262d31e4751", "committedDate": "2020-11-13T00:55:05Z", "message": "Fix test\n\nSigned-off-by: Ian Jungmann <ian.jungmann@hedera.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "40e3c0f9948660c1374911f86d8bdbbffd278782", "author": {"user": {"login": "ijungmann", "name": "Ian Jungmann"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/40e3c0f9948660c1374911f86d8bdbbffd278782", "committedDate": "2020-11-13T04:06:11Z", "message": "Fix pubsub messages file for test\n\nSigned-off-by: Ian Jungmann <ian.jungmann@hedera.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwMjg0MTkz", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1254#pullrequestreview-530284193", "createdAt": "2020-11-13T17:56:08Z", "commit": {"oid": "40e3c0f9948660c1374911f86d8bdbbffd278782"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QxNzo1NjowOFrOHy5IPA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xM1QxNzo1ODoxMFrOHy5MaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzEyNjg0NA==", "bodyText": "remove left over console  log", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1254#discussion_r523126844", "createdAt": "2020-11-13T17:56:08Z", "author": {"login": "Nana-EC"}, "path": "hedera-mirror-rest/transactions.js", "diffHunk": "@@ -96,6 +96,7 @@ const createTransferLists = (rows) => {\n   const transactions = {};\n \n   for (const row of rows) {\n+    console.log(row);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "40e3c0f9948660c1374911f86d8bdbbffd278782"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzEyNzkxMg==", "bodyText": "nit. We should have done this previously but could you make this a constant\nconst cryptoTransferTransactionType =14 and use here and below\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                     ON t.type = 14\n          \n          \n            \n                     ON t.type = ${cryptoTransferTransactionType}", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1254#discussion_r523127912", "createdAt": "2020-11-13T17:58:10Z", "author": {"login": "Nana-EC"}, "path": "hedera-mirror-rest/transactions.js", "diffHunk": "@@ -152,7 +153,7 @@ const getTransactionsOuterQuery = function (innerQuery, order) {\n        LEFT OUTER JOIN t_transaction_types ttt ON ttt.proto_id = t.type\n        JOIN crypto_transfer ctl ON tlist.consensus_timestamp = ctl.consensus_timestamp\n        LEFT OUTER JOIN token_transfer ttl\n-         ON t.type = 30\n+         ON t.type = 14", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "40e3c0f9948660c1374911f86d8bdbbffd278782"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "62f0653469342879f86efe75c831edd2c6d57213", "author": {"user": {"login": "ijungmann", "name": "Ian Jungmann"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/62f0653469342879f86efe75c831edd2c6d57213", "committedDate": "2020-11-13T20:36:08Z", "message": "Refactor transactions.js\n\nSigned-off-by: Ian Jungmann <ian.jungmann@hedera.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "08d7e81a11f649d2bad027db37332e626db69583", "author": {"user": {"login": "ijungmann", "name": "Ian Jungmann"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/08d7e81a11f649d2bad027db37332e626db69583", "committedDate": "2020-11-16T02:00:58Z", "message": "Bump to rc.3 for java version\n\nSigned-off-by: Ian Jungmann <ian.jungmann@hedera.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "00f8f47f8ac63d43e9350ad305e4c3788d0148f6", "author": {"user": {"login": "ijungmann", "name": "Ian Jungmann"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/00f8f47f8ac63d43e9350ad305e4c3788d0148f6", "committedDate": "2020-11-16T02:56:38Z", "message": "Update expiry, autorenewal, and tokenID fields in tokens for 0.9.0\n\nSigned-off-by: Ian Jungmann <ian.jungmann@hedera.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3def1b95286628b5ce9ca8b75be663f48a1e4077", "author": {"user": {"login": "ijungmann", "name": "Ian Jungmann"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/3def1b95286628b5ce9ca8b75be663f48a1e4077", "committedDate": "2020-11-16T06:00:24Z", "message": "Fix other transaction query\n\nSigned-off-by: Ian Jungmann <ian.jungmann@hedera.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxNDE5NDMy", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1254#pullrequestreview-531419432", "createdAt": "2020-11-16T15:18:27Z", "commit": {"oid": "00f8f47f8ac63d43e9350ad305e4c3788d0148f6"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxNToxODoyOFrOH0DeIQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNlQxNToyODo1M1rOH0D9Hw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDM0NDg2NQ==", "bodyText": "Wrong time unit. Use Utility.timestampInNanosMax()", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1254#discussion_r524344865", "createdAt": "2020-11-16T15:18:28Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/record/transactionhandler/TokenUpdateTransactionsHandler.java", "diffHunk": "@@ -48,12 +48,12 @@ public void updateEntity(Entities entity, RecordItem recordItem) {\n             entity.setKey(tokenUpdateTransactionBody.getAdminKey().toByteArray());\n         }\n \n-        if (tokenUpdateTransactionBody.getAutoRenewPeriod() != 0) {\n-            entity.setAutoRenewPeriod(tokenUpdateTransactionBody.getAutoRenewPeriod());\n+        if (tokenUpdateTransactionBody.hasAutoRenewPeriod()) {\n+            entity.setAutoRenewPeriod(tokenUpdateTransactionBody.getAutoRenewPeriod().getSeconds());\n         }\n \n-        if (tokenUpdateTransactionBody.getExpiry() != 0) {\n-            entity.setExpiryTimeNs(tokenUpdateTransactionBody.getExpiry());\n+        if (tokenUpdateTransactionBody.hasExpiry()) {\n+            entity.setExpiryTimeNs(tokenUpdateTransactionBody.getExpiry().getSeconds());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "00f8f47f8ac63d43e9350ad305e4c3788d0148f6"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDM1Mjc5OQ==", "bodyText": "Wrong time unit. Use Utility.timestampInNanosMax()", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1254#discussion_r524352799", "createdAt": "2020-11-16T15:28:53Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/record/transactionhandler/TokenCreateTransactionsHandler.java", "diffHunk": "@@ -48,12 +48,12 @@ public void updateEntity(Entities entity, RecordItem recordItem) {\n             entity.setKey(tokenCreateTransactionBody.getAdminKey().toByteArray());\n         }\n \n-        if (tokenCreateTransactionBody.getAutoRenewPeriod() != 0) {\n-            entity.setAutoRenewPeriod(tokenCreateTransactionBody.getAutoRenewPeriod());\n+        if (tokenCreateTransactionBody.hasAutoRenewPeriod()) {\n+            entity.setAutoRenewPeriod(tokenCreateTransactionBody.getAutoRenewPeriod().getSeconds());\n         }\n \n-        if (tokenCreateTransactionBody.getExpiry() != 0) {\n-            entity.setExpiryTimeNs(tokenCreateTransactionBody.getExpiry());\n+        if (tokenCreateTransactionBody.hasExpiry()) {\n+            entity.setExpiryTimeNs(tokenCreateTransactionBody.getExpiry().getSeconds());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "00f8f47f8ac63d43e9350ad305e4c3788d0148f6"}, "originalPosition": 22}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "93ccd795fcfabf6edb3153fd6fdfc87f23b55e0a", "author": {"user": {"login": "ijungmann", "name": "Ian Jungmann"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/93ccd795fcfabf6edb3153fd6fdfc87f23b55e0a", "committedDate": "2020-11-16T15:55:48Z", "message": "Fix wrong time unit on expiry\n\nSigned-off-by: Ian Jungmann <ian.jungmann@hedera.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bb172d8c39e6167e178a3b8714a113d7a6b82ae2", "author": {"user": {"login": "ijungmann", "name": "Ian Jungmann"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/bb172d8c39e6167e178a3b8714a113d7a6b82ae2", "committedDate": "2020-11-16T16:00:57Z", "message": "Fix wrong time unit on expiry\n\nSigned-off-by: Ian Jungmann <ian.jungmann@hedera.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxNDY0OTEw", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1254#pullrequestreview-531464910", "createdAt": "2020-11-16T16:03:16Z", "commit": {"oid": "bb172d8c39e6167e178a3b8714a113d7a6b82ae2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxNTA3MDYw", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1254#pullrequestreview-531507060", "createdAt": "2020-11-16T16:46:37Z", "commit": {"oid": "bb172d8c39e6167e178a3b8714a113d7a6b82ae2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3505, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}