{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEwOTMzMzgy", "number": 726, "title": "Added running_hash_version migration", "bodyText": "Detailed description:\nThe r5-rc4 update contained a few changes and additions.\nThis change\n\nAdds the running_hash_version column to the topic_message table\nSets running_hash_version of topic_message table if null. Based on comparison of consensus_timestamp with r5-rc4 deployDate it will be set to default\nSets default running hash version as configureable value\n\nWhich issue(s) this PR fixes:\nFixes #688\nSpecial notes for your reviewer:\nRan migration locally to verify cases of\n\nNo running_hash_version with messages pre and post deploy date\nrunning_hash_version column present with empty values\nrunning_hash_version column present and set\n\nChecklist\n\n Documentation added\n Tests updated", "createdAt": "2020-04-29T20:23:26Z", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/726", "merged": true, "mergeCommit": {"oid": "a6415cbf20bd7d3ce7b27a741d758be3aefc2e27"}, "closed": true, "closedAt": "2020-04-30T02:21:02Z", "author": {"login": "Nana-EC"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcceW_3AH2gAyNDEwOTMzMzgyOjIwNzgwOWFhMDJiNDQxOTU0M2RjOTc5ZWNjM2FhY2ZhNGM4ZWRhYmY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABccj72ugFqTQwMzE1NTg2Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "207809aa02b4419543dc979ecc3aacfa4c8edabf", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/207809aa02b4419543dc979ecc3aacfa4c8edabf", "committedDate": "2020-04-29T20:18:14Z", "message": "Migrate db to add runningHashVersion\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzMDI4NDE0", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/726#pullrequestreview-403028414", "createdAt": "2020-04-29T20:50:19Z", "commit": {"oid": "207809aa02b4419543dc979ecc3aacfa4c8edabf"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQyMDo1MDoxOVrOGOQdnw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQyMDo1MTowOFrOGOQfVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzYwMjk3NQ==", "bodyText": "Thinking of maybe changing this to 'hedera.service.v05-deployDate' & 'hedera.service.runningHashDefaultVersion'", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/726#discussion_r417602975", "createdAt": "2020-04-29T20:50:19Z", "author": {"login": "Nana-EC"}, "path": "docs/configuration.md", "diffHunk": "@@ -68,6 +68,8 @@ value, it is recommended to only populate overridden properties in the custom `a\n | `hedera.mirror.importer.parser.record.persist.nonFeeTransfers`       | false                   | Persist non-fee transfers for transactions that explicitly request hbar transfers              |\n | `hedera.mirror.importer.parser.record.persist.systemFiles`           | true                    | Persist only system files (number lower than `1000`) to the database                           |\n | `hedera.mirror.importer.parser.record.persist.transactionBytes`      | false                   | Persist raw transaction bytes to the database                                                  |\n+| `hedera.mirror.importer.r5-rc4-deployDate`                           | 1588636800000000001     | The deployment date of the r5-rc4 version which introduced the running hash version            |", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "207809aa02b4419543dc979ecc3aacfa4c8edabf"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzYwMzQxMg==", "bodyText": "Will remove to ensure it's correctly set at deployment time. Will leave tests", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/726#discussion_r417603412", "createdAt": "2020-04-29T20:51:08Z", "author": {"login": "Nana-EC"}, "path": "hedera-mirror-importer/src/main/resources/application.yml", "diffHunk": "@@ -9,6 +9,9 @@ hedera:\n         restPassword: mirror_api_pass\n         restUsername: mirror_api\n         username: mirror_node\n+      # service r5-rc4 deployDate in consensus_timestamp format e.g. 1588636800000000001, must be set for v1.23.1 migration\n+      r5-rc4-deployDate: 1588636800000000001", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "207809aa02b4419543dc979ecc3aacfa4c8edabf"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzMDI0Mzcx", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/726#pullrequestreview-403024371", "createdAt": "2020-04-29T20:44:29Z", "commit": {"oid": "207809aa02b4419543dc979ecc3aacfa4c8edabf"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQyMDo0NDozMFrOGOQRXg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQyMTowMzozNVrOGOQ55Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzU5OTgzOA==", "bodyText": "I don't think a runningHashDefaultVersion provides any value. I assume it was added in case a 3rd party runs this much later when a runningHashVersion=3+ is available? But in that case the migration logic is wrong either way as it doesn't differentiate v2 from v3 rows properly.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/726#discussion_r417599838", "createdAt": "2020-04-29T20:44:30Z", "author": {"login": "steven-sheehy"}, "path": "docs/configuration.md", "diffHunk": "@@ -68,6 +68,8 @@ value, it is recommended to only populate overridden properties in the custom `a\n | `hedera.mirror.importer.parser.record.persist.nonFeeTransfers`       | false                   | Persist non-fee transfers for transactions that explicitly request hbar transfers              |\n | `hedera.mirror.importer.parser.record.persist.systemFiles`           | true                    | Persist only system files (number lower than `1000`) to the database                           |\n | `hedera.mirror.importer.parser.record.persist.transactionBytes`      | false                   | Persist raw transaction bytes to the database                                                  |\n+| `hedera.mirror.importer.r5-rc4-deployDate`                           | 1588636800000000001     | The deployment date of the r5-rc4 version which introduced the running hash version            |\n+| `hedera.mirror.importer.runningHashDefaultVersion`                   | 2                       | The default running hash version used by service. Is 2 as of r5-rc4                            |", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "207809aa02b4419543dc979ecc3aacfa4c8edabf"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzYwMzE1Mw==", "bodyText": "Should be named after the field being added and not the release name. Maybe hedera.mirror.importer.runningHashVersionAdded. Comments should mention it's a Unix timestamp not a date. Not sure default needs to be nanosecond resolution.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/726#discussion_r417603153", "createdAt": "2020-04-29T20:50:41Z", "author": {"login": "steven-sheehy"}, "path": "docs/configuration.md", "diffHunk": "@@ -68,6 +68,8 @@ value, it is recommended to only populate overridden properties in the custom `a\n | `hedera.mirror.importer.parser.record.persist.nonFeeTransfers`       | false                   | Persist non-fee transfers for transactions that explicitly request hbar transfers              |\n | `hedera.mirror.importer.parser.record.persist.systemFiles`           | true                    | Persist only system files (number lower than `1000`) to the database                           |\n | `hedera.mirror.importer.parser.record.persist.transactionBytes`      | false                   | Persist raw transaction bytes to the database                                                  |\n+| `hedera.mirror.importer.r5-rc4-deployDate`                           | 1588636800000000001     | The deployment date of the r5-rc4 version which introduced the running hash version            |", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "207809aa02b4419543dc979ecc3aacfa4c8edabf"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzYwNDEyOQ==", "bodyText": "alter table if exists", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/726#discussion_r417604129", "createdAt": "2020-04-29T20:52:24Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-importer/src/main/resources/db/migration/V1.23.1__add_topicmessage_runninghashversion.sql", "diffHunk": "@@ -0,0 +1,5 @@\n+-- add the running_hash_version column conditionally\n+alter table topic_message add column if not exists running_hash_version smallint null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "207809aa02b4419543dc979ecc3aacfa4c8edabf"}, "originalPosition": 2}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzYwNDMwOQ==", "bodyText": "int like the schema", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/726#discussion_r417604309", "createdAt": "2020-04-29T20:52:43Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/domain/TopicMessage.java", "diffHunk": "@@ -44,4 +44,6 @@\n     private long sequenceNumber;\n \n     private int topicNum;\n+\n+    private long runningHashVersion;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "207809aa02b4419543dc979ecc3aacfa4c8edabf"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzYwNTcyMw==", "bodyText": "Mixing case with previous statement. Prefer all lowercase to match majority of other migrations", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/726#discussion_r417605723", "createdAt": "2020-04-29T20:55:15Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-importer/src/main/resources/db/migration/V1.23.1__add_topicmessage_runninghashversion.sql", "diffHunk": "@@ -0,0 +1,5 @@\n+-- add the running_hash_version column conditionally\n+alter table topic_message add column if not exists running_hash_version smallint null;\n+\n+-- set rows with empty running_hash_version to 1 if r5-rc4 is not yet released and to the default value if it is\n+UPDATE topic_message SET running_hash_version = CASE WHEN consensus_timestamp < ${r5-rc4-deployDate} THEN 1 ELSE ${runningHashDefaultVersion} END WHERE running_hash_version IS NULL;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "207809aa02b4419543dc979ecc3aacfa4c8edabf"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzYwNzA3Mg==", "bodyText": "Column should be constrained to be not null by the end of this migration. Can add an additional statement to add the constraint or can set to not null here and set a default of 0 or -1.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/726#discussion_r417607072", "createdAt": "2020-04-29T20:57:47Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-importer/src/main/resources/db/migration/V1.23.1__add_topicmessage_runninghashversion.sql", "diffHunk": "@@ -0,0 +1,5 @@\n+-- add the running_hash_version column conditionally\n+alter table topic_message add column if not exists running_hash_version smallint null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "207809aa02b4419543dc979ecc3aacfa4c8edabf"}, "originalPosition": 2}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzYwODI3MQ==", "bodyText": "Missing similar change in integrationDbOps.js", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/726#discussion_r417608271", "createdAt": "2020-04-29T21:00:04Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-rest/config/.node-flywaydb.integration.conf", "diffHunk": "@@ -1,14 +1,16 @@\n module.exports = {\n     flywayArgs: {\n         'placeholders.api-user': 'mirror_api'\n-        ,'placeholders.api-password': 'mirror_api_pass'\n-        ,'placeholders.db-name': 'mirror_node_integration'\n-        ,'placeholders.db-user': 'mirror_node'\n+        , 'placeholders.api-password': 'mirror_api_pass'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "207809aa02b4419543dc979ecc3aacfa4c8edabf"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzYwODcyMg==", "bodyText": "Missing similar change in datagenerator", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/726#discussion_r417608722", "createdAt": "2020-04-29T21:00:54Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-importer/src/main/resources/application.yml", "diffHunk": "@@ -64,6 +67,8 @@ spring:\n       api-user: ${hedera.mirror.importer.db.restUsername}\n       db-name: ${hedera.mirror.importer.db.name}\n       db-user: ${hedera.mirror.importer.db.username}\n+      r5-rc4-deployDate: ${hedera.mirror.importer.r5-rc4-deployDate}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "207809aa02b4419543dc979ecc3aacfa4c8edabf"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzYxMDIxMw==", "bodyText": "This doesn't normalize 0 to 1 in case this is deployed before R5 or when processing pre-R5 transactions during catch up.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/726#discussion_r417610213", "createdAt": "2020-04-29T21:03:35Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/record/RecordItemParser.java", "diffHunk": "@@ -202,7 +202,7 @@ private void insertConsensusTopicMessage(ConsensusSubmitMessageTransactionBody t\n                 Utility.timeStampInNanos(transactionRecord.getConsensusTimestamp()),\n                 transactionBody.getMessage().toByteArray(), (int) topicId.getRealmNum(),\n                 receipt.getTopicRunningHash().toByteArray(), receipt.getTopicSequenceNumber(),\n-                (int) topicId.getTopicNum());\n+                (int) topicId.getTopicNum(), receipt.getTopicRunningHashVersion());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "207809aa02b4419543dc979ecc3aacfa4c8edabf"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5cc441880265a7923ad5ee8a9517bc75d9b68368", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/5cc441880265a7923ad5ee8a9517bc75d9b68368", "committedDate": "2020-04-29T21:17:34Z", "message": "Set time to May 5th, at 19:00 UTC and updated config name\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzMDQ4Nzgz", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/726#pullrequestreview-403048783", "createdAt": "2020-04-29T21:21:15Z", "commit": {"oid": "207809aa02b4419543dc979ecc3aacfa4c8edabf"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "30c05725aa3658ca9bb5396ef5d367d9186c6ff8", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/30c05725aa3658ca9bb5396ef5d367d9186c6ff8", "committedDate": "2020-04-29T22:45:53Z", "message": "Address feedback on naming and constraints\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f3bfbfdb1fd00512156d99b79273c38e93a3dc24", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/f3bfbfdb1fd00512156d99b79273c38e93a3dc24", "committedDate": "2020-04-29T22:50:06Z", "message": "Merged record to entity refactor\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0251807ccc4fceabea84c488956ca6745e17dd36", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/0251807ccc4fceabea84c488956ca6745e17dd36", "committedDate": "2020-04-29T22:58:20Z", "message": "Fixed repeated runing_hash column\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d9ae7310f0265e609b99db39486be0f047fdb05", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/9d9ae7310f0265e609b99db39486be0f047fdb05", "committedDate": "2020-04-29T23:10:31Z", "message": "Removed value of topicRunningHashV2AddedTimestamp to enforce deployment time set\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzMTQ1NzU4", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/726#pullrequestreview-403145758", "createdAt": "2020-04-30T01:23:57Z", "commit": {"oid": "9d9ae7310f0265e609b99db39486be0f047fdb05"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQwMToyMzo1N1rOGOWn1Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQwMToyMzo1N1rOGOWn1Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzcwMzg5Mw==", "bodyText": "I wouldn't think this line would be necessary.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/726#discussion_r417703893", "createdAt": "2020-04-30T01:23:57Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-importer/src/test/resources/application-default.yml", "diffHunk": "@@ -12,7 +12,12 @@ hedera:\n         exclude:\n           - entity: 0.0.999\n       network: TESTNET\n+      # timestamp service added running hash v2 in Unix timestamp format e.g. 1588705200000000000, must be set for v1.23.1 migration\n+      topicRunningHashV2AddedTimestamp: 1588705200000000000\n spring:\n   task:\n     scheduling:\n       enabled: false\n+  flyway:\n+    placeholders:\n+      topicRunningHashV2AddedTimestamp: ${hedera.mirror.importer.topicRunningHashV2AddedTimestamp}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9d9ae7310f0265e609b99db39486be0f047fdb05"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAzMTU1ODY3", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/726#pullrequestreview-403155867", "createdAt": "2020-04-30T02:00:52Z", "commit": {"oid": "9d9ae7310f0265e609b99db39486be0f047fdb05"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQwMjowMDo1MlrOGOXLyg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0zMFQwMjo0MzozN1rOGOX0BQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzcxMzA5OA==", "bodyText": "set to 0", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/726#discussion_r417713098", "createdAt": "2020-04-30T02:00:52Z", "author": {"login": "apeksharma"}, "path": "hedera-mirror-grpc/src/test/resources/application-default.yml", "diffHunk": "@@ -36,3 +36,4 @@ spring:\n       api-user: mirror_api\n       db-name: ${hedera.mirror.grpc.db.name}\n       db-user: ${hedera.mirror.grpc.db.username}\n+      topicRunningHashV2AddedTimestamp: 1588705200000000000", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9d9ae7310f0265e609b99db39486be0f047fdb05"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzcxMzIyNA==", "bodyText": "set to 0", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/726#discussion_r417713224", "createdAt": "2020-04-30T02:01:23Z", "author": {"login": "apeksharma"}, "path": "hedera-mirror-datagenerator/src/main/resources/application.yml", "diffHunk": "@@ -59,3 +59,4 @@ spring:\n       api-user: ${hedera.mirror.datagenerator.db.restUsername}\n       db-name: ${hedera.mirror.datagenerator.db.name}\n       db-user: ${hedera.mirror.datagenerator.db.username}\n+      topicRunningHashV2AddedTimestamp: 1588705200000000000", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9d9ae7310f0265e609b99db39486be0f047fdb05"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzcyMjYxOQ==", "bodyText": "This configuration represents time of an event which hasn't happened yet. It shouldn't have a value unless the real value is known.\nUse 0 to represent undefined.\nMigration\nupdate topic_message\nset running_hash_version =\n    case\n        when ${topicRunningHashV2AddedTimestamp} == 0 then 1\n        else case \n            when consensus_timestamp < ${topicRunningHashV2AddedTimestamp} then 1\n            else 2\n        end\n    end\nwhere running_hash_version is null;\n\nThen set the config to 0 for all tests since they start with clean db.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/726#discussion_r417722619", "createdAt": "2020-04-30T02:40:10Z", "author": {"login": "apeksharma"}, "path": "docs/configuration.md", "diffHunk": "@@ -69,6 +69,7 @@ value, it is recommended to only populate overridden properties in the custom `a\n | `hedera.mirror.importer.parser.record.persist.systemFiles`           | true                    | Persist only system files (number lower than `1000`) to the database                           |\n | `hedera.mirror.importer.parser.record.persist.transactionBytes`      | false                   | Persist raw transaction bytes to the database                                                  |\n | `hedera.mirror.importer.parser.record.sql.batchSize`                 | 100                     | When inserting transactions into db, executeBatches() is called every these many transactions  |\n+| `hedera.mirror.importer.topicRunningHashV2AddedTimestamp`            | 1588636800000000001     | The Unix timestamp when topic message running hash v2 was introduced                           |", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9d9ae7310f0265e609b99db39486be0f047fdb05"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzcyMzM5Nw==", "bodyText": "comment can be made more useful\n\"Used for setting running hash version of topic messages when migrating from v1 to v2. If non-zero, all messages with consensusTimestamp >= this value will be marked version 2, and those less will be marked version 1. If zero, all messages are marked version 1\"", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/726#discussion_r417723397", "createdAt": "2020-04-30T02:43:37Z", "author": {"login": "apeksharma"}, "path": "hedera-mirror-importer/src/main/resources/application.yml", "diffHunk": "@@ -9,6 +9,8 @@ hedera:\n         restPassword: mirror_api_pass\n         restUsername: mirror_api\n         username: mirror_node\n+      # service v05 AddedTimestamp in consensus_timestamp format e.g. 1588636800000000001, must be set for v1.23.1 migration", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9d9ae7310f0265e609b99db39486be0f047fdb05"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3108, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}