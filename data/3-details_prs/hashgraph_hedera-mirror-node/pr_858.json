{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ2NTkyNTMx", "number": 858, "title": "Hardcode bucket names to network enum", "bodyText": "Detailed description:\nNow that all buckets are requester pays, anyone can run a Mirror Node. However, as is they wouldl have to ask Hedera what the bucket names are.\nThis change hardcodes the bucket names in the code accordingly with the network. Only the OTHER network option requires bucketName set.\n\nMoves the HederaNetwork enum into the MirrorProperties where it's used.\nAdds a bucketName string to the enum object with the hardcoded bucket names\nMoves bucketName to mirrorPorperties to be set with network is OTHER\nUpdates documentation and references to bucketName\n\nWhich issue(s) this PR fixes:\nFixes #844\nSpecial notes for your reviewer:\nChecklist\n\n Documentation added\n Tests updated", "createdAt": "2020-07-09T03:21:22Z", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/858", "merged": true, "mergeCommit": {"oid": "fd4f69dadfded5ce3e390514ced863528ba7b5fe"}, "closed": true, "closedAt": "2020-07-15T15:41:21Z", "author": {"login": "Nana-EC"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABczl0NYAH2gAyNDQ2NTkyNTMxOjJiN2Y0ZjZjZTI3MzcyN2ZlMzlhNmU2ZDRmNmU3ZmM2MTlkZWQ0ZTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc1MAzCAFqTQ0OTA1MTI3Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "2b7f4f6ce273727fe39a6e6d4f6e7fc619ded4e8", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/2b7f4f6ce273727fe39a6e6d4f6e7fc619ded4e8", "committedDate": "2020-07-10T15:59:44Z", "message": "Hardcode bucket names to network enum\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "41fb8a45eb69c21effd19647a4012b0833c7fceb", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/41fb8a45eb69c21effd19647a4012b0833c7fceb", "committedDate": "2020-07-08T21:56:47Z", "message": "Hardcode bucket names to network enum\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}, "afterCommit": {"oid": "2b7f4f6ce273727fe39a6e6d4f6e7fc619ded4e8", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/2b7f4f6ce273727fe39a6e6d4f6e7fc619ded4e8", "committedDate": "2020-07-10T15:59:44Z", "message": "Hardcode bucket names to network enum\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "91f079bae7bac2431c0a497026219f8b75fe41db", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/91f079bae7bac2431c0a497026219f8b75fe41db", "committedDate": "2020-07-10T16:57:13Z", "message": "Fix abstractdownload beforeTest\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2NzAxNDA0", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/858#pullrequestreview-446701404", "createdAt": "2020-07-10T21:07:23Z", "commit": {"oid": "91f079bae7bac2431c0a497026219f8b75fe41db"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQyMTowNzoyM1rOGwFqpQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQyMjowMDowMFrOGwGxmA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzA3NzY2OQ==", "bodyText": "I don't see why we're changing the path to bucketName. It's still associated with the downloader component and should be namespaced under a path that reflects that. Also, it's an unnecessary breaking change to clients that should be avoided if possible.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/858#discussion_r453077669", "createdAt": "2020-07-10T21:07:23Z", "author": {"login": "steven-sheehy"}, "path": "docs/configuration.md", "diffHunk": "@@ -21,6 +19,7 @@ value, it is recommended to only populate overridden properties in the custom `a\n \n | Name                                                                 | Default                 | Description                                                                                    |\n | -------------------------------------------------------------------- | ----------------------- | ---------------------------------------------------------------------------------------------- |\n+| `hedera.mirror.importer.bucketName`                                  | \"\"                      | The cloud storage bucket name to download streamed files. Must be set if `hedera.mirror.importer.network` is 'OTHER'|", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91f079bae7bac2431c0a497026219f8b75fe41db"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzA5NDU5Nw==", "bodyText": "Can actually remove this since default in code is empty and it now uses network", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/858#discussion_r453094597", "createdAt": "2020-07-10T21:56:04Z", "author": {"login": "steven-sheehy"}, "path": "charts/marketplace/gcp/schema-test.yaml", "diffHunk": "@@ -1,9 +1,9 @@\n properties:\n-  importer.config.hedera.mirror.importer.downloader.accessKey:\n+  importer.config.hedera.mirror.importer.bucketName:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91f079bae7bac2431c0a497026219f8b75fe41db"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzA5NTU3OA==", "bodyText": "I assume you moved it here just because network was here and it made it a little easier to have it consolidated. But as mentioned previously we should keep it where it makes better sense and to not break clients. Recommend keeping network here and moving bucketName back to CommonDownloaderProperties. Then you can inject MirrorProperties into CommonDownloaderProperties to consolidate logic.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/858#discussion_r453095578", "createdAt": "2020-07-10T21:59:10Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/MirrorProperties.java", "diffHunk": "@@ -63,4 +64,21 @@ public void setDataPath(Path dataPath) {\n         Utility.ensureDirectory(dataPath);\n         this.dataPath = dataPath;\n     }\n+\n+    private String bucketName = \"\";\n+\n+    public String getBucketName() {\n+        return network == HederaNetwork.OTHER ? bucketName : network.getBucketName();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91f079bae7bac2431c0a497026219f8b75fe41db"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzA5NTgzMg==", "bodyText": "Revert", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/858#discussion_r453095832", "createdAt": "2020-07-10T22:00:00Z", "author": {"login": "steven-sheehy"}, "path": "charts/marketplace/gcp/schema.yaml", "diffHunk": "@@ -103,6 +103,10 @@ properties:\n               - apiGroups: ['']\n                 resources: ['pods']\n                 verbs: ['get']\n+  importer.config.hedera.mirror.importer.downloader.bucketName:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91f079bae7bac2431c0a497026219f8b75fe41db"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "db57e54442630ee91c771803d63fd5d854737053", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/db57e54442630ee91c771803d63fd5d854737053", "committedDate": "2020-07-11T22:39:55Z", "message": "Revert moving bucketName porperty out\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b1807de298c640af328d389c05c436b797ea72e", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/4b1807de298c640af328d389c05c436b797ea72e", "committedDate": "2020-07-11T22:57:32Z", "message": "Pull commonDownloaderProperties and mirrorProperties from injected downloaderProperties\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b4156d182ec80b760bc3d8299a4f2ae0e9ab494b", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/b4156d182ec80b760bc3d8299a4f2ae0e9ab494b", "committedDate": "2020-07-11T23:31:48Z", "message": "Increaseoffset between historic and incoming messages\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ2ODQyMDMz", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/858#pullrequestreview-446842033", "createdAt": "2020-07-12T02:58:55Z", "commit": {"oid": "b4156d182ec80b760bc3d8299a4f2ae0e9ab494b"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMlQwMjo1ODo1NVrOGwQxNg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMlQwMjo1ODo1NVrOGwQxNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzI1OTU3NA==", "bodyText": "I think the bucket name should act as an override for all environments, not just for OTHER. When testnet gets reset again and gets a new bucket we don't want to be blocked on a new build to correct the enum. Update docs in other areas as appropriate.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/858#discussion_r453259574", "createdAt": "2020-07-12T02:58:55Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/downloader/CommonDownloaderProperties.java", "diffHunk": "@@ -21,23 +21,30 @@\n  */\n \n import javax.validation.constraints.Min;\n-import javax.validation.constraints.NotBlank;\n import javax.validation.constraints.NotNull;\n import lombok.Data;\n import lombok.Getter;\n import lombok.RequiredArgsConstructor;\n import org.springframework.boot.context.properties.ConfigurationProperties;\n import org.springframework.validation.annotation.Validated;\n \n+import com.hedera.mirror.importer.MirrorProperties;\n+\n @Data\n @Validated\n @ConfigurationProperties(\"hedera.mirror.importer.downloader\")\n public class CommonDownloaderProperties {\n \n+    private final MirrorProperties mirrorProperties;\n+\n     private String accessKey;\n \n-    @NotBlank\n-    private String bucketName = \"hedera-demo-streams\";\n+    private String bucketName = \"\";\n+\n+    public String getBucketName() {\n+        return mirrorProperties.getNetwork() == MirrorProperties.HederaNetwork.OTHER ? bucketName :", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b4156d182ec80b760bc3d8299a4f2ae0e9ab494b"}, "originalPosition": 28}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "02e89a017dbba6e4ec95a265d4c5dbbddf702494", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/02e89a017dbba6e4ec95a265d4c5dbbddf702494", "committedDate": "2020-07-14T20:12:56Z", "message": "Updated getBucketName to default to hedera.mirror.importer.downloader.bucketName if not null\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "885e9ea874823055a09ae30192bb97c7cc31f825", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/885e9ea874823055a09ae30192bb97c7cc31f825", "committedDate": "2020-07-14T20:52:45Z", "message": "Updated docs and empty bucketname check\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ4NDg1MzY5", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/858#pullrequestreview-448485369", "createdAt": "2020-07-14T21:38:39Z", "commit": {"oid": "885e9ea874823055a09ae30192bb97c7cc31f825"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQyMTozODozOVrOGxmUAQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQyMTozODozOVrOGxmUAQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDY2MTEyMQ==", "bodyText": "Please correct", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/858#discussion_r454661121", "createdAt": "2020-07-14T21:38:39Z", "author": {"login": "steven-sheehy"}, "path": "charts/marketplace/gcp/schema.yaml", "diffHunk": "@@ -118,7 +118,7 @@ properties:\n     title: Importer GCP access key\n   importer.config.hedera.mirror.importer.downloader.bucketName:\n     type: string\n-    description: The Google Cloud Storage bucket name to download streamed files\n+    description: The Google Cloud Storage bucket name to download streamed files. Must be set when importer.config.hedera.mirror.importer.network is OTHER", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "885e9ea874823055a09ae30192bb97c7cc31f825"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "17a40c1b9290def942ec072cdb218536a5adfcdf", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/17a40c1b9290def942ec072cdb218536a5adfcdf", "committedDate": "2020-07-15T05:02:33Z", "message": "Updated schema documentaiton for bucket names\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ5MDUxMjc2", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/858#pullrequestreview-449051276", "createdAt": "2020-07-15T15:03:48Z", "commit": {"oid": "17a40c1b9290def942ec072cdb218536a5adfcdf"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4069, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}