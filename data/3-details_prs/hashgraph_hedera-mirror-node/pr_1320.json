{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMyNzY2NDc4", "number": 1320, "title": "Optimize transaction query", "bodyText": "Detailed description:\n\nReplace the join crypto_transfer table and transaction table inner query by join transaction table and a subquery to select distinct consensus timestamps from crypto_transfer table\n\nWhich issue(s) this PR fixes:\nFixes #\nSpecial notes for your reviewer:\nChecklist\n\n Documentation added\n Tests updated", "createdAt": "2020-12-04T20:21:36Z", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1320", "merged": true, "mergeCommit": {"oid": "c19127035e117d8329f70016997af09ab88043d5"}, "closed": true, "closedAt": "2020-12-05T00:29:58Z", "author": {"login": "xin-hedera"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdi9lq-gH2gAyNTMyNzY2NDc4OjM5MTMyOTA5MDk1YmNlYWRkMDk1NjAwNjg4MmViNTBlNjYxYWUyMWU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdjAnJygFqTU0NTM2NzU4Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "39132909095bceadd0956006882eb50e661ae21e", "author": {"user": {"login": "xin-hedera", "name": "Xin Li"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/39132909095bceadd0956006882eb50e661ae21e", "committedDate": "2020-12-04T20:16:01Z", "message": "optimize transaction query\n\nSigned-off-by: Xin Li <xin.li@swirlds.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ1Mjk3NTgw", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1320#pullrequestreview-545297580", "createdAt": "2020-12-04T21:09:14Z", "commit": {"oid": "39132909095bceadd0956006882eb50e661ae21e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQyMTowOTo1MlrOH_iGtA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wNFQyMTowOTo1MlrOH_iGtA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjM4MTEwOA==", "bodyText": "q: Does this end up contributing to the #1295  bug where transactions for account that don't pay crypto transfer fees.\ni.e. will transactions now be filtered out as a result of this?", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1320#discussion_r536381108", "createdAt": "2020-12-04T21:09:52Z", "author": {"login": "Nana-EC"}, "path": "hedera-mirror-rest/transactions.js", "diffHunk": "@@ -183,16 +195,21 @@ const getTransactionsInnerQuery = function (\n   transactionTypeQuery,\n   order\n ) {\n-  let whereClause = [accountQuery, tsQuery, resultTypeQuery, creditDebitQuery, transactionTypeQuery]\n-    .filter((q) => q !== '')\n-    .join(' AND ');\n-  whereClause = whereClause === '' ? '' : `WHERE ${whereClause}`;\n+  const whereClause = buildWhereClause(resultTypeQuery, transactionTypeQuery);\n+  const ctlWhereClause = buildWhereClause(accountQuery, tsQuery, creditDebitQuery);\n+\n   return `\n-    SELECT DISTINCT ctl.consensus_timestamp\n-    FROM crypto_transfer ctl\n-      JOIN transaction t ON t.consensus_ns = ctl.consensus_timestamp\n+    SELECT t.consensus_ns AS consensus_timestamp\n+    FROM transaction t\n+    JOIN (\n+            SELECT DISTINCT consensus_timestamp", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "39132909095bceadd0956006882eb50e661ae21e"}, "originalPosition": 49}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ1MzM1ODQz", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1320#pullrequestreview-545335843", "createdAt": "2020-12-04T22:18:28Z", "commit": {"oid": "39132909095bceadd0956006882eb50e661ae21e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ1MzU3MjYz", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1320#pullrequestreview-545357263", "createdAt": "2020-12-04T23:12:45Z", "commit": {"oid": "39132909095bceadd0956006882eb50e661ae21e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ1MzY3NTgz", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1320#pullrequestreview-545367583", "createdAt": "2020-12-04T23:47:21Z", "commit": {"oid": "39132909095bceadd0956006882eb50e661ae21e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3399, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}