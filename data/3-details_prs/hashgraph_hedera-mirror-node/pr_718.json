{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEwMjkwOTg5", "number": 718, "title": "Add Helm tests", "bodyText": "Detailed description:\n\nAdds a helm test pod usings bats to verify REST API only for now\nWaits for REST API to return 200 before running tests\nTests are successful if at least one accounts, balances and transactions are returned\n\nWhich issue(s) this PR fixes:\nFixes #653\nSpecial notes for your reviewer:\nWe don't check for topics or recent transactions as that would be guaranteed to fail for demo bucket and during catch up\nChecklist\n\n Documentation added\n Tests updated", "createdAt": "2020-04-28T18:38:22Z", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/718", "merged": true, "mergeCommit": {"oid": "3a7f51856e7e7d534c18a771d05eab51b9897336"}, "closed": true, "closedAt": "2020-04-28T20:37:14Z", "author": {"login": "steven-sheehy"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABccIc1lABqjMyODE2NjIxMjI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABccJDOnAFqTQwMjE0NTQ4NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f1404ac749a7f86040c02f611bb1caf6e032925f", "author": {"user": {"login": "steven-sheehy", "name": "Steven Sheehy"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/f1404ac749a7f86040c02f611bb1caf6e032925f", "committedDate": "2020-04-28T18:00:55Z", "message": "Add helm tests\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>"}, "afterCommit": {"oid": "944cbaa8840bbccb89c68e71740399b4ebdd2f95", "author": {"user": {"login": "steven-sheehy", "name": "Steven Sheehy"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/944cbaa8840bbccb89c68e71740399b4ebdd2f95", "committedDate": "2020-04-28T18:46:35Z", "message": "Add helm tests\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2c3788f7130a14ce941870e96f3f760ed642a72f", "author": {"user": {"login": "steven-sheehy", "name": "Steven Sheehy"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/2c3788f7130a14ce941870e96f3f760ed642a72f", "committedDate": "2020-04-28T19:04:37Z", "message": "Add helm tests\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "944cbaa8840bbccb89c68e71740399b4ebdd2f95", "author": {"user": {"login": "steven-sheehy", "name": "Steven Sheehy"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/944cbaa8840bbccb89c68e71740399b4ebdd2f95", "committedDate": "2020-04-28T18:46:35Z", "message": "Add helm tests\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>"}, "afterCommit": {"oid": "2c3788f7130a14ce941870e96f3f760ed642a72f", "author": {"user": {"login": "steven-sheehy", "name": "Steven Sheehy"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/2c3788f7130a14ce941870e96f3f760ed642a72f", "committedDate": "2020-04-28T19:04:37Z", "message": "Add helm tests\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAyMTQ1NDg1", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/718#pullrequestreview-402145485", "createdAt": "2020-04-28T19:28:31Z", "commit": {"oid": "2c3788f7130a14ce941870e96f3f760ed642a72f"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQxOToyODozMVrOGNjkeQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOFQxOToyODozMVrOGNjkeQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjg2NzQ0OQ==", "bodyText": "might be good to add one for topic messages also", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/718#discussion_r416867449", "createdAt": "2020-04-28T19:28:31Z", "author": {"login": "Nana-EC"}, "path": "charts/hedera-mirror-rest/templates/tests/configmap.yaml", "diffHunk": "@@ -0,0 +1,38 @@\n+apiVersion: v1\n+kind: ConfigMap\n+metadata:\n+  annotations:\n+    helm.sh/hook: test-success\n+    helm.sh/hook-delete-policy: hook-succeeded\n+  labels:\n+    {{- include \"hedera-mirror-rest.labels\" . | nindent 4 }}\n+  name: {{ include \"hedera-mirror-rest.fullname\" . }}-test\n+  namespace: {{ include \"hedera-mirror-rest.namespace\" . }}\n+data:\n+  test.sh: |-\n+    #!/usr/bin/env bash\n+\n+    URI='http://{{ include \"hedera-mirror-rest.fullname\" . }}:{{ .Values.service.port }}'\n+\n+    # Infinite loop is okay since helm test itself has a timeout\n+    function setup() {\n+      apk add -qu curl jq\n+      until (curl -s \"${URI}/api/v1/transactions?limit=1\"); do\n+        sleep 1\n+      done\n+    }\n+\n+    @test \"Has accounts\" {\n+      curl -s \"${URI}/api/v1/accounts?limit=1\" | jq -e '.accounts | length >= 1'\n+      [[ \"$?\" -eq 0 ]]\n+    }\n+\n+    @test \"Has balances\" {\n+      curl -s \"${URI}/api/v1/balances?limit=1\" | jq -e '.balances | length >= 1'\n+      [[ \"$?\" -eq 0 ]]\n+    }\n+\n+    @test \"Has transactions\" {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2c3788f7130a14ce941870e96f3f760ed642a72f"}, "originalPosition": 35}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3100, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}