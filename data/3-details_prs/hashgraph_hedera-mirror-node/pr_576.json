{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgxOTgzODc5", "number": 576, "title": "Postgres Writer #2", "bodyText": "Detailed description:\n\nMove topic messages, contract result, file data, and live hashes from\nRecordFileLogger to PostgresWritingRecordParsedItemHandler\nLogic for Transaction and batching will be moved together in followup\n\nSigned-off-by: Apekshit Sharma apekshit.sharma@hedera.com\nWhich issue(s) this PR fixes:\nPartially fixes #566\nSpecial notes for your reviewer:\nSteps to merge in:\n\nmerge in #575  first\nchange base of this PR to master\nmerge in this PR\n\nChecklist\n\n Documentation added\n Tests updated", "createdAt": "2020-03-01T02:47:29Z", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/576", "merged": true, "mergeCommit": {"oid": "1e04dbfdb743a67e7b52d3319fe822f154188b24"}, "closed": true, "closedAt": "2020-03-02T18:09:07Z", "author": {"login": "apeksharma"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcJwcQ9gFqTM2NzM0NjExNQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcJxupbAFqTM2NzQxMjA2NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY3MzQ2MTE1", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/576#pullrequestreview-367346115", "createdAt": "2020-03-02T16:35:55Z", "commit": {"oid": "ddb953ab499776bcd1a0bd2c446e2060cbc49350"}, "state": "DISMISSED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxNjozNTo1NVrOFwmf4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wMlQxNjozNTo1NVrOFwmf4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjUwNjcyMA==", "bodyText": "beyond the if statement it looks like insertFileCreate() and insertFileAppend() have some common code that could be shared.\nConsider consolidating it if it makes sense", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/576#discussion_r386506720", "createdAt": "2020-03-02T16:35:55Z", "author": {"login": "Nana-EC"}, "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/record/RecordFileLogger.java", "diffHunk": "@@ -748,39 +729,33 @@ private static EntityId storeConsensusSubmitMessage(TransactionBody body,\n     }\n \n     private static void insertConsensusTopicMessage(ConsensusSubmitMessageTransactionBody transactionBody,\n-                                                    TransactionRecord transactionRecord) throws SQLException {\n+                                                    TransactionRecord transactionRecord) {\n         var receipt = transactionRecord.getReceipt();\n-        var ts = transactionRecord.getConsensusTimestamp();\n         var topicId = transactionBody.getTopicID();\n-        sqlInsertTopicMessage.setLong(1, Utility.timeStampInNanos(ts));\n-        sqlInsertTopicMessage.setShort(2, (short) topicId.getRealmNum());\n-        sqlInsertTopicMessage.setInt(3, (int) topicId.getTopicNum());\n-        sqlInsertTopicMessage.setBytes(4, transactionBody.getMessage().toByteArray());\n-        sqlInsertTopicMessage.setBytes(5, receipt.getTopicRunningHash().toByteArray());\n-        sqlInsertTopicMessage.setLong(6, receipt.getTopicSequenceNumber());\n-        sqlInsertTopicMessage.addBatch();\n+        TopicMessage topicMessage = new TopicMessage(\n+                Utility.timeStampInNanos(transactionRecord.getConsensusTimestamp()),\n+                transactionBody.getMessage().toByteArray(), (int) topicId.getRealmNum(),\n+                receipt.getTopicRunningHash().toByteArray(), receipt.getTopicSequenceNumber(),\n+                (int) topicId.getTopicNum());\n+        postgresWriter.onTopicMessage(topicMessage);\n     }\n \n     private static void insertFileCreate(long consensusTimestamp, FileCreateTransactionBody transactionBody,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ddb953ab499776bcd1a0bd2c446e2060cbc49350"}, "originalPosition": 98}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d72129deddc1f34dd1b92f79c42c74e82124614e", "author": {"user": {"login": "apeksharma", "name": "Apekshit Sharma"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/d72129deddc1f34dd1b92f79c42c74e82124614e", "committedDate": "2020-03-02T18:00:07Z", "message": "Postgres Writer #2\n\n- Move topic messages, contract result, file data, and live hashes from\n  RecordFileLogger to PostgresWritingRecordParsedItemHandler\n- Logic for Transaction and batching will be moved together in followup\n\nSigned-off-by: Apekshit Sharma <apekshit.sharma@hedera.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "08665cacb2dc9387bff9dc2a8da633080c626a62", "author": {"user": {"login": "apeksharma", "name": "Apekshit Sharma"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/08665cacb2dc9387bff9dc2a8da633080c626a62", "committedDate": "2020-03-02T17:57:39Z", "message": "Merge branch 'master' into parser_22"}, "afterCommit": {"oid": "d72129deddc1f34dd1b92f79c42c74e82124614e", "author": {"user": {"login": "apeksharma", "name": "Apekshit Sharma"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/d72129deddc1f34dd1b92f79c42c74e82124614e", "committedDate": "2020-03-02T18:00:07Z", "message": "Postgres Writer #2\n\n- Move topic messages, contract result, file data, and live hashes from\n  RecordFileLogger to PostgresWritingRecordParsedItemHandler\n- Logic for Transaction and batching will be moved together in followup\n\nSigned-off-by: Apekshit Sharma <apekshit.sharma@hedera.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY3NDEyMDY0", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/576#pullrequestreview-367412064", "createdAt": "2020-03-02T18:07:42Z", "commit": {"oid": "d72129deddc1f34dd1b92f79c42c74e82124614e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3289, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}