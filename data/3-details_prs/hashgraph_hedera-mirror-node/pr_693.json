{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA1MjY2NjYy", "number": 693, "title": "Add Traefik API gateway", "bodyText": "Detailed description:\n\n\nAdd Traefik API Gateway to centralize routing\n\nGRPC, REST and Grafana are now available on a single IP and port accessible via a LoadBalancer\nPorts 80, 443 and 5600 (for backwards compatibility) can be used to access any of the 3 services, with 443 currently using a self signed certificate\nGrafana accessible at sub-path /grafana\nSeparate middleware enabled for each service:\n\nIP Whitelisting\nConnection limits per IP\nRate limits (average and burst)\nCircuit breaker\n\n\nMetrics give us request rate broken down by method, protocol, response code and service\nAccess logs\nTraefik dashboard accessible via kubectl port-forward deploy/traefik 9000:9000 and http://localhost:9000/dashboard/#/\n\n\n\nFix chart not rendering with helm template (a requirement for Google marketplace) by removing sub-chart variables from NOTES.txt and replacing with new load balancer IP\n\n\nDisable autoCreateIndex for Elasticsearch as we manually create index anyway and this reduces permissions of elastic user\n\n\nAdd recording parsing TPS to log\n\n\nAdjust the CPU and memory resources of some pods that were close to max per metrics\n\n\nRename some sub-charts to remove '-' as it is not supported by Golang templates\n\n\nBump importer replicas to 2 by default for HA\n\n\nWhich issue(s) this PR fixes:\nFixes #651\nSpecial notes for your reviewer:\nChecklist\n\n Documentation added\n Tests updated", "createdAt": "2020-04-17T17:58:37Z", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/693", "merged": true, "mergeCommit": {"oid": "eb43cd7b233def323ff2df5579db0414c54d50db"}, "closed": true, "closedAt": "2020-04-20T20:19:30Z", "author": {"login": "steven-sheehy"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcYlJCAgH2gAyNDA1MjY2NjYyOmJkODBmMjI1ZTlmODM4MzRhZjI5Y2U4NGNiNmI3NTRmOGU2OTlkYTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcZkAqtAFqTM5NjczNjg4MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "bd80f225e9f83834af29ce84cb6b754f8e699da7", "author": {"user": {"login": "steven-sheehy", "name": "Steven Sheehy"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/bd80f225e9f83834af29ce84cb6b754f8e699da7", "committedDate": "2020-04-17T17:56:37Z", "message": "Add Traefik API gateway\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f3cda2d7c412894e83de1d7a4b599036f60b3115", "author": {"user": {"login": "steven-sheehy", "name": "Steven Sheehy"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/f3cda2d7c412894e83de1d7a4b599036f60b3115", "committedDate": "2020-04-17T21:58:20Z", "message": "Separate middleware per API\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1ODA1ODM3", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/693#pullrequestreview-395805837", "createdAt": "2020-04-17T22:22:30Z", "commit": {"oid": "f3cda2d7c412894e83de1d7a4b599036f60b3115"}, "state": "DISMISSED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QyMjoyMjozMFrOGHex4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QyMjoyMjozMFrOGHex4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQ5NzUwNQ==", "bodyText": "nit: might be worth a small not on why --render-subchart-notes as it's not a regular property", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/693#discussion_r410497505", "createdAt": "2020-04-17T22:22:30Z", "author": {"login": "Nana-EC"}, "path": "charts/README.md", "diffHunk": "@@ -16,7 +16,7 @@ Installs the Hedera Mirror Node Helm wrapper chart. This chart will install the\n To install the wrapper chart with a release name of `mirror`:\n \n ```shell script\n-$ helm upgrade --install mirror charts/hedera-mirror\n+$ helm upgrade --install --render-subchart-notes mirror charts/hedera-mirror", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f3cda2d7c412894e83de1d7a4b599036f60b3115"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e1ead25610e4c8da4bcb3d72f40b741784701334", "author": {"user": {"login": "steven-sheehy", "name": "Steven Sheehy"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/e1ead25610e4c8da4bcb3d72f40b741784701334", "committedDate": "2020-04-17T23:45:17Z", "message": "Update documentation\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1ODE0NTg1", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/693#pullrequestreview-395814585", "createdAt": "2020-04-17T22:50:42Z", "commit": {"oid": "f3cda2d7c412894e83de1d7a4b599036f60b3115"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QyMjo1MDo0MlrOGHfPNA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QyMzoyMjozNVrOGHfr5Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDUwNTAxMg==", "bodyText": "do we need 5 middleware definitions?\nGiven each spec is 3-5 lines, would be neater and more manageable if we can directly add them here with comments.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/693#discussion_r410505012", "createdAt": "2020-04-17T22:50:42Z", "author": {"login": "apeksharma"}, "path": "charts/hedera-mirror-grpc/templates/middleware.yaml", "diffHunk": "@@ -0,0 +1,68 @@\n+{{- if .Values.ingress.middleware.enabled -}}\n+apiVersion: traefik.containo.us/v1alpha1\n+kind: Middleware\n+metadata:\n+  labels:\n+    {{- include \"hedera-mirror-grpc.labels\" . | nindent 4 }}\n+  name: {{ include \"hedera-mirror-grpc.fullname\" . }}\n+  namespace: {{ include \"hedera-mirror-grpc.namespace\" . }}\n+spec:\n+  chain:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f3cda2d7c412894e83de1d7a4b599036f60b3115"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDUwODMzOA==", "bodyText": "Would be best to avoid the burden of configuring every path if we have no reason to block any.\nIn case of grpc, i believe we can open up all paths(?).\nIs is possible to specify something like * here?", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/693#discussion_r410508338", "createdAt": "2020-04-17T23:04:49Z", "author": {"login": "apeksharma"}, "path": "charts/hedera-mirror-grpc/values.yaml", "diffHunk": "@@ -30,6 +30,28 @@ image:\n \n imagePullSecrets: []\n \n+ingress:\n+  annotations:\n+    traefik.ingress.kubernetes.io/router.middlewares: '{{ include \"hedera-mirror-grpc.namespace\" . }}-{{ include \"hedera-mirror-grpc.fullname\" . }}@kubernetescrd'\n+  enabled: true\n+  hosts:\n+    - host: \"\"\n+      paths:\n+        - \"/com.hedera.mirror.api.proto.ConsensusService\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f3cda2d7c412894e83de1d7a4b599036f60b3115"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDUxMDU4OA==", "bodyText": "does helm has no way of sharing duplicates like these across subcharts?", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/693#discussion_r410510588", "createdAt": "2020-04-17T23:14:49Z", "author": {"login": "apeksharma"}, "path": "charts/hedera-mirror-rest/templates/ingress.yaml", "diffHunk": "@@ -0,0 +1,38 @@\n+{{- if .Values.ingress.enabled -}}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f3cda2d7c412894e83de1d7a4b599036f60b3115"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDUxMjM1Nw==", "bodyText": "Grafana would be internal only and authenticated. There should be no need to limit it. Seems a bit excessive early on since it's not clear if we are even gonna need it.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/693#discussion_r410512357", "createdAt": "2020-04-17T23:22:35Z", "author": {"login": "apeksharma"}, "path": "charts/hedera-mirror/templates/middleware-grafana.yaml", "diffHunk": "@@ -0,0 +1,85 @@\n+{{ $ingress := .Values.prometheus.grafana.ingress }}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f3cda2d7c412894e83de1d7a4b599036f60b3115"}, "originalPosition": 1}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "09433ca1e5bc24eb963262fb41d0118238eab354", "author": {"user": {"login": "steven-sheehy", "name": "Steven Sheehy"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/09433ca1e5bc24eb963262fb41d0118238eab354", "committedDate": "2020-04-18T03:35:01Z", "message": "Add Traefik antiAffinity\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e7ee150c1edf84a2d60717edae4ddee52624658a", "author": {"user": {"login": "steven-sheehy", "name": "Steven Sheehy"}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/e7ee150c1edf84a2d60717edae4ddee52624658a", "committedDate": "2020-04-18T21:08:25Z", "message": "Add Traefik Grafana dashboard\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2NzM2ODgx", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/693#pullrequestreview-396736881", "createdAt": "2020-04-20T19:11:30Z", "commit": {"oid": "e7ee150c1edf84a2d60717edae4ddee52624658a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3079, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}