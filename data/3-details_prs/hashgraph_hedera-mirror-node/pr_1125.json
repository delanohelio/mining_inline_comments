{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAxNzQ4NTIz", "number": 1125, "title": "HTS: Token REST API", "bodyText": "Detailed description:\nWith the addition of HTS customers will need a REST API to query the details of a specific token on the network\nImplement a Token Info REST API per the design.\n\nAdd /api/v1/tokens/ endpoint to server.js\nUpdate tokens.js file to hold token retrieval data from database for tables token\nAdd spec files to validate token query variations\n\nWhich issue(s) this PR fixes:\nFixes #1106\nSpecial notes for your reviewer:\nChecklist\n\n Documentation added\n Tests updated", "createdAt": "2020-10-12T18:47:08Z", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1125", "merged": true, "mergeCommit": {"oid": "169a63af5e612ba070e6ad49e7098b97de8ddb7b"}, "closed": true, "closedAt": "2020-10-16T17:58:33Z", "author": {"login": "Nana-EC"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdSpM8VgH2gAyNTAxNzQ4NTIzOjk2ZWRlYzMxNzNjNDAzMWUwN2FjODk2NzU2ZGY2ZjJjODRlYmQyNWY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdTKGfOAFqTUxMDY4MzEzNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "96edec3173c4031e07ac896756df6f2c84ebd25f", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/96edec3173c4031e07ac896756df6f2c84ebd25f", "committedDate": "2020-10-15T03:28:07Z", "message": "HTS: REST Token Info\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8bf9b9478fec118f78f8597100400db2aa4f9bc8", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/8bf9b9478fec118f78f8597100400db2aa4f9bc8", "committedDate": "2020-10-15T03:34:13Z", "message": "Added format test\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6ba6f14f04ac98188be6bb7c5cf0f876ea6e7533", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/6ba6f14f04ac98188be6bb7c5cf0f876ea6e7533", "committedDate": "2020-10-15T03:26:15Z", "message": "Merge branch 'rest-token-info' of https://github.com/hashgraph/hedera-mirror-node into rest-token-info"}, "afterCommit": {"oid": "8bf9b9478fec118f78f8597100400db2aa4f9bc8", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/8bf9b9478fec118f78f8597100400db2aa4f9bc8", "committedDate": "2020-10-15T03:34:13Z", "message": "Added format test\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "858c11b050aa8ac1efe584009623327190ed7902", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/858c11b050aa8ac1efe584009623327190ed7902", "committedDate": "2020-10-15T03:56:08Z", "message": "Update token info row formating\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5NDgzOTMw", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1125#pullrequestreview-509483930", "createdAt": "2020-10-15T15:06:27Z", "commit": {"oid": "858c11b050aa8ac1efe584009623327190ed7902"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxNTowNjoyN1rOHiMlHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxNToxMjoyMlrOHiM4IQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTYxOTc0Mg==", "bodyText": "I thought Xin's PR renamed this to entities? Are these all accounts or are some tokens? Can you please always put the types so it's clear. I think these are defaulting to account type.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1125#discussion_r505619742", "createdAt": "2020-10-15T15:06:27Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-rest/__tests__/specs/token-info-01-no-args.spec.json", "diffHunk": "@@ -0,0 +1,63 @@\n+{\n+  \"description\": \"Token info api call for a given token\",\n+  \"setup\": {\n+    \"accounts\": [", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "858c11b050aa8ac1efe584009623327190ed7902"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTYyMjQ0MA==", "bodyText": "Alphabetic sort of keys, please. Even primary keys.", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1125#discussion_r505622440", "createdAt": "2020-10-15T15:09:39Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-rest/tokens.js", "diffHunk": "@@ -103,6 +108,28 @@ const formatTokenRow = (row) => {\n   };\n };\n \n+const formatTokenInfoRow = (row) => {\n+  return {\n+    token_id: EntityId.fromString(row.token_id).toString(),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "858c11b050aa8ac1efe584009623327190ed7902"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTYyNDYwOQ==", "bodyText": "This is weird and inefficient. Why do we not have a separate fromNumber(num) that can handle null?", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1125#discussion_r505624609", "createdAt": "2020-10-15T15:12:22Z", "author": {"login": "steven-sheehy"}, "path": "hedera-mirror-rest/tokens.js", "diffHunk": "@@ -103,6 +108,28 @@ const formatTokenRow = (row) => {\n   };\n };\n \n+const formatTokenInfoRow = (row) => {\n+  return {\n+    token_id: EntityId.fromString(row.token_id).toString(),\n+    symbol: row.symbol,\n+    treasury_account_id: EntityId.fromString(row.treasury_account_id).toString(),\n+    freeze_default: row.freeze_default,\n+    admin_key: utils.encodeKey(row.key),\n+    kyc_key: utils.encodeKey(row.kyc_key),\n+    freeze_key: utils.encodeKey(row.freeze_key),\n+    supply_key: utils.encodeKey(row.supply_key),\n+    wipe_key: utils.encodeKey(row.wipe_key),\n+    created_timestamp: utils.nsToSecNs(row.created_timestamp),\n+    decimals: row.decimals,\n+    initial_supply: row.initial_supply,\n+    total_supply: row.total_supply,\n+    expiry_timestamp: row.exp_time_ns,\n+    auto_renew_account:\n+      row.auto_renew_account_id === null ? null : EntityId.fromString(row.auto_renew_account_id.toString()).toString(),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "858c11b050aa8ac1efe584009623327190ed7902"}, "originalPosition": 46}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5NTE4NTU0", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1125#pullrequestreview-509518554", "createdAt": "2020-10-15T15:41:42Z", "commit": {"oid": "858c11b050aa8ac1efe584009623327190ed7902"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxNTo0MTo0M1rOHiOM8Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQxNTo0NToxMlrOHiOWxg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTY0NjMyMQ==", "bodyText": "should use results.rows.length. rowCount is not really rows.length, though for this query, they have the same value. https://node-postgres.com/api/result\nnit: it's easier to read in this way:\nif (results.rows.length !== 1) {\n  throw new NotFoundError();\n}\n\n// normal processing", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1125#discussion_r505646321", "createdAt": "2020-10-15T15:41:43Z", "author": {"login": "xin-hedera"}, "path": "hedera-mirror-rest/tokens.js", "diffHunk": "@@ -336,7 +383,28 @@ const getTokenBalances = async (req, res) => {\n     });\n };\n \n+const getToken = async (pgSqlQuery, pgSqlParams) => {\n+  if (logger.isTraceEnabled()) {\n+    logger.trace(`getTokenInfo query: ${pgSqlQuery}, params: ${pgSqlParams}`);\n+  }\n+\n+  return pool\n+    .query(pgSqlQuery, pgSqlParams)\n+    .catch((err) => {\n+      throw new DbError(err.message);\n+    })\n+    .then((results) => {\n+      if (results.rowCount === 1) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "858c11b050aa8ac1efe584009623327190ed7902"}, "originalPosition": 96}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTY0ODgzOA==", "bodyText": "it's changed to tokenId in token balances API", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1125#discussion_r505648838", "createdAt": "2020-10-15T15:45:12Z", "author": {"login": "xin-hedera"}, "path": "hedera-mirror-rest/__tests__/specs/token-info-02-invalid-id.spec.json", "diffHunk": "@@ -0,0 +1,54 @@\n+{\n+  \"description\": \"Token info api call for a given token\",\n+  \"setup\": {\n+    \"accounts\": [\n+      {\n+        \"entity_num\": 1\n+      },\n+      {\n+        \"entity_num\": 1135\n+      },\n+      {\n+        \"entity_realm\": 7,\n+        \"entity_num\": 25301\n+      },\n+      {\n+        \"entity_realm\": 23,\n+        \"entity_num\": 45678\n+      }\n+    ],\n+    \"tokens\": [\n+      {\n+        \"token_id\": \"0.0.1\",\n+        \"symbol\": \"FIRSTMOVERLPDJH\"\n+      },\n+      {\n+        \"token_id\": \"0.0.1135\",\n+        \"symbol\": \"ORIGINALRDKSE\"\n+      },\n+      {\n+        \"token_id\": \"0.7.25301\",\n+        \"symbol\": \"MIRRORTOKEN\"\n+      },\n+      {\n+        \"token_id\": \"0.23.45678\",\n+        \"symbol\": \"HEDERACOIN\"\n+      }\n+    ],\n+    \"balances\": [],\n+    \"transactions\": [],\n+    \"cryptotransfers\": [],\n+    \"tokentransfers\": []\n+  },\n+  \"url\": \"/api/v1/tokens/abc\",\n+  \"responseStatus\": 400,\n+  \"responseJson\": {\n+    \"_status\": {\n+      \"messages\": [\n+        {\n+          \"message\": \"Invalid parameter: token.id\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "858c11b050aa8ac1efe584009623327190ed7902"}, "originalPosition": 49}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ff4e1f138b4a4d967c9530ea1cdf5b69d12875e6", "author": {"user": {"login": "Nana-EC", "name": null}}, "url": "https://github.com/hashgraph/hedera-mirror-node/commit/ff4e1f138b4a4d967c9530ea1cdf5b69d12875e6", "committedDate": "2020-10-15T19:59:44Z", "message": "Updated Entity fromString to handle nulls and added fromInt method. Address other feeedback also\n\nSigned-off-by: Nana-EC <56320167+Nana-EC@users.noreply.github.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwNjY0MjU5", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1125#pullrequestreview-510664259", "createdAt": "2020-10-16T17:23:44Z", "commit": {"oid": "ff4e1f138b4a4d967c9530ea1cdf5b69d12875e6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEwNjgzMTM0", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1125#pullrequestreview-510683134", "createdAt": "2020-10-16T17:47:56Z", "commit": {"oid": "ff4e1f138b4a4d967c9530ea1cdf5b69d12875e6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3588, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}