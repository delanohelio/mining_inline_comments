{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE4NDY5NzMx", "number": 586, "title": "Add QPS limit when querying account to prevent performanceDT pressure test failure when QPS limit is turned on", "bodyText": "", "createdAt": "2020-05-15T09:07:56Z", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/586", "merged": true, "mergeCommit": {"oid": "04178db0070694c10fe2afcc1ae76c86e77120ed"}, "closed": true, "closedAt": "2020-05-15T09:23:57Z", "author": {"login": "cyjseagull"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcheX_EAFqTQxMjQ3NjEwNw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABchemVCAFqTQxMjQ4NzM3OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyNDc2MTA3", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/586#pullrequestreview-412476107", "createdAt": "2020-05-15T09:08:56Z", "commit": {"oid": "5f94605c5585acbb76d501f1d36b3619c5bd17fe"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQwOTowODo1NlrOGV8xAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQwOTowODo1NlrOGV8xAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTY2ODg2Nw==", "bodyText": "[PMD] Potential violation of Law of Demeter (object not created locally) (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nLawOfDemeter\nDesign\n3\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.23.0/pmd_rules_java_design.html#lawofdemeter\n\nYou can close this issue if no need to fix it. Learn more.", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/586#discussion_r425668867", "createdAt": "2020-05-15T09:08:56Z", "author": {"login": "sider"}, "path": "src/test/java/org/fisco/bcos/channel/test/parallel/precompile/PerformanceDTTest.java", "diffHunk": "@@ -230,6 +230,7 @@ public void userAddTest(BigInteger count, BigInteger qps) {\n \n             for (Integer i = 0; i < count.intValue(); ++i) {\n                 final int index = i;\n+                limiter.acquire();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5f94605c5585acbb76d501f1d36b3619c5bd17fe"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyNDc2MTE4", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/586#pullrequestreview-412476118", "createdAt": "2020-05-15T09:08:57Z", "commit": {"oid": "5f94605c5585acbb76d501f1d36b3619c5bd17fe"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQwOTowODo1N1rOGV8xEA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQwOTowODo1N1rOGV8xEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTY2ODg4MA==", "bodyText": "[PMD] Potential violation of Law of Demeter (object not created locally) (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nLawOfDemeter\nDesign\n3\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.23.0/pmd_rules_java_design.html#lawofdemeter\n\nYou can close this issue if no need to fix it. Learn more.", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/586#discussion_r425668880", "createdAt": "2020-05-15T09:08:57Z", "author": {"login": "sider"}, "path": "src/test/java/org/fisco/bcos/channel/test/parallel/parallelok/PerformanceDTTest.java", "diffHunk": "@@ -440,6 +440,7 @@ public void userTransferTest(BigInteger count, BigInteger qps, BigInteger deci)\n             AtomicInteger geted = new AtomicInteger(0);\n             for (int i = 0; i < allUser.size(); ++i) {\n                 final Integer _i = i;\n+                limiter.acquire();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5f94605c5585acbb76d501f1d36b3619c5bd17fe"}, "originalPosition": 4}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5f94605c5585acbb76d501f1d36b3619c5bd17fe", "author": {"user": {"login": "cyjseagull", "name": "cyjseagull"}}, "url": "https://github.com/FISCO-BCOS/web3sdk/commit/5f94605c5585acbb76d501f1d36b3619c5bd17fe", "committedDate": "2020-05-15T09:07:07Z", "message": "Add QPS limit when querying account to prevent performanceDT pressure test failure when QPS limit is turned on"}, "afterCommit": {"oid": "0b0a501a689ac19cc5910dfe9a1e06c3d57d3372", "author": {"user": {"login": "cyjseagull", "name": "cyjseagull"}}, "url": "https://github.com/FISCO-BCOS/web3sdk/commit/0b0a501a689ac19cc5910dfe9a1e06c3d57d3372", "committedDate": "2020-05-15T09:10:00Z", "message": "Add QPS limit when querying account to prevent performanceDT pressure test failure when QPS limit is turned on"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyNDc3ODE4", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/586#pullrequestreview-412477818", "createdAt": "2020-05-15T09:11:25Z", "commit": {"oid": "0b0a501a689ac19cc5910dfe9a1e06c3d57d3372"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQwOToxMToyNVrOGV82aQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQwOToxMToyNVrOGV82aQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTY3MDI0OQ==", "bodyText": "[PMD] Potential violation of Law of Demeter (object not created locally) (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nLawOfDemeter\nDesign\n3\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.23.0/pmd_rules_java_design.html#lawofdemeter\n\nYou can close this issue if no need to fix it. Learn more.", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/586#discussion_r425670249", "createdAt": "2020-05-15T09:11:25Z", "author": {"login": "sider"}, "path": "src/test/java/org/fisco/bcos/channel/test/parallel/parallelok/PerformanceDTTest.java", "diffHunk": "@@ -433,13 +433,15 @@ public void userTransferTest(BigInteger count, BigInteger qps, BigInteger deci)\n             threadPool.setMaxPoolSize(500);\n             threadPool.setQueueCapacity(Math.max(count.intValue(), allUser.size()) + 1000);\n             threadPool.initialize();\n+            RateLimiter limiter = RateLimiter.create(qps.intValue());\n \n             Lock lock = new ReentrantLock();\n \n             final ParallelOk _parallelok = parallelok;\n             AtomicInteger geted = new AtomicInteger(0);\n             for (int i = 0; i < allUser.size(); ++i) {\n                 final Integer _i = i;\n+                limiter.acquire();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0b0a501a689ac19cc5910dfe9a1e06c3d57d3372"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ee1f4337063721822de72728aaa6a92ae1e0eefa", "author": {"user": {"login": "cyjseagull", "name": "cyjseagull"}}, "url": "https://github.com/FISCO-BCOS/web3sdk/commit/ee1f4337063721822de72728aaa6a92ae1e0eefa", "committedDate": "2020-05-15T09:15:22Z", "message": "Add QPS limit when querying account to prevent performanceDT pressure test failure when QPS limit is turned on"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0b0a501a689ac19cc5910dfe9a1e06c3d57d3372", "author": {"user": {"login": "cyjseagull", "name": "cyjseagull"}}, "url": "https://github.com/FISCO-BCOS/web3sdk/commit/0b0a501a689ac19cc5910dfe9a1e06c3d57d3372", "committedDate": "2020-05-15T09:10:00Z", "message": "Add QPS limit when querying account to prevent performanceDT pressure test failure when QPS limit is turned on"}, "afterCommit": {"oid": "ee1f4337063721822de72728aaa6a92ae1e0eefa", "author": {"user": {"login": "cyjseagull", "name": "cyjseagull"}}, "url": "https://github.com/FISCO-BCOS/web3sdk/commit/ee1f4337063721822de72728aaa6a92ae1e0eefa", "committedDate": "2020-05-15T09:15:22Z", "message": "Add QPS limit when querying account to prevent performanceDT pressure test failure when QPS limit is turned on"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyNDgxNjQw", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/586#pullrequestreview-412481640", "createdAt": "2020-05-15T09:16:44Z", "commit": {"oid": "ee1f4337063721822de72728aaa6a92ae1e0eefa"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQwOToxNjo0NFrOGV9CbA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQwOToxNjo0NFrOGV9CbA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTY3MzMyNA==", "bodyText": "[PMD] Potential violation of Law of Demeter (object not created locally) (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nLawOfDemeter\nDesign\n3\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.23.0/pmd_rules_java_design.html#lawofdemeter\n\nYou can close this issue if no need to fix it. Learn more.", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/586#discussion_r425673324", "createdAt": "2020-05-15T09:16:44Z", "author": {"login": "sider"}, "path": "src/test/java/org/fisco/bcos/channel/test/parallel/precompile/PerformanceDTTest.java", "diffHunk": "@@ -419,11 +419,13 @@ public void userTransferTest(BigInteger count, BigInteger qps, BigInteger deci)\n             threadPool.setMaxPoolSize(500);\n             threadPool.setQueueCapacity(Math.max(count.intValue(), allUser.size()));\n             threadPool.initialize();\n+            RateLimiter limiter = RateLimiter.create(qps.intValue());\n \n             final DagTransfer _dagTransfer = dagTransfer;\n             AtomicInteger geted = new AtomicInteger(0);\n             for (int i = 0; i < allUser.size(); ++i) {\n                 final Integer _i = i;\n+                limiter.acquire();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ee1f4337063721822de72728aaa6a92ae1e0eefa"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyNDg1NTk0", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/586#pullrequestreview-412485594", "createdAt": "2020-05-15T09:22:08Z", "commit": {"oid": "ee1f4337063721822de72728aaa6a92ae1e0eefa"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyNDg2NDcz", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/586#pullrequestreview-412486473", "createdAt": "2020-05-15T09:23:22Z", "commit": {"oid": "ee1f4337063721822de72728aaa6a92ae1e0eefa"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyNDg3Mzc5", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/586#pullrequestreview-412487379", "createdAt": "2020-05-15T09:24:36Z", "commit": {"oid": "ee1f4337063721822de72728aaa6a92ae1e0eefa"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1934, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}