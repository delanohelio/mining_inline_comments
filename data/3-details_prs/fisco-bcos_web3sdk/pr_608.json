{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMyODg1MTI2", "number": 608, "title": "remove fastjson", "bodyText": "", "createdAt": "2020-06-11T07:12:53Z", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/608", "merged": true, "mergeCommit": {"oid": "18c96f55826e36b5199b1f63ab52367b080cb66a"}, "closed": true, "closedAt": "2020-06-11T07:14:06Z", "author": {"login": "ywy2090"}, "timelineItems": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcqIzsGAH2gAyNDMyODg1MTI2Ojk1ZjBhZGU0Nzk3MGVhYjIxOTQ2MDhjZjc5ZmI1NDA4YzIzOGVkOTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcqI6FRgFqTQyODY0ODcxMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "95f0ade47970eab2194608cf79fb5408c238ed94", "author": {"user": {"login": "ywy2090", "name": null}}, "url": "https://github.com/FISCO-BCOS/web3sdk/commit/95f0ade47970eab2194608cf79fb5408c238ed94", "committedDate": "2020-06-11T07:06:36Z", "message": "remove fastjson"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI4NjQ4NzEz", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/608#pullrequestreview-428648713", "createdAt": "2020-06-11T07:13:33Z", "commit": {"oid": "95f0ade47970eab2194608cf79fb5408c238ed94"}, "state": "COMMENTED", "comments": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQwNzoxMzozM1rOGiRPxQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQwNzoxMzozNVrOGiRP1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODU4NzMzMw==", "bodyText": "[PMD Java] This for loop can be replaced by a foreach loop (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nForLoopCanBeForeach\nBest Practices\n3\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.23.0/pmd_rules_java_bestpractices.html#forloopcanbeforeach\n\nYou can close this issue if no need to fix it. Learn more.", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/608#discussion_r438587333", "createdAt": "2020-06-11T07:13:33Z", "author": {"login": "sider"}, "path": "src/main/java/org/bcos/contract/tools/CNSCmdTool.java", "diffHunk": "@@ -83,16 +82,16 @@ public static String getAddr(String addrPath) throws IOException {\n \t */\n \tpublic static boolean isContractHasVersion(String abi) throws Exception {\n \t\ttry {\n-\t\t\tJSONArray a = JSON.parseArray(abi);\n-\t\t\tfor(int i=0;i<a.size();++i) {\n-\t\t\t\tJSONObject o = a.getJSONObject(i);\n-\t\t\t\t//if abi has function member getVersion , then maybe the contract has version\n-\t\t\t\tif(o.containsKey(\"name\") && o.getString(\"name\").equals(\"getVersion\")) {\n+\t\t\tObjectMapper objectMapper = ObjectMapperFactory.getObjectMapper();\n+\t\t\tAbiDefinition[] abiDefinition = objectMapper.readValue(abi, AbiDefinition[].class);\n+\n+\t\t\tfor (int i = 0; i < abiDefinition.length; i++) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "95f0ade47970eab2194608cf79fb5408c238ed94"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODU4NzMzNA==", "bodyText": "[PMD Java] Potential violation of Law of Demeter (method chain calls) (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nLawOfDemeter\nDesign\n3\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.23.0/pmd_rules_java_design.html#lawofdemeter\n\nYou can close this issue if no need to fix it. Learn more.", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/608#discussion_r438587334", "createdAt": "2020-06-11T07:13:33Z", "author": {"login": "sider"}, "path": "src/main/java/org/bcos/contract/tools/CNSCmdTool.java", "diffHunk": "@@ -83,16 +82,16 @@ public static String getAddr(String addrPath) throws IOException {\n \t */\n \tpublic static boolean isContractHasVersion(String abi) throws Exception {\n \t\ttry {\n-\t\t\tJSONArray a = JSON.parseArray(abi);\n-\t\t\tfor(int i=0;i<a.size();++i) {\n-\t\t\t\tJSONObject o = a.getJSONObject(i);\n-\t\t\t\t//if abi has function member getVersion , then maybe the contract has version\n-\t\t\t\tif(o.containsKey(\"name\") && o.getString(\"name\").equals(\"getVersion\")) {\n+\t\t\tObjectMapper objectMapper = ObjectMapperFactory.getObjectMapper();\n+\t\t\tAbiDefinition[] abiDefinition = objectMapper.readValue(abi, AbiDefinition[].class);\n+\n+\t\t\tfor (int i = 0; i < abiDefinition.length; i++) {\n+\t\t\t\tif (abiDefinition[i].getType().equals(\"function\") && abiDefinition[i].getName().equals(\"getVersion\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "95f0ade47970eab2194608cf79fb5408c238ed94"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODU4NzMzNg==", "bodyText": "[PMD Java] The class 'Account' is suspected to be a Data Class (WOC=0.000%, NOPA=0, NOAM=6, WMC=6) (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nDataClass\nDesign\n3\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.23.0/pmd_rules_java_design.html#dataclass\n\nYou can close this issue if no need to fix it. Learn more.", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/608#discussion_r438587336", "createdAt": "2020-06-11T07:13:33Z", "author": {"login": "sider"}, "path": "src/main/java/org/bcos/contract/tools/KeyInfo.java", "diffHunk": "@@ -39,6 +30,36 @@\n     KeyInfo() {\r\n     }\r\n \r\n+    private static class Account {\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "95f0ade47970eab2194608cf79fb5408c238ed94"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODU4NzMzNw==", "bodyText": "[PMD Java] It is somewhat confusing to have a field name matching the declaring class name (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nAvoidFieldNameMatchingTypeName\nError Prone\n3\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.23.0/pmd_rules_java_errorprone.html#avoidfieldnamematchingtypename\n\nYou can close this issue if no need to fix it. Learn more.", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/608#discussion_r438587337", "createdAt": "2020-06-11T07:13:34Z", "author": {"login": "sider"}, "path": "src/main/java/org/bcos/contract/tools/KeyInfo.java", "diffHunk": "@@ -39,6 +30,36 @@\n     KeyInfo() {\r\n     }\r\n \r\n+    private static class Account {\r\n+        private String privateKey;\r\n+        private String publicKey;\r\n+        private String account;\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "95f0ade47970eab2194608cf79fb5408c238ed94"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODU4NzMzOA==", "bodyText": "[PMD Java] Potential violation of Law of Demeter (method chain calls) (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nLawOfDemeter\nDesign\n3\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.23.0/pmd_rules_java_design.html#lawofdemeter\n\nYou can close this issue if no need to fix it. Learn more.", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/608#discussion_r438587338", "createdAt": "2020-06-11T07:13:34Z", "author": {"login": "sider"}, "path": "src/main/java/org/bcos/contract/tools/KeyInfo.java", "diffHunk": "@@ -129,18 +150,13 @@ public int loadKeyInfo(String keyFile) {\n         System.out.println(\"\");\r\n         System.out.println(\"===key info:\" + keyInfoJsonStr);\r\n         try {\r\n-            JSONObject keyInfoJsonObj = JSONObject.parseObject(keyInfoJsonStr);\r\n-            if (keyInfoJsonObj == null) {\r\n-                System.out.println(\"load json str from key info failed\");\r\n-                logger.error(\"load json str from key info failed\");\r\n-                return RetCode.parseJsonFailed;\r\n-            }\r\n-            if (keyInfoJsonObj.containsKey(privJsonKey))\r\n-                privateKey = keyInfoJsonObj.getString(privJsonKey);\r\n-            if (keyInfoJsonObj.containsKey(pubJsonKey))\r\n-                publicKey = keyInfoJsonObj.getString(pubJsonKey);\r\n-            if (keyInfoJsonObj.containsKey(accountJsonKey))\r\n-                account = keyInfoJsonObj.getString(accountJsonKey);\r\n+            Account key =\r\n+                    ObjectMapperFactory.getObjectMapper().readValue(keyInfoJsonStr, Account.class);\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "95f0ade47970eab2194608cf79fb5408c238ed94"}, "originalPosition": 77}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODU4NzM0MQ==", "bodyText": "[PMD Java] Potential violation of Law of Demeter (method chain calls) (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nLawOfDemeter\nDesign\n3\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.23.0/pmd_rules_java_design.html#lawofdemeter\n\nYou can close this issue if no need to fix it. Learn more.", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/608#discussion_r438587341", "createdAt": "2020-06-11T07:13:34Z", "author": {"login": "sider"}, "path": "src/main/java/org/bcos/contract/tools/KeyInfo.java", "diffHunk": "@@ -178,14 +194,13 @@ private static int writeFile(String keyFile, String content) {\n      */\r\n     @Override\r\n     public int storeKeyInfo(String keyFile) {\r\n-        try {\r\n-            //Map<String, String> keyMap = new HashMap<String, String>();\r\n-            JSONObject keyMapJson = new JSONObject();\r\n-            keyMapJson.put(privJsonKey, privateKey);\r\n-            keyMapJson.put(pubJsonKey, publicKey);\r\n-            keyMapJson.put(accountJsonKey, account);\r\n+    \ttry {\r\n+            Account key = new Account();\r\n+            key.setPrivateKey(getPrivateKey());\r\n+            key.setPublicKey(getPublicKey());\r\n+            key.setAccount(getAccount());\r\n \r\n-            String keyJsonInfo = keyMapJson.toString();\r\n+            String keyJsonInfo = ObjectMapperFactory.getObjectMapper().writeValueAsString(key);\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "95f0ade47970eab2194608cf79fb5408c238ed94"}, "originalPosition": 103}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODU4NzM0Mw==", "bodyText": "[PMD Java] Potential violation of Law of Demeter (method chain calls) (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nLawOfDemeter\nDesign\n3\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.23.0/pmd_rules_java_design.html#lawofdemeter\n\nYou can close this issue if no need to fix it. Learn more.", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/608#discussion_r438587343", "createdAt": "2020-06-11T07:13:34Z", "author": {"login": "sider"}, "path": "src/main/java/org/bcos/web3j/console/Web3RpcApi.java", "diffHunk": "@@ -129,9 +130,10 @@ public static void main(String[] args)  {\n         \t\t}\r\n \t\t\t\ttransactionIndex = new BigInteger(args[2]);\r\n \t\t\t\ttransaction=web3j.ethGetTransactionByBlockHashAndIndex(args[1], transactionIndex).send().getResult();\r\n-\t\t\t\t\r\n-\t\t\t\tString transactionJson1=JSONObject.toJSONString(transaction);\r\n-\t\t\t\tSystem.out.println(transactionJson1);\r\n+\r\n+\t\t\t\tString transactionJson = ObjectMapperFactory.getObjectMapper().writeValueAsString(transaction);\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "95f0ade47970eab2194608cf79fb5408c238ed94"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODU4NzM0NQ==", "bodyText": "[PMD Java] System.out.println is used (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nSystemPrintln\nBest Practices\n2\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.23.0/pmd_rules_java_bestpractices.html#systemprintln\n\nYou can close this issue if no need to fix it. Learn more.", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/608#discussion_r438587345", "createdAt": "2020-06-11T07:13:34Z", "author": {"login": "sider"}, "path": "src/main/java/org/bcos/web3j/console/Web3RpcApi.java", "diffHunk": "@@ -129,9 +130,10 @@ public static void main(String[] args)  {\n         \t\t}\r\n \t\t\t\ttransactionIndex = new BigInteger(args[2]);\r\n \t\t\t\ttransaction=web3j.ethGetTransactionByBlockHashAndIndex(args[1], transactionIndex).send().getResult();\r\n-\t\t\t\t\r\n-\t\t\t\tString transactionJson1=JSONObject.toJSONString(transaction);\r\n-\t\t\t\tSystem.out.println(transactionJson1);\r\n+\r\n+\t\t\t\tString transactionJson = ObjectMapperFactory.getObjectMapper().writeValueAsString(transaction);\r\n+\t\t\t\t// String transactionJson=JSONObject.toJSONString(transaction);\r\n+\t\t\t\tSystem.out.println(transactionJson);\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "95f0ade47970eab2194608cf79fb5408c238ed94"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODU4NzM0Ng==", "bodyText": "[PMD Java] Potential violation of Law of Demeter (method chain calls) (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nLawOfDemeter\nDesign\n3\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.23.0/pmd_rules_java_design.html#lawofdemeter\n\nYou can close this issue if no need to fix it. Learn more.", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/608#discussion_r438587346", "createdAt": "2020-06-11T07:13:35Z", "author": {"login": "sider"}, "path": "src/main/java/org/bcos/web3j/console/Web3RpcApi.java", "diffHunk": "@@ -142,14 +144,16 @@ public static void main(String[] args)  {\n \t\t\t\tbigBlockHeight = new BigInteger(args[1]);\r\n \t\t\t\ttransactionIndex = new BigInteger(args[2]);\r\n \t\t\t\ttransaction =web3j.ethGetTransactionByBlockNumberAndIndex(DefaultBlockParameter.valueOf(bigBlockHeight), transactionIndex).send().getResult();\r\n-\t\t\t\tString transactionJson=JSONObject.toJSONString(transaction);\r\n-\t\t\t\tSystem.out.println(transactionJson);\r\n+\t\t\t\tString transactionJson1 = ObjectMapperFactory.getObjectMapper().writeValueAsString(transaction);\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "95f0ade47970eab2194608cf79fb5408c238ed94"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODU4NzM0Nw==", "bodyText": "[PMD Java] System.out.println is used (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nSystemPrintln\nBest Practices\n2\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.23.0/pmd_rules_java_bestpractices.html#systemprintln\n\nYou can close this issue if no need to fix it. Learn more.", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/608#discussion_r438587347", "createdAt": "2020-06-11T07:13:35Z", "author": {"login": "sider"}, "path": "src/main/java/org/bcos/web3j/console/Web3RpcApi.java", "diffHunk": "@@ -142,14 +144,16 @@ public static void main(String[] args)  {\n \t\t\t\tbigBlockHeight = new BigInteger(args[1]);\r\n \t\t\t\ttransactionIndex = new BigInteger(args[2]);\r\n \t\t\t\ttransaction =web3j.ethGetTransactionByBlockNumberAndIndex(DefaultBlockParameter.valueOf(bigBlockHeight), transactionIndex).send().getResult();\r\n-\t\t\t\tString transactionJson=JSONObject.toJSONString(transaction);\r\n-\t\t\t\tSystem.out.println(transactionJson);\r\n+\t\t\t\tString transactionJson1 = ObjectMapperFactory.getObjectMapper().writeValueAsString(transaction);\r\n+\t\t\t\t// String transactionJson=JSONObject.toJSONString(transaction);\r\n+\t\t\t\tSystem.out.println(transactionJson1);\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "95f0ade47970eab2194608cf79fb5408c238ed94"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODU4NzM1MA==", "bodyText": "[PMD Java] Potential violation of Law of Demeter (method chain calls) (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nLawOfDemeter\nDesign\n3\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.23.0/pmd_rules_java_design.html#lawofdemeter\n\nYou can close this issue if no need to fix it. Learn more.", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/608#discussion_r438587350", "createdAt": "2020-06-11T07:13:35Z", "author": {"login": "sider"}, "path": "src/main/java/org/bcos/web3j/console/Web3RpcApi.java", "diffHunk": "@@ -142,14 +144,16 @@ public static void main(String[] args)  {\n \t\t\t\tbigBlockHeight = new BigInteger(args[1]);\r\n \t\t\t\ttransactionIndex = new BigInteger(args[2]);\r\n \t\t\t\ttransaction =web3j.ethGetTransactionByBlockNumberAndIndex(DefaultBlockParameter.valueOf(bigBlockHeight), transactionIndex).send().getResult();\r\n-\t\t\t\tString transactionJson=JSONObject.toJSONString(transaction);\r\n-\t\t\t\tSystem.out.println(transactionJson);\r\n+\t\t\t\tString transactionJson1 = ObjectMapperFactory.getObjectMapper().writeValueAsString(transaction);\r\n+\t\t\t\t// String transactionJson=JSONObject.toJSONString(transaction);\r\n+\t\t\t\tSystem.out.println(transactionJson1);\r\n \t\t\t\tbreak;\r\n \t\t\t\t\r\n \t\t\tcase \"eth_getTransactionReceipt\":\t\r\n \t\t\t\t\r\n \t\t\t\tTransactionReceipt receipt = web3j.ethGetTransactionReceipt(args[1]).send().getResult();\r\n-\t\t\t\tString receiptJson=JSONObject.toJSONString(receipt);\r\n+\t\t\t\tString receiptJson = ObjectMapperFactory.getObjectMapper().writeValueAsString(receipt);\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "95f0ade47970eab2194608cf79fb5408c238ed94"}, "originalPosition": 41}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1990, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}