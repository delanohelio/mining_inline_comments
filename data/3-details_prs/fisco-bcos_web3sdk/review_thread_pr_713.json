{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk1MzY0MjA1", "number": 713, "reviewThreads": {"totalCount": 30, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwOTowOTowNlrOEo8LTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwOTowOToxMlrOEo8Lhw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMzY0NDI4OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/fisco/bcos/web3j/precompile/consensus/ConsensusService.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwOTowOTowNlrOHaUX8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwOTowOTowNlrOHaUX8A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzM1ODgzMg==", "bodyText": "[PMD Java] Avoid catching generic exceptions such as NullPointerException, RuntimeException, Exception in try-catch block (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nAvoidCatchingGenericException\nDesign\n3\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.27.0/pmd_rules_java_design.html#avoidcatchinggenericexception\n\nYou can close this issue if no need to fix it. Learn more.", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/713#discussion_r497358832", "createdAt": "2020-09-30T09:09:06Z", "author": {"login": "sider"}, "path": "src/main/java/org/fisco/bcos/web3j/precompile/consensus/ConsensusService.java", "diffHunk": "@@ -26,34 +26,50 @@ public ConsensusService(Web3j web3j, Credentials credentials) {\n     }\n \n     public String addSealer(String nodeID) throws Exception {\n-        if (!isValidNodeID(nodeID)) {\n-            return PrecompiledCommon.transferToJson(PrecompiledCommon.P2pNetwork);\n-        }\n-        List<String> sealerList = web3j.getSealerList().send().getResult();\n-        if (sealerList.contains(nodeID)) {\n-            return PrecompiledCommon.transferToJson(PrecompiledCommon.SealerList);\n-        }\n-        TransactionReceipt receipt = consensus.addSealer(nodeID).send();\n+        TransactionReceipt receipt = addSealerAndRetReceipt(nodeID);\n         return PrecompiledCommon.handleTransactionReceipt(receipt, web3j);\n     }\n \n+    public TransactionReceipt addSealerAndRetReceipt(String nodeID) throws Exception {\n+        return consensus.addSealer(nodeID).send();\n+    }\n+\n     public String addObserver(String nodeID) throws Exception {\n-        if (!isValidNodeID(nodeID)) {\n-            return PrecompiledCommon.transferToJson(PrecompiledCommon.P2pNetwork);\n-        }\n-        List<String> observerList = web3j.getObserverList().send().getResult();\n-        if (observerList.contains(nodeID)) {\n-            return PrecompiledCommon.transferToJson(PrecompiledCommon.ObserverList);\n-        }\n-        TransactionReceipt receipt = consensus.addObserver(nodeID).send();\n+        TransactionReceipt receipt = addObserverAndRetReceipt(nodeID);\n         return PrecompiledCommon.handleTransactionReceipt(receipt, web3j);\n     }\n \n+    public TransactionReceipt addObserverAndRetReceipt(String nodeID) throws Exception {\n+        return consensus.addObserver(nodeID).send();\n+    }\n+\n     public String removeNode(String nodeId) throws Exception {\n         List<String> groupPeers = web3j.getGroupPeers().send().getResult();\n         if (!groupPeers.contains(nodeId)) {\n             return PrecompiledCommon.transferToJson(PrecompiledCommon.GroupPeers);\n         }\n+        TransactionReceipt receipt = null;\n+        try {\n+            receipt = removeNodeAndRetReceipt(nodeId);\n+        } catch (RuntimeException e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "14b2987801cbc9d69fb8de19e91a8ecd3ddda385"}, "originalPosition": 45}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMzY0NDI5OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/fisco/bcos/web3j/protocol/core/JsonRpc2_0Web3j.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwOTowOTowN1rOHaUX9A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwOTowOTowN1rOHaUX9A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzM1ODgzNg==", "bodyText": "[PMD Java] Avoid catching generic exceptions such as NullPointerException, RuntimeException, Exception in try-catch block (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nAvoidCatchingGenericException\nDesign\n3\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.27.0/pmd_rules_java_design.html#avoidcatchinggenericexception\n\nYou can close this issue if no need to fix it. Learn more.", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/713#discussion_r497358836", "createdAt": "2020-09-30T09:09:07Z", "author": {"login": "sider"}, "path": "src/main/java/org/fisco/bcos/web3j/protocol/core/JsonRpc2_0Web3j.java", "diffHunk": "@@ -132,6 +132,19 @@ public BigInteger getBlockNumberCache() {\n         return getLocalBlockNumber().add(new BigInteger(BlockLimit.blockLimit.toString()));\n     }\n \n+    @Override\n+    public BigInteger getBlockLimit() {\n+        if (getLocalBlockNumber().intValue() == 1) {\n+            try {\n+                BlockNumber blockNumber = getBlockNumber().sendAsync().get();\n+                setBlockNumber(blockNumber.getBlockNumber());\n+            } catch (Exception e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "14b2987801cbc9d69fb8de19e91a8ecd3ddda385"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMzY0NDMxOnYy", "diffSide": "RIGHT", "path": "src/main/java/org/fisco/bcos/web3j/abi/wrapper/ABIObject.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwOTowOTowN1rOHaUX9w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwOTowOTowN1rOHaUX9w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzM1ODgzOQ==", "bodyText": "[PMD Java] Avoid using Literals in Conditional Statements (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nAvoidLiteralsInIfCondition\nError Prone\n3\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.27.0/pmd_rules_java_errorprone.html#avoidliteralsinifcondition\n\nYou can close this issue if no need to fix it. Learn more.", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/713#discussion_r497358839", "createdAt": "2020-09-30T09:09:07Z", "author": {"login": "sider"}, "path": "src/main/java/org/fisco/bcos/web3j/abi/wrapper/ABIObject.java", "diffHunk": "@@ -349,6 +350,10 @@ public String encode() {\n                             }\n                         case BYTES:\n                             {\n+                                if (bytesValue.getValue().length > 32) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "14b2987801cbc9d69fb8de19e91a8ecd3ddda385"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMzY0NDM0OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/fisco/bcos/web3j/protocol/core/JsonRpc2_0Web3j.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwOTowOTowN1rOHaUX-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwOTowOTowN1rOHaUX-g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzM1ODg0Mg==", "bodyText": "[PMD Java] Avoid using Literals in Conditional Statements (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nAvoidLiteralsInIfCondition\nError Prone\n3\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.27.0/pmd_rules_java_errorprone.html#avoidliteralsinifcondition\n\nYou can close this issue if no need to fix it. Learn more.", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/713#discussion_r497358842", "createdAt": "2020-09-30T09:09:07Z", "author": {"login": "sider"}, "path": "src/main/java/org/fisco/bcos/web3j/protocol/core/JsonRpc2_0Web3j.java", "diffHunk": "@@ -132,6 +132,19 @@ public BigInteger getBlockNumberCache() {\n         return getLocalBlockNumber().add(new BigInteger(BlockLimit.blockLimit.toString()));\n     }\n \n+    @Override\n+    public BigInteger getBlockLimit() {\n+        if (getLocalBlockNumber().intValue() == 1) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "14b2987801cbc9d69fb8de19e91a8ecd3ddda385"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMzY0NDM1OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/fisco/bcos/web3j/protocol/core/methods/response/ConsensusStatus.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwOTowOTowN1rOHaUX-w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwOTowOTowN1rOHaUX-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzM1ODg0Mw==", "bodyText": "[PMD Java] Avoid using Literals in Conditional Statements (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nAvoidLiteralsInIfCondition\nError Prone\n3\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.27.0/pmd_rules_java_errorprone.html#avoidliteralsinifcondition\n\nYou can close this issue if no need to fix it. Learn more.", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/713#discussion_r497358843", "createdAt": "2020-09-30T09:09:07Z", "author": {"login": "sider"}, "path": "src/main/java/org/fisco/bcos/web3j/protocol/core/methods/response/ConsensusStatus.java", "diffHunk": "@@ -1,10 +1,460 @@\n package org.fisco.bcos.web3j.protocol.core.methods.response;\n \n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import com.fasterxml.jackson.core.JsonParser;\n+import com.fasterxml.jackson.core.type.TypeReference;\n+import com.fasterxml.jackson.databind.DeserializationContext;\n+import com.fasterxml.jackson.databind.JsonDeserializer;\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.databind.annotation.JsonDeserialize;\n+import java.io.IOException;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Objects;\n+import org.fisco.bcos.web3j.protocol.ObjectMapperFactory;\n import org.fisco.bcos.web3j.protocol.core.Response;\n \n /** getConsensusStatus */\n-public class ConsensusStatus extends Response<String> {\n-    public String getConsensusStatus() {\n+public class ConsensusStatus extends Response<ConsensusStatus.ConsensusInfo> {\n+    @Override\n+    @JsonDeserialize(using = ConsensusStatusDeserializer.class)\n+    public void setResult(ConsensusStatus.ConsensusInfo result) {\n+        super.setResult(result);\n+    }\n+\n+    public ConsensusInfo getConsensusStatus() {\n         return getResult();\n     }\n+\n+    public static class ViewInfo {\n+        private String nodeId;\n+        private String view;\n+\n+        public String getNodeId() {\n+            return nodeId;\n+        }\n+\n+        public void setNodeId(String nodeId) {\n+            this.nodeId = nodeId;\n+        }\n+\n+        public String getView() {\n+            return view;\n+        }\n+\n+        public void setView(String view) {\n+            this.view = view;\n+        }\n+\n+        @Override\n+        public boolean equals(Object o) {\n+            if (this == o) return true;\n+            if (o == null || getClass() != o.getClass()) return false;\n+            ViewInfo viewInfo = (ViewInfo) o;\n+            return Objects.equals(nodeId, viewInfo.nodeId) && Objects.equals(view, viewInfo.view);\n+        }\n+\n+        @Override\n+        public int hashCode() {\n+            return Objects.hash(nodeId, view);\n+        }\n+\n+        @Override\n+        public String toString() {\n+            return \"ViewInfo{\" + \"nodeId='\" + nodeId + '\\'' + \", view='\" + view + '\\'' + '}';\n+        }\n+    }\n+\n+    public static class BasicConsensusInfo {\n+        private String nodeNum;\n+\n+        @JsonProperty(\"node_index\")\n+        private String nodeIndex;\n+\n+        @JsonProperty(\"node index\")\n+        private String raftNodeIndex;\n+\n+        @JsonProperty(\"max_faulty_leader\")\n+        private String maxFaultyNodeNum;\n+\n+        @JsonProperty(\"sealer.\")\n+        private List<String> sealerList;\n+\n+        private String consensusedBlockNumber;\n+        private String highestblockNumber;\n+        private String groupId;\n+        private String protocolId;\n+        private String accountType;\n+        private String cfgErr;\n+        private String omitEmptyBlock;\n+        private String nodeId;\n+        private String allowFutureBlocks;\n+        private String connectedNodes;\n+        private String currentView;\n+        private String toView;\n+        private String leaderFailed;\n+        private String highestblockHash;\n+        private String leaderId;\n+        private String leaderIdx;\n+\n+        public String getRaftNodeIndex() {\n+            return raftNodeIndex;\n+        }\n+\n+        public void setRaftNodeIndex(String raftNodeIndex) {\n+            this.raftNodeIndex = raftNodeIndex;\n+        }\n+\n+        public String getLeaderId() {\n+            return leaderId;\n+        }\n+\n+        public void setLeaderId(String leaderId) {\n+            this.leaderId = leaderId;\n+        }\n+\n+        public String getLeaderIdx() {\n+            return leaderIdx;\n+        }\n+\n+        public void setLeaderIdx(String leaderIdx) {\n+            this.leaderIdx = leaderIdx;\n+        }\n+\n+        public String getNodeIndex() {\n+            return nodeIndex;\n+        }\n+\n+        public void setNodeIndex(String nodeIndex) {\n+            this.nodeIndex = nodeIndex;\n+        }\n+\n+        public String getHighestblockHash() {\n+            return highestblockHash;\n+        }\n+\n+        public void setHighestblockHash(String highestblockHash) {\n+            this.highestblockHash = highestblockHash;\n+        }\n+\n+        public String getNodeNum() {\n+            return nodeNum;\n+        }\n+\n+        public void setNodeNum(String nodeNum) {\n+            this.nodeNum = nodeNum;\n+        }\n+\n+        public String getMaxFaultyNodeNum() {\n+            return maxFaultyNodeNum;\n+        }\n+\n+        public void setMaxFaultyNodeNum(String maxFaultyNodeNum) {\n+            this.maxFaultyNodeNum = maxFaultyNodeNum;\n+        }\n+\n+        public List<String> getSealerList() {\n+            return sealerList;\n+        }\n+\n+        public void setSealerList(List<String> sealerList) {\n+            this.sealerList = sealerList;\n+        }\n+\n+        public String getConsensusedBlockNumber() {\n+            return consensusedBlockNumber;\n+        }\n+\n+        public void setConsensusedBlockNumber(String consensusedBlockNumber) {\n+            this.consensusedBlockNumber = consensusedBlockNumber;\n+        }\n+\n+        public String getHighestblockNumber() {\n+            return highestblockNumber;\n+        }\n+\n+        public void setHighestblockNumber(String highestblockNumber) {\n+            this.highestblockNumber = highestblockNumber;\n+        }\n+\n+        public String getGroupId() {\n+            return groupId;\n+        }\n+\n+        public void setGroupId(String groupId) {\n+            this.groupId = groupId;\n+        }\n+\n+        public String getProtocolId() {\n+            return protocolId;\n+        }\n+\n+        public void setProtocolId(String protocolId) {\n+            this.protocolId = protocolId;\n+        }\n+\n+        public String getAccountType() {\n+            return accountType;\n+        }\n+\n+        public void setAccountType(String accountType) {\n+            this.accountType = accountType;\n+        }\n+\n+        public String getCfgErr() {\n+            return cfgErr;\n+        }\n+\n+        public void setCfgErr(String cfgErr) {\n+            this.cfgErr = cfgErr;\n+        }\n+\n+        public String getOmitEmptyBlock() {\n+            return omitEmptyBlock;\n+        }\n+\n+        public void setOmitEmptyBlock(String omitEmptyBlock) {\n+            this.omitEmptyBlock = omitEmptyBlock;\n+        }\n+\n+        public String getNodeId() {\n+            return nodeId;\n+        }\n+\n+        public void setNodeId(String nodeId) {\n+            this.nodeId = nodeId;\n+        }\n+\n+        public String getAllowFutureBlocks() {\n+            return allowFutureBlocks;\n+        }\n+\n+        public void setAllowFutureBlocks(String allowFutureBlocks) {\n+            this.allowFutureBlocks = allowFutureBlocks;\n+        }\n+\n+        public String getConnectedNodes() {\n+            return connectedNodes;\n+        }\n+\n+        public void setConnectedNodes(String connectedNodes) {\n+            this.connectedNodes = connectedNodes;\n+        }\n+\n+        public String getCurrentView() {\n+            return currentView;\n+        }\n+\n+        public void setCurrentView(String currentView) {\n+            this.currentView = currentView;\n+        }\n+\n+        public String getToView() {\n+            return toView;\n+        }\n+\n+        public void setToView(String toView) {\n+            this.toView = toView;\n+        }\n+\n+        public String getLeaderFailed() {\n+            return leaderFailed;\n+        }\n+\n+        public void setLeaderFailed(String leaderFailed) {\n+            this.leaderFailed = leaderFailed;\n+        }\n+\n+        @Override\n+        public boolean equals(Object o) {\n+            if (this == o) return true;\n+            if (o == null || getClass() != o.getClass()) return false;\n+            BasicConsensusInfo that = (BasicConsensusInfo) o;\n+            return Objects.equals(nodeNum, that.nodeNum)\n+                    && Objects.equals(nodeIndex, that.nodeIndex)\n+                    && Objects.equals(maxFaultyNodeNum, that.maxFaultyNodeNum)\n+                    && Objects.equals(sealerList, that.sealerList)\n+                    && Objects.equals(consensusedBlockNumber, that.consensusedBlockNumber)\n+                    && Objects.equals(highestblockNumber, that.highestblockNumber)\n+                    && Objects.equals(groupId, that.groupId)\n+                    && Objects.equals(protocolId, that.protocolId)\n+                    && Objects.equals(accountType, that.accountType)\n+                    && Objects.equals(cfgErr, that.cfgErr)\n+                    && Objects.equals(omitEmptyBlock, that.omitEmptyBlock)\n+                    && Objects.equals(nodeId, that.nodeId)\n+                    && Objects.equals(allowFutureBlocks, that.allowFutureBlocks)\n+                    && Objects.equals(connectedNodes, that.connectedNodes)\n+                    && Objects.equals(currentView, that.currentView)\n+                    && Objects.equals(toView, that.toView)\n+                    && Objects.equals(leaderFailed, that.leaderFailed)\n+                    && Objects.equals(highestblockHash, that.highestblockHash);\n+        }\n+\n+        @Override\n+        public int hashCode() {\n+            return Objects.hash(\n+                    nodeNum,\n+                    nodeIndex,\n+                    maxFaultyNodeNum,\n+                    sealerList,\n+                    consensusedBlockNumber,\n+                    highestblockNumber,\n+                    groupId,\n+                    protocolId,\n+                    accountType,\n+                    cfgErr,\n+                    omitEmptyBlock,\n+                    nodeId,\n+                    allowFutureBlocks,\n+                    connectedNodes,\n+                    currentView,\n+                    toView,\n+                    leaderFailed,\n+                    highestblockHash);\n+        }\n+\n+        @Override\n+        public String toString() {\n+            return \"BasicConsensusInfo{\"\n+                    + \"nodeNum='\"\n+                    + nodeNum\n+                    + '\\''\n+                    + \", nodeIndex='\"\n+                    + nodeIndex\n+                    + '\\''\n+                    + \", maxFaultyNodeNum='\"\n+                    + maxFaultyNodeNum\n+                    + '\\''\n+                    + \", sealerList=\"\n+                    + sealerList\n+                    + \", consensusedBlockNumber='\"\n+                    + consensusedBlockNumber\n+                    + '\\''\n+                    + \", highestblockNumber='\"\n+                    + highestblockNumber\n+                    + '\\''\n+                    + \", groupId='\"\n+                    + groupId\n+                    + '\\''\n+                    + \", protocolId='\"\n+                    + protocolId\n+                    + '\\''\n+                    + \", accountType='\"\n+                    + accountType\n+                    + '\\''\n+                    + \", cfgErr='\"\n+                    + cfgErr\n+                    + '\\''\n+                    + \", omitEmptyBlock='\"\n+                    + omitEmptyBlock\n+                    + '\\''\n+                    + \", nodeId='\"\n+                    + nodeId\n+                    + '\\''\n+                    + \", allowFutureBlocks='\"\n+                    + allowFutureBlocks\n+                    + '\\''\n+                    + \", connectedNodes='\"\n+                    + connectedNodes\n+                    + '\\''\n+                    + \", currentView='\"\n+                    + currentView\n+                    + '\\''\n+                    + \", toView='\"\n+                    + toView\n+                    + '\\''\n+                    + \", leaderFailed='\"\n+                    + leaderFailed\n+                    + '\\''\n+                    + \", highestblockHash='\"\n+                    + highestblockHash\n+                    + '\\''\n+                    + '}';\n+        }\n+    }\n+\n+    public static class ConsensusInfo {\n+        private BasicConsensusInfo baseConsensusInfo;\n+        private List<ViewInfo> viewInfos;\n+\n+        public ConsensusInfo() {}\n+\n+        public ConsensusInfo(BasicConsensusInfo baseConsensusInfo, List<ViewInfo> viewInfos) {\n+            this.baseConsensusInfo = baseConsensusInfo;\n+            this.viewInfos = viewInfos;\n+        }\n+\n+        public BasicConsensusInfo getBaseConsensusInfo() {\n+            return baseConsensusInfo;\n+        }\n+\n+        public void setBaseConsensusInfo(BasicConsensusInfo baseConsensusInfo) {\n+            this.baseConsensusInfo = baseConsensusInfo;\n+        }\n+\n+        public List<ViewInfo> getViewInfos() {\n+            return viewInfos;\n+        }\n+\n+        public void setViewInfos(List<ViewInfo> viewInfos) {\n+            this.viewInfos = viewInfos;\n+        }\n+\n+        @Override\n+        public boolean equals(Object o) {\n+            if (this == o) return true;\n+            if (o == null || getClass() != o.getClass()) return false;\n+            ConsensusInfo that = (ConsensusInfo) o;\n+            return Objects.equals(baseConsensusInfo, that.baseConsensusInfo)\n+                    && Objects.equals(viewInfos, that.viewInfos);\n+        }\n+\n+        @Override\n+        public int hashCode() {\n+            return Objects.hash(baseConsensusInfo, viewInfos);\n+        }\n+\n+        @Override\n+        public String toString() {\n+            return \"ConsensusInfo{\"\n+                    + \"baseConsensusInfo=\"\n+                    + baseConsensusInfo\n+                    + \", viewInfos=\"\n+                    + viewInfos\n+                    + '}';\n+        }\n+    }\n+\n+    public static class ConsensusStatusDeserializer extends JsonDeserializer<ConsensusInfo> {\n+        private ObjectMapper objecMapper = ObjectMapperFactory.getObjectMapper();\n+\n+        @Override\n+        public ConsensusInfo deserialize(\n+                JsonParser jsonParser, DeserializationContext deserializationContext)\n+                throws IOException {\n+            JsonNode node = jsonParser.getCodec().readTree(jsonParser);\n+            BasicConsensusInfo baseConsensusInfo = null;\n+            List<ViewInfo> viewInfos = null;\n+            if (node.size() > 0) {\n+                baseConsensusInfo =\n+                        objecMapper.readValue(node.get(0).toString(), BasicConsensusInfo.class);\n+                Integer sealersNum = Integer.valueOf(baseConsensusInfo.getNodeNum());\n+                baseConsensusInfo.setSealerList(new ArrayList<String>(sealersNum));\n+                // parse sealerList\n+                for (Integer i = 0; i < sealersNum; i++) {\n+                    String key = \"sealer.\" + String.valueOf(i);\n+                    if (node.get(0).has(key)) {\n+                        baseConsensusInfo.getSealerList().add(i, node.get(0).get(key).asText());\n+                    }\n+                }\n+            }\n+            if (node.size() > 1) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "14b2987801cbc9d69fb8de19e91a8ecd3ddda385"}, "originalPosition": 454}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMzY0NDM3OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/fisco/bcos/web3j/abi/wrapper/ABICodecJsonWrapper.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwOTowOTowOFrOHaUX_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwOTowOTowOFrOHaUX_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzM1ODg0Ng==", "bodyText": "[PMD Java] A method or constructor should not explicitly declare unchecked exceptions in its 'throws' clause (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nAvoidUncheckedExceptionsInSignatures\nDesign\n3\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.27.0/pmd_rules_java_design.html#avoiduncheckedexceptionsinsignatures\n\nYou can close this issue if no need to fix it. Learn more.", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/713#discussion_r497358846", "createdAt": "2020-09-30T09:09:08Z", "author": {"login": "sider"}, "path": "src/main/java/org/fisco/bcos/web3j/abi/wrapper/ABICodecJsonWrapper.java", "diffHunk": "@@ -37,6 +37,12 @@ private void errorReport(String path, String expected, String actual)\n         throw new InvalidParameterException(errorMessage);\n     }\n \n+    private void errorReport(String path, String desc) throws InvalidParameterException {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "14b2987801cbc9d69fb8de19e91a8ecd3ddda385"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMzY0NDM5OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/fisco/bcos/web3j/protocol/core/methods/response/ConsensusStatus.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwOTowOTowOFrOHaUYAg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwOTowOTowOFrOHaUYAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzM1ODg1MA==", "bodyText": "[PMD Java] Found non-transient, non-static member. Please mark as transient or provide accessors. (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nBeanMembersShouldSerialize\nError Prone\n3\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.27.0/pmd_rules_java_errorprone.html#beanmembersshouldserialize\n\nYou can close this issue if no need to fix it. Learn more.", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/713#discussion_r497358850", "createdAt": "2020-09-30T09:09:08Z", "author": {"login": "sider"}, "path": "src/main/java/org/fisco/bcos/web3j/protocol/core/methods/response/ConsensusStatus.java", "diffHunk": "@@ -1,10 +1,460 @@\n package org.fisco.bcos.web3j.protocol.core.methods.response;\n \n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import com.fasterxml.jackson.core.JsonParser;\n+import com.fasterxml.jackson.core.type.TypeReference;\n+import com.fasterxml.jackson.databind.DeserializationContext;\n+import com.fasterxml.jackson.databind.JsonDeserializer;\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.databind.annotation.JsonDeserialize;\n+import java.io.IOException;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Objects;\n+import org.fisco.bcos.web3j.protocol.ObjectMapperFactory;\n import org.fisco.bcos.web3j.protocol.core.Response;\n \n /** getConsensusStatus */\n-public class ConsensusStatus extends Response<String> {\n-    public String getConsensusStatus() {\n+public class ConsensusStatus extends Response<ConsensusStatus.ConsensusInfo> {\n+    @Override\n+    @JsonDeserialize(using = ConsensusStatusDeserializer.class)\n+    public void setResult(ConsensusStatus.ConsensusInfo result) {\n+        super.setResult(result);\n+    }\n+\n+    public ConsensusInfo getConsensusStatus() {\n         return getResult();\n     }\n+\n+    public static class ViewInfo {\n+        private String nodeId;\n+        private String view;\n+\n+        public String getNodeId() {\n+            return nodeId;\n+        }\n+\n+        public void setNodeId(String nodeId) {\n+            this.nodeId = nodeId;\n+        }\n+\n+        public String getView() {\n+            return view;\n+        }\n+\n+        public void setView(String view) {\n+            this.view = view;\n+        }\n+\n+        @Override\n+        public boolean equals(Object o) {\n+            if (this == o) return true;\n+            if (o == null || getClass() != o.getClass()) return false;\n+            ViewInfo viewInfo = (ViewInfo) o;\n+            return Objects.equals(nodeId, viewInfo.nodeId) && Objects.equals(view, viewInfo.view);\n+        }\n+\n+        @Override\n+        public int hashCode() {\n+            return Objects.hash(nodeId, view);\n+        }\n+\n+        @Override\n+        public String toString() {\n+            return \"ViewInfo{\" + \"nodeId='\" + nodeId + '\\'' + \", view='\" + view + '\\'' + '}';\n+        }\n+    }\n+\n+    public static class BasicConsensusInfo {\n+        private String nodeNum;\n+\n+        @JsonProperty(\"node_index\")\n+        private String nodeIndex;\n+\n+        @JsonProperty(\"node index\")\n+        private String raftNodeIndex;\n+\n+        @JsonProperty(\"max_faulty_leader\")\n+        private String maxFaultyNodeNum;\n+\n+        @JsonProperty(\"sealer.\")\n+        private List<String> sealerList;\n+\n+        private String consensusedBlockNumber;\n+        private String highestblockNumber;\n+        private String groupId;\n+        private String protocolId;\n+        private String accountType;\n+        private String cfgErr;\n+        private String omitEmptyBlock;\n+        private String nodeId;\n+        private String allowFutureBlocks;\n+        private String connectedNodes;\n+        private String currentView;\n+        private String toView;\n+        private String leaderFailed;\n+        private String highestblockHash;\n+        private String leaderId;\n+        private String leaderIdx;\n+\n+        public String getRaftNodeIndex() {\n+            return raftNodeIndex;\n+        }\n+\n+        public void setRaftNodeIndex(String raftNodeIndex) {\n+            this.raftNodeIndex = raftNodeIndex;\n+        }\n+\n+        public String getLeaderId() {\n+            return leaderId;\n+        }\n+\n+        public void setLeaderId(String leaderId) {\n+            this.leaderId = leaderId;\n+        }\n+\n+        public String getLeaderIdx() {\n+            return leaderIdx;\n+        }\n+\n+        public void setLeaderIdx(String leaderIdx) {\n+            this.leaderIdx = leaderIdx;\n+        }\n+\n+        public String getNodeIndex() {\n+            return nodeIndex;\n+        }\n+\n+        public void setNodeIndex(String nodeIndex) {\n+            this.nodeIndex = nodeIndex;\n+        }\n+\n+        public String getHighestblockHash() {\n+            return highestblockHash;\n+        }\n+\n+        public void setHighestblockHash(String highestblockHash) {\n+            this.highestblockHash = highestblockHash;\n+        }\n+\n+        public String getNodeNum() {\n+            return nodeNum;\n+        }\n+\n+        public void setNodeNum(String nodeNum) {\n+            this.nodeNum = nodeNum;\n+        }\n+\n+        public String getMaxFaultyNodeNum() {\n+            return maxFaultyNodeNum;\n+        }\n+\n+        public void setMaxFaultyNodeNum(String maxFaultyNodeNum) {\n+            this.maxFaultyNodeNum = maxFaultyNodeNum;\n+        }\n+\n+        public List<String> getSealerList() {\n+            return sealerList;\n+        }\n+\n+        public void setSealerList(List<String> sealerList) {\n+            this.sealerList = sealerList;\n+        }\n+\n+        public String getConsensusedBlockNumber() {\n+            return consensusedBlockNumber;\n+        }\n+\n+        public void setConsensusedBlockNumber(String consensusedBlockNumber) {\n+            this.consensusedBlockNumber = consensusedBlockNumber;\n+        }\n+\n+        public String getHighestblockNumber() {\n+            return highestblockNumber;\n+        }\n+\n+        public void setHighestblockNumber(String highestblockNumber) {\n+            this.highestblockNumber = highestblockNumber;\n+        }\n+\n+        public String getGroupId() {\n+            return groupId;\n+        }\n+\n+        public void setGroupId(String groupId) {\n+            this.groupId = groupId;\n+        }\n+\n+        public String getProtocolId() {\n+            return protocolId;\n+        }\n+\n+        public void setProtocolId(String protocolId) {\n+            this.protocolId = protocolId;\n+        }\n+\n+        public String getAccountType() {\n+            return accountType;\n+        }\n+\n+        public void setAccountType(String accountType) {\n+            this.accountType = accountType;\n+        }\n+\n+        public String getCfgErr() {\n+            return cfgErr;\n+        }\n+\n+        public void setCfgErr(String cfgErr) {\n+            this.cfgErr = cfgErr;\n+        }\n+\n+        public String getOmitEmptyBlock() {\n+            return omitEmptyBlock;\n+        }\n+\n+        public void setOmitEmptyBlock(String omitEmptyBlock) {\n+            this.omitEmptyBlock = omitEmptyBlock;\n+        }\n+\n+        public String getNodeId() {\n+            return nodeId;\n+        }\n+\n+        public void setNodeId(String nodeId) {\n+            this.nodeId = nodeId;\n+        }\n+\n+        public String getAllowFutureBlocks() {\n+            return allowFutureBlocks;\n+        }\n+\n+        public void setAllowFutureBlocks(String allowFutureBlocks) {\n+            this.allowFutureBlocks = allowFutureBlocks;\n+        }\n+\n+        public String getConnectedNodes() {\n+            return connectedNodes;\n+        }\n+\n+        public void setConnectedNodes(String connectedNodes) {\n+            this.connectedNodes = connectedNodes;\n+        }\n+\n+        public String getCurrentView() {\n+            return currentView;\n+        }\n+\n+        public void setCurrentView(String currentView) {\n+            this.currentView = currentView;\n+        }\n+\n+        public String getToView() {\n+            return toView;\n+        }\n+\n+        public void setToView(String toView) {\n+            this.toView = toView;\n+        }\n+\n+        public String getLeaderFailed() {\n+            return leaderFailed;\n+        }\n+\n+        public void setLeaderFailed(String leaderFailed) {\n+            this.leaderFailed = leaderFailed;\n+        }\n+\n+        @Override\n+        public boolean equals(Object o) {\n+            if (this == o) return true;\n+            if (o == null || getClass() != o.getClass()) return false;\n+            BasicConsensusInfo that = (BasicConsensusInfo) o;\n+            return Objects.equals(nodeNum, that.nodeNum)\n+                    && Objects.equals(nodeIndex, that.nodeIndex)\n+                    && Objects.equals(maxFaultyNodeNum, that.maxFaultyNodeNum)\n+                    && Objects.equals(sealerList, that.sealerList)\n+                    && Objects.equals(consensusedBlockNumber, that.consensusedBlockNumber)\n+                    && Objects.equals(highestblockNumber, that.highestblockNumber)\n+                    && Objects.equals(groupId, that.groupId)\n+                    && Objects.equals(protocolId, that.protocolId)\n+                    && Objects.equals(accountType, that.accountType)\n+                    && Objects.equals(cfgErr, that.cfgErr)\n+                    && Objects.equals(omitEmptyBlock, that.omitEmptyBlock)\n+                    && Objects.equals(nodeId, that.nodeId)\n+                    && Objects.equals(allowFutureBlocks, that.allowFutureBlocks)\n+                    && Objects.equals(connectedNodes, that.connectedNodes)\n+                    && Objects.equals(currentView, that.currentView)\n+                    && Objects.equals(toView, that.toView)\n+                    && Objects.equals(leaderFailed, that.leaderFailed)\n+                    && Objects.equals(highestblockHash, that.highestblockHash);\n+        }\n+\n+        @Override\n+        public int hashCode() {\n+            return Objects.hash(\n+                    nodeNum,\n+                    nodeIndex,\n+                    maxFaultyNodeNum,\n+                    sealerList,\n+                    consensusedBlockNumber,\n+                    highestblockNumber,\n+                    groupId,\n+                    protocolId,\n+                    accountType,\n+                    cfgErr,\n+                    omitEmptyBlock,\n+                    nodeId,\n+                    allowFutureBlocks,\n+                    connectedNodes,\n+                    currentView,\n+                    toView,\n+                    leaderFailed,\n+                    highestblockHash);\n+        }\n+\n+        @Override\n+        public String toString() {\n+            return \"BasicConsensusInfo{\"\n+                    + \"nodeNum='\"\n+                    + nodeNum\n+                    + '\\''\n+                    + \", nodeIndex='\"\n+                    + nodeIndex\n+                    + '\\''\n+                    + \", maxFaultyNodeNum='\"\n+                    + maxFaultyNodeNum\n+                    + '\\''\n+                    + \", sealerList=\"\n+                    + sealerList\n+                    + \", consensusedBlockNumber='\"\n+                    + consensusedBlockNumber\n+                    + '\\''\n+                    + \", highestblockNumber='\"\n+                    + highestblockNumber\n+                    + '\\''\n+                    + \", groupId='\"\n+                    + groupId\n+                    + '\\''\n+                    + \", protocolId='\"\n+                    + protocolId\n+                    + '\\''\n+                    + \", accountType='\"\n+                    + accountType\n+                    + '\\''\n+                    + \", cfgErr='\"\n+                    + cfgErr\n+                    + '\\''\n+                    + \", omitEmptyBlock='\"\n+                    + omitEmptyBlock\n+                    + '\\''\n+                    + \", nodeId='\"\n+                    + nodeId\n+                    + '\\''\n+                    + \", allowFutureBlocks='\"\n+                    + allowFutureBlocks\n+                    + '\\''\n+                    + \", connectedNodes='\"\n+                    + connectedNodes\n+                    + '\\''\n+                    + \", currentView='\"\n+                    + currentView\n+                    + '\\''\n+                    + \", toView='\"\n+                    + toView\n+                    + '\\''\n+                    + \", leaderFailed='\"\n+                    + leaderFailed\n+                    + '\\''\n+                    + \", highestblockHash='\"\n+                    + highestblockHash\n+                    + '\\''\n+                    + '}';\n+        }\n+    }\n+\n+    public static class ConsensusInfo {\n+        private BasicConsensusInfo baseConsensusInfo;\n+        private List<ViewInfo> viewInfos;\n+\n+        public ConsensusInfo() {}\n+\n+        public ConsensusInfo(BasicConsensusInfo baseConsensusInfo, List<ViewInfo> viewInfos) {\n+            this.baseConsensusInfo = baseConsensusInfo;\n+            this.viewInfos = viewInfos;\n+        }\n+\n+        public BasicConsensusInfo getBaseConsensusInfo() {\n+            return baseConsensusInfo;\n+        }\n+\n+        public void setBaseConsensusInfo(BasicConsensusInfo baseConsensusInfo) {\n+            this.baseConsensusInfo = baseConsensusInfo;\n+        }\n+\n+        public List<ViewInfo> getViewInfos() {\n+            return viewInfos;\n+        }\n+\n+        public void setViewInfos(List<ViewInfo> viewInfos) {\n+            this.viewInfos = viewInfos;\n+        }\n+\n+        @Override\n+        public boolean equals(Object o) {\n+            if (this == o) return true;\n+            if (o == null || getClass() != o.getClass()) return false;\n+            ConsensusInfo that = (ConsensusInfo) o;\n+            return Objects.equals(baseConsensusInfo, that.baseConsensusInfo)\n+                    && Objects.equals(viewInfos, that.viewInfos);\n+        }\n+\n+        @Override\n+        public int hashCode() {\n+            return Objects.hash(baseConsensusInfo, viewInfos);\n+        }\n+\n+        @Override\n+        public String toString() {\n+            return \"ConsensusInfo{\"\n+                    + \"baseConsensusInfo=\"\n+                    + baseConsensusInfo\n+                    + \", viewInfos=\"\n+                    + viewInfos\n+                    + '}';\n+        }\n+    }\n+\n+    public static class ConsensusStatusDeserializer extends JsonDeserializer<ConsensusInfo> {\n+        private ObjectMapper objecMapper = ObjectMapperFactory.getObjectMapper();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "14b2987801cbc9d69fb8de19e91a8ecd3ddda385"}, "originalPosition": 432}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMzY0NDQzOnYy", "diffSide": "RIGHT", "path": "src/test/java/org/fisco/bcos/web3j/tx/ManagedTransactionTester.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwOTowOTowOFrOHaUYBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwOTowOTowOFrOHaUYBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzM1ODg1NQ==", "bodyText": "[PMD Java] Dont create instances of already existing BigInteger and BigDecimal (ZERO, ONE, TEN) (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nBigIntegerInstantiation\nPerformance\n3\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.27.0/pmd_rules_java_performance.html#bigintegerinstantiation\n\nYou can close this issue if no need to fix it. Learn more.", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/713#discussion_r497358855", "createdAt": "2020-09-30T09:09:08Z", "author": {"login": "sider"}, "path": "src/test/java/org/fisco/bcos/web3j/tx/ManagedTransactionTester.java", "diffHunk": "@@ -58,7 +58,7 @@ void prepareBlockNumberRequest() throws IOException {\n         Request<?, BlockNumber> ethBlockNumberRequest = mock(Request.class);\n         when(ethBlockNumberRequest.send()).thenReturn(ethBlockNumber);\n         when(web3j.getBlockNumber()).thenReturn((Request) ethBlockNumberRequest);\n-        when(web3j.getBlockNumberCache()).thenReturn(new BigInteger(\"1\"));\n+        when(web3j.getBlockLimit()).thenReturn(new BigInteger(\"1\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "14b2987801cbc9d69fb8de19e91a8ecd3ddda385"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMzY0NDQ1OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/fisco/bcos/web3j/crypto/Keys.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwOTowOTowOFrOHaUYCQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwOTowOTowOFrOHaUYCQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzM1ODg1Nw==", "bodyText": "[PMD Java] Avoid empty if statements (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nEmptyIfStmt\nError Prone\n3\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.27.0/pmd_rules_java_errorprone.html#emptyifstmt\n\nYou can close this issue if no need to fix it. Learn more.", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/713#discussion_r497358857", "createdAt": "2020-09-30T09:09:08Z", "author": {"login": "sider"}, "path": "src/main/java/org/fisco/bcos/web3j/crypto/Keys.java", "diffHunk": "@@ -99,7 +102,27 @@ public static String getAddress(String publicKey) {\n             publicKeyNoPrefix =\n                     Strings.zeros(PUBLIC_KEY_LENGTH_IN_HEX - publicKeyNoPrefix.length())\n                             + publicKeyNoPrefix;\n+        } else if (publicKeyNoPrefix.length() == PUBLIC_KEY_LENGTH_IN_HEX) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "14b2987801cbc9d69fb8de19e91a8ecd3ddda385"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMzY0NDQ3OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/fisco/bcos/web3j/protocol/core/methods/response/ConsensusStatus.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwOTowOTowOFrOHaUYDQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwOTowOTowOFrOHaUYDQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzM1ODg2MQ==", "bodyText": "[PMD Java] Possible God Class (WMC=48, ATFD=19, TCC=13.333%) (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nGodClass\nDesign\n3\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.27.0/pmd_rules_java_design.html#godclass\n\nYou can close this issue if no need to fix it. Learn more.", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/713#discussion_r497358861", "createdAt": "2020-09-30T09:09:08Z", "author": {"login": "sider"}, "path": "src/main/java/org/fisco/bcos/web3j/protocol/core/methods/response/ConsensusStatus.java", "diffHunk": "@@ -1,10 +1,460 @@\n package org.fisco.bcos.web3j.protocol.core.methods.response;\n \n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import com.fasterxml.jackson.core.JsonParser;\n+import com.fasterxml.jackson.core.type.TypeReference;\n+import com.fasterxml.jackson.databind.DeserializationContext;\n+import com.fasterxml.jackson.databind.JsonDeserializer;\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.databind.annotation.JsonDeserialize;\n+import java.io.IOException;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Objects;\n+import org.fisco.bcos.web3j.protocol.ObjectMapperFactory;\n import org.fisco.bcos.web3j.protocol.core.Response;\n \n /** getConsensusStatus */\n-public class ConsensusStatus extends Response<String> {\n-    public String getConsensusStatus() {\n+public class ConsensusStatus extends Response<ConsensusStatus.ConsensusInfo> {\n+    @Override\n+    @JsonDeserialize(using = ConsensusStatusDeserializer.class)\n+    public void setResult(ConsensusStatus.ConsensusInfo result) {\n+        super.setResult(result);\n+    }\n+\n+    public ConsensusInfo getConsensusStatus() {\n         return getResult();\n     }\n+\n+    public static class ViewInfo {\n+        private String nodeId;\n+        private String view;\n+\n+        public String getNodeId() {\n+            return nodeId;\n+        }\n+\n+        public void setNodeId(String nodeId) {\n+            this.nodeId = nodeId;\n+        }\n+\n+        public String getView() {\n+            return view;\n+        }\n+\n+        public void setView(String view) {\n+            this.view = view;\n+        }\n+\n+        @Override\n+        public boolean equals(Object o) {\n+            if (this == o) return true;\n+            if (o == null || getClass() != o.getClass()) return false;\n+            ViewInfo viewInfo = (ViewInfo) o;\n+            return Objects.equals(nodeId, viewInfo.nodeId) && Objects.equals(view, viewInfo.view);\n+        }\n+\n+        @Override\n+        public int hashCode() {\n+            return Objects.hash(nodeId, view);\n+        }\n+\n+        @Override\n+        public String toString() {\n+            return \"ViewInfo{\" + \"nodeId='\" + nodeId + '\\'' + \", view='\" + view + '\\'' + '}';\n+        }\n+    }\n+\n+    public static class BasicConsensusInfo {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "14b2987801cbc9d69fb8de19e91a8ecd3ddda385"}, "originalPosition": 71}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMzY0NDQ4OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/fisco/bcos/web3j/protocol/core/JsonRpc2_0Web3j.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwOTowOTowOVrOHaUYDw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwOTowOTowOVrOHaUYDw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzM1ODg2Mw==", "bodyText": "[PMD Java] Logger calls should be surrounded by log level guards. (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nGuardLogStatement\nBest Practices\n2\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.27.0/pmd_rules_java_bestpractices.html#guardlogstatement\n\nYou can close this issue if no need to fix it. Learn more.", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/713#discussion_r497358863", "createdAt": "2020-09-30T09:09:09Z", "author": {"login": "sider"}, "path": "src/main/java/org/fisco/bcos/web3j/protocol/core/JsonRpc2_0Web3j.java", "diffHunk": "@@ -132,6 +132,19 @@ public BigInteger getBlockNumberCache() {\n         return getLocalBlockNumber().add(new BigInteger(BlockLimit.blockLimit.toString()));\n     }\n \n+    @Override\n+    public BigInteger getBlockLimit() {\n+        if (getLocalBlockNumber().intValue() == 1) {\n+            try {\n+                BlockNumber blockNumber = getBlockNumber().sendAsync().get();\n+                setBlockNumber(blockNumber.getBlockNumber());\n+            } catch (Exception e) {\n+                logger.error(\"Exception: \" + e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "14b2987801cbc9d69fb8de19e91a8ecd3ddda385"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMzY0NDQ5OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/fisco/bcos/web3j/protocol/core/methods/response/ConsensusStatus.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwOTowOTowOVrOHaUYEA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwOTowOTowOVrOHaUYEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzM1ODg2NA==", "bodyText": "[PMD Java] Private field 'objecMapper' could be made final; it is only initialized in the declaration or constructor. (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nImmutableField\nDesign\n3\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.27.0/pmd_rules_java_design.html#immutablefield\n\nYou can close this issue if no need to fix it. Learn more.", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/713#discussion_r497358864", "createdAt": "2020-09-30T09:09:09Z", "author": {"login": "sider"}, "path": "src/main/java/org/fisco/bcos/web3j/protocol/core/methods/response/ConsensusStatus.java", "diffHunk": "@@ -1,10 +1,460 @@\n package org.fisco.bcos.web3j.protocol.core.methods.response;\n \n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import com.fasterxml.jackson.core.JsonParser;\n+import com.fasterxml.jackson.core.type.TypeReference;\n+import com.fasterxml.jackson.databind.DeserializationContext;\n+import com.fasterxml.jackson.databind.JsonDeserializer;\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.databind.annotation.JsonDeserialize;\n+import java.io.IOException;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Objects;\n+import org.fisco.bcos.web3j.protocol.ObjectMapperFactory;\n import org.fisco.bcos.web3j.protocol.core.Response;\n \n /** getConsensusStatus */\n-public class ConsensusStatus extends Response<String> {\n-    public String getConsensusStatus() {\n+public class ConsensusStatus extends Response<ConsensusStatus.ConsensusInfo> {\n+    @Override\n+    @JsonDeserialize(using = ConsensusStatusDeserializer.class)\n+    public void setResult(ConsensusStatus.ConsensusInfo result) {\n+        super.setResult(result);\n+    }\n+\n+    public ConsensusInfo getConsensusStatus() {\n         return getResult();\n     }\n+\n+    public static class ViewInfo {\n+        private String nodeId;\n+        private String view;\n+\n+        public String getNodeId() {\n+            return nodeId;\n+        }\n+\n+        public void setNodeId(String nodeId) {\n+            this.nodeId = nodeId;\n+        }\n+\n+        public String getView() {\n+            return view;\n+        }\n+\n+        public void setView(String view) {\n+            this.view = view;\n+        }\n+\n+        @Override\n+        public boolean equals(Object o) {\n+            if (this == o) return true;\n+            if (o == null || getClass() != o.getClass()) return false;\n+            ViewInfo viewInfo = (ViewInfo) o;\n+            return Objects.equals(nodeId, viewInfo.nodeId) && Objects.equals(view, viewInfo.view);\n+        }\n+\n+        @Override\n+        public int hashCode() {\n+            return Objects.hash(nodeId, view);\n+        }\n+\n+        @Override\n+        public String toString() {\n+            return \"ViewInfo{\" + \"nodeId='\" + nodeId + '\\'' + \", view='\" + view + '\\'' + '}';\n+        }\n+    }\n+\n+    public static class BasicConsensusInfo {\n+        private String nodeNum;\n+\n+        @JsonProperty(\"node_index\")\n+        private String nodeIndex;\n+\n+        @JsonProperty(\"node index\")\n+        private String raftNodeIndex;\n+\n+        @JsonProperty(\"max_faulty_leader\")\n+        private String maxFaultyNodeNum;\n+\n+        @JsonProperty(\"sealer.\")\n+        private List<String> sealerList;\n+\n+        private String consensusedBlockNumber;\n+        private String highestblockNumber;\n+        private String groupId;\n+        private String protocolId;\n+        private String accountType;\n+        private String cfgErr;\n+        private String omitEmptyBlock;\n+        private String nodeId;\n+        private String allowFutureBlocks;\n+        private String connectedNodes;\n+        private String currentView;\n+        private String toView;\n+        private String leaderFailed;\n+        private String highestblockHash;\n+        private String leaderId;\n+        private String leaderIdx;\n+\n+        public String getRaftNodeIndex() {\n+            return raftNodeIndex;\n+        }\n+\n+        public void setRaftNodeIndex(String raftNodeIndex) {\n+            this.raftNodeIndex = raftNodeIndex;\n+        }\n+\n+        public String getLeaderId() {\n+            return leaderId;\n+        }\n+\n+        public void setLeaderId(String leaderId) {\n+            this.leaderId = leaderId;\n+        }\n+\n+        public String getLeaderIdx() {\n+            return leaderIdx;\n+        }\n+\n+        public void setLeaderIdx(String leaderIdx) {\n+            this.leaderIdx = leaderIdx;\n+        }\n+\n+        public String getNodeIndex() {\n+            return nodeIndex;\n+        }\n+\n+        public void setNodeIndex(String nodeIndex) {\n+            this.nodeIndex = nodeIndex;\n+        }\n+\n+        public String getHighestblockHash() {\n+            return highestblockHash;\n+        }\n+\n+        public void setHighestblockHash(String highestblockHash) {\n+            this.highestblockHash = highestblockHash;\n+        }\n+\n+        public String getNodeNum() {\n+            return nodeNum;\n+        }\n+\n+        public void setNodeNum(String nodeNum) {\n+            this.nodeNum = nodeNum;\n+        }\n+\n+        public String getMaxFaultyNodeNum() {\n+            return maxFaultyNodeNum;\n+        }\n+\n+        public void setMaxFaultyNodeNum(String maxFaultyNodeNum) {\n+            this.maxFaultyNodeNum = maxFaultyNodeNum;\n+        }\n+\n+        public List<String> getSealerList() {\n+            return sealerList;\n+        }\n+\n+        public void setSealerList(List<String> sealerList) {\n+            this.sealerList = sealerList;\n+        }\n+\n+        public String getConsensusedBlockNumber() {\n+            return consensusedBlockNumber;\n+        }\n+\n+        public void setConsensusedBlockNumber(String consensusedBlockNumber) {\n+            this.consensusedBlockNumber = consensusedBlockNumber;\n+        }\n+\n+        public String getHighestblockNumber() {\n+            return highestblockNumber;\n+        }\n+\n+        public void setHighestblockNumber(String highestblockNumber) {\n+            this.highestblockNumber = highestblockNumber;\n+        }\n+\n+        public String getGroupId() {\n+            return groupId;\n+        }\n+\n+        public void setGroupId(String groupId) {\n+            this.groupId = groupId;\n+        }\n+\n+        public String getProtocolId() {\n+            return protocolId;\n+        }\n+\n+        public void setProtocolId(String protocolId) {\n+            this.protocolId = protocolId;\n+        }\n+\n+        public String getAccountType() {\n+            return accountType;\n+        }\n+\n+        public void setAccountType(String accountType) {\n+            this.accountType = accountType;\n+        }\n+\n+        public String getCfgErr() {\n+            return cfgErr;\n+        }\n+\n+        public void setCfgErr(String cfgErr) {\n+            this.cfgErr = cfgErr;\n+        }\n+\n+        public String getOmitEmptyBlock() {\n+            return omitEmptyBlock;\n+        }\n+\n+        public void setOmitEmptyBlock(String omitEmptyBlock) {\n+            this.omitEmptyBlock = omitEmptyBlock;\n+        }\n+\n+        public String getNodeId() {\n+            return nodeId;\n+        }\n+\n+        public void setNodeId(String nodeId) {\n+            this.nodeId = nodeId;\n+        }\n+\n+        public String getAllowFutureBlocks() {\n+            return allowFutureBlocks;\n+        }\n+\n+        public void setAllowFutureBlocks(String allowFutureBlocks) {\n+            this.allowFutureBlocks = allowFutureBlocks;\n+        }\n+\n+        public String getConnectedNodes() {\n+            return connectedNodes;\n+        }\n+\n+        public void setConnectedNodes(String connectedNodes) {\n+            this.connectedNodes = connectedNodes;\n+        }\n+\n+        public String getCurrentView() {\n+            return currentView;\n+        }\n+\n+        public void setCurrentView(String currentView) {\n+            this.currentView = currentView;\n+        }\n+\n+        public String getToView() {\n+            return toView;\n+        }\n+\n+        public void setToView(String toView) {\n+            this.toView = toView;\n+        }\n+\n+        public String getLeaderFailed() {\n+            return leaderFailed;\n+        }\n+\n+        public void setLeaderFailed(String leaderFailed) {\n+            this.leaderFailed = leaderFailed;\n+        }\n+\n+        @Override\n+        public boolean equals(Object o) {\n+            if (this == o) return true;\n+            if (o == null || getClass() != o.getClass()) return false;\n+            BasicConsensusInfo that = (BasicConsensusInfo) o;\n+            return Objects.equals(nodeNum, that.nodeNum)\n+                    && Objects.equals(nodeIndex, that.nodeIndex)\n+                    && Objects.equals(maxFaultyNodeNum, that.maxFaultyNodeNum)\n+                    && Objects.equals(sealerList, that.sealerList)\n+                    && Objects.equals(consensusedBlockNumber, that.consensusedBlockNumber)\n+                    && Objects.equals(highestblockNumber, that.highestblockNumber)\n+                    && Objects.equals(groupId, that.groupId)\n+                    && Objects.equals(protocolId, that.protocolId)\n+                    && Objects.equals(accountType, that.accountType)\n+                    && Objects.equals(cfgErr, that.cfgErr)\n+                    && Objects.equals(omitEmptyBlock, that.omitEmptyBlock)\n+                    && Objects.equals(nodeId, that.nodeId)\n+                    && Objects.equals(allowFutureBlocks, that.allowFutureBlocks)\n+                    && Objects.equals(connectedNodes, that.connectedNodes)\n+                    && Objects.equals(currentView, that.currentView)\n+                    && Objects.equals(toView, that.toView)\n+                    && Objects.equals(leaderFailed, that.leaderFailed)\n+                    && Objects.equals(highestblockHash, that.highestblockHash);\n+        }\n+\n+        @Override\n+        public int hashCode() {\n+            return Objects.hash(\n+                    nodeNum,\n+                    nodeIndex,\n+                    maxFaultyNodeNum,\n+                    sealerList,\n+                    consensusedBlockNumber,\n+                    highestblockNumber,\n+                    groupId,\n+                    protocolId,\n+                    accountType,\n+                    cfgErr,\n+                    omitEmptyBlock,\n+                    nodeId,\n+                    allowFutureBlocks,\n+                    connectedNodes,\n+                    currentView,\n+                    toView,\n+                    leaderFailed,\n+                    highestblockHash);\n+        }\n+\n+        @Override\n+        public String toString() {\n+            return \"BasicConsensusInfo{\"\n+                    + \"nodeNum='\"\n+                    + nodeNum\n+                    + '\\''\n+                    + \", nodeIndex='\"\n+                    + nodeIndex\n+                    + '\\''\n+                    + \", maxFaultyNodeNum='\"\n+                    + maxFaultyNodeNum\n+                    + '\\''\n+                    + \", sealerList=\"\n+                    + sealerList\n+                    + \", consensusedBlockNumber='\"\n+                    + consensusedBlockNumber\n+                    + '\\''\n+                    + \", highestblockNumber='\"\n+                    + highestblockNumber\n+                    + '\\''\n+                    + \", groupId='\"\n+                    + groupId\n+                    + '\\''\n+                    + \", protocolId='\"\n+                    + protocolId\n+                    + '\\''\n+                    + \", accountType='\"\n+                    + accountType\n+                    + '\\''\n+                    + \", cfgErr='\"\n+                    + cfgErr\n+                    + '\\''\n+                    + \", omitEmptyBlock='\"\n+                    + omitEmptyBlock\n+                    + '\\''\n+                    + \", nodeId='\"\n+                    + nodeId\n+                    + '\\''\n+                    + \", allowFutureBlocks='\"\n+                    + allowFutureBlocks\n+                    + '\\''\n+                    + \", connectedNodes='\"\n+                    + connectedNodes\n+                    + '\\''\n+                    + \", currentView='\"\n+                    + currentView\n+                    + '\\''\n+                    + \", toView='\"\n+                    + toView\n+                    + '\\''\n+                    + \", leaderFailed='\"\n+                    + leaderFailed\n+                    + '\\''\n+                    + \", highestblockHash='\"\n+                    + highestblockHash\n+                    + '\\''\n+                    + '}';\n+        }\n+    }\n+\n+    public static class ConsensusInfo {\n+        private BasicConsensusInfo baseConsensusInfo;\n+        private List<ViewInfo> viewInfos;\n+\n+        public ConsensusInfo() {}\n+\n+        public ConsensusInfo(BasicConsensusInfo baseConsensusInfo, List<ViewInfo> viewInfos) {\n+            this.baseConsensusInfo = baseConsensusInfo;\n+            this.viewInfos = viewInfos;\n+        }\n+\n+        public BasicConsensusInfo getBaseConsensusInfo() {\n+            return baseConsensusInfo;\n+        }\n+\n+        public void setBaseConsensusInfo(BasicConsensusInfo baseConsensusInfo) {\n+            this.baseConsensusInfo = baseConsensusInfo;\n+        }\n+\n+        public List<ViewInfo> getViewInfos() {\n+            return viewInfos;\n+        }\n+\n+        public void setViewInfos(List<ViewInfo> viewInfos) {\n+            this.viewInfos = viewInfos;\n+        }\n+\n+        @Override\n+        public boolean equals(Object o) {\n+            if (this == o) return true;\n+            if (o == null || getClass() != o.getClass()) return false;\n+            ConsensusInfo that = (ConsensusInfo) o;\n+            return Objects.equals(baseConsensusInfo, that.baseConsensusInfo)\n+                    && Objects.equals(viewInfos, that.viewInfos);\n+        }\n+\n+        @Override\n+        public int hashCode() {\n+            return Objects.hash(baseConsensusInfo, viewInfos);\n+        }\n+\n+        @Override\n+        public String toString() {\n+            return \"ConsensusInfo{\"\n+                    + \"baseConsensusInfo=\"\n+                    + baseConsensusInfo\n+                    + \", viewInfos=\"\n+                    + viewInfos\n+                    + '}';\n+        }\n+    }\n+\n+    public static class ConsensusStatusDeserializer extends JsonDeserializer<ConsensusInfo> {\n+        private ObjectMapper objecMapper = ObjectMapperFactory.getObjectMapper();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "14b2987801cbc9d69fb8de19e91a8ecd3ddda385"}, "originalPosition": 432}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMzY0NDUyOnYy", "diffSide": "RIGHT", "path": "src/integration-test/java/org/fisco/bcos/precompile/PermissionServiceTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwOTowOTowOVrOHaUYFA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwOTowOTowOVrOHaUYFA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzM1ODg2OA==", "bodyText": "[PMD Java] JUnit assertions should include a message (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nJUnitAssertionsShouldIncludeMessage\nBest Practices\n3\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.27.0/pmd_rules_java_bestpractices.html#junitassertionsshouldincludemessage\n\nYou can close this issue if no need to fix it. Learn more.", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/713#discussion_r497358868", "createdAt": "2020-09-30T09:09:09Z", "author": {"login": "sider"}, "path": "src/integration-test/java/org/fisco/bcos/precompile/PermissionServiceTest.java", "diffHunk": "@@ -1,22 +1,26 @@\n package org.fisco.bcos.precompile;\n \n import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertTrue;\n \n import org.fisco.bcos.TestBase;\n-import org.fisco.bcos.web3j.precompile.exception.PrecompileMessageException;\n+import org.fisco.bcos.web3j.precompile.common.PrecompiledCommon;\n import org.fisco.bcos.web3j.precompile.permission.PermissionService;\n+import org.fisco.bcos.web3j.protocol.core.methods.response.TransactionReceipt;\n+import org.junit.Assert;\n import org.junit.Test;\n \n public class PermissionServiceTest extends TestBase {\n \n \n   private PermissionService permissionService = new PermissionService(web3j, credentials);\n \n-  @Test(expected= PrecompileMessageException.class) \n+  @Test\n   public void userTableManager() throws Exception {\n-  \t\n-\t  permissionService.grantUserTableManager(\"tt\", Common.TX_ORIGIN);\n-  \n+\t\tTransactionReceipt transactionReceipt = permissionService.grantAndRetReceipt(\"tt\", Common.TX_ORIGIN);\n+\t\tAssert.assertTrue(transactionReceipt.isStatusOK());\n+\t\tint i = PrecompiledCommon.handleTransactionReceiptForCRUD(transactionReceipt);\n+\t\tassertEquals(i , 1);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "14b2987801cbc9d69fb8de19e91a8ecd3ddda385"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMzY0NDUzOnYy", "diffSide": "RIGHT", "path": "src/integration-test/java/org/fisco/bcos/web3j/Web3jApITest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwOTowOTowOVrOHaUYFg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwOTowOTowOVrOHaUYFg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzM1ODg3MA==", "bodyText": "[PMD Java] JUnit assertions should include a message (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nJUnitAssertionsShouldIncludeMessage\nBest Practices\n3\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.27.0/pmd_rules_java_bestpractices.html#junitassertionsshouldincludemessage\n\nYou can close this issue if no need to fix it. Learn more.", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/713#discussion_r497358870", "createdAt": "2020-09-30T09:09:09Z", "author": {"login": "sider"}, "path": "src/integration-test/java/org/fisco/bcos/web3j/Web3jApITest.java", "diffHunk": "@@ -56,6 +56,12 @@ public void getBlockNumberCache() throws IOException {\n     assertNotNull(blockNumberCache);\n   }\n \n+  @Test\n+  public void getBlockNumberLimit() throws IOException {\n+    BigInteger blockLimit = web3j.getBlockLimit();\n+    assertNotNull(blockLimit);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "14b2987801cbc9d69fb8de19e91a8ecd3ddda385"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMzY0NDU2OnYy", "diffSide": "RIGHT", "path": "src/integration-test/java/org/fisco/bcos/precompile/PermissionServiceTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwOTowOTowOVrOHaUYGg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwOTowOTowOVrOHaUYGg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzM1ODg3NA==", "bodyText": "[PMD Java] Potential violation of Law of Demeter (object not created locally) (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nLawOfDemeter\nDesign\n3\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.27.0/pmd_rules_java_design.html#lawofdemeter\n\nYou can close this issue if no need to fix it. Learn more.", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/713#discussion_r497358874", "createdAt": "2020-09-30T09:09:09Z", "author": {"login": "sider"}, "path": "src/integration-test/java/org/fisco/bcos/precompile/PermissionServiceTest.java", "diffHunk": "@@ -1,22 +1,26 @@\n package org.fisco.bcos.precompile;\n \n import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertTrue;\n \n import org.fisco.bcos.TestBase;\n-import org.fisco.bcos.web3j.precompile.exception.PrecompileMessageException;\n+import org.fisco.bcos.web3j.precompile.common.PrecompiledCommon;\n import org.fisco.bcos.web3j.precompile.permission.PermissionService;\n+import org.fisco.bcos.web3j.protocol.core.methods.response.TransactionReceipt;\n+import org.junit.Assert;\n import org.junit.Test;\n \n public class PermissionServiceTest extends TestBase {\n \n \n   private PermissionService permissionService = new PermissionService(web3j, credentials);\n \n-  @Test(expected= PrecompileMessageException.class) \n+  @Test\n   public void userTableManager() throws Exception {\n-  \t\n-\t  permissionService.grantUserTableManager(\"tt\", Common.TX_ORIGIN);\n-  \n+\t\tTransactionReceipt transactionReceipt = permissionService.grantAndRetReceipt(\"tt\", Common.TX_ORIGIN);\n+\t\tAssert.assertTrue(transactionReceipt.isStatusOK());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "14b2987801cbc9d69fb8de19e91a8ecd3ddda385"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMzY0NDU4OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/fisco/bcos/web3j/abi/wrapper/ABICodecJsonWrapper.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwOTowOToxMFrOHaUYHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwOTowOToxMFrOHaUYHg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzM1ODg3OA==", "bodyText": "[PMD Java] Potential violation of Law of Demeter (object not created locally) (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nLawOfDemeter\nDesign\n3\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.27.0/pmd_rules_java_design.html#lawofdemeter\n\nYou can close this issue if no need to fix it. Learn more.", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/713#discussion_r497358878", "createdAt": "2020-09-30T09:09:10Z", "author": {"login": "sider"}, "path": "src/main/java/org/fisco/bcos/web3j/abi/wrapper/ABICodecJsonWrapper.java", "diffHunk": "@@ -224,9 +229,8 @@ private ABIObject encodeNode(String path, ABIObject template, JsonNode node) {\n \n                             if (structNode == null) {\n                                 errorReport(\n-                                        path + \"miss field value, field name: \" + field.getName(),\n-                                        template.getValueType().toString(),\n-                                        node.getNodeType().toString());\n+                                        path,\n+                                        \" Missing struct field, field name: \" + field.getName());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "14b2987801cbc9d69fb8de19e91a8ecd3ddda385"}, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMzY0NDU5OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/fisco/bcos/web3j/abi/wrapper/ABIObject.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwOTowOToxMFrOHaUYIQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwOTowOToxMFrOHaUYIQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzM1ODg4MQ==", "bodyText": "[PMD Java] Potential violation of Law of Demeter (method chain calls) (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nLawOfDemeter\nDesign\n3\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.27.0/pmd_rules_java_design.html#lawofdemeter\n\nYou can close this issue if no need to fix it. Learn more.", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/713#discussion_r497358881", "createdAt": "2020-09-30T09:09:10Z", "author": {"login": "sider"}, "path": "src/main/java/org/fisco/bcos/web3j/abi/wrapper/ABIObject.java", "diffHunk": "@@ -349,6 +350,10 @@ public String encode() {\n                             }\n                         case BYTES:\n                             {\n+                                if (bytesValue.getValue().length > 32) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "14b2987801cbc9d69fb8de19e91a8ecd3ddda385"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMzY0NDYwOnYy", "diffSide": "RIGHT", "path": "src/main/java/org/fisco/bcos/web3j/crypto/Keys.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwOTowOToxMFrOHaUYIw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwOTowOToxMFrOHaUYIw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzM1ODg4Mw==", "bodyText": "[PMD Java] Potential violation of Law of Demeter (object not created locally) (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nLawOfDemeter\nDesign\n3\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.27.0/pmd_rules_java_design.html#lawofdemeter\n\nYou can close this issue if no need to fix it. Learn more.", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/713#discussion_r497358883", "createdAt": "2020-09-30T09:09:10Z", "author": {"login": "sider"}, "path": "src/main/java/org/fisco/bcos/web3j/crypto/Keys.java", "diffHunk": "@@ -99,7 +102,27 @@ public static String getAddress(String publicKey) {\n             publicKeyNoPrefix =\n                     Strings.zeros(PUBLIC_KEY_LENGTH_IN_HEX - publicKeyNoPrefix.length())\n                             + publicKeyNoPrefix;\n+        } else if (publicKeyNoPrefix.length() == PUBLIC_KEY_LENGTH_IN_HEX) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "14b2987801cbc9d69fb8de19e91a8ecd3ddda385"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMzY0NDYyOnYy", "diffSide": "RIGHT", "path": "src/main/java/org/fisco/bcos/web3j/crypto/Keys.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwOTowOToxMFrOHaUYJQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwOTowOToxMFrOHaUYJQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzM1ODg4NQ==", "bodyText": "[PMD Java] Potential violation of Law of Demeter (object not created locally) (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nLawOfDemeter\nDesign\n3\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.27.0/pmd_rules_java_design.html#lawofdemeter\n\nYou can close this issue if no need to fix it. Learn more.", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/713#discussion_r497358885", "createdAt": "2020-09-30T09:09:10Z", "author": {"login": "sider"}, "path": "src/main/java/org/fisco/bcos/web3j/crypto/Keys.java", "diffHunk": "@@ -99,7 +102,27 @@ public static String getAddress(String publicKey) {\n             publicKeyNoPrefix =\n                     Strings.zeros(PUBLIC_KEY_LENGTH_IN_HEX - publicKeyNoPrefix.length())\n                             + publicKeyNoPrefix;\n+        } else if (publicKeyNoPrefix.length() == PUBLIC_KEY_LENGTH_IN_HEX) {\n+            // do nothing\n+        } else if (publicKeyNoPrefix.length() == PUBLIC_KEY_LENGTH_IN_HEX_WITH_COMPRESS_FLAG_2) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "14b2987801cbc9d69fb8de19e91a8ecd3ddda385"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMzY0NDYzOnYy", "diffSide": "RIGHT", "path": "src/main/java/org/fisco/bcos/web3j/crypto/Keys.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwOTowOToxMFrOHaUYJg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwOTowOToxMFrOHaUYJg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzM1ODg4Ng==", "bodyText": "[PMD Java] Potential violation of Law of Demeter (object not created locally) (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nLawOfDemeter\nDesign\n3\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.27.0/pmd_rules_java_design.html#lawofdemeter\n\nYou can close this issue if no need to fix it. Learn more.", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/713#discussion_r497358886", "createdAt": "2020-09-30T09:09:10Z", "author": {"login": "sider"}, "path": "src/main/java/org/fisco/bcos/web3j/crypto/Keys.java", "diffHunk": "@@ -99,7 +102,27 @@ public static String getAddress(String publicKey) {\n             publicKeyNoPrefix =\n                     Strings.zeros(PUBLIC_KEY_LENGTH_IN_HEX - publicKeyNoPrefix.length())\n                             + publicKeyNoPrefix;\n+        } else if (publicKeyNoPrefix.length() == PUBLIC_KEY_LENGTH_IN_HEX) {\n+            // do nothing\n+        } else if (publicKeyNoPrefix.length() == PUBLIC_KEY_LENGTH_IN_HEX_WITH_COMPRESS_FLAG_2) {\n+            // 130 length,should start with 03 or 04\n+            if (!(publicKeyNoPrefix.startsWith(\"03\") || publicKeyNoPrefix.startsWith(\"04\"))) {\n+                throw new IllegalArgumentException(\n+                        \" publicKey not start with \\\"03\\\" or \\\"04\\\", publicKey: \" + publicKey);\n+            }\n+            publicKeyNoPrefix = publicKeyNoPrefix.substring(2);\n+        } else if (publicKeyNoPrefix.length() == PUBLIC_KEY_LENGTH_IN_HEX_WITH_COMPRESS_FLAG_1) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "14b2987801cbc9d69fb8de19e91a8ecd3ddda385"}, "originalPosition": 34}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMzY0NDY0OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/fisco/bcos/web3j/precompile/cns/CnsService.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwOTowOToxMFrOHaUYKA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwOTowOToxMFrOHaUYKA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzM1ODg4OA==", "bodyText": "[PMD Java] Potential violation of Law of Demeter (method chain calls) (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nLawOfDemeter\nDesign\n3\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.27.0/pmd_rules_java_design.html#lawofdemeter\n\nYou can close this issue if no need to fix it. Learn more.", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/713#discussion_r497358888", "createdAt": "2020-09-30T09:09:10Z", "author": {"login": "sider"}, "path": "src/main/java/org/fisco/bcos/web3j/precompile/cns/CnsService.java", "diffHunk": "@@ -99,14 +99,16 @@ public String getAddressByContractNameAndVersion(String contractNameAndVersion)\n \n     public String registerCns(String name, String version, String address, String abi)\n             throws Exception {\n-        CNS cns = lookupResolver();\n-        if (version.length() > MAX_VERSION_LENGTH) {\n-            return PrecompiledCommon.transferToJson(PrecompiledCommon.VersionExceeds);\n-        }\n-        TransactionReceipt receipt = cns.insert(name, version, address, abi).send();\n+        TransactionReceipt receipt = registerCnsAndRetReceipt(name, version, address, abi);\n         return PrecompiledCommon.handleTransactionReceipt(receipt, web3j);\n     }\n \n+    public TransactionReceipt registerCnsAndRetReceipt(\n+            String name, String version, String address, String abi) throws Exception {\n+        CNS cns = lookupResolver();\n+        return cns.insert(name, version, address, abi).send();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "14b2987801cbc9d69fb8de19e91a8ecd3ddda385"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMzY0NDY2OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/fisco/bcos/web3j/precompile/cns/CnsService.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwOTowOToxMVrOHaUYKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwOTowOToxMVrOHaUYKg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzM1ODg5MA==", "bodyText": "[PMD Java] Potential violation of Law of Demeter (object not created locally) (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nLawOfDemeter\nDesign\n3\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.27.0/pmd_rules_java_design.html#lawofdemeter\n\nYou can close this issue if no need to fix it. Learn more.", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/713#discussion_r497358890", "createdAt": "2020-09-30T09:09:11Z", "author": {"login": "sider"}, "path": "src/main/java/org/fisco/bcos/web3j/precompile/cns/CnsService.java", "diffHunk": "@@ -99,14 +99,16 @@ public String getAddressByContractNameAndVersion(String contractNameAndVersion)\n \n     public String registerCns(String name, String version, String address, String abi)\n             throws Exception {\n-        CNS cns = lookupResolver();\n-        if (version.length() > MAX_VERSION_LENGTH) {\n-            return PrecompiledCommon.transferToJson(PrecompiledCommon.VersionExceeds);\n-        }\n-        TransactionReceipt receipt = cns.insert(name, version, address, abi).send();\n+        TransactionReceipt receipt = registerCnsAndRetReceipt(name, version, address, abi);\n         return PrecompiledCommon.handleTransactionReceipt(receipt, web3j);\n     }\n \n+    public TransactionReceipt registerCnsAndRetReceipt(\n+            String name, String version, String address, String abi) throws Exception {\n+        CNS cns = lookupResolver();\n+        return cns.insert(name, version, address, abi).send();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "14b2987801cbc9d69fb8de19e91a8ecd3ddda385"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMzY0NDY3OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/fisco/bcos/web3j/precompile/config/SystemConfigService.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwOTowOToxMVrOHaUYKw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwOTowOToxMVrOHaUYKw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzM1ODg5MQ==", "bodyText": "[PMD Java] Potential violation of Law of Demeter (method chain calls) (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nLawOfDemeter\nDesign\n3\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.27.0/pmd_rules_java_design.html#lawofdemeter\n\nYou can close this issue if no need to fix it. Learn more.", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/713#discussion_r497358891", "createdAt": "2020-09-30T09:09:11Z", "author": {"login": "sider"}, "path": "src/main/java/org/fisco/bcos/web3j/precompile/config/SystemConfigService.java", "diffHunk": "@@ -25,7 +25,12 @@ public SystemConfigService(Web3j web3j, Credentials credentials) {\n     }\n \n     public String setValueByKey(String key, String value) throws Exception {\n-        TransactionReceipt receipt = systemConfig.setValueByKey(key, value).send();\n+        TransactionReceipt receipt = setValueByKeyAndRetReceipt(key, value);\n         return PrecompiledCommon.handleTransactionReceipt(receipt, web3j);\n     }\n+\n+    public TransactionReceipt setValueByKeyAndRetReceipt(String key, String value)\n+            throws Exception {\n+        return systemConfig.setValueByKey(key, value).send();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "14b2987801cbc9d69fb8de19e91a8ecd3ddda385"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMzY0NDY5OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/fisco/bcos/web3j/precompile/consensus/ConsensusService.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwOTowOToxMVrOHaUYLQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwOTowOToxMVrOHaUYLQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzM1ODg5Mw==", "bodyText": "[PMD Java] Potential violation of Law of Demeter (method chain calls) (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nLawOfDemeter\nDesign\n3\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.27.0/pmd_rules_java_design.html#lawofdemeter\n\nYou can close this issue if no need to fix it. Learn more.", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/713#discussion_r497358893", "createdAt": "2020-09-30T09:09:11Z", "author": {"login": "sider"}, "path": "src/main/java/org/fisco/bcos/web3j/precompile/consensus/ConsensusService.java", "diffHunk": "@@ -26,34 +26,50 @@ public ConsensusService(Web3j web3j, Credentials credentials) {\n     }\n \n     public String addSealer(String nodeID) throws Exception {\n-        if (!isValidNodeID(nodeID)) {\n-            return PrecompiledCommon.transferToJson(PrecompiledCommon.P2pNetwork);\n-        }\n-        List<String> sealerList = web3j.getSealerList().send().getResult();\n-        if (sealerList.contains(nodeID)) {\n-            return PrecompiledCommon.transferToJson(PrecompiledCommon.SealerList);\n-        }\n-        TransactionReceipt receipt = consensus.addSealer(nodeID).send();\n+        TransactionReceipt receipt = addSealerAndRetReceipt(nodeID);\n         return PrecompiledCommon.handleTransactionReceipt(receipt, web3j);\n     }\n \n+    public TransactionReceipt addSealerAndRetReceipt(String nodeID) throws Exception {\n+        return consensus.addSealer(nodeID).send();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "14b2987801cbc9d69fb8de19e91a8ecd3ddda385"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMzY0NDcyOnYy", "diffSide": "RIGHT", "path": "src/main/java/org/fisco/bcos/web3j/precompile/consensus/ConsensusService.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwOTowOToxMVrOHaUYMg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwOTowOToxMVrOHaUYMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzM1ODg5OA==", "bodyText": "[PMD Java] Potential violation of Law of Demeter (method chain calls) (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nLawOfDemeter\nDesign\n3\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.27.0/pmd_rules_java_design.html#lawofdemeter\n\nYou can close this issue if no need to fix it. Learn more.", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/713#discussion_r497358898", "createdAt": "2020-09-30T09:09:11Z", "author": {"login": "sider"}, "path": "src/main/java/org/fisco/bcos/web3j/precompile/consensus/ConsensusService.java", "diffHunk": "@@ -26,34 +26,50 @@ public ConsensusService(Web3j web3j, Credentials credentials) {\n     }\n \n     public String addSealer(String nodeID) throws Exception {\n-        if (!isValidNodeID(nodeID)) {\n-            return PrecompiledCommon.transferToJson(PrecompiledCommon.P2pNetwork);\n-        }\n-        List<String> sealerList = web3j.getSealerList().send().getResult();\n-        if (sealerList.contains(nodeID)) {\n-            return PrecompiledCommon.transferToJson(PrecompiledCommon.SealerList);\n-        }\n-        TransactionReceipt receipt = consensus.addSealer(nodeID).send();\n+        TransactionReceipt receipt = addSealerAndRetReceipt(nodeID);\n         return PrecompiledCommon.handleTransactionReceipt(receipt, web3j);\n     }\n \n+    public TransactionReceipt addSealerAndRetReceipt(String nodeID) throws Exception {\n+        return consensus.addSealer(nodeID).send();\n+    }\n+\n     public String addObserver(String nodeID) throws Exception {\n-        if (!isValidNodeID(nodeID)) {\n-            return PrecompiledCommon.transferToJson(PrecompiledCommon.P2pNetwork);\n-        }\n-        List<String> observerList = web3j.getObserverList().send().getResult();\n-        if (observerList.contains(nodeID)) {\n-            return PrecompiledCommon.transferToJson(PrecompiledCommon.ObserverList);\n-        }\n-        TransactionReceipt receipt = consensus.addObserver(nodeID).send();\n+        TransactionReceipt receipt = addObserverAndRetReceipt(nodeID);\n         return PrecompiledCommon.handleTransactionReceipt(receipt, web3j);\n     }\n \n+    public TransactionReceipt addObserverAndRetReceipt(String nodeID) throws Exception {\n+        return consensus.addObserver(nodeID).send();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "14b2987801cbc9d69fb8de19e91a8ecd3ddda385"}, "originalPosition": 34}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMzY0NDc1OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/fisco/bcos/web3j/precompile/consensus/ConsensusService.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwOTowOToxMVrOHaUYNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwOTowOToxMVrOHaUYNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzM1ODkwMQ==", "bodyText": "[PMD Java] Potential violation of Law of Demeter (method chain calls) (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nLawOfDemeter\nDesign\n3\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.27.0/pmd_rules_java_design.html#lawofdemeter\n\nYou can close this issue if no need to fix it. Learn more.", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/713#discussion_r497358901", "createdAt": "2020-09-30T09:09:11Z", "author": {"login": "sider"}, "path": "src/main/java/org/fisco/bcos/web3j/precompile/consensus/ConsensusService.java", "diffHunk": "@@ -26,34 +26,50 @@ public ConsensusService(Web3j web3j, Credentials credentials) {\n     }\n \n     public String addSealer(String nodeID) throws Exception {\n-        if (!isValidNodeID(nodeID)) {\n-            return PrecompiledCommon.transferToJson(PrecompiledCommon.P2pNetwork);\n-        }\n-        List<String> sealerList = web3j.getSealerList().send().getResult();\n-        if (sealerList.contains(nodeID)) {\n-            return PrecompiledCommon.transferToJson(PrecompiledCommon.SealerList);\n-        }\n-        TransactionReceipt receipt = consensus.addSealer(nodeID).send();\n+        TransactionReceipt receipt = addSealerAndRetReceipt(nodeID);\n         return PrecompiledCommon.handleTransactionReceipt(receipt, web3j);\n     }\n \n+    public TransactionReceipt addSealerAndRetReceipt(String nodeID) throws Exception {\n+        return consensus.addSealer(nodeID).send();\n+    }\n+\n     public String addObserver(String nodeID) throws Exception {\n-        if (!isValidNodeID(nodeID)) {\n-            return PrecompiledCommon.transferToJson(PrecompiledCommon.P2pNetwork);\n-        }\n-        List<String> observerList = web3j.getObserverList().send().getResult();\n-        if (observerList.contains(nodeID)) {\n-            return PrecompiledCommon.transferToJson(PrecompiledCommon.ObserverList);\n-        }\n-        TransactionReceipt receipt = consensus.addObserver(nodeID).send();\n+        TransactionReceipt receipt = addObserverAndRetReceipt(nodeID);\n         return PrecompiledCommon.handleTransactionReceipt(receipt, web3j);\n     }\n \n+    public TransactionReceipt addObserverAndRetReceipt(String nodeID) throws Exception {\n+        return consensus.addObserver(nodeID).send();\n+    }\n+\n     public String removeNode(String nodeId) throws Exception {\n         List<String> groupPeers = web3j.getGroupPeers().send().getResult();\n         if (!groupPeers.contains(nodeId)) {\n             return PrecompiledCommon.transferToJson(PrecompiledCommon.GroupPeers);\n         }\n+        TransactionReceipt receipt = null;\n+        try {\n+            receipt = removeNodeAndRetReceipt(nodeId);\n+        } catch (RuntimeException e) {\n+            // firstly remove node that sdk connected to the node, return the request that present\n+            // susscces\n+            // because the exception is throwed by getTransactionReceipt, we need ignore it.\n+            if (e.getMessage().contains(\"Don't send requests to this group\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "14b2987801cbc9d69fb8de19e91a8ecd3ddda385"}, "originalPosition": 49}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMzY0NDc5OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/fisco/bcos/web3j/precompile/consensus/ConsensusService.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwOTowOToxMVrOHaUYOQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwOTowOToxMVrOHaUYOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzM1ODkwNQ==", "bodyText": "[PMD Java] Potential violation of Law of Demeter (method chain calls) (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nLawOfDemeter\nDesign\n3\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.27.0/pmd_rules_java_design.html#lawofdemeter\n\nYou can close this issue if no need to fix it. Learn more.", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/713#discussion_r497358905", "createdAt": "2020-09-30T09:09:11Z", "author": {"login": "sider"}, "path": "src/main/java/org/fisco/bcos/web3j/precompile/consensus/ConsensusService.java", "diffHunk": "@@ -26,34 +26,50 @@ public ConsensusService(Web3j web3j, Credentials credentials) {\n     }\n \n     public String addSealer(String nodeID) throws Exception {\n-        if (!isValidNodeID(nodeID)) {\n-            return PrecompiledCommon.transferToJson(PrecompiledCommon.P2pNetwork);\n-        }\n-        List<String> sealerList = web3j.getSealerList().send().getResult();\n-        if (sealerList.contains(nodeID)) {\n-            return PrecompiledCommon.transferToJson(PrecompiledCommon.SealerList);\n-        }\n-        TransactionReceipt receipt = consensus.addSealer(nodeID).send();\n+        TransactionReceipt receipt = addSealerAndRetReceipt(nodeID);\n         return PrecompiledCommon.handleTransactionReceipt(receipt, web3j);\n     }\n \n+    public TransactionReceipt addSealerAndRetReceipt(String nodeID) throws Exception {\n+        return consensus.addSealer(nodeID).send();\n+    }\n+\n     public String addObserver(String nodeID) throws Exception {\n-        if (!isValidNodeID(nodeID)) {\n-            return PrecompiledCommon.transferToJson(PrecompiledCommon.P2pNetwork);\n-        }\n-        List<String> observerList = web3j.getObserverList().send().getResult();\n-        if (observerList.contains(nodeID)) {\n-            return PrecompiledCommon.transferToJson(PrecompiledCommon.ObserverList);\n-        }\n-        TransactionReceipt receipt = consensus.addObserver(nodeID).send();\n+        TransactionReceipt receipt = addObserverAndRetReceipt(nodeID);\n         return PrecompiledCommon.handleTransactionReceipt(receipt, web3j);\n     }\n \n+    public TransactionReceipt addObserverAndRetReceipt(String nodeID) throws Exception {\n+        return consensus.addObserver(nodeID).send();\n+    }\n+\n     public String removeNode(String nodeId) throws Exception {\n         List<String> groupPeers = web3j.getGroupPeers().send().getResult();\n         if (!groupPeers.contains(nodeId)) {\n             return PrecompiledCommon.transferToJson(PrecompiledCommon.GroupPeers);\n         }\n+        TransactionReceipt receipt = null;\n+        try {\n+            receipt = removeNodeAndRetReceipt(nodeId);\n+        } catch (RuntimeException e) {\n+            // firstly remove node that sdk connected to the node, return the request that present\n+            // susscces\n+            // because the exception is throwed by getTransactionReceipt, we need ignore it.\n+            if (e.getMessage().contains(\"Don't send requests to this group\")) {\n+                return PrecompiledCommon.transferToJson(0);\n+            } else {\n+                throw e;\n+            }\n+        }\n+        return PrecompiledCommon.handleTransactionReceipt(receipt, web3j);\n+    }\n+\n+    public TransactionReceipt removeNodeAndRetReceipt(String nodeId) throws Exception {\n+        return consensus.remove(nodeId).send();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "14b2987801cbc9d69fb8de19e91a8ecd3ddda385"}, "originalPosition": 59}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMzY0NDgxOnYy", "diffSide": "RIGHT", "path": "src/main/java/org/fisco/bcos/web3j/precompile/crud/CRUDService.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwOTowOToxMlrOHaUYOw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwOTowOToxMlrOHaUYOw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzM1ODkwNw==", "bodyText": "[PMD Java] Potential violation of Law of Demeter (method chain calls) (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nLawOfDemeter\nDesign\n3\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.27.0/pmd_rules_java_design.html#lawofdemeter\n\nYou can close this issue if no need to fix it. Learn more.", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/713#discussion_r497358907", "createdAt": "2020-09-30T09:09:12Z", "author": {"login": "sider"}, "path": "src/main/java/org/fisco/bcos/web3j/precompile/crud/CRUDService.java", "diffHunk": "@@ -64,6 +70,21 @@ public int insert(Table table, Entry entry) throws Exception {\n         return PrecompiledCommon.handleTransactionReceiptForCRUD(receipt);\n     }\n \n+    public void insert(Table table, Entry entry, TransactionSucCallback callback) throws Exception {\n+\n+        if (table.getKey().length() > PrecompiledCommon.TABLE_KEY_MAX_LENGTH) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "14b2987801cbc9d69fb8de19e91a8ecd3ddda385"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMzY0NDg0OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/fisco/bcos/web3j/precompile/crud/CRUDService.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwOTowOToxMlrOHaUYPw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwOTowOToxMlrOHaUYPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzM1ODkxMQ==", "bodyText": "[PMD Java] Potential violation of Law of Demeter (method chain calls) (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nLawOfDemeter\nDesign\n3\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.27.0/pmd_rules_java_design.html#lawofdemeter\n\nYou can close this issue if no need to fix it. Learn more.", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/713#discussion_r497358911", "createdAt": "2020-09-30T09:09:12Z", "author": {"login": "sider"}, "path": "src/main/java/org/fisco/bcos/web3j/precompile/crud/CRUDService.java", "diffHunk": "@@ -64,6 +70,21 @@ public int insert(Table table, Entry entry) throws Exception {\n         return PrecompiledCommon.handleTransactionReceiptForCRUD(receipt);\n     }\n \n+    public void insert(Table table, Entry entry, TransactionSucCallback callback) throws Exception {\n+\n+        if (table.getKey().length() > PrecompiledCommon.TABLE_KEY_MAX_LENGTH) {\n+            throw new PrecompileMessageException(\n+                    \"The value of the table key exceeds the maximum limit(\"\n+                            + PrecompiledCommon.TABLE_KEY_MAX_LENGTH\n+                            + \").\");\n+        }\n+        String entryJsonStr =\n+                ObjectMapperFactory.getObjectMapper().writeValueAsString(entry.getFields());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "14b2987801cbc9d69fb8de19e91a8ecd3ddda385"}, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExMzY0NDg3OnYy", "diffSide": "RIGHT", "path": "src/main/java/org/fisco/bcos/web3j/precompile/crud/CRUDService.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwOTowOToxMlrOHaUYQQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQwOTowOToxMlrOHaUYQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzM1ODkxMw==", "bodyText": "[PMD Java] Potential violation of Law of Demeter (method chain calls) (view)\n\n\n\n\nRule\nRuleset\nPriority\n\n\n\n\nLawOfDemeter\nDesign\n3\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.27.0/pmd_rules_java_design.html#lawofdemeter\n\nYou can close this issue if no need to fix it. Learn more.", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/713#discussion_r497358913", "createdAt": "2020-09-30T09:09:12Z", "author": {"login": "sider"}, "path": "src/main/java/org/fisco/bcos/web3j/precompile/crud/CRUDService.java", "diffHunk": "@@ -87,6 +108,30 @@ public int update(Table table, Entry entry, Condition condition) throws Exceptio\n         return PrecompiledCommon.handleTransactionReceiptForCRUD(receipt);\n     }\n \n+    public void update(\n+            Table table, Entry entry, Condition condition, TransactionSucCallback callback)\n+            throws Exception {\n+\n+        if (table.getKey().length() > PrecompiledCommon.TABLE_KEY_MAX_LENGTH) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "14b2987801cbc9d69fb8de19e91a8ecd3ddda385"}, "originalPosition": 50}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 617, "cost": 1, "resetAt": "2021-11-12T18:49:56Z"}}}