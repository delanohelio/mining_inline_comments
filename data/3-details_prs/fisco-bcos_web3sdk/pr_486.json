{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU4NTQ0NDY4", "number": 486, "title": "fix the bug of sm2 verify && add the test case", "bodyText": "as the title mentioned", "createdAt": "2020-01-02T03:34:29Z", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/486", "merged": true, "mergeCommit": {"oid": "e6c909df006e3935246d98238c9d386c1315400e"}, "closed": true, "closedAt": "2020-01-03T06:29:42Z", "author": {"login": "dalaocu"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABbkoYUVAH2gAyMzU4NTQ0NDY4OmQzOGNhOWYwZGMzNDBhYTAzZTVjYjcyOGU1ODdkN2E0MGUxZjNmNjM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb2oXuCgFqTMzNzk1OTk4Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d38ca9f0dc340aa03e5cb728e587d7a40e1f3f63", "author": {"user": {"login": "ywy2090", "name": null}}, "url": "https://github.com/FISCO-BCOS/web3sdk/commit/d38ca9f0dc340aa03e5cb728e587d7a40e1f3f63", "committedDate": "2019-11-08T08:18:58Z", "message": "Fix gm unusable bugs (#437)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "85977860179013e9e43d3342c5e0e1e3cd9d692e", "author": {"user": {"login": "ywy2090", "name": null}}, "url": "https://github.com/FISCO-BCOS/web3sdk/commit/85977860179013e9e43d3342c5e0e1e3cd9d692e", "committedDate": "2019-11-14T12:55:08Z", "message": "update ChangeLog.md (#448)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "005dde1a8f304f60faee1142a315569d744e67eb", "author": {"user": {"login": "dalaocu", "name": null}}, "url": "https://github.com/FISCO-BCOS/web3sdk/commit/005dde1a8f304f60faee1142a315569d744e67eb", "committedDate": "2020-01-02T03:18:21Z", "message": "fix the bug of sm2 verify && add the test case"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3eb97637a45532ea64cc1b243602acfb4b681597", "author": {"user": {"login": "dalaocu", "name": null}}, "url": "https://github.com/FISCO-BCOS/web3sdk/commit/3eb97637a45532ea64cc1b243602acfb4b681597", "committedDate": "2020-01-02T03:30:51Z", "message": "merge"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "88f35390c3a25d583f4c0355f311dd1324f968e5", "author": {"user": {"login": "dalaocu", "name": null}}, "url": "https://github.com/FISCO-BCOS/web3sdk/commit/88f35390c3a25d583f4c0355f311dd1324f968e5", "committedDate": "2020-01-02T03:31:55Z", "message": "format"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM3NTI0ODMw", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/486#pullrequestreview-337524830", "createdAt": "2020-01-02T03:36:43Z", "commit": {"oid": "88f35390c3a25d583f4c0355f311dd1324f968e5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cfa5d8659dc9eec4631a6ca008a14a844341cc83", "author": {"user": {"login": "dalaocu", "name": null}}, "url": "https://github.com/FISCO-BCOS/web3sdk/commit/cfa5d8659dc9eec4631a6ca008a14a844341cc83", "committedDate": "2020-01-02T13:23:56Z", "message": "rm print"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM3NjU1OTQz", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/486#pullrequestreview-337655943", "createdAt": "2020-01-02T13:25:16Z", "commit": {"oid": "cfa5d8659dc9eec4631a6ca008a14a844341cc83"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wMlQxMzoyNToxNlrOFZrf7Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wMlQxMzoyNToxNlrOFZrf7Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjQ3MTQwNQ==", "bodyText": "[PMD] Found 'DU'-anomaly for variable 'publicKeyBytes' (lines '72'-'86'). (see on Sider)\n\n\n\n\nRule\n\n\n\n\nError Prone-DataflowAnomalyAnalysis-05494a1db449e2d66c833277a6cffe821b6225d6\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.20.0/pmd_rules_java_errorprone.html#dataflowanomalyanalysis", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/486#discussion_r362471405", "createdAt": "2020-01-02T13:25:16Z", "author": {"login": "sider"}, "path": "src/test/java/org/fisco/bcos/web3j/crypto/SignTest.java", "diffHunk": "@@ -52,4 +63,25 @@ public void testPublicKeyFromPrivatePoint() {\n         ECPoint point = Sign.publicPointFromPrivate(SampleKeys.PRIVATE_KEY);\n         assertThat(Sign.publicFromPoint(point.getEncoded(false)), equalTo(SampleKeys.PUBLIC_KEY));\n     }\n+    \n+    @Test\n+    public void testGmSignVerify() throws IOException {\n+        byte[] sourceData = Hex.decode(\"434477813974bf58f94bcf760833c2b40f77a5fc360485b0b9ed1bd9682edb45\");\n+        String publicKey =\n+                \"e8c670380cb220095268f40221fc748fa6ac39d6e930e63c30da68bad97f885da6e8c9ad722c3683ab859393220d1431eb1818ed44a942efb07b261a0fc769e7\";\n+        byte[] publicKeyBytes = Hex.decode(publicKey);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cfa5d8659dc9eec4631a6ca008a14a844341cc83"}, "originalPosition": 31}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9fb722d6ffdd6339f161f847c28b0f639e560b34", "author": {"user": {"login": "cyjseagull", "name": "cyjseagull"}}, "url": "https://github.com/FISCO-BCOS/web3sdk/commit/9fb722d6ffdd6339f161f847c28b0f639e560b34", "committedDate": "2020-01-03T02:28:15Z", "message": "Merge branch 'release-2.2.1' into release-2.1.2"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "505a5a4046e6164ff44ab768b750107eca04a8df", "author": {"user": {"login": "dalaocu", "name": null}}, "url": "https://github.com/FISCO-BCOS/web3sdk/commit/505a5a4046e6164ff44ab768b750107eca04a8df", "committedDate": "2020-01-03T03:08:15Z", "message": "fix style"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7689230ee8e728a2f96384ba5c5a6f17fb818fe7", "author": {"user": {"login": "dalaocu", "name": null}}, "url": "https://github.com/FISCO-BCOS/web3sdk/commit/7689230ee8e728a2f96384ba5c5a6f17fb818fe7", "committedDate": "2020-01-03T03:37:43Z", "message": "test msg"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cfa7300fef3285e9ff512d2ff43501631c3f222a", "author": {"user": {"login": "dalaocu", "name": null}}, "url": "https://github.com/FISCO-BCOS/web3sdk/commit/cfa7300fef3285e9ff512d2ff43501631c3f222a", "committedDate": "2020-01-03T03:56:55Z", "message": "format"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM3OTQzMTQw", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/486#pullrequestreview-337943140", "createdAt": "2020-01-03T03:58:20Z", "commit": {"oid": "cfa7300fef3285e9ff512d2ff43501631c3f222a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wM1QwMzo1ODoyMFrOFZ5hVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wM1QwMzo1ODoyMFrOFZ5hVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjcwMTE0MQ==", "bodyText": "[PMD] Potential violation of Law of Demeter (object not created locally) (see on Sider)\n\n\n\n\nRule\n\n\n\n\nDesign-LawOfDemeter-b97a717b6b3cf4346fbdcd26a2e8e1637439cf60\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.20.0/pmd_rules_java_design.html#lawofdemeter", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/486#discussion_r362701141", "createdAt": "2020-01-03T03:58:20Z", "author": {"login": "sider"}, "path": "src/test/java/org/fisco/bcos/web3j/crypto/SignTest.java", "diffHunk": "@@ -52,4 +62,31 @@ public void testPublicKeyFromPrivatePoint() {\n         ECPoint point = Sign.publicPointFromPrivate(SampleKeys.PRIVATE_KEY);\n         assertThat(Sign.publicFromPoint(point.getEncoded(false)), equalTo(SampleKeys.PUBLIC_KEY));\n     }\n+\n+    @Test\n+    public void testGmSignVerify() throws IOException {\n+        byte[] sourceData =\n+                Hex.decode(\"434477813974bf58f94bcf760833c2b40f77a5fc360485b0b9ed1bd9682edb45\");\n+        String publicKey =\n+                \"e8c670380cb220095268f40221fc748fa6ac39d6e930e63c30da68bad97f885da6e8c9ad722c3683ab859393220d1431eb1818ed44a942efb07b261a0fc769e7\";\n+        String sign =\n+                \"09628650676000c8d18bf43db68e7f66dfaed230d87e6391c29eb594b7b9cc3c8d370dbd29ce62bbcf3506adb57f041d8646ae4f70a26ea5179418e738fd4372e8c670380cb220095268f40221fc748fa6ac39d6e930e63c30da68bad97f885da6e8c9ad722c3683ab859393220d1431eb1818ed44a942efb07b261a0fc769e7\";\n+        byte[] signatureBytes = Numeric.hexStringToByteArray(\"0x\" + sign);\n+\n+        ASN1Integer d_r =\n+                new ASN1Integer(new BigInteger(1, Arrays.copyOfRange(signatureBytes, 0, 32)));\n+        ASN1Integer d_s =\n+                new ASN1Integer(new BigInteger(1, Arrays.copyOfRange(signatureBytes, 32, 64)));\n+        ASN1EncodableVector v2 = new ASN1EncodableVector();\n+        v2.add(d_r);\n+        v2.add(d_s);\n+        DERSequence der = new DERSequence(v2);\n+        boolean b =\n+                SM2Algorithm.verify(\n+                        sourceData,\n+                        der.getEncoded(),\n+                        publicKey.substring(0, 64),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cfa7300fef3285e9ff512d2ff43501631c3f222a"}, "originalPosition": 47}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM3OTQzMTQx", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/486#pullrequestreview-337943141", "createdAt": "2020-01-03T03:58:21Z", "commit": {"oid": "cfa7300fef3285e9ff512d2ff43501631c3f222a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wM1QwMzo1ODoyMVrOFZ5hVw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wM1QwMzo1ODoyMVrOFZ5hVw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjcwMTE0Mw==", "bodyText": "[PMD] Potential violation of Law of Demeter (object not created locally) (see on Sider)\n\n\n\n\nRule\n\n\n\n\nDesign-LawOfDemeter-b97a717b6b3cf4346fbdcd26a2e8e1637439cf60\n\n\n\nReferences:\n\nhttps://pmd.github.io/pmd-6.20.0/pmd_rules_java_design.html#lawofdemeter", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/486#discussion_r362701143", "createdAt": "2020-01-03T03:58:21Z", "author": {"login": "sider"}, "path": "src/test/java/org/fisco/bcos/web3j/crypto/SignTest.java", "diffHunk": "@@ -52,4 +62,31 @@ public void testPublicKeyFromPrivatePoint() {\n         ECPoint point = Sign.publicPointFromPrivate(SampleKeys.PRIVATE_KEY);\n         assertThat(Sign.publicFromPoint(point.getEncoded(false)), equalTo(SampleKeys.PUBLIC_KEY));\n     }\n+\n+    @Test\n+    public void testGmSignVerify() throws IOException {\n+        byte[] sourceData =\n+                Hex.decode(\"434477813974bf58f94bcf760833c2b40f77a5fc360485b0b9ed1bd9682edb45\");\n+        String publicKey =\n+                \"e8c670380cb220095268f40221fc748fa6ac39d6e930e63c30da68bad97f885da6e8c9ad722c3683ab859393220d1431eb1818ed44a942efb07b261a0fc769e7\";\n+        String sign =\n+                \"09628650676000c8d18bf43db68e7f66dfaed230d87e6391c29eb594b7b9cc3c8d370dbd29ce62bbcf3506adb57f041d8646ae4f70a26ea5179418e738fd4372e8c670380cb220095268f40221fc748fa6ac39d6e930e63c30da68bad97f885da6e8c9ad722c3683ab859393220d1431eb1818ed44a942efb07b261a0fc769e7\";\n+        byte[] signatureBytes = Numeric.hexStringToByteArray(\"0x\" + sign);\n+\n+        ASN1Integer d_r =\n+                new ASN1Integer(new BigInteger(1, Arrays.copyOfRange(signatureBytes, 0, 32)));\n+        ASN1Integer d_s =\n+                new ASN1Integer(new BigInteger(1, Arrays.copyOfRange(signatureBytes, 32, 64)));\n+        ASN1EncodableVector v2 = new ASN1EncodableVector();\n+        v2.add(d_r);\n+        v2.add(d_s);\n+        DERSequence der = new DERSequence(v2);\n+        boolean b =\n+                SM2Algorithm.verify(\n+                        sourceData,\n+                        der.getEncoded(),\n+                        publicKey.substring(0, 64),\n+                        publicKey.substring(64, 128));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cfa7300fef3285e9ff512d2ff43501631c3f222a"}, "originalPosition": 48}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM3OTU5OTgz", "url": "https://github.com/FISCO-BCOS/web3sdk/pull/486#pullrequestreview-337959983", "createdAt": "2020-01-03T06:28:57Z", "commit": {"oid": "cfa7300fef3285e9ff512d2ff43501631c3f222a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1995, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}