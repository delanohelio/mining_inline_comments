{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI0MDg4NjI3", "number": 418, "title": "NMA -390 Blockchain Identity Persistance", "bodyText": "This does not change the blockchain_identity table much besides adding one field to support item 4.\n\n\nSupport recovering the username when the blockchain is rescanned.\n\n\nSupport recovering the username when the wallet is restored from a recovery phrase.\n\n\nSupport recovering the username when the wallet is restored from a backup file (not tested)\n\n\nSupport restarting the recovery when interupted (not tested)\n\n\nSave the DashPay profile in the database and support recovering it as part of a recovery operation.\n\n\nAssociated DashPay library PR:  dashevo/android-dashpay#6\nDPP PR: dashevo/android-dpp#4", "createdAt": "2020-05-27T20:09:14Z", "url": "https://github.com/dashevo/dash-wallet/pull/418", "merged": true, "mergeCommit": {"oid": "aab3e2e75bd4e99e6cd3a8f13663d7164585a011"}, "closed": true, "closedAt": "2020-06-01T13:17:21Z", "author": {"login": "HashEngineering"}, "timelineItems": {"totalCount": 27, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABclfCCpAFqTQxOTU3MTgxMg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcm_1BKAH2gAyNDI0MDg4NjI3OjIwZjIyYTBiZDVkMzEyNDM5ZjQ5MzA4NzUwNmIyN2UxOWVjYTQ1N2Q=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE5NTcxODEy", "url": "https://github.com/dashevo/dash-wallet/pull/418#pullrequestreview-419571812", "createdAt": "2020-05-27T20:10:33Z", "commit": {"oid": "f04482d751efc5b739e13f7681462754466b0d31"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QyMDoxMDozM1rOGbbZhA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QyMDoxMDozM1rOGbbZhA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTQxMzYzNg==", "bodyText": "For some reason the listener added here was being called three times.  This resulted in three services being created.", "url": "https://github.com/dashevo/dash-wallet/pull/418#discussion_r431413636", "createdAt": "2020-05-27T20:10:33Z", "author": {"login": "HashEngineering"}, "path": "wallet/src/de/schildbach/wallet/service/BlockchainServiceImpl.java", "diffHunk": "@@ -773,12 +789,31 @@ public void onCreate() {\n \n         peerDiscoveryList.add(dnsDiscovery);\n         updateAppWidget();\n+\n+        initViewModel();\n+    }\n+\n+    void initViewModel() {\n+\n         AppDatabase.getAppDatabase().blockchainStateDao().load().observe(this, new Observer<BlockchainState>() {\n             @Override\n             public void onChanged(BlockchainState blockchainState) {\n                 handleBlockchainStateNotification(blockchainState);\n             }\n         });\n+\n+        Wallet wallet = ((WalletApplication) getApplication()).getWallet();\n+        //wallet.addCreditFundingEventListener(Threading.SAME_THREAD, creditFundingTransactionEventListener);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f04482d751efc5b739e13f7681462754466b0d31"}, "originalPosition": 95}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE5NTk2NjI1", "url": "https://github.com/dashevo/dash-wallet/pull/418#pullrequestreview-419596625", "createdAt": "2020-05-27T20:48:54Z", "commit": {"oid": "f04482d751efc5b739e13f7681462754466b0d31"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QyMDo0ODo1NFrOGbck_A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QyMDo0ODo1NFrOGbck_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTQzMjk1Ng==", "bodyText": "comment is wrong", "url": "https://github.com/dashevo/dash-wallet/pull/418#discussion_r431432956", "createdAt": "2020-05-27T20:48:54Z", "author": {"login": "HashEngineering"}, "path": "wallet/src/de/schildbach/wallet/ui/dashpay/PlatformRepo.kt", "diffHunk": "@@ -147,4 +166,13 @@ class PlatformRepo(val walletApplication: WalletApplication) {\n             }\n         }\n     }\n+\n+    //\n+    // Step 5: Find the identity in the case of recovery", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f04482d751efc5b739e13f7681462754466b0d31"}, "originalPosition": 46}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "26167fc65a0245598ea4168286bf42e6836560d3", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/26167fc65a0245598ea4168286bf42e6836560d3", "committedDate": "2020-05-29T16:30:03Z", "message": "Add ability to recover a username when rescanning blockchain"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b0397787fdd8277843ae90beabba7cdff0d1168a", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/b0397787fdd8277843ae90beabba7cdff0d1168a", "committedDate": "2020-05-29T16:31:29Z", "message": "Add support for restoring the username from a recovery phrase"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "cc88524e6f6dd54a8d2cb350bb93a8e77aff97cc", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/cc88524e6f6dd54a8d2cb350bb93a8e77aff97cc", "committedDate": "2020-05-28T22:04:49Z", "message": "Add support for restoring the username from a recovery phrase"}, "afterCommit": {"oid": "b0397787fdd8277843ae90beabba7cdff0d1168a", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/b0397787fdd8277843ae90beabba7cdff0d1168a", "committedDate": "2020-05-29T16:31:29Z", "message": "Add support for restoring the username from a recovery phrase"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9dd5fb2c50a20bbdf17c57ea641ea665b52526df", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/9dd5fb2c50a20bbdf17c57ea641ea665b52526df", "committedDate": "2020-05-30T04:21:46Z", "message": "Add \"restoring\" to save the type of operation (create / restore)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e7cd98d508026627a80254d48a17743d8a896250", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/e7cd98d508026627a80254d48a17743d8a896250", "committedDate": "2020-05-30T04:23:58Z", "message": "Add ability to restart a recover operation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ad446974006366475428afbf12f13864809be7cb", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/ad446974006366475428afbf12f13864809be7cb", "committedDate": "2020-05-30T04:24:45Z", "message": "Add simple DashPayProfile management to the database"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "552cf7255cdf21746c496ea7e0274c6c5ce7f92e", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/552cf7255cdf21746c496ea7e0274c6c5ce7f92e", "committedDate": "2020-05-30T04:31:19Z", "message": "Remove unnecessary code and imports"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ea9e9bef126fb1475c7b0e4c696871b23a79e3bf", "author": {"user": {"login": "tomasz-ludek", "name": null}}, "url": "https://github.com/dashevo/dash-wallet/commit/ea9e9bef126fb1475c7b0e4c696871b23a79e3bf", "committedDate": "2020-05-30T08:59:31Z", "message": "Merge branch 'evonet-develop' into blockchain-identity-persistance"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9421ac65587e8343a23ceef9b6073e0589c1502a", "author": {"user": {"login": "tomasz-ludek", "name": null}}, "url": "https://github.com/dashevo/dash-wallet/commit/9421ac65587e8343a23ceef9b6073e0589c1502a", "committedDate": "2020-05-30T09:27:30Z", "message": "Preventing kotlin NPE crash in CreateIdentityService.\nDisabled the ability to use existing username (it was ebanled for testing).\nAdded wake lock acquiring in CreateIdentityService to prevent from interrupting process by the system suspend.\nHide `Join DashPay` button during creation process.\nMerged `evonet-develop` into `blockchain-identity-persistance`."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxMzkyMjUw", "url": "https://github.com/dashevo/dash-wallet/pull/418#pullrequestreview-421392250", "createdAt": "2020-05-30T09:28:19Z", "commit": {"oid": "ea9e9bef126fb1475c7b0e4c696871b23a79e3bf"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d203b46937b27d370c378638a06da5179166b02", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/8d203b46937b27d370c378638a06da5179166b02", "committedDate": "2020-05-30T10:41:59Z", "message": "Merge branch 'blockchain-identity-persistance' of http://github.com/dashevo/dash-wallet into blockchain-identity-persistance"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "51289c74b24a487d454beb83178a0d24f0c72d9d", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/51289c74b24a487d454beb83178a0d24f0c72d9d", "committedDate": "2020-05-30T18:57:58Z", "message": "Show 1 letter on avatar.  Hide avatar when there is no username"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d0f0f4420d0623092cd92a2a41e7a2bf5417e03", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/9d0f0f4420d0623092cd92a2a41e7a2bf5417e03", "committedDate": "2020-05-31T03:02:38Z", "message": "Remove dashpayprofile on reset"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "628e9f2700050204dc34dadc7144dedbf38b77c6", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/628e9f2700050204dc34dadc7144dedbf38b77c6", "committedDate": "2020-05-31T03:17:55Z", "message": "Fix logging of errors"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxNDk5MTk2", "url": "https://github.com/dashevo/dash-wallet/pull/418#pullrequestreview-421499196", "createdAt": "2020-05-31T14:17:50Z", "commit": {"oid": "628e9f2700050204dc34dadc7144dedbf38b77c6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMVQxNDoxNzo1MVrOGc5R5A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMVQxNDoxNzo1MVrOGc5R5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjk1MTc4MA==", "bodyText": "When resetting a wallet, this code does not appear to be executed.  Is it because we are using an executor? @tomasz-ludek\nPerhaps the app is restarted before this is executed.  When doing a rescan blockchain, this code is executed.", "url": "https://github.com/dashevo/dash-wallet/pull/418#discussion_r432951780", "createdAt": "2020-05-31T14:17:51Z", "author": {"login": "HashEngineering"}, "path": "wallet/src/de/schildbach/wallet/service/BlockchainServiceImpl.java", "diffHunk": "@@ -916,6 +930,15 @@ public void onDestroy() {\n                 log.info(\"removing wallet file and app data\");\n                 application.finalizeWipe();\n             }\n+            //Clear the blockchain identity\n+            executor.execute(new Runnable() {\n+                @Override\n+                public void run() {\n+                    //not sure when this will execute\n+                    AppDatabase.getAppDatabase().blockchainIdentityDataDao().clear();\n+                    AppDatabase.getAppDatabase().dashPayProfileDao().clear();\n+                }\n+            });", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "628e9f2700050204dc34dadc7144dedbf38b77c6"}, "originalPosition": 84}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "26496fafcba50fd03cfab2a9ea4280341ac255d2", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/26496fafcba50fd03cfab2a9ea4280341ac255d2", "committedDate": "2020-05-31T14:49:45Z", "message": "Don't show avatar if there is no username"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0ff2704207c11681f11ae99df076deceb5462d57", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/0ff2704207c11681f11ae99df076deceb5462d57", "committedDate": "2020-05-31T14:56:15Z", "message": "Remove databases when restoring from seed, file or creating new wallet"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9900b4f7663decf9910fbbf1bb8fbc3a674117f6", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/9900b4f7663decf9910fbbf1bb8fbc3a674117f6", "committedDate": "2020-05-31T15:36:11Z", "message": "Hide the hello card (top item in history) after clicking on it"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDIxNTE3MzU0", "url": "https://github.com/dashevo/dash-wallet/pull/418#pullrequestreview-421517354", "createdAt": "2020-05-31T18:31:16Z", "commit": {"oid": "9900b4f7663decf9910fbbf1bb8fbc3a674117f6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6ee1ada6796182f119d40a03326d69d1ca0d2aed", "author": {"user": {"login": "tomasz-ludek", "name": null}}, "url": "https://github.com/dashevo/dash-wallet/commit/6ee1ada6796182f119d40a03326d69d1ca0d2aed", "committedDate": "2020-06-01T11:02:36Z", "message": "Changed color of the check marks during username validation to green.\nMinor refactoring."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "40c04f989e81f88a56ac572dab126c2e7d8b1f91", "author": {"user": {"login": "tomasz-ludek", "name": null}}, "url": "https://github.com/dashevo/dash-wallet/commit/40c04f989e81f88a56ac572dab126c2e7d8b1f91", "committedDate": "2020-06-01T11:09:23Z", "message": "Changed shades for green of the check marks during username validation."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "14167bb8e4c280fdcf49e892ea209a3e6b4256b2", "author": {"user": {"login": "tomasz-ludek", "name": null}}, "url": "https://github.com/dashevo/dash-wallet/commit/14167bb8e4c280fdcf49e892ea209a3e6b4256b2", "committedDate": "2020-06-01T11:37:49Z", "message": "Changed some messages when recovering the identity"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "abf080a0abd2f695b9c389510137fcd3bdf669e6", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/abf080a0abd2f695b9c389510137fcd3bdf669e6", "committedDate": "2020-06-01T12:30:13Z", "message": "Simplify the database removal step in finalize wipe"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4be4ac4c56abb55b4abb4df4a1604fd1dcff2651", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/4be4ac4c56abb55b4abb4df4a1604fd1dcff2651", "committedDate": "2020-06-01T12:51:09Z", "message": "Remove comment about when a thread executes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "20f22a0bd5d312439f493087506b27e19eca457d", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/20f22a0bd5d312439f493087506b27e19eca457d", "committedDate": "2020-06-01T12:57:08Z", "message": "Change comment about thread execution"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2916, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}