{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk3OTQzNTM3", "number": 366, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QwNToyNDoyM1rODuNj7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QwNTozMDo1MlrODuNn4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5NzgzMjc2OnYy", "diffSide": "RIGHT", "path": "wallet/src/de/schildbach/wallet/service/BlockchainServiceImpl.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QwNToyNDoyM1rOGAFgRQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QwNToyNDoyM1rOGAFgRQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjc0MzM2NQ==", "bodyText": "before the Prevent Sending when Syncing story in v7 or v6, this was where the blockchain state was updated and broadcast.", "url": "https://github.com/dashevo/dash-wallet/pull/366#discussion_r402743365", "createdAt": "2020-04-03T05:24:23Z", "author": {"login": "HashEngineering"}, "path": "wallet/src/de/schildbach/wallet/service/BlockchainServiceImpl.java", "diffHunk": "@@ -377,19 +378,32 @@ public void run() {\n                     if(timeAgo < DateUtils.DAY_IN_MILLIS)\n                         config.setRestoringBackup(false);\n                 }\n+                // this method is always called after progress or doneDownload\n+                updateBlockchainState();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2db5bdef8f4081ff839dfe541f30f6937a4ca99b"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5Nzg0MDMxOnYy", "diffSide": "RIGHT", "path": "wallet/src/de/schildbach/wallet/service/BlockchainServiceImpl.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QwNToyODo1NVrOGAFkrw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QwNToyODo1NVrOGAFkrw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjc0NDQ5NQ==", "bodyText": "There may be a better way to do this in the BlockListFragment, with a database observer.  For now this is the quickest way to trigger the block loader in BlockListFragment without more significant rewrites.", "url": "https://github.com/dashevo/dash-wallet/pull/366#discussion_r402744495", "createdAt": "2020-04-03T05:28:55Z", "author": {"login": "HashEngineering"}, "path": "wallet/src/de/schildbach/wallet/service/BlockchainServiceImpl.java", "diffHunk": "@@ -1026,6 +1040,11 @@ private void broadcastPeerState(final int numPeers) {\n     }\n \n     private void handleBlockchainStateNotification(BlockchainState blockchainState) {\n+        // send this out for the Network Monitor, other activities observe the database\n+        final Intent broadcast = new Intent(ACTION_BLOCKCHAIN_STATE);\n+        broadcast.setPackage(getPackageName());\n+        LocalBroadcastManager.getInstance(this).sendBroadcast(broadcast);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2db5bdef8f4081ff839dfe541f30f6937a4ca99b"}, "originalPosition": 50}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQ5Nzg0Mjg4OnYy", "diffSide": "RIGHT", "path": "wallet/src/de/schildbach/wallet/service/BlockchainServiceImpl.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QwNTozMDo1MlrOGAFmTQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0wM1QwNTozMDo1MlrOGAFmTQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjc0NDkwOQ==", "bodyText": "This is a calculation that gives the percentage in terms how much the entire blockchain is synced (from block 0).  This is some left over code that should have been caught in a previous review 4 months ago when the method was changed to match what dashj provides in the progress method above.  If a user starts the app after 1 week with this code, the % will be displayed as 99% instead of 0 when the app starts to sync.", "url": "https://github.com/dashevo/dash-wallet/pull/366#discussion_r402744909", "createdAt": "2020-04-03T05:30:52Z", "author": {"login": "HashEngineering"}, "path": "wallet/src/de/schildbach/wallet/service/BlockchainServiceImpl.java", "diffHunk": "@@ -1045,19 +1064,7 @@ private void handleBlockchainStateNotification(BlockchainState blockchainState)\n     }\n \n     private int percentageSync() {\n-        int chainHeadHeight = blockChain.getChainHead().getHeight();\n-        int mostCommonChainHeight;\n-        if (peerGroup == null) {\n-            return 0;\n-        }\n-        if (peerGroup.getMostCommonChainHeight() > 0) {\n-            mostCommonChainHeight = peerGroup.getMostCommonChainHeight();\n-        } else {\n-            mostCommonChainHeight = chainHeadHeight;\n-        }\n-        float percentage = ((float) chainHeadHeight / (float) mostCommonChainHeight) * 100;\n-        log.info(\"mostCommonChainHeight: \" + mostCommonChainHeight + \"\\tchainHeadHeight: \" + chainHeadHeight + \"\\t\" + percentage + \"%\\t\" + config.getBestChainHeightEver());\n-        return (int) percentage;\n+        return syncPercentage;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2db5bdef8f4081ff839dfe541f30f6937a4ca99b"}, "originalPosition": 72}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 632, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}