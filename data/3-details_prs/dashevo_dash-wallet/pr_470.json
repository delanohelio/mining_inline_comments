{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYyMTkxMzk3", "number": 470, "title": "Another attempt to fix the KRIP crash on Android 8.0/8.1", "bodyText": "Using JobScheduler instead of AlarmManager to trigger periodic blockchain sync on Android 8.0 and 8.1", "createdAt": "2020-08-03T13:52:43Z", "url": "https://github.com/dashevo/dash-wallet/pull/470", "merged": true, "mergeCommit": {"oid": "5bcd2898fc4b2e472f653116e8e6a12cc93d7420"}, "closed": true, "closedAt": "2020-08-11T00:02:22Z", "author": {"login": "tomasz-ludek"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc7SXILAH2gAyNDYyMTkxMzk3OjBkMjAzNmYyNzFhNmIwY2QyNjg4M2IwMzI5NGRiNDI4NjczMDA4NGM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc9mOwDAFqTQ2NDQ1OTM3MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0d2036f271a6b0cd26883b03294db4286730084c", "author": {"user": {"login": "tomasz-ludek", "name": null}}, "url": "https://github.com/dashevo/dash-wallet/commit/0d2036f271a6b0cd26883b03294db4286730084c", "committedDate": "2020-08-03T13:51:10Z", "message": "Using JobScheduler instead of AlarmManager to trigger periodic blockchain sync on Android 8.0 and 8.1"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2ced1beeac1526981290831ac55cd1449cb2b26f", "author": {"user": {"login": "tomasz-ludek", "name": null}}, "url": "https://github.com/dashevo/dash-wallet/commit/2ced1beeac1526981290831ac55cd1449cb2b26f", "committedDate": "2020-08-03T16:05:03Z", "message": "Force startForeground of BlockchainServiceImpl from ServiceConnection to make sure the Krip crash is fixed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b6b8e6bc45e80ba23739559f3dde61176ef1be42", "author": {"user": {"login": "tomasz-ludek", "name": null}}, "url": "https://github.com/dashevo/dash-wallet/commit/b6b8e6bc45e80ba23739559f3dde61176ef1be42", "committedDate": "2020-08-03T16:39:14Z", "message": "Avoid rescheduling existing  blockchain sync job with the same interval"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "91474fb2861fc7637f61e60ca1682c1c69da94c9", "author": {"user": {"login": "tomasz-ludek", "name": null}}, "url": "https://github.com/dashevo/dash-wallet/commit/91474fb2861fc7637f61e60ca1682c1c69da94c9", "committedDate": "2020-08-03T16:59:17Z", "message": "Moved the custom sync scheduling below `alarmManager.cancel(alarmIntent);` to force removing existing alarms also on Android 8/8.1"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwMjMzNjc5", "url": "https://github.com/dashevo/dash-wallet/pull/470#pullrequestreview-460233679", "createdAt": "2020-08-03T18:02:42Z", "commit": {"oid": "91474fb2861fc7637f61e60ca1682c1c69da94c9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYzNTAxMTA0", "url": "https://github.com/dashevo/dash-wallet/pull/470#pullrequestreview-463501104", "createdAt": "2020-08-07T17:58:17Z", "commit": {"oid": "91474fb2861fc7637f61e60ca1682c1c69da94c9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QxNzo1ODoxN1rOG9i7XA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wN1QxNzo1ODoxN1rOG9i7XA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzE4ODU3Mg==", "bodyText": "Lets report the interval in minutes.", "url": "https://github.com/dashevo/dash-wallet/pull/470#discussion_r467188572", "createdAt": "2020-08-07T17:58:17Z", "author": {"login": "HashEngineering"}, "path": "wallet/src/de/schildbach/wallet/WalletApplication.java", "diffHunk": "@@ -713,10 +720,27 @@ else if (lastUsedAgo < Constants.LAST_USAGE_THRESHOLD_RECENTLY_MS)\n         }\n         alarmManager.cancel(alarmIntent);\n \n-        // workaround for no inexact set() before KitKat\n-        final long now = System.currentTimeMillis();\n-        alarmManager.setInexactRepeating(AlarmManager.RTC_WAKEUP, now + alarmInterval, AlarmManager.INTERVAL_DAY,\n-                alarmIntent);\n+        if (Build.VERSION.SDK_INT == Build.VERSION_CODES.O || Build.VERSION.SDK_INT == Build.VERSION_CODES.O_MR1) {\n+            log.info(\"custom sync scheduling with JobScheduler for Android 8 and 8.1\");\n+            JobScheduler jobScheduler = (JobScheduler) context.getSystemService(Context.JOB_SCHEDULER_SERVICE);\n+            JobInfo pendingJob = jobScheduler.getPendingJob(BLOCKCHAIN_SYNC_JOB_ID);\n+            if (pendingJob == null || pendingJob.getIntervalMillis() != alarmInterval) {\n+                ComponentName jobService = new ComponentName(context, BlockchainSyncJobService.class);\n+                JobInfo jobInfo = new JobInfo.Builder(BLOCKCHAIN_SYNC_JOB_ID, jobService)\n+                        .setPeriodic(alarmInterval)\n+                        .setPersisted(true)\n+                        .build();\n+                int scheduleResult = jobScheduler.schedule(jobInfo);\n+                log.info(\"scheduling blockchain sync job with interval of {}s, result: {}\", alarmInterval / 1000, scheduleResult);\n+            } else {\n+                log.info(\"blockchain sync job already scheduled with interval of {}s\", alarmInterval / 1000);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "91474fb2861fc7637f61e60ca1682c1c69da94c9"}, "originalPosition": 73}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYzNTA0NTUw", "url": "https://github.com/dashevo/dash-wallet/pull/470#pullrequestreview-463504550", "createdAt": "2020-08-07T18:03:58Z", "commit": {"oid": "91474fb2861fc7637f61e60ca1682c1c69da94c9"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "69c39b39ffb457655562090df16b10d209e14ca0", "author": {"user": {"login": "tomasz-ludek", "name": null}}, "url": "https://github.com/dashevo/dash-wallet/commit/69c39b39ffb457655562090df16b10d209e14ca0", "committedDate": "2020-08-10T10:45:58Z", "message": "Changed unit of logging periodic sync time from seconds to minutes in order to increase readability"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0NDU5Mzcw", "url": "https://github.com/dashevo/dash-wallet/pull/470#pullrequestreview-464459370", "createdAt": "2020-08-10T18:07:58Z", "commit": {"oid": "69c39b39ffb457655562090df16b10d209e14ca0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2786, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}