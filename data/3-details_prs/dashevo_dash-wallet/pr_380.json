{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA2NDM1OTY5", "number": 380, "title": "NMA-444: Connect UI to backend Part I: Check username existance", "bodyText": "This PR uses a ViewModel, LiveData, Background Task methodology to determine if a username exists on a Dash Evonet and displays a message on the Create Username screen.  The idea behind this PR is to suggest a methodology to use to continue connecting the backend.  Two other connects that need to be made are this:\n\nDetermine if Platform is available\nRegister a username (4 step process)\n\nTo build this (Travis CI will fail on this PR), one must git clone these repo's and gradlew assemble each one in this order:\n\n\nhttps://github.com/dashevo/android-dpp (dpp:0.11-SNAPSHOT)\n\n\nhttps://github.com/dashevo/dapi-client-android (dapiclient:0.11-SNAPSHOT)\n\n\nhttps://github.com/HashEngineering/android-dashpay (platform-core & dashpay:0.11-SNAPSHOT).  This repo will be moved soon to the dashevo account.\n\n\nKnown Issues:\n\nInAppMessaging is disabled due to a crash that occurs when the above 3 libraries are included.  Most likely there is a conflict with dapi-client.\nAs the user types a letter, the Platform will be queried.  But if another letter is typed while the last query is being executed, this should (but it may not be working well) cancel the last query and execute the new query.  There may be a better way to handle this.  Perhaps wait till the user stops typing and then make the query?\nThe first time the Platform is queries to check the existance of a username, it appears to be slower and the Register button can potentially still be pressed before the check for the username is started.\n\nQuestions:\n\nCan a single live data class be used to make different types of queries (get username documents, get platform network status, etc).  In the future other Platform methods may be required.\nCan the registration process be combined with the existing live data classes or should it be separated.\nCoroutines are not currently used but there might be useful if because it seems that they have less overhead than creating a thread.  But perhaps there aren't enough threads created to justify coroutines.\nIs there a better way that using a ViewModel, LiveData, Background thread for these Platform Queries.  The Username creation process will be done one time, but other Platform queries and operations may be used much more frequently.\nThe red checkmark should be a red x, possibly, when a username is found to exist.", "createdAt": "2020-04-21T04:50:45Z", "url": "https://github.com/dashevo/dash-wallet/pull/380", "merged": true, "mergeCommit": {"oid": "4f52d33f42121070e3906cb4f816a4bf8a2fb411"}, "closed": true, "closedAt": "2020-04-24T21:06:03Z", "author": {"login": "HashEngineering"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcZr_JmgH2gAyNDA2NDM1OTY5OjkzMGZhN2MyMjc4YTllNDZjODg2MDExYTQ5MmY5YTgxNmJkZmZmNGU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABca354lgH2gAyNDA2NDM1OTY5OmIwM2IwODQ2ODE4NmFkYzQzODdkMDNkNjNmOTUxNDljMzk0NGM4MzI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "930fa7c2278a9e46c886011a492f9a816bdfff4e", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/930fa7c2278a9e46c886011a492f9a816bdfff4e", "committedDate": "2020-04-21T04:29:05Z", "message": "Replace okhttp with okhttp3"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8e7aef75ab9918693883d454d35c5b6a42513eb2", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/8e7aef75ab9918693883d454d35c5b6a42513eb2", "committedDate": "2020-04-21T04:30:25Z", "message": "Add dpp, dapi-client, dashpay, platform-core libraries and disable inappmessaging"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b4c6bee555b266655e0f646ce3bb5c6428125510", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/b4c6bee555b266655e0f646ce3bb5c6428125510", "committedDate": "2020-04-21T04:32:42Z", "message": "Connect Platform to background task, live data, view model to getusername data"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "595bb432651d68badd5ddbbf575be627b8ab29fe", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/595bb432651d68badd5ddbbf575be627b8ab29fe", "committedDate": "2020-04-21T04:33:21Z", "message": "CreateUsernameActivity: Check for username existance"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "675faf0e747901a0e96bf95964ceac1328c4a3a7", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/675faf0e747901a0e96bf95964ceac1328c4a3a7", "committedDate": "2020-04-21T16:12:38Z", "message": "Use 0.11 dpp"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bf32a839a0ba33adb9fff9269afafe77ede02221", "author": {"user": {"login": "tomasz-ludek", "name": null}}, "url": "https://github.com/dashevo/dash-wallet/commit/bf32a839a0ba33adb9fff9269afafe77ede02221", "committedDate": "2020-04-23T03:33:20Z", "message": "Use Coroutines based Platform communication model (#382)\n\n* Delay the call of getUsernameViewModel.getUsername(username) until user stop typing\r\n\r\n* Updated the incorrect dpp version\r\n\r\n* Updated some dependencies in order to be able use androidx.lifecycle:lifecycle-livedata-ktx\r\n\r\n* Replaced GetUsernameViewModel with less generic DashPayViewModel which can be used to handle multiple Platform-related LiveDates\r\nMoved the code related to retrieving the data from Platform into PlatformRepo (repository pattern)\r\nFinally replaced Handler based async processing of Platform requests with kotlin coroutines\r\n\r\n* Cancel the previous getUsername call if new one arrived"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "acccbcd93dbafbfeb447bd8497609217f61349f7", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/acccbcd93dbafbfeb447bd8497609217f61349f7", "committedDate": "2020-04-23T03:33:53Z", "message": "Merge branch 'evonet-username-exists' of http://github.com/dashevo/dash-wallet into evonet-username-exists"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cef488bfb597a37ad1fa711cc4afc83f14c22685", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/cef488bfb597a37ad1fa711cc4afc83f14c22685", "committedDate": "2020-04-23T04:20:56Z", "message": "Add methods to check for platform availability"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c686b648b5f714fc6dfcc079c68b563e6d468bae", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/c686b648b5f714fc6dfcc079c68b563e6d468bae", "committedDate": "2020-04-23T04:27:10Z", "message": "Call showHideJoinDashPayAction() + add comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "addd5e1ce23219bb7b63dff65325f2e8eab0d2ce", "author": {"user": {"login": "tomasz-ludek", "name": null}}, "url": "https://github.com/dashevo/dash-wallet/commit/addd5e1ce23219bb7b63dff65325f2e8eab0d2ce", "committedDate": "2020-04-24T06:14:23Z", "message": "Simplified isPlatformAvailableLiveData, upgraded deprecated code and removed temporary debugging change"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5NjcwMTkw", "url": "https://github.com/dashevo/dash-wallet/pull/380#pullrequestreview-399670190", "createdAt": "2020-04-24T06:25:18Z", "commit": {"oid": "addd5e1ce23219bb7b63dff65325f2e8eab0d2ce"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQwNjoyNToxOVrOGLIbHA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQwNjozMDo1MFrOGLIkpQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDMyNTUzMg==", "bodyText": "This old way of retrieving ViewModels is deprecated in 'androidx.core:core:1.2.0', I applied the recommended one.", "url": "https://github.com/dashevo/dash-wallet/pull/380#discussion_r414325532", "createdAt": "2020-04-24T06:25:19Z", "author": {"login": "tomasz-ludek"}, "path": "wallet/src/de/schildbach/wallet/ui/WalletActivity.java", "diffHunk": "@@ -320,7 +321,7 @@ private void initViewModel() {\n         // the Join DashPay (evolution) button on the shortcuts bar.\n         // If that is the only function that the platform required for, then we can\n         // conditionally execute this code when a username hasn't been registered.\n-        dashPayViewModel = ViewModelProviders.of(this).get(DashPayViewModel.class);\n+        dashPayViewModel = new ViewModelProvider(this).get(DashPayViewModel.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "addd5e1ce23219bb7b63dff65325f2e8eab0d2ce"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDMyNTk1MA==", "bodyText": "Last time I forgot to revert this temporary debugging change.", "url": "https://github.com/dashevo/dash-wallet/pull/380#discussion_r414325950", "createdAt": "2020-04-24T06:26:14Z", "author": {"login": "tomasz-ludek"}, "path": "wallet/src/de/schildbach/wallet/ui/WalletActivity.java", "diffHunk": "@@ -345,7 +345,7 @@ private void showHideJoinDashPayAction() {\n             boolean canAffordIt = walletBalance.isGreaterThan(Constants.DASH_PAY_FEE)\n                     || walletBalance.equals(Constants.DASH_PAY_FEE);\n             boolean visible = canAffordIt && config.getShowJoinDashPay();\n-            joinDashPayAction.setVisibility(View.VISIBLE);//visible ? View.VISIBLE : View.GONE);\n+            joinDashPayAction.setVisibility(visible ? View.VISIBLE : View.GONE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "addd5e1ce23219bb7b63dff65325f2e8eab0d2ce"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDMyNzk3Mw==", "bodyText": "This field and all related code is only needed if you want to be able to reload the value of related LiveData multiple times and each time cancel previous request is it wasn't yet finished. I'll try to explain it in more details on Slack.", "url": "https://github.com/dashevo/dash-wallet/pull/380#discussion_r414327973", "createdAt": "2020-04-24T06:30:50Z", "author": {"login": "tomasz-ludek"}, "path": "wallet/src/de/schildbach/wallet/ui/dashpay/DashPayViewModel.kt", "diffHunk": "@@ -29,13 +29,10 @@ class DashPayViewModel(application: Application) : AndroidViewModel(application)\n \n     private val platformRepo = PlatformRepo(application as WalletApplication)\n \n-\n     private val usernameLiveData = MutableLiveData<String>()\n-    private val platformStatusLiveData = MutableLiveData<Boolean>()\n \n     // Job instance (https://stackoverflow.com/questions/57723714/how-to-cancel-a-running-livedata-coroutine-block/57726583#57726583)\n     private var getUsernameJob = Job()\n-    private var isPlatformAvailableJob = Job()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "addd5e1ce23219bb7b63dff65325f2e8eab0d2ce"}, "originalPosition": 10}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwMDMxNzUy", "url": "https://github.com/dashevo/dash-wallet/pull/380#pullrequestreview-400031752", "createdAt": "2020-04-24T15:07:19Z", "commit": {"oid": "addd5e1ce23219bb7b63dff65325f2e8eab0d2ce"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAwMDM5MDAz", "url": "https://github.com/dashevo/dash-wallet/pull/380#pullrequestreview-400039003", "createdAt": "2020-04-24T15:15:50Z", "commit": {"oid": "addd5e1ce23219bb7b63dff65325f2e8eab0d2ce"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxNToxNTo1MFrOGLckbg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yNFQxNToxNTo1MFrOGLckbg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDY1NTU5OA==", "bodyText": "I am curious about this change.  How do we trigger this call?", "url": "https://github.com/dashevo/dash-wallet/pull/380#discussion_r414655598", "createdAt": "2020-04-24T15:15:50Z", "author": {"login": "HashEngineering"}, "path": "wallet/src/de/schildbach/wallet/ui/WalletActivity.java", "diffHunk": "@@ -330,7 +331,6 @@ public void onChanged(Resource<Boolean> status) {\n                 showHideJoinDashPayAction();\n             }\n         });\n-        dashPayViewModel.isPlatformAvailable();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "addd5e1ce23219bb7b63dff65325f2e8eab0d2ce"}, "originalPosition": 21}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0c8f3c610ea3867c73e4b32f9ce973b21ce8a4cf", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/0c8f3c610ea3867c73e4b32f9ce973b21ce8a4cf", "committedDate": "2020-04-24T20:14:31Z", "message": "Update username exists error text"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5a5c81ab29d8c36dc6a4ae6d533cb1fb3a5db14f", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/5a5c81ab29d8c36dc6a4ae6d533cb1fb3a5db14f", "committedDate": "2020-04-24T20:54:24Z", "message": "Merge branch 'evonet-develop' of http://github.com/dashevo/dash-wallet into evonet-username-exists"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b03b08468186adc4387d03d63f95149c3944c832", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/b03b08468186adc4387d03d63f95149c3944c832", "committedDate": "2020-04-24T20:56:07Z", "message": "this file got left out of the merge"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2893, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}