{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU3NDY0MjI1", "number": 464, "title": "DashPay: Send payment | Contact UI", "bodyText": "Issue being fixed or feature implemented\n\n\n\nNMA-372\nAdd ability to send payments to a contact.\nKnown Issues:\n\nFor the DashPayUserActivity, the notifications currently use a duplicate TransactionViewHolder class (in Kotlin).  This can be refactored in a different story along with other view holders to separate files and possibly also replace the Java version\nWhen starting the flow from the Select a Contact Screen, the flow ends at that screen after closing the DashPayUserActivity at the end of the process, instead of the Payments Screen.  I am not sure how to return to the previous screen from there.\nWhen paying a contact, the same address may be used.  This is not ideal, a new address should be used.  This would be fixed in the dashpay library.  This has been addressed in dashj.\n\nRelated PR's and Dependencies\n\ndashevo/android-dashpay#18\ndashevo/dashj#82\nScreenshots / Videos\n\n\n\n\nHow Has This Been Tested?\n\n\n\n\n QA (Mobile Team)\n\nChecklist:\n\n\n I have performed a self-review of my own code and added comments where necessary\n I have added or updated relevant unit/integration/functional/e2e tests", "createdAt": "2020-07-28T00:04:46Z", "url": "https://github.com/dashevo/dash-wallet/pull/464", "merged": true, "mergeCommit": {"oid": "437e12cc8b3fe9afab6421d20614460123d3513e"}, "closed": true, "closedAt": "2020-08-04T16:34:12Z", "author": {"login": "HashEngineering"}, "timelineItems": {"totalCount": 69, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcyaBPdgH2gAyNDU3NDY0MjI1OmQwYjFmNzFjYThlNTkxZmYyNmRjN2M5ZTgxNzM2YWU2OTY0ZWNkNmU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc7oMFcgH2gAyNDU3NDY0MjI1OmE0ODRjZWQ3ODVkZmIzZTFjNmJlNGQ4ZjgyNjY0MmZiODJkZjgxNWE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d0b1f71ca8e591ff26dc7c9e81736ae6964ecd6e", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/d0b1f71ca8e591ff26dc7c9e81736ae6964ecd6e", "committedDate": "2020-07-06T23:41:11Z", "message": "Use dashpay, platform-core, dpp, dapi-client 0.13-SNAPSHOT"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9bace73fb7c512f22381feea225ae13f6c7c1322", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/9bace73fb7c512f22381feea225ae13f6c7c1322", "committedDate": "2020-07-06T23:41:40Z", "message": "Update to DPP 0.13"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd6f471ae7d7ed4eceba223928f340d45ecee45e", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/bd6f471ae7d7ed4eceba223928f340d45ecee45e", "committedDate": "2020-07-08T23:25:46Z", "message": "Change primary key contents of Contact Request table"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9bd08261726792cb1b89b2d1f1700d058f0a55e3", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/9bd08261726792cb1b89b2d1f1700d058f0a55e3", "committedDate": "2020-07-09T15:53:36Z", "message": "PlatformRepo: Recover Profile if the DashPay contract exists"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8256b844b320df198441bd2c0be9f00ec721b135", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/8256b844b320df198441bd2c0be9f00ec721b135", "committedDate": "2020-07-09T15:54:10Z", "message": "PlatformRepo: Use records.dashIdentity instead of ownerId"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d124f0e39c818c65e0cf53f243faa0da5041d609", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/d124f0e39c818c65e0cf53f243faa0da5041d609", "committedDate": "2020-07-10T19:23:43Z", "message": "BlockchainService: Set the DapiClient's masternode list"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7e24158770cc48441532eb3917d2905141d3e2ee", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/7e24158770cc48441532eb3917d2905141d3e2ee", "committedDate": "2020-07-10T19:23:44Z", "message": "Fix BlockchainIdentity construction (use same platform object as the app)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e73b2b36b333a6f1cdad0d4f0a30582a3ec4c040", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/e73b2b36b333a6f1cdad0d4f0a30582a3ec4c040", "committedDate": "2020-07-10T19:23:44Z", "message": "PlatformRepo: If there are on contactRequests, skip searching profiles and names"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "23bef1b651814f0ec36542a8a94c4752c44f15f1", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/23bef1b651814f0ec36542a8a94c4752c44f15f1", "committedDate": "2020-07-10T19:23:45Z", "message": "PlatformRepo: change isPlatformAvailable"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1e3530ca70c1733e3d78bd8304fad0ddd884b035", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/1e3530ca70c1733e3d78bd8304fad0ddd884b035", "committedDate": "2020-07-13T22:33:40Z", "message": "Refactor some liveData from DashPayViewModel to new classes\n\n* New classes NotificationsLiveData, NotificationCountLiveData\n* Listeners react to updating the contact database and then update data\n* The notifications screen is live"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b7b756b5d79bbf438bb0d3c6ba2b1945137eb8f0", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/b7b756b5d79bbf438bb0d3c6ba2b1945137eb8f0", "committedDate": "2020-07-14T14:24:15Z", "message": "Fix sort order for notifications"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "78d7597ec649ecf1537ed2ab2bef315ad18ca721", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/78d7597ec649ecf1537ed2ab2bef315ad18ca721", "committedDate": "2020-07-14T14:25:07Z", "message": "Use the fromContactRequest date"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7145eb69351b0aa885ca4edeeef36b4b34a5c3cb", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/7145eb69351b0aa885ca4edeeef36b4b34a5c3cb", "committedDate": "2020-07-14T21:07:10Z", "message": "PlatformRepo: Make Singleton, replace contact update timer\n\n* Remove timer code from BlockchainServiceImpl"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "59f7c7a25c2c36d0166ad844acc0199f3392ad97", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/59f7c7a25c2c36d0166ad844acc0199f3392ad97", "committedDate": "2020-07-16T01:00:15Z", "message": "Update home screen data when resumed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a388068208679dbb34e6f9e582029a7ecc0a5665", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/a388068208679dbb34e6f9e582029a7ecc0a5665", "committedDate": "2020-07-16T01:01:05Z", "message": "ContactsActivity: Update when the database is changed, trigger DB update on resume"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c87ef6a0d7e2355a7553a56b19f633618e127f5b", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/c87ef6a0d7e2355a7553a56b19f633618e127f5b", "committedDate": "2020-07-16T01:01:42Z", "message": "PlatformRepo: Fix bug that prevented updating contacts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3e397fcbf0fc68fed5245d8d996967a1ce39d3ee", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/3e397fcbf0fc68fed5245d8d996967a1ce39d3ee", "committedDate": "2020-07-17T15:57:15Z", "message": "Merge branch 'evonet-develop' of https://github.com/dashevo/dash-wallet into dpp-0.13"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "576b010f1e8eace54fa6d3d00af02550ca04e45b", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/576b010f1e8eace54fa6d3d00af02550ca04e45b", "committedDate": "2020-07-17T18:03:30Z", "message": "Merge branch 'dashpay-notifications-fix' of https://github.com/dashevo/dash-wallet into dpp-0.13"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ace4e589f721cf70d10478ed0a0150208648a49f", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/ace4e589f721cf70d10478ed0a0150208648a49f", "committedDate": "2020-07-20T14:55:46Z", "message": "Use dpp 0.14-SNAPSHOT related libraries"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "41ffaae8a4430b5f13c1613e644c38206a9e679a", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/41ffaae8a4430b5f13c1613e644c38206a9e679a", "committedDate": "2020-07-21T23:18:15Z", "message": "Add Sending To on Enter Amount and Confirm Screens"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec0fb3001391fc266a2944727b382694cf8e86a3", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/ec0fb3001391fc266a2944727b382694cf8e86a3", "committedDate": "2020-07-22T21:54:20Z", "message": "PlatformRepo: Add contact keychains to wallet when updating contacts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ead06e4aba5de7d6a1158e66ca8c7e179db1ce07", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/ead06e4aba5de7d6a1158e66ca8c7e179db1ce07", "committedDate": "2020-07-22T22:41:33Z", "message": "Add NotificationItem to handle many types of notifications"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b22c5c51e0ccffc79897e78b6e59d66d30300dea", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/b22c5c51e0ccffc79897e78b6e59d66d30300dea", "committedDate": "2020-07-23T21:37:28Z", "message": "Merge branch 'evonet-develop' of http://github.com/dashevo/dash-wallet into dpp-0.13\n\n# Conflicts:\n#\twallet/src/de/schildbach/wallet/ui/HeaderBalanceFragment.java\n#\twallet/src/de/schildbach/wallet/ui/dashpay/CreateIdentityService.kt\n#\twallet/src/de/schildbach/wallet/ui/dashpay/DashPayViewModel.kt\n#\twallet/src/de/schildbach/wallet/ui/dashpay/NotificationsActivity.kt\n#\twallet/src/de/schildbach/wallet/ui/dashpay/PlatformRepo.kt"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "81ec13ba312d9f7939e69fac0951613483710e78", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/81ec13ba312d9f7939e69fac0951613483710e78", "committedDate": "2020-07-24T20:41:54Z", "message": "Add Preliminary History to Profile Page if contact was accepted"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a4a12002e92a4dfd1b5d5b90db5277d2dbf7c81d", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/a4a12002e92a4dfd1b5d5b90db5277d2dbf7c81d", "committedDate": "2020-07-24T20:44:25Z", "message": "Add Preliminary History to Profile Page if contact was accepted (Part 2)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5a10e4e676e1cbb9f52fe91ef07e7c437614b966", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/5a10e4e676e1cbb9f52fe91ef07e7c437614b966", "committedDate": "2020-07-24T20:46:07Z", "message": "Add username support to Transaction Details screens\n\nFix other bugs with EnterAmountFragment and ConfirmTransactionDialog"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "49701a77282fbeb8d1917e542b0da7f9e59c311e", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/49701a77282fbeb8d1917e542b0da7f9e59c311e", "committedDate": "2020-07-25T16:23:18Z", "message": "DashPayUserActivity: only show history if its a full contact"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4d74c50ba3f189e3e4b4ae17c837c36513b3e64b", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/4d74c50ba3f189e3e4b4ae17c837c36513b3e64b", "committedDate": "2020-07-27T14:18:29Z", "message": "BlockchainService: Add reset bloom filters action\n\nSubmit new bloom filters when contact is added"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f553e09a0b3984da9ec9cdf63a2750ed917054ed", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/f553e09a0b3984da9ec9cdf63a2750ed917054ed", "committedDate": "2020-07-27T14:36:45Z", "message": "DashPayUserActivity: Update screen after Send/Accept (was broken earlier)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a01e617b82783c673595e243715069e80a0eda2f", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/a01e617b82783c673595e243715069e80a0eda2f", "committedDate": "2020-07-27T20:12:20Z", "message": "Merge branch 'dpp-0.13' of https://github.com/dashevo/dash-wallet into dashpay-send-payment\n\n# Conflicts:\n#\twallet/src/de/schildbach/wallet/ui/dashpay/DashPayViewModel.kt\n#\twallet/src/de/schildbach/wallet/ui/dashpay/PlatformRepo.kt"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "937a2fab1ce379cb83c41bae069d0e42c825f6e9", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/937a2fab1ce379cb83c41bae069d0e42c825f6e9", "committedDate": "2020-07-27T22:14:17Z", "message": "Use correct flow Send -> Select a Contact -> Contacts Screen\n-> contact -> Enter Amount\n-> Confirm -> Authenticate -> Results -> Profile/History"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "424a7a0919ac9c1eb4298534c53f0a4131297612", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/424a7a0919ac9c1eb4298534c53f0a4131297612", "committedDate": "2020-07-27T23:44:53Z", "message": "Minor changes, restore \"My Contacts Header\" in Select a Contact Screen"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2MjE2NjIw", "url": "https://github.com/dashevo/dash-wallet/pull/464#pullrequestreview-456216620", "createdAt": "2020-07-28T00:08:39Z", "commit": {"oid": "424a7a0919ac9c1eb4298534c53f0a4131297612"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQwMDowODozOVrOG3342A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQwMDowODozOVrOG3342A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTI0MDUzNg==", "bodyText": "This was copy/pasted from the TransactionAdapter.java class.  Ideally this should be refactored into a separate file that can be used on the Home Screen and any Notifications screen.", "url": "https://github.com/dashevo/dash-wallet/pull/464#discussion_r461240536", "createdAt": "2020-07-28T00:08:39Z", "author": {"login": "HashEngineering"}, "path": "wallet/src/de/schildbach/wallet/ui/dashpay/NotificationsAdapter.kt", "diffHunk": "@@ -268,4 +307,135 @@ class NotificationsAdapter(val onContactRequestButtonClickListener: OnContactReq\n         fun onAcceptRequest(usernameSearchResult: UsernameSearchResult, position: Int)\n         fun onIgnoreRequest(usernameSearchResult: UsernameSearchResult, position: Int)\n     }\n+\n+    private val transactionCache: HashMap<Sha256Hash, TransactionCacheEntry> = HashMap()\n+\n+    private class TransactionCacheEntry constructor(val value: Coin, val sent: Boolean, val self: Boolean, val showFee: Boolean, val address: Address?,\n+                                                            val addressLabel: String?, val type: Transaction.Type)\n+\n+    inner class TransactionViewHolder (inflater: LayoutInflater, parent: ViewGroup) : ViewHolder(R.layout.notification_transaction_row, inflater, parent) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "424a7a0919ac9c1eb4298534c53f0a4131297612"}, "originalPosition": 142}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2MjE2OTQ3", "url": "https://github.com/dashevo/dash-wallet/pull/464#pullrequestreview-456216947", "createdAt": "2020-07-28T00:09:32Z", "commit": {"oid": "424a7a0919ac9c1eb4298534c53f0a4131297612"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQwMDowOTozMlrOG336GQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQwMDowOTozMlrOG336GQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTI0MDg1Nw==", "bodyText": "should call the BlockchainIdentity method instead of wallet.", "url": "https://github.com/dashevo/dash-wallet/pull/464#discussion_r461240857", "createdAt": "2020-07-28T00:09:32Z", "author": {"login": "HashEngineering"}, "path": "wallet/src/de/schildbach/wallet/ui/dashpay/NotificationsForUserLiveData.kt", "diffHunk": "@@ -0,0 +1,45 @@\n+package de.schildbach.wallet.ui.dashpay\n+\n+import de.schildbach.wallet.WalletApplication\n+import de.schildbach.wallet.data.NotificationItem\n+import de.schildbach.wallet.data.UsernameSortOrderBy\n+import de.schildbach.wallet.livedata.Resource\n+import kotlinx.coroutines.GlobalScope\n+import kotlinx.coroutines.launch\n+import org.bitcoinj.evolution.EvolutionContact\n+\n+class NotificationsForUserLiveData(walletApplication: WalletApplication, platformRepo: PlatformRepo) : NotificationsLiveData(walletApplication, platformRepo) {\n+\n+    override fun searchNotifications(userId: String) {\n+        this.query = userId\n+        GlobalScope.launch {\n+            val results = arrayListOf<NotificationItem>()\n+            val contactRequests = platformRepo.searchContacts(\"\", UsernameSortOrderBy.DATE_ADDED)\n+\n+            //TODO: gather other notification types\n+            // * invitations\n+            // * payments\n+            // * other\n+\n+            if(contactRequests.data != null) {\n+                contactRequests.data.filter {\n+                    cr -> cr.dashPayProfile.userId == userId\n+                }.forEach {\n+                    results.add(NotificationItem(it))\n+                }\n+            }\n+\n+            val blockchainIdentity = platformRepo.getBlockchainIdentity()!!\n+\n+            val contact = EvolutionContact(blockchainIdentity.uniqueIdString, userId)\n+\n+            val txs = walletApplication.wallet.getTransactionsWithFriend(contact)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "424a7a0919ac9c1eb4298534c53f0a4131297612"}, "originalPosition": 36}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2NzA4NDU1", "url": "https://github.com/dashevo/dash-wallet/pull/464#pullrequestreview-456708455", "createdAt": "2020-07-28T14:44:20Z", "commit": {"oid": "424a7a0919ac9c1eb4298534c53f0a4131297612"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxNDo0NDoyMFrOG4QLrQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxNDo0NDoyMFrOG4QLrQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTYzODU3Mw==", "bodyText": "We no longer need InstantSend indicators for PaymentIntent. This was necessary when it was possible to specify InstantSend as a requirement for a transaction which required an extra fee.", "url": "https://github.com/dashevo/dash-wallet/pull/464#discussion_r461638573", "createdAt": "2020-07-28T14:44:20Z", "author": {"login": "HashEngineering"}, "path": "wallet/src/de/schildbach/wallet/data/PaymentIntent.java", "diffHunk": "@@ -163,18 +164,16 @@ private Output(final Parcel in) {\n     @Nullable\n     public final byte[] paymentRequestHash;\n \n-    public boolean useInstantX = false;\n-", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "424a7a0919ac9c1eb4298534c53f0a4131297612"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2NzE3NTUx", "url": "https://github.com/dashevo/dash-wallet/pull/464#pullrequestreview-456717551", "createdAt": "2020-07-28T14:52:59Z", "commit": {"oid": "424a7a0919ac9c1eb4298534c53f0a4131297612"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxNDo1Mjo1OVrOG4QnUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxNDo1Mjo1OVrOG4QnUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTY0NTY1MA==", "bodyText": "These are read in the constructor", "url": "https://github.com/dashevo/dash-wallet/pull/464#discussion_r461645650", "createdAt": "2020-07-28T14:52:59Z", "author": {"login": "HashEngineering"}, "path": "wallet/src/de/schildbach/wallet/ui/DashPayUserActivity.kt", "diffHunk": "@@ -126,37 +175,121 @@ class DashPayUserActivity : InteractionAwareActivity() {\n     }\n \n     private fun updateContactRelationUi() {\n-        val contactRequestSent = intent.getBooleanExtra(CONTACT_REQUEST_SENT, false)\n-        val contactRequestReceived = intent.getBooleanExtra(CONTACT_REQUEST_RECEIVED, false)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "424a7a0919ac9c1eb4298534c53f0a4131297612"}, "originalPosition": 149}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4df9c7d11f9a8eac6ba488e8800ed3ff068790c9", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/4df9c7d11f9a8eac6ba488e8800ed3ff068790c9", "committedDate": "2020-07-28T15:11:19Z", "message": "Other minor changes and code cleanup from self review"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e177219ce5e80e9e02aa4c868d50874936a61192", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/e177219ce5e80e9e02aa4c868d50874936a61192", "committedDate": "2020-07-29T23:00:01Z", "message": "Merge branch 'evonet-develop' of https://github.com/dashevo/dash-wallet into dashpay-send-payment\n\n# Conflicts:\n#\twallet/src/de/schildbach/wallet/ui/dashpay/PlatformRepo.kt"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3OTU4OTQw", "url": "https://github.com/dashevo/dash-wallet/pull/464#pullrequestreview-457958940", "createdAt": "2020-07-29T23:09:50Z", "commit": {"oid": "e177219ce5e80e9e02aa4c868d50874936a61192"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQyMzowOTo1MFrOG5NXVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQyMzowOTo1MFrOG5NXVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjY0MDk4Mg==", "bodyText": "There were bugs in the wallet that upon loading when the app started, the app would require a blockchain reset.  This is still a possibility, given the amount of changes that were required to support payments from and to contacts.", "url": "https://github.com/dashevo/dash-wallet/pull/464#discussion_r462640982", "createdAt": "2020-07-29T23:09:50Z", "author": {"login": "HashEngineering"}, "path": "wallet/src/de/schildbach/wallet/ui/dashpay/PlatformRepo.kt", "diffHunk": "@@ -630,9 +659,16 @@ class PlatformRepo private constructor(val walletApplication: WalletApplication)\n \n         val blockchainIdentityData = blockchainIdentityDataDaoAsync.load() ?: return\n         val userId = blockchainIdentityData!!.getIdentity(walletApplication.wallet) ?: return\n+        if (blockchainIdentityData.username == null) {\n+            return // this is here because the wallet is being reset without removing blockchainIdentityData\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e177219ce5e80e9e02aa4c868d50874936a61192"}, "originalPosition": 140}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d3f39ce39a783632dd1f73da9c83cf11886f148d", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/d3f39ce39a783632dd1f73da9c83cf11886f148d", "committedDate": "2020-07-29T23:26:30Z", "message": "Remove commented code"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3OTcwMzk3", "url": "https://github.com/dashevo/dash-wallet/pull/464#pullrequestreview-457970397", "createdAt": "2020-07-29T23:42:09Z", "commit": {"oid": "e177219ce5e80e9e02aa4c868d50874936a61192"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQyMzo0MjoxMFrOG5N-qw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQyMzo0MjoxMFrOG5N-qw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjY1MTA1MQ==", "bodyText": "Should we use an observer instead?  perhaps a LiveData that returns a BlockchainIdentity object?", "url": "https://github.com/dashevo/dash-wallet/pull/464#discussion_r462651051", "createdAt": "2020-07-29T23:42:10Z", "author": {"login": "HashEngineering"}, "path": "wallet/src/de/schildbach/wallet/ui/TransactionResultActivity.kt", "diffHunk": "@@ -75,7 +86,9 @@ class TransactionResultActivity : AbstractWalletActivity() {\n         val txId = intent.getSerializableExtra(EXTRA_TX_ID) as Sha256Hash\n         setContentView(R.layout.activity_successful_transaction)\n \n-        val transactionResultViewBinder = TransactionResultViewBinder(container)\n+        val blockchainIdentity: BlockchainIdentity? = runBlocking { PlatformRepo.getInstance().getBlockchainIdentity() }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e177219ce5e80e9e02aa4c868d50874936a61192"}, "originalPosition": 57}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3OTcwNTk4", "url": "https://github.com/dashevo/dash-wallet/pull/464#pullrequestreview-457970598", "createdAt": "2020-07-29T23:42:45Z", "commit": {"oid": "e177219ce5e80e9e02aa4c868d50874936a61192"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQyMzo0Mjo0NVrOG5N_TA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQyMzo0Mjo0NVrOG5N_TA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjY1MTIxMg==", "bodyText": "Should we use an observer instead?", "url": "https://github.com/dashevo/dash-wallet/pull/464#discussion_r462651212", "createdAt": "2020-07-29T23:42:45Z", "author": {"login": "HashEngineering"}, "path": "wallet/src/de/schildbach/wallet/ui/TransactionResultViewBinder.kt", "diffHunk": "@@ -187,6 +198,38 @@ class TransactionResultViewBinder(private val containerView: View) {\n             }\n         }\n \n+        // handle dashpay\n+        var profile: DashPayProfile? = null\n+        if (blockchainIdentity != null) {\n+            val userId = blockchainIdentity.getContactForTransaction(tx)\n+            if (userId != null) {\n+                profile = runBlocking { AppDatabase.getAppDatabase().dashPayProfileDaoAsync().load(userId) }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e177219ce5e80e9e02aa4c868d50874936a61192"}, "originalPosition": 48}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3OTcxMTQ3", "url": "https://github.com/dashevo/dash-wallet/pull/464#pullrequestreview-457971147", "createdAt": "2020-07-29T23:44:27Z", "commit": {"oid": "e177219ce5e80e9e02aa4c868d50874936a61192"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQyMzo0NDoyN1rOG5OBbQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQyMzo0NDoyN1rOG5OBbQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjY1MTc1Nw==", "bodyText": "It seems strange to have a runBlocking inside a view Model.  Should we use a liveData instead to get the next address for a particular user?", "url": "https://github.com/dashevo/dash-wallet/pull/464#discussion_r462651757", "createdAt": "2020-07-29T23:44:27Z", "author": {"login": "HashEngineering"}, "path": "wallet/src/de/schildbach/wallet/ui/dashpay/DashPayViewModel.kt", "diffHunk": "@@ -132,6 +140,14 @@ class DashPayViewModel(application: Application) : AndroidViewModel(application)\n         }\n     }\n \n+    fun getNextContactAddress(userId: String): Address {\n+        var address: Address? = null\n+        runBlocking {\n+            address = platformRepo.getNextContactAddress(userId)\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e177219ce5e80e9e02aa4c868d50874936a61192"}, "originalPosition": 41}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU3OTcxODEx", "url": "https://github.com/dashevo/dash-wallet/pull/464#pullrequestreview-457971811", "createdAt": "2020-07-29T23:46:29Z", "commit": {"oid": "e177219ce5e80e9e02aa4c868d50874936a61192"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQyMzo0NjoyOVrOG5OD7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQyMzo0NjoyOVrOG5OD7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjY1MjM5Ng==", "bodyText": "getLocalUsernameSearchResult actually makes three queries to the database.  A MediatorLiveData, i think, could be used instead.", "url": "https://github.com/dashevo/dash-wallet/pull/464#discussion_r462652396", "createdAt": "2020-07-29T23:46:29Z", "author": {"login": "HashEngineering"}, "path": "wallet/src/de/schildbach/wallet/ui/DashPayUserActivity.kt", "diffHunk": "@@ -63,13 +77,24 @@ class DashPayUserActivity : InteractionAwareActivity() {\n             intent.putExtra(CONTACT_REQUEST_RECEIVED, contactRequestReceived)\n             return intent\n         }\n+\n+        @JvmStatic\n+        fun createIntent(context: Context, userId: String): Intent {\n+            val usernameSearchResult = runBlocking { PlatformRepo.getInstance().getLocalUsernameSearchResult(userId) }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e177219ce5e80e9e02aa4c868d50874936a61192"}, "originalPosition": 56}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7d98682b3005f1d775d1af3f3b236fb852a7e0aa", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/7d98682b3005f1d775d1af3f3b236fb852a7e0aa", "committedDate": "2020-07-30T17:53:29Z", "message": "Don't update contacts if there is no dashpay contract or the username is not completely registered"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1934d999130edd41141cc1605d15f27a1c659fff", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/1934d999130edd41141cc1605d15f27a1c659fff", "committedDate": "2020-07-31T13:21:56Z", "message": "Replace runBlocking in two places"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "defb02c61b238aa310295195f5e95862f11d62ef", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/defb02c61b238aa310295195f5e95862f11d62ef", "committedDate": "2020-07-31T15:21:07Z", "message": "Use loadDistinct when getting profile information"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b0b07c93949bed299fb9c999483fed9adc3a5f39", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/b0b07c93949bed299fb9c999483fed9adc3a5f39", "committedDate": "2020-07-31T15:22:40Z", "message": "Move RoomDatabaseExtensions to data"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7a9c9ca5626f97d3e811c858e0e4d1abcfe1d1c1", "author": {"user": {"login": "tomasz-ludek", "name": null}}, "url": "https://github.com/dashevo/dash-wallet/commit/7a9c9ca5626f97d3e811c858e0e4d1abcfe1d1c1", "committedDate": "2020-07-31T15:27:27Z", "message": "Basic implementation of blockchainIdentity caching"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6777dedbf938edda08d9603149cf19d85f9f5e70", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/6777dedbf938edda08d9603149cf19d85f9f5e70", "committedDate": "2020-07-31T15:31:19Z", "message": "Merge branch 'dashpay-send-payment' of http://github.com/dashevo/dash-wallet into dashpay-send-payment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c9a0238a667d974b1dfd30f580c20806b34f0f13", "author": {"user": {"login": "tomasz-ludek", "name": null}}, "url": "https://github.com/dashevo/dash-wallet/commit/c9a0238a667d974b1dfd30f580c20806b34f0f13", "committedDate": "2020-07-31T15:36:18Z", "message": "Removed obsolete code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "41fa6bb794af0023d5020c6c54bb2f304ce99e0c", "author": {"user": {"login": "tomasz-ludek", "name": null}}, "url": "https://github.com/dashevo/dash-wallet/commit/41fa6bb794af0023d5020c6c54bb2f304ce99e0c", "committedDate": "2020-07-31T15:39:55Z", "message": "Fixed crash when initializing PlatformRepo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c64440f9879947d41e581438a28c5e76d10e4f4c", "author": {"user": {"login": "tomasz-ludek", "name": null}}, "url": "https://github.com/dashevo/dash-wallet/commit/c64440f9879947d41e581438a28c5e76d10e4f4c", "committedDate": "2020-07-31T15:44:35Z", "message": "Fixed crash when initializing PlatformRepo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c925ab0b32857e47bb4d2bdc21b48b493470bd2e", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/c925ab0b32857e47bb4d2bdc21b48b493470bd2e", "committedDate": "2020-07-31T15:48:20Z", "message": "Merge branch 'dashpay-send-payment' of http://github.com/dashevo/dash-wallet into dashpay-send-payment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "be80467ffbbdded00fe0e63a248cd1fbac40312d", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/be80467ffbbdded00fe0e63a248cd1fbac40312d", "committedDate": "2020-07-31T16:29:25Z", "message": "Move the start timer back to WalletApplication.initPlatform\n\nOtherwise there was a crash becuase of a missing Looper.prepare() or the\ntimer didn't work."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0db2cea47c7dd767022f71aff50b9bf4ac253838", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/0db2cea47c7dd767022f71aff50b9bf4ac253838", "committedDate": "2020-07-31T16:30:42Z", "message": "Remove unused code (blockchainIdentity)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4d1c575f00d242f6ca878e62aa4e3f713e428c0e", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/4d1c575f00d242f6ca878e62aa4e3f713e428c0e", "committedDate": "2020-07-31T16:32:29Z", "message": "Remove other runBlocking {}"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwMDUwMjc5", "url": "https://github.com/dashevo/dash-wallet/pull/464#pullrequestreview-460050279", "createdAt": "2020-08-03T14:00:09Z", "commit": {"oid": "4d1c575f00d242f6ca878e62aa4e3f713e428c0e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "33411f56a4cbdaeec53b0d2af92ff0264b36dc67", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/33411f56a4cbdaeec53b0d2af92ff0264b36dc67", "committedDate": "2020-08-03T19:18:03Z", "message": "Merge branch 'evonet-develop' of http://github.com/dashevo/dash-wallet into dashpay-send-payment\n\n# Conflicts:\n#\twallet/src/de/schildbach/wallet/ui/dashpay/ContactsFragment.kt"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "34579ad0b8c3667bc6a0fe3fb010039d9d3a921d", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/34579ad0b8c3667bc6a0fe3fb010039d9d3a921d", "committedDate": "2020-08-03T19:19:40Z", "message": "DashPayUserActivity: Remove unused createIntent with runBlocking"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9266de2eb5ebbdeea1e2a51a8a2e15e99cd4c11a", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/9266de2eb5ebbdeea1e2a51a8a2e15e99cd4c11a", "committedDate": "2020-08-03T19:58:01Z", "message": "PlatformRepo: Use backgroundHandler to avoid crashes with Handler"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2e3d14ee5c8b890750694f8fb0ed65bb25e43c90", "author": {"user": {"login": "tomasz-ludek", "name": null}}, "url": "https://github.com/dashevo/dash-wallet/commit/2e3d14ee5c8b890750694f8fb0ed65bb25e43c90", "committedDate": "2020-08-04T12:03:14Z", "message": "Moved PlatformRepo initialization into main thread.\nReverted deletion of timerHandler which was replaced by backgroundHandler"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "172460c5a66c9482f6c46bc2a7e6db96975667fe", "author": {"user": {"login": "tomasz-ludek", "name": null}}, "url": "https://github.com/dashevo/dash-wallet/commit/172460c5a66c9482f6c46bc2a7e6db96975667fe", "committedDate": "2020-08-04T12:49:18Z", "message": "Changed the way of performing periodic contacts sync by replacing Handler with direct coroutine approach"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwNzg2NTM2", "url": "https://github.com/dashevo/dash-wallet/pull/464#pullrequestreview-460786536", "createdAt": "2020-08-04T12:58:20Z", "commit": {"oid": "2e3d14ee5c8b890750694f8fb0ed65bb25e43c90"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQxMjo1ODoyMVrOG7fNKQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQxMjo1ODoyMVrOG7fNKQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTAzMDQ0MQ==", "bodyText": "This was moved out of the background thread therefore we should retest all the wallet initialization scenarios.\n2e3d14e#diff-05204d8915f357bdf7c4bfcbed61d7c3R79", "url": "https://github.com/dashevo/dash-wallet/pull/464#discussion_r465030441", "createdAt": "2020-08-04T12:58:21Z", "author": {"login": "tomasz-ludek"}, "path": "wallet/src/de/schildbach/wallet/livedata/EncryptWalletLiveData.kt", "diffHunk": "@@ -95,10 +95,6 @@ class EncryptWalletLiveData(application: Application) : MutableLiveData<Resource\n                 // initialize the authentication key chains to allow recovery of the username\n                 wallet.initializeAuthenticationKeyChains(decryptedSeed, newKey);\n \n-                if(initialize) {\n-                    walletApplication.saveWalletAndFinalizeInitialization()\n-                }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2e3d14ee5c8b890750694f8fb0ed65bb25e43c90"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwNzkwMzc1", "url": "https://github.com/dashevo/dash-wallet/pull/464#pullrequestreview-460790375", "createdAt": "2020-08-04T13:03:04Z", "commit": {"oid": "172460c5a66c9482f6c46bc2a7e6db96975667fe"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQxMzowMzowNFrOG7fYag==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQxMzowMzowNFrOG7fYag==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTAzMzMyMg==", "bodyText": "This will load the blockchainIdentity and start periodic contacts sync without the need of using Handler.\nGlobalScope is active as long as the app is launched.\nPeriodic contacts sync will not start if there is no blockchainIdentity yet.", "url": "https://github.com/dashevo/dash-wallet/pull/464#discussion_r465033322", "createdAt": "2020-08-04T13:03:04Z", "author": {"login": "tomasz-ludek"}, "path": "wallet/src/de/schildbach/wallet/ui/dashpay/PlatformRepo.kt", "diffHunk": "@@ -94,11 +94,36 @@ class PlatformRepo private constructor(val walletApplication: WalletApplication)\n     private val dashPayProfileDaoAsync = AppDatabase.getAppDatabase().dashPayProfileDaoAsync()\n     private val dashPayContactRequestDaoAsync = AppDatabase.getAppDatabase().dashPayContactRequestDaoAsync()\n \n+    private val securityGuard = SecurityGuard()\n     private lateinit var blockchainIdentity: BlockchainIdentity\n+\n     private val backgroundThread = HandlerThread(\"background\", Process.THREAD_PRIORITY_BACKGROUND)\n-    private val backgroundHandler by lazy {\n+    private val backgroundHandler: Handler\n+\n+    init {\n         backgroundThread.start()\n-        Handler(backgroundThread.looper)\n+        backgroundHandler = Handler(backgroundThread.looper)\n+    }\n+\n+    fun init() {\n+        GlobalScope.launch {\n+            blockchainIdentityDataDaoAsync.load()?.let {\n+                blockchainIdentity = initBlockchainIdentity(it, walletApplication.wallet)\n+                while (isActive) {\n+                    log.info(\"Timer: Update contacts\")\n+                    platformRepoInstance.updateContactRequests()\n+                    delay(UPDATE_TIMER_DELAY)\n+                }\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "172460c5a66c9482f6c46bc2a7e6db96975667fe"}, "originalPosition": 89}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwNzkxMTA1", "url": "https://github.com/dashevo/dash-wallet/pull/464#pullrequestreview-460791105", "createdAt": "2020-08-04T13:03:59Z", "commit": {"oid": "172460c5a66c9482f6c46bc2a7e6db96975667fe"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQxMzowMzo1OVrOG7fafg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQxMzowMzo1OVrOG7fafg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTAzMzg1NA==", "bodyText": "This will also start the periodic contacts sync", "url": "https://github.com/dashevo/dash-wallet/pull/464#discussion_r465033854", "createdAt": "2020-08-04T13:03:59Z", "author": {"login": "tomasz-ludek"}, "path": "wallet/src/de/schildbach/wallet/ui/dashpay/CreateIdentityService.kt", "diffHunk": "@@ -317,6 +317,8 @@ class CreateIdentityService : LifecycleService() {\n             platformRepo.updateCreationState(blockchainIdentityData, CreationState.DONE)\n         }\n \n+        PlatformRepo.getInstance().init()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "172460c5a66c9482f6c46bc2a7e6db96975667fe"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9fa994714107f49b0a3c2598ecdef32d4530517a", "author": {"user": {"login": "tomasz-ludek", "name": null}}, "url": "https://github.com/dashevo/dash-wallet/commit/9fa994714107f49b0a3c2598ecdef32d4530517a", "committedDate": "2020-08-04T14:46:49Z", "message": "Moved PlatformRepo initialization in WalletApplication to loadWalletFromProtobuf() method so that it is triggered for a regular app launches. During the wallet restoration it will be triggered after restoring the identity."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ea39e16318dab3c1a5b3a4b53688f40b5c042375", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/ea39e16318dab3c1a5b3a4b53688f40b5c042375", "committedDate": "2020-08-04T15:01:01Z", "message": "Revert \"Moved PlatformRepo initialization in WalletApplication to loadWalletFromProtobuf() method so that it is triggered for a regular app launches. During the wallet restoration it will be triggered after restoring the identity.\"\n\nThis reverts commit 9fa99471"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a484ced785dfb3e1c6be4d8f826642fb82df815a", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/a484ced785dfb3e1c6be4d8f826642fb82df815a", "committedDate": "2020-08-04T15:17:01Z", "message": "CreateIdentityService: initialize the PlatformRepo after the restore process is complete."}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2783, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}