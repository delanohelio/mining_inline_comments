{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMzMzEyMTI4", "number": 570, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxMToyMTowOFrOFFiTHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxMToyNToxOFrOFFiZiQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxMzQ5MTUwOnYy", "diffSide": "RIGHT", "path": "wallet/src/de/schildbach/wallet/data/DashPayContactRequestDao.kt", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxMToyMTowOFrOIGF9Bw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxMToyMTowOFrOIGF9Bw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzI1OTkxMQ==", "bodyText": "Nice!", "url": "https://github.com/dashevo/dash-wallet/pull/570#discussion_r543259911", "createdAt": "2020-12-15T11:21:08Z", "author": {"login": "tomasz-ludek"}, "path": "wallet/src/de/schildbach/wallet/data/DashPayContactRequestDao.kt", "diffHunk": "@@ -19,6 +19,9 @@ interface DashPayContactRequestDao {\n     @Query(\"SELECT * FROM dashpay_contact_request WHERE toUserId = :toUserId\")\n     suspend fun loadFromOthers(toUserId: String): List<DashPayContactRequest>?\n \n+    @Query(\"SELECT EXISTS (SELECT * FROM dashpay_contact_request WHERE userId = :userId AND toUserId = :toUserId)\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "546fb06a853f005ee0980dc3a5819dd2a077663b"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQxMzUwNzkzOnYy", "diffSide": "RIGHT", "path": "wallet/src/de/schildbach/wallet/ui/dashpay/PlatformRepo.kt", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxMToyNToxOFrOIGGGjQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNVQxNzo0NDoyMFrOIGX3mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzI2MjM0OQ==", "bodyText": "I would prefer to use TimeUnit.MINUTES.toMillis(10) instead of DateUtils.MINUTE_IN_MILLIS * 10 but it isn't a part of this story so we can let well alone ;)", "url": "https://github.com/dashevo/dash-wallet/pull/570#discussion_r543262349", "createdAt": "2020-12-15T11:25:18Z", "author": {"login": "tomasz-ludek"}, "path": "wallet/src/de/schildbach/wallet/ui/dashpay/PlatformRepo.kt", "diffHunk": "@@ -810,8 +810,15 @@ class PlatformRepo private constructor(val walletApplication: WalletApplication)\n             Context.propagate(walletApplication.wallet.context)\n             var encryptionKey: KeyParameter? = null\n \n-            var lastContactRequestTime = if (dashPayContactRequestDao.countAllRequests() > 0)\n-                dashPayContactRequestDao.getLastTimestamp() - DateUtils.MINUTE_IN_MILLIS * 12\n+            var lastContactRequestTime = if (dashPayContactRequestDao.countAllRequests() > 0) {\n+                val lastTimeStamp = dashPayContactRequestDao.getLastTimestamp()\n+                // if the last contact request was received in the past 10 minutes, then query for\n+                // contact requests that are 10 minutes before it.  If the last contact request was\n+                // more than 10 minutes ago, then query all contact requests that came after it.\n+                if (lastTimeStamp < System.currentTimeMillis() - DateUtils.MINUTE_IN_MILLIS * 10)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "546fb06a853f005ee0980dc3a5819dd2a077663b"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzU1MzQzNQ==", "bodyText": "Looks like our app is using both of these methods depending on the author.", "url": "https://github.com/dashevo/dash-wallet/pull/570#discussion_r543553435", "createdAt": "2020-12-15T17:44:20Z", "author": {"login": "HashEngineering"}, "path": "wallet/src/de/schildbach/wallet/ui/dashpay/PlatformRepo.kt", "diffHunk": "@@ -810,8 +810,15 @@ class PlatformRepo private constructor(val walletApplication: WalletApplication)\n             Context.propagate(walletApplication.wallet.context)\n             var encryptionKey: KeyParameter? = null\n \n-            var lastContactRequestTime = if (dashPayContactRequestDao.countAllRequests() > 0)\n-                dashPayContactRequestDao.getLastTimestamp() - DateUtils.MINUTE_IN_MILLIS * 12\n+            var lastContactRequestTime = if (dashPayContactRequestDao.countAllRequests() > 0) {\n+                val lastTimeStamp = dashPayContactRequestDao.getLastTimestamp()\n+                // if the last contact request was received in the past 10 minutes, then query for\n+                // contact requests that are 10 minutes before it.  If the last contact request was\n+                // more than 10 minutes ago, then query all contact requests that came after it.\n+                if (lastTimeStamp < System.currentTimeMillis() - DateUtils.MINUTE_IN_MILLIS * 10)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzI2MjM0OQ=="}, "originalCommit": {"oid": "546fb06a853f005ee0980dc3a5819dd2a077663b"}, "originalPosition": 11}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 550, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}