{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ4NTM5NDg5", "number": 460, "title": "DashPay: Notifications fix -  NMA-551", "bodyText": "Issue being fixed or feature implemented\n\n\nThe notification count on the home screen was not being updated all the time.\nThis was due to a race condition or reading the contact requests from the database before the database was completely updated from Platform.  In such a case the notification retrieval failed and no information about new notifications was displayed.\nThere are still some known issues with updating notifications:\n\nAfter creating a user, the update contact timer does not appear to be activated.\nAfter the blockchain service shuts down, the update contact timer is stopped.\n\nThis must be merged after #456 and its related PR's.\ndashevo/android-dashpay#16\nWhat was done?\n\nNotification related LiveData uses a listener to update notifications and the notification count after the contacts requests are updated from platform.\nThese changes also made it possible to easily update the Notification Screen when new contact requests are detected.\nChecklist:\n\n\n I have performed a self-review of my own code", "createdAt": "2020-07-13T22:45:23Z", "url": "https://github.com/dashevo/dash-wallet/pull/460", "merged": true, "mergeCommit": {"oid": "091ad8a2ed69efdfe7a7aa94892f04f79a327fde"}, "closed": true, "closedAt": "2020-07-23T19:10:00Z", "author": {"login": "HashEngineering"}, "timelineItems": {"totalCount": 23, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABczou9hgH2gAyNDQ4NTM5NDg5OmQxMjRmMGUzOWM4MThjNjVlMGNmNTNmMjQzZmFhMGRhNTA0MWQ2MDk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc3z5C3gFqTQ1NDM5OTI1Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d124f0e39c818c65e0cf53f243faa0da5041d609", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/d124f0e39c818c65e0cf53f243faa0da5041d609", "committedDate": "2020-07-10T19:23:43Z", "message": "BlockchainService: Set the DapiClient's masternode list"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7e24158770cc48441532eb3917d2905141d3e2ee", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/7e24158770cc48441532eb3917d2905141d3e2ee", "committedDate": "2020-07-10T19:23:44Z", "message": "Fix BlockchainIdentity construction (use same platform object as the app)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e73b2b36b333a6f1cdad0d4f0a30582a3ec4c040", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/e73b2b36b333a6f1cdad0d4f0a30582a3ec4c040", "committedDate": "2020-07-10T19:23:44Z", "message": "PlatformRepo: If there are on contactRequests, skip searching profiles and names"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "23bef1b651814f0ec36542a8a94c4752c44f15f1", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/23bef1b651814f0ec36542a8a94c4752c44f15f1", "committedDate": "2020-07-10T19:23:45Z", "message": "PlatformRepo: change isPlatformAvailable"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1e3530ca70c1733e3d78bd8304fad0ddd884b035", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/1e3530ca70c1733e3d78bd8304fad0ddd884b035", "committedDate": "2020-07-13T22:33:40Z", "message": "Refactor some liveData from DashPayViewModel to new classes\n\n* New classes NotificationsLiveData, NotificationCountLiveData\n* Listeners react to updating the contact database and then update data\n* The notifications screen is live"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ3NjYzNzE1", "url": "https://github.com/dashevo/dash-wallet/pull/460#pullrequestreview-447663715", "createdAt": "2020-07-13T22:49:13Z", "commit": {"oid": "1e3530ca70c1733e3d78bd8304fad0ddd884b035"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QyMjo0OToxM1rOGw9aHQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QyMjo0OToxM1rOGw9aHQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzk5MDk0MQ==", "bodyText": "i am not sure if the GlobalScope.launch is the best way to run a suspend method.", "url": "https://github.com/dashevo/dash-wallet/pull/460#discussion_r453990941", "createdAt": "2020-07-13T22:49:13Z", "author": {"login": "HashEngineering"}, "path": "wallet/src/de/schildbach/wallet/ui/dashpay/NotificationsLiveData.kt", "diffHunk": "@@ -0,0 +1,55 @@\n+package de.schildbach.wallet.ui.dashpay\n+\n+import androidx.lifecycle.LiveData\n+import de.schildbach.wallet.WalletApplication\n+import de.schildbach.wallet.data.UsernameSearchResult\n+import de.schildbach.wallet.data.UsernameSortOrderBy\n+import de.schildbach.wallet.livedata.Resource\n+import kotlinx.coroutines.GlobalScope\n+import kotlinx.coroutines.launch\n+\n+class NotificationsLiveData(val walletApplication: WalletApplication, private val platformRepo: PlatformRepo) : LiveData<Resource<List<UsernameSearchResult>>>(), OnContactsUpdated {\n+    private var listening = false\n+    private var query = \"\"\n+\n+    override fun onActive() {\n+        maybeAddEventListener()\n+        searchNotifications(query)\n+    }\n+\n+    override fun onInactive() {\n+        maybeRemoveEventListener()\n+    }\n+\n+    private fun maybeAddEventListener() {\n+        if (!listening && hasActiveObservers()) {\n+            PlatformRepo.addContactsUpdatedListener(this)\n+            listening = true\n+        }\n+    }\n+\n+    private fun maybeRemoveEventListener() {\n+        if (listening) {\n+            PlatformRepo.removeContactsUpdatedListener(this)\n+            listening = false\n+        }\n+    }\n+\n+    override fun onContactsUpdated() {\n+        searchNotifications(query)\n+    }\n+\n+    fun searchNotifications(text: String = \"\") {\n+        query = text\n+        GlobalScope.launch {\n+            val contactRequests = platformRepo.searchContacts(query, UsernameSortOrderBy.LAST_ACTIVITY)\n+\n+            //TODO: gather other notification types\n+            // * invitations\n+            // * payments\n+            // * other\n+\n+            postValue(contactRequests)\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1e3530ca70c1733e3d78bd8304fad0ddd884b035"}, "originalPosition": 53}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ3NjY0MzUw", "url": "https://github.com/dashevo/dash-wallet/pull/460#pullrequestreview-447664350", "createdAt": "2020-07-13T22:50:53Z", "commit": {"oid": "1e3530ca70c1733e3d78bd8304fad0ddd884b035"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QyMjo1MDo1M1rOGw9caQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QyMjo1MDo1M1rOGw9caQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzk5MTUyOQ==", "bodyText": "This section of code was made \"static\" because there could be more than one instance of PlatformRepo running in the app.  DashPayViewModel has one instance.  The BlockchainServiceImpl creates a new instance every time the timer triggers an update of the DashPay state (currently only updates the contact requests and profiles)", "url": "https://github.com/dashevo/dash-wallet/pull/460#discussion_r453991529", "createdAt": "2020-07-13T22:50:53Z", "author": {"login": "HashEngineering"}, "path": "wallet/src/de/schildbach/wallet/ui/dashpay/PlatformRepo.kt", "diffHunk": "@@ -62,6 +68,24 @@ class PlatformRepo(val walletApplication: WalletApplication) {\n \n     companion object {\n         private val log = LoggerFactory.getLogger(PlatformRepo::class.java)\n+\n+        private val onContactsUpdatedListeners = arrayListOf<OnContactsUpdated>()\n+        private val updatingContacts = AtomicBoolean(false)\n+\n+        fun addContactsUpdatedListener(listener: OnContactsUpdated) {\n+            onContactsUpdatedListeners.add(listener)\n+        }\n+\n+        fun removeContactsUpdatedListener(listener: OnContactsUpdated?) {\n+            onContactsUpdatedListeners.remove(listener)\n+        }\n+\n+        fun queueContactsUpdatedListeners(updateBackgroundHandler: Handler) {\n+            updateBackgroundHandler.post {\n+                for (listener in onContactsUpdatedListeners)\n+                    listener.onContactsUpdated()\n+            }\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1e3530ca70c1733e3d78bd8304fad0ddd884b035"}, "originalPosition": 43}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ3NjY1MTM4", "url": "https://github.com/dashevo/dash-wallet/pull/460#pullrequestreview-447665138", "createdAt": "2020-07-13T22:52:53Z", "commit": {"oid": "1e3530ca70c1733e3d78bd8304fad0ddd884b035"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QyMjo1Mjo1M1rOGw9e_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xM1QyMjo1Mjo1M1rOGw9e_g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzk5MjE5MA==", "bodyText": "I would like to replace dependence on BlockchainServiceImpl for the timer that triggers DashPay related updates from Platform.  When the blockchain service is shutdown, the timer is also stopped and no further updates occur.  What is the best place to start a timer in the app that can be shut down when the app is closed?  This timer would only be active if the user has a username.", "url": "https://github.com/dashevo/dash-wallet/pull/460#discussion_r453992190", "createdAt": "2020-07-13T22:52:53Z", "author": {"login": "HashEngineering"}, "path": "wallet/src/de/schildbach/wallet/service/BlockchainServiceImpl.java", "diffHunk": "@@ -1072,20 +1072,18 @@ public void run() {\n         });\n     }\n \n-    boolean updatingDashPayState = false;\n     private void updateDashPayState() {\n-        if (blockchainIdentityData != null && !updatingDashPayState) {\n+        if (blockchainIdentityData != null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1e3530ca70c1733e3d78bd8304fad0ddd884b035"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b7b756b5d79bbf438bb0d3c6ba2b1945137eb8f0", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/b7b756b5d79bbf438bb0d3c6ba2b1945137eb8f0", "committedDate": "2020-07-14T14:24:15Z", "message": "Fix sort order for notifications"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "78d7597ec649ecf1537ed2ab2bef315ad18ca721", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/78d7597ec649ecf1537ed2ab2bef315ad18ca721", "committedDate": "2020-07-14T14:25:07Z", "message": "Use the fromContactRequest date"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ4MzAwMjYz", "url": "https://github.com/dashevo/dash-wallet/pull/460#pullrequestreview-448300263", "createdAt": "2020-07-14T17:07:21Z", "commit": {"oid": "78d7597ec649ecf1537ed2ab2bef315ad18ca721"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7145eb69351b0aa885ca4edeeef36b4b34a5c3cb", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/7145eb69351b0aa885ca4edeeef36b4b34a5c3cb", "committedDate": "2020-07-14T21:07:10Z", "message": "PlatformRepo: Make Singleton, replace contact update timer\n\n* Remove timer code from BlockchainServiceImpl"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "59f7c7a25c2c36d0166ad844acc0199f3392ad97", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/59f7c7a25c2c36d0166ad844acc0199f3392ad97", "committedDate": "2020-07-16T01:00:15Z", "message": "Update home screen data when resumed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a388068208679dbb34e6f9e582029a7ecc0a5665", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/a388068208679dbb34e6f9e582029a7ecc0a5665", "committedDate": "2020-07-16T01:01:05Z", "message": "ContactsActivity: Update when the database is changed, trigger DB update on resume"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c87ef6a0d7e2355a7553a56b19f633618e127f5b", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/c87ef6a0d7e2355a7553a56b19f633618e127f5b", "committedDate": "2020-07-16T01:01:42Z", "message": "PlatformRepo: Fix bug that prevented updating contacts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8fe0129f8d24c0adc22e23d8b2fc09860ecb1c42", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/8fe0129f8d24c0adc22e23d8b2fc09860ecb1c42", "committedDate": "2020-07-17T21:44:20Z", "message": "Remove check for 44 characters for an identity before sending a CR"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dd05d974d77c287a5d0c5de97108a155e216bbc6", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/dd05d974d77c287a5d0c5de97108a155e216bbc6", "committedDate": "2020-07-23T14:34:00Z", "message": "Merge branch 'evonet-develop' of http://github.com/dashevo/dash-wallet into dashpay-notifications-fix\n\n# Conflicts:\n#\twallet/src/de/schildbach/wallet/service/BlockchainServiceImpl.java\n#\twallet/src/de/schildbach/wallet/ui/dashpay/CreateIdentityService.kt\n#\twallet/src/de/schildbach/wallet/ui/dashpay/NotificationsActivity.kt\n#\twallet/src/de/schildbach/wallet/ui/dashpay/PlatformRepo.kt"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b0beb0381b64a215cdb910b1e75146f32a8045a2", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/b0beb0381b64a215cdb910b1e75146f32a8045a2", "committedDate": "2020-07-23T14:37:43Z", "message": "Merge branch 'dashpay-notifications-fix' of http://github.com/dashevo/dash-wallet into dashpay-notifications-fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU0MjY4NTg2", "url": "https://github.com/dashevo/dash-wallet/pull/460#pullrequestreview-454268586", "createdAt": "2020-07-23T15:47:16Z", "commit": {"oid": "8fe0129f8d24c0adc22e23d8b2fc09860ecb1c42"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QxNTo0NzoxNlrOG2QsPg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QxNTo0NzoxNlrOG2QsPg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTU0OTc1OA==", "bodyText": "It looks like this and the comment below can be removed.", "url": "https://github.com/dashevo/dash-wallet/pull/460#discussion_r459549758", "createdAt": "2020-07-23T15:47:16Z", "author": {"login": "sambarboza"}, "path": "wallet/src/de/schildbach/wallet/ui/dashpay/PlatformRepo.kt", "diffHunk": "@@ -638,9 +666,58 @@ class PlatformRepo(val walletApplication: WalletApplication) {\n                     dashPayProfileDaoAsync.insert(profile!!)\n                 }\n             }\n+            queueContactsUpdatedListeners()\n             log.info(\"updating contacts and profiles took $watch\")\n         } catch (e: Exception) {\n-            log.error(\"error updating contacts ${e.message}\")\n+            log.error(formatExceptionMessage(\"error updating contacts\", e))\n+        } finally {\n+            updatingContacts.set(false)\n+        }\n+    }\n+\n+    // Create the Handler object (on the main thread by default)\n+    val timerHandler = Handler()\n+    var timerStarted = false\n+\n+    // Define the code block to be executed\n+    private val executeUpdateContacts = object : Runnable {\n+        override fun run() {\n+            // Do something here on the main thread", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8fe0129f8d24c0adc22e23d8b2fc09860ecb1c42"}, "originalPosition": 134}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU0MjcxNDk4", "url": "https://github.com/dashevo/dash-wallet/pull/460#pullrequestreview-454271498", "createdAt": "2020-07-23T15:50:38Z", "commit": {"oid": "8fe0129f8d24c0adc22e23d8b2fc09860ecb1c42"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QxNTo1MDozOFrOG2Q1Jg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QxNTo1MDozOFrOG2Q1Jg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTU1MjAzOA==", "bodyText": "Are we going to use the date parameter in the future? If so, can we add a comment? Otherwise we should remove it.", "url": "https://github.com/dashevo/dash-wallet/pull/460#discussion_r459552038", "createdAt": "2020-07-23T15:50:38Z", "author": {"login": "sambarboza"}, "path": "wallet/src/de/schildbach/wallet/ui/dashpay/DashPayViewModel.kt", "diffHunk": "@@ -109,16 +112,12 @@ class DashPayViewModel(application: Application) : AndroidViewModel(application)\n         emit(platformRepo.isPlatformAvailable())\n     }\n \n-    fun getNotificationCount(date: Long) {\n-        notificationCountLiveData.value = date\n+    fun searchNotifications(text: String) {\n+        notificationsLiveData.searchNotifications(text)\n     }\n \n-    val getNotificationCountLiveData = Transformations.switchMap(notificationCountLiveData) { date: Long ->\n-        liveData(Dispatchers.IO) {\n-            val count = platformRepo.getNotificationCount(date)\n-            if (count >= 0)\n-                emit(count)\n-        }\n+    fun getNotificationCount(date: Long) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8fe0129f8d24c0adc22e23d8b2fc09860ecb1c42"}, "originalPosition": 34}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU0Mjg0ODkw", "url": "https://github.com/dashevo/dash-wallet/pull/460#pullrequestreview-454284890", "createdAt": "2020-07-23T16:06:00Z", "commit": {"oid": "8fe0129f8d24c0adc22e23d8b2fc09860ecb1c42"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QxNjowNjowMFrOG2RdWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QxNjowNjowMFrOG2RdWQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTU2MjMyOQ==", "bodyText": "It doesn't look like we're queuing calls on this method, so I would rename to fireContactsUpdatedListeners or something similar. Also, this function can be private.", "url": "https://github.com/dashevo/dash-wallet/pull/460#discussion_r459562329", "createdAt": "2020-07-23T16:06:00Z", "author": {"login": "sambarboza"}, "path": "wallet/src/de/schildbach/wallet/ui/dashpay/PlatformRepo.kt", "diffHunk": "@@ -638,9 +666,58 @@ class PlatformRepo(val walletApplication: WalletApplication) {\n                     dashPayProfileDaoAsync.insert(profile!!)\n                 }\n             }\n+            queueContactsUpdatedListeners()\n             log.info(\"updating contacts and profiles took $watch\")\n         } catch (e: Exception) {\n-            log.error(\"error updating contacts ${e.message}\")\n+            log.error(formatExceptionMessage(\"error updating contacts\", e))\n+        } finally {\n+            updatingContacts.set(false)\n+        }\n+    }\n+\n+    // Create the Handler object (on the main thread by default)\n+    val timerHandler = Handler()\n+    var timerStarted = false\n+\n+    // Define the code block to be executed\n+    private val executeUpdateContacts = object : Runnable {\n+        override fun run() {\n+            // Do something here on the main thread\n+            log.info(\"Timer: Update contacts\")\n+            // Repeat this the same runnable code block again another 2 seconds\n+            GlobalScope.launch {\n+                updateContactRequests()\n+            }\n+            timerHandler.postDelayed(this, UPDATE_TIMER_DELAY)\n+        }\n+    }\n+\n+    // Start the initial runnable task by posting through the handler\n+    fun startUpdateTimer() {\n+        log.info(\"Starting timer for updating DashPay\")\n+        if (!timerStarted) {\n+            timerHandler.post(executeUpdateContacts)\n+            timerStarted = true\n+        }\n+    }\n+\n+    fun stopUpdateTimer() {\n+        timerStarted = false\n+        timerHandler.removeCallbacks(executeUpdateContacts)\n+    }\n+\n+    fun addContactsUpdatedListener(listener: OnContactsUpdated) {\n+        onContactsUpdatedListeners.add(listener)\n+    }\n+\n+    fun removeContactsUpdatedListener(listener: OnContactsUpdated?) {\n+        onContactsUpdatedListeners.remove(listener)\n+    }\n+\n+    fun queueContactsUpdatedListeners() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8fe0129f8d24c0adc22e23d8b2fc09860ecb1c42"}, "originalPosition": 166}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "929801ebf4d37deb29e65188d61588f5ddc7c7f1", "author": {"user": {"login": "HashEngineering", "name": "Hash Engineering Solutions"}}, "url": "https://github.com/dashevo/dash-wallet/commit/929801ebf4d37deb29e65188d61588f5ddc7c7f1", "committedDate": "2020-07-23T16:36:22Z", "message": "Review fixes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU0Mzk5MjU2", "url": "https://github.com/dashevo/dash-wallet/pull/460#pullrequestreview-454399256", "createdAt": "2020-07-23T18:39:23Z", "commit": {"oid": "929801ebf4d37deb29e65188d61588f5ddc7c7f1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2773, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}