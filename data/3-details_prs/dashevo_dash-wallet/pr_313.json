{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY3NTY0MzY1", "number": 313, "title": "New security model based on Android Keystore", "bodyText": "Introduced a new security model based on Android Keystore.\nSeparates the PIN from wallet file encryption password, which is now a complex random string generated by the app when creating the wallet.\nMore details can be found in the NMA-324 story description.\nIncludes required by NMA-324 Show No Lock Screen if Auto Logout = OFF.", "createdAt": "2020-01-27T15:48:35Z", "url": "https://github.com/dashevo/dash-wallet/pull/313", "merged": true, "mergeCommit": {"oid": "1326fa3229df765fbf3d932d6c9b0e7f27ce1c6a"}, "closed": true, "closedAt": "2020-02-05T16:07:00Z", "author": {"login": "tomasz-ludek"}, "timelineItems": {"totalCount": 17, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb9M04kAH2gAyMzY3NTY0MzY1OjQ2MGM5YTAxYTQ1MzM4ZGZiNTAwNjEwNmYxZTRkZGM4ZjZhZmFmM2U=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcBYID8AFqTM1MzgyMjQyMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "460c9a01a45338dfb5006106f1e4ddc8f6afaf3e", "author": {"user": {"login": "tomasz-ludek", "name": null}}, "url": "https://github.com/dashevo/dash-wallet/commit/460c9a01a45338dfb5006106f1e4ddc8f6afaf3e", "committedDate": "2020-01-23T16:20:56Z", "message": "Base classes for new security model.\nInstead of using a short 4-digit pin to encrypt the wallet we will use\na complex random string that will be encrypted by AndroidKeystore and\nsaved in SharedPreferences.\nThe same method will be used to save the pin, which we will be using\nonly form UI-level authentication."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "953fc719e8aa77626425440b721f33845d472938", "author": {"user": {"login": "tomasz-ludek", "name": null}}, "url": "https://github.com/dashevo/dash-wallet/commit/953fc719e8aa77626425440b721f33845d472938", "committedDate": "2020-01-23T17:06:32Z", "message": "Minor code refactoring"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4287cb1551fb4d4907bf8925e1c4e1d13f0950af", "author": {"user": {"login": "tomasz-ludek", "name": null}}, "url": "https://github.com/dashevo/dash-wallet/commit/4287cb1551fb4d4907bf8925e1c4e1d13f0950af", "committedDate": "2020-01-24T06:17:47Z", "message": "Applied the new security model to basic operations (encrypt wallet, check pin, change pin)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d68bc31cf64738dbe39ee8d59053565c9cee17f9", "author": {"user": {"login": "tomasz-ludek", "name": null}}, "url": "https://github.com/dashevo/dash-wallet/commit/d68bc31cf64738dbe39ee8d59053565c9cee17f9", "committedDate": "2020-01-24T06:38:10Z", "message": "Merge branch 'redesign' into redisign-keystore-introduction"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8c8c3fdb00312f523a27cd2bd6a147a9b57ff842", "author": {"user": {"login": "tomasz-ludek", "name": null}}, "url": "https://github.com/dashevo/dash-wallet/commit/8c8c3fdb00312f523a27cd2bd6a147a9b57ff842", "committedDate": "2020-01-24T09:38:02Z", "message": "Displaying the seed with new security model"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b151ba2bdf197bd6ed63799bb14db4cfb1b703a4", "author": {"user": {"login": "tomasz-ludek", "name": null}}, "url": "https://github.com/dashevo/dash-wallet/commit/b151ba2bdf197bd6ed63799bb14db4cfb1b703a4", "committedDate": "2020-01-24T10:43:55Z", "message": "Handling the app update from the version using old security model\n(works also when updating from master version but only if it was secured with 4-digits pin)."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5cb298f6b58773bb5d4d05d9c11439195d8aae95", "author": {"user": {"login": "tomasz-ludek", "name": null}}, "url": "https://github.com/dashevo/dash-wallet/commit/5cb298f6b58773bb5d4d05d9c11439195d8aae95", "committedDate": "2020-01-27T09:38:05Z", "message": "Removing security keys when wiping the wallet"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce0657244a4eeac380744899e15d8ff8bc1f4bbb", "author": {"user": {"login": "tomasz-ludek", "name": null}}, "url": "https://github.com/dashevo/dash-wallet/commit/ce0657244a4eeac380744899e15d8ff8bc1f4bbb", "committedDate": "2020-01-27T15:40:34Z", "message": "Sending transactions with the new security model.\nShow No Lock Screen if Auto Logout = OFF.\nFixed send payment flows for with and without the authentication."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ4ODg4NTIy", "url": "https://github.com/dashevo/dash-wallet/pull/313#pullrequestreview-348888522", "createdAt": "2020-01-27T18:42:34Z", "commit": {"oid": "ce0657244a4eeac380744899e15d8ff8bc1f4bbb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7b16df3471d4c686d1c80549d3481677555599f7", "author": {"user": {"login": "tomasz-ludek", "name": null}}, "url": "https://github.com/dashevo/dash-wallet/commit/7b16df3471d4c686d1c80549d3481677555599f7", "committedDate": "2020-01-29T19:34:25Z", "message": "Fixed the crash when displaying QR code scanner from LockScreen on Android 10\nCrash description: \"cameraThread Only the original thread that created a view hierarchy can touch its views\""}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c377e9bd921ab84eca04afc79b241f46acc0ca25", "author": {"user": {"login": "tomasz-ludek", "name": null}}, "url": "https://github.com/dashevo/dash-wallet/commit/c377e9bd921ab84eca04afc79b241f46acc0ca25", "committedDate": "2020-01-30T10:11:26Z", "message": "Fixed the crash when verifying OLD pin after restoring wallet from file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "81fa5c862398def2edb001f0225c955b6f5ae373", "author": {"user": {"login": "tomasz-ludek", "name": null}}, "url": "https://github.com/dashevo/dash-wallet/commit/81fa5c862398def2edb001f0225c955b6f5ae373", "committedDate": "2020-01-31T07:49:57Z", "message": "Merge branch 'android-10-camera-crash' into redisign-keystore-introduction\n\n# Conflicts:\n#\twallet/res/values/strings-extra.xml"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzNDYyMzg5", "url": "https://github.com/dashevo/dash-wallet/pull/313#pullrequestreview-353462389", "createdAt": "2020-02-05T04:39:34Z", "commit": {"oid": "81fa5c862398def2edb001f0225c955b6f5ae373"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQwNDozOTozNFrOFlrmeQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQwNDozOTozNFrOFlrmeQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTA1NTk5Mw==", "bodyText": "Do we need this empty block?", "url": "https://github.com/dashevo/dash-wallet/pull/313#discussion_r375055993", "createdAt": "2020-02-05T04:39:34Z", "author": {"login": "sambarboza"}, "path": "wallet/src/de/schildbach/wallet/ui/VerifySeedActivity.kt", "diffHunk": "@@ -32,30 +35,59 @@ class VerifySeedActivity : AppCompatActivity(), VerifySeedActions {\n     companion object {\n \n         private const val EXTRA_SEED = \"extra_seed\"\n+        private const val EXTRA_PIN = \"extra_pin\"\n \n         @JvmStatic\n         fun createIntent(context: Context, seed: Array<String>): Intent {\n             val intent = Intent(context, VerifySeedActivity::class.java)\n             intent.putExtra(EXTRA_SEED, seed)\n             return intent\n         }\n+\n+        @JvmStatic\n+        fun createIntent(context: Context, pin: String): Intent {\n+            val intent = Intent(context, VerifySeedActivity::class.java)\n+            intent.putExtra(EXTRA_PIN, pin)\n+            return intent\n+        }\n     }\n \n+    private lateinit var decryptSeedViewModel: DecryptSeedViewModel\n+\n     private var seed: Array<String> = arrayOf()\n \n     override fun onCreate(savedInstanceState: Bundle?) {\n         super.onCreate(savedInstanceState)\n         setContentView(R.layout.activity_verify_seed)\n \n-        seed = if (intent.extras?.containsKey(EXTRA_SEED)!!) {\n-            intent.extras!!.getStringArray(EXTRA_SEED)!!\n+        if (intent.extras!!.containsKey(EXTRA_SEED)) {\n+            seed = intent.extras!!.getStringArray(EXTRA_SEED)!!\n         } else {\n-            throw IllegalStateException(\"This activity needs to receive a String[] Intent Extra \" +\n-                    \"containing the recovery seed.\")\n+            initViewModel()\n+            val pin = intent.extras!!.getString(EXTRA_PIN)!!\n+            decryptSeedViewModel.checkPin(pin)\n         }\n \n         supportFragmentManager.beginTransaction().add(R.id.container,\n-                    VerifySeedSecureNowFragment.newInstance()).commit()\n+                VerifySeedSecureNowFragment.newInstance()).commit()\n+    }\n+\n+    private fun initViewModel() {\n+        decryptSeedViewModel = ViewModelProviders.of(this).get(DecryptSeedViewModel::class.java)\n+        decryptSeedViewModel.decryptSeedLiveData.observe(this, Observer {\n+            when (it.status) {\n+                Status.ERROR -> {\n+                    finish()\n+                }\n+                Status.LOADING -> {\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "81fa5c862398def2edb001f0225c955b6f5ae373"}, "originalPosition": 65}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzNDY2NTI2", "url": "https://github.com/dashevo/dash-wallet/pull/313#pullrequestreview-353466526", "createdAt": "2020-02-05T04:58:55Z", "commit": {"oid": "81fa5c862398def2edb001f0225c955b6f5ae373"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQwNDo1ODo1NVrOFlr0Rg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQwNDo1ODo1NVrOFlr0Rg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTA1OTUyNg==", "bodyText": "I would advise creating an interface so we don't tie this fragment to the SendCoinsActivity as this can cause some problems eventually.", "url": "https://github.com/dashevo/dash-wallet/pull/313#discussion_r375059526", "createdAt": "2020-02-05T04:58:55Z", "author": {"login": "sambarboza"}, "path": "wallet/src/de/schildbach/wallet/ui/send/SendCoinsFragment.java", "diffHunk": "@@ -158,7 +161,7 @@ public void onClick(final DialogInterface dialog, final int which) {\n     public void onAttach(final Context context) {\n         super.onAttach(context);\n \n-        this.activity = (AbstractBindServiceActivity) context;\n+        this.activity = (SendCoinsActivity) context;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "81fa5c862398def2edb001f0225c955b6f5ae373"}, "originalPosition": 50}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b9ace74d4902f854f37bd6cc634aeb6e4b56b63f", "author": {"user": {"login": "tomasz-ludek", "name": null}}, "url": "https://github.com/dashevo/dash-wallet/commit/b9ace74d4902f854f37bd6cc634aeb6e4b56b63f", "committedDate": "2020-02-05T11:28:40Z", "message": "Merge branch 'redesign' into redisign-keystore-introduction\n\n# Conflicts:\n#\twallet/src/de/schildbach/wallet/ui/LockScreenActivity.kt\n#\twallet/src/de/schildbach/wallet/ui/SetPinActivity.kt\n#\twallet/src/de/schildbach/wallet/ui/VerifySeedActivity.kt\n#\twallet/src/de/schildbach/wallet/ui/WalletActivity.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2cbb160c5f16f70044f77d81fe238c84ba9c7b55", "author": {"user": {"login": "tomasz-ludek", "name": null}}, "url": "https://github.com/dashevo/dash-wallet/commit/2cbb160c5f16f70044f77d81fe238c84ba9c7b55", "committedDate": "2020-02-05T13:17:21Z", "message": "Minor code refactoring"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUzODIyNDIw", "url": "https://github.com/dashevo/dash-wallet/pull/313#pullrequestreview-353822420", "createdAt": "2020-02-05T15:46:32Z", "commit": {"oid": "2cbb160c5f16f70044f77d81fe238c84ba9c7b55"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2970, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}