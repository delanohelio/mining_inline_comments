{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI0MDg4NjI3", "number": 418, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QyMDoxMDozM1rOEAQirQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMVQxNDoxNzo1MVrOEBLzgg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4NzA2NDc3OnYy", "diffSide": "RIGHT", "path": "wallet/src/de/schildbach/wallet/service/BlockchainServiceImpl.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QyMDoxMDozM1rOGbbZhA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QyMDoxMDozM1rOGbbZhA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTQxMzYzNg==", "bodyText": "For some reason the listener added here was being called three times.  This resulted in three services being created.", "url": "https://github.com/dashevo/dash-wallet/pull/418#discussion_r431413636", "createdAt": "2020-05-27T20:10:33Z", "author": {"login": "HashEngineering"}, "path": "wallet/src/de/schildbach/wallet/service/BlockchainServiceImpl.java", "diffHunk": "@@ -773,12 +789,31 @@ public void onCreate() {\n \n         peerDiscoveryList.add(dnsDiscovery);\n         updateAppWidget();\n+\n+        initViewModel();\n+    }\n+\n+    void initViewModel() {\n+\n         AppDatabase.getAppDatabase().blockchainStateDao().load().observe(this, new Observer<BlockchainState>() {\n             @Override\n             public void onChanged(BlockchainState blockchainState) {\n                 handleBlockchainStateNotification(blockchainState);\n             }\n         });\n+\n+        Wallet wallet = ((WalletApplication) getApplication()).getWallet();\n+        //wallet.addCreditFundingEventListener(Threading.SAME_THREAD, creditFundingTransactionEventListener);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f04482d751efc5b739e13f7681462754466b0d31"}, "originalPosition": 95}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY4NzE4MjU1OnYy", "diffSide": "RIGHT", "path": "wallet/src/de/schildbach/wallet/ui/dashpay/PlatformRepo.kt", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QyMDo0ODo1NFrOGbck_A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QyMDo0ODo1NFrOGbck_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTQzMjk1Ng==", "bodyText": "comment is wrong", "url": "https://github.com/dashevo/dash-wallet/pull/418#discussion_r431432956", "createdAt": "2020-05-27T20:48:54Z", "author": {"login": "HashEngineering"}, "path": "wallet/src/de/schildbach/wallet/ui/dashpay/PlatformRepo.kt", "diffHunk": "@@ -147,4 +166,13 @@ class PlatformRepo(val walletApplication: WalletApplication) {\n             }\n         }\n     }\n+\n+    //\n+    // Step 5: Find the identity in the case of recovery", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f04482d751efc5b739e13f7681462754466b0d31"}, "originalPosition": 46}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY5Njc3NDQyOnYy", "diffSide": "RIGHT", "path": "wallet/src/de/schildbach/wallet/service/BlockchainServiceImpl.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0zMVQxNDoxNzo1MVrOGc5R5A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wMVQxMjozOToyN1rOGdJBJQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjk1MTc4MA==", "bodyText": "When resetting a wallet, this code does not appear to be executed.  Is it because we are using an executor? @tomasz-ludek\nPerhaps the app is restarted before this is executed.  When doing a rescan blockchain, this code is executed.", "url": "https://github.com/dashevo/dash-wallet/pull/418#discussion_r432951780", "createdAt": "2020-05-31T14:17:51Z", "author": {"login": "HashEngineering"}, "path": "wallet/src/de/schildbach/wallet/service/BlockchainServiceImpl.java", "diffHunk": "@@ -916,6 +930,15 @@ public void onDestroy() {\n                 log.info(\"removing wallet file and app data\");\n                 application.finalizeWipe();\n             }\n+            //Clear the blockchain identity\n+            executor.execute(new Runnable() {\n+                @Override\n+                public void run() {\n+                    //not sure when this will execute\n+                    AppDatabase.getAppDatabase().blockchainIdentityDataDao().clear();\n+                    AppDatabase.getAppDatabase().dashPayProfileDao().clear();\n+                }\n+            });", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "628e9f2700050204dc34dadc7144dedbf38b77c6"}, "originalPosition": 84}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjk3MjExMA==", "bodyText": "As discussed on Slack. It could be moved to the end of WalletApplication.finalizeWipe methode, like this:\nfinal Handler mainThreadHandler = new Handler();\nExecutors.newSingleThreadExecutor().execute(new Runnable() {\n    @Override\n    public void run() {\n        AppDatabase.getAppDatabase().blockchainIdentityDataDao().clear();\n        AppDatabase.getAppDatabase().dashPayProfileDao().clear();\n        mainThreadHandler.post(new Runnable() {\n            @Override\n            public void run() {\n                ProcessPhoenix.triggerRebirth(WalletApplication.this);\n            }\n        });\n    }\n});", "url": "https://github.com/dashevo/dash-wallet/pull/418#discussion_r432972110", "createdAt": "2020-05-31T18:31:05Z", "author": {"login": "tomasz-ludek"}, "path": "wallet/src/de/schildbach/wallet/service/BlockchainServiceImpl.java", "diffHunk": "@@ -916,6 +930,15 @@ public void onDestroy() {\n                 log.info(\"removing wallet file and app data\");\n                 application.finalizeWipe();\n             }\n+            //Clear the blockchain identity\n+            executor.execute(new Runnable() {\n+                @Override\n+                public void run() {\n+                    //not sure when this will execute\n+                    AppDatabase.getAppDatabase().blockchainIdentityDataDao().clear();\n+                    AppDatabase.getAppDatabase().dashPayProfileDao().clear();\n+                }\n+            });", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjk1MTc4MA=="}, "originalCommit": {"oid": "628e9f2700050204dc34dadc7144dedbf38b77c6"}, "originalPosition": 84}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzIwOTYzNw==", "bodyText": "abf080a\nthis code was working for me", "url": "https://github.com/dashevo/dash-wallet/pull/418#discussion_r433209637", "createdAt": "2020-06-01T12:39:27Z", "author": {"login": "HashEngineering"}, "path": "wallet/src/de/schildbach/wallet/service/BlockchainServiceImpl.java", "diffHunk": "@@ -916,6 +930,15 @@ public void onDestroy() {\n                 log.info(\"removing wallet file and app data\");\n                 application.finalizeWipe();\n             }\n+            //Clear the blockchain identity\n+            executor.execute(new Runnable() {\n+                @Override\n+                public void run() {\n+                    //not sure when this will execute\n+                    AppDatabase.getAppDatabase().blockchainIdentityDataDao().clear();\n+                    AppDatabase.getAppDatabase().dashPayProfileDao().clear();\n+                }\n+            });", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjk1MTc4MA=="}, "originalCommit": {"oid": "628e9f2700050204dc34dadc7144dedbf38b77c6"}, "originalPosition": 84}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 659, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}