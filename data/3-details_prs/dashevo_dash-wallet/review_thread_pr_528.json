{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAxOTI4MDg5", "number": 528, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQwMDo1MTo0N1rOEtRldg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQwNDozMjoyNlrOEwEVBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE1OTA5NDk0OnYy", "diffSide": "RIGHT", "path": "common/src/main/java/org/dash/wallet/common/Configuration.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQwMDo1MTo0N1rOHg-X_w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQwMTo1NTo1M1rOHg_W6Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDMzODQzMQ==", "bodyText": ".apply() needs to be called to save the image path to preferences.", "url": "https://github.com/dashevo/dash-wallet/pull/528#discussion_r504338431", "createdAt": "2020-10-14T00:51:47Z", "author": {"login": "sambarboza"}, "path": "common/src/main/java/org/dash/wallet/common/Configuration.java", "diffHunk": "@@ -431,7 +432,15 @@ public long getLastSeenNotificationTime() {\n         return prefs.getLong(PREFS_LAST_SEEN_NOTIFICATION_TIME, 0);\n     }\n \n-    public void setPrefsLastSeenNotificationTime(long lastSeenNotificationTime) {\n+    public void setLastSeenNotificationTime(long lastSeenNotificationTime) {\n         prefs.edit().putLong(PREFS_LAST_SEEN_NOTIFICATION_TIME, lastSeenNotificationTime).apply();\n     }\n+\n+    public void setLocalProfilePictureUri(String picturePath) {\n+        prefs.edit().putString(PREFS_KEY_LOCAL_PROFILE_PICTURE_URI, picturePath);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1dfcb0ff7df947c473ce427fa90384cc2f7c203f"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDM1NDUzNw==", "bodyText": "Fixed here: 649f009", "url": "https://github.com/dashevo/dash-wallet/pull/528#discussion_r504354537", "createdAt": "2020-10-14T01:55:53Z", "author": {"login": "HashEngineering"}, "path": "common/src/main/java/org/dash/wallet/common/Configuration.java", "diffHunk": "@@ -431,7 +432,15 @@ public long getLastSeenNotificationTime() {\n         return prefs.getLong(PREFS_LAST_SEEN_NOTIFICATION_TIME, 0);\n     }\n \n-    public void setPrefsLastSeenNotificationTime(long lastSeenNotificationTime) {\n+    public void setLastSeenNotificationTime(long lastSeenNotificationTime) {\n         prefs.edit().putLong(PREFS_LAST_SEEN_NOTIFICATION_TIME, lastSeenNotificationTime).apply();\n     }\n+\n+    public void setLocalProfilePictureUri(String picturePath) {\n+        prefs.edit().putString(PREFS_KEY_LOCAL_PROFILE_PICTURE_URI, picturePath);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDMzODQzMQ=="}, "originalCommit": {"oid": "1dfcb0ff7df947c473ce427fa90384cc2f7c203f"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE4ODM4MDIwOnYy", "diffSide": "RIGHT", "path": "wallet/src/de/schildbach/wallet/ui/EditProfileActivity.kt", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQwNDozMjoyNlrOHlZ3qA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQyMjozNzowN1rOHmJxFg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODk4MzIwOA==", "bodyText": "I think the ger... is a typo?", "url": "https://github.com/dashevo/dash-wallet/pull/528#discussion_r508983208", "createdAt": "2020-10-21T04:32:26Z", "author": {"login": "sambarboza"}, "path": "wallet/src/de/schildbach/wallet/ui/EditProfileActivity.kt", "diffHunk": "@@ -177,4 +221,115 @@ class EditProfileActivity : BaseMenuActivity() {\n         this.isEditing = isEditing\n     }\n \n+    private fun takePictureWithPermission() {\n+        if (ContextCompat.checkSelfPermission(this, Manifest.permission.CAMERA) == PackageManager.PERMISSION_GRANTED) {\n+            takePicture()\n+        } else {\n+            ActivityCompat.requestPermissions(this, arrayOf(Manifest.permission.CAMERA), REQUEST_CODE_TAKE_PICTURE_PERMISSION)\n+        }\n+    }\n+\n+    private fun choosePictureWithPermission() {\n+        if (ContextCompat.checkSelfPermission(this, Manifest.permission.READ_EXTERNAL_STORAGE) == PackageManager.PERMISSION_GRANTED) {\n+            choosePicture()\n+        } else {\n+            ActivityCompat.requestPermissions(this, arrayOf(Manifest.permission.READ_EXTERNAL_STORAGE), REQUEST_CODE_CHOOSE_PICTURE_PERMISSION)\n+        }\n+    }\n+\n+    private fun selectImage(context: Context) {\n+        SelectProfilePictureDialog.createDialog()\n+                .show(supportFragmentManager, \"selectPictureDialog\");\n+    }\n+\n+    private fun choosePicture() {\n+        if (editProfileViewModel.createTmpPictureFile()) {\n+            val pickPhoto = Intent(Intent.ACTION_PICK, MediaStore.Images.Media.EXTERNAL_CONTENT_URI)\n+            startActivityForResult(pickPhoto, REQUEST_CODE_URI)\n+        } else {\n+            Toast.makeText(this, \"Unable to create temporary file\", Toast.LENGTH_LONG).show()\n+        }\n+    }\n+\n+    private fun takePicture() {\n+        if (editProfileViewModel.createTmpPictureFile()) {\n+            dispatchTakePictureIntent()\n+        } else {\n+            Toast.makeText(this, \"Unable to create temporary file\", Toast.LENGTH_LONG).show()\n+        }\n+    }\n+\n+    private fun dispatchTakePictureIntent() {\n+        Intent(MediaStore.ACTION_IMAGE_CAPTURE).also { takePictureIntent ->\n+            // Ensure that there's a camera activity to handle the intent\n+            takePictureIntent.resolveActivity(packageManager)?.also {\n+                val tmpFileUri = gerFileUri(editProfileViewModel.tmpPictureFile)\n+                takePictureIntent.putExtra(MediaStore.EXTRA_OUTPUT, tmpFileUri)\n+                if (Build.VERSION.SDK_INT <= Build.VERSION_CODES.LOLLIPOP) {\n+                    // to avoid 'SecurityException: Permission Denial' on KitKat\n+                    takePictureIntent.clipData = ClipData.newRawUri(\"\", tmpFileUri)\n+                    takePictureIntent.addFlags(Intent.FLAG_GRANT_WRITE_URI_PERMISSION or Intent.FLAG_GRANT_READ_URI_PERMISSION)\n+                }\n+                startActivityForResult(takePictureIntent, REQUEST_CODE_IMAGE)\n+            }\n+        }\n+    }\n+\n+    override fun onActivityResult(requestCode: Int, resultCode: Int, data: Intent?) {\n+        super.onActivityResult(requestCode, resultCode, data)\n+        if (resultCode != RESULT_CANCELED) {\n+            when (requestCode) {\n+                REQUEST_CODE_IMAGE -> {\n+                    if (resultCode == RESULT_OK) {\n+                        // picture saved in editProfileViewModel.profilePictureTmpFile\n+                        editProfileViewModel.onTmpPictureReadyForEditEvent.call(editProfileViewModel.tmpPictureFile)\n+                    }\n+                }\n+                REQUEST_CODE_URI -> if (resultCode == RESULT_OK && data != null) {\n+                    val selectedImage: Uri? = data.data\n+                    val filePathColumn = arrayOf(MediaStore.Images.Media.DATA)\n+                    if (selectedImage != null) {\n+                        val cursor: Cursor? = contentResolver.query(selectedImage,\n+                                filePathColumn, null, null, null)\n+                        if (cursor != null) {\n+                            cursor.moveToFirst()\n+                            val columnIndex: Int = cursor.getColumnIndex(filePathColumn[0])\n+                            val picturePath: String = cursor.getString(columnIndex)\n+                            editProfileViewModel.saveAsProfilePictureTmp(picturePath)\n+                            cursor.close()\n+                        }\n+                    }\n+                }\n+            }\n+        }\n+    }\n+\n+    private fun cropProfilePicture() {\n+        val tmpPictureFile = editProfileViewModel.tmpPictureFile\n+        //TODO: this line is for debugging - show the selected image on the screen\n+        dashpayUserAvatar.setImageURI(gerFileUri(tmpPictureFile))\n+        editProfileViewModel.saveTmpAsProfilePicture()\n+    }\n+\n+    override fun onRequestPermissionsResult(requestCode: Int, permissions: Array<out String>, grantResults: IntArray) {\n+        when (requestCode) {\n+            REQUEST_CODE_TAKE_PICTURE_PERMISSION -> {\n+                when {\n+                    grantResults.isNotEmpty() && grantResults[0] == PackageManager.PERMISSION_GRANTED -> takePicture()\n+                    else -> takePictureWithPermission()\n+                }\n+            }\n+            REQUEST_CODE_CHOOSE_PICTURE_PERMISSION -> {\n+                when {\n+                    grantResults.isNotEmpty() && grantResults[0] == PackageManager.PERMISSION_GRANTED -> choosePicture()\n+                    else -> choosePictureWithPermission()\n+                }\n+            }\n+            else -> super.onRequestPermissionsResult(requestCode, permissions, grantResults)\n+        }\n+    }\n+\n+    private fun gerFileUri(file: File): Uri {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9e77c31f5a7ea1432d9c51977401e5dbdee9e8c9"}, "originalPosition": 207}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTc2Nzk1OA==", "bodyText": "Fixed here:  206c8d1", "url": "https://github.com/dashevo/dash-wallet/pull/528#discussion_r509767958", "createdAt": "2020-10-21T22:37:07Z", "author": {"login": "HashEngineering"}, "path": "wallet/src/de/schildbach/wallet/ui/EditProfileActivity.kt", "diffHunk": "@@ -177,4 +221,115 @@ class EditProfileActivity : BaseMenuActivity() {\n         this.isEditing = isEditing\n     }\n \n+    private fun takePictureWithPermission() {\n+        if (ContextCompat.checkSelfPermission(this, Manifest.permission.CAMERA) == PackageManager.PERMISSION_GRANTED) {\n+            takePicture()\n+        } else {\n+            ActivityCompat.requestPermissions(this, arrayOf(Manifest.permission.CAMERA), REQUEST_CODE_TAKE_PICTURE_PERMISSION)\n+        }\n+    }\n+\n+    private fun choosePictureWithPermission() {\n+        if (ContextCompat.checkSelfPermission(this, Manifest.permission.READ_EXTERNAL_STORAGE) == PackageManager.PERMISSION_GRANTED) {\n+            choosePicture()\n+        } else {\n+            ActivityCompat.requestPermissions(this, arrayOf(Manifest.permission.READ_EXTERNAL_STORAGE), REQUEST_CODE_CHOOSE_PICTURE_PERMISSION)\n+        }\n+    }\n+\n+    private fun selectImage(context: Context) {\n+        SelectProfilePictureDialog.createDialog()\n+                .show(supportFragmentManager, \"selectPictureDialog\");\n+    }\n+\n+    private fun choosePicture() {\n+        if (editProfileViewModel.createTmpPictureFile()) {\n+            val pickPhoto = Intent(Intent.ACTION_PICK, MediaStore.Images.Media.EXTERNAL_CONTENT_URI)\n+            startActivityForResult(pickPhoto, REQUEST_CODE_URI)\n+        } else {\n+            Toast.makeText(this, \"Unable to create temporary file\", Toast.LENGTH_LONG).show()\n+        }\n+    }\n+\n+    private fun takePicture() {\n+        if (editProfileViewModel.createTmpPictureFile()) {\n+            dispatchTakePictureIntent()\n+        } else {\n+            Toast.makeText(this, \"Unable to create temporary file\", Toast.LENGTH_LONG).show()\n+        }\n+    }\n+\n+    private fun dispatchTakePictureIntent() {\n+        Intent(MediaStore.ACTION_IMAGE_CAPTURE).also { takePictureIntent ->\n+            // Ensure that there's a camera activity to handle the intent\n+            takePictureIntent.resolveActivity(packageManager)?.also {\n+                val tmpFileUri = gerFileUri(editProfileViewModel.tmpPictureFile)\n+                takePictureIntent.putExtra(MediaStore.EXTRA_OUTPUT, tmpFileUri)\n+                if (Build.VERSION.SDK_INT <= Build.VERSION_CODES.LOLLIPOP) {\n+                    // to avoid 'SecurityException: Permission Denial' on KitKat\n+                    takePictureIntent.clipData = ClipData.newRawUri(\"\", tmpFileUri)\n+                    takePictureIntent.addFlags(Intent.FLAG_GRANT_WRITE_URI_PERMISSION or Intent.FLAG_GRANT_READ_URI_PERMISSION)\n+                }\n+                startActivityForResult(takePictureIntent, REQUEST_CODE_IMAGE)\n+            }\n+        }\n+    }\n+\n+    override fun onActivityResult(requestCode: Int, resultCode: Int, data: Intent?) {\n+        super.onActivityResult(requestCode, resultCode, data)\n+        if (resultCode != RESULT_CANCELED) {\n+            when (requestCode) {\n+                REQUEST_CODE_IMAGE -> {\n+                    if (resultCode == RESULT_OK) {\n+                        // picture saved in editProfileViewModel.profilePictureTmpFile\n+                        editProfileViewModel.onTmpPictureReadyForEditEvent.call(editProfileViewModel.tmpPictureFile)\n+                    }\n+                }\n+                REQUEST_CODE_URI -> if (resultCode == RESULT_OK && data != null) {\n+                    val selectedImage: Uri? = data.data\n+                    val filePathColumn = arrayOf(MediaStore.Images.Media.DATA)\n+                    if (selectedImage != null) {\n+                        val cursor: Cursor? = contentResolver.query(selectedImage,\n+                                filePathColumn, null, null, null)\n+                        if (cursor != null) {\n+                            cursor.moveToFirst()\n+                            val columnIndex: Int = cursor.getColumnIndex(filePathColumn[0])\n+                            val picturePath: String = cursor.getString(columnIndex)\n+                            editProfileViewModel.saveAsProfilePictureTmp(picturePath)\n+                            cursor.close()\n+                        }\n+                    }\n+                }\n+            }\n+        }\n+    }\n+\n+    private fun cropProfilePicture() {\n+        val tmpPictureFile = editProfileViewModel.tmpPictureFile\n+        //TODO: this line is for debugging - show the selected image on the screen\n+        dashpayUserAvatar.setImageURI(gerFileUri(tmpPictureFile))\n+        editProfileViewModel.saveTmpAsProfilePicture()\n+    }\n+\n+    override fun onRequestPermissionsResult(requestCode: Int, permissions: Array<out String>, grantResults: IntArray) {\n+        when (requestCode) {\n+            REQUEST_CODE_TAKE_PICTURE_PERMISSION -> {\n+                when {\n+                    grantResults.isNotEmpty() && grantResults[0] == PackageManager.PERMISSION_GRANTED -> takePicture()\n+                    else -> takePictureWithPermission()\n+                }\n+            }\n+            REQUEST_CODE_CHOOSE_PICTURE_PERMISSION -> {\n+                when {\n+                    grantResults.isNotEmpty() && grantResults[0] == PackageManager.PERMISSION_GRANTED -> choosePicture()\n+                    else -> choosePictureWithPermission()\n+                }\n+            }\n+            else -> super.onRequestPermissionsResult(requestCode, permissions, grantResults)\n+        }\n+    }\n+\n+    private fun gerFileUri(file: File): Uri {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODk4MzIwOA=="}, "originalCommit": {"oid": "9e77c31f5a7ea1432d9c51977401e5dbdee9e8c9"}, "originalPosition": 207}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 607, "cost": 1, "resetAt": "2021-11-12T11:57:46Z"}}}