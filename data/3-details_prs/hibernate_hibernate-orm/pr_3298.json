{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg3NDY4MDM1", "number": 3298, "title": "Wip/6.0 HHH 13756 Entity graph implementation", "bodyText": "https://trello.com/c/d9dirY4C/59-entitygraph-support\nhttps://hibernate.atlassian.net/browse/HHH-13756\nTesting cases for loader, HQL and Criteria are added. To avoid getting lost in ANTLR tree forest, many util method was created. Because of our testing mechanism, JUnit5's @Nest and parameterized testing features cannot be tapped into to avoid duplication, however.\nOne bug flushed out (not directly related to entity graph) and a PR has been created: #3297", "createdAt": "2020-03-12T20:55:36Z", "url": "https://github.com/hibernate/hibernate-orm/pull/3298", "merged": true, "mergeCommit": {"oid": "620dcc62c05943472f2d302513ae8967d72a3145"}, "closed": true, "closedAt": "2020-03-19T18:27:13Z", "author": {"login": "NathanQingyangXu"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcNCJYIgFqTM3Mzg5NTAxMw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcPQMcQgFqTM3Nzk4NjI4Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczODk1MDEz", "url": "https://github.com/hibernate/hibernate-orm/pull/3298#pullrequestreview-373895013", "createdAt": "2020-03-12T20:57:08Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQyMDo1NzowOVrOF1vC5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQyMDo1NzowOVrOF1vC5w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTg4OTYzOQ==", "bodyText": "The boolean parameter to denote whether we are exploring 'keySubGraph' is important to disambiguate in entity graph implementing, so I changed Consumer to BiConsumer.", "url": "https://github.com/hibernate/hibernate-orm/pull/3298#discussion_r391889639", "createdAt": "2020-03-12T20:57:09Z", "author": {"login": "NathanQingyangXu"}, "path": "hibernate-core/src/main/java/org/hibernate/loader/ast/internal/LoaderSelectBuilder.java", "diffHunk": "@@ -366,36 +382,33 @@ private void applyOrdering(TableGroup tableGroup, PluralAttributeMapping pluralA\n \t\t}\n \t}\n \n-\tprivate void applyOrdering(\n-\t\t\tTableGroup tableGroup,\n-\t\t\tOrderByFragment orderByFragment) {\n+\tprivate void applyOrdering(TableGroup tableGroup, OrderByFragment orderByFragment) {\n \t\tif ( orderByFragments == null ) {\n \t\t\torderByFragments = new LinkedHashMap<>();\n \t\t}\n \t\torderByFragments.put( orderByFragment, tableGroup );\n \t}\n \n-\tprivate int fetchDepth = 0;\n-\n \tprivate List<Fetch> visitFetches(FetchParent fetchParent, QuerySpec querySpec, LoaderSqlAstCreationState creationState) {\n \t\tlog.tracef( \"Starting visitation of FetchParent's Fetchables : %s\", fetchParent.getNavigablePath() );\n \n \t\tfinal List<Fetch> fetches = new ArrayList<>();\n \n-\t\tfinal Consumer<Fetchable> processor = createFetchableConsumer( fetchParent, querySpec, creationState, fetches );\n+\t\tfinal BiConsumer<Fetchable, Boolean> processor = createFetchableBiConsumer( fetchParent, querySpec, creationState, fetches );\n \n \t\tfinal FetchableContainer referencedMappingContainer = fetchParent.getReferencedMappingContainer();\n-\t\treferencedMappingContainer.visitKeyFetchables( processor, null );\n-\t\treferencedMappingContainer.visitFetchables( processor, null );\n+\t\treferencedMappingContainer.visitKeyFetchables( fetchable -> processor.accept( fetchable, true ), null );\n+\t\treferencedMappingContainer.visitFetchables( fetchable -> processor.accept( fetchable, false ), null );", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 143}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczODk1ODAw", "url": "https://github.com/hibernate/hibernate-orm/pull/3298#pullrequestreview-373895800", "createdAt": "2020-03-12T20:58:34Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQyMDo1ODozNFrOF1vFQQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQyMDo1ODozNFrOF1vFQQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTg5MDI0MQ==", "bodyText": "I moved the field here for best practice. Also, it seems we don't need to set default value here.", "url": "https://github.com/hibernate/hibernate-orm/pull/3298#discussion_r391890241", "createdAt": "2020-03-12T20:58:34Z", "author": {"login": "NathanQingyangXu"}, "path": "hibernate-core/src/main/java/org/hibernate/query/sqm/sql/internal/StandardSqmSelectTranslator.java", "diffHunk": "@@ -86,7 +85,9 @@\n \t// prepare for 10 root selections to avoid list growth in most cases\n \tprivate final List<DomainResult> domainResults = CollectionHelper.arrayList( 10 );\n \n-\tprivate GraphImplementor<?> currentJpaGraphNode;\n+\tprivate final EntityGraphNavigator entityGraphNavigator;\n+\n+\tprivate int fetchDepth;", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 38}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "be251de56021176596c16b9a09af439fcc416cd8", "author": {"user": {"login": "NathanQingyangXu", "name": "Nathan Xu"}}, "url": "https://github.com/hibernate/hibernate-orm/commit/be251de56021176596c16b9a09af439fcc416cd8", "committedDate": "2020-03-18T15:08:32Z", "message": "HHH-13756 implement entity graph in v6"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd01841ebf1b32c0ce8e3b1d68cdc93c726a6802", "author": {"user": {"login": "NathanQingyangXu", "name": "Nathan Xu"}}, "url": "https://github.com/hibernate/hibernate-orm/commit/bd01841ebf1b32c0ce8e3b1d68cdc93c726a6802", "committedDate": "2020-03-18T15:08:32Z", "message": "HHH-13756 rename 'NavigateResult' class name to 'Navigation'"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f30f0bf982d3d95a6f333c211ffe3ff170c8cdfa", "author": {"user": {"login": "NathanQingyangXu", "name": "Nathan Xu"}}, "url": "https://github.com/hibernate/hibernate-orm/commit/f30f0bf982d3d95a6f333c211ffe3ff170c8cdfa", "committedDate": "2020-03-18T15:08:32Z", "message": "HHH-13756 add a hql testing skeleton"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d190b59a48a49b8d95bc20785868b30139035d69", "author": {"user": {"login": "NathanQingyangXu", "name": "Nathan Xu"}}, "url": "https://github.com/hibernate/hibernate-orm/commit/d190b59a48a49b8d95bc20785868b30139035d69", "committedDate": "2020-03-18T15:08:32Z", "message": "HHH-13756 enrich hql testing class"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dcfd288522677f3012810cb4461ba9637a8c3a69", "author": {"user": {"login": "NathanQingyangXu", "name": "Nathan Xu"}}, "url": "https://github.com/hibernate/hibernate-orm/commit/dcfd288522677f3012810cb4461ba9637a8c3a69", "committedDate": "2020-03-18T15:09:45Z", "message": "HHH-13756 fix some bug in EmbeddableFetchImpl"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c3fd948564e6ce2ebcded88d171e6c795f592bc6", "author": {"user": {"login": "NathanQingyangXu", "name": "Nathan Xu"}}, "url": "https://github.com/hibernate/hibernate-orm/commit/c3fd948564e6ce2ebcded88d171e6c795f592bc6", "committedDate": "2020-03-18T15:09:45Z", "message": "HHH-13756 simplify EntityGraphNavigator's navigate() to never return null value"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "df9a96fc0d48c066c7d4081897c5a19472823db6", "author": {"user": {"login": "NathanQingyangXu", "name": "Nathan Xu"}}, "url": "https://github.com/hibernate/hibernate-orm/commit/df9a96fc0d48c066c7d4081897c5a19472823db6", "committedDate": "2020-03-18T15:09:45Z", "message": "finish both 'loader' and 'HQL' testing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "03fb438000b5842e7309622d6398e52d2646fba7", "author": {"user": {"login": "NathanQingyangXu", "name": "Nathan Xu"}}, "url": "https://github.com/hibernate/hibernate-orm/commit/03fb438000b5842e7309622d6398e52d2646fba7", "committedDate": "2020-03-18T15:09:45Z", "message": "add 'Criteria' testing"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "313f6a5ac3b45e51ea0d15c08a83d84872a179cd", "author": {"user": {"login": "NathanQingyangXu", "name": "Nathan Xu"}}, "url": "https://github.com/hibernate/hibernate-orm/commit/313f6a5ac3b45e51ea0d15c08a83d84872a179cd", "committedDate": "2020-03-18T15:09:45Z", "message": "make use of JUnit5's ParameterizedTest to avoid some testing code duplication"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "411fc2d71e752df9b7dd81539040014561f7fcdf", "author": {"user": {"login": "NathanQingyangXu", "name": "Nathan Xu"}}, "url": "https://github.com/hibernate/hibernate-orm/commit/411fc2d71e752df9b7dd81539040014561f7fcdf", "committedDate": "2020-03-18T15:09:46Z", "message": "HHH-13756 renaming and internal implementation tweaking"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "411fc2d71e752df9b7dd81539040014561f7fcdf", "author": {"user": {"login": "NathanQingyangXu", "name": "Nathan Xu"}}, "url": "https://github.com/hibernate/hibernate-orm/commit/411fc2d71e752df9b7dd81539040014561f7fcdf", "committedDate": "2020-03-18T15:09:46Z", "message": "HHH-13756 renaming and internal implementation tweaking"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc3OTg2Mjgy", "url": "https://github.com/hibernate/hibernate-orm/pull/3298#pullrequestreview-377986282", "createdAt": "2020-03-19T18:27:02Z", "commit": {"oid": "411fc2d71e752df9b7dd81539040014561f7fcdf"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3215, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}