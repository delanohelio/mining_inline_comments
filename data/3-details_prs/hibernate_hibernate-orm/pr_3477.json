{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU1Mzk2Mjg1", "number": 3477, "title": "HHH-14113 Entity Graph attribute resolution not based on selected entity", "bodyText": "https://hibernate.atlassian.net/browse/HHH-14113\nI added a warning logging to remind the user that entity graph is not applicable to the root entity, as per Benjamin M.'s suggestion.\nNote: this PR should not be merged into v6 for entity graph implementation in v6 has changed.", "createdAt": "2020-07-22T22:59:27Z", "url": "https://github.com/hibernate/hibernate-orm/pull/3477", "merged": true, "mergeCommit": {"oid": "162bc7d9dd671d6fc3c596a2ec29c469c1acb7b3"}, "closed": true, "closedAt": "2020-09-01T18:20:55Z", "author": {"login": "NathanQingyangXu"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc3jH8KABqjM1Nzc4NzE2MTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc5wVO4ABqjM2MDA1NDY2NjM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU1NzU0NTk1", "url": "https://github.com/hibernate/hibernate-orm/pull/3477#pullrequestreview-455754595", "createdAt": "2020-07-27T12:58:17Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QxMjo1ODoxN1rOG3hSxg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yN1QxMjo1ODoxN1rOG3hSxg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDg3MDM0Mg==", "bodyText": "I noticed there seems to be some additional issue here. So from the HQL it seems the result should be a list of Set<Group>, but the real result is a list of Group. Is that a bug?", "url": "https://github.com/hibernate/hibernate-orm/pull/3477#discussion_r460870342", "createdAt": "2020-07-27T12:58:17Z", "author": {"login": "NathanQingyangXu"}, "path": "hibernate-core/src/test/java/org/hibernate/jpa/test/graphs/EntityGraphAttributeResolutionTest.java", "diffHunk": "@@ -0,0 +1,254 @@\n+package org.hibernate.jpa.test.graphs;\n+\n+import java.util.Arrays;\n+import java.util.EnumSet;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Set;\n+import javax.persistence.CollectionTable;\n+import javax.persistence.ElementCollection;\n+import javax.persistence.Entity;\n+import javax.persistence.EntityGraph;\n+import javax.persistence.EntityManager;\n+import javax.persistence.EnumType;\n+import javax.persistence.Enumerated;\n+import javax.persistence.FetchType;\n+import javax.persistence.GeneratedValue;\n+import javax.persistence.GenerationType;\n+import javax.persistence.Id;\n+import javax.persistence.JoinColumn;\n+import javax.persistence.ManyToMany;\n+import javax.persistence.NamedAttributeNode;\n+import javax.persistence.NamedEntityGraph;\n+import javax.persistence.Table;\n+\n+import org.hibernate.graph.GraphSemantic;\n+import org.hibernate.jpa.test.BaseEntityManagerFunctionalTestCase;\n+\n+import org.hibernate.testing.TestForIssue;\n+import org.junit.Before;\n+import org.junit.Test;\n+\n+import static org.junit.Assert.assertEquals;\n+\n+\n+/**\n+ * @author Benjamin M.\n+ * @author Nathan Xu\n+ */\n+@TestForIssue( jiraKey = \"HHH-14113\" )\n+public class EntityGraphAttributeResolutionTest extends BaseEntityManagerFunctionalTestCase {\n+\n+\tprivate User u;\n+\tprivate Group g1, g2;\n+\n+\t@Override\n+\tprotected Class<?>[] getAnnotatedClasses() {\n+\t\treturn new Class[] { User.class, Group.class };\n+\t}\n+\n+\t@Before\n+\tpublic void setUp() {\n+\t\tEntityManager em = getOrCreateEntityManager();\n+\t\tem.getTransaction().begin();\n+\n+\t\tg1 = new Group();\n+\t\tg1.addPermission( Permission.BAR );\n+\t\tem.persist( g1 );\n+\n+\t\tg2 = new Group();\n+\t\tg2.addPermission( Permission.BAZ );\n+\t\tem.persist( g2 );\n+\n+\t\tu = new User();\n+\t\tem.persist( u );\n+\t\tu.addGroup( g1 );\n+\t\tu.addGroup( g2 );\n+\n+\t\tem.getTransaction().commit();\n+\t}\n+\n+\t@Test\n+\tpublic void fetchAssocWithNamedFetchGraph() {\n+\t\tEntityManager em = getOrCreateEntityManager();\n+\t\tList result = em.createQuery( \"SELECT u.groups FROM User u WHERE u.id = ?1\" )\n+\t\t\t\t.setParameter(1, u.getId() )\n+\t\t\t\t.setHint( GraphSemantic.FETCH.getJpaHintName(), em.getEntityGraph( Group.ENTITY_GRAPH ) )\n+\t\t\t\t.getResultList();\n+\n+\t\tassertEquals( Arrays.asList( g1, g2 ), result );", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 79}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": null}, {"__typename": "PullRequestCommit", "commit": {"oid": "35ca367a0585ef331087309d9b0e5294cac65c7b", "author": {"user": {"login": "NathanQingyangXu", "name": "Nathan Xu"}}, "url": "https://github.com/hibernate/hibernate-orm/commit/35ca367a0585ef331087309d9b0e5294cac65c7b", "committedDate": "2020-07-29T19:38:00Z", "message": "HHH-14113 Entity Graph attribute resolution not based on selected entity"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "35ca367a0585ef331087309d9b0e5294cac65c7b", "author": {"user": {"login": "NathanQingyangXu", "name": "Nathan Xu"}}, "url": "https://github.com/hibernate/hibernate-orm/commit/35ca367a0585ef331087309d9b0e5294cac65c7b", "committedDate": "2020-07-29T19:38:00Z", "message": "HHH-14113 Entity Graph attribute resolution not based on selected entity"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2814, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}