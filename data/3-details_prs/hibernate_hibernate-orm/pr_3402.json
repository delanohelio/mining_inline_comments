{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE4NjM0MjMx", "number": 3402, "title": "wip/6.0 Fix some logging performance issues", "bodyText": "This is a labour intensively PR and feel free to have it merged as late as possible lest it breaks many existing PRs.\nThe following issues are taken care of in this PR as much as possible:\n\navoid string concatenation (replace it with format parameter)\nadd level checking if the format parameter involves nontrivial computing (e.g. method invoking)\nkeep from using format logging method if the content doesn't involve format placeholder\nmisc bugs correction (e.g. missing format parameter, etc.)", "createdAt": "2020-05-15T14:46:04Z", "url": "https://github.com/hibernate/hibernate-orm/pull/3402", "merged": true, "mergeCommit": {"oid": "4c856725f804677b724d26b270785d947c60cb69"}, "closed": true, "closedAt": "2020-06-23T15:12:25Z", "author": {"login": "NathanQingyangXu"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABchjNjkAFqTQxMjcxNDUzNQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcmu5O2gBqjMzOTA4MDAzMDk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyNzE0NTM1", "url": "https://github.com/hibernate/hibernate-orm/pull/3402#pullrequestreview-412714535", "createdAt": "2020-05-15T14:47:04Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxNDo0NzowNFrOGWH-Kg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxNDo0NzowNFrOGWH-Kg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTg1MjQ1OA==", "bodyText": "The above string concatenation will incur performance cost invariably even though trace logging level is disabled", "url": "https://github.com/hibernate/hibernate-orm/pull/3402#discussion_r425852458", "createdAt": "2020-05-15T14:47:04Z", "author": {"login": "NathanQingyangXu"}, "path": "hibernate-core/src/main/java/org/hibernate/boot/archive/internal/ArchiveHelper.java", "diffHunk": "@@ -93,7 +93,7 @@ else if ( \"zip\".equals( protocol )\n \t\t\t\t\t\"Unable to determine JAR Url from \" + url + \". Cause: \" + e.getMessage()\n \t\t\t);\n \t\t}\n-\t\tlog.trace( \"JAR URL from URL Entry: \" + url + \" >> \" + jarUrl );", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyNzE2NTgy", "url": "https://github.com/hibernate/hibernate-orm/pull/3402#pullrequestreview-412716582", "createdAt": "2020-05-15T14:49:21Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxNDo0OToyMVrOGWIETA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxNDo0OToyMVrOGWIETA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTg1NDAyOA==", "bodyText": "I added logging level checking whenever the method invoking is involved. We never know how much performance cost will be paid for future coding might provide an overridden heavy weight method implementation. Adding logging level checking is simple and future proof.", "url": "https://github.com/hibernate/hibernate-orm/pull/3402#discussion_r425854028", "createdAt": "2020-05-15T14:49:21Z", "author": {"login": "NathanQingyangXu"}, "path": "hibernate-core/src/main/java/org/hibernate/boot/archive/internal/StandardArchiveDescriptorFactory.java", "diffHunk": "@@ -130,12 +130,14 @@ public URL adjustJarFileEntryUrl(URL url, URL rootUrl) {\n \t\t\t}\n \t\t\tcatch (MalformedURLException e) {\n \t\t\t\t// allow to pass through to return the original URL\n-\t\t\t\tlog.debugf(\n-\t\t\t\t\t\te,\n-\t\t\t\t\t\t\"Unable to adjust relative <jar-file/> URL [%s] relative to root URL [%s]\",\n-\t\t\t\t\t\tfilePart,\n-\t\t\t\t\t\trootUrlFile.getAbsolutePath()\n-\t\t\t\t);\n+\t\t\t\tif ( log.isDebugEnabled() ) {\n+\t\t\t\t\tlog.debugf(\n+\t\t\t\t\t\t\te,\n+\t\t\t\t\t\t\t\"Unable to adjust relative <jar-file/> URL [%s] relative to root URL [%s]\",\n+\t\t\t\t\t\t\tfilePart,\n+\t\t\t\t\t\t\trootUrlFile.getAbsolutePath()", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyNzE4Nzcw", "url": "https://github.com/hibernate/hibernate-orm/pull/3402#pullrequestreview-412718770", "createdAt": "2020-05-15T14:51:56Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxNDo1MTo1N1rOGWIKug==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxNDo1MTo1N1rOGWIKug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTg1NTY3NA==", "bodyText": "The above pattern has two drawbacks:\n\nunnecessary string concatenation cost even the produced string is simply discarded later due to level disabling\nthe produced string might contain magic chars (i.e. %s) and will explode during runtime", "url": "https://github.com/hibernate/hibernate-orm/pull/3402#discussion_r425855674", "createdAt": "2020-05-15T14:51:57Z", "author": {"login": "NathanQingyangXu"}, "path": "hibernate-core/src/main/java/org/hibernate/boot/model/source/internal/hbm/ModelBinder.java", "diffHunk": "@@ -4221,7 +4227,7 @@ public void addAttributeBinding(Property attributeBinding) {\n \n \t\t@Override\n \t\tpublic void process() {\n-\t\t\tlog.debugf( \"Binding natural-id UniqueKey for entity : \" + entityBinding.getEntityName() );", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 59}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyNzIxODM1", "url": "https://github.com/hibernate/hibernate-orm/pull/3402#pullrequestreview-412721835", "createdAt": "2020-05-15T14:55:24Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxNDo1NToyNFrOGWIT_A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNVQxNDo1NToyNFrOGWIT_A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTg1ODA0NA==", "bodyText": "It is still a common bug to miss format parameter. I tried the Checker Framework (https://checkerframework.org/) but it crashed when I used it on hibernate-orm, :(.", "url": "https://github.com/hibernate/hibernate-orm/pull/3402#discussion_r425858044", "createdAt": "2020-05-15T14:55:24Z", "author": {"login": "NathanQingyangXu"}, "path": "hibernate-core/src/main/java/org/hibernate/resource/beans/container/internal/JpaCompliantLifecycleStrategy.java", "diffHunk": "@@ -125,7 +125,7 @@ public void initialize() {\n \t\t\t\tthrow e;\n \t\t\t}\n \t\t\tcatch (Exception e) {\n-\t\t\t\tlog.debugf( \"Error resolving CDI bean [%s] - using fallback\" );\n+\t\t\t\tlog.debugf( \"Error resolving CDI bean [%s] - using fallback\", beanType.getName() );", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "be85c2479a898f8ec09e9f64dcb385894ca7204a", "author": {"user": {"login": "NathanQingyangXu", "name": "Nathan Xu"}}, "url": "https://github.com/hibernate/hibernate-orm/commit/be85c2479a898f8ec09e9f64dcb385894ca7204a", "committedDate": "2020-05-31T17:12:45Z", "message": "fix some logging performance issues"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "be85c2479a898f8ec09e9f64dcb385894ca7204a", "author": {"user": {"login": "NathanQingyangXu", "name": "Nathan Xu"}}, "url": "https://github.com/hibernate/hibernate-orm/commit/be85c2479a898f8ec09e9f64dcb385894ca7204a", "committedDate": "2020-05-31T17:12:45Z", "message": "fix some logging performance issues"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3092, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}