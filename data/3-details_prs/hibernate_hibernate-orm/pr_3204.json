{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY5NjAzNDc3", "number": 3204, "title": "Log usage of deprecated Dialect classes", "bodyText": "The database-version-specific dialects are now @Deprecated. So produce a log message to this effect.", "createdAt": "2020-01-31T14:18:23Z", "url": "https://github.com/hibernate/hibernate-orm/pull/3204", "merged": true, "mergeCommit": {"oid": "1503f09a411f162e62894693d5500b4feb6dbf9e"}, "closed": true, "closedAt": "2020-02-19T14:57:05Z", "author": {"login": "gavinking"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb_xli9gFqTM1MTYxMzY1Ng==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcF3zowgFqTM2MTE4MTEyMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxNjEzNjU2", "url": "https://github.com/hibernate/hibernate-orm/pull/3204#pullrequestreview-351613656", "createdAt": "2020-01-31T16:14:40Z", "commit": null, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQxNjoxNDo0MVrOFkQW8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQxNjoxNjoxNVrOFkQaBg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzU2MTA3Mg==", "bodyText": "This is against the Quarkus mandate that thou shall not read annotations at runtime.  Just saying", "url": "https://github.com/hibernate/hibernate-orm/pull/3204#discussion_r373561072", "createdAt": "2020-01-31T16:14:41Z", "author": {"login": "sebersole"}, "path": "hibernate-core/src/main/java/org/hibernate/dialect/Dialect.java", "diffHunk": "@@ -225,6 +225,22 @@ protected Dialect() {\n \t\tdefaultSizeStrategy = new DefaultSizeStrategyImpl();\n \t}\n \n+\tprivate void logDeprecation() {\n+\t\tLOG.usingDialect( this );\n+\n+\t\tClass<? extends Dialect> dialect = getClass();\n+\t\tif ( dialect.isAnnotationPresent(Deprecated.class) ) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzU2MTg2Mg==", "bodyText": "I don't think the separate method does anything here; just move that code inline.  Or at least name the method better - it does not just log deprecations", "url": "https://github.com/hibernate/hibernate-orm/pull/3204#discussion_r373561862", "createdAt": "2020-01-31T16:16:15Z", "author": {"login": "sebersole"}, "path": "hibernate-core/src/main/java/org/hibernate/dialect/Dialect.java", "diffHunk": "@@ -136,7 +136,7 @@\n \t// constructors and factory methods ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n \n \tprotected Dialect() {\n-\t\tLOG.usingDialect( this );\n+\t\tlogDeprecation();", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxNjU4MDIz", "url": "https://github.com/hibernate/hibernate-orm/pull/3204#pullrequestreview-351658023", "createdAt": "2020-01-31T17:25:29Z", "commit": null, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQxNzoyNToyOVrOFkSYVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQxNzoyNToyOVrOFkSYVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzU5NDE5OA==", "bodyText": "I'm surprised this even compiles for you. These ids need to be unique.  The JBoss Logging AP checks that during compile", "url": "https://github.com/hibernate/hibernate-orm/pull/3204#discussion_r373594198", "createdAt": "2020-01-31T17:25:29Z", "author": {"login": "sebersole"}, "path": "hibernate-core/src/main/java/org/hibernate/internal/log/DeprecationLogger.java", "diffHunk": "@@ -249,4 +249,15 @@ void connectionProviderClassDeprecated(\n \t\t\t\t\t\"5.3 in upgrading.  It will be removed in a later version.\"\n \t)\n \tvoid logUseOfDeprecatedZeroBasedJdbcStyleParams();\n+\n+\t@LogMessage(level = WARN)\n+\t@Message(value = \"%s has been deprecated\",\n+\t\t\tid = 90000025)\n+\tvoid deprecatedDialect(String dialect);\n+\n+\t@LogMessage(level = WARN)\n+\t@Message(value = \"%s has been deprecated; use %s instead\",\n+\t\t\tid = 90000025)", "state": "SUBMITTED", "replyTo": null, "originalCommit": null, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5ee450e9af5f5a1b4aa75736f84bd7a22cecb1ab", "author": {"user": {"login": "gavinking", "name": "Gavin King"}}, "url": "https://github.com/hibernate/hibernate-orm/commit/5ee450e9af5f5a1b4aa75736f84bd7a22cecb1ab", "committedDate": "2020-01-31T20:56:37Z", "message": "Log usage of deprecated Dialect classes using DeprecationLogger\n\nWe want people to stop using the ones annotated @Deprecated."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "5ee450e9af5f5a1b4aa75736f84bd7a22cecb1ab", "author": {"user": {"login": "gavinking", "name": "Gavin King"}}, "url": "https://github.com/hibernate/hibernate-orm/commit/5ee450e9af5f5a1b4aa75736f84bd7a22cecb1ab", "committedDate": "2020-01-31T20:56:37Z", "message": "Log usage of deprecated Dialect classes using DeprecationLogger\n\nWe want people to stop using the ones annotated @Deprecated."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzYxMTgxMTIx", "url": "https://github.com/hibernate/hibernate-orm/pull/3204#pullrequestreview-361181121", "createdAt": "2020-02-19T14:56:53Z", "commit": {"oid": "5ee450e9af5f5a1b4aa75736f84bd7a22cecb1ab"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3284, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}