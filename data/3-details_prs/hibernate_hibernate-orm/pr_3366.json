{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA3NTA0NDI5", "number": 3366, "title": "wip/6.0 implement @Where and @WhereJoinTable", "bodyText": "https://trello.com/c/lF9R13J3/115-where-and-wherejointable\nSo @Where and @WhereJoinTable belongs to the same filter umbrella, together with @Filter and @FilterJoinTable. We simply generalize existing implementation to accommodate it easily.", "createdAt": "2020-04-22T19:44:47Z", "url": "https://github.com/hibernate/hibernate-orm/pull/3366", "merged": true, "mergeCommit": {"oid": "9ef62f1fb89484a3f067a6de01c22dbd5cf38a37"}, "closed": true, "closedAt": "2020-04-24T18:23:38Z", "author": {"login": "NathanQingyangXu"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcacW9cAH2gAyNDA3NTA0NDI5OjMzNmQzZDczOWUxM2RlMjJlZjIxNzIyYWY0ZGU2MGFkMzlmNWQ1Yjg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcace3TAFqTM5OTA3MzIzOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "336d3d739e13de22ef21722af4de60ad39f5d5b8", "author": {"user": {"login": "NathanQingyangXu", "name": "Nathan Xu"}}, "url": "https://github.com/hibernate/hibernate-orm/commit/336d3d739e13de22ef21722af4de60ad39f5d5b8", "committedDate": "2020-04-23T12:50:32Z", "message": "implement @where and @whereJoinTable"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "336d3d739e13de22ef21722af4de60ad39f5d5b8", "author": {"user": {"login": "NathanQingyangXu", "name": "Nathan Xu"}}, "url": "https://github.com/hibernate/hibernate-orm/commit/336d3d739e13de22ef21722af4de60ad39f5d5b8", "committedDate": "2020-04-23T12:50:32Z", "message": "implement @where and @whereJoinTable"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5MDY4MTQ0", "url": "https://github.com/hibernate/hibernate-orm/pull/3366#pullrequestreview-399068144", "createdAt": "2020-04-23T12:53:02Z", "commit": {"oid": "336d3d739e13de22ef21722af4de60ad39f5d5b8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QxMjo1MzowMlrOGKnusw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QxMjo1MzowMlrOGKnusw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzc4OTg3NQ==", "bodyText": "The above code change is to revert back erroneous changes in some previous PR.", "url": "https://github.com/hibernate/hibernate-orm/pull/3366#discussion_r413789875", "createdAt": "2020-04-23T12:53:02Z", "author": {"login": "NathanQingyangXu"}, "path": "hibernate-core/src/main/java/org/hibernate/cfg/annotations/CollectionBinder.java", "diffHunk": "@@ -990,7 +990,7 @@ private void bindFilters(boolean hasAssociationTable) {\n \t\tif ( filterJoinTables != null ) {\n \t\t\tfor (FilterJoinTable filter : filterJoinTables.value()) {\n \t\t\t\tif ( hasAssociationTable ) {\n-\t\t\t\t\tcollection.addManyToManyFilter(filter.name(), filter.condition(),\n+\t\t\t\t\tcollection.addFilter(filter.name(), filter.condition(),\n \t\t\t\t\t\t\tfilter.deduceAliasInjectionPoints(),\n \t\t\t\t\t\t\ttoAliasTableMap(filter.aliases()), toAliasEntityMap(filter.aliases()));\n \t\t\t\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "336d3d739e13de22ef21722af4de60ad39f5d5b8"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk5MDczMjM4", "url": "https://github.com/hibernate/hibernate-orm/pull/3366#pullrequestreview-399073238", "createdAt": "2020-04-23T12:59:09Z", "commit": {"oid": "336d3d739e13de22ef21722af4de60ad39f5d5b8"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QxMjo1OTowOVrOGKn_3g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yM1QxMjo1OTowOVrOGKn_3g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzc5NDI3MA==", "bodyText": "The above change is simply to get rid of if ( loadQueryInfluencers.hasEnabledFilters() ) { for it will add @Where and @WhereJoinTable filter content as well. This is the gist of this PR.", "url": "https://github.com/hibernate/hibernate-orm/pull/3366#discussion_r413794270", "createdAt": "2020-04-23T12:59:09Z", "author": {"login": "NathanQingyangXu"}, "path": "hibernate-core/src/main/java/org/hibernate/loader/ast/internal/LoaderSelectBuilder.java", "diffHunk": "@@ -380,22 +381,20 @@ private void applyKeyRestriction(\n \t}\n \n \tprivate void applyFiltering(QuerySpec querySpec, TableGroup tableGroup, PluralAttributeMapping pluralAttributeMapping) {\n-\t\tif ( loadQueryInfluencers.hasEnabledFilters() ) {\n-\t\t\tfinal Joinable joinable = pluralAttributeMapping\n-\t\t\t\t\t.getCollectionDescriptor()\n-\t\t\t\t\t.getCollectionType()\n-\t\t\t\t\t.getAssociatedJoinable( creationContext.getSessionFactory() );\n-\t\t\tassert joinable instanceof AbstractCollectionPersister;\n-\t\t\tfinal String tableExpression = joinable.getTableName();\n-\t\t\tfinal String tableAlias = tableGroup.resolveTableReference( tableExpression ).getIdentificationVariable();\n-\t\t\tfinal Predicate filterPredicate = FilterHelper.createFilterPredicate(\n-\t\t\t\t\tloadQueryInfluencers,\n-\t\t\t\t\tjoinable,\n-\t\t\t\t\ttableAlias\n-\t\t\t);\n-\t\t\tif ( filterPredicate != null ) {\n-\t\t\t\tquerySpec.applyPredicate( filterPredicate );\n-\t\t\t}\n+\t\tfinal Joinable joinable = pluralAttributeMapping\n+\t\t\t\t.getCollectionDescriptor()\n+\t\t\t\t.getCollectionType()\n+\t\t\t\t.getAssociatedJoinable( creationContext.getSessionFactory() );\n+\t\tassert joinable instanceof AbstractCollectionPersister;\n+\t\tfinal String tableExpression = joinable.getTableName();\n+\t\tfinal String tableAlias = tableGroup.resolveTableReference( tableExpression ).getIdentificationVariable();\n+\t\tfinal Predicate filterPredicate = FilterHelper.createFilterPredicate(\n+\t\t\t\tloadQueryInfluencers,\n+\t\t\t\tjoinable,\n+\t\t\t\ttableAlias\n+\t\t);\n+\t\tif ( filterPredicate != null ) {\n+\t\t\tquerySpec.applyPredicate( filterPredicate );", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "336d3d739e13de22ef21722af4de60ad39f5d5b8"}, "originalPosition": 58}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3055, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}