{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU4NDYyMDM1", "number": 3484, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxNDo0NToyNVrOETSe8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxNTo1NTowMFrOETUajQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4NjYxMjM0OnYy", "diffSide": "RIGHT", "path": "hibernate-core/src/main/java/org/hibernate/loader/Loader.java", "isResolved": false, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxNDo0NToyNVrOG47_bA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxOTo0ODo0OVrOG5HnNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjM1NjMzMg==", "bodyText": "It seems a good catch. I am the community developer who implemented 'fetch graph' in v5. Also I implemented entity graph fully in v6. Yeah, I agree. The current implementation is buggy and difficult to maintain. That is because v5 infrastructure and design makes it difficult to implement and that is why 'fetch graph' was not implemented for a long time. The status has been changed in v6 and I think we have implemented the whole entity graph elegantly there already.\nI would take a look at the PR and thanks for the two options to choose from. However, I am community contributor and have very limited free cycles out of my daily job. Seems an endless fixing of entity graph in v5, :(.", "url": "https://github.com/hibernate/hibernate-orm/pull/3484#discussion_r462356332", "createdAt": "2020-07-29T14:45:25Z", "author": {"login": "NathanQingyangXu"}, "path": "hibernate-core/src/main/java/org/hibernate/loader/Loader.java", "diffHunk": "@@ -68,6 +68,7 @@\n import org.hibernate.event.spi.PostLoadEvent;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ea5825bc943796305f873548b0c92b81046a4b50"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjM1ODAzNA==", "bodyText": "Right, I also noticed that a better solution to handle fetch graphs would require very significant changes to ORM 5. That's why I didn't even try :)", "url": "https://github.com/hibernate/hibernate-orm/pull/3484#discussion_r462358034", "createdAt": "2020-07-29T14:47:40Z", "author": {"login": "yrodiere"}, "path": "hibernate-core/src/main/java/org/hibernate/loader/Loader.java", "diffHunk": "@@ -68,6 +68,7 @@\n import org.hibernate.event.spi.PostLoadEvent;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjM1NjMzMg=="}, "originalCommit": {"oid": "ea5825bc943796305f873548b0c92b81046a4b50"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjM2MjcwMQ==", "bodyText": "I would prefer non-intrusive approach to fix the issue without much performance cost. The improvement in v6 is we have complete access to the navigation role path of the entity to be loaded. There might be such role info already in TwoPhaseLoad, though no time to investigate. Another concern is to avoid merging the PR into v6 for the entity graph implementation is totally changed (TwoPhaseLoad is phased out in v6 as well) so the more centralized code changes, the better.", "url": "https://github.com/hibernate/hibernate-orm/pull/3484#discussion_r462362701", "createdAt": "2020-07-29T14:53:54Z", "author": {"login": "NathanQingyangXu"}, "path": "hibernate-core/src/main/java/org/hibernate/loader/Loader.java", "diffHunk": "@@ -68,6 +68,7 @@\n import org.hibernate.event.spi.PostLoadEvent;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjM1NjMzMg=="}, "originalCommit": {"oid": "ea5825bc943796305f873548b0c92b81046a4b50"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjM3Mjg2Mg==", "bodyText": "Would you mind my creating another PR if I can solve the issue without changing Loader or creating any new data structure (reusing existing info instead)? Not necessarily possible. Just in case.", "url": "https://github.com/hibernate/hibernate-orm/pull/3484#discussion_r462372862", "createdAt": "2020-07-29T15:07:18Z", "author": {"login": "NathanQingyangXu"}, "path": "hibernate-core/src/main/java/org/hibernate/loader/Loader.java", "diffHunk": "@@ -68,6 +68,7 @@\n import org.hibernate.event.spi.PostLoadEvent;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjM1NjMzMg=="}, "originalCommit": {"oid": "ea5825bc943796305f873548b0c92b81046a4b50"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjQxODE0OQ==", "bodyText": "I wouldn't mind as long as my tests still pass, but I'd rather you create another ticket and a follow-up PR if you want to make more changes to address more problems. You know, one step at a time.\nI also think it might not be the best use of your time, since 6.0 is the future, but that's your time :)", "url": "https://github.com/hibernate/hibernate-orm/pull/3484#discussion_r462418149", "createdAt": "2020-07-29T16:10:21Z", "author": {"login": "yrodiere"}, "path": "hibernate-core/src/main/java/org/hibernate/loader/Loader.java", "diffHunk": "@@ -68,6 +68,7 @@\n import org.hibernate.event.spi.PostLoadEvent;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjM1NjMzMg=="}, "originalCommit": {"oid": "ea5825bc943796305f873548b0c92b81046a4b50"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjU0Njc0MA==", "bodyText": "I tried to create my PR but failed. Especially there is no way to even know some hydrated object is of root entity or not (the relationship among them is totally lost in TwoPhaseLoad class). Seems no better way to solve the issue. Great job and thanks a ton.", "url": "https://github.com/hibernate/hibernate-orm/pull/3484#discussion_r462546740", "createdAt": "2020-07-29T19:48:49Z", "author": {"login": "NathanQingyangXu"}, "path": "hibernate-core/src/main/java/org/hibernate/loader/Loader.java", "diffHunk": "@@ -68,6 +68,7 @@\n import org.hibernate.event.spi.PostLoadEvent;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjM1NjMzMg=="}, "originalCommit": {"oid": "ea5825bc943796305f873548b0c92b81046a4b50"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg4NjkyODc3OnYy", "diffSide": "RIGHT", "path": "hibernate-core/src/main/java/org/hibernate/loader/Loader.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxNTo1NTowMFrOG4_G4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOVQxNzoxMjowNFrOG5CF8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjQwNzM5Mw==", "bodyText": "Did you conduct some MPH benchmark comparison to justify the hack? It would be great to avoid such hack for the entity graph implementation logic has been so difficult to understand and maintain.", "url": "https://github.com/hibernate/hibernate-orm/pull/3484#discussion_r462407393", "createdAt": "2020-07-29T15:55:00Z", "author": {"login": "NathanQingyangXu"}, "path": "hibernate-core/src/main/java/org/hibernate/loader/Loader.java", "diffHunk": "@@ -1215,8 +1242,13 @@ private void initializeEntitiesAndCollections(\n \t\t\t}\n \t\t}\n \n-\t\tif ( hydratedObjects != null ) {\n-\t\t\tfor ( Object hydratedObject : hydratedObjects ) {\n+\t\tif ( nullSeparatedHydratedObjects != null ) {\n+\t\t\tfor ( Object hydratedObject : nullSeparatedHydratedObjects ) {\n+\t\t\t\tif ( hydratedObject == null ) {\n+\t\t\t\t\t// This is a hack to signal that we're starting to process a new row\n+\t\t\t\t\t// Ignore\n+\t\t\t\t\tcontinue;\n+\t\t\t\t}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ea5825bc943796305f873548b0c92b81046a4b50"}, "originalPosition": 222}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjQxNjI1MQ==", "bodyText": "I did not. I'm just considering that keeping the same data structure (a List) and adding a few elements is less change than moving to a List<List<?>>. I'm not saying it's the same, mind you. Just that it's the closest I can get.", "url": "https://github.com/hibernate/hibernate-orm/pull/3484#discussion_r462416251", "createdAt": "2020-07-29T16:07:43Z", "author": {"login": "yrodiere"}, "path": "hibernate-core/src/main/java/org/hibernate/loader/Loader.java", "diffHunk": "@@ -1215,8 +1242,13 @@ private void initializeEntitiesAndCollections(\n \t\t\t}\n \t\t}\n \n-\t\tif ( hydratedObjects != null ) {\n-\t\t\tfor ( Object hydratedObject : hydratedObjects ) {\n+\t\tif ( nullSeparatedHydratedObjects != null ) {\n+\t\t\tfor ( Object hydratedObject : nullSeparatedHydratedObjects ) {\n+\t\t\t\tif ( hydratedObject == null ) {\n+\t\t\t\t\t// This is a hack to signal that we're starting to process a new row\n+\t\t\t\t\t// Ignore\n+\t\t\t\t\tcontinue;\n+\t\t\t\t}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjQwNzM5Mw=="}, "originalCommit": {"oid": "ea5825bc943796305f873548b0c92b81046a4b50"}, "originalPosition": 222}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjQ1NjMwNQ==", "bodyText": "I am not against such hack as long as it turns out to be the hot spot. Also, the fetch graph impl in v5 has been based on hack already. Overall the PR looks good from a quick review. I might focus on it more later in my off hours to finalize the review. Thanks for the bug reporting and quick fixing.", "url": "https://github.com/hibernate/hibernate-orm/pull/3484#discussion_r462456305", "createdAt": "2020-07-29T17:12:04Z", "author": {"login": "NathanQingyangXu"}, "path": "hibernate-core/src/main/java/org/hibernate/loader/Loader.java", "diffHunk": "@@ -1215,8 +1242,13 @@ private void initializeEntitiesAndCollections(\n \t\t\t}\n \t\t}\n \n-\t\tif ( hydratedObjects != null ) {\n-\t\t\tfor ( Object hydratedObject : hydratedObjects ) {\n+\t\tif ( nullSeparatedHydratedObjects != null ) {\n+\t\t\tfor ( Object hydratedObject : nullSeparatedHydratedObjects ) {\n+\t\t\t\tif ( hydratedObject == null ) {\n+\t\t\t\t\t// This is a hack to signal that we're starting to process a new row\n+\t\t\t\t\t// Ignore\n+\t\t\t\t\tcontinue;\n+\t\t\t\t}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjQwNzM5Mw=="}, "originalCommit": {"oid": "ea5825bc943796305f873548b0c92b81046a4b50"}, "originalPosition": 222}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4131, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}