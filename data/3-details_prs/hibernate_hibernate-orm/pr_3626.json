{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE3ODg5ODI0", "number": 3626, "title": "HHH-14315 Upgrade to Gradle 6.7 and use toolchains for per-JDK builds", "bodyText": "https://hibernate.atlassian.net/browse/HHH-14315\nAfter this PR, we will need a few change in our CI jobs, and then we will be able to test JDK16 (spoiler alert: it works).\nThis introduces similar changes to hibernate/hibernate-reactive#429.\nBy default, nothing changes, except that we now use Gradle 6.7.\nWhen specific options are enabled:\n\nWe run Gradle with JDK8\nWe compile the project with JDK 8\nWe run the tests with a separate JVM version 11, 15 or 16.\n\nDifferent configurations are also possible, e.g. run Gradle with JDK11, compile with JDK8 and run the tests with JDK15. But the one above is the most interesting and most likely the one we'll use.\n@Sanne I think that, considering you need specific options to enable toolchains, we can safely backport to 5.4?", "createdAt": "2020-11-09T16:37:58Z", "url": "https://github.com/hibernate/hibernate-orm/pull/3626", "merged": true, "mergeCommit": {"oid": "2be511e61516853424c44ce46567b256b7ccc692"}, "closed": true, "closedAt": "2020-11-10T11:02:09Z", "author": {"login": "yrodiere"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdbEYX7AH2gAyNTE3ODg5ODI0OmU1NmNlOTRmMmM0ODg2NDc5NjU0ZTg4ZDJmYjQ3ZGY3MjU1N2Q1MTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdbHJQPAFqTUyNzA4MDk5Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e56ce94f2c4886479654e88d2fb47df72557d514", "author": {"user": {"login": "yrodiere", "name": "Yoann Rodi\u00e8re"}}, "url": "https://github.com/hibernate/hibernate-orm/commit/e56ce94f2c4886479654e88d2fb47df72557d514", "committedDate": "2020-11-10T07:39:26Z", "message": "HHH-14315 Upgrade to Gradle 6.7\n\nSigned-off-by: Yoann Rodi\u00e8re <yoann@hibernate.org>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "95f482146983471ad4aa6c9c098b162963a10949", "author": {"user": {"login": "yrodiere", "name": "Yoann Rodi\u00e8re"}}, "url": "https://github.com/hibernate/hibernate-orm/commit/95f482146983471ad4aa6c9c098b162963a10949", "committedDate": "2020-11-10T07:39:26Z", "message": "HHH-14315 Add optional support for toolchains to the Gradle build\n\nSigned-off-by: Yoann Rodi\u00e8re <yoann@hibernate.org>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "73d0801a7aebcff105855477e81e160e745376b0", "author": {"user": {"login": "yrodiere", "name": "Yoann Rodi\u00e8re"}}, "url": "https://github.com/hibernate/hibernate-orm/commit/73d0801a7aebcff105855477e81e160e745376b0", "committedDate": "2020-11-10T07:39:26Z", "message": "HHH-14315 Force JVM options when using toolchains\n\nApparently Gradle won't just use the same options as in its own JVM.\n\nSigned-off-by: Yoann Rodi\u00e8re <yoann@hibernate.org>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": null, "afterCommit": {"oid": "73d0801a7aebcff105855477e81e160e745376b0", "author": {"user": {"login": "yrodiere", "name": "Yoann Rodi\u00e8re"}}, "url": "https://github.com/hibernate/hibernate-orm/commit/73d0801a7aebcff105855477e81e160e745376b0", "committedDate": "2020-11-10T07:39:26Z", "message": "HHH-14315 Force JVM options when using toolchains\n\nApparently Gradle won't just use the same options as in its own JVM.\n\nSigned-off-by: Yoann Rodi\u00e8re <yoann@hibernate.org>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4182ec5d55479c075f2d2d00cca0cc26828cf070", "author": {"user": {"login": "yrodiere", "name": "Yoann Rodi\u00e8re"}}, "url": "https://github.com/hibernate/hibernate-orm/commit/4182ec5d55479c075f2d2d00cca0cc26828cf070", "committedDate": "2020-11-10T10:10:03Z", "message": "HHH-14315 Upgrade Travis build to OpenJDK 11.0.9\n\nFor some reason the gradle build gets stuck at task\n:hibernate-core:compileTestJava when using OpenJDK 11.0.3.\nI can't reproduce the problem with 11.0.9, though, so it's probably a\nbug in OpenJDK 11.0.3.\n\nSigned-off-by: Yoann Rodi\u00e8re <yoann@hibernate.org>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3MDc5Mzg1", "url": "https://github.com/hibernate/hibernate-orm/pull/3626#pullrequestreview-527079385", "createdAt": "2020-11-10T10:50:34Z", "commit": {"oid": "4182ec5d55479c075f2d2d00cca0cc26828cf070"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxMDo1MDozNVrOHwW2Ww==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxMDo1MDozNVrOHwW2Ww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDQ2ODA1OQ==", "bodyText": "just wondering, was it necessary to remove these?", "url": "https://github.com/hibernate/hibernate-orm/pull/3626#discussion_r520468059", "createdAt": "2020-11-10T10:50:35Z", "author": {"login": "Sanne"}, "path": "gradle/java-module.gradle", "diffHunk": "@@ -112,17 +112,72 @@ dependencies {\n \n tasks.withType( JavaCompile ) {\n \toptions.encoding = 'UTF-8'\n-\tsourceCompatibility = project.baselineJavaVersion", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4182ec5d55479c075f2d2d00cca0cc26828cf070"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3MDgwNjc0", "url": "https://github.com/hibernate/hibernate-orm/pull/3626#pullrequestreview-527080674", "createdAt": "2020-11-10T10:52:12Z", "commit": {"oid": "4182ec5d55479c075f2d2d00cca0cc26828cf070"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxMDo1MjoxM1rOHwW6mA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxMDo1MjoxM1rOHwW6mA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDQ2OTE0NA==", "bodyText": "hu?? Have a pointer about what kinds of things it needs doing?", "url": "https://github.com/hibernate/hibernate-orm/pull/3626#discussion_r520469144", "createdAt": "2020-11-10T10:52:13Z", "author": {"login": "Sanne"}, "path": "settings.gradle", "diffHunk": "@@ -13,35 +13,79 @@ if ( !JavaVersion.current().java8Compatible ) {\n     throw new GradleException( \"Gradle must be run with Java 8 or later\" )\n }\n \n-// Consume the property 'testedJavaVersion' here and\n-// set it on gradle.ext so that we can inspect the result in build.gradle.\n-// We wouldn't be able to do that if we consumed\n-// the property in base-information.gradle and set it on project.ext.\n-\n-if ( hasProperty( 'testedJavaVersion' ) ) {\n-    logger.warn( \"[WARN] Targeting Java version '$testedJavaVersion' in tests.\" )\n-    gradle.ext.testedJavaVersion = testedJavaVersion\n-    gradle.ext.testedJavaVersionAsEnum = JavaVersion.toVersion( testedJavaVersion )\n-}\n-else {\n-    // We will simply use Gradle's JDK for compilation, tests and javadoc generation.\n-    def major\n-    if ( JavaVersion.current() == JavaVersion.VERSION_HIGHER) {\n-        logger.warn( \"Gradle does not support this JDK, because it is too recent; build is likely to fail.\" +\n-                \" To avoid failures, you should specify an older Java version in the 'testedJavaVersion' parameter.\" +\n-                \" Just append the following to your gradle command:\" +\n-                \" '-PtestedJavaVersion=<major version of your newer JDK, e.g. 14>'\" )\n-        // Use a hack to retrieve the major as a string.\n-        // This only works for Java 9+ (we're at least on Java 18 here).\n-        gradle.ext.testedJavaVersion = System.getProperty( 'java.specification.version' )\n+gradle.ext.baselineJavaVersion = JavaLanguageVersion.of( 8 )\n+\n+// Gradle does bytecode transformation on tests.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4182ec5d55479c075f2d2d00cca0cc26828cf070"}, "originalPosition": 27}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3MDgwOTk3", "url": "https://github.com/hibernate/hibernate-orm/pull/3626#pullrequestreview-527080997", "createdAt": "2020-11-10T10:52:38Z", "commit": {"oid": "4182ec5d55479c075f2d2d00cca0cc26828cf070"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2772, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}