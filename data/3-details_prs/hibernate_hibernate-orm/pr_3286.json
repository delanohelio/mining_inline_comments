{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg1MDgwMDU1", "number": 3286, "title": "HHH-13891 : ProxyFactory should not be built if any ID or property getter/setter methods are final", "bodyText": "https://hibernate.atlassian.net/browse/HHH-13891", "createdAt": "2020-03-07T00:55:08Z", "url": "https://github.com/hibernate/hibernate-orm/pull/3286", "merged": true, "mergeCommit": {"oid": "a54d657d98795e88b5541b9aa05a4621c9f5f1b5"}, "closed": true, "closedAt": "2020-03-26T01:36:06Z", "author": {"login": "gbadner"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcLJ3CxgH2gAyMzg1MDgwMDU1OjE0YWI0NjY2M2I2ZDA3Y2JiNDM5MjE2ODRjYWNhMDhmZTBiMGYwZGQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcRCmqVAFqTM4MDkxMzU4Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "14ab46663b6d07cbb43921684caca08fe0b0f0dd", "author": {"user": {"login": "gbadner", "name": null}}, "url": "https://github.com/hibernate/hibernate-orm/commit/14ab46663b6d07cbb43921684caca08fe0b0f0dd", "committedDate": "2020-03-07T00:48:31Z", "message": "HHH-13891 : Added test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c48caafadbf0c8fbba17871ed96307091cc4b966", "author": {"user": {"login": "gbadner", "name": null}}, "url": "https://github.com/hibernate/hibernate-orm/commit/c48caafadbf0c8fbba17871ed96307091cc4b966", "committedDate": "2020-03-07T00:50:21Z", "message": "HHH-13891 : ProxyFactory should not be built if any ID or property getter/setter methods are final"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcwODUwMzgw", "url": "https://github.com/hibernate/hibernate-orm/pull/3286#pullrequestreview-370850380", "createdAt": "2020-03-08T18:54:40Z", "commit": {"oid": "c48caafadbf0c8fbba17871ed96307091cc4b966"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOFQxODo1NDo0MFrOFzW0TQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOFQxODo1NDo0MFrOFzW0TQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTM5NTUzMw==", "bodyText": "It seems getterOrSetter parameter is not necessary for we can get that information if we refactor the method to accept either Getter or Setter only. For instance\nprivate static void validateGetterSetterMethodProxyability(Object getterOrSetter ) {\n                String methodCategory = getterOrSetter instanceof Getter ? \"Getter\" : \"Setter\";\n                Method method = getterOrSetter instanceof Getter ? Getter.class.cast(getterOrSetter).getMethod(): Setter.class.cast(getterOrSetter).getMethod();\n\t\tif ( method != null && Modifier.isFinal( method.getModifiers() ) ) {\n\t\t\tthrow new HibernateException(\n\t\t\t\t\tString.format(\n\t\t\t\t\t\t\t\"%s methods of lazy classes cannot be final: %s#%s\",\n\t\t\t\t\t\t\tmethodCategory,\n\t\t\t\t\t\t\tmethod.getDeclaringClass().getName(),\n\t\t\t\t\t\t\tmethod.getName()\n\t\t\t\t\t)\n\t\t\t);\n\nI also changed the visibility from public to private above. If Getter and Setter shared some common interface (like methodAware), it would be more elegant and straightforward.\nnot a big deal for sure and feel free to ignore my comment.", "url": "https://github.com/hibernate/hibernate-orm/pull/3286#discussion_r389395533", "createdAt": "2020-03-08T18:54:40Z", "author": {"login": "NathanQingyangXu"}, "path": "hibernate-core/src/main/java/org/hibernate/proxy/pojo/ProxyFactoryHelper.java", "diffHunk": "@@ -84,14 +85,21 @@ public static void validateProxyability(final PersistentClass persistentClass) {\n \t\tClass clazz = persistentClass.getMappedClass();\n \t\twhile ( properties.hasNext() ) {\n \t\t\tProperty property = (Property) properties.next();\n-\t\t\tMethod method = property.getGetter( clazz ).getMethod();\n-\t\t\tif ( method != null && Modifier.isFinal( method.getModifiers() ) ) {\n-\t\t\t\tLOG.gettersOfLazyClassesCannotBeFinal( persistentClass.getEntityName(), property.getName() );\n-\t\t\t}\n-\t\t\tmethod = property.getSetter( clazz ).getMethod();\n-\t\t\tif ( method != null && Modifier.isFinal( method.getModifiers() ) ) {\n-\t\t\t\tLOG.settersOfLazyClassesCannotBeFinal( persistentClass.getEntityName(), property.getName() );\n-\t\t\t}\n+\t\t\tvalidateGetterSetterMethodProxyability( \"Getter\", property.getGetter( clazz ).getMethod() );\n+\t\t\tvalidateGetterSetterMethodProxyability( \"Setter\", property.getSetter( clazz ).getMethod() );\n+\t\t}\n+\t}\n+\n+\tpublic static void validateGetterSetterMethodProxyability(String getterOrSetter, Method method ) {\n+\t\tif ( method != null && Modifier.isFinal( method.getModifiers() ) ) {\n+\t\t\tthrow new HibernateException(\n+\t\t\t\t\tString.format(\n+\t\t\t\t\t\t\t\"%s methods of lazy classes cannot be final: %s#%s\",\n+\t\t\t\t\t\t\tgetterOrSetter,\n+\t\t\t\t\t\t\tmethod.getDeclaringClass().getName(),\n+\t\t\t\t\t\t\tmethod.getName()\n+\t\t\t\t\t)\n+\t\t\t);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c48caafadbf0c8fbba17871ed96307091cc4b966"}, "originalPosition": 34}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwOTEzNTg2", "url": "https://github.com/hibernate/hibernate-orm/pull/3286#pullrequestreview-380913586", "createdAt": "2020-03-25T07:44:50Z", "commit": {"oid": "c48caafadbf0c8fbba17871ed96307091cc4b966"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3206, "cost": 1, "resetAt": "2021-11-01T14:51:55Z"}}}