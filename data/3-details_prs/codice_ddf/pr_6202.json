{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU4Nzc0NTI2", "number": 6202, "title": "[2.19.x] DDF-UI-294 G-8763 G-8787 fix Unable to remove results filters", "bodyText": "What does this PR do?\nFixes bug where user is unable to access the result filter after saving an anygeo filter\nfixes bug where keyword/bbox geos are converted to polygons when the user reopens the result filter\nbackport of #5436\nWho is reviewing it?\n@hayleynorton @cassandrabailey293 @zta6 @abel-connexta\nSelect relevant component teams:\n\nAsk 2 committers to review/merge the PR and tag them here.\n@bdeining\n@mojogitoverhere\nHow should this be tested?\n\nbuild / install\ningest records with location data or edit records to include a location\nsearch for all records\nuse filter button to add an anygeo filter\nverify the results are filtered correclty and the result filter and be reopened and edited\nrefreshed and verify user can edit\nsave a keyword or bbox geometry filter, reopen and verify the value are as you enter them\nattempt to save an invalid geo and verify that its prevented\n\nAny background context you want to provide?\nWhat are the relevant tickets?\ncodice/ddf-ui#294\nG-8763\nScreenshots\n\nChecklist:\n\n Documentation Updated\n Update / Add Threat Dragon models\n Update / Add Unit Tests\n Update / Add Integration Tests\n\nNotes on Review Process\nPlease see Notes on Review Process for further guidance on requirements for merging and abbreviated reviews.\nReview Comment Legend:\n\n\u270f\ufe0f (Pencil) This comment is a nitpick or style suggestion, no action required for approval. This comment should provide a suggestion either as an in line code snippet or a gist.\n\u2753 (Question Mark) This comment is to gain a clearer understanding of design or code choices, clarification is required but action may not be necessary for approval.\n\u2757 (Exclamation Mark) This comment is critical and requires clarification or action before approval.", "createdAt": "2020-07-29T23:58:48Z", "url": "https://github.com/codice/ddf/pull/6202", "merged": true, "mergeCommit": {"oid": "9aa891b44250e4e77b86bd2dd9f00fb0f461ad8e"}, "closed": true, "closedAt": "2020-08-05T15:31:24Z", "author": {"login": "andrewzimmer"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc6E870AH2gAyNDU4Nzc0NTI2OjZiNDYyN2ZiMDJiY2I3YjFiNzY2ZGM3Yzc4Yjg0MDk2Nzc2NTI1YjY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc7qkUnAFqTQ2MTA0NDc5NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6b4627fb02bcb7b1b766dc7c78b84096776525b6", "author": {"user": {"login": "andrewzimmer", "name": null}}, "url": "https://github.com/codice/ddf/commit/6b4627fb02bcb7b1b766dc7c78b84096776525b6", "committedDate": "2020-07-30T19:39:52Z", "message": "DDF-UI-294 G-8763 fix Unable to remove results filters"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f7df9953297511e326b9259bd423bc21f7207200", "author": {"user": {"login": "andrewzimmer", "name": null}}, "url": "https://github.com/codice/ddf/commit/f7df9953297511e326b9259bd423bc21f7207200", "committedDate": "2020-07-29T23:58:15Z", "message": "DDF-UI-294 fix multiple geos"}, "afterCommit": {"oid": "6b4627fb02bcb7b1b766dc7c78b84096776525b6", "author": {"user": {"login": "andrewzimmer", "name": null}}, "url": "https://github.com/codice/ddf/commit/6b4627fb02bcb7b1b766dc7c78b84096776525b6", "committedDate": "2020-07-30T19:39:52Z", "message": "DDF-UI-294 G-8763 fix Unable to remove results filters"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwMDUxODIx", "url": "https://github.com/codice/ddf/pull/6202#pullrequestreview-460051821", "createdAt": "2020-08-03T14:01:58Z", "commit": {"oid": "6b4627fb02bcb7b1b766dc7c78b84096776525b6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxNDowMTo1OFrOG66wTQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QxNDowMTo1OFrOG66wTQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDQzMzIyOQ==", "bodyText": "can we verify that the verification stuff still works? i know it calls this function to show those toast error messages for anyGeo", "url": "https://github.com/codice/ddf/pull/6202#discussion_r464433229", "createdAt": "2020-08-03T14:01:58Z", "author": {"login": "cassandrabailey293"}, "path": "ui/packages/catalog-ui-search/src/main/webapp/component/result-filter/result-filter.view.js", "diffHunk": "@@ -64,7 +63,7 @@ module.exports = Marionette.LayoutView.extend({\n     this.handleFilter()\n   },\n   getFilter() {\n-    return this.editorProperties.currentView.transformToCql()\n+    return this.editorProperties.currentView.getFilters()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6b4627fb02bcb7b1b766dc7c78b84096776525b6"}, "originalPosition": 31}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwMDUyNDIw", "url": "https://github.com/codice/ddf/pull/6202#pullrequestreview-460052420", "createdAt": "2020-08-03T14:02:42Z", "commit": {"oid": "6b4627fb02bcb7b1b766dc7c78b84096776525b6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c959fd645a207b60dc97d60be3a0367ecd65549c", "author": {"user": {"login": "andrewzimmer", "name": null}}, "url": "https://github.com/codice/ddf/commit/c959fd645a207b60dc97d60be3a0367ecd65549c", "committedDate": "2020-08-03T15:54:52Z", "message": "DDF-UI-294 prevent saving invlaid geo"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwMTU0OTQ5", "url": "https://github.com/codice/ddf/pull/6202#pullrequestreview-460154949", "createdAt": "2020-08-03T16:09:36Z", "commit": {"oid": "c959fd645a207b60dc97d60be3a0367ecd65549c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwMzE1OTEx", "url": "https://github.com/codice/ddf/pull/6202#pullrequestreview-460315911", "createdAt": "2020-08-03T20:23:07Z", "commit": {"oid": "c959fd645a207b60dc97d60be3a0367ecd65549c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QyMDoyMzowN1rOG7HgDQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wM1QyMDoyMzowN1rOG7HgDQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDY0MjA2MQ==", "bodyText": "this is weird; we convert it and convert it again?", "url": "https://github.com/codice/ddf/pull/6202#discussion_r464642061", "createdAt": "2020-08-03T20:23:07Z", "author": {"login": "bdeining"}, "path": "ui/packages/catalog-ui-search/src/main/webapp/component/visualization/maps/map.view.js", "diffHunk": "@@ -459,7 +459,12 @@ const View = Marionette.LayoutView.extend({\n       .get('preferences')\n       .get('resultFilter')\n     if (resultFilter) {\n-      this.handleFilter(CQLUtils.transformCQLToFilter(resultFilter), '#c89600')\n+      this.handleFilter(\n+        CQLUtils.transformCQLToFilter(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c959fd645a207b60dc97d60be3a0367ecd65549c"}, "originalPosition": 6}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxMDQwMjky", "url": "https://github.com/codice/ddf/pull/6202#pullrequestreview-461040292", "createdAt": "2020-08-04T17:53:58Z", "commit": {"oid": "c959fd645a207b60dc97d60be3a0367ecd65549c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxMDQ0Nzk0", "url": "https://github.com/codice/ddf/pull/6202#pullrequestreview-461044794", "createdAt": "2020-08-04T18:00:06Z", "commit": {"oid": "c959fd645a207b60dc97d60be3a0367ecd65549c"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQxODowMDowNlrOG7rc9w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQxODowMTo1NlrOG7rg2w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTIzMTA5NQ==", "bodyText": "Looks like this isn't used anywhere. Is it still needed?", "url": "https://github.com/codice/ddf/pull/6202#discussion_r465231095", "createdAt": "2020-08-04T18:00:06Z", "author": {"login": "mojogitoverhere"}, "path": "ui/packages/catalog-ui-search/src/main/webapp/component/filter-builder/filter-builder.view.js", "diffHunk": "@@ -183,6 +183,9 @@ module.exports = Marionette.LayoutView.extend({\n     this.filterOperator.currentView.turnOffEditing()\n     this.filterContents.currentView.turnOffEditing()\n   },\n+  turnOffNesting: function() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c959fd645a207b60dc97d60be3a0367ecd65549c"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTIzMjA5MQ==", "bodyText": "Might be good to add a comment summarizing the previous discussion", "url": "https://github.com/codice/ddf/pull/6202#discussion_r465232091", "createdAt": "2020-08-04T18:01:56Z", "author": {"login": "mojogitoverhere"}, "path": "ui/packages/catalog-ui-search/src/main/webapp/component/visualization/maps/map.view.js", "diffHunk": "@@ -459,7 +459,12 @@ const View = Marionette.LayoutView.extend({\n       .get('preferences')\n       .get('resultFilter')\n     if (resultFilter) {\n-      this.handleFilter(CQLUtils.transformCQLToFilter(resultFilter), '#c89600')\n+      this.handleFilter(\n+        CQLUtils.transformCQLToFilter(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDY0MjA2MQ=="}, "originalCommit": {"oid": "c959fd645a207b60dc97d60be3a0367ecd65549c"}, "originalPosition": 6}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 831, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}