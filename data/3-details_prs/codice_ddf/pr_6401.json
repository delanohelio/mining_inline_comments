{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEwMjEyNDQ2", "number": 6401, "title": "DDF-6400 Upgrade to Camel 3.4.0", "bodyText": "What does this PR do?\nUpgrades to Camel 3.4.4 to continue receiving security updates. This is the last Camel LTS release with Java 8 support, and will be supported through June of 2021 (see https://camel.apache.org/blog/2020/03/LTS-Release-Schedule/#release-schedule). Also, it upgrades a few other dependencies to match the version Camel uses, most notably moving to Guava 29.0.\nThere were a few minor backwards-incompatible changes in Camel that affected DDF. I've commented inline with references to the Camel migration guide\nWho is reviewing it?\n\n@jlcsmith\nSelect relevant component teams:\n@codice/security\n@codice/io\nHow should this be tested?\nTest the http proxy and all the camel routes\nHttpProxy:\nThe DDF HttpProxy is no longer used by DDF itself. Probably worth considering removing it in the future, but for now you can install the Intrigue UI to test:\n\nBuild this PR and this DDF-UI PR codice/ddf-ui#453. Note: you'll need to change the ddf.version property in the DDF-UI pom.\nInstall the Intrigue UI:\n\nfeature:repo-add mvn:org.codice.ddf.search/intrigue-ui-app/4.0.0-SNAPSHOT/xml/features\nfeature:install catalog-ui-app\nfeature:repo-add mvn:org.codice.ddf.search/ui-frontend/4.0.0-SNAPSHOT/xml/features\nfeature:install ui-frontend\n\n\nVerify you get the same response when browsing to https://localhost:8993/search/catalog/proxy/catalog0/layer.json and http://assets.agi.com/stk-terrain/tilesets/world/tiles/layer.json\n\nContent Directory Monitor\nTest each of the processing mechanisms. The docs describe the differences http://codice.org/ddf/docs/documentation.html#_using_the_content_directory_monitor. Make sure to replace the uses of \"${DDF_HOME}\" in these instructions with the actual path to your DDF installation.\n\nMake a directory for the CDM to monitor. To avoid messing with permissions, you can use the DDF tmp dir.\n\nmkdir ${DDF_HOME}/data/tmp/cdm\n\n\nIn the Admin UI find the \"Catalog Content Directory Monitor\" config under the Catalog app. Add a config with the following properties:\n\nDirectory Path: ${DDF_HOME}/data/tmp/cdm\nProcessing Mechanism: Monitor in place\n\n\nDrop a file in the cdm directory and make sure it gets ingested. It may take a bit for the metacard to show up.\nRemove the config and repeat steps 2 & 3 for the other two processing mechanisms\n\nWFS Query\n\nSet up a WFS server. I can help with this\nAdd a WFS source to DDF pointing to the WFS server\nOpen the search UI (/search/simple will work fine) and perform queries against the wfs source.\nVerify you get results back and that there are no errors in the logs\n\nUser account deletion\nDo this last, or backup your users.properties file so you don't get locked out of the system when the accounts get deleted.\n\nAccounts are deleted after 3 days, so you'll need to adjust the installation timestamp so the system thinks it was installed ~3 days ago. Create a time stamp file ${DDF_HOME}/data/tmp/timestamp.bin with the following contents:\n\n2020-11-03T17:40:40Z\n\nThis is a UTC timestamp that indicates when the system was first installed. You can get the current time from https://www.utctime.net/. Subtract 3 days from the timestamp and add ~35 minutes (not a typo - it's not actually 3 days exactly, this should give you 5 minutes to do step 2)\n2. The feature isn't on by default. Go to Admin UI \u2192 Admin \u2192 Default Users Deletion Scheduler \u2192 Enable default users automatic deletion to turn it on. It may take a minute or two, but you should see a new route appear in the Karaf shell once the deletion has been scheduled.\nadmin@root()> camel:route-list                                                                                                                                                                                                             \n Context                    Route                             Status              Total #       Failed #     Inflight #   Uptime         \n -------                    -----                             ------              -------       --------     ----------   ------         \n camelContext               deletionJob                       Started                   0              0              0   6.762 seconds  \n wfsTransformationContext   TransformFeatureCollectionRoute   Started                   0              0              0   24 minutes     \n wfsTransformationContext   TransformFeatureMemberRoute       Started                   0              0              0   24 minutes\n\nYou should also see this line in the logs:\n10:01:43,522 | INFO  | pool-14-thread-2 | he.camel.component.quartz.QuartzEndpoint  400 | e.camel.camel-quartz | Job scheduler.deletionTimer (triggerType=CronTriggerImpl, jobClass=CamelJob) is scheduled. Next fire date is Fri Nov 06 10:10:40 MST 2020\n\nThe next fire date is when the user accounts will be deleted\n3. Verify the accounts get deleted\nAny background context you want to provide?\nWhat are the relevant tickets?\nFixes: #6400\nScreenshots\n\nChecklist:\n\n Documentation Updated\n Update / Add Threat Dragon models\n Update / Add Unit Tests\n Update / Add Integration Tests\n\nNotes on Review Process\nPlease see Notes on Review Process for further guidance on requirements for merging and abbreviated reviews.\nReview Comment Legend:\n\n\u270f\ufe0f (Pencil) This comment is a nitpick or style suggestion, no action required for approval. This comment should provide a suggestion either as an in line code snippet or a gist.\n\u2753 (Question Mark) This comment is to gain a clearer understanding of design or code choices, clarification is required but action may not be necessary for approval.\n\u2757 (Exclamation Mark) This comment is critical and requires clarification or action before approval.", "createdAt": "2020-10-26T18:04:48Z", "url": "https://github.com/codice/ddf/pull/6401", "merged": true, "mergeCommit": {"oid": "befaf0151792545bbcaad6b7343429bd2290af4d"}, "closed": true, "closedAt": "2020-11-11T00:40:39Z", "author": {"login": "SmithJosh"}, "timelineItems": {"totalCount": 22, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdWYexTAFqTUxNzA0ODU5NA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdbN74pAFqTUyNzUwNjQ1Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE3MDQ4NTk0", "url": "https://github.com/codice/ddf/pull/6401#pullrequestreview-517048594", "createdAt": "2020-10-26T18:08:24Z", "commit": {"oid": "a46b71ad84c91913f551eb2f3e1fda8d0f8a433d"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxODowODoyNFrOHocOmQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxODoxMzo1NlrOHocbUQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjE2NzU3Nw==", "bodyText": "After discussing with @pklinef & @stustison, we decided this platform-http-proxy bundle no longer adds any value. Anybody that needs to enable HTTP can do so via the Pax Web configuration", "url": "https://github.com/codice/ddf/pull/6401#discussion_r512167577", "createdAt": "2020-10-26T18:08:24Z", "author": {"login": "SmithJosh"}, "path": "platform/platform-http-proxy/pom.xml", "diffHunk": "@@ -1,142 +0,0 @@\n-<?xml version=\"1.0\" encoding=\"UTF-8\"?>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a46b71ad84c91913f551eb2f3e1fda8d0f8a433d"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjE2OTgyMQ==", "bodyText": "See https://camel.apache.org/manual/latest/camel-3-migration-guide.html#_controlling_routes", "url": "https://github.com/codice/ddf/pull/6401#discussion_r512169821", "createdAt": "2020-10-26T18:12:09Z", "author": {"login": "SmithJosh"}, "path": "catalog/core/catalog-core-directorymonitor/src/main/java/org/codice/ddf/catalog/content/monitor/ContentDirectoryMonitor.java", "diffHunk": "@@ -216,10 +218,10 @@ private void removeRoutes() {\n       try {\n         String routeId = routeDef.getId();\n         LOGGER.trace(\"Stopping route with ID = {} and path {}\", routeId, monitoredDirectory);\n-        camelContext.stopRoute(routeId);\n+        camelContext.getRouteController().stopRoute(routeId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a46b71ad84c91913f551eb2f3e1fda8d0f8a433d"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjE3MDA2Mg==", "bodyText": "See https://camel.apache.org/manual/latest/camel-3-migration-guide.html#_modelcamelcontext", "url": "https://github.com/codice/ddf/pull/6401#discussion_r512170062", "createdAt": "2020-10-26T18:12:34Z", "author": {"login": "SmithJosh"}, "path": "catalog/core/catalog-core-directorymonitor/src/main/java/org/codice/ddf/catalog/content/monitor/ContentDirectoryMonitor.java", "diffHunk": "@@ -216,10 +218,10 @@ private void removeRoutes() {\n       try {\n         String routeId = routeDef.getId();\n         LOGGER.trace(\"Stopping route with ID = {} and path {}\", routeId, monitoredDirectory);\n-        camelContext.stopRoute(routeId);\n+        camelContext.getRouteController().stopRoute(routeId);\n         boolean status = camelContext.removeRoute(routeId);\n         LOGGER.trace(\"Status of removing route {} is {}\", routeId, status);\n-        camelContext.removeRouteDefinition(routeDef);\n+        camelContext.adapt(ModelCamelContext.class).removeRouteDefinition(routeDef);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a46b71ad84c91913f551eb2f3e1fda8d0f8a433d"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjE3MDgzMw==", "bodyText": "See https://camel.apache.org/manual/latest/camel-3-migration-guide.html#_generic_information\nCompositeRegistry is removed. DefaultRegistry is recommended replacement", "url": "https://github.com/codice/ddf/pull/6401#discussion_r512170833", "createdAt": "2020-10-26T18:13:56Z", "author": {"login": "SmithJosh"}, "path": "catalog/plugin/catalog-plugin-metacardbackup-s3storage/src/main/java/org/codice/ddf/catalog/plugin/metacard/backup/storage/s3storage/MetacardS3StorageRoute.java", "diffHunk": "@@ -88,11 +89,9 @@\n \n   public MetacardS3StorageRoute(CamelContext camelContext) {\n     super(camelContext);\n-    registry = new org.apache.camel.impl.SimpleRegistry();\n-    CompositeRegistry compositeRegistry = new CompositeRegistry();\n-    compositeRegistry.addRegistry(camelContext.getRegistry());\n-    compositeRegistry.addRegistry(registry);\n-    ((DefaultCamelContext) camelContext).setRegistry(compositeRegistry);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a46b71ad84c91913f551eb2f3e1fda8d0f8a433d"}, "originalPosition": 28}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE3MDk5Mjkz", "url": "https://github.com/codice/ddf/pull/6401#pullrequestreview-517099293", "createdAt": "2020-10-26T19:16:30Z", "commit": {"oid": "a46b71ad84c91913f551eb2f3e1fda8d0f8a433d"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxOToxNjozMFrOHoesUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yNlQxOToyMTo1NlrOHoe35g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjIwNzk1NA==", "bodyText": "Rather than copying these features and having to keep them in sync with camel can we just use org.apache.features.xml featureReplacements?", "url": "https://github.com/codice/ddf/pull/6401#discussion_r512207954", "createdAt": "2020-10-26T19:16:30Z", "author": {"login": "ryeats"}, "path": "features/camel/src/main/feature/feature.xml", "diffHunk": "@@ -16,285 +16,561 @@\n           xmlns=\"http://karaf.apache.org/xmlns/features/v1.3.0\"\n           xsi:schemaLocation=\"http://karaf.apache.org/xmlns/features/v1.3.0 http://karaf.apache.org/xmlns/features/v1.3.0\">\n \n-    <repository>mvn:org.apache.karaf.features/spring/${karaf.version}/xml/features</repository>\n-    <repository>mvn:ddf.features/cxf/${project.version}/xml/features</repository>\n-    <repository>mvn:org.apache.karaf.features/enterprise/${karaf.version}/xml/features</repository>\n+  <repository>mvn:ddf.features/cxf/${project.version}/xml/features</repository>\n+  <repository>mvn:org.apache.karaf.features/spring/${karaf.version}/xml/features</repository>\n+  <repository>mvn:org.apache.karaf.features/enterprise/${karaf.version}/xml/features</repository>\n \n-    <!--START Camel Features-->\n-    <!-- DO NOT EDIT\n-        All feature definitions come from 3rd party feature file:\n-        <repository>mvn:org.apache.camel.karaf/apache-camel/2.24.2/xml/features</repository>\n+  <!--START Camel Features-->\n+  <!-- DO NOT EDIT\n+      All feature definitions come from 3rd party feature file:\n+      <repository>mvn:org.apache.camel.karaf/apache-camel/3.4.4/xml/features</repository>\n \n-        All version properties for these Camel features are defined in the platform-app pom.\n+      All version properties for these Camel features are defined in the platform-app pom.\n \n-        DDF Changes made:\n-        - removed resolver=\"(obr)\" from every feature\n-        - added  to every feature\n-        - replaced ${project.version} with ${camel.version}\n-        - commented out xml-specs-api feature and replaced xml-specs-api with cxf-specs in camel-core feature\n-        - added camel as feature prerequisite in camel-http to keep things ordered\n-        - added cxf as feature prerequisite in camel to keep things ordered\n-        - removed features that are not needed\n-        - updated versions of qpid and proton versions and added netty bundles in camel-amqp\n-        - replaced bundles in camel-jms\n-        - replaced cxf-http-provider with cxf-http-jetty\n-        - the versions for proton-j and qpid-jms-client used in camel-amqp need to be kept in sync with the versions used in artemis-amqp\n-        - updated proton, qpid-jms, and netty versions to stay in sync with Camel 2.24.2 dependencies\n+      DDF Changes made:\n+      - replaced ${project.version} with ${camel.version}\n+      - commented out xml-specs-api feature and replaced xml-specs-api with cxf-specs in camel-core feature", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a46b71ad84c91913f551eb2f3e1fda8d0f8a433d"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjIxMDkxOA==", "bodyText": "It may be better if DDF didn't maintain these and any other features it doesn't directly use and require downstream distribution to add them or use them directly from camel's feature file", "url": "https://github.com/codice/ddf/pull/6401#discussion_r512210918", "createdAt": "2020-10-26T19:21:56Z", "author": {"login": "ryeats"}, "path": "features/camel/src/main/feature/feature.xml", "diffHunk": "@@ -16,285 +16,561 @@\n           xmlns=\"http://karaf.apache.org/xmlns/features/v1.3.0\"\n           xsi:schemaLocation=\"http://karaf.apache.org/xmlns/features/v1.3.0 http://karaf.apache.org/xmlns/features/v1.3.0\">\n \n-    <repository>mvn:org.apache.karaf.features/spring/${karaf.version}/xml/features</repository>\n-    <repository>mvn:ddf.features/cxf/${project.version}/xml/features</repository>\n-    <repository>mvn:org.apache.karaf.features/enterprise/${karaf.version}/xml/features</repository>\n+  <repository>mvn:ddf.features/cxf/${project.version}/xml/features</repository>\n+  <repository>mvn:org.apache.karaf.features/spring/${karaf.version}/xml/features</repository>\n+  <repository>mvn:org.apache.karaf.features/enterprise/${karaf.version}/xml/features</repository>\n \n-    <!--START Camel Features-->\n-    <!-- DO NOT EDIT\n-        All feature definitions come from 3rd party feature file:\n-        <repository>mvn:org.apache.camel.karaf/apache-camel/2.24.2/xml/features</repository>\n+  <!--START Camel Features-->\n+  <!-- DO NOT EDIT\n+      All feature definitions come from 3rd party feature file:\n+      <repository>mvn:org.apache.camel.karaf/apache-camel/3.4.4/xml/features</repository>\n \n-        All version properties for these Camel features are defined in the platform-app pom.\n+      All version properties for these Camel features are defined in the platform-app pom.\n \n-        DDF Changes made:\n-        - removed resolver=\"(obr)\" from every feature\n-        - added  to every feature\n-        - replaced ${project.version} with ${camel.version}\n-        - commented out xml-specs-api feature and replaced xml-specs-api with cxf-specs in camel-core feature\n-        - added camel as feature prerequisite in camel-http to keep things ordered\n-        - added cxf as feature prerequisite in camel to keep things ordered\n-        - removed features that are not needed\n-        - updated versions of qpid and proton versions and added netty bundles in camel-amqp\n-        - replaced bundles in camel-jms\n-        - replaced cxf-http-provider with cxf-http-jetty\n-        - the versions for proton-j and qpid-jms-client used in camel-amqp need to be kept in sync with the versions used in artemis-amqp\n-        - updated proton, qpid-jms, and netty versions to stay in sync with Camel 2.24.2 dependencies\n+      DDF Changes made:\n+      - replaced ${project.version} with ${camel.version}\n+      - commented out xml-specs-api feature and replaced xml-specs-api with cxf-specs in camel-core feature\n+      - removed features that are not needed\n+      - replaced geronimo-jta_1.1_spec bundle with Karaf's \"transaction\" feature in a few places:\n+        * camel-jms", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a46b71ad84c91913f551eb2f3e1fda8d0f8a433d"}, "originalPosition": 41}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE5MTA1NjA0", "url": "https://github.com/codice/ddf/pull/6401#pullrequestreview-519105604", "createdAt": "2020-10-28T21:40:14Z", "commit": {"oid": "f12c5e451269348d6a6f6d2b108ce68b17908ba7"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE5OTQwODY2", "url": "https://github.com/codice/ddf/pull/6401#pullrequestreview-519940866", "createdAt": "2020-10-29T18:05:38Z", "commit": {"oid": "f12c5e451269348d6a6f6d2b108ce68b17908ba7"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxODowNTozOVrOHqoWyw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxODoxNzowNFrOHqozKA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDQ2MzQzNQ==", "bodyText": "\u270f\ufe0f The string should contain the name of variable with the same case. So, it would be camelContext, not CamelContext.", "url": "https://github.com/codice/ddf/pull/6401#discussion_r514463435", "createdAt": "2020-10-29T18:05:39Z", "author": {"login": "glenhein"}, "path": "catalog/core/catalog-core-directorymonitor/src/main/java/org/codice/ddf/catalog/content/monitor/ContentDirectoryMonitor.java", "diffHunk": "@@ -117,7 +119,7 @@ public ContentDirectoryMonitor(\n       int delayBetweenRetries,\n       Executor configurationExecutor,\n       Security security) {\n-    this.camelContext = camelContext;\n+    this.camelContext = Objects.requireNonNull(camelContext, \"CamelContext cannot be null\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f12c5e451269348d6a6f6d2b108ce68b17908ba7"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDQ2OTI2NA==", "bodyText": "Can you provide an explanation for the drop in coverage?", "url": "https://github.com/codice/ddf/pull/6401#discussion_r514469264", "createdAt": "2020-10-29T18:14:50Z", "author": {"login": "glenhein"}, "path": "catalog/plugin/catalog-plugin-metacardbackup-storage-common/pom.xml", "diffHunk": "@@ -91,12 +90,12 @@\n                                         <limit implementation=\"org.codice.jacoco.LenientLimit\">\n                                             <counter>INSTRUCTION</counter>\n                                             <value>COVEREDRATIO</value>\n-                                            <minimum>0.85</minimum>\n+                                            <minimum>0.82</minimum>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f12c5e451269348d6a6f6d2b108ce68b17908ba7"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDQ3MDY5Ng==", "bodyText": "Does an InputSource need to be closed?", "url": "https://github.com/codice/ddf/pull/6401#discussion_r514470696", "createdAt": "2020-10-29T18:17:04Z", "author": {"login": "glenhein"}, "path": "catalog/spatial/wfs/spatial-wfs-source/src/main/java/org/codice/ddf/spatial/ogc/wfs/catalog/source/reader/XmlSchemaMessageBodyReader.java", "diffHunk": "@@ -66,20 +81,33 @@ public XmlSchema readFrom(\n       MultivaluedMap<String, String> headers,\n       InputStream inStream)\n       throws IOException, WebApplicationException {\n-    // Determine if this is an XMLSchema\n-    String input = IOUtils.toString(inStream);\n+\n+    String input = IOUtils.toString(inStream, StandardCharsets.UTF_8);\n     inStream.reset();\n-    String count = COUNT_XPATH_BUILDER.evaluate(camelContext, input);\n-    // See if there exactly one instance of \"xsd:schema\" in this doc\n-    if (Integer.parseInt(count) == 1) {\n-      XmlSchema schema = null;\n+\n+    if (isValid(new InputSource(inStream))) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f12c5e451269348d6a6f6d2b108ce68b17908ba7"}, "originalPosition": 75}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE5OTU0ODA5", "url": "https://github.com/codice/ddf/pull/6401#pullrequestreview-519954809", "createdAt": "2020-10-29T18:22:57Z", "commit": {"oid": "f12c5e451269348d6a6f6d2b108ce68b17908ba7"}, "state": "APPROVED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQxODoyMjo1N1rOHqpBUw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yOVQyMjoyMTowNFrOHqwv-g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDQ3NDMyMw==", "bodyText": "\u270f\ufe0f I think that the default for Import-Package is *, so I think you can omit the Import-Package section\n<instructions>\n    <Bundle-SymbolicName>${project.artifactId}</Bundle-SymbolicName>\n    <Export-Package>\n        org.codice.proxy.http\n    </Export-Package>\n</instructions>\nSame for libs/httpproxy/proxy-camel-servlet/pom.xml.", "url": "https://github.com/codice/ddf/pull/6401#discussion_r514474323", "createdAt": "2020-10-29T18:22:57Z", "author": {"login": "emmberk"}, "path": "libs/httpproxy/proxy-camel-route/pom.xml", "diffHunk": "@@ -91,15 +41,9 @@\n                     <instructions>\n                         <Bundle-SymbolicName>${project.artifactId}</Bundle-SymbolicName>\n                         <Import-Package>\n-                            org.apache.camel.component.http,\n-                            org.apache.camel.component.servlet,\n-                            org.apache.camel.core.osgi,\n-                            javax.annotation;version=\"[1.2,2)\",\n                             *\n                         </Import-Package>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f12c5e451269348d6a6f6d2b108ce68b17908ba7"}, "originalPosition": 74}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDU5NTUwNA==", "bodyText": "\u270f\ufe0f I prefer to use the actual version for the file from which these properties were copied from in case the camel version is upgraded, but this file isn't updated correspondingly. Like we do in the camel feature.xml file.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    Copied from org.apache.camel:camel-parent:pom:${camel.version}\n          \n          \n            \n                    Copied from org.apache.camel:camel-parent:pom:3.4.4", "url": "https://github.com/codice/ddf/pull/6401#discussion_r514595504", "createdAt": "2020-10-29T22:07:01Z", "author": {"login": "emmberk"}, "path": "features/pom.xml", "diffHunk": "@@ -39,60 +39,28 @@\n     </modules>\n \n     <properties>\n-        <!--START versions for camel features in platform-app features\n-        Copied from apache-camel-2.19.4-src/parent/pom.xml\n+        <!-- START versions for camel features\n+        Copied from org.apache.camel:camel-parent:pom:${camel.version}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f12c5e451269348d6a6f6d2b108ce68b17908ba7"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDU5OTUyNQ==", "bodyText": "\u270f\ufe0f\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  All version properties for these Camel features are defined in the platform-app pom.\n          \n          \n            \n                  All version properties for these Camel features are defined in the features pom.", "url": "https://github.com/codice/ddf/pull/6401#discussion_r514599525", "createdAt": "2020-10-29T22:17:22Z", "author": {"login": "emmberk"}, "path": "features/camel/src/main/feature/feature.xml", "diffHunk": "@@ -16,285 +16,434 @@\n           xmlns=\"http://karaf.apache.org/xmlns/features/v1.3.0\"\n           xsi:schemaLocation=\"http://karaf.apache.org/xmlns/features/v1.3.0 http://karaf.apache.org/xmlns/features/v1.3.0\">\n \n-    <repository>mvn:org.apache.karaf.features/spring/${karaf.version}/xml/features</repository>\n-    <repository>mvn:ddf.features/cxf/${project.version}/xml/features</repository>\n-    <repository>mvn:org.apache.karaf.features/enterprise/${karaf.version}/xml/features</repository>\n+  <repository>mvn:ddf.features/cxf/${project.version}/xml/features</repository>\n \n-    <!--START Camel Features-->\n-    <!-- DO NOT EDIT\n-        All feature definitions come from 3rd party feature file:\n-        <repository>mvn:org.apache.camel.karaf/apache-camel/2.24.2/xml/features</repository>\n+  <!--START Camel Features-->\n+  <!-- DO NOT EDIT\n+      All feature definitions come from 3rd party feature file:\n+      <repository>mvn:org.apache.camel.karaf/apache-camel/3.4.4/xml/features</repository>\n \n-        All version properties for these Camel features are defined in the platform-app pom.\n+      All version properties for these Camel features are defined in the platform-app pom.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f12c5e451269348d6a6f6d2b108ce68b17908ba7"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDYwMDc0MQ==", "bodyText": "\ud83d\udc4d I reviewed the diff with https://github.com/apache/camel-karaf/blob/camel-karaf-3.4.4/pom.xml and https://github.com/apache/camel/blob/camel-3.4.4/camel-dependencies/pom.xml. There are a few versions that are upgraded from what camel uses, but there are no older versions from what camel is using. I also confirmed that the remaining camel version properties are all used.", "url": "https://github.com/codice/ddf/pull/6401#discussion_r514600741", "createdAt": "2020-10-29T22:20:31Z", "author": {"login": "emmberk"}, "path": "features/pom.xml", "diffHunk": "@@ -39,60 +39,28 @@\n     </modules>\n \n     <properties>\n-        <!--START versions for camel features in platform-app features\n-        Copied from apache-camel-2.19.4-src/parent/pom.xml\n+        <!-- START versions for camel features\n+        Copied from org.apache.camel:camel-parent:pom:${camel.version}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f12c5e451269348d6a6f6d2b108ce68b17908ba7"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDYwMDk1NA==", "bodyText": "\ud83d\udc4d I reviewed the diff with https://github.com/apache/camel-karaf/blob/camel-karaf-3.4.4/platforms/karaf/features/src/main/resources/features.xml. Everything is exactly the same besides what's mentioned in the DDF changes made list.", "url": "https://github.com/codice/ddf/pull/6401#discussion_r514600954", "createdAt": "2020-10-29T22:21:04Z", "author": {"login": "emmberk"}, "path": "features/camel/src/main/feature/feature.xml", "diffHunk": "@@ -16,285 +16,434 @@\n           xmlns=\"http://karaf.apache.org/xmlns/features/v1.3.0\"\n           xsi:schemaLocation=\"http://karaf.apache.org/xmlns/features/v1.3.0 http://karaf.apache.org/xmlns/features/v1.3.0\">\n \n-    <repository>mvn:org.apache.karaf.features/spring/${karaf.version}/xml/features</repository>\n-    <repository>mvn:ddf.features/cxf/${project.version}/xml/features</repository>\n-    <repository>mvn:org.apache.karaf.features/enterprise/${karaf.version}/xml/features</repository>\n+  <repository>mvn:ddf.features/cxf/${project.version}/xml/features</repository>\n \n-    <!--START Camel Features-->\n-    <!-- DO NOT EDIT\n-        All feature definitions come from 3rd party feature file:\n-        <repository>mvn:org.apache.camel.karaf/apache-camel/2.24.2/xml/features</repository>\n+  <!--START Camel Features-->\n+  <!-- DO NOT EDIT\n+      All feature definitions come from 3rd party feature file:\n+      <repository>mvn:org.apache.camel.karaf/apache-camel/3.4.4/xml/features</repository>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f12c5e451269348d6a6f6d2b108ce68b17908ba7"}, "originalPosition": 16}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7d7be8eca7c6cf650b68d3f2cdc9e77310f4c25b", "author": {"user": {"login": "SmithJosh", "name": "Joshua Smith"}}, "url": "https://github.com/codice/ddf/commit/7d7be8eca7c6cf650b68d3f2cdc9e77310f4c25b", "committedDate": "2020-10-29T23:17:57Z", "message": "Address comments"}, "afterCommit": {"oid": "8a010c6cd1bef37efd3872e4eb9f01c619c5d275", "author": {"user": {"login": "SmithJosh", "name": "Joshua Smith"}}, "url": "https://github.com/codice/ddf/commit/8a010c6cd1bef37efd3872e4eb9f01c619c5d275", "committedDate": "2020-10-29T23:24:23Z", "message": "Address comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a05da2b56ef2ff32c72588ded3bd136c0656b97b", "author": {"user": {"login": "SmithJosh", "name": "Joshua Smith"}}, "url": "https://github.com/codice/ddf/commit/a05da2b56ef2ff32c72588ded3bd136c0656b97b", "committedDate": "2020-11-04T16:49:31Z", "message": "Upgrade to Camel 3.4.4"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "308cc6f7fe90e14fc0327a2ecdda4161eacdd136", "author": {"user": {"login": "SmithJosh", "name": "Joshua Smith"}}, "url": "https://github.com/codice/ddf/commit/308cc6f7fe90e14fc0327a2ecdda4161eacdd136", "committedDate": "2020-11-04T16:49:31Z", "message": "Upgrade to Jakarta Mail"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6258d87b221de08c1fb0666248c9044ffa8c71a4", "author": {"user": {"login": "SmithJosh", "name": "Joshua Smith"}}, "url": "https://github.com/codice/ddf/commit/6258d87b221de08c1fb0666248c9044ffa8c71a4", "committedDate": "2020-11-04T16:49:31Z", "message": "Fix compilation errors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0c25f63b48e4c92d2ef918e8d73412ad0ffe5d8a", "author": {"user": {"login": "SmithJosh", "name": "Joshua Smith"}}, "url": "https://github.com/codice/ddf/commit/0c25f63b48e4c92d2ef918e8d73412ad0ffe5d8a", "committedDate": "2020-11-04T16:49:31Z", "message": "Remove platform-http-proxy module and update proxy-camel-route to httpclient 4"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6bfd70e2334d48b65dcebd3dc46811351e644bfb", "author": {"user": {"login": "SmithJosh", "name": "Joshua Smith"}}, "url": "https://github.com/codice/ddf/commit/6bfd70e2334d48b65dcebd3dc46811351e644bfb", "committedDate": "2020-11-04T16:49:31Z", "message": "Fix tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ca8d84aae14aaa090d6d5997057c1d6e4c106257", "author": {"user": {"login": "SmithJosh", "name": "Joshua Smith"}}, "url": "https://github.com/codice/ddf/commit/ca8d84aae14aaa090d6d5997057c1d6e4c106257", "committedDate": "2020-11-04T16:49:32Z", "message": "Remove unused Camel features"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9c7213ab940bf40d5019cabd761a25da4ba973e3", "author": {"user": {"login": "SmithJosh", "name": "Joshua Smith"}}, "url": "https://github.com/codice/ddf/commit/9c7213ab940bf40d5019cabd761a25da4ba973e3", "committedDate": "2020-11-04T16:49:32Z", "message": "Address comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "148d28e0c7ed8b327020d9e555d8b7b9eb166d34", "author": {"user": {"login": "SmithJosh", "name": "Joshua Smith"}}, "url": "https://github.com/codice/ddf/commit/148d28e0c7ed8b327020d9e555d8b7b9eb166d34", "committedDate": "2020-11-04T16:49:32Z", "message": "Fix permissions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dff45fdb05b87a5bb56cdf7905e7e8d19d78c582", "author": {"user": {"login": "SmithJosh", "name": "Joshua Smith"}}, "url": "https://github.com/codice/ddf/commit/dff45fdb05b87a5bb56cdf7905e7e8d19d78c582", "committedDate": "2020-11-04T16:49:49Z", "message": "Switch to Camel 3.4.0 due to bug in 3.4.4"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3730a53738ee9f210d157d91048ed6644d66cbea", "author": {"user": {"login": "SmithJosh", "name": "Joshua Smith"}}, "url": "https://github.com/codice/ddf/commit/3730a53738ee9f210d157d91048ed6644d66cbea", "committedDate": "2020-10-30T00:09:09Z", "message": "Fix permissions"}, "afterCommit": {"oid": "dff45fdb05b87a5bb56cdf7905e7e8d19d78c582", "author": {"user": {"login": "SmithJosh", "name": "Joshua Smith"}}, "url": "https://github.com/codice/ddf/commit/dff45fdb05b87a5bb56cdf7905e7e8d19d78c582", "committedDate": "2020-11-04T16:49:49Z", "message": "Switch to Camel 3.4.0 due to bug in 3.4.4"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIzNzg2MjY2", "url": "https://github.com/codice/ddf/pull/6401#pullrequestreview-523786266", "createdAt": "2020-11-04T22:35:48Z", "commit": {"oid": "dff45fdb05b87a5bb56cdf7905e7e8d19d78c582"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e47b0a4316dfa74ddd13301ed9fc60359fc21d3f", "author": {"user": {"login": "SmithJosh", "name": "Joshua Smith"}}, "url": "https://github.com/codice/ddf/commit/e47b0a4316dfa74ddd13301ed9fc60359fc21d3f", "committedDate": "2020-11-10T17:37:35Z", "message": "Fix broken routes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7f4d155a77ccaed8c0ad22a809b5a188b7a50ced", "author": {"user": {"login": "SmithJosh", "name": "Joshua Smith"}}, "url": "https://github.com/codice/ddf/commit/7f4d155a77ccaed8c0ad22a809b5a188b7a50ced", "committedDate": "2020-11-10T17:46:22Z", "message": "Fix WFS query errors"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "acf0d0071d37b53007f09c5ca84159cc19b976da", "author": {"user": {"login": "SmithJosh", "name": "Joshua Smith"}}, "url": "https://github.com/codice/ddf/commit/acf0d0071d37b53007f09c5ca84159cc19b976da", "committedDate": "2020-11-10T17:37:46Z", "message": "Fix WFS query errors"}, "afterCommit": {"oid": "7f4d155a77ccaed8c0ad22a809b5a188b7a50ced", "author": {"user": {"login": "SmithJosh", "name": "Joshua Smith"}}, "url": "https://github.com/codice/ddf/commit/7f4d155a77ccaed8c0ad22a809b5a188b7a50ced", "committedDate": "2020-11-10T17:46:22Z", "message": "Fix WFS query errors"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3NDcwODE5", "url": "https://github.com/codice/ddf/pull/6401#pullrequestreview-527470819", "createdAt": "2020-11-10T18:05:50Z", "commit": {"oid": "7f4d155a77ccaed8c0ad22a809b5a188b7a50ced"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI3NTA2NDU2", "url": "https://github.com/codice/ddf/pull/6401#pullrequestreview-527506456", "createdAt": "2020-11-10T18:45:43Z", "commit": {"oid": "7f4d155a77ccaed8c0ad22a809b5a188b7a50ced"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxODo0NTo0M1rOHwqdMg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQxODo0NTo0M1rOHwqdMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDc4OTI5OA==", "bodyText": "I suppose the body was already in memory, but is there anyway that this could blow up memory, thus creating a possible DNS attack?", "url": "https://github.com/codice/ddf/pull/6401#discussion_r520789298", "createdAt": "2020-11-10T18:45:43Z", "author": {"login": "glenhein"}, "path": "catalog/spatial/wfs/spatial-wfs-featuretransformer/src/main/java/org/codice/ddf/spatial/ogc/wfs/featuretransformer/impl/WfsRouteBuilder.java", "diffHunk": "@@ -33,22 +33,33 @@\n \n   @Override\n   public void configure() {\n+    /*\n+     * This route is designed to be called via a Camel proxy using the FeatureTransformationService\n+     * interface. Arguments are bound to the message body as an array, i.e.\n+     *\n+     * method: apply(InputStream featureCollection, WfsMetadata metadata)\n+     * message body: new Object[] { featureCollection, metadata }\n+     */\n     from(FEATURECOLLECTION_ENDPOINT_URL)\n         .id(\"TransformFeatureCollectionRoute\")\n+        .streamCaching()\n         .setHeader(\"metadata\", simple(\"${body[1]}\"))\n-        .setHeader(\"xml\", simple(\"${body[0]}\"))\n+        // Stream caching doesn't work when the input stream is located in a header. Copying the\n+        // stream to the body first is a workaround. It causes the stream to be cached, then we can\n+        // copy that cache to the header so we can access it later.\n+        .setBody(simple(\"${body[0]}\"))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7f4d155a77ccaed8c0ad22a809b5a188b7a50ced"}, "originalPosition": 19}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 795, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}