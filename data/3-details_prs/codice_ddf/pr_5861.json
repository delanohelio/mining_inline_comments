{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgxMDEwODc0", "number": 5861, "title": "[2.16.x] DDF-5946 Subject identity fix", "bodyText": "What does this PR do?\nUpdates the UI to respect the Subject Identity configuration, rather than always using the email as the subject identity. It also updates the subject identity code to ignore guest claims if the user is logged in, so that they are not used as the subject identifier.\nWho is reviewing it?\n@stustison @bakejeyner @blen-desta @garrettfreibott\nHow should this be tested?\n\nCreate two non-admin accounts in DDF\nChange the Subject Identity config in the Admin UI to use the http://schemas.xmlsoap.org/ws/2005/05/identity/claims/nameidentifier attribute instead of email.\nRestart DDF\nVerify the following:\n\n\nMetacard security attributes (the security.access-* attributes) use the name identifier instead of email.\nThe workspaces page use the name identifier to indicate workspace ownership\nWorkspace filtering works (Owned by Me, Not Owned by Me)\nWorkspace sharing works\nSearch form sharing works (top left hamburger > Search Forms)\nOn load, Intrigue opens an existing workspace if there is one owned by the current user\nQuery annotations use name identifier to indicate ownership, and only the owner can modify their notes. Also, make sure the owner can update and delete their notes\nThe subject identifier is not \"guest\". It should always be the nameidentifier of the logged in user.\n\nAny background context you want to provide?\nWhat are the relevant tickets?\nFixes: #5946\nScreenshots\n\nChecklist:\n\n Documentation Updated\n Update / Add Threat Dragon models\n Update / Add Unit Tests\n Update / Add Integration Tests\n\nNotes on Review Process\nPlease see Notes on Review Process for further guidance on requirements for merging and abbreviated reviews.\nReview Comment Legend:\n\n\u270f\ufe0f (Pencil) This comment is a nitpick or style suggestion, no action required for approval. This comment should provide a suggestion either as an in line code snippet or a gist.\n\u2753 (Question Mark) This comment is to gain a clearer understanding of design or code choices, clarification is required but action may not be necessary for approval.\n\u2757 (Exclamation Mark) This comment is critical and requires clarification or action before approval.", "createdAt": "2020-02-27T18:45:15Z", "url": "https://github.com/codice/ddf/pull/5861", "merged": true, "mergeCommit": {"oid": "f82298401eb0023a0f69486c294e453a75a865cf"}, "closed": true, "closedAt": "2020-04-23T20:54:10Z", "author": {"login": "SmithJosh"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcXTtkzgFqTM5MjM2MTk0OA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcZ57l0AH2gAyMzgxMDEwODc0Ojg2ZDYxNDM0Mjk5NDc3YmRkYTkxOTVlMmE1NjM0Yjg3MjIxOGFhNDg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkyMzYxOTQ4", "url": "https://github.com/codice/ddf/pull/5861#pullrequestreview-392361948", "createdAt": "2020-04-13T19:04:19Z", "commit": {"oid": "babdf1ff7420d855374026e2ff5e5112453277dc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2f67110efd32cde6a0b59ffee91e383f6f3f344f", "author": {"user": {"login": "SmithJosh", "name": "Joshua Smith"}}, "url": "https://github.com/codice/ddf/commit/2f67110efd32cde6a0b59ffee91e383f6f3f344f", "committedDate": "2020-04-13T19:46:48Z", "message": "DDF-5946 Use unique id for metacard owner and permissions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4995bdb7eb315b4c5063fd7351f3e39fe6b176b6", "author": {"user": {"login": "SmithJosh", "name": "Joshua Smith"}}, "url": "https://github.com/codice/ddf/commit/4995bdb7eb315b4c5063fd7351f3e39fe6b176b6", "committedDate": "2020-04-13T19:47:05Z", "message": "DDF-5946 Remove guest claims before selecting subject identifier"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "babdf1ff7420d855374026e2ff5e5112453277dc", "author": {"user": {"login": "SmithJosh", "name": "Joshua Smith"}}, "url": "https://github.com/codice/ddf/commit/babdf1ff7420d855374026e2ff5e5112453277dc", "committedDate": "2020-02-21T17:04:26Z", "message": "Remove guest claims before selecting subject identifier"}, "afterCommit": {"oid": "4995bdb7eb315b4c5063fd7351f3e39fe6b176b6", "author": {"user": {"login": "SmithJosh", "name": "Joshua Smith"}}, "url": "https://github.com/codice/ddf/commit/4995bdb7eb315b4c5063fd7351f3e39fe6b176b6", "committedDate": "2020-04-13T19:47:05Z", "message": "DDF-5946 Remove guest claims before selecting subject identifier"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3MDE0ODAy", "url": "https://github.com/codice/ddf/pull/5861#pullrequestreview-397014802", "createdAt": "2020-04-21T06:14:37Z", "commit": {"oid": "4995bdb7eb315b4c5063fd7351f3e39fe6b176b6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk3NjA0NjMz", "url": "https://github.com/codice/ddf/pull/5861#pullrequestreview-397604633", "createdAt": "2020-04-21T19:21:01Z", "commit": {"oid": "4995bdb7eb315b4c5063fd7351f3e39fe6b176b6"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxOToyMTowMlrOGJUkZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxOToyNjowOVrOGJUxkw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjQyNzM2NQ==", "bodyText": "\u2753 Did you mean to remove this?", "url": "https://github.com/codice/ddf/pull/5861#discussion_r412427365", "createdAt": "2020-04-21T19:21:02Z", "author": {"login": "bakejeyner"}, "path": "platform/security/sts/security-sts-guestclaimshandler/pom.xml", "diffHunk": "@@ -53,7 +53,7 @@\n                     <instructions>\n                         <Bundle-SymbolicName>${project.artifactId}</Bundle-SymbolicName>\n                         <Embed-Dependency>httpclient,httpcore</Embed-Dependency>\n-                        <Export-Package />\n+<!--                        <Export-Package />-->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4995bdb7eb315b4c5063fd7351f3e39fe6b176b6"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjQzMDczOQ==", "bodyText": "\u270f\ufe0f I was a little confused by what the getSubjectAttribute method is doing. It might be useful to rename that method to something like getSubjectIdentityAttribute.", "url": "https://github.com/codice/ddf/pull/5861#discussion_r412430739", "createdAt": "2020-04-21T19:26:09Z", "author": {"login": "bakejeyner"}, "path": "platform/security/core/security-core-services/src/main/java/ddf/security/impl/SubjectIdentityImpl.java", "diffHunk": "@@ -34,9 +41,21 @@\n    */\n   @Override\n   public String getUniqueIdentifier(Subject subject) {\n-    Optional<String> owner = getSubjectAttribute(subject).stream().findFirst();\n-    if (owner.isPresent()) {\n-      return owner.get();\n+    SortedSet<String> subjectAttribute = getSubjectAttribute(subject);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4995bdb7eb315b4c5063fd7351f3e39fe6b176b6"}, "originalPosition": 31}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "86d61434299477bdda9195e2a5634b872218aa48", "author": {"user": {"login": "SmithJosh", "name": "Joshua Smith"}}, "url": "https://github.com/codice/ddf/commit/86d61434299477bdda9195e2a5634b872218aa48", "committedDate": "2020-04-21T20:43:52Z", "message": "DDF-5946 Remove commented line"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 39, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}