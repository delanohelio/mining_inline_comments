{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQxNDM0NzI4", "number": 6464, "title": "[2.19.x] G-9195 G-9469 Fix single result export to have user-friendly headers", "bodyText": "What does this PR do?\nThis pr fixes the issue where single results exported from the results/inspector pane in the UI did not have the user-friendly attribute names as headers; rather, they exported the raw labels.\nThe reason this was happening is because for that particular case, we were calling exportResult, instead of exportResultSet. The exportResult method used the following endpoint:\n/services/catalog/sources/${source}/${id}?transform=${transformer}&columnOrder=${attributes}\nIn all of the other cases, we were calling exportResultSet, which uses:\n./internal/cql/transform/${transformer}\nwhich relies on creating a query and using a query response transformer.\nThis latter case has the proper processing and should be used in all cases. I have left alone the zipped compression case (on the UI, three dot menu on the search -> Export Selected (Compressed) ) to be fixed in a separate PR, because it doesn't seem to be working at all.\nIn addition, we were previously encoding the source id and result id in their getters in export.tsx. This was because of the former endpoint passing parameters through the URL. now, by using only exportResultSet, we only pass the transformer through the url, and the rest of the parameters like sources through the request body, so they should no longer be uncoded. This was actually causing the export of multiple results to fail from the inspector, because it was using exportResultSet but sending URI-encoded values for source. This pr also fixes that issue.\nWho is reviewing it?\n\n@lavoywj @leo-sakh @frnkshin @jMoneee\nSelect relevant component teams:\n\n@codice/ui\nAsk 2 committers to review/merge the PR and tag them here.\n\nHow should this be tested?\n\nMain Issue - Export user-friendly headers\n\nbuild, profile install, ingest data\nCreate a search that generates results\nSelect a record from the search panel\nClick the 3-dot menu on the result\nSelect \"Export As\"\nSelect \"CSV\"\nClick the \"Download\" button\nView the Excel spreadsheet and verify that the headers match the ones you see in the inspector and table.\n\nSide Issue - Multiple Export Failing\n\nbuild, profile install, ingest data\nCreate a search that generates results\nSelect a record from the search panel\nClick the 3-dot menu on the result\nSelect \"Export As\"\nSelect \"CSV\"\nClick the \"Download\" button\nView the Excel spreadsheet and verify that the headers match the ones you see in the inspector and table.\n\nAny background context you want to provide?\nWhat are the relevant tickets?\nFixes: #____\nScreenshots\n\nChecklist:\n\n Documentation Updated\n Update / Add Threat Dragon models\n Update / Add Unit Tests\n Update / Add Integration Tests\n\nNotes on Review Process\nPlease see Notes on Review Process for further guidance on requirements for merging and abbreviated reviews.\nReview Comment Legend:\n\n\u270f\ufe0f (Pencil) This comment is a nitpick or style suggestion, no action required for approval. This comment should provide a suggestion either as an in line code snippet or a gist.\n\u2753 (Question Mark) This comment is to gain a clearer understanding of design or code choices, clarification is required but action may not be necessary for approval.\n\u2757 (Exclamation Mark) This comment is critical and requires clarification or action before approval.", "createdAt": "2020-12-16T20:57:51Z", "url": "https://github.com/codice/ddf/pull/6464", "merged": true, "mergeCommit": {"oid": "b79873274a153af86acf0c7a994b3db3e12df25d"}, "closed": true, "closedAt": "2020-12-28T23:55:28Z", "author": {"login": "cassandrabailey293"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdm1zRsAFqTU1NDA5ODAzMg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdqquQ6ABqjQxNTI4MDA0MDU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU0MDk4MDMy", "url": "https://github.com/codice/ddf/pull/6464#pullrequestreview-554098032", "createdAt": "2020-12-16T21:27:20Z", "commit": {"oid": "c40cc1141898588ff4d9e93e42c90a6743b509e0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQyMToyNzoyMFrOIHZ4sA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQyMToyNzoyMFrOIHZ4sA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDYzNTA1Ng==", "bodyText": "\u270f\ufe0f You can remove the {} and the return since this a pretty short predicate statement now", "url": "https://github.com/codice/ddf/pull/6464#discussion_r544635056", "createdAt": "2020-12-16T21:27:20Z", "author": {"login": "leo-sakh"}, "path": "ui/packages/catalog-ui-search/src/main/webapp/react-component/results-export/container.tsx", "diffHunk": "@@ -69,9 +70,7 @@ class ResultsExport extends React.Component<Props, State> {\n   }\n \n   getTransformerType = () => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c40cc1141898588ff4d9e93e42c90a6743b509e0"}, "originalPosition": 16}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU0MTA0MTg1", "url": "https://github.com/codice/ddf/pull/6464#pullrequestreview-554104185", "createdAt": "2020-12-16T21:36:46Z", "commit": {"oid": "c40cc1141898588ff4d9e93e42c90a6743b509e0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQyMTozNjo0NlrOIHaNcA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQyMTozNjo0NlrOIHaNcA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY0MDM2OA==", "bodyText": "\u2753 Why can't we just do const attributes = this.props.results.map(result => result.attributes)?", "url": "https://github.com/codice/ddf/pull/6464#discussion_r544640368", "createdAt": "2020-12-16T21:36:46Z", "author": {"login": "leo-sakh"}, "path": "ui/packages/catalog-ui-search/src/main/webapp/react-component/results-export/container.tsx", "diffHunk": "@@ -149,20 +147,21 @@ class ResultsExport extends React.Component<Props, State> {\n           transformerId: uriEncodedTransformerId,\n         },\n       })\n-    } else if (this.props.results.length > 1) {\n+    } else {\n+      let attributes = new Array()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c40cc1141898588ff4d9e93e42c90a6743b509e0"}, "originalPosition": 38}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU2NjkwNDk1", "url": "https://github.com/codice/ddf/pull/6464#pullrequestreview-556690495", "createdAt": "2020-12-21T21:59:13Z", "commit": {"oid": "095d769e3a3752c57254f84e5b461167a5dd83fe"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU4MTc1MTcz", "url": "https://github.com/codice/ddf/pull/6464#pullrequestreview-558175173", "createdAt": "2020-12-23T18:55:08Z", "commit": {"oid": "095d769e3a3752c57254f84e5b461167a5dd83fe"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU4MjE4Mjgy", "url": "https://github.com/codice/ddf/pull/6464#pullrequestreview-558218282", "createdAt": "2020-12-23T20:38:36Z", "commit": {"oid": "095d769e3a3752c57254f84e5b461167a5dd83fe"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ba4fbfaadcd4d2fdc811b07a784dda0afbfdf08d", "author": {"user": null}, "url": "https://github.com/codice/ddf/commit/ba4fbfaadcd4d2fdc811b07a784dda0afbfdf08d", "committedDate": "2020-12-28T18:45:12Z", "message": "G-9195 initial commit"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c8ab9dd68a7df776d2c4b9133c398df1d1d1fb70", "author": {"user": null}, "url": "https://github.com/codice/ddf/commit/c8ab9dd68a7df776d2c4b9133c398df1d1d1fb70", "committedDate": "2020-12-28T18:45:12Z", "message": "G-9195 refactor to use query transformer only for csv case"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "26ddf5b603e4edca43e97fa66d602da877950f2a", "author": {"user": null}, "url": "https://github.com/codice/ddf/commit/26ddf5b603e4edca43e97fa66d602da877950f2a", "committedDate": "2020-12-28T18:46:24Z", "message": "G-9195 use query transformers for all non-zipped export"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e0d6046032cb08880cc78f9e8a513d793b81cda8", "author": {"user": null}, "url": "https://github.com/codice/ddf/commit/e0d6046032cb08880cc78f9e8a513d793b81cda8", "committedDate": "2020-12-28T18:46:25Z", "message": "G-9195 formatting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "58ac6f7678712a1877cd4ceb37a11dc960d7b64b", "author": {"user": null}, "url": "https://github.com/codice/ddf/commit/58ac6f7678712a1877cd4ceb37a11dc960d7b64b", "committedDate": "2020-12-28T18:47:02Z", "message": "G-9195 remove accidental line addition"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2ac205e9f14b30dd05837dc286233aebf5076ccd", "author": {"user": null}, "url": "https://github.com/codice/ddf/commit/2ac205e9f14b30dd05837dc286233aebf5076ccd", "committedDate": "2020-12-28T18:47:03Z", "message": "G-9195 refactor"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "095d769e3a3752c57254f84e5b461167a5dd83fe", "author": {"user": null}, "url": "https://github.com/codice/ddf/commit/095d769e3a3752c57254f84e5b461167a5dd83fe", "committedDate": "2020-12-18T14:46:27Z", "message": "G-9195 refactor"}, "afterCommit": {"oid": "2ac205e9f14b30dd05837dc286233aebf5076ccd", "author": {"user": null}, "url": "https://github.com/codice/ddf/commit/2ac205e9f14b30dd05837dc286233aebf5076ccd", "committedDate": "2020-12-28T18:47:03Z", "message": "G-9195 refactor"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 701, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}