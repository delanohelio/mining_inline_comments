{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk1NzczOTQ3", "number": 6361, "reviewThreads": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQyMDozOToxN1rOEpMhEQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQyMTo0MDo0M1rOEpNtwA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExNjMyMTQ1OnYy", "diffSide": "RIGHT", "path": "catalog/rest/catalog-rest-endpoint/src/test/java/org/codice/ddf/endpoints/rest/it/RestEndpointIT.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQyMDozOToxN1rOHaud7w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQyMDozOToxN1rOHaud7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzc4NjM1MQ==", "bodyText": "It's a pain to maintain two environments. Didn't think it was in-scope for this PR, but it made me wonder why we don't run these on top of the kernel", "url": "https://github.com/codice/ddf/pull/6361#discussion_r497786351", "createdAt": "2020-09-30T20:39:17Z", "author": {"login": "SmithJosh"}, "path": "catalog/rest/catalog-rest-endpoint/src/test/java/org/codice/ddf/endpoints/rest/it/RestEndpointIT.java", "diffHunk": "@@ -229,17 +224,22 @@ protected FeatureOption getFeatureOptions() {\n \n       @Override\n       public Option get() {\n+        // Add activation and annotation bundles and expose them via the system bundle. This is\n+        // the same thing that the DDF kernel does, but this test runs on the base Karaf distro, so\n+        // we don't have those changes", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d6f38da494ab572bd102df1b66ad36cbc4aaf0cb"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExNjMyODU2OnYy", "diffSide": "RIGHT", "path": "catalog/spatial/csw/spatial-csw-endpoint/src/test/java/org/codice/ddf/spatial/ogc/csw/catalog/endpoint/reader/TransactionMessageBodyReaderTest.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQyMDo0MTozNFrOHauiXg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQyMDo0MTozNFrOHauiXg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzc4NzQ4Ng==", "bodyText": "There was no change to the DDF JAXB schemas, but for some reason after upgrading JAXB, it started failing to unmarshall this request. I looked at the schema and the namespace here should be csw, so I think JAXB should have been failing on this before as well.", "url": "https://github.com/codice/ddf/pull/6361#discussion_r497787486", "createdAt": "2020-09-30T20:41:34Z", "author": {"login": "SmithJosh"}, "path": "catalog/spatial/csw/spatial-csw-endpoint/src/test/java/org/codice/ddf/spatial/ogc/csw/catalog/endpoint/reader/TransactionMessageBodyReaderTest.java", "diffHunk": "@@ -107,9 +107,9 @@\n           + \"   xmlns:ogc=\\\"http://www.opengis.net/ogc\\\">\\n\"\n           + \"  <csw:Delete typeName=\\\"csw:Record\\\" handle=\\\"something\\\">\\n\"\n           + \"    <csw:Constraint version=\\\"2.0.0\\\">\\n\"\n-          + \"      <ogc:CqlText>\\n\"\n+          + \"      <csw:CqlText>\\n\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d6f38da494ab572bd102df1b66ad36cbc4aaf0cb"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExNjMzNjEwOnYy", "diffSide": "RIGHT", "path": "catalog/spatial/wfs/1.1.0/spatial-wfs-v1_1_0-converter/pom.xml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQyMDo0Mzo1N1rOHaunAA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQyMToyMzo0N1rOHav2Qw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzc4ODY3Mg==", "bodyText": "\u270f\ufe0f Do these FIXMEs need to be addressed?", "url": "https://github.com/codice/ddf/pull/6361#discussion_r497788672", "createdAt": "2020-09-30T20:43:57Z", "author": {"login": "emmberk"}, "path": "catalog/spatial/wfs/1.1.0/spatial-wfs-v1_1_0-converter/pom.xml", "diffHunk": "@@ -101,6 +94,7 @@\n             <artifactId>spatial-wfs-v1_1_0-common</artifactId>\n             <version>${project.version}</version>\n             <exclusions>\n+                <!-- FIXME: There's no cxf-api artifact anymore -->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d6f38da494ab572bd102df1b66ad36cbc4aaf0cb"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzgwODk2Mw==", "bodyText": "I removed the exclusions. Since the artifact doesn't exist the exclusions didn't do anything and it still worked", "url": "https://github.com/codice/ddf/pull/6361#discussion_r497808963", "createdAt": "2020-09-30T21:23:47Z", "author": {"login": "SmithJosh"}, "path": "catalog/spatial/wfs/1.1.0/spatial-wfs-v1_1_0-converter/pom.xml", "diffHunk": "@@ -101,6 +94,7 @@\n             <artifactId>spatial-wfs-v1_1_0-common</artifactId>\n             <version>${project.version}</version>\n             <exclusions>\n+                <!-- FIXME: There's no cxf-api artifact anymore -->", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzc4ODY3Mg=="}, "originalCommit": {"oid": "d6f38da494ab572bd102df1b66ad36cbc4aaf0cb"}, "originalPosition": 43}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExNjM0Mzg1OnYy", "diffSide": "LEFT", "path": "distribution/ddf-common/src/main/resources-filtered/etc/custom.properties", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQyMDo0NjoyMFrOHaurlQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQyMDo0NjoyMFrOHaurlQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzc4OTg0NQ==", "bodyText": "No need for these anymore. JAXB gets installed as a bundle rather than exposing them via the system bundle", "url": "https://github.com/codice/ddf/pull/6361#discussion_r497789845", "createdAt": "2020-09-30T20:46:20Z", "author": {"login": "SmithJosh"}, "path": "distribution/ddf-common/src/main/resources-filtered/etc/custom.properties", "diffHunk": "@@ -100,12 +97,6 @@ org.osgi.framework.system.packages.extra = \\\n     org.xml.sax;version=2.0.2, \\\n     org.xml.sax.ext;uses:=\\\"org.xml.sax,org.xml.sax.helpers\\\";version=2.0.2, \\\n     org.xml.sax.helpers;uses:=org.xml.sax;version=2.0.2, \\\n-    javax.xml.bind;uses:=\\\"javax.xml.bind.annotation.adapters,javax.xml.bind.attachment,javax.xml.namespace,javax.xml.stream,javax.xml.transform,javax.xml.validation,org.w3c.dom,org.xml.sax\\\";version=2.3.0, \\\n-    javax.xml.bind.annotation;uses:=\\\"javax.xml.bind,javax.xml.parsers,javax.xml.transform,javax.xml.transform.dom,org.w3c.dom\\\";version=2.3.0, \\\n-    javax.xml.bind.annotation.adapters;version=2.3.0, \\\n-    javax.xml.bind.attachment;uses:=javax.activation;version=2.3.0, \\\n-    javax.xml.bind.helpers;uses:=\\\"javax.xml.bind,javax.xml.bind.annotation.adapters,javax.xml.bind.attachment,javax.xml.stream,javax.xml.transform,javax.xml.validation,org.w3c.dom,org.xml.sax\\\";version=2.3.0, \\\n-    javax.xml.bind.util;uses:=\\\"javax.xml.bind,javax.xml.transform.sax\\\";version=2.3.0, \\", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d6f38da494ab572bd102df1b66ad36cbc4aaf0cb"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExNjM1OTYxOnYy", "diffSide": "RIGHT", "path": "platform/security/pep/security-pep-interceptor/src/main/java/ddf/security/pep/interceptor/SecurityAssertionStore.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQyMDo1MDo0MFrOHau0-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQyMDo1MDo0MFrOHau0-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzc5MjI0OQ==", "bodyText": "\u270f\ufe0f Add @Nullable annotation", "url": "https://github.com/codice/ddf/pull/6361#discussion_r497792249", "createdAt": "2020-09-30T20:50:40Z", "author": {"login": "emmberk"}, "path": "platform/security/pep/security-pep-interceptor/src/main/java/ddf/security/pep/interceptor/SecurityAssertionStore.java", "diffHunk": "@@ -116,12 +117,16 @@ public static SecurityAssertion getSecurityAssertion(Message message) {\n   }\n \n   /**\n-   * Return the TokenStore associated with this message.\n+   * Return the TokenStore associated with this message\n    *\n    * @param message\n-   * @return TokenStore\n+   * @return the TokenStore, or null if it could not be retrieved\n    */\n   public static TokenStore getTokenStore(Message message) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d6f38da494ab572bd102df1b66ad36cbc4aaf0cb"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExNjM2MDU5OnYy", "diffSide": "RIGHT", "path": "distribution/ddf-common/src/main/resources-filtered/etc/startup.properties", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQyMDo1MDo1NlrOHau1lw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQyMDo1MDo1NlrOHau1lw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzc5MjQwNw==", "bodyText": "Getting the newer JAXB implementation to be used was a pain. servicemix jaxb v2.2 preferred user-installed jaxb implementations over the internal JRE implementation regardless of start order. This is not the case in v2.3; the implementation must be installed before the api [1][2] \ud83e\udd37\u200d\u2642\ufe0f\nThe problem is, Karaf uses the api for its feature support, so it and the impl need to be installed first thing. There were two options:\n\nInstall via startup.properties\nDrop both bundles in the lib directory and expose them via the system bundle.\n\nI picked the first option\nReferences:\n[1] https://github.com/apache/servicemix-specs/blob/master/jaxb-api-2.2/src/main/java/javax/xml/bind/ContextFinder.java#L468-L480\n[2] https://issues.apache.org/jira/browse/SM-4322?focusedCommentId=17058493&page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#comment-17058493", "url": "https://github.com/codice/ddf/pull/6361#discussion_r497792407", "createdAt": "2020-09-30T20:50:56Z", "author": {"login": "SmithJosh"}, "path": "distribution/ddf-common/src/main/resources-filtered/etc/startup.properties", "diffHunk": "@@ -17,4 +17,6 @@ mvn\\:ddf.platform.osgi/platform-osgi-internal-api/${project.version}=9\n mvn\\:ddf.platform.osgi/platform-osgi-configadmin/${project.version}=10\n mvn\\:org.apache.felix/org.apache.felix.configadmin/${felix.configadmin.version}=11\n mvn\\:org.apache.felix/org.apache.felix.fileinstall/${felix.fileinstall.version}=12\n+mvn\\:org.apache.servicemix.specs/org.apache.servicemix.specs.jaxb-api-2.3/2.3_3=13\n+mvn\\:org.apache.servicemix.bundles/org.apache.servicemix.bundles.jaxb-runtime/2.3.2_2=14", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d6f38da494ab572bd102df1b66ad36cbc4aaf0cb"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExNjM2NzQzOnYy", "diffSide": "RIGHT", "path": "distribution/ddf-common/src/main/resources/common-bin.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQyMDo1Mjo1N1rOHau5vg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQyMDo1Mjo1N1rOHau5vg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzc5MzQ3MA==", "bodyText": "\u2757 TODO: Need to substitute these versions", "url": "https://github.com/codice/ddf/pull/6361#discussion_r497793470", "createdAt": "2020-09-30T20:52:57Z", "author": {"login": "SmithJosh"}, "path": "distribution/ddf-common/src/main/resources/common-bin.xml", "diffHunk": "@@ -381,5 +381,25 @@\n                 </include>\n             </includes>\n         </dependencySet>\n+        <dependencySet>\n+            <outputDirectory>\n+                system/org/apache/servicemix/specs/org.apache.servicemix.specs.jaxb-api-2.3/2.3_3\n+            </outputDirectory>\n+            <includes>\n+                <include>\n+                    org.apache.servicemix.specs:org.apache.servicemix.specs.jaxb-api-2.3:jar:2.3_3\n+                </include>\n+            </includes>\n+        </dependencySet>\n+        <dependencySet>\n+            <outputDirectory>\n+                system/org/apache/servicemix/bundles/org.apache.servicemix.bundles.jaxb-runtime/2.3.2_2\n+            </outputDirectory>\n+            <includes>\n+                <include>\n+                    org.apache.servicemix.bundles:org.apache.servicemix.bundles.jaxb-runtime:jar:2.3.2_2", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d6f38da494ab572bd102df1b66ad36cbc4aaf0cb"}, "originalPosition": 20}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExNjM2OTgwOnYy", "diffSide": "RIGHT", "path": "distribution/ddf-common/src/main/resources/etc/jre.properties", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQyMDo1MzozM1rOHau7JQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQyMDo1MzozM1rOHau7JQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzc5MzgyOQ==", "bodyText": "Don't want to use the JRE JAXB implementation", "url": "https://github.com/codice/ddf/pull/6361#discussion_r497793829", "createdAt": "2020-09-30T20:53:33Z", "author": {"login": "SmithJosh"}, "path": "distribution/ddf-common/src/main/resources/etc/jre.properties", "diffHunk": "@@ -422,12 +422,12 @@ jre-1.8= \\\n  javax.tools, \\\n  javax.transaction; javax.transaction.xa; partial=true; mandatory:=partial, \\\n  javax.xml, \\\n- javax.xml.bind;version=\"2.2.8\", \\\n- javax.xml.bind.annotation;version=\"2.2.8\", \\\n- javax.xml.bind.annotation.adapters;version=\"2.2.8\", \\\n- javax.xml.bind.attachment;version=\"2.2.8\", \\\n- javax.xml.bind.helpers;version=\"2.2.8\", \\\n- javax.xml.bind.util;version=\"2.2.8\", \\\n+# javax.xml.bind;version=\"2.3.0\", \\\n+# javax.xml.bind.annotation;version=\"2.3.0\", \\\n+# javax.xml.bind.annotation.adapters;version=\"2.3.0\", \\\n+# javax.xml.bind.attachment;version=\"2.3.0\", \\\n+# javax.xml.bind.helpers;version=\"2.3.0\", \\\n+# javax.xml.bind.util;version=\"2.3.0\", \\", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d6f38da494ab572bd102df1b66ad36cbc4aaf0cb"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExNjM5MjIyOnYy", "diffSide": "LEFT", "path": "libs/bundles/libs-bundles-opensaml/pom.xml", "isResolved": false, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQyMTowMDoxOVrOHavJDw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQyMTowMDoyNFrOHctoaw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzc5NzM5MQ==", "bodyText": "After previous discussions about removing this, I ended up going ahead and doing it. The reason was that the Servicemix OpenSAML bundle now has no version constraint on the Guava version is uses. See: https://github.com/apache/servicemix-bundles/blob/master/opensaml-3.4.5/pom.xml#L63\nThis means it will pick up the Guava version that DDF uses automatically; we don't need to force the version here. Note, though, that we have to make sure that there is only one Guava version available or there will be uses constraint violations.\nI'm open to keeping this bundle if we think that's a better option. But these changes work just fine without it.\nTagging @Lambeaux", "url": "https://github.com/codice/ddf/pull/6361#discussion_r497797391", "createdAt": "2020-09-30T21:00:19Z", "author": {"login": "SmithJosh"}, "path": "libs/bundles/libs-bundles-opensaml/pom.xml", "diffHunk": "@@ -1,223 +0,0 @@\n-<?xml version=\"1.0\" encoding=\"UTF-8\"?>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d6f38da494ab572bd102df1b66ad36cbc4aaf0cb"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzgxODMzNw==", "bodyText": "I vote we remove it.", "url": "https://github.com/codice/ddf/pull/6361#discussion_r497818337", "createdAt": "2020-09-30T21:43:59Z", "author": {"login": "stustison"}, "path": "libs/bundles/libs-bundles-opensaml/pom.xml", "diffHunk": "@@ -1,223 +0,0 @@\n-<?xml version=\"1.0\" encoding=\"UTF-8\"?>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzc5NzM5MQ=="}, "originalCommit": {"oid": "d6f38da494ab572bd102df1b66ad36cbc4aaf0cb"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODU1MTU0NA==", "bodyText": "(\u2757 ) If only one Guava version can be available, then this may break some Camel features. Check out the Camel features file:\n<feature name=\"camel-protobuf\" version=\"${camel.version}\" start-level=\"50\">\n        <feature version=\"${camel.version}\">camel-core</feature>\n        <bundle dependency=\"true\">mvn:com.google.protobuf/protobuf-java/${protobuf-version}</bundle>\n        <bundle dependency=\"true\">mvn:com.google.protobuf/protobuf-java-util/${protobuf-version}</bundle>\n        <bundle dependency=\"true\">mvn:commons-io/commons-io/${commons-io-version}</bundle>\n        <bundle dependency=\"true\">mvn:com.google.guava/guava/${camel.guava.version}</bundle>\n        <bundle dependency=\"true\">mvn:com.google.code.gson/gson/${gson.version}</bundle>\n        <bundle>mvn:org.apache.camel/camel-protobuf/${camel.version}</bundle>\n    </feature>\n\nIt appears the Camel version of Guava is lower than DDF's version of Guava.\n<camel.guava.version>19.0</camel.guava.version>", "url": "https://github.com/codice/ddf/pull/6361#discussion_r498551544", "createdAt": "2020-10-01T22:57:43Z", "author": {"login": "Lambeaux"}, "path": "libs/bundles/libs-bundles-opensaml/pom.xml", "diffHunk": "@@ -1,223 +0,0 @@\n-<?xml version=\"1.0\" encoding=\"UTF-8\"?>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzc5NzM5MQ=="}, "originalCommit": {"oid": "d6f38da494ab572bd102df1b66ad36cbc4aaf0cb"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTc1NTIyNQ==", "bodyText": "Turns out this is actually a lot more nuanced than I was thinking. Interestingly, installing the feature you linked also causes uses constraint violations on 2.26.0. It's not just these changes - DDF cannot have two Gauva versions installed at the same time. Here's a sample of the constraint violations you see if it does:\n2020-10-05T08:56:24,035 | DEBUG | tures-3-thread-1 | ResolverImpl                     | ternal.resolver.Slf4jResolverLog   45 | 17 - org.apache.karaf.features.core - 4.2.9 | Candidate permutation failed due to a conflict between imports; will try another if possible. (Uses constraint violation. Unable to resolve resource solr-factory-impl [solr-factory-impl/2.26.0] because it is exposed to package 'com.google.common.collect' from resources com.google.guava [com.google.guava/25.1.0.jre] and com.google.guava [com.google.guava/25.1.0.jre] via two dependency chains.\n\nChain 1:\n  solr-factory-impl [solr-factory-impl/2.26.0]\n    import: (&(osgi.wiring.package=com.google.common.collect)(version>=25.1.0)(!(version>=26.0.0)))\n     |\n    export: osgi.wiring.package: com.google.common.collect\n  com.google.guava [com.google.guava/25.1.0.jre]\n\nChain 2:\n  solr-factory-impl [solr-factory-impl/2.26.0]\n    import: (&(osgi.wiring.package=org.codice.ddf.platform.util)(version>=2.26.0)(!(version>=3.0.0)))\n     |\n    export: osgi.wiring.package=org.codice.ddf.platform.util; uses:=com.google.common.io\n  platform-util [platform-util/2.26.0]\n    import: (&(osgi.wiring.package=com.google.common.io)(version>=25.1.0)(!(version>=26.0.0)))\n     |\n    export: osgi.wiring.package: com.google.common.io; uses:=com.google.common.collect\n    export: osgi.wiring.package=com.google.common.collect\n  com.google.guava [com.google.guava/25.1.0.jre])\n\nA couple notes:\n\nThis isn't actually an error, just a Karaf debug message. I found that interesting - there are non-fatal uses constraint violations. However, while it doesn't break anything Karaf takes significantly longer to resolve bundle wiring. On my machine, a profile:install standard took about 6 minutes compared to 1 minute normally.\nThe error message here is a bit confusing since it references 25.1.0.jre for both dependency chains. It's really an issue with the uses constrains being satisfied by both versions of Guava present.\nPart of the problem is DDFs own leaky abstractions: platform-util exposes Guava in its API. Meaning anything that uses Guava and platform-util will have uses constraints violations if two Guava versions are present.\n\nThe only reason DDF 2.26.0 doesn't have these issues by default is that it doesn't install multiple Guava versions. That surprised me because the CXF and DDF versions differ. I dug into it a bit and it's because CXF uses the dependency flag in its feature descriptor. From the Karaf mailing list, here's a description of the dependency flag (http://karaf.922171.n3.nabble.com/features-xml-dependency-true-tp3286359p3288842.html):\n\nThe role of the dependency attribute is to mark that a bundle is a dependency. If a dependency is already satisfied (an existing bundle already exports the same packages/version) then it doesn't get installed. This behavior happens if the declared feature resolver is installed (e.g. obr is installed).\n\nThe wrapped OpenSAML bundle imports Guava packages with the version matching the DDF Guava version. So when when Karaf installs OpenSAML, it sees that the imports are already satisfied and so doesn't try to install the CXF Guava version (note, CXF itself doesn't import Guava. It only pulls it in to satisfy OpenSAML). Now that we're using the OpenSAML bundle without a version constraint, it appears Karaf doesn't think the imports are already satisfied and so installs the new version.\nTo summarize: with these changes, the only difference from master is that the CXF and DDF Guava versions must match to prevent uses constraint violations. With or without these changes, the presence of multiple Guava versions is problematic and will cause non-fatal uses constraint violations and significantly longer installation times.", "url": "https://github.com/codice/ddf/pull/6361#discussion_r499755225", "createdAt": "2020-10-05T17:21:56Z", "author": {"login": "SmithJosh"}, "path": "libs/bundles/libs-bundles-opensaml/pom.xml", "diffHunk": "@@ -1,223 +0,0 @@\n-<?xml version=\"1.0\" encoding=\"UTF-8\"?>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzc5NzM5MQ=="}, "originalCommit": {"oid": "d6f38da494ab572bd102df1b66ad36cbc4aaf0cb"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTg1NzExMg==", "bodyText": "That's some quality background and investigation. Even though we can get the container to start I still believe that 6 minutes to start is just as bad as a borked container that doesn't work at all because you have to wait far too long (synchronously) to learn if you've succeeded or failed. So for future readers of this - know that wiring issues like the above are basically fatal even if the container is capable of recovering.\nTo add to the above \u261d\ufe0f the OpenSAML bundle needed to be wrapped because, as of October of last year, no new versions existed without the transitive version constraint. As @SmithJosh pointed out, this has recently been resolved with several new artifacts released from servicemix.\nAdditionally, between the time I upgraded Guava and this change, the class path complexity has increased. Platform-util is now a bundle which itself exposes Guava.\nGuava upgrade: #5379\nPlatform util: #5776\nThis means that, while the Camel feature may have worked fine last year, it no longer does. Likely because of a new class path collision with platform util's Guava and the code that Camel needs.\nGiven the wrapper is no longer serving any purpose I'm +1 to remove it now, as well. \ud83d\udc4d", "url": "https://github.com/codice/ddf/pull/6361#discussion_r499857112", "createdAt": "2020-10-05T20:35:51Z", "author": {"login": "Lambeaux"}, "path": "libs/bundles/libs-bundles-opensaml/pom.xml", "diffHunk": "@@ -1,223 +0,0 @@\n-<?xml version=\"1.0\" encoding=\"UTF-8\"?>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzc5NzM5MQ=="}, "originalCommit": {"oid": "d6f38da494ab572bd102df1b66ad36cbc4aaf0cb"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTg2OTgwMw==", "bodyText": "Thanks @Lambeaux. Completely agree with this:\n\nEven though we can get the container to start I still believe that 6 minutes to start is just as bad as a borked container that doesn't work at all because you have to wait far too long (synchronously) to learn if you've succeeded or failed\n\nI created #6365 to fix it", "url": "https://github.com/codice/ddf/pull/6361#discussion_r499869803", "createdAt": "2020-10-05T21:00:24Z", "author": {"login": "SmithJosh"}, "path": "libs/bundles/libs-bundles-opensaml/pom.xml", "diffHunk": "@@ -1,223 +0,0 @@\n-<?xml version=\"1.0\" encoding=\"UTF-8\"?>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzc5NzM5MQ=="}, "originalCommit": {"oid": "d6f38da494ab572bd102df1b66ad36cbc4aaf0cb"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExNjM5NDQ0OnYy", "diffSide": "LEFT", "path": "platform/security/core/security-core-impl/pom.xml", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQyMTowMTowMFrOHavKWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQyMTowMTowMFrOHavKWQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzc5NzcyMQ==", "bodyText": "bnd figures out these imports just fine", "url": "https://github.com/codice/ddf/pull/6361#discussion_r497797721", "createdAt": "2020-09-30T21:01:00Z", "author": {"login": "SmithJosh"}, "path": "platform/security/core/security-core-impl/pom.xml", "diffHunk": "@@ -252,8 +232,6 @@\n                             !org.mockito*,\n                             !org.hamcrest*,\n                             !org.junit*,\n-                            org.opensaml.xmlsec.signature.support.provider,\n-                            org.opensaml.*;version=\"${opensaml.version}\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d6f38da494ab572bd102df1b66ad36cbc4aaf0cb"}, "originalPosition": 55}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExNjQxMzE0OnYy", "diffSide": "RIGHT", "path": "platform/security/pep/security-pep-interceptor/src/main/java/ddf/security/pep/interceptor/SecurityAssertionStore.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQyMTowNjo1NFrOHavWCw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQwMDoyNTo0OVrOHaz5Fg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzgwMDcxNQ==", "bodyText": "The only code change for this PR \ud83c\udf89\nIf this is null, we just return a new SecurityAssertionSaml instance. I'm not sure if that's what we actually want, as the code looks like we were not expecting the token store to be null. Would appreciate another set of eyes.\nhttps://github.com/codice/ddf/blob/master/platform/security/pep/security-pep-interceptor/src/main/java/ddf/security/pep/interceptor/SecurityAssertionStore.java#L115", "url": "https://github.com/codice/ddf/pull/6361#discussion_r497800715", "createdAt": "2020-09-30T21:06:54Z", "author": {"login": "SmithJosh"}, "path": "platform/security/pep/security-pep-interceptor/src/main/java/ddf/security/pep/interceptor/SecurityAssertionStore.java", "diffHunk": "@@ -116,12 +117,16 @@ public static SecurityAssertion getSecurityAssertion(Message message) {\n   }\n \n   /**\n-   * Return the TokenStore associated with this message.\n+   * Return the TokenStore associated with this message\n    *\n    * @param message\n-   * @return TokenStore\n+   * @return the TokenStore, or null if it could not be retrieved\n    */\n   public static TokenStore getTokenStore(Message message) {\n-    return TokenStoreUtils.getTokenStore(message);\n+    try {\n+      return TokenStoreUtils.getTokenStore(message);\n+    } catch (TokenStoreException e) {\n+      return null;\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d6f38da494ab572bd102df1b66ad36cbc4aaf0cb"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzgyMjg2Ng==", "bodyText": "It will work correctly the way it is and the PEP still fails closed as long as the token for the assertion is null, which it will be if you just create an empty SAML assertion. However, it might be more correct if we just return an exception if the token store is null or in the case where we might flow down to returning that empty SecurityAssertionSaml instance. I think all that empty instance does is trigger the error condition anyways, so we may as well just jump there. That way we can avoid someone changing the PEP in the future and this possibly failing open at some point.", "url": "https://github.com/codice/ddf/pull/6361#discussion_r497822866", "createdAt": "2020-09-30T21:54:14Z", "author": {"login": "stustison"}, "path": "platform/security/pep/security-pep-interceptor/src/main/java/ddf/security/pep/interceptor/SecurityAssertionStore.java", "diffHunk": "@@ -116,12 +117,16 @@ public static SecurityAssertion getSecurityAssertion(Message message) {\n   }\n \n   /**\n-   * Return the TokenStore associated with this message.\n+   * Return the TokenStore associated with this message\n    *\n    * @param message\n-   * @return TokenStore\n+   * @return the TokenStore, or null if it could not be retrieved\n    */\n   public static TokenStore getTokenStore(Message message) {\n-    return TokenStoreUtils.getTokenStore(message);\n+    try {\n+      return TokenStoreUtils.getTokenStore(message);\n+    } catch (TokenStoreException e) {\n+      return null;\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzgwMDcxNQ=="}, "originalCommit": {"oid": "d6f38da494ab572bd102df1b66ad36cbc4aaf0cb"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzg3NTIyMg==", "bodyText": "Ok thanks for confirming. I'm inclined to keep it as-is in that case since the PEP still denies access. I checked and the PEP has tests for null tokens and null assertions so that should raise some flags if it starts failing open.", "url": "https://github.com/codice/ddf/pull/6361#discussion_r497875222", "createdAt": "2020-10-01T00:25:49Z", "author": {"login": "SmithJosh"}, "path": "platform/security/pep/security-pep-interceptor/src/main/java/ddf/security/pep/interceptor/SecurityAssertionStore.java", "diffHunk": "@@ -116,12 +117,16 @@ public static SecurityAssertion getSecurityAssertion(Message message) {\n   }\n \n   /**\n-   * Return the TokenStore associated with this message.\n+   * Return the TokenStore associated with this message\n    *\n    * @param message\n-   * @return TokenStore\n+   * @return the TokenStore, or null if it could not be retrieved\n    */\n   public static TokenStore getTokenStore(Message message) {\n-    return TokenStoreUtils.getTokenStore(message);\n+    try {\n+      return TokenStoreUtils.getTokenStore(message);\n+    } catch (TokenStoreException e) {\n+      return null;\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzgwMDcxNQ=="}, "originalCommit": {"oid": "d6f38da494ab572bd102df1b66ad36cbc4aaf0cb"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzExNjUxNzc2OnYy", "diffSide": "RIGHT", "path": "catalog/transformer/catalog-transformer-xlsx/pom.xml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQyMTo0MDo0M1rOHawU0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQwMDoyMDowM1rOHazrlw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzgxNjc4NQ==", "bodyText": "platform-util is a bundle so it shouldn't be embedded. I must have missed this when I removed it from all the poms or maybe it was added after I changed things.", "url": "https://github.com/codice/ddf/pull/6361#discussion_r497816785", "createdAt": "2020-09-30T21:40:43Z", "author": {"login": "stustison"}, "path": "catalog/transformer/catalog-transformer-xlsx/pom.xml", "diffHunk": "@@ -84,8 +75,7 @@\n                     <instructions>\n                         <Embed-Dependency>\n                             catalog-core-api-impl,\n-                            platform-util,\n-                            security-rest-clientapi\n+                            platform-util", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d6f38da494ab572bd102df1b66ad36cbc4aaf0cb"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzg3MTc2Nw==", "bodyText": "ok I'll remove it", "url": "https://github.com/codice/ddf/pull/6361#discussion_r497871767", "createdAt": "2020-10-01T00:20:03Z", "author": {"login": "SmithJosh"}, "path": "catalog/transformer/catalog-transformer-xlsx/pom.xml", "diffHunk": "@@ -84,8 +75,7 @@\n                     <instructions>\n                         <Embed-Dependency>\n                             catalog-core-api-impl,\n-                            platform-util,\n-                            security-rest-clientapi\n+                            platform-util", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzgxNjc4NQ=="}, "originalCommit": {"oid": "d6f38da494ab572bd102df1b66ad36cbc4aaf0cb"}, "originalPosition": 22}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4486, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}