{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY5MzU2MzQ1", "number": 5807, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxOToyMToxMlrODdGR8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxOToyMzowM1rODdGUCw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxODM4MTk0OnYy", "diffSide": "RIGHT", "path": "catalog/solr/catalog-solr-provider/src/main/java/ddf/catalog/solr/provider/InjectedAttributeListener.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxOToyMToxM1rOFlgZvg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxOTo0NzowMFrOFlhLyg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDg3MjUxMA==", "bodyText": "Could you add some javadoc that gives a high level description?", "url": "https://github.com/codice/ddf/pull/5807#discussion_r374872510", "createdAt": "2020-02-04T19:21:13Z", "author": {"login": "glenhein"}, "path": "catalog/solr/catalog-solr-provider/src/main/java/ddf/catalog/solr/provider/InjectedAttributeListener.java", "diffHunk": "@@ -0,0 +1,96 @@\n+/**\n+ * Copyright (c) Codice Foundation\n+ *\n+ * <p>This is free software: you can redistribute it and/or modify it under the terms of the GNU\n+ * Lesser General Public License as published by the Free Software Foundation, either version 3 of\n+ * the License, or any later version.\n+ *\n+ * <p>This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;\n+ * without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * GNU Lesser General Public License for more details. A copy of the GNU Lesser General Public\n+ * License is distributed along with this program and can be found at\n+ * <http://www.gnu.org/licenses/lgpl.html>.\n+ */\n+package ddf.catalog.solr.provider;\n+\n+import ddf.catalog.data.AttributeDescriptor;\n+import ddf.catalog.data.AttributeRegistry;\n+import ddf.catalog.data.InjectableAttribute;\n+import ddf.catalog.source.solr.DynamicSchemaResolver;\n+import java.util.Arrays;\n+import java.util.Collection;\n+import java.util.Objects;\n+import java.util.Optional;\n+import org.osgi.framework.Bundle;\n+import org.osgi.framework.BundleContext;\n+import org.osgi.framework.FrameworkUtil;\n+import org.osgi.framework.InvalidSyntaxException;\n+import org.osgi.framework.ServiceEvent;\n+import org.osgi.framework.ServiceListener;\n+import org.osgi.framework.ServiceReference;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+public class InjectedAttributeListener implements ServiceListener {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4a442c97f32298f838adcc6ba40b8802a4d84f29"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDg4NTMyMg==", "bodyText": "done", "url": "https://github.com/codice/ddf/pull/5807#discussion_r374885322", "createdAt": "2020-02-04T19:47:00Z", "author": {"login": "derekwilhelm"}, "path": "catalog/solr/catalog-solr-provider/src/main/java/ddf/catalog/solr/provider/InjectedAttributeListener.java", "diffHunk": "@@ -0,0 +1,96 @@\n+/**\n+ * Copyright (c) Codice Foundation\n+ *\n+ * <p>This is free software: you can redistribute it and/or modify it under the terms of the GNU\n+ * Lesser General Public License as published by the Free Software Foundation, either version 3 of\n+ * the License, or any later version.\n+ *\n+ * <p>This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;\n+ * without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * GNU Lesser General Public License for more details. A copy of the GNU Lesser General Public\n+ * License is distributed along with this program and can be found at\n+ * <http://www.gnu.org/licenses/lgpl.html>.\n+ */\n+package ddf.catalog.solr.provider;\n+\n+import ddf.catalog.data.AttributeDescriptor;\n+import ddf.catalog.data.AttributeRegistry;\n+import ddf.catalog.data.InjectableAttribute;\n+import ddf.catalog.source.solr.DynamicSchemaResolver;\n+import java.util.Arrays;\n+import java.util.Collection;\n+import java.util.Objects;\n+import java.util.Optional;\n+import org.osgi.framework.Bundle;\n+import org.osgi.framework.BundleContext;\n+import org.osgi.framework.FrameworkUtil;\n+import org.osgi.framework.InvalidSyntaxException;\n+import org.osgi.framework.ServiceEvent;\n+import org.osgi.framework.ServiceListener;\n+import org.osgi.framework.ServiceReference;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+public class InjectedAttributeListener implements ServiceListener {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDg3MjUxMA=="}, "originalCommit": {"oid": "4a442c97f32298f838adcc6ba40b8802a4d84f29"}, "originalPosition": 34}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMxODM4NzMxOnYy", "diffSide": "RIGHT", "path": "catalog/solr/catalog-solr-provider/src/main/java/ddf/catalog/solr/provider/InjectedAttributeListener.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxOToyMzowM1rOFlgdVQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNFQxOToyMzowM1rOFlgdVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDg3MzQyOQ==", "bodyText": "\u270f\ufe0f \u270f\ufe0f I would eliminate the eventType variable, since it's only used once and doesn't add to readability.", "url": "https://github.com/codice/ddf/pull/5807#discussion_r374873429", "createdAt": "2020-02-04T19:23:03Z", "author": {"login": "glenhein"}, "path": "catalog/solr/catalog-solr-provider/src/main/java/ddf/catalog/solr/provider/InjectedAttributeListener.java", "diffHunk": "@@ -0,0 +1,96 @@\n+/**\n+ * Copyright (c) Codice Foundation\n+ *\n+ * <p>This is free software: you can redistribute it and/or modify it under the terms of the GNU\n+ * Lesser General Public License as published by the Free Software Foundation, either version 3 of\n+ * the License, or any later version.\n+ *\n+ * <p>This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;\n+ * without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * GNU Lesser General Public License for more details. A copy of the GNU Lesser General Public\n+ * License is distributed along with this program and can be found at\n+ * <http://www.gnu.org/licenses/lgpl.html>.\n+ */\n+package ddf.catalog.solr.provider;\n+\n+import ddf.catalog.data.AttributeDescriptor;\n+import ddf.catalog.data.AttributeRegistry;\n+import ddf.catalog.data.InjectableAttribute;\n+import ddf.catalog.source.solr.DynamicSchemaResolver;\n+import java.util.Arrays;\n+import java.util.Collection;\n+import java.util.Objects;\n+import java.util.Optional;\n+import org.osgi.framework.Bundle;\n+import org.osgi.framework.BundleContext;\n+import org.osgi.framework.FrameworkUtil;\n+import org.osgi.framework.InvalidSyntaxException;\n+import org.osgi.framework.ServiceEvent;\n+import org.osgi.framework.ServiceListener;\n+import org.osgi.framework.ServiceReference;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+public class InjectedAttributeListener implements ServiceListener {\n+\n+  private static final Logger LOGGER = LoggerFactory.getLogger(InjectedAttributeListener.class);\n+\n+  private BundleContext context;\n+  private DynamicSchemaResolver resolver;\n+  private AttributeRegistry attributeRegistry;\n+\n+  public InjectedAttributeListener(\n+      DynamicSchemaResolver resolver, AttributeRegistry attributeRegistry) {\n+    this.resolver = resolver;\n+    this.attributeRegistry = attributeRegistry;\n+  }\n+\n+  public void init() {\n+    Bundle bundle = FrameworkUtil.getBundle(this.getClass());\n+    context = bundle.getBundleContext();\n+    try {\n+      String filter = \"(objectClass=\" + InjectableAttribute.class.getName() + \")\";\n+      context.addServiceListener(this, filter);\n+\n+      Collection<ServiceReference<InjectableAttribute>> alreadyRegistered =\n+          context.getServiceReferences(InjectableAttribute.class, null);\n+      alreadyRegistered\n+          .stream()\n+          .map(context::getService)\n+          .filter(Objects::nonNull)\n+          .map(InjectableAttribute::attribute)\n+          .forEach(this::registerAttribute);\n+    } catch (InvalidSyntaxException e) {\n+      LOGGER.warn(\"Unable to register listener for injected attributes\", e);\n+    }\n+  }\n+\n+  public void close() {\n+    if (context != null) {\n+      context.removeServiceListener(this);\n+    }\n+  }\n+\n+  public void serviceChanged(ServiceEvent event) {\n+    ServiceReference serviceRef = event.getServiceReference();\n+    Object service = context.getService(serviceRef);\n+    if (service instanceof InjectableAttribute) {\n+      int eventType = event.getType();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4a442c97f32298f838adcc6ba40b8802a4d84f29"}, "originalPosition": 78}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4786, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}