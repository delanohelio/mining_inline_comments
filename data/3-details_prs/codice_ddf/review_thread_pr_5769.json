{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYzMjM2OTk0", "number": 5769, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQxNjo1NjoxMVrODYPm_A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQxNTozNjoxNlrODdufxw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI2NzQ4MTU2OnYy", "diffSide": "RIGHT", "path": "platform/security/rest/security-rest-clientapi/src/main/java/org/codice/ddf/cxf/client/SecureCxfClientFactory.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQxNjo1NjoxMVrOFd_Xvw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQxODozNTowOVrOFeCUGw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Njk5MTI5NQ==", "bodyText": "\u2753 Why did you need to add this? It looks like it isn't used anywhere.", "url": "https://github.com/codice/ddf/pull/5769#discussion_r366991295", "createdAt": "2020-01-15T16:56:11Z", "author": {"login": "stustison"}, "path": "platform/security/rest/security-rest-clientapi/src/main/java/org/codice/ddf/cxf/client/SecureCxfClientFactory.java", "diffHunk": "@@ -42,6 +42,13 @@\n    */\n   WebClient getWebClient();\n \n+  /**\n+   * Returns the WebClient\n+   *\n+   * @return\n+   */\n+  WebClient getWebSystemClient();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "93bb3b82add5a6b86461d901e371f0ad9c7e0245"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzAzOTUxNQ==", "bodyText": "It will not be used in DDF but downstream distributions will use it.", "url": "https://github.com/codice/ddf/pull/5769#discussion_r367039515", "createdAt": "2020-01-15T18:35:09Z", "author": {"login": "blen-desta"}, "path": "platform/security/rest/security-rest-clientapi/src/main/java/org/codice/ddf/cxf/client/SecureCxfClientFactory.java", "diffHunk": "@@ -42,6 +42,13 @@\n    */\n   WebClient getWebClient();\n \n+  /**\n+   * Returns the WebClient\n+   *\n+   * @return\n+   */\n+  WebClient getWebSystemClient();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Njk5MTI5NQ=="}, "originalCommit": {"oid": "93bb3b82add5a6b86461d901e371f0ad9c7e0245"}, "originalPosition": 9}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI2ODM2OTQzOnYy", "diffSide": "LEFT", "path": "catalog/core/catalog-core-urlresourcereader/pom.xml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQyMjoxMjozMVrOFeIH1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQyMzozMjo0NFrOFeJzcQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzEzNDY3OA==", "bodyText": "\u2753 Can you add a test for this?", "url": "https://github.com/codice/ddf/pull/5769#discussion_r367134678", "createdAt": "2020-01-15T22:12:31Z", "author": {"login": "SmithJosh"}, "path": "catalog/core/catalog-core-urlresourcereader/pom.xml", "diffHunk": "@@ -154,12 +154,12 @@\n                                         <limit implementation=\"org.codice.jacoco.LenientLimit\">\n                                             <counter>INSTRUCTION</counter>\n                                             <value>COVEREDRATIO</value>\n-                                            <minimum>0.70</minimum>\n+                                            <minimum>0.68</minimum>\n                                         </limit>\n                                         <limit implementation=\"org.codice.jacoco.LenientLimit\">\n                                             <counter>BRANCH</counter>\n                                             <value>COVEREDRATIO</value>\n-                                            <minimum>0.64</minimum>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "93bb3b82add5a6b86461d901e371f0ad9c7e0245"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzE2MjIyNQ==", "bodyText": "Yes I will that whole method was not tested", "url": "https://github.com/codice/ddf/pull/5769#discussion_r367162225", "createdAt": "2020-01-15T23:32:44Z", "author": {"login": "blen-desta"}, "path": "catalog/core/catalog-core-urlresourcereader/pom.xml", "diffHunk": "@@ -154,12 +154,12 @@\n                                         <limit implementation=\"org.codice.jacoco.LenientLimit\">\n                                             <counter>INSTRUCTION</counter>\n                                             <value>COVEREDRATIO</value>\n-                                            <minimum>0.70</minimum>\n+                                            <minimum>0.68</minimum>\n                                         </limit>\n                                         <limit implementation=\"org.codice.jacoco.LenientLimit\">\n                                             <counter>BRANCH</counter>\n                                             <value>COVEREDRATIO</value>\n-                                            <minimum>0.64</minimum>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzEzNDY3OA=="}, "originalCommit": {"oid": "93bb3b82add5a6b86461d901e371f0ad9c7e0245"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI4NjEyNzE3OnYy", "diffSide": "RIGHT", "path": "catalog/core/catalog-core-urlresourcereader/src/main/java/ddf/catalog/resource/impl/URLResourceReader.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwMDozMzowNVrOFgvpwg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwMDozMzowNVrOFgvpwg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTg3OTQ5MA==", "bodyText": "I get a compilation error when building. This test needs to be updated with the new getWebClient method signature:\nhttps://github.com/codice/ddf/blob/master/catalog/spatial/ogc/spatial-ogc-urlresourcereader/src/test/java/org/codice/ddf/spatial/ogc/catalog/resource/impl/ResourceReaderTest.java#L94-L95", "url": "https://github.com/codice/ddf/pull/5769#discussion_r369879490", "createdAt": "2020-01-23T00:33:05Z", "author": {"login": "SmithJosh"}, "path": "catalog/core/catalog-core-urlresourcereader/src/main/java/ddf/catalog/resource/impl/URLResourceReader.java", "diffHunk": "@@ -583,7 +594,8 @@ private boolean validateFilePath(File resourceFilePath) throws IOException {\n     return false;\n   }\n \n-  protected WebClient getWebClient(String uri, Map<String, Serializable> properties) {\n+  @VisibleForTesting\n+  WebClient getWebClient(String uri, Map<String, Serializable> properties) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3515a6e61a9a2960357958ce0daa405d9ad7b4a7"}, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMwMzI3MzA1OnYy", "diffSide": "RIGHT", "path": "platform/security/rest/security-rest-cxfwrapper/src/main/java/org/codice/ddf/cxf/oauth/OAuthSecurityImpl.java", "isResolved": true, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQxNzoyODozNVrOFjRGBQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQyMTowNTo0OVrOFjXeSA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjUyNDU0OQ==", "bodyText": "I already approved, but we have a configuration for OAuth handler which determines the scopes that will be requested from the auth server. Wondering if we should include the full set from that config here as well", "url": "https://github.com/codice/ddf/pull/5769#discussion_r372524549", "createdAt": "2020-01-29T17:28:35Z", "author": {"login": "SmithJosh"}, "path": "platform/security/rest/security-rest-cxfwrapper/src/main/java/org/codice/ddf/cxf/oauth/OAuthSecurityImpl.java", "diffHunk": "@@ -324,6 +326,7 @@ private String getNewAccessToken(\n \n     Form formParam = new Form(GRANT_TYPE, grantType);\n     queryParameters.forEach(formParam::param);\n+    formParam.param(SCOPE, OPENID_SCOPE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9cb5f2a960b768230047032429c9dfee00960ec2"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjU2NTAxMQ==", "bodyText": "The problem is that the configuration for the OAuth handler is separate. This code is for federating and that is for login so they could be connected to two different providers.", "url": "https://github.com/codice/ddf/pull/5769#discussion_r372565011", "createdAt": "2020-01-29T18:48:36Z", "author": {"login": "blen-desta"}, "path": "platform/security/rest/security-rest-cxfwrapper/src/main/java/org/codice/ddf/cxf/oauth/OAuthSecurityImpl.java", "diffHunk": "@@ -324,6 +326,7 @@ private String getNewAccessToken(\n \n     Form formParam = new Form(GRANT_TYPE, grantType);\n     queryParameters.forEach(formParam::param);\n+    formParam.param(SCOPE, OPENID_SCOPE);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjUyNDU0OQ=="}, "originalCommit": {"oid": "9cb5f2a960b768230047032429c9dfee00960ec2"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjU2OTg0Nw==", "bodyText": "Do we see a use case where these federation scopes would need to be configurable? If so, I would imagine that would live in the source configuration somewhere, but \ud83e\udd37\u200d\u2642", "url": "https://github.com/codice/ddf/pull/5769#discussion_r372569847", "createdAt": "2020-01-29T18:57:52Z", "author": {"login": "bakejeyner"}, "path": "platform/security/rest/security-rest-cxfwrapper/src/main/java/org/codice/ddf/cxf/oauth/OAuthSecurityImpl.java", "diffHunk": "@@ -324,6 +326,7 @@ private String getNewAccessToken(\n \n     Form formParam = new Form(GRANT_TYPE, grantType);\n     queryParameters.forEach(formParam::param);\n+    formParam.param(SCOPE, OPENID_SCOPE);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjUyNDU0OQ=="}, "originalCommit": {"oid": "9cb5f2a960b768230047032429c9dfee00960ec2"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjU5Mzg0NA==", "bodyText": "Actually, it probably is fine as-is. It's likely we'll hit a situation where additional scopes are needed, but auth servers should be configurable to provide scopes as needed to specific clients without the client requesting them.", "url": "https://github.com/codice/ddf/pull/5769#discussion_r372593844", "createdAt": "2020-01-29T19:45:44Z", "author": {"login": "SmithJosh"}, "path": "platform/security/rest/security-rest-cxfwrapper/src/main/java/org/codice/ddf/cxf/oauth/OAuthSecurityImpl.java", "diffHunk": "@@ -324,6 +326,7 @@ private String getNewAccessToken(\n \n     Form formParam = new Form(GRANT_TYPE, grantType);\n     queryParameters.forEach(formParam::param);\n+    formParam.param(SCOPE, OPENID_SCOPE);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjUyNDU0OQ=="}, "originalCommit": {"oid": "9cb5f2a960b768230047032429c9dfee00960ec2"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjYyMzQyOQ==", "bodyText": "If that is the case we will need an additional configuration in the source configurations to take care of that.", "url": "https://github.com/codice/ddf/pull/5769#discussion_r372623429", "createdAt": "2020-01-29T20:52:35Z", "author": {"login": "blen-desta"}, "path": "platform/security/rest/security-rest-cxfwrapper/src/main/java/org/codice/ddf/cxf/oauth/OAuthSecurityImpl.java", "diffHunk": "@@ -324,6 +326,7 @@ private String getNewAccessToken(\n \n     Form formParam = new Form(GRANT_TYPE, grantType);\n     queryParameters.forEach(formParam::param);\n+    formParam.param(SCOPE, OPENID_SCOPE);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjUyNDU0OQ=="}, "originalCommit": {"oid": "9cb5f2a960b768230047032429c9dfee00960ec2"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjYyOTA2NA==", "bodyText": "I was trying to say we shouldn't need to do that \ud83d\ude04 It makes sense to request the \"openid\" scope since that's required for OIDC, but for application-specific scopes, it should be possible to configure everything in the auth server rather than DDF. That's at least the case for Keycloak. You can provide a list of default scopes to issue on a per-client basis.", "url": "https://github.com/codice/ddf/pull/5769#discussion_r372629064", "createdAt": "2020-01-29T21:05:49Z", "author": {"login": "SmithJosh"}, "path": "platform/security/rest/security-rest-cxfwrapper/src/main/java/org/codice/ddf/cxf/oauth/OAuthSecurityImpl.java", "diffHunk": "@@ -324,6 +326,7 @@ private String getNewAccessToken(\n \n     Form formParam = new Form(GRANT_TYPE, grantType);\n     queryParameters.forEach(formParam::param);\n+    formParam.param(SCOPE, OPENID_SCOPE);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjUyNDU0OQ=="}, "originalCommit": {"oid": "9cb5f2a960b768230047032429c9dfee00960ec2"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyMjgyNTUxOnYy", "diffSide": "LEFT", "path": "catalog/core/catalog-core-api/src/main/java/ddf/catalog/plugin/OAuthPluginException.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQyMzo1MToyNlrOFmLLWg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQwMjo1NDo0MFrOFmN6Jg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTU3MzMzOA==", "bodyText": "\u2753 Does this mean there is no longer a case where the complete URL will be passed into this exception? IOW it will always be the baseUrl + parameters?", "url": "https://github.com/codice/ddf/pull/5769#discussion_r375573338", "createdAt": "2020-02-05T23:51:26Z", "author": {"login": "bakejeyner"}, "path": "catalog/core/catalog-core-api/src/main/java/ddf/catalog/plugin/OAuthPluginException.java", "diffHunk": "@@ -37,17 +46,38 @@ public int getStatusCode() {\n     }\n   }\n \n-  public OAuthPluginException(String sourceId, String url, ErrorType errorType) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5fd2792611adf26f9dc97df85fa5e65246546f00"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTYxODA4Ng==", "bodyText": "Yes", "url": "https://github.com/codice/ddf/pull/5769#discussion_r375618086", "createdAt": "2020-02-06T02:54:40Z", "author": {"login": "blen-desta"}, "path": "catalog/core/catalog-core-api/src/main/java/ddf/catalog/plugin/OAuthPluginException.java", "diffHunk": "@@ -37,17 +46,38 @@ public int getStatusCode() {\n     }\n   }\n \n-  public OAuthPluginException(String sourceId, String url, ErrorType errorType) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTU3MzMzOA=="}, "originalCommit": {"oid": "5fd2792611adf26f9dc97df85fa5e65246546f00"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMyNDk3MDk1OnYy", "diffSide": "RIGHT", "path": "catalog/rest/catalog-rest-service/src/main/java/org/codice/ddf/rest/service/AbstractCatalogService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQxNTozNjoxNlrOFmfjQg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQxNTozNjoxNlrOFmfjQg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTkwNzEzOA==", "bodyText": "\u270f\ufe0f Does this comment need to move down to the catch (RuntimeException | UnsupportedEncodingException e) line?", "url": "https://github.com/codice/ddf/pull/5769#discussion_r375907138", "createdAt": "2020-02-06T15:36:16Z", "author": {"login": "SmithJosh"}, "path": "catalog/rest/catalog-rest-service/src/main/java/org/codice/ddf/rest/service/AbstractCatalogService.java", "diffHunk": "@@ -372,6 +377,15 @@ public BinaryContent getDocument(\n         // We need to catch this exception here or else execution will return to CXF and", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5fd2792611adf26f9dc97df85fa5e65246546f00"}, "originalPosition": 34}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4768, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}