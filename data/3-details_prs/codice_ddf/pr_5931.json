{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkzMzYxNTUx", "number": 5931, "title": "[2.19.x] DDF-UI-135 filter blank attributes from CSV export result", "bodyText": "What does this PR do?\nThis PR fixes the single result export so that only the attributes that exist on that particular record will show up as columns in the .csv\nWho is reviewing it?\n\n@hayleynorton @andrewzimmer @zta6\nSelect relevant component teams:\n\n@codice/ui\nAsk 2 committers to review/merge the PR and tag them here.\n@bdeining\n\nHow should this be tested?\n\n\nbuild/install\nadd some records\nsearch for records and click the ellipsis menu on the bottom right corner of the result\nselect \"Export as\"\nchoose csv and download\nverify that the blank attributes are filtered out\n\nAny background context you want to provide?\nWhat are the relevant tickets?\nFixes: codice/ddf-ui#135\nScreenshots\n\nChecklist:\n\n Documentation Updated\n Update / Add Threat Dragon models\n Update / Add Unit Tests\n Update / Add Integration Tests\n\nNotes on Review Process\nPlease see Notes on Review Process for further guidance on requirements for merging and abbreviated reviews.\nReview Comment Legend:\n\n\u270f\ufe0f (Pencil) This comment is a nitpick or style suggestion, no action required for approval. This comment should provide a suggestion either as an in line code snippet or a gist.\n\u2753 (Question Mark) This comment is to gain a clearer understanding of design or code choices, clarification is required but action may not be necessary for approval.\n\u2757 (Exclamation Mark) This comment is critical and requires clarification or action before approval.", "createdAt": "2020-03-25T03:19:54Z", "url": "https://github.com/codice/ddf/pull/5931", "merged": true, "mergeCommit": {"oid": "5402b952a9fd154aa0104af843fc54279a8928c1"}, "closed": true, "closedAt": "2020-04-14T19:55:23Z", "author": {"login": "cassandrabailey293"}, "timelineItems": {"totalCount": 23, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcQ8mddgH2gAyMzkzMzYxNTUxOjNmMTU5NzFmYjM1MTIzNTYyZjdmNTllOWQxMTI1NDcxZjI3N2U2MzY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcXlkC-AFqTM5MzA2NTA1MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "3f15971fb35123562f7f59e9d1125471f277e636", "author": {"user": null}, "url": "https://github.com/codice/ddf/commit/3f15971fb35123562f7f59e9d1125471f277e636", "committedDate": "2020-03-25T00:45:11Z", "message": "DDF-UI-135 pass attributes to the transformer"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxMTg5Mjky", "url": "https://github.com/codice/ddf/pull/5931#pullrequestreview-381189292", "createdAt": "2020-03-25T14:16:49Z", "commit": {"oid": "3f15971fb35123562f7f59e9d1125471f277e636"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxNDoxNjo0OVrOF7dKog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxNDoxNjo0OVrOF7dKog==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzg4ODE2Mg==", "bodyText": "\u270f\ufe0f remove commented line", "url": "https://github.com/codice/ddf/pull/5931#discussion_r397888162", "createdAt": "2020-03-25T14:16:49Z", "author": {"login": "zta6"}, "path": "ui/packages/catalog-ui-search/src/main/webapp/react-component/utils/export/export.tsx", "diffHunk": "@@ -78,10 +81,12 @@ export const getExportOptions = async (type: Transformer) => {\n export const exportResult = async (\n   source: string,\n   id: string,\n-  transformer: string\n+  transformer: string,\n+  attributes: string\n ) => {\n   return await fetch(\n-    `/services/catalog/sources/${source}/${id}?transform=${transformer}`\n+    `/services/catalog/sources/${source}/${id}?transform=${transformer}&columnOrder=${attributes}`\n+    // `/services/catalog/sources/${source}/${id}?transform=${transformer}`", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f15971fb35123562f7f59e9d1125471f277e636"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxMTg5Mzgx", "url": "https://github.com/codice/ddf/pull/5931#pullrequestreview-381189381", "createdAt": "2020-03-25T14:16:54Z", "commit": {"oid": "3f15971fb35123562f7f59e9d1125471f277e636"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c2cca4d28b3e525458865ad6586646b58ad35548", "author": {"user": null}, "url": "https://github.com/codice/ddf/commit/c2cca4d28b3e525458865ad6586646b58ad35548", "committedDate": "2020-03-25T14:33:54Z", "message": "DDF-UI-135 remove commented line"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxMjQ4Mjk4", "url": "https://github.com/codice/ddf/pull/5931#pullrequestreview-381248298", "createdAt": "2020-03-25T15:14:33Z", "commit": {"oid": "c2cca4d28b3e525458865ad6586646b58ad35548"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxNToxNDozM1rOF7gA9A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxNToxNDozM1rOF7gA9A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzkzNDgzNg==", "bodyText": "\u270f\ufe0f use .get() to access a single attribute from a backbone model (for example line 58)", "url": "https://github.com/codice/ddf/pull/5931#discussion_r397934836", "createdAt": "2020-03-25T15:14:33Z", "author": {"login": "andrewzimmer"}, "path": "ui/packages/catalog-ui-search/src/main/webapp/react-component/utils/export/export.tsx", "diffHunk": "@@ -67,6 +67,9 @@ export const getExportResult = (result: any) => {\n   return {\n     id: getResultId(result),\n     source: getResultSourceId(result),\n+    attributes: Object.keys(\n+      result.attributes.metacard.attributes.properties.attributes", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c2cca4d28b3e525458865ad6586646b58ad35548"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxMjUxNDk3", "url": "https://github.com/codice/ddf/pull/5931#pullrequestreview-381251497", "createdAt": "2020-03-25T15:17:45Z", "commit": {"oid": "c2cca4d28b3e525458865ad6586646b58ad35548"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxNToxNzo0NVrOF7gKXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxNToxNzo0NVrOF7gKXQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzkzNzI0NQ==", "bodyText": "Is this transformer used anywhere else? wondering if we should avoid filtering if no columnOrder arg is passed in", "url": "https://github.com/codice/ddf/pull/5931#discussion_r397937245", "createdAt": "2020-03-25T15:17:45Z", "author": {"login": "andrewzimmer"}, "path": "catalog/transformer/catalog-transformer-csv-queryresponse/src/main/java/ddf/catalog/transformer/csv/CsvMetacardTransformer.java", "diffHunk": "@@ -43,11 +46,20 @@ public BinaryContent transform(Metacard metacard, Map<String, Serializable> argu\n \n     Map<String, String> aliases =\n         (Map<String, String>) arguments.getOrDefault(\"aliases\", new HashMap<>());\n+    String attributeString = (String) arguments.get(\"columnOrder\");\n+    ArrayList<String> attributes =\n+        new ArrayList<String>(Arrays.asList((attributeString).split(\",\")));\n \n     Appendable appendable =\n         writeMetacardsToCsv(\n             Collections.singletonList(metacard),\n-            new ArrayList<>(metacard.getMetacardType().getAttributeDescriptors()),\n+            new ArrayList<AttributeDescriptor>(\n+                metacard\n+                    .getMetacardType()\n+                    .getAttributeDescriptors()\n+                    .stream()\n+                    .filter(attr -> attributes.contains(attr.getName()))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c2cca4d28b3e525458865ad6586646b58ad35548"}, "originalPosition": 36}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8fd9de65f08de704012defb8e8b84f0695c24b86", "author": {"user": null}, "url": "https://github.com/codice/ddf/commit/8fd9de65f08de704012defb8e8b84f0695c24b86", "committedDate": "2020-03-25T15:23:27Z", "message": "DDF-UI-135 use .get"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "71a5e7b4e577be4e2462870ac6d398e9ea516605", "author": {"user": null}, "url": "https://github.com/codice/ddf/commit/71a5e7b4e577be4e2462870ac6d398e9ea516605", "committedDate": "2020-03-25T15:28:06Z", "message": "DDF-UI-135 fix get attributes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "39a249f2c3a3cf3e26f1590b6b063f6367b0e1d0", "author": {"user": null}, "url": "https://github.com/codice/ddf/commit/39a249f2c3a3cf3e26f1590b6b063f6367b0e1d0", "committedDate": "2020-03-25T18:12:37Z", "message": "DDF-UI-135 only filter if columnOrder is provided"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dd70cc4cafcb9f479704c11024b8652d2bb23f70", "author": {"user": null}, "url": "https://github.com/codice/ddf/commit/dd70cc4cafcb9f479704c11024b8652d2bb23f70", "committedDate": "2020-03-26T16:43:33Z", "message": "DDF-UI-135 use List instead of ArrayList"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyMjE1NjYx", "url": "https://github.com/codice/ddf/pull/5931#pullrequestreview-382215661", "createdAt": "2020-03-26T16:59:59Z", "commit": {"oid": "dd70cc4cafcb9f479704c11024b8652d2bb23f70"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxNjo1OTo1OVrOF8Q7XA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxNjo1OTo1OVrOF8Q7XA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODczNjIyMA==", "bodyText": "\u270f\ufe0f Same comment as the other PR, could use CollectionUtils.isEmpty(attributes) here", "url": "https://github.com/codice/ddf/pull/5931#discussion_r398736220", "createdAt": "2020-03-26T16:59:59Z", "author": {"login": "zta6"}, "path": "catalog/transformer/catalog-transformer-csv-queryresponse/src/main/java/ddf/catalog/transformer/csv/CsvMetacardTransformer.java", "diffHunk": "@@ -43,12 +46,21 @@ public BinaryContent transform(Metacard metacard, Map<String, Serializable> argu\n \n     Map<String, String> aliases =\n         (Map<String, String>) arguments.getOrDefault(\"aliases\", new HashMap<>());\n-\n+    String attributeString = (String) arguments.get(\"columnOrder\");\n+    List<String> attributes =\n+        new ArrayList<String>(Arrays.asList((attributeString).split(\",\")));\n+    List<AttributeDescriptor> allAttributes =\n+        new ArrayList<AttributeDescriptor>(metacard.getMetacardType().getAttributeDescriptors());\n+    List<AttributeDescriptor> descriptors =\n+        new ArrayList<AttributeDescriptor>(\n+            attributes == null || attributes.isEmpty()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dd70cc4cafcb9f479704c11024b8652d2bb23f70"}, "originalPosition": 31}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4cabae96808196b487b3c32d5cfc2570641c9b2c", "author": {"user": null}, "url": "https://github.com/codice/ddf/commit/4cabae96808196b487b3c32d5cfc2570641c9b2c", "committedDate": "2020-03-26T17:07:28Z", "message": "DDF-UI-135 use CollectionUtils and import List"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyMjQzMDMy", "url": "https://github.com/codice/ddf/pull/5931#pullrequestreview-382243032", "createdAt": "2020-03-26T17:30:16Z", "commit": {"oid": "4cabae96808196b487b3c32d5cfc2570641c9b2c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxNzozMDoxNlrOF8SRUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxNzozMDoxNlrOF8SRUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODc1ODIyNg==", "bodyText": "if no columnOrder arg is present, will this return an empty string or null?", "url": "https://github.com/codice/ddf/pull/5931#discussion_r398758226", "createdAt": "2020-03-26T17:30:16Z", "author": {"login": "andrewzimmer"}, "path": "catalog/transformer/catalog-transformer-csv-queryresponse/src/main/java/ddf/catalog/transformer/csv/CsvMetacardTransformer.java", "diffHunk": "@@ -43,12 +48,20 @@ public BinaryContent transform(Metacard metacard, Map<String, Serializable> argu\n \n     Map<String, String> aliases =\n         (Map<String, String>) arguments.getOrDefault(\"aliases\", new HashMap<>());\n-\n+    String attributeString = (String) arguments.get(\"columnOrder\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4cabae96808196b487b3c32d5cfc2570641c9b2c"}, "originalPosition": 26}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6f5ace17f6fd8a422b26aac24d18cd7172470c12", "author": {"user": null}, "url": "https://github.com/codice/ddf/commit/6f5ace17f6fd8a422b26aac24d18cd7172470c12", "committedDate": "2020-03-26T19:43:28Z", "message": "DDF-UI-135 guard against null columnOrder"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyMzY2MDc5", "url": "https://github.com/codice/ddf/pull/5931#pullrequestreview-382366079", "createdAt": "2020-03-26T19:55:20Z", "commit": {"oid": "6f5ace17f6fd8a422b26aac24d18cd7172470c12"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxOTo1NToyMFrOF8X_YA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxOTo1NToyMFrOF8X_YA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODg1MTkzNg==", "bodyText": "any reason these all need to be new ArrayList? I think it should already be returning a list of strings. Same question for the two below", "url": "https://github.com/codice/ddf/pull/5931#discussion_r398851936", "createdAt": "2020-03-26T19:55:20Z", "author": {"login": "andrewzimmer"}, "path": "catalog/transformer/catalog-transformer-csv-queryresponse/src/main/java/ddf/catalog/transformer/csv/CsvMetacardTransformer.java", "diffHunk": "@@ -43,12 +48,21 @@ public BinaryContent transform(Metacard metacard, Map<String, Serializable> argu\n \n     Map<String, String> aliases =\n         (Map<String, String>) arguments.getOrDefault(\"aliases\", new HashMap<>());\n-\n+    String attributeString =\n+        arguments.get(\"columnOrder\") != null ? (String) arguments.get(\"columnOrder\") : \"\";\n+    List<String> attributes = new ArrayList<String>(Arrays.asList((attributeString).split(\",\")));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6f5ace17f6fd8a422b26aac24d18cd7172470c12"}, "originalPosition": 28}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ef822ea3f54732fe5bf992a7de901f93aa228aaf", "author": {"user": null}, "url": "https://github.com/codice/ddf/commit/ef822ea3f54732fe5bf992a7de901f93aa228aaf", "committedDate": "2020-03-26T20:04:05Z", "message": "DDF-UI-135 remove unnecessary new operators"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyMzczNDUw", "url": "https://github.com/codice/ddf/pull/5931#pullrequestreview-382373450", "createdAt": "2020-03-26T20:05:17Z", "commit": {"oid": "ef822ea3f54732fe5bf992a7de901f93aa228aaf"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4202517cefa3903e4aa6ee278a89d839bcb06e1c", "author": {"user": null}, "url": "https://github.com/codice/ddf/commit/4202517cefa3903e4aa6ee278a89d839bcb06e1c", "committedDate": "2020-03-26T22:38:38Z", "message": "DDF-UI-135 use const"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyNDc2MTc1", "url": "https://github.com/codice/ddf/pull/5931#pullrequestreview-382476175", "createdAt": "2020-03-26T22:55:18Z", "commit": {"oid": "4202517cefa3903e4aa6ee278a89d839bcb06e1c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzMjE2MjI1", "url": "https://github.com/codice/ddf/pull/5931#pullrequestreview-383216225", "createdAt": "2020-03-27T21:41:40Z", "commit": {"oid": "4202517cefa3903e4aa6ee278a89d839bcb06e1c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "813f3c19639fe15bf3cfd36c32fb946138cbad53", "author": {"user": null}, "url": "https://github.com/codice/ddf/commit/813f3c19639fe15bf3cfd36c32fb946138cbad53", "committedDate": "2020-03-30T14:33:34Z", "message": "DDF-UI-135 formatting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "634634da246cae3852341647502073c60e09b380", "author": {"user": null}, "url": "https://github.com/codice/ddf/commit/634634da246cae3852341647502073c60e09b380", "committedDate": "2020-04-01T19:04:33Z", "message": "DDF-UI-135 fix unit test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzMDY1MDUx", "url": "https://github.com/codice/ddf/pull/5931#pullrequestreview-393065051", "createdAt": "2020-04-14T15:51:33Z", "commit": {"oid": "634634da246cae3852341647502073c60e09b380"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxNTo1MTozM1rOGFVWdg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxNTo1MTozM1rOGFVWdg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODI0NTg3OA==", "bodyText": "According to the documentation for CollectionUtils.isEmpty, it returns true on null. Do we want to return null here?", "url": "https://github.com/codice/ddf/pull/5931#discussion_r408245878", "createdAt": "2020-04-14T15:51:33Z", "author": {"login": "AzGoalie"}, "path": "catalog/transformer/catalog-transformer-csv-queryresponse/src/main/java/ddf/catalog/transformer/csv/CsvMetacardTransformer.java", "diffHunk": "@@ -43,12 +48,20 @@ public BinaryContent transform(Metacard metacard, Map<String, Serializable> argu\n \n     Map<String, String> aliases =\n         (Map<String, String>) arguments.getOrDefault(\"aliases\", new HashMap<>());\n-\n+    String attributeString =\n+        arguments.get(\"columnOrder\") != null ? (String) arguments.get(\"columnOrder\") : \"\";\n+    List<String> attributes = Arrays.asList((attributeString).split(\",\"));\n+    List<AttributeDescriptor> allAttributes =\n+        new ArrayList<AttributeDescriptor>(metacard.getMetacardType().getAttributeDescriptors());\n+    List<AttributeDescriptor> descriptors =\n+        CollectionUtils.isEmpty(attributes)\n+            ? allAttributes", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "634634da246cae3852341647502073c60e09b380"}, "originalPosition": 33}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4849, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}