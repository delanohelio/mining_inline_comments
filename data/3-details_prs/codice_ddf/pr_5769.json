{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYzMjM2OTk0", "number": 5769, "title": "DDF-5360 Adds the ability to go through OAuth to download a resource", "bodyText": "Needs: codice/ddf-ui#83\nWhat does this PR do?\nAdds the ability to go through OAuth to download a resource.\nWho is reviewing it?\n@SmithJosh @bakejeyner\nSelect relevant component teams:\n@codice/security\nAsk 2 committers to review/merge the PR and tag them here.\n@garrettfreibott\n@stustison\nHow should this be tested?\n\nVerify downloading a resource from an OAuth protected source works. Download using\n\nthe download button\nthe inspector tab\nthe action tab\n\n\nDelete the user's tokens and try downloading a resource (should be prompted to log in).\nVerify querying with OAuth still works\n\nWhat are the relevant tickets?\n#5360\nChecklist:\n\n Documentation Updated\n Update / Add Threat Dragon models\n Update / Add Unit Tests\n Update / Add Integration Tests\n\nNotes on Review Process\nPlease see Notes on Review Process for further guidance on requirements for merging and abbreviated reviews.\nReview Comment Legend:\n\n\u270f\ufe0f (Pencil) This comment is a nitpick or style suggestion, no action required for approval. This comment should provide a suggestion either as an in line code snippet or a gist.\n\u2753 (Question Mark) This comment is to gain a clearer understanding of design or code choices, clarification is required but action may not be necessary for approval.\n\u2757 (Exclamation Mark) This comment is critical and requires clarification or action before approval.", "createdAt": "2020-01-15T16:50:53Z", "url": "https://github.com/codice/ddf/pull/5769", "merged": true, "mergeCommit": {"oid": "3cf905b8760a0cb3dd0aa164dafa6c6736ae64e6"}, "closed": true, "closedAt": "2020-02-21T01:10:52Z", "author": {"login": "blen-desta"}, "timelineItems": {"totalCount": 21, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb6oiX2gFqTM0MzM3MTM3MQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcFsHHfABqjMwNDk4Njk1NTY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQzMzcxMzcx", "url": "https://github.com/codice/ddf/pull/5769#pullrequestreview-343371371", "createdAt": "2020-01-15T16:56:11Z", "commit": {"oid": "93bb3b82add5a6b86461d901e371f0ad9c7e0245"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQxNjo1NjoxMVrOFd_Xvw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQxNjo1NjoxMVrOFd_Xvw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Njk5MTI5NQ==", "bodyText": "\u2753 Why did you need to add this? It looks like it isn't used anywhere.", "url": "https://github.com/codice/ddf/pull/5769#discussion_r366991295", "createdAt": "2020-01-15T16:56:11Z", "author": {"login": "stustison"}, "path": "platform/security/rest/security-rest-clientapi/src/main/java/org/codice/ddf/cxf/client/SecureCxfClientFactory.java", "diffHunk": "@@ -42,6 +42,13 @@\n    */\n   WebClient getWebClient();\n \n+  /**\n+   * Returns the WebClient\n+   *\n+   * @return\n+   */\n+  WebClient getWebSystemClient();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "93bb3b82add5a6b86461d901e371f0ad9c7e0245"}, "originalPosition": 9}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQzNTU3NTI4", "url": "https://github.com/codice/ddf/pull/5769#pullrequestreview-343557528", "createdAt": "2020-01-15T22:12:31Z", "commit": {"oid": "93bb3b82add5a6b86461d901e371f0ad9c7e0245"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQyMjoxMjozMVrOFeIH1g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQyMjoxMjozMVrOFeIH1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzEzNDY3OA==", "bodyText": "\u2753 Can you add a test for this?", "url": "https://github.com/codice/ddf/pull/5769#discussion_r367134678", "createdAt": "2020-01-15T22:12:31Z", "author": {"login": "SmithJosh"}, "path": "catalog/core/catalog-core-urlresourcereader/pom.xml", "diffHunk": "@@ -154,12 +154,12 @@\n                                         <limit implementation=\"org.codice.jacoco.LenientLimit\">\n                                             <counter>INSTRUCTION</counter>\n                                             <value>COVEREDRATIO</value>\n-                                            <minimum>0.70</minimum>\n+                                            <minimum>0.68</minimum>\n                                         </limit>\n                                         <limit implementation=\"org.codice.jacoco.LenientLimit\">\n                                             <counter>BRANCH</counter>\n                                             <value>COVEREDRATIO</value>\n-                                            <minimum>0.64</minimum>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "93bb3b82add5a6b86461d901e371f0ad9c7e0245"}, "originalPosition": 10}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "93bb3b82add5a6b86461d901e371f0ad9c7e0245", "author": {"user": {"login": "blen-desta", "name": "Blen Desta"}}, "url": "https://github.com/codice/ddf/commit/93bb3b82add5a6b86461d901e371f0ad9c7e0245", "committedDate": "2020-01-15T16:45:14Z", "message": "DDF-5360 Added OAuth to the URLResourceReader"}, "afterCommit": {"oid": "3515a6e61a9a2960357958ce0daa405d9ad7b4a7", "author": {"user": {"login": "blen-desta", "name": "Blen Desta"}}, "url": "https://github.com/codice/ddf/commit/3515a6e61a9a2960357958ce0daa405d9ad7b4a7", "committedDate": "2020-01-21T21:47:15Z", "message": "DDF-5360 Added OAuth to the URLResourceReader"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQ2OTk3MTg4", "url": "https://github.com/codice/ddf/pull/5769#pullrequestreview-346997188", "createdAt": "2020-01-23T00:33:05Z", "commit": {"oid": "3515a6e61a9a2960357958ce0daa405d9ad7b4a7"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwMDozMzowNVrOFgvpwg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yM1QwMDozMzowNVrOFgvpwg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTg3OTQ5MA==", "bodyText": "I get a compilation error when building. This test needs to be updated with the new getWebClient method signature:\nhttps://github.com/codice/ddf/blob/master/catalog/spatial/ogc/spatial-ogc-urlresourcereader/src/test/java/org/codice/ddf/spatial/ogc/catalog/resource/impl/ResourceReaderTest.java#L94-L95", "url": "https://github.com/codice/ddf/pull/5769#discussion_r369879490", "createdAt": "2020-01-23T00:33:05Z", "author": {"login": "SmithJosh"}, "path": "catalog/core/catalog-core-urlresourcereader/src/main/java/ddf/catalog/resource/impl/URLResourceReader.java", "diffHunk": "@@ -583,7 +594,8 @@ private boolean validateFilePath(File resourceFilePath) throws IOException {\n     return false;\n   }\n \n-  protected WebClient getWebClient(String uri, Map<String, Serializable> properties) {\n+  @VisibleForTesting\n+  WebClient getWebClient(String uri, Map<String, Serializable> properties) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3515a6e61a9a2960357958ce0daa405d9ad7b4a7"}, "originalPosition": 31}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3515a6e61a9a2960357958ce0daa405d9ad7b4a7", "author": {"user": {"login": "blen-desta", "name": "Blen Desta"}}, "url": "https://github.com/codice/ddf/commit/3515a6e61a9a2960357958ce0daa405d9ad7b4a7", "committedDate": "2020-01-21T21:47:15Z", "message": "DDF-5360 Added OAuth to the URLResourceReader"}, "afterCommit": {"oid": "2196450e2301ed7d7f330e531a9dceb2e5a871bd", "author": {"user": {"login": "blen-desta", "name": "Blen Desta"}}, "url": "https://github.com/codice/ddf/commit/2196450e2301ed7d7f330e531a9dceb2e5a871bd", "committedDate": "2020-01-23T04:24:43Z", "message": "DDF-5360 Added OAuth to the URLResourceReader"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2196450e2301ed7d7f330e531a9dceb2e5a871bd", "author": {"user": {"login": "blen-desta", "name": "Blen Desta"}}, "url": "https://github.com/codice/ddf/commit/2196450e2301ed7d7f330e531a9dceb2e5a871bd", "committedDate": "2020-01-23T04:24:43Z", "message": "DDF-5360 Added OAuth to the URLResourceReader"}, "afterCommit": {"oid": "93c54f5600867741c8299dee41c9ceea18063e4a", "author": {"user": {"login": "blen-desta", "name": "Blen Desta"}}, "url": "https://github.com/codice/ddf/commit/93c54f5600867741c8299dee41c9ceea18063e4a", "committedDate": "2020-01-23T15:22:39Z", "message": "DDF-5360 Added OAuth to the URLResourceReader"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUwMjg4NTY4", "url": "https://github.com/codice/ddf/pull/5769#pullrequestreview-350288568", "createdAt": "2020-01-29T17:26:18Z", "commit": {"oid": "9cb5f2a960b768230047032429c9dfee00960ec2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUwMjkwMDUz", "url": "https://github.com/codice/ddf/pull/5769#pullrequestreview-350290053", "createdAt": "2020-01-29T17:28:34Z", "commit": {"oid": "9cb5f2a960b768230047032429c9dfee00960ec2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQxNzoyODozNVrOFjRGBQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0yOVQxNzoyODozNVrOFjRGBQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjUyNDU0OQ==", "bodyText": "I already approved, but we have a configuration for OAuth handler which determines the scopes that will be requested from the auth server. Wondering if we should include the full set from that config here as well", "url": "https://github.com/codice/ddf/pull/5769#discussion_r372524549", "createdAt": "2020-01-29T17:28:35Z", "author": {"login": "SmithJosh"}, "path": "platform/security/rest/security-rest-cxfwrapper/src/main/java/org/codice/ddf/cxf/oauth/OAuthSecurityImpl.java", "diffHunk": "@@ -324,6 +326,7 @@ private String getNewAccessToken(\n \n     Form formParam = new Form(GRANT_TYPE, grantType);\n     queryParameters.forEach(formParam::param);\n+    formParam.param(SCOPE, OPENID_SCOPE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9cb5f2a960b768230047032429c9dfee00960ec2"}, "originalPosition": 18}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUwMzQ1NjM1", "url": "https://github.com/codice/ddf/pull/5769#pullrequestreview-350345635", "createdAt": "2020-01-29T18:54:52Z", "commit": {"oid": "9cb5f2a960b768230047032429c9dfee00960ec2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUwNDk0MjI3", "url": "https://github.com/codice/ddf/pull/5769#pullrequestreview-350494227", "createdAt": "2020-01-29T23:22:59Z", "commit": {"oid": "9cb5f2a960b768230047032429c9dfee00960ec2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9cb5f2a960b768230047032429c9dfee00960ec2", "author": {"user": {"login": "blen-desta", "name": "Blen Desta"}}, "url": "https://github.com/codice/ddf/commit/9cb5f2a960b768230047032429c9dfee00960ec2", "committedDate": "2020-01-28T19:10:42Z", "message": "Added oidc scope to system token requests"}, "afterCommit": {"oid": "34fa8ae3187b72f472c009ec5d4edec1f8e65a35", "author": {"user": {"login": "blen-desta", "name": "Blen Desta"}}, "url": "https://github.com/codice/ddf/commit/34fa8ae3187b72f472c009ec5d4edec1f8e65a35", "committedDate": "2020-02-05T21:21:16Z", "message": "DDF-5360 Adds the ability to go through OAuth to download a resource"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "34fa8ae3187b72f472c009ec5d4edec1f8e65a35", "author": {"user": {"login": "blen-desta", "name": "Blen Desta"}}, "url": "https://github.com/codice/ddf/commit/34fa8ae3187b72f472c009ec5d4edec1f8e65a35", "committedDate": "2020-02-05T21:21:16Z", "message": "DDF-5360 Adds the ability to go through OAuth to download a resource"}, "afterCommit": {"oid": "ef5dbbeb2a90b755d272977ac4eca3e26f2b0e94", "author": {"user": {"login": "blen-desta", "name": "Blen Desta"}}, "url": "https://github.com/codice/ddf/commit/ef5dbbeb2a90b755d272977ac4eca3e26f2b0e94", "committedDate": "2020-02-05T21:23:14Z", "message": "DDF-5360 Adds the ability to go through OAuth to download a resource"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5fd2792611adf26f9dc97df85fa5e65246546f00", "author": {"user": {"login": "blen-desta", "name": "Blen Desta"}}, "url": "https://github.com/codice/ddf/commit/5fd2792611adf26f9dc97df85fa5e65246546f00", "committedDate": "2020-02-05T21:25:53Z", "message": "DDF-5360 Adds the ability to go through OAuth to download a resource"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ef5dbbeb2a90b755d272977ac4eca3e26f2b0e94", "author": {"user": {"login": "blen-desta", "name": "Blen Desta"}}, "url": "https://github.com/codice/ddf/commit/ef5dbbeb2a90b755d272977ac4eca3e26f2b0e94", "committedDate": "2020-02-05T21:23:14Z", "message": "DDF-5360 Adds the ability to go through OAuth to download a resource"}, "afterCommit": {"oid": "5fd2792611adf26f9dc97df85fa5e65246546f00", "author": {"user": {"login": "blen-desta", "name": "Blen Desta"}}, "url": "https://github.com/codice/ddf/commit/5fd2792611adf26f9dc97df85fa5e65246546f00", "committedDate": "2020-02-05T21:25:53Z", "message": "DDF-5360 Adds the ability to go through OAuth to download a resource"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0MDY0MzQ4", "url": "https://github.com/codice/ddf/pull/5769#pullrequestreview-354064348", "createdAt": "2020-02-05T21:48:15Z", "commit": {"oid": "5fd2792611adf26f9dc97df85fa5e65246546f00"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0MTIxNDY5", "url": "https://github.com/codice/ddf/pull/5769#pullrequestreview-354121469", "createdAt": "2020-02-05T23:51:26Z", "commit": {"oid": "5fd2792611adf26f9dc97df85fa5e65246546f00"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQyMzo1MToyNlrOFmLLWg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNVQyMzo1MToyNlrOFmLLWg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTU3MzMzOA==", "bodyText": "\u2753 Does this mean there is no longer a case where the complete URL will be passed into this exception? IOW it will always be the baseUrl + parameters?", "url": "https://github.com/codice/ddf/pull/5769#discussion_r375573338", "createdAt": "2020-02-05T23:51:26Z", "author": {"login": "bakejeyner"}, "path": "catalog/core/catalog-core-api/src/main/java/ddf/catalog/plugin/OAuthPluginException.java", "diffHunk": "@@ -37,17 +46,38 @@ public int getStatusCode() {\n     }\n   }\n \n-  public OAuthPluginException(String sourceId, String url, ErrorType errorType) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5fd2792611adf26f9dc97df85fa5e65246546f00"}, "originalPosition": 27}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0NTQ2Nzc1", "url": "https://github.com/codice/ddf/pull/5769#pullrequestreview-354546775", "createdAt": "2020-02-06T15:36:16Z", "commit": {"oid": "5fd2792611adf26f9dc97df85fa5e65246546f00"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQxNTozNjoxNlrOFmfjQg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wNlQxNTozNjoxNlrOFmfjQg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTkwNzEzOA==", "bodyText": "\u270f\ufe0f Does this comment need to move down to the catch (RuntimeException | UnsupportedEncodingException e) line?", "url": "https://github.com/codice/ddf/pull/5769#discussion_r375907138", "createdAt": "2020-02-06T15:36:16Z", "author": {"login": "SmithJosh"}, "path": "catalog/rest/catalog-rest-service/src/main/java/org/codice/ddf/rest/service/AbstractCatalogService.java", "diffHunk": "@@ -372,6 +377,15 @@ public BinaryContent getDocument(\n         // We need to catch this exception here or else execution will return to CXF and", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5fd2792611adf26f9dc97df85fa5e65246546f00"}, "originalPosition": 34}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0Njc3MjI1", "url": "https://github.com/codice/ddf/pull/5769#pullrequestreview-354677225", "createdAt": "2020-02-06T18:33:13Z", "commit": {"oid": "5fd2792611adf26f9dc97df85fa5e65246546f00"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f02d2b7045802e817a8a5e8edfa90957271b7e8a", "author": {"user": {"login": "blen-desta", "name": "Blen Desta"}}, "url": "https://github.com/codice/ddf/commit/f02d2b7045802e817a8a5e8edfa90957271b7e8a", "committedDate": "2020-02-06T19:13:43Z", "message": "Moves the Uri builder in the OAuthException to avoid embedding jars"}, "afterCommit": {"oid": "fd15a634662ad60a2339617a3e56c32de5875ab6", "author": {"user": {"login": "blen-desta", "name": "Blen Desta"}}, "url": "https://github.com/codice/ddf/commit/fd15a634662ad60a2339617a3e56c32de5875ab6", "committedDate": "2020-02-06T19:28:32Z", "message": "Moves the Uri builder in the OAuthException to avoid embedding jars"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "09584145c20aa7877ce3d00b4d055e7016f65d07", "author": {"user": {"login": "blen-desta", "name": "Blen Desta"}}, "url": "https://github.com/codice/ddf/commit/09584145c20aa7877ce3d00b4d055e7016f65d07", "committedDate": "2020-02-19T01:18:59Z", "message": "Moves the Uri builder in the OAuthException to avoid embedding jars"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fd15a634662ad60a2339617a3e56c32de5875ab6", "author": {"user": {"login": "blen-desta", "name": "Blen Desta"}}, "url": "https://github.com/codice/ddf/commit/fd15a634662ad60a2339617a3e56c32de5875ab6", "committedDate": "2020-02-06T19:28:32Z", "message": "Moves the Uri builder in the OAuthException to avoid embedding jars"}, "afterCommit": {"oid": "09584145c20aa7877ce3d00b4d055e7016f65d07", "author": {"user": {"login": "blen-desta", "name": "Blen Desta"}}, "url": "https://github.com/codice/ddf/commit/09584145c20aa7877ce3d00b4d055e7016f65d07", "committedDate": "2020-02-19T01:18:59Z", "message": "Moves the Uri builder in the OAuthException to avoid embedding jars"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4968, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}