{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE5NzY4MDA5", "number": 6068, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQyMjo1MjoyM1rOD9k_qA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQxNjoxODozNVrOD_AN5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY1ODk1ODQ4OnYy", "diffSide": "RIGHT", "path": "platform/security/servlet/security-servlet-web-socket/src/main/java/org/codice/ddf/security/servlet/web/socket/SecureWebSocketServlet.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQyMjo1MjoyM1rOGXKBIw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOFQyMjo1MjoyM1rOGXKBIw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjkzNDU2Mw==", "bodyText": "Looks like this comment no longer applies", "url": "https://github.com/codice/ddf/pull/6068#discussion_r426934563", "createdAt": "2020-05-18T22:52:23Z", "author": {"login": "SmithJosh"}, "path": "platform/security/servlet/security-servlet-web-socket/src/main/java/org/codice/ddf/security/servlet/web/socket/SecureWebSocketServlet.java", "diffHunk": "@@ -0,0 +1,138 @@\n+/**\n+ * Copyright (c) Codice Foundation\n+ *\n+ * <p>This is free software: you can redistribute it and/or modify it under the terms of the GNU\n+ * Lesser General Public License as published by the Free Software Foundation, either version 3 of\n+ * the License, or any later version.\n+ *\n+ * <p>This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;\n+ * without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * GNU Lesser General Public License for more details. A copy of the GNU Lesser General Public\n+ * License is distributed along with this program and can be found at\n+ * <http://www.gnu.org/licenses/lgpl.html>.\n+ */\n+package org.codice.ddf.security.servlet.web.socket;\n+\n+import ddf.security.SecurityConstants;\n+import ddf.security.Subject;\n+import java.io.IOException;\n+import java.util.concurrent.ExecutorService;\n+import javax.servlet.http.HttpSession;\n+import org.eclipse.jetty.websocket.api.Session;\n+import org.eclipse.jetty.websocket.api.annotations.OnWebSocketClose;\n+import org.eclipse.jetty.websocket.api.annotations.OnWebSocketConnect;\n+import org.eclipse.jetty.websocket.api.annotations.OnWebSocketError;\n+import org.eclipse.jetty.websocket.api.annotations.OnWebSocketMessage;\n+import org.eclipse.jetty.websocket.servlet.ServletUpgradeRequest;\n+import org.eclipse.jetty.websocket.servlet.WebSocketServlet;\n+import org.eclipse.jetty.websocket.servlet.WebSocketServletFactory;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+public class SecureWebSocketServlet extends WebSocketServlet {\n+\n+  private static final Logger LOGGER = LoggerFactory.getLogger(SecureWebSocketServlet.class);\n+\n+  private final WebSocket ws;\n+\n+  private final ExecutorService executor;\n+\n+  public SecureWebSocketServlet(ExecutorService executor, WebSocket ws) {\n+    this.ws = ws;\n+    this.executor = executor;\n+  }\n+\n+  @Override\n+  public void destroy() {\n+    executor.shutdown();\n+  }\n+\n+  /*\n+   Pass the TokenHolder into the WebSocket, in order to know when the user has logged out. Can't\n+   pass the Session because Jetty won't let anything check session attributes unless there's a\n+   request (excluding WebSocket requests) being actively fulfilled for that session.\n+  */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c7d66045259c444afd11c1a82a4d81bd33307eb7"}, "originalPosition": 54}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3MzkwNDM2OnYy", "diffSide": "RIGHT", "path": "features/security/src/main/feature/feature.xml", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMlQxNjoxODozNVrOGZcqbA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QwMjoxOTo1OVrOGa3Nfw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTMzNzE5Ng==", "bodyText": "This might need to be changed now. Try rebasing and see if this actually needs impl.", "url": "https://github.com/codice/ddf/pull/6068#discussion_r429337196", "createdAt": "2020-05-22T16:18:35Z", "author": {"login": "stustison"}, "path": "features/security/src/main/feature/feature.xml", "diffHunk": "@@ -528,6 +528,13 @@ org.ops4j.pax.web.default.realmname=DDF\n         <bundle>mvn:ddf.security.servlet/security-servlet-whoami/${project.version}</bundle>\n     </feature>\n \n+    <feature name=\"security-servlet-web-socket\" version=\"${project.version}\"\n+             description=\"Defines a secure web socket servlet type.\">\n+        <feature>security-core-impl</feature>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c7d66045259c444afd11c1a82a4d81bd33307eb7"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDUwNTUzNQ==", "bodyText": "\ud83d\udc4d I'll see if CI fails on it first. Scared of building atm", "url": "https://github.com/codice/ddf/pull/6068#discussion_r430505535", "createdAt": "2020-05-26T15:33:29Z", "author": {"login": "bakejeyner"}, "path": "features/security/src/main/feature/feature.xml", "diffHunk": "@@ -528,6 +528,13 @@ org.ops4j.pax.web.default.realmname=DDF\n         <bundle>mvn:ddf.security.servlet/security-servlet-whoami/${project.version}</bundle>\n     </feature>\n \n+    <feature name=\"security-servlet-web-socket\" version=\"${project.version}\"\n+             description=\"Defines a secure web socket servlet type.\">\n+        <feature>security-core-impl</feature>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTMzNzE5Ng=="}, "originalCommit": {"oid": "c7d66045259c444afd11c1a82a4d81bd33307eb7"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDgyMDczNQ==", "bodyText": "Manually verified it is now using artifacts from security-core-api. Making the change.", "url": "https://github.com/codice/ddf/pull/6068#discussion_r430820735", "createdAt": "2020-05-27T02:19:59Z", "author": {"login": "bakejeyner"}, "path": "features/security/src/main/feature/feature.xml", "diffHunk": "@@ -528,6 +528,13 @@ org.ops4j.pax.web.default.realmname=DDF\n         <bundle>mvn:ddf.security.servlet/security-servlet-whoami/${project.version}</bundle>\n     </feature>\n \n+    <feature name=\"security-servlet-web-socket\" version=\"${project.version}\"\n+             description=\"Defines a secure web socket servlet type.\">\n+        <feature>security-core-impl</feature>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTMzNzE5Ng=="}, "originalCommit": {"oid": "c7d66045259c444afd11c1a82a4d81bd33307eb7"}, "originalPosition": 6}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4601, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}