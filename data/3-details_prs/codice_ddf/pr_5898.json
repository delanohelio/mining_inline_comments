{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg3NzczMjY2", "number": 5898, "title": "[2.19.x] DDF-5897: Fixed drawing polygons without buffers", "bodyText": "What does this PR do?\nFixes a bug introduced by #5851\nWho is reviewing it?\n@bdeining\n@millerw8\n@bennuttle\n@frnkshin\n@nsuvarna\n@lavoywj\nSelect relevant component teams:\n@codice/ui\nAsk 2 committers to review/merge the PR and tag them here.\n@bdeining\n@millerw8\nHow should this be tested?\nSame as #5801\nAny background context you want to provide?\nSee #5851\nWhat are the relevant tickets?\nFixes: #5897\nChecklist:\n\n Documentation Updated\n Update / Add Threat Dragon models\n Update / Add Unit Tests\n Update / Add Integration Tests\n\nNotes on Review Process\nPlease see Notes on Review Process for further guidance on requirements for merging and abbreviated reviews.\nReview Comment Legend:\n\n\u270f\ufe0f (Pencil) This comment is a nitpick or style suggestion, no action required for approval. This comment should provide a suggestion either as an in line code snippet or a gist.\n\u2753 (Question Mark) This comment is to gain a clearer understanding of design or code choices, clarification is required but action may not be necessary for approval.\n\u2757 (Exclamation Mark) This comment is critical and requires clarification or action before approval.", "createdAt": "2020-03-13T13:20:31Z", "url": "https://github.com/codice/ddf/pull/5898", "merged": true, "mergeCommit": {"oid": "f92efe4391d5901abeb2bf47560ad46c0e8874a3"}, "closed": true, "closedAt": "2020-04-22T13:31:23Z", "author": {"login": "leo-sakh"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcNTZlFAFqTM3NDQ2MzExOA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcZ54AUgBqjMyNTc4MTc4NjI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc0NDYzMTE4", "url": "https://github.com/codice/ddf/pull/5898#pullrequestreview-374463118", "createdAt": "2020-03-13T16:56:57Z", "commit": {"oid": "e71ad214e0526f1249cf0843e003e327d539af86"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxNjo1Njo1N1rOF2LXTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xM1QxNzowMzowNlrOF2LkRw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjM1MzYxMg==", "bodyText": "\u270f\ufe0f May want to list the version with the bug, so that it's clear down-the-line later on if this has been resolved", "url": "https://github.com/codice/ddf/pull/5898#discussion_r392353612", "createdAt": "2020-03-13T16:56:57Z", "author": {"login": "bennuttle"}, "path": "ui/packages/catalog-ui-search/src/main/webapp/js/widgets/openlayers.polygon.js", "diffHunk": "@@ -50,19 +50,49 @@ const translateFromOpenlayersCoordinates = coords => {\n     .flatten()\n }\n \n+const isValidBufferWidth = bufferWidth =>\n+  !_.isNull(bufferWidth) && !_.isUndefined(bufferWidth) && '' != bufferWidth\n+\n /**\n- * Returns buffer width in meters with the lowest value of 1 meter.\n+ * Returns buffer width in meters, if applicable, with the lowest value of 1 meter.\n  */\n const getConstrainedBufferWidth = model => {\n+  const polygonWidthValue = model.get('polygonBufferWidth')\n+\n+  if (!isValidBufferWidth(polygonWidthValue)) return undefined\n+\n+  if (0 == polygonWidthValue) return undefined\n+\n   const bufferWidth =\n     DistanceUtils.getDistanceInMeters(\n-      model.get('polygonBufferWidth'),\n+      polygonWidthValue,\n       model.get('polygonBufferUnits')\n     ) || 1\n \n   return bufferWidth >= 1 ? bufferWidth : 1\n }\n \n+const getPolygonCoordSegments = (polySegment, bufferWidth) => {\n+  if (isValidBufferWidth(bufferWidth))\n+    return Turf.buffer(\n+      polySegment,\n+      bufferWidth,\n+      'meters'\n+    ).geometry.coordinates.map(set => {\n+      return Turf.polygon([set])\n+    })\n+\n+  return polySegment.geometry.coordinates.map(set => {\n+    /**\n+     * There appears to be a bug in the current version of Turf that produces 2-point arrays instead of 4\n+     * which results in an exception\n+     */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e71ad214e0526f1249cf0843e003e327d539af86"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjM1NjkzNQ==", "bodyText": "\u270f\ufe0f This seems readable to me, but I know some folks don't like single-line ifs without brackets.", "url": "https://github.com/codice/ddf/pull/5898#discussion_r392356935", "createdAt": "2020-03-13T17:03:06Z", "author": {"login": "bennuttle"}, "path": "ui/packages/catalog-ui-search/src/main/webapp/js/widgets/openlayers.polygon.js", "diffHunk": "@@ -50,19 +50,49 @@ const translateFromOpenlayersCoordinates = coords => {\n     .flatten()\n }\n \n+const isValidBufferWidth = bufferWidth =>\n+  !_.isNull(bufferWidth) && !_.isUndefined(bufferWidth) && '' != bufferWidth\n+\n /**\n- * Returns buffer width in meters with the lowest value of 1 meter.\n+ * Returns buffer width in meters, if applicable, with the lowest value of 1 meter.\n  */\n const getConstrainedBufferWidth = model => {\n+  const polygonWidthValue = model.get('polygonBufferWidth')\n+\n+  if (!isValidBufferWidth(polygonWidthValue)) return undefined\n+\n+  if (0 == polygonWidthValue) return undefined", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e71ad214e0526f1249cf0843e003e327d539af86"}, "originalPosition": 16}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc1Njk2MzAz", "url": "https://github.com/codice/ddf/pull/5898#pullrequestreview-375696303", "createdAt": "2020-03-17T02:18:28Z", "commit": {"oid": "e71ad214e0526f1249cf0843e003e327d539af86"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzMjEzMzAz", "url": "https://github.com/codice/ddf/pull/5898#pullrequestreview-383213303", "createdAt": "2020-03-27T21:34:56Z", "commit": {"oid": "e71ad214e0526f1249cf0843e003e327d539af86"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzNDU4OTk1", "url": "https://github.com/codice/ddf/pull/5898#pullrequestreview-393458995", "createdAt": "2020-04-15T05:09:03Z", "commit": {"oid": "e71ad214e0526f1249cf0843e003e327d539af86"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk2ODA5MjUz", "url": "https://github.com/codice/ddf/pull/5898#pullrequestreview-396809253", "createdAt": "2020-04-20T21:00:57Z", "commit": {"oid": "e71ad214e0526f1249cf0843e003e327d539af86"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "efc8112193911f430aeab5793425172d181ecd87", "author": {"user": null}, "url": "https://github.com/codice/ddf/commit/efc8112193911f430aeab5793425172d181ecd87", "committedDate": "2020-04-21T19:26:00Z", "message": "[2.19.x] DDF-5897: Fixed drawing polygons without buffers"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e71ad214e0526f1249cf0843e003e327d539af86", "author": {"user": null}, "url": "https://github.com/codice/ddf/commit/e71ad214e0526f1249cf0843e003e327d539af86", "committedDate": "2020-03-13T13:17:04Z", "message": "[2.19.x] DDF-5897: Fixed drawing polygons without buffers"}, "afterCommit": {"oid": "33b9e1ef286eeb2ef2b0fb7272c598a5126dda81", "author": {"user": null}, "url": "https://github.com/codice/ddf/commit/33b9e1ef286eeb2ef2b0fb7272c598a5126dda81", "committedDate": "2020-04-21T20:23:24Z", "message": "[2.19.x] DDF-5897: Added comment with related issue"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd56c5332c9c6d3d058fe28da47e8e72b9ae911e", "author": {"user": null}, "url": "https://github.com/codice/ddf/commit/bd56c5332c9c6d3d058fe28da47e8e72b9ae911e", "committedDate": "2020-04-21T20:39:28Z", "message": "[2.19.x] DDF-5897: Added comment with related issue"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "33b9e1ef286eeb2ef2b0fb7272c598a5126dda81", "author": {"user": null}, "url": "https://github.com/codice/ddf/commit/33b9e1ef286eeb2ef2b0fb7272c598a5126dda81", "committedDate": "2020-04-21T20:23:24Z", "message": "[2.19.x] DDF-5897: Added comment with related issue"}, "afterCommit": {"oid": "bd56c5332c9c6d3d058fe28da47e8e72b9ae911e", "author": {"user": null}, "url": "https://github.com/codice/ddf/commit/bd56c5332c9c6d3d058fe28da47e8e72b9ae911e", "committedDate": "2020-04-21T20:39:28Z", "message": "[2.19.x] DDF-5897: Added comment with related issue"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 65, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}