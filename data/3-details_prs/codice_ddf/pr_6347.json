{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkzMTcwODAw", "number": 6347, "title": "Prevent CVEs for docs and itests dependencies from appearing in OWASP reports and speed up OWASP scans during CI", "bodyText": "What does this PR do?\nPrevents CVEs for docs and itests dependencies from appearing in OWASP reports\n\nChanges scope of docs dependencies so they don't leak into distribution\nAdds an \"itests\" profile so all itest modules can be skipped. Previously we were only skipping the test-itests-ddf module so CVEs for the other modules were showing up\n\nSpeeds up OWASP scanning during CI\n\nRun the \"aggregate\" goal instead of \"check\".\nChange the \"owasp-dist\" profile to scan any zip build artifacts (i.e. kernel, distribution) when using the aggregate goal\n\nWith these changes, we now get OWASP reports for both PR and branch builds, and the branch builds include CVEs for the distro, kernel, etc. which they didn't before. Also, the scans run much faster. Here's the difference in performance (running on my laptop):\n\naggregate: 2:24 min\naggregate -Powasp-dist: 6:43 min\ncheck -Powasp-dist: 38:56 min\n\nWho is reviewing it?\n@bakejeyner @blen-desta @emmberk @garrettfreibott  @stustison\nSelect relevant component teams:\n@codice/continuous-integration\n@codice/security\nAsk 2 committers to review/merge the PR and tag them here.\n\nHow should this be tested?\nCI for the OWASP scan changes for PRs. Also for the itest stages. Should verify that:\n\nOWASP report is available\nReport contains no CVEs for docs or itest dependencies\n'Integration Tests Only Build' stage runs all itests except test-itests-ddf-core\n\nNot sure how to test the OWASP scanning changes for branch builds without merging.\nAny background context you want to provide?\nWhat are the relevant tickets?\nFixes: #____\nScreenshots\n\nChecklist:\n\n Documentation Updated\n Update / Add Threat Dragon models\n Update / Add Unit Tests\n Update / Add Integration Tests\n\nNotes on Review Process\nPlease see Notes on Review Process for further guidance on requirements for merging and abbreviated reviews.\nReview Comment Legend:\n\n\u270f\ufe0f (Pencil) This comment is a nitpick or style suggestion, no action required for approval. This comment should provide a suggestion either as an in line code snippet or a gist.\n\u2753 (Question Mark) This comment is to gain a clearer understanding of design or code choices, clarification is required but action may not be necessary for approval.\n\u2757 (Exclamation Mark) This comment is critical and requires clarification or action before approval.", "createdAt": "2020-09-25T16:00:14Z", "url": "https://github.com/codice/ddf/pull/6347", "merged": true, "mergeCommit": {"oid": "af75594147efc395db64a5d5abb3c2fb5f0c3fe3"}, "closed": true, "closedAt": "2020-10-23T22:09:52Z", "author": {"login": "SmithJosh"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdMYA7sAFqTQ5NjU1NDE4MQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdVeCpIgFqTUxNjAzNjgwMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk2NTU0MTgx", "url": "https://github.com/codice/ddf/pull/6347#pullrequestreview-496554181", "createdAt": "2020-09-25T16:03:03Z", "commit": {"oid": "9e1cc523e58b051d889a7e26f05f395c59b3d4db"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQxNjowMzowM1rOHYJsgQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQxNjowMzowM1rOHYJsgQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTA4NjcyMQ==", "bodyText": "This only works for the check goal. Not useful for aggregate", "url": "https://github.com/codice/ddf/pull/6347#discussion_r495086721", "createdAt": "2020-09-25T16:03:03Z", "author": {"login": "SmithJosh"}, "path": "distribution/test/pom.xml", "diffHunk": "@@ -60,22 +60,4 @@\n             </dependency>\n         </dependencies>\n     </dependencyManagement>\n-    <build>\n-        <plugins>\n-            <!-- Disable vulnerability checks since this project only contains tests -->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9e1cc523e58b051d889a7e26f05f395c59b3d4db"}, "originalPosition": 6}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9e1cc523e58b051d889a7e26f05f395c59b3d4db", "author": {"user": {"login": "SmithJosh", "name": "Joshua Smith"}}, "url": "https://github.com/codice/ddf/commit/9e1cc523e58b051d889a7e26f05f395c59b3d4db", "committedDate": "2020-09-25T01:29:28Z", "message": "Skip all itests for OWASP scan and only run aggregate goal for CI"}, "afterCommit": {"oid": "9fb3c23dfe59fa25fa25f28a0df07589aab2cccf", "author": {"user": {"login": "SmithJosh", "name": "Joshua Smith"}}, "url": "https://github.com/codice/ddf/commit/9fb3c23dfe59fa25fa25f28a0df07589aab2cccf", "committedDate": "2020-09-25T01:31:22Z", "message": "Skip all itests for OWASP scan and only run aggregate goal for CI"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk2NTYyMDI5", "url": "https://github.com/codice/ddf/pull/6347#pullrequestreview-496562029", "createdAt": "2020-09-25T16:13:53Z", "commit": {"oid": "9fb3c23dfe59fa25fa25f28a0df07589aab2cccf"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk2NTU3ODAw", "url": "https://github.com/codice/ddf/pull/6347#pullrequestreview-496557800", "createdAt": "2020-09-25T16:08:01Z", "commit": {"oid": "9fb3c23dfe59fa25fa25f28a0df07589aab2cccf"}, "state": "APPROVED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQxNjowODowMVrOHYJ3OA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQxNjoyMDoxNlrOHYKRjg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTA4OTQ2NA==", "bodyText": "\u270f\ufe0f Is this property needed anymore now that there is an itest profile?", "url": "https://github.com/codice/ddf/pull/6347#discussion_r495089464", "createdAt": "2020-09-25T16:08:01Z", "author": {"login": "emmberk"}, "path": "Jenkinsfile", "diffHunk": "@@ -26,7 +26,7 @@ pipeline {\n     }\n     environment {\n         DOCS = 'distribution/docs'\n-        ITESTS = 'distribution/test/itests/test-itests-ddf'\n+        ITESTS = 'distribution/test/itests'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9fb3c23dfe59fa25fa25f28a0df07589aab2cccf"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTA5MjcwMg==", "bodyText": "\u270f\ufe0f Why is -amd needed here?", "url": "https://github.com/codice/ddf/pull/6347#discussion_r495092702", "createdAt": "2020-09-25T16:13:46Z", "author": {"login": "emmberk"}, "path": "Jenkinsfile", "diffHunk": "@@ -96,7 +96,7 @@ pipeline {\n                 withMaven(maven: 'maven-latest', globalMavenSettingsConfig: 'default-global-settings', mavenSettingsConfig: 'codice-maven-settings', mavenOpts: '${LARGE_MVN_OPTS} ${LINUX_MVN_RANDOM}') {\n                     sh '''\n                         unset JAVA_TOOL_OPTIONS\n-                        mvn install -B -pl $ITESTS -nsu $DISABLE_DOWNLOAD_PROGRESS_OPTS\n+                        mvn install -B -pl $ITESTS,!$ITCORE -amd -nsu $DISABLE_DOWNLOAD_PROGRESS_OPTS", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9fb3c23dfe59fa25fa25f28a0df07589aab2cccf"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTA5NTE0MQ==", "bodyText": "\u270f\ufe0f Why not just always scan the zips? Is it because it takes longer to run?", "url": "https://github.com/codice/ddf/pull/6347#discussion_r495095141", "createdAt": "2020-09-25T16:18:18Z", "author": {"login": "emmberk"}, "path": "pom.xml", "diffHunk": "@@ -1048,8 +1040,11 @@\n                 </plugins>\n             </build>\n         </profile>\n+        <!-- Adds all zip build artifacts to the OWASP scan. This includes the kernel, the DDF\n+             distro, etc. Those may include artifacts which aren't actually dependencies of any\n+             DDF modules, so won't appear in a normal scan. -->\n         <profile>\n-            <id>owasp</id>\n+            <id>owasp-dist</id>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9fb3c23dfe59fa25fa25f28a0df07589aab2cccf"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTA5NjIwNg==", "bodyText": "\u270f\ufe0f Shouldn't we always scan the distribution (i.e. zip files), even if this is a PR build? Is this if/else really necessary if it's not scanning changed modules?", "url": "https://github.com/codice/ddf/pull/6347#discussion_r495096206", "createdAt": "2020-09-25T16:20:16Z", "author": {"login": "emmberk"}, "path": "Jenkinsfile", "diffHunk": "@@ -134,9 +134,9 @@ pipeline {\n                     script {\n                         // If this build is not a pull request, run owasp scan on the distribution. Otherwise run incremental scan\n                         if (env.CHANGE_ID == null) {\n-                            sh 'mvn org.commonjava.maven.plugins:directory-maven-plugin:highest-basedir@directories dependency-check:check dependency-check:aggregate -q -B -Powasp-dist -DskipTests=true -DskipStatic=true -pl !$DOCS $DISABLE_DOWNLOAD_PROGRESS_OPTS'\n+                            sh 'mvn org.commonjava.maven.plugins:directory-maven-plugin:highest-basedir@directories dependency-check:aggregate -q -B -pl !$DOCS -P !itests,owasp-dist $DISABLE_DOWNLOAD_PROGRESS_OPTS'\n                         } else {\n-                            sh 'mvn org.commonjava.maven.plugins:directory-maven-plugin:highest-basedir@directories dependency-check:check -q -B -Powasp -DskipTests=true -DskipStatic=true -pl !$DOCS -Dgib.enabled=true -Dgib.referenceBranch=/refs/remotes/origin/$CHANGE_TARGET $DISABLE_DOWNLOAD_PROGRESS_OPTS'\n+                            sh 'mvn org.commonjava.maven.plugins:directory-maven-plugin:highest-basedir@directories dependency-check:aggregate -q -B -pl !$DOCS -P !itests $DISABLE_DOWNLOAD_PROGRESS_OPTS'\n                         }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9fb3c23dfe59fa25fa25f28a0df07589aab2cccf"}, "originalPosition": 53}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk2NTkwNzI3", "url": "https://github.com/codice/ddf/pull/6347#pullrequestreview-496590727", "createdAt": "2020-09-25T16:55:28Z", "commit": {"oid": "9fb3c23dfe59fa25fa25f28a0df07589aab2cccf"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk2NjI2ODA0", "url": "https://github.com/codice/ddf/pull/6347#pullrequestreview-496626804", "createdAt": "2020-09-25T17:48:53Z", "commit": {"oid": "9fb3c23dfe59fa25fa25f28a0df07589aab2cccf"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3NjQwOTIw", "url": "https://github.com/codice/ddf/pull/6347#pullrequestreview-497640920", "createdAt": "2020-09-28T15:21:35Z", "commit": {"oid": "9fb3c23dfe59fa25fa25f28a0df07589aab2cccf"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNToyMTozNlrOHZDiwQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxNToyNTowNlrOHZDx4g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjAzNDQ5Nw==", "bodyText": "Nice idea using a profile.", "url": "https://github.com/codice/ddf/pull/6347#discussion_r496034497", "createdAt": "2020-09-28T15:21:36Z", "author": {"login": "shaundmorris"}, "path": "Jenkinsfile", "diffHunk": "@@ -68,22 +68,22 @@ pipeline {\n             steps {\n                 withMaven(maven: 'maven-latest', globalMavenSettingsConfig: 'default-global-settings', mavenSettingsConfig: 'codice-maven-settings', mavenOpts: '${LARGE_MVN_OPTS} ${LINUX_MVN_RANDOM}') {\n                     sh 'mvn install -B -DskipStatic=true -DskipTests=true $DISABLE_DOWNLOAD_PROGRESS_OPTS'\n-                    sh 'mvn clean install -B -pl !$ITESTS,!$ITCORE -Dgib.enabled=true -Dgib.referenceBranch=/refs/remotes/origin/$CHANGE_TARGET $DISABLE_DOWNLOAD_PROGRESS_OPTS'\n+                    sh 'mvn clean install -B -P !itests -Dgib.enabled=true -Dgib.referenceBranch=/refs/remotes/origin/$CHANGE_TARGET $DISABLE_DOWNLOAD_PROGRESS_OPTS'", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9fb3c23dfe59fa25fa25f28a0df07589aab2cccf"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjAzNzYyMA==", "bodyText": "Yes, this seems like the original decision we had on PR builds. It is not the ideal state but probably the best balance of performance, maintenance on dependencies, and process at the moment.", "url": "https://github.com/codice/ddf/pull/6347#discussion_r496037620", "createdAt": "2020-09-28T15:24:16Z", "author": {"login": "shaundmorris"}, "path": "Jenkinsfile", "diffHunk": "@@ -134,9 +134,9 @@ pipeline {\n                     script {\n                         // If this build is not a pull request, run owasp scan on the distribution. Otherwise run incremental scan\n                         if (env.CHANGE_ID == null) {\n-                            sh 'mvn org.commonjava.maven.plugins:directory-maven-plugin:highest-basedir@directories dependency-check:check dependency-check:aggregate -q -B -Powasp-dist -DskipTests=true -DskipStatic=true -pl !$DOCS $DISABLE_DOWNLOAD_PROGRESS_OPTS'\n+                            sh 'mvn org.commonjava.maven.plugins:directory-maven-plugin:highest-basedir@directories dependency-check:aggregate -q -B -pl !$DOCS -P !itests,owasp-dist $DISABLE_DOWNLOAD_PROGRESS_OPTS'\n                         } else {\n-                            sh 'mvn org.commonjava.maven.plugins:directory-maven-plugin:highest-basedir@directories dependency-check:check -q -B -Powasp -DskipTests=true -DskipStatic=true -pl !$DOCS -Dgib.enabled=true -Dgib.referenceBranch=/refs/remotes/origin/$CHANGE_TARGET $DISABLE_DOWNLOAD_PROGRESS_OPTS'\n+                            sh 'mvn org.commonjava.maven.plugins:directory-maven-plugin:highest-basedir@directories dependency-check:aggregate -q -B -pl !$DOCS -P !itests $DISABLE_DOWNLOAD_PROGRESS_OPTS'\n                         }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTA5NjIwNg=="}, "originalCommit": {"oid": "9fb3c23dfe59fa25fa25f28a0df07589aab2cccf"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjAzODM3MA==", "bodyText": "\u2754 I assume making the docs provided scope means they won't be evaluated by dependency-check?", "url": "https://github.com/codice/ddf/pull/6347#discussion_r496038370", "createdAt": "2020-09-28T15:25:06Z", "author": {"login": "shaundmorris"}, "path": "distribution/docs/pom.xml", "diffHunk": "@@ -33,16 +33,19 @@\n             <groupId>org.asciidoctor</groupId>\n             <artifactId>asciidoctorj</artifactId>\n             <version>${asciidoctorj.version}</version>\n+            <scope>provided</scope>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9fb3c23dfe59fa25fa25f28a0df07589aab2cccf"}, "originalPosition": 13}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5ODc0NTgx", "url": "https://github.com/codice/ddf/pull/6347#pullrequestreview-499874581", "createdAt": "2020-09-30T23:15:40Z", "commit": {"oid": "9fb3c23dfe59fa25fa25f28a0df07589aab2cccf"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9fb3c23dfe59fa25fa25f28a0df07589aab2cccf", "author": {"user": {"login": "SmithJosh", "name": "Joshua Smith"}}, "url": "https://github.com/codice/ddf/commit/9fb3c23dfe59fa25fa25f28a0df07589aab2cccf", "committedDate": "2020-09-25T01:31:22Z", "message": "Skip all itests for OWASP scan and only run aggregate goal for CI"}, "afterCommit": {"oid": "9a412cafb94930ee333900164a30817971f9ce61", "author": {"user": {"login": "SmithJosh", "name": "Joshua Smith"}}, "url": "https://github.com/codice/ddf/commit/9a412cafb94930ee333900164a30817971f9ce61", "committedDate": "2020-10-01T15:20:07Z", "message": "Skip all itests for OWASP scan and only run aggregate goal for CI"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyMTAyNzU1", "url": "https://github.com/codice/ddf/pull/6347#pullrequestreview-502102755", "createdAt": "2020-10-05T14:17:19Z", "commit": {"oid": "9a412cafb94930ee333900164a30817971f9ce61"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ac2a3cfee367c8b3c2c73b382ae50dfeb8f81e3f", "author": {"user": {"login": "SmithJosh", "name": "Joshua Smith"}}, "url": "https://github.com/codice/ddf/commit/ac2a3cfee367c8b3c2c73b382ae50dfeb8f81e3f", "committedDate": "2020-10-23T18:50:34Z", "message": "Skip all itests for OWASP scan and only run aggregate goal for CI"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9a412cafb94930ee333900164a30817971f9ce61", "author": {"user": {"login": "SmithJosh", "name": "Joshua Smith"}}, "url": "https://github.com/codice/ddf/commit/9a412cafb94930ee333900164a30817971f9ce61", "committedDate": "2020-10-01T15:20:07Z", "message": "Skip all itests for OWASP scan and only run aggregate goal for CI"}, "afterCommit": {"oid": "ac2a3cfee367c8b3c2c73b382ae50dfeb8f81e3f", "author": {"user": {"login": "SmithJosh", "name": "Joshua Smith"}}, "url": "https://github.com/codice/ddf/commit/ac2a3cfee367c8b3c2c73b382ae50dfeb8f81e3f", "committedDate": "2020-10-23T18:50:34Z", "message": "Skip all itests for OWASP scan and only run aggregate goal for CI"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE2MDM2ODAx", "url": "https://github.com/codice/ddf/pull/6347#pullrequestreview-516036801", "createdAt": "2020-10-23T22:09:41Z", "commit": {"oid": "ac2a3cfee367c8b3c2c73b382ae50dfeb8f81e3f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 757, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}