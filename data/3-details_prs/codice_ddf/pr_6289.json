{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc4ODMyNzM2", "number": 6289, "title": "[2.25.x] DDF-6272 Fix thumbnail generation for .ppt and .pptx files", "bodyText": "What does this PR do?\nFixes thumbnail generation\nNOTE: This does not completely fix thumbnail generation. PPTs with SVG content will still fail due to an issue with the POI bundle (ingest will succeed, but no thumnail is generated). See apache/servicemix-bundles#145 (review)\nWho is reviewing it?\n\n@emmberk @blen-desta @bakejeyner @garrettfreibott @stustison\nSelect relevant component teams:\n\n@codice/security\n@codice/data\nAsk 2 committers to review/merge the PR and tag them here.\n\nHow should this be tested?\n\nAny background context you want to provide?\n#6138 changed the PPTX input transformer so it no longer embeds POI, so now the classes are located in the separate bundle. But the transformer was still setting the thread classloader to its bundle classloader though, so POI would try to load classes from the wrong bundle.\nWhat are the relevant tickets?\nFixes: #6272\nScreenshots\n\nChecklist:\n\n Documentation Updated\n Update / Add Threat Dragon models\n Update / Add Unit Tests\n Update / Add Integration Tests\n\nNotes on Review Process\nPlease see Notes on Review Process for further guidance on requirements for merging and abbreviated reviews.\nReview Comment Legend:\n\n\u270f\ufe0f (Pencil) This comment is a nitpick or style suggestion, no action required for approval. This comment should provide a suggestion either as an in line code snippet or a gist.\n\u2753 (Question Mark) This comment is to gain a clearer understanding of design or code choices, clarification is required but action may not be necessary for approval.\n\u2757 (Exclamation Mark) This comment is critical and requires clarification or action before approval.", "createdAt": "2020-09-03T19:01:23Z", "url": "https://github.com/codice/ddf/pull/6289", "merged": true, "mergeCommit": {"oid": "60abd0520989c1147b0018549c8c94004a8815da"}, "closed": true, "closedAt": "2020-09-10T16:06:17Z", "author": {"login": "SmithJosh"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdFVWSAAH2gAyNDc4ODMyNzM2OmJhOGY1MjVhMTFmNmU5Y2I3NTg4YjA4ZGEzYmQ5ZDA4ZTlkNDU4YmM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdHQL6iAFqTQ4NTI3Mjc3OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ba8f525a11f6e9cb7588b08da3bd9d08e9d458bc", "author": {"user": {"login": "SmithJosh", "name": "Joshua Smith"}}, "url": "https://github.com/codice/ddf/commit/ba8f525a11f6e9cb7588b08da3bd9d08e9d458bc", "committedDate": "2020-09-03T18:59:12Z", "message": "DDF-6272 Fix thumbnail generation for .ppt and .pptx files"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgyMTI0MjQ2", "url": "https://github.com/codice/ddf/pull/6289#pullrequestreview-482124246", "createdAt": "2020-09-03T19:04:13Z", "commit": {"oid": "ba8f525a11f6e9cb7588b08da3bd9d08e9d458bc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgyMTMyMTk2", "url": "https://github.com/codice/ddf/pull/6289#pullrequestreview-482132196", "createdAt": "2020-09-03T19:16:32Z", "commit": {"oid": "ba8f525a11f6e9cb7588b08da3bd9d08e9d458bc"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QxOToxNjozMlrOHM0O4w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QxOToxNjozMlrOHM0O4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzIwMDczOQ==", "bodyText": "\u270f\ufe0f Add an itest for ingesting a powerpoint and verifying that the thumbnail metacard attribute is populated to prevent this regression in the future.", "url": "https://github.com/codice/ddf/pull/6289#discussion_r483200739", "createdAt": "2020-09-03T19:16:32Z", "author": {"login": "emmberk"}, "path": "catalog/transformer/catalog-transformer-pptx/src/main/java/ddf/catalog/transformer/input/pptx/PptxInputTransformer.java", "diffHunk": "@@ -150,7 +150,8 @@ private Metacard extractInitialMetadata(InputStream input)\n   private void extractThumbnail(Metacard metacard, InputStream input) throws IOException {\n \n     ClassLoader originalContextClassLoader = Thread.currentThread().getContextClassLoader();\n-    Thread.currentThread().setContextClassLoader(getClass().getClassLoader());\n+    // This class is arbitrary. It just needs to be part of the bundle exporting POI classes\n+    Thread.currentThread().setContextClassLoader(SlideShowFactory.class.getClassLoader());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ba8f525a11f6e9cb7588b08da3bd9d08e9d458bc"}, "originalPosition": 17}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg0NDk2NzIx", "url": "https://github.com/codice/ddf/pull/6289#pullrequestreview-484496721", "createdAt": "2020-09-08T21:12:50Z", "commit": {"oid": "ba8f525a11f6e9cb7588b08da3bd9d08e9d458bc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e5427482ae599077e3a2630ca3b80e1b00472a16", "author": {"user": {"login": "SmithJosh", "name": "Joshua Smith"}}, "url": "https://github.com/codice/ddf/commit/e5427482ae599077e3a2630ca3b80e1b00472a16", "committedDate": "2020-09-08T21:45:08Z", "message": "DDF-6272 Add itest"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1MjYyNTg1", "url": "https://github.com/codice/ddf/pull/6289#pullrequestreview-485262585", "createdAt": "2020-09-09T17:52:04Z", "commit": {"oid": "e5427482ae599077e3a2630ca3b80e1b00472a16"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg1MjcyNzc4", "url": "https://github.com/codice/ddf/pull/6289#pullrequestreview-485272778", "createdAt": "2020-09-09T18:06:12Z", "commit": {"oid": "e5427482ae599077e3a2630ca3b80e1b00472a16"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 897, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}