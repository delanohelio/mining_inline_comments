{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQxNjY0MjQw", "number": 6155, "reviewThreads": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxOToxMzozM1rOEKoXWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQyMDozNDo0NlrOELC7iQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5NTgyNTUzOnYy", "diffSide": "RIGHT", "path": "features/security/src/main/feature/feature.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxOToxMzozM1rOGryP6g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxOToxMzozM1rOGryP6g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODU2NTIyNg==", "bodyText": "\u270f\ufe0f We should make a ticket to remove these Nimbus dependencies from being needed by the APIs. Seems like we must be leaking these things somewhere so we need to clean it up.", "url": "https://github.com/codice/ddf/pull/6155#discussion_r448565226", "createdAt": "2020-07-01T19:13:33Z", "author": {"login": "stustison"}, "path": "features/security/src/main/feature/feature.xml", "diffHunk": "@@ -21,694 +21,317 @@\n     <repository>mvn:ddf.features/kernel/${project.version}/xml/features</repository>\n     <repository>mvn:ddf.features/utilities/${project.version}/xml/features</repository>\n     <repository>mvn:ddf.features/branding/${project.version}/xml/features</repository>\n+    <repository>mvn:ddf.features/camel/${project.version}/xml/features</repository>\n \n-    <feature name=\"security-logger\" version=\"${project.version}\"\n-             description=\"Logs incoming and outgoing requests\">\n-        <feature>security-core-api</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.interceptor/security-interceptor-logger/${project.version}</bundle>\n-    </feature>\n+    <feature name=\"security-core-api-dependencies\" version=\"${project.version\"\n+             description=\"Dependencies for the core security APIs.\">\n+        <!-- Third Party Features -->\n+        <feature prerequisite=\"true\">wrap</feature>\n+        <feature>pax-http-whiteboard</feature>\n \n-    <feature name=\"security-core-api\" version=\"${project.version}\"\n-             description=\"Security Core\">\n-        <bundle start-level=\"30\">mvn:org.apache.neethi/neethi/${wss4j.neethi.version}</bundle>\n-        <feature>cxf-rt-security</feature>\n-        <feature>security-filter-api</feature>\n+        <!-- External DDF Features -->\n+        <feature>jackson</feature>\n+        <feature>wss4j</feature>\n+        <feature>cxf-ws-security</feature>\n         <feature>cxf-jaxrs</feature>\n-        <feature>platform-util</feature>\n-        <bundle dependency=\"true\">mvn:ddf.platform.security/log-sanitizer/${project.version}</bundle>\n-        <bundle dependency=\"true\">mvn:org.apache.commons/commons-configuration2/${commons-configuration2.version}</bundle>\n-        <bundle dependency=\"true\">mvn:org.apache.shiro/shiro-core/${apache.shiro.version}</bundle>\n-\n-        <feature>guava</feature>\n+        <feature>cxf-bindings-soap</feature>\n         <feature>common-system</feature>\n \n-        <bundle>mvn:joda-time/joda-time/${joda-time.version}</bundle>\n-        <bundle>mvn:org.apache.santuario/xmlsec/${xmlsec.version}</bundle>\n+        <!-- NimbusDS -->", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5fe3c153d747edf954bc7be7ba8835a00d20f2da"}, "originalPosition": 40}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5NTgzMTMyOnYy", "diffSide": "RIGHT", "path": "features/security/src/main/feature/feature.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxOToxNTozMFrOGryTYw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxOToxNTozMFrOGryTYw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODU2NjExNQ==", "bodyText": "\u270f\ufe0f This bundle is just a wrap of some of the oidc dependencies, so it should probably go in the dependencies feature of whatever feature is actually using it. Probably impl or services.", "url": "https://github.com/codice/ddf/pull/6155#discussion_r448566115", "createdAt": "2020-07-01T19:15:30Z", "author": {"login": "stustison"}, "path": "features/security/src/main/feature/feature.xml", "diffHunk": "@@ -21,694 +21,317 @@\n     <repository>mvn:ddf.features/kernel/${project.version}/xml/features</repository>\n     <repository>mvn:ddf.features/utilities/${project.version}/xml/features</repository>\n     <repository>mvn:ddf.features/branding/${project.version}/xml/features</repository>\n+    <repository>mvn:ddf.features/camel/${project.version}/xml/features</repository>\n \n-    <feature name=\"security-logger\" version=\"${project.version}\"\n-             description=\"Logs incoming and outgoing requests\">\n-        <feature>security-core-api</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.interceptor/security-interceptor-logger/${project.version}</bundle>\n-    </feature>\n+    <feature name=\"security-core-api-dependencies\" version=\"${project.version\"\n+             description=\"Dependencies for the core security APIs.\">\n+        <!-- Third Party Features -->\n+        <feature prerequisite=\"true\">wrap</feature>\n+        <feature>pax-http-whiteboard</feature>\n \n-    <feature name=\"security-core-api\" version=\"${project.version}\"\n-             description=\"Security Core\">\n-        <bundle start-level=\"30\">mvn:org.apache.neethi/neethi/${wss4j.neethi.version}</bundle>\n-        <feature>cxf-rt-security</feature>\n-        <feature>security-filter-api</feature>\n+        <!-- External DDF Features -->\n+        <feature>jackson</feature>\n+        <feature>wss4j</feature>\n+        <feature>cxf-ws-security</feature>\n         <feature>cxf-jaxrs</feature>\n-        <feature>platform-util</feature>\n-        <bundle dependency=\"true\">mvn:ddf.platform.security/log-sanitizer/${project.version}</bundle>\n-        <bundle dependency=\"true\">mvn:org.apache.commons/commons-configuration2/${commons-configuration2.version}</bundle>\n-        <bundle dependency=\"true\">mvn:org.apache.shiro/shiro-core/${apache.shiro.version}</bundle>\n-\n-        <feature>guava</feature>\n+        <feature>cxf-bindings-soap</feature>\n         <feature>common-system</feature>\n \n-        <bundle>mvn:joda-time/joda-time/${joda-time.version}</bundle>\n-        <bundle>mvn:org.apache.santuario/xmlsec/${xmlsec.version}</bundle>\n+        <!-- NimbusDS -->\n+        <bundle>wrap:mvn:com.nimbusds/nimbus-jose-jwt/${nimbus.version}</bundle>\n+        <bundle>wrap:mvn:com.nimbusds/oauth2-oidc-sdk/${nimbus.oidc.version}</bundle>\n+        <bundle>mvn:com.nimbusds/content-type/${nimbus.content-type.version}</bundle>\n+        <bundle>mvn:com.nimbusds/lang-tag/${nimbus.langtag.version}</bundle>\n \n-        <feature>cxf-bindings-soap</feature>\n-        <feature>cxf-ws-policy</feature>\n-        <feature>cxf-ws-security</feature>\n-        <feature>spring</feature>\n+        <!-- MiniDev -->\n+        <bundle>mvn:net.minidev/accessors-smart/1.2</bundle>\n+        <bundle>mvn:net.minidev/json-smart/2.3</bundle>\n \n-        <!--  TODO (https://github.com/codice/ddf/issues/5327)\n-                Remove wrapped OpenSAML after security refactor is complete  -->\n-        <!--  <bundle>mvn:org.apache.servicemix.bundles/org.apache.servicemix.bundles.opensaml/${opensaml.osgi.version}-->\n-        <!--  </bundle>-->\n-        <bundle>mvn:ddf.lib.bundles/libs-bundles-opensaml/${project.version}</bundle>\n+        <!-- Miscellaneous -->\n+        <bundle dependency=\"true\">mvn:org.apache.shiro/shiro-core/${apache.shiro.version}</bundle>\n+        <bundle>mvn:com.sun.mail/javax.mail/${javax-mail.version}</bundle>\n+        <!--\n+            net.minidev/accessors-smart/1.2 uses asm v5.x. Need this resolved before we can upgrade:\n+            https://bitbucket.org/connect2id/nimbus-jose-jwt/issues/239/switch-to-other-json-library\n+        -->\n+        <bundle>mvn:org.ow2.asm/asm/5.2</bundle>\n+        <bundle>wrap:mvn:com.github.stephenc.jcip/jcip-annotations/1.0-1</bundle>\n+    </feature>\n \n+    <feature name=\"security-core-api\" version=\"${project.version}\"\n+             description=\"Core security APIs.\">\n+        <feature>security-core-api-dependencies</feature>\n+\n+        <!-- Core -->\n         <bundle>mvn:ddf.security.core/security-core-api/${project.version}</bundle>\n+\n+        <!-- Country Converter -->\n+        <bundle>mvn:ddf.platform.country/platform-country-converter-api/${project.version}</bundle>\n+\n+        <!-- Rest Client -->\n         <bundle>mvn:ddf.platform.security/security-rest-clientapi/${project.version}</bundle>\n-        <bundle>\n-            mvn:org.apache.servicemix.bundles/org.apache.servicemix.bundles.jaxen/${org.apache.servicemix.bundles.jaxen.version}\n-        </bundle>\n-    </feature>\n \n-    <feature name=\"security-filter-api\" version=\"${project.version}\">\n-        <bundle>mvn:javax.servlet/javax.servlet-api/${javax.servlet-api-version}</bundle>\n+        <!-- Filters -->\n         <bundle>mvn:ddf.platform/security-filter-api/${project.version}</bundle>\n-    </feature>\n \n-    <feature name=\"platform-error-page-injector\" version=\"${project.version}\"\n-             description=\"Adding a better error page to Jetty\">\n-        <feature>error-api</feature>\n-        <bundle>mvn:ddf.platform.error/platform-error-page-injector/${project.version}</bundle>\n-    </feature>\n+        <!-- Handlers -->\n+        <bundle>mvn:ddf.security.handler/security-handler-api/${project.version}</bundle>\n \n-    <feature name=\"security-encryption\" version=\"${project.version}\"\n-             description=\"Security Encryption\">\n-        <feature>wss4j</feature>\n-        <bundle>mvn:org.apache.commons/commons-lang3/${commons-lang3.version}</bundle>\n+        <!-- Policy -->\n+        <bundle>mvn:ddf.security.policy/security-policy-api/${project.version}</bundle>\n+\n+        <!-- Encryption -->\n         <bundle>mvn:ddf.security.encryption/security-encryption-api/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.encryption/security-encryption-impl/${project.version}</bundle>\n-        <bundle dependency=\"true\">mvn:ddf.platform.security/log-sanitizer/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.encryption/security-encryption-commands/${project.version}</bundle>\n-    </feature>\n \n-    <feature name=\"web-container\" version=\"${project.version}\">\n-        <feature>platform-paxweb-jettyconfig</feature>\n-        <feature>platform-error-page-injector</feature>\n-        <feature>war</feature>\n-    </feature>\n+        <!-- Expansion -->\n+        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n \n-    <feature name=\"session-invalidator\" version=\"${project.version}\"\n-             description=\"API for invalidating servlet sessions\">\n-        <bundle>mvn:ddf.platform/platform-session-invalidator/${project.version}</bundle>\n-    </feature>\n+        <!-- Token Storage -->\n+        <bundle>mvn:ddf.security.storage/token-storage-api/${project.version}</bundle>\n \n-    <feature name=\"platform-paxweb-jettyconfig\" version=\"${project.version}\"\n-      description=\"Custom Session Manager\">\n-        <config name=\"org.ops4j.pax.web\" append=\"true\">\n-#######################################\n-# Jetty Server Authenticator Settings\n-#######################################\n+        <!-- Sessions -->\n+        <bundle>mvn:ddf.platform.security/session-management-api/${project.version}</bundle>\n+        <bundle>mvn:ddf.platform/platform-session-invalidator-api/${project.version}</bundle>\n \n-# Set the authmethod/realmname so that our JettyAuthenticator is used\n-org.ops4j.pax.web.default.authmethod=DDF\n-org.ops4j.pax.web.default.realmname=DDF\n-        </config>\n-        <feature version=\"${spring.version}_1\">spring</feature>\n-        <feature>apache-commons</feature>\n-        <feature>security-core-api</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-core-services</feature>\n-        <feature>security-filter-api</feature>\n-        <feature>pax-http-jetty</feature>\n-        <bundle start-level=\"30\">mvn:org.ops4j.pax.web/pax-web-jsp/${pax.web.version}</bundle>\n-        <bundle>mvn:javax.el/javax.el-api/3.0.0</bundle>\n-        <feature>pax-jetty</feature>\n-        <feature>session-invalidator</feature>\n-        <feature prerequisite=\"true\">wrap</feature>\n-        <bundle>wrap:mvn:net.jodah/failsafe/${jodah-failsafe.version}</bundle>\n-        <feature>guava</feature>\n-        <feature>common-system</feature>\n-        <bundle>mvn:ddf.platform/platform-paxweb-jettyconfig/${project.version}</bundle>\n-    </feature>\n+        <!-- Logout -->\n+        <bundle>mvn:ddf.security.servlet/security-servlet-logout-api/${project.version}</bundle>\n \n-    <feature name=\"security-handler-api\" version=\"${project.version}\"\n-             description=\"API for authentication handlers for web applications.\">\n-        <feature>security-core-api</feature>\n-        <feature>parser-xml</feature>\n-        <feature>oidc-dependencies</feature>\n-        <bundle>mvn:org.apache.cxf/cxf-rt-rs-security-jose/${cxf.version}</bundle>\n-        <bundle>mvn:org.apache.cxf/cxf-rt-rs-security-jose-jaxrs/${cxf.version}</bundle>\n-        <bundle>mvn:ddf.security.handler/security-handler-api/${project.version}</bundle>\n-    </feature>\n+        <!-- Email -->\n+        <bundle>mvn:ddf.platform.email/platform-email-api/${project.version}</bundle>\n \n-    <feature name=\"security-handler-impl\" version=\"${project.version}\"\n-             description=\"Implementation used by all security handlers\">\n-        <feature>security-core-api</feature>\n-        <feature>security-core-impl</feature>\n-        <bundle>mvn:ddf.security.handler/security-handler-impl/${project.version}</bundle>\n+        <!-- Miscellaneous -->\n+        <bundle>mvn:ddf.security.servlet/security-servlet-web-socket-api/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.interceptor/security-interceptor-guest-wrapper/${project.version}</bundle>\n+        <bundle>mvn:ddf.platform.security/security-oidc-bundle/${project.version}</bundle>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5fe3c153d747edf954bc7be7ba8835a00d20f2da"}, "originalPosition": 184}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5NTg0NzkyOnYy", "diffSide": "RIGHT", "path": "features/security/src/main/feature/feature.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxOToyMToyNFrOGrydqg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxOToyMToyNFrOGrydqg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODU2ODc0Ng==", "bodyText": "\u270f\ufe0f I think this one belongs in impl", "url": "https://github.com/codice/ddf/pull/6155#discussion_r448568746", "createdAt": "2020-07-01T19:21:24Z", "author": {"login": "stustison"}, "path": "features/security/src/main/feature/feature.xml", "diffHunk": "@@ -21,694 +21,317 @@\n     <repository>mvn:ddf.features/kernel/${project.version}/xml/features</repository>\n     <repository>mvn:ddf.features/utilities/${project.version}/xml/features</repository>\n     <repository>mvn:ddf.features/branding/${project.version}/xml/features</repository>\n+    <repository>mvn:ddf.features/camel/${project.version}/xml/features</repository>\n \n-    <feature name=\"security-logger\" version=\"${project.version}\"\n-             description=\"Logs incoming and outgoing requests\">\n-        <feature>security-core-api</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.interceptor/security-interceptor-logger/${project.version}</bundle>\n-    </feature>\n+    <feature name=\"security-core-api-dependencies\" version=\"${project.version\"\n+             description=\"Dependencies for the core security APIs.\">\n+        <!-- Third Party Features -->\n+        <feature prerequisite=\"true\">wrap</feature>\n+        <feature>pax-http-whiteboard</feature>\n \n-    <feature name=\"security-core-api\" version=\"${project.version}\"\n-             description=\"Security Core\">\n-        <bundle start-level=\"30\">mvn:org.apache.neethi/neethi/${wss4j.neethi.version}</bundle>\n-        <feature>cxf-rt-security</feature>\n-        <feature>security-filter-api</feature>\n+        <!-- External DDF Features -->\n+        <feature>jackson</feature>\n+        <feature>wss4j</feature>\n+        <feature>cxf-ws-security</feature>\n         <feature>cxf-jaxrs</feature>\n-        <feature>platform-util</feature>\n-        <bundle dependency=\"true\">mvn:ddf.platform.security/log-sanitizer/${project.version}</bundle>\n-        <bundle dependency=\"true\">mvn:org.apache.commons/commons-configuration2/${commons-configuration2.version}</bundle>\n-        <bundle dependency=\"true\">mvn:org.apache.shiro/shiro-core/${apache.shiro.version}</bundle>\n-\n-        <feature>guava</feature>\n+        <feature>cxf-bindings-soap</feature>\n         <feature>common-system</feature>\n \n-        <bundle>mvn:joda-time/joda-time/${joda-time.version}</bundle>\n-        <bundle>mvn:org.apache.santuario/xmlsec/${xmlsec.version}</bundle>\n+        <!-- NimbusDS -->\n+        <bundle>wrap:mvn:com.nimbusds/nimbus-jose-jwt/${nimbus.version}</bundle>\n+        <bundle>wrap:mvn:com.nimbusds/oauth2-oidc-sdk/${nimbus.oidc.version}</bundle>\n+        <bundle>mvn:com.nimbusds/content-type/${nimbus.content-type.version}</bundle>\n+        <bundle>mvn:com.nimbusds/lang-tag/${nimbus.langtag.version}</bundle>\n \n-        <feature>cxf-bindings-soap</feature>\n-        <feature>cxf-ws-policy</feature>\n-        <feature>cxf-ws-security</feature>\n-        <feature>spring</feature>\n+        <!-- MiniDev -->\n+        <bundle>mvn:net.minidev/accessors-smart/1.2</bundle>\n+        <bundle>mvn:net.minidev/json-smart/2.3</bundle>\n \n-        <!--  TODO (https://github.com/codice/ddf/issues/5327)\n-                Remove wrapped OpenSAML after security refactor is complete  -->\n-        <!--  <bundle>mvn:org.apache.servicemix.bundles/org.apache.servicemix.bundles.opensaml/${opensaml.osgi.version}-->\n-        <!--  </bundle>-->\n-        <bundle>mvn:ddf.lib.bundles/libs-bundles-opensaml/${project.version}</bundle>\n+        <!-- Miscellaneous -->\n+        <bundle dependency=\"true\">mvn:org.apache.shiro/shiro-core/${apache.shiro.version}</bundle>\n+        <bundle>mvn:com.sun.mail/javax.mail/${javax-mail.version}</bundle>\n+        <!--\n+            net.minidev/accessors-smart/1.2 uses asm v5.x. Need this resolved before we can upgrade:\n+            https://bitbucket.org/connect2id/nimbus-jose-jwt/issues/239/switch-to-other-json-library\n+        -->\n+        <bundle>mvn:org.ow2.asm/asm/5.2</bundle>\n+        <bundle>wrap:mvn:com.github.stephenc.jcip/jcip-annotations/1.0-1</bundle>\n+    </feature>\n \n+    <feature name=\"security-core-api\" version=\"${project.version}\"\n+             description=\"Core security APIs.\">\n+        <feature>security-core-api-dependencies</feature>\n+\n+        <!-- Core -->\n         <bundle>mvn:ddf.security.core/security-core-api/${project.version}</bundle>\n+\n+        <!-- Country Converter -->\n+        <bundle>mvn:ddf.platform.country/platform-country-converter-api/${project.version}</bundle>\n+\n+        <!-- Rest Client -->\n         <bundle>mvn:ddf.platform.security/security-rest-clientapi/${project.version}</bundle>\n-        <bundle>\n-            mvn:org.apache.servicemix.bundles/org.apache.servicemix.bundles.jaxen/${org.apache.servicemix.bundles.jaxen.version}\n-        </bundle>\n-    </feature>\n \n-    <feature name=\"security-filter-api\" version=\"${project.version}\">\n-        <bundle>mvn:javax.servlet/javax.servlet-api/${javax.servlet-api-version}</bundle>\n+        <!-- Filters -->\n         <bundle>mvn:ddf.platform/security-filter-api/${project.version}</bundle>\n-    </feature>\n \n-    <feature name=\"platform-error-page-injector\" version=\"${project.version}\"\n-             description=\"Adding a better error page to Jetty\">\n-        <feature>error-api</feature>\n-        <bundle>mvn:ddf.platform.error/platform-error-page-injector/${project.version}</bundle>\n-    </feature>\n+        <!-- Handlers -->\n+        <bundle>mvn:ddf.security.handler/security-handler-api/${project.version}</bundle>\n \n-    <feature name=\"security-encryption\" version=\"${project.version}\"\n-             description=\"Security Encryption\">\n-        <feature>wss4j</feature>\n-        <bundle>mvn:org.apache.commons/commons-lang3/${commons-lang3.version}</bundle>\n+        <!-- Policy -->\n+        <bundle>mvn:ddf.security.policy/security-policy-api/${project.version}</bundle>\n+\n+        <!-- Encryption -->\n         <bundle>mvn:ddf.security.encryption/security-encryption-api/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.encryption/security-encryption-impl/${project.version}</bundle>\n-        <bundle dependency=\"true\">mvn:ddf.platform.security/log-sanitizer/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.encryption/security-encryption-commands/${project.version}</bundle>\n-    </feature>\n \n-    <feature name=\"web-container\" version=\"${project.version}\">\n-        <feature>platform-paxweb-jettyconfig</feature>\n-        <feature>platform-error-page-injector</feature>\n-        <feature>war</feature>\n-    </feature>\n+        <!-- Expansion -->\n+        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n \n-    <feature name=\"session-invalidator\" version=\"${project.version}\"\n-             description=\"API for invalidating servlet sessions\">\n-        <bundle>mvn:ddf.platform/platform-session-invalidator/${project.version}</bundle>\n-    </feature>\n+        <!-- Token Storage -->\n+        <bundle>mvn:ddf.security.storage/token-storage-api/${project.version}</bundle>\n \n-    <feature name=\"platform-paxweb-jettyconfig\" version=\"${project.version}\"\n-      description=\"Custom Session Manager\">\n-        <config name=\"org.ops4j.pax.web\" append=\"true\">\n-#######################################\n-# Jetty Server Authenticator Settings\n-#######################################\n+        <!-- Sessions -->\n+        <bundle>mvn:ddf.platform.security/session-management-api/${project.version}</bundle>\n+        <bundle>mvn:ddf.platform/platform-session-invalidator-api/${project.version}</bundle>\n \n-# Set the authmethod/realmname so that our JettyAuthenticator is used\n-org.ops4j.pax.web.default.authmethod=DDF\n-org.ops4j.pax.web.default.realmname=DDF\n-        </config>\n-        <feature version=\"${spring.version}_1\">spring</feature>\n-        <feature>apache-commons</feature>\n-        <feature>security-core-api</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-core-services</feature>\n-        <feature>security-filter-api</feature>\n-        <feature>pax-http-jetty</feature>\n-        <bundle start-level=\"30\">mvn:org.ops4j.pax.web/pax-web-jsp/${pax.web.version}</bundle>\n-        <bundle>mvn:javax.el/javax.el-api/3.0.0</bundle>\n-        <feature>pax-jetty</feature>\n-        <feature>session-invalidator</feature>\n-        <feature prerequisite=\"true\">wrap</feature>\n-        <bundle>wrap:mvn:net.jodah/failsafe/${jodah-failsafe.version}</bundle>\n-        <feature>guava</feature>\n-        <feature>common-system</feature>\n-        <bundle>mvn:ddf.platform/platform-paxweb-jettyconfig/${project.version}</bundle>\n-    </feature>\n+        <!-- Logout -->\n+        <bundle>mvn:ddf.security.servlet/security-servlet-logout-api/${project.version}</bundle>\n \n-    <feature name=\"security-handler-api\" version=\"${project.version}\"\n-             description=\"API for authentication handlers for web applications.\">\n-        <feature>security-core-api</feature>\n-        <feature>parser-xml</feature>\n-        <feature>oidc-dependencies</feature>\n-        <bundle>mvn:org.apache.cxf/cxf-rt-rs-security-jose/${cxf.version}</bundle>\n-        <bundle>mvn:org.apache.cxf/cxf-rt-rs-security-jose-jaxrs/${cxf.version}</bundle>\n-        <bundle>mvn:ddf.security.handler/security-handler-api/${project.version}</bundle>\n-    </feature>\n+        <!-- Email -->\n+        <bundle>mvn:ddf.platform.email/platform-email-api/${project.version}</bundle>\n \n-    <feature name=\"security-handler-impl\" version=\"${project.version}\"\n-             description=\"Implementation used by all security handlers\">\n-        <feature>security-core-api</feature>\n-        <feature>security-core-impl</feature>\n-        <bundle>mvn:ddf.security.handler/security-handler-impl/${project.version}</bundle>\n+        <!-- Miscellaneous -->\n+        <bundle>mvn:ddf.security.servlet/security-servlet-web-socket-api/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.interceptor/security-interceptor-guest-wrapper/${project.version}</bundle>\n+        <bundle>mvn:ddf.platform.security/security-oidc-bundle/${project.version}</bundle>\n+        <bundle dependency=\"true\">mvn:ddf.platform.security/log-sanitizer/${project.version}</bundle>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5fe3c153d747edf954bc7be7ba8835a00d20f2da"}, "originalPosition": 185}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5NTg1MDk3OnYy", "diffSide": "RIGHT", "path": "features/security/src/main/feature/feature.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxOToyMjoyNVrOGryfjg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMVQxOToyMjoyNVrOGryfjg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODU2OTIzMA==", "bodyText": "\u270f\ufe0f I think this one belongs in impl", "url": "https://github.com/codice/ddf/pull/6155#discussion_r448569230", "createdAt": "2020-07-01T19:22:25Z", "author": {"login": "stustison"}, "path": "features/security/src/main/feature/feature.xml", "diffHunk": "@@ -21,694 +21,317 @@\n     <repository>mvn:ddf.features/kernel/${project.version}/xml/features</repository>\n     <repository>mvn:ddf.features/utilities/${project.version}/xml/features</repository>\n     <repository>mvn:ddf.features/branding/${project.version}/xml/features</repository>\n+    <repository>mvn:ddf.features/camel/${project.version}/xml/features</repository>\n \n-    <feature name=\"security-logger\" version=\"${project.version}\"\n-             description=\"Logs incoming and outgoing requests\">\n-        <feature>security-core-api</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.interceptor/security-interceptor-logger/${project.version}</bundle>\n-    </feature>\n+    <feature name=\"security-core-api-dependencies\" version=\"${project.version\"\n+             description=\"Dependencies for the core security APIs.\">\n+        <!-- Third Party Features -->\n+        <feature prerequisite=\"true\">wrap</feature>\n+        <feature>pax-http-whiteboard</feature>\n \n-    <feature name=\"security-core-api\" version=\"${project.version}\"\n-             description=\"Security Core\">\n-        <bundle start-level=\"30\">mvn:org.apache.neethi/neethi/${wss4j.neethi.version}</bundle>\n-        <feature>cxf-rt-security</feature>\n-        <feature>security-filter-api</feature>\n+        <!-- External DDF Features -->\n+        <feature>jackson</feature>\n+        <feature>wss4j</feature>\n+        <feature>cxf-ws-security</feature>\n         <feature>cxf-jaxrs</feature>\n-        <feature>platform-util</feature>\n-        <bundle dependency=\"true\">mvn:ddf.platform.security/log-sanitizer/${project.version}</bundle>\n-        <bundle dependency=\"true\">mvn:org.apache.commons/commons-configuration2/${commons-configuration2.version}</bundle>\n-        <bundle dependency=\"true\">mvn:org.apache.shiro/shiro-core/${apache.shiro.version}</bundle>\n-\n-        <feature>guava</feature>\n+        <feature>cxf-bindings-soap</feature>\n         <feature>common-system</feature>\n \n-        <bundle>mvn:joda-time/joda-time/${joda-time.version}</bundle>\n-        <bundle>mvn:org.apache.santuario/xmlsec/${xmlsec.version}</bundle>\n+        <!-- NimbusDS -->\n+        <bundle>wrap:mvn:com.nimbusds/nimbus-jose-jwt/${nimbus.version}</bundle>\n+        <bundle>wrap:mvn:com.nimbusds/oauth2-oidc-sdk/${nimbus.oidc.version}</bundle>\n+        <bundle>mvn:com.nimbusds/content-type/${nimbus.content-type.version}</bundle>\n+        <bundle>mvn:com.nimbusds/lang-tag/${nimbus.langtag.version}</bundle>\n \n-        <feature>cxf-bindings-soap</feature>\n-        <feature>cxf-ws-policy</feature>\n-        <feature>cxf-ws-security</feature>\n-        <feature>spring</feature>\n+        <!-- MiniDev -->\n+        <bundle>mvn:net.minidev/accessors-smart/1.2</bundle>\n+        <bundle>mvn:net.minidev/json-smart/2.3</bundle>\n \n-        <!--  TODO (https://github.com/codice/ddf/issues/5327)\n-                Remove wrapped OpenSAML after security refactor is complete  -->\n-        <!--  <bundle>mvn:org.apache.servicemix.bundles/org.apache.servicemix.bundles.opensaml/${opensaml.osgi.version}-->\n-        <!--  </bundle>-->\n-        <bundle>mvn:ddf.lib.bundles/libs-bundles-opensaml/${project.version}</bundle>\n+        <!-- Miscellaneous -->\n+        <bundle dependency=\"true\">mvn:org.apache.shiro/shiro-core/${apache.shiro.version}</bundle>\n+        <bundle>mvn:com.sun.mail/javax.mail/${javax-mail.version}</bundle>\n+        <!--\n+            net.minidev/accessors-smart/1.2 uses asm v5.x. Need this resolved before we can upgrade:\n+            https://bitbucket.org/connect2id/nimbus-jose-jwt/issues/239/switch-to-other-json-library\n+        -->\n+        <bundle>mvn:org.ow2.asm/asm/5.2</bundle>\n+        <bundle>wrap:mvn:com.github.stephenc.jcip/jcip-annotations/1.0-1</bundle>\n+    </feature>\n \n+    <feature name=\"security-core-api\" version=\"${project.version}\"\n+             description=\"Core security APIs.\">\n+        <feature>security-core-api-dependencies</feature>\n+\n+        <!-- Core -->\n         <bundle>mvn:ddf.security.core/security-core-api/${project.version}</bundle>\n+\n+        <!-- Country Converter -->\n+        <bundle>mvn:ddf.platform.country/platform-country-converter-api/${project.version}</bundle>\n+\n+        <!-- Rest Client -->\n         <bundle>mvn:ddf.platform.security/security-rest-clientapi/${project.version}</bundle>\n-        <bundle>\n-            mvn:org.apache.servicemix.bundles/org.apache.servicemix.bundles.jaxen/${org.apache.servicemix.bundles.jaxen.version}\n-        </bundle>\n-    </feature>\n \n-    <feature name=\"security-filter-api\" version=\"${project.version}\">\n-        <bundle>mvn:javax.servlet/javax.servlet-api/${javax.servlet-api-version}</bundle>\n+        <!-- Filters -->\n         <bundle>mvn:ddf.platform/security-filter-api/${project.version}</bundle>\n-    </feature>\n \n-    <feature name=\"platform-error-page-injector\" version=\"${project.version}\"\n-             description=\"Adding a better error page to Jetty\">\n-        <feature>error-api</feature>\n-        <bundle>mvn:ddf.platform.error/platform-error-page-injector/${project.version}</bundle>\n-    </feature>\n+        <!-- Handlers -->\n+        <bundle>mvn:ddf.security.handler/security-handler-api/${project.version}</bundle>\n \n-    <feature name=\"security-encryption\" version=\"${project.version}\"\n-             description=\"Security Encryption\">\n-        <feature>wss4j</feature>\n-        <bundle>mvn:org.apache.commons/commons-lang3/${commons-lang3.version}</bundle>\n+        <!-- Policy -->\n+        <bundle>mvn:ddf.security.policy/security-policy-api/${project.version}</bundle>\n+\n+        <!-- Encryption -->\n         <bundle>mvn:ddf.security.encryption/security-encryption-api/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.encryption/security-encryption-impl/${project.version}</bundle>\n-        <bundle dependency=\"true\">mvn:ddf.platform.security/log-sanitizer/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.encryption/security-encryption-commands/${project.version}</bundle>\n-    </feature>\n \n-    <feature name=\"web-container\" version=\"${project.version}\">\n-        <feature>platform-paxweb-jettyconfig</feature>\n-        <feature>platform-error-page-injector</feature>\n-        <feature>war</feature>\n-    </feature>\n+        <!-- Expansion -->\n+        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n \n-    <feature name=\"session-invalidator\" version=\"${project.version}\"\n-             description=\"API for invalidating servlet sessions\">\n-        <bundle>mvn:ddf.platform/platform-session-invalidator/${project.version}</bundle>\n-    </feature>\n+        <!-- Token Storage -->\n+        <bundle>mvn:ddf.security.storage/token-storage-api/${project.version}</bundle>\n \n-    <feature name=\"platform-paxweb-jettyconfig\" version=\"${project.version}\"\n-      description=\"Custom Session Manager\">\n-        <config name=\"org.ops4j.pax.web\" append=\"true\">\n-#######################################\n-# Jetty Server Authenticator Settings\n-#######################################\n+        <!-- Sessions -->\n+        <bundle>mvn:ddf.platform.security/session-management-api/${project.version}</bundle>\n+        <bundle>mvn:ddf.platform/platform-session-invalidator-api/${project.version}</bundle>\n \n-# Set the authmethod/realmname so that our JettyAuthenticator is used\n-org.ops4j.pax.web.default.authmethod=DDF\n-org.ops4j.pax.web.default.realmname=DDF\n-        </config>\n-        <feature version=\"${spring.version}_1\">spring</feature>\n-        <feature>apache-commons</feature>\n-        <feature>security-core-api</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-core-services</feature>\n-        <feature>security-filter-api</feature>\n-        <feature>pax-http-jetty</feature>\n-        <bundle start-level=\"30\">mvn:org.ops4j.pax.web/pax-web-jsp/${pax.web.version}</bundle>\n-        <bundle>mvn:javax.el/javax.el-api/3.0.0</bundle>\n-        <feature>pax-jetty</feature>\n-        <feature>session-invalidator</feature>\n-        <feature prerequisite=\"true\">wrap</feature>\n-        <bundle>wrap:mvn:net.jodah/failsafe/${jodah-failsafe.version}</bundle>\n-        <feature>guava</feature>\n-        <feature>common-system</feature>\n-        <bundle>mvn:ddf.platform/platform-paxweb-jettyconfig/${project.version}</bundle>\n-    </feature>\n+        <!-- Logout -->\n+        <bundle>mvn:ddf.security.servlet/security-servlet-logout-api/${project.version}</bundle>\n \n-    <feature name=\"security-handler-api\" version=\"${project.version}\"\n-             description=\"API for authentication handlers for web applications.\">\n-        <feature>security-core-api</feature>\n-        <feature>parser-xml</feature>\n-        <feature>oidc-dependencies</feature>\n-        <bundle>mvn:org.apache.cxf/cxf-rt-rs-security-jose/${cxf.version}</bundle>\n-        <bundle>mvn:org.apache.cxf/cxf-rt-rs-security-jose-jaxrs/${cxf.version}</bundle>\n-        <bundle>mvn:ddf.security.handler/security-handler-api/${project.version}</bundle>\n-    </feature>\n+        <!-- Email -->\n+        <bundle>mvn:ddf.platform.email/platform-email-api/${project.version}</bundle>\n \n-    <feature name=\"security-handler-impl\" version=\"${project.version}\"\n-             description=\"Implementation used by all security handlers\">\n-        <feature>security-core-api</feature>\n-        <feature>security-core-impl</feature>\n-        <bundle>mvn:ddf.security.handler/security-handler-impl/${project.version}</bundle>\n+        <!-- Miscellaneous -->\n+        <bundle>mvn:ddf.security.servlet/security-servlet-web-socket-api/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.interceptor/security-interceptor-guest-wrapper/${project.version}</bundle>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5fe3c153d747edf954bc7be7ba8835a00d20f2da"}, "originalPosition": 183}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5OTkzNzU2OnYy", "diffSide": "RIGHT", "path": "features/security/src/main/feature/feature.xml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQxOTowNzoxOVrOGsZ9pw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQyMToyMTowNVrOGsdWOw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTIxNTkxMQ==", "bodyText": "Looks like this only installs the config, not the embedded ldap. Was that the intent?", "url": "https://github.com/codice/ddf/pull/6155#discussion_r449215911", "createdAt": "2020-07-02T19:07:19Z", "author": {"login": "SmithJosh"}, "path": "features/security/src/main/feature/feature.xml", "diffHunk": "@@ -21,694 +21,317 @@\n     <repository>mvn:ddf.features/kernel/${project.version}/xml/features</repository>\n     <repository>mvn:ddf.features/utilities/${project.version}/xml/features</repository>\n     <repository>mvn:ddf.features/branding/${project.version}/xml/features</repository>\n+    <repository>mvn:ddf.features/camel/${project.version}/xml/features</repository>\n \n-    <feature name=\"security-logger\" version=\"${project.version}\"\n-             description=\"Logs incoming and outgoing requests\">\n-        <feature>security-core-api</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.interceptor/security-interceptor-logger/${project.version}</bundle>\n-    </feature>\n+    <feature name=\"security-core-api-dependencies\" version=\"${project.version\"\n+             description=\"Dependencies for the core security APIs.\">\n+        <!-- Third Party Features -->\n+        <feature prerequisite=\"true\">wrap</feature>\n+        <feature>pax-http-whiteboard</feature>\n \n-    <feature name=\"security-core-api\" version=\"${project.version}\"\n-             description=\"Security Core\">\n-        <bundle start-level=\"30\">mvn:org.apache.neethi/neethi/${wss4j.neethi.version}</bundle>\n-        <feature>cxf-rt-security</feature>\n-        <feature>security-filter-api</feature>\n+        <!-- External DDF Features -->\n+        <feature>jackson</feature>\n+        <feature>wss4j</feature>\n+        <feature>cxf-ws-security</feature>\n         <feature>cxf-jaxrs</feature>\n-        <feature>platform-util</feature>\n-        <bundle dependency=\"true\">mvn:ddf.platform.security/log-sanitizer/${project.version}</bundle>\n-        <bundle dependency=\"true\">mvn:org.apache.commons/commons-configuration2/${commons-configuration2.version}</bundle>\n-        <bundle dependency=\"true\">mvn:org.apache.shiro/shiro-core/${apache.shiro.version}</bundle>\n-\n-        <feature>guava</feature>\n+        <feature>cxf-bindings-soap</feature>\n         <feature>common-system</feature>\n \n-        <bundle>mvn:joda-time/joda-time/${joda-time.version}</bundle>\n-        <bundle>mvn:org.apache.santuario/xmlsec/${xmlsec.version}</bundle>\n+        <!-- NimbusDS -->\n+        <bundle>wrap:mvn:com.nimbusds/nimbus-jose-jwt/${nimbus.version}</bundle>\n+        <bundle>wrap:mvn:com.nimbusds/oauth2-oidc-sdk/${nimbus.oidc.version}</bundle>\n+        <bundle>mvn:com.nimbusds/content-type/${nimbus.content-type.version}</bundle>\n+        <bundle>mvn:com.nimbusds/lang-tag/${nimbus.langtag.version}</bundle>\n \n-        <feature>cxf-bindings-soap</feature>\n-        <feature>cxf-ws-policy</feature>\n-        <feature>cxf-ws-security</feature>\n-        <feature>spring</feature>\n+        <!-- MiniDev -->\n+        <bundle>mvn:net.minidev/accessors-smart/1.2</bundle>\n+        <bundle>mvn:net.minidev/json-smart/2.3</bundle>\n \n-        <!--  TODO (https://github.com/codice/ddf/issues/5327)\n-                Remove wrapped OpenSAML after security refactor is complete  -->\n-        <!--  <bundle>mvn:org.apache.servicemix.bundles/org.apache.servicemix.bundles.opensaml/${opensaml.osgi.version}-->\n-        <!--  </bundle>-->\n-        <bundle>mvn:ddf.lib.bundles/libs-bundles-opensaml/${project.version}</bundle>\n+        <!-- Miscellaneous -->\n+        <bundle dependency=\"true\">mvn:org.apache.shiro/shiro-core/${apache.shiro.version}</bundle>\n+        <bundle>mvn:com.sun.mail/javax.mail/${javax-mail.version}</bundle>\n+        <!--\n+            net.minidev/accessors-smart/1.2 uses asm v5.x. Need this resolved before we can upgrade:\n+            https://bitbucket.org/connect2id/nimbus-jose-jwt/issues/239/switch-to-other-json-library\n+        -->\n+        <bundle>mvn:org.ow2.asm/asm/5.2</bundle>\n+        <bundle>wrap:mvn:com.github.stephenc.jcip/jcip-annotations/1.0-1</bundle>\n+    </feature>\n \n+    <feature name=\"security-core-api\" version=\"${project.version}\"\n+             description=\"Core security APIs.\">\n+        <feature>security-core-api-dependencies</feature>\n+\n+        <!-- Core -->\n         <bundle>mvn:ddf.security.core/security-core-api/${project.version}</bundle>\n+\n+        <!-- Country Converter -->\n+        <bundle>mvn:ddf.platform.country/platform-country-converter-api/${project.version}</bundle>\n+\n+        <!-- Rest Client -->\n         <bundle>mvn:ddf.platform.security/security-rest-clientapi/${project.version}</bundle>\n-        <bundle>\n-            mvn:org.apache.servicemix.bundles/org.apache.servicemix.bundles.jaxen/${org.apache.servicemix.bundles.jaxen.version}\n-        </bundle>\n-    </feature>\n \n-    <feature name=\"security-filter-api\" version=\"${project.version}\">\n-        <bundle>mvn:javax.servlet/javax.servlet-api/${javax.servlet-api-version}</bundle>\n+        <!-- Filters -->\n         <bundle>mvn:ddf.platform/security-filter-api/${project.version}</bundle>\n-    </feature>\n \n-    <feature name=\"platform-error-page-injector\" version=\"${project.version}\"\n-             description=\"Adding a better error page to Jetty\">\n-        <feature>error-api</feature>\n-        <bundle>mvn:ddf.platform.error/platform-error-page-injector/${project.version}</bundle>\n-    </feature>\n+        <!-- Handlers -->\n+        <bundle>mvn:ddf.security.handler/security-handler-api/${project.version}</bundle>\n \n-    <feature name=\"security-encryption\" version=\"${project.version}\"\n-             description=\"Security Encryption\">\n-        <feature>wss4j</feature>\n-        <bundle>mvn:org.apache.commons/commons-lang3/${commons-lang3.version}</bundle>\n+        <!-- Policy -->\n+        <bundle>mvn:ddf.security.policy/security-policy-api/${project.version}</bundle>\n+\n+        <!-- Encryption -->\n         <bundle>mvn:ddf.security.encryption/security-encryption-api/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.encryption/security-encryption-impl/${project.version}</bundle>\n-        <bundle dependency=\"true\">mvn:ddf.platform.security/log-sanitizer/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.encryption/security-encryption-commands/${project.version}</bundle>\n-    </feature>\n \n-    <feature name=\"web-container\" version=\"${project.version}\">\n-        <feature>platform-paxweb-jettyconfig</feature>\n-        <feature>platform-error-page-injector</feature>\n-        <feature>war</feature>\n-    </feature>\n+        <!-- Expansion -->\n+        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n \n-    <feature name=\"session-invalidator\" version=\"${project.version}\"\n-             description=\"API for invalidating servlet sessions\">\n-        <bundle>mvn:ddf.platform/platform-session-invalidator/${project.version}</bundle>\n-    </feature>\n+        <!-- Token Storage -->\n+        <bundle>mvn:ddf.security.storage/token-storage-api/${project.version}</bundle>\n \n-    <feature name=\"platform-paxweb-jettyconfig\" version=\"${project.version}\"\n-      description=\"Custom Session Manager\">\n-        <config name=\"org.ops4j.pax.web\" append=\"true\">\n-#######################################\n-# Jetty Server Authenticator Settings\n-#######################################\n+        <!-- Sessions -->\n+        <bundle>mvn:ddf.platform.security/session-management-api/${project.version}</bundle>\n+        <bundle>mvn:ddf.platform/platform-session-invalidator-api/${project.version}</bundle>\n \n-# Set the authmethod/realmname so that our JettyAuthenticator is used\n-org.ops4j.pax.web.default.authmethod=DDF\n-org.ops4j.pax.web.default.realmname=DDF\n-        </config>\n-        <feature version=\"${spring.version}_1\">spring</feature>\n-        <feature>apache-commons</feature>\n-        <feature>security-core-api</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-core-services</feature>\n-        <feature>security-filter-api</feature>\n-        <feature>pax-http-jetty</feature>\n-        <bundle start-level=\"30\">mvn:org.ops4j.pax.web/pax-web-jsp/${pax.web.version}</bundle>\n-        <bundle>mvn:javax.el/javax.el-api/3.0.0</bundle>\n-        <feature>pax-jetty</feature>\n-        <feature>session-invalidator</feature>\n-        <feature prerequisite=\"true\">wrap</feature>\n-        <bundle>wrap:mvn:net.jodah/failsafe/${jodah-failsafe.version}</bundle>\n-        <feature>guava</feature>\n-        <feature>common-system</feature>\n-        <bundle>mvn:ddf.platform/platform-paxweb-jettyconfig/${project.version}</bundle>\n-    </feature>\n+        <!-- Logout -->\n+        <bundle>mvn:ddf.security.servlet/security-servlet-logout-api/${project.version}</bundle>\n \n-    <feature name=\"security-handler-api\" version=\"${project.version}\"\n-             description=\"API for authentication handlers for web applications.\">\n-        <feature>security-core-api</feature>\n-        <feature>parser-xml</feature>\n-        <feature>oidc-dependencies</feature>\n-        <bundle>mvn:org.apache.cxf/cxf-rt-rs-security-jose/${cxf.version}</bundle>\n-        <bundle>mvn:org.apache.cxf/cxf-rt-rs-security-jose-jaxrs/${cxf.version}</bundle>\n-        <bundle>mvn:ddf.security.handler/security-handler-api/${project.version}</bundle>\n-    </feature>\n+        <!-- Email -->\n+        <bundle>mvn:ddf.platform.email/platform-email-api/${project.version}</bundle>\n \n-    <feature name=\"security-handler-impl\" version=\"${project.version}\"\n-             description=\"Implementation used by all security handlers\">\n-        <feature>security-core-api</feature>\n-        <feature>security-core-impl</feature>\n-        <bundle>mvn:ddf.security.handler/security-handler-impl/${project.version}</bundle>\n+        <!-- Miscellaneous -->\n+        <bundle>mvn:ddf.security.servlet/security-servlet-web-socket-api/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.interceptor/security-interceptor-guest-wrapper/${project.version}</bundle>\n+        <bundle>mvn:ddf.platform.security/security-oidc-bundle/${project.version}</bundle>\n+        <bundle dependency=\"true\">mvn:ddf.platform.security/log-sanitizer/${project.version}</bundle>\n     </feature>\n \n-    <feature name=\"security-token-storage\" version=\"${project.version}\"\n-             description=\"OAuth token storage api and file storage implementation.\">\n-        <feature>apache-commons</feature>\n-        <bundle>mvn:com.google.code.gson/gson/${gson.version}</bundle>\n-        <bundle>mvn:ddf.security.storage/token-storage-api/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.storage/token-storage-impl/${project.version}</bundle>\n+    <feature name=\"security-core-impl-dependencies\" version=\"${project.version}\"\n+             description=\"Dependencies for core security implementations.\">\n+        <!-- External DDF Features -->\n+        <feature>javax-validation</feature>\n+        <feature>parser-xml</feature>\n+        <feature>platform-util</feature>\n     </feature>\n \n     <feature name=\"security-core-impl\" version=\"${project.version}\"\n-             description=\"Security Core\">\n+             description=\"Core security implementations.\">\n         <feature>security-core-api</feature>\n-        <feature>security-handler-api</feature>\n-        <feature>security-encryption</feature>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <bundle>mvn:ddf.platform.util/util-uuidgenerator-api/${project.version}</bundle>\n-        <feature>javax-validation</feature>\n-        <feature>cxf-frontend-javascript</feature>\n-        <bundle>mvn:javax.servlet/javax.servlet-api/${javax.servlet-api.version}</bundle>\n-        <feature>cxf-jaxrs</feature>\n-        <feature>util-uuidgenerator</feature>\n-        <feature dependency=\"true\">oidc-dependencies</feature>\n-        <feature>security-token-storage</feature>\n-        <feature>cxf-rs-security-oauth2</feature>\n-        <feature>platform-util</feature>\n+        <feature>security-core-impl-dependencies</feature>\n+\n+        <!-- Core -->\n         <bundle>mvn:ddf.security.core/security-core-impl/${project.version}</bundle>\n-    </feature>\n \n-    <feature name=\"security-core-services\" version=\"${project.version}\"\n-             description=\"Main security services\">\n-        <feature>security-core-impl</feature>\n-        <feature>security-handler-impl</feature>\n-        <bundle>mvn:ddf.security.core/security-core-services/${project.version}</bundle>\n-        <bundle>mvn:ddf.platform.security/security-rest-cxfwrapper/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.realm/security-realm-pki/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.realm/security-realm-userpass/${project.version}</bundle>\n-    </feature>\n+        <!-- Handlers -->\n+        <bundle>mvn:ddf.security.handler/security-handler-impl/${project.version}</bundle>\n \n-    <feature name=\"security-expansion\" version=\"${project.version}\"\n-             description=\"Security Expansion\">\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n+        <!-- Expansion -->\n         <bundle>mvn:ddf.security.expansion/security-expansion-impl/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-commands/${project.version}</bundle>\n-    </feature>\n-\n-    <feature name=\"security-pdp-authz\" version=\"${project.version}\"\n-             description=\"Security PDP.\">\n-        <configfile finalname=\"${ddf.etc}/ddf.security.pdp.realm.AuthzRealm.config\">\n-            mvn:ddf.security.pdp/security-pdp-authzrealm/${project.version}/config/default-authzrealm\n-        </configfile>\n-        <feature>security-core-impl</feature>\n-        <feature dependency=\"true\">oidc-dependencies</feature>\n-        <feature>security-expansion</feature>\n-        <feature>security-expansion-user-attributes</feature>\n-        <feature>security-expansion-metacard-attributes</feature>\n-        <feature>javax-validation</feature>\n \n-        <feature>cxf-frontend-javascript</feature>\n-        <feature>cxf-jaxrs</feature>\n-        <feature>parser-xml</feature>\n-        <feature>security-handler-api</feature>\n-        <feature>platform-util</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.pdp/security-pdp-authzrealm/${project.version}</bundle>\n-    </feature>\n-\n-    <feature name=\"security-pep-serviceauthz\" version=\"${project.version}\"\n-             description=\"Security PEP Service AuthZ\">\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <feature>javax-validation</feature>\n-        <feature>cxf-frontend-javascript</feature>\n-        <feature>cxf-jaxrs</feature>\n-        <bundle>mvn:ddf.security.encryption/security-encryption-api/${project.version}</bundle>\n-        <feature>security-handler-api</feature>\n-        <feature dependency=\"true\">oidc-dependencies</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-core-services</feature>\n+        <!-- Policy Extension Point -->\n         <bundle>mvn:ddf.security.pep/security-pep-interceptor/${project.version}</bundle>\n     </feature>\n \n-    <feature name=\"security-expansion-user-attributes\" version=\"${project.version}\"\n-             description=\"Security Expansion User Attributes Expansion\">\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-impl/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-userattr-map/${project.version}\n-        </bundle>\n-    </feature>\n-\n-    <feature name=\"security-expansion-metacard-attributes\" version=\"${project.version}\"\n-             description=\"Security Expansion Metacard Attributes Expansion\">\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-impl/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-metacardattr-map/${project.version}\n-        </bundle>\n-    </feature>\n+    <feature name=\"security-core-services-dependencies\" version=\"${project.version}\"\n+             description=\"Dependencies for core security services.\">\n+        <!-- Third Party Features -->\n+        <feature>spring</feature>\n+        <feature>war</feature>\n+        <feature>pax-jetty</feature>\n+        <feature>pax-http-jetty</feature>\n \n-    <feature name=\"security-core-misc\" version=\"${project.version}\">\n+        <!-- External DDF Features -->\n+        <feature>apache-commons</feature>\n+        <feature>guava</feature>\n         <feature>cxf-core</feature>\n-        <feature>cxf-ws-security</feature>\n-        <bundle start-level=\"40\">mvn:org.apache.cxf/cxf-rt-rs-json-basic/${cxf.version}</bundle>\n-        <bundle start-level=\"40\">mvn:org.apache.cxf/cxf-rt-rs-security-jose/${cxf.version}</bundle>\n-        <bundle>mvn:org.apache.commons/commons-jexl/2.1.1</bundle>\n-        <feature>security-core-api</feature>\n-        <feature>security-handler-api</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-handler-impl</feature>\n-        <feature>platform-util</feature>\n-        <feature prerequisite=\"true\">wrap</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.platform.security/security-rest-cxfwrapper/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.certificate/security-ocsp-checker/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.handler/security-handler-pki/${project.version}</bundle>\n-        <bundle>wrap:mvn:org.springframework.ldap/spring-ldap-core/2.3.2.RELEASE</bundle>\n-        <configfile finalname=\"${ddf.etc}/ws-security/attributeMap.properties\">\n-            mvn:ddf.security.claims/security-claims-ldap/${project.version}/properties/attributeMap\n-        </configfile>\n-    </feature>\n-\n-    <feature name=\"security-realm-saml\" version=\"${project.version}\"\n-             description=\"Security realm for SAML.\">\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <feature>security-core-impl</feature>\n-        <feature>javax-validation</feature>\n-        <feature>cxf-frontend-javascript</feature>\n-        <feature>cxf-jaxrs</feature>\n-        <feature>security-handler-api</feature>\n-        <feature>security-handler-impl</feature>\n-        <feature>security-policy-context</feature>\n-        <feature dependency=\"true\">saml-validator</feature>\n-        <feature dependency=\"true\">oidc-dependencies</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.realm/security-realm-saml/${project.version}</bundle>\n-    </feature>\n-\n-    <feature name=\"security-guest-realm\" version=\"${project.version}\"\n-             description=\"Security Guest Realm.\">\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <feature>security-core-impl</feature>\n-        <feature>javax-validation</feature>\n-        <feature>security-handler-api</feature>\n-        <feature>security-handler-impl</feature>\n-        <feature>security-policy-context</feature>\n+        <feature>cxf-rt-security</feature>\n+        <feature>cxf-ws-policy</feature>\n         <feature>cxf-frontend-javascript</feature>\n-        <feature>cxf-jaxrs</feature>\n-        <feature dependency=\"true\">oidc-dependencies</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.realm/security-realm-guest/${project.version}</bundle>\n-    </feature>\n-\n-    <feature name=\"security-jaas-ldap\" version=\"${project.version}\"\n-             description=\"Security JAAS LDAP Login.\">\n-        <feature>security-core-misc</feature>\n-        <feature>javax-validation</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:org.apache.commons/commons-pool2/2.5.0</bundle>\n-        <bundle>mvn:ddf.security.encryption/security-encryption-api/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.jaas/security-jaas-ldap/${project.version}</bundle>\n-    </feature>\n-\n-    <feature name=\"security-claims-ldap\" version=\"${project.version}\"\n-             description=\"Retrieves claims attributes from an LDAP store.\">\n-        <bundle>mvn:ddf.security.encryption/security-encryption-api/${project.version}</bundle>\n-        <feature>security-core-misc</feature>\n-        <feature>security-encryption</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.claims/security-claims-ldap/${project.version}</bundle>\n-    </feature>\n+        <feature>cxf-rs-security-oauth2</feature>\n+        <feature>cxf-rs-security-sso-saml</feature>\n+        <feature>action-core-impl</feature>\n+        <feature>error-api</feature>\n+        <feature>util-uuidgenerator</feature>\n+        <feature>camel-jetty9</feature>\n+        <feature>camel-blueprint</feature>\n+        <feature>camel-http</feature>\n \n-    <feature name=\"ldap-embedded-default-configs\" version=\"${project.version}\"\n-             description=\"Installs default embedded ldap claims handler and login configs\">\n-        <feature>ldap-embedded-default-claimshandler-config</feature>\n-        <feature>ldap-embedded-default-stslogin-config</feature>\n-    </feature>\n+        <!-- JavaX -->\n+        <bundle>mvn:javax.el/javax.el-api/3.0.0</bundle>\n+        <bundle>mvn:javax.servlet/javax.servlet-api/${javax.servlet-api-version}</bundle>\n \n-    <feature name=\"ldap-embedded-default-claimshandler-config\" version=\"${project.version}\"\n-             description=\"Installs a default embedded ldap login config\">\n-        <configfile\n-                finalname=\"${ddf.etc}/Claims_Handler_Manager-ddf.security.sts.claimsHandler.ClaimsHandlerManager.config\"\n-                override=\"false\">\n-            mvn:ddf.security.claims/security-claims-ldap/${project.version}/config/default-ldap-claimshandler\n-        </configfile>\n-    </feature>\n+        <!-- Apache -->\n+        <bundle>mvn:org.apache.commons/commons-lang3/${commons-lang3.version}</bundle>\n+        <bundle dependency=\"true\">mvn:org.apache.commons/commons-configuration2/${commons-configuration2.version}</bundle>\n+        <bundle>mvn:org.apache.commons/commons-jexl/2.1.1</bundle>\n+        <bundle>\n+            mvn:org.apache.servicemix.bundles/org.apache.servicemix.bundles.jaxen/${org.apache.servicemix.bundles.jaxen.version}\n+        </bundle>\n+        <bundle>mvn:org.apache.santuario/xmlsec/${xmlsec.version}</bundle>\n+        <bundle start-level=\"30\">mvn:org.apache.neethi/neethi/${wss4j.neethi.version}</bundle>\n+        <bundle start-level=\"40\">mvn:org.apache.cxf/cxf-rt-rs-json-basic/${cxf.version}</bundle>\n+        <bundle start-level=\"40\">mvn:org.apache.cxf/cxf-rt-rs-security-jose/${cxf.version}</bundle>\n \n-    <feature name=\"ldap-embedded-default-stslogin-config\" version=\"${project.version}\"\n-             description=\"Installs a default embedded ldap claims handler config\">\n-        <configfile\n-                finalname=\"${ddf.etc}/Ldap_Login_Config-ddf.ldap.ldaplogin.LdapLoginConfig.config\"\n-                override=\"false\">\n-            mvn:ddf.security.jaas/security-jaas-ldap/${project.version}/config/default-ldaplogin\n-        </configfile>\n-    </feature>\n+        <!-- Pax -->\n+        <config name=\"org.ops4j.pax.web\" append=\"true\">\n+            #######################################\n+            # Jetty Server Authenticator Settings\n+            #######################################\n \n-    <feature name=\"security-handler-basic\" version=\"${project.version}\"\n-             description=\"Basic Authentication Handler for web applications.\">\n-        <feature>security-core-misc</feature>\n-        <feature>parser-xml</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.handler/security-handler-basic/${project.version}</bundle>\n-    </feature>\n+            # Set the authmethod/realmname so that our JettyAuthenticator is used\n+            org.ops4j.pax.web.default.authmethod=DDF\n+            org.ops4j.pax.web.default.realmname=DDF\n+        </config>\n+        <bundle start-level=\"30\">mvn:org.ops4j.pax.web/pax-web-jsp/${pax.web.version}</bundle>\n \n-    <feature name=\"oidc-dependencies\" version=\"${project.version}\"\n-      description=\"All OIDC third party dependencies\">\n-        <feature prerequisite=\"true\">wrap</feature>\n-        <feature>jackson</feature>\n-        <bundle>mvn:com.sun.mail/javax.mail/${javax-mail.version}</bundle>\n-        <!--\n-            net.minidev/accessors-smart/1.2 uses asm v5.x. Need this resolved before we can upgrade:\n-            https://bitbucket.org/connect2id/nimbus-jose-jwt/issues/239/switch-to-other-json-library\n-        -->\n-        <bundle>mvn:org.ow2.asm/asm/5.2</bundle>\n-        <bundle>mvn:net.minidev/accessors-smart/1.2</bundle>\n-        <bundle>mvn:net.minidev/json-smart/2.3</bundle>\n-        <bundle>wrap:mvn:com.nimbusds/nimbus-jose-jwt/${nimbus.version}</bundle>\n-        <bundle>wrap:mvn:com.nimbusds/oauth2-oidc-sdk/${nimbus.oidc.version}</bundle>\n-        <bundle>mvn:com.nimbusds/content-type/${nimbus.content-type.version}</bundle>\n-        <bundle>mvn:com.nimbusds/lang-tag/${nimbus.langtag.version}</bundle>\n-        <bundle>wrap:mvn:com.github.stephenc.jcip/jcip-annotations/1.0-1</bundle>\n-        <bundle>mvn:commons-codec/commons-codec/${commons-codec.version}</bundle>\n-        <bundle>mvn:ddf.platform.security/security-oidc-bundle/${project.version}</bundle>\n+        <!-- Miscellaneous -->\n+        <bundle>mvn:com.google.code.gson/gson/${gson.version}</bundle>\n+        <bundle>wrap:mvn:org.springframework.ldap/spring-ldap-core/2.3.2.RELEASE</bundle>\n+        <bundle>wrap:mvn:net.jodah/failsafe/${jodah-failsafe.version}</bundle>\n+        <bundle>mvn:joda-time/joda-time/${joda-time.version}</bundle>\n+        <bundle>mvn:org.codice.thirdparty/commons-httpclient/3.1.0_1</bundle>\n     </feature>\n \n-    <feature name=\"security-handler-oidc\" version=\"${project.version}\"\n-             description=\"OIDC Authentication Handler for web applications.\">\n-        <feature>oidc-dependencies</feature>\n-        <feature>action-core-impl</feature>\n+    <feature name=\"security-core-services\" version=\"${project.version}\"\n+             description=\"Core security services.\">\n         <feature>security-core-impl</feature>\n-        <feature>security-handler-impl</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.handler/security-handler-oidc/${project.version}</bundle>\n-    </feature>\n+        <feature>security-core-services-dependencies</feature>\n \n-    <feature name=\"security-handler-oauth\" version=\"${project.version}\"\n-      description=\"OIDC Authentication Handler for web applications.\">\n-        <feature>oidc-dependencies</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-handler-impl</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.handler/security-handler-oauth/${project.version}</bundle>\n-    </feature>\n+        <!-- Core -->\n+        <bundle>mvn:ddf.security.core/security-core-services/${project.version}</bundle>\n \n-    <feature name=\"security-oidc-realm\" version=\"${project.version}\"\n-             description=\"OIDC Authentication Handler for web applications.\">\n-        <feature>jackson</feature>\n-        <feature dependency=\"true\">oidc-dependencies</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-handler-api</feature>\n-        <feature>security-handler-oidc</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.realm/security-realm-oidc/${project.version}</bundle>\n-    </feature>\n+        <!-- Rest Client -->\n+        <bundle>mvn:ddf.platform.security/security-rest-cxfwrapper/${project.version}</bundle>\n \n-    <feature name=\"security-filter-login\" version=\"${project.version}\"\n-             description=\"Login Filter for web applications.\">\n-        <feature>security-core-impl</feature>\n-        <feature>security-policy-context</feature>\n-        <feature>cxf-rs-security-sso-saml</feature>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <feature>javax-validation</feature>\n-        <feature>cxf-frontend-javascript</feature>\n-        <feature>security-filter-api</feature>\n-        <feature>security-handler-api</feature>\n-        <feature>security-handler-impl</feature>\n-        <feature dependency=\"true\">oidc-dependencies</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.filter/security-filter-login/${project.version}</bundle>\n-    </feature>\n+        <!-- Country Converter -->\n+        <bundle>mvn:ddf.platform.country/platform-country-converter-local/${project.version}</bundle>\n \n-    <feature name=\"security-filter-csrf\" version=\"${project.version}\"\n-             description=\"CSRF Filter for web applications.\">\n-        <feature>security-core-api</feature>\n+        <!-- Filters -->\n         <bundle>mvn:ddf.security.filter/security-filter-csrf/${project.version}</bundle>\n-    </feature>\n-\n-    <feature name=\"security-filter-authz\" version=\"${project.version}\"\n-             description=\"Authz Filter for web applications.\">\n-        <feature>security-policy-context</feature>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <feature>security-filter-api</feature>\n-        <feature>javax-validation</feature>\n-        <feature>cxf-frontend-javascript</feature>\n-        <feature>cxf-jaxrs</feature>\n-        <feature>security-handler-api</feature>\n-        <feature dependency=\"true\">oidc-dependencies</feature>\n-        <feature>security-core-services</feature>\n+        <bundle>mvn:ddf.security.filter/security-filter-web-sso/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.filter/security-filter-login/${project.version}</bundle>\n         <bundle>mvn:ddf.security.filter/security-filter-authorization/${project.version}</bundle>\n-    </feature>\n \n+        <!-- Claims -->\n+        <bundle>mvn:ddf.security.claims/security-claims-property/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.claims/security-claims-attributequery/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.claims/security-claims-certificate/${project.version}</bundle>\n \n-    <feature name=\"security-filter-web-sso\" version=\"${project.version}\"\n-             description=\"Web SSO Filter for web applications.\">\n-        <feature>security-core-impl</feature>\n-        <feature>security-filter-api</feature>\n-        <feature>security-handler-api</feature>\n-        <feature>security-policy-context</feature>\n-        <feature>security-handler-impl</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.filter/security-filter-web-sso/${project.version}</bundle>\n-    </feature>\n+        <!-- Keys and Certificates -->\n+        <bundle>mvn:ddf.security.certificate/security-certificate-keystoreeditor/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.certificate/security-certificate-generator/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.certificate/security-crl-generator/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.certificate/security-ocsp-checker/${project.version}</bundle>\n \n-    <feature name=\"security-policy-context\" version=\"${project.version}\"\n-             description=\"Web Context policy manager\">\n-        <feature>security-core-api</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.policy/security-policy-api/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.policy/security-policy-context/${project.version}</bundle>\n-    </feature>\n+        <!-- Encryption -->\n+        <bundle>mvn:ddf.security.encryption/security-encryption-impl/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.encryption/security-encryption-commands/${project.version}</bundle>\n \n-    <feature name=\"security-claims-certificate\"\n-             version=\"${project.version}\"\n-             description=\"Retrieves claims from a user's certificate.\">\n-        <feature>security-core-misc</feature>\n-        <bundle>mvn:ddf.security.claims/security-claims-certificate/${project.version}\n-        </bundle>\n-    </feature>\n+        <!-- Token Storage -->\n+        <bundle>mvn:ddf.security.storage/token-storage-impl/${project.version}</bundle>\n \n-    <feature name=\"security-claims-property\" version=\"${project.version}\"\n-             description=\"Looks up user properties via a properties file.\">\n-        <feature>security-core-misc</feature>\n-        <feature>javax-validation</feature>\n-        <bundle>mvn:ddf.security.claims/security-claims-property/${project.version}</bundle>\n-    </feature>\n+        <!-- Sessions -->\n+        <bundle>mvn:ddf.platform.security/session-management-impl/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.servlet/security-servlet-session-expiry/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.command/security-command-sessionmanager/${project.version}</bundle>\n \n-    <feature name=\"security-interceptor-guest\" version=\"${project.version}\"\n-             description=\"Injects guest user information into incoming SOAP messages.\">\n-        <feature>guava</feature>\n-        <bundle>mvn:ddf.security.encryption/security-encryption-api/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <feature>javax-validation</feature>\n-        <feature>cxf-frontend-javascript</feature>\n-        <feature>cxf-jaxrs</feature>\n-        <feature>security-handler-api</feature>\n-        <feature>security-handler-impl</feature>\n-        <feature>security-policy-context</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-encryption</feature>\n-        <feature dependency=\"true\">oidc-dependencies</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.interceptor/security-interceptor-guest/${project.version}</bundle>\n-    </feature>\n+        <!-- Expansion -->\n+        <bundle>mvn:ddf.security.expansion/security-expansion-userattr-map/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.expansion/security-expansion-metacardattr-map/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.expansion/security-expansion-commands/${project.version}</bundle>\n \n-    <feature name=\"security-claims-attributequery\"\n-             version=\"${project.version}\"\n-             description=\"Retrieves claims from external attribute store using an AttributeQuery request.\">\n-        <feature>guava</feature>\n-        <bundle>mvn:ddf.security.encryption/security-encryption-api/${project.version}</bundle>\n-        <feature>security-core-misc</feature>\n-        <feature>security-encryption</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.claims/security-claims-attributequery/${project.version}\n-        </bundle>\n-    </feature>\n+        <!-- Logout -->\n+        <bundle>mvn:ddf.security.servlet/security-servlet-logout/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.servlet/security-servlet-default-logout/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.servlet/security-servlet-logout-endpoint/${project.version}</bundle>\n \n-    <feature name=\"security-interceptor-guest-wrapper\"\n-             version=\"${project.version}\"\n-             description=\"Wrapper for Security Interceptor Guest that injects guest user information into incoming SOAP messages.\">\n-        <feature>cxf-bindings-soap</feature>\n-        <feature>cxf-ws-security</feature>\n-        <bundle>mvn:ddf.security.interceptor/security-interceptor-guest-wrapper/${project.version}\n-        </bundle>\n-    </feature>\n+        <!-- Policy Decision Point -->\n+        <configfile finalname=\"${ddf.etc}/ddf.security.pdp.realm.AuthzRealm.config\">\n+            mvn:ddf.security.pdp/security-pdp-authzrealm/${project.version}/config/default-authzrealm\n+        </configfile>\n+        <bundle>mvn:ddf.security.pdp/security-pdp-authzrealm/${project.version}</bundle>\n \n-    <feature name=\"security-guest\" version=\"${project.version}\"\n-             description=\"Contains all of the guest security features.\">\n-        <feature>security-interceptor-guest-wrapper</feature>\n-        <feature>security-interceptor-guest</feature>\n-    </feature>\n+        <!-- Context Policy -->\n+        <bundle>mvn:ddf.security.policy/security-policy-context/${project.version}</bundle>\n \n-    <feature name=\"security-servlet-session-expiry\" version=\"${project.version}\"\n-             description=\"Session expiry servlet.\">\n-        <feature>guava</feature>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <feature>javax-validation</feature>\n-        <feature>cxf-frontend-javascript</feature>\n-        <feature>cxf-jaxrs</feature>\n-        <feature>security-handler-api</feature>\n-        <feature>security-core-impl</feature>\n-        <feature dependency=\"true\">oidc-dependencies</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.platform.security/session-management-service/${project.version}</bundle>\n-        <bundle>mvn:ddf.platform.security/session-management-impl/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.servlet/security-servlet-session-expiry/${project.version}</bundle>\n-    </feature>\n+        <!-- Logging -->\n+        <bundle>mvn:ddf.security.interceptor/security-interceptor-logger/${project.version}</bundle>\n \n-    <feature name=\"security-servlet-whoami\" version=\"${project.version}\"\n-             description=\"Who Am I servlet.\">\n-        <feature>security-core-impl</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.servlet/security-servlet-whoami/${project.version}</bundle>\n-    </feature>\n+        <!-- Guest Authentication -->\n+        <bundle>mvn:ddf.security.realm/security-realm-guest/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.interceptor/security-interceptor-guest/${project.version}</bundle>\n \n-    <feature name=\"security-servlet-web-socket\" version=\"${project.version}\"\n-             description=\"Defines a secure web socket servlet type.\">\n-        <feature>security-core-api</feature>\n-        <feature>pax-http-whiteboard</feature>\n-        <bundle>mvn:ddf.security.servlet/security-servlet-web-socket/${project.version}</bundle>\n-    </feature>\n+        <!-- Basic Auth -->\n+        <bundle>mvn:ddf.security.realm/security-realm-userpass/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.handler/security-handler-basic/${project.version}</bundle>\n \n-    <feature name=\"security-handler-saml\" version=\"${project.version}\"\n-             description=\"SAML Web SSO client\">\n-        <feature>security-core-api</feature>\n-        <feature>security-handler-api</feature>\n-        <feature>javax-validation</feature>\n-        <feature>action-core-impl</feature>\n-        <feature>cxf-rs-security-sso-saml</feature>\n-        <feature>security-filter-api</feature>\n-        <feature>session-invalidator</feature>\n-        <feature>platform-paxweb-jettyconfig</feature>\n-        <feature>security-filter-login</feature>\n-        <feature>guava</feature>\n-        <feature>cxf-frontend-javascript</feature>\n-        <feature>cxf-jaxrs</feature>\n-        <feature>util-uuidgenerator</feature>\n-        <feature>security-handler-basic</feature>\n-        <feature dependency=\"true\">oidc-dependencies</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>saml-validator</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security/security-saml-util/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.handler/security-handler-saml/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.encryption/security-encryption-api/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <bundle>mvn:com.google.code.gson/gson/${gson.version}</bundle>\n-    </feature>\n+        <!-- PKI Auth -->\n+        <bundle>mvn:ddf.security.realm/security-realm-pki/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.handler/security-handler-pki/${project.version}</bundle>\n \n-    <feature name=\"saml-validator\" version=\"${project.version}\" description=\"Saml token validator\">\n-        <!--  TODO (https://github.com/codice/ddf/issues/5327)\n-                Address potential circular dependencies as part of security refactor  -->\n-        <feature>security-core-impl</feature>\n-        <feature>security-handler-impl</feature>\n-        <bundle>mvn:ddf.security.saml/saml-assertion-validator/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.saml/saml-assertion-validator-impl/${project.version}</bundle>\n-    </feature>\n+        <!-- Email -->\n+        <bundle>mvn:ddf.platform.email/platform-email-impl/${project.version}</bundle>\n \n-    <feature name=\"security-command-listener\" version=\"${project.version}\"\n-             description=\"Audits all commands entered on the Karaf command line.\">\n-        <feature>security-core-api</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-core-services</feature>\n+        <!-- Miscellaneous -->\n+        <bundle>mvn:ddf.platform/platform-paxweb-jettyconfig/${project.version}</bundle>\n+        <bundle>mvn:ddf.platform/platform-http-proxy/${project.version}</bundle>\n+        <bundle>mvn:ddf.platform.security/secure-boot/${project.version}</bundle>\n         <bundle>mvn:ddf.security.command/security-command-listener/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.servlet/security-servlet-whoami/${project.version}</bundle>\n     </feature>\n \n-    <feature name=\"security-web-sso-defaults\" version=\"${project.version}\"\n-             description=\"Installs the default features needed for web-based SSO authentication.\">\n-        <feature>security-policy-context</feature>\n-        <feature>security-expansion</feature>\n-        <feature>security-expansion-user-attributes</feature>\n-        <feature>security-expansion-metacard-attributes</feature>\n-        <feature>security-core-misc</feature>\n-        <feature>security-filter-web-sso</feature>\n-        <feature>security-filter-login</feature>\n-        <feature>security-filter-csrf</feature>\n-        <feature>security-handler-basic</feature>\n-        <feature>security-oidc-realm</feature>\n-        <feature>security-handler-oidc</feature>\n-        <feature>security-handler-oauth</feature>\n-        <feature>security-handler-saml</feature>\n-        <feature>security-filter-authz</feature>\n-        <feature>security-pdp-authz</feature>\n-        <feature>security-servlet-whoami</feature>\n-        <feature>security-servlet-session-expiry</feature>\n-        <feature>security-servlet-web-socket</feature>\n-        <feature>security-realm-saml</feature>\n-        <feature>security-guest-realm</feature>\n-        <feature>security-claims-property</feature>\n+    <feature name=\"oidc-auth\" version=\"${project.version}\"\n+             description=\"OIDC features and bundles.\">\n         <feature>security-core-services</feature>\n-    </feature>\n \n-    <feature name=\"secure-boot\" version=\"${project.version}\"\n-             description=\"Verifies that the installation is located in a secure directory.\">\n-        <bundle>mvn:ddf.platform.security/secure-boot/${project.version}</bundle>\n-    </feature>\n-\n-    <feature name=\"security-core\" version=\"${project.version}\"\n-             description=\"The Security Application provides Authentication, Authorization, and Auditing services.\\nThey comprise both a framework that developers and integrators can extend and also a reference implementation that can be used which meets security requirements.::Security\">\n-        <feature>web-container</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-policy-context</feature>\n-        <feature>security-web-sso-defaults</feature>\n-        <feature>security-guest</feature>\n-        <feature>security-command-listener</feature>\n+        <bundle>mvn:ddf.security.realm/security-realm-oidc/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.handler/security-handler-oidc/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.handler/security-handler-oauth/${project.version}</bundle>\n     </feature>\n \n-    <!-- Start of app features -->\n-\n-    <repository>mvn:ddf.features/camel/${project.version}/xml/features</repository>\n+    <feature name=\"saml-auth\" version=\"${project.version}\"\n+             description=\"SAML features and bundles.\">\n+        <feature>security-core-services</feature>\n \n-    <feature name=\"platform-http-proxy\" version=\"${project.version}\"\n-             description=\"HTTP to HTTPS proxy.\">\n-        <feature>camel-jetty9</feature>\n-        <feature>security-core-api</feature>\n-        <feature>camel-blueprint</feature>\n-        <feature>camel-http</feature>\n-        <bundle>mvn:org.codice.thirdparty/commons-httpclient/3.1.0_1</bundle>\n-        <bundle>mvn:ddf.platform/platform-http-proxy/${project.version}</bundle>\n-    </feature>\n+        <!--  TODO (https://github.com/codice/ddf/issues/5327)\n+                Remove wrapped OpenSAML after security refactor is complete  -->\n+        <!--  <bundle>mvn:org.apache.servicemix.bundles/org.apache.servicemix.bundles.opensaml/${opensaml.osgi.version}-->\n+        <!--  </bundle>-->\n+        <bundle>mvn:ddf.lib.bundles/libs-bundles-opensaml/${project.version}</bundle>\n \n-    <feature name=\"session-manager-command\" version=\"${project.version}\"\n-             description=\"Commands for managing active SAML sessions\">\n-        <feature>security-handler-api</feature>\n-        <bundle>mvn:ddf.security.command/security-command-sessionmanager/${project.version}</bundle>\n-    </feature>\n+        <bundle>mvn:ddf.security/security-saml-util/${project.version}</bundle>\n \n-    <feature name=\"security-misc\" version=\"${project.version}\">\n-        <feature>security-core-misc</feature>\n-        <feature>security-certificate</feature>\n-    </feature>\n+        <bundle>mvn:ddf.security.saml/saml-assertion-validator/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.saml/saml-assertion-validator-impl/${project.version}</bundle>\n \n-    <feature name=\"security-certificate\"\n-             version=\"${project.version}\"\n-             description=\"Keystore editor MBean and associated web application.\">\n-        <bundle>mvn:org.codice.thirdparty/commons-httpclient/3.1.0_1</bundle>\n-        <feature>security-core-api</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>\n-            mvn:ddf.security.certificate/security-certificate-keystoreeditor/${project.version}\n-        </bundle>\n-        <bundle>mvn:ddf.security.certificate/security-certificate-generator/${project.version}\n-        </bundle>\n-        <bundle>mvn:ddf.security.certificate/security-crl-generator/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.certificate/security-ocsp-checker/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.realm/security-realm-saml/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.handler/security-handler-saml/${project.version}</bundle>\n     </feature>\n \n-    <feature name=\"security-servlet-logout\" version=\"${project.version}\"\n-             description=\"Logout servlet.\">\n-        <feature>guava</feature>\n-        <feature>cxf-frontend-javascript</feature>\n-        <feature>action-core-impl</feature>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <feature>javax-validation</feature>\n-        <feature>cxf-jaxrs</feature>\n-        <feature>security-handler-api</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-token-storage</feature>\n+    <feature name=\"ldap-auth\" version=\"${project.version}\"\n+             description=\"LDAP features and bundles.\">\n         <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.servlet/security-servlet-logout-service/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.servlet/security-servlet-default-logout/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.servlet/security-servlet-logout/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.servlet/security-servlet-logout-endpoint/${project.version}</bundle>\n-        <bundle>mvn:com.google.code.gson/gson/${gson.version}</bundle>\n-    </feature>\n \n-    <feature name=\"platform-email\" version=\"${project.version}\" start-level=\"50\">\n-        <bundle>mvn:commons-lang/commons-lang/${commons-lang.version}</bundle>\n-        <bundle>mvn:com.sun.mail/javax.mail/${javax-mail.version}</bundle>\n-        <feature>guava</feature>\n-        <bundle>mvn:ddf.platform.email/platform-email-api/${project.version}</bundle>\n-        <feature>security-logger</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.platform.email/platform-email-impl/${project.version}</bundle>\n-    </feature>\n+        <bundle>mvn:org.apache.commons/commons-pool2/2.5.0</bundle>\n+        <bundle>mvn:ddf.security.jaas/security-jaas-ldap/${project.version}</bundle>\n \n-    <feature name=\"platform-country-local\" version=\"${project.version}\"\n-             description=\"Service to convert country codes into various formats by performing a local lookup.\">\n-        <feature>guava</feature>\n-        <feature>security-core-api</feature>\n-        <bundle>mvn:ddf.platform.country/platform-country-converter-api/${project.version}</bundle>\n-        <bundle>mvn:ddf.platform.country/platform-country-converter-local/${project.version}\n-        </bundle>\n+        <configfile finalname=\"${ddf.etc}/ws-security/attributeMap.properties\">\n+            mvn:ddf.security.claims/security-claims-ldap/${project.version}/properties/attributeMap\n+        </configfile>\n+        <bundle>mvn:ddf.security.claims/security-claims-ldap/${project.version}</bundle>\n     </feature>\n \n-    <feature name=\"security-services-app\" version=\"${project.version}\"\n-             description=\"The Security Application provides Authentication, Authorization, and Auditing services.\\nThey comprise both a framework that developers and integrators can extend and also a reference implementation that can be used which meets security requirements.::Security\">\n-        <feature>security-core</feature>\n-        <feature>security-certificate</feature>\n-        <feature>security-servlet-logout</feature>\n+    <feature name=\"embedded-ldap\" version=\"${project.version}\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5fe3c153d747edf954bc7be7ba8835a00d20f2da"}, "originalPosition": 907}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTI3MTM1NQ==", "bodyText": "The old embedded-ldap features only contained config files, so yes.\nHowever this comment just reminded me that I haven't tried running itests yet \ud83d\ude31", "url": "https://github.com/codice/ddf/pull/6155#discussion_r449271355", "createdAt": "2020-07-02T21:21:05Z", "author": {"login": "bakejeyner"}, "path": "features/security/src/main/feature/feature.xml", "diffHunk": "@@ -21,694 +21,317 @@\n     <repository>mvn:ddf.features/kernel/${project.version}/xml/features</repository>\n     <repository>mvn:ddf.features/utilities/${project.version}/xml/features</repository>\n     <repository>mvn:ddf.features/branding/${project.version}/xml/features</repository>\n+    <repository>mvn:ddf.features/camel/${project.version}/xml/features</repository>\n \n-    <feature name=\"security-logger\" version=\"${project.version}\"\n-             description=\"Logs incoming and outgoing requests\">\n-        <feature>security-core-api</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.interceptor/security-interceptor-logger/${project.version}</bundle>\n-    </feature>\n+    <feature name=\"security-core-api-dependencies\" version=\"${project.version\"\n+             description=\"Dependencies for the core security APIs.\">\n+        <!-- Third Party Features -->\n+        <feature prerequisite=\"true\">wrap</feature>\n+        <feature>pax-http-whiteboard</feature>\n \n-    <feature name=\"security-core-api\" version=\"${project.version}\"\n-             description=\"Security Core\">\n-        <bundle start-level=\"30\">mvn:org.apache.neethi/neethi/${wss4j.neethi.version}</bundle>\n-        <feature>cxf-rt-security</feature>\n-        <feature>security-filter-api</feature>\n+        <!-- External DDF Features -->\n+        <feature>jackson</feature>\n+        <feature>wss4j</feature>\n+        <feature>cxf-ws-security</feature>\n         <feature>cxf-jaxrs</feature>\n-        <feature>platform-util</feature>\n-        <bundle dependency=\"true\">mvn:ddf.platform.security/log-sanitizer/${project.version}</bundle>\n-        <bundle dependency=\"true\">mvn:org.apache.commons/commons-configuration2/${commons-configuration2.version}</bundle>\n-        <bundle dependency=\"true\">mvn:org.apache.shiro/shiro-core/${apache.shiro.version}</bundle>\n-\n-        <feature>guava</feature>\n+        <feature>cxf-bindings-soap</feature>\n         <feature>common-system</feature>\n \n-        <bundle>mvn:joda-time/joda-time/${joda-time.version}</bundle>\n-        <bundle>mvn:org.apache.santuario/xmlsec/${xmlsec.version}</bundle>\n+        <!-- NimbusDS -->\n+        <bundle>wrap:mvn:com.nimbusds/nimbus-jose-jwt/${nimbus.version}</bundle>\n+        <bundle>wrap:mvn:com.nimbusds/oauth2-oidc-sdk/${nimbus.oidc.version}</bundle>\n+        <bundle>mvn:com.nimbusds/content-type/${nimbus.content-type.version}</bundle>\n+        <bundle>mvn:com.nimbusds/lang-tag/${nimbus.langtag.version}</bundle>\n \n-        <feature>cxf-bindings-soap</feature>\n-        <feature>cxf-ws-policy</feature>\n-        <feature>cxf-ws-security</feature>\n-        <feature>spring</feature>\n+        <!-- MiniDev -->\n+        <bundle>mvn:net.minidev/accessors-smart/1.2</bundle>\n+        <bundle>mvn:net.minidev/json-smart/2.3</bundle>\n \n-        <!--  TODO (https://github.com/codice/ddf/issues/5327)\n-                Remove wrapped OpenSAML after security refactor is complete  -->\n-        <!--  <bundle>mvn:org.apache.servicemix.bundles/org.apache.servicemix.bundles.opensaml/${opensaml.osgi.version}-->\n-        <!--  </bundle>-->\n-        <bundle>mvn:ddf.lib.bundles/libs-bundles-opensaml/${project.version}</bundle>\n+        <!-- Miscellaneous -->\n+        <bundle dependency=\"true\">mvn:org.apache.shiro/shiro-core/${apache.shiro.version}</bundle>\n+        <bundle>mvn:com.sun.mail/javax.mail/${javax-mail.version}</bundle>\n+        <!--\n+            net.minidev/accessors-smart/1.2 uses asm v5.x. Need this resolved before we can upgrade:\n+            https://bitbucket.org/connect2id/nimbus-jose-jwt/issues/239/switch-to-other-json-library\n+        -->\n+        <bundle>mvn:org.ow2.asm/asm/5.2</bundle>\n+        <bundle>wrap:mvn:com.github.stephenc.jcip/jcip-annotations/1.0-1</bundle>\n+    </feature>\n \n+    <feature name=\"security-core-api\" version=\"${project.version}\"\n+             description=\"Core security APIs.\">\n+        <feature>security-core-api-dependencies</feature>\n+\n+        <!-- Core -->\n         <bundle>mvn:ddf.security.core/security-core-api/${project.version}</bundle>\n+\n+        <!-- Country Converter -->\n+        <bundle>mvn:ddf.platform.country/platform-country-converter-api/${project.version}</bundle>\n+\n+        <!-- Rest Client -->\n         <bundle>mvn:ddf.platform.security/security-rest-clientapi/${project.version}</bundle>\n-        <bundle>\n-            mvn:org.apache.servicemix.bundles/org.apache.servicemix.bundles.jaxen/${org.apache.servicemix.bundles.jaxen.version}\n-        </bundle>\n-    </feature>\n \n-    <feature name=\"security-filter-api\" version=\"${project.version}\">\n-        <bundle>mvn:javax.servlet/javax.servlet-api/${javax.servlet-api-version}</bundle>\n+        <!-- Filters -->\n         <bundle>mvn:ddf.platform/security-filter-api/${project.version}</bundle>\n-    </feature>\n \n-    <feature name=\"platform-error-page-injector\" version=\"${project.version}\"\n-             description=\"Adding a better error page to Jetty\">\n-        <feature>error-api</feature>\n-        <bundle>mvn:ddf.platform.error/platform-error-page-injector/${project.version}</bundle>\n-    </feature>\n+        <!-- Handlers -->\n+        <bundle>mvn:ddf.security.handler/security-handler-api/${project.version}</bundle>\n \n-    <feature name=\"security-encryption\" version=\"${project.version}\"\n-             description=\"Security Encryption\">\n-        <feature>wss4j</feature>\n-        <bundle>mvn:org.apache.commons/commons-lang3/${commons-lang3.version}</bundle>\n+        <!-- Policy -->\n+        <bundle>mvn:ddf.security.policy/security-policy-api/${project.version}</bundle>\n+\n+        <!-- Encryption -->\n         <bundle>mvn:ddf.security.encryption/security-encryption-api/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.encryption/security-encryption-impl/${project.version}</bundle>\n-        <bundle dependency=\"true\">mvn:ddf.platform.security/log-sanitizer/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.encryption/security-encryption-commands/${project.version}</bundle>\n-    </feature>\n \n-    <feature name=\"web-container\" version=\"${project.version}\">\n-        <feature>platform-paxweb-jettyconfig</feature>\n-        <feature>platform-error-page-injector</feature>\n-        <feature>war</feature>\n-    </feature>\n+        <!-- Expansion -->\n+        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n \n-    <feature name=\"session-invalidator\" version=\"${project.version}\"\n-             description=\"API for invalidating servlet sessions\">\n-        <bundle>mvn:ddf.platform/platform-session-invalidator/${project.version}</bundle>\n-    </feature>\n+        <!-- Token Storage -->\n+        <bundle>mvn:ddf.security.storage/token-storage-api/${project.version}</bundle>\n \n-    <feature name=\"platform-paxweb-jettyconfig\" version=\"${project.version}\"\n-      description=\"Custom Session Manager\">\n-        <config name=\"org.ops4j.pax.web\" append=\"true\">\n-#######################################\n-# Jetty Server Authenticator Settings\n-#######################################\n+        <!-- Sessions -->\n+        <bundle>mvn:ddf.platform.security/session-management-api/${project.version}</bundle>\n+        <bundle>mvn:ddf.platform/platform-session-invalidator-api/${project.version}</bundle>\n \n-# Set the authmethod/realmname so that our JettyAuthenticator is used\n-org.ops4j.pax.web.default.authmethod=DDF\n-org.ops4j.pax.web.default.realmname=DDF\n-        </config>\n-        <feature version=\"${spring.version}_1\">spring</feature>\n-        <feature>apache-commons</feature>\n-        <feature>security-core-api</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-core-services</feature>\n-        <feature>security-filter-api</feature>\n-        <feature>pax-http-jetty</feature>\n-        <bundle start-level=\"30\">mvn:org.ops4j.pax.web/pax-web-jsp/${pax.web.version}</bundle>\n-        <bundle>mvn:javax.el/javax.el-api/3.0.0</bundle>\n-        <feature>pax-jetty</feature>\n-        <feature>session-invalidator</feature>\n-        <feature prerequisite=\"true\">wrap</feature>\n-        <bundle>wrap:mvn:net.jodah/failsafe/${jodah-failsafe.version}</bundle>\n-        <feature>guava</feature>\n-        <feature>common-system</feature>\n-        <bundle>mvn:ddf.platform/platform-paxweb-jettyconfig/${project.version}</bundle>\n-    </feature>\n+        <!-- Logout -->\n+        <bundle>mvn:ddf.security.servlet/security-servlet-logout-api/${project.version}</bundle>\n \n-    <feature name=\"security-handler-api\" version=\"${project.version}\"\n-             description=\"API for authentication handlers for web applications.\">\n-        <feature>security-core-api</feature>\n-        <feature>parser-xml</feature>\n-        <feature>oidc-dependencies</feature>\n-        <bundle>mvn:org.apache.cxf/cxf-rt-rs-security-jose/${cxf.version}</bundle>\n-        <bundle>mvn:org.apache.cxf/cxf-rt-rs-security-jose-jaxrs/${cxf.version}</bundle>\n-        <bundle>mvn:ddf.security.handler/security-handler-api/${project.version}</bundle>\n-    </feature>\n+        <!-- Email -->\n+        <bundle>mvn:ddf.platform.email/platform-email-api/${project.version}</bundle>\n \n-    <feature name=\"security-handler-impl\" version=\"${project.version}\"\n-             description=\"Implementation used by all security handlers\">\n-        <feature>security-core-api</feature>\n-        <feature>security-core-impl</feature>\n-        <bundle>mvn:ddf.security.handler/security-handler-impl/${project.version}</bundle>\n+        <!-- Miscellaneous -->\n+        <bundle>mvn:ddf.security.servlet/security-servlet-web-socket-api/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.interceptor/security-interceptor-guest-wrapper/${project.version}</bundle>\n+        <bundle>mvn:ddf.platform.security/security-oidc-bundle/${project.version}</bundle>\n+        <bundle dependency=\"true\">mvn:ddf.platform.security/log-sanitizer/${project.version}</bundle>\n     </feature>\n \n-    <feature name=\"security-token-storage\" version=\"${project.version}\"\n-             description=\"OAuth token storage api and file storage implementation.\">\n-        <feature>apache-commons</feature>\n-        <bundle>mvn:com.google.code.gson/gson/${gson.version}</bundle>\n-        <bundle>mvn:ddf.security.storage/token-storage-api/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.storage/token-storage-impl/${project.version}</bundle>\n+    <feature name=\"security-core-impl-dependencies\" version=\"${project.version}\"\n+             description=\"Dependencies for core security implementations.\">\n+        <!-- External DDF Features -->\n+        <feature>javax-validation</feature>\n+        <feature>parser-xml</feature>\n+        <feature>platform-util</feature>\n     </feature>\n \n     <feature name=\"security-core-impl\" version=\"${project.version}\"\n-             description=\"Security Core\">\n+             description=\"Core security implementations.\">\n         <feature>security-core-api</feature>\n-        <feature>security-handler-api</feature>\n-        <feature>security-encryption</feature>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <bundle>mvn:ddf.platform.util/util-uuidgenerator-api/${project.version}</bundle>\n-        <feature>javax-validation</feature>\n-        <feature>cxf-frontend-javascript</feature>\n-        <bundle>mvn:javax.servlet/javax.servlet-api/${javax.servlet-api.version}</bundle>\n-        <feature>cxf-jaxrs</feature>\n-        <feature>util-uuidgenerator</feature>\n-        <feature dependency=\"true\">oidc-dependencies</feature>\n-        <feature>security-token-storage</feature>\n-        <feature>cxf-rs-security-oauth2</feature>\n-        <feature>platform-util</feature>\n+        <feature>security-core-impl-dependencies</feature>\n+\n+        <!-- Core -->\n         <bundle>mvn:ddf.security.core/security-core-impl/${project.version}</bundle>\n-    </feature>\n \n-    <feature name=\"security-core-services\" version=\"${project.version}\"\n-             description=\"Main security services\">\n-        <feature>security-core-impl</feature>\n-        <feature>security-handler-impl</feature>\n-        <bundle>mvn:ddf.security.core/security-core-services/${project.version}</bundle>\n-        <bundle>mvn:ddf.platform.security/security-rest-cxfwrapper/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.realm/security-realm-pki/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.realm/security-realm-userpass/${project.version}</bundle>\n-    </feature>\n+        <!-- Handlers -->\n+        <bundle>mvn:ddf.security.handler/security-handler-impl/${project.version}</bundle>\n \n-    <feature name=\"security-expansion\" version=\"${project.version}\"\n-             description=\"Security Expansion\">\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n+        <!-- Expansion -->\n         <bundle>mvn:ddf.security.expansion/security-expansion-impl/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-commands/${project.version}</bundle>\n-    </feature>\n-\n-    <feature name=\"security-pdp-authz\" version=\"${project.version}\"\n-             description=\"Security PDP.\">\n-        <configfile finalname=\"${ddf.etc}/ddf.security.pdp.realm.AuthzRealm.config\">\n-            mvn:ddf.security.pdp/security-pdp-authzrealm/${project.version}/config/default-authzrealm\n-        </configfile>\n-        <feature>security-core-impl</feature>\n-        <feature dependency=\"true\">oidc-dependencies</feature>\n-        <feature>security-expansion</feature>\n-        <feature>security-expansion-user-attributes</feature>\n-        <feature>security-expansion-metacard-attributes</feature>\n-        <feature>javax-validation</feature>\n \n-        <feature>cxf-frontend-javascript</feature>\n-        <feature>cxf-jaxrs</feature>\n-        <feature>parser-xml</feature>\n-        <feature>security-handler-api</feature>\n-        <feature>platform-util</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.pdp/security-pdp-authzrealm/${project.version}</bundle>\n-    </feature>\n-\n-    <feature name=\"security-pep-serviceauthz\" version=\"${project.version}\"\n-             description=\"Security PEP Service AuthZ\">\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <feature>javax-validation</feature>\n-        <feature>cxf-frontend-javascript</feature>\n-        <feature>cxf-jaxrs</feature>\n-        <bundle>mvn:ddf.security.encryption/security-encryption-api/${project.version}</bundle>\n-        <feature>security-handler-api</feature>\n-        <feature dependency=\"true\">oidc-dependencies</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-core-services</feature>\n+        <!-- Policy Extension Point -->\n         <bundle>mvn:ddf.security.pep/security-pep-interceptor/${project.version}</bundle>\n     </feature>\n \n-    <feature name=\"security-expansion-user-attributes\" version=\"${project.version}\"\n-             description=\"Security Expansion User Attributes Expansion\">\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-impl/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-userattr-map/${project.version}\n-        </bundle>\n-    </feature>\n-\n-    <feature name=\"security-expansion-metacard-attributes\" version=\"${project.version}\"\n-             description=\"Security Expansion Metacard Attributes Expansion\">\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-impl/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-metacardattr-map/${project.version}\n-        </bundle>\n-    </feature>\n+    <feature name=\"security-core-services-dependencies\" version=\"${project.version}\"\n+             description=\"Dependencies for core security services.\">\n+        <!-- Third Party Features -->\n+        <feature>spring</feature>\n+        <feature>war</feature>\n+        <feature>pax-jetty</feature>\n+        <feature>pax-http-jetty</feature>\n \n-    <feature name=\"security-core-misc\" version=\"${project.version}\">\n+        <!-- External DDF Features -->\n+        <feature>apache-commons</feature>\n+        <feature>guava</feature>\n         <feature>cxf-core</feature>\n-        <feature>cxf-ws-security</feature>\n-        <bundle start-level=\"40\">mvn:org.apache.cxf/cxf-rt-rs-json-basic/${cxf.version}</bundle>\n-        <bundle start-level=\"40\">mvn:org.apache.cxf/cxf-rt-rs-security-jose/${cxf.version}</bundle>\n-        <bundle>mvn:org.apache.commons/commons-jexl/2.1.1</bundle>\n-        <feature>security-core-api</feature>\n-        <feature>security-handler-api</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-handler-impl</feature>\n-        <feature>platform-util</feature>\n-        <feature prerequisite=\"true\">wrap</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.platform.security/security-rest-cxfwrapper/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.certificate/security-ocsp-checker/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.handler/security-handler-pki/${project.version}</bundle>\n-        <bundle>wrap:mvn:org.springframework.ldap/spring-ldap-core/2.3.2.RELEASE</bundle>\n-        <configfile finalname=\"${ddf.etc}/ws-security/attributeMap.properties\">\n-            mvn:ddf.security.claims/security-claims-ldap/${project.version}/properties/attributeMap\n-        </configfile>\n-    </feature>\n-\n-    <feature name=\"security-realm-saml\" version=\"${project.version}\"\n-             description=\"Security realm for SAML.\">\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <feature>security-core-impl</feature>\n-        <feature>javax-validation</feature>\n-        <feature>cxf-frontend-javascript</feature>\n-        <feature>cxf-jaxrs</feature>\n-        <feature>security-handler-api</feature>\n-        <feature>security-handler-impl</feature>\n-        <feature>security-policy-context</feature>\n-        <feature dependency=\"true\">saml-validator</feature>\n-        <feature dependency=\"true\">oidc-dependencies</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.realm/security-realm-saml/${project.version}</bundle>\n-    </feature>\n-\n-    <feature name=\"security-guest-realm\" version=\"${project.version}\"\n-             description=\"Security Guest Realm.\">\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <feature>security-core-impl</feature>\n-        <feature>javax-validation</feature>\n-        <feature>security-handler-api</feature>\n-        <feature>security-handler-impl</feature>\n-        <feature>security-policy-context</feature>\n+        <feature>cxf-rt-security</feature>\n+        <feature>cxf-ws-policy</feature>\n         <feature>cxf-frontend-javascript</feature>\n-        <feature>cxf-jaxrs</feature>\n-        <feature dependency=\"true\">oidc-dependencies</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.realm/security-realm-guest/${project.version}</bundle>\n-    </feature>\n-\n-    <feature name=\"security-jaas-ldap\" version=\"${project.version}\"\n-             description=\"Security JAAS LDAP Login.\">\n-        <feature>security-core-misc</feature>\n-        <feature>javax-validation</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:org.apache.commons/commons-pool2/2.5.0</bundle>\n-        <bundle>mvn:ddf.security.encryption/security-encryption-api/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.jaas/security-jaas-ldap/${project.version}</bundle>\n-    </feature>\n-\n-    <feature name=\"security-claims-ldap\" version=\"${project.version}\"\n-             description=\"Retrieves claims attributes from an LDAP store.\">\n-        <bundle>mvn:ddf.security.encryption/security-encryption-api/${project.version}</bundle>\n-        <feature>security-core-misc</feature>\n-        <feature>security-encryption</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.claims/security-claims-ldap/${project.version}</bundle>\n-    </feature>\n+        <feature>cxf-rs-security-oauth2</feature>\n+        <feature>cxf-rs-security-sso-saml</feature>\n+        <feature>action-core-impl</feature>\n+        <feature>error-api</feature>\n+        <feature>util-uuidgenerator</feature>\n+        <feature>camel-jetty9</feature>\n+        <feature>camel-blueprint</feature>\n+        <feature>camel-http</feature>\n \n-    <feature name=\"ldap-embedded-default-configs\" version=\"${project.version}\"\n-             description=\"Installs default embedded ldap claims handler and login configs\">\n-        <feature>ldap-embedded-default-claimshandler-config</feature>\n-        <feature>ldap-embedded-default-stslogin-config</feature>\n-    </feature>\n+        <!-- JavaX -->\n+        <bundle>mvn:javax.el/javax.el-api/3.0.0</bundle>\n+        <bundle>mvn:javax.servlet/javax.servlet-api/${javax.servlet-api-version}</bundle>\n \n-    <feature name=\"ldap-embedded-default-claimshandler-config\" version=\"${project.version}\"\n-             description=\"Installs a default embedded ldap login config\">\n-        <configfile\n-                finalname=\"${ddf.etc}/Claims_Handler_Manager-ddf.security.sts.claimsHandler.ClaimsHandlerManager.config\"\n-                override=\"false\">\n-            mvn:ddf.security.claims/security-claims-ldap/${project.version}/config/default-ldap-claimshandler\n-        </configfile>\n-    </feature>\n+        <!-- Apache -->\n+        <bundle>mvn:org.apache.commons/commons-lang3/${commons-lang3.version}</bundle>\n+        <bundle dependency=\"true\">mvn:org.apache.commons/commons-configuration2/${commons-configuration2.version}</bundle>\n+        <bundle>mvn:org.apache.commons/commons-jexl/2.1.1</bundle>\n+        <bundle>\n+            mvn:org.apache.servicemix.bundles/org.apache.servicemix.bundles.jaxen/${org.apache.servicemix.bundles.jaxen.version}\n+        </bundle>\n+        <bundle>mvn:org.apache.santuario/xmlsec/${xmlsec.version}</bundle>\n+        <bundle start-level=\"30\">mvn:org.apache.neethi/neethi/${wss4j.neethi.version}</bundle>\n+        <bundle start-level=\"40\">mvn:org.apache.cxf/cxf-rt-rs-json-basic/${cxf.version}</bundle>\n+        <bundle start-level=\"40\">mvn:org.apache.cxf/cxf-rt-rs-security-jose/${cxf.version}</bundle>\n \n-    <feature name=\"ldap-embedded-default-stslogin-config\" version=\"${project.version}\"\n-             description=\"Installs a default embedded ldap claims handler config\">\n-        <configfile\n-                finalname=\"${ddf.etc}/Ldap_Login_Config-ddf.ldap.ldaplogin.LdapLoginConfig.config\"\n-                override=\"false\">\n-            mvn:ddf.security.jaas/security-jaas-ldap/${project.version}/config/default-ldaplogin\n-        </configfile>\n-    </feature>\n+        <!-- Pax -->\n+        <config name=\"org.ops4j.pax.web\" append=\"true\">\n+            #######################################\n+            # Jetty Server Authenticator Settings\n+            #######################################\n \n-    <feature name=\"security-handler-basic\" version=\"${project.version}\"\n-             description=\"Basic Authentication Handler for web applications.\">\n-        <feature>security-core-misc</feature>\n-        <feature>parser-xml</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.handler/security-handler-basic/${project.version}</bundle>\n-    </feature>\n+            # Set the authmethod/realmname so that our JettyAuthenticator is used\n+            org.ops4j.pax.web.default.authmethod=DDF\n+            org.ops4j.pax.web.default.realmname=DDF\n+        </config>\n+        <bundle start-level=\"30\">mvn:org.ops4j.pax.web/pax-web-jsp/${pax.web.version}</bundle>\n \n-    <feature name=\"oidc-dependencies\" version=\"${project.version}\"\n-      description=\"All OIDC third party dependencies\">\n-        <feature prerequisite=\"true\">wrap</feature>\n-        <feature>jackson</feature>\n-        <bundle>mvn:com.sun.mail/javax.mail/${javax-mail.version}</bundle>\n-        <!--\n-            net.minidev/accessors-smart/1.2 uses asm v5.x. Need this resolved before we can upgrade:\n-            https://bitbucket.org/connect2id/nimbus-jose-jwt/issues/239/switch-to-other-json-library\n-        -->\n-        <bundle>mvn:org.ow2.asm/asm/5.2</bundle>\n-        <bundle>mvn:net.minidev/accessors-smart/1.2</bundle>\n-        <bundle>mvn:net.minidev/json-smart/2.3</bundle>\n-        <bundle>wrap:mvn:com.nimbusds/nimbus-jose-jwt/${nimbus.version}</bundle>\n-        <bundle>wrap:mvn:com.nimbusds/oauth2-oidc-sdk/${nimbus.oidc.version}</bundle>\n-        <bundle>mvn:com.nimbusds/content-type/${nimbus.content-type.version}</bundle>\n-        <bundle>mvn:com.nimbusds/lang-tag/${nimbus.langtag.version}</bundle>\n-        <bundle>wrap:mvn:com.github.stephenc.jcip/jcip-annotations/1.0-1</bundle>\n-        <bundle>mvn:commons-codec/commons-codec/${commons-codec.version}</bundle>\n-        <bundle>mvn:ddf.platform.security/security-oidc-bundle/${project.version}</bundle>\n+        <!-- Miscellaneous -->\n+        <bundle>mvn:com.google.code.gson/gson/${gson.version}</bundle>\n+        <bundle>wrap:mvn:org.springframework.ldap/spring-ldap-core/2.3.2.RELEASE</bundle>\n+        <bundle>wrap:mvn:net.jodah/failsafe/${jodah-failsafe.version}</bundle>\n+        <bundle>mvn:joda-time/joda-time/${joda-time.version}</bundle>\n+        <bundle>mvn:org.codice.thirdparty/commons-httpclient/3.1.0_1</bundle>\n     </feature>\n \n-    <feature name=\"security-handler-oidc\" version=\"${project.version}\"\n-             description=\"OIDC Authentication Handler for web applications.\">\n-        <feature>oidc-dependencies</feature>\n-        <feature>action-core-impl</feature>\n+    <feature name=\"security-core-services\" version=\"${project.version}\"\n+             description=\"Core security services.\">\n         <feature>security-core-impl</feature>\n-        <feature>security-handler-impl</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.handler/security-handler-oidc/${project.version}</bundle>\n-    </feature>\n+        <feature>security-core-services-dependencies</feature>\n \n-    <feature name=\"security-handler-oauth\" version=\"${project.version}\"\n-      description=\"OIDC Authentication Handler for web applications.\">\n-        <feature>oidc-dependencies</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-handler-impl</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.handler/security-handler-oauth/${project.version}</bundle>\n-    </feature>\n+        <!-- Core -->\n+        <bundle>mvn:ddf.security.core/security-core-services/${project.version}</bundle>\n \n-    <feature name=\"security-oidc-realm\" version=\"${project.version}\"\n-             description=\"OIDC Authentication Handler for web applications.\">\n-        <feature>jackson</feature>\n-        <feature dependency=\"true\">oidc-dependencies</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-handler-api</feature>\n-        <feature>security-handler-oidc</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.realm/security-realm-oidc/${project.version}</bundle>\n-    </feature>\n+        <!-- Rest Client -->\n+        <bundle>mvn:ddf.platform.security/security-rest-cxfwrapper/${project.version}</bundle>\n \n-    <feature name=\"security-filter-login\" version=\"${project.version}\"\n-             description=\"Login Filter for web applications.\">\n-        <feature>security-core-impl</feature>\n-        <feature>security-policy-context</feature>\n-        <feature>cxf-rs-security-sso-saml</feature>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <feature>javax-validation</feature>\n-        <feature>cxf-frontend-javascript</feature>\n-        <feature>security-filter-api</feature>\n-        <feature>security-handler-api</feature>\n-        <feature>security-handler-impl</feature>\n-        <feature dependency=\"true\">oidc-dependencies</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.filter/security-filter-login/${project.version}</bundle>\n-    </feature>\n+        <!-- Country Converter -->\n+        <bundle>mvn:ddf.platform.country/platform-country-converter-local/${project.version}</bundle>\n \n-    <feature name=\"security-filter-csrf\" version=\"${project.version}\"\n-             description=\"CSRF Filter for web applications.\">\n-        <feature>security-core-api</feature>\n+        <!-- Filters -->\n         <bundle>mvn:ddf.security.filter/security-filter-csrf/${project.version}</bundle>\n-    </feature>\n-\n-    <feature name=\"security-filter-authz\" version=\"${project.version}\"\n-             description=\"Authz Filter for web applications.\">\n-        <feature>security-policy-context</feature>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <feature>security-filter-api</feature>\n-        <feature>javax-validation</feature>\n-        <feature>cxf-frontend-javascript</feature>\n-        <feature>cxf-jaxrs</feature>\n-        <feature>security-handler-api</feature>\n-        <feature dependency=\"true\">oidc-dependencies</feature>\n-        <feature>security-core-services</feature>\n+        <bundle>mvn:ddf.security.filter/security-filter-web-sso/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.filter/security-filter-login/${project.version}</bundle>\n         <bundle>mvn:ddf.security.filter/security-filter-authorization/${project.version}</bundle>\n-    </feature>\n \n+        <!-- Claims -->\n+        <bundle>mvn:ddf.security.claims/security-claims-property/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.claims/security-claims-attributequery/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.claims/security-claims-certificate/${project.version}</bundle>\n \n-    <feature name=\"security-filter-web-sso\" version=\"${project.version}\"\n-             description=\"Web SSO Filter for web applications.\">\n-        <feature>security-core-impl</feature>\n-        <feature>security-filter-api</feature>\n-        <feature>security-handler-api</feature>\n-        <feature>security-policy-context</feature>\n-        <feature>security-handler-impl</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.filter/security-filter-web-sso/${project.version}</bundle>\n-    </feature>\n+        <!-- Keys and Certificates -->\n+        <bundle>mvn:ddf.security.certificate/security-certificate-keystoreeditor/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.certificate/security-certificate-generator/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.certificate/security-crl-generator/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.certificate/security-ocsp-checker/${project.version}</bundle>\n \n-    <feature name=\"security-policy-context\" version=\"${project.version}\"\n-             description=\"Web Context policy manager\">\n-        <feature>security-core-api</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.policy/security-policy-api/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.policy/security-policy-context/${project.version}</bundle>\n-    </feature>\n+        <!-- Encryption -->\n+        <bundle>mvn:ddf.security.encryption/security-encryption-impl/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.encryption/security-encryption-commands/${project.version}</bundle>\n \n-    <feature name=\"security-claims-certificate\"\n-             version=\"${project.version}\"\n-             description=\"Retrieves claims from a user's certificate.\">\n-        <feature>security-core-misc</feature>\n-        <bundle>mvn:ddf.security.claims/security-claims-certificate/${project.version}\n-        </bundle>\n-    </feature>\n+        <!-- Token Storage -->\n+        <bundle>mvn:ddf.security.storage/token-storage-impl/${project.version}</bundle>\n \n-    <feature name=\"security-claims-property\" version=\"${project.version}\"\n-             description=\"Looks up user properties via a properties file.\">\n-        <feature>security-core-misc</feature>\n-        <feature>javax-validation</feature>\n-        <bundle>mvn:ddf.security.claims/security-claims-property/${project.version}</bundle>\n-    </feature>\n+        <!-- Sessions -->\n+        <bundle>mvn:ddf.platform.security/session-management-impl/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.servlet/security-servlet-session-expiry/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.command/security-command-sessionmanager/${project.version}</bundle>\n \n-    <feature name=\"security-interceptor-guest\" version=\"${project.version}\"\n-             description=\"Injects guest user information into incoming SOAP messages.\">\n-        <feature>guava</feature>\n-        <bundle>mvn:ddf.security.encryption/security-encryption-api/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <feature>javax-validation</feature>\n-        <feature>cxf-frontend-javascript</feature>\n-        <feature>cxf-jaxrs</feature>\n-        <feature>security-handler-api</feature>\n-        <feature>security-handler-impl</feature>\n-        <feature>security-policy-context</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-encryption</feature>\n-        <feature dependency=\"true\">oidc-dependencies</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.interceptor/security-interceptor-guest/${project.version}</bundle>\n-    </feature>\n+        <!-- Expansion -->\n+        <bundle>mvn:ddf.security.expansion/security-expansion-userattr-map/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.expansion/security-expansion-metacardattr-map/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.expansion/security-expansion-commands/${project.version}</bundle>\n \n-    <feature name=\"security-claims-attributequery\"\n-             version=\"${project.version}\"\n-             description=\"Retrieves claims from external attribute store using an AttributeQuery request.\">\n-        <feature>guava</feature>\n-        <bundle>mvn:ddf.security.encryption/security-encryption-api/${project.version}</bundle>\n-        <feature>security-core-misc</feature>\n-        <feature>security-encryption</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.claims/security-claims-attributequery/${project.version}\n-        </bundle>\n-    </feature>\n+        <!-- Logout -->\n+        <bundle>mvn:ddf.security.servlet/security-servlet-logout/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.servlet/security-servlet-default-logout/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.servlet/security-servlet-logout-endpoint/${project.version}</bundle>\n \n-    <feature name=\"security-interceptor-guest-wrapper\"\n-             version=\"${project.version}\"\n-             description=\"Wrapper for Security Interceptor Guest that injects guest user information into incoming SOAP messages.\">\n-        <feature>cxf-bindings-soap</feature>\n-        <feature>cxf-ws-security</feature>\n-        <bundle>mvn:ddf.security.interceptor/security-interceptor-guest-wrapper/${project.version}\n-        </bundle>\n-    </feature>\n+        <!-- Policy Decision Point -->\n+        <configfile finalname=\"${ddf.etc}/ddf.security.pdp.realm.AuthzRealm.config\">\n+            mvn:ddf.security.pdp/security-pdp-authzrealm/${project.version}/config/default-authzrealm\n+        </configfile>\n+        <bundle>mvn:ddf.security.pdp/security-pdp-authzrealm/${project.version}</bundle>\n \n-    <feature name=\"security-guest\" version=\"${project.version}\"\n-             description=\"Contains all of the guest security features.\">\n-        <feature>security-interceptor-guest-wrapper</feature>\n-        <feature>security-interceptor-guest</feature>\n-    </feature>\n+        <!-- Context Policy -->\n+        <bundle>mvn:ddf.security.policy/security-policy-context/${project.version}</bundle>\n \n-    <feature name=\"security-servlet-session-expiry\" version=\"${project.version}\"\n-             description=\"Session expiry servlet.\">\n-        <feature>guava</feature>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <feature>javax-validation</feature>\n-        <feature>cxf-frontend-javascript</feature>\n-        <feature>cxf-jaxrs</feature>\n-        <feature>security-handler-api</feature>\n-        <feature>security-core-impl</feature>\n-        <feature dependency=\"true\">oidc-dependencies</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.platform.security/session-management-service/${project.version}</bundle>\n-        <bundle>mvn:ddf.platform.security/session-management-impl/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.servlet/security-servlet-session-expiry/${project.version}</bundle>\n-    </feature>\n+        <!-- Logging -->\n+        <bundle>mvn:ddf.security.interceptor/security-interceptor-logger/${project.version}</bundle>\n \n-    <feature name=\"security-servlet-whoami\" version=\"${project.version}\"\n-             description=\"Who Am I servlet.\">\n-        <feature>security-core-impl</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.servlet/security-servlet-whoami/${project.version}</bundle>\n-    </feature>\n+        <!-- Guest Authentication -->\n+        <bundle>mvn:ddf.security.realm/security-realm-guest/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.interceptor/security-interceptor-guest/${project.version}</bundle>\n \n-    <feature name=\"security-servlet-web-socket\" version=\"${project.version}\"\n-             description=\"Defines a secure web socket servlet type.\">\n-        <feature>security-core-api</feature>\n-        <feature>pax-http-whiteboard</feature>\n-        <bundle>mvn:ddf.security.servlet/security-servlet-web-socket/${project.version}</bundle>\n-    </feature>\n+        <!-- Basic Auth -->\n+        <bundle>mvn:ddf.security.realm/security-realm-userpass/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.handler/security-handler-basic/${project.version}</bundle>\n \n-    <feature name=\"security-handler-saml\" version=\"${project.version}\"\n-             description=\"SAML Web SSO client\">\n-        <feature>security-core-api</feature>\n-        <feature>security-handler-api</feature>\n-        <feature>javax-validation</feature>\n-        <feature>action-core-impl</feature>\n-        <feature>cxf-rs-security-sso-saml</feature>\n-        <feature>security-filter-api</feature>\n-        <feature>session-invalidator</feature>\n-        <feature>platform-paxweb-jettyconfig</feature>\n-        <feature>security-filter-login</feature>\n-        <feature>guava</feature>\n-        <feature>cxf-frontend-javascript</feature>\n-        <feature>cxf-jaxrs</feature>\n-        <feature>util-uuidgenerator</feature>\n-        <feature>security-handler-basic</feature>\n-        <feature dependency=\"true\">oidc-dependencies</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>saml-validator</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security/security-saml-util/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.handler/security-handler-saml/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.encryption/security-encryption-api/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <bundle>mvn:com.google.code.gson/gson/${gson.version}</bundle>\n-    </feature>\n+        <!-- PKI Auth -->\n+        <bundle>mvn:ddf.security.realm/security-realm-pki/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.handler/security-handler-pki/${project.version}</bundle>\n \n-    <feature name=\"saml-validator\" version=\"${project.version}\" description=\"Saml token validator\">\n-        <!--  TODO (https://github.com/codice/ddf/issues/5327)\n-                Address potential circular dependencies as part of security refactor  -->\n-        <feature>security-core-impl</feature>\n-        <feature>security-handler-impl</feature>\n-        <bundle>mvn:ddf.security.saml/saml-assertion-validator/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.saml/saml-assertion-validator-impl/${project.version}</bundle>\n-    </feature>\n+        <!-- Email -->\n+        <bundle>mvn:ddf.platform.email/platform-email-impl/${project.version}</bundle>\n \n-    <feature name=\"security-command-listener\" version=\"${project.version}\"\n-             description=\"Audits all commands entered on the Karaf command line.\">\n-        <feature>security-core-api</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-core-services</feature>\n+        <!-- Miscellaneous -->\n+        <bundle>mvn:ddf.platform/platform-paxweb-jettyconfig/${project.version}</bundle>\n+        <bundle>mvn:ddf.platform/platform-http-proxy/${project.version}</bundle>\n+        <bundle>mvn:ddf.platform.security/secure-boot/${project.version}</bundle>\n         <bundle>mvn:ddf.security.command/security-command-listener/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.servlet/security-servlet-whoami/${project.version}</bundle>\n     </feature>\n \n-    <feature name=\"security-web-sso-defaults\" version=\"${project.version}\"\n-             description=\"Installs the default features needed for web-based SSO authentication.\">\n-        <feature>security-policy-context</feature>\n-        <feature>security-expansion</feature>\n-        <feature>security-expansion-user-attributes</feature>\n-        <feature>security-expansion-metacard-attributes</feature>\n-        <feature>security-core-misc</feature>\n-        <feature>security-filter-web-sso</feature>\n-        <feature>security-filter-login</feature>\n-        <feature>security-filter-csrf</feature>\n-        <feature>security-handler-basic</feature>\n-        <feature>security-oidc-realm</feature>\n-        <feature>security-handler-oidc</feature>\n-        <feature>security-handler-oauth</feature>\n-        <feature>security-handler-saml</feature>\n-        <feature>security-filter-authz</feature>\n-        <feature>security-pdp-authz</feature>\n-        <feature>security-servlet-whoami</feature>\n-        <feature>security-servlet-session-expiry</feature>\n-        <feature>security-servlet-web-socket</feature>\n-        <feature>security-realm-saml</feature>\n-        <feature>security-guest-realm</feature>\n-        <feature>security-claims-property</feature>\n+    <feature name=\"oidc-auth\" version=\"${project.version}\"\n+             description=\"OIDC features and bundles.\">\n         <feature>security-core-services</feature>\n-    </feature>\n \n-    <feature name=\"secure-boot\" version=\"${project.version}\"\n-             description=\"Verifies that the installation is located in a secure directory.\">\n-        <bundle>mvn:ddf.platform.security/secure-boot/${project.version}</bundle>\n-    </feature>\n-\n-    <feature name=\"security-core\" version=\"${project.version}\"\n-             description=\"The Security Application provides Authentication, Authorization, and Auditing services.\\nThey comprise both a framework that developers and integrators can extend and also a reference implementation that can be used which meets security requirements.::Security\">\n-        <feature>web-container</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-policy-context</feature>\n-        <feature>security-web-sso-defaults</feature>\n-        <feature>security-guest</feature>\n-        <feature>security-command-listener</feature>\n+        <bundle>mvn:ddf.security.realm/security-realm-oidc/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.handler/security-handler-oidc/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.handler/security-handler-oauth/${project.version}</bundle>\n     </feature>\n \n-    <!-- Start of app features -->\n-\n-    <repository>mvn:ddf.features/camel/${project.version}/xml/features</repository>\n+    <feature name=\"saml-auth\" version=\"${project.version}\"\n+             description=\"SAML features and bundles.\">\n+        <feature>security-core-services</feature>\n \n-    <feature name=\"platform-http-proxy\" version=\"${project.version}\"\n-             description=\"HTTP to HTTPS proxy.\">\n-        <feature>camel-jetty9</feature>\n-        <feature>security-core-api</feature>\n-        <feature>camel-blueprint</feature>\n-        <feature>camel-http</feature>\n-        <bundle>mvn:org.codice.thirdparty/commons-httpclient/3.1.0_1</bundle>\n-        <bundle>mvn:ddf.platform/platform-http-proxy/${project.version}</bundle>\n-    </feature>\n+        <!--  TODO (https://github.com/codice/ddf/issues/5327)\n+                Remove wrapped OpenSAML after security refactor is complete  -->\n+        <!--  <bundle>mvn:org.apache.servicemix.bundles/org.apache.servicemix.bundles.opensaml/${opensaml.osgi.version}-->\n+        <!--  </bundle>-->\n+        <bundle>mvn:ddf.lib.bundles/libs-bundles-opensaml/${project.version}</bundle>\n \n-    <feature name=\"session-manager-command\" version=\"${project.version}\"\n-             description=\"Commands for managing active SAML sessions\">\n-        <feature>security-handler-api</feature>\n-        <bundle>mvn:ddf.security.command/security-command-sessionmanager/${project.version}</bundle>\n-    </feature>\n+        <bundle>mvn:ddf.security/security-saml-util/${project.version}</bundle>\n \n-    <feature name=\"security-misc\" version=\"${project.version}\">\n-        <feature>security-core-misc</feature>\n-        <feature>security-certificate</feature>\n-    </feature>\n+        <bundle>mvn:ddf.security.saml/saml-assertion-validator/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.saml/saml-assertion-validator-impl/${project.version}</bundle>\n \n-    <feature name=\"security-certificate\"\n-             version=\"${project.version}\"\n-             description=\"Keystore editor MBean and associated web application.\">\n-        <bundle>mvn:org.codice.thirdparty/commons-httpclient/3.1.0_1</bundle>\n-        <feature>security-core-api</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>\n-            mvn:ddf.security.certificate/security-certificate-keystoreeditor/${project.version}\n-        </bundle>\n-        <bundle>mvn:ddf.security.certificate/security-certificate-generator/${project.version}\n-        </bundle>\n-        <bundle>mvn:ddf.security.certificate/security-crl-generator/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.certificate/security-ocsp-checker/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.realm/security-realm-saml/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.handler/security-handler-saml/${project.version}</bundle>\n     </feature>\n \n-    <feature name=\"security-servlet-logout\" version=\"${project.version}\"\n-             description=\"Logout servlet.\">\n-        <feature>guava</feature>\n-        <feature>cxf-frontend-javascript</feature>\n-        <feature>action-core-impl</feature>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <feature>javax-validation</feature>\n-        <feature>cxf-jaxrs</feature>\n-        <feature>security-handler-api</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-token-storage</feature>\n+    <feature name=\"ldap-auth\" version=\"${project.version}\"\n+             description=\"LDAP features and bundles.\">\n         <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.servlet/security-servlet-logout-service/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.servlet/security-servlet-default-logout/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.servlet/security-servlet-logout/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.servlet/security-servlet-logout-endpoint/${project.version}</bundle>\n-        <bundle>mvn:com.google.code.gson/gson/${gson.version}</bundle>\n-    </feature>\n \n-    <feature name=\"platform-email\" version=\"${project.version}\" start-level=\"50\">\n-        <bundle>mvn:commons-lang/commons-lang/${commons-lang.version}</bundle>\n-        <bundle>mvn:com.sun.mail/javax.mail/${javax-mail.version}</bundle>\n-        <feature>guava</feature>\n-        <bundle>mvn:ddf.platform.email/platform-email-api/${project.version}</bundle>\n-        <feature>security-logger</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.platform.email/platform-email-impl/${project.version}</bundle>\n-    </feature>\n+        <bundle>mvn:org.apache.commons/commons-pool2/2.5.0</bundle>\n+        <bundle>mvn:ddf.security.jaas/security-jaas-ldap/${project.version}</bundle>\n \n-    <feature name=\"platform-country-local\" version=\"${project.version}\"\n-             description=\"Service to convert country codes into various formats by performing a local lookup.\">\n-        <feature>guava</feature>\n-        <feature>security-core-api</feature>\n-        <bundle>mvn:ddf.platform.country/platform-country-converter-api/${project.version}</bundle>\n-        <bundle>mvn:ddf.platform.country/platform-country-converter-local/${project.version}\n-        </bundle>\n+        <configfile finalname=\"${ddf.etc}/ws-security/attributeMap.properties\">\n+            mvn:ddf.security.claims/security-claims-ldap/${project.version}/properties/attributeMap\n+        </configfile>\n+        <bundle>mvn:ddf.security.claims/security-claims-ldap/${project.version}</bundle>\n     </feature>\n \n-    <feature name=\"security-services-app\" version=\"${project.version}\"\n-             description=\"The Security Application provides Authentication, Authorization, and Auditing services.\\nThey comprise both a framework that developers and integrators can extend and also a reference implementation that can be used which meets security requirements.::Security\">\n-        <feature>security-core</feature>\n-        <feature>security-certificate</feature>\n-        <feature>security-servlet-logout</feature>\n+    <feature name=\"embedded-ldap\" version=\"${project.version}\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTIxNTkxMQ=="}, "originalCommit": {"oid": "5fe3c153d747edf954bc7be7ba8835a00d20f2da"}, "originalPosition": 907}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5OTk0NzU3OnYy", "diffSide": "RIGHT", "path": "features/apps/src/main/feature/feature.xml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQxOToxMDozOVrOGsaDjg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQyMToyMTo1M1rOGsdXdQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTIxNzQyMg==", "bodyText": "LDAP auth is currently not enabled by default. Is this change intentional?", "url": "https://github.com/codice/ddf/pull/6155#discussion_r449217422", "createdAt": "2020-07-02T19:10:39Z", "author": {"login": "SmithJosh"}, "path": "features/apps/src/main/feature/feature.xml", "diffHunk": "@@ -63,13 +62,17 @@\n     <feature name=\"ddf-boot-features\" version=\"${project.version}\"\n              description=\"Features that will be started on container startup.\">\n         <feature>ddf-core</feature>\n-        <feature>security-services-app</feature>\n+        <feature>security-core-services</feature>\n+        <feature>oidc-auth</feature>\n+        <feature>saml-auth</feature>\n+        <feature>ldap-auth</feature>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5fe3c153d747edf954bc7be7ba8835a00d20f2da"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTI3MTY2OQ==", "bodyText": "Good catch, made the change.", "url": "https://github.com/codice/ddf/pull/6155#discussion_r449271669", "createdAt": "2020-07-02T21:21:53Z", "author": {"login": "bakejeyner"}, "path": "features/apps/src/main/feature/feature.xml", "diffHunk": "@@ -63,13 +62,17 @@\n     <feature name=\"ddf-boot-features\" version=\"${project.version}\"\n              description=\"Features that will be started on container startup.\">\n         <feature>ddf-core</feature>\n-        <feature>security-services-app</feature>\n+        <feature>security-core-services</feature>\n+        <feature>oidc-auth</feature>\n+        <feature>saml-auth</feature>\n+        <feature>ldap-auth</feature>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTIxNzQyMg=="}, "originalCommit": {"oid": "5fe3c153d747edf954bc7be7ba8835a00d20f2da"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc5OTk3Mzc0OnYy", "diffSide": "RIGHT", "path": "features/security/src/main/feature/feature.xml", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQxOToxOTozNVrOGsaTcA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQyMzoyODowNVrOGsfmLA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTIyMTQ4OA==", "bodyText": "I see the email feature was previously part of the security features descriptor, but I'm curious why this is part of the security apis. It seems like the odd one out", "url": "https://github.com/codice/ddf/pull/6155#discussion_r449221488", "createdAt": "2020-07-02T19:19:35Z", "author": {"login": "SmithJosh"}, "path": "features/security/src/main/feature/feature.xml", "diffHunk": "@@ -21,694 +21,317 @@\n     <repository>mvn:ddf.features/kernel/${project.version}/xml/features</repository>\n     <repository>mvn:ddf.features/utilities/${project.version}/xml/features</repository>\n     <repository>mvn:ddf.features/branding/${project.version}/xml/features</repository>\n+    <repository>mvn:ddf.features/camel/${project.version}/xml/features</repository>\n \n-    <feature name=\"security-logger\" version=\"${project.version}\"\n-             description=\"Logs incoming and outgoing requests\">\n-        <feature>security-core-api</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.interceptor/security-interceptor-logger/${project.version}</bundle>\n-    </feature>\n+    <feature name=\"security-core-api-dependencies\" version=\"${project.version\"\n+             description=\"Dependencies for the core security APIs.\">\n+        <!-- Third Party Features -->\n+        <feature prerequisite=\"true\">wrap</feature>\n+        <feature>pax-http-whiteboard</feature>\n \n-    <feature name=\"security-core-api\" version=\"${project.version}\"\n-             description=\"Security Core\">\n-        <bundle start-level=\"30\">mvn:org.apache.neethi/neethi/${wss4j.neethi.version}</bundle>\n-        <feature>cxf-rt-security</feature>\n-        <feature>security-filter-api</feature>\n+        <!-- External DDF Features -->\n+        <feature>jackson</feature>\n+        <feature>wss4j</feature>\n+        <feature>cxf-ws-security</feature>\n         <feature>cxf-jaxrs</feature>\n-        <feature>platform-util</feature>\n-        <bundle dependency=\"true\">mvn:ddf.platform.security/log-sanitizer/${project.version}</bundle>\n-        <bundle dependency=\"true\">mvn:org.apache.commons/commons-configuration2/${commons-configuration2.version}</bundle>\n-        <bundle dependency=\"true\">mvn:org.apache.shiro/shiro-core/${apache.shiro.version}</bundle>\n-\n-        <feature>guava</feature>\n+        <feature>cxf-bindings-soap</feature>\n         <feature>common-system</feature>\n \n-        <bundle>mvn:joda-time/joda-time/${joda-time.version}</bundle>\n-        <bundle>mvn:org.apache.santuario/xmlsec/${xmlsec.version}</bundle>\n+        <!-- NimbusDS -->\n+        <bundle>wrap:mvn:com.nimbusds/nimbus-jose-jwt/${nimbus.version}</bundle>\n+        <bundle>wrap:mvn:com.nimbusds/oauth2-oidc-sdk/${nimbus.oidc.version}</bundle>\n+        <bundle>mvn:com.nimbusds/content-type/${nimbus.content-type.version}</bundle>\n+        <bundle>mvn:com.nimbusds/lang-tag/${nimbus.langtag.version}</bundle>\n \n-        <feature>cxf-bindings-soap</feature>\n-        <feature>cxf-ws-policy</feature>\n-        <feature>cxf-ws-security</feature>\n-        <feature>spring</feature>\n+        <!-- MiniDev -->\n+        <bundle>mvn:net.minidev/accessors-smart/1.2</bundle>\n+        <bundle>mvn:net.minidev/json-smart/2.3</bundle>\n \n-        <!--  TODO (https://github.com/codice/ddf/issues/5327)\n-                Remove wrapped OpenSAML after security refactor is complete  -->\n-        <!--  <bundle>mvn:org.apache.servicemix.bundles/org.apache.servicemix.bundles.opensaml/${opensaml.osgi.version}-->\n-        <!--  </bundle>-->\n-        <bundle>mvn:ddf.lib.bundles/libs-bundles-opensaml/${project.version}</bundle>\n+        <!-- Miscellaneous -->\n+        <bundle dependency=\"true\">mvn:org.apache.shiro/shiro-core/${apache.shiro.version}</bundle>\n+        <bundle>mvn:com.sun.mail/javax.mail/${javax-mail.version}</bundle>\n+        <!--\n+            net.minidev/accessors-smart/1.2 uses asm v5.x. Need this resolved before we can upgrade:\n+            https://bitbucket.org/connect2id/nimbus-jose-jwt/issues/239/switch-to-other-json-library\n+        -->\n+        <bundle>mvn:org.ow2.asm/asm/5.2</bundle>\n+        <bundle>wrap:mvn:com.github.stephenc.jcip/jcip-annotations/1.0-1</bundle>\n+    </feature>\n \n+    <feature name=\"security-core-api\" version=\"${project.version}\"\n+             description=\"Core security APIs.\">\n+        <feature>security-core-api-dependencies</feature>\n+\n+        <!-- Core -->\n         <bundle>mvn:ddf.security.core/security-core-api/${project.version}</bundle>\n+\n+        <!-- Country Converter -->\n+        <bundle>mvn:ddf.platform.country/platform-country-converter-api/${project.version}</bundle>\n+\n+        <!-- Rest Client -->\n         <bundle>mvn:ddf.platform.security/security-rest-clientapi/${project.version}</bundle>\n-        <bundle>\n-            mvn:org.apache.servicemix.bundles/org.apache.servicemix.bundles.jaxen/${org.apache.servicemix.bundles.jaxen.version}\n-        </bundle>\n-    </feature>\n \n-    <feature name=\"security-filter-api\" version=\"${project.version}\">\n-        <bundle>mvn:javax.servlet/javax.servlet-api/${javax.servlet-api-version}</bundle>\n+        <!-- Filters -->\n         <bundle>mvn:ddf.platform/security-filter-api/${project.version}</bundle>\n-    </feature>\n \n-    <feature name=\"platform-error-page-injector\" version=\"${project.version}\"\n-             description=\"Adding a better error page to Jetty\">\n-        <feature>error-api</feature>\n-        <bundle>mvn:ddf.platform.error/platform-error-page-injector/${project.version}</bundle>\n-    </feature>\n+        <!-- Handlers -->\n+        <bundle>mvn:ddf.security.handler/security-handler-api/${project.version}</bundle>\n \n-    <feature name=\"security-encryption\" version=\"${project.version}\"\n-             description=\"Security Encryption\">\n-        <feature>wss4j</feature>\n-        <bundle>mvn:org.apache.commons/commons-lang3/${commons-lang3.version}</bundle>\n+        <!-- Policy -->\n+        <bundle>mvn:ddf.security.policy/security-policy-api/${project.version}</bundle>\n+\n+        <!-- Encryption -->\n         <bundle>mvn:ddf.security.encryption/security-encryption-api/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.encryption/security-encryption-impl/${project.version}</bundle>\n-        <bundle dependency=\"true\">mvn:ddf.platform.security/log-sanitizer/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.encryption/security-encryption-commands/${project.version}</bundle>\n-    </feature>\n \n-    <feature name=\"web-container\" version=\"${project.version}\">\n-        <feature>platform-paxweb-jettyconfig</feature>\n-        <feature>platform-error-page-injector</feature>\n-        <feature>war</feature>\n-    </feature>\n+        <!-- Expansion -->\n+        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n \n-    <feature name=\"session-invalidator\" version=\"${project.version}\"\n-             description=\"API for invalidating servlet sessions\">\n-        <bundle>mvn:ddf.platform/platform-session-invalidator/${project.version}</bundle>\n-    </feature>\n+        <!-- Token Storage -->\n+        <bundle>mvn:ddf.security.storage/token-storage-api/${project.version}</bundle>\n \n-    <feature name=\"platform-paxweb-jettyconfig\" version=\"${project.version}\"\n-      description=\"Custom Session Manager\">\n-        <config name=\"org.ops4j.pax.web\" append=\"true\">\n-#######################################\n-# Jetty Server Authenticator Settings\n-#######################################\n+        <!-- Sessions -->\n+        <bundle>mvn:ddf.platform.security/session-management-api/${project.version}</bundle>\n+        <bundle>mvn:ddf.platform/platform-session-invalidator-api/${project.version}</bundle>\n \n-# Set the authmethod/realmname so that our JettyAuthenticator is used\n-org.ops4j.pax.web.default.authmethod=DDF\n-org.ops4j.pax.web.default.realmname=DDF\n-        </config>\n-        <feature version=\"${spring.version}_1\">spring</feature>\n-        <feature>apache-commons</feature>\n-        <feature>security-core-api</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-core-services</feature>\n-        <feature>security-filter-api</feature>\n-        <feature>pax-http-jetty</feature>\n-        <bundle start-level=\"30\">mvn:org.ops4j.pax.web/pax-web-jsp/${pax.web.version}</bundle>\n-        <bundle>mvn:javax.el/javax.el-api/3.0.0</bundle>\n-        <feature>pax-jetty</feature>\n-        <feature>session-invalidator</feature>\n-        <feature prerequisite=\"true\">wrap</feature>\n-        <bundle>wrap:mvn:net.jodah/failsafe/${jodah-failsafe.version}</bundle>\n-        <feature>guava</feature>\n-        <feature>common-system</feature>\n-        <bundle>mvn:ddf.platform/platform-paxweb-jettyconfig/${project.version}</bundle>\n-    </feature>\n+        <!-- Logout -->\n+        <bundle>mvn:ddf.security.servlet/security-servlet-logout-api/${project.version}</bundle>\n \n-    <feature name=\"security-handler-api\" version=\"${project.version}\"\n-             description=\"API for authentication handlers for web applications.\">\n-        <feature>security-core-api</feature>\n-        <feature>parser-xml</feature>\n-        <feature>oidc-dependencies</feature>\n-        <bundle>mvn:org.apache.cxf/cxf-rt-rs-security-jose/${cxf.version}</bundle>\n-        <bundle>mvn:org.apache.cxf/cxf-rt-rs-security-jose-jaxrs/${cxf.version}</bundle>\n-        <bundle>mvn:ddf.security.handler/security-handler-api/${project.version}</bundle>\n-    </feature>\n+        <!-- Email -->\n+        <bundle>mvn:ddf.platform.email/platform-email-api/${project.version}</bundle>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5fe3c153d747edf954bc7be7ba8835a00d20f2da"}, "originalPosition": 174}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTI5NzMyOQ==", "bodyText": "TLDR: Kinda figured it out in my follow up post. I'm keeping the email bundles in place or else it introduces a cyclical dependency.\nOman this blew up.\nI too thought it was weird that there were platform packages in here. They do depend on security packages, but I decided moved them over to the utilities feature file anyway.\nBut when I did that, the utilities feature itests they claimed they couldn't find the org.codice.ddf.platform.util package, even though I added the platform-util feature which exposes that package. No matter what I did, the email bundles just were not picking up that package.\nThe only way I could fix it was by including the big security-core-services feature. I have a feeling its because in platform-util's bundle manifest the org.codice.ddf.platform.util exported package \"uses\" a ton of other packages that security-core-services ends up pulling in.\nI couldn't find an easy way to determine those packages, so I'm just going to make the platform bundles depend on security-core-services. I have verified that we only pull in those platform bundles when we have already pulled in security-core-services anyway. I don't like it, but I also don't feel like doing an insane amount of trial and error or reading up on package resolution in karaf.", "url": "https://github.com/codice/ddf/pull/6155#discussion_r449297329", "createdAt": "2020-07-02T22:43:54Z", "author": {"login": "bakejeyner"}, "path": "features/security/src/main/feature/feature.xml", "diffHunk": "@@ -21,694 +21,317 @@\n     <repository>mvn:ddf.features/kernel/${project.version}/xml/features</repository>\n     <repository>mvn:ddf.features/utilities/${project.version}/xml/features</repository>\n     <repository>mvn:ddf.features/branding/${project.version}/xml/features</repository>\n+    <repository>mvn:ddf.features/camel/${project.version}/xml/features</repository>\n \n-    <feature name=\"security-logger\" version=\"${project.version}\"\n-             description=\"Logs incoming and outgoing requests\">\n-        <feature>security-core-api</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.interceptor/security-interceptor-logger/${project.version}</bundle>\n-    </feature>\n+    <feature name=\"security-core-api-dependencies\" version=\"${project.version\"\n+             description=\"Dependencies for the core security APIs.\">\n+        <!-- Third Party Features -->\n+        <feature prerequisite=\"true\">wrap</feature>\n+        <feature>pax-http-whiteboard</feature>\n \n-    <feature name=\"security-core-api\" version=\"${project.version}\"\n-             description=\"Security Core\">\n-        <bundle start-level=\"30\">mvn:org.apache.neethi/neethi/${wss4j.neethi.version}</bundle>\n-        <feature>cxf-rt-security</feature>\n-        <feature>security-filter-api</feature>\n+        <!-- External DDF Features -->\n+        <feature>jackson</feature>\n+        <feature>wss4j</feature>\n+        <feature>cxf-ws-security</feature>\n         <feature>cxf-jaxrs</feature>\n-        <feature>platform-util</feature>\n-        <bundle dependency=\"true\">mvn:ddf.platform.security/log-sanitizer/${project.version}</bundle>\n-        <bundle dependency=\"true\">mvn:org.apache.commons/commons-configuration2/${commons-configuration2.version}</bundle>\n-        <bundle dependency=\"true\">mvn:org.apache.shiro/shiro-core/${apache.shiro.version}</bundle>\n-\n-        <feature>guava</feature>\n+        <feature>cxf-bindings-soap</feature>\n         <feature>common-system</feature>\n \n-        <bundle>mvn:joda-time/joda-time/${joda-time.version}</bundle>\n-        <bundle>mvn:org.apache.santuario/xmlsec/${xmlsec.version}</bundle>\n+        <!-- NimbusDS -->\n+        <bundle>wrap:mvn:com.nimbusds/nimbus-jose-jwt/${nimbus.version}</bundle>\n+        <bundle>wrap:mvn:com.nimbusds/oauth2-oidc-sdk/${nimbus.oidc.version}</bundle>\n+        <bundle>mvn:com.nimbusds/content-type/${nimbus.content-type.version}</bundle>\n+        <bundle>mvn:com.nimbusds/lang-tag/${nimbus.langtag.version}</bundle>\n \n-        <feature>cxf-bindings-soap</feature>\n-        <feature>cxf-ws-policy</feature>\n-        <feature>cxf-ws-security</feature>\n-        <feature>spring</feature>\n+        <!-- MiniDev -->\n+        <bundle>mvn:net.minidev/accessors-smart/1.2</bundle>\n+        <bundle>mvn:net.minidev/json-smart/2.3</bundle>\n \n-        <!--  TODO (https://github.com/codice/ddf/issues/5327)\n-                Remove wrapped OpenSAML after security refactor is complete  -->\n-        <!--  <bundle>mvn:org.apache.servicemix.bundles/org.apache.servicemix.bundles.opensaml/${opensaml.osgi.version}-->\n-        <!--  </bundle>-->\n-        <bundle>mvn:ddf.lib.bundles/libs-bundles-opensaml/${project.version}</bundle>\n+        <!-- Miscellaneous -->\n+        <bundle dependency=\"true\">mvn:org.apache.shiro/shiro-core/${apache.shiro.version}</bundle>\n+        <bundle>mvn:com.sun.mail/javax.mail/${javax-mail.version}</bundle>\n+        <!--\n+            net.minidev/accessors-smart/1.2 uses asm v5.x. Need this resolved before we can upgrade:\n+            https://bitbucket.org/connect2id/nimbus-jose-jwt/issues/239/switch-to-other-json-library\n+        -->\n+        <bundle>mvn:org.ow2.asm/asm/5.2</bundle>\n+        <bundle>wrap:mvn:com.github.stephenc.jcip/jcip-annotations/1.0-1</bundle>\n+    </feature>\n \n+    <feature name=\"security-core-api\" version=\"${project.version}\"\n+             description=\"Core security APIs.\">\n+        <feature>security-core-api-dependencies</feature>\n+\n+        <!-- Core -->\n         <bundle>mvn:ddf.security.core/security-core-api/${project.version}</bundle>\n+\n+        <!-- Country Converter -->\n+        <bundle>mvn:ddf.platform.country/platform-country-converter-api/${project.version}</bundle>\n+\n+        <!-- Rest Client -->\n         <bundle>mvn:ddf.platform.security/security-rest-clientapi/${project.version}</bundle>\n-        <bundle>\n-            mvn:org.apache.servicemix.bundles/org.apache.servicemix.bundles.jaxen/${org.apache.servicemix.bundles.jaxen.version}\n-        </bundle>\n-    </feature>\n \n-    <feature name=\"security-filter-api\" version=\"${project.version}\">\n-        <bundle>mvn:javax.servlet/javax.servlet-api/${javax.servlet-api-version}</bundle>\n+        <!-- Filters -->\n         <bundle>mvn:ddf.platform/security-filter-api/${project.version}</bundle>\n-    </feature>\n \n-    <feature name=\"platform-error-page-injector\" version=\"${project.version}\"\n-             description=\"Adding a better error page to Jetty\">\n-        <feature>error-api</feature>\n-        <bundle>mvn:ddf.platform.error/platform-error-page-injector/${project.version}</bundle>\n-    </feature>\n+        <!-- Handlers -->\n+        <bundle>mvn:ddf.security.handler/security-handler-api/${project.version}</bundle>\n \n-    <feature name=\"security-encryption\" version=\"${project.version}\"\n-             description=\"Security Encryption\">\n-        <feature>wss4j</feature>\n-        <bundle>mvn:org.apache.commons/commons-lang3/${commons-lang3.version}</bundle>\n+        <!-- Policy -->\n+        <bundle>mvn:ddf.security.policy/security-policy-api/${project.version}</bundle>\n+\n+        <!-- Encryption -->\n         <bundle>mvn:ddf.security.encryption/security-encryption-api/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.encryption/security-encryption-impl/${project.version}</bundle>\n-        <bundle dependency=\"true\">mvn:ddf.platform.security/log-sanitizer/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.encryption/security-encryption-commands/${project.version}</bundle>\n-    </feature>\n \n-    <feature name=\"web-container\" version=\"${project.version}\">\n-        <feature>platform-paxweb-jettyconfig</feature>\n-        <feature>platform-error-page-injector</feature>\n-        <feature>war</feature>\n-    </feature>\n+        <!-- Expansion -->\n+        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n \n-    <feature name=\"session-invalidator\" version=\"${project.version}\"\n-             description=\"API for invalidating servlet sessions\">\n-        <bundle>mvn:ddf.platform/platform-session-invalidator/${project.version}</bundle>\n-    </feature>\n+        <!-- Token Storage -->\n+        <bundle>mvn:ddf.security.storage/token-storage-api/${project.version}</bundle>\n \n-    <feature name=\"platform-paxweb-jettyconfig\" version=\"${project.version}\"\n-      description=\"Custom Session Manager\">\n-        <config name=\"org.ops4j.pax.web\" append=\"true\">\n-#######################################\n-# Jetty Server Authenticator Settings\n-#######################################\n+        <!-- Sessions -->\n+        <bundle>mvn:ddf.platform.security/session-management-api/${project.version}</bundle>\n+        <bundle>mvn:ddf.platform/platform-session-invalidator-api/${project.version}</bundle>\n \n-# Set the authmethod/realmname so that our JettyAuthenticator is used\n-org.ops4j.pax.web.default.authmethod=DDF\n-org.ops4j.pax.web.default.realmname=DDF\n-        </config>\n-        <feature version=\"${spring.version}_1\">spring</feature>\n-        <feature>apache-commons</feature>\n-        <feature>security-core-api</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-core-services</feature>\n-        <feature>security-filter-api</feature>\n-        <feature>pax-http-jetty</feature>\n-        <bundle start-level=\"30\">mvn:org.ops4j.pax.web/pax-web-jsp/${pax.web.version}</bundle>\n-        <bundle>mvn:javax.el/javax.el-api/3.0.0</bundle>\n-        <feature>pax-jetty</feature>\n-        <feature>session-invalidator</feature>\n-        <feature prerequisite=\"true\">wrap</feature>\n-        <bundle>wrap:mvn:net.jodah/failsafe/${jodah-failsafe.version}</bundle>\n-        <feature>guava</feature>\n-        <feature>common-system</feature>\n-        <bundle>mvn:ddf.platform/platform-paxweb-jettyconfig/${project.version}</bundle>\n-    </feature>\n+        <!-- Logout -->\n+        <bundle>mvn:ddf.security.servlet/security-servlet-logout-api/${project.version}</bundle>\n \n-    <feature name=\"security-handler-api\" version=\"${project.version}\"\n-             description=\"API for authentication handlers for web applications.\">\n-        <feature>security-core-api</feature>\n-        <feature>parser-xml</feature>\n-        <feature>oidc-dependencies</feature>\n-        <bundle>mvn:org.apache.cxf/cxf-rt-rs-security-jose/${cxf.version}</bundle>\n-        <bundle>mvn:org.apache.cxf/cxf-rt-rs-security-jose-jaxrs/${cxf.version}</bundle>\n-        <bundle>mvn:ddf.security.handler/security-handler-api/${project.version}</bundle>\n-    </feature>\n+        <!-- Email -->\n+        <bundle>mvn:ddf.platform.email/platform-email-api/${project.version}</bundle>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTIyMTQ4OA=="}, "originalCommit": {"oid": "5fe3c153d747edf954bc7be7ba8835a00d20f2da"}, "originalPosition": 174}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTMwMjc1NA==", "bodyText": "Huh, that is weird that it couldn't find org.codice.ddf.platform.util with that feature installed. platform-email-impl pulls in the security logger service, though, so it does depend on security-core-services", "url": "https://github.com/codice/ddf/pull/6155#discussion_r449302754", "createdAt": "2020-07-02T23:05:05Z", "author": {"login": "SmithJosh"}, "path": "features/security/src/main/feature/feature.xml", "diffHunk": "@@ -21,694 +21,317 @@\n     <repository>mvn:ddf.features/kernel/${project.version}/xml/features</repository>\n     <repository>mvn:ddf.features/utilities/${project.version}/xml/features</repository>\n     <repository>mvn:ddf.features/branding/${project.version}/xml/features</repository>\n+    <repository>mvn:ddf.features/camel/${project.version}/xml/features</repository>\n \n-    <feature name=\"security-logger\" version=\"${project.version}\"\n-             description=\"Logs incoming and outgoing requests\">\n-        <feature>security-core-api</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.interceptor/security-interceptor-logger/${project.version}</bundle>\n-    </feature>\n+    <feature name=\"security-core-api-dependencies\" version=\"${project.version\"\n+             description=\"Dependencies for the core security APIs.\">\n+        <!-- Third Party Features -->\n+        <feature prerequisite=\"true\">wrap</feature>\n+        <feature>pax-http-whiteboard</feature>\n \n-    <feature name=\"security-core-api\" version=\"${project.version}\"\n-             description=\"Security Core\">\n-        <bundle start-level=\"30\">mvn:org.apache.neethi/neethi/${wss4j.neethi.version}</bundle>\n-        <feature>cxf-rt-security</feature>\n-        <feature>security-filter-api</feature>\n+        <!-- External DDF Features -->\n+        <feature>jackson</feature>\n+        <feature>wss4j</feature>\n+        <feature>cxf-ws-security</feature>\n         <feature>cxf-jaxrs</feature>\n-        <feature>platform-util</feature>\n-        <bundle dependency=\"true\">mvn:ddf.platform.security/log-sanitizer/${project.version}</bundle>\n-        <bundle dependency=\"true\">mvn:org.apache.commons/commons-configuration2/${commons-configuration2.version}</bundle>\n-        <bundle dependency=\"true\">mvn:org.apache.shiro/shiro-core/${apache.shiro.version}</bundle>\n-\n-        <feature>guava</feature>\n+        <feature>cxf-bindings-soap</feature>\n         <feature>common-system</feature>\n \n-        <bundle>mvn:joda-time/joda-time/${joda-time.version}</bundle>\n-        <bundle>mvn:org.apache.santuario/xmlsec/${xmlsec.version}</bundle>\n+        <!-- NimbusDS -->\n+        <bundle>wrap:mvn:com.nimbusds/nimbus-jose-jwt/${nimbus.version}</bundle>\n+        <bundle>wrap:mvn:com.nimbusds/oauth2-oidc-sdk/${nimbus.oidc.version}</bundle>\n+        <bundle>mvn:com.nimbusds/content-type/${nimbus.content-type.version}</bundle>\n+        <bundle>mvn:com.nimbusds/lang-tag/${nimbus.langtag.version}</bundle>\n \n-        <feature>cxf-bindings-soap</feature>\n-        <feature>cxf-ws-policy</feature>\n-        <feature>cxf-ws-security</feature>\n-        <feature>spring</feature>\n+        <!-- MiniDev -->\n+        <bundle>mvn:net.minidev/accessors-smart/1.2</bundle>\n+        <bundle>mvn:net.minidev/json-smart/2.3</bundle>\n \n-        <!--  TODO (https://github.com/codice/ddf/issues/5327)\n-                Remove wrapped OpenSAML after security refactor is complete  -->\n-        <!--  <bundle>mvn:org.apache.servicemix.bundles/org.apache.servicemix.bundles.opensaml/${opensaml.osgi.version}-->\n-        <!--  </bundle>-->\n-        <bundle>mvn:ddf.lib.bundles/libs-bundles-opensaml/${project.version}</bundle>\n+        <!-- Miscellaneous -->\n+        <bundle dependency=\"true\">mvn:org.apache.shiro/shiro-core/${apache.shiro.version}</bundle>\n+        <bundle>mvn:com.sun.mail/javax.mail/${javax-mail.version}</bundle>\n+        <!--\n+            net.minidev/accessors-smart/1.2 uses asm v5.x. Need this resolved before we can upgrade:\n+            https://bitbucket.org/connect2id/nimbus-jose-jwt/issues/239/switch-to-other-json-library\n+        -->\n+        <bundle>mvn:org.ow2.asm/asm/5.2</bundle>\n+        <bundle>wrap:mvn:com.github.stephenc.jcip/jcip-annotations/1.0-1</bundle>\n+    </feature>\n \n+    <feature name=\"security-core-api\" version=\"${project.version}\"\n+             description=\"Core security APIs.\">\n+        <feature>security-core-api-dependencies</feature>\n+\n+        <!-- Core -->\n         <bundle>mvn:ddf.security.core/security-core-api/${project.version}</bundle>\n+\n+        <!-- Country Converter -->\n+        <bundle>mvn:ddf.platform.country/platform-country-converter-api/${project.version}</bundle>\n+\n+        <!-- Rest Client -->\n         <bundle>mvn:ddf.platform.security/security-rest-clientapi/${project.version}</bundle>\n-        <bundle>\n-            mvn:org.apache.servicemix.bundles/org.apache.servicemix.bundles.jaxen/${org.apache.servicemix.bundles.jaxen.version}\n-        </bundle>\n-    </feature>\n \n-    <feature name=\"security-filter-api\" version=\"${project.version}\">\n-        <bundle>mvn:javax.servlet/javax.servlet-api/${javax.servlet-api-version}</bundle>\n+        <!-- Filters -->\n         <bundle>mvn:ddf.platform/security-filter-api/${project.version}</bundle>\n-    </feature>\n \n-    <feature name=\"platform-error-page-injector\" version=\"${project.version}\"\n-             description=\"Adding a better error page to Jetty\">\n-        <feature>error-api</feature>\n-        <bundle>mvn:ddf.platform.error/platform-error-page-injector/${project.version}</bundle>\n-    </feature>\n+        <!-- Handlers -->\n+        <bundle>mvn:ddf.security.handler/security-handler-api/${project.version}</bundle>\n \n-    <feature name=\"security-encryption\" version=\"${project.version}\"\n-             description=\"Security Encryption\">\n-        <feature>wss4j</feature>\n-        <bundle>mvn:org.apache.commons/commons-lang3/${commons-lang3.version}</bundle>\n+        <!-- Policy -->\n+        <bundle>mvn:ddf.security.policy/security-policy-api/${project.version}</bundle>\n+\n+        <!-- Encryption -->\n         <bundle>mvn:ddf.security.encryption/security-encryption-api/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.encryption/security-encryption-impl/${project.version}</bundle>\n-        <bundle dependency=\"true\">mvn:ddf.platform.security/log-sanitizer/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.encryption/security-encryption-commands/${project.version}</bundle>\n-    </feature>\n \n-    <feature name=\"web-container\" version=\"${project.version}\">\n-        <feature>platform-paxweb-jettyconfig</feature>\n-        <feature>platform-error-page-injector</feature>\n-        <feature>war</feature>\n-    </feature>\n+        <!-- Expansion -->\n+        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n \n-    <feature name=\"session-invalidator\" version=\"${project.version}\"\n-             description=\"API for invalidating servlet sessions\">\n-        <bundle>mvn:ddf.platform/platform-session-invalidator/${project.version}</bundle>\n-    </feature>\n+        <!-- Token Storage -->\n+        <bundle>mvn:ddf.security.storage/token-storage-api/${project.version}</bundle>\n \n-    <feature name=\"platform-paxweb-jettyconfig\" version=\"${project.version}\"\n-      description=\"Custom Session Manager\">\n-        <config name=\"org.ops4j.pax.web\" append=\"true\">\n-#######################################\n-# Jetty Server Authenticator Settings\n-#######################################\n+        <!-- Sessions -->\n+        <bundle>mvn:ddf.platform.security/session-management-api/${project.version}</bundle>\n+        <bundle>mvn:ddf.platform/platform-session-invalidator-api/${project.version}</bundle>\n \n-# Set the authmethod/realmname so that our JettyAuthenticator is used\n-org.ops4j.pax.web.default.authmethod=DDF\n-org.ops4j.pax.web.default.realmname=DDF\n-        </config>\n-        <feature version=\"${spring.version}_1\">spring</feature>\n-        <feature>apache-commons</feature>\n-        <feature>security-core-api</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-core-services</feature>\n-        <feature>security-filter-api</feature>\n-        <feature>pax-http-jetty</feature>\n-        <bundle start-level=\"30\">mvn:org.ops4j.pax.web/pax-web-jsp/${pax.web.version}</bundle>\n-        <bundle>mvn:javax.el/javax.el-api/3.0.0</bundle>\n-        <feature>pax-jetty</feature>\n-        <feature>session-invalidator</feature>\n-        <feature prerequisite=\"true\">wrap</feature>\n-        <bundle>wrap:mvn:net.jodah/failsafe/${jodah-failsafe.version}</bundle>\n-        <feature>guava</feature>\n-        <feature>common-system</feature>\n-        <bundle>mvn:ddf.platform/platform-paxweb-jettyconfig/${project.version}</bundle>\n-    </feature>\n+        <!-- Logout -->\n+        <bundle>mvn:ddf.security.servlet/security-servlet-logout-api/${project.version}</bundle>\n \n-    <feature name=\"security-handler-api\" version=\"${project.version}\"\n-             description=\"API for authentication handlers for web applications.\">\n-        <feature>security-core-api</feature>\n-        <feature>parser-xml</feature>\n-        <feature>oidc-dependencies</feature>\n-        <bundle>mvn:org.apache.cxf/cxf-rt-rs-security-jose/${cxf.version}</bundle>\n-        <bundle>mvn:org.apache.cxf/cxf-rt-rs-security-jose-jaxrs/${cxf.version}</bundle>\n-        <bundle>mvn:ddf.security.handler/security-handler-api/${project.version}</bundle>\n-    </feature>\n+        <!-- Email -->\n+        <bundle>mvn:ddf.platform.email/platform-email-api/${project.version}</bundle>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTIyMTQ4OA=="}, "originalCommit": {"oid": "5fe3c153d747edf954bc7be7ba8835a00d20f2da"}, "originalPosition": 174}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTMwODIwNA==", "bodyText": "Oh I think I know what the issue could have been.\nI forgot to add the security feature file dependency to the utilitlies feature pom. When I did, maven noted a cyclical dependency. Both having a cyclical dependency and not including the security feature file as a dependency could have caused the weird behavior I observed.\nTLDR: I'm keeping the email bundles in place or else it introduces a cyclical dependency.", "url": "https://github.com/codice/ddf/pull/6155#discussion_r449308204", "createdAt": "2020-07-02T23:28:05Z", "author": {"login": "bakejeyner"}, "path": "features/security/src/main/feature/feature.xml", "diffHunk": "@@ -21,694 +21,317 @@\n     <repository>mvn:ddf.features/kernel/${project.version}/xml/features</repository>\n     <repository>mvn:ddf.features/utilities/${project.version}/xml/features</repository>\n     <repository>mvn:ddf.features/branding/${project.version}/xml/features</repository>\n+    <repository>mvn:ddf.features/camel/${project.version}/xml/features</repository>\n \n-    <feature name=\"security-logger\" version=\"${project.version}\"\n-             description=\"Logs incoming and outgoing requests\">\n-        <feature>security-core-api</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.interceptor/security-interceptor-logger/${project.version}</bundle>\n-    </feature>\n+    <feature name=\"security-core-api-dependencies\" version=\"${project.version\"\n+             description=\"Dependencies for the core security APIs.\">\n+        <!-- Third Party Features -->\n+        <feature prerequisite=\"true\">wrap</feature>\n+        <feature>pax-http-whiteboard</feature>\n \n-    <feature name=\"security-core-api\" version=\"${project.version}\"\n-             description=\"Security Core\">\n-        <bundle start-level=\"30\">mvn:org.apache.neethi/neethi/${wss4j.neethi.version}</bundle>\n-        <feature>cxf-rt-security</feature>\n-        <feature>security-filter-api</feature>\n+        <!-- External DDF Features -->\n+        <feature>jackson</feature>\n+        <feature>wss4j</feature>\n+        <feature>cxf-ws-security</feature>\n         <feature>cxf-jaxrs</feature>\n-        <feature>platform-util</feature>\n-        <bundle dependency=\"true\">mvn:ddf.platform.security/log-sanitizer/${project.version}</bundle>\n-        <bundle dependency=\"true\">mvn:org.apache.commons/commons-configuration2/${commons-configuration2.version}</bundle>\n-        <bundle dependency=\"true\">mvn:org.apache.shiro/shiro-core/${apache.shiro.version}</bundle>\n-\n-        <feature>guava</feature>\n+        <feature>cxf-bindings-soap</feature>\n         <feature>common-system</feature>\n \n-        <bundle>mvn:joda-time/joda-time/${joda-time.version}</bundle>\n-        <bundle>mvn:org.apache.santuario/xmlsec/${xmlsec.version}</bundle>\n+        <!-- NimbusDS -->\n+        <bundle>wrap:mvn:com.nimbusds/nimbus-jose-jwt/${nimbus.version}</bundle>\n+        <bundle>wrap:mvn:com.nimbusds/oauth2-oidc-sdk/${nimbus.oidc.version}</bundle>\n+        <bundle>mvn:com.nimbusds/content-type/${nimbus.content-type.version}</bundle>\n+        <bundle>mvn:com.nimbusds/lang-tag/${nimbus.langtag.version}</bundle>\n \n-        <feature>cxf-bindings-soap</feature>\n-        <feature>cxf-ws-policy</feature>\n-        <feature>cxf-ws-security</feature>\n-        <feature>spring</feature>\n+        <!-- MiniDev -->\n+        <bundle>mvn:net.minidev/accessors-smart/1.2</bundle>\n+        <bundle>mvn:net.minidev/json-smart/2.3</bundle>\n \n-        <!--  TODO (https://github.com/codice/ddf/issues/5327)\n-                Remove wrapped OpenSAML after security refactor is complete  -->\n-        <!--  <bundle>mvn:org.apache.servicemix.bundles/org.apache.servicemix.bundles.opensaml/${opensaml.osgi.version}-->\n-        <!--  </bundle>-->\n-        <bundle>mvn:ddf.lib.bundles/libs-bundles-opensaml/${project.version}</bundle>\n+        <!-- Miscellaneous -->\n+        <bundle dependency=\"true\">mvn:org.apache.shiro/shiro-core/${apache.shiro.version}</bundle>\n+        <bundle>mvn:com.sun.mail/javax.mail/${javax-mail.version}</bundle>\n+        <!--\n+            net.minidev/accessors-smart/1.2 uses asm v5.x. Need this resolved before we can upgrade:\n+            https://bitbucket.org/connect2id/nimbus-jose-jwt/issues/239/switch-to-other-json-library\n+        -->\n+        <bundle>mvn:org.ow2.asm/asm/5.2</bundle>\n+        <bundle>wrap:mvn:com.github.stephenc.jcip/jcip-annotations/1.0-1</bundle>\n+    </feature>\n \n+    <feature name=\"security-core-api\" version=\"${project.version}\"\n+             description=\"Core security APIs.\">\n+        <feature>security-core-api-dependencies</feature>\n+\n+        <!-- Core -->\n         <bundle>mvn:ddf.security.core/security-core-api/${project.version}</bundle>\n+\n+        <!-- Country Converter -->\n+        <bundle>mvn:ddf.platform.country/platform-country-converter-api/${project.version}</bundle>\n+\n+        <!-- Rest Client -->\n         <bundle>mvn:ddf.platform.security/security-rest-clientapi/${project.version}</bundle>\n-        <bundle>\n-            mvn:org.apache.servicemix.bundles/org.apache.servicemix.bundles.jaxen/${org.apache.servicemix.bundles.jaxen.version}\n-        </bundle>\n-    </feature>\n \n-    <feature name=\"security-filter-api\" version=\"${project.version}\">\n-        <bundle>mvn:javax.servlet/javax.servlet-api/${javax.servlet-api-version}</bundle>\n+        <!-- Filters -->\n         <bundle>mvn:ddf.platform/security-filter-api/${project.version}</bundle>\n-    </feature>\n \n-    <feature name=\"platform-error-page-injector\" version=\"${project.version}\"\n-             description=\"Adding a better error page to Jetty\">\n-        <feature>error-api</feature>\n-        <bundle>mvn:ddf.platform.error/platform-error-page-injector/${project.version}</bundle>\n-    </feature>\n+        <!-- Handlers -->\n+        <bundle>mvn:ddf.security.handler/security-handler-api/${project.version}</bundle>\n \n-    <feature name=\"security-encryption\" version=\"${project.version}\"\n-             description=\"Security Encryption\">\n-        <feature>wss4j</feature>\n-        <bundle>mvn:org.apache.commons/commons-lang3/${commons-lang3.version}</bundle>\n+        <!-- Policy -->\n+        <bundle>mvn:ddf.security.policy/security-policy-api/${project.version}</bundle>\n+\n+        <!-- Encryption -->\n         <bundle>mvn:ddf.security.encryption/security-encryption-api/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.encryption/security-encryption-impl/${project.version}</bundle>\n-        <bundle dependency=\"true\">mvn:ddf.platform.security/log-sanitizer/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.encryption/security-encryption-commands/${project.version}</bundle>\n-    </feature>\n \n-    <feature name=\"web-container\" version=\"${project.version}\">\n-        <feature>platform-paxweb-jettyconfig</feature>\n-        <feature>platform-error-page-injector</feature>\n-        <feature>war</feature>\n-    </feature>\n+        <!-- Expansion -->\n+        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n \n-    <feature name=\"session-invalidator\" version=\"${project.version}\"\n-             description=\"API for invalidating servlet sessions\">\n-        <bundle>mvn:ddf.platform/platform-session-invalidator/${project.version}</bundle>\n-    </feature>\n+        <!-- Token Storage -->\n+        <bundle>mvn:ddf.security.storage/token-storage-api/${project.version}</bundle>\n \n-    <feature name=\"platform-paxweb-jettyconfig\" version=\"${project.version}\"\n-      description=\"Custom Session Manager\">\n-        <config name=\"org.ops4j.pax.web\" append=\"true\">\n-#######################################\n-# Jetty Server Authenticator Settings\n-#######################################\n+        <!-- Sessions -->\n+        <bundle>mvn:ddf.platform.security/session-management-api/${project.version}</bundle>\n+        <bundle>mvn:ddf.platform/platform-session-invalidator-api/${project.version}</bundle>\n \n-# Set the authmethod/realmname so that our JettyAuthenticator is used\n-org.ops4j.pax.web.default.authmethod=DDF\n-org.ops4j.pax.web.default.realmname=DDF\n-        </config>\n-        <feature version=\"${spring.version}_1\">spring</feature>\n-        <feature>apache-commons</feature>\n-        <feature>security-core-api</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-core-services</feature>\n-        <feature>security-filter-api</feature>\n-        <feature>pax-http-jetty</feature>\n-        <bundle start-level=\"30\">mvn:org.ops4j.pax.web/pax-web-jsp/${pax.web.version}</bundle>\n-        <bundle>mvn:javax.el/javax.el-api/3.0.0</bundle>\n-        <feature>pax-jetty</feature>\n-        <feature>session-invalidator</feature>\n-        <feature prerequisite=\"true\">wrap</feature>\n-        <bundle>wrap:mvn:net.jodah/failsafe/${jodah-failsafe.version}</bundle>\n-        <feature>guava</feature>\n-        <feature>common-system</feature>\n-        <bundle>mvn:ddf.platform/platform-paxweb-jettyconfig/${project.version}</bundle>\n-    </feature>\n+        <!-- Logout -->\n+        <bundle>mvn:ddf.security.servlet/security-servlet-logout-api/${project.version}</bundle>\n \n-    <feature name=\"security-handler-api\" version=\"${project.version}\"\n-             description=\"API for authentication handlers for web applications.\">\n-        <feature>security-core-api</feature>\n-        <feature>parser-xml</feature>\n-        <feature>oidc-dependencies</feature>\n-        <bundle>mvn:org.apache.cxf/cxf-rt-rs-security-jose/${cxf.version}</bundle>\n-        <bundle>mvn:org.apache.cxf/cxf-rt-rs-security-jose-jaxrs/${cxf.version}</bundle>\n-        <bundle>mvn:ddf.security.handler/security-handler-api/${project.version}</bundle>\n-    </feature>\n+        <!-- Email -->\n+        <bundle>mvn:ddf.platform.email/platform-email-api/${project.version}</bundle>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTIyMTQ4OA=="}, "originalCommit": {"oid": "5fe3c153d747edf954bc7be7ba8835a00d20f2da"}, "originalPosition": 174}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwMDA4NDA5OnYy", "diffSide": "RIGHT", "path": "features/security/src/main/feature/feature.xml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQyMDowMDoyMFrOGsbXJg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQyMToxNjowM1rOGsdO4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTIzODgyMg==", "bodyText": "\u2753 This issue is shown as closed in github. Should it be re-opened?", "url": "https://github.com/codice/ddf/pull/6155#discussion_r449238822", "createdAt": "2020-07-02T20:00:20Z", "author": {"login": "blen-desta"}, "path": "features/security/src/main/feature/feature.xml", "diffHunk": "@@ -21,694 +21,317 @@\n     <repository>mvn:ddf.features/kernel/${project.version}/xml/features</repository>\n     <repository>mvn:ddf.features/utilities/${project.version}/xml/features</repository>\n     <repository>mvn:ddf.features/branding/${project.version}/xml/features</repository>\n+    <repository>mvn:ddf.features/camel/${project.version}/xml/features</repository>\n \n-    <feature name=\"security-logger\" version=\"${project.version}\"\n-             description=\"Logs incoming and outgoing requests\">\n-        <feature>security-core-api</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.interceptor/security-interceptor-logger/${project.version}</bundle>\n-    </feature>\n+    <feature name=\"security-core-api-dependencies\" version=\"${project.version\"\n+             description=\"Dependencies for the core security APIs.\">\n+        <!-- Third Party Features -->\n+        <feature prerequisite=\"true\">wrap</feature>\n+        <feature>pax-http-whiteboard</feature>\n \n-    <feature name=\"security-core-api\" version=\"${project.version}\"\n-             description=\"Security Core\">\n-        <bundle start-level=\"30\">mvn:org.apache.neethi/neethi/${wss4j.neethi.version}</bundle>\n-        <feature>cxf-rt-security</feature>\n-        <feature>security-filter-api</feature>\n+        <!-- External DDF Features -->\n+        <feature>jackson</feature>\n+        <feature>wss4j</feature>\n+        <feature>cxf-ws-security</feature>\n         <feature>cxf-jaxrs</feature>\n-        <feature>platform-util</feature>\n-        <bundle dependency=\"true\">mvn:ddf.platform.security/log-sanitizer/${project.version}</bundle>\n-        <bundle dependency=\"true\">mvn:org.apache.commons/commons-configuration2/${commons-configuration2.version}</bundle>\n-        <bundle dependency=\"true\">mvn:org.apache.shiro/shiro-core/${apache.shiro.version}</bundle>\n-\n-        <feature>guava</feature>\n+        <feature>cxf-bindings-soap</feature>\n         <feature>common-system</feature>\n \n-        <bundle>mvn:joda-time/joda-time/${joda-time.version}</bundle>\n-        <bundle>mvn:org.apache.santuario/xmlsec/${xmlsec.version}</bundle>\n+        <!-- NimbusDS -->\n+        <bundle>wrap:mvn:com.nimbusds/nimbus-jose-jwt/${nimbus.version}</bundle>\n+        <bundle>wrap:mvn:com.nimbusds/oauth2-oidc-sdk/${nimbus.oidc.version}</bundle>\n+        <bundle>mvn:com.nimbusds/content-type/${nimbus.content-type.version}</bundle>\n+        <bundle>mvn:com.nimbusds/lang-tag/${nimbus.langtag.version}</bundle>\n \n-        <feature>cxf-bindings-soap</feature>\n-        <feature>cxf-ws-policy</feature>\n-        <feature>cxf-ws-security</feature>\n-        <feature>spring</feature>\n+        <!-- MiniDev -->\n+        <bundle>mvn:net.minidev/accessors-smart/1.2</bundle>\n+        <bundle>mvn:net.minidev/json-smart/2.3</bundle>\n \n-        <!--  TODO (https://github.com/codice/ddf/issues/5327)\n-                Remove wrapped OpenSAML after security refactor is complete  -->\n-        <!--  <bundle>mvn:org.apache.servicemix.bundles/org.apache.servicemix.bundles.opensaml/${opensaml.osgi.version}-->\n-        <!--  </bundle>-->\n-        <bundle>mvn:ddf.lib.bundles/libs-bundles-opensaml/${project.version}</bundle>\n+        <!-- Miscellaneous -->\n+        <bundle dependency=\"true\">mvn:org.apache.shiro/shiro-core/${apache.shiro.version}</bundle>\n+        <bundle>mvn:com.sun.mail/javax.mail/${javax-mail.version}</bundle>\n+        <!--\n+            net.minidev/accessors-smart/1.2 uses asm v5.x. Need this resolved before we can upgrade:\n+            https://bitbucket.org/connect2id/nimbus-jose-jwt/issues/239/switch-to-other-json-library\n+        -->\n+        <bundle>mvn:org.ow2.asm/asm/5.2</bundle>\n+        <bundle>wrap:mvn:com.github.stephenc.jcip/jcip-annotations/1.0-1</bundle>\n+    </feature>\n \n+    <feature name=\"security-core-api\" version=\"${project.version}\"\n+             description=\"Core security APIs.\">\n+        <feature>security-core-api-dependencies</feature>\n+\n+        <!-- Core -->\n         <bundle>mvn:ddf.security.core/security-core-api/${project.version}</bundle>\n+\n+        <!-- Country Converter -->\n+        <bundle>mvn:ddf.platform.country/platform-country-converter-api/${project.version}</bundle>\n+\n+        <!-- Rest Client -->\n         <bundle>mvn:ddf.platform.security/security-rest-clientapi/${project.version}</bundle>\n-        <bundle>\n-            mvn:org.apache.servicemix.bundles/org.apache.servicemix.bundles.jaxen/${org.apache.servicemix.bundles.jaxen.version}\n-        </bundle>\n-    </feature>\n \n-    <feature name=\"security-filter-api\" version=\"${project.version}\">\n-        <bundle>mvn:javax.servlet/javax.servlet-api/${javax.servlet-api-version}</bundle>\n+        <!-- Filters -->\n         <bundle>mvn:ddf.platform/security-filter-api/${project.version}</bundle>\n-    </feature>\n \n-    <feature name=\"platform-error-page-injector\" version=\"${project.version}\"\n-             description=\"Adding a better error page to Jetty\">\n-        <feature>error-api</feature>\n-        <bundle>mvn:ddf.platform.error/platform-error-page-injector/${project.version}</bundle>\n-    </feature>\n+        <!-- Handlers -->\n+        <bundle>mvn:ddf.security.handler/security-handler-api/${project.version}</bundle>\n \n-    <feature name=\"security-encryption\" version=\"${project.version}\"\n-             description=\"Security Encryption\">\n-        <feature>wss4j</feature>\n-        <bundle>mvn:org.apache.commons/commons-lang3/${commons-lang3.version}</bundle>\n+        <!-- Policy -->\n+        <bundle>mvn:ddf.security.policy/security-policy-api/${project.version}</bundle>\n+\n+        <!-- Encryption -->\n         <bundle>mvn:ddf.security.encryption/security-encryption-api/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.encryption/security-encryption-impl/${project.version}</bundle>\n-        <bundle dependency=\"true\">mvn:ddf.platform.security/log-sanitizer/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.encryption/security-encryption-commands/${project.version}</bundle>\n-    </feature>\n \n-    <feature name=\"web-container\" version=\"${project.version}\">\n-        <feature>platform-paxweb-jettyconfig</feature>\n-        <feature>platform-error-page-injector</feature>\n-        <feature>war</feature>\n-    </feature>\n+        <!-- Expansion -->\n+        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n \n-    <feature name=\"session-invalidator\" version=\"${project.version}\"\n-             description=\"API for invalidating servlet sessions\">\n-        <bundle>mvn:ddf.platform/platform-session-invalidator/${project.version}</bundle>\n-    </feature>\n+        <!-- Token Storage -->\n+        <bundle>mvn:ddf.security.storage/token-storage-api/${project.version}</bundle>\n \n-    <feature name=\"platform-paxweb-jettyconfig\" version=\"${project.version}\"\n-      description=\"Custom Session Manager\">\n-        <config name=\"org.ops4j.pax.web\" append=\"true\">\n-#######################################\n-# Jetty Server Authenticator Settings\n-#######################################\n+        <!-- Sessions -->\n+        <bundle>mvn:ddf.platform.security/session-management-api/${project.version}</bundle>\n+        <bundle>mvn:ddf.platform/platform-session-invalidator-api/${project.version}</bundle>\n \n-# Set the authmethod/realmname so that our JettyAuthenticator is used\n-org.ops4j.pax.web.default.authmethod=DDF\n-org.ops4j.pax.web.default.realmname=DDF\n-        </config>\n-        <feature version=\"${spring.version}_1\">spring</feature>\n-        <feature>apache-commons</feature>\n-        <feature>security-core-api</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-core-services</feature>\n-        <feature>security-filter-api</feature>\n-        <feature>pax-http-jetty</feature>\n-        <bundle start-level=\"30\">mvn:org.ops4j.pax.web/pax-web-jsp/${pax.web.version}</bundle>\n-        <bundle>mvn:javax.el/javax.el-api/3.0.0</bundle>\n-        <feature>pax-jetty</feature>\n-        <feature>session-invalidator</feature>\n-        <feature prerequisite=\"true\">wrap</feature>\n-        <bundle>wrap:mvn:net.jodah/failsafe/${jodah-failsafe.version}</bundle>\n-        <feature>guava</feature>\n-        <feature>common-system</feature>\n-        <bundle>mvn:ddf.platform/platform-paxweb-jettyconfig/${project.version}</bundle>\n-    </feature>\n+        <!-- Logout -->\n+        <bundle>mvn:ddf.security.servlet/security-servlet-logout-api/${project.version}</bundle>\n \n-    <feature name=\"security-handler-api\" version=\"${project.version}\"\n-             description=\"API for authentication handlers for web applications.\">\n-        <feature>security-core-api</feature>\n-        <feature>parser-xml</feature>\n-        <feature>oidc-dependencies</feature>\n-        <bundle>mvn:org.apache.cxf/cxf-rt-rs-security-jose/${cxf.version}</bundle>\n-        <bundle>mvn:org.apache.cxf/cxf-rt-rs-security-jose-jaxrs/${cxf.version}</bundle>\n-        <bundle>mvn:ddf.security.handler/security-handler-api/${project.version}</bundle>\n-    </feature>\n+        <!-- Email -->\n+        <bundle>mvn:ddf.platform.email/platform-email-api/${project.version}</bundle>\n \n-    <feature name=\"security-handler-impl\" version=\"${project.version}\"\n-             description=\"Implementation used by all security handlers\">\n-        <feature>security-core-api</feature>\n-        <feature>security-core-impl</feature>\n-        <bundle>mvn:ddf.security.handler/security-handler-impl/${project.version}</bundle>\n+        <!-- Miscellaneous -->\n+        <bundle>mvn:ddf.security.servlet/security-servlet-web-socket-api/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.interceptor/security-interceptor-guest-wrapper/${project.version}</bundle>\n+        <bundle>mvn:ddf.platform.security/security-oidc-bundle/${project.version}</bundle>\n+        <bundle dependency=\"true\">mvn:ddf.platform.security/log-sanitizer/${project.version}</bundle>\n     </feature>\n \n-    <feature name=\"security-token-storage\" version=\"${project.version}\"\n-             description=\"OAuth token storage api and file storage implementation.\">\n-        <feature>apache-commons</feature>\n-        <bundle>mvn:com.google.code.gson/gson/${gson.version}</bundle>\n-        <bundle>mvn:ddf.security.storage/token-storage-api/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.storage/token-storage-impl/${project.version}</bundle>\n+    <feature name=\"security-core-impl-dependencies\" version=\"${project.version}\"\n+             description=\"Dependencies for core security implementations.\">\n+        <!-- External DDF Features -->\n+        <feature>javax-validation</feature>\n+        <feature>parser-xml</feature>\n+        <feature>platform-util</feature>\n     </feature>\n \n     <feature name=\"security-core-impl\" version=\"${project.version}\"\n-             description=\"Security Core\">\n+             description=\"Core security implementations.\">\n         <feature>security-core-api</feature>\n-        <feature>security-handler-api</feature>\n-        <feature>security-encryption</feature>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <bundle>mvn:ddf.platform.util/util-uuidgenerator-api/${project.version}</bundle>\n-        <feature>javax-validation</feature>\n-        <feature>cxf-frontend-javascript</feature>\n-        <bundle>mvn:javax.servlet/javax.servlet-api/${javax.servlet-api.version}</bundle>\n-        <feature>cxf-jaxrs</feature>\n-        <feature>util-uuidgenerator</feature>\n-        <feature dependency=\"true\">oidc-dependencies</feature>\n-        <feature>security-token-storage</feature>\n-        <feature>cxf-rs-security-oauth2</feature>\n-        <feature>platform-util</feature>\n+        <feature>security-core-impl-dependencies</feature>\n+\n+        <!-- Core -->\n         <bundle>mvn:ddf.security.core/security-core-impl/${project.version}</bundle>\n-    </feature>\n \n-    <feature name=\"security-core-services\" version=\"${project.version}\"\n-             description=\"Main security services\">\n-        <feature>security-core-impl</feature>\n-        <feature>security-handler-impl</feature>\n-        <bundle>mvn:ddf.security.core/security-core-services/${project.version}</bundle>\n-        <bundle>mvn:ddf.platform.security/security-rest-cxfwrapper/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.realm/security-realm-pki/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.realm/security-realm-userpass/${project.version}</bundle>\n-    </feature>\n+        <!-- Handlers -->\n+        <bundle>mvn:ddf.security.handler/security-handler-impl/${project.version}</bundle>\n \n-    <feature name=\"security-expansion\" version=\"${project.version}\"\n-             description=\"Security Expansion\">\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n+        <!-- Expansion -->\n         <bundle>mvn:ddf.security.expansion/security-expansion-impl/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-commands/${project.version}</bundle>\n-    </feature>\n-\n-    <feature name=\"security-pdp-authz\" version=\"${project.version}\"\n-             description=\"Security PDP.\">\n-        <configfile finalname=\"${ddf.etc}/ddf.security.pdp.realm.AuthzRealm.config\">\n-            mvn:ddf.security.pdp/security-pdp-authzrealm/${project.version}/config/default-authzrealm\n-        </configfile>\n-        <feature>security-core-impl</feature>\n-        <feature dependency=\"true\">oidc-dependencies</feature>\n-        <feature>security-expansion</feature>\n-        <feature>security-expansion-user-attributes</feature>\n-        <feature>security-expansion-metacard-attributes</feature>\n-        <feature>javax-validation</feature>\n \n-        <feature>cxf-frontend-javascript</feature>\n-        <feature>cxf-jaxrs</feature>\n-        <feature>parser-xml</feature>\n-        <feature>security-handler-api</feature>\n-        <feature>platform-util</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.pdp/security-pdp-authzrealm/${project.version}</bundle>\n-    </feature>\n-\n-    <feature name=\"security-pep-serviceauthz\" version=\"${project.version}\"\n-             description=\"Security PEP Service AuthZ\">\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <feature>javax-validation</feature>\n-        <feature>cxf-frontend-javascript</feature>\n-        <feature>cxf-jaxrs</feature>\n-        <bundle>mvn:ddf.security.encryption/security-encryption-api/${project.version}</bundle>\n-        <feature>security-handler-api</feature>\n-        <feature dependency=\"true\">oidc-dependencies</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-core-services</feature>\n+        <!-- Policy Extension Point -->\n         <bundle>mvn:ddf.security.pep/security-pep-interceptor/${project.version}</bundle>\n     </feature>\n \n-    <feature name=\"security-expansion-user-attributes\" version=\"${project.version}\"\n-             description=\"Security Expansion User Attributes Expansion\">\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-impl/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-userattr-map/${project.version}\n-        </bundle>\n-    </feature>\n-\n-    <feature name=\"security-expansion-metacard-attributes\" version=\"${project.version}\"\n-             description=\"Security Expansion Metacard Attributes Expansion\">\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-impl/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-metacardattr-map/${project.version}\n-        </bundle>\n-    </feature>\n+    <feature name=\"security-core-services-dependencies\" version=\"${project.version}\"\n+             description=\"Dependencies for core security services.\">\n+        <!-- Third Party Features -->\n+        <feature>spring</feature>\n+        <feature>war</feature>\n+        <feature>pax-jetty</feature>\n+        <feature>pax-http-jetty</feature>\n \n-    <feature name=\"security-core-misc\" version=\"${project.version}\">\n+        <!-- External DDF Features -->\n+        <feature>apache-commons</feature>\n+        <feature>guava</feature>\n         <feature>cxf-core</feature>\n-        <feature>cxf-ws-security</feature>\n-        <bundle start-level=\"40\">mvn:org.apache.cxf/cxf-rt-rs-json-basic/${cxf.version}</bundle>\n-        <bundle start-level=\"40\">mvn:org.apache.cxf/cxf-rt-rs-security-jose/${cxf.version}</bundle>\n-        <bundle>mvn:org.apache.commons/commons-jexl/2.1.1</bundle>\n-        <feature>security-core-api</feature>\n-        <feature>security-handler-api</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-handler-impl</feature>\n-        <feature>platform-util</feature>\n-        <feature prerequisite=\"true\">wrap</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.platform.security/security-rest-cxfwrapper/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.certificate/security-ocsp-checker/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.handler/security-handler-pki/${project.version}</bundle>\n-        <bundle>wrap:mvn:org.springframework.ldap/spring-ldap-core/2.3.2.RELEASE</bundle>\n-        <configfile finalname=\"${ddf.etc}/ws-security/attributeMap.properties\">\n-            mvn:ddf.security.claims/security-claims-ldap/${project.version}/properties/attributeMap\n-        </configfile>\n-    </feature>\n-\n-    <feature name=\"security-realm-saml\" version=\"${project.version}\"\n-             description=\"Security realm for SAML.\">\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <feature>security-core-impl</feature>\n-        <feature>javax-validation</feature>\n-        <feature>cxf-frontend-javascript</feature>\n-        <feature>cxf-jaxrs</feature>\n-        <feature>security-handler-api</feature>\n-        <feature>security-handler-impl</feature>\n-        <feature>security-policy-context</feature>\n-        <feature dependency=\"true\">saml-validator</feature>\n-        <feature dependency=\"true\">oidc-dependencies</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.realm/security-realm-saml/${project.version}</bundle>\n-    </feature>\n-\n-    <feature name=\"security-guest-realm\" version=\"${project.version}\"\n-             description=\"Security Guest Realm.\">\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <feature>security-core-impl</feature>\n-        <feature>javax-validation</feature>\n-        <feature>security-handler-api</feature>\n-        <feature>security-handler-impl</feature>\n-        <feature>security-policy-context</feature>\n+        <feature>cxf-rt-security</feature>\n+        <feature>cxf-ws-policy</feature>\n         <feature>cxf-frontend-javascript</feature>\n-        <feature>cxf-jaxrs</feature>\n-        <feature dependency=\"true\">oidc-dependencies</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.realm/security-realm-guest/${project.version}</bundle>\n-    </feature>\n-\n-    <feature name=\"security-jaas-ldap\" version=\"${project.version}\"\n-             description=\"Security JAAS LDAP Login.\">\n-        <feature>security-core-misc</feature>\n-        <feature>javax-validation</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:org.apache.commons/commons-pool2/2.5.0</bundle>\n-        <bundle>mvn:ddf.security.encryption/security-encryption-api/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.jaas/security-jaas-ldap/${project.version}</bundle>\n-    </feature>\n-\n-    <feature name=\"security-claims-ldap\" version=\"${project.version}\"\n-             description=\"Retrieves claims attributes from an LDAP store.\">\n-        <bundle>mvn:ddf.security.encryption/security-encryption-api/${project.version}</bundle>\n-        <feature>security-core-misc</feature>\n-        <feature>security-encryption</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.claims/security-claims-ldap/${project.version}</bundle>\n-    </feature>\n+        <feature>cxf-rs-security-oauth2</feature>\n+        <feature>cxf-rs-security-sso-saml</feature>\n+        <feature>action-core-impl</feature>\n+        <feature>error-api</feature>\n+        <feature>util-uuidgenerator</feature>\n+        <feature>camel-jetty9</feature>\n+        <feature>camel-blueprint</feature>\n+        <feature>camel-http</feature>\n \n-    <feature name=\"ldap-embedded-default-configs\" version=\"${project.version}\"\n-             description=\"Installs default embedded ldap claims handler and login configs\">\n-        <feature>ldap-embedded-default-claimshandler-config</feature>\n-        <feature>ldap-embedded-default-stslogin-config</feature>\n-    </feature>\n+        <!-- JavaX -->\n+        <bundle>mvn:javax.el/javax.el-api/3.0.0</bundle>\n+        <bundle>mvn:javax.servlet/javax.servlet-api/${javax.servlet-api-version}</bundle>\n \n-    <feature name=\"ldap-embedded-default-claimshandler-config\" version=\"${project.version}\"\n-             description=\"Installs a default embedded ldap login config\">\n-        <configfile\n-                finalname=\"${ddf.etc}/Claims_Handler_Manager-ddf.security.sts.claimsHandler.ClaimsHandlerManager.config\"\n-                override=\"false\">\n-            mvn:ddf.security.claims/security-claims-ldap/${project.version}/config/default-ldap-claimshandler\n-        </configfile>\n-    </feature>\n+        <!-- Apache -->\n+        <bundle>mvn:org.apache.commons/commons-lang3/${commons-lang3.version}</bundle>\n+        <bundle dependency=\"true\">mvn:org.apache.commons/commons-configuration2/${commons-configuration2.version}</bundle>\n+        <bundle>mvn:org.apache.commons/commons-jexl/2.1.1</bundle>\n+        <bundle>\n+            mvn:org.apache.servicemix.bundles/org.apache.servicemix.bundles.jaxen/${org.apache.servicemix.bundles.jaxen.version}\n+        </bundle>\n+        <bundle>mvn:org.apache.santuario/xmlsec/${xmlsec.version}</bundle>\n+        <bundle start-level=\"30\">mvn:org.apache.neethi/neethi/${wss4j.neethi.version}</bundle>\n+        <bundle start-level=\"40\">mvn:org.apache.cxf/cxf-rt-rs-json-basic/${cxf.version}</bundle>\n+        <bundle start-level=\"40\">mvn:org.apache.cxf/cxf-rt-rs-security-jose/${cxf.version}</bundle>\n \n-    <feature name=\"ldap-embedded-default-stslogin-config\" version=\"${project.version}\"\n-             description=\"Installs a default embedded ldap claims handler config\">\n-        <configfile\n-                finalname=\"${ddf.etc}/Ldap_Login_Config-ddf.ldap.ldaplogin.LdapLoginConfig.config\"\n-                override=\"false\">\n-            mvn:ddf.security.jaas/security-jaas-ldap/${project.version}/config/default-ldaplogin\n-        </configfile>\n-    </feature>\n+        <!-- Pax -->\n+        <config name=\"org.ops4j.pax.web\" append=\"true\">\n+            #######################################\n+            # Jetty Server Authenticator Settings\n+            #######################################\n \n-    <feature name=\"security-handler-basic\" version=\"${project.version}\"\n-             description=\"Basic Authentication Handler for web applications.\">\n-        <feature>security-core-misc</feature>\n-        <feature>parser-xml</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.handler/security-handler-basic/${project.version}</bundle>\n-    </feature>\n+            # Set the authmethod/realmname so that our JettyAuthenticator is used\n+            org.ops4j.pax.web.default.authmethod=DDF\n+            org.ops4j.pax.web.default.realmname=DDF\n+        </config>\n+        <bundle start-level=\"30\">mvn:org.ops4j.pax.web/pax-web-jsp/${pax.web.version}</bundle>\n \n-    <feature name=\"oidc-dependencies\" version=\"${project.version}\"\n-      description=\"All OIDC third party dependencies\">\n-        <feature prerequisite=\"true\">wrap</feature>\n-        <feature>jackson</feature>\n-        <bundle>mvn:com.sun.mail/javax.mail/${javax-mail.version}</bundle>\n-        <!--\n-            net.minidev/accessors-smart/1.2 uses asm v5.x. Need this resolved before we can upgrade:\n-            https://bitbucket.org/connect2id/nimbus-jose-jwt/issues/239/switch-to-other-json-library\n-        -->\n-        <bundle>mvn:org.ow2.asm/asm/5.2</bundle>\n-        <bundle>mvn:net.minidev/accessors-smart/1.2</bundle>\n-        <bundle>mvn:net.minidev/json-smart/2.3</bundle>\n-        <bundle>wrap:mvn:com.nimbusds/nimbus-jose-jwt/${nimbus.version}</bundle>\n-        <bundle>wrap:mvn:com.nimbusds/oauth2-oidc-sdk/${nimbus.oidc.version}</bundle>\n-        <bundle>mvn:com.nimbusds/content-type/${nimbus.content-type.version}</bundle>\n-        <bundle>mvn:com.nimbusds/lang-tag/${nimbus.langtag.version}</bundle>\n-        <bundle>wrap:mvn:com.github.stephenc.jcip/jcip-annotations/1.0-1</bundle>\n-        <bundle>mvn:commons-codec/commons-codec/${commons-codec.version}</bundle>\n-        <bundle>mvn:ddf.platform.security/security-oidc-bundle/${project.version}</bundle>\n+        <!-- Miscellaneous -->\n+        <bundle>mvn:com.google.code.gson/gson/${gson.version}</bundle>\n+        <bundle>wrap:mvn:org.springframework.ldap/spring-ldap-core/2.3.2.RELEASE</bundle>\n+        <bundle>wrap:mvn:net.jodah/failsafe/${jodah-failsafe.version}</bundle>\n+        <bundle>mvn:joda-time/joda-time/${joda-time.version}</bundle>\n+        <bundle>mvn:org.codice.thirdparty/commons-httpclient/3.1.0_1</bundle>\n     </feature>\n \n-    <feature name=\"security-handler-oidc\" version=\"${project.version}\"\n-             description=\"OIDC Authentication Handler for web applications.\">\n-        <feature>oidc-dependencies</feature>\n-        <feature>action-core-impl</feature>\n+    <feature name=\"security-core-services\" version=\"${project.version}\"\n+             description=\"Core security services.\">\n         <feature>security-core-impl</feature>\n-        <feature>security-handler-impl</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.handler/security-handler-oidc/${project.version}</bundle>\n-    </feature>\n+        <feature>security-core-services-dependencies</feature>\n \n-    <feature name=\"security-handler-oauth\" version=\"${project.version}\"\n-      description=\"OIDC Authentication Handler for web applications.\">\n-        <feature>oidc-dependencies</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-handler-impl</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.handler/security-handler-oauth/${project.version}</bundle>\n-    </feature>\n+        <!-- Core -->\n+        <bundle>mvn:ddf.security.core/security-core-services/${project.version}</bundle>\n \n-    <feature name=\"security-oidc-realm\" version=\"${project.version}\"\n-             description=\"OIDC Authentication Handler for web applications.\">\n-        <feature>jackson</feature>\n-        <feature dependency=\"true\">oidc-dependencies</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-handler-api</feature>\n-        <feature>security-handler-oidc</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.realm/security-realm-oidc/${project.version}</bundle>\n-    </feature>\n+        <!-- Rest Client -->\n+        <bundle>mvn:ddf.platform.security/security-rest-cxfwrapper/${project.version}</bundle>\n \n-    <feature name=\"security-filter-login\" version=\"${project.version}\"\n-             description=\"Login Filter for web applications.\">\n-        <feature>security-core-impl</feature>\n-        <feature>security-policy-context</feature>\n-        <feature>cxf-rs-security-sso-saml</feature>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <feature>javax-validation</feature>\n-        <feature>cxf-frontend-javascript</feature>\n-        <feature>security-filter-api</feature>\n-        <feature>security-handler-api</feature>\n-        <feature>security-handler-impl</feature>\n-        <feature dependency=\"true\">oidc-dependencies</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.filter/security-filter-login/${project.version}</bundle>\n-    </feature>\n+        <!-- Country Converter -->\n+        <bundle>mvn:ddf.platform.country/platform-country-converter-local/${project.version}</bundle>\n \n-    <feature name=\"security-filter-csrf\" version=\"${project.version}\"\n-             description=\"CSRF Filter for web applications.\">\n-        <feature>security-core-api</feature>\n+        <!-- Filters -->\n         <bundle>mvn:ddf.security.filter/security-filter-csrf/${project.version}</bundle>\n-    </feature>\n-\n-    <feature name=\"security-filter-authz\" version=\"${project.version}\"\n-             description=\"Authz Filter for web applications.\">\n-        <feature>security-policy-context</feature>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <feature>security-filter-api</feature>\n-        <feature>javax-validation</feature>\n-        <feature>cxf-frontend-javascript</feature>\n-        <feature>cxf-jaxrs</feature>\n-        <feature>security-handler-api</feature>\n-        <feature dependency=\"true\">oidc-dependencies</feature>\n-        <feature>security-core-services</feature>\n+        <bundle>mvn:ddf.security.filter/security-filter-web-sso/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.filter/security-filter-login/${project.version}</bundle>\n         <bundle>mvn:ddf.security.filter/security-filter-authorization/${project.version}</bundle>\n-    </feature>\n \n+        <!-- Claims -->\n+        <bundle>mvn:ddf.security.claims/security-claims-property/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.claims/security-claims-attributequery/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.claims/security-claims-certificate/${project.version}</bundle>\n \n-    <feature name=\"security-filter-web-sso\" version=\"${project.version}\"\n-             description=\"Web SSO Filter for web applications.\">\n-        <feature>security-core-impl</feature>\n-        <feature>security-filter-api</feature>\n-        <feature>security-handler-api</feature>\n-        <feature>security-policy-context</feature>\n-        <feature>security-handler-impl</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.filter/security-filter-web-sso/${project.version}</bundle>\n-    </feature>\n+        <!-- Keys and Certificates -->\n+        <bundle>mvn:ddf.security.certificate/security-certificate-keystoreeditor/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.certificate/security-certificate-generator/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.certificate/security-crl-generator/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.certificate/security-ocsp-checker/${project.version}</bundle>\n \n-    <feature name=\"security-policy-context\" version=\"${project.version}\"\n-             description=\"Web Context policy manager\">\n-        <feature>security-core-api</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.policy/security-policy-api/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.policy/security-policy-context/${project.version}</bundle>\n-    </feature>\n+        <!-- Encryption -->\n+        <bundle>mvn:ddf.security.encryption/security-encryption-impl/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.encryption/security-encryption-commands/${project.version}</bundle>\n \n-    <feature name=\"security-claims-certificate\"\n-             version=\"${project.version}\"\n-             description=\"Retrieves claims from a user's certificate.\">\n-        <feature>security-core-misc</feature>\n-        <bundle>mvn:ddf.security.claims/security-claims-certificate/${project.version}\n-        </bundle>\n-    </feature>\n+        <!-- Token Storage -->\n+        <bundle>mvn:ddf.security.storage/token-storage-impl/${project.version}</bundle>\n \n-    <feature name=\"security-claims-property\" version=\"${project.version}\"\n-             description=\"Looks up user properties via a properties file.\">\n-        <feature>security-core-misc</feature>\n-        <feature>javax-validation</feature>\n-        <bundle>mvn:ddf.security.claims/security-claims-property/${project.version}</bundle>\n-    </feature>\n+        <!-- Sessions -->\n+        <bundle>mvn:ddf.platform.security/session-management-impl/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.servlet/security-servlet-session-expiry/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.command/security-command-sessionmanager/${project.version}</bundle>\n \n-    <feature name=\"security-interceptor-guest\" version=\"${project.version}\"\n-             description=\"Injects guest user information into incoming SOAP messages.\">\n-        <feature>guava</feature>\n-        <bundle>mvn:ddf.security.encryption/security-encryption-api/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <feature>javax-validation</feature>\n-        <feature>cxf-frontend-javascript</feature>\n-        <feature>cxf-jaxrs</feature>\n-        <feature>security-handler-api</feature>\n-        <feature>security-handler-impl</feature>\n-        <feature>security-policy-context</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-encryption</feature>\n-        <feature dependency=\"true\">oidc-dependencies</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.interceptor/security-interceptor-guest/${project.version}</bundle>\n-    </feature>\n+        <!-- Expansion -->\n+        <bundle>mvn:ddf.security.expansion/security-expansion-userattr-map/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.expansion/security-expansion-metacardattr-map/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.expansion/security-expansion-commands/${project.version}</bundle>\n \n-    <feature name=\"security-claims-attributequery\"\n-             version=\"${project.version}\"\n-             description=\"Retrieves claims from external attribute store using an AttributeQuery request.\">\n-        <feature>guava</feature>\n-        <bundle>mvn:ddf.security.encryption/security-encryption-api/${project.version}</bundle>\n-        <feature>security-core-misc</feature>\n-        <feature>security-encryption</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.claims/security-claims-attributequery/${project.version}\n-        </bundle>\n-    </feature>\n+        <!-- Logout -->\n+        <bundle>mvn:ddf.security.servlet/security-servlet-logout/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.servlet/security-servlet-default-logout/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.servlet/security-servlet-logout-endpoint/${project.version}</bundle>\n \n-    <feature name=\"security-interceptor-guest-wrapper\"\n-             version=\"${project.version}\"\n-             description=\"Wrapper for Security Interceptor Guest that injects guest user information into incoming SOAP messages.\">\n-        <feature>cxf-bindings-soap</feature>\n-        <feature>cxf-ws-security</feature>\n-        <bundle>mvn:ddf.security.interceptor/security-interceptor-guest-wrapper/${project.version}\n-        </bundle>\n-    </feature>\n+        <!-- Policy Decision Point -->\n+        <configfile finalname=\"${ddf.etc}/ddf.security.pdp.realm.AuthzRealm.config\">\n+            mvn:ddf.security.pdp/security-pdp-authzrealm/${project.version}/config/default-authzrealm\n+        </configfile>\n+        <bundle>mvn:ddf.security.pdp/security-pdp-authzrealm/${project.version}</bundle>\n \n-    <feature name=\"security-guest\" version=\"${project.version}\"\n-             description=\"Contains all of the guest security features.\">\n-        <feature>security-interceptor-guest-wrapper</feature>\n-        <feature>security-interceptor-guest</feature>\n-    </feature>\n+        <!-- Context Policy -->\n+        <bundle>mvn:ddf.security.policy/security-policy-context/${project.version}</bundle>\n \n-    <feature name=\"security-servlet-session-expiry\" version=\"${project.version}\"\n-             description=\"Session expiry servlet.\">\n-        <feature>guava</feature>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <feature>javax-validation</feature>\n-        <feature>cxf-frontend-javascript</feature>\n-        <feature>cxf-jaxrs</feature>\n-        <feature>security-handler-api</feature>\n-        <feature>security-core-impl</feature>\n-        <feature dependency=\"true\">oidc-dependencies</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.platform.security/session-management-service/${project.version}</bundle>\n-        <bundle>mvn:ddf.platform.security/session-management-impl/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.servlet/security-servlet-session-expiry/${project.version}</bundle>\n-    </feature>\n+        <!-- Logging -->\n+        <bundle>mvn:ddf.security.interceptor/security-interceptor-logger/${project.version}</bundle>\n \n-    <feature name=\"security-servlet-whoami\" version=\"${project.version}\"\n-             description=\"Who Am I servlet.\">\n-        <feature>security-core-impl</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.servlet/security-servlet-whoami/${project.version}</bundle>\n-    </feature>\n+        <!-- Guest Authentication -->\n+        <bundle>mvn:ddf.security.realm/security-realm-guest/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.interceptor/security-interceptor-guest/${project.version}</bundle>\n \n-    <feature name=\"security-servlet-web-socket\" version=\"${project.version}\"\n-             description=\"Defines a secure web socket servlet type.\">\n-        <feature>security-core-api</feature>\n-        <feature>pax-http-whiteboard</feature>\n-        <bundle>mvn:ddf.security.servlet/security-servlet-web-socket/${project.version}</bundle>\n-    </feature>\n+        <!-- Basic Auth -->\n+        <bundle>mvn:ddf.security.realm/security-realm-userpass/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.handler/security-handler-basic/${project.version}</bundle>\n \n-    <feature name=\"security-handler-saml\" version=\"${project.version}\"\n-             description=\"SAML Web SSO client\">\n-        <feature>security-core-api</feature>\n-        <feature>security-handler-api</feature>\n-        <feature>javax-validation</feature>\n-        <feature>action-core-impl</feature>\n-        <feature>cxf-rs-security-sso-saml</feature>\n-        <feature>security-filter-api</feature>\n-        <feature>session-invalidator</feature>\n-        <feature>platform-paxweb-jettyconfig</feature>\n-        <feature>security-filter-login</feature>\n-        <feature>guava</feature>\n-        <feature>cxf-frontend-javascript</feature>\n-        <feature>cxf-jaxrs</feature>\n-        <feature>util-uuidgenerator</feature>\n-        <feature>security-handler-basic</feature>\n-        <feature dependency=\"true\">oidc-dependencies</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>saml-validator</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security/security-saml-util/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.handler/security-handler-saml/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.encryption/security-encryption-api/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <bundle>mvn:com.google.code.gson/gson/${gson.version}</bundle>\n-    </feature>\n+        <!-- PKI Auth -->\n+        <bundle>mvn:ddf.security.realm/security-realm-pki/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.handler/security-handler-pki/${project.version}</bundle>\n \n-    <feature name=\"saml-validator\" version=\"${project.version}\" description=\"Saml token validator\">\n-        <!--  TODO (https://github.com/codice/ddf/issues/5327)\n-                Address potential circular dependencies as part of security refactor  -->\n-        <feature>security-core-impl</feature>\n-        <feature>security-handler-impl</feature>\n-        <bundle>mvn:ddf.security.saml/saml-assertion-validator/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.saml/saml-assertion-validator-impl/${project.version}</bundle>\n-    </feature>\n+        <!-- Email -->\n+        <bundle>mvn:ddf.platform.email/platform-email-impl/${project.version}</bundle>\n \n-    <feature name=\"security-command-listener\" version=\"${project.version}\"\n-             description=\"Audits all commands entered on the Karaf command line.\">\n-        <feature>security-core-api</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-core-services</feature>\n+        <!-- Miscellaneous -->\n+        <bundle>mvn:ddf.platform/platform-paxweb-jettyconfig/${project.version}</bundle>\n+        <bundle>mvn:ddf.platform/platform-http-proxy/${project.version}</bundle>\n+        <bundle>mvn:ddf.platform.security/secure-boot/${project.version}</bundle>\n         <bundle>mvn:ddf.security.command/security-command-listener/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.servlet/security-servlet-whoami/${project.version}</bundle>\n     </feature>\n \n-    <feature name=\"security-web-sso-defaults\" version=\"${project.version}\"\n-             description=\"Installs the default features needed for web-based SSO authentication.\">\n-        <feature>security-policy-context</feature>\n-        <feature>security-expansion</feature>\n-        <feature>security-expansion-user-attributes</feature>\n-        <feature>security-expansion-metacard-attributes</feature>\n-        <feature>security-core-misc</feature>\n-        <feature>security-filter-web-sso</feature>\n-        <feature>security-filter-login</feature>\n-        <feature>security-filter-csrf</feature>\n-        <feature>security-handler-basic</feature>\n-        <feature>security-oidc-realm</feature>\n-        <feature>security-handler-oidc</feature>\n-        <feature>security-handler-oauth</feature>\n-        <feature>security-handler-saml</feature>\n-        <feature>security-filter-authz</feature>\n-        <feature>security-pdp-authz</feature>\n-        <feature>security-servlet-whoami</feature>\n-        <feature>security-servlet-session-expiry</feature>\n-        <feature>security-servlet-web-socket</feature>\n-        <feature>security-realm-saml</feature>\n-        <feature>security-guest-realm</feature>\n-        <feature>security-claims-property</feature>\n+    <feature name=\"oidc-auth\" version=\"${project.version}\"\n+             description=\"OIDC features and bundles.\">\n         <feature>security-core-services</feature>\n-    </feature>\n \n-    <feature name=\"secure-boot\" version=\"${project.version}\"\n-             description=\"Verifies that the installation is located in a secure directory.\">\n-        <bundle>mvn:ddf.platform.security/secure-boot/${project.version}</bundle>\n-    </feature>\n-\n-    <feature name=\"security-core\" version=\"${project.version}\"\n-             description=\"The Security Application provides Authentication, Authorization, and Auditing services.\\nThey comprise both a framework that developers and integrators can extend and also a reference implementation that can be used which meets security requirements.::Security\">\n-        <feature>web-container</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-policy-context</feature>\n-        <feature>security-web-sso-defaults</feature>\n-        <feature>security-guest</feature>\n-        <feature>security-command-listener</feature>\n+        <bundle>mvn:ddf.security.realm/security-realm-oidc/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.handler/security-handler-oidc/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.handler/security-handler-oauth/${project.version}</bundle>\n     </feature>\n \n-    <!-- Start of app features -->\n-\n-    <repository>mvn:ddf.features/camel/${project.version}/xml/features</repository>\n+    <feature name=\"saml-auth\" version=\"${project.version}\"\n+             description=\"SAML features and bundles.\">\n+        <feature>security-core-services</feature>\n \n-    <feature name=\"platform-http-proxy\" version=\"${project.version}\"\n-             description=\"HTTP to HTTPS proxy.\">\n-        <feature>camel-jetty9</feature>\n-        <feature>security-core-api</feature>\n-        <feature>camel-blueprint</feature>\n-        <feature>camel-http</feature>\n-        <bundle>mvn:org.codice.thirdparty/commons-httpclient/3.1.0_1</bundle>\n-        <bundle>mvn:ddf.platform/platform-http-proxy/${project.version}</bundle>\n-    </feature>\n+        <!--  TODO (https://github.com/codice/ddf/issues/5327)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5fe3c153d747edf954bc7be7ba8835a00d20f2da"}, "originalPosition": 818}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTI2OTQ3Mg==", "bodyText": "It's still an issue, but I'm not sure when we are planning to get around to resolving it. I'm not sure what the best practice is in this case.", "url": "https://github.com/codice/ddf/pull/6155#discussion_r449269472", "createdAt": "2020-07-02T21:16:03Z", "author": {"login": "bakejeyner"}, "path": "features/security/src/main/feature/feature.xml", "diffHunk": "@@ -21,694 +21,317 @@\n     <repository>mvn:ddf.features/kernel/${project.version}/xml/features</repository>\n     <repository>mvn:ddf.features/utilities/${project.version}/xml/features</repository>\n     <repository>mvn:ddf.features/branding/${project.version}/xml/features</repository>\n+    <repository>mvn:ddf.features/camel/${project.version}/xml/features</repository>\n \n-    <feature name=\"security-logger\" version=\"${project.version}\"\n-             description=\"Logs incoming and outgoing requests\">\n-        <feature>security-core-api</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.interceptor/security-interceptor-logger/${project.version}</bundle>\n-    </feature>\n+    <feature name=\"security-core-api-dependencies\" version=\"${project.version\"\n+             description=\"Dependencies for the core security APIs.\">\n+        <!-- Third Party Features -->\n+        <feature prerequisite=\"true\">wrap</feature>\n+        <feature>pax-http-whiteboard</feature>\n \n-    <feature name=\"security-core-api\" version=\"${project.version}\"\n-             description=\"Security Core\">\n-        <bundle start-level=\"30\">mvn:org.apache.neethi/neethi/${wss4j.neethi.version}</bundle>\n-        <feature>cxf-rt-security</feature>\n-        <feature>security-filter-api</feature>\n+        <!-- External DDF Features -->\n+        <feature>jackson</feature>\n+        <feature>wss4j</feature>\n+        <feature>cxf-ws-security</feature>\n         <feature>cxf-jaxrs</feature>\n-        <feature>platform-util</feature>\n-        <bundle dependency=\"true\">mvn:ddf.platform.security/log-sanitizer/${project.version}</bundle>\n-        <bundle dependency=\"true\">mvn:org.apache.commons/commons-configuration2/${commons-configuration2.version}</bundle>\n-        <bundle dependency=\"true\">mvn:org.apache.shiro/shiro-core/${apache.shiro.version}</bundle>\n-\n-        <feature>guava</feature>\n+        <feature>cxf-bindings-soap</feature>\n         <feature>common-system</feature>\n \n-        <bundle>mvn:joda-time/joda-time/${joda-time.version}</bundle>\n-        <bundle>mvn:org.apache.santuario/xmlsec/${xmlsec.version}</bundle>\n+        <!-- NimbusDS -->\n+        <bundle>wrap:mvn:com.nimbusds/nimbus-jose-jwt/${nimbus.version}</bundle>\n+        <bundle>wrap:mvn:com.nimbusds/oauth2-oidc-sdk/${nimbus.oidc.version}</bundle>\n+        <bundle>mvn:com.nimbusds/content-type/${nimbus.content-type.version}</bundle>\n+        <bundle>mvn:com.nimbusds/lang-tag/${nimbus.langtag.version}</bundle>\n \n-        <feature>cxf-bindings-soap</feature>\n-        <feature>cxf-ws-policy</feature>\n-        <feature>cxf-ws-security</feature>\n-        <feature>spring</feature>\n+        <!-- MiniDev -->\n+        <bundle>mvn:net.minidev/accessors-smart/1.2</bundle>\n+        <bundle>mvn:net.minidev/json-smart/2.3</bundle>\n \n-        <!--  TODO (https://github.com/codice/ddf/issues/5327)\n-                Remove wrapped OpenSAML after security refactor is complete  -->\n-        <!--  <bundle>mvn:org.apache.servicemix.bundles/org.apache.servicemix.bundles.opensaml/${opensaml.osgi.version}-->\n-        <!--  </bundle>-->\n-        <bundle>mvn:ddf.lib.bundles/libs-bundles-opensaml/${project.version}</bundle>\n+        <!-- Miscellaneous -->\n+        <bundle dependency=\"true\">mvn:org.apache.shiro/shiro-core/${apache.shiro.version}</bundle>\n+        <bundle>mvn:com.sun.mail/javax.mail/${javax-mail.version}</bundle>\n+        <!--\n+            net.minidev/accessors-smart/1.2 uses asm v5.x. Need this resolved before we can upgrade:\n+            https://bitbucket.org/connect2id/nimbus-jose-jwt/issues/239/switch-to-other-json-library\n+        -->\n+        <bundle>mvn:org.ow2.asm/asm/5.2</bundle>\n+        <bundle>wrap:mvn:com.github.stephenc.jcip/jcip-annotations/1.0-1</bundle>\n+    </feature>\n \n+    <feature name=\"security-core-api\" version=\"${project.version}\"\n+             description=\"Core security APIs.\">\n+        <feature>security-core-api-dependencies</feature>\n+\n+        <!-- Core -->\n         <bundle>mvn:ddf.security.core/security-core-api/${project.version}</bundle>\n+\n+        <!-- Country Converter -->\n+        <bundle>mvn:ddf.platform.country/platform-country-converter-api/${project.version}</bundle>\n+\n+        <!-- Rest Client -->\n         <bundle>mvn:ddf.platform.security/security-rest-clientapi/${project.version}</bundle>\n-        <bundle>\n-            mvn:org.apache.servicemix.bundles/org.apache.servicemix.bundles.jaxen/${org.apache.servicemix.bundles.jaxen.version}\n-        </bundle>\n-    </feature>\n \n-    <feature name=\"security-filter-api\" version=\"${project.version}\">\n-        <bundle>mvn:javax.servlet/javax.servlet-api/${javax.servlet-api-version}</bundle>\n+        <!-- Filters -->\n         <bundle>mvn:ddf.platform/security-filter-api/${project.version}</bundle>\n-    </feature>\n \n-    <feature name=\"platform-error-page-injector\" version=\"${project.version}\"\n-             description=\"Adding a better error page to Jetty\">\n-        <feature>error-api</feature>\n-        <bundle>mvn:ddf.platform.error/platform-error-page-injector/${project.version}</bundle>\n-    </feature>\n+        <!-- Handlers -->\n+        <bundle>mvn:ddf.security.handler/security-handler-api/${project.version}</bundle>\n \n-    <feature name=\"security-encryption\" version=\"${project.version}\"\n-             description=\"Security Encryption\">\n-        <feature>wss4j</feature>\n-        <bundle>mvn:org.apache.commons/commons-lang3/${commons-lang3.version}</bundle>\n+        <!-- Policy -->\n+        <bundle>mvn:ddf.security.policy/security-policy-api/${project.version}</bundle>\n+\n+        <!-- Encryption -->\n         <bundle>mvn:ddf.security.encryption/security-encryption-api/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.encryption/security-encryption-impl/${project.version}</bundle>\n-        <bundle dependency=\"true\">mvn:ddf.platform.security/log-sanitizer/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.encryption/security-encryption-commands/${project.version}</bundle>\n-    </feature>\n \n-    <feature name=\"web-container\" version=\"${project.version}\">\n-        <feature>platform-paxweb-jettyconfig</feature>\n-        <feature>platform-error-page-injector</feature>\n-        <feature>war</feature>\n-    </feature>\n+        <!-- Expansion -->\n+        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n \n-    <feature name=\"session-invalidator\" version=\"${project.version}\"\n-             description=\"API for invalidating servlet sessions\">\n-        <bundle>mvn:ddf.platform/platform-session-invalidator/${project.version}</bundle>\n-    </feature>\n+        <!-- Token Storage -->\n+        <bundle>mvn:ddf.security.storage/token-storage-api/${project.version}</bundle>\n \n-    <feature name=\"platform-paxweb-jettyconfig\" version=\"${project.version}\"\n-      description=\"Custom Session Manager\">\n-        <config name=\"org.ops4j.pax.web\" append=\"true\">\n-#######################################\n-# Jetty Server Authenticator Settings\n-#######################################\n+        <!-- Sessions -->\n+        <bundle>mvn:ddf.platform.security/session-management-api/${project.version}</bundle>\n+        <bundle>mvn:ddf.platform/platform-session-invalidator-api/${project.version}</bundle>\n \n-# Set the authmethod/realmname so that our JettyAuthenticator is used\n-org.ops4j.pax.web.default.authmethod=DDF\n-org.ops4j.pax.web.default.realmname=DDF\n-        </config>\n-        <feature version=\"${spring.version}_1\">spring</feature>\n-        <feature>apache-commons</feature>\n-        <feature>security-core-api</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-core-services</feature>\n-        <feature>security-filter-api</feature>\n-        <feature>pax-http-jetty</feature>\n-        <bundle start-level=\"30\">mvn:org.ops4j.pax.web/pax-web-jsp/${pax.web.version}</bundle>\n-        <bundle>mvn:javax.el/javax.el-api/3.0.0</bundle>\n-        <feature>pax-jetty</feature>\n-        <feature>session-invalidator</feature>\n-        <feature prerequisite=\"true\">wrap</feature>\n-        <bundle>wrap:mvn:net.jodah/failsafe/${jodah-failsafe.version}</bundle>\n-        <feature>guava</feature>\n-        <feature>common-system</feature>\n-        <bundle>mvn:ddf.platform/platform-paxweb-jettyconfig/${project.version}</bundle>\n-    </feature>\n+        <!-- Logout -->\n+        <bundle>mvn:ddf.security.servlet/security-servlet-logout-api/${project.version}</bundle>\n \n-    <feature name=\"security-handler-api\" version=\"${project.version}\"\n-             description=\"API for authentication handlers for web applications.\">\n-        <feature>security-core-api</feature>\n-        <feature>parser-xml</feature>\n-        <feature>oidc-dependencies</feature>\n-        <bundle>mvn:org.apache.cxf/cxf-rt-rs-security-jose/${cxf.version}</bundle>\n-        <bundle>mvn:org.apache.cxf/cxf-rt-rs-security-jose-jaxrs/${cxf.version}</bundle>\n-        <bundle>mvn:ddf.security.handler/security-handler-api/${project.version}</bundle>\n-    </feature>\n+        <!-- Email -->\n+        <bundle>mvn:ddf.platform.email/platform-email-api/${project.version}</bundle>\n \n-    <feature name=\"security-handler-impl\" version=\"${project.version}\"\n-             description=\"Implementation used by all security handlers\">\n-        <feature>security-core-api</feature>\n-        <feature>security-core-impl</feature>\n-        <bundle>mvn:ddf.security.handler/security-handler-impl/${project.version}</bundle>\n+        <!-- Miscellaneous -->\n+        <bundle>mvn:ddf.security.servlet/security-servlet-web-socket-api/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.interceptor/security-interceptor-guest-wrapper/${project.version}</bundle>\n+        <bundle>mvn:ddf.platform.security/security-oidc-bundle/${project.version}</bundle>\n+        <bundle dependency=\"true\">mvn:ddf.platform.security/log-sanitizer/${project.version}</bundle>\n     </feature>\n \n-    <feature name=\"security-token-storage\" version=\"${project.version}\"\n-             description=\"OAuth token storage api and file storage implementation.\">\n-        <feature>apache-commons</feature>\n-        <bundle>mvn:com.google.code.gson/gson/${gson.version}</bundle>\n-        <bundle>mvn:ddf.security.storage/token-storage-api/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.storage/token-storage-impl/${project.version}</bundle>\n+    <feature name=\"security-core-impl-dependencies\" version=\"${project.version}\"\n+             description=\"Dependencies for core security implementations.\">\n+        <!-- External DDF Features -->\n+        <feature>javax-validation</feature>\n+        <feature>parser-xml</feature>\n+        <feature>platform-util</feature>\n     </feature>\n \n     <feature name=\"security-core-impl\" version=\"${project.version}\"\n-             description=\"Security Core\">\n+             description=\"Core security implementations.\">\n         <feature>security-core-api</feature>\n-        <feature>security-handler-api</feature>\n-        <feature>security-encryption</feature>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <bundle>mvn:ddf.platform.util/util-uuidgenerator-api/${project.version}</bundle>\n-        <feature>javax-validation</feature>\n-        <feature>cxf-frontend-javascript</feature>\n-        <bundle>mvn:javax.servlet/javax.servlet-api/${javax.servlet-api.version}</bundle>\n-        <feature>cxf-jaxrs</feature>\n-        <feature>util-uuidgenerator</feature>\n-        <feature dependency=\"true\">oidc-dependencies</feature>\n-        <feature>security-token-storage</feature>\n-        <feature>cxf-rs-security-oauth2</feature>\n-        <feature>platform-util</feature>\n+        <feature>security-core-impl-dependencies</feature>\n+\n+        <!-- Core -->\n         <bundle>mvn:ddf.security.core/security-core-impl/${project.version}</bundle>\n-    </feature>\n \n-    <feature name=\"security-core-services\" version=\"${project.version}\"\n-             description=\"Main security services\">\n-        <feature>security-core-impl</feature>\n-        <feature>security-handler-impl</feature>\n-        <bundle>mvn:ddf.security.core/security-core-services/${project.version}</bundle>\n-        <bundle>mvn:ddf.platform.security/security-rest-cxfwrapper/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.realm/security-realm-pki/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.realm/security-realm-userpass/${project.version}</bundle>\n-    </feature>\n+        <!-- Handlers -->\n+        <bundle>mvn:ddf.security.handler/security-handler-impl/${project.version}</bundle>\n \n-    <feature name=\"security-expansion\" version=\"${project.version}\"\n-             description=\"Security Expansion\">\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n+        <!-- Expansion -->\n         <bundle>mvn:ddf.security.expansion/security-expansion-impl/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-commands/${project.version}</bundle>\n-    </feature>\n-\n-    <feature name=\"security-pdp-authz\" version=\"${project.version}\"\n-             description=\"Security PDP.\">\n-        <configfile finalname=\"${ddf.etc}/ddf.security.pdp.realm.AuthzRealm.config\">\n-            mvn:ddf.security.pdp/security-pdp-authzrealm/${project.version}/config/default-authzrealm\n-        </configfile>\n-        <feature>security-core-impl</feature>\n-        <feature dependency=\"true\">oidc-dependencies</feature>\n-        <feature>security-expansion</feature>\n-        <feature>security-expansion-user-attributes</feature>\n-        <feature>security-expansion-metacard-attributes</feature>\n-        <feature>javax-validation</feature>\n \n-        <feature>cxf-frontend-javascript</feature>\n-        <feature>cxf-jaxrs</feature>\n-        <feature>parser-xml</feature>\n-        <feature>security-handler-api</feature>\n-        <feature>platform-util</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.pdp/security-pdp-authzrealm/${project.version}</bundle>\n-    </feature>\n-\n-    <feature name=\"security-pep-serviceauthz\" version=\"${project.version}\"\n-             description=\"Security PEP Service AuthZ\">\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <feature>javax-validation</feature>\n-        <feature>cxf-frontend-javascript</feature>\n-        <feature>cxf-jaxrs</feature>\n-        <bundle>mvn:ddf.security.encryption/security-encryption-api/${project.version}</bundle>\n-        <feature>security-handler-api</feature>\n-        <feature dependency=\"true\">oidc-dependencies</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-core-services</feature>\n+        <!-- Policy Extension Point -->\n         <bundle>mvn:ddf.security.pep/security-pep-interceptor/${project.version}</bundle>\n     </feature>\n \n-    <feature name=\"security-expansion-user-attributes\" version=\"${project.version}\"\n-             description=\"Security Expansion User Attributes Expansion\">\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-impl/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-userattr-map/${project.version}\n-        </bundle>\n-    </feature>\n-\n-    <feature name=\"security-expansion-metacard-attributes\" version=\"${project.version}\"\n-             description=\"Security Expansion Metacard Attributes Expansion\">\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-impl/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-metacardattr-map/${project.version}\n-        </bundle>\n-    </feature>\n+    <feature name=\"security-core-services-dependencies\" version=\"${project.version}\"\n+             description=\"Dependencies for core security services.\">\n+        <!-- Third Party Features -->\n+        <feature>spring</feature>\n+        <feature>war</feature>\n+        <feature>pax-jetty</feature>\n+        <feature>pax-http-jetty</feature>\n \n-    <feature name=\"security-core-misc\" version=\"${project.version}\">\n+        <!-- External DDF Features -->\n+        <feature>apache-commons</feature>\n+        <feature>guava</feature>\n         <feature>cxf-core</feature>\n-        <feature>cxf-ws-security</feature>\n-        <bundle start-level=\"40\">mvn:org.apache.cxf/cxf-rt-rs-json-basic/${cxf.version}</bundle>\n-        <bundle start-level=\"40\">mvn:org.apache.cxf/cxf-rt-rs-security-jose/${cxf.version}</bundle>\n-        <bundle>mvn:org.apache.commons/commons-jexl/2.1.1</bundle>\n-        <feature>security-core-api</feature>\n-        <feature>security-handler-api</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-handler-impl</feature>\n-        <feature>platform-util</feature>\n-        <feature prerequisite=\"true\">wrap</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.platform.security/security-rest-cxfwrapper/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.certificate/security-ocsp-checker/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.handler/security-handler-pki/${project.version}</bundle>\n-        <bundle>wrap:mvn:org.springframework.ldap/spring-ldap-core/2.3.2.RELEASE</bundle>\n-        <configfile finalname=\"${ddf.etc}/ws-security/attributeMap.properties\">\n-            mvn:ddf.security.claims/security-claims-ldap/${project.version}/properties/attributeMap\n-        </configfile>\n-    </feature>\n-\n-    <feature name=\"security-realm-saml\" version=\"${project.version}\"\n-             description=\"Security realm for SAML.\">\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <feature>security-core-impl</feature>\n-        <feature>javax-validation</feature>\n-        <feature>cxf-frontend-javascript</feature>\n-        <feature>cxf-jaxrs</feature>\n-        <feature>security-handler-api</feature>\n-        <feature>security-handler-impl</feature>\n-        <feature>security-policy-context</feature>\n-        <feature dependency=\"true\">saml-validator</feature>\n-        <feature dependency=\"true\">oidc-dependencies</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.realm/security-realm-saml/${project.version}</bundle>\n-    </feature>\n-\n-    <feature name=\"security-guest-realm\" version=\"${project.version}\"\n-             description=\"Security Guest Realm.\">\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <feature>security-core-impl</feature>\n-        <feature>javax-validation</feature>\n-        <feature>security-handler-api</feature>\n-        <feature>security-handler-impl</feature>\n-        <feature>security-policy-context</feature>\n+        <feature>cxf-rt-security</feature>\n+        <feature>cxf-ws-policy</feature>\n         <feature>cxf-frontend-javascript</feature>\n-        <feature>cxf-jaxrs</feature>\n-        <feature dependency=\"true\">oidc-dependencies</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.realm/security-realm-guest/${project.version}</bundle>\n-    </feature>\n-\n-    <feature name=\"security-jaas-ldap\" version=\"${project.version}\"\n-             description=\"Security JAAS LDAP Login.\">\n-        <feature>security-core-misc</feature>\n-        <feature>javax-validation</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:org.apache.commons/commons-pool2/2.5.0</bundle>\n-        <bundle>mvn:ddf.security.encryption/security-encryption-api/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.jaas/security-jaas-ldap/${project.version}</bundle>\n-    </feature>\n-\n-    <feature name=\"security-claims-ldap\" version=\"${project.version}\"\n-             description=\"Retrieves claims attributes from an LDAP store.\">\n-        <bundle>mvn:ddf.security.encryption/security-encryption-api/${project.version}</bundle>\n-        <feature>security-core-misc</feature>\n-        <feature>security-encryption</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.claims/security-claims-ldap/${project.version}</bundle>\n-    </feature>\n+        <feature>cxf-rs-security-oauth2</feature>\n+        <feature>cxf-rs-security-sso-saml</feature>\n+        <feature>action-core-impl</feature>\n+        <feature>error-api</feature>\n+        <feature>util-uuidgenerator</feature>\n+        <feature>camel-jetty9</feature>\n+        <feature>camel-blueprint</feature>\n+        <feature>camel-http</feature>\n \n-    <feature name=\"ldap-embedded-default-configs\" version=\"${project.version}\"\n-             description=\"Installs default embedded ldap claims handler and login configs\">\n-        <feature>ldap-embedded-default-claimshandler-config</feature>\n-        <feature>ldap-embedded-default-stslogin-config</feature>\n-    </feature>\n+        <!-- JavaX -->\n+        <bundle>mvn:javax.el/javax.el-api/3.0.0</bundle>\n+        <bundle>mvn:javax.servlet/javax.servlet-api/${javax.servlet-api-version}</bundle>\n \n-    <feature name=\"ldap-embedded-default-claimshandler-config\" version=\"${project.version}\"\n-             description=\"Installs a default embedded ldap login config\">\n-        <configfile\n-                finalname=\"${ddf.etc}/Claims_Handler_Manager-ddf.security.sts.claimsHandler.ClaimsHandlerManager.config\"\n-                override=\"false\">\n-            mvn:ddf.security.claims/security-claims-ldap/${project.version}/config/default-ldap-claimshandler\n-        </configfile>\n-    </feature>\n+        <!-- Apache -->\n+        <bundle>mvn:org.apache.commons/commons-lang3/${commons-lang3.version}</bundle>\n+        <bundle dependency=\"true\">mvn:org.apache.commons/commons-configuration2/${commons-configuration2.version}</bundle>\n+        <bundle>mvn:org.apache.commons/commons-jexl/2.1.1</bundle>\n+        <bundle>\n+            mvn:org.apache.servicemix.bundles/org.apache.servicemix.bundles.jaxen/${org.apache.servicemix.bundles.jaxen.version}\n+        </bundle>\n+        <bundle>mvn:org.apache.santuario/xmlsec/${xmlsec.version}</bundle>\n+        <bundle start-level=\"30\">mvn:org.apache.neethi/neethi/${wss4j.neethi.version}</bundle>\n+        <bundle start-level=\"40\">mvn:org.apache.cxf/cxf-rt-rs-json-basic/${cxf.version}</bundle>\n+        <bundle start-level=\"40\">mvn:org.apache.cxf/cxf-rt-rs-security-jose/${cxf.version}</bundle>\n \n-    <feature name=\"ldap-embedded-default-stslogin-config\" version=\"${project.version}\"\n-             description=\"Installs a default embedded ldap claims handler config\">\n-        <configfile\n-                finalname=\"${ddf.etc}/Ldap_Login_Config-ddf.ldap.ldaplogin.LdapLoginConfig.config\"\n-                override=\"false\">\n-            mvn:ddf.security.jaas/security-jaas-ldap/${project.version}/config/default-ldaplogin\n-        </configfile>\n-    </feature>\n+        <!-- Pax -->\n+        <config name=\"org.ops4j.pax.web\" append=\"true\">\n+            #######################################\n+            # Jetty Server Authenticator Settings\n+            #######################################\n \n-    <feature name=\"security-handler-basic\" version=\"${project.version}\"\n-             description=\"Basic Authentication Handler for web applications.\">\n-        <feature>security-core-misc</feature>\n-        <feature>parser-xml</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.handler/security-handler-basic/${project.version}</bundle>\n-    </feature>\n+            # Set the authmethod/realmname so that our JettyAuthenticator is used\n+            org.ops4j.pax.web.default.authmethod=DDF\n+            org.ops4j.pax.web.default.realmname=DDF\n+        </config>\n+        <bundle start-level=\"30\">mvn:org.ops4j.pax.web/pax-web-jsp/${pax.web.version}</bundle>\n \n-    <feature name=\"oidc-dependencies\" version=\"${project.version}\"\n-      description=\"All OIDC third party dependencies\">\n-        <feature prerequisite=\"true\">wrap</feature>\n-        <feature>jackson</feature>\n-        <bundle>mvn:com.sun.mail/javax.mail/${javax-mail.version}</bundle>\n-        <!--\n-            net.minidev/accessors-smart/1.2 uses asm v5.x. Need this resolved before we can upgrade:\n-            https://bitbucket.org/connect2id/nimbus-jose-jwt/issues/239/switch-to-other-json-library\n-        -->\n-        <bundle>mvn:org.ow2.asm/asm/5.2</bundle>\n-        <bundle>mvn:net.minidev/accessors-smart/1.2</bundle>\n-        <bundle>mvn:net.minidev/json-smart/2.3</bundle>\n-        <bundle>wrap:mvn:com.nimbusds/nimbus-jose-jwt/${nimbus.version}</bundle>\n-        <bundle>wrap:mvn:com.nimbusds/oauth2-oidc-sdk/${nimbus.oidc.version}</bundle>\n-        <bundle>mvn:com.nimbusds/content-type/${nimbus.content-type.version}</bundle>\n-        <bundle>mvn:com.nimbusds/lang-tag/${nimbus.langtag.version}</bundle>\n-        <bundle>wrap:mvn:com.github.stephenc.jcip/jcip-annotations/1.0-1</bundle>\n-        <bundle>mvn:commons-codec/commons-codec/${commons-codec.version}</bundle>\n-        <bundle>mvn:ddf.platform.security/security-oidc-bundle/${project.version}</bundle>\n+        <!-- Miscellaneous -->\n+        <bundle>mvn:com.google.code.gson/gson/${gson.version}</bundle>\n+        <bundle>wrap:mvn:org.springframework.ldap/spring-ldap-core/2.3.2.RELEASE</bundle>\n+        <bundle>wrap:mvn:net.jodah/failsafe/${jodah-failsafe.version}</bundle>\n+        <bundle>mvn:joda-time/joda-time/${joda-time.version}</bundle>\n+        <bundle>mvn:org.codice.thirdparty/commons-httpclient/3.1.0_1</bundle>\n     </feature>\n \n-    <feature name=\"security-handler-oidc\" version=\"${project.version}\"\n-             description=\"OIDC Authentication Handler for web applications.\">\n-        <feature>oidc-dependencies</feature>\n-        <feature>action-core-impl</feature>\n+    <feature name=\"security-core-services\" version=\"${project.version}\"\n+             description=\"Core security services.\">\n         <feature>security-core-impl</feature>\n-        <feature>security-handler-impl</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.handler/security-handler-oidc/${project.version}</bundle>\n-    </feature>\n+        <feature>security-core-services-dependencies</feature>\n \n-    <feature name=\"security-handler-oauth\" version=\"${project.version}\"\n-      description=\"OIDC Authentication Handler for web applications.\">\n-        <feature>oidc-dependencies</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-handler-impl</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.handler/security-handler-oauth/${project.version}</bundle>\n-    </feature>\n+        <!-- Core -->\n+        <bundle>mvn:ddf.security.core/security-core-services/${project.version}</bundle>\n \n-    <feature name=\"security-oidc-realm\" version=\"${project.version}\"\n-             description=\"OIDC Authentication Handler for web applications.\">\n-        <feature>jackson</feature>\n-        <feature dependency=\"true\">oidc-dependencies</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-handler-api</feature>\n-        <feature>security-handler-oidc</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.realm/security-realm-oidc/${project.version}</bundle>\n-    </feature>\n+        <!-- Rest Client -->\n+        <bundle>mvn:ddf.platform.security/security-rest-cxfwrapper/${project.version}</bundle>\n \n-    <feature name=\"security-filter-login\" version=\"${project.version}\"\n-             description=\"Login Filter for web applications.\">\n-        <feature>security-core-impl</feature>\n-        <feature>security-policy-context</feature>\n-        <feature>cxf-rs-security-sso-saml</feature>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <feature>javax-validation</feature>\n-        <feature>cxf-frontend-javascript</feature>\n-        <feature>security-filter-api</feature>\n-        <feature>security-handler-api</feature>\n-        <feature>security-handler-impl</feature>\n-        <feature dependency=\"true\">oidc-dependencies</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.filter/security-filter-login/${project.version}</bundle>\n-    </feature>\n+        <!-- Country Converter -->\n+        <bundle>mvn:ddf.platform.country/platform-country-converter-local/${project.version}</bundle>\n \n-    <feature name=\"security-filter-csrf\" version=\"${project.version}\"\n-             description=\"CSRF Filter for web applications.\">\n-        <feature>security-core-api</feature>\n+        <!-- Filters -->\n         <bundle>mvn:ddf.security.filter/security-filter-csrf/${project.version}</bundle>\n-    </feature>\n-\n-    <feature name=\"security-filter-authz\" version=\"${project.version}\"\n-             description=\"Authz Filter for web applications.\">\n-        <feature>security-policy-context</feature>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <feature>security-filter-api</feature>\n-        <feature>javax-validation</feature>\n-        <feature>cxf-frontend-javascript</feature>\n-        <feature>cxf-jaxrs</feature>\n-        <feature>security-handler-api</feature>\n-        <feature dependency=\"true\">oidc-dependencies</feature>\n-        <feature>security-core-services</feature>\n+        <bundle>mvn:ddf.security.filter/security-filter-web-sso/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.filter/security-filter-login/${project.version}</bundle>\n         <bundle>mvn:ddf.security.filter/security-filter-authorization/${project.version}</bundle>\n-    </feature>\n \n+        <!-- Claims -->\n+        <bundle>mvn:ddf.security.claims/security-claims-property/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.claims/security-claims-attributequery/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.claims/security-claims-certificate/${project.version}</bundle>\n \n-    <feature name=\"security-filter-web-sso\" version=\"${project.version}\"\n-             description=\"Web SSO Filter for web applications.\">\n-        <feature>security-core-impl</feature>\n-        <feature>security-filter-api</feature>\n-        <feature>security-handler-api</feature>\n-        <feature>security-policy-context</feature>\n-        <feature>security-handler-impl</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.filter/security-filter-web-sso/${project.version}</bundle>\n-    </feature>\n+        <!-- Keys and Certificates -->\n+        <bundle>mvn:ddf.security.certificate/security-certificate-keystoreeditor/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.certificate/security-certificate-generator/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.certificate/security-crl-generator/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.certificate/security-ocsp-checker/${project.version}</bundle>\n \n-    <feature name=\"security-policy-context\" version=\"${project.version}\"\n-             description=\"Web Context policy manager\">\n-        <feature>security-core-api</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.policy/security-policy-api/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.policy/security-policy-context/${project.version}</bundle>\n-    </feature>\n+        <!-- Encryption -->\n+        <bundle>mvn:ddf.security.encryption/security-encryption-impl/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.encryption/security-encryption-commands/${project.version}</bundle>\n \n-    <feature name=\"security-claims-certificate\"\n-             version=\"${project.version}\"\n-             description=\"Retrieves claims from a user's certificate.\">\n-        <feature>security-core-misc</feature>\n-        <bundle>mvn:ddf.security.claims/security-claims-certificate/${project.version}\n-        </bundle>\n-    </feature>\n+        <!-- Token Storage -->\n+        <bundle>mvn:ddf.security.storage/token-storage-impl/${project.version}</bundle>\n \n-    <feature name=\"security-claims-property\" version=\"${project.version}\"\n-             description=\"Looks up user properties via a properties file.\">\n-        <feature>security-core-misc</feature>\n-        <feature>javax-validation</feature>\n-        <bundle>mvn:ddf.security.claims/security-claims-property/${project.version}</bundle>\n-    </feature>\n+        <!-- Sessions -->\n+        <bundle>mvn:ddf.platform.security/session-management-impl/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.servlet/security-servlet-session-expiry/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.command/security-command-sessionmanager/${project.version}</bundle>\n \n-    <feature name=\"security-interceptor-guest\" version=\"${project.version}\"\n-             description=\"Injects guest user information into incoming SOAP messages.\">\n-        <feature>guava</feature>\n-        <bundle>mvn:ddf.security.encryption/security-encryption-api/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <feature>javax-validation</feature>\n-        <feature>cxf-frontend-javascript</feature>\n-        <feature>cxf-jaxrs</feature>\n-        <feature>security-handler-api</feature>\n-        <feature>security-handler-impl</feature>\n-        <feature>security-policy-context</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-encryption</feature>\n-        <feature dependency=\"true\">oidc-dependencies</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.interceptor/security-interceptor-guest/${project.version}</bundle>\n-    </feature>\n+        <!-- Expansion -->\n+        <bundle>mvn:ddf.security.expansion/security-expansion-userattr-map/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.expansion/security-expansion-metacardattr-map/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.expansion/security-expansion-commands/${project.version}</bundle>\n \n-    <feature name=\"security-claims-attributequery\"\n-             version=\"${project.version}\"\n-             description=\"Retrieves claims from external attribute store using an AttributeQuery request.\">\n-        <feature>guava</feature>\n-        <bundle>mvn:ddf.security.encryption/security-encryption-api/${project.version}</bundle>\n-        <feature>security-core-misc</feature>\n-        <feature>security-encryption</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.claims/security-claims-attributequery/${project.version}\n-        </bundle>\n-    </feature>\n+        <!-- Logout -->\n+        <bundle>mvn:ddf.security.servlet/security-servlet-logout/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.servlet/security-servlet-default-logout/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.servlet/security-servlet-logout-endpoint/${project.version}</bundle>\n \n-    <feature name=\"security-interceptor-guest-wrapper\"\n-             version=\"${project.version}\"\n-             description=\"Wrapper for Security Interceptor Guest that injects guest user information into incoming SOAP messages.\">\n-        <feature>cxf-bindings-soap</feature>\n-        <feature>cxf-ws-security</feature>\n-        <bundle>mvn:ddf.security.interceptor/security-interceptor-guest-wrapper/${project.version}\n-        </bundle>\n-    </feature>\n+        <!-- Policy Decision Point -->\n+        <configfile finalname=\"${ddf.etc}/ddf.security.pdp.realm.AuthzRealm.config\">\n+            mvn:ddf.security.pdp/security-pdp-authzrealm/${project.version}/config/default-authzrealm\n+        </configfile>\n+        <bundle>mvn:ddf.security.pdp/security-pdp-authzrealm/${project.version}</bundle>\n \n-    <feature name=\"security-guest\" version=\"${project.version}\"\n-             description=\"Contains all of the guest security features.\">\n-        <feature>security-interceptor-guest-wrapper</feature>\n-        <feature>security-interceptor-guest</feature>\n-    </feature>\n+        <!-- Context Policy -->\n+        <bundle>mvn:ddf.security.policy/security-policy-context/${project.version}</bundle>\n \n-    <feature name=\"security-servlet-session-expiry\" version=\"${project.version}\"\n-             description=\"Session expiry servlet.\">\n-        <feature>guava</feature>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <feature>javax-validation</feature>\n-        <feature>cxf-frontend-javascript</feature>\n-        <feature>cxf-jaxrs</feature>\n-        <feature>security-handler-api</feature>\n-        <feature>security-core-impl</feature>\n-        <feature dependency=\"true\">oidc-dependencies</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.platform.security/session-management-service/${project.version}</bundle>\n-        <bundle>mvn:ddf.platform.security/session-management-impl/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.servlet/security-servlet-session-expiry/${project.version}</bundle>\n-    </feature>\n+        <!-- Logging -->\n+        <bundle>mvn:ddf.security.interceptor/security-interceptor-logger/${project.version}</bundle>\n \n-    <feature name=\"security-servlet-whoami\" version=\"${project.version}\"\n-             description=\"Who Am I servlet.\">\n-        <feature>security-core-impl</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.servlet/security-servlet-whoami/${project.version}</bundle>\n-    </feature>\n+        <!-- Guest Authentication -->\n+        <bundle>mvn:ddf.security.realm/security-realm-guest/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.interceptor/security-interceptor-guest/${project.version}</bundle>\n \n-    <feature name=\"security-servlet-web-socket\" version=\"${project.version}\"\n-             description=\"Defines a secure web socket servlet type.\">\n-        <feature>security-core-api</feature>\n-        <feature>pax-http-whiteboard</feature>\n-        <bundle>mvn:ddf.security.servlet/security-servlet-web-socket/${project.version}</bundle>\n-    </feature>\n+        <!-- Basic Auth -->\n+        <bundle>mvn:ddf.security.realm/security-realm-userpass/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.handler/security-handler-basic/${project.version}</bundle>\n \n-    <feature name=\"security-handler-saml\" version=\"${project.version}\"\n-             description=\"SAML Web SSO client\">\n-        <feature>security-core-api</feature>\n-        <feature>security-handler-api</feature>\n-        <feature>javax-validation</feature>\n-        <feature>action-core-impl</feature>\n-        <feature>cxf-rs-security-sso-saml</feature>\n-        <feature>security-filter-api</feature>\n-        <feature>session-invalidator</feature>\n-        <feature>platform-paxweb-jettyconfig</feature>\n-        <feature>security-filter-login</feature>\n-        <feature>guava</feature>\n-        <feature>cxf-frontend-javascript</feature>\n-        <feature>cxf-jaxrs</feature>\n-        <feature>util-uuidgenerator</feature>\n-        <feature>security-handler-basic</feature>\n-        <feature dependency=\"true\">oidc-dependencies</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>saml-validator</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security/security-saml-util/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.handler/security-handler-saml/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.encryption/security-encryption-api/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <bundle>mvn:com.google.code.gson/gson/${gson.version}</bundle>\n-    </feature>\n+        <!-- PKI Auth -->\n+        <bundle>mvn:ddf.security.realm/security-realm-pki/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.handler/security-handler-pki/${project.version}</bundle>\n \n-    <feature name=\"saml-validator\" version=\"${project.version}\" description=\"Saml token validator\">\n-        <!--  TODO (https://github.com/codice/ddf/issues/5327)\n-                Address potential circular dependencies as part of security refactor  -->\n-        <feature>security-core-impl</feature>\n-        <feature>security-handler-impl</feature>\n-        <bundle>mvn:ddf.security.saml/saml-assertion-validator/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.saml/saml-assertion-validator-impl/${project.version}</bundle>\n-    </feature>\n+        <!-- Email -->\n+        <bundle>mvn:ddf.platform.email/platform-email-impl/${project.version}</bundle>\n \n-    <feature name=\"security-command-listener\" version=\"${project.version}\"\n-             description=\"Audits all commands entered on the Karaf command line.\">\n-        <feature>security-core-api</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-core-services</feature>\n+        <!-- Miscellaneous -->\n+        <bundle>mvn:ddf.platform/platform-paxweb-jettyconfig/${project.version}</bundle>\n+        <bundle>mvn:ddf.platform/platform-http-proxy/${project.version}</bundle>\n+        <bundle>mvn:ddf.platform.security/secure-boot/${project.version}</bundle>\n         <bundle>mvn:ddf.security.command/security-command-listener/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.servlet/security-servlet-whoami/${project.version}</bundle>\n     </feature>\n \n-    <feature name=\"security-web-sso-defaults\" version=\"${project.version}\"\n-             description=\"Installs the default features needed for web-based SSO authentication.\">\n-        <feature>security-policy-context</feature>\n-        <feature>security-expansion</feature>\n-        <feature>security-expansion-user-attributes</feature>\n-        <feature>security-expansion-metacard-attributes</feature>\n-        <feature>security-core-misc</feature>\n-        <feature>security-filter-web-sso</feature>\n-        <feature>security-filter-login</feature>\n-        <feature>security-filter-csrf</feature>\n-        <feature>security-handler-basic</feature>\n-        <feature>security-oidc-realm</feature>\n-        <feature>security-handler-oidc</feature>\n-        <feature>security-handler-oauth</feature>\n-        <feature>security-handler-saml</feature>\n-        <feature>security-filter-authz</feature>\n-        <feature>security-pdp-authz</feature>\n-        <feature>security-servlet-whoami</feature>\n-        <feature>security-servlet-session-expiry</feature>\n-        <feature>security-servlet-web-socket</feature>\n-        <feature>security-realm-saml</feature>\n-        <feature>security-guest-realm</feature>\n-        <feature>security-claims-property</feature>\n+    <feature name=\"oidc-auth\" version=\"${project.version}\"\n+             description=\"OIDC features and bundles.\">\n         <feature>security-core-services</feature>\n-    </feature>\n \n-    <feature name=\"secure-boot\" version=\"${project.version}\"\n-             description=\"Verifies that the installation is located in a secure directory.\">\n-        <bundle>mvn:ddf.platform.security/secure-boot/${project.version}</bundle>\n-    </feature>\n-\n-    <feature name=\"security-core\" version=\"${project.version}\"\n-             description=\"The Security Application provides Authentication, Authorization, and Auditing services.\\nThey comprise both a framework that developers and integrators can extend and also a reference implementation that can be used which meets security requirements.::Security\">\n-        <feature>web-container</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-policy-context</feature>\n-        <feature>security-web-sso-defaults</feature>\n-        <feature>security-guest</feature>\n-        <feature>security-command-listener</feature>\n+        <bundle>mvn:ddf.security.realm/security-realm-oidc/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.handler/security-handler-oidc/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.handler/security-handler-oauth/${project.version}</bundle>\n     </feature>\n \n-    <!-- Start of app features -->\n-\n-    <repository>mvn:ddf.features/camel/${project.version}/xml/features</repository>\n+    <feature name=\"saml-auth\" version=\"${project.version}\"\n+             description=\"SAML features and bundles.\">\n+        <feature>security-core-services</feature>\n \n-    <feature name=\"platform-http-proxy\" version=\"${project.version}\"\n-             description=\"HTTP to HTTPS proxy.\">\n-        <feature>camel-jetty9</feature>\n-        <feature>security-core-api</feature>\n-        <feature>camel-blueprint</feature>\n-        <feature>camel-http</feature>\n-        <bundle>mvn:org.codice.thirdparty/commons-httpclient/3.1.0_1</bundle>\n-        <bundle>mvn:ddf.platform/platform-http-proxy/${project.version}</bundle>\n-    </feature>\n+        <!--  TODO (https://github.com/codice/ddf/issues/5327)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTIzODgyMg=="}, "originalCommit": {"oid": "5fe3c153d747edf954bc7be7ba8835a00d20f2da"}, "originalPosition": 818}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwMDE2MzE0OnYy", "diffSide": "RIGHT", "path": "features/security/src/main/feature/feature.xml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQyMDoyOTozNVrOGscG8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQyMjo1MToxNVrOGsfC-w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTI1MTA1Ng==", "bodyText": "Was the http proxy enabled by default before? Imo it might be better to leave it uninstalled out of the box, and let people install it if they need it.", "url": "https://github.com/codice/ddf/pull/6155#discussion_r449251056", "createdAt": "2020-07-02T20:29:35Z", "author": {"login": "SmithJosh"}, "path": "features/security/src/main/feature/feature.xml", "diffHunk": "@@ -21,694 +21,317 @@\n     <repository>mvn:ddf.features/kernel/${project.version}/xml/features</repository>\n     <repository>mvn:ddf.features/utilities/${project.version}/xml/features</repository>\n     <repository>mvn:ddf.features/branding/${project.version}/xml/features</repository>\n+    <repository>mvn:ddf.features/camel/${project.version}/xml/features</repository>\n \n-    <feature name=\"security-logger\" version=\"${project.version}\"\n-             description=\"Logs incoming and outgoing requests\">\n-        <feature>security-core-api</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.interceptor/security-interceptor-logger/${project.version}</bundle>\n-    </feature>\n+    <feature name=\"security-core-api-dependencies\" version=\"${project.version\"\n+             description=\"Dependencies for the core security APIs.\">\n+        <!-- Third Party Features -->\n+        <feature prerequisite=\"true\">wrap</feature>\n+        <feature>pax-http-whiteboard</feature>\n \n-    <feature name=\"security-core-api\" version=\"${project.version}\"\n-             description=\"Security Core\">\n-        <bundle start-level=\"30\">mvn:org.apache.neethi/neethi/${wss4j.neethi.version}</bundle>\n-        <feature>cxf-rt-security</feature>\n-        <feature>security-filter-api</feature>\n+        <!-- External DDF Features -->\n+        <feature>jackson</feature>\n+        <feature>wss4j</feature>\n+        <feature>cxf-ws-security</feature>\n         <feature>cxf-jaxrs</feature>\n-        <feature>platform-util</feature>\n-        <bundle dependency=\"true\">mvn:ddf.platform.security/log-sanitizer/${project.version}</bundle>\n-        <bundle dependency=\"true\">mvn:org.apache.commons/commons-configuration2/${commons-configuration2.version}</bundle>\n-        <bundle dependency=\"true\">mvn:org.apache.shiro/shiro-core/${apache.shiro.version}</bundle>\n-\n-        <feature>guava</feature>\n+        <feature>cxf-bindings-soap</feature>\n         <feature>common-system</feature>\n \n-        <bundle>mvn:joda-time/joda-time/${joda-time.version}</bundle>\n-        <bundle>mvn:org.apache.santuario/xmlsec/${xmlsec.version}</bundle>\n+        <!-- NimbusDS -->\n+        <bundle>wrap:mvn:com.nimbusds/nimbus-jose-jwt/${nimbus.version}</bundle>\n+        <bundle>wrap:mvn:com.nimbusds/oauth2-oidc-sdk/${nimbus.oidc.version}</bundle>\n+        <bundle>mvn:com.nimbusds/content-type/${nimbus.content-type.version}</bundle>\n+        <bundle>mvn:com.nimbusds/lang-tag/${nimbus.langtag.version}</bundle>\n \n-        <feature>cxf-bindings-soap</feature>\n-        <feature>cxf-ws-policy</feature>\n-        <feature>cxf-ws-security</feature>\n-        <feature>spring</feature>\n+        <!-- MiniDev -->\n+        <bundle>mvn:net.minidev/accessors-smart/1.2</bundle>\n+        <bundle>mvn:net.minidev/json-smart/2.3</bundle>\n \n-        <!--  TODO (https://github.com/codice/ddf/issues/5327)\n-                Remove wrapped OpenSAML after security refactor is complete  -->\n-        <!--  <bundle>mvn:org.apache.servicemix.bundles/org.apache.servicemix.bundles.opensaml/${opensaml.osgi.version}-->\n-        <!--  </bundle>-->\n-        <bundle>mvn:ddf.lib.bundles/libs-bundles-opensaml/${project.version}</bundle>\n+        <!-- Miscellaneous -->\n+        <bundle dependency=\"true\">mvn:org.apache.shiro/shiro-core/${apache.shiro.version}</bundle>\n+        <bundle>mvn:com.sun.mail/javax.mail/${javax-mail.version}</bundle>\n+        <!--\n+            net.minidev/accessors-smart/1.2 uses asm v5.x. Need this resolved before we can upgrade:\n+            https://bitbucket.org/connect2id/nimbus-jose-jwt/issues/239/switch-to-other-json-library\n+        -->\n+        <bundle>mvn:org.ow2.asm/asm/5.2</bundle>\n+        <bundle>wrap:mvn:com.github.stephenc.jcip/jcip-annotations/1.0-1</bundle>\n+    </feature>\n \n+    <feature name=\"security-core-api\" version=\"${project.version}\"\n+             description=\"Core security APIs.\">\n+        <feature>security-core-api-dependencies</feature>\n+\n+        <!-- Core -->\n         <bundle>mvn:ddf.security.core/security-core-api/${project.version}</bundle>\n+\n+        <!-- Country Converter -->\n+        <bundle>mvn:ddf.platform.country/platform-country-converter-api/${project.version}</bundle>\n+\n+        <!-- Rest Client -->\n         <bundle>mvn:ddf.platform.security/security-rest-clientapi/${project.version}</bundle>\n-        <bundle>\n-            mvn:org.apache.servicemix.bundles/org.apache.servicemix.bundles.jaxen/${org.apache.servicemix.bundles.jaxen.version}\n-        </bundle>\n-    </feature>\n \n-    <feature name=\"security-filter-api\" version=\"${project.version}\">\n-        <bundle>mvn:javax.servlet/javax.servlet-api/${javax.servlet-api-version}</bundle>\n+        <!-- Filters -->\n         <bundle>mvn:ddf.platform/security-filter-api/${project.version}</bundle>\n-    </feature>\n \n-    <feature name=\"platform-error-page-injector\" version=\"${project.version}\"\n-             description=\"Adding a better error page to Jetty\">\n-        <feature>error-api</feature>\n-        <bundle>mvn:ddf.platform.error/platform-error-page-injector/${project.version}</bundle>\n-    </feature>\n+        <!-- Handlers -->\n+        <bundle>mvn:ddf.security.handler/security-handler-api/${project.version}</bundle>\n \n-    <feature name=\"security-encryption\" version=\"${project.version}\"\n-             description=\"Security Encryption\">\n-        <feature>wss4j</feature>\n-        <bundle>mvn:org.apache.commons/commons-lang3/${commons-lang3.version}</bundle>\n+        <!-- Policy -->\n+        <bundle>mvn:ddf.security.policy/security-policy-api/${project.version}</bundle>\n+\n+        <!-- Encryption -->\n         <bundle>mvn:ddf.security.encryption/security-encryption-api/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.encryption/security-encryption-impl/${project.version}</bundle>\n-        <bundle dependency=\"true\">mvn:ddf.platform.security/log-sanitizer/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.encryption/security-encryption-commands/${project.version}</bundle>\n-    </feature>\n \n-    <feature name=\"web-container\" version=\"${project.version}\">\n-        <feature>platform-paxweb-jettyconfig</feature>\n-        <feature>platform-error-page-injector</feature>\n-        <feature>war</feature>\n-    </feature>\n+        <!-- Expansion -->\n+        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n \n-    <feature name=\"session-invalidator\" version=\"${project.version}\"\n-             description=\"API for invalidating servlet sessions\">\n-        <bundle>mvn:ddf.platform/platform-session-invalidator/${project.version}</bundle>\n-    </feature>\n+        <!-- Token Storage -->\n+        <bundle>mvn:ddf.security.storage/token-storage-api/${project.version}</bundle>\n \n-    <feature name=\"platform-paxweb-jettyconfig\" version=\"${project.version}\"\n-      description=\"Custom Session Manager\">\n-        <config name=\"org.ops4j.pax.web\" append=\"true\">\n-#######################################\n-# Jetty Server Authenticator Settings\n-#######################################\n+        <!-- Sessions -->\n+        <bundle>mvn:ddf.platform.security/session-management-api/${project.version}</bundle>\n+        <bundle>mvn:ddf.platform/platform-session-invalidator-api/${project.version}</bundle>\n \n-# Set the authmethod/realmname so that our JettyAuthenticator is used\n-org.ops4j.pax.web.default.authmethod=DDF\n-org.ops4j.pax.web.default.realmname=DDF\n-        </config>\n-        <feature version=\"${spring.version}_1\">spring</feature>\n-        <feature>apache-commons</feature>\n-        <feature>security-core-api</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-core-services</feature>\n-        <feature>security-filter-api</feature>\n-        <feature>pax-http-jetty</feature>\n-        <bundle start-level=\"30\">mvn:org.ops4j.pax.web/pax-web-jsp/${pax.web.version}</bundle>\n-        <bundle>mvn:javax.el/javax.el-api/3.0.0</bundle>\n-        <feature>pax-jetty</feature>\n-        <feature>session-invalidator</feature>\n-        <feature prerequisite=\"true\">wrap</feature>\n-        <bundle>wrap:mvn:net.jodah/failsafe/${jodah-failsafe.version}</bundle>\n-        <feature>guava</feature>\n-        <feature>common-system</feature>\n-        <bundle>mvn:ddf.platform/platform-paxweb-jettyconfig/${project.version}</bundle>\n-    </feature>\n+        <!-- Logout -->\n+        <bundle>mvn:ddf.security.servlet/security-servlet-logout-api/${project.version}</bundle>\n \n-    <feature name=\"security-handler-api\" version=\"${project.version}\"\n-             description=\"API for authentication handlers for web applications.\">\n-        <feature>security-core-api</feature>\n-        <feature>parser-xml</feature>\n-        <feature>oidc-dependencies</feature>\n-        <bundle>mvn:org.apache.cxf/cxf-rt-rs-security-jose/${cxf.version}</bundle>\n-        <bundle>mvn:org.apache.cxf/cxf-rt-rs-security-jose-jaxrs/${cxf.version}</bundle>\n-        <bundle>mvn:ddf.security.handler/security-handler-api/${project.version}</bundle>\n-    </feature>\n+        <!-- Email -->\n+        <bundle>mvn:ddf.platform.email/platform-email-api/${project.version}</bundle>\n \n-    <feature name=\"security-handler-impl\" version=\"${project.version}\"\n-             description=\"Implementation used by all security handlers\">\n-        <feature>security-core-api</feature>\n-        <feature>security-core-impl</feature>\n-        <bundle>mvn:ddf.security.handler/security-handler-impl/${project.version}</bundle>\n+        <!-- Miscellaneous -->\n+        <bundle>mvn:ddf.security.servlet/security-servlet-web-socket-api/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.interceptor/security-interceptor-guest-wrapper/${project.version}</bundle>\n+        <bundle>mvn:ddf.platform.security/security-oidc-bundle/${project.version}</bundle>\n+        <bundle dependency=\"true\">mvn:ddf.platform.security/log-sanitizer/${project.version}</bundle>\n     </feature>\n \n-    <feature name=\"security-token-storage\" version=\"${project.version}\"\n-             description=\"OAuth token storage api and file storage implementation.\">\n-        <feature>apache-commons</feature>\n-        <bundle>mvn:com.google.code.gson/gson/${gson.version}</bundle>\n-        <bundle>mvn:ddf.security.storage/token-storage-api/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.storage/token-storage-impl/${project.version}</bundle>\n+    <feature name=\"security-core-impl-dependencies\" version=\"${project.version}\"\n+             description=\"Dependencies for core security implementations.\">\n+        <!-- External DDF Features -->\n+        <feature>javax-validation</feature>\n+        <feature>parser-xml</feature>\n+        <feature>platform-util</feature>\n     </feature>\n \n     <feature name=\"security-core-impl\" version=\"${project.version}\"\n-             description=\"Security Core\">\n+             description=\"Core security implementations.\">\n         <feature>security-core-api</feature>\n-        <feature>security-handler-api</feature>\n-        <feature>security-encryption</feature>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <bundle>mvn:ddf.platform.util/util-uuidgenerator-api/${project.version}</bundle>\n-        <feature>javax-validation</feature>\n-        <feature>cxf-frontend-javascript</feature>\n-        <bundle>mvn:javax.servlet/javax.servlet-api/${javax.servlet-api.version}</bundle>\n-        <feature>cxf-jaxrs</feature>\n-        <feature>util-uuidgenerator</feature>\n-        <feature dependency=\"true\">oidc-dependencies</feature>\n-        <feature>security-token-storage</feature>\n-        <feature>cxf-rs-security-oauth2</feature>\n-        <feature>platform-util</feature>\n+        <feature>security-core-impl-dependencies</feature>\n+\n+        <!-- Core -->\n         <bundle>mvn:ddf.security.core/security-core-impl/${project.version}</bundle>\n-    </feature>\n \n-    <feature name=\"security-core-services\" version=\"${project.version}\"\n-             description=\"Main security services\">\n-        <feature>security-core-impl</feature>\n-        <feature>security-handler-impl</feature>\n-        <bundle>mvn:ddf.security.core/security-core-services/${project.version}</bundle>\n-        <bundle>mvn:ddf.platform.security/security-rest-cxfwrapper/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.realm/security-realm-pki/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.realm/security-realm-userpass/${project.version}</bundle>\n-    </feature>\n+        <!-- Handlers -->\n+        <bundle>mvn:ddf.security.handler/security-handler-impl/${project.version}</bundle>\n \n-    <feature name=\"security-expansion\" version=\"${project.version}\"\n-             description=\"Security Expansion\">\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n+        <!-- Expansion -->\n         <bundle>mvn:ddf.security.expansion/security-expansion-impl/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-commands/${project.version}</bundle>\n-    </feature>\n-\n-    <feature name=\"security-pdp-authz\" version=\"${project.version}\"\n-             description=\"Security PDP.\">\n-        <configfile finalname=\"${ddf.etc}/ddf.security.pdp.realm.AuthzRealm.config\">\n-            mvn:ddf.security.pdp/security-pdp-authzrealm/${project.version}/config/default-authzrealm\n-        </configfile>\n-        <feature>security-core-impl</feature>\n-        <feature dependency=\"true\">oidc-dependencies</feature>\n-        <feature>security-expansion</feature>\n-        <feature>security-expansion-user-attributes</feature>\n-        <feature>security-expansion-metacard-attributes</feature>\n-        <feature>javax-validation</feature>\n \n-        <feature>cxf-frontend-javascript</feature>\n-        <feature>cxf-jaxrs</feature>\n-        <feature>parser-xml</feature>\n-        <feature>security-handler-api</feature>\n-        <feature>platform-util</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.pdp/security-pdp-authzrealm/${project.version}</bundle>\n-    </feature>\n-\n-    <feature name=\"security-pep-serviceauthz\" version=\"${project.version}\"\n-             description=\"Security PEP Service AuthZ\">\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <feature>javax-validation</feature>\n-        <feature>cxf-frontend-javascript</feature>\n-        <feature>cxf-jaxrs</feature>\n-        <bundle>mvn:ddf.security.encryption/security-encryption-api/${project.version}</bundle>\n-        <feature>security-handler-api</feature>\n-        <feature dependency=\"true\">oidc-dependencies</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-core-services</feature>\n+        <!-- Policy Extension Point -->\n         <bundle>mvn:ddf.security.pep/security-pep-interceptor/${project.version}</bundle>\n     </feature>\n \n-    <feature name=\"security-expansion-user-attributes\" version=\"${project.version}\"\n-             description=\"Security Expansion User Attributes Expansion\">\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-impl/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-userattr-map/${project.version}\n-        </bundle>\n-    </feature>\n-\n-    <feature name=\"security-expansion-metacard-attributes\" version=\"${project.version}\"\n-             description=\"Security Expansion Metacard Attributes Expansion\">\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-impl/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-metacardattr-map/${project.version}\n-        </bundle>\n-    </feature>\n+    <feature name=\"security-core-services-dependencies\" version=\"${project.version}\"\n+             description=\"Dependencies for core security services.\">\n+        <!-- Third Party Features -->\n+        <feature>spring</feature>\n+        <feature>war</feature>\n+        <feature>pax-jetty</feature>\n+        <feature>pax-http-jetty</feature>\n \n-    <feature name=\"security-core-misc\" version=\"${project.version}\">\n+        <!-- External DDF Features -->\n+        <feature>apache-commons</feature>\n+        <feature>guava</feature>\n         <feature>cxf-core</feature>\n-        <feature>cxf-ws-security</feature>\n-        <bundle start-level=\"40\">mvn:org.apache.cxf/cxf-rt-rs-json-basic/${cxf.version}</bundle>\n-        <bundle start-level=\"40\">mvn:org.apache.cxf/cxf-rt-rs-security-jose/${cxf.version}</bundle>\n-        <bundle>mvn:org.apache.commons/commons-jexl/2.1.1</bundle>\n-        <feature>security-core-api</feature>\n-        <feature>security-handler-api</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-handler-impl</feature>\n-        <feature>platform-util</feature>\n-        <feature prerequisite=\"true\">wrap</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.platform.security/security-rest-cxfwrapper/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.certificate/security-ocsp-checker/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.handler/security-handler-pki/${project.version}</bundle>\n-        <bundle>wrap:mvn:org.springframework.ldap/spring-ldap-core/2.3.2.RELEASE</bundle>\n-        <configfile finalname=\"${ddf.etc}/ws-security/attributeMap.properties\">\n-            mvn:ddf.security.claims/security-claims-ldap/${project.version}/properties/attributeMap\n-        </configfile>\n-    </feature>\n-\n-    <feature name=\"security-realm-saml\" version=\"${project.version}\"\n-             description=\"Security realm for SAML.\">\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <feature>security-core-impl</feature>\n-        <feature>javax-validation</feature>\n-        <feature>cxf-frontend-javascript</feature>\n-        <feature>cxf-jaxrs</feature>\n-        <feature>security-handler-api</feature>\n-        <feature>security-handler-impl</feature>\n-        <feature>security-policy-context</feature>\n-        <feature dependency=\"true\">saml-validator</feature>\n-        <feature dependency=\"true\">oidc-dependencies</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.realm/security-realm-saml/${project.version}</bundle>\n-    </feature>\n-\n-    <feature name=\"security-guest-realm\" version=\"${project.version}\"\n-             description=\"Security Guest Realm.\">\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <feature>security-core-impl</feature>\n-        <feature>javax-validation</feature>\n-        <feature>security-handler-api</feature>\n-        <feature>security-handler-impl</feature>\n-        <feature>security-policy-context</feature>\n+        <feature>cxf-rt-security</feature>\n+        <feature>cxf-ws-policy</feature>\n         <feature>cxf-frontend-javascript</feature>\n-        <feature>cxf-jaxrs</feature>\n-        <feature dependency=\"true\">oidc-dependencies</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.realm/security-realm-guest/${project.version}</bundle>\n-    </feature>\n-\n-    <feature name=\"security-jaas-ldap\" version=\"${project.version}\"\n-             description=\"Security JAAS LDAP Login.\">\n-        <feature>security-core-misc</feature>\n-        <feature>javax-validation</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:org.apache.commons/commons-pool2/2.5.0</bundle>\n-        <bundle>mvn:ddf.security.encryption/security-encryption-api/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.jaas/security-jaas-ldap/${project.version}</bundle>\n-    </feature>\n-\n-    <feature name=\"security-claims-ldap\" version=\"${project.version}\"\n-             description=\"Retrieves claims attributes from an LDAP store.\">\n-        <bundle>mvn:ddf.security.encryption/security-encryption-api/${project.version}</bundle>\n-        <feature>security-core-misc</feature>\n-        <feature>security-encryption</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.claims/security-claims-ldap/${project.version}</bundle>\n-    </feature>\n+        <feature>cxf-rs-security-oauth2</feature>\n+        <feature>cxf-rs-security-sso-saml</feature>\n+        <feature>action-core-impl</feature>\n+        <feature>error-api</feature>\n+        <feature>util-uuidgenerator</feature>\n+        <feature>camel-jetty9</feature>\n+        <feature>camel-blueprint</feature>\n+        <feature>camel-http</feature>\n \n-    <feature name=\"ldap-embedded-default-configs\" version=\"${project.version}\"\n-             description=\"Installs default embedded ldap claims handler and login configs\">\n-        <feature>ldap-embedded-default-claimshandler-config</feature>\n-        <feature>ldap-embedded-default-stslogin-config</feature>\n-    </feature>\n+        <!-- JavaX -->\n+        <bundle>mvn:javax.el/javax.el-api/3.0.0</bundle>\n+        <bundle>mvn:javax.servlet/javax.servlet-api/${javax.servlet-api-version}</bundle>\n \n-    <feature name=\"ldap-embedded-default-claimshandler-config\" version=\"${project.version}\"\n-             description=\"Installs a default embedded ldap login config\">\n-        <configfile\n-                finalname=\"${ddf.etc}/Claims_Handler_Manager-ddf.security.sts.claimsHandler.ClaimsHandlerManager.config\"\n-                override=\"false\">\n-            mvn:ddf.security.claims/security-claims-ldap/${project.version}/config/default-ldap-claimshandler\n-        </configfile>\n-    </feature>\n+        <!-- Apache -->\n+        <bundle>mvn:org.apache.commons/commons-lang3/${commons-lang3.version}</bundle>\n+        <bundle dependency=\"true\">mvn:org.apache.commons/commons-configuration2/${commons-configuration2.version}</bundle>\n+        <bundle>mvn:org.apache.commons/commons-jexl/2.1.1</bundle>\n+        <bundle>\n+            mvn:org.apache.servicemix.bundles/org.apache.servicemix.bundles.jaxen/${org.apache.servicemix.bundles.jaxen.version}\n+        </bundle>\n+        <bundle>mvn:org.apache.santuario/xmlsec/${xmlsec.version}</bundle>\n+        <bundle start-level=\"30\">mvn:org.apache.neethi/neethi/${wss4j.neethi.version}</bundle>\n+        <bundle start-level=\"40\">mvn:org.apache.cxf/cxf-rt-rs-json-basic/${cxf.version}</bundle>\n+        <bundle start-level=\"40\">mvn:org.apache.cxf/cxf-rt-rs-security-jose/${cxf.version}</bundle>\n \n-    <feature name=\"ldap-embedded-default-stslogin-config\" version=\"${project.version}\"\n-             description=\"Installs a default embedded ldap claims handler config\">\n-        <configfile\n-                finalname=\"${ddf.etc}/Ldap_Login_Config-ddf.ldap.ldaplogin.LdapLoginConfig.config\"\n-                override=\"false\">\n-            mvn:ddf.security.jaas/security-jaas-ldap/${project.version}/config/default-ldaplogin\n-        </configfile>\n-    </feature>\n+        <!-- Pax -->\n+        <config name=\"org.ops4j.pax.web\" append=\"true\">\n+            #######################################\n+            # Jetty Server Authenticator Settings\n+            #######################################\n \n-    <feature name=\"security-handler-basic\" version=\"${project.version}\"\n-             description=\"Basic Authentication Handler for web applications.\">\n-        <feature>security-core-misc</feature>\n-        <feature>parser-xml</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.handler/security-handler-basic/${project.version}</bundle>\n-    </feature>\n+            # Set the authmethod/realmname so that our JettyAuthenticator is used\n+            org.ops4j.pax.web.default.authmethod=DDF\n+            org.ops4j.pax.web.default.realmname=DDF\n+        </config>\n+        <bundle start-level=\"30\">mvn:org.ops4j.pax.web/pax-web-jsp/${pax.web.version}</bundle>\n \n-    <feature name=\"oidc-dependencies\" version=\"${project.version}\"\n-      description=\"All OIDC third party dependencies\">\n-        <feature prerequisite=\"true\">wrap</feature>\n-        <feature>jackson</feature>\n-        <bundle>mvn:com.sun.mail/javax.mail/${javax-mail.version}</bundle>\n-        <!--\n-            net.minidev/accessors-smart/1.2 uses asm v5.x. Need this resolved before we can upgrade:\n-            https://bitbucket.org/connect2id/nimbus-jose-jwt/issues/239/switch-to-other-json-library\n-        -->\n-        <bundle>mvn:org.ow2.asm/asm/5.2</bundle>\n-        <bundle>mvn:net.minidev/accessors-smart/1.2</bundle>\n-        <bundle>mvn:net.minidev/json-smart/2.3</bundle>\n-        <bundle>wrap:mvn:com.nimbusds/nimbus-jose-jwt/${nimbus.version}</bundle>\n-        <bundle>wrap:mvn:com.nimbusds/oauth2-oidc-sdk/${nimbus.oidc.version}</bundle>\n-        <bundle>mvn:com.nimbusds/content-type/${nimbus.content-type.version}</bundle>\n-        <bundle>mvn:com.nimbusds/lang-tag/${nimbus.langtag.version}</bundle>\n-        <bundle>wrap:mvn:com.github.stephenc.jcip/jcip-annotations/1.0-1</bundle>\n-        <bundle>mvn:commons-codec/commons-codec/${commons-codec.version}</bundle>\n-        <bundle>mvn:ddf.platform.security/security-oidc-bundle/${project.version}</bundle>\n+        <!-- Miscellaneous -->\n+        <bundle>mvn:com.google.code.gson/gson/${gson.version}</bundle>\n+        <bundle>wrap:mvn:org.springframework.ldap/spring-ldap-core/2.3.2.RELEASE</bundle>\n+        <bundle>wrap:mvn:net.jodah/failsafe/${jodah-failsafe.version}</bundle>\n+        <bundle>mvn:joda-time/joda-time/${joda-time.version}</bundle>\n+        <bundle>mvn:org.codice.thirdparty/commons-httpclient/3.1.0_1</bundle>\n     </feature>\n \n-    <feature name=\"security-handler-oidc\" version=\"${project.version}\"\n-             description=\"OIDC Authentication Handler for web applications.\">\n-        <feature>oidc-dependencies</feature>\n-        <feature>action-core-impl</feature>\n+    <feature name=\"security-core-services\" version=\"${project.version}\"\n+             description=\"Core security services.\">\n         <feature>security-core-impl</feature>\n-        <feature>security-handler-impl</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.handler/security-handler-oidc/${project.version}</bundle>\n-    </feature>\n+        <feature>security-core-services-dependencies</feature>\n \n-    <feature name=\"security-handler-oauth\" version=\"${project.version}\"\n-      description=\"OIDC Authentication Handler for web applications.\">\n-        <feature>oidc-dependencies</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-handler-impl</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.handler/security-handler-oauth/${project.version}</bundle>\n-    </feature>\n+        <!-- Core -->\n+        <bundle>mvn:ddf.security.core/security-core-services/${project.version}</bundle>\n \n-    <feature name=\"security-oidc-realm\" version=\"${project.version}\"\n-             description=\"OIDC Authentication Handler for web applications.\">\n-        <feature>jackson</feature>\n-        <feature dependency=\"true\">oidc-dependencies</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-handler-api</feature>\n-        <feature>security-handler-oidc</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.realm/security-realm-oidc/${project.version}</bundle>\n-    </feature>\n+        <!-- Rest Client -->\n+        <bundle>mvn:ddf.platform.security/security-rest-cxfwrapper/${project.version}</bundle>\n \n-    <feature name=\"security-filter-login\" version=\"${project.version}\"\n-             description=\"Login Filter for web applications.\">\n-        <feature>security-core-impl</feature>\n-        <feature>security-policy-context</feature>\n-        <feature>cxf-rs-security-sso-saml</feature>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <feature>javax-validation</feature>\n-        <feature>cxf-frontend-javascript</feature>\n-        <feature>security-filter-api</feature>\n-        <feature>security-handler-api</feature>\n-        <feature>security-handler-impl</feature>\n-        <feature dependency=\"true\">oidc-dependencies</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.filter/security-filter-login/${project.version}</bundle>\n-    </feature>\n+        <!-- Country Converter -->\n+        <bundle>mvn:ddf.platform.country/platform-country-converter-local/${project.version}</bundle>\n \n-    <feature name=\"security-filter-csrf\" version=\"${project.version}\"\n-             description=\"CSRF Filter for web applications.\">\n-        <feature>security-core-api</feature>\n+        <!-- Filters -->\n         <bundle>mvn:ddf.security.filter/security-filter-csrf/${project.version}</bundle>\n-    </feature>\n-\n-    <feature name=\"security-filter-authz\" version=\"${project.version}\"\n-             description=\"Authz Filter for web applications.\">\n-        <feature>security-policy-context</feature>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <feature>security-filter-api</feature>\n-        <feature>javax-validation</feature>\n-        <feature>cxf-frontend-javascript</feature>\n-        <feature>cxf-jaxrs</feature>\n-        <feature>security-handler-api</feature>\n-        <feature dependency=\"true\">oidc-dependencies</feature>\n-        <feature>security-core-services</feature>\n+        <bundle>mvn:ddf.security.filter/security-filter-web-sso/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.filter/security-filter-login/${project.version}</bundle>\n         <bundle>mvn:ddf.security.filter/security-filter-authorization/${project.version}</bundle>\n-    </feature>\n \n+        <!-- Claims -->\n+        <bundle>mvn:ddf.security.claims/security-claims-property/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.claims/security-claims-attributequery/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.claims/security-claims-certificate/${project.version}</bundle>\n \n-    <feature name=\"security-filter-web-sso\" version=\"${project.version}\"\n-             description=\"Web SSO Filter for web applications.\">\n-        <feature>security-core-impl</feature>\n-        <feature>security-filter-api</feature>\n-        <feature>security-handler-api</feature>\n-        <feature>security-policy-context</feature>\n-        <feature>security-handler-impl</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.filter/security-filter-web-sso/${project.version}</bundle>\n-    </feature>\n+        <!-- Keys and Certificates -->\n+        <bundle>mvn:ddf.security.certificate/security-certificate-keystoreeditor/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.certificate/security-certificate-generator/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.certificate/security-crl-generator/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.certificate/security-ocsp-checker/${project.version}</bundle>\n \n-    <feature name=\"security-policy-context\" version=\"${project.version}\"\n-             description=\"Web Context policy manager\">\n-        <feature>security-core-api</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.policy/security-policy-api/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.policy/security-policy-context/${project.version}</bundle>\n-    </feature>\n+        <!-- Encryption -->\n+        <bundle>mvn:ddf.security.encryption/security-encryption-impl/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.encryption/security-encryption-commands/${project.version}</bundle>\n \n-    <feature name=\"security-claims-certificate\"\n-             version=\"${project.version}\"\n-             description=\"Retrieves claims from a user's certificate.\">\n-        <feature>security-core-misc</feature>\n-        <bundle>mvn:ddf.security.claims/security-claims-certificate/${project.version}\n-        </bundle>\n-    </feature>\n+        <!-- Token Storage -->\n+        <bundle>mvn:ddf.security.storage/token-storage-impl/${project.version}</bundle>\n \n-    <feature name=\"security-claims-property\" version=\"${project.version}\"\n-             description=\"Looks up user properties via a properties file.\">\n-        <feature>security-core-misc</feature>\n-        <feature>javax-validation</feature>\n-        <bundle>mvn:ddf.security.claims/security-claims-property/${project.version}</bundle>\n-    </feature>\n+        <!-- Sessions -->\n+        <bundle>mvn:ddf.platform.security/session-management-impl/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.servlet/security-servlet-session-expiry/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.command/security-command-sessionmanager/${project.version}</bundle>\n \n-    <feature name=\"security-interceptor-guest\" version=\"${project.version}\"\n-             description=\"Injects guest user information into incoming SOAP messages.\">\n-        <feature>guava</feature>\n-        <bundle>mvn:ddf.security.encryption/security-encryption-api/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <feature>javax-validation</feature>\n-        <feature>cxf-frontend-javascript</feature>\n-        <feature>cxf-jaxrs</feature>\n-        <feature>security-handler-api</feature>\n-        <feature>security-handler-impl</feature>\n-        <feature>security-policy-context</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-encryption</feature>\n-        <feature dependency=\"true\">oidc-dependencies</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.interceptor/security-interceptor-guest/${project.version}</bundle>\n-    </feature>\n+        <!-- Expansion -->\n+        <bundle>mvn:ddf.security.expansion/security-expansion-userattr-map/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.expansion/security-expansion-metacardattr-map/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.expansion/security-expansion-commands/${project.version}</bundle>\n \n-    <feature name=\"security-claims-attributequery\"\n-             version=\"${project.version}\"\n-             description=\"Retrieves claims from external attribute store using an AttributeQuery request.\">\n-        <feature>guava</feature>\n-        <bundle>mvn:ddf.security.encryption/security-encryption-api/${project.version}</bundle>\n-        <feature>security-core-misc</feature>\n-        <feature>security-encryption</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.claims/security-claims-attributequery/${project.version}\n-        </bundle>\n-    </feature>\n+        <!-- Logout -->\n+        <bundle>mvn:ddf.security.servlet/security-servlet-logout/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.servlet/security-servlet-default-logout/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.servlet/security-servlet-logout-endpoint/${project.version}</bundle>\n \n-    <feature name=\"security-interceptor-guest-wrapper\"\n-             version=\"${project.version}\"\n-             description=\"Wrapper for Security Interceptor Guest that injects guest user information into incoming SOAP messages.\">\n-        <feature>cxf-bindings-soap</feature>\n-        <feature>cxf-ws-security</feature>\n-        <bundle>mvn:ddf.security.interceptor/security-interceptor-guest-wrapper/${project.version}\n-        </bundle>\n-    </feature>\n+        <!-- Policy Decision Point -->\n+        <configfile finalname=\"${ddf.etc}/ddf.security.pdp.realm.AuthzRealm.config\">\n+            mvn:ddf.security.pdp/security-pdp-authzrealm/${project.version}/config/default-authzrealm\n+        </configfile>\n+        <bundle>mvn:ddf.security.pdp/security-pdp-authzrealm/${project.version}</bundle>\n \n-    <feature name=\"security-guest\" version=\"${project.version}\"\n-             description=\"Contains all of the guest security features.\">\n-        <feature>security-interceptor-guest-wrapper</feature>\n-        <feature>security-interceptor-guest</feature>\n-    </feature>\n+        <!-- Context Policy -->\n+        <bundle>mvn:ddf.security.policy/security-policy-context/${project.version}</bundle>\n \n-    <feature name=\"security-servlet-session-expiry\" version=\"${project.version}\"\n-             description=\"Session expiry servlet.\">\n-        <feature>guava</feature>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <feature>javax-validation</feature>\n-        <feature>cxf-frontend-javascript</feature>\n-        <feature>cxf-jaxrs</feature>\n-        <feature>security-handler-api</feature>\n-        <feature>security-core-impl</feature>\n-        <feature dependency=\"true\">oidc-dependencies</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.platform.security/session-management-service/${project.version}</bundle>\n-        <bundle>mvn:ddf.platform.security/session-management-impl/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.servlet/security-servlet-session-expiry/${project.version}</bundle>\n-    </feature>\n+        <!-- Logging -->\n+        <bundle>mvn:ddf.security.interceptor/security-interceptor-logger/${project.version}</bundle>\n \n-    <feature name=\"security-servlet-whoami\" version=\"${project.version}\"\n-             description=\"Who Am I servlet.\">\n-        <feature>security-core-impl</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.servlet/security-servlet-whoami/${project.version}</bundle>\n-    </feature>\n+        <!-- Guest Authentication -->\n+        <bundle>mvn:ddf.security.realm/security-realm-guest/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.interceptor/security-interceptor-guest/${project.version}</bundle>\n \n-    <feature name=\"security-servlet-web-socket\" version=\"${project.version}\"\n-             description=\"Defines a secure web socket servlet type.\">\n-        <feature>security-core-api</feature>\n-        <feature>pax-http-whiteboard</feature>\n-        <bundle>mvn:ddf.security.servlet/security-servlet-web-socket/${project.version}</bundle>\n-    </feature>\n+        <!-- Basic Auth -->\n+        <bundle>mvn:ddf.security.realm/security-realm-userpass/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.handler/security-handler-basic/${project.version}</bundle>\n \n-    <feature name=\"security-handler-saml\" version=\"${project.version}\"\n-             description=\"SAML Web SSO client\">\n-        <feature>security-core-api</feature>\n-        <feature>security-handler-api</feature>\n-        <feature>javax-validation</feature>\n-        <feature>action-core-impl</feature>\n-        <feature>cxf-rs-security-sso-saml</feature>\n-        <feature>security-filter-api</feature>\n-        <feature>session-invalidator</feature>\n-        <feature>platform-paxweb-jettyconfig</feature>\n-        <feature>security-filter-login</feature>\n-        <feature>guava</feature>\n-        <feature>cxf-frontend-javascript</feature>\n-        <feature>cxf-jaxrs</feature>\n-        <feature>util-uuidgenerator</feature>\n-        <feature>security-handler-basic</feature>\n-        <feature dependency=\"true\">oidc-dependencies</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>saml-validator</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security/security-saml-util/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.handler/security-handler-saml/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.encryption/security-encryption-api/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <bundle>mvn:com.google.code.gson/gson/${gson.version}</bundle>\n-    </feature>\n+        <!-- PKI Auth -->\n+        <bundle>mvn:ddf.security.realm/security-realm-pki/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.handler/security-handler-pki/${project.version}</bundle>\n \n-    <feature name=\"saml-validator\" version=\"${project.version}\" description=\"Saml token validator\">\n-        <!--  TODO (https://github.com/codice/ddf/issues/5327)\n-                Address potential circular dependencies as part of security refactor  -->\n-        <feature>security-core-impl</feature>\n-        <feature>security-handler-impl</feature>\n-        <bundle>mvn:ddf.security.saml/saml-assertion-validator/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.saml/saml-assertion-validator-impl/${project.version}</bundle>\n-    </feature>\n+        <!-- Email -->\n+        <bundle>mvn:ddf.platform.email/platform-email-impl/${project.version}</bundle>\n \n-    <feature name=\"security-command-listener\" version=\"${project.version}\"\n-             description=\"Audits all commands entered on the Karaf command line.\">\n-        <feature>security-core-api</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-core-services</feature>\n+        <!-- Miscellaneous -->\n+        <bundle>mvn:ddf.platform/platform-paxweb-jettyconfig/${project.version}</bundle>\n+        <bundle>mvn:ddf.platform/platform-http-proxy/${project.version}</bundle>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5fe3c153d747edf954bc7be7ba8835a00d20f2da"}, "originalPosition": 750}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTI5OTE5NQ==", "bodyText": "Another good catch \ud83d\udc4d", "url": "https://github.com/codice/ddf/pull/6155#discussion_r449299195", "createdAt": "2020-07-02T22:51:15Z", "author": {"login": "bakejeyner"}, "path": "features/security/src/main/feature/feature.xml", "diffHunk": "@@ -21,694 +21,317 @@\n     <repository>mvn:ddf.features/kernel/${project.version}/xml/features</repository>\n     <repository>mvn:ddf.features/utilities/${project.version}/xml/features</repository>\n     <repository>mvn:ddf.features/branding/${project.version}/xml/features</repository>\n+    <repository>mvn:ddf.features/camel/${project.version}/xml/features</repository>\n \n-    <feature name=\"security-logger\" version=\"${project.version}\"\n-             description=\"Logs incoming and outgoing requests\">\n-        <feature>security-core-api</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.interceptor/security-interceptor-logger/${project.version}</bundle>\n-    </feature>\n+    <feature name=\"security-core-api-dependencies\" version=\"${project.version\"\n+             description=\"Dependencies for the core security APIs.\">\n+        <!-- Third Party Features -->\n+        <feature prerequisite=\"true\">wrap</feature>\n+        <feature>pax-http-whiteboard</feature>\n \n-    <feature name=\"security-core-api\" version=\"${project.version}\"\n-             description=\"Security Core\">\n-        <bundle start-level=\"30\">mvn:org.apache.neethi/neethi/${wss4j.neethi.version}</bundle>\n-        <feature>cxf-rt-security</feature>\n-        <feature>security-filter-api</feature>\n+        <!-- External DDF Features -->\n+        <feature>jackson</feature>\n+        <feature>wss4j</feature>\n+        <feature>cxf-ws-security</feature>\n         <feature>cxf-jaxrs</feature>\n-        <feature>platform-util</feature>\n-        <bundle dependency=\"true\">mvn:ddf.platform.security/log-sanitizer/${project.version}</bundle>\n-        <bundle dependency=\"true\">mvn:org.apache.commons/commons-configuration2/${commons-configuration2.version}</bundle>\n-        <bundle dependency=\"true\">mvn:org.apache.shiro/shiro-core/${apache.shiro.version}</bundle>\n-\n-        <feature>guava</feature>\n+        <feature>cxf-bindings-soap</feature>\n         <feature>common-system</feature>\n \n-        <bundle>mvn:joda-time/joda-time/${joda-time.version}</bundle>\n-        <bundle>mvn:org.apache.santuario/xmlsec/${xmlsec.version}</bundle>\n+        <!-- NimbusDS -->\n+        <bundle>wrap:mvn:com.nimbusds/nimbus-jose-jwt/${nimbus.version}</bundle>\n+        <bundle>wrap:mvn:com.nimbusds/oauth2-oidc-sdk/${nimbus.oidc.version}</bundle>\n+        <bundle>mvn:com.nimbusds/content-type/${nimbus.content-type.version}</bundle>\n+        <bundle>mvn:com.nimbusds/lang-tag/${nimbus.langtag.version}</bundle>\n \n-        <feature>cxf-bindings-soap</feature>\n-        <feature>cxf-ws-policy</feature>\n-        <feature>cxf-ws-security</feature>\n-        <feature>spring</feature>\n+        <!-- MiniDev -->\n+        <bundle>mvn:net.minidev/accessors-smart/1.2</bundle>\n+        <bundle>mvn:net.minidev/json-smart/2.3</bundle>\n \n-        <!--  TODO (https://github.com/codice/ddf/issues/5327)\n-                Remove wrapped OpenSAML after security refactor is complete  -->\n-        <!--  <bundle>mvn:org.apache.servicemix.bundles/org.apache.servicemix.bundles.opensaml/${opensaml.osgi.version}-->\n-        <!--  </bundle>-->\n-        <bundle>mvn:ddf.lib.bundles/libs-bundles-opensaml/${project.version}</bundle>\n+        <!-- Miscellaneous -->\n+        <bundle dependency=\"true\">mvn:org.apache.shiro/shiro-core/${apache.shiro.version}</bundle>\n+        <bundle>mvn:com.sun.mail/javax.mail/${javax-mail.version}</bundle>\n+        <!--\n+            net.minidev/accessors-smart/1.2 uses asm v5.x. Need this resolved before we can upgrade:\n+            https://bitbucket.org/connect2id/nimbus-jose-jwt/issues/239/switch-to-other-json-library\n+        -->\n+        <bundle>mvn:org.ow2.asm/asm/5.2</bundle>\n+        <bundle>wrap:mvn:com.github.stephenc.jcip/jcip-annotations/1.0-1</bundle>\n+    </feature>\n \n+    <feature name=\"security-core-api\" version=\"${project.version}\"\n+             description=\"Core security APIs.\">\n+        <feature>security-core-api-dependencies</feature>\n+\n+        <!-- Core -->\n         <bundle>mvn:ddf.security.core/security-core-api/${project.version}</bundle>\n+\n+        <!-- Country Converter -->\n+        <bundle>mvn:ddf.platform.country/platform-country-converter-api/${project.version}</bundle>\n+\n+        <!-- Rest Client -->\n         <bundle>mvn:ddf.platform.security/security-rest-clientapi/${project.version}</bundle>\n-        <bundle>\n-            mvn:org.apache.servicemix.bundles/org.apache.servicemix.bundles.jaxen/${org.apache.servicemix.bundles.jaxen.version}\n-        </bundle>\n-    </feature>\n \n-    <feature name=\"security-filter-api\" version=\"${project.version}\">\n-        <bundle>mvn:javax.servlet/javax.servlet-api/${javax.servlet-api-version}</bundle>\n+        <!-- Filters -->\n         <bundle>mvn:ddf.platform/security-filter-api/${project.version}</bundle>\n-    </feature>\n \n-    <feature name=\"platform-error-page-injector\" version=\"${project.version}\"\n-             description=\"Adding a better error page to Jetty\">\n-        <feature>error-api</feature>\n-        <bundle>mvn:ddf.platform.error/platform-error-page-injector/${project.version}</bundle>\n-    </feature>\n+        <!-- Handlers -->\n+        <bundle>mvn:ddf.security.handler/security-handler-api/${project.version}</bundle>\n \n-    <feature name=\"security-encryption\" version=\"${project.version}\"\n-             description=\"Security Encryption\">\n-        <feature>wss4j</feature>\n-        <bundle>mvn:org.apache.commons/commons-lang3/${commons-lang3.version}</bundle>\n+        <!-- Policy -->\n+        <bundle>mvn:ddf.security.policy/security-policy-api/${project.version}</bundle>\n+\n+        <!-- Encryption -->\n         <bundle>mvn:ddf.security.encryption/security-encryption-api/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.encryption/security-encryption-impl/${project.version}</bundle>\n-        <bundle dependency=\"true\">mvn:ddf.platform.security/log-sanitizer/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.encryption/security-encryption-commands/${project.version}</bundle>\n-    </feature>\n \n-    <feature name=\"web-container\" version=\"${project.version}\">\n-        <feature>platform-paxweb-jettyconfig</feature>\n-        <feature>platform-error-page-injector</feature>\n-        <feature>war</feature>\n-    </feature>\n+        <!-- Expansion -->\n+        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n \n-    <feature name=\"session-invalidator\" version=\"${project.version}\"\n-             description=\"API for invalidating servlet sessions\">\n-        <bundle>mvn:ddf.platform/platform-session-invalidator/${project.version}</bundle>\n-    </feature>\n+        <!-- Token Storage -->\n+        <bundle>mvn:ddf.security.storage/token-storage-api/${project.version}</bundle>\n \n-    <feature name=\"platform-paxweb-jettyconfig\" version=\"${project.version}\"\n-      description=\"Custom Session Manager\">\n-        <config name=\"org.ops4j.pax.web\" append=\"true\">\n-#######################################\n-# Jetty Server Authenticator Settings\n-#######################################\n+        <!-- Sessions -->\n+        <bundle>mvn:ddf.platform.security/session-management-api/${project.version}</bundle>\n+        <bundle>mvn:ddf.platform/platform-session-invalidator-api/${project.version}</bundle>\n \n-# Set the authmethod/realmname so that our JettyAuthenticator is used\n-org.ops4j.pax.web.default.authmethod=DDF\n-org.ops4j.pax.web.default.realmname=DDF\n-        </config>\n-        <feature version=\"${spring.version}_1\">spring</feature>\n-        <feature>apache-commons</feature>\n-        <feature>security-core-api</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-core-services</feature>\n-        <feature>security-filter-api</feature>\n-        <feature>pax-http-jetty</feature>\n-        <bundle start-level=\"30\">mvn:org.ops4j.pax.web/pax-web-jsp/${pax.web.version}</bundle>\n-        <bundle>mvn:javax.el/javax.el-api/3.0.0</bundle>\n-        <feature>pax-jetty</feature>\n-        <feature>session-invalidator</feature>\n-        <feature prerequisite=\"true\">wrap</feature>\n-        <bundle>wrap:mvn:net.jodah/failsafe/${jodah-failsafe.version}</bundle>\n-        <feature>guava</feature>\n-        <feature>common-system</feature>\n-        <bundle>mvn:ddf.platform/platform-paxweb-jettyconfig/${project.version}</bundle>\n-    </feature>\n+        <!-- Logout -->\n+        <bundle>mvn:ddf.security.servlet/security-servlet-logout-api/${project.version}</bundle>\n \n-    <feature name=\"security-handler-api\" version=\"${project.version}\"\n-             description=\"API for authentication handlers for web applications.\">\n-        <feature>security-core-api</feature>\n-        <feature>parser-xml</feature>\n-        <feature>oidc-dependencies</feature>\n-        <bundle>mvn:org.apache.cxf/cxf-rt-rs-security-jose/${cxf.version}</bundle>\n-        <bundle>mvn:org.apache.cxf/cxf-rt-rs-security-jose-jaxrs/${cxf.version}</bundle>\n-        <bundle>mvn:ddf.security.handler/security-handler-api/${project.version}</bundle>\n-    </feature>\n+        <!-- Email -->\n+        <bundle>mvn:ddf.platform.email/platform-email-api/${project.version}</bundle>\n \n-    <feature name=\"security-handler-impl\" version=\"${project.version}\"\n-             description=\"Implementation used by all security handlers\">\n-        <feature>security-core-api</feature>\n-        <feature>security-core-impl</feature>\n-        <bundle>mvn:ddf.security.handler/security-handler-impl/${project.version}</bundle>\n+        <!-- Miscellaneous -->\n+        <bundle>mvn:ddf.security.servlet/security-servlet-web-socket-api/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.interceptor/security-interceptor-guest-wrapper/${project.version}</bundle>\n+        <bundle>mvn:ddf.platform.security/security-oidc-bundle/${project.version}</bundle>\n+        <bundle dependency=\"true\">mvn:ddf.platform.security/log-sanitizer/${project.version}</bundle>\n     </feature>\n \n-    <feature name=\"security-token-storage\" version=\"${project.version}\"\n-             description=\"OAuth token storage api and file storage implementation.\">\n-        <feature>apache-commons</feature>\n-        <bundle>mvn:com.google.code.gson/gson/${gson.version}</bundle>\n-        <bundle>mvn:ddf.security.storage/token-storage-api/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.storage/token-storage-impl/${project.version}</bundle>\n+    <feature name=\"security-core-impl-dependencies\" version=\"${project.version}\"\n+             description=\"Dependencies for core security implementations.\">\n+        <!-- External DDF Features -->\n+        <feature>javax-validation</feature>\n+        <feature>parser-xml</feature>\n+        <feature>platform-util</feature>\n     </feature>\n \n     <feature name=\"security-core-impl\" version=\"${project.version}\"\n-             description=\"Security Core\">\n+             description=\"Core security implementations.\">\n         <feature>security-core-api</feature>\n-        <feature>security-handler-api</feature>\n-        <feature>security-encryption</feature>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <bundle>mvn:ddf.platform.util/util-uuidgenerator-api/${project.version}</bundle>\n-        <feature>javax-validation</feature>\n-        <feature>cxf-frontend-javascript</feature>\n-        <bundle>mvn:javax.servlet/javax.servlet-api/${javax.servlet-api.version}</bundle>\n-        <feature>cxf-jaxrs</feature>\n-        <feature>util-uuidgenerator</feature>\n-        <feature dependency=\"true\">oidc-dependencies</feature>\n-        <feature>security-token-storage</feature>\n-        <feature>cxf-rs-security-oauth2</feature>\n-        <feature>platform-util</feature>\n+        <feature>security-core-impl-dependencies</feature>\n+\n+        <!-- Core -->\n         <bundle>mvn:ddf.security.core/security-core-impl/${project.version}</bundle>\n-    </feature>\n \n-    <feature name=\"security-core-services\" version=\"${project.version}\"\n-             description=\"Main security services\">\n-        <feature>security-core-impl</feature>\n-        <feature>security-handler-impl</feature>\n-        <bundle>mvn:ddf.security.core/security-core-services/${project.version}</bundle>\n-        <bundle>mvn:ddf.platform.security/security-rest-cxfwrapper/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.realm/security-realm-pki/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.realm/security-realm-userpass/${project.version}</bundle>\n-    </feature>\n+        <!-- Handlers -->\n+        <bundle>mvn:ddf.security.handler/security-handler-impl/${project.version}</bundle>\n \n-    <feature name=\"security-expansion\" version=\"${project.version}\"\n-             description=\"Security Expansion\">\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n+        <!-- Expansion -->\n         <bundle>mvn:ddf.security.expansion/security-expansion-impl/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-commands/${project.version}</bundle>\n-    </feature>\n-\n-    <feature name=\"security-pdp-authz\" version=\"${project.version}\"\n-             description=\"Security PDP.\">\n-        <configfile finalname=\"${ddf.etc}/ddf.security.pdp.realm.AuthzRealm.config\">\n-            mvn:ddf.security.pdp/security-pdp-authzrealm/${project.version}/config/default-authzrealm\n-        </configfile>\n-        <feature>security-core-impl</feature>\n-        <feature dependency=\"true\">oidc-dependencies</feature>\n-        <feature>security-expansion</feature>\n-        <feature>security-expansion-user-attributes</feature>\n-        <feature>security-expansion-metacard-attributes</feature>\n-        <feature>javax-validation</feature>\n \n-        <feature>cxf-frontend-javascript</feature>\n-        <feature>cxf-jaxrs</feature>\n-        <feature>parser-xml</feature>\n-        <feature>security-handler-api</feature>\n-        <feature>platform-util</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.pdp/security-pdp-authzrealm/${project.version}</bundle>\n-    </feature>\n-\n-    <feature name=\"security-pep-serviceauthz\" version=\"${project.version}\"\n-             description=\"Security PEP Service AuthZ\">\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <feature>javax-validation</feature>\n-        <feature>cxf-frontend-javascript</feature>\n-        <feature>cxf-jaxrs</feature>\n-        <bundle>mvn:ddf.security.encryption/security-encryption-api/${project.version}</bundle>\n-        <feature>security-handler-api</feature>\n-        <feature dependency=\"true\">oidc-dependencies</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-core-services</feature>\n+        <!-- Policy Extension Point -->\n         <bundle>mvn:ddf.security.pep/security-pep-interceptor/${project.version}</bundle>\n     </feature>\n \n-    <feature name=\"security-expansion-user-attributes\" version=\"${project.version}\"\n-             description=\"Security Expansion User Attributes Expansion\">\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-impl/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-userattr-map/${project.version}\n-        </bundle>\n-    </feature>\n-\n-    <feature name=\"security-expansion-metacard-attributes\" version=\"${project.version}\"\n-             description=\"Security Expansion Metacard Attributes Expansion\">\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-impl/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-metacardattr-map/${project.version}\n-        </bundle>\n-    </feature>\n+    <feature name=\"security-core-services-dependencies\" version=\"${project.version}\"\n+             description=\"Dependencies for core security services.\">\n+        <!-- Third Party Features -->\n+        <feature>spring</feature>\n+        <feature>war</feature>\n+        <feature>pax-jetty</feature>\n+        <feature>pax-http-jetty</feature>\n \n-    <feature name=\"security-core-misc\" version=\"${project.version}\">\n+        <!-- External DDF Features -->\n+        <feature>apache-commons</feature>\n+        <feature>guava</feature>\n         <feature>cxf-core</feature>\n-        <feature>cxf-ws-security</feature>\n-        <bundle start-level=\"40\">mvn:org.apache.cxf/cxf-rt-rs-json-basic/${cxf.version}</bundle>\n-        <bundle start-level=\"40\">mvn:org.apache.cxf/cxf-rt-rs-security-jose/${cxf.version}</bundle>\n-        <bundle>mvn:org.apache.commons/commons-jexl/2.1.1</bundle>\n-        <feature>security-core-api</feature>\n-        <feature>security-handler-api</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-handler-impl</feature>\n-        <feature>platform-util</feature>\n-        <feature prerequisite=\"true\">wrap</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.platform.security/security-rest-cxfwrapper/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.certificate/security-ocsp-checker/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.handler/security-handler-pki/${project.version}</bundle>\n-        <bundle>wrap:mvn:org.springframework.ldap/spring-ldap-core/2.3.2.RELEASE</bundle>\n-        <configfile finalname=\"${ddf.etc}/ws-security/attributeMap.properties\">\n-            mvn:ddf.security.claims/security-claims-ldap/${project.version}/properties/attributeMap\n-        </configfile>\n-    </feature>\n-\n-    <feature name=\"security-realm-saml\" version=\"${project.version}\"\n-             description=\"Security realm for SAML.\">\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <feature>security-core-impl</feature>\n-        <feature>javax-validation</feature>\n-        <feature>cxf-frontend-javascript</feature>\n-        <feature>cxf-jaxrs</feature>\n-        <feature>security-handler-api</feature>\n-        <feature>security-handler-impl</feature>\n-        <feature>security-policy-context</feature>\n-        <feature dependency=\"true\">saml-validator</feature>\n-        <feature dependency=\"true\">oidc-dependencies</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.realm/security-realm-saml/${project.version}</bundle>\n-    </feature>\n-\n-    <feature name=\"security-guest-realm\" version=\"${project.version}\"\n-             description=\"Security Guest Realm.\">\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <feature>security-core-impl</feature>\n-        <feature>javax-validation</feature>\n-        <feature>security-handler-api</feature>\n-        <feature>security-handler-impl</feature>\n-        <feature>security-policy-context</feature>\n+        <feature>cxf-rt-security</feature>\n+        <feature>cxf-ws-policy</feature>\n         <feature>cxf-frontend-javascript</feature>\n-        <feature>cxf-jaxrs</feature>\n-        <feature dependency=\"true\">oidc-dependencies</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.realm/security-realm-guest/${project.version}</bundle>\n-    </feature>\n-\n-    <feature name=\"security-jaas-ldap\" version=\"${project.version}\"\n-             description=\"Security JAAS LDAP Login.\">\n-        <feature>security-core-misc</feature>\n-        <feature>javax-validation</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:org.apache.commons/commons-pool2/2.5.0</bundle>\n-        <bundle>mvn:ddf.security.encryption/security-encryption-api/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.jaas/security-jaas-ldap/${project.version}</bundle>\n-    </feature>\n-\n-    <feature name=\"security-claims-ldap\" version=\"${project.version}\"\n-             description=\"Retrieves claims attributes from an LDAP store.\">\n-        <bundle>mvn:ddf.security.encryption/security-encryption-api/${project.version}</bundle>\n-        <feature>security-core-misc</feature>\n-        <feature>security-encryption</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.claims/security-claims-ldap/${project.version}</bundle>\n-    </feature>\n+        <feature>cxf-rs-security-oauth2</feature>\n+        <feature>cxf-rs-security-sso-saml</feature>\n+        <feature>action-core-impl</feature>\n+        <feature>error-api</feature>\n+        <feature>util-uuidgenerator</feature>\n+        <feature>camel-jetty9</feature>\n+        <feature>camel-blueprint</feature>\n+        <feature>camel-http</feature>\n \n-    <feature name=\"ldap-embedded-default-configs\" version=\"${project.version}\"\n-             description=\"Installs default embedded ldap claims handler and login configs\">\n-        <feature>ldap-embedded-default-claimshandler-config</feature>\n-        <feature>ldap-embedded-default-stslogin-config</feature>\n-    </feature>\n+        <!-- JavaX -->\n+        <bundle>mvn:javax.el/javax.el-api/3.0.0</bundle>\n+        <bundle>mvn:javax.servlet/javax.servlet-api/${javax.servlet-api-version}</bundle>\n \n-    <feature name=\"ldap-embedded-default-claimshandler-config\" version=\"${project.version}\"\n-             description=\"Installs a default embedded ldap login config\">\n-        <configfile\n-                finalname=\"${ddf.etc}/Claims_Handler_Manager-ddf.security.sts.claimsHandler.ClaimsHandlerManager.config\"\n-                override=\"false\">\n-            mvn:ddf.security.claims/security-claims-ldap/${project.version}/config/default-ldap-claimshandler\n-        </configfile>\n-    </feature>\n+        <!-- Apache -->\n+        <bundle>mvn:org.apache.commons/commons-lang3/${commons-lang3.version}</bundle>\n+        <bundle dependency=\"true\">mvn:org.apache.commons/commons-configuration2/${commons-configuration2.version}</bundle>\n+        <bundle>mvn:org.apache.commons/commons-jexl/2.1.1</bundle>\n+        <bundle>\n+            mvn:org.apache.servicemix.bundles/org.apache.servicemix.bundles.jaxen/${org.apache.servicemix.bundles.jaxen.version}\n+        </bundle>\n+        <bundle>mvn:org.apache.santuario/xmlsec/${xmlsec.version}</bundle>\n+        <bundle start-level=\"30\">mvn:org.apache.neethi/neethi/${wss4j.neethi.version}</bundle>\n+        <bundle start-level=\"40\">mvn:org.apache.cxf/cxf-rt-rs-json-basic/${cxf.version}</bundle>\n+        <bundle start-level=\"40\">mvn:org.apache.cxf/cxf-rt-rs-security-jose/${cxf.version}</bundle>\n \n-    <feature name=\"ldap-embedded-default-stslogin-config\" version=\"${project.version}\"\n-             description=\"Installs a default embedded ldap claims handler config\">\n-        <configfile\n-                finalname=\"${ddf.etc}/Ldap_Login_Config-ddf.ldap.ldaplogin.LdapLoginConfig.config\"\n-                override=\"false\">\n-            mvn:ddf.security.jaas/security-jaas-ldap/${project.version}/config/default-ldaplogin\n-        </configfile>\n-    </feature>\n+        <!-- Pax -->\n+        <config name=\"org.ops4j.pax.web\" append=\"true\">\n+            #######################################\n+            # Jetty Server Authenticator Settings\n+            #######################################\n \n-    <feature name=\"security-handler-basic\" version=\"${project.version}\"\n-             description=\"Basic Authentication Handler for web applications.\">\n-        <feature>security-core-misc</feature>\n-        <feature>parser-xml</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.handler/security-handler-basic/${project.version}</bundle>\n-    </feature>\n+            # Set the authmethod/realmname so that our JettyAuthenticator is used\n+            org.ops4j.pax.web.default.authmethod=DDF\n+            org.ops4j.pax.web.default.realmname=DDF\n+        </config>\n+        <bundle start-level=\"30\">mvn:org.ops4j.pax.web/pax-web-jsp/${pax.web.version}</bundle>\n \n-    <feature name=\"oidc-dependencies\" version=\"${project.version}\"\n-      description=\"All OIDC third party dependencies\">\n-        <feature prerequisite=\"true\">wrap</feature>\n-        <feature>jackson</feature>\n-        <bundle>mvn:com.sun.mail/javax.mail/${javax-mail.version}</bundle>\n-        <!--\n-            net.minidev/accessors-smart/1.2 uses asm v5.x. Need this resolved before we can upgrade:\n-            https://bitbucket.org/connect2id/nimbus-jose-jwt/issues/239/switch-to-other-json-library\n-        -->\n-        <bundle>mvn:org.ow2.asm/asm/5.2</bundle>\n-        <bundle>mvn:net.minidev/accessors-smart/1.2</bundle>\n-        <bundle>mvn:net.minidev/json-smart/2.3</bundle>\n-        <bundle>wrap:mvn:com.nimbusds/nimbus-jose-jwt/${nimbus.version}</bundle>\n-        <bundle>wrap:mvn:com.nimbusds/oauth2-oidc-sdk/${nimbus.oidc.version}</bundle>\n-        <bundle>mvn:com.nimbusds/content-type/${nimbus.content-type.version}</bundle>\n-        <bundle>mvn:com.nimbusds/lang-tag/${nimbus.langtag.version}</bundle>\n-        <bundle>wrap:mvn:com.github.stephenc.jcip/jcip-annotations/1.0-1</bundle>\n-        <bundle>mvn:commons-codec/commons-codec/${commons-codec.version}</bundle>\n-        <bundle>mvn:ddf.platform.security/security-oidc-bundle/${project.version}</bundle>\n+        <!-- Miscellaneous -->\n+        <bundle>mvn:com.google.code.gson/gson/${gson.version}</bundle>\n+        <bundle>wrap:mvn:org.springframework.ldap/spring-ldap-core/2.3.2.RELEASE</bundle>\n+        <bundle>wrap:mvn:net.jodah/failsafe/${jodah-failsafe.version}</bundle>\n+        <bundle>mvn:joda-time/joda-time/${joda-time.version}</bundle>\n+        <bundle>mvn:org.codice.thirdparty/commons-httpclient/3.1.0_1</bundle>\n     </feature>\n \n-    <feature name=\"security-handler-oidc\" version=\"${project.version}\"\n-             description=\"OIDC Authentication Handler for web applications.\">\n-        <feature>oidc-dependencies</feature>\n-        <feature>action-core-impl</feature>\n+    <feature name=\"security-core-services\" version=\"${project.version}\"\n+             description=\"Core security services.\">\n         <feature>security-core-impl</feature>\n-        <feature>security-handler-impl</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.handler/security-handler-oidc/${project.version}</bundle>\n-    </feature>\n+        <feature>security-core-services-dependencies</feature>\n \n-    <feature name=\"security-handler-oauth\" version=\"${project.version}\"\n-      description=\"OIDC Authentication Handler for web applications.\">\n-        <feature>oidc-dependencies</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-handler-impl</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.handler/security-handler-oauth/${project.version}</bundle>\n-    </feature>\n+        <!-- Core -->\n+        <bundle>mvn:ddf.security.core/security-core-services/${project.version}</bundle>\n \n-    <feature name=\"security-oidc-realm\" version=\"${project.version}\"\n-             description=\"OIDC Authentication Handler for web applications.\">\n-        <feature>jackson</feature>\n-        <feature dependency=\"true\">oidc-dependencies</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-handler-api</feature>\n-        <feature>security-handler-oidc</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.realm/security-realm-oidc/${project.version}</bundle>\n-    </feature>\n+        <!-- Rest Client -->\n+        <bundle>mvn:ddf.platform.security/security-rest-cxfwrapper/${project.version}</bundle>\n \n-    <feature name=\"security-filter-login\" version=\"${project.version}\"\n-             description=\"Login Filter for web applications.\">\n-        <feature>security-core-impl</feature>\n-        <feature>security-policy-context</feature>\n-        <feature>cxf-rs-security-sso-saml</feature>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <feature>javax-validation</feature>\n-        <feature>cxf-frontend-javascript</feature>\n-        <feature>security-filter-api</feature>\n-        <feature>security-handler-api</feature>\n-        <feature>security-handler-impl</feature>\n-        <feature dependency=\"true\">oidc-dependencies</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.filter/security-filter-login/${project.version}</bundle>\n-    </feature>\n+        <!-- Country Converter -->\n+        <bundle>mvn:ddf.platform.country/platform-country-converter-local/${project.version}</bundle>\n \n-    <feature name=\"security-filter-csrf\" version=\"${project.version}\"\n-             description=\"CSRF Filter for web applications.\">\n-        <feature>security-core-api</feature>\n+        <!-- Filters -->\n         <bundle>mvn:ddf.security.filter/security-filter-csrf/${project.version}</bundle>\n-    </feature>\n-\n-    <feature name=\"security-filter-authz\" version=\"${project.version}\"\n-             description=\"Authz Filter for web applications.\">\n-        <feature>security-policy-context</feature>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <feature>security-filter-api</feature>\n-        <feature>javax-validation</feature>\n-        <feature>cxf-frontend-javascript</feature>\n-        <feature>cxf-jaxrs</feature>\n-        <feature>security-handler-api</feature>\n-        <feature dependency=\"true\">oidc-dependencies</feature>\n-        <feature>security-core-services</feature>\n+        <bundle>mvn:ddf.security.filter/security-filter-web-sso/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.filter/security-filter-login/${project.version}</bundle>\n         <bundle>mvn:ddf.security.filter/security-filter-authorization/${project.version}</bundle>\n-    </feature>\n \n+        <!-- Claims -->\n+        <bundle>mvn:ddf.security.claims/security-claims-property/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.claims/security-claims-attributequery/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.claims/security-claims-certificate/${project.version}</bundle>\n \n-    <feature name=\"security-filter-web-sso\" version=\"${project.version}\"\n-             description=\"Web SSO Filter for web applications.\">\n-        <feature>security-core-impl</feature>\n-        <feature>security-filter-api</feature>\n-        <feature>security-handler-api</feature>\n-        <feature>security-policy-context</feature>\n-        <feature>security-handler-impl</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.filter/security-filter-web-sso/${project.version}</bundle>\n-    </feature>\n+        <!-- Keys and Certificates -->\n+        <bundle>mvn:ddf.security.certificate/security-certificate-keystoreeditor/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.certificate/security-certificate-generator/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.certificate/security-crl-generator/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.certificate/security-ocsp-checker/${project.version}</bundle>\n \n-    <feature name=\"security-policy-context\" version=\"${project.version}\"\n-             description=\"Web Context policy manager\">\n-        <feature>security-core-api</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.policy/security-policy-api/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.policy/security-policy-context/${project.version}</bundle>\n-    </feature>\n+        <!-- Encryption -->\n+        <bundle>mvn:ddf.security.encryption/security-encryption-impl/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.encryption/security-encryption-commands/${project.version}</bundle>\n \n-    <feature name=\"security-claims-certificate\"\n-             version=\"${project.version}\"\n-             description=\"Retrieves claims from a user's certificate.\">\n-        <feature>security-core-misc</feature>\n-        <bundle>mvn:ddf.security.claims/security-claims-certificate/${project.version}\n-        </bundle>\n-    </feature>\n+        <!-- Token Storage -->\n+        <bundle>mvn:ddf.security.storage/token-storage-impl/${project.version}</bundle>\n \n-    <feature name=\"security-claims-property\" version=\"${project.version}\"\n-             description=\"Looks up user properties via a properties file.\">\n-        <feature>security-core-misc</feature>\n-        <feature>javax-validation</feature>\n-        <bundle>mvn:ddf.security.claims/security-claims-property/${project.version}</bundle>\n-    </feature>\n+        <!-- Sessions -->\n+        <bundle>mvn:ddf.platform.security/session-management-impl/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.servlet/security-servlet-session-expiry/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.command/security-command-sessionmanager/${project.version}</bundle>\n \n-    <feature name=\"security-interceptor-guest\" version=\"${project.version}\"\n-             description=\"Injects guest user information into incoming SOAP messages.\">\n-        <feature>guava</feature>\n-        <bundle>mvn:ddf.security.encryption/security-encryption-api/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <feature>javax-validation</feature>\n-        <feature>cxf-frontend-javascript</feature>\n-        <feature>cxf-jaxrs</feature>\n-        <feature>security-handler-api</feature>\n-        <feature>security-handler-impl</feature>\n-        <feature>security-policy-context</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-encryption</feature>\n-        <feature dependency=\"true\">oidc-dependencies</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.interceptor/security-interceptor-guest/${project.version}</bundle>\n-    </feature>\n+        <!-- Expansion -->\n+        <bundle>mvn:ddf.security.expansion/security-expansion-userattr-map/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.expansion/security-expansion-metacardattr-map/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.expansion/security-expansion-commands/${project.version}</bundle>\n \n-    <feature name=\"security-claims-attributequery\"\n-             version=\"${project.version}\"\n-             description=\"Retrieves claims from external attribute store using an AttributeQuery request.\">\n-        <feature>guava</feature>\n-        <bundle>mvn:ddf.security.encryption/security-encryption-api/${project.version}</bundle>\n-        <feature>security-core-misc</feature>\n-        <feature>security-encryption</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.claims/security-claims-attributequery/${project.version}\n-        </bundle>\n-    </feature>\n+        <!-- Logout -->\n+        <bundle>mvn:ddf.security.servlet/security-servlet-logout/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.servlet/security-servlet-default-logout/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.servlet/security-servlet-logout-endpoint/${project.version}</bundle>\n \n-    <feature name=\"security-interceptor-guest-wrapper\"\n-             version=\"${project.version}\"\n-             description=\"Wrapper for Security Interceptor Guest that injects guest user information into incoming SOAP messages.\">\n-        <feature>cxf-bindings-soap</feature>\n-        <feature>cxf-ws-security</feature>\n-        <bundle>mvn:ddf.security.interceptor/security-interceptor-guest-wrapper/${project.version}\n-        </bundle>\n-    </feature>\n+        <!-- Policy Decision Point -->\n+        <configfile finalname=\"${ddf.etc}/ddf.security.pdp.realm.AuthzRealm.config\">\n+            mvn:ddf.security.pdp/security-pdp-authzrealm/${project.version}/config/default-authzrealm\n+        </configfile>\n+        <bundle>mvn:ddf.security.pdp/security-pdp-authzrealm/${project.version}</bundle>\n \n-    <feature name=\"security-guest\" version=\"${project.version}\"\n-             description=\"Contains all of the guest security features.\">\n-        <feature>security-interceptor-guest-wrapper</feature>\n-        <feature>security-interceptor-guest</feature>\n-    </feature>\n+        <!-- Context Policy -->\n+        <bundle>mvn:ddf.security.policy/security-policy-context/${project.version}</bundle>\n \n-    <feature name=\"security-servlet-session-expiry\" version=\"${project.version}\"\n-             description=\"Session expiry servlet.\">\n-        <feature>guava</feature>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <feature>javax-validation</feature>\n-        <feature>cxf-frontend-javascript</feature>\n-        <feature>cxf-jaxrs</feature>\n-        <feature>security-handler-api</feature>\n-        <feature>security-core-impl</feature>\n-        <feature dependency=\"true\">oidc-dependencies</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.platform.security/session-management-service/${project.version}</bundle>\n-        <bundle>mvn:ddf.platform.security/session-management-impl/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.servlet/security-servlet-session-expiry/${project.version}</bundle>\n-    </feature>\n+        <!-- Logging -->\n+        <bundle>mvn:ddf.security.interceptor/security-interceptor-logger/${project.version}</bundle>\n \n-    <feature name=\"security-servlet-whoami\" version=\"${project.version}\"\n-             description=\"Who Am I servlet.\">\n-        <feature>security-core-impl</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.servlet/security-servlet-whoami/${project.version}</bundle>\n-    </feature>\n+        <!-- Guest Authentication -->\n+        <bundle>mvn:ddf.security.realm/security-realm-guest/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.interceptor/security-interceptor-guest/${project.version}</bundle>\n \n-    <feature name=\"security-servlet-web-socket\" version=\"${project.version}\"\n-             description=\"Defines a secure web socket servlet type.\">\n-        <feature>security-core-api</feature>\n-        <feature>pax-http-whiteboard</feature>\n-        <bundle>mvn:ddf.security.servlet/security-servlet-web-socket/${project.version}</bundle>\n-    </feature>\n+        <!-- Basic Auth -->\n+        <bundle>mvn:ddf.security.realm/security-realm-userpass/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.handler/security-handler-basic/${project.version}</bundle>\n \n-    <feature name=\"security-handler-saml\" version=\"${project.version}\"\n-             description=\"SAML Web SSO client\">\n-        <feature>security-core-api</feature>\n-        <feature>security-handler-api</feature>\n-        <feature>javax-validation</feature>\n-        <feature>action-core-impl</feature>\n-        <feature>cxf-rs-security-sso-saml</feature>\n-        <feature>security-filter-api</feature>\n-        <feature>session-invalidator</feature>\n-        <feature>platform-paxweb-jettyconfig</feature>\n-        <feature>security-filter-login</feature>\n-        <feature>guava</feature>\n-        <feature>cxf-frontend-javascript</feature>\n-        <feature>cxf-jaxrs</feature>\n-        <feature>util-uuidgenerator</feature>\n-        <feature>security-handler-basic</feature>\n-        <feature dependency=\"true\">oidc-dependencies</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>saml-validator</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security/security-saml-util/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.handler/security-handler-saml/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.encryption/security-encryption-api/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <bundle>mvn:com.google.code.gson/gson/${gson.version}</bundle>\n-    </feature>\n+        <!-- PKI Auth -->\n+        <bundle>mvn:ddf.security.realm/security-realm-pki/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.handler/security-handler-pki/${project.version}</bundle>\n \n-    <feature name=\"saml-validator\" version=\"${project.version}\" description=\"Saml token validator\">\n-        <!--  TODO (https://github.com/codice/ddf/issues/5327)\n-                Address potential circular dependencies as part of security refactor  -->\n-        <feature>security-core-impl</feature>\n-        <feature>security-handler-impl</feature>\n-        <bundle>mvn:ddf.security.saml/saml-assertion-validator/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.saml/saml-assertion-validator-impl/${project.version}</bundle>\n-    </feature>\n+        <!-- Email -->\n+        <bundle>mvn:ddf.platform.email/platform-email-impl/${project.version}</bundle>\n \n-    <feature name=\"security-command-listener\" version=\"${project.version}\"\n-             description=\"Audits all commands entered on the Karaf command line.\">\n-        <feature>security-core-api</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-core-services</feature>\n+        <!-- Miscellaneous -->\n+        <bundle>mvn:ddf.platform/platform-paxweb-jettyconfig/${project.version}</bundle>\n+        <bundle>mvn:ddf.platform/platform-http-proxy/${project.version}</bundle>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTI1MTA1Ng=="}, "originalCommit": {"oid": "5fe3c153d747edf954bc7be7ba8835a00d20f2da"}, "originalPosition": 750}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwMDE3ODAxOnYy", "diffSide": "RIGHT", "path": "features/security/src/main/feature/feature.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQyMDozNDo0NlrOGscP5A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wMlQyMDozNDo0NlrOGscP5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTI1MzM0OA==", "bodyText": "Should all ldap functionality be contained in the ldap-auth feature? (and if this isn't used for ldap auth, I'm curious what it is used for)", "url": "https://github.com/codice/ddf/pull/6155#discussion_r449253348", "createdAt": "2020-07-02T20:34:46Z", "author": {"login": "SmithJosh"}, "path": "features/security/src/main/feature/feature.xml", "diffHunk": "@@ -21,694 +21,317 @@\n     <repository>mvn:ddf.features/kernel/${project.version}/xml/features</repository>\n     <repository>mvn:ddf.features/utilities/${project.version}/xml/features</repository>\n     <repository>mvn:ddf.features/branding/${project.version}/xml/features</repository>\n+    <repository>mvn:ddf.features/camel/${project.version}/xml/features</repository>\n \n-    <feature name=\"security-logger\" version=\"${project.version}\"\n-             description=\"Logs incoming and outgoing requests\">\n-        <feature>security-core-api</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.interceptor/security-interceptor-logger/${project.version}</bundle>\n-    </feature>\n+    <feature name=\"security-core-api-dependencies\" version=\"${project.version\"\n+             description=\"Dependencies for the core security APIs.\">\n+        <!-- Third Party Features -->\n+        <feature prerequisite=\"true\">wrap</feature>\n+        <feature>pax-http-whiteboard</feature>\n \n-    <feature name=\"security-core-api\" version=\"${project.version}\"\n-             description=\"Security Core\">\n-        <bundle start-level=\"30\">mvn:org.apache.neethi/neethi/${wss4j.neethi.version}</bundle>\n-        <feature>cxf-rt-security</feature>\n-        <feature>security-filter-api</feature>\n+        <!-- External DDF Features -->\n+        <feature>jackson</feature>\n+        <feature>wss4j</feature>\n+        <feature>cxf-ws-security</feature>\n         <feature>cxf-jaxrs</feature>\n-        <feature>platform-util</feature>\n-        <bundle dependency=\"true\">mvn:ddf.platform.security/log-sanitizer/${project.version}</bundle>\n-        <bundle dependency=\"true\">mvn:org.apache.commons/commons-configuration2/${commons-configuration2.version}</bundle>\n-        <bundle dependency=\"true\">mvn:org.apache.shiro/shiro-core/${apache.shiro.version}</bundle>\n-\n-        <feature>guava</feature>\n+        <feature>cxf-bindings-soap</feature>\n         <feature>common-system</feature>\n \n-        <bundle>mvn:joda-time/joda-time/${joda-time.version}</bundle>\n-        <bundle>mvn:org.apache.santuario/xmlsec/${xmlsec.version}</bundle>\n+        <!-- NimbusDS -->\n+        <bundle>wrap:mvn:com.nimbusds/nimbus-jose-jwt/${nimbus.version}</bundle>\n+        <bundle>wrap:mvn:com.nimbusds/oauth2-oidc-sdk/${nimbus.oidc.version}</bundle>\n+        <bundle>mvn:com.nimbusds/content-type/${nimbus.content-type.version}</bundle>\n+        <bundle>mvn:com.nimbusds/lang-tag/${nimbus.langtag.version}</bundle>\n \n-        <feature>cxf-bindings-soap</feature>\n-        <feature>cxf-ws-policy</feature>\n-        <feature>cxf-ws-security</feature>\n-        <feature>spring</feature>\n+        <!-- MiniDev -->\n+        <bundle>mvn:net.minidev/accessors-smart/1.2</bundle>\n+        <bundle>mvn:net.minidev/json-smart/2.3</bundle>\n \n-        <!--  TODO (https://github.com/codice/ddf/issues/5327)\n-                Remove wrapped OpenSAML after security refactor is complete  -->\n-        <!--  <bundle>mvn:org.apache.servicemix.bundles/org.apache.servicemix.bundles.opensaml/${opensaml.osgi.version}-->\n-        <!--  </bundle>-->\n-        <bundle>mvn:ddf.lib.bundles/libs-bundles-opensaml/${project.version}</bundle>\n+        <!-- Miscellaneous -->\n+        <bundle dependency=\"true\">mvn:org.apache.shiro/shiro-core/${apache.shiro.version}</bundle>\n+        <bundle>mvn:com.sun.mail/javax.mail/${javax-mail.version}</bundle>\n+        <!--\n+            net.minidev/accessors-smart/1.2 uses asm v5.x. Need this resolved before we can upgrade:\n+            https://bitbucket.org/connect2id/nimbus-jose-jwt/issues/239/switch-to-other-json-library\n+        -->\n+        <bundle>mvn:org.ow2.asm/asm/5.2</bundle>\n+        <bundle>wrap:mvn:com.github.stephenc.jcip/jcip-annotations/1.0-1</bundle>\n+    </feature>\n \n+    <feature name=\"security-core-api\" version=\"${project.version}\"\n+             description=\"Core security APIs.\">\n+        <feature>security-core-api-dependencies</feature>\n+\n+        <!-- Core -->\n         <bundle>mvn:ddf.security.core/security-core-api/${project.version}</bundle>\n+\n+        <!-- Country Converter -->\n+        <bundle>mvn:ddf.platform.country/platform-country-converter-api/${project.version}</bundle>\n+\n+        <!-- Rest Client -->\n         <bundle>mvn:ddf.platform.security/security-rest-clientapi/${project.version}</bundle>\n-        <bundle>\n-            mvn:org.apache.servicemix.bundles/org.apache.servicemix.bundles.jaxen/${org.apache.servicemix.bundles.jaxen.version}\n-        </bundle>\n-    </feature>\n \n-    <feature name=\"security-filter-api\" version=\"${project.version}\">\n-        <bundle>mvn:javax.servlet/javax.servlet-api/${javax.servlet-api-version}</bundle>\n+        <!-- Filters -->\n         <bundle>mvn:ddf.platform/security-filter-api/${project.version}</bundle>\n-    </feature>\n \n-    <feature name=\"platform-error-page-injector\" version=\"${project.version}\"\n-             description=\"Adding a better error page to Jetty\">\n-        <feature>error-api</feature>\n-        <bundle>mvn:ddf.platform.error/platform-error-page-injector/${project.version}</bundle>\n-    </feature>\n+        <!-- Handlers -->\n+        <bundle>mvn:ddf.security.handler/security-handler-api/${project.version}</bundle>\n \n-    <feature name=\"security-encryption\" version=\"${project.version}\"\n-             description=\"Security Encryption\">\n-        <feature>wss4j</feature>\n-        <bundle>mvn:org.apache.commons/commons-lang3/${commons-lang3.version}</bundle>\n+        <!-- Policy -->\n+        <bundle>mvn:ddf.security.policy/security-policy-api/${project.version}</bundle>\n+\n+        <!-- Encryption -->\n         <bundle>mvn:ddf.security.encryption/security-encryption-api/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.encryption/security-encryption-impl/${project.version}</bundle>\n-        <bundle dependency=\"true\">mvn:ddf.platform.security/log-sanitizer/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.encryption/security-encryption-commands/${project.version}</bundle>\n-    </feature>\n \n-    <feature name=\"web-container\" version=\"${project.version}\">\n-        <feature>platform-paxweb-jettyconfig</feature>\n-        <feature>platform-error-page-injector</feature>\n-        <feature>war</feature>\n-    </feature>\n+        <!-- Expansion -->\n+        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n \n-    <feature name=\"session-invalidator\" version=\"${project.version}\"\n-             description=\"API for invalidating servlet sessions\">\n-        <bundle>mvn:ddf.platform/platform-session-invalidator/${project.version}</bundle>\n-    </feature>\n+        <!-- Token Storage -->\n+        <bundle>mvn:ddf.security.storage/token-storage-api/${project.version}</bundle>\n \n-    <feature name=\"platform-paxweb-jettyconfig\" version=\"${project.version}\"\n-      description=\"Custom Session Manager\">\n-        <config name=\"org.ops4j.pax.web\" append=\"true\">\n-#######################################\n-# Jetty Server Authenticator Settings\n-#######################################\n+        <!-- Sessions -->\n+        <bundle>mvn:ddf.platform.security/session-management-api/${project.version}</bundle>\n+        <bundle>mvn:ddf.platform/platform-session-invalidator-api/${project.version}</bundle>\n \n-# Set the authmethod/realmname so that our JettyAuthenticator is used\n-org.ops4j.pax.web.default.authmethod=DDF\n-org.ops4j.pax.web.default.realmname=DDF\n-        </config>\n-        <feature version=\"${spring.version}_1\">spring</feature>\n-        <feature>apache-commons</feature>\n-        <feature>security-core-api</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-core-services</feature>\n-        <feature>security-filter-api</feature>\n-        <feature>pax-http-jetty</feature>\n-        <bundle start-level=\"30\">mvn:org.ops4j.pax.web/pax-web-jsp/${pax.web.version}</bundle>\n-        <bundle>mvn:javax.el/javax.el-api/3.0.0</bundle>\n-        <feature>pax-jetty</feature>\n-        <feature>session-invalidator</feature>\n-        <feature prerequisite=\"true\">wrap</feature>\n-        <bundle>wrap:mvn:net.jodah/failsafe/${jodah-failsafe.version}</bundle>\n-        <feature>guava</feature>\n-        <feature>common-system</feature>\n-        <bundle>mvn:ddf.platform/platform-paxweb-jettyconfig/${project.version}</bundle>\n-    </feature>\n+        <!-- Logout -->\n+        <bundle>mvn:ddf.security.servlet/security-servlet-logout-api/${project.version}</bundle>\n \n-    <feature name=\"security-handler-api\" version=\"${project.version}\"\n-             description=\"API for authentication handlers for web applications.\">\n-        <feature>security-core-api</feature>\n-        <feature>parser-xml</feature>\n-        <feature>oidc-dependencies</feature>\n-        <bundle>mvn:org.apache.cxf/cxf-rt-rs-security-jose/${cxf.version}</bundle>\n-        <bundle>mvn:org.apache.cxf/cxf-rt-rs-security-jose-jaxrs/${cxf.version}</bundle>\n-        <bundle>mvn:ddf.security.handler/security-handler-api/${project.version}</bundle>\n-    </feature>\n+        <!-- Email -->\n+        <bundle>mvn:ddf.platform.email/platform-email-api/${project.version}</bundle>\n \n-    <feature name=\"security-handler-impl\" version=\"${project.version}\"\n-             description=\"Implementation used by all security handlers\">\n-        <feature>security-core-api</feature>\n-        <feature>security-core-impl</feature>\n-        <bundle>mvn:ddf.security.handler/security-handler-impl/${project.version}</bundle>\n+        <!-- Miscellaneous -->\n+        <bundle>mvn:ddf.security.servlet/security-servlet-web-socket-api/${project.version}</bundle>\n+        <bundle>mvn:ddf.security.interceptor/security-interceptor-guest-wrapper/${project.version}</bundle>\n+        <bundle>mvn:ddf.platform.security/security-oidc-bundle/${project.version}</bundle>\n+        <bundle dependency=\"true\">mvn:ddf.platform.security/log-sanitizer/${project.version}</bundle>\n     </feature>\n \n-    <feature name=\"security-token-storage\" version=\"${project.version}\"\n-             description=\"OAuth token storage api and file storage implementation.\">\n-        <feature>apache-commons</feature>\n-        <bundle>mvn:com.google.code.gson/gson/${gson.version}</bundle>\n-        <bundle>mvn:ddf.security.storage/token-storage-api/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.storage/token-storage-impl/${project.version}</bundle>\n+    <feature name=\"security-core-impl-dependencies\" version=\"${project.version}\"\n+             description=\"Dependencies for core security implementations.\">\n+        <!-- External DDF Features -->\n+        <feature>javax-validation</feature>\n+        <feature>parser-xml</feature>\n+        <feature>platform-util</feature>\n     </feature>\n \n     <feature name=\"security-core-impl\" version=\"${project.version}\"\n-             description=\"Security Core\">\n+             description=\"Core security implementations.\">\n         <feature>security-core-api</feature>\n-        <feature>security-handler-api</feature>\n-        <feature>security-encryption</feature>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <bundle>mvn:ddf.platform.util/util-uuidgenerator-api/${project.version}</bundle>\n-        <feature>javax-validation</feature>\n-        <feature>cxf-frontend-javascript</feature>\n-        <bundle>mvn:javax.servlet/javax.servlet-api/${javax.servlet-api.version}</bundle>\n-        <feature>cxf-jaxrs</feature>\n-        <feature>util-uuidgenerator</feature>\n-        <feature dependency=\"true\">oidc-dependencies</feature>\n-        <feature>security-token-storage</feature>\n-        <feature>cxf-rs-security-oauth2</feature>\n-        <feature>platform-util</feature>\n+        <feature>security-core-impl-dependencies</feature>\n+\n+        <!-- Core -->\n         <bundle>mvn:ddf.security.core/security-core-impl/${project.version}</bundle>\n-    </feature>\n \n-    <feature name=\"security-core-services\" version=\"${project.version}\"\n-             description=\"Main security services\">\n-        <feature>security-core-impl</feature>\n-        <feature>security-handler-impl</feature>\n-        <bundle>mvn:ddf.security.core/security-core-services/${project.version}</bundle>\n-        <bundle>mvn:ddf.platform.security/security-rest-cxfwrapper/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.realm/security-realm-pki/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.realm/security-realm-userpass/${project.version}</bundle>\n-    </feature>\n+        <!-- Handlers -->\n+        <bundle>mvn:ddf.security.handler/security-handler-impl/${project.version}</bundle>\n \n-    <feature name=\"security-expansion\" version=\"${project.version}\"\n-             description=\"Security Expansion\">\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n+        <!-- Expansion -->\n         <bundle>mvn:ddf.security.expansion/security-expansion-impl/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-commands/${project.version}</bundle>\n-    </feature>\n-\n-    <feature name=\"security-pdp-authz\" version=\"${project.version}\"\n-             description=\"Security PDP.\">\n-        <configfile finalname=\"${ddf.etc}/ddf.security.pdp.realm.AuthzRealm.config\">\n-            mvn:ddf.security.pdp/security-pdp-authzrealm/${project.version}/config/default-authzrealm\n-        </configfile>\n-        <feature>security-core-impl</feature>\n-        <feature dependency=\"true\">oidc-dependencies</feature>\n-        <feature>security-expansion</feature>\n-        <feature>security-expansion-user-attributes</feature>\n-        <feature>security-expansion-metacard-attributes</feature>\n-        <feature>javax-validation</feature>\n \n-        <feature>cxf-frontend-javascript</feature>\n-        <feature>cxf-jaxrs</feature>\n-        <feature>parser-xml</feature>\n-        <feature>security-handler-api</feature>\n-        <feature>platform-util</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.pdp/security-pdp-authzrealm/${project.version}</bundle>\n-    </feature>\n-\n-    <feature name=\"security-pep-serviceauthz\" version=\"${project.version}\"\n-             description=\"Security PEP Service AuthZ\">\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <feature>javax-validation</feature>\n-        <feature>cxf-frontend-javascript</feature>\n-        <feature>cxf-jaxrs</feature>\n-        <bundle>mvn:ddf.security.encryption/security-encryption-api/${project.version}</bundle>\n-        <feature>security-handler-api</feature>\n-        <feature dependency=\"true\">oidc-dependencies</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-core-services</feature>\n+        <!-- Policy Extension Point -->\n         <bundle>mvn:ddf.security.pep/security-pep-interceptor/${project.version}</bundle>\n     </feature>\n \n-    <feature name=\"security-expansion-user-attributes\" version=\"${project.version}\"\n-             description=\"Security Expansion User Attributes Expansion\">\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-impl/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-userattr-map/${project.version}\n-        </bundle>\n-    </feature>\n-\n-    <feature name=\"security-expansion-metacard-attributes\" version=\"${project.version}\"\n-             description=\"Security Expansion Metacard Attributes Expansion\">\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-impl/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.expansion/security-expansion-metacardattr-map/${project.version}\n-        </bundle>\n-    </feature>\n+    <feature name=\"security-core-services-dependencies\" version=\"${project.version}\"\n+             description=\"Dependencies for core security services.\">\n+        <!-- Third Party Features -->\n+        <feature>spring</feature>\n+        <feature>war</feature>\n+        <feature>pax-jetty</feature>\n+        <feature>pax-http-jetty</feature>\n \n-    <feature name=\"security-core-misc\" version=\"${project.version}\">\n+        <!-- External DDF Features -->\n+        <feature>apache-commons</feature>\n+        <feature>guava</feature>\n         <feature>cxf-core</feature>\n-        <feature>cxf-ws-security</feature>\n-        <bundle start-level=\"40\">mvn:org.apache.cxf/cxf-rt-rs-json-basic/${cxf.version}</bundle>\n-        <bundle start-level=\"40\">mvn:org.apache.cxf/cxf-rt-rs-security-jose/${cxf.version}</bundle>\n-        <bundle>mvn:org.apache.commons/commons-jexl/2.1.1</bundle>\n-        <feature>security-core-api</feature>\n-        <feature>security-handler-api</feature>\n-        <feature>security-core-impl</feature>\n-        <feature>security-handler-impl</feature>\n-        <feature>platform-util</feature>\n-        <feature prerequisite=\"true\">wrap</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.platform.security/security-rest-cxfwrapper/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.certificate/security-ocsp-checker/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.handler/security-handler-pki/${project.version}</bundle>\n-        <bundle>wrap:mvn:org.springframework.ldap/spring-ldap-core/2.3.2.RELEASE</bundle>\n-        <configfile finalname=\"${ddf.etc}/ws-security/attributeMap.properties\">\n-            mvn:ddf.security.claims/security-claims-ldap/${project.version}/properties/attributeMap\n-        </configfile>\n-    </feature>\n-\n-    <feature name=\"security-realm-saml\" version=\"${project.version}\"\n-             description=\"Security realm for SAML.\">\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <feature>security-core-impl</feature>\n-        <feature>javax-validation</feature>\n-        <feature>cxf-frontend-javascript</feature>\n-        <feature>cxf-jaxrs</feature>\n-        <feature>security-handler-api</feature>\n-        <feature>security-handler-impl</feature>\n-        <feature>security-policy-context</feature>\n-        <feature dependency=\"true\">saml-validator</feature>\n-        <feature dependency=\"true\">oidc-dependencies</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.realm/security-realm-saml/${project.version}</bundle>\n-    </feature>\n-\n-    <feature name=\"security-guest-realm\" version=\"${project.version}\"\n-             description=\"Security Guest Realm.\">\n-        <bundle>mvn:ddf.security.expansion/security-expansion-api/${project.version}</bundle>\n-        <feature>security-core-impl</feature>\n-        <feature>javax-validation</feature>\n-        <feature>security-handler-api</feature>\n-        <feature>security-handler-impl</feature>\n-        <feature>security-policy-context</feature>\n+        <feature>cxf-rt-security</feature>\n+        <feature>cxf-ws-policy</feature>\n         <feature>cxf-frontend-javascript</feature>\n-        <feature>cxf-jaxrs</feature>\n-        <feature dependency=\"true\">oidc-dependencies</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.realm/security-realm-guest/${project.version}</bundle>\n-    </feature>\n-\n-    <feature name=\"security-jaas-ldap\" version=\"${project.version}\"\n-             description=\"Security JAAS LDAP Login.\">\n-        <feature>security-core-misc</feature>\n-        <feature>javax-validation</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:org.apache.commons/commons-pool2/2.5.0</bundle>\n-        <bundle>mvn:ddf.security.encryption/security-encryption-api/${project.version}</bundle>\n-        <bundle>mvn:ddf.security.jaas/security-jaas-ldap/${project.version}</bundle>\n-    </feature>\n-\n-    <feature name=\"security-claims-ldap\" version=\"${project.version}\"\n-             description=\"Retrieves claims attributes from an LDAP store.\">\n-        <bundle>mvn:ddf.security.encryption/security-encryption-api/${project.version}</bundle>\n-        <feature>security-core-misc</feature>\n-        <feature>security-encryption</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.claims/security-claims-ldap/${project.version}</bundle>\n-    </feature>\n+        <feature>cxf-rs-security-oauth2</feature>\n+        <feature>cxf-rs-security-sso-saml</feature>\n+        <feature>action-core-impl</feature>\n+        <feature>error-api</feature>\n+        <feature>util-uuidgenerator</feature>\n+        <feature>camel-jetty9</feature>\n+        <feature>camel-blueprint</feature>\n+        <feature>camel-http</feature>\n \n-    <feature name=\"ldap-embedded-default-configs\" version=\"${project.version}\"\n-             description=\"Installs default embedded ldap claims handler and login configs\">\n-        <feature>ldap-embedded-default-claimshandler-config</feature>\n-        <feature>ldap-embedded-default-stslogin-config</feature>\n-    </feature>\n+        <!-- JavaX -->\n+        <bundle>mvn:javax.el/javax.el-api/3.0.0</bundle>\n+        <bundle>mvn:javax.servlet/javax.servlet-api/${javax.servlet-api-version}</bundle>\n \n-    <feature name=\"ldap-embedded-default-claimshandler-config\" version=\"${project.version}\"\n-             description=\"Installs a default embedded ldap login config\">\n-        <configfile\n-                finalname=\"${ddf.etc}/Claims_Handler_Manager-ddf.security.sts.claimsHandler.ClaimsHandlerManager.config\"\n-                override=\"false\">\n-            mvn:ddf.security.claims/security-claims-ldap/${project.version}/config/default-ldap-claimshandler\n-        </configfile>\n-    </feature>\n+        <!-- Apache -->\n+        <bundle>mvn:org.apache.commons/commons-lang3/${commons-lang3.version}</bundle>\n+        <bundle dependency=\"true\">mvn:org.apache.commons/commons-configuration2/${commons-configuration2.version}</bundle>\n+        <bundle>mvn:org.apache.commons/commons-jexl/2.1.1</bundle>\n+        <bundle>\n+            mvn:org.apache.servicemix.bundles/org.apache.servicemix.bundles.jaxen/${org.apache.servicemix.bundles.jaxen.version}\n+        </bundle>\n+        <bundle>mvn:org.apache.santuario/xmlsec/${xmlsec.version}</bundle>\n+        <bundle start-level=\"30\">mvn:org.apache.neethi/neethi/${wss4j.neethi.version}</bundle>\n+        <bundle start-level=\"40\">mvn:org.apache.cxf/cxf-rt-rs-json-basic/${cxf.version}</bundle>\n+        <bundle start-level=\"40\">mvn:org.apache.cxf/cxf-rt-rs-security-jose/${cxf.version}</bundle>\n \n-    <feature name=\"ldap-embedded-default-stslogin-config\" version=\"${project.version}\"\n-             description=\"Installs a default embedded ldap claims handler config\">\n-        <configfile\n-                finalname=\"${ddf.etc}/Ldap_Login_Config-ddf.ldap.ldaplogin.LdapLoginConfig.config\"\n-                override=\"false\">\n-            mvn:ddf.security.jaas/security-jaas-ldap/${project.version}/config/default-ldaplogin\n-        </configfile>\n-    </feature>\n+        <!-- Pax -->\n+        <config name=\"org.ops4j.pax.web\" append=\"true\">\n+            #######################################\n+            # Jetty Server Authenticator Settings\n+            #######################################\n \n-    <feature name=\"security-handler-basic\" version=\"${project.version}\"\n-             description=\"Basic Authentication Handler for web applications.\">\n-        <feature>security-core-misc</feature>\n-        <feature>parser-xml</feature>\n-        <feature>security-core-services</feature>\n-        <bundle>mvn:ddf.security.handler/security-handler-basic/${project.version}</bundle>\n-    </feature>\n+            # Set the authmethod/realmname so that our JettyAuthenticator is used\n+            org.ops4j.pax.web.default.authmethod=DDF\n+            org.ops4j.pax.web.default.realmname=DDF\n+        </config>\n+        <bundle start-level=\"30\">mvn:org.ops4j.pax.web/pax-web-jsp/${pax.web.version}</bundle>\n \n-    <feature name=\"oidc-dependencies\" version=\"${project.version}\"\n-      description=\"All OIDC third party dependencies\">\n-        <feature prerequisite=\"true\">wrap</feature>\n-        <feature>jackson</feature>\n-        <bundle>mvn:com.sun.mail/javax.mail/${javax-mail.version}</bundle>\n-        <!--\n-            net.minidev/accessors-smart/1.2 uses asm v5.x. Need this resolved before we can upgrade:\n-            https://bitbucket.org/connect2id/nimbus-jose-jwt/issues/239/switch-to-other-json-library\n-        -->\n-        <bundle>mvn:org.ow2.asm/asm/5.2</bundle>\n-        <bundle>mvn:net.minidev/accessors-smart/1.2</bundle>\n-        <bundle>mvn:net.minidev/json-smart/2.3</bundle>\n-        <bundle>wrap:mvn:com.nimbusds/nimbus-jose-jwt/${nimbus.version}</bundle>\n-        <bundle>wrap:mvn:com.nimbusds/oauth2-oidc-sdk/${nimbus.oidc.version}</bundle>\n-        <bundle>mvn:com.nimbusds/content-type/${nimbus.content-type.version}</bundle>\n-        <bundle>mvn:com.nimbusds/lang-tag/${nimbus.langtag.version}</bundle>\n-        <bundle>wrap:mvn:com.github.stephenc.jcip/jcip-annotations/1.0-1</bundle>\n-        <bundle>mvn:commons-codec/commons-codec/${commons-codec.version}</bundle>\n-        <bundle>mvn:ddf.platform.security/security-oidc-bundle/${project.version}</bundle>\n+        <!-- Miscellaneous -->\n+        <bundle>mvn:com.google.code.gson/gson/${gson.version}</bundle>\n+        <bundle>wrap:mvn:org.springframework.ldap/spring-ldap-core/2.3.2.RELEASE</bundle>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5fe3c153d747edf954bc7be7ba8835a00d20f2da"}, "originalPosition": 466}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4645, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}