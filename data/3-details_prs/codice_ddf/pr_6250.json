{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY5NTY5OTkz", "number": 6250, "title": "DDF-6242 Add timeout to CDM", "bodyText": "What does this PR do?\n\nCreates a configurable timeout for files being processed by CDM.\nExpired file names are stored in memory with their \"last modified\" date, and will only be reattempted once the file has been changed.\nAdded Documentation and unit tests\n\nWho is reviewing it?\n@aaronilovici\n@mdang8\n@clockard\nSelect relevant component teams:\nAsk 2 committers to review/merge the PR and tag them here.\n@brendan-hofmann\n@clockard\nHow should this be tested?\nSteps to hero:\n\nBuild this branch and go through the regular install. In the console, set cdm logs to debug: log:set DEBUG cdmLogger\nSet up a directory outside of dib and give DIB the proper permissions to access it.\nIn \"etc/custom.system.properties\", add the following line\norg.codice.ddf.catalog.content.monitor.expirationTime=10000\nSet up a \"Monitor In Place\" CDM for the directory and add files to it to verify it ingests.\nAdd the hanging-plugin to the deploy directory (message for details). This will cause future files to hang during the ingest phase.\nAdd another file to the monitored directory. Wait 10 seconds\nIn the cdm logs (data/log/cdm.log) you should see that the recent file was expired:\n\"Processing time limit expired for 0 files. Removing these files from processing: your_file.txt\"\nNothing should be logged after this.\nMake a trivial change to the file added in step 6. The logs should try to process the file again, but should still fail.\n\nAny background context you want to provide?\nWhat are the relevant tickets?\nFixes: #____\nScreenshots\n\nChecklist:\n\n Documentation Updated\n Update / Add Threat Dragon models\n Update / Add Unit Tests\n Update / Add Integration Tests\n\nNotes on Review Process\nPlease see Notes on Review Process for further guidance on requirements for merging and abbreviated reviews.\nReview Comment Legend:\n\n\u270f\ufe0f (Pencil) This comment is a nitpick or style suggestion, no action required for approval. This comment should provide a suggestion either as an in line code snippet or a gist.\n\u2753 (Question Mark) This comment is to gain a clearer understanding of design or code choices, clarification is required but action may not be necessary for approval.\n\u2757 (Exclamation Mark) This comment is critical and requires clarification or action before approval.", "createdAt": "2020-08-18T15:22:48Z", "url": "https://github.com/codice/ddf/pull/6250", "merged": true, "mergeCommit": {"oid": "f66dc76e0233d2155a015c0a4b66f338783b2cc5"}, "closed": true, "closedAt": "2020-09-09T14:53:00Z", "author": {"login": "aaronilovici"}, "timelineItems": {"totalCount": 30, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc96KDMAH2gAyNDY5NTY5OTkzOjcyM2UzOTlkMzY2Y2I4MzkyNjAyMTk3YmI5MjdmMWVhNTMxY2Q2OGU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdG8KQKgH2gAyNDY5NTY5OTkzOjMxYWNlOWVlNjBiYmFjMjEwMDA3NzY1ZDk3ODE4YzZlMDc0NzZlMjU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "723e399d366cb8392602197bb927f1ea531cd68e", "author": {"user": {"login": "josephthweatt", "name": "Joseph Thweatt"}}, "url": "https://github.com/codice/ddf/commit/723e399d366cb8392602197bb927f1ea531cd68e", "committedDate": "2020-08-11T17:20:56Z", "message": "DDF-6408 Improve Logging for CDM  (#6064)\n\nDDF-000 CDM timeout initial code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "15de73960f68c92618843da56875d01fb96dc74e", "author": {"user": {"login": "josephthweatt", "name": "Joseph Thweatt"}}, "url": "https://github.com/codice/ddf/commit/15de73960f68c92618843da56875d01fb96dc74e", "committedDate": "2020-08-11T18:52:35Z", "message": "DDF-000 fixed merge issues"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a945e4437ab5ffada940a6242bfb3ed517200f40", "author": {"user": {"login": "josephthweatt", "name": "Joseph Thweatt"}}, "url": "https://github.com/codice/ddf/commit/a945e4437ab5ffada940a6242bfb3ed517200f40", "committedDate": "2020-08-13T14:54:29Z", "message": "DDF-6242 initial commit"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f034e1ea0394af3af04d5ba107b03b34a511d266", "author": {"user": {"login": "josephthweatt", "name": "Joseph Thweatt"}}, "url": "https://github.com/codice/ddf/commit/f034e1ea0394af3af04d5ba107b03b34a511d266", "committedDate": "2020-08-14T18:48:14Z", "message": "DDF-6242 added unit tests and configurable timeout"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cf3c32f64ee08acc699a08696468d06f0f927b01", "author": {"user": {"login": "josephthweatt", "name": "Joseph Thweatt"}}, "url": "https://github.com/codice/ddf/commit/cf3c32f64ee08acc699a08696468d06f0f927b01", "committedDate": "2020-08-17T14:47:29Z", "message": "DDF-6242 changes to the test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "20f45016106a80fbdd00205bf500b90bf484793f", "author": {"user": {"login": "josephthweatt", "name": "Joseph Thweatt"}}, "url": "https://github.com/codice/ddf/commit/20f45016106a80fbdd00205bf500b90bf484793f", "committedDate": "2020-08-17T15:48:17Z", "message": "DDF-6242 fixed logic in observer"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fe0f8fc006d06b4427e2e5e6a9083a49a3958adb", "author": {"user": {"login": "josephthweatt", "name": "Joseph Thweatt"}}, "url": "https://github.com/codice/ddf/commit/fe0f8fc006d06b4427e2e5e6a9083a49a3958adb", "committedDate": "2020-08-17T20:22:44Z", "message": "DDF-6242 fixed unit test"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5ab00aec0067f218badec8cf8f2283eb1a979e8c", "author": {"user": {"login": "josephthweatt", "name": "Joseph Thweatt"}}, "url": "https://github.com/codice/ddf/commit/5ab00aec0067f218badec8cf8f2283eb1a979e8c", "committedDate": "2020-08-17T20:53:48Z", "message": "DDF-6242 added unit test for file updates"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dce3419043922addbce9b95d571ee52baf587111", "author": {"user": {"login": "josephthweatt", "name": "Joseph Thweatt"}}, "url": "https://github.com/codice/ddf/commit/dce3419043922addbce9b95d571ee52baf587111", "committedDate": "2020-08-18T15:37:41Z", "message": "DDF-6242 removed testing plugin for CDM timeeout"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "de5a85cfb5c9b4e1273082774df80b8d2be09279", "author": {"user": {"login": "josephthweatt", "name": "Joseph Thweatt"}}, "url": "https://github.com/codice/ddf/commit/de5a85cfb5c9b4e1273082774df80b8d2be09279", "committedDate": "2020-08-18T15:46:44Z", "message": "DDF-6242 revert merge conflict"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "154df4af166e75c9de8960f05c2237e1b26f1c06", "author": {"user": {"login": "josephthweatt", "name": "Joseph Thweatt"}}, "url": "https://github.com/codice/ddf/commit/154df4af166e75c9de8960f05c2237e1b26f1c06", "committedDate": "2020-08-18T17:13:53Z", "message": "DDF-6242 updated documentation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c75825d8636e3a959dc69e38f993aa29bdd4b617", "author": {"user": {"login": "josephthweatt", "name": "Joseph Thweatt"}}, "url": "https://github.com/codice/ddf/commit/c75825d8636e3a959dc69e38f993aa29bdd4b617", "committedDate": "2020-08-19T15:59:34Z", "message": "DDF-6242 skip itests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "25e393a211fa9d74cbcd9c428406dcb15c2f4f6a", "author": {"user": {"login": "josephthweatt", "name": "Joseph Thweatt"}}, "url": "https://github.com/codice/ddf/commit/25e393a211fa9d74cbcd9c428406dcb15c2f4f6a", "committedDate": "2020-08-19T18:29:23Z", "message": "DDF-6242 fixed formatting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8a6f027769f03eef72e4278c7b82b3f0135ccd50", "author": {"user": {"login": "josephthweatt", "name": "Joseph Thweatt"}}, "url": "https://github.com/codice/ddf/commit/8a6f027769f03eef72e4278c7b82b3f0135ccd50", "committedDate": "2020-08-31T21:32:44Z", "message": "DDF-6242 removed reference to hagning-plugin"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8abaed1d979ed24cef4a0c0630e2ffa3fac6e927", "author": {"user": {"login": "josephthweatt", "name": "Joseph Thweatt"}}, "url": "https://github.com/codice/ddf/commit/8abaed1d979ed24cef4a0c0630e2ffa3fac6e927", "committedDate": "2020-09-01T19:11:26Z", "message": "DDF-6242 temp"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7220a81bcb509565daca212aedcdf47e0899af9c", "author": {"user": {"login": "josephthweatt", "name": "Joseph Thweatt"}}, "url": "https://github.com/codice/ddf/commit/7220a81bcb509565daca212aedcdf47e0899af9c", "committedDate": "2020-09-01T19:19:40Z", "message": "DDF-6242 temp"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b7c0923ecb514a0303e4532d3acb5154837b9336", "author": {"user": {"login": "josephthweatt", "name": "Joseph Thweatt"}}, "url": "https://github.com/codice/ddf/commit/b7c0923ecb514a0303e4532d3acb5154837b9336", "committedDate": "2020-09-01T21:32:10Z", "message": "DDF-6242 removed itests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgwMTY5MjI2", "url": "https://github.com/codice/ddf/pull/6250#pullrequestreview-480169226", "createdAt": "2020-09-01T22:49:39Z", "commit": {"oid": "b7c0923ecb514a0303e4532d3acb5154837b9336"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQyMjo0OTozOVrOHLK4Dg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQyMjo0OTozOVrOHLK4Dg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTQ3NDU3NA==", "bodyText": "I am thinking this constant should be included somewhere in the CDM bundle instead of the catalog api since it is only used in that one bundle.", "url": "https://github.com/codice/ddf/pull/6250#discussion_r481474574", "createdAt": "2020-09-01T22:49:39Z", "author": {"login": "clockard"}, "path": "catalog/core/catalog-core-api/src/main/java/ddf/catalog/Constants.java", "diffHunk": "@@ -125,6 +125,8 @@\n \n   public static final String INGEST_LOGGER_NAME = \"ingestLogger\";\n \n+  public static final String CDM_LOGGER_NAME = \"cdmLogger\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b7c0923ecb514a0303e4532d3acb5154837b9336"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "836bcf68a50d61c7d0e4c74cb3ece5bb4e053aa5", "author": {"user": {"login": "josephthweatt", "name": "Joseph Thweatt"}}, "url": "https://github.com/codice/ddf/commit/836bcf68a50d61c7d0e4c74cb3ece5bb4e053aa5", "committedDate": "2020-09-02T15:23:48Z", "message": "DDF-6242 clearing system properties set in itests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c2a58b1136850c32f29e513801c265891feb3517", "author": {"user": {"login": "josephthweatt", "name": "Joseph Thweatt"}}, "url": "https://github.com/codice/ddf/commit/c2a58b1136850c32f29e513801c265891feb3517", "committedDate": "2020-09-02T16:48:10Z", "message": "DDF-6242 moved Catalog constants' CDM_LOGGER_NAME to catalog-core-directorymonitor"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgxMzEzOTU4", "url": "https://github.com/codice/ddf/pull/6250#pullrequestreview-481313958", "createdAt": "2020-09-02T21:28:45Z", "commit": {"oid": "c2a58b1136850c32f29e513801c265891feb3517"}, "state": "COMMENTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQyMToyODo0NVrOHMI5Qw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQyMjowNzozMlrOHMK0Fg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjQ5MDY5MQ==", "bodyText": "What does this change have to do with the cdm change?", "url": "https://github.com/codice/ddf/pull/6250#discussion_r482490691", "createdAt": "2020-09-02T21:28:45Z", "author": {"login": "clockard"}, "path": "catalog/core/catalog-core-solr/src/test/java/ddf/catalog/source/solr/DynamicSchemaResolverTest.java", "diffHunk": "@@ -57,6 +58,11 @@\n   private static final ObjectMapper METACARD_TYPE_MAPPER =\n       MetacardTypeMapperFactory.newObjectMapper();\n \n+  @AfterClass", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c2a58b1136850c32f29e513801c265891feb3517"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjQ5NTQ3MQ==", "bodyText": "Did this file get lost in previous commits or are you back porting this particular one from more recent docs? Just wondering why it doesn't already exist", "url": "https://github.com/codice/ddf/pull/6250#discussion_r482495471", "createdAt": "2020-09-02T21:34:23Z", "author": {"login": "clockard"}, "path": "distribution/docs/src/main/resources/content/_managing/_configuring/content-directory-monitor.adoc", "diffHunk": "@@ -0,0 +1,179 @@\n+:title: Content Directory Monitor", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c2a58b1136850c32f29e513801c265891feb3517"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjQ5NjgwMw==", "bodyText": "CDM will not attempt to ingest the file until the file changes again ?", "url": "https://github.com/codice/ddf/pull/6250#discussion_r482496803", "createdAt": "2020-09-02T21:35:55Z", "author": {"login": "clockard"}, "path": "distribution/docs/src/main/resources/content/_managing/_configuring/content-directory-monitor.adoc", "diffHunk": "@@ -0,0 +1,179 @@\n+:title: Content Directory Monitor\n+:type: configuration\n+:status: published\n+:parent: Configuring Data Management\n+:order: 03\n+:summary: Content Directory Monitor.\n+\n+== {title}\n+\n+The Content Directory Monitor (CDM) provides the capability to easily add content and metacards into the\u00a0${ddf-catalog} by placing a file in a directory.\n+\n+=== Installing the Content Directory Monitor\n+\n+The Content Directory Monitor is installed by default with a standard installation of the ${ddf-catalog} application.\n+\n+=== Configuring Permissions for the Content Directory Monitor\n+// This section of the docs is duplicated in ${home_directory}/security/configurations.policy. Updates\n+// should be applied to both locations.\n+\n+[TIP]\n+====\n+If monitoring a WebDav server, then adding these permissions is not required and this section can be skipped.\n+====\n+\n+Configuring a Content Directory Monitor requires adding permissions to the Security Manager before CDM configuration.\n+\n+Configuring a CDM requires adding read and write permissions to the directory being monitored. The following permissions, replacing <DIRECTORY_PATH> with the path of the directory being monitored, are required for each configured CDM and should be placed in the CDM section inside ${home_directory}/security/configurations.policy.\n+\n+.Adding New Permissions\n+[WARNING]\n+====\n+After adding permissions, a system restart is required for them to take effect.\n+====\n+\n+. permission java.io.FilePermission \"<DIRECTORY_PATH>\", \"read\";\n+. permission java.io.FilePermission \"<DIRECTORY_PATH>${/}-\", \"read, write\";\n+\n+Trailing slashes after <DIRECTORY_PATH> have no effect on the permissions granted. For example, adding a permission for \"${/}test${/}path\" and \"${/}test${/}path${/}\" are equivalent. The recursive forms \"${/}test${/}path${/}-\", and \"${/}test${/}path${/}${/}-\" are also equivalent.\n+\n+Line 1 gives the CDM the permissions to read from the monitored directory path. Line 2 gives the CDM the permissions to recursively read and write from the monitored directory path, specified by the directory path's suffix \"${/}-\".\n+\n+If a CDM configuration is deleted, then the corresponding permissions that were added should be deleted to avoid granting unnecessary permissions to parts of the system.\n+\n+=== Configuring the Content Directory Monitor\n+\n+.Content Directory Monitor Permissions\n+[IMPORTANT]\n+====\n+When configuring a Content Directory Monitor, make sure to set permissions on the new directory to allow ${branding} to access it.\n+Setting permissions should be done *before* configuring a CDM.\n+Also, don't forget to add permissions for resources outside of the monitored directory.\n+See <<{managing-prefix}configuring_permissions_for_the_content_directory_monitor,Configuring Permissions for the Content Directory Monitor>> for in-depth instructions on configuring permissions.\n+====\n+\n+[NOTE]\n+====\n+If there's a metacard that points to a resource outside of the CDM, then you must configure the <<{developing-prefix}url_resource_reader, URL Resource Reader>> to be able to download it.\n+====\n+\n+.Monitoring Directories In Place\n+[WARNING]\n+====\n+If monitoring a directory in place, then the <<{developing-prefix}url_resource_reader, URL Resource Reader>> must be configured prior to configuring the CDM to allow reading from the configured directory.\n+This allows the ${ddf-catalog} to download the resources.\n+====\n+\n+Configure the CDM from the ${admin-console}:\n+\n+. Navigate to the *${admin-console}*.\n+. Select the *${ddf-catalog}* application.\n+. Select the *Configuration* tab.\n+. Select *Catalog Content Directory Monitor*.\n+\n+See <<{reference-prefix}org.codice.ddf.catalog.content.monitor.ContentDirectoryMonitor,Content Directory Monitor configurations>> for all possible configurations.\n+\n+=== Using the Content Directory Monitor\n+\n+The CDM processes files in a directory, and all of its sub-directories. The CDM offers three options:\n+\n+* Delete\n+* Move\n+* Monitor in place\n+\n+Regardless of the option, the ${branding} takes each file in a monitored directory structure and creates a metacard for it. The metacard is linked to the file. The behavior of each option is given below.\n+\n+.Delete\n+* Copies the file into the Content Repository.\n+* Creates a metacard in the Catalog from the file.\n+* *Erases* the original file from the monitored directory.\n+\n+.Move\n+* Copies the file into the directory `.\\ingested` *(this will double the disk space used)*\n+* Copies the file into the Content Repository.\n+* Creates a metacard in the Catalog from the file.\n+* *Erases* the original file from the monitored directory.\n+\n+.Monitor in place\n+* Creates a metacard in the Catalog from the file.\n+* Creates a reference from the metacard to the original file in the monitored directory.\n+* If the original file is deleted, the metacard is removed from the Catalog.\n+* If the original file is modified, the metacard is updated to reflect the new content.\n+* If the original file is renamed, the old metacard is deleted and a new metacard is created.\n+\n+.Parallel Processing\n+The CDM supports parallel processing of files (up to 8 files processed concurrently).  This is configured by setting the number of *Maximum Concurrent Files* in the configuration.  A maximum of 8 is imposed to protect system resources.\n+\n+.Read Lock\n+When the CDM is set up, the directory specified is continuously scanned, and files are locked for processing based on the *ReadLock Time Interval*.  This does not apply to the *Monitor in place* processing directive.  Files will not be ingested without having a ReadLock that has observed no change in the file size.\n+This is done so that files that are in transit will not be ingested prematurely. The interval should be dependent on the speed of the copy to the directory monitor (ex. network drive vs local disk).\n+For local files, the default value of 500 milliseconds is recommended. The recommended interval for network drives is 1000 - 2000 milliseconds.  If the value provided is less than 100, 100 milliseconds will be used.\n+It is also recommended that the *ReadLock Time Interval* be set to a lower amount of time when the *Maximum Concurrent Files* is set above 1 so that files are\n+locked in a timely manner and processed as soon as possible.  When a higher *ReadLock Time Interval* is set, the time it takes for files to be processed is increased.\n+\n+.Attribute Overrides\n+The CDM supports setting metacard attributes directly when ${branding} ingests a file. Custom overrides are entered in the form:\n+\n+`*attribute-name=attribute-value*`\n+\n+For example, to set the contact email for all metacards, add the attribute override:\n+\n+`*contact.point-of-contact-email=doctor@clinic.com*`\n+\n+Each override sets the value of a single metacard attribute. To set the value of an additional attribute, select the \"plus\"\n+ icon in the UI. This creates an empty line for the entry.\n+\n+To set multi-valued attributes, use a separate override for each value. For example, to add the keywords _PPI_ and _radiology_ to each metacard, add the custom attribute overrides:\n+\n+`*topic.keyword=PPI*` +\n+`*topic.keyword=radiology*`\n+\n+Attributes will only be overridden if they are part of the <<{integrating-prefix}metacard_type, metacard type>> or are <<{developing-prefix}attribute_injection_definition,injected>>.\n+\n+All attributes in the <<{metadata-prefix}catalog_taxonomy_definitions, catalog taxonomy tables>> are injected into all metacards by default and can be overridden.\n+\n+[IMPORTANT]\n+====\n+If an overridden attribute is not part of the <<{integrating-prefix}metacard_type, metacard type>> or <<{developing-prefix}attribute_injection_definition,injected>> the attribute will not be added to the metacard.\n+====\n+\n+For example, if the metacard type contains contact email,\n+\n+`*contact.point-of-contact-email*`\n+\n+but the value is not currently set, adding an attribute override will set the attribute value.\n+To override attributes that are not part of the metacard type, <<{developing-prefix}attribute_injection_definition,attribute injection>> can be used.\n+\n+.Blacklist\n+The CDM blacklist uses the \"bad.files\" and \"bad.file.extensions\" properties from the custom.system.properties file in \"etc/\" in order to prevent\n+malicious or unwanted data from being ingested into DDF.  While the CDM automatically omits hidden files, this is particularly useful when\n+an operating system automatically generates files that should not be ingested.  One such example of this is \"thumbs.db\" in Windows.\n+This file type and any temporary files are included in the blacklist.\n+\n+.Errors\n+If the CDM fails to read the file, an error will be logged in the CDM log. If the directory monitor is\n+configured to *Delete* or *Move*, the original file is also moved to the `\\.errors` directory.\n+\n+.Logging\n+CDM will send logs detailing the processing of files in the directory to `cdm.log`.\n+\n+[TIP]\n+====\n+The log level for CDM can be set with the following console command. At the DEBUG level, CDM will periodically log the list of files still currently processing.\n+----\n+log:set DEBUG cdmLogger\n+----\n+====\n+\n+.Timeout\n+CDM will expire files whose processing times exceed a specified threshold. By default, that threshold is 5 minutes. After expiration, CDM will not attempt to ingest the file until it changes have been made.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c2a58b1136850c32f29e513801c265891feb3517"}, "originalPosition": 169}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjUwNDc4Mw==", "bodyText": "Has this code been run through the formatter?", "url": "https://github.com/codice/ddf/pull/6250#discussion_r482504783", "createdAt": "2020-09-02T21:45:45Z", "author": {"login": "clockard"}, "path": "catalog/core/catalog-core-directorymonitor/src/main/java/org/codice/ddf/catalog/content/monitor/AsyncFileAlterationObserver.java", "diffHunk": "@@ -283,12 +326,40 @@ else if (!entry.hasChildren()) {\n    * @param success Boolean that shows if the task failed or completed successfully\n    */\n   private void commitDelete(AsyncFileEntry entry, boolean success) {\n-    LOGGER.debug(\"commitDelete({},{}): Starting...\", entry.getName(), success);\n-    if (success) {\n-      entry.getParent().ifPresent(e -> e.removeChild(entry));\n-      entry.destroy();\n+    LOGGER.trace(\"commitDelete({},{}): Starting...\", entry.getName(), success);\n+    try {\n+      if (success) {\n+        entry.getParent().ifPresent(e -> e.removeChild(entry));\n+        entry.destroy();\n+        LOGGER.debug(\n+            \"{} was removed from {}\",\n+            entry.getName(),\n+            entry.getParent().map(AsyncFileEntry::getName).orElse(\"parent\"));\n+      } else {\n+        LOGGER.debug(\"Delete task failed for {}\", entry.getName());\n+      }\n+    } finally {\n+      onFinish(entry);\n     }\n-    onFinish();\n+  }\n+\n+  /**\n+   * Verify whether {@link File} has exceeded the maximum processing time AND has not been updated\n+   *\n+   * @param file\n+   * @return true if the file has expired on processing before and has not been updated\n+   */\n+  private boolean expiredNotUpdated(File file) {\n+    if (file.isDirectory() || !expiredFiles.containsKey(file.getPath())) return false;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c2a58b1136850c32f29e513801c265891feb3517"}, "originalPosition": 215}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjUxNDg3Mw==", "bodyText": "Is LOGGING the right term here? It seems like maybe HEALTH_CHECK or INGEST_CHECK might be clearer.", "url": "https://github.com/codice/ddf/pull/6250#discussion_r482514873", "createdAt": "2020-09-02T21:58:11Z", "author": {"login": "clockard"}, "path": "catalog/core/catalog-core-directorymonitor/src/main/java/org/codice/ddf/catalog/content/monitor/AsyncFileAlterationObserver.java", "diffHunk": "@@ -49,15 +58,22 @@\n  */\n public class AsyncFileAlterationObserver {\n \n-  private static final Logger LOGGER = LoggerFactory.getLogger(AsyncFileAlterationObserver.class);\n+  private static final Logger LOGGER = LoggerFactory.getLogger(CDM_LOGGER_NAME);\n+\n+  private static final int LOGGING_TIME_DELAY = 500;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c2a58b1136850c32f29e513801c265891feb3517"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjUyMjEzNA==", "bodyText": "If we are setting this here we should probably not set it above on ling 98", "url": "https://github.com/codice/ddf/pull/6250#discussion_r482522134", "createdAt": "2020-09-02T22:07:32Z", "author": {"login": "clockard"}, "path": "catalog/core/catalog-core-directorymonitor/src/main/java/org/codice/ddf/catalog/content/monitor/ContentDirectoryMonitor.java", "diffHunk": "@@ -115,6 +121,7 @@ public ContentDirectoryMonitor(\n     this.maxRetries = maxRetries;\n     this.delayBetweenRetries = delayBetweenRetries;\n     this.configurationExecutor = configurationExecutor;\n+    systemSubjectBinder = new SystemSubjectBinder();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c2a58b1136850c32f29e513801c265891feb3517"}, "originalPosition": 31}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1a18b4dd51d730fc3e427d65ca86d7df873ef93b", "author": {"user": {"login": "josephthweatt", "name": "Joseph Thweatt"}}, "url": "https://github.com/codice/ddf/commit/1a18b4dd51d730fc3e427d65ca86d7df873ef93b", "committedDate": "2020-09-02T23:24:19Z", "message": "DDF-6242 refactoring"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c64045ee8bad4dc85aa89226dc11b0d2be962370", "author": {"user": {"login": "josephthweatt", "name": "Joseph Thweatt"}}, "url": "https://github.com/codice/ddf/commit/c64045ee8bad4dc85aa89226dc11b0d2be962370", "committedDate": "2020-09-02T23:49:13Z", "message": "DDF-6242 formatting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "931aaa027dff2333997b60da3cdf39068eb5e560", "author": {"user": {"login": "josephthweatt", "name": "Joseph Thweatt"}}, "url": "https://github.com/codice/ddf/commit/931aaa027dff2333997b60da3cdf39068eb5e560", "committedDate": "2020-09-03T16:20:40Z", "message": "DDF-6242 fixed documentation duplicate"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgyMDEzNzgx", "url": "https://github.com/codice/ddf/pull/6250#pullrequestreview-482013781", "createdAt": "2020-09-03T16:32:36Z", "commit": {"oid": "931aaa027dff2333997b60da3cdf39068eb5e560"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgyMDY3NTY1", "url": "https://github.com/codice/ddf/pull/6250#pullrequestreview-482067565", "createdAt": "2020-09-03T17:45:49Z", "commit": {"oid": "931aaa027dff2333997b60da3cdf39068eb5e560"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0ad9456ed54bf84f56f47940151b57ab79f9dea8", "author": {"user": {"login": "josephthweatt", "name": "Joseph Thweatt"}}, "url": "https://github.com/codice/ddf/commit/0ad9456ed54bf84f56f47940151b57ab79f9dea8", "committedDate": "2020-09-03T18:21:07Z", "message": "DDF-6242 update to Jenkinsfile"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgyMjcyNjM5", "url": "https://github.com/codice/ddf/pull/6250#pullrequestreview-482272639", "createdAt": "2020-09-03T23:49:46Z", "commit": {"oid": "0ad9456ed54bf84f56f47940151b57ab79f9dea8"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QyMzo0OTo0NlrOHM6-Lg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wM1QyMzo1NDoxOVrOHM7DEg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMxMTE1MA==", "bodyText": "\u2754 Do you have to do any null checking on entry?", "url": "https://github.com/codice/ddf/pull/6250#discussion_r483311150", "createdAt": "2020-09-03T23:49:46Z", "author": {"login": "shaundmorris"}, "path": "catalog/core/catalog-core-directorymonitor/src/main/java/org/codice/ddf/catalog/content/monitor/AsyncFileAlterationObserver.java", "diffHunk": "@@ -179,12 +212,10 @@ AsyncFileEntry getRootFile() {\n    */\n   private void doCreate(AsyncFileEntry entry, final AsyncFileAlterationListener listenerCopy) {\n \n-    processing.incrementAndGet();\n+    processing.add(entry);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0ad9456ed54bf84f56f47940151b57ab79f9dea8"}, "originalPosition": 93}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMxMTUzNA==", "bodyText": "\u2754 same question here on checking entry?", "url": "https://github.com/codice/ddf/pull/6250#discussion_r483311534", "createdAt": "2020-09-03T23:51:04Z", "author": {"login": "shaundmorris"}, "path": "catalog/core/catalog-core-directorymonitor/src/main/java/org/codice/ddf/catalog/content/monitor/AsyncFileAlterationObserver.java", "diffHunk": "@@ -260,15 +305,14 @@ private void commitMatch(AsyncFileEntry entry, boolean success) {\n    */\n   private void doDelete(AsyncFileEntry entry, final AsyncFileAlterationListener listenerCopy) {\n     if (!entry.isDirectory()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0ad9456ed54bf84f56f47940151b57ab79f9dea8"}, "originalPosition": 168}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzMxMjQwMg==", "bodyText": "\u2754 Do you think is the right balance between test time and consistency? I'm thinking about potentially flakiness based on the sleep time.", "url": "https://github.com/codice/ddf/pull/6250#discussion_r483312402", "createdAt": "2020-09-03T23:54:19Z", "author": {"login": "shaundmorris"}, "path": "catalog/core/catalog-core-directorymonitor/src/test/java/org/codice/ddf/catalog/content/monitor/AsyncFileAlterationObserverTest.java", "diffHunk": "@@ -231,6 +232,78 @@ public void testFileCreation() throws Exception {\n     verify(fileListener, never()).onFileDelete(any(File.class), any(Synchronization.class));\n   }\n \n+  @Test\n+  public void testHangingFileExpires() throws Exception {\n+    System.setProperty(\"org.codice.ddf.catalog.content.monitor.expirationTime\", \"100\");\n+\n+    // observer onCreate method will hang for longer than the set expiration time\n+    doAnswer(\n+            (InvocationOnMock e) -> {\n+              sleep(1000);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0ad9456ed54bf84f56f47940151b57ab79f9dea8"}, "originalPosition": 19}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg0MjYwMjc1", "url": "https://github.com/codice/ddf/pull/6250#pullrequestreview-484260275", "createdAt": "2020-09-08T15:31:38Z", "commit": {"oid": "0ad9456ed54bf84f56f47940151b57ab79f9dea8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "31ace9ee60bbac210007765d97818c6e07476e25", "author": {"user": {"login": "josephthweatt", "name": "Joseph Thweatt"}}, "url": "https://github.com/codice/ddf/commit/31ace9ee60bbac210007765d97818c6e07476e25", "committedDate": "2020-09-08T18:46:17Z", "message": "DDF-6242 reduced testing sleep time"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 870, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}