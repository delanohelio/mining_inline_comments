{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEzMjA2MjY5", "number": 6041, "title": "Support per collection properties with Solr", "bodyText": "What does this PR do?\nMakes it possible to override per collection or by default the number of shards, replication factor, and allowed shards per node when collections are created.  The number of shards for the catalog collection is now 6 shards instead of 2 shards.  All other collections still have 2 shards by default.\nWho is reviewing it?\n\n@lamhuy\n@derekwilhelm\nSelect relevant component teams:\n\n@codice/solr\nAsk 2 committers to review/merge the PR and tag them here.\n\n@rzwiefel\n@bdeining\nHow should this be tested?\n\nGo to http://localhost:8994/solr/#/catalog/collection-overview\nVerify that the catalog collection has 6 shards.\nGo to http://localhost:8994/solr/#/alerts/collection-overview\nVerify that the alerts collection has 2 shards.\nYou can verify the values under etc/solr/configsets/default/collection.properties and etc/solr/configsets/catalog/collection.properties.\nAny background context you want to provide?\nWhat are the relevant tickets?\nFixes: n/a\nScreenshots\n\nChecklist:\n\n[ n/a ] Documentation Updated\n[ n/a ] Update / Add Threat Dragon models\n Update / Add Unit Tests\n[ n/a ] Update / Add Integration Tests\n\nNotes on Review Process\nPlease see Notes on Review Process for further guidance on requirements for merging and abbreviated reviews.\nReview Comment Legend:\n\n\u270f\ufe0f (Pencil) This comment is a nitpick or style suggestion, no action required for approval. This comment should provide a suggestion either as an in line code snippet or a gist.\n\u2753 (Question Mark) This comment is to gain a clearer understanding of design or code choices, clarification is required but action may not be necessary for approval.\n\u2757 (Exclamation Mark) This comment is critical and requires clarification or action before approval.", "createdAt": "2020-05-04T21:56:03Z", "url": "https://github.com/codice/ddf/pull/6041", "merged": true, "mergeCommit": {"oid": "931b41c178628338477e96069096ca9e618c9a47"}, "closed": true, "closedAt": "2020-05-13T20:08:11Z", "author": {"login": "pklinef"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABceHK4jAFqTQwNTM5MDQxMQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcg7WQXAFqTQxMTA5MDk5OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1MzkwNDEx", "url": "https://github.com/codice/ddf/pull/6041#pullrequestreview-405390411", "createdAt": "2020-05-04T22:25:01Z", "commit": {"oid": "e8c876ca28b5dc5487890f9614a1c925f151c31c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQyMjoyNTowMVrOGQUbHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQyMjoyNTowMVrOGQUbHg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTc2NTAyMg==", "bodyText": "\u2753 Should we be creating this FileInputStream with a try-with-resources? Properties::load states\n\nThe specified stream remains open after this method returns.", "url": "https://github.com/codice/ddf/pull/6041#discussion_r419765022", "createdAt": "2020-05-04T22:25:01Z", "author": {"login": "rzwiefel"}, "path": "platform/solr/solr-factory-impl/src/main/java/org/codice/solr/factory/impl/CollectionConfig.java", "diffHunk": "@@ -0,0 +1,91 @@\n+/**\n+ * Copyright (c) Codice Foundation\n+ *\n+ * <p>This is free software: you can redistribute it and/or modify it under the terms of the GNU\n+ * Lesser General Public License as published by the Free Software Foundation, either version 3 of\n+ * the License, or any later version.\n+ *\n+ * <p>This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;\n+ * without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * GNU Lesser General Public License for more details. A copy of the GNU Lesser General Public\n+ * License is distributed along with this program and can be found at\n+ * <http://www.gnu.org/licenses/lgpl.html>.\n+ */\n+package org.codice.solr.factory.impl;\n+\n+import java.io.File;\n+import java.io.FileInputStream;\n+import java.io.IOException;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.util.Properties;\n+import org.apache.commons.lang.math.NumberUtils;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+public class CollectionConfig {\n+\n+  private static final Logger LOGGER = LoggerFactory.getLogger(CollectionConfig.class);\n+\n+  private final int shardCount;\n+\n+  private final int replicationFactor;\n+\n+  private final int maximumShardsPerNode;\n+\n+  public CollectionConfig(String collection) {\n+    this(collection, Paths.get(System.getProperty(\"ddf.home\", \"\"), \"etc/solr/configsets\"));\n+  }\n+\n+  public CollectionConfig(String collection, Path collectionConfigs) {\n+    File matchingConfig =\n+        collectionConfigs.resolve(Paths.get(collection, \"collection.properties\")).toFile();\n+    Properties collectionProps = new Properties();\n+    if (matchingConfig.exists()) {\n+      try {\n+        collectionProps.load(new FileInputStream(matchingConfig));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e8c876ca28b5dc5487890f9614a1c925f151c31c"}, "originalPosition": 46}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1Mzk5NDI0", "url": "https://github.com/codice/ddf/pull/6041#pullrequestreview-405399424", "createdAt": "2020-05-04T22:46:35Z", "commit": {"oid": "e8c876ca28b5dc5487890f9614a1c925f151c31c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e8c876ca28b5dc5487890f9614a1c925f151c31c", "author": {"user": {"login": "pklinef", "name": "Phil Klinefelter"}}, "url": "https://github.com/codice/ddf/commit/e8c876ca28b5dc5487890f9614a1c925f151c31c", "committedDate": "2020-05-04T21:36:50Z", "message": "Configure collection options by property file"}, "afterCommit": {"oid": "97ceee64518eafdffa12f9cc9c600e42475478ee", "author": {"user": {"login": "pklinef", "name": "Phil Klinefelter"}}, "url": "https://github.com/codice/ddf/commit/97ceee64518eafdffa12f9cc9c600e42475478ee", "committedDate": "2020-05-04T22:57:38Z", "message": "Configure collection options by property file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c3d7514efbe50b4ac2dfdf092e9ea362981719a9", "author": {"user": {"login": "pklinef", "name": "Phil Klinefelter"}}, "url": "https://github.com/codice/ddf/commit/c3d7514efbe50b4ac2dfdf092e9ea362981719a9", "committedDate": "2020-05-12T20:05:37Z", "message": "Fix ConfigsetsTest to be cross platform"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "18e8bcfaf06e547974a70cca3a3325cbd0d96b0c", "author": {"user": {"login": "pklinef", "name": "Phil Klinefelter"}}, "url": "https://github.com/codice/ddf/commit/18e8bcfaf06e547974a70cca3a3325cbd0d96b0c", "committedDate": "2020-05-12T23:34:09Z", "message": "Configure collection options by property file"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "97ceee64518eafdffa12f9cc9c600e42475478ee", "author": {"user": {"login": "pklinef", "name": "Phil Klinefelter"}}, "url": "https://github.com/codice/ddf/commit/97ceee64518eafdffa12f9cc9c600e42475478ee", "committedDate": "2020-05-04T22:57:38Z", "message": "Configure collection options by property file"}, "afterCommit": {"oid": "18e8bcfaf06e547974a70cca3a3325cbd0d96b0c", "author": {"user": {"login": "pklinef", "name": "Phil Klinefelter"}}, "url": "https://github.com/codice/ddf/commit/18e8bcfaf06e547974a70cca3a3325cbd0d96b0c", "committedDate": "2020-05-12T23:34:09Z", "message": "Configure collection options by property file"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwODM5NDQ3", "url": "https://github.com/codice/ddf/pull/6041#pullrequestreview-410839447", "createdAt": "2020-05-13T11:41:28Z", "commit": {"oid": "18e8bcfaf06e547974a70cca3a3325cbd0d96b0c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEwOTc3ODAy", "url": "https://github.com/codice/ddf/pull/6041#pullrequestreview-410977802", "createdAt": "2020-05-13T14:23:47Z", "commit": {"oid": "18e8bcfaf06e547974a70cca3a3325cbd0d96b0c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExMDkwOTE3", "url": "https://github.com/codice/ddf/pull/6041#pullrequestreview-411090917", "createdAt": "2020-05-13T16:20:17Z", "commit": {"oid": "18e8bcfaf06e547974a70cca3a3325cbd0d96b0c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNjoyMDoxN1rOGU5fGw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNjoyMDoxN1rOGU5fGw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU2NjU1NQ==", "bodyText": "do the coverage numbers change with this addition?", "url": "https://github.com/codice/ddf/pull/6041#discussion_r424566555", "createdAt": "2020-05-13T16:20:17Z", "author": {"login": "bdeining"}, "path": "platform/solr/solr-factory-impl/src/test/java/org/codice/solr/factory/impl/CollectionConfigTest.java", "diffHunk": "@@ -0,0 +1,61 @@\n+/**\n+ * Copyright (c) Codice Foundation\n+ *\n+ * <p>This is free software: you can redistribute it and/or modify it under the terms of the GNU\n+ * Lesser General Public License as published by the Free Software Foundation, either version 3 of\n+ * the License, or any later version.\n+ *\n+ * <p>This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;\n+ * without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * GNU Lesser General Public License for more details. A copy of the GNU Lesser General Public\n+ * License is distributed along with this program and can be found at\n+ * <http://www.gnu.org/licenses/lgpl.html>.\n+ */\n+package org.codice.solr.factory.impl;\n+\n+import static org.hamcrest.core.Is.is;\n+import static org.junit.Assert.assertThat;\n+\n+import java.io.File;\n+import java.io.IOException;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.junit.rules.TemporaryFolder;\n+\n+public class CollectionConfigTest {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "18e8bcfaf06e547974a70cca3a3325cbd0d96b0c"}, "originalPosition": 27}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExMDkwOTk5", "url": "https://github.com/codice/ddf/pull/6041#pullrequestreview-411090999", "createdAt": "2020-05-13T16:20:22Z", "commit": {"oid": "18e8bcfaf06e547974a70cca3a3325cbd0d96b0c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4956, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}