{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgzODMxMzA2", "number": 5876, "title": "DDF-5875 Adds original tags to DeletedMetacard", "bodyText": "What does this PR do?\n\nYou can now search for deleted metacards original tags by querying the field\n\nHow should this be tested?\nEnsure nothing breaks, ensure you can query on DeletedMetacards original tags field metacard.deleted.tags\nAny background context you want to provide?\n\nThis is functionality that its sibling class (MetacardVersionImpl) has but this class never got for some reason. So this is something that probably should have been there but wasn't before. No hard schema changes so upgrade can be done with no migrations to continue working.\n\nWhat are the relevant tickets?\nFixes: #5875\nChecklist:\n\n Documentation Updated\n Update / Add Threat Dragon models\n\nonly adding additional metadata about what the original metacard was (eg, a workspace) no resource metadata is exposed.\n\n\n Update / Add Unit Tests\n\nNotes on Review Process\nPlease see Notes on Review Process for further guidance on requirements for merging and abbreviated reviews.\nReview Comment Legend:\n\n\u270f\ufe0f (Pencil) This comment is a nitpick or style suggestion, no action required for approval. This comment should provide a suggestion either as an in line code snippet or a gist.\n\u2753 (Question Mark) This comment is to gain a clearer understanding of design or code choices, clarification is required but action may not be necessary for approval.\n\u2757 (Exclamation Mark) This comment is critical and requires clarification or action before approval.", "createdAt": "2020-03-04T19:53:55Z", "url": "https://github.com/codice/ddf/pull/5876", "merged": true, "mergeCommit": {"oid": "902b66776b68c0c97d276b84139852cacc485c09"}, "closed": true, "closedAt": "2020-03-16T21:52:35Z", "author": {"login": "rzwiefel"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcKccG1AH2gAyMzgzODMxMzA2OmNmOGJkNzA5ZjRhNDViOGY3ZDM4MGNiMTA3YWI0ZGJkOGFiODdhOTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcMZcYaAFqTM3MjMzNjgyNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "cf8bd709f4a45b8f7d380cb107ab4dbd8ab87a92", "author": {"user": null}, "url": "https://github.com/codice/ddf/commit/cf8bd709f4a45b8f7d380cb107ab4dbd8ab87a92", "committedDate": "2020-03-04T19:53:22Z", "message": "DDF-5875 Adds original tags to DeletedMetacard\n\n - You can now search for deleted metacards original tags by querying the field"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5MDgwODgw", "url": "https://github.com/codice/ddf/pull/5876#pullrequestreview-369080880", "createdAt": "2020-03-04T19:59:56Z", "commit": {"oid": "cf8bd709f4a45b8f7d380cb107ab4dbd8ab87a92"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxOTo1OTo1NlrOFx7rLQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wNFQxOTo1OTo1NlrOFx7rLQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzkwMjI1Mw==", "bodyText": "Nice. I like this test even though this case is rare \u2705 Good stuff.", "url": "https://github.com/codice/ddf/pull/5876#discussion_r387902253", "createdAt": "2020-03-04T19:59:56Z", "author": {"login": "vinamartin"}, "path": "catalog/core/catalog-core-versioning/versioning-common/src/test/groovy/ddf/catalog/core/versioning/impl/DeletedMetacardImplSpec.groovy", "diffHunk": "@@ -0,0 +1,88 @@\n+/**\n+ * Copyright (c) Codice Foundation\n+ * <p>\n+ * This is free software: you can redistribute it and/or modify it under the terms of the GNU Lesser\n+ * General Public License as published by the Free Software Foundation, either version 3 of the\n+ * License, or any later version.\n+ * <p>\n+ * This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY; without\n+ * even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n+ * Lesser General Public License for more details. A copy of the GNU Lesser General Public License\n+ * is distributed along with this program and can be found at\n+ * <http://www.gnu.org/licenses/lgpl.html>.\n+ */\n+package ddf.catalog.core.versioning.impl\n+\n+import ddf.catalog.core.versioning.DeletedMetacard\n+import ddf.catalog.data.Metacard\n+import ddf.catalog.data.impl.AttributeImpl\n+import ddf.catalog.data.impl.MetacardImpl\n+import org.apache.shiro.subject.Subject\n+import org.apache.shiro.util.ThreadContext\n+import spock.lang.Specification\n+\n+\n+class DeletedMetacardImplSpec extends Specification {\n+\n+    void setup() {\n+        ThreadContext.bind(Mock(Subject))\n+\n+    }\n+\n+    void cleanup() {\n+        ThreadContext.unbindSubject()\n+    }\n+\n+    def \"Tags of metacard being deleted are stored in the deleted metacard\"() {\n+        setup:\n+        def id = \"OriginalMetacardId\"\n+        def title = \"Title\"\n+        def tags = ['a-special-tag', 'a-second-special-tag'] as Set\n+        Metacard metacard = new MetacardImpl().with {\n+            setAttribute(ID, id)\n+            setAttribute(TITLE, title)\n+            setAttribute(new AttributeImpl(TAGS, new ArrayList<>(tags)))\n+            return it\n+        }\n+\n+        when: \"deleted metacards are created from a metacard with specific tags\"\n+        def deletedMetacard = new DeletedMetacardImpl(\n+                \"DeletedMetacardId\",\n+                id,\n+                \"UserSubjectName\",\n+                \"VersionMetacardId\",\n+                metacard)\n+\n+        then: \"deleted metacards have those specific tags for searchability\"\n+        deletedMetacard.\n+                getAttribute(DeletedMetacard.DELETED_METACARD_TAGS)?.\n+                values?.\n+                containsAll(tags)\n+\n+        when: \"deleted metacard has no tags (which would be odd)\"\n+        Metacard metacardNoTags = new MetacardImpl().with {\n+            setAttribute(ID, id)\n+            setAttribute(TITLE, title)\n+            return it\n+        }\n+\n+        def deletedMetacardNoTags = new DeletedMetacardImpl(\n+                \"DeletedMetacardId\",\n+                id,\n+                \"UserSubjectName\",\n+                \"VersionMetacardId\",\n+                metacardNoTags)\n+        then: \"nothing bad happens and there is no deleted_metacard_tags\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cf8bd709f4a45b8f7d380cb107ab4dbd8ab87a92"}, "originalPosition": 75}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY5MTA4ODc4", "url": "https://github.com/codice/ddf/pull/5876#pullrequestreview-369108878", "createdAt": "2020-03-04T20:45:22Z", "commit": {"oid": "cf8bd709f4a45b8f7d380cb107ab4dbd8ab87a92"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyMzMyNzQ5", "url": "https://github.com/codice/ddf/pull/5876#pullrequestreview-372332749", "createdAt": "2020-03-10T21:24:37Z", "commit": {"oid": "cf8bd709f4a45b8f7d380cb107ab4dbd8ab87a92"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyMzM2ODI3", "url": "https://github.com/codice/ddf/pull/5876#pullrequestreview-372336827", "createdAt": "2020-03-10T21:31:49Z", "commit": {"oid": "cf8bd709f4a45b8f7d380cb107ab4dbd8ab87a92"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 45, "cost": 1, "resetAt": "2021-11-01T13:07:16Z"}}}