{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYyMzcxMDM3", "number": 5765, "title": "[2.19.x] DDF-5716 G-7628 Add support for specifying UTM coords with the hemisphere notation in the gazetteer", "bodyText": "Backport of #5718\nWhat does this PR do?\nWhen a user enters a UTM coordinate in the gazetteer search box with no latitude band, N is used as the default. This behavior makes is appear as if we support specifying the Northern or Southern hemisphere in place of the latitude band since the gazetteer correctly pans to the Northern hemisphere point. However, this is only a side-effect of how we are parsing the coordinates. In reality, N does not directly correspond to the Northern hemisphere. Instead, if the latitude band does not actually correspond with the northing value, then the invalid latitude band is used to indirectly determine which hemisphere to use with C-M latitude bands corresponding to the Southern hemisphere and N-X latitude bands corresponding the the Northern hemisphere. As a result, the default behavior of adding the N latitude band happens to correctly takes the user to the Northern hemisphere coordinate. But when they try to use the S latitude band as the Southern hemisphere equivalent, they are taken to the same coordinate as the N latitude band because S also falls between N-X.\nThis PR allows users to use the S latitude band by showing two suggestions for that case:\n\nthe usual coordinate with the S latitude band, and\nthe Southern hemisphere alternative\n\nFor consistency and to teach the users about this feature, two suggestions are also shown for coordinates with the N latitude band even though both actually point to the same location.\nIn addition, if no latitude band is entered then both the Northern hemisphere and Southern hemisphere suggestions are shown.\nWho is reviewing it?\n\n@brianfelix @brhumphe @kentmorrissey @mazarag2 @Lambeaux\nSelect relevant component teams:\n\nAsk 2 committers to review/merge the PR and tag them here.\n@bdeining\n@millerw8\nHow should this be tested?\n\n\nStart solr by running docker-compose up in distribution/docker/solrcloud\nStart DDF and install the standard profile (profile:install standard)\nIn the admin UI, go to \"Catalog UI Search\" and unselect \"Use Online Gazetteer\"\nIn the gazetteer search box in Intrigue, test these cases. Make sure the suggestions are shown as expected and the map pans to the correct location. You can use this tool (https://mappingsupport.com/p2/coordinates-utm-gissurfer-maps.html) to determine if the locations are correct and get new coordinates to test (right clicking on that map shows the UTM coordinates for that point).\n\n\n\n\nGazetteer Query\nUTM suggestion(s)\nLocation\n\n\n\n\n17R 461652mE 2993043mN\nUTM: [ 17R 461652mE 2993043mN ]\nFlorida\n\n\n19G 577867mE 5117939mN\nUTM: [ 19G 577867mE 5117939mN ]\nArgentina\n\n\n34 678879 6697434\nUTM: [ 34  678879mE 6697434mN N ], UTM: [ 34  678879mE 6697434mN N ]\nFinland, South Africa\n\n\n53S 571222mE 7287229mN\nUTM: [ 53 570673mE 7181387mN N ], UTM: [ 53 570673mE 7181387mN N ]\nRussia, Australia\n\n\n20N 235789mE 756626mN\nUTM: [ 20N 235789mE 756626mN ], UTM: [ 20 235789mE 756626mN N ]\nBoth go to Venezuela\n\n\n10U 432103mE 5412830mN 19R 430147mE 2862469mN\nUTM: [ 10U 432103mE 5412830mN 19R ] [ 430147mE 2862469mN ]\nThe extent of the US\n\n\n\n\nEnter combinations of UTM and UPS coordinates\n\nVerify if only UTM coordinates are entered, the suggestion prefix is UTM\nVerify if only UPS coordinates are entered, the suggestion prefix is UPS\nVerify if a mix of UTM and UPS coordinates are entered, the suggestion prefix is UTM/UPS\n\n\nTry any other coordinates / combinations of coordinates\nTry some malformed coordinates (i.e. no zone, no latitude band, no units, multiple spaces, etc)\n\nAny background context you want to provide?\nWhat are the relevant tickets?\nFixes: #5716\nScreenshots\nS latitude band and Southern hemisphere suggestions\n\nChecklist:\n\n Documentation Updated\n Update / Add Threat Dragon models\n Update / Add Unit Tests\n Update / Add Integration Tests\n\nNotes on Review Process\nPlease see Notes on Review Process for further guidance on requirements for merging and abbreviated reviews.\nReview Comment Legend:\n\n\u270f\ufe0f (Pencil) This comment is a nitpick or style suggestion, no action required for approval. This comment should provide a suggestion either as an in line code snippet or a gist.\n\u2753 (Question Mark) This comment is to gain a clearer understanding of design or code choices, clarification is required but action may not be necessary for approval.\n\u2757 (Exclamation Mark) This comment is critical and requires clarification or action before approval.", "createdAt": "2020-01-13T23:24:34Z", "url": "https://github.com/codice/ddf/pull/5765", "merged": true, "mergeCommit": {"oid": "209b4bdc6aed31bcbdcf5c3d3764a3c80fc5e393"}, "closed": true, "closedAt": "2020-01-15T19:34:06Z", "author": {"login": "mojogitoverhere"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb6E1-rgH2gAyMzYyMzcxMDM3Ojg5ZWYxZmZiMTlhMjg5YjI2OTFlNjI4M2MyMWU1YmZjMjBlZGQ1YmQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb6pUUJAFqTM0MzQwNjgzMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "89ef1ffb19a289b2691e6283c21e5bfc20edd5bd", "author": {"user": {"login": "mojogitoverhere", "name": "David Morales"}}, "url": "https://github.com/codice/ddf/commit/89ef1ffb19a289b2691e6283c21e5bfc20edd5bd", "committedDate": "2020-01-13T23:21:07Z", "message": "DDF-5716 G-7628 Add support for specifying UTM coords with the hemisphere notation in the gazetteer  (#5718)\n\n* DDF-5716 Added hemisphere support\r\n\r\nDDF-0000 Added multiple suggestions for single UTM/UPS coord\r\n\r\nDDF-0000 Add support for hemisphere suggestions\r\n\r\n* DDF-5716 Clean up unit tests\r\n\r\n* DDF-5716 Remove comment\r\n\r\n* DDF-5716 Split up \"UTM/UPS\" prefix, make hemisphere suggestion more explicit\r\n\r\n* DDF-5716 Only show UTM/UPS prefix if both UTM and UPS points are entered\r\n\r\n* DDF-5716 Removed left over TODO\r\n\r\n* DDF-5716 Removed Nullable annotation\r\n\r\n* DDF-5716 Fixed javadoc"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQyNzMzMDkw", "url": "https://github.com/codice/ddf/pull/5765#pullrequestreview-342733090", "createdAt": "2020-01-14T18:07:57Z", "commit": {"oid": "89ef1ffb19a289b2691e6283c21e5bfc20edd5bd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQyOTA5MjIz", "url": "https://github.com/codice/ddf/pull/5765#pullrequestreview-342909223", "createdAt": "2020-01-14T23:35:35Z", "commit": {"oid": "89ef1ffb19a289b2691e6283c21e5bfc20edd5bd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQyOTM4MTMw", "url": "https://github.com/codice/ddf/pull/5765#pullrequestreview-342938130", "createdAt": "2020-01-15T01:10:42Z", "commit": {"oid": "89ef1ffb19a289b2691e6283c21e5bfc20edd5bd"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQwMToxMDo0MlrOFdqwCQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xNVQwMToxMToxN1rOFdqwhA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjY1MzQ0OQ==", "bodyText": "\u2757\ufe0f This is not going to accomplish exactly what you want. The isUTM and isUPS functions tell you if the coordinate \"data\" exists in the \"space\", not what the text format is. On top of that, there is overlap, so both functions could return true. They are not mutually exclusive.\nSee my comments on my review of the PR against master: #5718 (review)", "url": "https://github.com/codice/ddf/pull/5765#discussion_r366653449", "createdAt": "2020-01-15T01:10:42Z", "author": {"login": "Lambeaux"}, "path": "catalog/ui/catalog-ui-search/src/main/java/org/codice/ddf/catalog/ui/query/suggestion/UtmUpsCoordinateProcessor.java", "diffHunk": "@@ -76,42 +79,178 @@ public UtmUpsCoordinateProcessor(CoordinateSystemTranslator translator) {\n    */\n   public void enhanceResults(final List<Suggestion> results, final String query) {\n     LOGGER.trace(\"(UTM/UPS) Adding result for query [{}]\", query);\n-    final LiteralSuggestion literal = getUtmUpsSuggestion(query);\n-    if (literal != null && literal.hasGeo()) {\n-      LOGGER.trace(\"Adding the UTM/UPS suggestion to results [{}]\", literal);\n-      results.add(0, literal);\n-    }\n+    final List<LiteralSuggestion> literals = getUtmUpsSuggestions(query);\n+    literals\n+        .stream()\n+        .filter(Objects::nonNull)\n+        .filter(LiteralSuggestion::hasGeo)\n+        .forEach(\n+            literal -> {\n+              LOGGER.trace(\"Adding the UTM/UPS suggestion to results [{}]\", literal);\n+              results.add(0, literal);\n+            });\n     LOGGER.trace(\"(UTM/UPS) Done\");\n   }\n \n-  @Nullable\n-  private LiteralSuggestion getUtmUpsSuggestion(final String query) {\n+  private List<LiteralSuggestion> getUtmUpsSuggestions(final String query) {\n     final Matcher matcher = PATTERN_UTM_OR_UPS_COORDINATE.matcher(query);\n-    final StringBuilder nameBuilder = new StringBuilder(\"UTM/UPS:\");\n-    final List<UtmUpsCoordinate> utmUpsCoords = new ArrayList<>();\n+    final List<String> utmUpsMatches = new ArrayList<>();\n     while (matcher.find()) {\n       final String group = matcher.group();\n       LOGGER.trace(\"Match found [{}]\", group);\n-      final String utmOrUpsText = normalizeCoordinate(group);\n-      final UtmUpsCoordinate utmUps = parseUtmUpsString(utmOrUpsText);\n-      if (utmUps != null) {\n-        nameBuilder.append(\" [ \").append(utmUps.toString()).append(\" ]\");\n-        utmUpsCoords.add(utmUps);\n-      }\n+      utmUpsMatches.add(capitalizeLatBand(group));\n     }\n-    if (utmUpsCoords.isEmpty()) {\n+\n+    if (utmUpsMatches.isEmpty()) {\n       LOGGER.trace(\"No valid UTM or UPS strings could be inferred from query [{}]\", query);\n-      return null;\n+      return Collections.emptyList();\n+    }\n+\n+    return utmUpsMatches.size() == 1\n+        ? suggestionsForSinglePoint(utmUpsMatches.get(0))\n+        : Collections.singletonList(suggestionForMultiplePoints(utmUpsMatches));\n+  }\n+\n+  /**\n+   * Generates a list of {@link LiteralSuggestion}s based on the given {@code utmUpsCoord} string.\n+   * This method is only used to generate suggestions when the user enters a single UTM/UPS\n+   * coordinate. The following suggestions are returned depending on the information provided in the\n+   * coordinate:\n+   *\n+   * <ul>\n+   *   <li>If the {@code utmUpsCoord} does not have a latitude band, then two suggestions are\n+   *       returned - one for each hemisphere - and the hemisphere is denoted by a \"N\" or \"S\"\n+   *       suffix. Example: \"18 631054mE 4776851mN\" -> \"UTM/UPS: [ 18N 631054mE 4776851mN N ]\",\n+   *       \"UTM/UPS: [ 18S 631054mE 4776851mN S ]\"\n+   *   <li>If the {@code utmpUpsCoord} has an S latitude band, then two suggestions are also\n+   *       returned: one for the S latitude band coordinate and another for the Southern hemisphere\n+   *       coordinate. This is because the \"S\" is ambiguous - it can either refer to the latitude\n+   *       band or the Southern hemisphere. Example: \"15S 533427mE 3796272mN\" -> \"UTM/UPS: [ 15S\n+   *       533427mE 3796272mN ]\", \"UTM/UPS: [ 15S 533427mE 3796272mN S ]\"\n+   *   <li>If the {@code utmUpsCoord} has an N latitude band, then two suggestions are returned: one\n+   *       for the N latitude band and another for the Northern hemisphere. The \"N\" isn't ambiguous\n+   *       in this case, but the Northern hemisphere suggestion is included for consistency and to\n+   *       teach users about the N/S hemisphere syntax. Example: \"9N 365103mE 659568mN\" -> \"UTM/UPS:\n+   *       [ 9N 365103mE 659568mN ]\", \"UTM/UPS: [ 9N 365103mE 659568mN N ]\"\n+   *   <li>Otherwise, one suggestion is returned. Example: \"20M 48831mE09437282mN\" -> \"UTM/UPS: [\n+   *       20M 48831mE09437282mN ]\"\n+   * </ul>\n+   *\n+   * @param utmUpsCoord the user-provided gazetteer query text. It must match the {@code\n+   *     PATTERN_UTM_OR_UPS_COORDINATE} pattern.\n+   * @return a list of either one or two {@link LiteralSuggestion}s, depending on the latitude band\n+   *     of {@code utmUpsCoord}\n+   */\n+  private List<LiteralSuggestion> suggestionsForSinglePoint(String utmUpsCoord) {\n+    final Character latBand = getLatBand(utmUpsCoord);\n+    if (latBand == null) {\n+      // A coordinate without an NS indicator and a lat band is invalid so show two suggestions,\n+      // one for the northern hemisphere and another for the southern hemisphere.\n+      return Stream.of(parseUtmUpsString(utmUpsCoord + \" S\"), parseUtmUpsString(utmUpsCoord + \" N\"))\n+          .filter(Objects::nonNull)\n+          .map(this::suggestion)\n+          .collect(toList());\n+    } else if (latBand.equals('N')) {\n+      // If the coordinate has a N lat band, include the northern hemisphere suggestion for\n+      // convenience\n+      return Stream.of(\n+              parseUtmUpsString(removeLatBand(utmUpsCoord) + \" N\"), parseUtmUpsString(utmUpsCoord))\n+          .filter(Objects::nonNull)\n+          .map(this::suggestion)\n+          .collect(toList());\n+    } else if (latBand.equals('S')) {\n+      // Similarly, if the coordinate has an S lat band, include the southern hemisphere\n+      // suggestion for convenience\n+      return Stream.of(\n+              parseUtmUpsString(removeLatBand(utmUpsCoord) + \" S\"), parseUtmUpsString(utmUpsCoord))\n+          .filter(Objects::nonNull)\n+          .map(this::suggestion)\n+          .collect(toList());\n+    } else {\n+      return Stream.of(parseUtmUpsString(utmUpsCoord))\n+          .filter(Objects::nonNull)\n+          .map(this::suggestion)\n+          .collect(toList());\n     }\n+  }\n+\n+  private LiteralSuggestion suggestion(UtmUpsCoordinate utmUps) {\n     return new LiteralSuggestion(\n         LITERAL_SUGGESTION_ID,\n-        nameBuilder.toString(),\n+        makeSuggestionText(utmUps),\n+        Collections.singletonList(latLonFromUtmUtps(utmUps)));\n+  }\n+\n+  /**\n+   * Generates one {@link LiteralSuggestion} by combining the latitude/longitude values of each\n+   * UTM/UPS coordinate in the {@code utmUpsCoords} list. This method is used to generate a\n+   * suggestion when the user enters multiple UTM/UPS coordinates. No additional suggestions are\n+   * made for each point for simplicity since the map will pan to the extent or bounding box of all\n+   * the points. As a result, the N/S characters of each coordinate are always treated as latitude\n+   * bands and a coordinate is considered invalid if a latitude band is not included. Example: \"12S\n+   * 241451mE 4101052mN 13R 37090mE 63394439mN\" -> \"UTM/UPS: [ 12S 241451mE 4101052mN ] [ 13R\n+   * 37090mE 63394439mN ]\"\n+   *\n+   * @param utmUpsCoords a list of strings matching the {@code PATTERN_UTM_OR_UPS_COORDINATE}\n+   *     pattern, created from the user-provided gazetteer query text.\n+   * @return a singleton list with one {@link LiteralSuggestion} with the combined list of\n+   *     latitude/longitude values.\n+   */\n+  private LiteralSuggestion suggestionForMultiplePoints(final List<String> utmUpsCoords) {\n+    List<UtmUpsCoordinate> utmUpsList =\n         utmUpsCoords\n             .stream()\n-            .map(this::toLatLon)\n+            .map(this::parseUtmUpsString)\n             .filter(Objects::nonNull)\n-            .map(d -> new LatLon(d.getLat(), d.getLon()))\n-            .collect(Collectors.toList()));\n+            .collect(toList());\n+    List<LatLon> latLonList =\n+        utmUpsList.stream().map(this::latLonFromUtmUtps).filter(Objects::nonNull).collect(toList());\n+    String suggestionText = makeSuggestionText(utmUpsList);\n+\n+    return new LiteralSuggestion(LITERAL_SUGGESTION_ID, suggestionText, latLonList);\n+  }\n+\n+  private static String makeSuggestionText(UtmUpsCoordinate utmUps) {\n+    final StringBuilder nameBuilder = new StringBuilder();\n+    if (utmUps.isUTM()) {\n+      nameBuilder.append(\"UTM: [ \").append(utmUps.toString()).append(\" ]\");\n+      if (utmUps.getLatitudeBand() == null) {\n+        if (utmUps.getNSIndicator() == NSIndicator.SOUTH) {\n+          nameBuilder.append(\" (Southern)\");\n+        } else {\n+          nameBuilder.append(\" (Northern)\");\n+        }\n+      }\n+    } else {\n+      nameBuilder.append(\"UPS: [ \").append(utmUps.toString()).append(\" ]\");\n+    }\n+    return nameBuilder.toString();\n+  }\n+\n+  private static String makeSuggestionText(List<UtmUpsCoordinate> utmUpsList) {\n+    final StringBuilder nameBuilder = new StringBuilder();\n+    long numberOfUtmCoords = utmUpsList.stream().filter(UtmUpsCoordinate::isUTM).count();\n+    int total = utmUpsList.size();\n+    if (numberOfUtmCoords == total) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89ef1ffb19a289b2691e6283c21e5bfc20edd5bd"}, "originalPosition": 200}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjY1MzU3Mg==", "bodyText": "\u2757\ufe0f Same here. This isn't exactly what you want.", "url": "https://github.com/codice/ddf/pull/5765#discussion_r366653572", "createdAt": "2020-01-15T01:11:17Z", "author": {"login": "Lambeaux"}, "path": "catalog/ui/catalog-ui-search/src/main/java/org/codice/ddf/catalog/ui/query/suggestion/UtmUpsCoordinateProcessor.java", "diffHunk": "@@ -76,42 +79,178 @@ public UtmUpsCoordinateProcessor(CoordinateSystemTranslator translator) {\n    */\n   public void enhanceResults(final List<Suggestion> results, final String query) {\n     LOGGER.trace(\"(UTM/UPS) Adding result for query [{}]\", query);\n-    final LiteralSuggestion literal = getUtmUpsSuggestion(query);\n-    if (literal != null && literal.hasGeo()) {\n-      LOGGER.trace(\"Adding the UTM/UPS suggestion to results [{}]\", literal);\n-      results.add(0, literal);\n-    }\n+    final List<LiteralSuggestion> literals = getUtmUpsSuggestions(query);\n+    literals\n+        .stream()\n+        .filter(Objects::nonNull)\n+        .filter(LiteralSuggestion::hasGeo)\n+        .forEach(\n+            literal -> {\n+              LOGGER.trace(\"Adding the UTM/UPS suggestion to results [{}]\", literal);\n+              results.add(0, literal);\n+            });\n     LOGGER.trace(\"(UTM/UPS) Done\");\n   }\n \n-  @Nullable\n-  private LiteralSuggestion getUtmUpsSuggestion(final String query) {\n+  private List<LiteralSuggestion> getUtmUpsSuggestions(final String query) {\n     final Matcher matcher = PATTERN_UTM_OR_UPS_COORDINATE.matcher(query);\n-    final StringBuilder nameBuilder = new StringBuilder(\"UTM/UPS:\");\n-    final List<UtmUpsCoordinate> utmUpsCoords = new ArrayList<>();\n+    final List<String> utmUpsMatches = new ArrayList<>();\n     while (matcher.find()) {\n       final String group = matcher.group();\n       LOGGER.trace(\"Match found [{}]\", group);\n-      final String utmOrUpsText = normalizeCoordinate(group);\n-      final UtmUpsCoordinate utmUps = parseUtmUpsString(utmOrUpsText);\n-      if (utmUps != null) {\n-        nameBuilder.append(\" [ \").append(utmUps.toString()).append(\" ]\");\n-        utmUpsCoords.add(utmUps);\n-      }\n+      utmUpsMatches.add(capitalizeLatBand(group));\n     }\n-    if (utmUpsCoords.isEmpty()) {\n+\n+    if (utmUpsMatches.isEmpty()) {\n       LOGGER.trace(\"No valid UTM or UPS strings could be inferred from query [{}]\", query);\n-      return null;\n+      return Collections.emptyList();\n+    }\n+\n+    return utmUpsMatches.size() == 1\n+        ? suggestionsForSinglePoint(utmUpsMatches.get(0))\n+        : Collections.singletonList(suggestionForMultiplePoints(utmUpsMatches));\n+  }\n+\n+  /**\n+   * Generates a list of {@link LiteralSuggestion}s based on the given {@code utmUpsCoord} string.\n+   * This method is only used to generate suggestions when the user enters a single UTM/UPS\n+   * coordinate. The following suggestions are returned depending on the information provided in the\n+   * coordinate:\n+   *\n+   * <ul>\n+   *   <li>If the {@code utmUpsCoord} does not have a latitude band, then two suggestions are\n+   *       returned - one for each hemisphere - and the hemisphere is denoted by a \"N\" or \"S\"\n+   *       suffix. Example: \"18 631054mE 4776851mN\" -> \"UTM/UPS: [ 18N 631054mE 4776851mN N ]\",\n+   *       \"UTM/UPS: [ 18S 631054mE 4776851mN S ]\"\n+   *   <li>If the {@code utmpUpsCoord} has an S latitude band, then two suggestions are also\n+   *       returned: one for the S latitude band coordinate and another for the Southern hemisphere\n+   *       coordinate. This is because the \"S\" is ambiguous - it can either refer to the latitude\n+   *       band or the Southern hemisphere. Example: \"15S 533427mE 3796272mN\" -> \"UTM/UPS: [ 15S\n+   *       533427mE 3796272mN ]\", \"UTM/UPS: [ 15S 533427mE 3796272mN S ]\"\n+   *   <li>If the {@code utmUpsCoord} has an N latitude band, then two suggestions are returned: one\n+   *       for the N latitude band and another for the Northern hemisphere. The \"N\" isn't ambiguous\n+   *       in this case, but the Northern hemisphere suggestion is included for consistency and to\n+   *       teach users about the N/S hemisphere syntax. Example: \"9N 365103mE 659568mN\" -> \"UTM/UPS:\n+   *       [ 9N 365103mE 659568mN ]\", \"UTM/UPS: [ 9N 365103mE 659568mN N ]\"\n+   *   <li>Otherwise, one suggestion is returned. Example: \"20M 48831mE09437282mN\" -> \"UTM/UPS: [\n+   *       20M 48831mE09437282mN ]\"\n+   * </ul>\n+   *\n+   * @param utmUpsCoord the user-provided gazetteer query text. It must match the {@code\n+   *     PATTERN_UTM_OR_UPS_COORDINATE} pattern.\n+   * @return a list of either one or two {@link LiteralSuggestion}s, depending on the latitude band\n+   *     of {@code utmUpsCoord}\n+   */\n+  private List<LiteralSuggestion> suggestionsForSinglePoint(String utmUpsCoord) {\n+    final Character latBand = getLatBand(utmUpsCoord);\n+    if (latBand == null) {\n+      // A coordinate without an NS indicator and a lat band is invalid so show two suggestions,\n+      // one for the northern hemisphere and another for the southern hemisphere.\n+      return Stream.of(parseUtmUpsString(utmUpsCoord + \" S\"), parseUtmUpsString(utmUpsCoord + \" N\"))\n+          .filter(Objects::nonNull)\n+          .map(this::suggestion)\n+          .collect(toList());\n+    } else if (latBand.equals('N')) {\n+      // If the coordinate has a N lat band, include the northern hemisphere suggestion for\n+      // convenience\n+      return Stream.of(\n+              parseUtmUpsString(removeLatBand(utmUpsCoord) + \" N\"), parseUtmUpsString(utmUpsCoord))\n+          .filter(Objects::nonNull)\n+          .map(this::suggestion)\n+          .collect(toList());\n+    } else if (latBand.equals('S')) {\n+      // Similarly, if the coordinate has an S lat band, include the southern hemisphere\n+      // suggestion for convenience\n+      return Stream.of(\n+              parseUtmUpsString(removeLatBand(utmUpsCoord) + \" S\"), parseUtmUpsString(utmUpsCoord))\n+          .filter(Objects::nonNull)\n+          .map(this::suggestion)\n+          .collect(toList());\n+    } else {\n+      return Stream.of(parseUtmUpsString(utmUpsCoord))\n+          .filter(Objects::nonNull)\n+          .map(this::suggestion)\n+          .collect(toList());\n     }\n+  }\n+\n+  private LiteralSuggestion suggestion(UtmUpsCoordinate utmUps) {\n     return new LiteralSuggestion(\n         LITERAL_SUGGESTION_ID,\n-        nameBuilder.toString(),\n+        makeSuggestionText(utmUps),\n+        Collections.singletonList(latLonFromUtmUtps(utmUps)));\n+  }\n+\n+  /**\n+   * Generates one {@link LiteralSuggestion} by combining the latitude/longitude values of each\n+   * UTM/UPS coordinate in the {@code utmUpsCoords} list. This method is used to generate a\n+   * suggestion when the user enters multiple UTM/UPS coordinates. No additional suggestions are\n+   * made for each point for simplicity since the map will pan to the extent or bounding box of all\n+   * the points. As a result, the N/S characters of each coordinate are always treated as latitude\n+   * bands and a coordinate is considered invalid if a latitude band is not included. Example: \"12S\n+   * 241451mE 4101052mN 13R 37090mE 63394439mN\" -> \"UTM/UPS: [ 12S 241451mE 4101052mN ] [ 13R\n+   * 37090mE 63394439mN ]\"\n+   *\n+   * @param utmUpsCoords a list of strings matching the {@code PATTERN_UTM_OR_UPS_COORDINATE}\n+   *     pattern, created from the user-provided gazetteer query text.\n+   * @return a singleton list with one {@link LiteralSuggestion} with the combined list of\n+   *     latitude/longitude values.\n+   */\n+  private LiteralSuggestion suggestionForMultiplePoints(final List<String> utmUpsCoords) {\n+    List<UtmUpsCoordinate> utmUpsList =\n         utmUpsCoords\n             .stream()\n-            .map(this::toLatLon)\n+            .map(this::parseUtmUpsString)\n             .filter(Objects::nonNull)\n-            .map(d -> new LatLon(d.getLat(), d.getLon()))\n-            .collect(Collectors.toList()));\n+            .collect(toList());\n+    List<LatLon> latLonList =\n+        utmUpsList.stream().map(this::latLonFromUtmUtps).filter(Objects::nonNull).collect(toList());\n+    String suggestionText = makeSuggestionText(utmUpsList);\n+\n+    return new LiteralSuggestion(LITERAL_SUGGESTION_ID, suggestionText, latLonList);\n+  }\n+\n+  private static String makeSuggestionText(UtmUpsCoordinate utmUps) {\n+    final StringBuilder nameBuilder = new StringBuilder();\n+    if (utmUps.isUTM()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "89ef1ffb19a289b2691e6283c21e5bfc20edd5bd"}, "originalPosition": 181}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQzNDAzMzk4", "url": "https://github.com/codice/ddf/pull/5765#pullrequestreview-343403398", "createdAt": "2020-01-15T17:45:24Z", "commit": {"oid": "89ef1ffb19a289b2691e6283c21e5bfc20edd5bd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQzNDA2ODMz", "url": "https://github.com/codice/ddf/pull/5765#pullrequestreview-343406833", "createdAt": "2020-01-15T17:50:50Z", "commit": {"oid": "89ef1ffb19a289b2691e6283c21e5bfc20edd5bd"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4963, "cost": 1, "resetAt": "2021-11-01T13:51:04Z"}}}