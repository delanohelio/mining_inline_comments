{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAxODU3NTY3", "number": 6378, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxOToyNDo1MFrOEtMJtA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxODowNDoyMFrOEw4kSA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE1ODIwNDY4OnYy", "diffSide": "RIGHT", "path": "ui/packages/catalog-ui-search/src/main/webapp/react-component/list-create/list-create.js", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxOToyNDo1MFrOHg2BQw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xM1QxOToyODowOVrOHg2IVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDIwMTUzOQ==", "bodyText": "\u2753 why is there an empty span here?", "url": "https://github.com/codice/ddf/pull/6378#discussion_r504201539", "createdAt": "2020-10-13T19:24:50Z", "author": {"login": "cassandrabailey293"}, "path": "ui/packages/catalog-ui-search/src/main/webapp/react-component/list-create/list-create.js", "diffHunk": "@@ -43,6 +43,7 @@ const AddButton = props => {\n       style={{ width: '100%' }}\n     >\n       <span className=\"fa fa-plus\" />\n+      <span> </span>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "247fb0668ad78c909f04ab2a85e2857dc8c85693"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDIwMzM0OA==", "bodyText": "(Issue 5) To give the space between the + and the word for these. \"+Create New List\" and \"+Create New List with Result(s)\". Original added the space on line 47 to the existing span, but thought this would make it more apparent", "url": "https://github.com/codice/ddf/pull/6378#discussion_r504203348", "createdAt": "2020-10-13T19:28:09Z", "author": {"login": "abel-connexta"}, "path": "ui/packages/catalog-ui-search/src/main/webapp/react-component/list-create/list-create.js", "diffHunk": "@@ -43,6 +43,7 @@ const AddButton = props => {\n       style={{ width: '100%' }}\n     >\n       <span className=\"fa fa-plus\" />\n+      <span> </span>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDIwMTUzOQ=="}, "originalCommit": {"oid": "247fb0668ad78c909f04ab2a85e2857dc8c85693"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE4NjIwMTY5OnYy", "diffSide": "RIGHT", "path": "catalog/ui/catalog-ui-search/src/main/java/org/codice/ddf/catalog/ui/metacard/workspace/ListMetacardTypeImpl.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxNTo1Njo0OVrOHlFK8Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxNTo1Njo0OVrOHlFK8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODY0NDA4MQ==", "bodyText": "\u270f\ufe0f I think we should add a comment above LIST_CQL on line 31 to explain how it is being deprecated in favor of list.filters and should now be considered read-only", "url": "https://github.com/codice/ddf/pull/6378#discussion_r508644081", "createdAt": "2020-10-20T15:56:49Z", "author": {"login": "mojogitoverhere"}, "path": "catalog/ui/catalog-ui-search/src/main/java/org/codice/ddf/catalog/ui/metacard/workspace/ListMetacardTypeImpl.java", "diffHunk": "@@ -34,6 +34,8 @@\n \n   public static final String LIST_BOOKMARKS = \"list.bookmarks\";\n \n+  public static final String LIST_FILTERS = \"list.filters\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3378b5a380422e1d7747bb47ec8e16bfedaf8b5d"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE4NjMyMzQ1OnYy", "diffSide": "RIGHT", "path": "ui/packages/catalog-ui-search/src/main/webapp/component/result-add/result-add.view.js", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxNjoxNjo1NFrOHlGZBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxNjoxNjo1NFrOHlGZBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODY2NDA2OA==", "bodyText": "\u270f\ufe0f you can still use the shorthand notation without the return here\n      if (list['list.filters']) {\n        list.matchesFilter = this.model.every(result => \n          result.matchesFilters(list['list.filters'])\n        )", "url": "https://github.com/codice/ddf/pull/6378#discussion_r508664068", "createdAt": "2020-10-20T16:16:54Z", "author": {"login": "mojogitoverhere"}, "path": "ui/packages/catalog-ui-search/src/main/webapp/component/result-add/result-add.view.js", "diffHunk": "@@ -83,13 +83,13 @@ module.exports = Marionette.LayoutView.extend({\n     let listJSON = store\n       .getCurrentWorkspace()\n       .get('lists')\n-      .toJSON()\n+      .models.map(listModel => listModel.toJSON('keepObjs'))\n     listJSON = listJSON.map(list => {\n       list.matchesFilter = true\n-      if (list['list.cql'] !== '') {\n-        list.matchesFilter = this.model.every(result =>\n-          result.matchesCql(list['list.cql'])\n-        )\n+      if (list['list.filters']) {\n+        list.matchesFilter = this.model.every(result => {\n+          return result.matchesFilters(list['list.filters'])\n+        })", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3378b5a380422e1d7747bb47ec8e16bfedaf8b5d"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE4NjQ5MTkzOnYy", "diffSide": "RIGHT", "path": "ui/packages/catalog-ui-search/src/main/webapp/js/model/List.js", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxNjo1Nzo0OVrOHlIChw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxOTo0OTozN1rOHlOclw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODY5MTA3OQ==", "bodyText": "\u2753 This looks like a code smell to me. Does the code expect list.filters to be a string and in some places and an object in others?", "url": "https://github.com/codice/ddf/pull/6378#discussion_r508691079", "createdAt": "2020-10-20T16:57:49Z", "author": {"login": "mojogitoverhere"}, "path": "ui/packages/catalog-ui-search/src/main/webapp/js/model/List.js", "diffHunk": "@@ -86,6 +112,47 @@ module.exports = Backbone.AssociatedModel.extend(\n         this.updateQuery\n       )\n     },\n+    set(data, ...args) {\n+      if (typeof data === 'object') {\n+        // for backwards compatability\n+        if (data['list.cql'] && !data['list.filters']) {\n+          try {\n+            const filterTree = CQLUtils.transformCQLToFilter(data['list.cql'])\n+            data['list.filters'] = simplifyListFilter(filterTree)\n+          } catch (e) {\n+            console.log('Invalid cql: ' + data['list.cql'])\n+          }\n+          data['list.cql'] = undefined\n+        } else if (\n+          data['list.filters'] &&\n+          typeof data['list.filters'] === 'string'\n+        ) {\n+          try {\n+            data['list.filters'] = JSON.parse(data['list.filters'])\n+          } catch (e) {\n+            data['list.filters'] = undefined\n+          }\n+        }\n+      } else if (data === 'list.filters' && args.length == 1) {\n+        args = [simplifyListFilter(args[0])]\n+      }\n+      if (!IGNORED_DEPRECATED_ATTRIBUTES.includes(data)) {\n+        return Backbone.AssociatedModel.prototype.set.call(this, data, ...args)\n+      }\n+    },\n+    get(attr) {\n+      if (!IGNORED_DEPRECATED_ATTRIBUTES.includes(attr)) {\n+        return Backbone.AssociatedModel.prototype.get.call(this, attr)\n+      }\n+    },\n+    toJSON(...args) {\n+      const json = Backbone.AssociatedModel.prototype.toJSON.call(this, ...args)\n+      const keepObjs = args.length > 0 ? args.includes('keepObjs') : false\n+      if (!keepObjs && typeof json['list.filters'] === 'object') {\n+        json['list.filters'] = JSON.stringify(json['list.filters'])", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3378b5a380422e1d7747bb47ec8e16bfedaf8b5d"}, "originalPosition": 96}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODc1MzQ4Nw==", "bodyText": "In some cases such as here \n  \n    \n      ddf/ui/packages/catalog-ui-search/src/main/webapp/component/result-add/result-add.view.js\n    \n    \n         Line 90\n      in\n      3378b5a\n    \n    \n    \n    \n\n        \n          \n           list.matchesFilter = this.model.every(result => { \n        \n    \n  \n\n we want to iterate through the list.filters as an object and have no use of its stringify version. I could get it as a string, but will need to convert it as an object to iterate through it, thought this would be more efficient since won't need to do 2 conversions. Should I change it so each time want to use it as an object, the person calling it, should be responsible for converting it?", "url": "https://github.com/codice/ddf/pull/6378#discussion_r508753487", "createdAt": "2020-10-20T18:37:36Z", "author": {"login": "abel-connexta"}, "path": "ui/packages/catalog-ui-search/src/main/webapp/js/model/List.js", "diffHunk": "@@ -86,6 +112,47 @@ module.exports = Backbone.AssociatedModel.extend(\n         this.updateQuery\n       )\n     },\n+    set(data, ...args) {\n+      if (typeof data === 'object') {\n+        // for backwards compatability\n+        if (data['list.cql'] && !data['list.filters']) {\n+          try {\n+            const filterTree = CQLUtils.transformCQLToFilter(data['list.cql'])\n+            data['list.filters'] = simplifyListFilter(filterTree)\n+          } catch (e) {\n+            console.log('Invalid cql: ' + data['list.cql'])\n+          }\n+          data['list.cql'] = undefined\n+        } else if (\n+          data['list.filters'] &&\n+          typeof data['list.filters'] === 'string'\n+        ) {\n+          try {\n+            data['list.filters'] = JSON.parse(data['list.filters'])\n+          } catch (e) {\n+            data['list.filters'] = undefined\n+          }\n+        }\n+      } else if (data === 'list.filters' && args.length == 1) {\n+        args = [simplifyListFilter(args[0])]\n+      }\n+      if (!IGNORED_DEPRECATED_ATTRIBUTES.includes(data)) {\n+        return Backbone.AssociatedModel.prototype.set.call(this, data, ...args)\n+      }\n+    },\n+    get(attr) {\n+      if (!IGNORED_DEPRECATED_ATTRIBUTES.includes(attr)) {\n+        return Backbone.AssociatedModel.prototype.get.call(this, attr)\n+      }\n+    },\n+    toJSON(...args) {\n+      const json = Backbone.AssociatedModel.prototype.toJSON.call(this, ...args)\n+      const keepObjs = args.length > 0 ? args.includes('keepObjs') : false\n+      if (!keepObjs && typeof json['list.filters'] === 'object') {\n+        json['list.filters'] = JSON.stringify(json['list.filters'])", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODY5MTA3OQ=="}, "originalCommit": {"oid": "3378b5a380422e1d7747bb47ec8e16bfedaf8b5d"}, "originalPosition": 96}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODc5NjA1NQ==", "bodyText": "I think we can store it as an object by default", "url": "https://github.com/codice/ddf/pull/6378#discussion_r508796055", "createdAt": "2020-10-20T19:49:37Z", "author": {"login": "mojogitoverhere"}, "path": "ui/packages/catalog-ui-search/src/main/webapp/js/model/List.js", "diffHunk": "@@ -86,6 +112,47 @@ module.exports = Backbone.AssociatedModel.extend(\n         this.updateQuery\n       )\n     },\n+    set(data, ...args) {\n+      if (typeof data === 'object') {\n+        // for backwards compatability\n+        if (data['list.cql'] && !data['list.filters']) {\n+          try {\n+            const filterTree = CQLUtils.transformCQLToFilter(data['list.cql'])\n+            data['list.filters'] = simplifyListFilter(filterTree)\n+          } catch (e) {\n+            console.log('Invalid cql: ' + data['list.cql'])\n+          }\n+          data['list.cql'] = undefined\n+        } else if (\n+          data['list.filters'] &&\n+          typeof data['list.filters'] === 'string'\n+        ) {\n+          try {\n+            data['list.filters'] = JSON.parse(data['list.filters'])\n+          } catch (e) {\n+            data['list.filters'] = undefined\n+          }\n+        }\n+      } else if (data === 'list.filters' && args.length == 1) {\n+        args = [simplifyListFilter(args[0])]\n+      }\n+      if (!IGNORED_DEPRECATED_ATTRIBUTES.includes(data)) {\n+        return Backbone.AssociatedModel.prototype.set.call(this, data, ...args)\n+      }\n+    },\n+    get(attr) {\n+      if (!IGNORED_DEPRECATED_ATTRIBUTES.includes(attr)) {\n+        return Backbone.AssociatedModel.prototype.get.call(this, attr)\n+      }\n+    },\n+    toJSON(...args) {\n+      const json = Backbone.AssociatedModel.prototype.toJSON.call(this, ...args)\n+      const keepObjs = args.length > 0 ? args.includes('keepObjs') : false\n+      if (!keepObjs && typeof json['list.filters'] === 'object') {\n+        json['list.filters'] = JSON.stringify(json['list.filters'])", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODY5MTA3OQ=="}, "originalCommit": {"oid": "3378b5a380422e1d7747bb47ec8e16bfedaf8b5d"}, "originalPosition": 96}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE4Njc5MDU0OnYy", "diffSide": "RIGHT", "path": "ui/packages/catalog-ui-search/src/main/webapp/js/model/List.js", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxODoxNDowMVrOHlK7vg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMFQxODoxNDowMVrOHlK7vg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODczODQ5NA==", "bodyText": "\u2757 If we handle the list.cql backwards compatibility case in the initialize method, I think we will be able to simplify a lot of this logic or remove it completely. Do you think there will be any issues doing it this way?\ninitialize() {\n    if model has list.cql and not list.filters\n        convertCqlToFilters()        \n    }\n\n    // rest of initialize\n}\n\nOr we might want to think about updating the backend to do the conversion for us so that the ui only ever has to worry about list.filters", "url": "https://github.com/codice/ddf/pull/6378#discussion_r508738494", "createdAt": "2020-10-20T18:14:01Z", "author": {"login": "mojogitoverhere"}, "path": "ui/packages/catalog-ui-search/src/main/webapp/js/model/List.js", "diffHunk": "@@ -86,6 +112,47 @@ module.exports = Backbone.AssociatedModel.extend(\n         this.updateQuery\n       )\n     },\n+    set(data, ...args) {\n+      if (typeof data === 'object') {\n+        // for backwards compatability\n+        if (data['list.cql'] && !data['list.filters']) {\n+          try {\n+            const filterTree = CQLUtils.transformCQLToFilter(data['list.cql'])\n+            data['list.filters'] = simplifyListFilter(filterTree)\n+          } catch (e) {\n+            console.log('Invalid cql: ' + data['list.cql'])\n+          }\n+          data['list.cql'] = undefined\n+        } else if (\n+          data['list.filters'] &&\n+          typeof data['list.filters'] === 'string'\n+        ) {\n+          try {\n+            data['list.filters'] = JSON.parse(data['list.filters'])\n+          } catch (e) {\n+            data['list.filters'] = undefined\n+          }\n+        }\n+      } else if (data === 'list.filters' && args.length == 1) {\n+        args = [simplifyListFilter(args[0])]\n+      }\n+      if (!IGNORED_DEPRECATED_ATTRIBUTES.includes(data)) {\n+        return Backbone.AssociatedModel.prototype.set.call(this, data, ...args)\n+      }\n+    },\n+    get(attr) {\n+      if (!IGNORED_DEPRECATED_ATTRIBUTES.includes(attr)) {\n+        return Backbone.AssociatedModel.prototype.get.call(this, attr)\n+      }\n+    },", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3378b5a380422e1d7747bb47ec8e16bfedaf8b5d"}, "originalPosition": 91}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE5NjkzODk2OnYy", "diffSide": "RIGHT", "path": "ui/packages/catalog-ui-search/src/main/webapp/js/model/List.js", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxODowNDoyMFrOHmtv5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQxODoxMDozNFrOHmt97Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDM1NzQ3OQ==", "bodyText": "\u270f\ufe0f we can move the check on L83 here to reduce the amount of nesting\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              if (data['list.cql']) {\n          \n          \n            \n              if (data['list.cql'] && !data['list.filters']) {", "url": "https://github.com/codice/ddf/pull/6378#discussion_r510357479", "createdAt": "2020-10-22T18:04:20Z", "author": {"login": "mojogitoverhere"}, "path": "ui/packages/catalog-ui-search/src/main/webapp/js/model/List.js", "diffHunk": "@@ -53,13 +54,56 @@ function generateCql(bookmarks) {\n   })\n }\n \n+function simplifyListFilter(listFilters) {\n+  if (!listFilters) {\n+    return listFilters\n+  }\n+  let filtersArray = listFilters.filters || [listFilters]\n+  filtersArray = filtersArray\n+    .filter(filter => !filter.filters) //Only supports one filter group type, no nested filter groups\n+    .map(filter => {\n+      return {\n+        ...filter,\n+        value:\n+          filter.value && filter.value.value\n+            ? filter.value.value\n+            : filter.value,\n+      }\n+    })\n+  return {\n+    type: listFilters.filters ? listFilters.type : 'AND',\n+    filters: filtersArray,\n+  }\n+}\n+\n+function parseList(data) {\n+  // for backwards compatability\n+  if (data['list.cql']) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "88d32149a0e5825ffa472f9c8d0697e5b7c1b0ae"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDM2MTA2OQ==", "bodyText": "Had it there originally, but since no matter what, we always want to delete list.cql, hence why moved it bellow. Else if scenario of if for some reason there is a list.cql and a list.filters, we will delete that list.cql.", "url": "https://github.com/codice/ddf/pull/6378#discussion_r510361069", "createdAt": "2020-10-22T18:10:34Z", "author": {"login": "abel-connexta"}, "path": "ui/packages/catalog-ui-search/src/main/webapp/js/model/List.js", "diffHunk": "@@ -53,13 +54,56 @@ function generateCql(bookmarks) {\n   })\n }\n \n+function simplifyListFilter(listFilters) {\n+  if (!listFilters) {\n+    return listFilters\n+  }\n+  let filtersArray = listFilters.filters || [listFilters]\n+  filtersArray = filtersArray\n+    .filter(filter => !filter.filters) //Only supports one filter group type, no nested filter groups\n+    .map(filter => {\n+      return {\n+        ...filter,\n+        value:\n+          filter.value && filter.value.value\n+            ? filter.value.value\n+            : filter.value,\n+      }\n+    })\n+  return {\n+    type: listFilters.filters ? listFilters.type : 'AND',\n+    filters: filtersArray,\n+  }\n+}\n+\n+function parseList(data) {\n+  // for backwards compatability\n+  if (data['list.cql']) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDM1NzQ3OQ=="}, "originalCommit": {"oid": "88d32149a0e5825ffa472f9c8d0697e5b7c1b0ae"}, "originalPosition": 36}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4491, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}