{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQwODMwNTY3", "number": 6461, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxNTozNTo1MVrOFGQUKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxNTozNTo1MVrOFGQUKg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQyMTAzMDgyOnYy", "diffSide": "RIGHT", "path": "catalog/core/catalog-core-commands/src/main/java/org/codice/ddf/commands/catalog/SubjectCommands.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQxNTozNTo1MVrOIHLXaQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNlQyMDozNzozNFrOIHYI4w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDM5NzE2MQ==", "bodyText": "\u2757 missing placeholder for logging parameter", "url": "https://github.com/codice/ddf/pull/6461#discussion_r544397161", "createdAt": "2020-12-16T15:35:51Z", "author": {"login": "jlcsmith"}, "path": "catalog/core/catalog-core-commands/src/main/java/org/codice/ddf/commands/catalog/SubjectCommands.java", "diffHunk": "@@ -68,46 +64,59 @@\n    * the user doesn't have the permission to run the command.\n    *\n    * @return value returned by {@link #executeWithSubject()}, or {@code null} if the command failed\n-   * @throws InvocationTargetException thrown if an exception occurred while executing the command\n-   * @throws Exception if any other unexpected exception occurred\n    */\n   @Override\n-  public Object execute() throws Exception {\n-\n-    try {\n-      if (isNotBlank(user)) {\n-        return runWithUserName();\n-      } else {\n-        return security.runWithSubjectOrElevate(\n-            () ->\n-                AccessController.doPrivileged(\n-                    (PrivilegedExceptionAction<Object>) this::executeWithSubject));\n-      }\n-    } catch (SecurityServiceException e) {\n-      printErrorMessage(e.getMessage());\n-    } catch (InvocationTargetException e) {\n-      printErrorMessage(e.getCause().getMessage());\n+  public Object execute() {\n+    if (isNotBlank(user)) {\n+      return runWithUsername();\n+    } else {\n+      return runWithoutUsername();\n     }\n-    return null;\n   }\n \n-  private Object runWithUserName() throws InvocationTargetException {\n+  @Nullable\n+  private Object runWithUsername() {\n+    final String password;\n     try {\n-      String password = session.readLine(\"Password for \" + user + \": \", '*');\n-      Subject subject = security.getSubject(user, password, \"127.0.0.1\");\n+      password = session.readLine(\"Password for \" + user + \": \", '*');\n+    } catch (IOException e) {\n+      LOGGER.info(\"Failed to run command\", e);\n+      printErrorMessage(\"Failed to read password\");\n+      return null;\n+    }\n \n-      if (subject == null) {\n-        printErrorMessage(\"Invalid username/password\");\n-        return null;\n-      }\n+    final Subject subject = security.getSubject(user, password, \"127.0.0.1\");\n+    if (subject == null) {\n+      printErrorMessage(\"Invalid username/password\");\n+      return null;\n+    }\n \n+    try {\n       return subject.execute(this::executeWithSubject);\n     } catch (ExecutionException e) {\n-      LOGGER.info(\"Failed to run command: {}\", e.getCause().getMessage(), e.getCause());\n-      throw new InvocationTargetException(e.getCause());\n-    } catch (IOException e) {\n-      LOGGER.info(\"Failed to run command\", e);\n-      printErrorMessage(\"Failed to read password\");\n+      final Throwable failure = e.getCause();\n+      final String message = failure.getMessage();\n+      LOGGER.info(\"Failed to run command: {}\", message, failure);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6ca593886632d2fd075bcbda3f48cdfef044b73e"}, "originalPosition": 88}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDU2NzUwMg==", "bodyText": "Looks like is prints it correctly as is. Is there something I'm not seeing?\nadmin@root()> catalog:range --user admin name ___ ___\nPassword for admin: *****\n\n#       ID                                name                       Title\n\nCould not parse date parameters.\nadmin@root()> log:tail\n12:30:20,670 | INFO  | min name ___ ___ | ice.ddf.commands.catalog.SubjectCommands   99 | atalog-core-commands | Failed to run command: Could not parse date parameters.\njava.lang.InterruptedException: Could not parse date parameters.\n\tat org.codice.ddf.commands.catalog.RangeCommand.executeWithSubject(RangeCommand.java:127) ~[bundleFile:?]\n\tat org.apache.shiro.subject.support.SubjectCallable.doCall(SubjectCallable.java:90) ~[?:?]\n\tat org.apache.shiro.subject.support.SubjectCallable.call(SubjectCallable.java:83) ~[?:?]\n\tat org.apache.shiro.subject.support.DelegatingSubject.execute(DelegatingSubject.java:387) ~[?:?]\n\tat org.codice.ddf.commands.catalog.SubjectCommands.runWithUsername(SubjectCommands.java:95) [bundleFile:?]\n\tat org.codice.ddf.commands.catalog.SubjectCommands.execute(SubjectCommands.java:71) [bundleFile:?]\n\t...", "url": "https://github.com/codice/ddf/pull/6461#discussion_r544567502", "createdAt": "2020-12-16T19:33:04Z", "author": {"login": "emmberk"}, "path": "catalog/core/catalog-core-commands/src/main/java/org/codice/ddf/commands/catalog/SubjectCommands.java", "diffHunk": "@@ -68,46 +64,59 @@\n    * the user doesn't have the permission to run the command.\n    *\n    * @return value returned by {@link #executeWithSubject()}, or {@code null} if the command failed\n-   * @throws InvocationTargetException thrown if an exception occurred while executing the command\n-   * @throws Exception if any other unexpected exception occurred\n    */\n   @Override\n-  public Object execute() throws Exception {\n-\n-    try {\n-      if (isNotBlank(user)) {\n-        return runWithUserName();\n-      } else {\n-        return security.runWithSubjectOrElevate(\n-            () ->\n-                AccessController.doPrivileged(\n-                    (PrivilegedExceptionAction<Object>) this::executeWithSubject));\n-      }\n-    } catch (SecurityServiceException e) {\n-      printErrorMessage(e.getMessage());\n-    } catch (InvocationTargetException e) {\n-      printErrorMessage(e.getCause().getMessage());\n+  public Object execute() {\n+    if (isNotBlank(user)) {\n+      return runWithUsername();\n+    } else {\n+      return runWithoutUsername();\n     }\n-    return null;\n   }\n \n-  private Object runWithUserName() throws InvocationTargetException {\n+  @Nullable\n+  private Object runWithUsername() {\n+    final String password;\n     try {\n-      String password = session.readLine(\"Password for \" + user + \": \", '*');\n-      Subject subject = security.getSubject(user, password, \"127.0.0.1\");\n+      password = session.readLine(\"Password for \" + user + \": \", '*');\n+    } catch (IOException e) {\n+      LOGGER.info(\"Failed to run command\", e);\n+      printErrorMessage(\"Failed to read password\");\n+      return null;\n+    }\n \n-      if (subject == null) {\n-        printErrorMessage(\"Invalid username/password\");\n-        return null;\n-      }\n+    final Subject subject = security.getSubject(user, password, \"127.0.0.1\");\n+    if (subject == null) {\n+      printErrorMessage(\"Invalid username/password\");\n+      return null;\n+    }\n \n+    try {\n       return subject.execute(this::executeWithSubject);\n     } catch (ExecutionException e) {\n-      LOGGER.info(\"Failed to run command: {}\", e.getCause().getMessage(), e.getCause());\n-      throw new InvocationTargetException(e.getCause());\n-    } catch (IOException e) {\n-      LOGGER.info(\"Failed to run command\", e);\n-      printErrorMessage(\"Failed to read password\");\n+      final Throwable failure = e.getCause();\n+      final String message = failure.getMessage();\n+      LOGGER.info(\"Failed to run command: {}\", message, failure);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDM5NzE2MQ=="}, "originalCommit": {"oid": "6ca593886632d2fd075bcbda3f48cdfef044b73e"}, "originalPosition": 88}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDYwNjQzNQ==", "bodyText": "my bad - you are logging the exception as well as the message - disregard!", "url": "https://github.com/codice/ddf/pull/6461#discussion_r544606435", "createdAt": "2020-12-16T20:37:34Z", "author": {"login": "jlcsmith"}, "path": "catalog/core/catalog-core-commands/src/main/java/org/codice/ddf/commands/catalog/SubjectCommands.java", "diffHunk": "@@ -68,46 +64,59 @@\n    * the user doesn't have the permission to run the command.\n    *\n    * @return value returned by {@link #executeWithSubject()}, or {@code null} if the command failed\n-   * @throws InvocationTargetException thrown if an exception occurred while executing the command\n-   * @throws Exception if any other unexpected exception occurred\n    */\n   @Override\n-  public Object execute() throws Exception {\n-\n-    try {\n-      if (isNotBlank(user)) {\n-        return runWithUserName();\n-      } else {\n-        return security.runWithSubjectOrElevate(\n-            () ->\n-                AccessController.doPrivileged(\n-                    (PrivilegedExceptionAction<Object>) this::executeWithSubject));\n-      }\n-    } catch (SecurityServiceException e) {\n-      printErrorMessage(e.getMessage());\n-    } catch (InvocationTargetException e) {\n-      printErrorMessage(e.getCause().getMessage());\n+  public Object execute() {\n+    if (isNotBlank(user)) {\n+      return runWithUsername();\n+    } else {\n+      return runWithoutUsername();\n     }\n-    return null;\n   }\n \n-  private Object runWithUserName() throws InvocationTargetException {\n+  @Nullable\n+  private Object runWithUsername() {\n+    final String password;\n     try {\n-      String password = session.readLine(\"Password for \" + user + \": \", '*');\n-      Subject subject = security.getSubject(user, password, \"127.0.0.1\");\n+      password = session.readLine(\"Password for \" + user + \": \", '*');\n+    } catch (IOException e) {\n+      LOGGER.info(\"Failed to run command\", e);\n+      printErrorMessage(\"Failed to read password\");\n+      return null;\n+    }\n \n-      if (subject == null) {\n-        printErrorMessage(\"Invalid username/password\");\n-        return null;\n-      }\n+    final Subject subject = security.getSubject(user, password, \"127.0.0.1\");\n+    if (subject == null) {\n+      printErrorMessage(\"Invalid username/password\");\n+      return null;\n+    }\n \n+    try {\n       return subject.execute(this::executeWithSubject);\n     } catch (ExecutionException e) {\n-      LOGGER.info(\"Failed to run command: {}\", e.getCause().getMessage(), e.getCause());\n-      throw new InvocationTargetException(e.getCause());\n-    } catch (IOException e) {\n-      LOGGER.info(\"Failed to run command\", e);\n-      printErrorMessage(\"Failed to read password\");\n+      final Throwable failure = e.getCause();\n+      final String message = failure.getMessage();\n+      LOGGER.info(\"Failed to run command: {}\", message, failure);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDM5NzE2MQ=="}, "originalCommit": {"oid": "6ca593886632d2fd075bcbda3f48cdfef044b73e"}, "originalPosition": 88}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4422, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}