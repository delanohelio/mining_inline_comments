{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg2ODI2Mjg2", "number": 5892, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxMzo1ODo0MlrODnefjA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxNDowMDozMVrODneioA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQyNzIwNjUyOnYy", "diffSide": "RIGHT", "path": "ui/packages/catalog-ui-search/src/main/webapp/component/visualization/maps/geometry.view.js", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxMzo1ODo0MlrOF1fvKw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxMzo1ODo0MlrOF1fvKw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTYzODgyNw==", "bodyText": "what do you need this negative local variable for? I think the logic would still be the same if you got rid of it", "url": "https://github.com/codice/ddf/pull/5892#discussion_r391638827", "createdAt": "2020-03-12T13:58:42Z", "author": {"login": "cassandrabailey293"}, "path": "ui/packages/catalog-ui-search/src/main/webapp/component/visualization/maps/geometry.view.js", "diffHunk": "@@ -78,24 +78,47 @@ const GeometryView = Marionette.ItemView.extend({\n       this.stopListening(this.options.clusterCollection)\n     }\n   },\n+  adjustPoints(type, coordinates) {\n+    coordinates.forEach((coord, index) => {\n+      if(index + 1 < coordinates.length) {\n+        let negative = false", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6bbd072fff6e8e393a192bd28a06adc78392f968"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQyNzIwOTgyOnYy", "diffSide": "RIGHT", "path": "ui/packages/catalog-ui-search/src/main/webapp/component/visualization/maps/geometry.view.js", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxMzo1OToyOVrOF1fxNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxNDowMDowNVrOF1fywg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTYzOTM0OQ==", "bodyText": "\u270f\ufe0f maybe we can take this commented line out?", "url": "https://github.com/codice/ddf/pull/5892#discussion_r391639349", "createdAt": "2020-03-12T13:59:29Z", "author": {"login": "cassandrabailey293"}, "path": "ui/packages/catalog-ui-search/src/main/webapp/component/visualization/maps/geometry.view.js", "diffHunk": "@@ -78,24 +78,47 @@ const GeometryView = Marionette.ItemView.extend({\n       this.stopListening(this.options.clusterCollection)\n     }\n   },\n+  adjustPoints(type, coordinates) {\n+    coordinates.forEach((coord, index) => {\n+      if(index + 1 < coordinates.length) {\n+        let negative = false\n+        const east = Number(coordinates[index + 1][0])\n+        const west = Number(coordinates[index][0])\n+        if(east - west < -180) {\n+          negative = true\n+          coordinates[index + 1][0] = east + 360\n+        } else if(!negative && east - west > 180) {\n+          coordinates[index][0] = west + 360\n+        }\n+      }\n+    })\n+    // If the geo is a polygon, ensure that the first and last coordinate are the same\n+    if(type.includes('Polygon')) {\n+      coordinates[0][0] = coordinates[coordinates.length - 1][0]\n+    }\n+    return coordinates\n+  },\n   handleGeometry(geometry) {\n     switch (geometry.type) {\n       case 'Point':\n         this.handlePoint(geometry.coordinates)\n         break\n       case 'Polygon':\n         geometry.coordinates.forEach(polygon => {\n+          polygon = this.adjustPoints(geometry.type, polygon)\n           this.handlePoint(polygon[0])\n           this.handleLine(polygon)\n           //this.handlePolygon(polygon);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6bbd072fff6e8e393a192bd28a06adc78392f968"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTYzOTc0Ng==", "bodyText": "though it seems odd that case Polygon would not be calling handlePolygon", "url": "https://github.com/codice/ddf/pull/5892#discussion_r391639746", "createdAt": "2020-03-12T14:00:05Z", "author": {"login": "cassandrabailey293"}, "path": "ui/packages/catalog-ui-search/src/main/webapp/component/visualization/maps/geometry.view.js", "diffHunk": "@@ -78,24 +78,47 @@ const GeometryView = Marionette.ItemView.extend({\n       this.stopListening(this.options.clusterCollection)\n     }\n   },\n+  adjustPoints(type, coordinates) {\n+    coordinates.forEach((coord, index) => {\n+      if(index + 1 < coordinates.length) {\n+        let negative = false\n+        const east = Number(coordinates[index + 1][0])\n+        const west = Number(coordinates[index][0])\n+        if(east - west < -180) {\n+          negative = true\n+          coordinates[index + 1][0] = east + 360\n+        } else if(!negative && east - west > 180) {\n+          coordinates[index][0] = west + 360\n+        }\n+      }\n+    })\n+    // If the geo is a polygon, ensure that the first and last coordinate are the same\n+    if(type.includes('Polygon')) {\n+      coordinates[0][0] = coordinates[coordinates.length - 1][0]\n+    }\n+    return coordinates\n+  },\n   handleGeometry(geometry) {\n     switch (geometry.type) {\n       case 'Point':\n         this.handlePoint(geometry.coordinates)\n         break\n       case 'Polygon':\n         geometry.coordinates.forEach(polygon => {\n+          polygon = this.adjustPoints(geometry.type, polygon)\n           this.handlePoint(polygon[0])\n           this.handleLine(polygon)\n           //this.handlePolygon(polygon);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTYzOTM0OQ=="}, "originalCommit": {"oid": "6bbd072fff6e8e393a192bd28a06adc78392f968"}, "originalPosition": 34}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjQyNzIxNDQwOnYy", "diffSide": "RIGHT", "path": "ui/packages/catalog-ui-search/src/main/webapp/component/visualization/maps/geometry.view.js", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxNDowMDozMVrOF1f0Fg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xMlQxNDowMDozMVrOF1f0Fg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTY0MDA4Ng==", "bodyText": "\u270f\ufe0f same question about getting rid of the commented out line", "url": "https://github.com/codice/ddf/pull/5892#discussion_r391640086", "createdAt": "2020-03-12T14:00:31Z", "author": {"login": "cassandrabailey293"}, "path": "ui/packages/catalog-ui-search/src/main/webapp/component/visualization/maps/geometry.view.js", "diffHunk": "@@ -108,6 +131,7 @@ const GeometryView = Marionette.ItemView.extend({\n       case 'MultiPolygon':\n         geometry.coordinates.forEach(multipolygon => {\n           multipolygon.forEach(polygon => {\n+            polygon = this.adjustPoints(geometry.type, polygon)\n             this.handlePoint(polygon[0])\n             this.handleLine(polygon)\n             //this.handlePolygon(polygon);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6bbd072fff6e8e393a192bd28a06adc78392f968"}, "originalPosition": 55}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4824, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}