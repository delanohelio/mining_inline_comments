{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYzMzExNDI2", "number": 2095, "title": "[CALCITE-4156] ReflectiveRelMetadataProvider constructor should throw an exception (instead of assertion) when called with an empty map", "bodyText": "Jira ticket: CALCITE-4156\nReflectiveRelMetadataProvider's constructor verifies that it is not created with an empty map, using an assertion. However, this is not the most reliable way of verifying this situation, since assertions can be deactivated. In such scenario, we could silently end up having an invalid ReflectiveRelMetadataProvider, with no actual methods attached.\nAlso, since the map is private and has no getter, there is no way for a caller module to verify this situation on its side.\nFor this reason, it is proposed a minor change: replace the assertion with an IllegalArgumentException, which will work in 100% of the cases and will always prevent constructing an invalid ReflectiveRelMetadataProvider.", "createdAt": "2020-08-05T11:05:57Z", "url": "https://github.com/apache/calcite/pull/2095", "merged": true, "mergeCommit": {"oid": "ad53962f76a48e2627da1c155eb5f005150d3dcb"}, "closed": true, "closedAt": "2020-08-06T10:33:26Z", "author": {"login": "rubenada"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc75Js8AH2gAyNDYzMzExNDI2OjhkZjhjNTgzYmUxMjRhMGIwMGIzNTM4YTdmM2M3ZTZlMTQ1YWUzNWI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc8TbCaAFqTQ2MjczODk2NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8df8c583be124a0b00b3538a7f3c7e6e145ae35b", "author": {"user": {"login": "rubenada", "name": null}}, "url": "https://github.com/apache/calcite/commit/8df8c583be124a0b00b3538a7f3c7e6e145ae35b", "committedDate": "2020-08-05T11:02:48Z", "message": "[CALCITE-4156] ReflectiveRelMetadataProvider constructor should throw an exception (instead of assertion) when called with an empty map"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxNTc0Njk5", "url": "https://github.com/apache/calcite/pull/2095#pullrequestreview-461574699", "createdAt": "2020-08-05T11:26:09Z", "commit": {"oid": "8df8c583be124a0b00b3538a7f3c7e6e145ae35b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyMjE3Mjg4", "url": "https://github.com/apache/calcite/pull/2095#pullrequestreview-462217288", "createdAt": "2020-08-06T06:21:54Z", "commit": {"oid": "8df8c583be124a0b00b3538a7f3c7e6e145ae35b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQwNjoyMTo1NFrOG8k1wg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQwNjoyMTo1NFrOG8k1wg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjE3MTMzMA==", "bodyText": "There are many codes in Calcite use assert, should we also eliminate them ?", "url": "https://github.com/apache/calcite/pull/2095#discussion_r466171330", "createdAt": "2020-08-06T06:21:54Z", "author": {"login": "danny0405"}, "path": "core/src/main/java/org/apache/calcite/rel/metadata/ReflectiveRelMetadataProvider.java", "diffHunk": "@@ -78,7 +78,9 @@ protected ReflectiveRelMetadataProvider(\n       ConcurrentMap<Class<RelNode>, UnboundMetadata> map,\n       Class<? extends Metadata> metadataClass0,\n       Multimap<Method, MetadataHandler> handlerMap) {\n-    assert !map.isEmpty() : \"are your methods named wrong?\";\n+    if (map.isEmpty()) {\n+      throw new IllegalArgumentException(\"ReflectiveRelMetadataProvider methods map is empty\");\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8df8c583be124a0b00b3538a7f3c7e6e145ae35b"}, "originalPosition": 7}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYyNzM4OTY0", "url": "https://github.com/apache/calcite/pull/2095#pullrequestreview-462738964", "createdAt": "2020-08-06T17:39:16Z", "commit": {"oid": "8df8c583be124a0b00b3538a7f3c7e6e145ae35b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxNzozOToxNlrOG89s9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNlQxNzozOToxNlrOG89s9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjU3ODY3Nw==", "bodyText": "Sorry I missed your PR.\nWhy not use CheckArgument in Guava?", "url": "https://github.com/apache/calcite/pull/2095#discussion_r466578677", "createdAt": "2020-08-06T17:39:16Z", "author": {"login": "amaliujia"}, "path": "core/src/main/java/org/apache/calcite/rel/metadata/ReflectiveRelMetadataProvider.java", "diffHunk": "@@ -78,7 +78,9 @@ protected ReflectiveRelMetadataProvider(\n       ConcurrentMap<Class<RelNode>, UnboundMetadata> map,\n       Class<? extends Metadata> metadataClass0,\n       Multimap<Method, MetadataHandler> handlerMap) {\n-    assert !map.isEmpty() : \"are your methods named wrong?\";\n+    if (map.isEmpty()) {\n+      throw new IllegalArgumentException(\"ReflectiveRelMetadataProvider methods map is empty\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8df8c583be124a0b00b3538a7f3c7e6e145ae35b"}, "originalPosition": 6}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3192, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}