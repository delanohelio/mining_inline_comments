{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzgwOTY0Mjg3", "number": 1837, "title": "[CALCITE-3835] Overloaded table functions fail with an assertion error if param types differ", "bodyText": "", "createdAt": "2020-02-27T17:00:31Z", "url": "https://github.com/apache/calcite/pull/1837", "merged": true, "mergeCommit": {"oid": "4eaed593c9aee8df6ffe1f4bb7ec3d33a7cd0325"}, "closed": true, "closedAt": "2020-04-08T02:26:12Z", "author": {"login": "vvysotskyi"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcKu9swgBqjMxMDIxODM0MjM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcVL48rgFqTM4ODc4MTIxMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d6be61ad533e4e300ccac66dacd9bd633c104e26", "author": {"user": {"login": "vvysotskyi", "name": "Volodymyr Vysotskyi"}}, "url": "https://github.com/apache/calcite/commit/d6be61ad533e4e300ccac66dacd9bd633c104e26", "committedDate": "2020-02-27T16:55:57Z", "message": "[CALCITE-3835] Overloaded table functions fail with an assertion error if param types differ"}, "afterCommit": {"oid": "aaa1a7bdda745ac111be3f6faf0bb82b79f3a488", "author": {"user": {"login": "vvysotskyi", "name": "Volodymyr Vysotskyi"}}, "url": "https://github.com/apache/calcite/commit/aaa1a7bdda745ac111be3f6faf0bb82b79f3a488", "committedDate": "2020-03-05T17:27:51Z", "message": "[CALCITE-3835] Overloaded table functions fail with an assertion error if param types differ"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxMDQyMTA1", "url": "https://github.com/apache/calcite/pull/1837#pullrequestreview-381042105", "createdAt": "2020-03-25T10:57:36Z", "commit": {"oid": "aaa1a7bdda745ac111be3f6faf0bb82b79f3a488"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxMDo1NzozNlrOF7VwTg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQxMDo1NzozNlrOF7VwTg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzc2NjczNA==", "bodyText": "Does all kinds of functions return a non-empty list if the method call have parameter names ? I don't think so, and how about function.getParamNames().indexOf(argNames.get(i)) returns -1 there ?", "url": "https://github.com/apache/calcite/pull/1837#discussion_r397766734", "createdAt": "2020-03-25T10:57:36Z", "author": {"login": "danny0405"}, "path": "core/src/main/java/org/apache/calcite/sql/SqlUtil.java", "diffHunk": "@@ -676,14 +680,16 @@ public static boolean matchRoutinesByParameterCount(\n   }\n \n   private static RelDataType bestMatch(List<SqlFunction> sqlFunctions, int i,\n-      RelDataTypePrecedenceList precList) {\n+      List<String> argNames, RelDataTypePrecedenceList precList) {\n     RelDataType bestMatch = null;\n     for (SqlFunction function : sqlFunctions) {\n       List<RelDataType> paramTypes = function.getParamTypes();\n       if (paramTypes == null) {\n         continue;\n       }\n-      final RelDataType paramType = paramTypes.get(i);\n+      final RelDataType paramType = argNames != null\n+          ? paramTypes.get(function.getParamNames().indexOf(argNames.get(i)))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aaa1a7bdda745ac111be3f6faf0bb82b79f3a488"}, "originalPosition": 54}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "aaa1a7bdda745ac111be3f6faf0bb82b79f3a488", "author": {"user": {"login": "vvysotskyi", "name": "Volodymyr Vysotskyi"}}, "url": "https://github.com/apache/calcite/commit/aaa1a7bdda745ac111be3f6faf0bb82b79f3a488", "committedDate": "2020-03-05T17:27:51Z", "message": "[CALCITE-3835] Overloaded table functions fail with an assertion error if param types differ"}, "afterCommit": {"oid": "5820c21a21dcb759f044749bbddb739274626445", "author": {"user": {"login": "vvysotskyi", "name": "Volodymyr Vysotskyi"}}, "url": "https://github.com/apache/calcite/commit/5820c21a21dcb759f044749bbddb739274626445", "committedDate": "2020-03-26T10:05:38Z", "message": "[CALCITE-3835] Rename filterRoutinesByParameterType method and small refactor"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxOTc3NjY0", "url": "https://github.com/apache/calcite/pull/1837#pullrequestreview-381977664", "createdAt": "2020-03-26T12:53:37Z", "commit": {"oid": "5820c21a21dcb759f044749bbddb739274626445"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxMjo1MzozN1rOF8Fcdg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQxMjo1MzozN1rOF8Fcdg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODU0ODA4Ng==", "bodyText": "I think we should keep the old name. The passed in param is not necessary to be an array, so it maybe not overloaded.", "url": "https://github.com/apache/calcite/pull/1837#discussion_r398548086", "createdAt": "2020-03-26T12:53:37Z", "author": {"login": "danny0405"}, "path": "core/src/test/java/org/apache/calcite/test/JdbcTest.java", "diffHunk": "@@ -568,36 +572,44 @@ private void addTableMacro(Connection connection, Method method) throws SQLExcep\n     checkTableFunctionInModel(Smalls.TestStaticTableFunction.class);\n   }\n \n-  private CalciteAssert.AssertThat assertWithMacro(Class clazz) {\n+  private CalciteAssert.AssertThat assertOverloadedWithMacro(Class<?>... clazz) {\n+    String prefix = \"\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5820c21a21dcb759f044749bbddb739274626445"}, "originalPosition": 33}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e2853074ba4855ee7a4a484951422150074c73a1", "author": {"user": {"login": "vvysotskyi", "name": "Volodymyr Vysotskyi"}}, "url": "https://github.com/apache/calcite/commit/e2853074ba4855ee7a4a484951422150074c73a1", "committedDate": "2020-03-26T18:41:05Z", "message": "[CALCITE-3835] Overloaded table functions fail with an assertion error if param types differ"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5820c21a21dcb759f044749bbddb739274626445", "author": {"user": {"login": "vvysotskyi", "name": "Volodymyr Vysotskyi"}}, "url": "https://github.com/apache/calcite/commit/5820c21a21dcb759f044749bbddb739274626445", "committedDate": "2020-03-26T10:05:38Z", "message": "[CALCITE-3835] Rename filterRoutinesByParameterType method and small refactor"}, "afterCommit": {"oid": "e2853074ba4855ee7a4a484951422150074c73a1", "author": {"user": {"login": "vvysotskyi", "name": "Volodymyr Vysotskyi"}}, "url": "https://github.com/apache/calcite/commit/e2853074ba4855ee7a4a484951422150074c73a1", "committedDate": "2020-03-26T18:41:05Z", "message": "[CALCITE-3835] Overloaded table functions fail with an assertion error if param types differ"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyNTE1MzA4", "url": "https://github.com/apache/calcite/pull/1837#pullrequestreview-382515308", "createdAt": "2020-03-27T00:50:39Z", "commit": {"oid": "e2853074ba4855ee7a4a484951422150074c73a1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyNTUxMDg5", "url": "https://github.com/apache/calcite/pull/1837#pullrequestreview-382551089", "createdAt": "2020-03-27T02:57:22Z", "commit": {"oid": "e2853074ba4855ee7a4a484951422150074c73a1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QwMjo1NzoyMlrOF8hiMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QwMjo1NzoyMlrOF8hiMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTAwODMwNw==", "bodyText": "How can we resolve \"View\"(r=>'6', s=>'5')) since both TableMacroFunctionWithNamedParameters\nand AnotherTableMacroFunctionWithNamedParameters match?", "url": "https://github.com/apache/calcite/pull/1837#discussion_r399008307", "createdAt": "2020-03-27T02:57:22Z", "author": {"login": "chunweilei"}, "path": "core/src/test/java/org/apache/calcite/util/Smalls.java", "diffHunk": "@@ -843,6 +843,30 @@ private void abc(StringBuilder sb, Object s) {\n     }\n   }\n \n+  /** User-defined table-macro function with named and optional parameters. */\n+  public static class AnotherTableMacroFunctionWithNamedParameters {\n+    public TranslatableTable eval(\n+        @Parameter(name = \"R\", optional = true) String r,\n+        @Parameter(name = \"S\") String s,\n+        @Parameter(name = \"T\", optional = true) Integer t,\n+        @Parameter(name = \"S2\", optional = true) String s2) {\n+      final StringBuilder sb = new StringBuilder();\n+      abc(sb, r);\n+      abc(sb, s);\n+      abc(sb, t);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e2853074ba4855ee7a4a484951422150074c73a1"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg4NzgxMjEy", "url": "https://github.com/apache/calcite/pull/1837#pullrequestreview-388781212", "createdAt": "2020-04-07T04:49:39Z", "commit": {"oid": "e2853074ba4855ee7a4a484951422150074c73a1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4321, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}