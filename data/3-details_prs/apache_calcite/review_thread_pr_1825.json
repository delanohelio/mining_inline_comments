{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc4ODY2MzIz", "number": 1825, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQwODozMTo0OFrODiPajg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQxODo0Njo1NFrODib8jg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3MjMwNzM0OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/org/apache/calcite/plan/volcano/VolcanoPlanner.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQwODozMTo0OFrOFtYaOw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQwODozMTo0OFrOFtYaOw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzEzMDE3MQ==", "bodyText": "No need to use LinkedHashMultimap because the key should be unique.", "url": "https://github.com/apache/calcite/pull/1825#discussion_r383130171", "createdAt": "2020-02-24T08:31:48Z", "author": {"login": "chunweilei"}, "path": "core/src/main/java/org/apache/calcite/plan/volcano/VolcanoPlanner.java", "diffHunk": "@@ -239,8 +237,8 @@\n \n   /** Maps rule classes to their name, to ensure that the names are unique and\n    * conform to rules. */\n-  private final SetMultimap<String, Class> ruleNames =\n-      LinkedHashMultimap.create();\n+  private final Map<String, RelOptRule> ruleNames = new HashMap<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bb593bbfda7f0ce82a7f0b4895923758632dedec"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3NDM1NjY4OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/org/apache/calcite/plan/volcano/VolcanoPlanner.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQxODo0NTo1MVrOFtrpyg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNVQwMDo1OTo0MlrOFt1TMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzQ0NTQ1MA==", "bodyText": "You can simplify this as -\nif (ruleNames.put(ruleName, rule)) {\n...\n}\nthen you won't need the else block.", "url": "https://github.com/apache/calcite/pull/1825#discussion_r383445450", "createdAt": "2020-02-24T18:45:51Z", "author": {"login": "xndai"}, "path": "core/src/main/java/org/apache/calcite/plan/volcano/VolcanoPlanner.java", "diffHunk": "@@ -451,12 +449,11 @@ public boolean addRule(RelOptRule rule) {\n     assert added;\n \n     final String ruleName = rule.toString();\n-    if (ruleNames.put(ruleName, rule.getClass())) {\n-      Set<Class> x = ruleNames.get(ruleName);\n-      if (x.size() > 1) {\n-        throw new RuntimeException(\"Rule description '\" + ruleName\n-            + \"' is not unique; classes: \" + x);\n-      }\n+    if (ruleNames.containsKey(ruleName)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "10f52f7934c0801fe553689dece70beac9bf1fe6"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzYwMzUwNQ==", "bodyText": "Good idea~", "url": "https://github.com/apache/calcite/pull/1825#discussion_r383603505", "createdAt": "2020-02-25T00:59:42Z", "author": {"login": "chunweilei"}, "path": "core/src/main/java/org/apache/calcite/plan/volcano/VolcanoPlanner.java", "diffHunk": "@@ -451,12 +449,11 @@ public boolean addRule(RelOptRule rule) {\n     assert added;\n \n     final String ruleName = rule.toString();\n-    if (ruleNames.put(ruleName, rule.getClass())) {\n-      Set<Class> x = ruleNames.get(ruleName);\n-      if (x.size() > 1) {\n-        throw new RuntimeException(\"Rule description '\" + ruleName\n-            + \"' is not unique; classes: \" + x);\n-      }\n+    if (ruleNames.containsKey(ruleName)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzQ0NTQ1MA=="}, "originalCommit": {"oid": "10f52f7934c0801fe553689dece70beac9bf1fe6"}, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM3NDM2MDQ2OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/org/apache/calcite/plan/volcano/VolcanoPlanner.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQxODo0Njo1NFrOFtrsCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yNFQxODo0Njo1NFrOFtrsCA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzQ0NjAyNA==", "bodyText": "It's interesting that this is only called during planner clean up phase. But I think it's still good to fix this.", "url": "https://github.com/apache/calcite/pull/1825#discussion_r383446024", "createdAt": "2020-02-24T18:46:54Z", "author": {"login": "xndai"}, "path": "core/src/main/java/org/apache/calcite/plan/volcano/VolcanoPlanner.java", "diffHunk": "@@ -493,6 +490,9 @@ public boolean removeRule(RelOptRule rule) {\n       return false;\n     }\n \n+    // Remove rule name.\n+    ruleNames.remove(rule.toString());\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "10f52f7934c0801fe553689dece70beac9bf1fe6"}, "originalPosition": 47}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 309, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}