{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIwODAyOTcz", "number": 1986, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQxNzozODozMlrOD-sA3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQxNzozODozMlrOD-sA3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjY3MDU5NDIxOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/org/apache/calcite/plan/volcano/VolcanoRuleCall.java", "isResolved": false, "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQxNzozODozMlrOGY8UfQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNVQwOTowOToyM1rOHh993A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODgwNzI5Mw==", "bodyText": "Nit:  why not use checkArgument or something similar from Guava? Such that it can both check expected result, stop execute when not satisfying, and provide detailed description.", "url": "https://github.com/apache/calcite/pull/1986#discussion_r428807293", "createdAt": "2020-05-21T17:38:32Z", "author": {"login": "amaliujia"}, "path": "core/src/main/java/org/apache/calcite/plan/volcano/VolcanoRuleCall.java", "diffHunk": "@@ -136,7 +155,9 @@ public void transformTo(RelNode rel, Map<RelNode, RelNode> equiv,\n         volcanoPlanner.ensureRegistered(\n             entry.getKey(), entry.getValue());\n       }\n-      volcanoPlanner.ensureRegistered(rel, rels[0]);\n+      RelSubset subset = volcanoPlanner.ensureRegistered(rel, rels[0]);\n+      // The subset is not used, but we need it, just for debugging\n+      assert subset != null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e4f0054327846900bdb4be26f7f45e7419c8b3be"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODgwNzgzOQ==", "bodyText": "Saying this just because the comment says this assert is for debugging, so I assumed some context will be more useful for people who don't have know this much.", "url": "https://github.com/apache/calcite/pull/1986#discussion_r428807839", "createdAt": "2020-05-21T17:39:33Z", "author": {"login": "amaliujia"}, "path": "core/src/main/java/org/apache/calcite/plan/volcano/VolcanoRuleCall.java", "diffHunk": "@@ -136,7 +155,9 @@ public void transformTo(RelNode rel, Map<RelNode, RelNode> equiv,\n         volcanoPlanner.ensureRegistered(\n             entry.getKey(), entry.getValue());\n       }\n-      volcanoPlanner.ensureRegistered(rel, rels[0]);\n+      RelSubset subset = volcanoPlanner.ensureRegistered(rel, rels[0]);\n+      // The subset is not used, but we need it, just for debugging\n+      assert subset != null;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODgwNzI5Mw=="}, "originalCommit": {"oid": "e4f0054327846900bdb4be26f7f45e7419c8b3be"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODgwODYzOA==", "bodyText": "It is not intended to check null or not, just to silence the IDE that the 'subset' is used. But in fact it is useful to add a breakpoint there to see the content of subset.", "url": "https://github.com/apache/calcite/pull/1986#discussion_r428808638", "createdAt": "2020-05-21T17:40:56Z", "author": {"login": "hsyuan"}, "path": "core/src/main/java/org/apache/calcite/plan/volcano/VolcanoRuleCall.java", "diffHunk": "@@ -136,7 +155,9 @@ public void transformTo(RelNode rel, Map<RelNode, RelNode> equiv,\n         volcanoPlanner.ensureRegistered(\n             entry.getKey(), entry.getValue());\n       }\n-      volcanoPlanner.ensureRegistered(rel, rels[0]);\n+      RelSubset subset = volcanoPlanner.ensureRegistered(rel, rels[0]);\n+      // The subset is not used, but we need it, just for debugging\n+      assert subset != null;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODgwNzI5Mw=="}, "originalCommit": {"oid": "e4f0054327846900bdb4be26f7f45e7419c8b3be"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODgyNDI3NA==", "bodyText": "Gotcha. Now I see it is to suppress IDE, style checker, etc.\nThanks for clarification.", "url": "https://github.com/apache/calcite/pull/1986#discussion_r428824274", "createdAt": "2020-05-21T18:08:55Z", "author": {"login": "amaliujia"}, "path": "core/src/main/java/org/apache/calcite/plan/volcano/VolcanoRuleCall.java", "diffHunk": "@@ -136,7 +155,9 @@ public void transformTo(RelNode rel, Map<RelNode, RelNode> equiv,\n         volcanoPlanner.ensureRegistered(\n             entry.getKey(), entry.getValue());\n       }\n-      volcanoPlanner.ensureRegistered(rel, rels[0]);\n+      RelSubset subset = volcanoPlanner.ensureRegistered(rel, rels[0]);\n+      // The subset is not used, but we need it, just for debugging\n+      assert subset != null;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODgwNzI5Mw=="}, "originalCommit": {"oid": "e4f0054327846900bdb4be26f7f45e7419c8b3be"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODkwNTIzMg==", "bodyText": "I find it confusing to use an assertion just to silence some warnings. Usually there are annotations for this kind of things. Apart from that if the content is useful for debugging then why not logging it for real.", "url": "https://github.com/apache/calcite/pull/1986#discussion_r428905232", "createdAt": "2020-05-21T20:47:11Z", "author": {"login": "zabetak"}, "path": "core/src/main/java/org/apache/calcite/plan/volcano/VolcanoRuleCall.java", "diffHunk": "@@ -136,7 +155,9 @@ public void transformTo(RelNode rel, Map<RelNode, RelNode> equiv,\n         volcanoPlanner.ensureRegistered(\n             entry.getKey(), entry.getValue());\n       }\n-      volcanoPlanner.ensureRegistered(rel, rels[0]);\n+      RelSubset subset = volcanoPlanner.ensureRegistered(rel, rels[0]);\n+      // The subset is not used, but we need it, just for debugging\n+      assert subset != null;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODgwNzI5Mw=="}, "originalCommit": {"oid": "e4f0054327846900bdb4be26f7f45e7419c8b3be"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTAzMjk1NA==", "bodyText": "Good point, we can use annotations instead.\nBut logging is not what I want, I just want to add a debug point, check the returned subset for a specific rule match. Logging will print a lot of subsets for all the rule matches that I am not interested in.", "url": "https://github.com/apache/calcite/pull/1986#discussion_r429032954", "createdAt": "2020-05-22T04:11:01Z", "author": {"login": "hsyuan"}, "path": "core/src/main/java/org/apache/calcite/plan/volcano/VolcanoRuleCall.java", "diffHunk": "@@ -136,7 +155,9 @@ public void transformTo(RelNode rel, Map<RelNode, RelNode> equiv,\n         volcanoPlanner.ensureRegistered(\n             entry.getKey(), entry.getValue());\n       }\n-      volcanoPlanner.ensureRegistered(rel, rels[0]);\n+      RelSubset subset = volcanoPlanner.ensureRegistered(rel, rels[0]);\n+      // The subset is not used, but we need it, just for debugging\n+      assert subset != null;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODgwNzI5Mw=="}, "originalCommit": {"oid": "e4f0054327846900bdb4be26f7f45e7419c8b3be"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTM4MDMxNg==", "bodyText": "after udpate, this exception happend, this exception should not break OPTIMIZE process, JoinAssociateRule enable match EnumerableNestedLoopJoin. java.lang.RuntimeException: rel#3291:EnumerableHashJoin.ENUMERABLE.[](left=RelSubset#88,right=EnumerableNestedLoopJoin#3290,condition==($0, $3),joinType=inner) is a PhysicalNode, which is not allowed in JoinAssociateRule", "url": "https://github.com/apache/calcite/pull/1986#discussion_r505380316", "createdAt": "2020-10-15T09:09:23Z", "author": {"login": "mikasaakeman"}, "path": "core/src/main/java/org/apache/calcite/plan/volcano/VolcanoRuleCall.java", "diffHunk": "@@ -136,7 +155,9 @@ public void transformTo(RelNode rel, Map<RelNode, RelNode> equiv,\n         volcanoPlanner.ensureRegistered(\n             entry.getKey(), entry.getValue());\n       }\n-      volcanoPlanner.ensureRegistered(rel, rels[0]);\n+      RelSubset subset = volcanoPlanner.ensureRegistered(rel, rels[0]);\n+      // The subset is not used, but we need it, just for debugging\n+      assert subset != null;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODgwNzI5Mw=="}, "originalCommit": {"oid": "e4f0054327846900bdb4be26f7f45e7419c8b3be"}, "originalPosition": 47}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 154, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}