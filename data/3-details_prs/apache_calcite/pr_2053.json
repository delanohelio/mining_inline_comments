{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQzMjY5MDM0", "number": 2053, "title": "[CALCITE-4102] Some improvements to aggregate related operations", "bodyText": "Improve the use of data structures\nExtract common methods\nAvoid expensive operations", "createdAt": "2020-07-02T04:40:36Z", "url": "https://github.com/apache/calcite/pull/2053", "merged": true, "mergeCommit": {"oid": "ce2ae649c9ec072ceb8462b2783f8c6bba989241"}, "closed": true, "closedAt": "2020-07-29T06:34:30Z", "author": {"login": "liyafan82"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcw4gcVABqjM1MDU0OTM3Mjg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc1wOWRgFqTQ1MDUwMTcwMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b90e76d791df09d289961a23fd61a9cf19ebe5d0", "author": {"user": {"login": "liyafan82", "name": null}}, "url": "https://github.com/apache/calcite/commit/b90e76d791df09d289961a23fd61a9cf19ebe5d0", "committedDate": "2020-07-02T04:38:25Z", "message": "[CALCITE-4102] Some improvements to aggregate related operations"}, "afterCommit": {"oid": "1c39e51e4ce04e363ee7fb025f5acc2f8be2edec", "author": {"user": {"login": "liyafan82", "name": null}}, "url": "https://github.com/apache/calcite/commit/1c39e51e4ce04e363ee7fb025f5acc2f8be2edec", "committedDate": "2020-07-02T06:04:17Z", "message": "[CALCITE-4102] Some improvements to aggregate related operations"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1c39e51e4ce04e363ee7fb025f5acc2f8be2edec", "author": {"user": {"login": "liyafan82", "name": null}}, "url": "https://github.com/apache/calcite/commit/1c39e51e4ce04e363ee7fb025f5acc2f8be2edec", "committedDate": "2020-07-02T06:04:17Z", "message": "[CALCITE-4102] Some improvements to aggregate related operations"}, "afterCommit": {"oid": "5b3e8720944a241c70c7e6ecbff187043d648d3d", "author": {"user": {"login": "liyafan82", "name": null}}, "url": "https://github.com/apache/calcite/commit/5b3e8720944a241c70c7e6ecbff187043d648d3d", "committedDate": "2020-07-02T06:07:20Z", "message": "[CALCITE-4102] Some improvements to aggregate related operations"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyMDk4OTg3", "url": "https://github.com/apache/calcite/pull/2053#pullrequestreview-442098987", "createdAt": "2020-07-03T01:35:01Z", "commit": {"oid": "5b3e8720944a241c70c7e6ecbff187043d648d3d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QwMTozNTowMVrOGshOeg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QwMTozNTowMVrOGshOeg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTMzNDkwNg==", "bodyText": "we do not format like this", "url": "https://github.com/apache/calcite/pull/2053#discussion_r449334906", "createdAt": "2020-07-03T01:35:01Z", "author": {"login": "yanlin-Lynn"}, "path": "core/src/main/java/org/apache/calcite/util/ImmutableBitSet.java", "diffHunk": "@@ -901,6 +902,19 @@ public ImmutableBitSet shift(int offset) {\n     return builder.build();\n   }\n \n+  /**\n+   * Checks if all bit sets contain a particular bit.\n+   */\n+  public static boolean allContain(Collection<ImmutableBitSet> bitSets,\n+                                   int bit) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5b3e8720944a241c70c7e6ecbff187043d648d3d"}, "originalPosition": 16}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5b3e8720944a241c70c7e6ecbff187043d648d3d", "author": {"user": {"login": "liyafan82", "name": null}}, "url": "https://github.com/apache/calcite/commit/5b3e8720944a241c70c7e6ecbff187043d648d3d", "committedDate": "2020-07-02T06:07:20Z", "message": "[CALCITE-4102] Some improvements to aggregate related operations"}, "afterCommit": {"oid": "4903337bb50dc3c1de955bd45d9b8e3d2b02ae45", "author": {"user": {"login": "liyafan82", "name": null}}, "url": "https://github.com/apache/calcite/commit/4903337bb50dc3c1de955bd45d9b8e3d2b02ae45", "committedDate": "2020-07-03T06:00:58Z", "message": "[CALCITE-4102] Some improvements to aggregate related operations"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4903337bb50dc3c1de955bd45d9b8e3d2b02ae45", "author": {"user": {"login": "liyafan82", "name": null}}, "url": "https://github.com/apache/calcite/commit/4903337bb50dc3c1de955bd45d9b8e3d2b02ae45", "committedDate": "2020-07-03T06:00:58Z", "message": "[CALCITE-4102] Some improvements to aggregate related operations"}, "afterCommit": {"oid": "555f3321bb94b7b0c74fc8ef21e51c5411d39ba9", "author": {"user": {"login": "liyafan82", "name": null}}, "url": "https://github.com/apache/calcite/commit/555f3321bb94b7b0c74fc8ef21e51c5411d39ba9", "committedDate": "2020-07-08T11:47:57Z", "message": "[CALCITE-4102] Some improvements to aggregate related operations (Liya Fan)\n\n1. Extract a common method for ImmutableBitSet\n2. Refine the use of data structures\n3. Replace expensive operations with cheap ones"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "555f3321bb94b7b0c74fc8ef21e51c5411d39ba9", "author": {"user": {"login": "liyafan82", "name": null}}, "url": "https://github.com/apache/calcite/commit/555f3321bb94b7b0c74fc8ef21e51c5411d39ba9", "committedDate": "2020-07-08T11:47:57Z", "message": "[CALCITE-4102] Some improvements to aggregate related operations (Liya Fan)\n\n1. Extract a common method for ImmutableBitSet\n2. Refine the use of data structures\n3. Replace expensive operations with cheap ones"}, "afterCommit": {"oid": "add875776e9b91424e2750430af904278e12c9a0", "author": {"user": {"login": "liyafan82", "name": null}}, "url": "https://github.com/apache/calcite/commit/add875776e9b91424e2750430af904278e12c9a0", "committedDate": "2020-07-09T03:29:23Z", "message": "[CALCITE-4102] Some improvements to aggregate related operations (Liya Fan)\n\n1. Extract a common method for ImmutableBitSet\n2. Refine the use of data structures\n3. Replace expensive operations with cheap ones"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ3NzQxOTk2", "url": "https://github.com/apache/calcite/pull/2053#pullrequestreview-447741996", "createdAt": "2020-07-14T02:32:06Z", "commit": {"oid": "add875776e9b91424e2750430af904278e12c9a0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQwMjozMjowNlrOGxBtWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQwMjozMjowNlrOGxBtWQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDA2MTQwMQ==", "bodyText": "Would there be duplicate values since Set is changed to List?", "url": "https://github.com/apache/calcite/pull/2053#discussion_r454061401", "createdAt": "2020-07-14T02:32:06Z", "author": {"login": "chunweilei"}, "path": "core/src/main/java/org/apache/calcite/rel/core/Aggregate.java", "diffHunk": "@@ -548,19 +538,22 @@ public static boolean isRollup(ImmutableBitSet groupSet,\n      *\n      * @see #isRollup(ImmutableBitSet, List) */\n     public static List<Integer> getRollup(List<ImmutableBitSet> groupSets) {\n-      final Set<Integer> set = new LinkedHashSet<>();\n+      final List<Integer> rollUpBits = new ArrayList<>(groupSets.size() - 1);\n       ImmutableBitSet g = null;\n       for (ImmutableBitSet bitSet : groupSets) {\n         if (g == null) {\n           // First item must equal groupSet\n         } else {\n           // Each subsequent items must be a subset with one fewer bit than the\n           // previous item\n-          set.addAll(g.except(bitSet).toList());\n+          ImmutableBitSet diff = g.except(bitSet);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "add875776e9b91424e2750430af904278e12c9a0"}, "originalPosition": 59}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f7ce021df77a9acbf8f507c3c46486fe07be4957", "author": {"user": {"login": "liyafan82", "name": null}}, "url": "https://github.com/apache/calcite/commit/f7ce021df77a9acbf8f507c3c46486fe07be4957", "committedDate": "2020-07-16T02:23:19Z", "message": "[CALCITE-4102] Some improvements to aggregate related operations (Liya Fan)\n\n1. Extract a common method for ImmutableBitSet\n2. Refine the use of data structures\n3. Replace expensive operations with cheap ones"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "add875776e9b91424e2750430af904278e12c9a0", "author": {"user": {"login": "liyafan82", "name": null}}, "url": "https://github.com/apache/calcite/commit/add875776e9b91424e2750430af904278e12c9a0", "committedDate": "2020-07-09T03:29:23Z", "message": "[CALCITE-4102] Some improvements to aggregate related operations (Liya Fan)\n\n1. Extract a common method for ImmutableBitSet\n2. Refine the use of data structures\n3. Replace expensive operations with cheap ones"}, "afterCommit": {"oid": "f7ce021df77a9acbf8f507c3c46486fe07be4957", "author": {"user": {"login": "liyafan82", "name": null}}, "url": "https://github.com/apache/calcite/commit/f7ce021df77a9acbf8f507c3c46486fe07be4957", "committedDate": "2020-07-16T02:23:19Z", "message": "[CALCITE-4102] Some improvements to aggregate related operations (Liya Fan)\n\n1. Extract a common method for ImmutableBitSet\n2. Refine the use of data structures\n3. Replace expensive operations with cheap ones"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUwNTAxNzAw", "url": "https://github.com/apache/calcite/pull/2053#pullrequestreview-450501700", "createdAt": "2020-07-17T09:15:11Z", "commit": {"oid": "f7ce021df77a9acbf8f507c3c46486fe07be4957"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3816, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}