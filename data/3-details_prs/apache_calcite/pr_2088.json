{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU3NjM4Mjc4", "number": 2088, "title": "[CALCITE-4145] Exception when query from UDF field with structured type", "bodyText": "", "createdAt": "2020-07-28T08:21:16Z", "url": "https://github.com/apache/calcite/pull/2088", "merged": true, "mergeCommit": {"oid": "c52f0e527c86f6a6b18e138310359ac0c72ca529"}, "closed": true, "closedAt": "2020-07-29T03:22:30Z", "author": {"login": "danny0405"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc5U3phgBqjM1OTM5MzUzNDQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc5h6HxgBqjM1OTcwMjk3ODQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "81a4a3809d5f60db7f84e7118da7ca00b813ced1", "author": {"user": {"login": "danny0405", "name": "Danny Chan"}}, "url": "https://github.com/apache/calcite/commit/81a4a3809d5f60db7f84e7118da7ca00b813ced1", "committedDate": "2020-07-28T08:20:34Z", "message": "[CALCITE-4145] Exception when query from UDF field with structured type"}, "afterCommit": {"oid": "f5d8f3e3a8a89c199ed93833f49b9819f03a7c9e", "author": {"user": {"login": "danny0405", "name": "Danny Chan"}}, "url": "https://github.com/apache/calcite/commit/f5d8f3e3a8a89c199ed93833f49b9819f03a7c9e", "committedDate": "2020-07-28T11:38:18Z", "message": "[CALCITE-4145] Exception when query from UDF field with structured type"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2NTQ4MjUz", "url": "https://github.com/apache/calcite/pull/2088#pullrequestreview-456548253", "createdAt": "2020-07-28T11:40:07Z", "commit": {"oid": "f5d8f3e3a8a89c199ed93833f49b9819f03a7c9e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxMTo0MDowN1rOG4IqKQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yOFQxMTo0MDowN1rOG4IqKQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTUxNTMwNQ==", "bodyText": "I made this change because there are some problem with the new added test case in test env with concurrency, the == check not works anymore.", "url": "https://github.com/apache/calcite/pull/2088#discussion_r461515305", "createdAt": "2020-07-28T11:40:07Z", "author": {"login": "danny0405"}, "path": "core/src/main/java/org/apache/calcite/rex/RexFieldAccess.java", "diffHunk": "@@ -57,14 +59,23 @@\n   RexFieldAccess(\n       RexNode expr,\n       RelDataTypeField field) {\n+    checkValid(expr, field);\n     this.expr = expr;\n     this.field = field;\n     this.digest = expr + \".\" + field.getName();\n-    assert expr.getType().getFieldList().get(field.getIndex()) == field;\n   }\n \n   //~ Methods ----------------------------------------------------------------\n \n+  private static void checkValid(RexNode expr, RelDataTypeField field) {\n+    RelDataType exprType = expr.getType();\n+    int fieldsNum = exprType.getFieldList().size();\n+    int fieldIdx = field.getIndex();\n+    final String errMsg = \"Field \" + field + \" does not exist for expression \" + expr;\n+    Preconditions.checkArgument(fieldIdx < fieldsNum, errMsg);\n+    Preconditions.checkArgument(exprType.getFieldList().get(fieldIdx).equals(field), errMsg);\n+  }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f5d8f3e3a8a89c199ed93833f49b9819f03a7c9e"}, "originalPosition": 29}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f5d8f3e3a8a89c199ed93833f49b9819f03a7c9e", "author": {"user": {"login": "danny0405", "name": "Danny Chan"}}, "url": "https://github.com/apache/calcite/commit/f5d8f3e3a8a89c199ed93833f49b9819f03a7c9e", "committedDate": "2020-07-28T11:38:18Z", "message": "[CALCITE-4145] Exception when query from UDF field with structured type"}, "afterCommit": {"oid": "4b069c71b8923bdae40beffe140fe13a2c8cf6ca", "author": {"user": {"login": "danny0405", "name": "Danny Chan"}}, "url": "https://github.com/apache/calcite/commit/4b069c71b8923bdae40beffe140fe13a2c8cf6ca", "committedDate": "2020-07-29T01:45:51Z", "message": "[CALCITE-4145] Exception when query from UDF field with structured type"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3961b8274e313dd18d76122d851a0979b9abb96e", "author": {"user": {"login": "danny0405", "name": "Danny Chan"}}, "url": "https://github.com/apache/calcite/commit/3961b8274e313dd18d76122d851a0979b9abb96e", "committedDate": "2020-07-29T02:49:50Z", "message": "[CALCITE-4145] Exception when query from UDF field with structured type"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4b069c71b8923bdae40beffe140fe13a2c8cf6ca", "author": {"user": {"login": "danny0405", "name": "Danny Chan"}}, "url": "https://github.com/apache/calcite/commit/4b069c71b8923bdae40beffe140fe13a2c8cf6ca", "committedDate": "2020-07-29T01:45:51Z", "message": "[CALCITE-4145] Exception when query from UDF field with structured type"}, "afterCommit": {"oid": "3961b8274e313dd18d76122d851a0979b9abb96e", "author": {"user": {"login": "danny0405", "name": "Danny Chan"}}, "url": "https://github.com/apache/calcite/commit/3961b8274e313dd18d76122d851a0979b9abb96e", "committedDate": "2020-07-29T02:49:50Z", "message": "[CALCITE-4145] Exception when query from UDF field with structured type"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3167, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}