{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEyOTI4Mjkx", "number": 2238, "title": "[CALCITE-4364] `a IN (1, 2) AND a = 1` should be simplified to `a = 1`", "bodyText": "", "createdAt": "2020-10-30T11:19:41Z", "url": "https://github.com/apache/calcite/pull/2238", "merged": true, "mergeCommit": {"oid": "5e9943aa1f51a97068fc37d53dea1d447570becc"}, "closed": true, "closedAt": "2020-11-12T09:39:04Z", "author": {"login": "danny0405"}, "timelineItems": {"totalCount": 25, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdYfK30gBqjM5NDY1NTEwNDM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdbqkEaABqjM5ODY2OTEwMjY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "add3f70da302ce5679e141f323748baaf7a3fde4", "author": {"user": {"login": "danny0405", "name": "Danny Chan"}}, "url": "https://github.com/apache/calcite/commit/add3f70da302ce5679e141f323748baaf7a3fde4", "committedDate": "2020-10-30T11:18:41Z", "message": "[CALCITE-4364] `a in (1, 2) and a = 1` should be simplified to `a=1`"}, "afterCommit": {"oid": "ba956b3f40a1728df67ea411f1192a0486dfccd5", "author": {"user": {"login": "danny0405", "name": "Danny Chan"}}, "url": "https://github.com/apache/calcite/commit/ba956b3f40a1728df67ea411f1192a0486dfccd5", "committedDate": "2020-11-02T07:09:20Z", "message": "[CALCITE-4364] `a in (1, 2) and a = 1` should be simplified to `a=1`"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ba956b3f40a1728df67ea411f1192a0486dfccd5", "author": {"user": {"login": "danny0405", "name": "Danny Chan"}}, "url": "https://github.com/apache/calcite/commit/ba956b3f40a1728df67ea411f1192a0486dfccd5", "committedDate": "2020-11-02T07:09:20Z", "message": "[CALCITE-4364] `a in (1, 2) and a = 1` should be simplified to `a=1`"}, "afterCommit": {"oid": "306544af0108b196d26e36eadb9c9d1161c87d20", "author": {"user": {"login": "danny0405", "name": "Danny Chan"}}, "url": "https://github.com/apache/calcite/commit/306544af0108b196d26e36eadb9c9d1161c87d20", "committedDate": "2020-11-02T07:13:28Z", "message": "[CALCITE-4364] `a in (1, 2) and a = 1` should be simplified to `a=1`"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxOTYwMTY0", "url": "https://github.com/apache/calcite/pull/2238#pullrequestreview-521960164", "createdAt": "2020-11-02T20:13:34Z", "commit": {"oid": "306544af0108b196d26e36eadb9c9d1161c87d20"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQyMDoxMzozNVrOHsUEPw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQyMDoxMzozNVrOHsUEPw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjIyODE1OQ==", "bodyText": "s/Checks/Returns/; \"Checks\" often means that the method will throw if the check fails, whereas \"Returns\" is unambiguous.\nPut the criteria in the javadoc, and describe the purpose of newTermsCnt.\nI wouldn't abbreviate count to cnt. Save to characters, but convert a word into a non-word.", "url": "https://github.com/apache/calcite/pull/2238#discussion_r516228159", "createdAt": "2020-11-02T20:13:35Z", "author": {"login": "julianhyde"}, "path": "core/src/main/java/org/apache/calcite/rex/RexSimplify.java", "diffHunk": "@@ -2710,6 +2710,16 @@ private boolean accept1(RexNode e, SqlKind kind,\n       }\n     }\n \n+    /** Checks whether it is worth to fix and convert to {@code SEARCH} calls. */", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "306544af0108b196d26e36eadb9c9d1161c87d20"}, "originalPosition": 22}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxOTY2MDIy", "url": "https://github.com/apache/calcite/pull/2238#pullrequestreview-521966022", "createdAt": "2020-11-02T20:23:07Z", "commit": {"oid": "306544af0108b196d26e36eadb9c9d1161c87d20"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQyMDoyMzowN1rOHsUWoQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQyMDoyMzowN1rOHsUWoQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjIzMjg2NQ==", "bodyText": "Streams are cool but they are very expensive.\nProbably we are in some hot path here.\nIs it worth to use a simple loop?", "url": "https://github.com/apache/calcite/pull/2238#discussion_r516232865", "createdAt": "2020-11-02T20:23:07Z", "author": {"login": "eolivelli"}, "path": "core/src/main/java/org/apache/calcite/rex/RexSimplify.java", "diffHunk": "@@ -2710,6 +2710,16 @@ private boolean accept1(RexNode e, SqlKind kind,\n       }\n     }\n \n+    /** Checks whether it is worth to fix and convert to {@code SEARCH} calls. */\n+    boolean needToFix(int newTermsCnt) {\n+      // Fix and converts to SEARCH if:\n+      // 1. A Sarg has complexity greater than 1;\n+      // 2. The terms are reduced as simpler Sarg points.\n+      return map.values().stream().anyMatch(b -> b.complexity() > 1)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "306544af0108b196d26e36eadb9c9d1161c87d20"}, "originalPosition": 27}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxOTgzMDEx", "url": "https://github.com/apache/calcite/pull/2238#pullrequestreview-521983011", "createdAt": "2020-11-02T20:51:23Z", "commit": {"oid": "306544af0108b196d26e36eadb9c9d1161c87d20"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQyMDo1MToyM1rOHsVMmg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQyMDo1MToyM1rOHsVMmg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjI0NjY4Mg==", "bodyText": "What if we always convert to sarg format? Are there drawbacks?", "url": "https://github.com/apache/calcite/pull/2238#discussion_r516246682", "createdAt": "2020-11-02T20:51:23Z", "author": {"login": "vlsi"}, "path": "core/src/main/java/org/apache/calcite/rex/RexSimplify.java", "diffHunk": "@@ -1330,7 +1330,7 @@ RexNode simplifyAnd(RexCall e, RexUnknownAs unknownAs) {\n \n     final SargCollector sargCollector = new SargCollector(rexBuilder, true);\n     operands.forEach(t -> sargCollector.accept(t, terms));\n-    if (sargCollector.map.values().stream().anyMatch(b -> b.complexity() > 1)) {\n+    if (sargCollector.needToFix(terms.size())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "306544af0108b196d26e36eadb9c9d1161c87d20"}, "originalPosition": 5}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "306544af0108b196d26e36eadb9c9d1161c87d20", "author": {"user": {"login": "danny0405", "name": "Danny Chan"}}, "url": "https://github.com/apache/calcite/commit/306544af0108b196d26e36eadb9c9d1161c87d20", "committedDate": "2020-11-02T07:13:28Z", "message": "[CALCITE-4364] `a in (1, 2) and a = 1` should be simplified to `a=1`"}, "afterCommit": {"oid": "eec59546357c771ce4b2836f32895fb51aad08c4", "author": {"user": {"login": "danny0405", "name": "Danny Chan"}}, "url": "https://github.com/apache/calcite/commit/eec59546357c771ce4b2836f32895fb51aad08c4", "committedDate": "2020-11-03T03:05:18Z", "message": "[CALCITE-4364] `a in (1, 2) and a = 1` should be simplified to `a=1`"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "eec59546357c771ce4b2836f32895fb51aad08c4", "author": {"user": {"login": "danny0405", "name": "Danny Chan"}}, "url": "https://github.com/apache/calcite/commit/eec59546357c771ce4b2836f32895fb51aad08c4", "committedDate": "2020-11-03T03:05:18Z", "message": "[CALCITE-4364] `a in (1, 2) and a = 1` should be simplified to `a=1`"}, "afterCommit": {"oid": "d5f20ffff275811d36f579256e9bfcc18db52b20", "author": {"user": {"login": "danny0405", "name": "Danny Chan"}}, "url": "https://github.com/apache/calcite/commit/d5f20ffff275811d36f579256e9bfcc18db52b20", "committedDate": "2020-11-03T03:07:40Z", "message": "[CALCITE-4364] `a in (1, 2) and a = 1` should be simplified to `a=1`"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyMTY4MzY1", "url": "https://github.com/apache/calcite/pull/2238#pullrequestreview-522168365", "createdAt": "2020-11-03T03:18:18Z", "commit": {"oid": "d5f20ffff275811d36f579256e9bfcc18db52b20"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwMzoxODoxOFrOHsfDkQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwMzoxODoxOFrOHsfDkQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQwODIwOQ==", "bodyText": "Maybe we need another test case:\ndeptno in (20, 10) and deptno = 30\n==> false?", "url": "https://github.com/apache/calcite/pull/2238#discussion_r516408209", "createdAt": "2020-11-03T03:18:18Z", "author": {"login": "liyafan82"}, "path": "core/src/test/java/org/apache/calcite/rex/RexProgramTest.java", "diffHunk": "@@ -1774,6 +1770,17 @@ private void checkExponentialCnf(int n) {\n     checkSimplify2(e, \"SEARCH(?0.int0, Sarg[10])\", \"=(?0.int0, 10)\");\n   }\n \n+  @Test void testSimplifyInAnd() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d5f20ffff275811d36f579256e9bfcc18db52b20"}, "originalPosition": 24}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d5f20ffff275811d36f579256e9bfcc18db52b20", "author": {"user": {"login": "danny0405", "name": "Danny Chan"}}, "url": "https://github.com/apache/calcite/commit/d5f20ffff275811d36f579256e9bfcc18db52b20", "committedDate": "2020-11-03T03:07:40Z", "message": "[CALCITE-4364] `a in (1, 2) and a = 1` should be simplified to `a=1`"}, "afterCommit": {"oid": "6954d69dd8a333e54f679abb8dd841251a114678", "author": {"user": {"login": "danny0405", "name": "Danny Chan"}}, "url": "https://github.com/apache/calcite/commit/6954d69dd8a333e54f679abb8dd841251a114678", "committedDate": "2020-11-03T06:00:16Z", "message": "[CALCITE-4364] `a in (1, 2) and a = 1` should be simplified to `a=1`"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6954d69dd8a333e54f679abb8dd841251a114678", "author": {"user": {"login": "danny0405", "name": "Danny Chan"}}, "url": "https://github.com/apache/calcite/commit/6954d69dd8a333e54f679abb8dd841251a114678", "committedDate": "2020-11-03T06:00:16Z", "message": "[CALCITE-4364] `a in (1, 2) and a = 1` should be simplified to `a=1`"}, "afterCommit": {"oid": "c1ff54ffa7ec2d05cf58ad24a156d7a79bbbebbd", "author": {"user": {"login": "danny0405", "name": "Danny Chan"}}, "url": "https://github.com/apache/calcite/commit/c1ff54ffa7ec2d05cf58ad24a156d7a79bbbebbd", "committedDate": "2020-11-03T06:57:25Z", "message": "[CALCITE-4364] `a in (1, 2) and a = 1` should be simplified to `a=1`"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c1ff54ffa7ec2d05cf58ad24a156d7a79bbbebbd", "author": {"user": {"login": "danny0405", "name": "Danny Chan"}}, "url": "https://github.com/apache/calcite/commit/c1ff54ffa7ec2d05cf58ad24a156d7a79bbbebbd", "committedDate": "2020-11-03T06:57:25Z", "message": "[CALCITE-4364] `a in (1, 2) and a = 1` should be simplified to `a=1`"}, "afterCommit": {"oid": "4c5ca3165ead471656fa8c3f401132cba469f6bb", "author": {"user": {"login": "danny0405", "name": "Danny Chan"}}, "url": "https://github.com/apache/calcite/commit/4c5ca3165ead471656fa8c3f401132cba469f6bb", "committedDate": "2020-11-03T06:58:12Z", "message": "[CALCITE-4364] `a IN (1, 2) AND a = 1` should be simplified to `a = 1`"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIzMzIxMzI3", "url": "https://github.com/apache/calcite/pull/2238#pullrequestreview-523321327", "createdAt": "2020-11-04T12:38:19Z", "commit": {"oid": "4c5ca3165ead471656fa8c3f401132cba469f6bb"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQxMjozODoxOVrOHtWULg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQxMjozODoxOVrOHtWULg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzMxMzU4Mg==", "bodyText": "I find deptno > 0 or deptno in (20, 10) can' t be simplified as deptno > 0", "url": "https://github.com/apache/calcite/pull/2238#discussion_r517313582", "createdAt": "2020-11-04T12:38:19Z", "author": {"login": "godfreyhe"}, "path": "core/src/test/java/org/apache/calcite/rex/RexProgramTest.java", "diffHunk": "@@ -1774,6 +1770,27 @@ private void checkExponentialCnf(int n) {\n     checkSimplify2(e, \"SEARCH(?0.int0, Sarg[10])\", \"=(?0.int0, 10)\");\n   }\n \n+  @Test void testSimplifyInAnd() {\n+    // deptno in (20, 10) and deptno = 10\n+    //   ==>\n+    // deptno = 10\n+    checkSimplify2(\n+        and(\n+            in(vInt(), literal(20), literal(10)),\n+            eq(vInt(), literal(10))),\n+        \"SEARCH(?0.int0, Sarg[10])\",\n+        \"=(?0.int0, 10)\");\n+\n+    // deptno in (20, 10) and deptno = 30\n+    //   ==>\n+    // false\n+    checkSimplify(\n+        and(\n+        in(vInt(), literal(20), literal(10)),\n+        eq(vInt(), literal(30))),\n+        \"false\");\n+  }\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4c5ca3165ead471656fa8c3f401132cba469f6bb"}, "originalPosition": 44}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4c5ca3165ead471656fa8c3f401132cba469f6bb", "author": {"user": {"login": "danny0405", "name": "Danny Chan"}}, "url": "https://github.com/apache/calcite/commit/4c5ca3165ead471656fa8c3f401132cba469f6bb", "committedDate": "2020-11-03T06:58:12Z", "message": "[CALCITE-4364] `a IN (1, 2) AND a = 1` should be simplified to `a = 1`"}, "afterCommit": {"oid": "061ba0acc3a47ba8cfeba6256f4c1353697e1270", "author": {"user": {"login": "danny0405", "name": "Danny Chan"}}, "url": "https://github.com/apache/calcite/commit/061ba0acc3a47ba8cfeba6256f4c1353697e1270", "committedDate": "2020-11-05T07:01:59Z", "message": "[CALCITE-4364]  should be simplified to"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIzOTkwNjg4", "url": "https://github.com/apache/calcite/pull/2238#pullrequestreview-523990688", "createdAt": "2020-11-05T07:41:45Z", "commit": {"oid": "061ba0acc3a47ba8cfeba6256f4c1353697e1270"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQwNzo0MTo0NVrOHt2xKA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQwNzo0MTo0NVrOHt2xKA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzg0NTI4OA==", "bodyText": "An improvement change.", "url": "https://github.com/apache/calcite/pull/2238#discussion_r517845288", "createdAt": "2020-11-05T07:41:45Z", "author": {"login": "danny0405"}, "path": "core/src/test/java/org/apache/calcite/rex/RexProgramTest.java", "diffHunk": "@@ -1475,11 +1476,11 @@ private void checkExponentialCnf(int n) {\n             ne(aRef, literal4)),\n         \"<>(?0.a, 4)\");\n \n-    // \"b <> 1 or b = 1\" cannot be simplified, because b might be null\n+    // \"b <> 1 or b = 1\" ==> \"b is not null\" with unknown as false\n     final RexNode neOrEq =\n         or(ne(bRef, literal(1)),\n             eq(bRef, literal(1)));\n-    checkSimplifyFilter(neOrEq, \"OR(<>(?0.b, 1), =(?0.b, 1))\");\n+    checkSimplifyFilter(neOrEq, \"SEARCH(?0.b, Sarg[NOT NULL])\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "061ba0acc3a47ba8cfeba6256f4c1353697e1270"}, "originalPosition": 58}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIzOTkwODMw", "url": "https://github.com/apache/calcite/pull/2238#pullrequestreview-523990830", "createdAt": "2020-11-05T07:41:57Z", "commit": {"oid": "061ba0acc3a47ba8cfeba6256f4c1353697e1270"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQwNzo0MTo1N1rOHt2xoQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQwNzo0MTo1N1rOHt2xoQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzg0NTQwOQ==", "bodyText": "An improvement change.", "url": "https://github.com/apache/calcite/pull/2238#discussion_r517845409", "createdAt": "2020-11-05T07:41:57Z", "author": {"login": "danny0405"}, "path": "core/src/test/java/org/apache/calcite/rex/RexProgramTest.java", "diffHunk": "@@ -1846,7 +1880,7 @@ private void checkExponentialCnf(int n) {\n                 and(\n                     ge(vInt(), literal(1)),\n                     le(vInt(), literal(1))))),\n-        \"AND(=(?0.int2, 2), OR(=(?0.int3, 3), AND(>=(?0.int0, 1), <=(?0.int0, 1))))\",\n+        \"AND(=(?0.int2, 2), OR(=(?0.int3, 3), SEARCH(?0.int0, Sarg[1])))\",\n         \"AND(=(?0.int2, 2), OR(=(?0.int3, 3), =(?0.int0, 1)))\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "061ba0acc3a47ba8cfeba6256f4c1353697e1270"}, "originalPosition": 108}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIzOTkwOTMz", "url": "https://github.com/apache/calcite/pull/2238#pullrequestreview-523990933", "createdAt": "2020-11-05T07:42:09Z", "commit": {"oid": "061ba0acc3a47ba8cfeba6256f4c1353697e1270"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQwNzo0MjoxMFrOHt2yDA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQwNzo0MjoxMFrOHt2yDA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzg0NTUxNg==", "bodyText": "An improvement change.", "url": "https://github.com/apache/calcite/pull/2238#discussion_r517845516", "createdAt": "2020-11-05T07:42:10Z", "author": {"login": "danny0405"}, "path": "core/src/test/resources/org/apache/calcite/test/RelOptRulesTest.xml", "diffHunk": "@@ -6217,7 +6217,7 @@ LogicalProject(EXPR$0=[1])\n       LogicalProject(DEPTNO=[$7])\n         LogicalFilter(condition=[>($7, 1)])\n           LogicalTableScan(table=[[CATALOG, SALES, EMP]])\n-    LogicalFilter(condition=[OR(>($7, 7), >($7, 1))])\n+    LogicalFilter(condition=[SEARCH($7, Sarg[(1..+\u221e)])])\n       LogicalTableScan(table=[[CATALOG, SALES, EMP]])", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "061ba0acc3a47ba8cfeba6256f4c1353697e1270"}, "originalPosition": 24}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "061ba0acc3a47ba8cfeba6256f4c1353697e1270", "author": {"user": {"login": "danny0405", "name": "Danny Chan"}}, "url": "https://github.com/apache/calcite/commit/061ba0acc3a47ba8cfeba6256f4c1353697e1270", "committedDate": "2020-11-05T07:01:59Z", "message": "[CALCITE-4364]  should be simplified to"}, "afterCommit": {"oid": "2d3554fa4cc467ba4bb8c4982c2bf234f9254ded", "author": {"user": {"login": "danny0405", "name": "Danny Chan"}}, "url": "https://github.com/apache/calcite/commit/2d3554fa4cc467ba4bb8c4982c2bf234f9254ded", "committedDate": "2020-11-05T08:33:37Z", "message": "[CALCITE-4364] `a IN (1, 2) AND a = 1` should be simplified to `a = 1`"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2d3554fa4cc467ba4bb8c4982c2bf234f9254ded", "author": {"user": {"login": "danny0405", "name": "Danny Chan"}}, "url": "https://github.com/apache/calcite/commit/2d3554fa4cc467ba4bb8c4982c2bf234f9254ded", "committedDate": "2020-11-05T08:33:37Z", "message": "[CALCITE-4364] `a IN (1, 2) AND a = 1` should be simplified to `a = 1`"}, "afterCommit": {"oid": "8158ca3e5ef4f6401ae75cf671d43e59fa1a4ac1", "author": {"user": {"login": "danny0405", "name": "Danny Chan"}}, "url": "https://github.com/apache/calcite/commit/8158ca3e5ef4f6401ae75cf671d43e59fa1a4ac1", "committedDate": "2020-11-06T03:39:37Z", "message": "[CALCITE-4364] `a IN (1, 2) AND a = 1` should be simplified to `a = 1`"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "8158ca3e5ef4f6401ae75cf671d43e59fa1a4ac1", "author": {"user": {"login": "danny0405", "name": "Danny Chan"}}, "url": "https://github.com/apache/calcite/commit/8158ca3e5ef4f6401ae75cf671d43e59fa1a4ac1", "committedDate": "2020-11-06T03:39:37Z", "message": "[CALCITE-4364] `a IN (1, 2) AND a = 1` should be simplified to `a = 1`"}, "afterCommit": {"oid": "d36d91a6c09b4fddc7694b16c4554e9b1cce2999", "author": {"user": {"login": "danny0405", "name": "Danny Chan"}}, "url": "https://github.com/apache/calcite/commit/d36d91a6c09b4fddc7694b16c4554e9b1cce2999", "committedDate": "2020-11-06T06:33:42Z", "message": "[CALCITE-4364] `a IN (1, 2) AND a = 1` should be simplified to `a = 1`"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d36d91a6c09b4fddc7694b16c4554e9b1cce2999", "author": {"user": {"login": "danny0405", "name": "Danny Chan"}}, "url": "https://github.com/apache/calcite/commit/d36d91a6c09b4fddc7694b16c4554e9b1cce2999", "committedDate": "2020-11-06T06:33:42Z", "message": "[CALCITE-4364] `a IN (1, 2) AND a = 1` should be simplified to `a = 1`"}, "afterCommit": {"oid": "74ec77a6639b15a54c695ff4ee3a84dc9c61d8c6", "author": {"user": {"login": "danny0405", "name": "Danny Chan"}}, "url": "https://github.com/apache/calcite/commit/74ec77a6639b15a54c695ff4ee3a84dc9c61d8c6", "committedDate": "2020-11-06T06:38:02Z", "message": "[CALCITE-4364] `a IN (1, 2) AND a = 1` should be simplified to `a = 1`"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI2NTUxODY4", "url": "https://github.com/apache/calcite/pull/2238#pullrequestreview-526551868", "createdAt": "2020-11-09T18:50:29Z", "commit": {"oid": "74ec77a6639b15a54c695ff4ee3a84dc9c61d8c6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxODo1MDoyOVrOHv8sPg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxODo1MDoyOVrOHv8sPg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAzOTQ4Ng==", "bodyText": "Will throw if ranges.isEmpty() because you iterate before you check size. Add a test where this is called on an empty range set.", "url": "https://github.com/apache/calcite/pull/2238#discussion_r520039486", "createdAt": "2020-11-09T18:50:29Z", "author": {"login": "julianhyde"}, "path": "core/src/main/java/org/apache/calcite/util/RangeSets.java", "diffHunk": "@@ -128,6 +129,14 @@ private RangeSets() {}\n         && !range.isEmpty();\n   }\n \n+  /** Returns whether a range set is a single open interval. */\n+  public static <C extends Comparable<C>> boolean isOpenInterval(RangeSet<C> rangeSet) {\n+    final Set<Range<C>> ranges = rangeSet.asRanges();\n+    final Range<C> range = ranges.iterator().next();\n+    return ranges.size() == 1", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "74ec77a6639b15a54c695ff4ee3a84dc9c61d8c6"}, "originalPosition": 16}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI2NTUzOTQ0", "url": "https://github.com/apache/calcite/pull/2238#pullrequestreview-526553944", "createdAt": "2020-11-09T18:53:13Z", "commit": {"oid": "74ec77a6639b15a54c695ff4ee3a84dc9c61d8c6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxODo1MzoxM1rOHv8yuA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxODo1MzoxM1rOHv8yuA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDA0MTE0NA==", "bodyText": "There is no objective definition of 'simple'. I would claim that 'x <> 5' is simple, and so is 'x IS NOT NULL'. You might disagree.\nSo, this method doesn't belong on Sarg. It belongs in whichever piece of code needs a particular definition of 'simple'.", "url": "https://github.com/apache/calcite/pull/2238#discussion_r520041144", "createdAt": "2020-11-09T18:53:13Z", "author": {"login": "julianhyde"}, "path": "core/src/main/java/org/apache/calcite/util/Sarg.java", "diffHunk": "@@ -170,6 +170,14 @@ public boolean isComplementedPoints() {\n             .allMatch(RangeSets::isPoint);\n   }\n \n+  /**\n+   * Returns whether this Sarg can be expanded to more simple form, e.g.\n+   * the IN call or single comparison.\n+   */\n+  public boolean isSimple() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "74ec77a6639b15a54c695ff4ee3a84dc9c61d8c6"}, "originalPosition": 8}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI2NTU2OTI0", "url": "https://github.com/apache/calcite/pull/2238#pullrequestreview-526556924", "createdAt": "2020-11-09T18:57:02Z", "commit": {"oid": "74ec77a6639b15a54c695ff4ee3a84dc9c61d8c6"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxODo1NzowMlrOHv88CA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxODo1NzowMlrOHv88CA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDA0MzUyOA==", "bodyText": "Do you think we should flatten those ANDs in AND(AND(>($0, 0), <($0, 10)), IS NOT NULL($1))? I know it might be difficult to achieve efficiently.", "url": "https://github.com/apache/calcite/pull/2238#discussion_r520043528", "createdAt": "2020-11-09T18:57:02Z", "author": {"login": "julianhyde"}, "path": "core/src/test/java/org/apache/calcite/rex/RexProgramTest.java", "diffHunk": "@@ -1687,10 +1687,8 @@ private void checkExponentialCnf(int n) {\n         isNotNull(bRef));\n     // [CALCITE-4352] causes \"and b is not null\" to disappear from the expanded\n     // form.\n-    final String simplified = \"AND(SEARCH($0, Sarg[(0..10)]),\"\n-        + \" SEARCH($1, Sarg[NOT NULL]))\";\n-    final String expanded =\n-        \"AND(AND(>($0, 0), <($0, 10)), IS NOT NULL($1))\";\n+    final String simplified = \"AND(SEARCH($0, Sarg[(0..10)]), IS NOT NULL($1))\";\n+    final String expanded = \"AND(AND(>($0, 0), <($0, 10)), IS NOT NULL($1))\";\n     checkSimplify(expr, simplified)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "74ec77a6639b15a54c695ff4ee3a84dc9c61d8c6"}, "originalPosition": 102}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "117c44e470e02dc45a73c8d1aeb9248ac0fa8a23", "author": {"user": {"login": "danny0405", "name": "Danny Chan"}}, "url": "https://github.com/apache/calcite/commit/117c44e470e02dc45a73c8d1aeb9248ac0fa8a23", "committedDate": "2020-11-12T04:08:15Z", "message": "[CALCITE-4364] `a IN (1, 2) AND a = 1` should be simplified to `a = 1`"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6ac6756084c69f0dcb193bcd19cdb277b42064e7", "author": {"user": {"login": "danny0405", "name": "Danny Chan"}}, "url": "https://github.com/apache/calcite/commit/6ac6756084c69f0dcb193bcd19cdb277b42064e7", "committedDate": "2020-11-11T05:56:32Z", "message": "Fix Julian's review comments"}, "afterCommit": {"oid": "117c44e470e02dc45a73c8d1aeb9248ac0fa8a23", "author": {"user": {"login": "danny0405", "name": "Danny Chan"}}, "url": "https://github.com/apache/calcite/commit/117c44e470e02dc45a73c8d1aeb9248ac0fa8a23", "committedDate": "2020-11-12T04:08:15Z", "message": "[CALCITE-4364] `a IN (1, 2) AND a = 1` should be simplified to `a = 1`"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3017, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}