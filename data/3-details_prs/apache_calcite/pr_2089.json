{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU4MjQwMzEw", "number": 2089, "title": "[CALCITE-4081] Round-tripping a DECIMAL literal throws validation error", "bodyText": "JIRA: https://issues.apache.org/jira/browse/CALCITE-4081", "createdAt": "2020-07-29T07:06:54Z", "url": "https://github.com/apache/calcite/pull/2089", "merged": true, "mergeCommit": {"oid": "63c1667459d594cf4761e794b5f882a49a9ae197"}, "closed": true, "closedAt": "2020-08-06T06:36:03Z", "author": {"login": "chunweilei"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc6K-2DgFqTQ1ODg4NDA3NA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABc6OH9JgBqjM2MDcwNTM0MjM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4ODg0MDc0", "url": "https://github.com/apache/calcite/pull/2089#pullrequestreview-458884074", "createdAt": "2020-07-31T02:41:23Z", "commit": {"oid": "74e25247096ae38b069e1674f7710a2c54c5d9d0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4ODk1NTAy", "url": "https://github.com/apache/calcite/pull/2089#pullrequestreview-458895502", "createdAt": "2020-07-31T03:29:16Z", "commit": {"oid": "74e25247096ae38b069e1674f7710a2c54c5d9d0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQwMzoyOToxNlrOG564MQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQwMzoyOToxNlrOG564MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzM4NjY3Mw==", "bodyText": "Seems the toType should always be a Decimal type, we should add a check here. Also, can we add some doc to this method ?", "url": "https://github.com/apache/calcite/pull/2089#discussion_r463386673", "createdAt": "2020-07-31T03:29:16Z", "author": {"login": "danny0405"}, "path": "core/src/main/java/org/apache/calcite/sql/type/SqlTypeUtil.java", "diffHunk": "@@ -1751,4 +1752,18 @@ public static RelDataType extractLastNFields(RelDataTypeFactory typeFactory,\n     return typeFactory.createStructType(\n         type.getFieldList().subList(fieldsCnt - numToKeep, fieldsCnt));\n   }\n+\n+  public static boolean isValidDecimalValue(BigDecimal value, RelDataType toType) {\n+    if (value == null) {\n+      return true;\n+    }\n+    switch (toType.getSqlTypeName()) {\n+    case DECIMAL:\n+      final int intDigits = value.precision() - value.scale();\n+      final int maxIntDigits = toType.getPrecision() - toType.getScale();\n+      return intDigits <= maxIntDigits;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "74e25247096ae38b069e1674f7710a2c54c5d9d0"}, "originalPosition": 21}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4ODk2MTI5", "url": "https://github.com/apache/calcite/pull/2089#pullrequestreview-458896129", "createdAt": "2020-07-31T03:31:55Z", "commit": {"oid": "74e25247096ae38b069e1674f7710a2c54c5d9d0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQwMzozMTo1NlrOG566cQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQwMzozMTo1NlrOG566cQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzM4NzI0OQ==", "bodyText": "Why change the query ? It works in MySql and PostgresSQL.", "url": "https://github.com/apache/calcite/pull/2089#discussion_r463387249", "createdAt": "2020-07-31T03:31:56Z", "author": {"login": "danny0405"}, "path": "core/src/test/resources/sql/misc.iq", "diffHunk": "@@ -1689,7 +1689,7 @@ EnumerableCalc(expr#0=[{inputs}], expr#1=[123:BIGINT], EXPR$0=[$t1])\n !plan\n \n # Cast an integer literal to a decimal; note: the plan does not contain CAST\n-values cast('123.45' as decimal(4, 2));\n+values cast('123.45' as decimal(5, 2));\n +--------+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "74e25247096ae38b069e1674f7710a2c54c5d9d0"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6fef247a94507bf8c6544c210c7920dbdb0ce96f", "author": {"user": {"login": "chunweilei", "name": "chunwei"}}, "url": "https://github.com/apache/calcite/commit/6fef247a94507bf8c6544c210c7920dbdb0ce96f", "committedDate": "2020-07-31T06:20:44Z", "message": "[CALCITE-4081] Round-tripping a DECIMAL literal throws validation error"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "74e25247096ae38b069e1674f7710a2c54c5d9d0", "author": {"user": {"login": "chunweilei", "name": "chunwei"}}, "url": "https://github.com/apache/calcite/commit/74e25247096ae38b069e1674f7710a2c54c5d9d0", "committedDate": "2020-07-29T07:00:40Z", "message": "[CALCITE-4081] Round-tripping a DECIMAL literal throws validation error"}, "afterCommit": {"oid": "6fef247a94507bf8c6544c210c7920dbdb0ce96f", "author": {"user": {"login": "chunweilei", "name": "chunwei"}}, "url": "https://github.com/apache/calcite/commit/6fef247a94507bf8c6544c210c7920dbdb0ce96f", "committedDate": "2020-07-31T06:20:44Z", "message": "[CALCITE-4081] Round-tripping a DECIMAL literal throws validation error"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3172, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}