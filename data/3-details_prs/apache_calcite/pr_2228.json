{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA3MjA2NjQw", "number": 2228, "title": "[CALCITE-4225] Make RelDecorrelator pluggable", "bodyText": "Change all the members of RelDecorrelator protected scope\nAdd RelDecorrelator.getVisitor to override the dispatcher visitor\nAdd RelDecorrelator.getPostDecorrelateRules for post decorrelation\noptimisation", "createdAt": "2020-10-21T02:35:08Z", "url": "https://github.com/apache/calcite/pull/2228", "merged": true, "mergeCommit": {"oid": "3c7e2e3f3edbf60d93ebf7c8946d1177a02d3e87"}, "closed": true, "closedAt": "2020-10-26T07:54:03Z", "author": {"login": "danny0405"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdUk03ngFqTUxMzI4MTUwMg==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdVOfGSgBqjM5MTIwMDczOTA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEzMjgxNTAy", "url": "https://github.com/apache/calcite/pull/2228#pullrequestreview-513281502", "createdAt": "2020-10-21T03:30:03Z", "commit": {"oid": "0c540c21796a216df7dc55005ae5a2c66042ebbd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQwMzozMDowM1rOHlY64w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQwMzozMDowM1rOHlY64w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODk2NzY1MQ==", "bodyText": "It may be more efficient to replace this with !getPostDecorrelateRules().isEmpty()", "url": "https://github.com/apache/calcite/pull/2228#discussion_r508967651", "createdAt": "2020-10-21T03:30:03Z", "author": {"login": "liyafan82"}, "path": "core/src/main/java/org/apache/calcite/sql2rel/RelDecorrelator.java", "diffHunk": "@@ -280,16 +285,19 @@ protected RelNode decorrelate(RelNode root) {\n     final Frame frame = getInvoke(root, null);\n     if (frame != null) {\n       // has been rewritten; apply rules post-decorrelation\n-      final HepProgram program2 = HepProgram.builder()\n+      final HepProgramBuilder builder = HepProgram.builder()\n           .addRuleInstance(\n               CoreRules.FILTER_INTO_JOIN.config\n                   .withRelBuilderFactory(f)\n                   .toRule())\n           .addRuleInstance(\n               CoreRules.JOIN_CONDITION_PUSH.config\n                   .withRelBuilderFactory(f)\n-                  .toRule())\n-          .build();\n+                  .toRule());\n+      if (getPostDecorrelateRules().size() > 0) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0c540c21796a216df7dc55005ae5a2c66042ebbd"}, "originalPosition": 74}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEzMjgxNjQ4", "url": "https://github.com/apache/calcite/pull/2228#pullrequestreview-513281648", "createdAt": "2020-10-21T03:30:28Z", "commit": {"oid": "0c540c21796a216df7dc55005ae5a2c66042ebbd"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQwMzozMDoyOFrOHlY7aQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQwMzozMDoyOFrOHlY7aQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODk2Nzc4NQ==", "bodyText": "this class -> this object", "url": "https://github.com/apache/calcite/pull/2228#discussion_r508967785", "createdAt": "2020-10-21T03:30:28Z", "author": {"login": "liyafan82"}, "path": "core/src/main/java/org/apache/calcite/sql2rel/RelDecorrelator.java", "diffHunk": "@@ -2962,4 +2970,23 @@ assert allLessThan(this.oldToNewOutputs.values(),\n     /** Sets {@link #decorrelator}. */\n     Config withDecorrelator(RelDecorrelator decorrelator);\n   }\n+\n+  // -------------------------------------------------------------------------\n+  //  Getter/Setter\n+  // -------------------------------------------------------------------------\n+\n+  /**\n+   * Returns the {@code visitor} on which the {@code MethodDispatcher} dispatches\n+   * each {@code decorrelateRel} method, the default implementation returns this class,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0c540c21796a216df7dc55005ae5a2c66042ebbd"}, "originalPosition": 92}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0c540c21796a216df7dc55005ae5a2c66042ebbd", "author": {"user": {"login": "danny0405", "name": "Danny Chan"}}, "url": "https://github.com/apache/calcite/commit/0c540c21796a216df7dc55005ae5a2c66042ebbd", "committedDate": "2020-10-21T02:32:05Z", "message": "[CALCITE-4225] Make RelDecorrelator pluggable\n\n* Change all the members of RelDecorrelator protected scope\n* Add RelDecorrelator.getVisitor to override the dispatcher visitor\n* Add RelDecorrelator.getPostDecorrelateRules for post decorrelation\n  optimisation"}, "afterCommit": {"oid": "7893542b606c78f98fcd3737c8c6599436080911", "author": {"user": {"login": "danny0405", "name": "Danny Chan"}}, "url": "https://github.com/apache/calcite/commit/7893542b606c78f98fcd3737c8c6599436080911", "committedDate": "2020-10-21T03:51:27Z", "message": "[CALCITE-4225] Make RelDecorrelator pluggable\n\n* Change all the members of RelDecorrelator protected scope\n* Add RelDecorrelator.getVisitor to override the dispatcher visitor\n* Add RelDecorrelator.getPostDecorrelateRules for post decorrelation\n  optimisation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE1MjU1Njk2", "url": "https://github.com/apache/calcite/pull/2228#pullrequestreview-515255696", "createdAt": "2020-10-23T03:41:08Z", "commit": {"oid": "7893542b606c78f98fcd3737c8c6599436080911"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QwMzo0MTowOFrOHm7GxQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QwMzo0MTowOFrOHm7GxQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDU3NjMyNQ==", "bodyText": "Do we want to consider annotating it with \"@NotNull\"?", "url": "https://github.com/apache/calcite/pull/2228#discussion_r510576325", "createdAt": "2020-10-23T03:41:08Z", "author": {"login": "liyafan82"}, "path": "core/src/main/java/org/apache/calcite/sql2rel/RelDecorrelator.java", "diffHunk": "@@ -2962,4 +2970,23 @@ assert allLessThan(this.oldToNewOutputs.values(),\n     /** Sets {@link #decorrelator}. */\n     Config withDecorrelator(RelDecorrelator decorrelator);\n   }\n+\n+  // -------------------------------------------------------------------------\n+  //  Getter/Setter\n+  // -------------------------------------------------------------------------\n+\n+  /**\n+   * Returns the {@code visitor} on which the {@code MethodDispatcher} dispatches\n+   * each {@code decorrelateRel} method, the default implementation returns this instance,\n+   * if you got a sub-class, override this method to replace the {@code visitor} as the\n+   * sub-class instance.\n+   */\n+  protected RelDecorrelator getVisitor() {\n+    return this;\n+  }\n+\n+  /** Returns the rules applied on the rel after decorrelation, never null. */\n+  protected Collection<RelOptRule> getPostDecorrelateRules() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7893542b606c78f98fcd3737c8c6599436080911"}, "originalPosition": 101}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "57997b53d4ca5c04a0282b3267a38f8a79f42283", "author": {"user": {"login": "danny0405", "name": "Danny Chan"}}, "url": "https://github.com/apache/calcite/commit/57997b53d4ca5c04a0282b3267a38f8a79f42283", "committedDate": "2020-10-23T04:01:40Z", "message": "[CALCITE-4225] Make RelDecorrelator pluggable\n\n* Change all the members of RelDecorrelator as protected scope\n* Add RelDecorrelator.getVisitor to override the dispatcher visitor\n* Add RelDecorrelator.getPostDecorrelateRules for post decorrelation\n  optimisation"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "7893542b606c78f98fcd3737c8c6599436080911", "author": {"user": {"login": "danny0405", "name": "Danny Chan"}}, "url": "https://github.com/apache/calcite/commit/7893542b606c78f98fcd3737c8c6599436080911", "committedDate": "2020-10-21T03:51:27Z", "message": "[CALCITE-4225] Make RelDecorrelator pluggable\n\n* Change all the members of RelDecorrelator protected scope\n* Add RelDecorrelator.getVisitor to override the dispatcher visitor\n* Add RelDecorrelator.getPostDecorrelateRules for post decorrelation\n  optimisation"}, "afterCommit": {"oid": "57997b53d4ca5c04a0282b3267a38f8a79f42283", "author": {"user": {"login": "danny0405", "name": "Danny Chan"}}, "url": "https://github.com/apache/calcite/commit/57997b53d4ca5c04a0282b3267a38f8a79f42283", "committedDate": "2020-10-23T04:01:40Z", "message": "[CALCITE-4225] Make RelDecorrelator pluggable\n\n* Change all the members of RelDecorrelator as protected scope\n* Add RelDecorrelator.getVisitor to override the dispatcher visitor\n* Add RelDecorrelator.getPostDecorrelateRules for post decorrelation\n  optimisation"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2983, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}