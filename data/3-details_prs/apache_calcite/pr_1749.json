{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYxNzI1MDEw", "number": 1749, "title": "Refine rules to avoid producing matches that are known to be no-op", "bodyText": "UnionMergeRule produced lots of unrelated matches because it matched only the top operand as SetOp.\nBottom operand classes were compared in onMatch method only, so\nit resulted in lots of false positives for the optimizer.\nNot it does not get added to the optimizer queue at all.", "createdAt": "2020-01-11T12:19:16Z", "url": "https://github.com/apache/calcite/pull/1749", "merged": true, "mergeCommit": {"oid": "e387deddb0cce39f5827de8744645286b2cb1d7f"}, "closed": true, "closedAt": "2020-01-11T13:14:15Z", "author": {"login": "vlsi"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb5SOjcABqjI5NDA1ODYwODA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb5pruogFqTM0MTU4Mjc2NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d808512f51c69c97e2a1ce4d582acea0d4a40a78", "author": {"user": {"login": "vlsi", "name": "Vladimir Sitnikov"}}, "url": "https://github.com/apache/calcite/commit/d808512f51c69c97e2a1ce4d582acea0d4a40a78", "committedDate": "2020-01-11T12:18:43Z", "message": "Refine rules to avoid producing matches that are known to be no-op\n\nUnionMergeRule produced lots of unrelated matches because it\nmathed only the top operand as SetOp.\nBottom operand classes were compared in onMatch method only, so\nit resulted in lots of false positives for the optimizer.\n\nNot it does not get added to the optimizer queue at all."}, "afterCommit": {"oid": "ef6be093d67ef989cf861937b7ea98aa808a2b57", "author": {"user": {"login": "vlsi", "name": "Vladimir Sitnikov"}}, "url": "https://github.com/apache/calcite/commit/ef6be093d67ef989cf861937b7ea98aa808a2b57", "committedDate": "2020-01-11T12:22:41Z", "message": "Refine rules to avoid producing matches that are known to be no-op\n\nUnionMergeRule produced lots of unrelated matches because it\nmatched only the top operand as SetOp.\nBottom operand classes were compared in onMatch method only, so\nit resulted in lots of false positives for the optimizer.\n\nNot it does not get added to the optimizer queue at all."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e387deddb0cce39f5827de8744645286b2cb1d7f", "author": {"user": {"login": "vlsi", "name": "Vladimir Sitnikov"}}, "url": "https://github.com/apache/calcite/commit/e387deddb0cce39f5827de8744645286b2cb1d7f", "committedDate": "2020-01-11T13:13:42Z", "message": "Refine rules so they produce less no-op matches\n\nUnionMergeRule produced lots of unrelated matches because it\nmatched only the top operand as SetOp.\nBottom operand classes were compared in onMatch method only, so\nit resulted in lots of false positives for the optimizer.\n\nNot it does not get added to the optimizer queue at all."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ef6be093d67ef989cf861937b7ea98aa808a2b57", "author": {"user": {"login": "vlsi", "name": "Vladimir Sitnikov"}}, "url": "https://github.com/apache/calcite/commit/ef6be093d67ef989cf861937b7ea98aa808a2b57", "committedDate": "2020-01-11T12:22:41Z", "message": "Refine rules to avoid producing matches that are known to be no-op\n\nUnionMergeRule produced lots of unrelated matches because it\nmatched only the top operand as SetOp.\nBottom operand classes were compared in onMatch method only, so\nit resulted in lots of false positives for the optimizer.\n\nNot it does not get added to the optimizer queue at all."}, "afterCommit": {"oid": "e387deddb0cce39f5827de8744645286b2cb1d7f", "author": {"user": {"login": "vlsi", "name": "Vladimir Sitnikov"}}, "url": "https://github.com/apache/calcite/commit/e387deddb0cce39f5827de8744645286b2cb1d7f", "committedDate": "2020-01-11T13:13:42Z", "message": "Refine rules so they produce less no-op matches\n\nUnionMergeRule produced lots of unrelated matches because it\nmatched only the top operand as SetOp.\nBottom operand classes were compared in onMatch method only, so\nit resulted in lots of false positives for the optimizer.\n\nNot it does not get added to the optimizer queue at all."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQxNTgyNzY0", "url": "https://github.com/apache/calcite/pull/1749#pullrequestreview-341582764", "createdAt": "2020-01-12T15:42:28Z", "commit": {"oid": "e387deddb0cce39f5827de8744645286b2cb1d7f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMlQxNTo0MjoyOVrOFcp8NQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMlQxNTo0MjoyOVrOFcp8NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTU5MTYwNQ==", "bodyText": "Hi @vlsi\nShall we do analogous optimization for rules like ProjectSetOpTransposeRule, AggregateUnionAggregateRule, AggregateUnionTransposeRule. I mean check setOp.all or union.all by operandJ, rather than checking in method of onMatch, thus to save the \"match\" to be added into optimizer queue", "url": "https://github.com/apache/calcite/pull/1749#discussion_r365591605", "createdAt": "2020-01-12T15:42:29Z", "author": {"login": "jinxing64"}, "path": "core/src/main/java/org/apache/calcite/rel/rules/UnionToDistinctRule.java", "diffHunk": "@@ -43,7 +43,9 @@\n    */\n   public UnionToDistinctRule(Class<? extends Union> unionClazz,\n       RelBuilderFactory relBuilderFactory) {\n-    super(operand(unionClazz, any()), relBuilderFactory, null);\n+    super(\n+        operandJ(unionClazz, null, union -> !union.all, any()),\n+        relBuilderFactory, null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e387deddb0cce39f5827de8744645286b2cb1d7f"}, "originalPosition": 7}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4463, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}