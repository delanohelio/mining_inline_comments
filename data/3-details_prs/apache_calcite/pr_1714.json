{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU4NTc4Nzg1", "number": 1714, "title": "[Calcite 3663] Support for TRIM function in BigQuery dialect", "bodyText": "In current Calcite implementation for query : SELECT TRIM('ABC') for\u00a0 big-query Dialect it translated into SELECT TRIM(BOTH ' ' FROM 'ABC') .\nBut the appropriate query for BigQuery is  :: SELECT TRIM('ABC')\nSimilarly below query\nSELECT TRIM(BOTH 'a' from 'ABC')\nSELECT TRIM(LEADING ' ' from 'ABC')\nSELECT TRIM(TRAILING ' ' from 'ABC') are translated into invalid BigQuery query.\nUnparse logic for the trim has been handle in BigQuery dialect to convert the source Trim query into valid bigQuery query.", "createdAt": "2020-01-02T07:55:28Z", "url": "https://github.com/apache/calcite/pull/1714", "merged": true, "mergeCommit": {"oid": "e63c252c4adfcce6072ebdfba724af89e9b2859d"}, "closed": true, "closedAt": "2020-01-08T02:12:30Z", "author": {"login": "dhirenda-gautam"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb2WQ0HgBqjI5MTcyNTU1ODg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb4BaHTgBqjI5Mjc3NjAxNDM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "729c1265b9757ef51d6eb26d66b39c834248b615", "author": {"user": {"login": "dhirenda-gautam", "name": "Dhirenda Gautam"}}, "url": "https://github.com/apache/calcite/commit/729c1265b9757ef51d6eb26d66b39c834248b615", "committedDate": "2020-01-02T07:40:05Z", "message": "Merge branch 'master' of https://github.com/dhirenda-gautam/calcite"}, "afterCommit": {"oid": "371c648a93c874dd21d2670123eb560afd2aab0f", "author": {"user": {"login": "dhirenda-gautam", "name": "Dhirenda Gautam"}}, "url": "https://github.com/apache/calcite/commit/371c648a93c874dd21d2670123eb560afd2aab0f", "committedDate": "2020-01-02T09:22:23Z", "message": "Perform indentation for testcase and BQ"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM3NzkzMjg3", "url": "https://github.com/apache/calcite/pull/1714#pullrequestreview-337793287", "createdAt": "2020-01-02T18:34:03Z", "commit": {"oid": "371c648a93c874dd21d2670123eb560afd2aab0f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wMlQxODozNDowNFrOFZyFGw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wMlQxODozNDowNFrOFZyFGw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjU3OTIyNw==", "bodyText": "Also need to validate the second operand?", "url": "https://github.com/apache/calcite/pull/1714#discussion_r362579227", "createdAt": "2020-01-02T18:34:04Z", "author": {"login": "amaliujia"}, "path": "core/src/main/java/org/apache/calcite/sql/dialect/BigQuerySqlDialect.java", "diffHunk": "@@ -192,6 +197,37 @@ public BigQuerySqlDialect(SqlDialect.Context context) {\n     }\n   }\n \n+  /**\n+   * For usage of TRIM, LTRIM and RTRIM in BQ see\n+   * <a href=\"https://cloud.google.com/bigquery/docs/reference/standard-sql/functions-and-operators#trim\">\n+   *  BQ Trim Function</a>.\n+   */\n+  private void unparseTrim(SqlWriter writer, SqlCall call, int leftPrec,\n+      int rightPrec) {\n+    assert call.operand(0) instanceof SqlLiteral : call.operand(0);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "371c648a93c874dd21d2670123eb560afd2aab0f"}, "originalPosition": 35}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM3Nzk0ODYx", "url": "https://github.com/apache/calcite/pull/1714#pullrequestreview-337794861", "createdAt": "2020-01-02T18:37:46Z", "commit": {"oid": "371c648a93c874dd21d2670123eb560afd2aab0f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wMlQxODozNzo0NlrOFZyJ1Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wMlQxODozNzo0NlrOFZyJ1Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjU4MDQzNw==", "bodyText": "As you can see there is a comment about this test case which is hive related. So you can also add comments for BQ.\nYou can either add another comment for BQ, or split this test case to hive and BQ and then add comments seperately.", "url": "https://github.com/apache/calcite/pull/1714#discussion_r362580437", "createdAt": "2020-01-02T18:37:46Z", "author": {"login": "amaliujia"}, "path": "core/src/test/java/org/apache/calcite/rel/rel2sql/RelToSqlConverterTest.java", "diffHunk": "@@ -958,36 +958,82 @@ private static String toSql(RelNode root, SqlDialect dialect) {\n    * <a href=\"https://issues.apache.org/jira/browse/CALCITE-3220\">[CALCITE-3220]\n    * HiveSqlDialect should transform the SQL-standard TRIM function to TRIM,\n    * LTRIM or RTRIM</a>. */\n-  @Test public void testHiveTrim() {\n+  @Test public void testHiveAndBqTrim() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "371c648a93c874dd21d2670123eb560afd2aab0f"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM3OTQwOTI5", "url": "https://github.com/apache/calcite/pull/1714#pullrequestreview-337940929", "createdAt": "2020-01-03T03:38:26Z", "commit": {"oid": "371c648a93c874dd21d2670123eb560afd2aab0f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wM1QwMzozODoyNlrOFZ5aJg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wM1QwMzozODoyNlrOFZ5aJg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjY5OTMwMg==", "bodyText": "This if logic is different with that of HiveSqlDialect. Could you add doc for it?", "url": "https://github.com/apache/calcite/pull/1714#discussion_r362699302", "createdAt": "2020-01-03T03:38:26Z", "author": {"login": "DonnyZone"}, "path": "core/src/main/java/org/apache/calcite/sql/dialect/BigQuerySqlDialect.java", "diffHunk": "@@ -192,6 +197,37 @@ public BigQuerySqlDialect(SqlDialect.Context context) {\n     }\n   }\n \n+  /**\n+   * For usage of TRIM, LTRIM and RTRIM in BQ see\n+   * <a href=\"https://cloud.google.com/bigquery/docs/reference/standard-sql/functions-and-operators#trim\">\n+   *  BQ Trim Function</a>.\n+   */\n+  private void unparseTrim(SqlWriter writer, SqlCall call, int leftPrec,\n+      int rightPrec) {\n+    assert call.operand(0) instanceof SqlLiteral : call.operand(0);\n+    final String operatorName;\n+    SqlLiteral trimFlag = call.operand(0);\n+    SqlLiteral valueToTrim = call.operand(1);\n+    switch (trimFlag.getValueAs(SqlTrimFunction.Flag.class)) {\n+    case LEADING:\n+      operatorName = \"LTRIM\";\n+      break;\n+    case TRAILING:\n+      operatorName = \"RTRIM\";\n+      break;\n+    default:\n+      operatorName = call.getOperator().getName();\n+      break;\n+    }\n+    final SqlWriter.Frame trimFrame = writer.startFunCall(operatorName);\n+    call.operand(2).unparse(writer, leftPrec, rightPrec);\n+    if (!valueToTrim.toValue().matches(\"\\\\s+\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "371c648a93c874dd21d2670123eb560afd2aab0f"}, "originalPosition": 52}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "371c648a93c874dd21d2670123eb560afd2aab0f", "author": {"user": {"login": "dhirenda-gautam", "name": "Dhirenda Gautam"}}, "url": "https://github.com/apache/calcite/commit/371c648a93c874dd21d2670123eb560afd2aab0f", "committedDate": "2020-01-02T09:22:23Z", "message": "Perform indentation for testcase and BQ"}, "afterCommit": {"oid": "294000ddbb5ad6560f23ea2f681b75a6b11723b4", "author": {"user": {"login": "dhirenda-gautam", "name": "Dhirenda Gautam"}}, "url": "https://github.com/apache/calcite/commit/294000ddbb5ad6560f23ea2f681b75a6b11723b4", "committedDate": "2020-01-03T14:57:07Z", "message": "Removed the assertion check and added the Doc for the trim handling with char"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzM4Mzc4OTM2", "url": "https://github.com/apache/calcite/pull/1714#pullrequestreview-338378936", "createdAt": "2020-01-05T03:05:59Z", "commit": {"oid": "294000ddbb5ad6560f23ea2f681b75a6b11723b4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "e9fe04da54043de88b4cb95d6f22ab2668ebfbdd", "author": {"user": {"login": "dhirenda-gautam", "name": "Dhirenda Gautam"}}, "url": "https://github.com/apache/calcite/commit/e9fe04da54043de88b4cb95d6f22ab2668ebfbdd", "committedDate": "2020-01-06T06:49:22Z", "message": "Merge branch 'master' of https://github.com/dhirenda-gautam/calcite into HEAD"}, "afterCommit": {"oid": "37341f2b59ae329b61dee0ce72f52a2a00c97319", "author": {"user": {"login": "dhirenda-gautam", "name": "Dhirenda Gautam"}}, "url": "https://github.com/apache/calcite/commit/37341f2b59ae329b61dee0ce72f52a2a00c97319", "committedDate": "2020-01-06T11:04:36Z", "message": "[Calcite 3663] Support for TRIM function in BigQuery"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "37341f2b59ae329b61dee0ce72f52a2a00c97319", "author": {"user": {"login": "dhirenda-gautam", "name": "Dhirenda Gautam"}}, "url": "https://github.com/apache/calcite/commit/37341f2b59ae329b61dee0ce72f52a2a00c97319", "committedDate": "2020-01-06T11:04:36Z", "message": "[Calcite 3663] Support for TRIM function in BigQuery"}, "afterCommit": {"oid": "3235e6191fc105ba1b30afdbd3bde072f19899f7", "author": {"user": {"login": "dhirenda-gautam", "name": "Dhirenda Gautam"}}, "url": "https://github.com/apache/calcite/commit/3235e6191fc105ba1b30afdbd3bde072f19899f7", "committedDate": "2020-01-07T05:37:32Z", "message": "[CALCITE-3663] Support for TRIM function in BigQuery Dialect"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f6b939dc91b1daadb366a6d8bebcdc743d156dc2", "author": {"user": {"login": "dhirenda-gautam", "name": "Dhirenda Gautam"}}, "url": "https://github.com/apache/calcite/commit/f6b939dc91b1daadb366a6d8bebcdc743d156dc2", "committedDate": "2020-01-07T14:11:09Z", "message": "[CALCITE-3663] Support for TRIM function in BigQuery Dialect"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "3235e6191fc105ba1b30afdbd3bde072f19899f7", "author": {"user": {"login": "dhirenda-gautam", "name": "Dhirenda Gautam"}}, "url": "https://github.com/apache/calcite/commit/3235e6191fc105ba1b30afdbd3bde072f19899f7", "committedDate": "2020-01-07T05:37:32Z", "message": "[CALCITE-3663] Support for TRIM function in BigQuery Dialect"}, "afterCommit": {"oid": "f6b939dc91b1daadb366a6d8bebcdc743d156dc2", "author": {"user": {"login": "dhirenda-gautam", "name": "Dhirenda Gautam"}}, "url": "https://github.com/apache/calcite/commit/f6b939dc91b1daadb366a6d8bebcdc743d156dc2", "committedDate": "2020-01-07T14:11:09Z", "message": "[CALCITE-3663] Support for TRIM function in BigQuery Dialect"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4379, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}