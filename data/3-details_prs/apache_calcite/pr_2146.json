{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg0NTQxOTUw", "number": 2146, "title": "[CALCITE-4241] Some improvements to metadata query", "bodyText": "For {{RelMdColumnUniqueness#areColumnsUnique(RelSubset, RelMetadataQuery,\nImmutableBitSet, boolean)}}, we can return early as we encounter the first null.\n\n\nFor {{RelMdDistinctRowCount#getDistinctRowCount(Values, RelMetadataQuery,\nImmutableBitSet, RexNode)}}, we can get the distinct row count accurately, instead of guessing that half of the elements are distinct.\n\n\nRelMdUtil#areColumnsDefinitelyUniqueWhenNullsFiltered could be implemented in a more efficient way.", "createdAt": "2020-09-11T02:08:54Z", "url": "https://github.com/apache/calcite/pull/2146", "merged": true, "mergeCommit": {"oid": "e7ac26d6ec083848531b456d2acf3f7f58a499b5"}, "closed": true, "closedAt": "2020-09-21T03:51:57Z", "author": {"login": "liyafan82"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdHwR0ugFqTQ4NjUzODg5Nw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdI_weoAFqTQ4ODMwNzIwMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2NTM4ODk3", "url": "https://github.com/apache/calcite/pull/2146#pullrequestreview-486538897", "createdAt": "2020-09-11T07:29:33Z", "commit": {"oid": "dddaf5e85a912534f0b069a0f47484aa661b6363"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQwNzoyOTozM1rOHQRkVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMVQwNzoyOTozM1rOHQRkVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjgyNzA5NA==", "bodyText": "RelMdUtil#areColumnsDefinitelyUniqueWhenNullsFiltered has different implementation from RelMdUtil#areColumnsDefinitelyUnique. The former one would ignore null while the other one not. Why do you say they have same behavoirs?", "url": "https://github.com/apache/calcite/pull/2146#discussion_r486827094", "createdAt": "2020-09-11T07:29:33Z", "author": {"login": "chunweilei"}, "path": "core/src/main/java/org/apache/calcite/rel/rules/LoptOptimizeJoinRule.java", "diffHunk": "@@ -2064,7 +2064,7 @@ private static boolean areSelfJoinKeysUnique(RelMetadataQuery mq,\n     // are unique.  When removing self-joins, if needed, we'll later add an\n     // IS NOT NULL filter on the join keys that are nullable.  Therefore,\n     // it's ok if there are nulls in the unique key.\n-    return RelMdUtil.areColumnsDefinitelyUniqueWhenNullsFiltered(mq, leftRel,\n+    return RelMdUtil.areColumnsDefinitelyUnique(mq, leftRel,\n         joinInfo.leftSet());\n   }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dddaf5e85a912534f0b069a0f47484aa661b6363"}, "originalPosition": 16}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "dddaf5e85a912534f0b069a0f47484aa661b6363", "author": {"user": {"login": "liyafan82", "name": null}}, "url": "https://github.com/apache/calcite/commit/dddaf5e85a912534f0b069a0f47484aa661b6363", "committedDate": "2020-09-10T08:36:57Z", "message": "[CALCITE-4241] Some improvements to metadata query"}, "afterCommit": {"oid": "9d2c0a6ec53fb0e90b8633f1b911b72d7181ff70", "author": {"user": {"login": "liyafan82", "name": null}}, "url": "https://github.com/apache/calcite/commit/9d2c0a6ec53fb0e90b8633f1b911b72d7181ff70", "committedDate": "2020-09-11T08:20:21Z", "message": "[CALCITE-4241] Some improvements to metadata query"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3Mzc0MTU4", "url": "https://github.com/apache/calcite/pull/2146#pullrequestreview-487374158", "createdAt": "2020-09-14T02:05:55Z", "commit": {"oid": "9d2c0a6ec53fb0e90b8633f1b911b72d7181ff70"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwMjowNTo1NVrOHRBrNg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xNFQwMjowNTo1NVrOHRBrNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzYxNTI4Ng==", "bodyText": "Could you add a test case which contains null literal?", "url": "https://github.com/apache/calcite/pull/2146#discussion_r487615286", "createdAt": "2020-09-14T02:05:55Z", "author": {"login": "chunweilei"}, "path": "core/src/test/java/org/apache/calcite/test/RelMetadataTest.java", "diffHunk": "@@ -918,6 +918,28 @@ private void checkRelSelectivity(\n \n   @Test void testDistinctRowCountTable() {\n     // no unique key information is available so return null\n+    RelNode rel = convertSql(\"select * from (values \"\n+        + \"(1, 2, 3), \"\n+        + \"(3, 4, 5), \"\n+        + \"(3, 4, 5), \"\n+        + \"(8, 4, 5) \"\n+        + \") t(c1, c2, c3)\");\n+    final RelMetadataQuery mq = rel.getCluster().getMetadataQuery();\n+\n+    ImmutableBitSet groupKey = ImmutableBitSet.of(0, 1, 2);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9d2c0a6ec53fb0e90b8633f1b911b72d7181ff70"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bb44776ce506e52a755b3770b1837e25805e742b", "author": {"user": {"login": "liyafan82", "name": null}}, "url": "https://github.com/apache/calcite/commit/bb44776ce506e52a755b3770b1837e25805e742b", "committedDate": "2020-09-14T03:06:34Z", "message": "[CALCITE-4241] Some improvements to metadata query"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9d2c0a6ec53fb0e90b8633f1b911b72d7181ff70", "author": {"user": {"login": "liyafan82", "name": null}}, "url": "https://github.com/apache/calcite/commit/9d2c0a6ec53fb0e90b8633f1b911b72d7181ff70", "committedDate": "2020-09-11T08:20:21Z", "message": "[CALCITE-4241] Some improvements to metadata query"}, "afterCommit": {"oid": "bb44776ce506e52a755b3770b1837e25805e742b", "author": {"user": {"login": "liyafan82", "name": null}}, "url": "https://github.com/apache/calcite/commit/bb44776ce506e52a755b3770b1837e25805e742b", "committedDate": "2020-09-14T03:06:34Z", "message": "[CALCITE-4241] Some improvements to metadata query"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg4Mjg0NjYz", "url": "https://github.com/apache/calcite/pull/2146#pullrequestreview-488284663", "createdAt": "2020-09-15T02:46:15Z", "commit": {"oid": "bb44776ce506e52a755b3770b1837e25805e742b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg4MzA3MjAy", "url": "https://github.com/apache/calcite/pull/2146#pullrequestreview-488307202", "createdAt": "2020-09-15T04:05:36Z", "commit": {"oid": "bb44776ce506e52a755b3770b1837e25805e742b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3334, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}