{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzc0Njg3MDYw", "number": 1800, "title": "[CALCITE-3790] Make the url() of Sources.of(file) available", "bodyText": "When a FileSource is constructed with only a File object, its URL is left null. This makes it inconvenient for some scenarios where a valid URL is required.\nThis can be resolved, as each file in the local file system corresponds to a file URL, and we fix it by converting a file object to a file URL.", "createdAt": "2020-02-13T06:06:08Z", "url": "https://github.com/apache/calcite/pull/1800", "merged": true, "mergeCommit": {"oid": "fbfb58ebf68c07e15eb5e99b425d113fd3daa451"}, "closed": true, "closedAt": "2020-04-17T15:27:48Z", "author": {"login": "liyafan82"}, "timelineItems": {"totalCount": 22, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcD1Dq9ABqjMwMzM1OTgwNjE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcYjAQGgBqjMyNDQ4ODg0ODY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "fce7059e89df4f96e56995b54ab423cd9e8f1bd3", "author": {"user": {"login": "liyafan82", "name": null}}, "url": "https://github.com/apache/calcite/commit/fce7059e89df4f96e56995b54ab423cd9e8f1bd3", "committedDate": "2020-02-13T06:02:36Z", "message": "[CALCITE-3790] Make the URL of FileSource available"}, "afterCommit": {"oid": "2eda0f98a2fd59bbf8609867a387c08b0e9a865d", "author": {"user": {"login": "liyafan82", "name": null}}, "url": "https://github.com/apache/calcite/commit/2eda0f98a2fd59bbf8609867a387c08b0e9a865d", "committedDate": "2020-02-13T06:36:22Z", "message": "[CALCITE-3790] Make the URL of FileSource available"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5MjA2MzE4", "url": "https://github.com/apache/calcite/pull/1800#pullrequestreview-359206318", "createdAt": "2020-02-14T20:40:01Z", "commit": {"oid": "2eda0f98a2fd59bbf8609867a387c08b0e9a865d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5MjM5NDQ1", "url": "https://github.com/apache/calcite/pull/1800#pullrequestreview-359239445", "createdAt": "2020-02-14T21:49:28Z", "commit": {"oid": "2eda0f98a2fd59bbf8609867a387c08b0e9a865d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQyMTo0OToyOVrOFqEpvA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQyMTo0OToyOVrOFqEpvA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTY2MDczMg==", "bodyText": "This seems to impact #toString() output :-/", "url": "https://github.com/apache/calcite/pull/1800#discussion_r379660732", "createdAt": "2020-02-14T21:49:29Z", "author": {"login": "vlsi"}, "path": "core/src/main/java/org/apache/calcite/util/Sources.java", "diffHunk": "@@ -167,7 +167,7 @@ private FileSource(URL url) {\n \n     private FileSource(File file) {\n       this.file = Objects.requireNonNull(file);\n-      this.url = null;\n+      this.url = fileToUrl(file);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2eda0f98a2fd59bbf8609867a387c08b0e9a865d"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5MjQwMDY0", "url": "https://github.com/apache/calcite/pull/1800#pullrequestreview-359240064", "createdAt": "2020-02-14T21:50:53Z", "commit": {"oid": "2eda0f98a2fd59bbf8609867a387c08b0e9a865d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQyMTo1MDo1M1rOFqErpg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQyMTo1MDo1M1rOFqErpg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTY2MTIyMg==", "bodyText": "Please don't do that. It would be extremely hard to understand the nature of the failure if that assert fails in CI.\nPlease use the appropriate methods, and add messages so the failure is easy to understand by looking at CI output.", "url": "https://github.com/apache/calcite/pull/1800#discussion_r379661222", "createdAt": "2020-02-14T21:50:53Z", "author": {"login": "vlsi"}, "path": "core/src/test/java/org/apache/calcite/util/SourceTest.java", "diffHunk": "@@ -67,12 +70,27 @@ private static String getRootPrefix() {\n     }\n   }\n \n+  @Test public void testFileToUrl() throws URISyntaxException {\n+    final String path = \"abc.txt\";\n+    Source fileSource = file(null, path);\n+    URL url = fileSource.url();\n+\n+    assertFalse(url == null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2eda0f98a2fd59bbf8609867a387c08b0e9a865d"}, "originalPosition": 26}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5MjQwMjA1", "url": "https://github.com/apache/calcite/pull/1800#pullrequestreview-359240205", "createdAt": "2020-02-14T21:51:15Z", "commit": {"oid": "2eda0f98a2fd59bbf8609867a387c08b0e9a865d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQyMTo1MToxNVrOFqEsGw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQyMTo1MToxNVrOFqEsGw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTY2MTMzOQ==", "bodyText": "Please add the relevant message to clarify why you expect one thing to be equal to another thing.", "url": "https://github.com/apache/calcite/pull/1800#discussion_r379661339", "createdAt": "2020-02-14T21:51:15Z", "author": {"login": "vlsi"}, "path": "core/src/test/java/org/apache/calcite/util/SourceTest.java", "diffHunk": "@@ -67,12 +70,27 @@ private static String getRootPrefix() {\n     }\n   }\n \n+  @Test public void testFileToUrl() throws URISyntaxException {\n+    final String path = \"abc.txt\";\n+    Source fileSource = file(null, path);\n+    URL url = fileSource.url();\n+\n+    assertFalse(url == null);\n+\n+    String urlPath = new File(url.toURI().getPath()).getAbsolutePath();\n+    assertEquals(absolutePath(path), urlPath);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2eda0f98a2fd59bbf8609867a387c08b0e9a865d"}, "originalPosition": 29}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5MjQxMjUw", "url": "https://github.com/apache/calcite/pull/1800#pullrequestreview-359241250", "createdAt": "2020-02-14T21:53:34Z", "commit": {"oid": "2eda0f98a2fd59bbf8609867a387c08b0e9a865d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQyMTo1MzozNFrOFqEvVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0xNFQyMTo1MzozNFrOFqEvVg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTY2MjE2Ng==", "bodyText": "This looks like a behavior change. Can you please clarify what is produced in the output?\nCan you please clarify why the append of two relative paths becomes an absolute? It does look weird.", "url": "https://github.com/apache/calcite/pull/1800#discussion_r379662166", "createdAt": "2020-02-14T21:53:34Z", "author": {"login": "vlsi"}, "path": "core/src/test/java/org/apache/calcite/util/SourceTest.java", "diffHunk": "@@ -67,12 +70,27 @@ private static String getRootPrefix() {\n     }\n   }\n \n+  @Test public void testFileToUrl() throws URISyntaxException {\n+    final String path = \"abc.txt\";\n+    Source fileSource = file(null, path);\n+    URL url = fileSource.url();\n+\n+    assertFalse(url == null);\n+\n+    String urlPath = new File(url.toURI().getPath()).getAbsolutePath();\n+    assertEquals(absolutePath(path), urlPath);\n+  }\n+\n+  private String absolutePath(String relativePath) {\n+    return new File(relativePath).getAbsolutePath();\n+  }\n+\n   @Test public void testAppendWithSpaces() {\n     String fooRelative = \"fo o+\";\n     String fooAbsolute = ROOT_PREFIX + \"fo o+\";\n     String barRelative = \"b ar+\";\n     String barAbsolute = ROOT_PREFIX + \"b ar+\";\n-    assertAppend(file(null, fooRelative), file(null, barRelative), \"fo o+/b ar+\");\n+    assertAppend(file(null, fooRelative), file(null, barRelative), absolutePath(\"fo o+/b ar+\"));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2eda0f98a2fd59bbf8609867a387c08b0e9a865d"}, "originalPosition": 42}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "19ed68973d50a9da17e19169a317034aabbf5477", "author": {"user": {"login": "liyafan82", "name": null}}, "url": "https://github.com/apache/calcite/commit/19ed68973d50a9da17e19169a317034aabbf5477", "committedDate": "2020-02-17T11:48:33Z", "message": "[CALCITE-3790] Revise test cases"}, "afterCommit": {"oid": "ed10d42ce3373741e799e5b1e7f167d93a2cc84e", "author": {"user": {"login": "liyafan82", "name": null}}, "url": "https://github.com/apache/calcite/commit/ed10d42ce3373741e799e5b1e7f167d93a2cc84e", "committedDate": "2020-02-17T12:04:48Z", "message": "[CALCITE-3790] Revise test cases"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0NDc4NTMz", "url": "https://github.com/apache/calcite/pull/1800#pullrequestreview-384478533", "createdAt": "2020-03-31T07:46:28Z", "commit": {"oid": "bfc8008c88018d5f7395dd6cdb1b27102c181aad"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQwNzo0NjoyOFrOF-JOtg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQwNzo0NjoyOFrOF-JOtg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDcwNzI1NA==", "bodyText": "Why do you omit SecurityException e in the caused by chain?", "url": "https://github.com/apache/calcite/pull/1800#discussion_r400707254", "createdAt": "2020-03-31T07:46:28Z", "author": {"login": "vlsi"}, "path": "core/src/main/java/org/apache/calcite/util/Sources.java", "diffHunk": "@@ -189,14 +196,25 @@ private static File urlToFile(URL url) {\n       return Paths.get(uri).toFile();\n     }\n \n+    private static URL fileToUrl(File file) {\n+      URI uri;\n+      try {\n+        uri = file.toURI();\n+      } catch (SecurityException e) {\n+        throw new IllegalArgumentException(\"No access to the underlying file \" + file.getPath());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bfc8008c88018d5f7395dd6cdb1b27102c181aad"}, "originalPosition": 41}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0NDgyMDY5", "url": "https://github.com/apache/calcite/pull/1800#pullrequestreview-384482069", "createdAt": "2020-03-31T07:51:31Z", "commit": {"oid": "bfc8008c88018d5f7395dd6cdb1b27102c181aad"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQwNzo1MTozMlrOF-JZqA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQwNzo1MTozMlrOF-JZqA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDcxMDA1Ng==", "bodyText": "What does this mean?\nCould you please remove == null from within assert call?", "url": "https://github.com/apache/calcite/pull/1800#discussion_r400710056", "createdAt": "2020-03-31T07:51:32Z", "author": {"login": "vlsi"}, "path": "core/src/test/java/org/apache/calcite/util/SourceTest.java", "diffHunk": "@@ -67,6 +70,19 @@ private static String getRootPrefix() {\n     }\n   }\n \n+  @Test public void testFileToUrl() throws URISyntaxException {\n+    final String path = \"abc.txt\";\n+    Source fileSource = file(null, path);\n+    URL url = fileSource.url();\n+\n+    assertFalse(url == null, \"No url generated for file source\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bfc8008c88018d5f7395dd6cdb1b27102c181aad"}, "originalPosition": 26}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzg0NDgyNjI2", "url": "https://github.com/apache/calcite/pull/1800#pullrequestreview-384482626", "createdAt": "2020-03-31T07:52:17Z", "commit": {"oid": "bfc8008c88018d5f7395dd6cdb1b27102c181aad"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQwNzo1MjoxN1rOF-JbZg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0zMVQwNzo1MjoxN1rOF-JbZg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDcxMDUwMg==", "bodyText": "Does this support filenames with spaces?", "url": "https://github.com/apache/calcite/pull/1800#discussion_r400710502", "createdAt": "2020-03-31T07:52:17Z", "author": {"login": "vlsi"}, "path": "core/src/test/java/org/apache/calcite/util/SourceTest.java", "diffHunk": "@@ -67,6 +70,19 @@ private static String getRootPrefix() {\n     }\n   }\n \n+  @Test public void testFileToUrl() throws URISyntaxException {\n+    final String path = \"abc.txt\";\n+    Source fileSource = file(null, path);\n+    URL url = fileSource.url();\n+\n+    assertFalse(url == null, \"No url generated for file source\");\n+\n+    // convert the url back to a file, and assert they are identical.\n+    File urlFile = new File(url.toURI().getPath());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bfc8008c88018d5f7395dd6cdb1b27102c181aad"}, "originalPosition": 29}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "f0e6649c9335eda253f08e06fb79c7ef5764ba84", "author": {"user": {"login": "liyafan82", "name": null}}, "url": "https://github.com/apache/calcite/commit/f0e6649c9335eda253f08e06fb79c7ef5764ba84", "committedDate": "2020-03-31T10:02:25Z", "message": "[CALCITE-3790] Resolve comments by adjusting the test case"}, "afterCommit": {"oid": "6c98492725209cef1a66c5e48d5c5bc48ad4307f", "author": {"user": {"login": "liyafan82", "name": null}}, "url": "https://github.com/apache/calcite/commit/6c98492725209cef1a66c5e48d5c5bc48ad4307f", "committedDate": "2020-04-13T02:21:58Z", "message": "[CALCITE-3790] Resolve comments by adjusting the test case"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk0NDA3NzM3", "url": "https://github.com/apache/calcite/pull/1800#pullrequestreview-394407737", "createdAt": "2020-04-16T08:27:20Z", "commit": {"oid": "6c98492725209cef1a66c5e48d5c5bc48ad4307f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQwODoyNzoyMFrOGGaPAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQwODoyNzoyMFrOGGaPAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTM3NDQ2Nw==", "bodyText": "I wonder if it should have something like\n      String filePath = file.getPath();\n      if (!file.isAbsolute()) {\n        if (File.separatorChar != '/') {\n          filePath = filePath.replace(File.separatorChar, '/');\n        }\n        if (file.isDirectory() && !filePath.endsWith(\"/\")) {\n          filePath += \"/\";\n        }\n        try {\n          return new URL(\"file\", null, 0, URLEncoder.encode(filePath, StandardCharsets.UTF_8.name()));\n        } catch (MalformedURLException e) {\n          throw new IllegalArgumentException(\"Unable to create URI for file \" + filePath, e);\n        } catch (UnsupportedEncodingException e) {\n          throw new IllegalArgumentException(\"UTF-8 is not found\", e);\n        }\n      }\nThen implementation would handle both relative and absolute files symmetrically.\nIn other words, for the relative file it would produce something like file:abc%20def.txt which is in line with FileSource(URL).", "url": "https://github.com/apache/calcite/pull/1800#discussion_r409374467", "createdAt": "2020-04-16T08:27:20Z", "author": {"login": "vlsi"}, "path": "core/src/main/java/org/apache/calcite/util/Sources.java", "diffHunk": "@@ -189,14 +196,25 @@ private static File urlToFile(URL url) {\n       return Paths.get(uri).toFile();\n     }\n \n+    private static URL fileToUrl(File file) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6c98492725209cef1a66c5e48d5c5bc48ad4307f"}, "originalPosition": 36}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "c1d9e975716ba43a21a283444b91a162d77838df", "author": {"user": {"login": "liyafan82", "name": null}}, "url": "https://github.com/apache/calcite/commit/c1d9e975716ba43a21a283444b91a162d77838df", "committedDate": "2020-04-16T12:42:34Z", "message": "[CALCITE-3790] Treat relative path specially"}, "afterCommit": {"oid": "9d2998d6f77974afe140232cd384ba253ff5045d", "author": {"user": {"login": "liyafan82", "name": null}}, "url": "https://github.com/apache/calcite/commit/9d2998d6f77974afe140232cd384ba253ff5045d", "committedDate": "2020-04-16T12:44:14Z", "message": "[CALCITE-3790] Treat relative path specially"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9d2998d6f77974afe140232cd384ba253ff5045d", "author": {"user": {"login": "liyafan82", "name": null}}, "url": "https://github.com/apache/calcite/commit/9d2998d6f77974afe140232cd384ba253ff5045d", "committedDate": "2020-04-16T12:44:14Z", "message": "[CALCITE-3790] Treat relative path specially"}, "afterCommit": {"oid": "144a44b74ee5ace218f3295249d10a6c6d7be441", "author": {"user": {"login": "liyafan82", "name": null}}, "url": "https://github.com/apache/calcite/commit/144a44b74ee5ace218f3295249d10a6c6d7be441", "committedDate": "2020-04-16T12:45:52Z", "message": "[CALCITE-3790] Treat relative path specially"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk0NjAwMTQw", "url": "https://github.com/apache/calcite/pull/1800#pullrequestreview-394600140", "createdAt": "2020-04-16T12:52:06Z", "commit": {"oid": "144a44b74ee5ace218f3295249d10a6c6d7be441"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxMjo1MjowNlrOGGjwkw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxMjo1MjowNlrOGGjwkw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTUzMDUxNQ==", "bodyText": "Would you please remove else?\nIt is not really required as if branch either returns or throws.", "url": "https://github.com/apache/calcite/pull/1800#discussion_r409530515", "createdAt": "2020-04-16T12:52:06Z", "author": {"login": "vlsi"}, "path": "core/src/main/java/org/apache/calcite/util/Sources.java", "diffHunk": "@@ -189,14 +198,43 @@ private static File urlToFile(URL url) {\n       return Paths.get(uri).toFile();\n     }\n \n+    private static URL fileToUrl(File file) {\n+      String filePath = file.getPath();\n+      if (!file.isAbsolute()) {\n+        // convert relative file paths\n+        if (File.separatorChar != '/') {\n+          filePath = filePath.replace(File.separatorChar, '/');\n+        }\n+        if (file.isDirectory() && !filePath.endsWith(\"/\")) {\n+          filePath += \"/\";\n+        }\n+        try {\n+          return new URL(\n+              \"file\", null, 0, URLEncoder.encode(filePath, StandardCharsets.UTF_8.name()));\n+        } catch (MalformedURLException e) {\n+          throw new IllegalArgumentException(\"Unable to create URI for file \" + filePath, e);\n+        } catch (UnsupportedEncodingException e) {\n+          throw new IllegalArgumentException(\"UTF-8 is not supported\", e);\n+        }\n+      } else {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "144a44b74ee5ace218f3295249d10a6c6d7be441"}, "originalPosition": 67}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk0NjAwOTU0", "url": "https://github.com/apache/calcite/pull/1800#pullrequestreview-394600954", "createdAt": "2020-04-16T12:53:07Z", "commit": {"oid": "144a44b74ee5ace218f3295249d10a6c6d7be441"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxMjo1MzowN1rOGGjzFQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxMjo1MzowN1rOGGjzFQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTUzMTE1Nw==", "bodyText": "Would you please use literal for the expected value? It would make the expected value easier to understand when reading the code.", "url": "https://github.com/apache/calcite/pull/1800#discussion_r409531157", "createdAt": "2020-04-16T12:53:07Z", "author": {"login": "vlsi"}, "path": "core/src/test/java/org/apache/calcite/util/SourceTest.java", "diffHunk": "@@ -67,6 +72,32 @@ private static String getRootPrefix() {\n     }\n   }\n \n+  @Test void testRelativeFileToUrl() throws UnsupportedEncodingException {\n+    // a file path with space\n+    final String path = \"abc def.txt\";\n+    Source fileSource = file(null, path);\n+    URL url = fileSource.url();\n+\n+    assertNotNull(url, \"No url generated for file source\");\n+\n+    String expected = \"file:\" + URLEncoder.encode(path, StandardCharsets.UTF_8.name());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "144a44b74ee5ace218f3295249d10a6c6d7be441"}, "originalPosition": 31}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk1MzQ4NjA4", "url": "https://github.com/apache/calcite/pull/1800#pullrequestreview-395348608", "createdAt": "2020-04-17T10:41:51Z", "commit": {"oid": "20cf28ae30f5f17396f8e26aeb9f09b22d3b2606"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QxMDo0MTo1MVrOGHJE9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xN1QxMDo0MTo1MVrOGHJE9Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDE0MTk0MQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                      throw new IllegalArgumentException(\"Unable to create URI for file \" + filePath, e);\n          \n          \n            \n                      throw new IllegalArgumentException(\"Unable to create URL for file \" + filePath, e);\n          \n      \n    \n    \n  \n\nsorry for nit-picking :-/", "url": "https://github.com/apache/calcite/pull/1800#discussion_r410141941", "createdAt": "2020-04-17T10:41:51Z", "author": {"login": "vlsi"}, "path": "core/src/main/java/org/apache/calcite/util/Sources.java", "diffHunk": "@@ -189,14 +198,43 @@ private static File urlToFile(URL url) {\n       return Paths.get(uri).toFile();\n     }\n \n+    private static URL fileToUrl(File file) {\n+      String filePath = file.getPath();\n+      if (!file.isAbsolute()) {\n+        // convert relative file paths\n+        if (File.separatorChar != '/') {\n+          filePath = filePath.replace(File.separatorChar, '/');\n+        }\n+        if (file.isDirectory() && !filePath.endsWith(\"/\")) {\n+          filePath += \"/\";\n+        }\n+        try {\n+          return new URL(\n+              \"file\", null, 0, URLEncoder.encode(filePath, StandardCharsets.UTF_8.name()));\n+        } catch (MalformedURLException e) {\n+          throw new IllegalArgumentException(\"Unable to create URI for file \" + filePath, e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "20cf28ae30f5f17396f8e26aeb9f09b22d3b2606"}, "originalPosition": 63}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "20cf28ae30f5f17396f8e26aeb9f09b22d3b2606", "author": {"user": {"login": "liyafan82", "name": null}}, "url": "https://github.com/apache/calcite/commit/20cf28ae30f5f17396f8e26aeb9f09b22d3b2606", "committedDate": "2020-04-17T10:36:24Z", "message": "[CALCITE-3790] Resolve comments"}, "afterCommit": {"oid": "a40fa852a734d1ef0aca9ff5bfa195ba9b38678d", "author": {"user": {"login": "liyafan82", "name": null}}, "url": "https://github.com/apache/calcite/commit/a40fa852a734d1ef0aca9ff5bfa195ba9b38678d", "committedDate": "2020-04-17T10:44:19Z", "message": "[CALCITE-3790] Resolve comments"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5ec9019581879c406d50186342c993be72d24725", "author": {"user": {"login": "vlsi", "name": "Vladimir Sitnikov"}}, "url": "https://github.com/apache/calcite/commit/5ec9019581879c406d50186342c993be72d24725", "committedDate": "2020-04-17T15:03:30Z", "message": "slashify"}, "afterCommit": {"oid": "677d8b77638483a379d9479e06352806ae9b9f86", "author": {"user": {"login": "liyafan82", "name": null}}, "url": "https://github.com/apache/calcite/commit/677d8b77638483a379d9479e06352806ae9b9f86", "committedDate": "2020-04-17T15:23:46Z", "message": "[CALCITE-3790] Make the URL of FileSource available"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "677d8b77638483a379d9479e06352806ae9b9f86", "author": {"user": {"login": "liyafan82", "name": null}}, "url": "https://github.com/apache/calcite/commit/677d8b77638483a379d9479e06352806ae9b9f86", "committedDate": "2020-04-17T15:23:46Z", "message": "[CALCITE-3790] Make the URL of FileSource available"}, "afterCommit": {"oid": "09402d2414874507663d5b2a000a3a5c28061281", "author": {"user": {"login": "liyafan82", "name": null}}, "url": "https://github.com/apache/calcite/commit/09402d2414874507663d5b2a000a3a5c28061281", "committedDate": "2020-04-17T15:25:25Z", "message": "[CALCITE-3790] Make the url() of Sources.of(file) available"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fbfb58ebf68c07e15eb5e99b425d113fd3daa451", "author": {"user": {"login": "liyafan82", "name": null}}, "url": "https://github.com/apache/calcite/commit/fbfb58ebf68c07e15eb5e99b425d113fd3daa451", "committedDate": "2020-04-17T15:26:56Z", "message": "[CALCITE-3790] Make the url() of Sources.of(file) available"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "09402d2414874507663d5b2a000a3a5c28061281", "author": {"user": {"login": "liyafan82", "name": null}}, "url": "https://github.com/apache/calcite/commit/09402d2414874507663d5b2a000a3a5c28061281", "committedDate": "2020-04-17T15:25:25Z", "message": "[CALCITE-3790] Make the url() of Sources.of(file) available"}, "afterCommit": {"oid": "fbfb58ebf68c07e15eb5e99b425d113fd3daa451", "author": {"user": {"login": "liyafan82", "name": null}}, "url": "https://github.com/apache/calcite/commit/fbfb58ebf68c07e15eb5e99b425d113fd3daa451", "committedDate": "2020-04-17T15:26:56Z", "message": "[CALCITE-3790] Make the url() of Sources.of(file) available"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4246, "cost": 1, "resetAt": "2021-10-28T16:48:13Z"}}}