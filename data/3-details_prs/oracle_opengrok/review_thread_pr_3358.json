{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE1NDE2MDc5", "number": 3358, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQyMTo0MTo1MlrOE1aDqg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQxMDo1Mzo1MlrOE1mjdA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI0NDM2OTA2OnYy", "diffSide": "RIGHT", "path": "opengrok-tools/src/main/python/opengrok_tools/utils/restful.py", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQyMTo0MTo1MlrOHtqtEg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQxMDo0NzoyOFrOHt9mRw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzY0NzYzNA==", "bodyText": "this is usually done at the top of the file (like global variable)", "url": "https://github.com/oracle/opengrok/pull/3358#discussion_r517647634", "createdAt": "2020-11-04T21:41:52Z", "author": {"login": "tulinkry"}, "path": "opengrok-tools/src/main/python/opengrok_tools/utils/restful.py", "diffHunk": "@@ -38,14 +38,24 @@ def do_api_call(verb, uri, params=None, headers=None, data=None):\n     if handler is None or not callable(handler):\n         raise Exception('Unknown HTTP verb: {}'.format(verb))\n \n-    return handler(\n+    logger = logging.getLogger(__name__)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9e13c0f9a52f504e4fdf59be1816630198804136"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzk1NzE5MQ==", "bodyText": "will fix", "url": "https://github.com/oracle/opengrok/pull/3358#discussion_r517957191", "createdAt": "2020-11-05T10:47:28Z", "author": {"login": "vladak"}, "path": "opengrok-tools/src/main/python/opengrok_tools/utils/restful.py", "diffHunk": "@@ -38,14 +38,24 @@ def do_api_call(verb, uri, params=None, headers=None, data=None):\n     if handler is None or not callable(handler):\n         raise Exception('Unknown HTTP verb: {}'.format(verb))\n \n-    return handler(\n+    logger = logging.getLogger(__name__)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzY0NzYzNA=="}, "originalCommit": {"oid": "9e13c0f9a52f504e4fdf59be1816630198804136"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI0NDU4MTgwOnYy", "diffSide": "RIGHT", "path": "opengrok-tools/src/main/python/opengrok_tools/utils/restful.py", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQyMjo1NzowOFrOHtss8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQxMDo0Nzo1NFrOHt9nXg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzY4MDM3MA==", "bodyText": "you don't know the call failed at this point", "url": "https://github.com/oracle/opengrok/pull/3358#discussion_r517680370", "createdAt": "2020-11-04T22:57:08Z", "author": {"login": "tulinkry"}, "path": "opengrok-tools/src/main/python/opengrok_tools/utils/restful.py", "diffHunk": "@@ -38,14 +38,24 @@ def do_api_call(verb, uri, params=None, headers=None, data=None):\n     if handler is None or not callable(handler):\n         raise Exception('Unknown HTTP verb: {}'.format(verb))\n \n-    return handler(\n+    logger = logging.getLogger(__name__)\n+\n+    logger.debug(\"{} API call: {} with data '{}' and headers: {}\".\n+                 format(verb, uri, data, headers))\n+    r = handler(\n         uri,\n         data=data,\n         params=params,\n         headers=headers,\n         proxies=get_proxies(uri)\n     )\n \n+    if r is not None:\n+        logger.error(\"API call failed: {}\".format(r))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9e13c0f9a52f504e4fdf59be1816630198804136"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzY4MDgyMQ==", "bodyText": "is the logging necessary here? if you throw the exception you kinda expect someone else to handle it (and log it perhaps)", "url": "https://github.com/oracle/opengrok/pull/3358#discussion_r517680821", "createdAt": "2020-11-04T22:58:17Z", "author": {"login": "tulinkry"}, "path": "opengrok-tools/src/main/python/opengrok_tools/utils/restful.py", "diffHunk": "@@ -38,14 +38,24 @@ def do_api_call(verb, uri, params=None, headers=None, data=None):\n     if handler is None or not callable(handler):\n         raise Exception('Unknown HTTP verb: {}'.format(verb))\n \n-    return handler(\n+    logger = logging.getLogger(__name__)\n+\n+    logger.debug(\"{} API call: {} with data '{}' and headers: {}\".\n+                 format(verb, uri, data, headers))\n+    r = handler(\n         uri,\n         data=data,\n         params=params,\n         headers=headers,\n         proxies=get_proxies(uri)\n     )\n \n+    if r is not None:\n+        logger.error(\"API call failed: {}\".format(r))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzY4MDM3MA=="}, "originalCommit": {"oid": "9e13c0f9a52f504e4fdf59be1816630198804136"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzk1NzQ3MA==", "bodyText": "true, removed", "url": "https://github.com/oracle/opengrok/pull/3358#discussion_r517957470", "createdAt": "2020-11-05T10:47:54Z", "author": {"login": "vladak"}, "path": "opengrok-tools/src/main/python/opengrok_tools/utils/restful.py", "diffHunk": "@@ -38,14 +38,24 @@ def do_api_call(verb, uri, params=None, headers=None, data=None):\n     if handler is None or not callable(handler):\n         raise Exception('Unknown HTTP verb: {}'.format(verb))\n \n-    return handler(\n+    logger = logging.getLogger(__name__)\n+\n+    logger.debug(\"{} API call: {} with data '{}' and headers: {}\".\n+                 format(verb, uri, data, headers))\n+    r = handler(\n         uri,\n         data=data,\n         params=params,\n         headers=headers,\n         proxies=get_proxies(uri)\n     )\n \n+    if r is not None:\n+        logger.error(\"API call failed: {}\".format(r))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzY4MDM3MA=="}, "originalCommit": {"oid": "9e13c0f9a52f504e4fdf59be1816630198804136"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI0NDU4MzI0OnYy", "diffSide": "RIGHT", "path": "opengrok-tools/src/main/python/opengrok_tools/utils/restful.py", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQyMjo1NzozOVrOHtstzg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQxMDo1OTowNlrOHt-BXA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzY4MDU5MA==", "bodyText": "I'd interpret this behavior to the doc string (exception on failed requests)", "url": "https://github.com/oracle/opengrok/pull/3358#discussion_r517680590", "createdAt": "2020-11-04T22:57:39Z", "author": {"login": "tulinkry"}, "path": "opengrok-tools/src/main/python/opengrok_tools/utils/restful.py", "diffHunk": "@@ -38,14 +38,24 @@ def do_api_call(verb, uri, params=None, headers=None, data=None):\n     if handler is None or not callable(handler):\n         raise Exception('Unknown HTTP verb: {}'.format(verb))\n \n-    return handler(\n+    logger = logging.getLogger(__name__)\n+\n+    logger.debug(\"{} API call: {} with data '{}' and headers: {}\".\n+                 format(verb, uri, data, headers))\n+    r = handler(\n         uri,\n         data=data,\n         params=params,\n         headers=headers,\n         proxies=get_proxies(uri)\n     )\n \n+    if r is not None:\n+        logger.error(\"API call failed: {}\".format(r))\n+        r.raise_for_status()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9e13c0f9a52f504e4fdf59be1816630198804136"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzk2NDEyNA==", "bodyText": "added a doc string", "url": "https://github.com/oracle/opengrok/pull/3358#discussion_r517964124", "createdAt": "2020-11-05T10:59:06Z", "author": {"login": "vladak"}, "path": "opengrok-tools/src/main/python/opengrok_tools/utils/restful.py", "diffHunk": "@@ -38,14 +38,24 @@ def do_api_call(verb, uri, params=None, headers=None, data=None):\n     if handler is None or not callable(handler):\n         raise Exception('Unknown HTTP verb: {}'.format(verb))\n \n-    return handler(\n+    logger = logging.getLogger(__name__)\n+\n+    logger.debug(\"{} API call: {} with data '{}' and headers: {}\".\n+                 format(verb, uri, data, headers))\n+    r = handler(\n         uri,\n         data=data,\n         params=params,\n         headers=headers,\n         proxies=get_proxies(uri)\n     )\n \n+    if r is not None:\n+        logger.error(\"API call failed: {}\".format(r))\n+        r.raise_for_status()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzY4MDU5MA=="}, "originalCommit": {"oid": "9e13c0f9a52f504e4fdf59be1816630198804136"}, "originalPosition": 19}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI0NjQxNjUyOnYy", "diffSide": "RIGHT", "path": "opengrok-tools/src/main/python/opengrok_tools/utils/restful.py", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQxMDo1Mzo1MlrOHt91hg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQxMTowMToyMlrOHt-GgA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzk2MTA5NA==", "bodyText": "thinking about it, i don't remember if this can occur with requests, but even if it could occur (r is None) then you should probably raise an exception here instead of passing the None to the caller (like when handler is none)", "url": "https://github.com/oracle/opengrok/pull/3358#discussion_r517961094", "createdAt": "2020-11-05T10:53:52Z", "author": {"login": "tulinkry"}, "path": "opengrok-tools/src/main/python/opengrok_tools/utils/restful.py", "diffHunk": "@@ -34,18 +34,27 @@\n \n \n def do_api_call(verb, uri, params=None, headers=None, data=None):\n+    logger = logging.getLogger(__name__)\n+\n     handler = getattr(requests, verb.lower())\n     if handler is None or not callable(handler):\n         raise Exception('Unknown HTTP verb: {}'.format(verb))\n \n-    return handler(\n+    logger.debug(\"{} API call: {} with data '{}' and headers: {}\".\n+                 format(verb, uri, data, headers))\n+    r = handler(\n         uri,\n         data=data,\n         params=params,\n         headers=headers,\n         proxies=get_proxies(uri)\n     )\n \n+    if r is not None:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f65b7542c52d76128e58d96fcf15e76fd55e3a5"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzk2NTQ0MA==", "bodyText": "makes sense", "url": "https://github.com/oracle/opengrok/pull/3358#discussion_r517965440", "createdAt": "2020-11-05T11:01:22Z", "author": {"login": "vladak"}, "path": "opengrok-tools/src/main/python/opengrok_tools/utils/restful.py", "diffHunk": "@@ -34,18 +34,27 @@\n \n \n def do_api_call(verb, uri, params=None, headers=None, data=None):\n+    logger = logging.getLogger(__name__)\n+\n     handler = getattr(requests, verb.lower())\n     if handler is None or not callable(handler):\n         raise Exception('Unknown HTTP verb: {}'.format(verb))\n \n-    return handler(\n+    logger.debug(\"{} API call: {} with data '{}' and headers: {}\".\n+                 format(verb, uri, data, headers))\n+    r = handler(\n         uri,\n         data=data,\n         params=params,\n         headers=headers,\n         proxies=get_proxies(uri)\n     )\n \n+    if r is not None:", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzk2MTA5NA=="}, "originalCommit": {"oid": "3f65b7542c52d76128e58d96fcf15e76fd55e3a5"}, "originalPosition": 21}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4872, "cost": 1, "resetAt": "2021-11-12T12:57:47Z"}}}