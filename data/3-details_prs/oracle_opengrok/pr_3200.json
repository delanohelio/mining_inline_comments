{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc2NDkwMTUz", "number": 3200, "title": "introduce command timeout types", "bodyText": "This change makes the Executor command timeout more generic. Instead of setting the timeout based on interactivity, there will be 4 types of timeout:\n\nindexer\ninteractive (think webapp through UI)\nwebapp start (think deploy)\nRESTful\n\nEach will be tunable.", "createdAt": "2020-08-31T19:18:31Z", "url": "https://github.com/oracle/opengrok/pull/3200", "merged": true, "mergeCommit": {"oid": "e1b8a728de75efbcf65f25a7169ce99443c144ac"}, "closed": true, "closedAt": "2020-09-17T18:57:03Z", "author": {"login": "vladak"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdEPUn1AH2gAyNDc2NDkwMTUzOmRlNjk4YzRlMDg1MWRkNzAwYjg1MjkzM2VhZjUyOTQ1NDljZTJmMzk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdJ0lWmgH2gAyNDc2NDkwMTUzOjFhMTBjMjRjNGIyNzFlYzFjZjZiZmVlZjE3NDkxYWNjNjFjZTZlODU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "de698c4e0851dd700b852933eaf5294549ce2f39", "author": {"user": {"login": "vladak", "name": "Vladimir Kotal"}}, "url": "https://github.com/oracle/opengrok/commit/de698c4e0851dd700b852933eaf5294549ce2f39", "committedDate": "2020-08-31T09:24:02Z", "message": "introduce CommandTimeoutType\n\nfixes #3146"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2739a693d632219fc9847688d762477095113ba2", "author": {"user": {"login": "vladak", "name": "Vladimir Kotal"}}, "url": "https://github.com/oracle/opengrok/commit/2739a693d632219fc9847688d762477095113ba2", "committedDate": "2020-08-31T18:46:18Z", "message": "report command duration via Statistics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "acb0e685834ecd54cd8e47e665d0b5dd7f0fc471", "author": {"user": {"login": "vladak", "name": "Vladimir Kotal"}}, "url": "https://github.com/oracle/opengrok/commit/acb0e685834ecd54cd8e47e665d0b5dd7f0fc471", "committedDate": "2020-09-02T09:35:08Z", "message": "report index time of files with Level.FINEST"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkwNTgyMjc1", "url": "https://github.com/oracle/opengrok/pull/3200#pullrequestreview-490582275", "createdAt": "2020-09-17T13:18:22Z", "commit": {"oid": "acb0e685834ecd54cd8e47e665d0b5dd7f0fc471"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QxMzoxODoyMlrOHThpjA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QxMzozMzo0NlrOHTidww==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDIzNjMwMA==", "bodyText": "Would not IllegalArgumentException make more sense? InvalidParameterException is from security package and is not that commonly used.", "url": "https://github.com/oracle/opengrok/pull/3200#discussion_r490236300", "createdAt": "2020-09-17T13:18:22Z", "author": {"login": "ahornace"}, "path": "opengrok-indexer/src/main/java/org/opengrok/indexer/configuration/RuntimeEnvironment.java", "diffHunk": "@@ -227,29 +228,59 @@ public void setNestingMaximum(int nestingMaximum) {\n         syncWriteConfiguration(nestingMaximum, Configuration::setNestingMaximum);\n     }\n \n-    public int getCommandTimeout() {\n-        return syncReadConfiguration(Configuration::getCommandTimeout);\n+    public int getCommandTimeout(CommandTimeoutType cmdType) {\n+        switch (cmdType) {\n+            case INDEXER:\n+                return getIndexerCommandTimeout();\n+            case INTERACTIVE:\n+                return getInteractiveCommandTimeout();\n+            case WEBAPP_START:\n+                return getWebappStartCommandTimeout();\n+            case RESTFUL:\n+                return getRestfulCommandTimeout();\n+        }\n+\n+        throw new InvalidParameterException(\"invalid command timeout type\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "acb0e685834ecd54cd8e47e665d0b5dd7f0fc471"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDI0MzE0Mg==", "bodyText": "I know it was like this but since you are touching it, could you please rename to timeStr to follow Java standard?", "url": "https://github.com/oracle/opengrok/pull/3200#discussion_r490243142", "createdAt": "2020-09-17T13:26:34Z", "author": {"login": "ahornace"}, "path": "opengrok-indexer/src/main/java/org/opengrok/indexer/util/Statistics.java", "diffHunk": "@@ -28,28 +28,47 @@\n import static org.opengrok.indexer.util.StringUtils.getReadableTime;\n \n public class Statistics {\n-        \n-  private final long startTime;  \n \n-  public Statistics() {\n+    private final long startTime;\n+\n+    public Statistics() {\n       startTime = System.currentTimeMillis();    \n   }\n \n-  public void report(Logger log, String msg) {\n-      long stopTime = System.currentTimeMillis();\n-      String time_str = StringUtils.getReadableTime(stopTime - startTime);\n-      log.log(Level.INFO, msg + \" (took {0})\", time_str);\n-  }\n+    /**\n+     * log a message along with how much time it took since the constructor was called.\n+     * @param logger logger instance\n+     * @param logLevel log level\n+     * @param msg message string\n+     */\n+    public void report(Logger logger, Level logLevel, String msg) {\n+        long stopTime = System.currentTimeMillis();\n+        String time_str = StringUtils.getReadableTime(stopTime - startTime);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "acb0e685834ecd54cd8e47e665d0b5dd7f0fc471"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDI0OTY2Nw==", "bodyText": "I still prefer using Instant and Duration classes for computing the duration as it is more high level. If you do not, then feel free to ignore.", "url": "https://github.com/oracle/opengrok/pull/3200#discussion_r490249667", "createdAt": "2020-09-17T13:33:46Z", "author": {"login": "ahornace"}, "path": "opengrok-indexer/src/main/java/org/opengrok/indexer/util/Statistics.java", "diffHunk": "@@ -28,28 +28,47 @@\n import static org.opengrok.indexer.util.StringUtils.getReadableTime;\n \n public class Statistics {\n-        \n-  private final long startTime;  \n \n-  public Statistics() {\n+    private final long startTime;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "acb0e685834ecd54cd8e47e665d0b5dd7f0fc471"}, "originalPosition": 8}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "187f4cd872c1fceca95551343bdb2b9a4df4fc52", "author": {"user": {"login": "vladak", "name": "Vladimir Kotal"}}, "url": "https://github.com/oracle/opengrok/commit/187f4cd872c1fceca95551343bdb2b9a4df4fc52", "committedDate": "2020-09-17T15:51:13Z", "message": "rename per review comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e8c53d06676e666d0146465992e0d9111d9fbeb5", "author": {"user": {"login": "vladak", "name": "Vladimir Kotal"}}, "url": "https://github.com/oracle/opengrok/commit/e8c53d06676e666d0146465992e0d9111d9fbeb5", "committedDate": "2020-09-17T15:53:14Z", "message": "use IllegalArgumentException per review comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b08ee2a79de4f1e6f076f2ba617f9aa077ad438f", "author": {"user": {"login": "vladak", "name": "Vladimir Kotal"}}, "url": "https://github.com/oracle/opengrok/commit/b08ee2a79de4f1e6f076f2ba617f9aa077ad438f", "committedDate": "2020-09-17T15:58:18Z", "message": "use Instant/Duration per review comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1a10c24c4b271ec1cf6bfeef17491acc61ce6e85", "author": {"user": {"login": "vladak", "name": "Vladimir Kotal"}}, "url": "https://github.com/oracle/opengrok/commit/1a10c24c4b271ec1cf6bfeef17491acc61ce6e85", "committedDate": "2020-09-17T17:38:25Z", "message": "remove unused import"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 181, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}