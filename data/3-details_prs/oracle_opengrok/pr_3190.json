{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcxNjcxNTg2", "number": 3190, "title": "changes to LdapAttrPlugin", "bodyText": "Seeing failures of LdapAttrPlugin in the log where log entries referenced User object instead of LdapUser object:\n21-Aug-2020 16:31:47.512 WARNING [http-nio-8080-exec-92] opengrok.auth.plugin.LdapAttrPlugin.fillSession empty records or attribute values ou for user User{id=foo@bar.com, username=null, cookieTimestamp=null, timeouted=false, attrs={}}\n\nmade me realize this is the wrong user to log as LdapAttrPlugin deals with LdapUser when getting the attribute.\nWhile at it, I followed IDEA's advice to refactor this part to avoid the else branch.", "createdAt": "2020-08-21T14:35:24Z", "url": "https://github.com/oracle/opengrok/pull/3190", "merged": true, "mergeCommit": {"oid": "d271320effaee8faec700ffb0ac9e05c723db117"}, "closed": true, "closedAt": "2020-09-17T17:18:12Z", "author": {"login": "vladak"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdJy0NZAH2gAyNDcxNjcxNTg2OmViZDE5MmFiZWFlMTFhZTUyNWFkMTU4MjdmYzhkNmJmYTFmMjVhMTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdJzTNxAH2gAyNDcxNjcxNTg2OmUyNTQ0MGM2MmFiNmJlMDNkZjc4ZTQ4YWVlN2Q1MGNmOTkwZjMxNzM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ebd192abeae11ae525ad15827fc8d6bfa1f25a12", "author": {"user": {"login": "vladak", "name": "Vladimir Kotal"}}, "url": "https://github.com/oracle/opengrok/commit/ebd192abeae11ae525ad15827fc8d6bfa1f25a12", "committedDate": "2020-09-17T15:34:50Z", "message": "log the correct user instance"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9243eae152d1c2183b6ef0969787a86cafbf0ac2", "author": {"user": {"login": "vladak", "name": "Vladimir Kotal"}}, "url": "https://github.com/oracle/opengrok/commit/9243eae152d1c2183b6ef0969787a86cafbf0ac2", "committedDate": "2020-09-17T15:39:16Z", "message": "adjust another log message"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "21fb43221482f6d03b249db34082a6c5546b0dbb", "author": {"user": {"login": "vladak", "name": "Vladimir Kotal"}}, "url": "https://github.com/oracle/opengrok/commit/21fb43221482f6d03b249db34082a6c5546b0dbb", "committedDate": "2020-08-21T14:31:56Z", "message": "refactor"}, "afterCommit": {"oid": "9243eae152d1c2183b6ef0969787a86cafbf0ac2", "author": {"user": {"login": "vladak", "name": "Vladimir Kotal"}}, "url": "https://github.com/oracle/opengrok/commit/9243eae152d1c2183b6ef0969787a86cafbf0ac2", "committedDate": "2020-09-17T15:39:16Z", "message": "adjust another log message"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "48d37e9321282e86ddbe50b9f9c4d23d9447fc87", "author": {"user": {"login": "vladak", "name": "Vladimir Kotal"}}, "url": "https://github.com/oracle/opengrok/commit/48d37e9321282e86ddbe50b9f9c4d23d9447fc87", "committedDate": "2020-09-17T15:42:11Z", "message": "reshuffle variables"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkwNzQ2MDYy", "url": "https://github.com/oracle/opengrok/pull/3190#pullrequestreview-490746062", "createdAt": "2020-09-17T15:55:12Z", "commit": {"oid": "48d37e9321282e86ddbe50b9f9c4d23d9447fc87"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QxNTo1NToxMlrOHTpWRw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QxNTo1NToxMlrOHTpWRw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDM2MjQzOQ==", "bodyText": "I think it looks better like this:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    LdapUser ldapUser;\n          \n          \n            \n                    if ((ldapUser = (LdapUser) req.getSession().\n          \n          \n            \n                            getAttribute(LdapUserPlugin.getSessionAttrName(ldapUserInstance))) == null) {\n          \n          \n            \n                    LdapUser ldapUser = (LdapUser) req.getSession().                getAttribute(LdapUserPlugin.getSessionAttrName(ldapUserInstance));\n          \n          \n            \n                    if (ldapUser == null) {", "url": "https://github.com/oracle/opengrok/pull/3190#discussion_r490362439", "createdAt": "2020-09-17T15:55:12Z", "author": {"login": "ahornace"}, "path": "plugins/src/main/java/opengrok/auth/plugin/LdapAttrPlugin.java", "diffHunk": "@@ -126,13 +126,9 @@ String getSessionAllowedAttrName() {\n \n     @Override\n     public void fillSession(HttpServletRequest req, User user) {\n-        boolean sessionAllowed;\n-        LdapUser ldapUser;\n-        Map<String, Set<String>> records = null;\n-        Set<String> attributeValues;\n-\n         updateSession(req, false);\n \n+        LdapUser ldapUser;\n         if ((ldapUser = (LdapUser) req.getSession().\n                 getAttribute(LdapUserPlugin.getSessionAttrName(ldapUserInstance))) == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "48d37e9321282e86ddbe50b9f9c4d23d9447fc87"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "413791cd06eb5d74b548ed3cd217628fa6b74ded", "author": {"user": {"login": "vladak", "name": "Vladimir Kotal"}}, "url": "https://github.com/oracle/opengrok/commit/413791cd06eb5d74b548ed3cd217628fa6b74ded", "committedDate": "2020-09-17T16:00:02Z", "message": "Update plugins/src/main/java/opengrok/auth/plugin/LdapAttrPlugin.java\r\n\r\naccept review comment\n\nCo-authored-by: Adam Horn\u00e1\u010dek <adam.hornacek@icloud.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDkwNzU2OTA0", "url": "https://github.com/oracle/opengrok/pull/3190#pullrequestreview-490756904", "createdAt": "2020-09-17T16:02:21Z", "commit": {"oid": "413791cd06eb5d74b548ed3cd217628fa6b74ded"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QxNjowMjoyMVrOHTppxA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xN1QxNjowMjoyMVrOHTppxA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDM2NzQyOA==", "bodyText": "I missed the whitespaces :(\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    LdapUser ldapUser = (LdapUser) req.getSession().                getAttribute(LdapUserPlugin.getSessionAttrName(ldapUserInstance));\n          \n          \n            \n                    LdapUser ldapUser = (LdapUser) req.getSession().getAttribute(LdapUserPlugin.getSessionAttrName(ldapUserInstance));", "url": "https://github.com/oracle/opengrok/pull/3190#discussion_r490367428", "createdAt": "2020-09-17T16:02:21Z", "author": {"login": "ahornace"}, "path": "plugins/src/main/java/opengrok/auth/plugin/LdapAttrPlugin.java", "diffHunk": "@@ -128,9 +128,8 @@ String getSessionAllowedAttrName() {\n     public void fillSession(HttpServletRequest req, User user) {\n         updateSession(req, false);\n \n-        LdapUser ldapUser;\n-        if ((ldapUser = (LdapUser) req.getSession().\n-                getAttribute(LdapUserPlugin.getSessionAttrName(ldapUserInstance))) == null) {\n+        LdapUser ldapUser = (LdapUser) req.getSession().                getAttribute(LdapUserPlugin.getSessionAttrName(ldapUserInstance));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "413791cd06eb5d74b548ed3cd217628fa6b74ded"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e25440c62ab6be03df78e48aee7d50cf990f3173", "author": {"user": {"login": "vladak", "name": "Vladimir Kotal"}}, "url": "https://github.com/oracle/opengrok/commit/e25440c62ab6be03df78e48aee7d50cf990f3173", "committedDate": "2020-09-17T16:08:42Z", "message": "Update plugins/src/main/java/opengrok/auth/plugin/LdapAttrPlugin.java\n\nCo-authored-by: Adam Horn\u00e1\u010dek <adam.hornacek@icloud.com>"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 171, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}