{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE1NDE2MDc5", "number": 3358, "title": "raise exception from do_api_call()", "bodyText": "", "createdAt": "2020-11-04T14:19:47Z", "url": "https://github.com/oracle/opengrok/pull/3358", "merged": true, "mergeCommit": {"oid": "94ba42f5763c628db081e9b04809e87cffbde59b"}, "closed": true, "closedAt": "2020-11-05T12:17:02Z", "author": {"login": "vladak"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdZOfDiAH2gAyNTE1NDE2MDc5OjllMTNjMGY5YTUyZjUwNGU0ZmRmNTliZTE4MTY2MzAxOTg4MDQxMzY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdZgYGvAFqTUyNDE1NDA4Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9e13c0f9a52f504e4fdf59be1816630198804136", "author": {"user": {"login": "vladak", "name": "Vladimir Kotal"}}, "url": "https://github.com/oracle/opengrok/commit/9e13c0f9a52f504e4fdf59be1816630198804136", "committedDate": "2020-11-04T14:17:56Z", "message": "raise exception from do_api_call()\n\nfixes #3356"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIzNzU1OTUw", "url": "https://github.com/oracle/opengrok/pull/3358#pullrequestreview-523755950", "createdAt": "2020-11-04T21:41:52Z", "commit": {"oid": "9e13c0f9a52f504e4fdf59be1816630198804136"}, "state": "COMMENTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQyMTo0MTo1MlrOHtqtEg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNFQyMjo1ODoxN1rOHtsutQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzY0NzYzNA==", "bodyText": "this is usually done at the top of the file (like global variable)", "url": "https://github.com/oracle/opengrok/pull/3358#discussion_r517647634", "createdAt": "2020-11-04T21:41:52Z", "author": {"login": "tulinkry"}, "path": "opengrok-tools/src/main/python/opengrok_tools/utils/restful.py", "diffHunk": "@@ -38,14 +38,24 @@ def do_api_call(verb, uri, params=None, headers=None, data=None):\n     if handler is None or not callable(handler):\n         raise Exception('Unknown HTTP verb: {}'.format(verb))\n \n-    return handler(\n+    logger = logging.getLogger(__name__)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9e13c0f9a52f504e4fdf59be1816630198804136"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzY4MDM3MA==", "bodyText": "you don't know the call failed at this point", "url": "https://github.com/oracle/opengrok/pull/3358#discussion_r517680370", "createdAt": "2020-11-04T22:57:08Z", "author": {"login": "tulinkry"}, "path": "opengrok-tools/src/main/python/opengrok_tools/utils/restful.py", "diffHunk": "@@ -38,14 +38,24 @@ def do_api_call(verb, uri, params=None, headers=None, data=None):\n     if handler is None or not callable(handler):\n         raise Exception('Unknown HTTP verb: {}'.format(verb))\n \n-    return handler(\n+    logger = logging.getLogger(__name__)\n+\n+    logger.debug(\"{} API call: {} with data '{}' and headers: {}\".\n+                 format(verb, uri, data, headers))\n+    r = handler(\n         uri,\n         data=data,\n         params=params,\n         headers=headers,\n         proxies=get_proxies(uri)\n     )\n \n+    if r is not None:\n+        logger.error(\"API call failed: {}\".format(r))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9e13c0f9a52f504e4fdf59be1816630198804136"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzY4MDU5MA==", "bodyText": "I'd interpret this behavior to the doc string (exception on failed requests)", "url": "https://github.com/oracle/opengrok/pull/3358#discussion_r517680590", "createdAt": "2020-11-04T22:57:39Z", "author": {"login": "tulinkry"}, "path": "opengrok-tools/src/main/python/opengrok_tools/utils/restful.py", "diffHunk": "@@ -38,14 +38,24 @@ def do_api_call(verb, uri, params=None, headers=None, data=None):\n     if handler is None or not callable(handler):\n         raise Exception('Unknown HTTP verb: {}'.format(verb))\n \n-    return handler(\n+    logger = logging.getLogger(__name__)\n+\n+    logger.debug(\"{} API call: {} with data '{}' and headers: {}\".\n+                 format(verb, uri, data, headers))\n+    r = handler(\n         uri,\n         data=data,\n         params=params,\n         headers=headers,\n         proxies=get_proxies(uri)\n     )\n \n+    if r is not None:\n+        logger.error(\"API call failed: {}\".format(r))\n+        r.raise_for_status()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9e13c0f9a52f504e4fdf59be1816630198804136"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzY4MDgyMQ==", "bodyText": "is the logging necessary here? if you throw the exception you kinda expect someone else to handle it (and log it perhaps)", "url": "https://github.com/oracle/opengrok/pull/3358#discussion_r517680821", "createdAt": "2020-11-04T22:58:17Z", "author": {"login": "tulinkry"}, "path": "opengrok-tools/src/main/python/opengrok_tools/utils/restful.py", "diffHunk": "@@ -38,14 +38,24 @@ def do_api_call(verb, uri, params=None, headers=None, data=None):\n     if handler is None or not callable(handler):\n         raise Exception('Unknown HTTP verb: {}'.format(verb))\n \n-    return handler(\n+    logger = logging.getLogger(__name__)\n+\n+    logger.debug(\"{} API call: {} with data '{}' and headers: {}\".\n+                 format(verb, uri, data, headers))\n+    r = handler(\n         uri,\n         data=data,\n         params=params,\n         headers=headers,\n         proxies=get_proxies(uri)\n     )\n \n+    if r is not None:\n+        logger.error(\"API call failed: {}\".format(r))", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzY4MDM3MA=="}, "originalCommit": {"oid": "9e13c0f9a52f504e4fdf59be1816630198804136"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ef721794d22deb9c688f232aebb65f4451878152", "author": {"user": {"login": "vladak", "name": "Vladimir Kotal"}}, "url": "https://github.com/oracle/opengrok/commit/ef721794d22deb9c688f232aebb65f4451878152", "committedDate": "2020-11-05T10:47:15Z", "message": "move logger init"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3f65b7542c52d76128e58d96fcf15e76fd55e3a5", "author": {"user": {"login": "vladak", "name": "Vladimir Kotal"}}, "url": "https://github.com/oracle/opengrok/commit/3f65b7542c52d76128e58d96fcf15e76fd55e3a5", "committedDate": "2020-11-05T10:47:59Z", "message": "do not log"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0MTQyODE3", "url": "https://github.com/oracle/opengrok/pull/3358#pullrequestreview-524142817", "createdAt": "2020-11-05T10:53:52Z", "commit": {"oid": "3f65b7542c52d76128e58d96fcf15e76fd55e3a5"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQxMDo1Mzo1MlrOHt91hg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wNVQxMDo1Mzo1MlrOHt91hg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzk2MTA5NA==", "bodyText": "thinking about it, i don't remember if this can occur with requests, but even if it could occur (r is None) then you should probably raise an exception here instead of passing the None to the caller (like when handler is none)", "url": "https://github.com/oracle/opengrok/pull/3358#discussion_r517961094", "createdAt": "2020-11-05T10:53:52Z", "author": {"login": "tulinkry"}, "path": "opengrok-tools/src/main/python/opengrok_tools/utils/restful.py", "diffHunk": "@@ -34,18 +34,27 @@\n \n \n def do_api_call(verb, uri, params=None, headers=None, data=None):\n+    logger = logging.getLogger(__name__)\n+\n     handler = getattr(requests, verb.lower())\n     if handler is None or not callable(handler):\n         raise Exception('Unknown HTTP verb: {}'.format(verb))\n \n-    return handler(\n+    logger.debug(\"{} API call: {} with data '{}' and headers: {}\".\n+                 format(verb, uri, data, headers))\n+    r = handler(\n         uri,\n         data=data,\n         params=params,\n         headers=headers,\n         proxies=get_proxies(uri)\n     )\n \n+    if r is not None:", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3f65b7542c52d76128e58d96fcf15e76fd55e3a5"}, "originalPosition": 21}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e83429d616d53198f1a9b0285e191d14e74578ec", "author": {"user": {"login": "vladak", "name": "Vladimir Kotal"}}, "url": "https://github.com/oracle/opengrok/commit/e83429d616d53198f1a9b0285e191d14e74578ec", "committedDate": "2020-11-05T10:58:27Z", "message": "add doc string"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "126a298638c021b506c64aab155807fa7e08caa1", "author": {"user": {"login": "vladak", "name": "Vladimir Kotal"}}, "url": "https://github.com/oracle/opengrok/commit/126a298638c021b506c64aab155807fa7e08caa1", "committedDate": "2020-11-05T11:01:01Z", "message": "raise when result is None"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI0MTU0MDg2", "url": "https://github.com/oracle/opengrok/pull/3358#pullrequestreview-524154086", "createdAt": "2020-11-05T11:08:38Z", "commit": {"oid": "126a298638c021b506c64aab155807fa7e08caa1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 122, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}