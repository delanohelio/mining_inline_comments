{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM1MjI2NzU2", "number": 3399, "title": "add Indexer option to set API token", "bodyText": "This change adds --token Indexer option to allow setting API tokens in the requests made to the web application.\nOut of the occurrences where requests are made to the web app plugins/src/main/java/opengrok/auth/plugin/util/RestfulClient.java#postIt() was left untouched because it is effectively running in the web app context.\nTested with the isSecure() check commented out in the IncomingFilter and making sure the token matched.", "createdAt": "2020-12-09T14:38:52Z", "url": "https://github.com/oracle/opengrok/pull/3399", "merged": true, "mergeCommit": {"oid": "1f6726aecb7d8a3e3a38bc1535d839b167982f31"}, "closed": true, "closedAt": "2021-02-17T15:53:27Z", "author": {"login": "vladak"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdkfxtsABqjQwOTAyNzUyMjg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABd7CVUoAH2gAyNTM1MjI2NzU2OjQ1MDViMWExNTAyNzY5NDgyNTRlZTE5Nzg4ZDBkOTZiOGExYTI0ZjA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0a51a943bcc0377d08953a7e86545994d01916db", "author": {"user": {"login": "vladak", "name": "Vladimir Kotal"}}, "url": "https://github.com/oracle/opengrok/commit/0a51a943bcc0377d08953a7e86545994d01916db", "committedDate": "2020-12-09T14:24:49Z", "message": "remove unused import"}, "afterCommit": {"oid": "4bede68cb01bfc6e77f3176302006fa3b08e26ef", "author": {"user": {"login": "vladak", "name": "Vladimir Kotal"}}, "url": "https://github.com/oracle/opengrok/commit/4bede68cb01bfc6e77f3176302006fa3b08e26ef", "committedDate": "2020-12-09T14:35:15Z", "message": "add indexer option to specify bearer token for API calls\n\nfixes #3398"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU1Njk4NjAy", "url": "https://github.com/oracle/opengrok/pull/3399#pullrequestreview-555698602", "createdAt": "2020-12-18T17:59:49Z", "commit": {"oid": "ab99f516f796587f10983db7a8d0f6e8ba3d6ec7"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQxNzo1OTo0OVrOIItBMQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xOFQxODowMzoyMlrOIItHzw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTk5NzEwNQ==", "bodyText": "This is mis-ordered and should come after both -T and -t below", "url": "https://github.com/oracle/opengrok/pull/3399#discussion_r545997105", "createdAt": "2020-12-18T17:59:49Z", "author": {"login": "idodeclare"}, "path": "opengrok-indexer/src/main/java/org/opengrok/indexer/index/Indexer.java", "diffHunk": "@@ -756,6 +756,23 @@ public static void main(String[] argv) {\n                     \"stylesheet. The factory-setting is: \\\"default\\\".\").execute(stylePath ->\n                     cfg.setWebappLAF((String) stylePath));\n \n+            parser.on(\"--token\", \"=string|@file_with_string\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ab99f516f796587f10983db7a8d0f6e8ba3d6ec7"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTk5ODc5OQ==", "bodyText": "Is this correct handling w.r.t. the @ sigil?", "url": "https://github.com/oracle/opengrok/pull/3399#discussion_r545998799", "createdAt": "2020-12-18T18:03:22Z", "author": {"login": "idodeclare"}, "path": "opengrok-indexer/src/main/java/org/opengrok/indexer/index/Indexer.java", "diffHunk": "@@ -756,6 +756,23 @@ public static void main(String[] argv) {\n                     \"stylesheet. The factory-setting is: \\\"default\\\".\").execute(stylePath ->\n                     cfg.setWebappLAF((String) stylePath));\n \n+            parser.on(\"--token\", \"=string|@file_with_string\",\n+                    \"Authorization bearer API token to use when making API calls\",\n+                    \"to the web application\").\n+                    execute(optarg -> {\n+                        String value = ((String) optarg).trim();\n+                        if (value.startsWith(\"@\")) {\n+                            try {\n+                                String token = new String(Files.readAllBytes(Path.of(value))).trim();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ab99f516f796587f10983db7a8d0f6e8ba3d6ec7"}, "originalPosition": 11}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0d3a4546a597ec55cb72981775b59d68d55da2e5", "author": {"user": {"login": "vladak", "name": "Vladimir Kotal"}}, "url": "https://github.com/oracle/opengrok/commit/0d3a4546a597ec55cb72981775b59d68d55da2e5", "committedDate": "2021-02-11T08:40:01Z", "message": "add indexer option to specify bearer token for API calls\n\nfixes #3398"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0524b38b1becf4d5af587f641d5bdec97f54aeca", "author": {"user": {"login": "vladak", "name": "Vladimir Kotal"}}, "url": "https://github.com/oracle/opengrok/commit/0524b38b1becf4d5af587f641d5bdec97f54aeca", "committedDate": "2021-02-11T08:40:01Z", "message": "rename getHeaders()"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "de39dfa18ed4ff4770153eb0677dbccc8255dd35", "author": {"user": {"login": "vladak", "name": "Vladimir Kotal"}}, "url": "https://github.com/oracle/opengrok/commit/de39dfa18ed4ff4770153eb0677dbccc8255dd35", "committedDate": "2021-02-11T08:40:36Z", "message": "move --token below -T and -t"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ab99f516f796587f10983db7a8d0f6e8ba3d6ec7", "author": {"user": {"login": "vladak", "name": "Vladimir Kotal"}}, "url": "https://github.com/oracle/opengrok/commit/ab99f516f796587f10983db7a8d0f6e8ba3d6ec7", "committedDate": "2020-12-10T12:26:48Z", "message": "rename getHeaders()"}, "afterCommit": {"oid": "de39dfa18ed4ff4770153eb0677dbccc8255dd35", "author": {"user": {"login": "vladak", "name": "Vladimir Kotal"}}, "url": "https://github.com/oracle/opengrok/commit/de39dfa18ed4ff4770153eb0677dbccc8255dd35", "committedDate": "2021-02-11T08:40:36Z", "message": "move --token below -T and -t"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a70d6110c23217667d02a46db0a429ad2709cfe2", "author": {"user": {"login": "vladak", "name": "Vladimir Kotal"}}, "url": "https://github.com/oracle/opengrok/commit/a70d6110c23217667d02a46db0a429ad2709cfe2", "committedDate": "2021-02-11T10:12:41Z", "message": "read single line, fix the @ handling"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4505b1a150276948254ee19788d0d96b8a1a24f0", "author": {"user": {"login": "vladak", "name": "Vladimir Kotal"}}, "url": "https://github.com/oracle/opengrok/commit/4505b1a150276948254ee19788d0d96b8a1a24f0", "committedDate": "2021-02-17T15:21:52Z", "message": "remove unused import"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 140, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}