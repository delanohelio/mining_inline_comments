{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk3NzQ0OTE3", "number": 3261, "title": "do not call createCache() unnecessarily", "bodyText": "Looking at ensureHistoryCacheExists() to fix the double emitted log message during reindex, it seems that there is some unnecessary logic there. If the history cache was created for the repository in the 1st step of indexing (the existence of the history cache directory should be enough to tell), it should not be necessary to call createCache() again - only for complete failure to create the history cache.\nensureHistoryCacheExists() will probably disappear anyway with the fix for #747.", "createdAt": "2020-10-05T10:14:22Z", "url": "https://github.com/oracle/opengrok/pull/3261", "merged": true, "mergeCommit": {"oid": "f0c7371f520097cb0aa2926cb5e9a202f247bc96"}, "closed": true, "closedAt": "2020-10-08T12:41:49Z", "author": {"login": "vladak"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdPhBxTABqjM4Mzk2NTM2OTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdQgxlsgFqTUwNDczMDcxMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "23a092ad4d9f41dce3c3f3b36bd0caf6acbe21bf", "author": {"user": {"login": "vladak", "name": "Vladimir Kotal"}}, "url": "https://github.com/oracle/opengrok/commit/23a092ad4d9f41dce3c3f3b36bd0caf6acbe21bf", "committedDate": "2020-10-05T10:08:55Z", "message": "do not call createCache() for repositories without history for directories\n\nit cannot create the cache anyway"}, "afterCommit": {"oid": "1e03c471c766ae1b0fdd4455b5b458e9f09d785b", "author": {"user": {"login": "vladak", "name": "Vladimir Kotal"}}, "url": "https://github.com/oracle/opengrok/commit/1e03c471c766ae1b0fdd4455b5b458e9f09d785b", "committedDate": "2020-10-05T10:14:46Z", "message": "do not call createCache() for repositories without history for directories\n\nit cannot create the cache anyway"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyMDgwMzE0", "url": "https://github.com/oracle/opengrok/pull/3261#pullrequestreview-502080314", "createdAt": "2020-10-05T13:54:21Z", "commit": {"oid": "1e03c471c766ae1b0fdd4455b5b458e9f09d785b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxMzo1NDoyMlrOHceKhw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxMzo1NDoyMlrOHceKhw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTYxNjM5MQ==", "bodyText": ":(", "url": "https://github.com/oracle/opengrok/pull/3261#discussion_r499616391", "createdAt": "2020-10-05T13:54:22Z", "author": {"login": "tulinkry"}, "path": "opengrok-indexer/src/main/java/org/opengrok/indexer/history/HistoryGuru.java", "diffHunk": "@@ -731,24 +729,16 @@ public void ensureHistoryCacheExists(File file) throws HistoryException {\n \n         Repository repository = getRepository(file);\n         if (repository == null) {\n-            // no repository -> no history :(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1e03c471c766ae1b0fdd4455b5b458e9f09d785b"}, "originalPosition": 15}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAyMDgyMTcx", "url": "https://github.com/oracle/opengrok/pull/3261#pullrequestreview-502082171", "createdAt": "2020-10-05T13:56:13Z", "commit": {"oid": "1e03c471c766ae1b0fdd4455b5b458e9f09d785b"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxMzo1NjoxM1rOHcePjw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNVQxMzo1NjoxM1rOHcePjw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTYxNzY3OQ==", "bodyText": "but what if it has history but for older revision?", "url": "https://github.com/oracle/opengrok/pull/3261#discussion_r499617679", "createdAt": "2020-10-05T13:56:13Z", "author": {"login": "tulinkry"}, "path": "opengrok-indexer/src/main/java/org/opengrok/indexer/history/HistoryGuru.java", "diffHunk": "@@ -731,24 +729,16 @@ public void ensureHistoryCacheExists(File file) throws HistoryException {\n \n         Repository repository = getRepository(file);\n         if (repository == null) {\n-            // no repository -> no history :(\n+            // no repository -> no history\n             return;\n         }\n \n-        String sinceRevision = null;\n-\n-        if (historyCache.hasCacheForDirectory(file, repository)) {\n-            sinceRevision = historyCache.getLatestCachedRevision(repository);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1e03c471c766ae1b0fdd4455b5b458e9f09d785b"}, "originalPosition": 23}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6b3c2529927408a57727c3cb8a2947d37de764e0", "author": {"user": {"login": "vladak", "name": "Vladimir Kotal"}}, "url": "https://github.com/oracle/opengrok/commit/6b3c2529927408a57727c3cb8a2947d37de764e0", "committedDate": "2020-10-08T07:14:40Z", "message": "be content with just history cache directory in ensureHistoryCacheExists()\n\nfixes #3260"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3a97d4a5d5d253057ccfd98d5d02d56f81b3918a", "author": {"user": {"login": "vladak", "name": "Vladimir Kotal"}}, "url": "https://github.com/oracle/opengrok/commit/3a97d4a5d5d253057ccfd98d5d02d56f81b3918a", "committedDate": "2020-10-08T07:14:40Z", "message": "do not call createCache() for repositories without history for directories\n\nit cannot create the cache anyway"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1e03c471c766ae1b0fdd4455b5b458e9f09d785b", "author": {"user": {"login": "vladak", "name": "Vladimir Kotal"}}, "url": "https://github.com/oracle/opengrok/commit/1e03c471c766ae1b0fdd4455b5b458e9f09d785b", "committedDate": "2020-10-05T10:14:46Z", "message": "do not call createCache() for repositories without history for directories\n\nit cannot create the cache anyway"}, "afterCommit": {"oid": "4bf679eaa7042acf2566e678b8147a0990d24af9", "author": {"user": {"login": "vladak", "name": "Vladimir Kotal"}}, "url": "https://github.com/oracle/opengrok/commit/4bf679eaa7042acf2566e678b8147a0990d24af9", "committedDate": "2020-10-08T07:15:37Z", "message": "ensureHistoryCacheExists() be gone"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5e2ab9607a7f3b6f1646a1f125d9479fb0e3a55a", "author": {"user": {"login": "vladak", "name": "Vladimir Kotal"}}, "url": "https://github.com/oracle/opengrok/commit/5e2ab9607a7f3b6f1646a1f125d9479fb0e3a55a", "committedDate": "2020-10-08T08:34:39Z", "message": "ensureHistoryCacheExists() be gone"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4bf679eaa7042acf2566e678b8147a0990d24af9", "author": {"user": {"login": "vladak", "name": "Vladimir Kotal"}}, "url": "https://github.com/oracle/opengrok/commit/4bf679eaa7042acf2566e678b8147a0990d24af9", "committedDate": "2020-10-08T07:15:37Z", "message": "ensureHistoryCacheExists() be gone"}, "afterCommit": {"oid": "5e2ab9607a7f3b6f1646a1f125d9479fb0e3a55a", "author": {"user": {"login": "vladak", "name": "Vladimir Kotal"}}, "url": "https://github.com/oracle/opengrok/commit/5e2ab9607a7f3b6f1646a1f125d9479fb0e3a55a", "committedDate": "2020-10-08T08:34:39Z", "message": "ensureHistoryCacheExists() be gone"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA0NzMwNzEz", "url": "https://github.com/oracle/opengrok/pull/3261#pullrequestreview-504730713", "createdAt": "2020-10-08T12:31:09Z", "commit": {"oid": "5e2ab9607a7f3b6f1646a1f125d9479fb0e3a55a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 218, "cost": 1, "resetAt": "2021-11-01T15:33:45Z"}}}