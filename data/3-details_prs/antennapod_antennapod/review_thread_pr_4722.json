{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI4ODg4MDE1", "number": 4722, "reviewThreads": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxMDo0NDowM1rOE-mDuw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNy0xMVQwNjo1NTo1N1rOGUgiiw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM0MDcwNzE1OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxMDo0NDowM1rOH71V1w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxNDoyNjowOFrOH79c3A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjUwMTk3NQ==", "bodyText": "Could you please change this to an enum?", "url": "https://github.com/AntennaPod/AntennaPod/pull/4722#discussion_r532501975", "createdAt": "2020-11-30T10:44:03Z", "author": {"login": "ByteHamster"}, "path": "core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java", "diffHunk": "@@ -1465,7 +1464,7 @@ public void onReceive(Context context, Intent intent) {\n             Log.d(TAG, \"Received Auto Connection update: \" + status);\n             if (!isConnectedToCar) {\n                 Log.d(TAG, \"Car was unplugged during playback.\");\n-                pauseIfPauseOnDisconnect();\n+                pauseIfPauseOnDisconnect(\"bluetooth\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d7bfe38bdb8faad213deb6ca8d93f8f6aeb1a9f4"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjYzNDg0NA==", "bodyText": "ready for a review", "url": "https://github.com/AntennaPod/AntennaPod/pull/4722#discussion_r532634844", "createdAt": "2020-11-30T14:26:08Z", "author": {"login": "tonytamsf"}, "path": "core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java", "diffHunk": "@@ -1465,7 +1464,7 @@ public void onReceive(Context context, Intent intent) {\n             Log.d(TAG, \"Received Auto Connection update: \" + status);\n             if (!isConnectedToCar) {\n                 Log.d(TAG, \"Car was unplugged during playback.\");\n-                pauseIfPauseOnDisconnect();\n+                pauseIfPauseOnDisconnect(\"bluetooth\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjUwMTk3NQ=="}, "originalCommit": {"oid": "d7bfe38bdb8faad213deb6ca8d93f8f6aeb1a9f4"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzQ0NzQxNzkxOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QyMjoxNDoyMVrOIK4umw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0zMVQwNjowNTo1MFrOIdFn-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODI4NjEwNw==", "bodyText": "Why does this need to be executed even when the player is not actually paused? I did not try to do it but I could imagine a scenario where the headset is unplugged and plugged in while playing with Bluetooth. It then has  transientPause set to true. When then pausing manually, the flag is still true. Wouldn't re-connecting then assume a wrong state?", "url": "https://github.com/AntennaPod/AntennaPod/pull/4722#discussion_r548286107", "createdAt": "2020-12-23T22:14:21Z", "author": {"login": "ByteHamster"}, "path": "core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java", "diffHunk": "@@ -1534,19 +1538,25 @@ public void onReceive(Context context, Intent intent) {\n         public void onReceive(Context context, Intent intent) {\n             // sound is about to change, eg. bluetooth -> speaker\n             Log.d(TAG, \"Pausing playback because audio is becoming noisy\");\n-            pauseIfPauseOnDisconnect();\n+            pauseIfPauseOnDisconnect(AudioOutputMode.PHONE_SPEAKER);\n         }\n         // android.media.AUDIO_BECOMING_NOISY\n     };\n \n     /**\n      * Pauses playback if PREF_PAUSE_ON_HEADSET_DISCONNECT was set to true.\n      */\n-    private void pauseIfPauseOnDisconnect() {\n-        if (UserPreferences.isPauseOnHeadsetDisconnect() && !isCasting()) {\n-            if (mediaPlayer.getPlayerStatus() == PlayerStatus.PLAYING) {\n-                transientPause = true;\n-            }\n+    private void pauseIfPauseOnDisconnect(AudioOutputMode outputMode) {\n+        Log.d(TAG, \"pauseIfPauseOnDisconnect() \" + outputMode);\n+        // If bluetooth is playing, headset is plugged in, headset unplugged, bluetooth should continue\n+        // If headset is playing, bluetooth is connected, bluetooth is unplugged, headset should continue\n+        // If headset or bluetooth is unplugged (the speaker should not be playing)\n+        if (mediaPlayer.getPlayerStatus() == PlayerStatus.PLAYING) {\n+            transientPause = true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "97f5170b4da4c168922cc6fca10feda7c205b1a0"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDI4MDYyMg==", "bodyText": "@ByteHamster\nPlease go ahead and test it.   I tested your scenario and it works as expected (correctly)\ntransientPause = true is needed because unpauseIfPauseOnDisconnect() will set it to false later and it will be in the right state\nMaybe the code could be done to be more understandable, let me know if you want me to document it better", "url": "https://github.com/AntennaPod/AntennaPod/pull/4722#discussion_r550280622", "createdAt": "2020-12-30T18:06:15Z", "author": {"login": "tonytamsf"}, "path": "core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java", "diffHunk": "@@ -1534,19 +1538,25 @@ public void onReceive(Context context, Intent intent) {\n         public void onReceive(Context context, Intent intent) {\n             // sound is about to change, eg. bluetooth -> speaker\n             Log.d(TAG, \"Pausing playback because audio is becoming noisy\");\n-            pauseIfPauseOnDisconnect();\n+            pauseIfPauseOnDisconnect(AudioOutputMode.PHONE_SPEAKER);\n         }\n         // android.media.AUDIO_BECOMING_NOISY\n     };\n \n     /**\n      * Pauses playback if PREF_PAUSE_ON_HEADSET_DISCONNECT was set to true.\n      */\n-    private void pauseIfPauseOnDisconnect() {\n-        if (UserPreferences.isPauseOnHeadsetDisconnect() && !isCasting()) {\n-            if (mediaPlayer.getPlayerStatus() == PlayerStatus.PLAYING) {\n-                transientPause = true;\n-            }\n+    private void pauseIfPauseOnDisconnect(AudioOutputMode outputMode) {\n+        Log.d(TAG, \"pauseIfPauseOnDisconnect() \" + outputMode);\n+        // If bluetooth is playing, headset is plugged in, headset unplugged, bluetooth should continue\n+        // If headset is playing, bluetooth is connected, bluetooth is unplugged, headset should continue\n+        // If headset or bluetooth is unplugged (the speaker should not be playing)\n+        if (mediaPlayer.getPlayerStatus() == PlayerStatus.PLAYING) {\n+            transientPause = true;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODI4NjEwNw=="}, "originalCommit": {"oid": "97f5170b4da4c168922cc6fca10feda7c205b1a0"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MzMwMDY3OQ==", "bodyText": "Sorry for the late reply. I can confirm that it works but I am still wondering why it is necessary to always set it to true. Is it because the Android system pauses playback automatically and we want it to resume? What would break if the assignment was moved down inside the if statement next to mediaPlayer.pause?", "url": "https://github.com/AntennaPod/AntennaPod/pull/4722#discussion_r563300679", "createdAt": "2021-01-24T14:28:32Z", "author": {"login": "ByteHamster"}, "path": "core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java", "diffHunk": "@@ -1534,19 +1538,25 @@ public void onReceive(Context context, Intent intent) {\n         public void onReceive(Context context, Intent intent) {\n             // sound is about to change, eg. bluetooth -> speaker\n             Log.d(TAG, \"Pausing playback because audio is becoming noisy\");\n-            pauseIfPauseOnDisconnect();\n+            pauseIfPauseOnDisconnect(AudioOutputMode.PHONE_SPEAKER);\n         }\n         // android.media.AUDIO_BECOMING_NOISY\n     };\n \n     /**\n      * Pauses playback if PREF_PAUSE_ON_HEADSET_DISCONNECT was set to true.\n      */\n-    private void pauseIfPauseOnDisconnect() {\n-        if (UserPreferences.isPauseOnHeadsetDisconnect() && !isCasting()) {\n-            if (mediaPlayer.getPlayerStatus() == PlayerStatus.PLAYING) {\n-                transientPause = true;\n-            }\n+    private void pauseIfPauseOnDisconnect(AudioOutputMode outputMode) {\n+        Log.d(TAG, \"pauseIfPauseOnDisconnect() \" + outputMode);\n+        // If bluetooth is playing, headset is plugged in, headset unplugged, bluetooth should continue\n+        // If headset is playing, bluetooth is connected, bluetooth is unplugged, headset should continue\n+        // If headset or bluetooth is unplugged (the speaker should not be playing)\n+        if (mediaPlayer.getPlayerStatus() == PlayerStatus.PLAYING) {\n+            transientPause = true;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODI4NjEwNw=="}, "originalCommit": {"oid": "97f5170b4da4c168922cc6fca10feda7c205b1a0"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NzM3MTc2OA==", "bodyText": "@ByteHamster yup, your suggestion works.", "url": "https://github.com/AntennaPod/AntennaPod/pull/4722#discussion_r567371768", "createdAt": "2021-01-31T06:05:50Z", "author": {"login": "tonytamsf"}, "path": "core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java", "diffHunk": "@@ -1534,19 +1538,25 @@ public void onReceive(Context context, Intent intent) {\n         public void onReceive(Context context, Intent intent) {\n             // sound is about to change, eg. bluetooth -> speaker\n             Log.d(TAG, \"Pausing playback because audio is becoming noisy\");\n-            pauseIfPauseOnDisconnect();\n+            pauseIfPauseOnDisconnect(AudioOutputMode.PHONE_SPEAKER);\n         }\n         // android.media.AUDIO_BECOMING_NOISY\n     };\n \n     /**\n      * Pauses playback if PREF_PAUSE_ON_HEADSET_DISCONNECT was set to true.\n      */\n-    private void pauseIfPauseOnDisconnect() {\n-        if (UserPreferences.isPauseOnHeadsetDisconnect() && !isCasting()) {\n-            if (mediaPlayer.getPlayerStatus() == PlayerStatus.PLAYING) {\n-                transientPause = true;\n-            }\n+    private void pauseIfPauseOnDisconnect(AudioOutputMode outputMode) {\n+        Log.d(TAG, \"pauseIfPauseOnDisconnect() \" + outputMode);\n+        // If bluetooth is playing, headset is plugged in, headset unplugged, bluetooth should continue\n+        // If headset is playing, bluetooth is connected, bluetooth is unplugged, headset should continue\n+        // If headset or bluetooth is unplugged (the speaker should not be playing)\n+        if (mediaPlayer.getPlayerStatus() == PlayerStatus.PLAYING) {\n+            transientPause = true;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODI4NjEwNw=="}, "originalCommit": {"oid": "97f5170b4da4c168922cc6fca10feda7c205b1a0"}, "originalPosition": 67}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzU3NTQxMjA2OnYy", "diffSide": "LEFT", "path": "core/src/main/java/de/danoeh/antennapod/core/service/playback/LocalPSMP.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0zMVQyMjowOToyNFrOIdM9Ng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMi0wMVQwMDoxODoyMFrOIdN-pw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NzQ5MTg5NA==", "bodyText": "Could you please revert this line change to keep the git history clean?", "url": "https://github.com/AntennaPod/AntennaPod/pull/4722#discussion_r567491894", "createdAt": "2021-01-31T22:09:24Z", "author": {"login": "ByteHamster"}, "path": "core/src/main/java/de/danoeh/antennapod/core/service/playback/LocalPSMP.java", "diffHunk": "@@ -299,7 +299,6 @@ public void resume() {\n     private void resumeSync() {\n         if (playerStatus == PlayerStatus.PAUSED || playerStatus == PlayerStatus.PREPARED) {\n             int focusGained = AudioManagerCompat.requestAudioFocus(audioManager, audioFocusRequest);\n-", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "daeb207dbeed0013ff786ee9f8f71d995b43248f"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NzUwODY0Nw==", "bodyText": "done", "url": "https://github.com/AntennaPod/AntennaPod/pull/4722#discussion_r567508647", "createdAt": "2021-02-01T00:18:20Z", "author": {"login": "tonytamsf"}, "path": "core/src/main/java/de/danoeh/antennapod/core/service/playback/LocalPSMP.java", "diffHunk": "@@ -299,7 +299,6 @@ public void resume() {\n     private void resumeSync() {\n         if (playerStatus == PlayerStatus.PAUSED || playerStatus == PlayerStatus.PREPARED) {\n             int focusGained = AudioManagerCompat.requestAudioFocus(audioManager, audioFocusRequest);\n-", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NzQ5MTg5NA=="}, "originalCommit": {"oid": "daeb207dbeed0013ff786ee9f8f71d995b43248f"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzU3NTUwODQ2OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0zMVQyMzo0MzowMlrOIdNsOw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0zMVQyMzo0MzowMlrOIdNsOw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NzUwMzkzMQ==", "bodyText": "Note to reviewer: If there is a phone call, do not unpause", "url": "https://github.com/AntennaPod/AntennaPod/pull/4722#discussion_r567503931", "createdAt": "2021-01-31T23:43:02Z", "author": {"login": "tonytamsf"}, "path": "core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java", "diffHunk": "@@ -1534,27 +1538,31 @@ public void onReceive(Context context, Intent intent) {\n         public void onReceive(Context context, Intent intent) {\n             // sound is about to change, eg. bluetooth -> speaker\n             Log.d(TAG, \"Pausing playback because audio is becoming noisy\");\n-            pauseIfPauseOnDisconnect();\n+            pauseIfPauseOnDisconnect(AudioOutputMode.PHONE_SPEAKER);\n         }\n-        // android.media.AUDIO_BECOMING_NOISY\n     };\n \n     /**\n      * Pauses playback if PREF_PAUSE_ON_HEADSET_DISCONNECT was set to true.\n      */\n-    private void pauseIfPauseOnDisconnect() {\n-        if (UserPreferences.isPauseOnHeadsetDisconnect() && !isCasting()) {\n-            if (mediaPlayer.getPlayerStatus() == PlayerStatus.PLAYING) {\n-                transientPause = true;\n-            }\n-            mediaPlayer.pause(!UserPreferences.isPersistNotify(), true);\n+    private void pauseIfPauseOnDisconnect(AudioOutputMode outputMode) {\n+        Log.d(TAG, \"pauseIfPauseOnDisconnect() \" + outputMode);\n+        if (UserPreferences.isPauseOnHeadsetDisconnect()\n+                && outputMode == AudioOutputMode.PHONE_SPEAKER\n+                && !isCasting()) {\n+            transientPause = true;\n+            mediaPlayer.pause(!UserPreferences.isPersistNotify(), false);\n         }\n     }\n \n     /**\n      * @param bluetooth true if the event for unpausing came from bluetooth\n      */\n     private void unpauseIfPauseOnDisconnect(boolean bluetooth) {\n+        if (mediaPlayer.isAudioChannelInUse()) {\n+            Log.d(TAG, \"unpauseIfPauseOnDisconnect() audio is in use\");\n+            return;\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "daeb207dbeed0013ff786ee9f8f71d995b43248f"}, "originalPosition": 79}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzU3NTUwOTczOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0zMVQyMzo0NDozOVrOIdNs3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0zMVQyMzo0NDozOVrOIdNs3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NzUwNDA5Mw==", "bodyText": "note for reviewer: When headphone is disconnected, and the output is going to the phone speaker, then pause.  This would allow us to continue playing if the output would go to bluetooth", "url": "https://github.com/AntennaPod/AntennaPod/pull/4722#discussion_r567504093", "createdAt": "2021-01-31T23:44:39Z", "author": {"login": "tonytamsf"}, "path": "core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java", "diffHunk": "@@ -1534,27 +1538,31 @@ public void onReceive(Context context, Intent intent) {\n         public void onReceive(Context context, Intent intent) {\n             // sound is about to change, eg. bluetooth -> speaker\n             Log.d(TAG, \"Pausing playback because audio is becoming noisy\");\n-            pauseIfPauseOnDisconnect();\n+            pauseIfPauseOnDisconnect(AudioOutputMode.PHONE_SPEAKER);\n         }\n-        // android.media.AUDIO_BECOMING_NOISY\n     };\n \n     /**\n      * Pauses playback if PREF_PAUSE_ON_HEADSET_DISCONNECT was set to true.\n      */\n-    private void pauseIfPauseOnDisconnect() {\n-        if (UserPreferences.isPauseOnHeadsetDisconnect() && !isCasting()) {\n-            if (mediaPlayer.getPlayerStatus() == PlayerStatus.PLAYING) {\n-                transientPause = true;\n-            }\n-            mediaPlayer.pause(!UserPreferences.isPersistNotify(), true);\n+    private void pauseIfPauseOnDisconnect(AudioOutputMode outputMode) {\n+        Log.d(TAG, \"pauseIfPauseOnDisconnect() \" + outputMode);\n+        if (UserPreferences.isPauseOnHeadsetDisconnect()\n+                && outputMode == AudioOutputMode.PHONE_SPEAKER\n+                && !isCasting()) {\n+            transientPause = true;\n+            mediaPlayer.pause(!UserPreferences.isPersistNotify(), false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "daeb207dbeed0013ff786ee9f8f71d995b43248f"}, "originalPosition": 68}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzU3NTUxMTM3OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0zMVQyMzo0NjoxNVrOIdNtpw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0zMVQyMzo0NjoxNVrOIdNtpw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NzUwNDI5NQ==", "bodyText": "note for reviewer: Switching from true to false would allow us to continue when the headphone is plug back in, when we were streaming when we unpluged", "url": "https://github.com/AntennaPod/AntennaPod/pull/4722#discussion_r567504295", "createdAt": "2021-01-31T23:46:15Z", "author": {"login": "tonytamsf"}, "path": "core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java", "diffHunk": "@@ -1534,27 +1538,31 @@ public void onReceive(Context context, Intent intent) {\n         public void onReceive(Context context, Intent intent) {\n             // sound is about to change, eg. bluetooth -> speaker\n             Log.d(TAG, \"Pausing playback because audio is becoming noisy\");\n-            pauseIfPauseOnDisconnect();\n+            pauseIfPauseOnDisconnect(AudioOutputMode.PHONE_SPEAKER);\n         }\n-        // android.media.AUDIO_BECOMING_NOISY\n     };\n \n     /**\n      * Pauses playback if PREF_PAUSE_ON_HEADSET_DISCONNECT was set to true.\n      */\n-    private void pauseIfPauseOnDisconnect() {\n-        if (UserPreferences.isPauseOnHeadsetDisconnect() && !isCasting()) {\n-            if (mediaPlayer.getPlayerStatus() == PlayerStatus.PLAYING) {\n-                transientPause = true;\n-            }\n-            mediaPlayer.pause(!UserPreferences.isPersistNotify(), true);\n+    private void pauseIfPauseOnDisconnect(AudioOutputMode outputMode) {\n+        Log.d(TAG, \"pauseIfPauseOnDisconnect() \" + outputMode);\n+        if (UserPreferences.isPauseOnHeadsetDisconnect()\n+                && outputMode == AudioOutputMode.PHONE_SPEAKER\n+                && !isCasting()) {\n+            transientPause = true;\n+            mediaPlayer.pause(!UserPreferences.isPersistNotify(), false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "daeb207dbeed0013ff786ee9f8f71d995b43248f"}, "originalPosition": 68}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzgwMDc1MDgxOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackServiceMediaPlayer.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0yNVQxNDozMDo1M1rOI9rJCw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0yNVQxNDozMDo1M1rOI9rJCw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMTU0MDg3NQ==", "bodyText": "How about trying \" Play AntennaPod, unplug headphone, start Phone call, plug in headaphone - podcast should not start.\"\n\nHmm, when doing an actual phone call, AntennaPod does not start to play on my device, even without your PR. When executing the same steps with a music player, AntennaPod \"steals\" the audio focus. I think that's pretty unexpected too, so how about doing something like this?\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    int mode = audioManager.getMode();\n          \n          \n            \n            \n          \n          \n            \n                    return (mode != AudioManager.MODE_NORMAL);\n          \n          \n            \n                    return (audioManager.getMode() != AudioManager.MODE_NORMAL || audioManager.isMusicActive());", "url": "https://github.com/AntennaPod/AntennaPod/pull/4722#discussion_r601540875", "createdAt": "2021-03-25T14:30:53Z", "author": {"login": "ByteHamster"}, "path": "core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackServiceMediaPlayer.java", "diffHunk": "@@ -335,6 +336,13 @@ final synchronized void setPlayerStatus(@NonNull PlayerStatus newStatus, Playabl\n         callback.statusChanged(new PSMPInfo(oldPlayerStatus, playerStatus, getPlayable()));\n     }\n \n+    public boolean isAudioChannelInUse() {\n+        AudioManager audioManager = (AudioManager) context.getSystemService(Context.AUDIO_SERVICE);\n+        int mode = audioManager.getMode();\n+\n+        return (mode != AudioManager.MODE_NORMAL);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c7209c3e259e1c36579f9c11f68d60f5af15a5fa"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzgwMDgwNDEzOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0yNVQxNDo0MDozMFrOI9rrSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNy0xMFQxNjowMzozNlrOJ8cLow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMTU0OTY0Mw==", "bodyText": "Can't this call actually be removed? It doesn't do anything internally, now.", "url": "https://github.com/AntennaPod/AntennaPod/pull/4722#discussion_r601549643", "createdAt": "2021-03-25T14:40:30Z", "author": {"login": "ByteHamster"}, "path": "core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java", "diffHunk": "@@ -1499,11 +1503,11 @@ public void onReceive(Context context, Intent intent) {\n \n             if (TextUtils.equals(intent.getAction(), Intent.ACTION_HEADSET_PLUG)) {\n                 int state = intent.getIntExtra(\"state\", -1);\n+                Log.d(TAG, \"Headset plug event. State is \" + state);\n                 if (state != -1) {\n-                    Log.d(TAG, \"Headset plug event. State is \" + state);\n                     if (state == UNPLUGGED) {\n                         Log.d(TAG, \"Headset was unplugged during playback.\");\n-                        pauseIfPauseOnDisconnect();\n+                        pauseIfPauseOnDisconnect(AudioOutputMode.HEADPHONE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c7209c3e259e1c36579f9c11f68d60f5af15a5fa"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwNTM3NTIyNA==", "bodyText": "I thought it would still be good to call the function in case there is a change to our logic in pauseIfPauseOnDisconnect() I can remove this if you wanted", "url": "https://github.com/AntennaPod/AntennaPod/pull/4722#discussion_r605375224", "createdAt": "2021-04-01T04:56:43Z", "author": {"login": "tonytamsf"}, "path": "core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java", "diffHunk": "@@ -1499,11 +1503,11 @@ public void onReceive(Context context, Intent intent) {\n \n             if (TextUtils.equals(intent.getAction(), Intent.ACTION_HEADSET_PLUG)) {\n                 int state = intent.getIntExtra(\"state\", -1);\n+                Log.d(TAG, \"Headset plug event. State is \" + state);\n                 if (state != -1) {\n-                    Log.d(TAG, \"Headset plug event. State is \" + state);\n                     if (state == UNPLUGGED) {\n                         Log.d(TAG, \"Headset was unplugged during playback.\");\n-                        pauseIfPauseOnDisconnect();\n+                        pauseIfPauseOnDisconnect(AudioOutputMode.HEADPHONE);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMTU0OTY0Mw=="}, "originalCommit": {"oid": "c7209c3e259e1c36579f9c11f68d60f5af15a5fa"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY1MTE5NjU1OA==", "bodyText": "Sorry for the long delay, I somehow forgot about this PR. I think it would be better to remove it. Produces less \"dead\" code.", "url": "https://github.com/AntennaPod/AntennaPod/pull/4722#discussion_r651196558", "createdAt": "2021-06-14T18:54:23Z", "author": {"login": "ByteHamster"}, "path": "core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java", "diffHunk": "@@ -1499,11 +1503,11 @@ public void onReceive(Context context, Intent intent) {\n \n             if (TextUtils.equals(intent.getAction(), Intent.ACTION_HEADSET_PLUG)) {\n                 int state = intent.getIntExtra(\"state\", -1);\n+                Log.d(TAG, \"Headset plug event. State is \" + state);\n                 if (state != -1) {\n-                    Log.d(TAG, \"Headset plug event. State is \" + state);\n                     if (state == UNPLUGGED) {\n                         Log.d(TAG, \"Headset was unplugged during playback.\");\n-                        pauseIfPauseOnDisconnect();\n+                        pauseIfPauseOnDisconnect(AudioOutputMode.HEADPHONE);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMTU0OTY0Mw=="}, "originalCommit": {"oid": "c7209c3e259e1c36579f9c11f68d60f5af15a5fa"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NzM1NjA2Nw==", "bodyText": "removed the line that doesn't do anything", "url": "https://github.com/AntennaPod/AntennaPod/pull/4722#discussion_r667356067", "createdAt": "2021-07-10T16:03:36Z", "author": {"login": "tonytamsf"}, "path": "core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java", "diffHunk": "@@ -1499,11 +1503,11 @@ public void onReceive(Context context, Intent intent) {\n \n             if (TextUtils.equals(intent.getAction(), Intent.ACTION_HEADSET_PLUG)) {\n                 int state = intent.getIntExtra(\"state\", -1);\n+                Log.d(TAG, \"Headset plug event. State is \" + state);\n                 if (state != -1) {\n-                    Log.d(TAG, \"Headset plug event. State is \" + state);\n                     if (state == UNPLUGGED) {\n                         Log.d(TAG, \"Headset was unplugged during playback.\");\n-                        pauseIfPauseOnDisconnect();\n+                        pauseIfPauseOnDisconnect(AudioOutputMode.HEADPHONE);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMTU0OTY0Mw=="}, "originalCommit": {"oid": "c7209c3e259e1c36579f9c11f68d60f5af15a5fa"}, "originalPosition": 39}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkNDI0MTA2NzkxOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNy0xMFQxOToyMDozN1rOJ8dYhQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNy0xMVQwMzoxMzo1NFrOJ8fuJg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NzM3NTc0OQ==", "bodyText": "Isn't this one not doing anything, too?", "url": "https://github.com/AntennaPod/AntennaPod/pull/4722#discussion_r667375749", "createdAt": "2021-07-10T19:20:37Z", "author": {"login": "ByteHamster"}, "path": "core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java", "diffHunk": "@@ -1465,7 +1469,7 @@ public void onReceive(Context context, Intent intent) {\n             Log.d(TAG, \"Received Auto Connection update: \" + status);\n             if (!isConnectedToCar) {\n                 Log.d(TAG, \"Car was unplugged during playback.\");\n-                pauseIfPauseOnDisconnect();\n+                pauseIfPauseOnDisconnect(AudioOutputMode.BLUETOOTH);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "763eddf75ecd9d5c6e2d118c6789c7b0d7c1ffd3"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NzQxNDA1NA==", "bodyText": "removed, thanks", "url": "https://github.com/AntennaPod/AntennaPod/pull/4722#discussion_r667414054", "createdAt": "2021-07-11T03:13:54Z", "author": {"login": "tonytamsf"}, "path": "core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java", "diffHunk": "@@ -1465,7 +1469,7 @@ public void onReceive(Context context, Intent intent) {\n             Log.d(TAG, \"Received Auto Connection update: \" + status);\n             if (!isConnectedToCar) {\n                 Log.d(TAG, \"Car was unplugged during playback.\");\n-                pauseIfPauseOnDisconnect();\n+                pauseIfPauseOnDisconnect(AudioOutputMode.BLUETOOTH);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NzM3NTc0OQ=="}, "originalCommit": {"oid": "763eddf75ecd9d5c6e2d118c6789c7b0d7c1ffd3"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkNDI0MTU3ODM1OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNy0xMVQwNjo1NTo1N1rOJ8g36g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNy0xMVQwNjo1NTo1N1rOJ8g36g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NzQzMjkzOA==", "bodyText": "I don't think we need this one either, now. Only SPEAKER is ever used.", "url": "https://github.com/AntennaPod/AntennaPod/pull/4722#discussion_r667432938", "createdAt": "2021-07-11T06:55:57Z", "author": {"login": "ByteHamster"}, "path": "core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java", "diffHunk": "@@ -219,6 +218,11 @@\n \n     private String autoSkippedFeedMediaId = null;\n \n+    private enum AudioOutputMode {\n+        BLUETOOTH,\n+        HEADPHONE,\n+        PHONE_SPEAKER\n+    }\n     /**", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dce17163ae062b6c6ed45a7408fba0c899921026"}, "originalPosition": 17}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4624, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}