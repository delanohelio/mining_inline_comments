{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk4NTQyMjEy", "number": 4502, "title": "Extended subscriptions filter", "bodyText": "Closes #3065\nThis adds:\n\nauto download enabled/disabled\nKeep updated enabled/disabled\n\nScreenshot:", "createdAt": "2020-10-06T13:21:50Z", "url": "https://github.com/AntennaPod/AntennaPod/pull/4502", "merged": true, "mergeCommit": {"oid": "e334b9cad6c627d5793898c110e7e0ad57613c20"}, "closed": true, "closedAt": "2020-10-16T11:56:44Z", "author": {"login": "asdoi"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdPllhLAH2gAyNDk4NTQyMjEyOjhhMWU0NmRiMmQxNjMzNGFkZWY5MzdlYTEzOTM4MDEwN2ZiOTNkYjE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdR1J50AH2gAyNDk4NTQyMjEyOjNjNzJiMDQzN2Y4ZGMwYTI5MjY1NjMzOGRlZjk4ODBjNWRhZWQ3ZTE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "8a1e46db2d16334adef937ea139380107fb93db1", "author": {"user": {"login": "asdoi", "name": null}}, "url": "https://github.com/AntennaPod/AntennaPod/commit/8a1e46db2d16334adef937ea139380107fb93db1", "committedDate": "2020-10-05T15:33:34Z", "message": "add auto update/keep updated to subscriptions filter"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd2bc78be850e6ebf2dc7faf77fc120ea7052616", "author": {"user": {"login": "asdoi", "name": null}}, "url": "https://github.com/AntennaPod/AntennaPod/commit/bd2bc78be850e6ebf2dc7faf77fc120ea7052616", "committedDate": "2020-10-06T13:13:11Z", "message": "remove unused files"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7f9cadc5a1ab24dbdf4c46f9d3cfb5be46c02e90", "author": {"user": {"login": "asdoi", "name": null}}, "url": "https://github.com/AntennaPod/AntennaPod/commit/7f9cadc5a1ab24dbdf4c46f9d3cfb5be46c02e90", "committedDate": "2020-10-06T13:18:57Z", "message": "Merge branch 'subscriptions_filter_extended' into filter_extended\n\n# Conflicts:\n#\tapp/src/main/java/de/danoeh/antennapod/fragment/SubscriptionFragment.java\n#\tcore/src/main/java/de/danoeh/antennapod/core/preferences/UserPreferences.java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAzMjk2ODM0", "url": "https://github.com/AntennaPod/AntennaPod/pull/4502#pullrequestreview-503296834", "createdAt": "2020-10-06T19:37:20Z", "commit": {"oid": "7f9cadc5a1ab24dbdf4c46f9d3cfb5be46c02e90"}, "state": "COMMENTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxOTozNzoyMFrOHdXE1A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wNlQxOTo0NTozMVrOHdXVrA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDU0ODgyMA==", "bodyText": "Please pass the feedCounters array here instead of the database adapter. This avoids having to load the counters twice. Every caller of the method queries the counters, anyway.", "url": "https://github.com/AntennaPod/AntennaPod/pull/4502#discussion_r500548820", "createdAt": "2020-10-06T19:37:20Z", "author": {"login": "ByteHamster"}, "path": "core/src/main/java/de/danoeh/antennapod/core/feed/SubscriptionsFilter.java", "diffHunk": "@@ -0,0 +1,116 @@\n+package de.danoeh.antennapod.core.feed;\n+\n+import android.text.TextUtils;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import de.danoeh.antennapod.core.storage.PodDBAdapter;\n+import de.danoeh.antennapod.core.util.LongIntMap;\n+\n+public class SubscriptionsFilter {\n+    private final String[] properties;\n+\n+    private boolean showIfCounterGreaterZero = false;\n+\n+    private boolean showAutoDownloadEnabled = false;\n+    private boolean showAutoDownloadDisabled = false;\n+\n+    private boolean showUpdatedEnabled = false;\n+    private boolean showUpdatedDisabled = false;\n+\n+    public SubscriptionsFilter(String properties) {\n+        this(TextUtils.split(properties, \",\"));\n+    }\n+\n+\n+    public SubscriptionsFilter(String[] properties) {\n+        this.properties = properties;\n+        for (String property : properties) {\n+            // see R.arrays.feed_filter_values\n+            switch (property) {\n+                case \"counter_greater_zero\":\n+                    showIfCounterGreaterZero = true;\n+                    break;\n+                case \"enabled_auto_download\":\n+                    showAutoDownloadEnabled = true;\n+                    break;\n+                case \"disabled_auto_download\":\n+                    showAutoDownloadDisabled = true;\n+                    break;\n+                case \"enabled_updates\":\n+                    showUpdatedEnabled = true;\n+                    break;\n+                case \"disabled_updates\":\n+                    showUpdatedDisabled = true;\n+                    break;\n+                default:\n+                    break;\n+            }\n+        }\n+    }\n+\n+    public boolean areSubscriptionsFiltered() {\n+        return properties.length > 0;\n+    }\n+\n+    /**\n+     * Run a list of feed items through the filter.\n+     */\n+    public List<Feed> filter(List<Feed> items, PodDBAdapter adapter) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7f9cadc5a1ab24dbdf4c46f9d3cfb5be46c02e90"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDU1MDAyMg==", "bodyText": "The method name sounds a bit strange to me (having the words \"subscription filter\" twice). I currently do not have a better name in mind, though.", "url": "https://github.com/AntennaPod/AntennaPod/pull/4502#discussion_r500550022", "createdAt": "2020-10-06T19:39:37Z", "author": {"login": "ByteHamster"}, "path": "app/src/main/java/de/danoeh/antennapod/fragment/SubscriptionFragment.java", "diffHunk": "@@ -224,7 +224,7 @@ private void loadSubscriptions() {\n                     progressBar.setVisibility(View.GONE);\n                 }, error -> Log.e(TAG, Log.getStackTraceString(error)));\n \n-        if (UserPreferences.getFeedFilter() != UserPreferences.FEED_FILTER_NONE) {\n+        if (UserPreferences.getSubscriptionsFilter().areSubscriptionsFiltered()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7f9cadc5a1ab24dbdf4c46f9d3cfb5be46c02e90"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDU1MDUxNw==", "bodyText": "I think it is safe to not check this because the UI does not allow selecting those combinations", "url": "https://github.com/AntennaPod/AntennaPod/pull/4502#discussion_r500550517", "createdAt": "2020-10-06T19:40:34Z", "author": {"login": "ByteHamster"}, "path": "core/src/main/java/de/danoeh/antennapod/core/feed/SubscriptionsFilter.java", "diffHunk": "@@ -0,0 +1,116 @@\n+package de.danoeh.antennapod.core.feed;\n+\n+import android.text.TextUtils;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import de.danoeh.antennapod.core.storage.PodDBAdapter;\n+import de.danoeh.antennapod.core.util.LongIntMap;\n+\n+public class SubscriptionsFilter {\n+    private final String[] properties;\n+\n+    private boolean showIfCounterGreaterZero = false;\n+\n+    private boolean showAutoDownloadEnabled = false;\n+    private boolean showAutoDownloadDisabled = false;\n+\n+    private boolean showUpdatedEnabled = false;\n+    private boolean showUpdatedDisabled = false;\n+\n+    public SubscriptionsFilter(String properties) {\n+        this(TextUtils.split(properties, \",\"));\n+    }\n+\n+\n+    public SubscriptionsFilter(String[] properties) {\n+        this.properties = properties;\n+        for (String property : properties) {\n+            // see R.arrays.feed_filter_values\n+            switch (property) {\n+                case \"counter_greater_zero\":\n+                    showIfCounterGreaterZero = true;\n+                    break;\n+                case \"enabled_auto_download\":\n+                    showAutoDownloadEnabled = true;\n+                    break;\n+                case \"disabled_auto_download\":\n+                    showAutoDownloadDisabled = true;\n+                    break;\n+                case \"enabled_updates\":\n+                    showUpdatedEnabled = true;\n+                    break;\n+                case \"disabled_updates\":\n+                    showUpdatedDisabled = true;\n+                    break;\n+                default:\n+                    break;\n+            }\n+        }\n+    }\n+\n+    public boolean areSubscriptionsFiltered() {\n+        return properties.length > 0;\n+    }\n+\n+    /**\n+     * Run a list of feed items through the filter.\n+     */\n+    public List<Feed> filter(List<Feed> items, PodDBAdapter adapter) {\n+        if (properties.length == 0) {\n+            return items;\n+        }\n+\n+        List<Feed> result = new ArrayList<>();\n+\n+        // Check for filter combinations that will always return an empty list", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7f9cadc5a1ab24dbdf4c46f9d3cfb5be46c02e90"}, "originalPosition": 67}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDU1MTY2NA==", "bodyText": "I think a method like value.serialize() would be better. This then keeps the details of how items are joined encapsulated within the class.", "url": "https://github.com/AntennaPod/AntennaPod/pull/4502#discussion_r500551664", "createdAt": "2020-10-06T19:42:43Z", "author": {"login": "ByteHamster"}, "path": "core/src/main/java/de/danoeh/antennapod/core/preferences/UserPreferences.java", "diffHunk": "@@ -1046,14 +1045,14 @@ public static void setQueueKeepSortedOrder(SortOrder sortOrder) {\n                 .apply();\n     }\n \n-    public static int getFeedFilter() {\n-        String value = prefs.getString(PREF_FILTER_FEED, \"\" + FEED_FILTER_NONE);\n-        return Integer.parseInt(value);\n+    public static SubscriptionsFilter getSubscriptionsFilter() {\n+        String value = prefs.getString(PREF_FILTER_FEED, \"\");\n+        return new SubscriptionsFilter(value);\n     }\n \n-    public static void setFeedFilter(String value) {\n+    public static void setSubscriptionsFilter(SubscriptionsFilter value) {\n         prefs.edit()\n-                .putString(PREF_FILTER_FEED, value)\n+                .putString(PREF_FILTER_FEED, TextUtils.join(\",\", value.getValues()))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7f9cadc5a1ab24dbdf4c46f9d3cfb5be46c02e90"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDU1MjM3Mw==", "bodyText": "Side note: Changing the preference values like this would usually lead to data loss. In this case, it is okay because the feature is not released to the public yet.", "url": "https://github.com/AntennaPod/AntennaPod/pull/4502#discussion_r500552373", "createdAt": "2020-10-06T19:44:07Z", "author": {"login": "ByteHamster"}, "path": "core/src/main/res/values/arrays.xml", "diffHunk": "@@ -233,16 +233,6 @@\n         <item>3</item>\n     </string-array>\n \n-    <string-array name=\"nav_drawer_feed_filter_values\">\n-        <item>0</item>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7f9cadc5a1ab24dbdf4c46f9d3cfb5be46c02e90"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDU1MzEzMg==", "bodyText": "I am not completely happy about the strings because they are pretty long. In German, they will likely need 3 lines in the dialog. @keunes do you have a idea how to make them shorter?", "url": "https://github.com/AntennaPod/AntennaPod/pull/4502#discussion_r500553132", "createdAt": "2020-10-06T19:45:31Z", "author": {"login": "ByteHamster"}, "path": "core/src/main/res/values/strings.xml", "diffHunk": "@@ -527,9 +527,13 @@\n     <string name=\"pref_delete_removes_from_queue_sum\">Automatically remove an episode from the queue when it is deleted.</string>\n     <string name=\"pref_filter_feed_title\">Subscription Filter</string>\n     <string name=\"pref_filter_feed_sum\">Filter your subscriptions in navigation drawer and subscriptions screen.</string>\n-    <string name=\"hide_subscriptions_where_counter_is_zero\">Hide if counter is zero</string>\n     <string name=\"no_filter_label\">None</string>\n     <string name=\"subscriptions_are_filtered\">Subscriptions are filtered.</string>\n+    <string name=\"subscriptions_counter_greater_zero\">Counter greater zero</string>\n+    <string name=\"auto_downloaded\">Auto downloaded</string>\n+    <string name=\"not_auto_downloaded\">Not auto downloaded</string>\n+    <string name=\"kept_updated\">Kept updated</string>\n+    <string name=\"not_kept_updated\">Not kept updated</string>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7f9cadc5a1ab24dbdf4c46f9d3cfb5be46c02e90"}, "originalPosition": 11}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "070af86c2aa6112cbcd042693e2e5af161176066", "author": {"user": {"login": "asdoi", "name": null}}, "url": "https://github.com/AntennaPod/AntennaPod/commit/070af86c2aa6112cbcd042693e2e5af161176066", "committedDate": "2020-10-07T16:46:25Z", "message": "fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3c72b0437f8dc0a292656338def9880c5daed7e1", "author": {"user": {"login": "asdoi", "name": null}}, "url": "https://github.com/AntennaPod/AntennaPod/commit/3c72b0437f8dc0a292656338def9880c5daed7e1", "committedDate": "2020-10-12T14:49:44Z", "message": "rename to isEnabled()"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2717, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}