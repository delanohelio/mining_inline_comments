{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAwOTcxNTk5", "number": 4517, "title": "Show date from which statistics are counting", "bodyText": "Closes #3826\nIt uses the date when the app was installed and saves it to SharedPreferences.", "createdAt": "2020-10-10T12:47:37Z", "url": "https://github.com/AntennaPod/AntennaPod/pull/4517", "merged": true, "mergeCommit": {"oid": "d732e6a5c12735210e70ba0e04dce1e4f09e50f4"}, "closed": true, "closedAt": "2020-10-25T18:15:00Z", "author": {"login": "asdoi"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdRKLL6gH2gAyNTAwOTcxNTk5OmRiYWI3MWE5NjM2M2U2MGVlYjE1ZmNiNzZkN2Y5NzYzMzZmYTIyNjY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdVxOm-gH2gAyNTAwOTcxNTk5OjBjYWI3ZmMzOTAyMTk4YWJmN2Q1YzFlZDI4MTliYmVjNzQ1ZTEyZTk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "dbab71a96363e60eeb15fcb76d7f976336fa2266", "author": {"user": {"login": "asdoi", "name": null}}, "url": "https://github.com/AntennaPod/AntennaPod/commit/dbab71a96363e60eeb15fcb76d7f976336fa2266", "committedDate": "2020-10-10T12:45:13Z", "message": "add counting since to statistics"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2196362c2ada18c9b5cbbda80f70ec2d9600fd0c", "author": {"user": {"login": "asdoi", "name": null}}, "url": "https://github.com/AntennaPod/AntennaPod/commit/2196362c2ada18c9b5cbbda80f70ec2d9600fd0c", "committedDate": "2020-10-15T16:19:14Z", "message": "Localize text"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8893023d081cc67189b50e1e94c0ca233b5ff544", "author": {"user": {"login": "asdoi", "name": null}}, "url": "https://github.com/AntennaPod/AntennaPod/commit/8893023d081cc67189b50e1e94c0ca233b5ff544", "committedDate": "2020-10-21T16:14:37Z", "message": "use PreferenceUpgrader to check if app is on first run"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE0MTYxMTU5", "url": "https://github.com/AntennaPod/AntennaPod/pull/4517#pullrequestreview-514161159", "createdAt": "2020-10-21T20:30:20Z", "commit": {"oid": "8893023d081cc67189b50e1e94c0ca233b5ff544"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQyMDozMDoyMVrOHmDwyQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQyMDozODowM1rOHmEE1g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTY2OTU3Nw==", "bodyText": "Please revert the unrelated change to keep the git history clean", "url": "https://github.com/AntennaPod/AntennaPod/pull/4517#discussion_r509669577", "createdAt": "2020-10-21T20:30:21Z", "author": {"login": "ByteHamster"}, "path": "app/src/main/java/de/danoeh/antennapod/PodcastApp.java", "diffHunk": "@@ -12,6 +12,7 @@\n import de.danoeh.antennapod.activity.SplashActivity;\n import de.danoeh.antennapod.core.ApCoreEventBusIndex;\n import de.danoeh.antennapod.core.ClientConfig;\n+import de.danoeh.antennapod.core.preferences.UserPreferences;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8893023d081cc67189b50e1e94c0ca233b5ff544"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTY3MDM5NA==", "bodyText": "Please add something like \"date\" to the name. It currently sounds like it returns the millis between today and the first install.", "url": "https://github.com/AntennaPod/AntennaPod/pull/4517#discussion_r509670394", "createdAt": "2020-10-21T20:31:43Z", "author": {"login": "ByteHamster"}, "path": "core/src/main/java/de/danoeh/antennapod/core/preferences/UserPreferences.java", "diffHunk": "@@ -1057,4 +1059,15 @@ public static void setFeedFilter(String value) {\n                 .apply();\n     }\n \n+    public static long getUsageCountingMillis() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8893023d081cc67189b50e1e94c0ca233b5ff544"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTY3Mjg2OA==", "bodyText": "As a safeguard, could you please move this into the .subscribe lambda? If for whatever reason the database call fails, the date should not be reset. I do not think this will ever happen (or if it happens, users will not care) but it feels somehow more clean to only update after it is actually reset.", "url": "https://github.com/AntennaPod/AntennaPod/pull/4517#discussion_r509672868", "createdAt": "2020-10-21T20:35:31Z", "author": {"login": "ByteHamster"}, "path": "app/src/main/java/de/danoeh/antennapod/fragment/preferences/PlaybackStatisticsFragment.java", "diffHunk": "@@ -156,6 +157,8 @@ private void doResetStatistics() {\n             disposable.dispose();\n         }\n \n+        UserPreferences.resetUsageCounting();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8893023d081cc67189b50e1e94c0ca233b5ff544"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTY3Mzc4OA==", "bodyText": "Why is this \"if\" needed? I think the code should only be called on the very first install. We therefore know that the usage stats are not yet counting. Did I miss something?", "url": "https://github.com/AntennaPod/AntennaPod/pull/4517#discussion_r509673788", "createdAt": "2020-10-21T20:36:43Z", "author": {"login": "ByteHamster"}, "path": "app/src/main/java/de/danoeh/antennapod/preferences/PreferenceUpgrader.java", "diffHunk": "@@ -34,6 +34,10 @@ public static void checkUpgrades(Context context) {\n \n     private static void upgrade(int oldVersion) {\n         if (oldVersion == -1) {\n+            //New installation\n+            if(UserPreferences.getUsageCountingMillis() < 0){", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8893023d081cc67189b50e1e94c0ca233b5ff544"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTY3NDcxMA==", "bodyText": "I would combine set/reset to a single method. Can't think of a case where we want to use set without reset.", "url": "https://github.com/AntennaPod/AntennaPod/pull/4517#discussion_r509674710", "createdAt": "2020-10-21T20:38:03Z", "author": {"login": "ByteHamster"}, "path": "core/src/main/java/de/danoeh/antennapod/core/preferences/UserPreferences.java", "diffHunk": "@@ -1057,4 +1059,15 @@ public static void setFeedFilter(String value) {\n                 .apply();\n     }\n \n+    public static long getUsageCountingMillis() {\n+        return prefs.getLong(PREF_USAGE_COUNTING_DATE, -1);\n+    }\n+\n+    private static void setUsageCountingMillis(long value) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8893023d081cc67189b50e1e94c0ca233b5ff544"}, "originalPosition": 33}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e00997bf64e49472a83068a16d364a714320689d", "author": {"user": {"login": "asdoi", "name": null}}, "url": "https://github.com/AntennaPod/AntennaPod/commit/e00997bf64e49472a83068a16d364a714320689d", "committedDate": "2020-10-22T18:33:20Z", "message": "fix code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "82b3cbc319ff9b62b2311dbc3532f57e2664ea2f", "author": {"user": {"login": "asdoi", "name": null}}, "url": "https://github.com/AntennaPod/AntennaPod/commit/82b3cbc319ff9b62b2311dbc3532f57e2664ea2f", "committedDate": "2020-10-22T18:43:20Z", "message": "use formatAbbrev"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTE1MTE0MDI3", "url": "https://github.com/AntennaPod/AntennaPod/pull/4517#pullrequestreview-515114027", "createdAt": "2020-10-22T20:58:59Z", "commit": {"oid": "82b3cbc319ff9b62b2311dbc3532f57e2664ea2f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQyMDo1OTowMFrOHmzmHQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMlQyMDo1OTowMFrOHmzmHQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQ1MzI3Nw==", "bodyText": "This should also be called when a database is imported.", "url": "https://github.com/AntennaPod/AntennaPod/pull/4517#discussion_r510453277", "createdAt": "2020-10-22T20:59:00Z", "author": {"login": "ByteHamster"}, "path": "core/src/main/java/de/danoeh/antennapod/core/preferences/UserPreferences.java", "diffHunk": "@@ -1057,4 +1059,12 @@ public static void setFeedFilter(String value) {\n                 .apply();\n     }\n \n+    public static long getUsageCountingDateMillis() {\n+        return prefs.getLong(PREF_USAGE_COUNTING_DATE, -1);\n+    }\n+\n+    public static void resetUsageCountingDate() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "82b3cbc319ff9b62b2311dbc3532f57e2664ea2f"}, "originalPosition": 33}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b7ea64d90296d69096d7f61e9187fb044d68d600", "author": {"user": {"login": "asdoi", "name": null}}, "url": "https://github.com/AntennaPod/AntennaPod/commit/b7ea64d90296d69096d7f61e9187fb044d68d600", "committedDate": "2020-10-24T20:26:41Z", "message": "unset usage counting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0cab7fc3902198abf7d5c1ed2819bbec745e12e9", "author": {"user": {"login": "asdoi", "name": null}}, "url": "https://github.com/AntennaPod/AntennaPod/commit/0cab7fc3902198abf7d5c1ed2819bbec745e12e9", "committedDate": "2020-10-24T20:30:57Z", "message": "fix checkstyle"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2727, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}