{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI4ODg4MDE1", "number": 4722, "title": "Handle bluetooth and headphone disconnect", "bodyText": "fixes #2365\nfixes #5251\nfixes #5259\n@keunes and @ByteHamster - please test these senarios below\n\n testing\n Downloaded episode : Have headphone plugged in, play, unplug expect pause, plug back in, expect resume\n Streaming episode  : Have headphone plugged in, play, unplug expect pause, plug back in, expect resume\n If bluetooth is playing, headset is plugged in, headset unplugged, bluetooth should continue\n If headset is playing, bluetooth is connected, bluetooth is unplugged, headset should continue\n If headset or bluetooth is unplugged (the phone speaker should not be playing)\n Play AntennaPod, unplug headphone, Start a zoom call, plug in headaphone - podcast should not start.", "createdAt": "2020-11-28T04:07:32Z", "url": "https://github.com/AntennaPod/AntennaPod/pull/4722", "merged": true, "mergeCommit": {"oid": "e8eb2458996053a1350048d3b85b079db77242f8"}, "closed": true, "closedAt": "2021-07-11T17:36:03Z", "author": {"login": "tonytamsf"}, "timelineItems": {"totalCount": 24, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdg0H1dAH2gAyNTI4ODg4MDE1OmE0YTAxYjk5ZmM1YWExOWE4NGJmZGM5YmFhMjBiMDM0YWIzZGZiMmU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABepaC8lAH2gAyNTI4ODg4MDE1OjMxNzI5MWEzMzRjZGRiZmI2ZTE2MjdkYTI4NjRkMDdhNzNlOWI2YzI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a4a01b99fc5aa19a84bfdc9baa20b034ab3dfb2e", "author": {"user": {"login": "tonytamsf", "name": "Tony Tam"}}, "url": "https://github.com/AntennaPod/AntennaPod/commit/a4a01b99fc5aa19a84bfdc9baa20b034ab3dfb2e", "committedDate": "2020-11-28T04:06:26Z", "message": "handle bluetooth and headphone disconnect"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b4bad030029236225d314e0a74f6a609a566c0b4", "author": {"user": {"login": "tonytamsf", "name": "Tony Tam"}}, "url": "https://github.com/AntennaPod/AntennaPod/commit/b4bad030029236225d314e0a74f6a609a566c0b4", "committedDate": "2020-11-28T18:25:02Z", "message": "handle when there is an internal zoom/whatsapp/wechat happening"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d7bfe38bdb8faad213deb6ca8d93f8f6aeb1a9f4", "author": {"user": {"login": "tonytamsf", "name": "Tony Tam"}}, "url": "https://github.com/AntennaPod/AntennaPod/commit/d7bfe38bdb8faad213deb6ca8d93f8f6aeb1a9f4", "committedDate": "2020-11-28T22:31:31Z", "message": "checkstyle"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQwNzg4NjU4", "url": "https://github.com/AntennaPod/AntennaPod/pull/4722#pullrequestreview-540788658", "createdAt": "2020-11-30T10:44:03Z", "commit": {"oid": "d7bfe38bdb8faad213deb6ca8d93f8f6aeb1a9f4"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxMDo0NDowM1rOH71V1w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0zMFQxMDo0NDowM1rOH71V1w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjUwMTk3NQ==", "bodyText": "Could you please change this to an enum?", "url": "https://github.com/AntennaPod/AntennaPod/pull/4722#discussion_r532501975", "createdAt": "2020-11-30T10:44:03Z", "author": {"login": "ByteHamster"}, "path": "core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java", "diffHunk": "@@ -1465,7 +1464,7 @@ public void onReceive(Context context, Intent intent) {\n             Log.d(TAG, \"Received Auto Connection update: \" + status);\n             if (!isConnectedToCar) {\n                 Log.d(TAG, \"Car was unplugged during playback.\");\n-                pauseIfPauseOnDisconnect();\n+                pauseIfPauseOnDisconnect(\"bluetooth\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d7bfe38bdb8faad213deb6ca8d93f8f6aeb1a9f4"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "97f5170b4da4c168922cc6fca10feda7c205b1a0", "author": {"user": {"login": "tonytamsf", "name": "Tony Tam"}}, "url": "https://github.com/AntennaPod/AntennaPod/commit/97f5170b4da4c168922cc6fca10feda7c205b1a0", "committedDate": "2020-11-30T14:25:52Z", "message": "use enum"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTU4MjUwNDQy", "url": "https://github.com/AntennaPod/AntennaPod/pull/4722#pullrequestreview-558250442", "createdAt": "2020-12-23T22:14:21Z", "commit": {"oid": "97f5170b4da4c168922cc6fca10feda7c205b1a0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QyMjoxNDoyMVrOIK4umw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0yM1QyMjoxNDoyMVrOIK4umw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODI4NjEwNw==", "bodyText": "Why does this need to be executed even when the player is not actually paused? I did not try to do it but I could imagine a scenario where the headset is unplugged and plugged in while playing with Bluetooth. It then has  transientPause set to true. When then pausing manually, the flag is still true. Wouldn't re-connecting then assume a wrong state?", "url": "https://github.com/AntennaPod/AntennaPod/pull/4722#discussion_r548286107", "createdAt": "2020-12-23T22:14:21Z", "author": {"login": "ByteHamster"}, "path": "core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java", "diffHunk": "@@ -1534,19 +1538,25 @@ public void onReceive(Context context, Intent intent) {\n         public void onReceive(Context context, Intent intent) {\n             // sound is about to change, eg. bluetooth -> speaker\n             Log.d(TAG, \"Pausing playback because audio is becoming noisy\");\n-            pauseIfPauseOnDisconnect();\n+            pauseIfPauseOnDisconnect(AudioOutputMode.PHONE_SPEAKER);\n         }\n         // android.media.AUDIO_BECOMING_NOISY\n     };\n \n     /**\n      * Pauses playback if PREF_PAUSE_ON_HEADSET_DISCONNECT was set to true.\n      */\n-    private void pauseIfPauseOnDisconnect() {\n-        if (UserPreferences.isPauseOnHeadsetDisconnect() && !isCasting()) {\n-            if (mediaPlayer.getPlayerStatus() == PlayerStatus.PLAYING) {\n-                transientPause = true;\n-            }\n+    private void pauseIfPauseOnDisconnect(AudioOutputMode outputMode) {\n+        Log.d(TAG, \"pauseIfPauseOnDisconnect() \" + outputMode);\n+        // If bluetooth is playing, headset is plugged in, headset unplugged, bluetooth should continue\n+        // If headset is playing, bluetooth is connected, bluetooth is unplugged, headset should continue\n+        // If headset or bluetooth is unplugged (the speaker should not be playing)\n+        if (mediaPlayer.getPlayerStatus() == PlayerStatus.PLAYING) {\n+            transientPause = true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "97f5170b4da4c168922cc6fca10feda7c205b1a0"}, "originalPosition": 67}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ae11204daf29a4bbc607864bdaa4d25c4a5dc547", "author": {"user": {"login": "tonytamsf", "name": "Tony Tam"}}, "url": "https://github.com/AntennaPod/AntennaPod/commit/ae11204daf29a4bbc607864bdaa4d25c4a5dc547", "committedDate": "2021-01-20T07:03:18Z", "message": "Trigger Build"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9a4b863a1a5354037232ab45b39c0a74bbdea91f", "author": {"user": {"login": "tonytamsf", "name": "Tony Tam"}}, "url": "https://github.com/AntennaPod/AntennaPod/commit/9a4b863a1a5354037232ab45b39c0a74bbdea91f", "committedDate": "2021-01-31T05:37:59Z", "message": "remove extra code"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "daeb207dbeed0013ff786ee9f8f71d995b43248f", "author": {"user": {"login": "tonytamsf", "name": "Tony Tam"}}, "url": "https://github.com/AntennaPod/AntennaPod/commit/daeb207dbeed0013ff786ee9f8f71d995b43248f", "committedDate": "2021-01-31T06:04:56Z", "message": "fix disconnect+connect for streaming"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTc5OTQwMTg1", "url": "https://github.com/AntennaPod/AntennaPod/pull/4722#pullrequestreview-579940185", "createdAt": "2021-01-31T22:09:24Z", "commit": {"oid": "daeb207dbeed0013ff786ee9f8f71d995b43248f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0zMVQyMjowOToyNFrOIdM9Ng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0zMVQyMjowOToyNFrOIdM9Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NzQ5MTg5NA==", "bodyText": "Could you please revert this line change to keep the git history clean?", "url": "https://github.com/AntennaPod/AntennaPod/pull/4722#discussion_r567491894", "createdAt": "2021-01-31T22:09:24Z", "author": {"login": "ByteHamster"}, "path": "core/src/main/java/de/danoeh/antennapod/core/service/playback/LocalPSMP.java", "diffHunk": "@@ -299,7 +299,6 @@ public void resume() {\n     private void resumeSync() {\n         if (playerStatus == PlayerStatus.PAUSED || playerStatus == PlayerStatus.PREPARED) {\n             int focusGained = AudioManagerCompat.requestAudioFocus(audioManager, audioFocusRequest);\n-", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "daeb207dbeed0013ff786ee9f8f71d995b43248f"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTc5OTQ5Mzk2", "url": "https://github.com/AntennaPod/AntennaPod/pull/4722#pullrequestreview-579949396", "createdAt": "2021-01-31T23:43:02Z", "commit": {"oid": "daeb207dbeed0013ff786ee9f8f71d995b43248f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0zMVQyMzo0MzowMlrOIdNsOw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0zMVQyMzo0MzowMlrOIdNsOw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NzUwMzkzMQ==", "bodyText": "Note to reviewer: If there is a phone call, do not unpause", "url": "https://github.com/AntennaPod/AntennaPod/pull/4722#discussion_r567503931", "createdAt": "2021-01-31T23:43:02Z", "author": {"login": "tonytamsf"}, "path": "core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java", "diffHunk": "@@ -1534,27 +1538,31 @@ public void onReceive(Context context, Intent intent) {\n         public void onReceive(Context context, Intent intent) {\n             // sound is about to change, eg. bluetooth -> speaker\n             Log.d(TAG, \"Pausing playback because audio is becoming noisy\");\n-            pauseIfPauseOnDisconnect();\n+            pauseIfPauseOnDisconnect(AudioOutputMode.PHONE_SPEAKER);\n         }\n-        // android.media.AUDIO_BECOMING_NOISY\n     };\n \n     /**\n      * Pauses playback if PREF_PAUSE_ON_HEADSET_DISCONNECT was set to true.\n      */\n-    private void pauseIfPauseOnDisconnect() {\n-        if (UserPreferences.isPauseOnHeadsetDisconnect() && !isCasting()) {\n-            if (mediaPlayer.getPlayerStatus() == PlayerStatus.PLAYING) {\n-                transientPause = true;\n-            }\n-            mediaPlayer.pause(!UserPreferences.isPersistNotify(), true);\n+    private void pauseIfPauseOnDisconnect(AudioOutputMode outputMode) {\n+        Log.d(TAG, \"pauseIfPauseOnDisconnect() \" + outputMode);\n+        if (UserPreferences.isPauseOnHeadsetDisconnect()\n+                && outputMode == AudioOutputMode.PHONE_SPEAKER\n+                && !isCasting()) {\n+            transientPause = true;\n+            mediaPlayer.pause(!UserPreferences.isPersistNotify(), false);\n         }\n     }\n \n     /**\n      * @param bluetooth true if the event for unpausing came from bluetooth\n      */\n     private void unpauseIfPauseOnDisconnect(boolean bluetooth) {\n+        if (mediaPlayer.isAudioChannelInUse()) {\n+            Log.d(TAG, \"unpauseIfPauseOnDisconnect() audio is in use\");\n+            return;\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "daeb207dbeed0013ff786ee9f8f71d995b43248f"}, "originalPosition": 79}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTc5OTQ5NTU0", "url": "https://github.com/AntennaPod/AntennaPod/pull/4722#pullrequestreview-579949554", "createdAt": "2021-01-31T23:44:39Z", "commit": {"oid": "daeb207dbeed0013ff786ee9f8f71d995b43248f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0zMVQyMzo0NDozOVrOIdNs3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0zMVQyMzo0NDozOVrOIdNs3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NzUwNDA5Mw==", "bodyText": "note for reviewer: When headphone is disconnected, and the output is going to the phone speaker, then pause.  This would allow us to continue playing if the output would go to bluetooth", "url": "https://github.com/AntennaPod/AntennaPod/pull/4722#discussion_r567504093", "createdAt": "2021-01-31T23:44:39Z", "author": {"login": "tonytamsf"}, "path": "core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java", "diffHunk": "@@ -1534,27 +1538,31 @@ public void onReceive(Context context, Intent intent) {\n         public void onReceive(Context context, Intent intent) {\n             // sound is about to change, eg. bluetooth -> speaker\n             Log.d(TAG, \"Pausing playback because audio is becoming noisy\");\n-            pauseIfPauseOnDisconnect();\n+            pauseIfPauseOnDisconnect(AudioOutputMode.PHONE_SPEAKER);\n         }\n-        // android.media.AUDIO_BECOMING_NOISY\n     };\n \n     /**\n      * Pauses playback if PREF_PAUSE_ON_HEADSET_DISCONNECT was set to true.\n      */\n-    private void pauseIfPauseOnDisconnect() {\n-        if (UserPreferences.isPauseOnHeadsetDisconnect() && !isCasting()) {\n-            if (mediaPlayer.getPlayerStatus() == PlayerStatus.PLAYING) {\n-                transientPause = true;\n-            }\n-            mediaPlayer.pause(!UserPreferences.isPersistNotify(), true);\n+    private void pauseIfPauseOnDisconnect(AudioOutputMode outputMode) {\n+        Log.d(TAG, \"pauseIfPauseOnDisconnect() \" + outputMode);\n+        if (UserPreferences.isPauseOnHeadsetDisconnect()\n+                && outputMode == AudioOutputMode.PHONE_SPEAKER\n+                && !isCasting()) {\n+            transientPause = true;\n+            mediaPlayer.pause(!UserPreferences.isPersistNotify(), false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "daeb207dbeed0013ff786ee9f8f71d995b43248f"}, "originalPosition": 68}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTc5OTQ5NzIx", "url": "https://github.com/AntennaPod/AntennaPod/pull/4722#pullrequestreview-579949721", "createdAt": "2021-01-31T23:46:15Z", "commit": {"oid": "daeb207dbeed0013ff786ee9f8f71d995b43248f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0zMVQyMzo0NjoxNVrOIdNtpw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0zMVQyMzo0NjoxNVrOIdNtpw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NzUwNDI5NQ==", "bodyText": "note for reviewer: Switching from true to false would allow us to continue when the headphone is plug back in, when we were streaming when we unpluged", "url": "https://github.com/AntennaPod/AntennaPod/pull/4722#discussion_r567504295", "createdAt": "2021-01-31T23:46:15Z", "author": {"login": "tonytamsf"}, "path": "core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java", "diffHunk": "@@ -1534,27 +1538,31 @@ public void onReceive(Context context, Intent intent) {\n         public void onReceive(Context context, Intent intent) {\n             // sound is about to change, eg. bluetooth -> speaker\n             Log.d(TAG, \"Pausing playback because audio is becoming noisy\");\n-            pauseIfPauseOnDisconnect();\n+            pauseIfPauseOnDisconnect(AudioOutputMode.PHONE_SPEAKER);\n         }\n-        // android.media.AUDIO_BECOMING_NOISY\n     };\n \n     /**\n      * Pauses playback if PREF_PAUSE_ON_HEADSET_DISCONNECT was set to true.\n      */\n-    private void pauseIfPauseOnDisconnect() {\n-        if (UserPreferences.isPauseOnHeadsetDisconnect() && !isCasting()) {\n-            if (mediaPlayer.getPlayerStatus() == PlayerStatus.PLAYING) {\n-                transientPause = true;\n-            }\n-            mediaPlayer.pause(!UserPreferences.isPersistNotify(), true);\n+    private void pauseIfPauseOnDisconnect(AudioOutputMode outputMode) {\n+        Log.d(TAG, \"pauseIfPauseOnDisconnect() \" + outputMode);\n+        if (UserPreferences.isPauseOnHeadsetDisconnect()\n+                && outputMode == AudioOutputMode.PHONE_SPEAKER\n+                && !isCasting()) {\n+            transientPause = true;\n+            mediaPlayer.pause(!UserPreferences.isPersistNotify(), false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "daeb207dbeed0013ff786ee9f8f71d995b43248f"}, "originalPosition": 68}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "86f62283f5e4602ee853456b1aae0c603e7ff3f5", "author": {"user": {"login": "tonytamsf", "name": "Tony Tam"}}, "url": "https://github.com/AntennaPod/AntennaPod/commit/86f62283f5e4602ee853456b1aae0c603e7ff3f5", "committedDate": "2021-02-01T00:08:50Z", "message": "revert"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c7209c3e259e1c36579f9c11f68d60f5af15a5fa", "author": {"user": {"login": "tonytamsf", "name": "Tony Tam"}}, "url": "https://github.com/AntennaPod/AntennaPod/commit/c7209c3e259e1c36579f9c11f68d60f5af15a5fa", "committedDate": "2021-02-01T00:12:32Z", "message": "ws"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjIxMTg1Nzc1", "url": "https://github.com/AntennaPod/AntennaPod/pull/4722#pullrequestreview-621185775", "createdAt": "2021-03-25T14:30:53Z", "commit": {"oid": "c7209c3e259e1c36579f9c11f68d60f5af15a5fa"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0yNVQxNDozMDo1M1rOI9rJCw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0yNVQxNDo0MDozMFrOI9rrSw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMTU0MDg3NQ==", "bodyText": "How about trying \" Play AntennaPod, unplug headphone, start Phone call, plug in headaphone - podcast should not start.\"\n\nHmm, when doing an actual phone call, AntennaPod does not start to play on my device, even without your PR. When executing the same steps with a music player, AntennaPod \"steals\" the audio focus. I think that's pretty unexpected too, so how about doing something like this?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    int mode = audioManager.getMode();\n          \n          \n            \n            \n          \n          \n            \n                    return (mode != AudioManager.MODE_NORMAL);\n          \n          \n            \n                    return (audioManager.getMode() != AudioManager.MODE_NORMAL || audioManager.isMusicActive());", "url": "https://github.com/AntennaPod/AntennaPod/pull/4722#discussion_r601540875", "createdAt": "2021-03-25T14:30:53Z", "author": {"login": "ByteHamster"}, "path": "core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackServiceMediaPlayer.java", "diffHunk": "@@ -335,6 +336,13 @@ final synchronized void setPlayerStatus(@NonNull PlayerStatus newStatus, Playabl\n         callback.statusChanged(new PSMPInfo(oldPlayerStatus, playerStatus, getPlayable()));\n     }\n \n+    public boolean isAudioChannelInUse() {\n+        AudioManager audioManager = (AudioManager) context.getSystemService(Context.AUDIO_SERVICE);\n+        int mode = audioManager.getMode();\n+\n+        return (mode != AudioManager.MODE_NORMAL);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c7209c3e259e1c36579f9c11f68d60f5af15a5fa"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMTU0OTY0Mw==", "bodyText": "Can't this call actually be removed? It doesn't do anything internally, now.", "url": "https://github.com/AntennaPod/AntennaPod/pull/4722#discussion_r601549643", "createdAt": "2021-03-25T14:40:30Z", "author": {"login": "ByteHamster"}, "path": "core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java", "diffHunk": "@@ -1499,11 +1503,11 @@ public void onReceive(Context context, Intent intent) {\n \n             if (TextUtils.equals(intent.getAction(), Intent.ACTION_HEADSET_PLUG)) {\n                 int state = intent.getIntExtra(\"state\", -1);\n+                Log.d(TAG, \"Headset plug event. State is \" + state);\n                 if (state != -1) {\n-                    Log.d(TAG, \"Headset plug event. State is \" + state);\n                     if (state == UNPLUGGED) {\n                         Log.d(TAG, \"Headset was unplugged during playback.\");\n-                        pauseIfPauseOnDisconnect();\n+                        pauseIfPauseOnDisconnect(AudioOutputMode.HEADPHONE);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c7209c3e259e1c36579f9c11f68d60f5af15a5fa"}, "originalPosition": 39}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7deee0fe00cf74dbcd0607d69ecff4481532d95b", "author": {"user": {"login": "tonytamsf", "name": "Tony Tam"}}, "url": "https://github.com/AntennaPod/AntennaPod/commit/7deee0fe00cf74dbcd0607d69ecff4481532d95b", "committedDate": "2021-04-01T04:57:15Z", "message": "Update core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackServiceMediaPlayer.java\n\nCo-authored-by: ByteHamster <ByteHamster@users.noreply.github.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "046a833c526d570c0552bcc70684c47fdddea57a", "author": {"user": {"login": "tonytamsf", "name": "Tony Tam"}}, "url": "https://github.com/AntennaPod/AntennaPod/commit/046a833c526d570c0552bcc70684c47fdddea57a", "committedDate": "2021-07-09T16:31:01Z", "message": "Trigger Build"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "763eddf75ecd9d5c6e2d118c6789c7b0d7c1ffd3", "author": {"user": {"login": "tonytamsf", "name": "Tony Tam"}}, "url": "https://github.com/AntennaPod/AntennaPod/commit/763eddf75ecd9d5c6e2d118c6789c7b0d7c1ffd3", "committedDate": "2021-07-10T16:01:47Z", "message": "remove unused lines when we detect headphone unplugged"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NzAzNTI0MTU1", "url": "https://github.com/AntennaPod/AntennaPod/pull/4722#pullrequestreview-703524155", "createdAt": "2021-07-10T19:20:37Z", "commit": {"oid": "763eddf75ecd9d5c6e2d118c6789c7b0d7c1ffd3"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNy0xMFQxOToyMDozN1rOJ8dYhQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNy0xMFQxOToyMDozN1rOJ8dYhQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NzM3NTc0OQ==", "bodyText": "Isn't this one not doing anything, too?", "url": "https://github.com/AntennaPod/AntennaPod/pull/4722#discussion_r667375749", "createdAt": "2021-07-10T19:20:37Z", "author": {"login": "ByteHamster"}, "path": "core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java", "diffHunk": "@@ -1465,7 +1469,7 @@ public void onReceive(Context context, Intent intent) {\n             Log.d(TAG, \"Received Auto Connection update: \" + status);\n             if (!isConnectedToCar) {\n                 Log.d(TAG, \"Car was unplugged during playback.\");\n-                pauseIfPauseOnDisconnect();\n+                pauseIfPauseOnDisconnect(AudioOutputMode.BLUETOOTH);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "763eddf75ecd9d5c6e2d118c6789c7b0d7c1ffd3"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dce17163ae062b6c6ed45a7408fba0c899921026", "author": {"user": {"login": "tonytamsf", "name": "Tony Tam"}}, "url": "https://github.com/AntennaPod/AntennaPod/commit/dce17163ae062b6c6ed45a7408fba0c899921026", "committedDate": "2021-07-11T03:13:41Z", "message": "remove code that does not do anything"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NzAzNTUzNjk0", "url": "https://github.com/AntennaPod/AntennaPod/pull/4722#pullrequestreview-703553694", "createdAt": "2021-07-11T06:55:57Z", "commit": {"oid": "dce17163ae062b6c6ed45a7408fba0c899921026"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNy0xMVQwNjo1NTo1N1rOJ8g36g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNy0xMVQwNjo1NTo1N1rOJ8g36g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2NzQzMjkzOA==", "bodyText": "I don't think we need this one either, now. Only SPEAKER is ever used.", "url": "https://github.com/AntennaPod/AntennaPod/pull/4722#discussion_r667432938", "createdAt": "2021-07-11T06:55:57Z", "author": {"login": "ByteHamster"}, "path": "core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java", "diffHunk": "@@ -219,6 +218,11 @@\n \n     private String autoSkippedFeedMediaId = null;\n \n+    private enum AudioOutputMode {\n+        BLUETOOTH,\n+        HEADPHONE,\n+        PHONE_SPEAKER\n+    }\n     /**", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "dce17163ae062b6c6ed45a7408fba0c899921026"}, "originalPosition": 17}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6e2aeb15a3a4a97e74df2fd5dbc9e9a5b61171ca", "author": {"user": {"login": "ByteHamster", "name": null}}, "url": "https://github.com/AntennaPod/AntennaPod/commit/6e2aeb15a3a4a97e74df2fd5dbc9e9a5b61171ca", "committedDate": "2021-07-11T16:58:07Z", "message": "Merge branch 'develop' into bluetooth-headset-disconnect"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "317291a334cddbfb6e1627da2864d07a73e9b6c2", "author": {"user": {"login": "ByteHamster", "name": null}}, "url": "https://github.com/AntennaPod/AntennaPod/commit/317291a334cddbfb6e1627da2864d07a73e9b6c2", "committedDate": "2021-07-11T17:00:02Z", "message": "Removed more unused code"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2657, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}