{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzcyMjEwMDI3", "number": 3839, "title": "Notification for Auto Downloads", "bodyText": "Resolves #2153.", "createdAt": "2020-02-07T02:55:28Z", "url": "https://github.com/AntennaPod/AntennaPod/pull/3839", "merged": true, "mergeCommit": {"oid": "38c1b559e3d3a7714a4fd0b1fe41ed94a1bcd526"}, "closed": true, "closedAt": "2020-03-26T18:22:05Z", "author": {"login": "shortspider"}, "timelineItems": {"totalCount": 28, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcB3D55gBqjMwMTYyODU2OTY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcRf88SgH2gAyMzcyMjEwMDI3OjEzY2ExYThkYmMwNDk1OGVkYTRhNDg4NjQyMTM5OTcyNjM3ZjZkMmY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2fa079d890cb8f87b76092a09c2e9c396a599c56", "author": {"user": null}, "url": "https://github.com/AntennaPod/AntennaPod/commit/2fa079d890cb8f87b76092a09c2e9c396a599c56", "committedDate": "2020-02-07T03:14:41Z", "message": "Fix build and tests"}, "afterCommit": {"oid": "26814568777f0a49fff5dd4a5de3f0493821c5d2", "author": {"user": null}, "url": "https://github.com/AntennaPod/AntennaPod/commit/26814568777f0a49fff5dd4a5de3f0493821c5d2", "committedDate": "2020-02-07T03:48:54Z", "message": "Fix build and tests"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9d5e27c76aeabe79b17f7634c8f0bf46d64a0527", "author": {"user": null}, "url": "https://github.com/AntennaPod/AntennaPod/commit/9d5e27c76aeabe79b17f7634c8f0bf46d64a0527", "committedDate": "2020-02-07T04:14:26Z", "message": "Simplify constructors"}, "afterCommit": {"oid": "4bdf5b5ce35dfa48b5f682ffa4e3ab0647714618", "author": {"user": {"login": "shortspider", "name": "Nathan Mascitelli"}}, "url": "https://github.com/AntennaPod/AntennaPod/commit/4bdf5b5ce35dfa48b5f682ffa4e3ab0647714618", "committedDate": "2020-02-07T16:42:46Z", "message": "Rename generatedBySystem to initiatedByUser"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU1NjA2MTIz", "url": "https://github.com/AntennaPod/AntennaPod/pull/3839#pullrequestreview-355606123", "createdAt": "2020-02-09T13:08:29Z", "commit": {"oid": "4bdf5b5ce35dfa48b5f682ffa4e3ab0647714618"}, "state": "COMMENTED", "comments": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wOVQxMzowODoyOVrOFnU_JA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wOVQxMzoyMDo1NVrOFnVCeA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njc4MjYyOA==", "bodyText": "This parameter seems to be always true. You can just remove it :)", "url": "https://github.com/AntennaPod/AntennaPod/pull/3839#discussion_r376782628", "createdAt": "2020-02-09T13:08:29Z", "author": {"login": "ByteHamster"}, "path": "app/src/main/java/de/danoeh/antennapod/activity/OnlineFeedViewActivity.java", "diffHunk": "@@ -225,7 +225,7 @@ public boolean onOptionsItemSelected(MenuItem item) {\n         return super.onOptionsItemSelected(item);\n     }\n \n-    private void startFeedDownload(String url, String username, String password) {\n+    private void startFeedDownload(String url, String username, String password, boolean initiatedByUser) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4bdf5b5ce35dfa48b5f682ffa4e3ab0647714618"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njc4MjY5OA==", "bodyText": "Please change the indentation, so it matches other items in the file.", "url": "https://github.com/AntennaPod/AntennaPod/pull/3839#discussion_r376782698", "createdAt": "2020-02-09T13:09:33Z", "author": {"login": "ByteHamster"}, "path": "app/src/main/res/xml/preferences_network.xml", "diffHunk": "@@ -35,6 +35,12 @@\n                 android:key=\"prefShowDownloadReport\"\n                 android:summary=\"@string/pref_showDownloadReport_sum\"\n                 android:title=\"@string/pref_showDownloadReport_title\"/>\n+        <SwitchPreference\n+            android:defaultValue=\"false\"\n+            android:enabled=\"true\"\n+            android:key=\"prefShowAutoDownloadReport\"\n+            android:summary=\"@string/pref_showAutoDownloadReport_sum\"\n+            android:title=\"@string/pref_showAutoDownloadReport_title\"/>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4bdf5b5ce35dfa48b5f682ffa4e3ab0647714618"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njc4Mjg2NQ==", "bodyText": "I do not think this is needed", "url": "https://github.com/AntennaPod/AntennaPod/pull/3839#discussion_r376782865", "createdAt": "2020-02-09T13:12:12Z", "author": {"login": "ByteHamster"}, "path": "core/src/main/java/de/danoeh/antennapod/core/storage/PodDBAdapter.java", "diffHunk": "@@ -110,6 +110,7 @@\n     public static final String KEY_INCLUDE_FILTER = \"include_filter\";\n     public static final String KEY_EXCLUDE_FILTER = \"exclude_filter\";\n     public static final String KEY_FEED_PLAYBACK_SPEED = \"feed_playback_speed\";\n+    public static final String KEY_INITIATED_BY_USER = \"initiated_by_user\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4bdf5b5ce35dfa48b5f682ffa4e3ab0647714618"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njc4MzAzMw==", "bodyText": "Please keep this line", "url": "https://github.com/AntennaPod/AntennaPod/pull/3839#discussion_r376783033", "createdAt": "2020-02-09T13:15:16Z", "author": {"login": "ByteHamster"}, "path": "core/src/main/java/de/danoeh/antennapod/core/service/download/DownloadServiceNotification.java", "diffHunk": "@@ -108,9 +108,11 @@ public void updateReport(List<DownloadStatus> reportQueue) {\n             if (status.isSuccessful()) {\n                 successfulDownloads++;\n             } else if (!status.isCancelled()) {\n-                createReport = true;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4bdf5b5ce35dfa48b5f682ffa4e3ab0647714618"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njc4MzEyNQ==", "bodyText": "This is only about auto download. Please do not add something related to failed downloads here.", "url": "https://github.com/AntennaPod/AntennaPod/pull/3839#discussion_r376783125", "createdAt": "2020-02-09T13:16:19Z", "author": {"login": "ByteHamster"}, "path": "core/src/main/java/de/danoeh/antennapod/core/service/download/DownloadServiceNotification.java", "diffHunk": "@@ -108,9 +108,11 @@ public void updateReport(List<DownloadStatus> reportQueue) {\n             if (status.isSuccessful()) {\n                 successfulDownloads++;\n             } else if (!status.isCancelled()) {\n-                createReport = true;\n                 failedDownloads++;\n             }\n+            if (failedDownloads > 0 || showAutoDownloadReport && !status.isInitiatedByUser() && status.getFeedfileType() == FeedMedia.FEEDFILETYPE_FEEDMEDIA) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4bdf5b5ce35dfa48b5f682ffa4e3ab0647714618"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njc4MzE4Nw==", "bodyText": "Instead of adding the field to DownloadStatus, please use status.getRequest().isInitiatedByUser(). Then we do not need another copy of the variable.", "url": "https://github.com/AntennaPod/AntennaPod/pull/3839#discussion_r376783187", "createdAt": "2020-02-09T13:17:22Z", "author": {"login": "ByteHamster"}, "path": "core/src/main/java/de/danoeh/antennapod/core/service/download/DownloadStatus.java", "diffHunk": "@@ -41,62 +41,49 @@\n \t * FEEDFILETYPE_FEEDIMAGE or FEEDFILETYPE_FEEDMEDIA\n \t */\n     private final int feedfileType;\n+    private final boolean initiatedByUser;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4bdf5b5ce35dfa48b5f682ffa4e3ab0647714618"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Njc4MzQ4MA==", "bodyText": "Users can also press the refresh button. I think this method might be called when users press the refresh button, so it is not always initiated by the system. Not sure what to pick here, though.", "url": "https://github.com/AntennaPod/AntennaPod/pull/3839#discussion_r376783480", "createdAt": "2020-02-09T13:20:55Z", "author": {"login": "ByteHamster"}, "path": "core/src/main/java/de/danoeh/antennapod/core/storage/DBTasks.java", "diffHunk": "@@ -199,11 +199,12 @@ private static void refreshFeeds(final Context context,\n                 } catch (DownloadRequestException e) {\n                     e.printStackTrace();\n                     DBWriter.addDownloadStatus(\n-                            new DownloadStatus(feed, feed\n-                                    .getHumanReadableIdentifier(),\n-                                    DownloadError.ERROR_REQUEST_ERROR, false, e\n-                                    .getMessage()\n-                            )\n+                            new DownloadStatus(feed,\n+                                               feed.getHumanReadableIdentifier(),\n+                                               DownloadError.ERROR_REQUEST_ERROR,\n+                                               false,\n+                                               e.getMessage(),\n+                                               false)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4bdf5b5ce35dfa48b5f682ffa4e3ab0647714618"}, "originalPosition": 14}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6f7dfbd41681c1d89c2ca9926d927d071bdb7945", "author": {"user": {"login": "shortspider", "name": "Nathan Mascitelli"}}, "url": "https://github.com/AntennaPod/AntennaPod/commit/6f7dfbd41681c1d89c2ca9926d927d071bdb7945", "committedDate": "2020-02-12T13:24:05Z", "message": "Remove unused constant"}, "afterCommit": {"oid": "787dadd0abbc2611e7fa9a772fad072e1fd9f999", "author": {"user": {"login": "shortspider", "name": "Nathan Mascitelli"}}, "url": "https://github.com/AntennaPod/AntennaPod/commit/787dadd0abbc2611e7fa9a772fad072e1fd9f999", "committedDate": "2020-02-12T13:34:59Z", "message": "Fix build after rebase"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzY2Mzg4NTc3", "url": "https://github.com/AntennaPod/AntennaPod/pull/3839#pullrequestreview-366388577", "createdAt": "2020-02-28T13:16:59Z", "commit": {"oid": "bd327f119b32cdf3b053eded9ed8ae3dfda42233"}, "state": "COMMENTED", "comments": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQxMzoxNjo1OVrOFv0mNQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0yOFQxMzozMjozOVrOFv1Cxw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTY4OTE0MQ==", "bodyText": "I think there should be two strings. One for auto downloads completed and one for failed downloads.", "url": "https://github.com/AntennaPod/AntennaPod/pull/3839#discussion_r385689141", "createdAt": "2020-02-28T13:16:59Z", "author": {"login": "ByteHamster"}, "path": "core/src/main/res/values/strings.xml", "diffHunk": "@@ -245,7 +245,7 @@\n     <string name=\"download_error_forbidden\">Forbidden</string>\n     <string name=\"download_canceled_msg\">Download canceled</string>\n     <string name=\"download_canceled_autodownload_enabled_msg\">Download canceled\\nDisabled <i>Auto Download</i> for this item</string>\n-    <string name=\"download_report_title\">Downloads completed with error(s)</string>\n+    <string name=\"download_report_title\">Downloads completed</string>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd327f119b32cdf3b053eded9ed8ae3dfda42233"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTY4OTcxMg==", "bodyText": "Maybe \"have been\" downloaded? \"were\" downloaded? Not a native English speaker but the notification is shown after the downloads were completed. \"Are\" sounds like the download is still running.", "url": "https://github.com/AntennaPod/AntennaPod/pull/3839#discussion_r385689712", "createdAt": "2020-02-28T13:18:26Z", "author": {"login": "ByteHamster"}, "path": "core/src/main/res/values/strings.xml", "diffHunk": "@@ -781,6 +783,8 @@\n     <string name=\"notification_channel_playing_description\">Allows to control playback. This is the main notification you see while playing a podcast.</string>\n     <string name=\"notification_channel_error\">Errors</string>\n     <string name=\"notification_channel_error_description\">Shown if something went wrong, for example if download or gpodder sync fails.</string>\n+    <string name=\"notification_channel_auto_download\">Auto Downloads</string>\n+    <string name=\"notification_channel_error_auto_download\">Shown when episodes are automatically downloaded.</string>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd327f119b32cdf3b053eded9ed8ae3dfda42233"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTY5MDYxNQ==", "bodyText": "Please break to a new line. The maximum line length should be 120 characters. This is currently not enforced by the CI because other parts of the app do not comply but I want new code to be consistent.", "url": "https://github.com/AntennaPod/AntennaPod/pull/3839#discussion_r385690615", "createdAt": "2020-02-28T13:20:26Z", "author": {"login": "ByteHamster"}, "path": "core/src/main/java/de/danoeh/antennapod/core/storage/DownloadRequester.java", "diffHunk": "@@ -203,25 +203,26 @@ public synchronized void downloadFeed(Context context, Feed feed, boolean loadAl\n             args.putBoolean(REQUEST_ARG_LOAD_ALL_PAGES, loadAllPages);\n \n             DownloadRequest request = createRequest(feed, null, new File(getFeedfilePath(), getFeedfileName(feed)),\n-                    true, username, password, lastModified, true, args);\n+                    true, username, password, lastModified, true, args, initiatedByUser\n+            );\n             if (request != null) {\n                 download(context, request);\n             }\n         }\n     }\n \n     public synchronized void downloadFeed(Context context, Feed feed) throws DownloadRequestException {\n-        downloadFeed(context, feed, false, false);\n+        downloadFeed(context, feed, false, false, true);\n     }\n \n-    public synchronized void downloadMedia(@NonNull Context context, FeedItem... feedItems)\n+    public synchronized void downloadMedia(@NonNull Context context, boolean initiatedByUser, FeedItem... feedItems)\n             throws DownloadRequestException {\n-        downloadMedia(true, context, feedItems);\n+        downloadMedia(true, context, initiatedByUser, feedItems);\n \n     }\n \n     @VisibleForTesting(otherwise = VisibleForTesting.PACKAGE_PRIVATE)\n-    public synchronized void downloadMedia(boolean performAutoCleanup, @NonNull Context context,\n+    public synchronized void downloadMedia(boolean performAutoCleanup, @NonNull Context context, boolean initiatedByUser,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd327f119b32cdf3b053eded9ed8ae3dfda42233"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTY5MjM5MQ==", "bodyText": "Please add a space after (byte)", "url": "https://github.com/AntennaPod/AntennaPod/pull/3839#discussion_r385692391", "createdAt": "2020-02-28T13:23:52Z", "author": {"login": "ByteHamster"}, "path": "core/src/main/java/de/danoeh/antennapod/core/service/download/DownloadRequest.java", "diffHunk": "@@ -107,6 +134,7 @@ public void writeToParcel(Parcel dest, int flags) {\n         dest.writeString(nonNullString(password));\n         dest.writeByte((mediaEnqueued) ? (byte) 1 : 0);\n         dest.writeBundle(arguments);\n+        dest.writeByte(initiatedByUser ? (byte)1 : 0);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd327f119b32cdf3b053eded9ed8ae3dfda42233"}, "originalPosition": 125}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTY5MjgwNA==", "bodyText": "To be honest, I think this is harder to read than before. This nearly fills the screen of my laptop vertically and is basically empty horizontally. Please break the lines, so that one line has more than one parameter.", "url": "https://github.com/AntennaPod/AntennaPod/pull/3839#discussion_r385692804", "createdAt": "2020-02-28T13:24:47Z", "author": {"login": "ByteHamster"}, "path": "core/src/main/java/de/danoeh/antennapod/core/service/download/DownloadRequest.java", "diffHunk": "@@ -38,50 +39,76 @@ public DownloadRequest(@NonNull String destination,\n                            String username,\n                            String password,\n                            boolean deleteOnFailure,\n-                           Bundle arguments) {\n+                           Bundle arguments,\n+                           boolean initiatedByUser) {\n+        this(destination,\n+             source,\n+             title,\n+             feedfileId,\n+             feedfileType,\n+             null,\n+             deleteOnFailure,\n+             username,\n+             password,\n+             false,\n+             arguments,\n+             initiatedByUser);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd327f119b32cdf3b053eded9ed8ae3dfda42233"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTY5MjkxOQ==", "bodyText": "Please add line breaks", "url": "https://github.com/AntennaPod/AntennaPod/pull/3839#discussion_r385692919", "createdAt": "2020-02-28T13:25:00Z", "author": {"login": "ByteHamster"}, "path": "core/src/main/java/de/danoeh/antennapod/core/service/download/DownloadRequest.java", "diffHunk": "@@ -258,6 +287,8 @@ public boolean isMediaEnqueued() {\n         return mediaEnqueued;\n     }\n \n+    public boolean isInitiatedByUser() { return initiatedByUser; }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd327f119b32cdf3b053eded9ed8ae3dfda42233"}, "originalPosition": 141}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTY5NTUwNQ==", "bodyText": "This file seems to be indented with tabs instead of spaces. While you are already touching big parts of the file, it would make sense to let Android Studio convert the file to spaces instead of tabs. That would also fix the strange indention above.", "url": "https://github.com/AntennaPod/AntennaPod/pull/3839#discussion_r385695505", "createdAt": "2020-02-28T13:30:31Z", "author": {"login": "ByteHamster"}, "path": "core/src/main/java/de/danoeh/antennapod/core/service/download/DownloadStatus.java", "diffHunk": "@@ -109,18 +95,41 @@ public static DownloadStatus fromCursor(Cursor cursor) {\n \t\tint indexCompletionDate = cursor.getColumnIndex(PodDBAdapter.KEY_COMPLETION_DATE);\n \t\tint indexReasonDetailed = cursor.getColumnIndex(PodDBAdapter.KEY_REASON_DETAILED);\n \n-\t\tlong id = cursor.getLong(indexId);\n-\t\tString title = cursor.getString(indexTitle);\n-\t\tlong feedfileId = cursor.getLong(indexFeedFile);\n-\t\tint feedfileType = cursor.getInt(indexFileFileType);\n-\t\tboolean successful = cursor.getInt(indexSuccessful) > 0;\n-\t\tint reason = cursor.getInt(indexReason);\n-\t\tDate completionDate = new Date(cursor.getLong(indexCompletionDate));\n-\t\tString reasonDetailed = cursor.getString(indexReasonDetailed);\n-\n-\t\treturn new DownloadStatus(id, title, feedfileId,\n-\t\t\t\tfeedfileType, successful, DownloadError.fromCode(reason), completionDate,\n-\t\t\t\treasonDetailed);\n+\t\treturn new DownloadStatus(cursor.getLong(indexId),\n+\t\t\t\t\t\t\t\t  cursor.getString(indexTitle),\n+\t\t\t\t\t\t\t\t  cursor.getLong(indexFeedFile),\n+\t\t\t\t\t\t\t\t  cursor.getInt(indexFileFileType),\n+\t\t\t\t\t\t\t\t  cursor.getInt(indexSuccessful) > 0,\n+\t\t\t\t\t\t\t\t  false,\n+\t\t\t\t\t\t\t\t  true,\n+\t\t\t\t\t\t\t\t  DownloadError.fromCode(cursor.getInt(indexReason)),\n+\t\t\t\t\t\t\t\t  new Date(cursor.getLong(indexCompletionDate)),\n+\t\t\t\t\t\t\t\t  cursor.getString(indexReasonDetailed),\n+\t\t\t\t\t\t\t\t  false);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd327f119b32cdf3b053eded9ed8ae3dfda42233"}, "originalPosition": 123}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTY5NjQ1NQ==", "bodyText": "Just wondering... The two kinds of notifications are now quite different (Channel, text, maybe even icon). Would it make sense to extract the auto download notification to a new class instead of handling everything in the existing notificationManager? I have not checked if this will lead to a lot of code duplication, though.", "url": "https://github.com/AntennaPod/AntennaPod/pull/3839#discussion_r385696455", "createdAt": "2020-02-28T13:32:39Z", "author": {"login": "ByteHamster"}, "path": "core/src/main/java/de/danoeh/antennapod/core/service/download/DownloadService.java", "diffHunk": "@@ -205,9 +205,10 @@ public void onDestroy() {\n         Log.d(TAG, \"Service shutting down\");\n         isRunning = false;\n \n+        boolean showAutoDownloadReport = UserPreferences.showAutoDownloadReport();\n         if (ClientConfig.downloadServiceCallbacks.shouldCreateReport()\n-                && UserPreferences.showDownloadReport()) {\n-            notificationManager.updateReport(reportQueue);\n+                && (UserPreferences.showDownloadReport() || showAutoDownloadReport)) {\n+            notificationManager.updateReport(reportQueue, showAutoDownloadReport);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bd327f119b32cdf3b053eded9ed8ae3dfda42233"}, "originalPosition": 9}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0defc6803b2411dc4ffa8f220a3450aa726d517e", "author": {"user": {"login": "shortspider", "name": "Nathan Mascitelli"}}, "url": "https://github.com/AntennaPod/AntennaPod/commit/0defc6803b2411dc4ffa8f220a3450aa726d517e", "committedDate": "2020-03-12T19:56:56Z", "message": "Autodownload notification opens queue"}, "afterCommit": {"oid": "7717669c9d045efe8807d762b3283e6d5ef06bb7", "author": {"user": {"login": "shortspider", "name": "Nathan Mascitelli"}}, "url": "https://github.com/AntennaPod/AntennaPod/commit/7717669c9d045efe8807d762b3283e6d5ef06bb7", "committedDate": "2020-03-12T20:05:30Z", "message": "Autodownload notification opens queue"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc2MTA0NTE3", "url": "https://github.com/AntennaPod/AntennaPod/pull/3839#pullrequestreview-376104517", "createdAt": "2020-03-17T14:46:44Z", "commit": {"oid": "7717669c9d045efe8807d762b3283e6d5ef06bb7"}, "state": "COMMENTED", "comments": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNDo0Njo0NFrOF3fmSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0xN1QxNTowMDo1MVrOF3gPOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzczMzcwNg==", "bodyText": "Please use request.getTitle() instead of feed.getHumanReadableIdentifier(): In this case, feed does not have a human readable title yet", "url": "https://github.com/AntennaPod/AntennaPod/pull/3839#discussion_r393733706", "createdAt": "2020-03-17T14:46:44Z", "author": {"login": "ByteHamster"}, "path": "core/src/main/java/de/danoeh/antennapod/core/service/download/handler/FeedParserTask.java", "diffHunk": "@@ -78,12 +78,12 @@ public FeedHandlerResult call() {\n         }\n \n         if (successful) {\n-            downloadStatus = new DownloadStatus(feed, feed.getHumanReadableIdentifier(),\n-                    DownloadError.SUCCESS, successful, reasonDetailed);\n+            downloadStatus = new DownloadStatus(feed, feed.getHumanReadableIdentifier(), DownloadError.SUCCESS,\n+                                                successful, reasonDetailed, request.isInitiatedByUser());\n             return result;\n         } else {\n-            downloadStatus = new DownloadStatus(feed, request.getTitle(),\n-                    reason, successful, reasonDetailed);\n+            downloadStatus = new DownloadStatus(feed, feed.getHumanReadableIdentifier(), reason, successful,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7717669c9d045efe8807d762b3283e6d5ef06bb7"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzczNTYyOQ==", "bodyText": "Why _error_auto_download? This is not related to errors, I think.", "url": "https://github.com/AntennaPod/AntennaPod/pull/3839#discussion_r393735629", "createdAt": "2020-03-17T14:49:22Z", "author": {"login": "ByteHamster"}, "path": "core/src/main/res/values/strings.xml", "diffHunk": "@@ -782,6 +785,8 @@\n     <string name=\"notification_channel_playing_description\">Allows to control playback. This is the main notification you see while playing a podcast.</string>\n     <string name=\"notification_channel_error\">Errors</string>\n     <string name=\"notification_channel_error_description\">Shown if something went wrong, for example if download or gpodder sync fails.</string>\n+    <string name=\"notification_channel_auto_download\">Auto Downloads</string>\n+    <string name=\"notification_channel_error_auto_download\">Shown when episodes have been automatically downloaded.</string>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7717669c9d045efe8807d762b3283e6d5ef06bb7"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzczNzI2OA==", "bodyText": "Maybe \"Show a notification for automatically downloaded episodes\" could be easier to understand", "url": "https://github.com/AntennaPod/AntennaPod/pull/3839#discussion_r393737268", "createdAt": "2020-03-17T14:51:31Z", "author": {"login": "ByteHamster"}, "path": "core/src/main/res/values/strings.xml", "diffHunk": "@@ -477,6 +478,8 @@\n     <string name=\"pref_lockscreen_background_sum\">Set the lockscreen background to the current episode\\'s image. As a side effect, this will also show the image in third party apps.</string>\n     <string name=\"pref_showDownloadReport_title\">Show Download Report</string>\n     <string name=\"pref_showDownloadReport_sum\">If downloads fail, generate a report that shows the details of the failure.</string>\n+    <string name=\"pref_showAutoDownloadReport_title\">Show Auto Download Report</string>\n+    <string name=\"pref_showAutoDownloadReport_sum\">Generate a report that shows the details of auto downloaded episodes.</string>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7717669c9d045efe8807d762b3283e6d5ef06bb7"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzczNzUwOQ==", "bodyText": "Auto-downloads completed?", "url": "https://github.com/AntennaPod/AntennaPod/pull/3839#discussion_r393737509", "createdAt": "2020-03-17T14:51:51Z", "author": {"login": "ByteHamster"}, "path": "core/src/main/res/values/strings.xml", "diffHunk": "@@ -245,6 +245,7 @@\n     <string name=\"download_canceled_msg\">Download canceled</string>\n     <string name=\"download_canceled_autodownload_enabled_msg\">Download canceled\\nDisabled <i>Auto Download</i> for this item</string>\n     <string name=\"download_report_title\">Downloads completed with error(s)</string>\n+    <string name=\"auto_download_report_title\">Downloads completed</string>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7717669c9d045efe8807d762b3283e6d5ef06bb7"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzczNzk5OA==", "bodyText": "I think the description string is wrong. Should be the new one for auto download\nCould you please use the same formatting as the rest of the file, so that it looks more even?", "url": "https://github.com/AntennaPod/AntennaPod/pull/3839#discussion_r393737998", "createdAt": "2020-03-17T14:52:35Z", "author": {"login": "ByteHamster"}, "path": "core/src/main/java/de/danoeh/antennapod/core/util/gui/NotificationUtils.java", "diffHunk": "@@ -62,4 +64,14 @@ private static NotificationChannel createChannelError(Context c) {\n         mChannel.setDescription(c.getString(R.string.notification_channel_error_description));\n         return mChannel;\n     }\n+\n+    @RequiresApi(api = Build.VERSION_CODES.O)\n+    private static NotificationChannel createChannelAutoDownload(Context c) {\n+        NotificationChannel mChannel = new NotificationChannel(\n+                                            CHANNEL_ID_AUTO_DOWNLOAD,\n+                                            c.getString(R.string.notification_channel_auto_download),\n+                                            NotificationManager.IMPORTANCE_DEFAULT);\n+        mChannel.setDescription(c.getString(R.string.notification_channel_downloading_description));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7717669c9d045efe8807d762b3283e6d5ef06bb7"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzczOTc0Ng==", "bodyText": "I think createReport |= ... would be easier to read because you do not need to think about operator precedence", "url": "https://github.com/AntennaPod/AntennaPod/pull/3839#discussion_r393739746", "createdAt": "2020-03-17T14:55:00Z", "author": {"login": "ByteHamster"}, "path": "core/src/main/java/de/danoeh/antennapod/core/service/download/DownloadServiceNotification.java", "diffHunk": "@@ -107,29 +107,28 @@ public void updateReport(List<DownloadStatus> reportQueue) {\n         for (DownloadStatus status : reportQueue) {\n             if (status.isSuccessful()) {\n                 successfulDownloads++;\n+                createReport = createReport || showAutoDownloadReport && !status.isInitiatedByUser() && status.getFeedfileType() == FeedMedia.FEEDFILETYPE_FEEDMEDIA;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7717669c9d045efe8807d762b3283e6d5ef06bb7"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc0MDU5Ng==", "bodyText": "I think it would make sense to create a second method here.", "url": "https://github.com/AntennaPod/AntennaPod/pull/3839#discussion_r393740596", "createdAt": "2020-03-17T14:56:08Z", "author": {"login": "ByteHamster"}, "path": "app/src/main/java/de/danoeh/antennapod/config/DownloadServiceCallbacksImpl.java", "diffHunk": "@@ -38,13 +39,15 @@ public PendingIntent getAuthentificationNotificationContentIntent(Context contex\n     }\n \n     @Override\n-    public PendingIntent getReportNotificationContentIntent(Context context) {\n+    public PendingIntent getReportNotificationContentIntent(Context context, boolean autoDownloadReport) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7717669c9d045efe8807d762b3283e6d5ef06bb7"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc0MTY2Nw==", "bodyText": "IMO if we did create another class there would be a fair bit of duplication.\n\n\ud83d\udc4d", "url": "https://github.com/AntennaPod/AntennaPod/pull/3839#discussion_r393741667", "createdAt": "2020-03-17T14:57:36Z", "author": {"login": "ByteHamster"}, "path": "core/src/main/java/de/danoeh/antennapod/core/service/download/DownloadService.java", "diffHunk": "@@ -205,9 +205,10 @@ public void onDestroy() {\n         Log.d(TAG, \"Service shutting down\");\n         isRunning = false;\n \n+        boolean showAutoDownloadReport = UserPreferences.showAutoDownloadReport();\n         if (ClientConfig.downloadServiceCallbacks.shouldCreateReport()\n-                && UserPreferences.showDownloadReport()) {\n-            notificationManager.updateReport(reportQueue);\n+                && (UserPreferences.showDownloadReport() || showAutoDownloadReport)) {\n+            notificationManager.updateReport(reportQueue, showAutoDownloadReport);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTY5NjQ1NQ=="}, "originalCommit": {"oid": "bd327f119b32cdf3b053eded9ed8ae3dfda42233"}, "originalPosition": 9}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzc0NDE4NQ==", "bodyText": "Please use the same string for ticker and content title. Also, I think it would be easier to read the code if you copied the notification builder code: if(autoDownloadReport){...}else{...} instead of using the ? operator in basically every line.", "url": "https://github.com/AntennaPod/AntennaPod/pull/3839#discussion_r393744185", "createdAt": "2020-03-17T15:00:51Z", "author": {"login": "ByteHamster"}, "path": "core/src/main/java/de/danoeh/antennapod/core/service/download/DownloadServiceNotification.java", "diffHunk": "@@ -107,29 +107,28 @@ public void updateReport(List<DownloadStatus> reportQueue) {\n         for (DownloadStatus status : reportQueue) {\n             if (status.isSuccessful()) {\n                 successfulDownloads++;\n+                createReport = createReport || showAutoDownloadReport && !status.isInitiatedByUser() && status.getFeedfileType() == FeedMedia.FEEDFILETYPE_FEEDMEDIA;\n             } else if (!status.isCancelled()) {\n-                createReport = true;\n                 failedDownloads++;\n+                createReport = true;\n             }\n         }\n \n         if (createReport) {\n             Log.d(TAG, \"Creating report\");\n+\n             // create notification object\n-            NotificationCompat.Builder builder = new NotificationCompat.Builder(context,\n-                    NotificationUtils.CHANNEL_ID_ERROR)\n-                    .setTicker(context.getString(R.string.download_report_title))\n-                    .setContentTitle(context.getString(R.string.download_report_content_title))\n-                    .setContentText(\n-                            String.format(\n-                                    context.getString(R.string.download_report_content),\n-                                    successfulDownloads, failedDownloads)\n-                    )\n-                    .setSmallIcon(R.drawable.stat_notify_sync_error)\n-                    .setContentIntent(\n-                            ClientConfig.downloadServiceCallbacks.getReportNotificationContentIntent(context)\n-                    )\n-                    .setAutoCancel(true);\n+            boolean autoDownloadReport = failedDownloads == 0;\n+            String channelId = autoDownloadReport ? NotificationUtils.CHANNEL_ID_AUTO_DOWNLOAD : NotificationUtils.CHANNEL_ID_ERROR;\n+            int titleId = autoDownloadReport ? R.string.auto_download_report_title : R.string.download_report_title;\n+\n+            NotificationCompat.Builder builder = new NotificationCompat.Builder(context, channelId);\n+            builder.setTicker(context.getString(titleId))\n+                   .setContentTitle(context.getString(R.string.download_report_content_title))", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7717669c9d045efe8807d762b3283e6d5ef06bb7"}, "originalPosition": 45}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b5244bbe99e423bfe5a2377728a086343a4c2fff", "author": {"user": {"login": "shortspider", "name": "Nathan Mascitelli"}}, "url": "https://github.com/AntennaPod/AntennaPod/commit/b5244bbe99e423bfe5a2377728a086343a4c2fff", "committedDate": "2020-03-22T20:19:31Z", "message": "Add generatedBySystem to DownloadRequest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "895af777cf761aa0edba7b89dd04318ab6ede1d2", "author": {"user": {"login": "shortspider", "name": "Nathan Mascitelli"}}, "url": "https://github.com/AntennaPod/AntennaPod/commit/895af777cf761aa0edba7b89dd04318ab6ede1d2", "committedDate": "2020-03-22T20:19:31Z", "message": "Add generatedBySystem to DownloadStatus"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "39e0d20ae7db2bf263ba02ebd9cfaccd5988a96f", "author": {"user": {"login": "shortspider", "name": "Nathan Mascitelli"}}, "url": "https://github.com/AntennaPod/AntennaPod/commit/39e0d20ae7db2bf263ba02ebd9cfaccd5988a96f", "committedDate": "2020-03-22T20:19:31Z", "message": "Create report if download generated by system"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1eaecf8358b3c5a9b946fa5283f6f60051dbc7b5", "author": {"user": {"login": "shortspider", "name": "Nathan Mascitelli"}}, "url": "https://github.com/AntennaPod/AntennaPod/commit/1eaecf8358b3c5a9b946fa5283f6f60051dbc7b5", "committedDate": "2020-03-22T20:19:31Z", "message": "Add preferences"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bbc994fc9bf4e066e80af624ee4329f95ac8db4b", "author": {"user": {"login": "shortspider", "name": "Nathan Mascitelli"}}, "url": "https://github.com/AntennaPod/AntennaPod/commit/bbc994fc9bf4e066e80af624ee4329f95ac8db4b", "committedDate": "2020-03-22T20:25:04Z", "message": "Fix build and tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "71f57bda32b942320b564ad68d0919fab0a77378", "author": {"user": {"login": "shortspider", "name": "Nathan Mascitelli"}}, "url": "https://github.com/AntennaPod/AntennaPod/commit/71f57bda32b942320b564ad68d0919fab0a77378", "committedDate": "2020-03-22T20:25:04Z", "message": "Simplify constructors"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5d70a3cc38f561a95050fb552194d8b4ab4ef56d", "author": {"user": {"login": "shortspider", "name": "Nathan Mascitelli"}}, "url": "https://github.com/AntennaPod/AntennaPod/commit/5d70a3cc38f561a95050fb552194d8b4ab4ef56d", "committedDate": "2020-03-22T20:25:57Z", "message": "Rename generatedBySystem to initiatedByUser"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd4631126d55aa91df2b83aebd5afa1e8ef0c841", "author": {"user": {"login": "shortspider", "name": "Nathan Mascitelli"}}, "url": "https://github.com/AntennaPod/AntennaPod/commit/bd4631126d55aa91df2b83aebd5afa1e8ef0c841", "committedDate": "2020-03-22T20:25:57Z", "message": "Updates based on QA feedback"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f7c520bc65c2c8c102f22c1a4d1e7eb5c7d8ad38", "author": {"user": {"login": "shortspider", "name": "Nathan Mascitelli"}}, "url": "https://github.com/AntennaPod/AntennaPod/commit/f7c520bc65c2c8c102f22c1a4d1e7eb5c7d8ad38", "committedDate": "2020-03-22T20:25:57Z", "message": "Remove unused constant"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "052c86f43b8646cda322ae592cdf0cce6f186340", "author": {"user": {"login": "shortspider", "name": "Nathan Mascitelli"}}, "url": "https://github.com/AntennaPod/AntennaPod/commit/052c86f43b8646cda322ae592cdf0cce6f186340", "committedDate": "2020-03-22T20:25:57Z", "message": "Fix build after rebase"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7a93f1e513c3616cebd88567fc701578cef357f1", "author": {"user": {"login": "shortspider", "name": "Nathan Mascitelli"}}, "url": "https://github.com/AntennaPod/AntennaPod/commit/7a93f1e513c3616cebd88567fc701578cef357f1", "committedDate": "2020-03-22T20:25:57Z", "message": "Add new notification channel"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "576baf90d874834dc3c0c9d52e40a0882a5c9136", "author": {"user": {"login": "shortspider", "name": "Nathan Mascitelli"}}, "url": "https://github.com/AntennaPod/AntennaPod/commit/576baf90d874834dc3c0c9d52e40a0882a5c9136", "committedDate": "2020-03-22T20:25:57Z", "message": "Requested changes from review feedback"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ad54ed3ec6685ade44e0238841569e0dd3187903", "author": {"user": {"login": "shortspider", "name": "Nathan Mascitelli"}}, "url": "https://github.com/AntennaPod/AntennaPod/commit/ad54ed3ec6685ade44e0238841569e0dd3187903", "committedDate": "2020-03-22T20:27:28Z", "message": "Autodownload notification opens queue"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f82f9d702c90577737c2073f7bfc2ef64a6b9b7c", "author": {"user": {"login": "shortspider", "name": "Nathan Mascitelli"}}, "url": "https://github.com/AntennaPod/AntennaPod/commit/f82f9d702c90577737c2073f7bfc2ef64a6b9b7c", "committedDate": "2020-03-22T20:28:51Z", "message": "Changes based on feedback"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "b1008591c6457dae7e8b6bd0c4171a82fb3e3ceb", "author": {"user": {"login": "shortspider", "name": "Nathan Mascitelli"}}, "url": "https://github.com/AntennaPod/AntennaPod/commit/b1008591c6457dae7e8b6bd0c4171a82fb3e3ceb", "committedDate": "2020-03-22T20:15:27Z", "message": "Changes based on feedback"}, "afterCommit": {"oid": "f82f9d702c90577737c2073f7bfc2ef64a6b9b7c", "author": {"user": {"login": "shortspider", "name": "Nathan Mascitelli"}}, "url": "https://github.com/AntennaPod/AntennaPod/commit/f82f9d702c90577737c2073f7bfc2ef64a6b9b7c", "committedDate": "2020-03-22T20:28:51Z", "message": "Changes based on feedback"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "16345468e33fb8252986c9ebfb26f3b0ad3a3c23", "author": {"user": {"login": "shortspider", "name": "Nathan Mascitelli"}}, "url": "https://github.com/AntennaPod/AntennaPod/commit/16345468e33fb8252986c9ebfb26f3b0ad3a3c23", "committedDate": "2020-03-22T20:31:43Z", "message": "Fix build after rebase"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c2d87f57e584ebf4e85a1cf098da4ab6f224db58", "author": {"user": {"login": "shortspider", "name": "Nathan Mascitelli"}}, "url": "https://github.com/AntennaPod/AntennaPod/commit/c2d87f57e584ebf4e85a1cf098da4ab6f224db58", "committedDate": "2020-03-25T00:03:04Z", "message": "Use different ids"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "125fa3932e84b7b13c9994b07b82abc8656bd0f9", "author": {"user": {"login": "shortspider", "name": "Nathan Mascitelli"}}, "url": "https://github.com/AntennaPod/AntennaPod/commit/125fa3932e84b7b13c9994b07b82abc8656bd0f9", "committedDate": "2020-03-25T00:48:35Z", "message": "List episodes that are downloaded"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9637734000d399ffaa8739f5a3f1c1624b2a6a37", "author": {"user": {"login": "shortspider", "name": "Nathan Mascitelli"}}, "url": "https://github.com/AntennaPod/AntennaPod/commit/9637734000d399ffaa8739f5a3f1c1624b2a6a37", "committedDate": "2020-03-25T01:12:02Z", "message": "Add and use new icon"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "11ef58f5920cadadeb8e3f34fce14ce8ff005dc8", "author": {"user": {"login": "ByteHamster", "name": null}}, "url": "https://github.com/AntennaPod/AntennaPod/commit/11ef58f5920cadadeb8e3f34fce14ce8ff005dc8", "committedDate": "2020-03-26T16:17:52Z", "message": "Merge branch 'develop' into NotificationForAutoDownloads"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "13ca1a8dbc04958eda4a488642139972637f6d2f", "author": {"user": {"login": "ByteHamster", "name": null}}, "url": "https://github.com/AntennaPod/AntennaPod/commit/13ca1a8dbc04958eda4a488642139972637f6d2f", "committedDate": "2020-03-26T17:56:25Z", "message": "Removed unused StringBuilder"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2869, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}