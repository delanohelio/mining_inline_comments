{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDg0MDA2NDcz", "number": 4417, "title": "Google Assistant App Actions for AntennaPod", "bodyText": "This pull request adds support for Google Assistant App Actions in AntennaPod. Demo videos available here and here.\nApp Actions Overview\nApp Actions let developers integrate their mobile applications with Google Assistant to enable tasks in the app directly from the Assistant. App Actions are supported on Android 5 (API level 21) and higher. Further documentation available here.\nImplemented Features\nThis pull request implements the \u201cOpen app feature\u201d built-in intent to enable users to navigate to the most relevant features of AntennaPod, like Downloads, Subscriptions, Playback History, Queue and Episodes directly from the Assistant with queries like \u201cOpen Downloads on AntennaPod\u201d or \u201cShow me History on AntennaPod\u201d.\nIt also implements the \u201cGet thing\u201d built-in intent to enable users to use the in-app search of AntennaPod directly from the Google Assistant with queries like \u201cSearch for BBC on AntennaPod\u201d.\nTesting\nIt can be tested with the App Actions test tool plugin in Android Studio. App Actions can only be tested with a physical device.\nDeployment\nThere are further steps required to be taken by the maintainers for deployment, including uploading the app (containing actions.xml) to the Google Play console for publishing as well as filling out a deployment request form (sample answers below). Guidelines for deployment can be found here and here.\nSuggested answers for the deployment form:\nSummary: Navigate to the popular features and perform in-app search from Google Assistant.\nDescription: Examples of supported queries include \u201cOpen Downloads on AntennaPod\u201d, \u201cShow me History on AntennaPod\u201d, \u201cSearch for BBC on AntennaPod\u201d.\nThis project was a part of Google STEP internship.\nCloses #3806", "createdAt": "2020-09-10T15:32:47Z", "url": "https://github.com/AntennaPod/AntennaPod/pull/4417", "merged": true, "mergeCommit": {"oid": "cd23eccf95d1a6c7193953c3f24a2fac4f32c97f"}, "closed": true, "closedAt": "2021-01-24T14:41:56Z", "author": {"login": "mgborowiec"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdHh7qCAH2gAyNDg0MDA2NDczOjFlNjA0MzU4YmE4OTU4YzQ5NTE1MDFkYTA3Mjg5OTJkOTBiM2FmNjE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdzS9klgH2gAyNDg0MDA2NDczOjk2MjljYzZiYjFhYzdiMTY2NjMwOTBlYTljMTM4YWVjZmFiODQyZjA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1e604358ba8958c4951501da0728992d90b3af61", "author": {"user": {"login": "mgborowiec", "name": "Margaret Borowiec"}}, "url": "https://github.com/AntennaPod/AntennaPod/commit/1e604358ba8958c4951501da0728992d90b3af61", "committedDate": "2020-09-10T14:46:44Z", "message": "Added actions.xml"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cbc7f5ad7bd693132d4f5e55daabe3d1947c5507", "author": {"user": {"login": "mgborowiec", "name": "Margaret Borowiec"}}, "url": "https://github.com/AntennaPod/AntennaPod/commit/cbc7f5ad7bd693132d4f5e55daabe3d1947c5507", "committedDate": "2020-09-10T14:52:06Z", "message": "Added functionality to handle incoming intents and deeplinks"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eb5add27f79d3a208a7c844c64df460feae70391", "author": {"user": {"login": "mgborowiec", "name": "Margaret Borowiec"}}, "url": "https://github.com/AntennaPod/AntennaPod/commit/eb5add27f79d3a208a7c844c64df460feae70391", "committedDate": "2020-09-10T14:52:09Z", "message": "Made changes to handling deeplinks and intents in MainActivity. Added comments and specified entity set in actions.xml."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bb515d9624de5a3b021c9a3ea6805ddf40ab60b2", "author": {"user": {"login": "mgborowiec", "name": "Margaret Borowiec"}}, "url": "https://github.com/AntennaPod/AntennaPod/commit/bb515d9624de5a3b021c9a3ea6805ddf40ab60b2", "committedDate": "2020-09-10T14:56:26Z", "message": "Implemented in-app search with Google Assistant (#2)\n\n* Implemented in-app search with Google Assistant\n\n* Updated a comment to split long sentences"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "376f4730017d002208e7cf2dd93b04754970ce67", "author": {"user": {"login": "mgborowiec", "name": "Margaret Borowiec"}}, "url": "https://github.com/AntennaPod/AntennaPod/commit/376f4730017d002208e7cf2dd93b04754970ce67", "committedDate": "2020-09-10T14:56:29Z", "message": "App actions search (#3)\n\n* Implemented in-app search with Google Assistant\r\n\r\n* Updated a comment to split long sentences\r\n\r\n* Change urls to match the original package name"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "25c3429d5587e3e280ba35699c454816a02fe73d", "author": {"user": {"login": "mgborowiec", "name": "Margaret Borowiec"}}, "url": "https://github.com/AntennaPod/AntennaPod/commit/25c3429d5587e3e280ba35699c454816a02fe73d", "committedDate": "2020-09-10T15:06:48Z", "message": "Updated imports in Main Activity"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg3MjUyMjQy", "url": "https://github.com/AntennaPod/AntennaPod/pull/4417#pullrequestreview-487252242", "createdAt": "2020-09-12T19:44:05Z", "commit": {"oid": "25c3429d5587e3e280ba35699c454816a02fe73d"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMlQxOTo0NDowNVrOHQ3GRw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMlQxOTo0NzowNlrOHQ3HVA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQ0MTk5MQ==", "bodyText": "This can be any URL, right? Is there a best-practice what to use? What do you think about using https://antennapod.org/deeplink/search{?query}", "url": "https://github.com/AntennaPod/AntennaPod/pull/4417#discussion_r487441991", "createdAt": "2020-09-12T19:44:05Z", "author": {"login": "ByteHamster"}, "path": "app/src/main/res/xml/actions.xml", "diffHunk": "@@ -0,0 +1,33 @@\n+<?xml version =\"1.0\" encoding =\"utf-8\"?>\n+<!--  You can learn more about App Actions and how to use them in the documentation:\n+https://developers.google.com/assistant/app/overview -->\n+\n+<actions>\n+    <action intentName=\"actions.intent.OPEN_APP_FEATURE\">\n+        <fulfillment urlTemplate=\"https://de.danoeh.antennapod/main{?featureName}\">\n+            <parameter-mapping\n+                intentParameter=\"feature\"\n+                urlParameter=\"featureName\" />\n+        </fulfillment>\n+        <parameter name=\"feature\">\n+            <entity-set-reference entitySetId=\"featureEntitySet\" />\n+        </parameter>\n+    </action>\n+\n+    <action intentName=\"actions.intent.GET_THING\">\n+        <fulfillment urlTemplate=\"https://de.danoeh.antennapod/search{?query}\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25c3429d5587e3e280ba35699c454816a02fe73d"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQ0MjE3MQ==", "bodyText": "This looks pretty similar to the switch in loadFragment. Could that one be re-used instead of creating another switch?", "url": "https://github.com/AntennaPod/AntennaPod/pull/4417#discussion_r487442171", "createdAt": "2020-09-12T19:45:46Z", "author": {"login": "ByteHamster"}, "path": "app/src/main/java/de/danoeh/antennapod/activity/MainActivity.java", "diffHunk": "@@ -511,4 +543,57 @@ public Snackbar showSnackbarAbovePlayer(CharSequence text, int duration) {\n     public Snackbar showSnackbarAbovePlayer(int text, int duration) {\n         return showSnackbarAbovePlayer(getResources().getText(text), duration);\n     }\n+\n+    /**\n+     * Handles the deep link incoming via App Actions.\n+     * Performs an in-app search or opens the relevant feature of the app\n+     * depending on the query.\n+     *\n+     * @param uri incoming deep link\n+     */\n+    private void handleDeeplink(Uri uri) {\n+        if (uri == null || uri.getPath() == null) {\n+           return;\n+        }\n+\n+        switch (uri.getPath()) {\n+            case \"/search\":\n+                String query = uri.getQueryParameter(\"query\");\n+                if (query == null) {\n+                    return;\n+                }\n+\n+                this.loadChildFragment(OnlineSearchFragment.newInstance(CombinedSearcher.class, query));\n+                break;\n+\n+            case \"/main\":\n+                String feature = uri.getQueryParameter(\"featureName\");\n+                if (feature == null) {\n+                    return;\n+                }\n+\n+                feature = feature.toLowerCase();\n+                switch (feature) {\n+                    case \"downloads\":", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25c3429d5587e3e280ba35699c454816a02fe73d"}, "originalPosition": 110}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQ0MjI2MA==", "bodyText": "We already have a function named handleNavIntent. Could those functions be combined? They seem to do pretty similar things.", "url": "https://github.com/AntennaPod/AntennaPod/pull/4417#discussion_r487442260", "createdAt": "2020-09-12T19:47:06Z", "author": {"login": "ByteHamster"}, "path": "app/src/main/java/de/danoeh/antennapod/activity/MainActivity.java", "diffHunk": "@@ -492,6 +498,32 @@ private void handleNavIntent() {\n     protected void onNewIntent(Intent intent) {\n         super.onNewIntent(intent);\n         setIntent(intent);\n+\n+        handleIntent(intent);\n+    }\n+\n+    /**\n+     *  Handles the incoming intent. If the activity was launched via a deep link,\n+     *  passes the uri to handleDeeplink().\n+     *\n+     *  Added an SDK version check since the minimum SDK supported by AntennaPod is 16\n+     *  and Object.equals(Obj1, Obj2) is only supported in API 19+.\n+     *\n+     * @param intent incoming intent\n+     */\n+    private void handleIntent(Intent intent) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "25c3429d5587e3e280ba35699c454816a02fe73d"}, "originalPosition": 59}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "02128be7a80301193bb70ab5fb4567959dc06d6f", "author": {"user": {"login": "mgborowiec", "name": "Margaret Borowiec"}}, "url": "https://github.com/AntennaPod/AntennaPod/commit/02128be7a80301193bb70ab5fb4567959dc06d6f", "committedDate": "2020-09-15T11:32:48Z", "message": "Code changes to deal with static analysis fails"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "817dbea5952c40d8ae3d9398a4e11bd8c6bbade1", "author": {"user": {"login": "mgborowiec", "name": "Margaret Borowiec"}}, "url": "https://github.com/AntennaPod/AntennaPod/commit/817dbea5952c40d8ae3d9398a4e11bd8c6bbade1", "committedDate": "2020-09-15T11:34:33Z", "message": "URL change for App Actions"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1f1ec18b84b1d670ce7daa550245b0b9b1fe745b", "author": {"user": {"login": "mgborowiec", "name": "Margaret Borowiec"}}, "url": "https://github.com/AntennaPod/AntennaPod/commit/1f1ec18b84b1d670ce7daa550245b0b9b1fe745b", "committedDate": "2020-09-15T11:43:20Z", "message": "Referenced actions.xml in AndroidManifest"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3MDk0MzU3", "url": "https://github.com/AntennaPod/AntennaPod/pull/4417#pullrequestreview-497094357", "createdAt": "2020-09-27T16:45:20Z", "commit": {"oid": "1f1ec18b84b1d670ce7daa550245b0b9b1fe745b"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yN1QxNjo0NToyMFrOHYogcg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yN1QxNzowMTo1MVrOHYomnQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTU5MTUzOA==", "bodyText": "Can the name be a @string/ resource, too? That would allow localization of the screen names.", "url": "https://github.com/AntennaPod/AntennaPod/pull/4417#discussion_r495591538", "createdAt": "2020-09-27T16:45:20Z", "author": {"login": "ByteHamster"}, "path": "app/src/main/res/xml/actions.xml", "diffHunk": "@@ -0,0 +1,33 @@\n+<?xml version =\"1.0\" encoding =\"utf-8\"?>\n+<!--  You can learn more about App Actions and how to use them in the documentation:\n+https://developers.google.com/assistant/app/overview -->\n+\n+<actions>\n+    <action intentName=\"actions.intent.OPEN_APP_FEATURE\">\n+        <fulfillment urlTemplate=\"https://antennapod.org/deeplink/main{?featureName}\">\n+            <parameter-mapping\n+                intentParameter=\"feature\"\n+                urlParameter=\"featureName\" />\n+        </fulfillment>\n+        <parameter name=\"feature\">\n+            <entity-set-reference entitySetId=\"featureEntitySet\" />\n+        </parameter>\n+    </action>\n+\n+    <action intentName=\"actions.intent.GET_THING\">\n+        <fulfillment urlTemplate=\"https://antennapod.org/deeplink/search{?query}\">\n+            <parameter-mapping\n+                intentParameter=\"thing.name\"\n+                urlParameter=\"query\"/>\n+        </fulfillment>\n+    </action>\n+\n+    <entity-set entitySetId=\"featureEntitySet\">\n+        <entity identifier=\"QUEUE\" name=\"Queue\" />", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1f1ec18b84b1d670ce7daa550245b0b9b1fe745b"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTU5MzExNw==", "bodyText": "Is this the same as the identifier specified in actions.xml (entity identifier=\"DOWNLOADS\")? If so, why do you use lower case here and upper case in actions.xml?", "url": "https://github.com/AntennaPod/AntennaPod/pull/4417#discussion_r495593117", "createdAt": "2020-09-27T17:01:51Z", "author": {"login": "ByteHamster"}, "path": "app/src/main/java/de/danoeh/antennapod/activity/MainActivity.java", "diffHunk": "@@ -511,4 +543,57 @@ public Snackbar showSnackbarAbovePlayer(CharSequence text, int duration) {\n     public Snackbar showSnackbarAbovePlayer(int text, int duration) {\n         return showSnackbarAbovePlayer(getResources().getText(text), duration);\n     }\n+\n+    /**\n+     * Handles the deep link incoming via App Actions.\n+     * Performs an in-app search or opens the relevant feature of the app\n+     * depending on the query.\n+     *\n+     * @param uri incoming deep link\n+     */\n+    private void handleDeeplink(Uri uri) {\n+        if (uri == null || uri.getPath() == null) {\n+           return;\n+        }\n+\n+        switch (uri.getPath()) {\n+            case \"/search\":\n+                String query = uri.getQueryParameter(\"query\");\n+                if (query == null) {\n+                    return;\n+                }\n+\n+                this.loadChildFragment(OnlineSearchFragment.newInstance(CombinedSearcher.class, query));\n+                break;\n+\n+            case \"/main\":\n+                String feature = uri.getQueryParameter(\"featureName\");\n+                if (feature == null) {\n+                    return;\n+                }\n+\n+                feature = feature.toLowerCase();\n+                switch (feature) {\n+                    case \"downloads\":", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzQ0MjE3MQ=="}, "originalCommit": {"oid": "25c3429d5587e3e280ba35699c454816a02fe73d"}, "originalPosition": 110}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "415dc548f29adcf399a272da663442e632b797eb", "author": {"user": {"login": "ByteHamster", "name": null}}, "url": "https://github.com/AntennaPod/AntennaPod/commit/415dc548f29adcf399a272da663442e632b797eb", "committedDate": "2021-01-23T19:35:53Z", "message": "Merge branch 'develop' into appActionsPullRequest"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b526806a51587602243c45a679574487d306d93f", "author": {"user": {"login": "ByteHamster", "name": null}}, "url": "https://github.com/AntennaPod/AntennaPod/commit/b526806a51587602243c45a679574487d306d93f", "committedDate": "2021-01-23T21:57:45Z", "message": "Fixes and localization"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9629cc6bb1ac7b16663090ea9c138aecfab842f0", "author": {"user": {"login": "ByteHamster", "name": null}}, "url": "https://github.com/AntennaPod/AntennaPod/commit/9629cc6bb1ac7b16663090ea9c138aecfab842f0", "committedDate": "2021-01-24T14:12:55Z", "message": "Local search"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2685, "cost": 1, "resetAt": "2021-10-29T17:30:11Z"}}}