{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAzMzMwMzM4", "number": 4058, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxNzo1ODowMFrODxwm-Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQyMTo1NTowMlrODz8L0Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjUzNTAzMjI1OnYy", "diffSide": "RIGHT", "path": "core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java", "isResolved": false, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxNzo1ODowMVrOGFacdg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQyMDo1MTo0M1rOGInK9A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODMyOTMzNA==", "bodyText": "Of the 4 cases where playMediaObject() is called, this was the only case I was able to trigger when testing - how do I call OnPlayFromSearch(), OnPlayFromMediaId(), and StartPlayingFromPreferences()?", "url": "https://github.com/AntennaPod/AntennaPod/pull/4058#discussion_r408329334", "createdAt": "2020-04-14T17:58:01Z", "author": {"login": "michaelmwhite"}, "path": "core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java", "diffHunk": "@@ -497,6 +497,7 @@ public int onStartCommand(Intent intent, int flags, int startId) {\n                     return Service.START_NOT_STICKY;\n                 }\n                 mediaPlayer.playMediaObject(playable, stream, startWhenPrepared, prepareImmediately);\n+                AddPlayableToQueue(playable);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "849756933bd0d2bd8a5f6ea6409c8a200e1de4fa"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODM1NzI1Ng==", "bodyText": "Thanks for your pull request. I like the fact that you added a test and try to increase the test coverage \ud83d\udc4d\nStartPlayingFromPreferences can be triggered by sending a Play button keycode to the service without specifying a media file (see PlaybackServiceNotificationBuilder.getPendingIntentForMediaAction).\nThe other methods are related to Android Auto, I think. Not sure how to test those.", "url": "https://github.com/AntennaPod/AntennaPod/pull/4058#discussion_r408357256", "createdAt": "2020-04-14T18:45:24Z", "author": {"login": "ByteHamster"}, "path": "core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java", "diffHunk": "@@ -497,6 +497,7 @@ public int onStartCommand(Intent intent, int flags, int startId) {\n                     return Service.START_NOT_STICKY;\n                 }\n                 mediaPlayer.playMediaObject(playable, stream, startWhenPrepared, prepareImmediately);\n+                AddPlayableToQueue(playable);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODMyOTMzNA=="}, "originalCommit": {"oid": "849756933bd0d2bd8a5f6ea6409c8a200e1de4fa"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTE0Njk3NQ==", "bodyText": "It's hard to write tests for the other cases since they require a lot of internal states within the app to be configured appropriately, so I think this is the only test I'm going to add for now. Is that ok/do you think the PR can be merged in?", "url": "https://github.com/AntennaPod/AntennaPod/pull/4058#discussion_r409146975", "createdAt": "2020-04-15T21:33:34Z", "author": {"login": "michaelmwhite"}, "path": "core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java", "diffHunk": "@@ -497,6 +497,7 @@ public int onStartCommand(Intent intent, int flags, int startId) {\n                     return Service.START_NOT_STICKY;\n                 }\n                 mediaPlayer.playMediaObject(playable, stream, startWhenPrepared, prepareImmediately);\n+                AddPlayableToQueue(playable);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODMyOTMzNA=="}, "originalCommit": {"oid": "849756933bd0d2bd8a5f6ea6409c8a200e1de4fa"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTE2MDM2Mw==", "bodyText": "Is that ok/do you think the PR can be merged in?\n\nTotally ok :) I did not expect a test in the first place, so even a single one is really nice to have \ud83d\udc4d\nI will have a closer look at the PR soon.", "url": "https://github.com/AntennaPod/AntennaPod/pull/4058#discussion_r409160363", "createdAt": "2020-04-15T22:02:10Z", "author": {"login": "ByteHamster"}, "path": "core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java", "diffHunk": "@@ -497,6 +497,7 @@ public int onStartCommand(Intent intent, int flags, int startId) {\n                     return Service.START_NOT_STICKY;\n                 }\n                 mediaPlayer.playMediaObject(playable, stream, startWhenPrepared, prepareImmediately);\n+                AddPlayableToQueue(playable);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODMyOTMzNA=="}, "originalCommit": {"oid": "849756933bd0d2bd8a5f6ea6409c8a200e1de4fa"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTY4MzU3Mg==", "bodyText": "@ByteHamster Have you gotten a chance to look over the pr?", "url": "https://github.com/AntennaPod/AntennaPod/pull/4058#discussion_r411683572", "createdAt": "2020-04-20T20:51:43Z", "author": {"login": "michaelmwhite"}, "path": "core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java", "diffHunk": "@@ -497,6 +497,7 @@ public int onStartCommand(Intent intent, int flags, int startId) {\n                     return Service.START_NOT_STICKY;\n                 }\n                 mediaPlayer.playMediaObject(playable, stream, startWhenPrepared, prepareImmediately);\n+                AddPlayableToQueue(playable);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODMyOTMzNA=="}, "originalCommit": {"oid": "849756933bd0d2bd8a5f6ea6409c8a200e1de4fa"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU1NzkwMDMzOnYy", "diffSide": "RIGHT", "path": "core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQyMTo1NTowMlrOGIpTlA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxMzozNjo1OFrOGJGI4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTcxODU0OA==", "bodyText": "Sorry for taking so long to respond.\nIf you use addQueueItem(this, false, false, ((FeedMedia) playable).getId()) instead, it does not need to do the database query that retrieves the item.\nBy the way, this also fixes #3277 :) \ud83d\udc4d", "url": "https://github.com/AntennaPod/AntennaPod/pull/4058#discussion_r411718548", "createdAt": "2020-04-20T21:55:02Z", "author": {"login": "ByteHamster"}, "path": "core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java", "diffHunk": "@@ -1636,6 +1638,13 @@ private void cancelPositionObserver() {\n         }\n     }\n \n+    private void addPlayableToQueue(Playable playable) {\n+        if (playable instanceof FeedMedia) {\n+            FeedItem feedItem = DBReader.getFeedItem(((FeedMedia) playable).getId());\n+            DBWriter.addQueueItem(this, feedItem);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed0402d53ff023f7ac95711a25a81252f742b366"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjE5MDk0NQ==", "bodyText": "Good call, I updated the pr", "url": "https://github.com/AntennaPod/AntennaPod/pull/4058#discussion_r412190945", "createdAt": "2020-04-21T13:36:58Z", "author": {"login": "michaelmwhite"}, "path": "core/src/main/java/de/danoeh/antennapod/core/service/playback/PlaybackService.java", "diffHunk": "@@ -1636,6 +1638,13 @@ private void cancelPositionObserver() {\n         }\n     }\n \n+    private void addPlayableToQueue(Playable playable) {\n+        if (playable instanceof FeedMedia) {\n+            FeedItem feedItem = DBReader.getFeedItem(((FeedMedia) playable).getId());\n+            DBWriter.addQueueItem(this, feedItem);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTcxODU0OA=="}, "originalCommit": {"oid": "ed0402d53ff023f7ac95711a25a81252f742b366"}, "originalPosition": 23}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4774, "cost": 1, "resetAt": "2021-11-12T09:44:50Z"}}}