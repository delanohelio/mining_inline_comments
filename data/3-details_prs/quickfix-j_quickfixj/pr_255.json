{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzYwMDE5MTQz", "number": 255, "title": "Introduce separate thread pool for establishing Initiator connections", "bodyText": "Fixes #254\n\nintroduced separate thread pool with 3 threads for connection establishment\nchanged enabled flag in Session to volatile and removed synchronization from setEnabled/isEnabled since I could not find any good reason why it was synchronized\n** volatile should be enough to ensure that all threads see the current state now that it is checked from distinct threads\nremoved synchronized from IoSessionInitiator.ConnectTask.run() since I could not find any good reason why it was synchronized", "createdAt": "2020-01-07T14:38:06Z", "url": "https://github.com/quickfix-j/quickfixj/pull/255", "merged": true, "mergeCommit": {"oid": "c7c19a34d672974d4380b6991abf525b71f9a42a"}, "closed": true, "closedAt": "2020-06-08T13:52:19Z", "author": {"login": "chrjohn"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb4BqKpgH2gAyMzYwMDE5MTQzOjBlMDU1NDYxNTE4NWIxOTlkMTIyM2RmYWNhNmRhMmM2Y2YxYWUyMDg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcg67algFqTQxMTA2NDc3MQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0e0554615185b199d1223dfaca6da2c6cf1ae208", "author": {"user": {"login": "chrjohn", "name": "Christoph John"}}, "url": "https://github.com/quickfix-j/quickfixj/commit/0e0554615185b199d1223dfaca6da2c6cf1ae208", "committedDate": "2020-01-07T14:30:39Z", "message": "Introduce separate thread pool for establishing Initiator connections\n\n * Fixes #254\n * introduced separate thread pool with 3 threads for connection establishment\n * changed `enabled` flag in `Session` to `volatile` and removed synchronization from `setEnabled`/`isEnabled` since I could not find any good reason why it was synchronized\n ** `volatile` should ensure that all threads should see the current state and prevents possible deadlocks now that flag is checked from distinct threads\n * removed `synchronized` from `IoSessionInitiator.ConnectTask.run()` since I could not find any good reason why it was synchronized"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f5e050c907decfdb0bfc27c6be21e9834a7ff59a", "author": {"user": {"login": "chrjohn", "name": "Christoph John"}}, "url": "https://github.com/quickfix-j/quickfixj/commit/f5e050c907decfdb0bfc27c6be21e9834a7ff59a", "committedDate": "2020-01-10T15:04:30Z", "message": "whitespace change\n\nto test LGTM check"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU0MTU3MTAy", "url": "https://github.com/quickfix-j/quickfixj/pull/255#pullrequestreview-354157102", "createdAt": "2020-02-06T01:45:28Z", "commit": {"oid": "f5e050c907decfdb0bfc27c6be21e9834a7ff59a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f2514215391f64527cff5537a63b243bf88a0c26", "author": {"user": {"login": "chrjohn", "name": "Christoph John"}}, "url": "https://github.com/quickfix-j/quickfixj/commit/f2514215391f64527cff5537a63b243bf88a0c26", "committedDate": "2020-04-05T21:57:59Z", "message": "fixed typo"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2c4b2b5672ca050272e64e3aab847f80fa599728", "author": {"user": {"login": "chrjohn", "name": "Christoph John"}}, "url": "https://github.com/quickfix-j/quickfixj/commit/2c4b2b5672ca050272e64e3aab847f80fa599728", "committedDate": "2020-04-05T22:08:15Z", "message": "Merge branch 'connection-timeout-254' of https://github.com/quickfix-j/quickfixj into connection-timeout-254"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b635cd64fe869681d72821af6418b5cf41a917a", "author": {"user": {"login": "chrjohn", "name": "Christoph John"}}, "url": "https://github.com/quickfix-j/quickfixj/commit/8b635cd64fe869681d72821af6418b5cf41a917a", "committedDate": "2020-04-07T13:16:02Z", "message": " - prevent NPE on Logon in Session when not specifying messageFactory in\nAbstractSessionConnectorBuilder"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d55caffc5c8561cf37572f61d6f8b8032feea960", "author": {"user": {"login": "chrjohn", "name": "Christoph John"}}, "url": "https://github.com/quickfix-j/quickfixj/commit/d55caffc5c8561cf37572f61d6f8b8032feea960", "committedDate": "2020-04-08T21:02:06Z", "message": " - added possibility to specify number of reconnect threads via builder\n - by default 3 threads are used\n - changed executor to be non-static, i.e. each Initiator instance has its own reconnect thread pool\n  - (unless feature is disabled which will use the former behaviour)\n  - to use the former behaviour (i.e. use \"QFJ Timer\" thread for both reconnections and calls to next()) you should pass 0 as number of reconnect threads\n - when passing 1 you will end up with a separate thread for reconnections; next() will still be called by \"QFJ Timer\" thread"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7e1e5348607661464fd7b2a33ae5723a115b4e1d", "author": {"user": {"login": "chrjohn", "name": "Christoph John"}}, "url": "https://github.com/quickfix-j/quickfixj/commit/7e1e5348607661464fd7b2a33ae5723a115b4e1d", "committedDate": "2020-04-08T21:05:36Z", "message": "minor formatting"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAxMzMwNDQw", "url": "https://github.com/quickfix-j/quickfixj/pull/255#pullrequestreview-401330440", "createdAt": "2020-04-27T21:12:31Z", "commit": {"oid": "7e1e5348607661464fd7b2a33ae5723a115b4e1d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QyMToxMjozMVrOGM37cw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yN1QyMToxMjozMVrOGM37cw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjE1MjQzNQ==", "bodyText": "Setting maximumPoolSize to initialPoolSize ensures that numReconnectThreads threads are available to service tasks. Otherwise new threads only get created when the task queue is full.", "url": "https://github.com/quickfix-j/quickfixj/pull/255#discussion_r416152435", "createdAt": "2020-04-27T21:12:31Z", "author": {"login": "chrjohn"}, "path": "quickfixj-core/src/main/java/quickfix/mina/initiator/AbstractSocketInitiator.java", "diffHunk": "@@ -69,9 +76,27 @@ protected AbstractSocketInitiator(Application application,\n \n     protected AbstractSocketInitiator(SessionSettings settings, SessionFactory sessionFactory)\n             throws ConfigError {\n+        this(settings, sessionFactory, 0);\n+    }\n+\n+    protected AbstractSocketInitiator(Application application,\n+            MessageStoreFactory messageStoreFactory, SessionSettings settings,\n+            LogFactory logFactory, MessageFactory messageFactory, int numReconnectThreads) throws ConfigError {\n+        this(settings, new DefaultSessionFactory(application, messageStoreFactory, logFactory,\n+                messageFactory), numReconnectThreads);\n+    }\n+\n+    protected AbstractSocketInitiator(SessionSettings settings, SessionFactory sessionFactory, int numReconnectThreads)\n+            throws ConfigError {\n         super(settings, sessionFactory);\n         IoBuffer.setAllocator(new SimpleBufferAllocator());\n         IoBuffer.setUseDirectBuffer(false);\n+        if (numReconnectThreads > 0) {\n+            scheduledReconnectExecutor = Executors.newScheduledThreadPool(numReconnectThreads, new QFScheduledReconnectThreadFactory());\n+            ((ThreadPoolExecutor) scheduledReconnectExecutor).setMaximumPoolSize(numReconnectThreads);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7e1e5348607661464fd7b2a33ae5723a115b4e1d"}, "originalPosition": 42}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExMDYwODMz", "url": "https://github.com/quickfix-j/quickfixj/pull/255#pullrequestreview-411060833", "createdAt": "2020-05-13T15:46:50Z", "commit": {"oid": "7e1e5348607661464fd7b2a33ae5723a115b4e1d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNTo0Njo1MFrOGU4ClA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xM1QxNTo0Njo1MFrOGU4ClA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU0Mjg2OA==", "bodyText": "Not directly related to this change, but we probably don't want to queue up timer tasks if they take too long for some reason.\n\n  \n    \n      quickfixj/quickfixj-core/src/main/java/quickfix/mina/initiator/IoSessionInitiator.java\n    \n    \n         Line 364\n      in\n      e53d41b\n    \n    \n    \n    \n\n        \n          \n           .scheduleWithFixedDelay(reconnectTask, 0, 1, TimeUnit.SECONDS);", "url": "https://github.com/quickfix-j/quickfixj/pull/255#discussion_r424542868", "createdAt": "2020-05-13T15:46:50Z", "author": {"login": "the-thing"}, "path": "quickfixj-core/src/main/java/quickfix/mina/SessionConnector.java", "diffHunk": "@@ -318,7 +318,7 @@ protected void startSessionTimer() {\n         if (shortLivedExecutor != null) {\n             timerTask = new DelegatingTask(timerTask, shortLivedExecutor);\n         }\n-        sessionTimerFuture = scheduledExecutorService.scheduleAtFixedRate(timerTask, 0, 1000L,\n+        sessionTimerFuture = SCHEDULED_EXECUTOR.scheduleAtFixedRate(timerTask, 0, 1000L,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7e1e5348607661464fd7b2a33ae5723a115b4e1d"}, "originalPosition": 14}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExMDY0Nzcx", "url": "https://github.com/quickfix-j/quickfixj/pull/255#pullrequestreview-411064771", "createdAt": "2020-05-13T15:51:03Z", "commit": {"oid": "7e1e5348607661464fd7b2a33ae5723a115b4e1d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3083, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}