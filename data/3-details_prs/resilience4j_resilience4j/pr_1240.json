{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE3MzgwNjk5", "number": 1240, "title": "added RateLimiter.drainPermissions method", "bodyText": "First part of #1228", "createdAt": "2020-11-08T22:26:05Z", "url": "https://github.com/resilience4j/resilience4j/pull/1240", "merged": true, "mergeCommit": {"oid": "cf6f922013d8f8a5bab102645c16fad0879a2b1d"}, "closed": true, "closedAt": "2020-11-30T08:00:34Z", "author": {"login": "walec51"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdanLTzgH2gAyNTE3MzgwNjk5OmJjYmQ5MzA4ODg4MjAwY2QxNDJjMDJjMmQxOTY3ZmVkMzY0OGZiN2E=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdhgp7tAFqTU0MDY2NjQ5NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "bcbd9308888200cd142c02c2d1967fed3648fb7a", "author": {"user": null}, "url": "https://github.com/resilience4j/resilience4j/commit/bcbd9308888200cd142c02c2d1967fed3648fb7a", "committedDate": "2020-11-08T21:37:55Z", "message": "added RateLimiter.drainPermissions method"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI2MDAyMTUx", "url": "https://github.com/resilience4j/resilience4j/pull/1240#pullrequestreview-526002151", "createdAt": "2020-11-09T08:02:09Z", "commit": {"oid": "bcbd9308888200cd142c02c2d1967fed3648fb7a"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQwODowMjowOVrOHviy_A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQwODowMjozMlrOHvizmA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTYxNTIyOA==", "bodyText": "DRAINED", "url": "https://github.com/resilience4j/resilience4j/pull/1240#discussion_r519615228", "createdAt": "2020-11-09T08:02:09Z", "author": {"login": "RobWin"}, "path": "resilience4j-ratelimiter/src/main/java/io/github/resilience4j/ratelimiter/event/RateLimiterOnDrainEvent.java", "diffHunk": "@@ -0,0 +1,31 @@\n+/*\n+ *\n+ *  Copyright 2016 Robert Winkler and Bohdan Storozhuk\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *         http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ *\n+ *\n+ */\n+package io.github.resilience4j.ratelimiter.event;\n+\n+public class RateLimiterOnDrainEvent extends AbstractRateLimiterEvent {\n+\n+    public RateLimiterOnDrainEvent(String rateLimiterName, int numberOfPermits) {\n+        super(rateLimiterName, numberOfPermits);\n+    }\n+\n+    @Override\n+    public Type getEventType() {\n+        return Type.SUCCESSFUL_ACQUIRE;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bcbd9308888200cd142c02c2d1967fed3648fb7a"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTYxNTM4NA==", "bodyText": "RateLimiterOnDrainedEvent\nwdyt?", "url": "https://github.com/resilience4j/resilience4j/pull/1240#discussion_r519615384", "createdAt": "2020-11-09T08:02:32Z", "author": {"login": "RobWin"}, "path": "resilience4j-ratelimiter/src/main/java/io/github/resilience4j/ratelimiter/event/RateLimiterOnDrainEvent.java", "diffHunk": "@@ -0,0 +1,31 @@\n+/*\n+ *\n+ *  Copyright 2016 Robert Winkler and Bohdan Storozhuk\n+ *\n+ *  Licensed under the Apache License, Version 2.0 (the \"License\");\n+ *  you may not use this file except in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *         http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing, software\n+ *  distributed under the License is distributed on an \"AS IS\" BASIS,\n+ *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ *  See the License for the specific language governing permissions and\n+ *  limitations under the License.\n+ *\n+ *\n+ */\n+package io.github.resilience4j.ratelimiter.event;\n+\n+public class RateLimiterOnDrainEvent extends AbstractRateLimiterEvent {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bcbd9308888200cd142c02c2d1967fed3648fb7a"}, "originalPosition": 21}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "624b5523186708e640f455c93a47e09b587676ad", "author": {"user": null}, "url": "https://github.com/resilience4j/resilience4j/commit/624b5523186708e640f455c93a47e09b587676ad", "committedDate": "2020-11-11T15:58:20Z", "message": "review fixes in RateLimiterOnDrainedEvent"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "008426f1326eeb8b83f8297eae75e0ad35c58d98", "author": {"user": null}, "url": "https://github.com/resilience4j/resilience4j/commit/008426f1326eeb8b83f8297eae75e0ad35c58d98", "committedDate": "2020-11-14T18:16:56Z", "message": "missing changes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMwNjAwNTI5", "url": "https://github.com/resilience4j/resilience4j/pull/1240#pullrequestreview-530600529", "createdAt": "2020-11-14T19:48:40Z", "commit": {"oid": "008426f1326eeb8b83f8297eae75e0ad35c58d98"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNFQxOTo0ODo0MFrOHzNOMw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xNFQxOTo0ODo0MFrOHzNOMw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzQ1NjA1MQ==", "bodyText": "Please don't change state directly, but use the same approach as in updateStateWithBackOff \n  \n    \n      resilience4j/resilience4j-ratelimiter/src/main/java/io/github/resilience4j/ratelimiter/internal/AtomicRateLimiter.java\n    \n    \n         Line 157\n      in\n      a2534c5\n    \n    \n    \n    \n\n        \n          \n           private State updateStateWithBackOff(final int permits, final long timeoutInNanos) {", "url": "https://github.com/resilience4j/resilience4j/pull/1240#discussion_r523456051", "createdAt": "2020-11-14T19:48:40Z", "author": {"login": "storozhukBM"}, "path": "resilience4j-ratelimiter/src/main/java/io/github/resilience4j/ratelimiter/internal/AtomicRateLimiter.java", "diffHunk": "@@ -128,20 +129,34 @@ public long reservePermission(final int permits) {\n \n         boolean canAcquireImmediately = modifiedState.nanosToWait <= 0;\n         if (canAcquireImmediately) {\n-            publishRateLimiterEvent(true, permits);\n+            publishRateLimiterAcquisitionEvent(true, permits);\n             return 0;\n         }\n \n         boolean canAcquireInTime = timeoutInNanos >= modifiedState.nanosToWait;\n         if (canAcquireInTime) {\n-            publishRateLimiterEvent(true, permits);\n+            publishRateLimiterAcquisitionEvent(true, permits);\n             return modifiedState.nanosToWait;\n         }\n \n-        publishRateLimiterEvent(false, permits);\n+        publishRateLimiterAcquisitionEvent(false, permits);\n         return -1;\n     }\n \n+    @Override\n+    public void drainPermissions() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "008426f1326eeb8b83f8297eae75e0ad35c58d98"}, "originalPosition": 39}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6ffd6de63c27f92f246fa998edd7e0f327abcd01", "author": {"user": null}, "url": "https://github.com/resilience4j/resilience4j/commit/6ffd6de63c27f92f246fa998edd7e0f327abcd01", "committedDate": "2020-11-15T01:28:23Z", "message": "review fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f4f57a3ad2006bb4637fe0aed511b1b82ea4d4f5", "author": {"user": null}, "url": "https://github.com/resilience4j/resilience4j/commit/f4f57a3ad2006bb4637fe0aed511b1b82ea4d4f5", "committedDate": "2020-11-15T01:40:56Z", "message": "added test case"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "05a4c30a7c15a4df1572e89e8b758868ee406b9e", "author": {"user": {"login": "walec51", "name": "Adam Walczak"}}, "url": "https://github.com/resilience4j/resilience4j/commit/05a4c30a7c15a4df1572e89e8b758868ee406b9e", "committedDate": "2020-11-16T20:14:17Z", "message": "Merge branch 'master' into rate-limiter-drain"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7d5d2c529394fa7c210b11becf74042a24841cdf", "author": {"user": null}, "url": "https://github.com/resilience4j/resilience4j/commit/7d5d2c529394fa7c210b11becf74042a24841cdf", "committedDate": "2020-11-20T21:33:33Z", "message": "Merge remote-tracking branch 'upstream/master' into rate-limiter-drain"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQwNjY2NDk0", "url": "https://github.com/resilience4j/resilience4j/pull/1240#pullrequestreview-540666494", "createdAt": "2020-11-30T07:59:31Z", "commit": {"oid": "7d5d2c529394fa7c210b11becf74042a24841cdf"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1738, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}