{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE5ODYzMDI4", "number": 997, "title": "Issue #991 Cancel auto transition when trasition happend in Open state", "bodyText": "", "createdAt": "2020-05-19T04:03:21Z", "url": "https://github.com/resilience4j/resilience4j/pull/997", "merged": true, "mergeCommit": {"oid": "378dd2b65889b83cda2a2b3d4203e86604b5044e"}, "closed": true, "closedAt": "2020-05-28T09:51:13Z", "author": {"login": "dlsrb6342"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcisQSLgH2gAyNDE5ODYzMDI4OjkxZjhkYmNjM2RlZmI0NTBhZDEzMjhjNzFkZDQxYTY0OGMxZGM1OWU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABclqgmXAFqTQxOTkzNzQ4MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "91f8dbcc3defb450ad1328c71dd41a648c1dc59e", "author": {"user": {"login": "dlsrb6342", "name": "Ingyu Hwang (Evan)"}}, "url": "https://github.com/resilience4j/resilience4j/commit/91f8dbcc3defb450ad1328c71dd41a648c1dc59e", "committedDate": "2020-05-19T03:53:07Z", "message": "Issue #991 Cancel auto transition when trasition happend in Open state"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "06d4980caae1ed2b6dd9a6b919318edccbd0d4b8", "author": {"user": {"login": "dlsrb6342", "name": "Ingyu Hwang (Evan)"}}, "url": "https://github.com/resilience4j/resilience4j/commit/06d4980caae1ed2b6dd9a6b919318edccbd0d4b8", "committedDate": "2020-05-24T08:15:34Z", "message": "Add auto transition cancel test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3NDUwMTg5", "url": "https://github.com/resilience4j/resilience4j/pull/997#pullrequestreview-417450189", "createdAt": "2020-05-25T04:29:45Z", "commit": {"oid": "06d4980caae1ed2b6dd9a6b919318edccbd0d4b8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a075e6cd0ecf5543e67a31224c563b42d0a8e4ba", "author": {"user": {"login": "dlsrb6342", "name": "Ingyu Hwang (Evan)"}}, "url": "https://github.com/resilience4j/resilience4j/commit/a075e6cd0ecf5543e67a31224c563b42d0a8e4ba", "committedDate": "2020-05-26T08:38:23Z", "message": "Test with mocked ScheduledExecutorService"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE4ODcxODA5", "url": "https://github.com/resilience4j/resilience4j/pull/997#pullrequestreview-418871809", "createdAt": "2020-05-27T05:43:58Z", "commit": {"oid": "a075e6cd0ecf5543e67a31224c563b42d0a8e4ba"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QwNTo0Mzo1OFrOGa6Lxg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yN1QwNTo0Mzo1OFrOGa6Lxg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDg2OTQ0Ng==", "bodyText": "I'm not happy that this state-specific code is in generic method of the CircuitBreakerStateMachine.\nMaybe we can add a postTransitionHook or preTransitionHook to states which are invoked here in a generic form?", "url": "https://github.com/resilience4j/resilience4j/pull/997#discussion_r430869446", "createdAt": "2020-05-27T05:43:58Z", "author": {"login": "RobWin"}, "path": "resilience4j-circuitbreaker/src/main/java/io/github/resilience4j/circuitbreaker/internal/CircuitBreakerStateMachine.java", "diffHunk": "@@ -293,6 +291,9 @@ private void stateTransition(State newState,\n         UnaryOperator<CircuitBreakerState> newStateGenerator) {\n         CircuitBreakerState previousState = stateReference.getAndUpdate(currentState -> {\n             StateTransition.transitionBetween(getName(), currentState.getState(), newState);\n+            if (currentState instanceof OpenState) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a075e6cd0ecf5543e67a31224c563b42d0a8e4ba"}, "originalPosition": 24}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cd02830859bc9359b5fbedcc3ad4abe4b9b8c914", "author": {"user": {"login": "dlsrb6342", "name": "Ingyu Hwang (Evan)"}}, "url": "https://github.com/resilience4j/resilience4j/commit/cd02830859bc9359b5fbedcc3ad4abe4b9b8c914", "committedDate": "2020-05-28T05:36:50Z", "message": "Add preTransisionHook"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE5ODk1MjYx", "url": "https://github.com/resilience4j/resilience4j/pull/997#pullrequestreview-419895261", "createdAt": "2020-05-28T08:38:14Z", "commit": {"oid": "cd02830859bc9359b5fbedcc3ad4abe4b9b8c914"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQwODozODoxNFrOGbrRBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yOFQwODozODoxNFrOGbrRBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTY3MzYwNw==", "bodyText": "what happens if the future is already completed?", "url": "https://github.com/resilience4j/resilience4j/pull/997#discussion_r431673607", "createdAt": "2020-05-28T08:38:14Z", "author": {"login": "RobWin"}, "path": "resilience4j-circuitbreaker/src/main/java/io/github/resilience4j/circuitbreaker/internal/CircuitBreakerStateMachine.java", "diffHunk": "@@ -695,12 +706,23 @@ public CircuitBreakerMetrics getMetrics() {\n             return circuitBreakerMetrics;\n         }\n \n+        @Override\n+        public void preTransitionHook() {\n+            cancelAutomaticTransitionToHalfOpen();\n+        }\n+\n         private void toHalfOpenState() {\n             if (isOpen.compareAndSet(true, false)) {\n                 transitionToHalfOpenState();\n             }\n         }\n \n+        private void cancelAutomaticTransitionToHalfOpen() {\n+            if (transitionToHalfOpenFuture != null) {\n+                transitionToHalfOpenFuture.cancel(true);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cd02830859bc9359b5fbedcc3ad4abe4b9b8c914"}, "originalPosition": 81}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "969f4e9407781dc732715ee08e92bc524eda908b", "author": {"user": {"login": "dlsrb6342", "name": "Ingyu Hwang (Evan)"}}, "url": "https://github.com/resilience4j/resilience4j/commit/969f4e9407781dc732715ee08e92bc524eda908b", "committedDate": "2020-05-28T09:21:39Z", "message": "Check auto transition future is already done"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE5OTM3NDgw", "url": "https://github.com/resilience4j/resilience4j/pull/997#pullrequestreview-419937480", "createdAt": "2020-05-28T09:32:54Z", "commit": {"oid": "969f4e9407781dc732715ee08e92bc524eda908b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1876, "cost": 1, "resetAt": "2021-11-01T16:37:27Z"}}}