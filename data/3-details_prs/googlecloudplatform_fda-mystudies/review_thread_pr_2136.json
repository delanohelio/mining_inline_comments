{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI2NDcxMDI2", "number": 2136, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxNzo1Njo1OFrOE82ynA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQxNzo0ODozMlrOE_RO2Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMyMjQ3NzA4OnYy", "diffSide": "RIGHT", "path": "participant-manager-datastore/participant-manager-service/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/SiteControllerTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNFQxNzo1Njo1OFrOH5Op0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0yNVQxNjo0Njo0NlrOH578nA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTc3MDk2MQ==", "bodyText": "Shouldn't we have a test here for when excludeEnrollmentStatus includes notEligible and yetToEnroll and check for empty array being returned instead", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2136#discussion_r529770961", "createdAt": "2020-11-24T17:56:58Z", "author": {"login": "saminguyen"}, "path": "participant-manager-datastore/participant-manager-service/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/SiteControllerTest.java", "diffHunk": "@@ -710,6 +710,33 @@ public void shouldReturnSiteParticipantsForDisabled() throws Exception {\n     verifyTokenIntrospectRequest();\n   }\n \n+  @Test\n+  public void shouldNotReturnSiteParticipantsForNotEligible() throws Exception {\n+    siteEntity = testDataHelper.createSiteEntity(studyEntity, userRegAdminEntity, appEntity);\n+    participantRegistrySiteEntity =\n+        testDataHelper.createParticipantRegistrySite(siteEntity, studyEntity);\n+\n+    participantStudyEntity.setStatus(\"notEligible\");\n+    testDataHelper.getParticipantStudyRepository().saveAndFlush(participantStudyEntity);\n+    HttpHeaders headers = testDataHelper.newCommonHeaders();\n+    headers.add(USER_ID_HEADER, userRegAdminEntity.getId());\n+\n+    mockMvc\n+        .perform(\n+            get(ApiEndpoint.GET_SITE_PARTICIPANTS.getPath(), siteEntity.getId())\n+                .headers(headers)\n+                .contextPath(getContextPath()))\n+        .andDo(print())\n+        .andExpect(status().isOk())\n+        .andExpect(jsonPath(\"$.participantRegistryDetail.registryParticipants\").isArray())\n+        .andExpect(\n+            jsonPath(\n+                \"$.participantRegistryDetail.registryParticipants[0].enrollmentStatus\",\n+                is(CommonConstants.YET_TO_ENROLL)));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3cb8283308cf2a0a7353503f1328a9110e87393f"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDUxMzA1Mg==", "bodyText": "fixed PR comment", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2136#discussion_r530513052", "createdAt": "2020-11-25T16:46:46Z", "author": {"login": "Kantharajut-btc"}, "path": "participant-manager-datastore/participant-manager-service/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/SiteControllerTest.java", "diffHunk": "@@ -710,6 +710,33 @@ public void shouldReturnSiteParticipantsForDisabled() throws Exception {\n     verifyTokenIntrospectRequest();\n   }\n \n+  @Test\n+  public void shouldNotReturnSiteParticipantsForNotEligible() throws Exception {\n+    siteEntity = testDataHelper.createSiteEntity(studyEntity, userRegAdminEntity, appEntity);\n+    participantRegistrySiteEntity =\n+        testDataHelper.createParticipantRegistrySite(siteEntity, studyEntity);\n+\n+    participantStudyEntity.setStatus(\"notEligible\");\n+    testDataHelper.getParticipantStudyRepository().saveAndFlush(participantStudyEntity);\n+    HttpHeaders headers = testDataHelper.newCommonHeaders();\n+    headers.add(USER_ID_HEADER, userRegAdminEntity.getId());\n+\n+    mockMvc\n+        .perform(\n+            get(ApiEndpoint.GET_SITE_PARTICIPANTS.getPath(), siteEntity.getId())\n+                .headers(headers)\n+                .contextPath(getContextPath()))\n+        .andDo(print())\n+        .andExpect(status().isOk())\n+        .andExpect(jsonPath(\"$.participantRegistryDetail.registryParticipants\").isArray())\n+        .andExpect(\n+            jsonPath(\n+                \"$.participantRegistryDetail.registryParticipants[0].enrollmentStatus\",\n+                is(CommonConstants.YET_TO_ENROLL)));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTc3MDk2MQ=="}, "originalCommit": {"oid": "3cb8283308cf2a0a7353503f1328a9110e87393f"}, "originalPosition": 26}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM0Nzc4MDczOnYy", "diffSide": "RIGHT", "path": "participant-manager-datastore/participant-manager-service/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/SiteControllerTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQxNzo0ODozMlrOH84seg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQwNjoyOTo0M1rOH9MQSQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzYwNTQ5OA==", "bodyText": "verify array size to show clearly that the enrollment status got excluded", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2136#discussion_r533605498", "createdAt": "2020-12-01T17:48:32Z", "author": {"login": "saminguyen"}, "path": "participant-manager-datastore/participant-manager-service/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/SiteControllerTest.java", "diffHunk": "@@ -725,14 +726,11 @@ public void shouldNotReturnSiteParticipantsForNotEligible() throws Exception {\n         .perform(\n             get(ApiEndpoint.GET_SITE_PARTICIPANTS.getPath(), siteEntity.getId())\n                 .headers(headers)\n+                .queryParam(\"excludeEnrollmentStatus\", \"notEligible\", \"yetToJoin \")\n                 .contextPath(getContextPath()))\n         .andDo(print())\n         .andExpect(status().isOk())\n-        .andExpect(jsonPath(\"$.participantRegistryDetail.registryParticipants\").isArray())\n-        .andExpect(\n-            jsonPath(\n-                \"$.participantRegistryDetail.registryParticipants[0].enrollmentStatus\",\n-                is(CommonConstants.YET_TO_ENROLL)));\n+        .andExpect(jsonPath(\"$.participantRegistryDetail.registryParticipants\").isArray());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e7195e723c0169e8cb84eabc6925f7339b0f9165"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzkyNTk2MQ==", "bodyText": "added array size to check 0 registryParticipants", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2136#discussion_r533925961", "createdAt": "2020-12-02T06:29:43Z", "author": {"login": "Kantharajut-btc"}, "path": "participant-manager-datastore/participant-manager-service/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/SiteControllerTest.java", "diffHunk": "@@ -725,14 +726,11 @@ public void shouldNotReturnSiteParticipantsForNotEligible() throws Exception {\n         .perform(\n             get(ApiEndpoint.GET_SITE_PARTICIPANTS.getPath(), siteEntity.getId())\n                 .headers(headers)\n+                .queryParam(\"excludeEnrollmentStatus\", \"notEligible\", \"yetToJoin \")\n                 .contextPath(getContextPath()))\n         .andDo(print())\n         .andExpect(status().isOk())\n-        .andExpect(jsonPath(\"$.participantRegistryDetail.registryParticipants\").isArray())\n-        .andExpect(\n-            jsonPath(\n-                \"$.participantRegistryDetail.registryParticipants[0].enrollmentStatus\",\n-                is(CommonConstants.YET_TO_ENROLL)));\n+        .andExpect(jsonPath(\"$.participantRegistryDetail.registryParticipants\").isArray());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzYwNTQ5OA=="}, "originalCommit": {"oid": "e7195e723c0169e8cb84eabc6925f7339b0f9165"}, "originalPosition": 23}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1591, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}