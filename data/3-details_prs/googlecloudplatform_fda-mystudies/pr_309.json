{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEyMzAxMDIz", "number": 309, "title": "Add AppId and OrgId as secrets and write them to CloudSQL.", "bodyText": "", "createdAt": "2020-05-01T21:05:56Z", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/309", "merged": true, "mergeCommit": {"oid": "9a4083cc9fc868af6a381c6b15d48dc0698202f9"}, "closed": true, "closedAt": "2020-05-07T20:23:03Z", "author": {"login": "kuoyuchi"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcdIN8_AH2gAyNDEyMzAxMDIzOjc1MjAyNmVmOTM3ZGRiMGFjODVlMzlkMjA5ODUwZTVmMjBjMGYzNTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcfC5AwgH2gAyNDEyMzAxMDIzOjM2OTdkODQ4ZDBhZDI3MGEwYWY5M2U5OTg2ZTE4NmZhZDIzZmM2NGI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "752026ef937ddb0ac85e39d209850e5f20c0f358", "author": {"user": {"login": "kuoyuchi", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/752026ef937ddb0ac85e39d209850e5f20c0f358", "committedDate": "2020-05-01T21:04:22Z", "message": "Add AppId and OrgId as secrets."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "178034716807f14e1ce4b44dc27926f24a44094a", "author": {"user": {"login": "kuoyuchi", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/178034716807f14e1ce4b44dc27926f24a44094a", "committedDate": "2020-05-01T21:05:11Z", "message": "Script to copy AppId and OrgId to SQL."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fd4aa23f91519f41e2b00a7b3036f06b1cb27b57", "author": {"user": {"login": "kuoyuchi", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/fd4aa23f91519f41e2b00a7b3036f06b1cb27b57", "committedDate": "2020-05-01T21:06:13Z", "message": "Merge branch 'early-access' into app-org-info"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1MDMxMjg0", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/309#pullrequestreview-405031284", "createdAt": "2020-05-04T14:18:32Z", "commit": {"oid": "fd4aa23f91519f41e2b00a7b3036f06b1cb27b57"}, "state": "APPROVED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxNDoxODozMlrOGQCf-A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQxNDozMjowMFrOGQDHWg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQ3MTM1Mg==", "bodyText": "could we get these values from env-variables? or generate them using a prefix that gets passed to the script?", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/309#discussion_r419471352", "createdAt": "2020-05-04T14:18:32Z", "author": {"login": "zohrehj"}, "path": "Terraform/copy_mobile_app_info_to_sql.sh", "diffHunk": "@@ -0,0 +1,30 @@\n+#!/bin/bash\n+# Script to copy AppId and OrgId from gcloud secret to CloudSQL.\n+set -e\n+\n+SECRET_PROJECT=heroes-hat-dev-devops\n+DATA_PROJECT=heroes-hat-dev-data\n+SQL_IMPORT_BUCKET=heroes-hat-dev-data-sql-import\n+TMPFILE=$(mktemp)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fd4aa23f91519f41e2b00a7b3036f06b1cb27b57"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQ4MDY0MA==", "bodyText": "should DummyOrgName be set in a variable on top so that it can be easily changed later?", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/309#discussion_r419480640", "createdAt": "2020-05-04T14:30:55Z", "author": {"login": "zohrehj"}, "path": "Terraform/copy_mobile_app_info_to_sql.sh", "diffHunk": "@@ -0,0 +1,30 @@\n+#!/bin/bash\n+# Script to copy AppId and OrgId from gcloud secret to CloudSQL.\n+set -e\n+\n+SECRET_PROJECT=heroes-hat-dev-devops\n+DATA_PROJECT=heroes-hat-dev-data\n+SQL_IMPORT_BUCKET=heroes-hat-dev-data-sql-import\n+TMPFILE=$(mktemp)\n+\n+# Write user registration server db name to TMPFILE.\n+echo \"USE \\`mystudies_userregistration\\`;\" >> ${TMPFILE}\n+\n+# Read AppId and OrgId from secrets..\n+APP_ID=`gcloud --project=${SECRET_PROJECT} secrets versions access latest --secret=mobile-app-appid`\n+ORG_ID=`gcloud --project=${SECRET_PROJECT} secrets versions access latest --secret=mobile-app-orgid`\n+\n+# Write corresponding SQL commands to TMPFILE.\n+echo \"INSERT INTO org_info (id, name, org_id) VALUES(1, \\\"DummyOrgName\\\", \\\"${ORG_ID}\\\");\" >> ${TMPFILE}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fd4aa23f91519f41e2b00a7b3036f06b1cb27b57"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQ4MDg2MQ==", "bodyText": "or taken from secrets as well?", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/309#discussion_r419480861", "createdAt": "2020-05-04T14:31:13Z", "author": {"login": "zohrehj"}, "path": "Terraform/copy_mobile_app_info_to_sql.sh", "diffHunk": "@@ -0,0 +1,30 @@\n+#!/bin/bash\n+# Script to copy AppId and OrgId from gcloud secret to CloudSQL.\n+set -e\n+\n+SECRET_PROJECT=heroes-hat-dev-devops\n+DATA_PROJECT=heroes-hat-dev-data\n+SQL_IMPORT_BUCKET=heroes-hat-dev-data-sql-import\n+TMPFILE=$(mktemp)\n+\n+# Write user registration server db name to TMPFILE.\n+echo \"USE \\`mystudies_userregistration\\`;\" >> ${TMPFILE}\n+\n+# Read AppId and OrgId from secrets..\n+APP_ID=`gcloud --project=${SECRET_PROJECT} secrets versions access latest --secret=mobile-app-appid`\n+ORG_ID=`gcloud --project=${SECRET_PROJECT} secrets versions access latest --secret=mobile-app-orgid`\n+\n+# Write corresponding SQL commands to TMPFILE.\n+echo \"INSERT INTO org_info (id, name, org_id) VALUES(1, \\\"DummyOrgName\\\", \\\"${ORG_ID}\\\");\" >> ${TMPFILE}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQ4MDY0MA=="}, "originalCommit": {"oid": "fd4aa23f91519f41e2b00a7b3036f06b1cb27b57"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQ4MTQzNA==", "bodyText": "how come org and app_info both get id=1, but you are setting id=2 for location. Is there another location that's set before this one?", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/309#discussion_r419481434", "createdAt": "2020-05-04T14:32:00Z", "author": {"login": "zohrehj"}, "path": "Terraform/copy_mobile_app_info_to_sql.sh", "diffHunk": "@@ -0,0 +1,30 @@\n+#!/bin/bash\n+# Script to copy AppId and OrgId from gcloud secret to CloudSQL.\n+set -e\n+\n+SECRET_PROJECT=heroes-hat-dev-devops\n+DATA_PROJECT=heroes-hat-dev-data\n+SQL_IMPORT_BUCKET=heroes-hat-dev-data-sql-import\n+TMPFILE=$(mktemp)\n+\n+# Write user registration server db name to TMPFILE.\n+echo \"USE \\`mystudies_userregistration\\`;\" >> ${TMPFILE}\n+\n+# Read AppId and OrgId from secrets..\n+APP_ID=`gcloud --project=${SECRET_PROJECT} secrets versions access latest --secret=mobile-app-appid`\n+ORG_ID=`gcloud --project=${SECRET_PROJECT} secrets versions access latest --secret=mobile-app-orgid`\n+\n+# Write corresponding SQL commands to TMPFILE.\n+echo \"INSERT INTO org_info (id, name, org_id) VALUES(1, \\\"DummyOrgName\\\", \\\"${ORG_ID}\\\");\" >> ${TMPFILE}\n+echo \"INSERT INTO app_info (app_info_id, custom_app_id, org_info_id) VALUES(1, \\\"${APP_ID}\\\", 1);\" >> ${TMPFILE}\n+echo \"INSERT INTO locations (id, is_default) VALUES(2, \\\"Y\\\");\" >> ${TMPFILE}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fd4aa23f91519f41e2b00a7b3036f06b1cb27b57"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5e90de970d735902d208a2c11d2928bfdeae08a2", "author": {"user": {"login": "kuoyuchi", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/5e90de970d735902d208a2c11d2928bfdeae08a2", "committedDate": "2020-05-05T16:45:00Z", "message": "Merge branch 'early-access' into app-org-info"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fa175f9fb6eb2dc5a1f3135f6349fd7bd67e3510", "author": {"user": {"login": "kuoyuchi", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/fa175f9fb6eb2dc5a1f3135f6349fd7bd67e3510", "committedDate": "2020-05-05T16:47:56Z", "message": "Merge branch 'early-access' into app-org-info"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5e40da3bc334e5c8984526e7a741ce9b394afa66", "author": {"user": {"login": "kuoyuchi", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/5e40da3bc334e5c8984526e7a741ce9b394afa66", "committedDate": "2020-05-06T03:53:33Z", "message": "Add TODO."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f04cd0ab80a5779d390d0ff7110fa43735787070", "author": {"user": {"login": "kuoyuchi", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/f04cd0ab80a5779d390d0ff7110fa43735787070", "committedDate": "2020-05-06T03:54:03Z", "message": "Merge branch 'app-org-info' of https://github.com/GoogleCloudPlatform/fda-mystudies into app-org-info"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a9265316e3aedc14554cf26405c8194dc16220b6", "author": {"user": {"login": "kuoyuchi", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/a9265316e3aedc14554cf26405c8194dc16220b6", "committedDate": "2020-05-06T03:54:24Z", "message": "Merge branch 'early-access' into app-org-info"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8cae3b407f9055b13a9dfa71ac562f5c1db01a47", "author": {"user": {"login": "zohrehj", "name": "Zohreh Jabbari"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/8cae3b407f9055b13a9dfa71ac562f5c1db01a47", "committedDate": "2020-05-06T18:22:00Z", "message": "Merge branch 'early-access' into app-org-info"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1be1a78d74ed9c63c2ccde40edad5425b4ea70a3", "author": {"user": {"login": "zohrehj", "name": "Zohreh Jabbari"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/1be1a78d74ed9c63c2ccde40edad5425b4ea70a3", "committedDate": "2020-05-06T22:20:54Z", "message": "Merge branch 'early-access' into app-org-info"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9605473f773c61b1f9a81c29fef12124c9a86568", "author": {"user": {"login": "zohrehj", "name": "Zohreh Jabbari"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/9605473f773c61b1f9a81c29fef12124c9a86568", "committedDate": "2020-05-07T19:45:39Z", "message": "Merge branch 'early-access' into app-org-info"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3697d848d0ad270a0af93e9986e186fad23fc64b", "author": {"user": {"login": "zohrehj", "name": "Zohreh Jabbari"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/3697d848d0ad270a0af93e9986e186fad23fc64b", "committedDate": "2020-05-07T19:59:49Z", "message": "Merge branch 'early-access' into app-org-info"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 984, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}