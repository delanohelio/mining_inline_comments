{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMxNTM1OTA2", "number": 2232, "title": "Participant Manager Datastore: GET /apps endpoint pagination", "bodyText": "Pagination implementation was discussed during technical discussion with Zohreh and same has been implemented.\n\nAdded additional request params - searchTerm, limit and offset- to API endpoint\nRefactored existing tests and/or added new tests for pagination.\n\nNote: This PR will be merged into develop branch after front-end changes PR is approved/merged.", "createdAt": "2020-12-03T06:17:29Z", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2232", "merged": true, "mergeCommit": {"oid": "7ca18b458c31247d4657bcb3e7aaa81942421ae4"}, "closed": true, "closedAt": "2020-12-11T10:14:23Z", "author": {"login": "monica-BTC"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdic9pMAH2gAyNTMxNTM1OTA2Ojc2MjUzYzYxZjBhYzVlMTEzNDdiYTM3NjRjNjU2MTZjOTU4NmNhMGM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdlFCDWAH2gAyNTMxNTM1OTA2OjQ2YTEyMmViOTEzNjA4MDRiOGVjOTFiMmNhMzhjMzQ1OTUwYTc3YTM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "76253c61f0ac5e11347ba3764c65616c9586ca0c", "author": {"user": {"login": "monica-BTC", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/76253c61f0ac5e11347ba3764c65616c9586ca0c", "committedDate": "2020-12-03T06:15:20Z", "message": "Apps Pagination\n\nApps Pagination"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e7b920e8fd3075d2eb2d28eedaa3265efc16389f", "author": {"user": {"login": "monica-BTC", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/e7b920e8fd3075d2eb2d28eedaa3265efc16389f", "committedDate": "2020-12-03T06:19:26Z", "message": "Merge branch 'develop' into apps-pagination"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0MTcxODQz", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2232#pullrequestreview-544171843", "createdAt": "2020-12-03T16:52:58Z", "commit": {"oid": "e7b920e8fd3075d2eb2d28eedaa3265efc16389f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxNjo1Mjo1OFrOH-mpRQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QxNjo1Mjo1OFrOH-mpRQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTQwNjkxNw==", "bodyText": "Have one test with offset being a non-zero value", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2232#discussion_r535406917", "createdAt": "2020-12-03T16:52:58Z", "author": {"login": "saminguyen"}, "path": "participant-manager-datastore/participant-manager-service/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/AppControllerTest.java", "diffHunk": "@@ -171,6 +173,88 @@ public void shouldReturnReturnAppsWithEnrolledCount() throws Exception {\n     verifyTokenIntrospectRequest();\n   }\n \n+  @Test\n+  public void shouldReturnAppsWithPagination() throws Exception {\n+    userRegAdminEntity.setSuperAdmin(false);\n+    testDataHelper.getUserRegAdminRepository().save(userRegAdminEntity);\n+\n+    for (int i = 1; i <= 20; i++) {\n+      appEntity = testDataHelper.newAppEntity();\n+      appEntity.setAppId(\"AppCustomId\" + String.valueOf(i));\n+      testDataHelper.getAppRepository().saveAndFlush(appEntity);\n+      studyEntity = testDataHelper.newStudyEntity();\n+      testDataHelper.getStudyRepository().saveAndFlush(studyEntity);\n+      SitePermissionEntity sitePermissionEntity = new SitePermissionEntity();\n+      sitePermissionEntity.setUrAdminUser(userRegAdminEntity);\n+      sitePermissionEntity.setCanEdit(Permission.EDIT);\n+      sitePermissionEntity.setApp(appEntity);\n+      sitePermissionEntity.setStudy(studyEntity);\n+      sitePermissionEntity.setSite(siteEntity);\n+      testDataHelper.getSitePermissionRepository().saveAndFlush(sitePermissionEntity);\n+      // Pagination records should be in descending order of created timestamp\n+      // Entities are not saved in sequential order so adding delay\n+      Thread.sleep(500);\n+    }\n+\n+    HttpHeaders headers = testDataHelper.newCommonHeaders();\n+    headers.add(USER_ID_HEADER, userRegAdminEntity.getId());\n+\n+    mockMvc\n+        .perform(\n+            get(ApiEndpoint.GET_APPS.getPath())\n+                .param(\"limit\", \"5\")\n+                .param(\"offset\", \"0\")\n+                .headers(headers)\n+                .contextPath(getContextPath()))\n+        .andDo(print())\n+        .andExpect(status().isOk())\n+        .andExpect(jsonPath(\"$.apps\").isArray())\n+        .andExpect(jsonPath(\"$.apps\", hasSize(5)))\n+        .andExpect(jsonPath(\"$.apps[0].customId\").value(\"AppCustomId20\"))\n+        .andExpect(jsonPath(\"$.apps[4].customId\").value(\"AppCustomId16\"));\n+\n+    verifyTokenIntrospectRequest();\n+  }\n+\n+  @Test\n+  public void shouldReturnAppsWithPaginationForSuperAdmin() throws Exception {\n+    userRegAdminEntity.setSuperAdmin(true);\n+    testDataHelper.getUserRegAdminRepository().save(userRegAdminEntity);\n+\n+    for (int i = 1; i <= 20; i++) {\n+      appEntity = testDataHelper.newAppEntity();\n+      appEntity.setAppId(\"AppCustomId\" + String.valueOf(i));\n+      testDataHelper.getAppRepository().saveAndFlush(appEntity);\n+      studyEntity = testDataHelper.newStudyEntity();\n+      testDataHelper.getStudyRepository().saveAndFlush(studyEntity);\n+      siteEntity = testDataHelper.newSiteEntity();\n+      siteEntity.setStudy(studyEntity);\n+      testDataHelper.getSiteRepository().saveAndFlush(siteEntity);\n+      // Pagination records should be in descending order of created timestamp\n+      // Entities are not saved in sequential order so adding delay\n+      Thread.sleep(500);\n+    }\n+\n+    HttpHeaders headers = testDataHelper.newCommonHeaders();\n+    headers.add(USER_ID_HEADER, userRegAdminEntity.getId());\n+\n+    mockMvc\n+        .perform(\n+            get(ApiEndpoint.GET_APPS.getPath())\n+                .param(\"limit\", \"20\")\n+                .param(\"offset\", \"0\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e7b920e8fd3075d2eb2d28eedaa3265efc16389f"}, "originalPosition": 88}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d7ce48c5373ab272af51c78b67aed3244566f169", "author": {"user": {"login": "monica-BTC", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/d7ce48c5373ab272af51c78b67aed3244566f169", "committedDate": "2020-12-04T08:24:54Z", "message": "Fixed Review Comment\n\nFixed Review Comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8785726c1bc6207b7a8e79e772d8e5e40c860409", "author": {"user": {"login": "monica-BTC", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/8785726c1bc6207b7a8e79e772d8e5e40c860409", "committedDate": "2020-12-07T13:17:46Z", "message": "Merge branch 'develop' into apps-pagination"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e5ef0d888f1a6a563dd06811ad021ede0a0be20b", "author": {"user": {"login": "monica-BTC", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/e5ef0d888f1a6a563dd06811ad021ede0a0be20b", "committedDate": "2020-12-07T14:52:04Z", "message": "search term implementation\n\nsearch term implementation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ2NjIwNzE1", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2232#pullrequestreview-546620715", "createdAt": "2020-12-07T23:21:13Z", "commit": {"oid": "e5ef0d888f1a6a563dd06811ad021ede0a0be20b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "46a122eb91360804b8ec91b2ca38c345950a77a3", "author": {"user": {"login": "monica-BTC", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/46a122eb91360804b8ec91b2ca38c345950a77a3", "committedDate": "2020-12-11T10:04:12Z", "message": "Merge branch 'develop' into apps-pagination"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1135, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}