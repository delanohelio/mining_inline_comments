{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDAyMzg1MjY4", "number": 136, "title": "Add bastion host.", "bodyText": "", "createdAt": "2020-04-12T19:14:52Z", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/136", "merged": true, "mergeCommit": {"oid": "bf6895ddfb62fd3cef4aa7bc1b35dd9ceef05887"}, "closed": true, "closedAt": "2020-04-15T00:14:40Z", "author": {"login": "xingao267"}, "timelineItems": {"totalCount": 21, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcW_THhgBqjMyMjUzNzY0NTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcXsuBhAFqTM5MzM3Njg1OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6a325db6576074a611947ab3415bfa6eea89f432", "author": {"user": {"login": "xingao267", "name": "Xin Gao"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/6a325db6576074a611947ab3415bfa6eea89f432", "committedDate": "2020-04-12T18:44:56Z", "message": "Add bastion host."}, "afterCommit": {"oid": "86b4a01ed17c35a5989db79f37156b81f468dcdf", "author": {"user": {"login": "xingao267", "name": "Xin Gao"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/86b4a01ed17c35a5989db79f37156b81f468dcdf", "committedDate": "2020-04-12T19:17:07Z", "message": "Add bastion host."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "86b4a01ed17c35a5989db79f37156b81f468dcdf", "author": {"user": {"login": "xingao267", "name": "Xin Gao"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/86b4a01ed17c35a5989db79f37156b81f468dcdf", "committedDate": "2020-04-12T19:17:07Z", "message": "Add bastion host."}, "afterCommit": {"oid": "ac6eb464411ed38128127ddd55694a43f15330b3", "author": {"user": {"login": "xingao267", "name": "Xin Gao"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/ac6eb464411ed38128127ddd55694a43f15330b3", "committedDate": "2020-04-12T19:22:07Z", "message": "Add bastion host."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "ac6eb464411ed38128127ddd55694a43f15330b3", "author": {"user": {"login": "xingao267", "name": "Xin Gao"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/ac6eb464411ed38128127ddd55694a43f15330b3", "committedDate": "2020-04-12T19:22:07Z", "message": "Add bastion host."}, "afterCommit": {"oid": "1b7b4137d430a54128055a8a560a96fc941a7819", "author": {"user": {"login": "xingao267", "name": "Xin Gao"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/1b7b4137d430a54128055a8a560a96fc941a7819", "committedDate": "2020-04-12T19:26:33Z", "message": "Add bastion host."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzMDA1MTY1", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/136#pullrequestreview-393005165", "createdAt": "2020-04-14T14:50:30Z", "commit": {"oid": "bcfe9119e6fa47e7f6cbd2e72d06b528c3e43087"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxNDo1MDozMFrOGFSdMA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxNDo1OTozNlrOGFS7dQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODE5ODQ0OA==", "bodyText": "Do you need to run apt-get -y update first?", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/136#discussion_r408198448", "createdAt": "2020-04-14T14:50:30Z", "author": {"login": "MartinPetkov"}, "path": "Terraform/org/folder.fda-my-studies/project.heroes-hat-dev-networks/networks/bastion.tf", "diffHunk": "@@ -0,0 +1,48 @@\n+# Copyright 2020 Google Inc.\n+#\n+# Licensed under the Apache License, Version 2.0 (the \"License\");\n+# you may not use this file except in compliance with the License.\n+# You may obtain a copy of the License at\n+#\n+#      http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+# $ gcloud compute ssh bastion-vm --zone=<var.zone> --project=<var.project_id>\n+# $ sudo apt install mysql-client-core-5.7", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bcfe9119e6fa47e7f6cbd2e72d06b528c3e43087"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODIwMjQ1Mg==", "bodyText": "My preference would be to continue calling this \"gke_region\", since the module is a generic \"networks\", and it might not be obvious to someone passing in variables that \"region\" also affects the GKE cluster.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/136#discussion_r408202452", "createdAt": "2020-04-14T14:55:18Z", "author": {"login": "MartinPetkov"}, "path": "Terraform/org/folder.fda-my-studies/project.heroes-hat-dev-networks/networks/variables.tf", "diffHunk": "@@ -2,9 +2,13 @@ variable \"project_id\" {\n   type = string\n }\n \n-variable \"gke_region\" {\n-  description = \"The region where the network and subnets will be created for the GKE clusters\"\n-  default     = \"us-central1\"\n+variable \"region\" {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bcfe9119e6fa47e7f6cbd2e72d06b528c3e43087"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODIwNDMxNg==", "bodyText": "How come the bastion host is in the same subnet as the GKE clusters?", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/136#discussion_r408204316", "createdAt": "2020-04-14T14:57:27Z", "author": {"login": "MartinPetkov"}, "path": "Terraform/org/folder.fda-my-studies/project.heroes-hat-dev-networks/networks/bastion.tf", "diffHunk": "@@ -0,0 +1,48 @@\n+# Copyright 2020 Google Inc.\n+#\n+# Licensed under the Apache License, Version 2.0 (the \"License\");\n+# you may not use this file except in compliance with the License.\n+# You may obtain a copy of the License at\n+#\n+#      http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+# $ gcloud compute ssh bastion-vm --zone=<var.zone> --project=<var.project_id>\n+# $ sudo apt install mysql-client-core-5.7\n+# $ mysql -h <sql_internal_ip> -u root\n+module \"iap_bastion\" {\n+  source = \"terraform-google-modules/bastion-host/google\"\n+\n+  name         = \"bastion-vm\"\n+  host_project = var.project_id\n+  project      = var.project_id\n+  region       = var.region\n+  zone         = var.zone\n+  network      = module.private.network_self_link\n+  subnet       = local.gke_subnet.self_link", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bcfe9119e6fa47e7f6cbd2e72d06b528c3e43087"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODIwNTI3MQ==", "bodyText": "Could this be done through the startup_script parameter?", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/136#discussion_r408205271", "createdAt": "2020-04-14T14:58:37Z", "author": {"login": "MartinPetkov"}, "path": "Terraform/org/folder.fda-my-studies/project.heroes-hat-dev-networks/networks/bastion.tf", "diffHunk": "@@ -0,0 +1,48 @@\n+# Copyright 2020 Google Inc.\n+#\n+# Licensed under the Apache License, Version 2.0 (the \"License\");\n+# you may not use this file except in compliance with the License.\n+# You may obtain a copy of the License at\n+#\n+#      http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+# $ gcloud compute ssh bastion-vm --zone=<var.zone> --project=<var.project_id>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bcfe9119e6fa47e7f6cbd2e72d06b528c3e43087"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODIwNjE5Nw==", "bodyText": "I think this is brittle, in that a user could easily forget to remove this block and re-apply the Terraform configs. Is there maybe a VM family that already has this package installed?", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/136#discussion_r408206197", "createdAt": "2020-04-14T14:59:36Z", "author": {"login": "MartinPetkov"}, "path": "Terraform/org/folder.fda-my-studies/project.heroes-hat-dev-networks/networks/bastion.tf", "diffHunk": "@@ -0,0 +1,48 @@\n+# Copyright 2020 Google Inc.\n+#\n+# Licensed under the Apache License, Version 2.0 (the \"License\");\n+# you may not use this file except in compliance with the License.\n+# You may obtain a copy of the License at\n+#\n+#      http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+# $ gcloud compute ssh bastion-vm --zone=<var.zone> --project=<var.project_id>\n+# $ sudo apt install mysql-client-core-5.7\n+# $ mysql -h <sql_internal_ip> -u root\n+module \"iap_bastion\" {\n+  source = \"terraform-google-modules/bastion-host/google\"\n+\n+  name         = \"bastion-vm\"\n+  host_project = var.project_id\n+  project      = var.project_id\n+  region       = var.region\n+  zone         = var.zone\n+  network      = module.private.network_self_link\n+  subnet       = local.gke_subnet.self_link\n+  image_family = \"ubuntu-1804-lts\"\n+  members      = var.bastion_users\n+}\n+\n+# Temporarily allow bastion-VM to connect to the Internet to install `mysql-client-core-5.7`.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bcfe9119e6fa47e7f6cbd2e72d06b528c3e43087"}, "originalPosition": 32}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzMDgwMDg3", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/136#pullrequestreview-393080087", "createdAt": "2020-04-14T16:08:36Z", "commit": {"oid": "bcfe9119e6fa47e7f6cbd2e72d06b528c3e43087"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxNjowODozN1rOGFWHKg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxNjowODozN1rOGFWHKg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODI1ODM0Ng==", "bodyText": "The default settings are likely suitable here, no need to set them", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/136#discussion_r408258346", "createdAt": "2020-04-14T16:08:37Z", "author": {"login": "umairidris"}, "path": "Terraform/org/folder.fda-my-studies/project.heroes-hat-dev-networks/networks/bastion.tf", "diffHunk": "@@ -0,0 +1,48 @@\n+# Copyright 2020 Google Inc.\n+#\n+# Licensed under the Apache License, Version 2.0 (the \"License\");\n+# you may not use this file except in compliance with the License.\n+# You may obtain a copy of the License at\n+#\n+#      http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+# $ gcloud compute ssh bastion-vm --zone=<var.zone> --project=<var.project_id>\n+# $ sudo apt install mysql-client-core-5.7\n+# $ mysql -h <sql_internal_ip> -u root\n+module \"iap_bastion\" {\n+  source = \"terraform-google-modules/bastion-host/google\"\n+\n+  name         = \"bastion-vm\"\n+  host_project = var.project_id\n+  project      = var.project_id\n+  region       = var.region\n+  zone         = var.zone\n+  network      = module.private.network_self_link\n+  subnet       = local.gke_subnet.self_link\n+  image_family = \"ubuntu-1804-lts\"\n+  members      = var.bastion_users\n+}\n+\n+# Temporarily allow bastion-VM to connect to the Internet to install `mysql-client-core-5.7`.\n+# Remove after installation.\n+module \"cloud-nat\" {\n+  source  = \"terraform-google-modules/cloud-router/google\"\n+  name    = \"bastion-router\"\n+  region  = var.region\n+  project = var.project_id\n+  network = module.private.network_name\n+  nats = [{\n+    name                             = \"bastion-nat\"\n+    min_ports_per_vm                 = \"64\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bcfe9119e6fa47e7f6cbd2e72d06b528c3e43087"}, "originalPosition": 42}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzMDg5ODA3", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/136#pullrequestreview-393089807", "createdAt": "2020-04-14T16:20:15Z", "commit": {"oid": "bcfe9119e6fa47e7f6cbd2e72d06b528c3e43087"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxNjoyMDoxNVrOGFWmog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxNjoyMDoxNVrOGFWmog==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODI2NjQwMg==", "bodyText": "Isn't there a startup script that can be set?", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/136#discussion_r408266402", "createdAt": "2020-04-14T16:20:15Z", "author": {"login": "umairidris"}, "path": "Terraform/org/folder.fda-my-studies/project.heroes-hat-dev-networks/networks/bastion.tf", "diffHunk": "@@ -0,0 +1,48 @@\n+# Copyright 2020 Google Inc.\n+#\n+# Licensed under the Apache License, Version 2.0 (the \"License\");\n+# you may not use this file except in compliance with the License.\n+# You may obtain a copy of the License at\n+#\n+#      http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+# $ gcloud compute ssh bastion-vm --zone=<var.zone> --project=<var.project_id>\n+# $ sudo apt install mysql-client-core-5.7", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bcfe9119e6fa47e7f6cbd2e72d06b528c3e43087"}, "originalPosition": 16}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzMDk1NzA4", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/136#pullrequestreview-393095708", "createdAt": "2020-04-14T16:27:12Z", "commit": {"oid": "bcfe9119e6fa47e7f6cbd2e72d06b528c3e43087"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxNjoyNzoxMlrOGFW5iQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQxNjoyNzoxMlrOGFW5iQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODI3MTI0MQ==", "bodyText": "This doesn't make a difference btw, it will just set the min to be 2.2 but if there is a version higher than 2.2 then it will pick that anyway when doing 2.0. That's why I typically prefer doing x.0 versions just to pin to a major version for most modules that are not complex.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/136#discussion_r408271241", "createdAt": "2020-04-14T16:27:12Z", "author": {"login": "umairidris"}, "path": "Terraform/org/folder.fda-my-studies/project.heroes-hat-dev-networks/networks/main.tf", "diffHunk": "@@ -8,7 +8,7 @@ locals {\n \n module \"private\" {\n   source  = \"terraform-google-modules/network/google\"\n-  version = \"~> 2.0\"\n+  version = \"~> 2.2\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bcfe9119e6fa47e7f6cbd2e72d06b528c3e43087"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "803792e991edd2198cc7fe2ca3712b3b27f7bf0b", "author": {"user": {"login": "xingao267", "name": "Xin Gao"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/803792e991edd2198cc7fe2ca3712b3b27f7bf0b", "committedDate": "2020-04-14T22:21:28Z", "message": "Add bastion host."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e0522b44d8ebbcd3828182cc3dd801ed7a1c2b0d", "author": {"user": {"login": "xingao267", "name": "Xin Gao"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/e0522b44d8ebbcd3828182cc3dd801ed7a1c2b0d", "committedDate": "2020-04-14T22:21:28Z", "message": "Add NAT."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3572cc305718000d863afd41a6f964456daa3a65", "author": {"user": {"login": "xingao267", "name": "Xin Gao"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/3572cc305718000d863afd41a6f964456daa3a65", "committedDate": "2020-04-14T22:21:29Z", "message": "Fix format."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ac2a37ba89177e01b76790c907c15d99db32e1a0", "author": {"user": {"login": "xingao267", "name": "Xin Gao"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/ac2a37ba89177e01b76790c907c15d99db32e1a0", "committedDate": "2020-04-14T22:21:29Z", "message": "Add VM startup script and restrict NAT source IP range."}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "bcfe9119e6fa47e7f6cbd2e72d06b528c3e43087", "author": {"user": {"login": "xingao267", "name": "Xin Gao"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/bcfe9119e6fa47e7f6cbd2e72d06b528c3e43087", "committedDate": "2020-04-14T14:08:28Z", "message": "Fix format."}, "afterCommit": {"oid": "ac2a37ba89177e01b76790c907c15d99db32e1a0", "author": {"user": {"login": "xingao267", "name": "Xin Gao"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/ac2a37ba89177e01b76790c907c15d99db32e1a0", "committedDate": "2020-04-14T22:21:29Z", "message": "Add VM startup script and restrict NAT source IP range."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzMzQzOTIz", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/136#pullrequestreview-393343923", "createdAt": "2020-04-14T22:39:14Z", "commit": {"oid": "ac2a37ba89177e01b76790c907c15d99db32e1a0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzMzQ0MDM0", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/136#pullrequestreview-393344034", "createdAt": "2020-04-14T22:39:27Z", "commit": {"oid": "ac2a37ba89177e01b76790c907c15d99db32e1a0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQyMjozOToyN1rOGFjeLQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQyMjozOToyN1rOGFjeLQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ3NzIyOQ==", "bodyText": "cloud_nat", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/136#discussion_r408477229", "createdAt": "2020-04-14T22:39:27Z", "author": {"login": "umairidris"}, "path": "Terraform/org/folder.fda-my-studies/project.heroes-hat-dev-networks/networks/bastion.tf", "diffHunk": "@@ -0,0 +1,57 @@\n+# Copyright 2020 Google Inc.\n+#\n+# Licensed under the Apache License, Version 2.0 (the \"License\");\n+# you may not use this file except in compliance with the License.\n+# You may obtain a copy of the License at\n+#\n+#      http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+# $ gcloud compute ssh bastion-vm --zone=<var.zone> --project=<var.project_id>\n+# $ mysql -h <sql_internal_ip> -u root\n+module \"iap_bastion\" {\n+  source = \"terraform-google-modules/bastion-host/google\"\n+\n+  name           = \"bastion-vm\"\n+  host_project   = var.project_id\n+  project        = var.project_id\n+  region         = var.region\n+  zone           = var.zone\n+  network        = module.private.network_self_link\n+  subnet         = module.private.subnets[\"${var.region}/${local.bastion_subnet_name}\"].self_link\n+  image_family   = \"ubuntu-1804-lts\"\n+  members        = var.bastion_users\n+  startup_script = <<EOF\n+#!/bin/bash\n+dpkg -l mysql-client-core-5.7\n+if [ $? -eq 0 ]; then\n+  echo \"mysql-client already installed\"\n+else\n+  sudo apt-get -y update\n+  sudo apt-get -y install mysql-client-core-5.7\n+fi\n+EOF\n+}\n+\n+# NAT to allow bastion-VM to connect to the Internet to install `mysql-client-core-5.7`.\n+module \"cloud-nat\" {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ac2a37ba89177e01b76790c907c15d99db32e1a0"}, "originalPosition": 42}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzMzQ0Mjcz", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/136#pullrequestreview-393344273", "createdAt": "2020-04-14T22:39:59Z", "commit": {"oid": "ac2a37ba89177e01b76790c907c15d99db32e1a0"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzMzQ0NTc0", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/136#pullrequestreview-393344574", "createdAt": "2020-04-14T22:40:40Z", "commit": {"oid": "ac2a37ba89177e01b76790c907c15d99db32e1a0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQyMjo0MDo0MFrOGFjf6g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQyMjo0MDo0MFrOGFjf6g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ3NzY3NA==", "bodyText": "Do we still need to check or we can always just install mysql?", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/136#discussion_r408477674", "createdAt": "2020-04-14T22:40:40Z", "author": {"login": "umairidris"}, "path": "Terraform/org/folder.fda-my-studies/project.heroes-hat-dev-networks/networks/bastion.tf", "diffHunk": "@@ -0,0 +1,57 @@\n+# Copyright 2020 Google Inc.\n+#\n+# Licensed under the Apache License, Version 2.0 (the \"License\");\n+# you may not use this file except in compliance with the License.\n+# You may obtain a copy of the License at\n+#\n+#      http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+# $ gcloud compute ssh bastion-vm --zone=<var.zone> --project=<var.project_id>\n+# $ mysql -h <sql_internal_ip> -u root\n+module \"iap_bastion\" {\n+  source = \"terraform-google-modules/bastion-host/google\"\n+\n+  name           = \"bastion-vm\"\n+  host_project   = var.project_id\n+  project        = var.project_id\n+  region         = var.region\n+  zone           = var.zone\n+  network        = module.private.network_self_link\n+  subnet         = module.private.subnets[\"${var.region}/${local.bastion_subnet_name}\"].self_link\n+  image_family   = \"ubuntu-1804-lts\"\n+  members        = var.bastion_users\n+  startup_script = <<EOF\n+#!/bin/bash\n+dpkg -l mysql-client-core-5.7", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ac2a37ba89177e01b76790c907c15d99db32e1a0"}, "originalPosition": 31}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e0bc1d0b87e9b6abca10eca2d4dfab116e7f3ea9", "author": {"user": {"login": "xingao267", "name": "Xin Gao"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/e0bc1d0b87e9b6abca10eca2d4dfab116e7f3ea9", "committedDate": "2020-04-14T22:42:02Z", "message": "naming"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzMzQ2MjA1", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/136#pullrequestreview-393346205", "createdAt": "2020-04-14T22:44:53Z", "commit": {"oid": "e0bc1d0b87e9b6abca10eca2d4dfab116e7f3ea9"}, "state": "DISMISSED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQyMjo0NDo1NFrOGFjluQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQyMjo1MDo0MFrOGFjtyA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ3OTE2MQ==", "bodyText": "Nit, but this could just be\nif dpkg -l mysql-client-core-5.7; then\n...", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/136#discussion_r408479161", "createdAt": "2020-04-14T22:44:54Z", "author": {"login": "MartinPetkov"}, "path": "Terraform/org/folder.fda-my-studies/project.heroes-hat-dev-networks/networks/bastion.tf", "diffHunk": "@@ -0,0 +1,57 @@\n+# Copyright 2020 Google Inc.\n+#\n+# Licensed under the Apache License, Version 2.0 (the \"License\");\n+# you may not use this file except in compliance with the License.\n+# You may obtain a copy of the License at\n+#\n+#      http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\n+# $ gcloud compute ssh bastion-vm --zone=<var.zone> --project=<var.project_id>\n+# $ mysql -h <sql_internal_ip> -u root\n+module \"bastion\" {\n+  source = \"terraform-google-modules/bastion-host/google\"\n+\n+  name           = \"bastion-vm\"\n+  host_project   = var.project_id\n+  project        = var.project_id\n+  region         = var.region\n+  zone           = var.zone\n+  network        = module.private.network_self_link\n+  subnet         = module.private.subnets[\"${var.region}/${local.bastion_subnet_name}\"].self_link\n+  image_family   = \"ubuntu-1804-lts\"\n+  members        = var.bastion_users\n+  startup_script = <<EOF\n+#!/bin/bash\n+dpkg -l mysql-client-core-5.7", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e0bc1d0b87e9b6abca10eca2d4dfab116e7f3ea9"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ4MDQwNQ==", "bodyText": "This comment is a great idea, thanks.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/136#discussion_r408480405", "createdAt": "2020-04-14T22:48:28Z", "author": {"login": "MartinPetkov"}, "path": "Terraform/org/folder.fda-my-studies/project.heroes-hat-dev-networks/networks/main.tf", "diffHunk": "@@ -4,21 +4,33 @@ terraform {\n \n locals {\n   gke_clusters_subnet_name = \"gke-clusters-subnet\"\n+  bastion_subnet_name      = \"bastion-subnet\"\n }\n \n module \"private\" {\n   source  = \"terraform-google-modules/network/google\"\n-  version = \"~> 2.0\"\n+  version = \"~> 2.2\"\n \n   project_id   = var.project_id\n   network_name = \"private\"\n \n-  # Multiple clusters can be in the same network and subnet.\n   subnets = [\n     {\n-      subnet_name      = local.gke_clusters_subnet_name\n+      # Multiple clusters can be in the same network and subnet.\n+      subnet_name = local.gke_clusters_subnet_name\n+      # 10.0.0.0 --> 10.0.127.255", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e0bc1d0b87e9b6abca10eca2d4dfab116e7f3ea9"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ4MTIyNA==", "bodyText": "Nit: I don't see a reason to reserve 255 IPs for just one host, I suspect this would work with a /30 range too. But if it works, I don't insist on changing it.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/136#discussion_r408481224", "createdAt": "2020-04-14T22:50:40Z", "author": {"login": "MartinPetkov"}, "path": "Terraform/org/folder.fda-my-studies/project.heroes-hat-dev-networks/networks/main.tf", "diffHunk": "@@ -4,21 +4,33 @@ terraform {\n \n locals {\n   gke_clusters_subnet_name = \"gke-clusters-subnet\"\n+  bastion_subnet_name      = \"bastion-subnet\"\n }\n \n module \"private\" {\n   source  = \"terraform-google-modules/network/google\"\n-  version = \"~> 2.0\"\n+  version = \"~> 2.2\"\n \n   project_id   = var.project_id\n   network_name = \"private\"\n \n-  # Multiple clusters can be in the same network and subnet.\n   subnets = [\n     {\n-      subnet_name      = local.gke_clusters_subnet_name\n+      # Multiple clusters can be in the same network and subnet.\n+      subnet_name = local.gke_clusters_subnet_name\n+      # 10.0.0.0 --> 10.0.127.255\n       subnet_ip        = \"10.0.0.0/17\"\n-      subnet_region    = var.gke_region\n+      subnet_region    = var.region\n+      subnet_flow_logs = \"true\"\n+\n+      # Needed for access to Cloud SQL.\n+      subnet_private_access = \"true\"\n+    },\n+    {\n+      subnet_name = local.bastion_subnet_name\n+      # 10.0.128.0 --> 10.0.128.255\n+      subnet_ip        = \"10.0.128.0/24\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e0bc1d0b87e9b6abca10eca2d4dfab116e7f3ea9"}, "originalPosition": 33}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzMzQ5OTI1", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/136#pullrequestreview-393349925", "createdAt": "2020-04-14T22:54:24Z", "commit": {"oid": "e0bc1d0b87e9b6abca10eca2d4dfab116e7f3ea9"}, "state": "DISMISSED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQyMjo1NDoyNFrOGFjy2w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNFQyMjo1NDoyNFrOGFjy2w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODQ4MjUyMw==", "bodyText": "remove quotes", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/136#discussion_r408482523", "createdAt": "2020-04-14T22:54:24Z", "author": {"login": "umairidris"}, "path": "Terraform/org/folder.fda-my-studies/project.heroes-hat-dev-networks/networks/main.tf", "diffHunk": "@@ -4,21 +4,33 @@ terraform {\n \n locals {\n   gke_clusters_subnet_name = \"gke-clusters-subnet\"\n+  bastion_subnet_name      = \"bastion-subnet\"\n }\n \n module \"private\" {\n   source  = \"terraform-google-modules/network/google\"\n-  version = \"~> 2.0\"\n+  version = \"~> 2.2\"\n \n   project_id   = var.project_id\n   network_name = \"private\"\n \n-  # Multiple clusters can be in the same network and subnet.\n   subnets = [\n     {\n-      subnet_name      = local.gke_clusters_subnet_name\n+      # Multiple clusters can be in the same network and subnet.\n+      subnet_name = local.gke_clusters_subnet_name\n+      # 10.0.0.0 --> 10.0.127.255\n       subnet_ip        = \"10.0.0.0/17\"\n-      subnet_region    = var.gke_region\n+      subnet_region    = var.region\n+      subnet_flow_logs = \"true\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e0bc1d0b87e9b6abca10eca2d4dfab116e7f3ea9"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "71104bc82052a81cef5b214bbb52f8cfe663c181", "author": {"user": {"login": "xingao267", "name": "Xin Gao"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/71104bc82052a81cef5b214bbb52f8cfe663c181", "committedDate": "2020-04-15T00:06:24Z", "message": "address code review comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzkzMzc2ODU5", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/136#pullrequestreview-393376859", "createdAt": "2020-04-15T00:12:26Z", "commit": {"oid": "71104bc82052a81cef5b214bbb52f8cfe663c181"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1291, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}