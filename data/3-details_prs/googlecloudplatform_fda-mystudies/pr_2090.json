{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIzNTA3OTM2", "number": 2090, "title": "Add logs writer permission for Service Accounts to fix issue 2058", "bodyText": "", "createdAt": "2020-11-18T21:59:25Z", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2090", "merged": true, "mergeCommit": {"oid": "31ec9de2d348f3398160830ae22a59b5dd1e2b98"}, "closed": true, "closedAt": "2020-11-19T17:13:31Z", "author": {"login": "saminguyen"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdd1cyVgH2gAyNTIzNTA3OTM2OmE5NTFmYzNmZDA0NDQ1ZWJjZGM2NWUzNGM4NmZmYTMzODQxODY3OTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdeF-xRgH2gAyNTIzNTA3OTM2OjEwMTY5M2Y3Y2YxZDM4MDQ5M2MwMmRhNmI5NWYwMjE3NzVkZDAwM2U=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a951fc3fd04445ebcdc65e34c86ffa3384186792", "author": {"user": {"login": "saminguyen", "name": "Sami Nguyen"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/a951fc3fd04445ebcdc65e34c86ffa3384186792", "committedDate": "2020-11-18T21:57:27Z", "message": "Add logs writer permission for Service Accounts to fix issue 2058"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMzOTI4MjI1", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2090#pullrequestreview-533928225", "createdAt": "2020-11-18T22:19:02Z", "commit": {"oid": "a951fc3fd04445ebcdc65e34c86ffa3384186792"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQyMjoxOTowMlrOH2En6Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQyMjoxOTowMlrOH2En6Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQ2MDkwNQ==", "bodyText": "Should be inserted at line L605 so those permissions are added in the apps projects. Since the SAs are created in the same deployment, we need to ensure the permissions are granted after the SAs are created. To do that, we can use references to enforce the dependency. For example\ndo\n\"\"serviceAccount:$${google_service_account.auth_server_gke_sa.account_id}@{{$prefix}}-{{$env}}-apps.iam.gserviceaccount.com\"\ninstead of \"serviceAccount:auth-server-gke-sa@{{$prefix}}-{{$env}}-apps.iam.gserviceaccount.com\" directly.\nBe careful with the Terraform references should use _ instead of -", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2090#discussion_r526460905", "createdAt": "2020-11-18T22:19:02Z", "author": {"login": "xingao267"}, "path": "deployment.hcl", "diffHunk": "@@ -749,6 +749,19 @@ EOF\n           \"serviceAccount:participant-manager-gke-sa@{{$prefix}}-{{$env}}-apps.iam.gserviceaccount.com\",\n           \"serviceAccount:triggers-pubsub-handler-gke-sa@{{$prefix}}-{{$env}}-apps.iam.gserviceaccount.com\",\n         ]\n+        \"roles/logging.logWriter \" = [", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a951fc3fd04445ebcdc65e34c86ffa3384186792"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "81440c1b426ea88187cce74dec1548ed02a6779c", "author": {"user": {"login": "saminguyen", "name": "Sami Nguyen"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/81440c1b426ea88187cce74dec1548ed02a6779c", "committedDate": "2020-11-18T23:00:21Z", "message": "moved the logs writer roll assignments up"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0b020dd09e7f19151261af5455ff6b35bc68e3d7", "author": {"user": {"login": "saminguyen", "name": "Sami Nguyen"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/0b020dd09e7f19151261af5455ff6b35bc68e3d7", "committedDate": "2020-11-18T23:14:08Z", "message": "fixed conflicts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e82c948a84e8b444949ad72e9f291bfeadb94424", "author": {"user": {"login": "saminguyen", "name": "Sami Nguyen"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/e82c948a84e8b444949ad72e9f291bfeadb94424", "committedDate": "2020-11-18T23:17:06Z", "message": "fixed references"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "40744c4f72c4922be94dec0255b17a29f18bef24", "author": {"user": {"login": "saminguyen", "name": "Sami Nguyen"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/40744c4f72c4922be94dec0255b17a29f18bef24", "committedDate": "2020-11-19T05:35:12Z", "message": "fixed references"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM0NTY0Mzg5", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2090#pullrequestreview-534564389", "createdAt": "2020-11-19T15:29:12Z", "commit": {"oid": "40744c4f72c4922be94dec0255b17a29f18bef24"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxNToyOToxMlrOH2kJNw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxNToyOToxMlrOH2kJNw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjk3NzMzNQ==", "bodyText": "Consider adding a comment why these IAM bindings are needed.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2090#discussion_r526977335", "createdAt": "2020-11-19T15:29:12Z", "author": {"login": "xingao267"}, "path": "mystudies.hcl", "diffHunk": "@@ -602,6 +602,19 @@ template \"project_apps\" {\n         { account_id = \"participant-manager-gke-sa\" },\n         { account_id = \"triggers-pubsub-handler-gke-sa\" },\n       ]\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "40744c4f72c4922be94dec0255b17a29f18bef24"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM0NTY0NDUx", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2090#pullrequestreview-534564451", "createdAt": "2020-11-19T15:29:15Z", "commit": {"oid": "40744c4f72c4922be94dec0255b17a29f18bef24"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "22b655140186635acd0192aad64aa02cc92e4331", "author": {"user": {"login": "saminguyen", "name": "Sami Nguyen"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/22b655140186635acd0192aad64aa02cc92e4331", "committedDate": "2020-11-19T17:07:01Z", "message": "added comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTM0NjY4MDU5", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2090#pullrequestreview-534668059", "createdAt": "2020-11-19T17:11:02Z", "commit": {"oid": "22b655140186635acd0192aad64aa02cc92e4331"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ed227f9c038e79bde461835f3be7b28af3c54d96", "author": {"user": {"login": "saminguyen", "name": "Sami Nguyen"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/ed227f9c038e79bde461835f3be7b28af3c54d96", "committedDate": "2020-11-19T17:12:35Z", "message": "Merge branch 'develop' into fix-issue-2058"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "101693f7cf1d380493c02da6b95f021775dd003e", "author": {"user": {"login": "saminguyen", "name": "Sami Nguyen"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/101693f7cf1d380493c02da6b95f021775dd003e", "committedDate": "2020-11-19T17:13:03Z", "message": "Merge branch 'develop' into fix-issue-2058"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1225, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}