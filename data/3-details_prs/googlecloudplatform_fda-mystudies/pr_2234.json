{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMxNTY3OTM0", "number": 2234, "title": "Participant Manager Datastore : GET /{appId}/participants endpoint", "bodyText": "Pagination implementation was discussed during technical discussion with Zohreh and same has been implemented.\n\nAdded additional request params - sortBy, sortDirection, searchTerm, limit and offset- to API endpoint\nRefactored existing tests and/or added new tests for pagination.\n\nNote: This PR will be merged into develop branch after front-end changes PR is approved/merged.", "createdAt": "2020-12-03T07:21:45Z", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2234", "merged": true, "mergeCommit": {"oid": "e7d0dc560ce550702f08230d2ce6afeaba52c4d5"}, "closed": true, "closedAt": "2020-12-15T04:29:47Z", "author": {"login": "monica-BTC"}, "timelineItems": {"totalCount": 25, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdid4gxAH2gAyNTMxNTY3OTM0OmU2ZjBiMGI2MjlhNTE3NGUyMjI0M2EwMTRmZGM5NmEwMTVmN2ExYTg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdmSlZpAH2gAyNTMxNTY3OTM0OmE0MDc4ODBlMjkzMmExMGMxM2UwN2M3NDIxZjg4YjgzYWRiNWVkNTU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e6f0b0b629a5174e22243a014fdc96a015f7a1a8", "author": {"user": {"login": "monica-BTC", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/e6f0b0b629a5174e22243a014fdc96a015f7a1a8", "committedDate": "2020-12-03T07:19:38Z", "message": "App Participants Pagination\n\nApp Participants Pagination"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0MTc2MzYw", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2234#pullrequestreview-544176360", "createdAt": "2020-12-03T16:57:41Z", "commit": {"oid": "e6f0b0b629a5174e22243a014fdc96a015f7a1a8"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f0a342a8467202a76aadd9423f1bea82cf42dd68", "author": {"user": {"login": "monica-BTC", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/f0a342a8467202a76aadd9423f1bea82cf42dd68", "committedDate": "2020-12-07T13:03:27Z", "message": "Merge branch 'develop' into app-participants-pagination"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c153e90e0ec52810b04e8c207623cf5274201855", "author": {"user": {"login": "monica-BTC", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/c153e90e0ec52810b04e8c207623cf5274201855", "committedDate": "2020-12-07T14:04:31Z", "message": "updated sorting and search term\n\nupdated sorting and search term"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "011850f4fe6e7d0c18114a034b829b1e8c6702ef", "author": {"user": {"login": "monica-BTC", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/011850f4fe6e7d0c18114a034b829b1e8c6702ef", "committedDate": "2020-12-07T14:11:29Z", "message": "Update AppController.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e9c709be75a13725fbb39a3d8e69de85b4e54f24", "author": {"user": {"login": "monica-BTC", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/e9c709be75a13725fbb39a3d8e69de85b4e54f24", "committedDate": "2020-12-07T14:17:58Z", "message": "fixed test case\n\nfixed test case"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0fff833cbd81ee1d0dc105937bac6ab637462716", "author": {"user": {"login": "monica-BTC", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/0fff833cbd81ee1d0dc105937bac6ab637462716", "committedDate": "2020-12-07T14:59:58Z", "message": "Merge branch 'develop' into app-participants-pagination"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ2NzAwODUy", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2234#pullrequestreview-546700852", "createdAt": "2020-12-08T02:37:39Z", "commit": {"oid": "0fff833cbd81ee1d0dc105937bac6ab637462716"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQwMjozNzozOVrOIBEMOg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wOFQwMzoyNTo1NFrOIBFPew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzk4ODE1NA==", "bodyText": "sortBy", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2234#discussion_r537988154", "createdAt": "2020-12-08T02:37:39Z", "author": {"login": "saminguyen"}, "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/common/ErrorCode.java", "diffHunk": "@@ -329,7 +329,13 @@\n       HttpStatus.NOT_FOUND.toString(),\n       \"This view displays app-wise enrollment if you manage multiple studies.\"),\n \n-  USER_EMAIL_EXIST(400, \"EC_0064\", Constants.BAD_REQUEST, \"The email already exists\");\n+  USER_EMAIL_EXIST(400, \"EC_0064\", Constants.BAD_REQUEST, \"The email already exists\"),\n+\n+  UNSUPPORTED_SORTBY_VALUE(\n+      400, \"EC_0076\", HttpStatus.BAD_REQUEST.toString(), \"Invalid sortby value\"),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0fff833cbd81ee1d0dc105937bac6ab637462716"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODAwNTM3MQ==", "bodyText": "check the first few participants returned to verify the sorting function", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2234#discussion_r538005371", "createdAt": "2020-12-08T03:25:54Z", "author": {"login": "saminguyen"}, "path": "participant-manager-datastore/participant-manager-service/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/AppControllerTest.java", "diffHunk": "@@ -427,6 +429,107 @@ public void shouldReturnGetAppParticipantsWithoutParticipants() throws Exception\n     verifyTokenIntrospectRequest();\n   }\n \n+  @Test\n+  public void shouldReturnAppParticipantsWithPagination() throws Exception {\n+    // Step 1 : Set studyEntity,siteEntity,locationEntity,userDetailsEntity and superAdmin to false\n+    userRegAdminEntity.setSuperAdmin(false);\n+    testDataHelper.getUserRegAdminRepository().save(userRegAdminEntity);\n+    studyEntity.setApp(appEntity);\n+    siteEntity.setStudy(studyEntity);\n+    locationEntity = testDataHelper.createLocation();\n+    siteEntity.setLocation(locationEntity);\n+    participantStudyEntity.setUserDetails(userDetailsEntity);\n+    testDataHelper.getParticipantStudyRepository().saveAndFlush(participantStudyEntity);\n+    HttpHeaders headers = testDataHelper.newCommonHeaders();\n+    headers.add(USER_ID_HEADER, userRegAdminEntity.getId());\n+\n+    // Step 1: 1 Participants for app already added in @BeforeEach, add 20 new Participants for\n+    // app\n+    for (int i = 1; i <= 20; i++) {\n+      userDetailsEntity = testDataHelper.newUserDetails();\n+      userDetailsEntity.setApp(appEntity);\n+      userDetailsEntity.setEmail(EMAIL_VALUE + String.valueOf(i));\n+      testDataHelper.getUserDetailsRepository().saveAndFlush(userDetailsEntity);\n+      // Pagination records should be in descending order of created timestamp\n+      // Entities are not saved in sequential order so adding delay\n+      Thread.sleep(500);\n+    }\n+\n+    // Step 2: Call API and expect GET_PARTICIPANT_REGISTRY_SUCCESS message and fetch 11 data\n+    // out of 21\n+    mockMvc\n+        .perform(\n+            get(ApiEndpoint.GET_APP_PARTICIPANTS.getPath(), appEntity.getId())\n+                .headers(headers)\n+                .param(\"limit\", \"20\")\n+                .param(\"offset\", \"10\")\n+                .param(\"sortBy\", \"registrationDate\")\n+                .param(\"sortDirection\", \"desc\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0fff833cbd81ee1d0dc105937bac6ab637462716"}, "originalPosition": 48}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1e9f4762d339b9a31e8e011313f747c3bad83f0c", "author": {"user": {"login": "monica-BTC", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/1e9f4762d339b9a31e8e011313f747c3bad83f0c", "committedDate": "2020-12-08T15:32:41Z", "message": "Merge branch 'develop' into app-participants-pagination"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "67b4a8a0c3dfe0c15b41dbdc54cc63ebcc4c62b9", "author": {"user": {"login": "monica-BTC", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/67b4a8a0c3dfe0c15b41dbdc54cc63ebcc4c62b9", "committedDate": "2020-12-08T16:22:26Z", "message": "Fixed review comment\n\nFixed review comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ3NDYzNzQy", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2234#pullrequestreview-547463742", "createdAt": "2020-12-08T17:29:18Z", "commit": {"oid": "67b4a8a0c3dfe0c15b41dbdc54cc63ebcc4c62b9"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6420d53e4f843ec99f1d04416fd2078ecb35c3ba", "author": {"user": {"login": "monica-BTC", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/6420d53e4f843ec99f1d04416fd2078ecb35c3ba", "committedDate": "2020-12-09T14:26:38Z", "message": "Merge branch 'develop' into app-participants-pagination"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ff37d831ff2262ef162129044929b7f4c93635b4", "author": {"user": {"login": "monica-BTC", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/ff37d831ff2262ef162129044929b7f4c93635b4", "committedDate": "2020-12-09T14:49:59Z", "message": "Fixed issue #1636\n\nFixed issue #1636"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ee66afdae18c25645b59cc1412da186375846794", "author": {"user": {"login": "monica-BTC", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/ee66afdae18c25645b59cc1412da186375846794", "committedDate": "2020-12-11T09:25:33Z", "message": "Merge branch 'develop' into app-participants-pagination"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4c6c0cee405642309a6b02d26e2845d5f06e96d9", "author": {"user": {"login": "monica-BTC", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/4c6c0cee405642309a6b02d26e2845d5f06e96d9", "committedDate": "2020-12-11T09:38:19Z", "message": "Merge branch 'develop' into app-participants-pagination"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bf97c55244e7b890b87568b203b7cf0522ed1947", "author": {"user": {"login": "monica-BTC", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/bf97c55244e7b890b87568b203b7cf0522ed1947", "committedDate": "2020-12-11T09:59:51Z", "message": "Update ErrorCode.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ea506dea24f3f7e5ce48dd4f14625240bd6be766", "author": {"user": {"login": "monica-BTC", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/ea506dea24f3f7e5ce48dd4f14625240bd6be766", "committedDate": "2020-12-11T10:15:57Z", "message": "Merge branch 'develop' into app-participants-pagination"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4ef798cc7fc790030b65f10d8e36dd2029094a85", "author": {"user": {"login": "monica-BTC", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/4ef798cc7fc790030b65f10d8e36dd2029094a85", "committedDate": "2020-12-11T10:21:28Z", "message": "Merge branch 'app-participants-pagination' into participant-manager-issue#1636"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e4077050bbb8d50e82bbd9cfa75189146580e430", "author": {"user": {"login": "monica-BTC", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/e4077050bbb8d50e82bbd9cfa75189146580e430", "committedDate": "2020-12-11T14:19:46Z", "message": "Merge branch 'develop' into app-participants-pagination"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dabb9a5650df14122b725550b26fa88cb196d027", "author": {"user": {"login": "monica-BTC", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/dabb9a5650df14122b725550b26fa88cb196d027", "committedDate": "2020-12-13T13:14:09Z", "message": "Merge pull request #2309 from GoogleCloudPlatform/participant-manager-issue#1636\n\nParticipant Manager : Fixed issue #1636 in GET /{appId}/participants endpoint"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d0c9438d762d3215a1ed12815ca40f03b21eb089", "author": {"user": {"login": "monica-BTC", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/d0c9438d762d3215a1ed12815ca40f03b21eb089", "committedDate": "2020-12-13T13:16:53Z", "message": "Merge branch 'develop' into app-participants-pagination"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e9a2830c97820520a4b5bdbfe1e8a932517b17a6", "author": {"user": {"login": "monica-BTC", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/e9a2830c97820520a4b5bdbfe1e8a932517b17a6", "committedDate": "2020-12-14T13:22:43Z", "message": "Merge branch 'develop' into app-participants-pagination"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0538c11b5c1cad2106233937c2f42cf5054cf10c", "author": {"user": {"login": "monica-BTC", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/0538c11b5c1cad2106233937c2f42cf5054cf10c", "committedDate": "2020-12-14T16:49:56Z", "message": "Merge branch 'develop' into app-participants-pagination"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUxODc4Nzk4", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2234#pullrequestreview-551878798", "createdAt": "2020-12-14T20:46:27Z", "commit": {"oid": "0538c11b5c1cad2106233937c2f42cf5054cf10c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a407880e2932a10c13e07c7421f88b83adb5ed55", "author": {"user": {"login": "monica-BTC", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/a407880e2932a10c13e07c7421f88b83adb5ed55", "committedDate": "2020-12-15T04:25:30Z", "message": "Merge branch 'develop' into app-participants-pagination"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1138, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}