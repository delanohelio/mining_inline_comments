{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDU3MjQxOTkz", "number": 686, "title": "Participant manager addNewUser api with non super admin", "bodyText": "Participant manager addNewUser api with non super admin", "createdAt": "2020-07-27T15:36:15Z", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/686", "merged": true, "mergeCommit": {"oid": "f7591c719b6e4392d76fe21b8510b66d711ece1d"}, "closed": true, "closedAt": "2020-08-18T14:08:48Z", "author": {"login": "chiranjibi009"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc5DffygH2gAyNDU3MjQxOTkzOjgyNmNhZmI3MjFmNDdkZWFkMzkzYTI1ZjNjZTc5NzFjNTUyOWQ3NDQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdAHj-gAH2gAyNDU3MjQxOTkzOjBlMDhjYzYyOGRlNzk1NWYxODVhNmRmOTlkYThlNjUxYmQyYjA1NzU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "826cafb721f47dead393a25f3ce7971c5529d744", "author": {"user": {"login": "chiranjibi009", "name": "Chiranjibi Dash"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/826cafb721f47dead393a25f3ce7971c5529d744", "committedDate": "2020-07-27T15:23:53Z", "message": "son super admin flow for addNewUser imolemented"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "78d8e41f74f128043903f5191f31bc11b7bf5031", "author": {"user": {"login": "chiranjibi009", "name": "Chiranjibi Dash"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/78d8e41f74f128043903f5191f31bc11b7bf5031", "committedDate": "2020-07-27T15:28:09Z", "message": "code formated"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c39158123585cbba466e7a6129e8da59c790f12d", "author": {"user": {"login": "chiranjibi009", "name": "Chiranjibi Dash"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/c39158123585cbba466e7a6129e8da59c790f12d", "committedDate": "2020-07-27T15:39:26Z", "message": "Merge branch 'participant-manager-add-new-user-common-module' into participant-manager-add-new-user-with-non-super-admin-implementation\n\n# Conflicts:\n#\tparticipant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/service/ManageUserServiceImpl.java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4MDQ5MjA0", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/686#pullrequestreview-458049204", "createdAt": "2020-07-30T03:38:10Z", "commit": {"oid": "c39158123585cbba466e7a6129e8da59c790f12d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwMzozODoxMFrOG5R5Bw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQwMzozODoxMFrOG5R5Bw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjcxNTE0Mw==", "bodyText": "\"Details\"", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/686#discussion_r462715143", "createdAt": "2020-07-30T03:38:10Z", "author": {"login": "saminguyen"}, "path": "participant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/service/ManageUserServiceImpl.java", "diffHunk": "@@ -139,10 +149,108 @@ private AdminUserResponse saveAdminDetails(UserRequest user) {\n     UserRegAdminEntity adminDetails =\n         UserMapper.fromUserRequest(user, Long.valueOf(appConfig.getSecurityCodeExpireDate()));\n     adminDetails = userAdminRepository.saveAndFlush(adminDetails);\n+\n+    Map<Boolean, List<UserAppPermissionRequest>> groupBySelectedAppMap =\n+        user.getApps()\n+            .stream()\n+            .collect(Collectors.groupingBy(UserAppPermissionRequest::isSelected));\n+\n+    // save permissions for selected apps\n+    for (UserAppPermissionRequest app :\n+        CollectionUtils.emptyIfNull(groupBySelectedAppMap.get(CommonConstants.SELECTED))) {\n+      saveAppStudySitePermissions(user, adminDetails, app);\n+    }\n+\n+    // save permissions for unselected apps\n+    for (UserAppPermissionRequest app :\n+        CollectionUtils.emptyIfNull(groupBySelectedAppMap.get(CommonConstants.UNSELECTED))) {\n+      for (UserStudyPermissionRequest study : CollectionUtils.emptyIfNull(app.getStudies())) {\n+        if (study.isSelected()) {\n+          saveStudySitePermissions(user, adminDetails, study);\n+        } else if (CollectionUtils.isNotEmpty(study.getSites())) {\n+          saveSitePermissions(user, adminDetails, study);\n+        }\n+      }\n+    }\n     logger.exit(\"Successfully saved admin details.\");\n     return new AdminUserResponse(MessageCode.ADD_NEW_USER_SUCCESS, adminDetails.getId());\n   }\n \n+  private void saveAppStudySitePermissions(\n+      UserRequest user, UserRegAdminEntity adminDeatils, UserAppPermissionRequest app) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c39158123585cbba466e7a6129e8da59c790f12d"}, "originalPosition": 65}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "adfb7931ddab2df6b1a90e75ca2d50a7cd7b0a2d", "author": {"user": {"login": "chiranjibi009", "name": "Chiranjibi Dash"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/adfb7931ddab2df6b1a90e75ca2d50a7cd7b0a2d", "committedDate": "2020-07-30T13:28:17Z", "message": "Merge branch 'participant-manager-add-new-user-common-module' into participant-manager-add-new-user-with-non-super-admin-implementation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "96bfd0e30a921a6433163a645610506b37ba9aab", "author": {"user": {"login": "chiranjibi009", "name": "Chiranjibi Dash"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/96bfd0e30a921a6433163a645610506b37ba9aab", "committedDate": "2020-07-30T13:38:18Z", "message": "commented PR fixed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "78a17c7914d8ac1398100669438585ddd903cd86", "author": {"user": {"login": "chiranjibi009", "name": "Chiranjibi Dash"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/78a17c7914d8ac1398100669438585ddd903cd86", "committedDate": "2020-07-31T06:32:08Z", "message": "Merge branch 'participant-manager-add-new-user-common-module' into participant-manager-add-new-user-with-non-super-admin-implementation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU5NTAzMDk2", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/686#pullrequestreview-459503096", "createdAt": "2020-07-31T22:11:56Z", "commit": {"oid": "78a17c7914d8ac1398100669438585ddd903cd86"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d360b5ee153c73b45d0c40e87c59132b98c6bc84", "author": {"user": {"login": "chiranjibi009", "name": "Chiranjibi Dash"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/d360b5ee153c73b45d0c40e87c59132b98c6bc84", "committedDate": "2020-08-18T06:38:57Z", "message": "Merge branch 'develop' into participant-manager-add-new-user-with-non-super-admin-implementation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7b9763d266765d42c6d562560617efb97ba1c8fb", "author": {"user": {"login": "chiranjibi009", "name": "Chiranjibi Dash"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/7b9763d266765d42c6d562560617efb97ba1c8fb", "committedDate": "2020-08-18T06:46:08Z", "message": "Merge branch 'develop' of https://github.com/GoogleCloudPlatform/fda-mystudies into participant-manager-add-new-user-with-non-super-admin-implementation\n\n# Conflicts:\n#\tparticipant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/service/ManageUserServiceImpl.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "67f3f411ff6ee12b360fb6663a33b87383dcc8cc", "author": {"user": {"login": "chiranjibi009", "name": "Chiranjibi Dash"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/67f3f411ff6ee12b360fb6663a33b87383dcc8cc", "committedDate": "2020-08-18T06:59:49Z", "message": "Merge branch 'participant-manager-add-new-user-with-non-super-admin-implementation' of https://github.com/GoogleCloudPlatform/fda-mystudies into participant-manager-add-new-user-with-non-super-admin-implementation\n\n# Conflicts:\n#\tparticipant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/service/ManageUserServiceImpl.java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY5NDUyNTg5", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/686#pullrequestreview-469452589", "createdAt": "2020-08-18T13:26:18Z", "commit": {"oid": "67f3f411ff6ee12b360fb6663a33b87383dcc8cc"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8cbc9c9603d9979d17e886f1e722e017c2fcd72b", "author": {"user": {"login": "saminguyen", "name": "Sami Nguyen"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/8cbc9c9603d9979d17e886f1e722e017c2fcd72b", "committedDate": "2020-08-18T13:26:23Z", "message": "Merge branch 'develop' into participant-manager-add-new-user-with-non-super-admin-implementation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0e08cc628de7955f185a6df99da8e651bd2b0575", "author": {"user": {"login": "chiranjibi009", "name": "Chiranjibi Dash"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/0e08cc628de7955f185a6df99da8e651bd2b0575", "committedDate": "2020-08-18T14:05:52Z", "message": "Merge branch 'develop' into participant-manager-add-new-user-with-non-super-admin-implementation"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 557, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}