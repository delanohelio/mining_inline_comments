{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE3ODA0OTgw", "number": 397, "title": "iOS - Fix stats filters navigation.", "bodyText": "fixes #324", "createdAt": "2020-05-14T07:29:18Z", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/397", "merged": true, "mergeCommit": {"oid": "40dfb6210f4710da156023d5b64143fd390e5a7b"}, "closed": true, "closedAt": "2020-05-18T05:47:10Z", "author": {"login": "tushar-boston"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABchIKRzgH2gAyNDE3ODA0OTgwOjQ3MWMwZDMwYzk1YmVmMjM1ZTA5MDFhMWFhNGY4YjMwMjgzODE1YmE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABciZJGAAH2gAyNDE3ODA0OTgwOmRmNzk3ZDk3OGU3ODhjZWQ4ZTk3NTQ2MTc4ZTYwYjQ2MzM5NGJhYjA=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "471c0d30c95bef235e0901a1aa4f8b30283815ba", "author": {"user": {"login": "tushar-boston", "name": "Tushar Katyal"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/471c0d30c95bef235e0901a1aa4f8b30283815ba", "committedDate": "2020-05-14T07:16:03Z", "message": "Fix stats filters wrt to time."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDExODM0ODQ1", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/397#pullrequestreview-411834845", "createdAt": "2020-05-14T14:01:01Z", "commit": {"oid": "471c0d30c95bef235e0901a1aa4f8b30283815ba"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxNDowMTowMVrOGVdudQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xNFQxNToxMDo1OFrOGVg93w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTE2MDMwOQ==", "bodyText": "nextStartDateOfWeek?", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/397#discussion_r425160309", "createdAt": "2020-05-14T14:01:01Z", "author": {"login": "nikklassen"}, "path": "iOS/HPHC/HPHC/Views/Cells/TableView/Study/StudyDashboardStatisticsTableViewCell.swift", "diffHunk": "@@ -198,59 +201,30 @@ class StudyDashboardStatisticsTableViewCell: UITableViewCell {\n     switch self.selectedTab {\n \n     case .Day:\n-\n-      self.buttonForward?.isEnabled = true\n-      self.buttonBackward?.isEnabled = true\n-      todaysDate = calendar.date(byAdding: .day, value: 1, to: todaysDate)!\n-      let stringDate = StudyDashboardStatisticsTableViewCell.formatter.string(\n-        from: todaysDate\n-      )\n-      let color = Utilities.getUIColorFromHex(0x007CBA)\n-\n-      let attributedStartDate: NSMutableAttributedString = NSMutableAttributedString(\n-        string: stringDate\n-      )\n-      attributedStartDate.addAttribute(\n-        NSAttributedString.Key.foregroundColor,\n-        value: color,\n-        range: NSRange(location: 0, length: 2)\n-      )\n-      labelDateValue?.attributedText = attributedStartDate\n-\n-      let result = todaysDate.compare(Date())\n-      if result == .orderedSame || result == .orderedDescending {\n-        self.buttonForward?.isEnabled = false\n+      if let nextDayDate = calendar.date(byAdding: .day, value: 1, to: todaysDate) {\n+        todaysDate = nextDayDate\n+        labelDateValue?.attributedText = getDayAttributedString()\n+        self.updateForwardBtnState()\n       }\n \n     case .Week:\n-\n-      self.buttonForward?.isEnabled = true\n-      self.buttonBackward?.isEnabled = true\n-\n-      startDateOfWeek = calendar.date(byAdding: .day, value: 7, to: startDateOfWeek!)\n-      endDateOfWeek = calendar.date(byAdding: .day, value: 7, to: endDateOfWeek!)\n-\n-      let attributedText = self.getWeeklyAttributedText()\n-      labelDateValue?.attributedText = attributedText\n-\n-      let result = todaysDate.compare(Date())\n-      if result == .orderedSame || result == .orderedDescending {\n-        self.buttonForward?.isEnabled = false\n+      if let currentStartDateOfWeek = startDateOfWeek,\n+        let currentEndDateOfWeek = endDateOfWeek {\n+        startDateOfWeek = calendar.date(byAdding: .day, value: 7, to: currentStartDateOfWeek)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "471c0d30c95bef235e0901a1aa4f8b30283815ba"}, "originalPosition": 199}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTE2Mjc0OQ==", "bodyText": "This should be currentWeekStartDate right? The end and start of a week can't be the same day", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/397#discussion_r425162749", "createdAt": "2020-05-14T14:04:27Z", "author": {"login": "nikklassen"}, "path": "iOS/HPHC/HPHC/Views/Cells/TableView/Study/StudyDashboardStatisticsTableViewCell.swift", "diffHunk": "@@ -198,59 +201,30 @@ class StudyDashboardStatisticsTableViewCell: UITableViewCell {\n     switch self.selectedTab {\n \n     case .Day:\n-\n-      self.buttonForward?.isEnabled = true\n-      self.buttonBackward?.isEnabled = true\n-      todaysDate = calendar.date(byAdding: .day, value: 1, to: todaysDate)!\n-      let stringDate = StudyDashboardStatisticsTableViewCell.formatter.string(\n-        from: todaysDate\n-      )\n-      let color = Utilities.getUIColorFromHex(0x007CBA)\n-\n-      let attributedStartDate: NSMutableAttributedString = NSMutableAttributedString(\n-        string: stringDate\n-      )\n-      attributedStartDate.addAttribute(\n-        NSAttributedString.Key.foregroundColor,\n-        value: color,\n-        range: NSRange(location: 0, length: 2)\n-      )\n-      labelDateValue?.attributedText = attributedStartDate\n-\n-      let result = todaysDate.compare(Date())\n-      if result == .orderedSame || result == .orderedDescending {\n-        self.buttonForward?.isEnabled = false\n+      if let nextDayDate = calendar.date(byAdding: .day, value: 1, to: todaysDate) {\n+        todaysDate = nextDayDate\n+        labelDateValue?.attributedText = getDayAttributedString()\n+        self.updateForwardBtnState()\n       }\n \n     case .Week:\n-\n-      self.buttonForward?.isEnabled = true\n-      self.buttonBackward?.isEnabled = true\n-\n-      startDateOfWeek = calendar.date(byAdding: .day, value: 7, to: startDateOfWeek!)\n-      endDateOfWeek = calendar.date(byAdding: .day, value: 7, to: endDateOfWeek!)\n-\n-      let attributedText = self.getWeeklyAttributedText()\n-      labelDateValue?.attributedText = attributedText\n-\n-      let result = todaysDate.compare(Date())\n-      if result == .orderedSame || result == .orderedDescending {\n-        self.buttonForward?.isEnabled = false\n+      if let currentStartDateOfWeek = startDateOfWeek,\n+        let currentEndDateOfWeek = endDateOfWeek {\n+        startDateOfWeek = calendar.date(byAdding: .day, value: 7, to: currentStartDateOfWeek)\n+        endDateOfWeek = calendar.date(byAdding: .day, value: 7, to: currentEndDateOfWeek)\n+        let attributedText = self.getWeeklyAttributedText()\n+        labelDateValue?.attributedText = attributedText\n+        if let currentWeekEndDate = startDateOfWeek {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "471c0d30c95bef235e0901a1aa4f8b30283815ba"}, "originalPosition": 203}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTIwODMwNQ==", "bodyText": "This seems pretty hacky. It seems like we should just be initializing a variable with the current date to control what date the user is looking at, and then never use Date() again.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/397#discussion_r425208305", "createdAt": "2020-05-14T15:03:56Z", "author": {"login": "nikklassen"}, "path": "iOS/HPHC/HPHC/Views/Cells/TableView/Study/StudyDashboardStatisticsTableViewCell.swift", "diffHunk": "@@ -123,21 +142,10 @@ class StudyDashboardStatisticsTableViewCell: UITableViewCell {\n       buttonMonth?.backgroundColor = UIColor.white\n \n       self.selectedTab = .Day\n-      todaysDate = Date()\n-\n-      let stringDate = StudyDashboardStatisticsTableViewCell.formatter.string(from: Date())\n-      let color = Utilities.getUIColorFromHex(0x007CBA)\n-\n-      let attributedStartDate: NSMutableAttributedString = NSMutableAttributedString(\n-        string: stringDate\n-      )\n-      attributedStartDate.addAttribute(\n-        NSAttributedString.Key.foregroundColor,\n-        value: color,\n-        range: NSRange(location: 0, length: 2)\n-      )\n-      labelDateValue?.attributedText = attributedStartDate\n-      self.buttonForward?.isEnabled = false\n+      \n+      todaysDate = todaysDate > Date() ? Date() : todaysDate", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "471c0d30c95bef235e0901a1aa4f8b30283815ba"}, "originalPosition": 111}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTIxMzQwNw==", "bodyText": "Seems cleaner to take the current date, subtract 7 days, then use .startOfWeek", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/397#discussion_r425213407", "createdAt": "2020-05-14T15:10:58Z", "author": {"login": "nikklassen"}, "path": "iOS/HPHC/HPHC/Views/Cells/TableView/Study/StudyDashboardStatisticsTableViewCell.swift", "diffHunk": "@@ -198,59 +201,30 @@ class StudyDashboardStatisticsTableViewCell: UITableViewCell {\n     switch self.selectedTab {\n \n     case .Day:\n-\n-      self.buttonForward?.isEnabled = true\n-      self.buttonBackward?.isEnabled = true\n-      todaysDate = calendar.date(byAdding: .day, value: 1, to: todaysDate)!\n-      let stringDate = StudyDashboardStatisticsTableViewCell.formatter.string(\n-        from: todaysDate\n-      )\n-      let color = Utilities.getUIColorFromHex(0x007CBA)\n-\n-      let attributedStartDate: NSMutableAttributedString = NSMutableAttributedString(\n-        string: stringDate\n-      )\n-      attributedStartDate.addAttribute(\n-        NSAttributedString.Key.foregroundColor,\n-        value: color,\n-        range: NSRange(location: 0, length: 2)\n-      )\n-      labelDateValue?.attributedText = attributedStartDate\n-\n-      let result = todaysDate.compare(Date())\n-      if result == .orderedSame || result == .orderedDescending {\n-        self.buttonForward?.isEnabled = false\n+      if let nextDayDate = calendar.date(byAdding: .day, value: 1, to: todaysDate) {\n+        todaysDate = nextDayDate\n+        labelDateValue?.attributedText = getDayAttributedString()\n+        self.updateForwardBtnState()\n       }\n \n     case .Week:\n-\n-      self.buttonForward?.isEnabled = true\n-      self.buttonBackward?.isEnabled = true\n-\n-      startDateOfWeek = calendar.date(byAdding: .day, value: 7, to: startDateOfWeek!)\n-      endDateOfWeek = calendar.date(byAdding: .day, value: 7, to: endDateOfWeek!)\n-\n-      let attributedText = self.getWeeklyAttributedText()\n-      labelDateValue?.attributedText = attributedText\n-\n-      let result = todaysDate.compare(Date())\n-      if result == .orderedSame || result == .orderedDescending {\n-        self.buttonForward?.isEnabled = false\n+      if let currentStartDateOfWeek = startDateOfWeek,\n+        let currentEndDateOfWeek = endDateOfWeek {\n+        startDateOfWeek = calendar.date(byAdding: .day, value: 7, to: currentStartDateOfWeek)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "471c0d30c95bef235e0901a1aa4f8b30283815ba"}, "originalPosition": 199}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7ccf71d66f8dca076c376605e31508159cc75da8", "author": {"user": {"login": "tushar-boston", "name": "Tushar Katyal"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/7ccf71d66f8dca076c376605e31508159cc75da8", "committedDate": "2020-05-14T16:22:43Z", "message": "Refactor naming conventions."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDEyODI2Nzk1", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/397#pullrequestreview-412826795", "createdAt": "2020-05-15T17:14:41Z", "commit": {"oid": "7ccf71d66f8dca076c376605e31508159cc75da8"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "df797d978e788ced8e97546178e60b463394bab0", "author": {"user": {"login": "tushar-boston", "name": "Tushar Katyal"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/df797d978e788ced8e97546178e60b463394bab0", "committedDate": "2020-05-18T05:37:04Z", "message": "Merge branch 'early-access' into ios-stats-fix"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1064, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}