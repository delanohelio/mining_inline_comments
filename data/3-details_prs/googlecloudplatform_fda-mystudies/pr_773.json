{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcwMjM1Mzc3", "number": 773, "title": "User Management - Create AppPermission and StudyPermission records for SuperAdmin", "bodyText": "Implemented add AppPermission and StudyPermission records for SuperAdmin.\nUpdated test to verify AppPermission and StudyPermission records created for SuperAdmin", "createdAt": "2020-08-19T15:16:42Z", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/773", "merged": true, "mergeCommit": {"oid": "ac71009c3a300c7ecf4b6ae1310176802b49bbbc"}, "closed": true, "closedAt": "2020-08-20T15:40:43Z", "author": {"login": "monica-BTC"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdAdHvMAH2gAyNDcwMjM1Mzc3OjE2NTJkZjY2ZDkwNGJhOTMzNDQ2YWEwZjQ2M2UwODMyZTJhNTYyYjM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdAyGpegFqTQ3MTc0NDc3NQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1652df66d904ba933446aa0f463e0832e2a562b3", "author": {"user": {"login": "monica-BTC", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/1652df66d904ba933446aa0f463e0832e2a562b3", "committedDate": "2020-08-19T15:12:56Z", "message": "added code to insert AppPermission and StudyPermission for SuperAdmin\n\nadded code to insert AppPermission and StudyPermission for SuperAdmin"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcwNzMzODA5", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/773#pullrequestreview-470733809", "createdAt": "2020-08-19T18:32:23Z", "commit": {"oid": "1652df66d904ba933446aa0f463e0832e2a562b3"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxODozMjoyM1rOHDUPZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxODo1NTo1MVrOHDU_Tg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzIzOTM5Nw==", "bodyText": "nit: assigning the null value is redundant", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/773#discussion_r473239397", "createdAt": "2020-08-19T18:32:23Z", "author": {"login": "saminguyen"}, "path": "user-registration-server-ws/user-mgmt-module/user-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/dao/StudiesDaoImpl.java", "diffHunk": "@@ -61,6 +65,12 @@ public ErrorBean saveStudyMetadata(StudyMetadataBean studyMetadataBean) {\n     AppInfoDetailsBO appInfo = null;\n     OrgInfo orgInfo = null;\n \n+    UserRegAdminUser superAdminUser = null;\n+\n+    AppPermission appPermission = null;\n+\n+    StudyPermission studyPermission = null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1652df66d904ba933446aa0f463e0832e2a562b3"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzI0OTYwNw==", "bodyText": "appPermissionList and studyPermissionList", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/773#discussion_r473249607", "createdAt": "2020-08-19T18:51:45Z", "author": {"login": "saminguyen"}, "path": "user-registration-server-ws/user-mgmt-module/user-mgmt/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/tests/StudiesControllerTest.java", "diffHunk": "@@ -86,6 +95,39 @@ public void addUpdateStudyMetadataSuccess() throws Exception {\n     assertEquals(Constants.STUDY_TAGLINE, studyInfoBo.getTagline());\n   }\n \n+  @Test\n+  public void addUpdateStudyMetadataSuccessForPermissions() throws Exception {\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    StudyMetadataBean studyMetaDataBean = createStudyMetadataBean();\n+    studyMetaDataBean.setStudyId(Constants.NEW_STUDY_ID);\n+    studyMetaDataBean.setAppId(Constants.NEW_APP_ID_VALUE);\n+    String requestJson = getObjectMapper().writeValueAsString(studyMetaDataBean);\n+    performPost(\n+        STUDY_METADATA_PATH, requestJson, headers, String.valueOf(HttpStatus.OK.value()), OK);\n+\n+    List<AppPermission> appPermission = appPermissionRepository.findAll();\n+    List<StudyPermission> studyPermission = studyPermissionRepository.findAll();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1652df66d904ba933446aa0f463e0832e2a562b3"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzI1MTY2Mg==", "bodyText": "Shouldn't we check for all the fields that is set in StudiesDaoImpl? (createBy, urAdminUser, etc)", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/773#discussion_r473251662", "createdAt": "2020-08-19T18:55:51Z", "author": {"login": "saminguyen"}, "path": "user-registration-server-ws/user-mgmt-module/user-mgmt/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/tests/StudiesControllerTest.java", "diffHunk": "@@ -86,6 +95,39 @@ public void addUpdateStudyMetadataSuccess() throws Exception {\n     assertEquals(Constants.STUDY_TAGLINE, studyInfoBo.getTagline());\n   }\n \n+  @Test\n+  public void addUpdateStudyMetadataSuccessForPermissions() throws Exception {\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    StudyMetadataBean studyMetaDataBean = createStudyMetadataBean();\n+    studyMetaDataBean.setStudyId(Constants.NEW_STUDY_ID);\n+    studyMetaDataBean.setAppId(Constants.NEW_APP_ID_VALUE);\n+    String requestJson = getObjectMapper().writeValueAsString(studyMetaDataBean);\n+    performPost(\n+        STUDY_METADATA_PATH, requestJson, headers, String.valueOf(HttpStatus.OK.value()), OK);\n+\n+    List<AppPermission> appPermission = appPermissionRepository.findAll();\n+    List<StudyPermission> studyPermission = studyPermissionRepository.findAll();\n+\n+    AppPermission app =\n+        appPermission\n+            .stream()\n+            .filter(x -> x.getAppInfo().getAppId().equals(Constants.NEW_APP_ID_VALUE))\n+            .findFirst()\n+            .orElse(null);\n+    StudyPermission study =\n+        studyPermission\n+            .stream()\n+            .filter(x -> x.getStudyInfo().getCustomId().equals(Constants.NEW_STUDY_ID))\n+            .findFirst()\n+            .orElse(null);\n+    assertNotNull(app);\n+    assertEquals(Constants.NEW_APP_ID_VALUE, app.getAppInfo().getAppId());\n+    assertEquals(Permission.READ_EDIT.value(), app.getEdit());\n+    assertNotNull(study);\n+    assertEquals(Constants.NEW_STUDY_ID, study.getStudyInfo().getCustomId());\n+    assertEquals(Permission.READ_EDIT.value(), study.getEdit());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1652df66d904ba933446aa0f463e0832e2a562b3"}, "originalPosition": 62}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "576d88beba9d2967588e91adbea18ab6e61fa4bf", "author": {"user": {"login": "monica-BTC", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/576d88beba9d2967588e91adbea18ab6e61fa4bf", "committedDate": "2020-08-20T06:31:55Z", "message": "fixed PR comments\n\nfixed PR comments"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcxNTk2MTQ4", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/773#pullrequestreview-471596148", "createdAt": "2020-08-20T13:14:52Z", "commit": {"oid": "576d88beba9d2967588e91adbea18ab6e61fa4bf"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ffbd600bd71e7b5e26b23a89c34a0c02b50b7d58", "author": {"user": {"login": "monica-BTC", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/ffbd600bd71e7b5e26b23a89c34a0c02b50b7d58", "committedDate": "2020-08-20T14:43:46Z", "message": "Merge branch 'develop' into user-management-app-study-permission"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "efdd98373c412e9643e34f0054179fdc2ef394e8", "author": {"user": {"login": "monica-BTC", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/efdd98373c412e9643e34f0054179fdc2ef394e8", "committedDate": "2020-08-20T15:22:52Z", "message": "resolved conflicts\n\nresolved conflicts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6a41698fb7e731549afe9c53c8a5c5a268cdfdd6", "author": {"user": {"login": "saminguyen", "name": "Sami Nguyen"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/6a41698fb7e731549afe9c53c8a5c5a268cdfdd6", "committedDate": "2020-08-20T15:38:58Z", "message": "Merge branch 'develop' into user-management-app-study-permission"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcxNzQ0Nzc1", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/773#pullrequestreview-471744775", "createdAt": "2020-08-20T15:39:45Z", "commit": {"oid": "6a41698fb7e731549afe9c53c8a5c5a268cdfdd6"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 692, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}