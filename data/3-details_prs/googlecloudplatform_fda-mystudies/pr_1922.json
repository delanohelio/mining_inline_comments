{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE3ODA0MzUz", "number": 1922, "title": "[Enrollment service and Participant Manager]issue 1873 fixes, Error message should be displayed as 'Unknown token' if user decommission the site after sending the invitation", "bodyText": "Issue #1873 fixes\n\nAdded enrollment_token_used column in participant_registry_site table\nSet enrollmentTokenUsed to true after enrollment and false when invitation is sent.\nWritten test cases", "createdAt": "2020-11-09T14:30:22Z", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1922", "merged": true, "mergeCommit": {"oid": "f6f990d9aef967361b2955273cca186cbc1a3b4d"}, "closed": true, "closedAt": "2020-11-17T04:19:44Z", "author": {"login": "madhurya-btc"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABda1mJVAH2gAyNTE3ODA0MzUzOjU5MGUzODU4ODQwOGE2MmM5MTlkNTRiOWZlNDQ3NDliYjM1NzJiNjY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABddRrwSgH2gAyNTE3ODA0MzUzOjZmZmI2OTRkOWQ3ODI3NTNiNGE3YmEyNGNlNmQyMzBjODNkMmE4ZTM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "590e38588408a62c919d54b9fe44749bb3572b66", "author": {"user": {"login": "madhurya-btc", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/590e38588408a62c919d54b9fe44749bb3572b66", "committedDate": "2020-11-09T14:25:54Z", "message": "issue 1873 fixed"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI2MzExODU1", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1922#pullrequestreview-526311855", "createdAt": "2020-11-09T14:31:08Z", "commit": {"oid": "590e38588408a62c919d54b9fe44749bb3572b66"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxNDozMTowOFrOHvxfhA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxNDozMTowOFrOHvxfhA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTg1NjAwNA==", "bodyText": "[enroll-mgmt Checks] reported by reviewdog \ud83d\udc36\nLine is longer than 100 characters (found 131).", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1922#discussion_r519856004", "createdAt": "2020-11-09T14:31:08Z", "author": {"login": "github-actions"}, "path": "participant-datastore/enroll-mgmt-module/enroll-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/dao/EnrollmentTokenDaoImpl.java", "diffHunk": "@@ -108,27 +108,16 @@ public boolean hasParticipant(@NotNull String studyId, @NotNull String tokenValu\n     logger.info(\"EnrollmentTokenDaoImpl hasParticipant() - Started \");\n     List<Object[]> participantList = null;\n     Session session = this.sessionFactory.getCurrentSession();\n-    List<String> studyStateStatus = new ArrayList<>();\n-    studyStateStatus.add(ParticipantStudyStateStatus.ENROLLED.getValue());\n-    studyStateStatus.add(ParticipantStudyStateStatus.WITHDRAWN.getValue());\n-    studyStateStatus.add(ParticipantStudyStateStatus.INPROGRESS.getValue());\n \n-    List<String> onboardingStatus = new ArrayList<>();\n-    onboardingStatus.add(OnboardingStatus.INVITED.getCode());\n-    onboardingStatus.add(OnboardingStatus.ENROLLED.getCode());\n-    onboardingStatus.add(OnboardingStatus.DISABLED.getCode());\n     participantList =\n         session\n             .createQuery(\n                 \"from ParticipantStudyEntity PS,StudyEntity SB, ParticipantRegistrySiteEntity PR\"\n                     + \" where SB.id =PS.study.id and PS.participantRegistrySite.id=PR.id\"\n-                    + \" and PS.status in (:studyStateStatus) \"\n-                    + \" and PR.onboardingStatus in (:onboardingStatus)\"\n-                    + \" and upper(trim(PR.enrollmentToken))=:token and SB.customId=:studyId\")\n-            .setParameter(\"studyStateStatus\", studyStateStatus)\n-            .setParameter(\"onboardingStatus\", onboardingStatus)\n+                    + \" and upper(trim(PR.enrollmentToken))=:token and SB.customId=:studyId and PR.enrollmentTokenUsed=:tokenUsed\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "590e38588408a62c919d54b9fe44749bb3572b66"}, "originalPosition": 51}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "13b85f9178a7d1243c791165c3c56abc4f41ad39", "author": {"user": {"login": "madhurya-btc", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/13b85f9178a7d1243c791165c3c56abc4f41ad39", "committedDate": "2020-11-09T14:32:46Z", "message": "github actions comment fixes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI2NjY2NzM2", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1922#pullrequestreview-526666736", "createdAt": "2020-11-09T21:25:41Z", "commit": {"oid": "13b85f9178a7d1243c791165c3c56abc4f41ad39"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQyMToyNTo0MVrOHwCN0w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQyMToyNTo0MVrOHwCN0w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDEzMDAwMw==", "bodyText": "Why are these removed? Is it relevant to the current bug to be fixed?", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1922#discussion_r520130003", "createdAt": "2020-11-09T21:25:41Z", "author": {"login": "saminguyen"}, "path": "participant-datastore/enroll-mgmt-module/enroll-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/dao/EnrollmentTokenDaoImpl.java", "diffHunk": "@@ -108,27 +108,17 @@ public boolean hasParticipant(@NotNull String studyId, @NotNull String tokenValu\n     logger.info(\"EnrollmentTokenDaoImpl hasParticipant() - Started \");\n     List<Object[]> participantList = null;\n     Session session = this.sessionFactory.getCurrentSession();\n-    List<String> studyStateStatus = new ArrayList<>();\n-    studyStateStatus.add(ParticipantStudyStateStatus.ENROLLED.getValue());\n-    studyStateStatus.add(ParticipantStudyStateStatus.WITHDRAWN.getValue());\n-    studyStateStatus.add(ParticipantStudyStateStatus.INPROGRESS.getValue());\n \n-    List<String> onboardingStatus = new ArrayList<>();\n-    onboardingStatus.add(OnboardingStatus.INVITED.getCode());\n-    onboardingStatus.add(OnboardingStatus.ENROLLED.getCode());\n-    onboardingStatus.add(OnboardingStatus.DISABLED.getCode());\n     participantList =\n         session\n             .createQuery(\n                 \"from ParticipantStudyEntity PS,StudyEntity SB, ParticipantRegistrySiteEntity PR\"\n                     + \" where SB.id =PS.study.id and PS.participantRegistrySite.id=PR.id\"\n-                    + \" and PS.status in (:studyStateStatus) \"\n-                    + \" and PR.onboardingStatus in (:onboardingStatus)\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "13b85f9178a7d1243c791165c3c56abc4f41ad39"}, "originalPosition": 47}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI2NjcwMjUy", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1922#pullrequestreview-526670252", "createdAt": "2020-11-09T21:31:00Z", "commit": {"oid": "13b85f9178a7d1243c791165c3c56abc4f41ad39"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "05206df2cae8556d9cb8666bf48b2b65f867379c", "author": {"user": {"login": "madhurya-btc", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/05206df2cae8556d9cb8666bf48b2b65f867379c", "committedDate": "2020-11-10T08:22:57Z", "message": "Merge branch 'develop' into issue1873"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0f27c8ea550161166f3f768b4c55cc44d43b2130", "author": {"user": {"login": "madhurya-btc", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/0f27c8ea550161166f3f768b4c55cc44d43b2130", "committedDate": "2020-11-13T12:55:53Z", "message": "Merge branch 'develop' into issue1873"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d4860ee4f7b161c30ec386f07a8cd08412399850", "author": {"user": {"login": "saminguyen", "name": "Sami Nguyen"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/d4860ee4f7b161c30ec386f07a8cd08412399850", "committedDate": "2020-11-13T20:01:10Z", "message": "Merge branch 'develop' into issue1873"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f92852917e2151541da464b7fed239c3f0bccf59", "author": {"user": {"login": "madhurya-btc", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/f92852917e2151541da464b7fed239c3f0bccf59", "committedDate": "2020-11-16T15:53:06Z", "message": "Merge branch 'develop' into issue1873"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxNjU0NjAw", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1922#pullrequestreview-531654600", "createdAt": "2020-11-16T19:51:42Z", "commit": {"oid": "f92852917e2151541da464b7fed239c3f0bccf59"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e5023ae87729eb534de1afdc5e06c16137c798d8", "author": {"user": {"login": "saminguyen", "name": "Sami Nguyen"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/e5023ae87729eb534de1afdc5e06c16137c798d8", "committedDate": "2020-11-16T19:51:48Z", "message": "Merge branch 'develop' into issue1873"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6ffb694d9d782753b4a7ba24ce6d230c83d2a8e3", "author": {"user": {"login": "madhurya-btc", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/6ffb694d9d782753b4a7ba24ce6d230c83d2a8e3", "committedDate": "2020-11-17T04:17:13Z", "message": "Merge branch 'develop' into issue1873"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1410, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}