{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEzMTY1MDUx", "number": 335, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQyMDoyMzo1MFrOD5Jp8g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQyMjoyMDoxOFrOD5L7OA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYxMjUzNjE4OnYy", "diffSide": "RIGHT", "path": "Terraform/org/folder.fda-my-studies/project.heroes-hat-dev-data/data/main.tf", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQyMDoyMzo1MFrOGQQxig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QwMzowNDoxOFrOGRsuSg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTcwNTIyNg==", "bodyText": "@kuoyuchi let me know what specs I should set on these two data storage destination, such as IAM, expiration time, etc.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/335#discussion_r419705226", "createdAt": "2020-05-04T20:23:50Z", "author": {"login": "xingao267"}, "path": "Terraform/org/folder.fda-my-studies/project.heroes-hat-dev-data/data/main.tf", "diffHunk": "@@ -90,3 +90,22 @@ module \"my_studies_cloudsql\" {\n     start_time         = \"20:55\"\n   }\n }\n+\n+# Firestore data export\n+module \"my_studies_firestore_data_bucket\" {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ef563d1298cd0d96ad9984c429021bb0d72b5992"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTcxMTIyMw==", "bodyText": "re: destination. SGTM to keep everything regional in the same region (i.e. us-east1).\nre: IAM. @Olamon can you comment on this?\nre: expiration time. The Cloud Storage bucket is meant to be a temporary export, so we shouldn't keep it for too long. Given that the pipeline runs daily, TTL=7d should be more than enough.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/335#discussion_r419711223", "createdAt": "2020-05-04T20:34:35Z", "author": {"login": "kuoyuchi"}, "path": "Terraform/org/folder.fda-my-studies/project.heroes-hat-dev-data/data/main.tf", "diffHunk": "@@ -90,3 +90,22 @@ module \"my_studies_cloudsql\" {\n     start_time         = \"20:55\"\n   }\n }\n+\n+# Firestore data export\n+module \"my_studies_firestore_data_bucket\" {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTcwNTIyNg=="}, "originalCommit": {"oid": "ef563d1298cd0d96ad9984c429021bb0d72b5992"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTczOTY1NA==", "bodyText": "Added TTL. The permissions can be configured by followup PRs.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/335#discussion_r419739654", "createdAt": "2020-05-04T21:28:19Z", "author": {"login": "xingao267"}, "path": "Terraform/org/folder.fda-my-studies/project.heroes-hat-dev-data/data/main.tf", "diffHunk": "@@ -90,3 +90,22 @@ module \"my_studies_cloudsql\" {\n     start_time         = \"20:55\"\n   }\n }\n+\n+# Firestore data export\n+module \"my_studies_firestore_data_bucket\" {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTcwNTIyNg=="}, "originalCommit": {"oid": "ef563d1298cd0d96ad9984c429021bb0d72b5992"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTIxMTcyMg==", "bodyText": "Thanks Xin. I followed up with Ola. This is read and written by firebase functions, which by default uses this service account:\n{project-id}@appspot.gserviceaccount.com\nBut this is also something we can change on cloud function console. We have 3 cloud functions, and makes sense to go down the path of each running as a different service account.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/335#discussion_r421211722", "createdAt": "2020-05-07T03:04:18Z", "author": {"login": "kuoyuchi"}, "path": "Terraform/org/folder.fda-my-studies/project.heroes-hat-dev-data/data/main.tf", "diffHunk": "@@ -90,3 +90,22 @@ module \"my_studies_cloudsql\" {\n     start_time         = \"20:55\"\n   }\n }\n+\n+# Firestore data export\n+module \"my_studies_firestore_data_bucket\" {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTcwNTIyNg=="}, "originalCommit": {"oid": "ef563d1298cd0d96ad9984c429021bb0d72b5992"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjYxMjkwODA4OnYy", "diffSide": "RIGHT", "path": "Terraform/org/folder.fda-my-studies/project.heroes-hat-dev-data/data/main.tf", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQyMjoyMDoxOFrOGQUT4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQyMjo1MjozMlrOGQVCIg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTc2MzE2OQ==", "bodyText": "Sorry I wasn't clear about this. @Olamon to confirm but the bigquery data should contain no PII and it's for aggregated dashboards. I expect this to be retained for longer.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/335#discussion_r419763169", "createdAt": "2020-05-04T22:20:18Z", "author": {"login": "kuoyuchi"}, "path": "Terraform/org/folder.fda-my-studies/project.heroes-hat-dev-data/data/main.tf", "diffHunk": "@@ -90,3 +90,35 @@ module \"my_studies_cloudsql\" {\n     start_time         = \"20:55\"\n   }\n }\n+\n+# Firestore data export\n+module \"my_studies_firestore_data_bucket\" {\n+  source  = \"terraform-google-modules/cloud-storage/google//modules/simple_bucket\"\n+  version = \"~> 1.4\"\n+\n+  name       = \"heroes-hat-dev-my-studies-firestore-data\"\n+  project_id = var.project_id\n+  location   = var.storage_location\n+\n+  # TTL 7 days.\n+  lifecycle_rules = [{\n+    action = {\n+      type = \"Delete\"\n+    }\n+    condition = {\n+      age        = 7 # 7 days\n+      with_state = \"ANY\"\n+    }\n+  }]\n+\n+}\n+\n+module \"my_studies_firestore_data_bigquery\" {\n+  source  = \"terraform-google-modules/bigquery/google\"\n+  version = \"~> 4.1.0\"\n+\n+  dataset_id                  = \"heroes_hat_dev_my_studies_firestore_data\"\n+  project_id                  = var.project_id\n+  location                    = var.storage_location\n+  default_table_expiration_ms = 7 * 8.64 * pow(10, 7) # 7 days", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "96861d5ae34ae73376d9f07ad77cfc6bc702d3e2"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTc3NTAxMA==", "bodyText": "removed the ttl for now. If there is a specific requirement on the ttl, we can add later", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/335#discussion_r419775010", "createdAt": "2020-05-04T22:52:32Z", "author": {"login": "xingao267"}, "path": "Terraform/org/folder.fda-my-studies/project.heroes-hat-dev-data/data/main.tf", "diffHunk": "@@ -90,3 +90,35 @@ module \"my_studies_cloudsql\" {\n     start_time         = \"20:55\"\n   }\n }\n+\n+# Firestore data export\n+module \"my_studies_firestore_data_bucket\" {\n+  source  = \"terraform-google-modules/cloud-storage/google//modules/simple_bucket\"\n+  version = \"~> 1.4\"\n+\n+  name       = \"heroes-hat-dev-my-studies-firestore-data\"\n+  project_id = var.project_id\n+  location   = var.storage_location\n+\n+  # TTL 7 days.\n+  lifecycle_rules = [{\n+    action = {\n+      type = \"Delete\"\n+    }\n+    condition = {\n+      age        = 7 # 7 days\n+      with_state = \"ANY\"\n+    }\n+  }]\n+\n+}\n+\n+module \"my_studies_firestore_data_bigquery\" {\n+  source  = \"terraform-google-modules/bigquery/google\"\n+  version = \"~> 4.1.0\"\n+\n+  dataset_id                  = \"heroes_hat_dev_my_studies_firestore_data\"\n+  project_id                  = var.project_id\n+  location                    = var.storage_location\n+  default_table_expiration_ms = 7 * 8.64 * pow(10, 7) # 7 days", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTc2MzE2OQ=="}, "originalCommit": {"oid": "96861d5ae34ae73376d9f07ad77cfc6bc702d3e2"}, "originalPosition": 34}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1058, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}