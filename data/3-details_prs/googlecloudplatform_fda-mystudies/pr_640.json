{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ5MzI5NjYy", "number": 640, "title": "Enroll token validation for one time use and restrict usage to mapped participant", "bodyText": "Enroll token validation for one time use and restrict usage to mapped participant. Please refer issue #639", "createdAt": "2020-07-15T08:29:52Z", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/640", "merged": true, "mergeCommit": {"oid": "0b97624b8c40a758db82fa6d9d83d26b47968157"}, "closed": true, "closedAt": "2020-08-23T11:09:54Z", "author": {"login": "aswinijena100"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc1GVeGgH2gAyNDQ5MzI5NjYyOjBlMTUyODVjOTA1OTliYzMzYzM4YmQ2NDNjMGRiMjgwMmYzZDIwYjQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdBr_yYgH2gAyNDQ5MzI5NjYyOjVjMDQ3YzllNzMyNGEyNTY5NGVhMjdiMTNkNGRmYWM4MDMxODQ2ZDE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0e15285c90599bc33c38bd643c0db2802f3d20b4", "author": {"user": {"login": "aswinijena100", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/0e15285c90599bc33c38bd643c0db2802f3d20b4", "committedDate": "2020-07-15T08:26:57Z", "message": "token validation for one time use and restrict usage against unmapped participant"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ4NzM5NzMy", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/640#pullrequestreview-448739732", "createdAt": "2020-07-15T08:30:43Z", "commit": {"oid": "0e15285c90599bc33c38bd643c0db2802f3d20b4"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwODozMDo0M1rOGxz2kw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwODozMDo0M1rOGxz2lA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDg4Mjk2Mw==", "bodyText": "[enroll-mgmt Checks] reported by reviewdog \ud83d\udc36\nWrong lexicographical order for 'com.google.cloud.healthcare.fdamystudies.model.UserDetailsBO' import. Should be before 'org.springframework.stereotype.Service'.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/640#discussion_r454882963", "createdAt": "2020-07-15T08:30:43Z", "author": {"login": "github-actions"}, "path": "user-registration-server-ws/enroll-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/service/EnrollmentTokenServiceImpl.java", "diffHunk": "@@ -9,15 +9,18 @@\n package com.google.cloud.healthcare.fdamystudies.service;\n \n import javax.validation.constraints.NotNull;\n+\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n import org.springframework.beans.factory.annotation.Autowired;\n import org.springframework.stereotype.Service;\n+\n import com.google.cloud.healthcare.fdamystudies.beans.EnrollmentResponseBean;\n import com.google.cloud.healthcare.fdamystudies.dao.EnrollmentTokenDao;\n import com.google.cloud.healthcare.fdamystudies.exception.InvalidRequestException;\n import com.google.cloud.healthcare.fdamystudies.exception.SystemException;\n import com.google.cloud.healthcare.fdamystudies.exception.UnAuthorizedRequestException;\n+import com.google.cloud.healthcare.fdamystudies.model.UserDetailsBO;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e15285c90599bc33c38bd643c0db2802f3d20b4"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDg4Mjk2NA==", "bodyText": "[enroll-mgmt Checks] reported by reviewdog \ud83d\udc36\nLine is longer than 100 characters (found 137).", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/640#discussion_r454882964", "createdAt": "2020-07-15T08:30:43Z", "author": {"login": "github-actions"}, "path": "user-registration-server-ws/enroll-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/dao/EnrollmentTokenDaoImpl.java", "diffHunk": "@@ -120,7 +125,7 @@ public boolean hasParticipant(@NotNull String studyId, @NotNull String tokenValu\n               .createQuery(\n                   \"from ParticipantStudiesBO PS,StudyInfoBO SB, ParticipantRegistrySite PR\"\n                       + \" where SB.id =PS.studyInfo.id and PS.participantRegistrySite.id=PR.id\"\n-                      + \" and PS.status='Enrolled' and PR.enrollmentToken=:token and SB.customId=:studyId\")\n+                      + \" and PS.status in ('Enrolled','Withdrawn','inProgress') and PR.enrollmentToken=:token and SB.customId=:studyId\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0e15285c90599bc33c38bd643c0db2802f3d20b4"}, "originalPosition": 50}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c1794f273ee1bad1268617b8c0ff1ca1e98aff7e", "author": {"user": {"login": "aswinijena100", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/c1794f273ee1bad1268617b8c0ff1ca1e98aff7e", "committedDate": "2020-07-15T08:48:39Z", "message": "Update data.sql"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ5MTc2NTc4", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/640#pullrequestreview-449176578", "createdAt": "2020-07-15T17:26:34Z", "commit": {"oid": "c1794f273ee1bad1268617b8c0ff1ca1e98aff7e"}, "state": "COMMENTED", "comments": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxNzoyNjo1NlrOGyIDzA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQxNzo1Mjo0MFrOGyJSxA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTIxNDAyOA==", "bodyText": "nit: rename emailId to email", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/640#discussion_r455214028", "createdAt": "2020-07-15T17:26:56Z", "author": {"login": "zohrehj"}, "path": "user-registration-server-ws/enroll-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/dao/EnrollmentTokenDao.java", "diffHunk": "@@ -19,7 +21,8 @@\n \n   public boolean hasParticipant(@NotNull String shortName, @NotNull String tokenValue);\n \n-  public boolean isValidStudyToken(@NotNull String token, @NotNull String shortName);\n+  public boolean isValidStudyToken(\n+      @NotNull String token, @NotNull String shortName, @NotNull String emailId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c1794f273ee1bad1268617b8c0ff1ca1e98aff7e"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTIxNTIxNA==", "bodyText": "please fix.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/640#discussion_r455215214", "createdAt": "2020-07-15T17:28:19Z", "author": {"login": "zohrehj"}, "path": "user-registration-server-ws/enroll-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/dao/EnrollmentTokenDaoImpl.java", "diffHunk": "@@ -120,7 +125,7 @@ public boolean hasParticipant(@NotNull String studyId, @NotNull String tokenValu\n               .createQuery(\n                   \"from ParticipantStudiesBO PS,StudyInfoBO SB, ParticipantRegistrySite PR\"\n                       + \" where SB.id =PS.studyInfo.id and PS.participantRegistrySite.id=PR.id\"\n-                      + \" and PS.status='Enrolled' and PR.enrollmentToken=:token and SB.customId=:studyId\")\n+                      + \" and PS.status in ('Enrolled','Withdrawn','inProgress') and PR.enrollmentToken=:token and SB.customId=:studyId\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDg4Mjk2NA=="}, "originalCommit": {"oid": "0e15285c90599bc33c38bd643c0db2802f3d20b4"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTIxNjczMA==", "bodyText": "change to studyID similar to above. please name params consistently.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/640#discussion_r455216730", "createdAt": "2020-07-15T17:29:44Z", "author": {"login": "zohrehj"}, "path": "user-registration-server-ws/enroll-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/service/EnrollmentTokenService.java", "diffHunk": "@@ -21,7 +23,8 @@\n \n   public boolean hasParticipant(@NotNull String shortName, @NotNull String tokenValue);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c1794f273ee1bad1268617b8c0ff1ca1e98aff7e"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTIyNzIxMQ==", "bodyText": "this query assumes that a token is unique within the context of a study_id.\nI do not see that as a constraint in the database, please add it, otherwise your token validation would take other participants into account and fail to validate.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/640#discussion_r455227211", "createdAt": "2020-07-15T17:40:42Z", "author": {"login": "zohrehj"}, "path": "user-registration-server-ws/enroll-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/dao/EnrollmentTokenDaoImpl.java", "diffHunk": "@@ -120,7 +125,7 @@ public boolean hasParticipant(@NotNull String studyId, @NotNull String tokenValu\n               .createQuery(\n                   \"from ParticipantStudiesBO PS,StudyInfoBO SB, ParticipantRegistrySite PR\"\n                       + \" where SB.id =PS.studyInfo.id and PS.participantRegistrySite.id=PR.id\"\n-                      + \" and PS.status='Enrolled' and PR.enrollmentToken=:token and SB.customId=:studyId\")\n+                      + \" and PS.status in ('Enrolled','Withdrawn','inProgress') and PR.enrollmentToken=:token and SB.customId=:studyId\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c1794f273ee1bad1268617b8c0ff1ca1e98aff7e"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTIyNzMwOQ==", "bodyText": "nit: isEnrollmentTokenValid\nYou are using the term studyToken frequently here, whereas the correct term should be enrollmentToken", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/640#discussion_r455227309", "createdAt": "2020-07-15T17:40:49Z", "author": {"login": "zohrehj"}, "path": "user-registration-server-ws/enroll-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/service/EnrollmentTokenService.java", "diffHunk": "@@ -21,7 +23,8 @@\n \n   public boolean hasParticipant(@NotNull String shortName, @NotNull String tokenValue);\n \n-  public boolean isValidStudyToken(@NotNull String token, @NotNull String shortName);\n+  public boolean isValidStudyToken(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c1794f273ee1bad1268617b8c0ff1ca1e98aff7e"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTIyODEzOQ==", "bodyText": "why are these values changed?", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/640#discussion_r455228139", "createdAt": "2020-07-15T17:42:19Z", "author": {"login": "zohrehj"}, "path": "user-registration-server-ws/enroll-mgmt/src/test/resources/data.sql", "diffHunk": "@@ -24,12 +24,12 @@ INSERT INTO `user_details` (`user_details_id`, `user_id`, `app_info_id`, `email`\n \t(45, 'leqmF97faSdVEB8-aUpS0dbXtSMDwIC-Iu9DgRWEcGxZezM', 1, 'cdash93@gmail.com', 1, 'test', 'user', 0, 0,  0, 0, '2020-01-30 20:21:28', '2020-02-05 19:11:05');\n \t\n INSERT INTO `participant_registry_site` (`id`, `site_id`, `study_info_id`, `email`, `invitation_date`, `onboarding_status`, `enrollment_token`, `enrollment_token_expiry`, `created`, `created_by`, `invitation_count`) VALUES\n-\t(30, 1, 1, 'abc@gmail.com', '2020-02-07 20:37:25', 'I', 'BSEEMNH6', '2020-02-09 18:42:32', '2020-02-09 18:42:32', 2, 0),\n-\t(33, 1, 1, 'abc@gmail.com', '2020-02-07 20:37:25', 'I', 'BSEEMNH6', '2020-02-09 18:42:32', '2020-02-09 18:42:32', 2, 0),\n-\t(34, 1, 4, 'xyz@gf.com', '2020-02-07 20:38:36', 'N', 'YB0CZICQ', '2020-02-09 18:42:34', '2020-02-09 18:42:32', 3, 0),\n+\t(30, 1, 1, 'cdash93@gmail.com', '2020-02-07 20:37:25', 'I', 'BSEEMNH6', '2020-02-09 18:42:32', '2020-02-09 18:42:32', 2, 0),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c1794f273ee1bad1268617b8c0ff1ca1e98aff7e"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTIyODk3NA==", "bodyText": "do we expect the same email, to be registered in the same study and site twice?\nThis should be invalid and the database should include unique constraints to prevent this from happening. Filed #643", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/640#discussion_r455228974", "createdAt": "2020-07-15T17:43:43Z", "author": {"login": "zohrehj"}, "path": "user-registration-server-ws/enroll-mgmt/src/test/resources/data.sql", "diffHunk": "@@ -24,12 +24,12 @@ INSERT INTO `user_details` (`user_details_id`, `user_id`, `app_info_id`, `email`\n \t(45, 'leqmF97faSdVEB8-aUpS0dbXtSMDwIC-Iu9DgRWEcGxZezM', 1, 'cdash93@gmail.com', 1, 'test', 'user', 0, 0,  0, 0, '2020-01-30 20:21:28', '2020-02-05 19:11:05');\n \t\n INSERT INTO `participant_registry_site` (`id`, `site_id`, `study_info_id`, `email`, `invitation_date`, `onboarding_status`, `enrollment_token`, `enrollment_token_expiry`, `created`, `created_by`, `invitation_count`) VALUES\n-\t(30, 1, 1, 'abc@gmail.com', '2020-02-07 20:37:25', 'I', 'BSEEMNH6', '2020-02-09 18:42:32', '2020-02-09 18:42:32', 2, 0),\n-\t(33, 1, 1, 'abc@gmail.com', '2020-02-07 20:37:25', 'I', 'BSEEMNH6', '2020-02-09 18:42:32', '2020-02-09 18:42:32', 2, 0),\n-\t(34, 1, 4, 'xyz@gf.com', '2020-02-07 20:38:36', 'N', 'YB0CZICQ', '2020-02-09 18:42:34', '2020-02-09 18:42:32', 3, 0),\n+\t(30, 1, 1, 'cdash93@gmail.com', '2020-02-07 20:37:25', 'I', 'BSEEMNH6', '2020-02-09 18:42:32', '2020-02-09 18:42:32', 2, 0),\n+\t(33, 1, 1, 'cdash93@gmail.com', '2020-02-07 20:37:25', 'I', 'BSEEMNH6', '2020-02-09 18:42:32', '2020-02-09 18:42:32', 2, 0),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c1794f273ee1bad1268617b8c0ff1ca1e98aff7e"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTIzNDI0NA==", "bodyText": "I am confused with this code, why are you checking for participants associated with a token? and looking at their status?\nDoesn't it make more sense to simply flag a token as used and/or remove it after the user has registered?", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/640#discussion_r455234244", "createdAt": "2020-07-15T17:52:40Z", "author": {"login": "zohrehj"}, "path": "user-registration-server-ws/enroll-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/controller/EnrollmentTokenController.java", "diffHunk": "@@ -159,7 +161,7 @@ else if (enrollmentTokenfService.enrollmentTokenRequired(enrollmentBean.getStudy\n                     enrollmentBean.getStudyId(), enrollmentBean.getToken())) {\n                   if (enrollManagementUtil.isChecksumValid(enrollmentBean.getToken())) {\n                     if (enrollmentTokenfService.isValidStudyToken(\n-                        enrollmentBean.getToken(), enrollmentBean.getStudyId())) {\n+                        enrollmentBean.getToken(), enrollmentBean.getStudyId(), userId)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c1794f273ee1bad1268617b8c0ff1ca1e98aff7e"}, "originalPosition": 30}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ebb08b1e0b0662f6d84d44499ceb623facd79f15", "author": {"user": {"login": "aswinijena100", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/ebb08b1e0b0662f6d84d44499ceb623facd79f15", "committedDate": "2020-07-17T04:38:54Z", "message": "renamed email variable"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bef7c9c564e0a88a6168e9f7fea854a57ed8baa0", "author": {"user": {"login": "aswinijena100", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/bef7c9c564e0a88a6168e9f7fea854a57ed8baa0", "committedDate": "2020-07-17T04:48:52Z", "message": "Revert \"renamed email variable\"\n\nThis reverts commit ebb08b1e0b0662f6d84d44499ceb623facd79f15."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "50e9cb0c5a4a48c0dade149c2d6ee31e71148290", "author": {"user": {"login": "aswinijena100", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/50e9cb0c5a4a48c0dade149c2d6ee31e71148290", "committedDate": "2020-07-20T06:13:37Z", "message": "review comment issue fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ed344613d51ed0f9367f79d5e833e556f624bc57", "author": {"user": {"login": "aswinijena100", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/ed344613d51ed0f9367f79d5e833e556f624bc57", "committedDate": "2020-07-22T05:02:36Z", "message": "Merge branch 'early-access' into early-access-token-validation-issue-fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY4NTM4MTM1", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/640#pullrequestreview-468538135", "createdAt": "2020-08-17T14:55:36Z", "commit": {"oid": "ed344613d51ed0f9367f79d5e833e556f624bc57"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNDo1NTozNlrOHBsRtA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNToyNjoxN1rOHBtiVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTUzNjA1Mg==", "bodyText": "remove the extra space between import. Please refer to the styleguide on how to format imports.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/640#discussion_r471536052", "createdAt": "2020-08-17T14:55:36Z", "author": {"login": "zohrehj"}, "path": "user-registration-server-ws/enroll-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/controller/EnrollmentTokenController.java", "diffHunk": "@@ -22,6 +23,7 @@\n import org.springframework.web.bind.annotation.RequestHeader;\n import org.springframework.web.bind.annotation.RequestMapping;\n import org.springframework.web.bind.annotation.RestController;\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed344613d51ed0f9367f79d5e833e556f624bc57"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTUzNjU3OA==", "bodyText": "same here; please fox the format", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/640#discussion_r471536578", "createdAt": "2020-08-17T14:56:21Z", "author": {"login": "zohrehj"}, "path": "user-registration-server-ws/enroll-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/dao/EnrollmentTokenDao.java", "diffHunk": "@@ -9,22 +9,25 @@\n package com.google.cloud.healthcare.fdamystudies.dao;\n \n import javax.validation.constraints.NotNull;\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed344613d51ed0f9367f79d5e833e556f624bc57"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU1NjUxOA==", "bodyText": "these values should be passed from the enum values, not hardcoded in the query.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/640#discussion_r471556518", "createdAt": "2020-08-17T15:26:01Z", "author": {"login": "zohrehj"}, "path": "user-registration-server-ws/enroll-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/dao/EnrollmentTokenDaoImpl.java", "diffHunk": "@@ -120,7 +125,8 @@ public boolean hasParticipant(@NotNull String studyId, @NotNull String tokenValu\n               .createQuery(\n                   \"from ParticipantStudiesBO PS,StudyInfoBO SB, ParticipantRegistrySite PR\"\n                       + \" where SB.id =PS.studyInfo.id and PS.participantRegistrySite.id=PR.id\"\n-                      + \" and PS.status='Enrolled' and PR.enrollmentToken=:token and SB.customId=:studyId\")\n+                      + \" and PS.status in ('Enrolled','Withdrawn','inProgress') \"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed344613d51ed0f9367f79d5e833e556f624bc57"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU1NjY5Mw==", "bodyText": "please fix the format.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/640#discussion_r471556693", "createdAt": "2020-08-17T15:26:17Z", "author": {"login": "zohrehj"}, "path": "user-registration-server-ws/enroll-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/service/EnrollmentTokenService.java", "diffHunk": "@@ -9,23 +9,26 @@\n package com.google.cloud.healthcare.fdamystudies.service;\n \n import javax.validation.constraints.NotNull;\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ed344613d51ed0f9367f79d5e833e556f624bc57"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3875def823d0f424d9da36edf1d3074def377672", "author": {"user": {"login": "aswinijena100", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/3875def823d0f424d9da36edf1d3074def377672", "committedDate": "2020-08-20T12:37:59Z", "message": "Merge branch 'early-access' into early-access-token-validation-issue-fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d3d243b3abc194a650e207150f9c10fbaf5265e0", "author": {"user": {"login": "aswinijena100", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/d3d243b3abc194a650e207150f9c10fbaf5265e0", "committedDate": "2020-08-21T07:48:42Z", "message": "Review Comment issue fixes\n\nReview Comment issue fixes"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcyNTM5NDc2", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/640#pullrequestreview-472539476", "createdAt": "2020-08-21T14:29:55Z", "commit": {"oid": "d3d243b3abc194a650e207150f9c10fbaf5265e0"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQxNDoyOTo1NVrOHEviMg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQxNDoyOTo1NVrOHEviMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDczNTE1NA==", "bodyText": "these are all the values for ParticpantStudyStateStatus, are we missing a value?\nIf not, maybe we don't need to filter by the status, if all status values are allowed", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/640#discussion_r474735154", "createdAt": "2020-08-21T14:29:55Z", "author": {"login": "zohrehj"}, "path": "user-registration-server-ws/enroll-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/dao/EnrollmentTokenDaoImpl.java", "diffHunk": "@@ -115,12 +118,18 @@ public boolean hasParticipant(@NotNull String studyId, @NotNull String tokenValu\n     List<Object[]> participantList = null;\n     boolean hasParticipant = false;\n     try (Session session = entityManagerFactory.unwrap(SessionFactory.class).openSession()) {\n+      List studyStateStatus = new ArrayList();\n+      studyStateStatus.add(ParticipantStudyStateStatus.ENROLLED.getValue());\n+      studyStateStatus.add(ParticipantStudyStateStatus.WITHDRAWN.getValue());\n+      studyStateStatus.add(ParticipantStudyStateStatus.INPROGRESS.getValue());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d3d243b3abc194a650e207150f9c10fbaf5265e0"}, "originalPosition": 60}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcyNTM5Nzc4", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/640#pullrequestreview-472539778", "createdAt": "2020-08-21T14:30:16Z", "commit": {"oid": "d3d243b3abc194a650e207150f9c10fbaf5265e0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5c047c9e7324a25694ea27b13d4dfac8031846d1", "author": {"user": {"login": "aswinijena100", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/5c047c9e7324a25694ea27b13d4dfac8031846d1", "committedDate": "2020-08-23T11:06:45Z", "message": "added few more status in enum classes\n\nadded few more status in enum classes"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 862, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}