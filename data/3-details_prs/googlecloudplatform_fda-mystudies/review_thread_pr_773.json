{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcwMjM1Mzc3", "number": 773, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxODozMjoyM1rOEaGhMQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxODo1NTo1MVrOEaG_AQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk1ODA1MjMzOnYy", "diffSide": "RIGHT", "path": "user-registration-server-ws/user-mgmt-module/user-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/dao/StudiesDaoImpl.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxODozMjoyM1rOHDUPZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQwNzoyODo0MFrOHDv7Rw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzIzOTM5Nw==", "bodyText": "nit: assigning the null value is redundant", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/773#discussion_r473239397", "createdAt": "2020-08-19T18:32:23Z", "author": {"login": "saminguyen"}, "path": "user-registration-server-ws/user-mgmt-module/user-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/dao/StudiesDaoImpl.java", "diffHunk": "@@ -61,6 +65,12 @@ public ErrorBean saveStudyMetadata(StudyMetadataBean studyMetadataBean) {\n     AppInfoDetailsBO appInfo = null;\n     OrgInfo orgInfo = null;\n \n+    UserRegAdminUser superAdminUser = null;\n+\n+    AppPermission appPermission = null;\n+\n+    StudyPermission studyPermission = null;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1652df66d904ba933446aa0f463e0832e2a562b3"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzY5Mjk5OQ==", "bodyText": "Fixed review comment.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/773#discussion_r473692999", "createdAt": "2020-08-20T07:28:40Z", "author": {"login": "monica-BTC"}, "path": "user-registration-server-ws/user-mgmt-module/user-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/dao/StudiesDaoImpl.java", "diffHunk": "@@ -61,6 +65,12 @@ public ErrorBean saveStudyMetadata(StudyMetadataBean studyMetadataBean) {\n     AppInfoDetailsBO appInfo = null;\n     OrgInfo orgInfo = null;\n \n+    UserRegAdminUser superAdminUser = null;\n+\n+    AppPermission appPermission = null;\n+\n+    StudyPermission studyPermission = null;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzIzOTM5Nw=="}, "originalCommit": {"oid": "1652df66d904ba933446aa0f463e0832e2a562b3"}, "originalPosition": 25}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk1ODExNjQzOnYy", "diffSide": "RIGHT", "path": "user-registration-server-ws/user-mgmt-module/user-mgmt/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/tests/StudiesControllerTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxODo1MTo0NVrOHDU3Rw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQwNjozNDo0NVrOHDtU0g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzI0OTYwNw==", "bodyText": "appPermissionList and studyPermissionList", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/773#discussion_r473249607", "createdAt": "2020-08-19T18:51:45Z", "author": {"login": "saminguyen"}, "path": "user-registration-server-ws/user-mgmt-module/user-mgmt/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/tests/StudiesControllerTest.java", "diffHunk": "@@ -86,6 +95,39 @@ public void addUpdateStudyMetadataSuccess() throws Exception {\n     assertEquals(Constants.STUDY_TAGLINE, studyInfoBo.getTagline());\n   }\n \n+  @Test\n+  public void addUpdateStudyMetadataSuccessForPermissions() throws Exception {\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    StudyMetadataBean studyMetaDataBean = createStudyMetadataBean();\n+    studyMetaDataBean.setStudyId(Constants.NEW_STUDY_ID);\n+    studyMetaDataBean.setAppId(Constants.NEW_APP_ID_VALUE);\n+    String requestJson = getObjectMapper().writeValueAsString(studyMetaDataBean);\n+    performPost(\n+        STUDY_METADATA_PATH, requestJson, headers, String.valueOf(HttpStatus.OK.value()), OK);\n+\n+    List<AppPermission> appPermission = appPermissionRepository.findAll();\n+    List<StudyPermission> studyPermission = studyPermissionRepository.findAll();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1652df66d904ba933446aa0f463e0832e2a562b3"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzY1MDM4Ng==", "bodyText": "Renamed to appPermissionList and studyPermissionList", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/773#discussion_r473650386", "createdAt": "2020-08-20T06:34:45Z", "author": {"login": "monica-BTC"}, "path": "user-registration-server-ws/user-mgmt-module/user-mgmt/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/tests/StudiesControllerTest.java", "diffHunk": "@@ -86,6 +95,39 @@ public void addUpdateStudyMetadataSuccess() throws Exception {\n     assertEquals(Constants.STUDY_TAGLINE, studyInfoBo.getTagline());\n   }\n \n+  @Test\n+  public void addUpdateStudyMetadataSuccessForPermissions() throws Exception {\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    StudyMetadataBean studyMetaDataBean = createStudyMetadataBean();\n+    studyMetaDataBean.setStudyId(Constants.NEW_STUDY_ID);\n+    studyMetaDataBean.setAppId(Constants.NEW_APP_ID_VALUE);\n+    String requestJson = getObjectMapper().writeValueAsString(studyMetaDataBean);\n+    performPost(\n+        STUDY_METADATA_PATH, requestJson, headers, String.valueOf(HttpStatus.OK.value()), OK);\n+\n+    List<AppPermission> appPermission = appPermissionRepository.findAll();\n+    List<StudyPermission> studyPermission = studyPermissionRepository.findAll();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzI0OTYwNw=="}, "originalCommit": {"oid": "1652df66d904ba933446aa0f463e0832e2a562b3"}, "originalPosition": 43}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk1ODEyODY1OnYy", "diffSide": "RIGHT", "path": "user-registration-server-ws/user-mgmt-module/user-mgmt/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/tests/StudiesControllerTest.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOVQxODo1NTo1MVrOHDU_Tg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQwNjozODoyMFrOHDtewA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzI1MTY2Mg==", "bodyText": "Shouldn't we check for all the fields that is set in StudiesDaoImpl? (createBy, urAdminUser, etc)", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/773#discussion_r473251662", "createdAt": "2020-08-19T18:55:51Z", "author": {"login": "saminguyen"}, "path": "user-registration-server-ws/user-mgmt-module/user-mgmt/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/tests/StudiesControllerTest.java", "diffHunk": "@@ -86,6 +95,39 @@ public void addUpdateStudyMetadataSuccess() throws Exception {\n     assertEquals(Constants.STUDY_TAGLINE, studyInfoBo.getTagline());\n   }\n \n+  @Test\n+  public void addUpdateStudyMetadataSuccessForPermissions() throws Exception {\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    StudyMetadataBean studyMetaDataBean = createStudyMetadataBean();\n+    studyMetaDataBean.setStudyId(Constants.NEW_STUDY_ID);\n+    studyMetaDataBean.setAppId(Constants.NEW_APP_ID_VALUE);\n+    String requestJson = getObjectMapper().writeValueAsString(studyMetaDataBean);\n+    performPost(\n+        STUDY_METADATA_PATH, requestJson, headers, String.valueOf(HttpStatus.OK.value()), OK);\n+\n+    List<AppPermission> appPermission = appPermissionRepository.findAll();\n+    List<StudyPermission> studyPermission = studyPermissionRepository.findAll();\n+\n+    AppPermission app =\n+        appPermission\n+            .stream()\n+            .filter(x -> x.getAppInfo().getAppId().equals(Constants.NEW_APP_ID_VALUE))\n+            .findFirst()\n+            .orElse(null);\n+    StudyPermission study =\n+        studyPermission\n+            .stream()\n+            .filter(x -> x.getStudyInfo().getCustomId().equals(Constants.NEW_STUDY_ID))\n+            .findFirst()\n+            .orElse(null);\n+    assertNotNull(app);\n+    assertEquals(Constants.NEW_APP_ID_VALUE, app.getAppInfo().getAppId());\n+    assertEquals(Permission.READ_EDIT.value(), app.getEdit());\n+    assertNotNull(study);\n+    assertEquals(Constants.NEW_STUDY_ID, study.getStudyInfo().getCustomId());\n+    assertEquals(Permission.READ_EDIT.value(), study.getEdit());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1652df66d904ba933446aa0f463e0832e2a562b3"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzY1MjkyOA==", "bodyText": "Checked for createdBy and userRegAdminUser.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/773#discussion_r473652928", "createdAt": "2020-08-20T06:38:20Z", "author": {"login": "monica-BTC"}, "path": "user-registration-server-ws/user-mgmt-module/user-mgmt/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/tests/StudiesControllerTest.java", "diffHunk": "@@ -86,6 +95,39 @@ public void addUpdateStudyMetadataSuccess() throws Exception {\n     assertEquals(Constants.STUDY_TAGLINE, studyInfoBo.getTagline());\n   }\n \n+  @Test\n+  public void addUpdateStudyMetadataSuccessForPermissions() throws Exception {\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    StudyMetadataBean studyMetaDataBean = createStudyMetadataBean();\n+    studyMetaDataBean.setStudyId(Constants.NEW_STUDY_ID);\n+    studyMetaDataBean.setAppId(Constants.NEW_APP_ID_VALUE);\n+    String requestJson = getObjectMapper().writeValueAsString(studyMetaDataBean);\n+    performPost(\n+        STUDY_METADATA_PATH, requestJson, headers, String.valueOf(HttpStatus.OK.value()), OK);\n+\n+    List<AppPermission> appPermission = appPermissionRepository.findAll();\n+    List<StudyPermission> studyPermission = studyPermissionRepository.findAll();\n+\n+    AppPermission app =\n+        appPermission\n+            .stream()\n+            .filter(x -> x.getAppInfo().getAppId().equals(Constants.NEW_APP_ID_VALUE))\n+            .findFirst()\n+            .orElse(null);\n+    StudyPermission study =\n+        studyPermission\n+            .stream()\n+            .filter(x -> x.getStudyInfo().getCustomId().equals(Constants.NEW_STUDY_ID))\n+            .findFirst()\n+            .orElse(null);\n+    assertNotNull(app);\n+    assertEquals(Constants.NEW_APP_ID_VALUE, app.getAppInfo().getAppId());\n+    assertEquals(Permission.READ_EDIT.value(), app.getEdit());\n+    assertNotNull(study);\n+    assertEquals(Constants.NEW_STUDY_ID, study.getStudyInfo().getCustomId());\n+    assertEquals(Permission.READ_EDIT.value(), study.getEdit());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzI1MTY2Mg=="}, "originalCommit": {"oid": "1652df66d904ba933446aa0f463e0832e2a562b3"}, "originalPosition": 62}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2157, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}