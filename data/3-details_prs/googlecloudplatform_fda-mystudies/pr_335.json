{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEzMTY1MDUx", "number": 335, "title": "Add firestore data export destinations.", "bodyText": "", "createdAt": "2020-05-04T20:22:42Z", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/335", "merged": true, "mergeCommit": {"oid": "b541b9b43b07ee793c3a370873f945c4c504c20d"}, "closed": true, "closedAt": "2020-05-07T14:42:39Z", "author": {"login": "xingao267"}, "timelineItems": {"totalCount": 15, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABceFagKgH2gAyNDEzMTY1MDUxOmVmNTYzZDEyOThjZDBkOTZhZDk5ODRjNDI5MDIxYmIwZDcyYjU5OTI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABce-KhYgH2gAyNDEzMTY1MDUxOjI3NGFkYTYzOWVkOTgyODUwMWFhZjM3Mzg3N2U5ZGJhMzhjOGU4NmI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "ef563d1298cd0d96ad9984c429021bb0d72b5992", "author": {"user": {"login": "xingao267", "name": "Xin Gao"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/ef563d1298cd0d96ad9984c429021bb0d72b5992", "committedDate": "2020-05-04T20:22:17Z", "message": "Add firestore data export destinations."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1MzE5MDcy", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/335#pullrequestreview-405319072", "createdAt": "2020-05-04T20:23:49Z", "commit": {"oid": "ef563d1298cd0d96ad9984c429021bb0d72b5992"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQyMDoyMzo1MFrOGQQxig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQyMDoyMzo1MFrOGQQxig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTcwNTIyNg==", "bodyText": "@kuoyuchi let me know what specs I should set on these two data storage destination, such as IAM, expiration time, etc.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/335#discussion_r419705226", "createdAt": "2020-05-04T20:23:50Z", "author": {"login": "xingao267"}, "path": "Terraform/org/folder.fda-my-studies/project.heroes-hat-dev-data/data/main.tf", "diffHunk": "@@ -90,3 +90,22 @@ module \"my_studies_cloudsql\" {\n     start_time         = \"20:55\"\n   }\n }\n+\n+# Firestore data export\n+module \"my_studies_firestore_data_bucket\" {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ef563d1298cd0d96ad9984c429021bb0d72b5992"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3408ce2500a77201b044c302ca05df18794f84d7", "author": {"user": {"login": "xingao267", "name": "Xin Gao"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/3408ce2500a77201b044c302ca05df18794f84d7", "committedDate": "2020-05-04T20:25:52Z", "message": "format"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2a976ab81d852252bb6cdaff0d2eee2990a3f876", "author": {"user": {"login": "xingao267", "name": "Xin Gao"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/2a976ab81d852252bb6cdaff0d2eee2990a3f876", "committedDate": "2020-05-04T21:04:11Z", "message": "Merge branch 'early-access' into data"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ddf7a4193db3fd597b5089b6bfb5235856cb7cfb", "author": {"user": {"login": "xingao267", "name": "Xin Gao"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/ddf7a4193db3fd597b5089b6bfb5235856cb7cfb", "committedDate": "2020-05-04T21:23:46Z", "message": "Add TTL"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "31aed40c3479b4b89ed49e30392743b7ccc77f11", "author": {"user": {"login": "xingao267", "name": "Xin Gao"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/31aed40c3479b4b89ed49e30392743b7ccc77f11", "committedDate": "2020-05-04T21:38:40Z", "message": "format"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "96861d5ae34ae73376d9f07ad77cfc6bc702d3e2", "author": {"user": {"login": "xingao267", "name": "Xin Gao"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/96861d5ae34ae73376d9f07ad77cfc6bc702d3e2", "committedDate": "2020-05-04T21:49:07Z", "message": "Merge branch 'early-access' into data"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1Mzg4MzQ2", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/335#pullrequestreview-405388346", "createdAt": "2020-05-04T22:20:18Z", "commit": {"oid": "96861d5ae34ae73376d9f07ad77cfc6bc702d3e2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQyMjoyMDoxOFrOGQUT4Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wNFQyMjoyMDoxOFrOGQUT4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTc2MzE2OQ==", "bodyText": "Sorry I wasn't clear about this. @Olamon to confirm but the bigquery data should contain no PII and it's for aggregated dashboards. I expect this to be retained for longer.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/335#discussion_r419763169", "createdAt": "2020-05-04T22:20:18Z", "author": {"login": "kuoyuchi"}, "path": "Terraform/org/folder.fda-my-studies/project.heroes-hat-dev-data/data/main.tf", "diffHunk": "@@ -90,3 +90,35 @@ module \"my_studies_cloudsql\" {\n     start_time         = \"20:55\"\n   }\n }\n+\n+# Firestore data export\n+module \"my_studies_firestore_data_bucket\" {\n+  source  = \"terraform-google-modules/cloud-storage/google//modules/simple_bucket\"\n+  version = \"~> 1.4\"\n+\n+  name       = \"heroes-hat-dev-my-studies-firestore-data\"\n+  project_id = var.project_id\n+  location   = var.storage_location\n+\n+  # TTL 7 days.\n+  lifecycle_rules = [{\n+    action = {\n+      type = \"Delete\"\n+    }\n+    condition = {\n+      age        = 7 # 7 days\n+      with_state = \"ANY\"\n+    }\n+  }]\n+\n+}\n+\n+module \"my_studies_firestore_data_bigquery\" {\n+  source  = \"terraform-google-modules/bigquery/google\"\n+  version = \"~> 4.1.0\"\n+\n+  dataset_id                  = \"heroes_hat_dev_my_studies_firestore_data\"\n+  project_id                  = var.project_id\n+  location                    = var.storage_location\n+  default_table_expiration_ms = 7 * 8.64 * pow(10, 7) # 7 days", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "96861d5ae34ae73376d9f07ad77cfc6bc702d3e2"}, "originalPosition": 34}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA1Mzk5MDY1", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/335#pullrequestreview-405399065", "createdAt": "2020-05-04T22:45:41Z", "commit": {"oid": "96861d5ae34ae73376d9f07ad77cfc6bc702d3e2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ab2499d431d6dc777573b1fc68e834b77082ea79", "author": {"user": {"login": "xingao267", "name": "Xin Gao"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/ab2499d431d6dc777573b1fc68e834b77082ea79", "committedDate": "2020-05-04T22:50:53Z", "message": "remove ttl on bigquery"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5503a55d947a3773e2411aebebd956b50e6121af", "author": {"user": {"login": "xingao267", "name": "Xin Gao"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/5503a55d947a3773e2411aebebd956b50e6121af", "committedDate": "2020-05-04T23:00:18Z", "message": "Add subscription."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "868cb1c0d0272988d129124e9fc7235cafe1b158", "author": {"user": {"login": "xingao267", "name": "Xin Gao"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/868cb1c0d0272988d129124e9fc7235cafe1b158", "committedDate": "2020-05-04T23:00:54Z", "message": "Merge branch 'early-access' into data"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "52274490f46b341eac3d1a5d582885857829af95", "author": {"user": {"login": "xingao267", "name": "Xin Gao"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/52274490f46b341eac3d1a5d582885857829af95", "committedDate": "2020-05-06T17:58:51Z", "message": "Merge branch 'early-access' into data"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA3MTIwMDU2", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/335#pullrequestreview-407120056", "createdAt": "2020-05-07T03:04:18Z", "commit": {"oid": "52274490f46b341eac3d1a5d582885857829af95"}, "state": "APPROVED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QwMzowNDoxOFrOGRsuSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0wN1QwMzowNDoxOFrOGRsuSg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTIxMTcyMg==", "bodyText": "Thanks Xin. I followed up with Ola. This is read and written by firebase functions, which by default uses this service account:\n{project-id}@appspot.gserviceaccount.com\nBut this is also something we can change on cloud function console. We have 3 cloud functions, and makes sense to go down the path of each running as a different service account.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/335#discussion_r421211722", "createdAt": "2020-05-07T03:04:18Z", "author": {"login": "kuoyuchi"}, "path": "Terraform/org/folder.fda-my-studies/project.heroes-hat-dev-data/data/main.tf", "diffHunk": "@@ -90,3 +90,22 @@ module \"my_studies_cloudsql\" {\n     start_time         = \"20:55\"\n   }\n }\n+\n+# Firestore data export\n+module \"my_studies_firestore_data_bucket\" {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTcwNTIyNg=="}, "originalCommit": {"oid": "ef563d1298cd0d96ad9984c429021bb0d72b5992"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "274ada639ed9828501aaf373877e9dba38c8e86b", "author": {"user": {"login": "xingao267", "name": "Xin Gao"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/274ada639ed9828501aaf373877e9dba38c8e86b", "committedDate": "2020-05-07T14:29:25Z", "message": "Merge branch 'early-access' into data"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 998, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}