{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkyNjUyNTY1", "number": 23, "title": "Unc cv19 iOS build", "bodyText": "Endpoints changes with GCP open implementation.\nLoader & some other code optimizations.", "createdAt": "2020-03-23T21:38:26Z", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/23", "merged": true, "mergeCommit": {"oid": "2f7c15b911394a05f5be8b491a9bfc0d38d6b495"}, "closed": true, "closedAt": "2020-03-24T21:13:45Z", "author": {"login": "tushar-boston"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcIEr8tAH2gAyMzkyNjUyNTY1OmEyM2ZiMjVkOWI2NzRhMjliNmU5ZTQ2OTY2YTdmN2FiYmUwMjA4ZjY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcQx2KrgFqTM4MDI0OTkxMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a23fb25d9b674a29b6e9e46966a7f7abbe0208f6", "author": {"user": {"login": "tushar-boston", "name": "Tushar Katyal"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/a23fb25d9b674a29b6e9e46966a7f7abbe0208f6", "committedDate": "2020-02-26T11:05:06Z", "message": "Create build-iOS.yml"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1086a8054568c4b7680cb9ea106f547228decf16", "author": {"user": {"login": "zohrehj", "name": "Zohreh Jabbari"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/1086a8054568c4b7680cb9ea106f547228decf16", "committedDate": "2020-02-26T15:02:56Z", "message": "Merge pull request #8 from tushar-boston/ios-patch-1\n\nCreate build-iOS.yml"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "97618077cb1bea8bc23d1807d539373c5178dd3d", "author": {"user": {"login": "tushar-boston", "name": "Tushar Katyal"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/97618077cb1bea8bc23d1807d539373c5178dd3d", "committedDate": "2020-03-12T10:08:39Z", "message": "iOS files path changes. (#17) (#18)\n\n* iOS files path changes. (#17)\r\n\r\n* Update files path.\r\n\r\n* Create build-iOS.yml\r\n\r\n* Update copyrights."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a7c34b7c9d49ed2219a17b75b3db391cd6479190", "author": {"user": {"login": "tushar-boston", "name": "Tushar Katyal"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/a7c34b7c9d49ed2219a17b75b3db391cd6479190", "committedDate": "2020-03-18T17:22:04Z", "message": "Style guide update & removed unused files. (#19)\n\n* Style guide changes.\r\n\r\n* Run swift-format\r\n\r\n* Delete unused files\r\n\r\n* Clean debug print logs\r\n\r\n* formatting and commented out code cleanup."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b434722ec9012eb972ff77edd961bd692857cf1e", "author": {"user": {"login": "tushar-boston", "name": "Tushar Katyal"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/b434722ec9012eb972ff77edd961bd692857cf1e", "committedDate": "2020-03-23T21:24:38Z", "message": "- GCP server updates."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzc5ODQ3NzIw", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/23#pullrequestreview-379847720", "createdAt": "2020-03-23T21:48:32Z", "commit": {"oid": "b434722ec9012eb972ff77edd961bd692857cf1e"}, "state": "COMMENTED", "comments": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QyMTo0ODozMlrOF6ZWjw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yM1QyMTo1OTo0MVrOF6Zqkw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc3NzEwMw==", "bodyText": "I noticed the error code change, is that a typo?", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/23#discussion_r396777103", "createdAt": "2020-03-23T21:48:32Z", "author": {"login": "zohrehj"}, "path": "iOS/HPHC/HPHC/Controllers/GatewayUI/ProfileViewUI/ProfileViewController.swift", "diffHunk": "@@ -808,7 +809,8 @@ extension ProfileViewController: NMWebServiceDelegate {\n   func failedRequest(_ manager: NetworkManager, requestName: NSString, error: NSError) {\n     self.removeProgressIndicator()\n \n-    if error.code == 403 {  //  unauthorized\n+    if requestName as String == AuthServerMethods.getRefreshedToken.description && error.code == 401", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b434722ec9012eb972ff77edd961bd692857cf1e"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc3NzMzMA==", "bodyText": "nit: double comment\nalso code changed from 403 to 401?", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/23#discussion_r396777330", "createdAt": "2020-03-23T21:49:03Z", "author": {"login": "zohrehj"}, "path": "iOS/HPHC/HPHC/Controllers/GatewayUI/SlideMenu/LeftMenuViewController.swift", "diffHunk": "@@ -613,7 +612,8 @@ extension LeftMenuViewController: NMWebServiceDelegate {\n   func failedRequest(_ manager: NetworkManager, requestName: NSString, error: NSError) {\n     UIApplication.shared.keyWindow?.addProgressIndicatorOnWindowFromTop()\n \n-    if error.code == 403 {  // unauthorized\n+    if requestName as String == AuthServerMethods.getRefreshedToken.description && error.code == 401\n+    {  //unauthorized  // unauthorized", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b434722ec9012eb972ff77edd961bd692857cf1e"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc3NzU5MA==", "bodyText": "nit: double comment", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/23#discussion_r396777590", "createdAt": "2020-03-23T21:49:37Z", "author": {"login": "zohrehj"}, "path": "iOS/HPHC/HPHC/Controllers/GatewayUI/StudyUI/StudyListViewController.swift", "diffHunk": "@@ -1090,7 +1082,8 @@ extension StudyListViewController: NMWebServiceDelegate {\n     let appdelegate = (UIApplication.shared.delegate as? AppDelegate)!\n     appdelegate.window?.removeProgressIndicatorFromWindow()\n \n-    if error.code == 403 {  // unauthorized Access\n+    if requestName as String == AuthServerMethods.getRefreshedToken.description && error.code == 401\n+    {  //unauthorized  // unauthorized Access", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b434722ec9012eb972ff77edd961bd692857cf1e"}, "originalPosition": 142}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc3ODI5NA==", "bodyText": "please remove", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/23#discussion_r396778294", "createdAt": "2020-03-23T21:51:11Z", "author": {"login": "zohrehj"}, "path": "iOS/HPHC/HPHC/Default.xcconfig", "diffHunk": "@@ -0,0 +1,50 @@\n+//\n+//  Default.xcconfig\n+//  HPHC", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b434722ec9012eb972ff77edd961bd692857cf1e"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc3ODc2NQ==", "bodyText": "please remove", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/23#discussion_r396778765", "createdAt": "2020-03-23T21:52:15Z", "author": {"login": "zohrehj"}, "path": "iOS/HPHC/HPHC/Networking/APIs/ConsentServices.swift", "diffHunk": "@@ -0,0 +1,179 @@\n+//\n+//  AuthServices.swift\n+//  HPHC", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b434722ec9012eb972ff77edd961bd692857cf1e"}, "originalPosition": 3}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc4MDMxOA==", "bodyText": "nit: typo seceretKey", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/23#discussion_r396780318", "createdAt": "2020-03-23T21:55:27Z", "author": {"login": "zohrehj"}, "path": "iOS/HPHC/HPHC/Networking/Configurations/AuthServerConfiguration.swift", "diffHunk": "@@ -0,0 +1,100 @@\n+//  Copyright 2020 Google LLC\n+//\n+//  Use of this source code is governed by an MIT-style\n+//  license that can be found in the LICENSE file or at\n+//  https://opensource.org/licenses/MIT.\n+\n+import UIKit\n+\n+enum AuthServerMethods: String {\n+\n+  case login\n+  case forgotPassword\n+  case logout\n+  case changePassword\n+  case getRefreshedToken\n+\n+  var description: String {\n+    switch self {\n+    default:\n+      return self.apiPath\n+    }\n+  }\n+\n+  var apiPath: String {\n+    switch self {\n+    default:\n+      return self.rawValue\n+    }\n+  }\n+\n+  var method: Method {\n+\n+    switch self {\n+\n+    case .logout:\n+      //DELETE Methods\n+      return Method(\n+        methodName: self.apiPath,\n+        methodType: .httpMethodDELETE,\n+        requestType: .requestTypeJSON\n+      )\n+    default:\n+      //POST Methods\n+      return Method(\n+        methodName: self.apiPath,\n+        methodType: .httpMethodPOST,\n+        requestType: .requestTypeJSON\n+      )\n+\n+    }\n+  }\n+\n+}\n+// MARK: - Set the server end points\n+enum AuthServerURLConstants {\n+  static let ProductionURL = API.authURL\n+  static let DevelopmentURL = API.authURL\n+}\n+\n+class AuthServerConfiguration: NetworkConfiguration {\n+  static let configuration = AuthServerConfiguration()\n+\n+  // MARK: Delegates\n+  override func getProductionURL() -> String {\n+    return AuthServerURLConstants.ProductionURL\n+  }\n+\n+  override func getDevelopmentURL() -> String {\n+    return AuthServerURLConstants.DevelopmentURL\n+  }\n+\n+  override func getDefaultHeaders() -> [String: String] {\n+\n+    let clientId = RegistrationServerAPIKey.apiKey\n+    let seceretKey = RegistrationServerSecretKey.secretKey\n+\n+    var header = [\n+      \"appId\": AppConfiguration.appID,\n+      \"orgId\": AppConfiguration.orgID,\n+    ]\n+\n+    if User.currentUser.authToken != nil {\n+      header[kUserAuthToken] = User.currentUser.authToken\n+      header[\"clientToken\"] = User.currentUser.clientToken\n+    } else {\n+      header[\"clientId\"] = clientId\n+      header[\"secretKey\"] = seceretKey", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b434722ec9012eb972ff77edd961bd692857cf1e"}, "originalPosition": 87}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc4MTE0Mg==", "bodyText": "please only add the Google copyright to files that have been updated with new functionality, not sure why this one has been changed", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/23#discussion_r396781142", "createdAt": "2020-03-23T21:57:17Z", "author": {"login": "zohrehj"}, "path": "iOS/HPHC/HPHC/Networking/Network setup/NetworkConstants.swift", "diffHunk": "@@ -1,6 +1,7 @@\n // License Agreement for FDA My Studies\n-// Copyright \u00a9 2017-2019 Harvard Pilgrim Health Care Institute (HPHCI) and its Contributors. Permission is\n-// hereby granted, free of charge, to any person obtaining a copy of this software and associated\n+// Copyright \u00a9 2017-2019 Harvard Pilgrim Health Care Institute (HPHCI) and its Contributors.\n+// Copyright 2020 Google LLC", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b434722ec9012eb972ff77edd961bd692857cf1e"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc4MTQwNg==", "bodyText": "same here. was this file updated aside from style guide changes?", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/23#discussion_r396781406", "createdAt": "2020-03-23T21:57:47Z", "author": {"login": "zohrehj"}, "path": "iOS/HPHC/HPHC/Networking/Network setup/NetworkManager.swift", "diffHunk": "@@ -1,6 +1,7 @@\n // License Agreement for FDA My Studies\n-// Copyright \u00a9 2017-2019 Harvard Pilgrim Health Care Institute (HPHCI) and its Contributors. Permission is\n-// hereby granted, free of charge, to any person obtaining a copy of this software and associated\n+// Copyright \u00a9 2017-2019 Harvard Pilgrim Health Care Institute (HPHCI) and its Contributors.\n+// Copyright 2020 Google LLC", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b434722ec9012eb972ff77edd961bd692857cf1e"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njc4MjIyNw==", "bodyText": "this file should have Google copyright header added to it, since there are some code changes.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/23#discussion_r396782227", "createdAt": "2020-03-23T21:59:41Z", "author": {"login": "zohrehj"}, "path": "iOS/HPHC/HPHC/Views/Cells/TableView/Study/StudyListCell.swift", "diffHunk": "@@ -44,6 +44,12 @@ class StudyListCell: UITableViewCell {\n   var selectedStudy: Study!\n   weak var delegate: StudyListDelegates?\n \n+  /// Cell cleanup.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b434722ec9012eb972ff77edd961bd692857cf1e"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "47c0f7de7641994467050d90c8042eca7ec6f42d", "author": {"user": {"login": "tushar-boston", "name": "Tushar Katyal"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/47c0f7de7641994467050d90c8042eca7ec6f42d", "committedDate": "2020-03-24T05:26:59Z", "message": "Copyrights & comments cleanup."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgwMjQ5OTEx", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/23#pullrequestreview-380249911", "createdAt": "2020-03-24T12:13:23Z", "commit": {"oid": "47c0f7de7641994467050d90c8042eca7ec6f42d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1344, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}