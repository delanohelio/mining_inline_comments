{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA2MDg3NDk1", "number": 1499, "title": "[Enrollment Service]:Issue #1357 and #1447 fixed", "bodyText": "Issue #1357 and #1447 fixed", "createdAt": "2020-10-19T15:49:45Z", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1499", "merged": true, "mergeCommit": {"oid": "e02150fb11f33be46e3f8cecae31572b09c606cd"}, "closed": true, "closedAt": "2020-10-20T18:22:31Z", "author": {"login": "madhurya-btc"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdUGHjWAH2gAyNTA2MDg3NDk1OjlhZjliZGMxN2JlNzI4OTQ4NDZkZmRiNGMxYjdlZmQyNjA2M2QxOGM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdUc8qFgH2gAyNTA2MDg3NDk1OmY0NTk1MTA1YTEwYTZkODViNGYwOWM0OWE5ODFiMmRhYTdjMGFjMjQ=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "9af9bdc17be72894846dfdb4c1b7efd26063d18c", "author": {"user": {"login": "madhurya-btc", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/9af9bdc17be72894846dfdb4c1b7efd26063d18c", "committedDate": "2020-10-19T15:43:24Z", "message": "issue 1357 fixed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cd8ef32336c55c7eb625953468b95553b6f19b5a", "author": {"user": {"login": "madhurya-btc", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/cd8ef32336c55c7eb625953468b95553b6f19b5a", "committedDate": "2020-10-19T15:52:55Z", "message": "Merge branch 'develop' into issue1357"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEyMTE2Mjk5", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1499#pullrequestreview-512116299", "createdAt": "2020-10-19T20:03:22Z", "commit": {"oid": "cd8ef32336c55c7eb625953468b95553b6f19b5a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQyMDowMzoyMlrOHkfmxA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xOVQyMDowMzoyMlrOHkfmxA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODAyODYxMg==", "bodyText": "How will this fix the two issues mentioned", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1499#discussion_r508028612", "createdAt": "2020-10-19T20:03:22Z", "author": {"login": "saminguyen"}, "path": "participant-datastore/enroll-mgmt-module/enroll-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/dao/EnrollmentTokenDaoImpl.java", "diffHunk": "@@ -103,13 +105,25 @@ public boolean hasParticipant(@NotNull String studyId, @NotNull String tokenValu\n     List<Object[]> participantList = null;\n     boolean hasParticipant = false;\n     Session session = this.sessionFactory.getCurrentSession();\n+    List<String> studyStateStatus = new ArrayList<>();\n+    studyStateStatus.add(ParticipantStudyStateStatus.ENROLLED.getValue());\n+    studyStateStatus.add(ParticipantStudyStateStatus.WITHDRAWN.getValue());\n+    studyStateStatus.add(ParticipantStudyStateStatus.INPROGRESS.getValue());\n+\n+    List<String> onboardingStatus = new ArrayList<>();\n+    onboardingStatus.add(OnboardingStatus.ENROLLED.getCode());\n+    onboardingStatus.add(OnboardingStatus.DISABLED.getCode());\n     participantList =\n         session\n             .createQuery(\n                 \"from ParticipantStudyEntity PS,StudyEntity SB, ParticipantRegistrySiteEntity PR\"\n                     + \" where SB.id =PS.study.id and PS.participantRegistrySite.id=PR.id\"\n-                    + \" and PS.status='Enrolled' and PR.enrollmentToken=:token and SB.customId=:studyId\")\n-            .setParameter(\"token\", tokenValue)\n+                    + \" and PS.status in (:studyStateStatus) \"\n+                    + \" and PR.onboardingStatus in (:onboardingStatus)\"\n+                    + \" and upper(trim(PR.enrollmentToken))=:token and SB.customId=:studyId\")\n+            .setParameter(\"studyStateStatus\", studyStateStatus)\n+            .setParameter(\"onboardingStatus\", onboardingStatus)\n+            .setParameter(\"token\", tokenValue.toUpperCase())", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cd8ef32336c55c7eb625953468b95553b6f19b5a"}, "originalPosition": 33}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cc8e31698c0b668c64aa8eef27c1d47554cc4fd4", "author": {"user": {"login": "madhurya-btc", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/cc8e31698c0b668c64aa8eef27c1d47554cc4fd4", "committedDate": "2020-10-20T14:13:50Z", "message": "Merge branch 'develop' into issue1357"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEyOTQxNjgy", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1499#pullrequestreview-512941682", "createdAt": "2020-10-20T16:52:45Z", "commit": {"oid": "cc8e31698c0b668c64aa8eef27c1d47554cc4fd4"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f4595105a10a6d85b4f09c49a981b2daa7c0ac24", "author": {"user": {"login": "aswinijena100", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/f4595105a10a6d85b4f09c49a981b2daa7c0ac24", "committedDate": "2020-10-20T18:19:19Z", "message": "Merge branch 'develop' into issue1357"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 124, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}