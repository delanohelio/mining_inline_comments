{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc1NTIzMTk1", "number": 851, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNjo1Mzo0NlrOEd0kwQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxNTowNjoyMFrOEeWLIw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5NzA1NTM3OnYy", "diffSide": "RIGHT", "path": "response-server-module/response-server-service/src/test/java/com/google/cloud/healthcare/fdamystudies/common/AppConfigTest.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNjo1Mzo0NlrOHJNuaw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQwNTo0MzoxMlrOHJqt7g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQyNDEwNw==", "bodyText": "[response-server Checks] reported by reviewdog \ud83d\udc36\n'package' should be separated from previous statement.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/851#discussion_r479424107", "createdAt": "2020-08-28T16:53:46Z", "author": {"login": "github-actions"}, "path": "response-server-module/response-server-service/src/test/java/com/google/cloud/healthcare/fdamystudies/common/AppConfigTest.java", "diffHunk": "@@ -0,0 +1,28 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+package com.google.cloud.healthcare.fdamystudies.common;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aa0a19f51f4ed2b5bbdcef2c8f4c5b1270e2aa4f"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQ1MzUwNg==", "bodyText": "please fix", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/851#discussion_r479453506", "createdAt": "2020-08-28T17:54:03Z", "author": {"login": "zohrehj"}, "path": "response-server-module/response-server-service/src/test/java/com/google/cloud/healthcare/fdamystudies/common/AppConfigTest.java", "diffHunk": "@@ -0,0 +1,28 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+package com.google.cloud.healthcare.fdamystudies.common;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQyNDEwNw=="}, "originalCommit": {"oid": "aa0a19f51f4ed2b5bbdcef2c8f4c5b1270e2aa4f"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTg5OTExOA==", "bodyText": "Fixed the comment", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/851#discussion_r479899118", "createdAt": "2020-08-31T05:43:12Z", "author": {"login": "navya-BTC"}, "path": "response-server-module/response-server-service/src/test/java/com/google/cloud/healthcare/fdamystudies/common/AppConfigTest.java", "diffHunk": "@@ -0,0 +1,28 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+package com.google.cloud.healthcare.fdamystudies.common;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQyNDEwNw=="}, "originalCommit": {"oid": "aa0a19f51f4ed2b5bbdcef2c8f4c5b1270e2aa4f"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5NzA1NTM5OnYy", "diffSide": "RIGHT", "path": "response-server-module/response-server-service/src/main/java/com/google/cloud/healthcare/fdamystudies/filter/TokenIntrospectionFilter.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNjo1Mzo0NlrOHJNubg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNjo1Mzo0NlrOHJNubg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQyNDExMA==", "bodyText": "[response-server Checks] reported by reviewdog \ud83d\udc36\nMissing a Javadoc comment.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/851#discussion_r479424110", "createdAt": "2020-08-28T16:53:46Z", "author": {"login": "github-actions"}, "path": "response-server-module/response-server-service/src/main/java/com/google/cloud/healthcare/fdamystudies/filter/TokenIntrospectionFilter.java", "diffHunk": "@@ -0,0 +1,58 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.filter;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+import javax.annotation.PostConstruct;\n+import javax.servlet.ServletContext;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.core.annotation.Order;\n+import org.springframework.http.HttpMethod;\n+import org.springframework.stereotype.Component;\n+\n+@Component\n+@Order(2)\n+public class TokenIntrospectionFilter extends BaseTokenIntrospectionFilter {\n+\n+  private Map<String, String[]> uriTemplateAndMethods = new HashMap<>();\n+\n+  @Autowired ServletContext context;\n+\n+  @PostConstruct", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aa0a19f51f4ed2b5bbdcef2c8f4c5b1270e2aa4f"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwMjUzMTMzOnYy", "diffSide": "RIGHT", "path": "response-server-module/response-server-service/src/main/java/com/google/cloud/healthcare/fdamystudies/filter/TokenIntrospectionFilter.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxNDo1OTowMVrOHJ8YBQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQxNToxNDoxMlrOHK7aBw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDE4ODQyMQ==", "bodyText": "what are these URI's from? and why are they being set here?\nA few other areas of concern:\n\nURL should not be hardcoded here within the code\nthey should follow the rest patterns, e.g. POST .../participants to create one, instead of .../participant/add", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/851#discussion_r480188421", "createdAt": "2020-08-31T14:59:01Z", "author": {"login": "zohrehj"}, "path": "response-server-module/response-server-service/src/main/java/com/google/cloud/healthcare/fdamystudies/filter/TokenIntrospectionFilter.java", "diffHunk": "@@ -0,0 +1,58 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.filter;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+import javax.annotation.PostConstruct;\n+import javax.servlet.ServletContext;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.core.annotation.Order;\n+import org.springframework.http.HttpMethod;\n+import org.springframework.stereotype.Component;\n+\n+@Component\n+@Order(2)\n+public class TokenIntrospectionFilter extends BaseTokenIntrospectionFilter {\n+\n+  private Map<String, String[]> uriTemplateAndMethods = new HashMap<>();\n+\n+  @Autowired ServletContext context;\n+\n+  @PostConstruct\n+  public void init() {\n+\n+    uriTemplateAndMethods.put(\n+        String.format(\"%s/participant/add\", context.getContextPath()),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a5769a16385c481b62a8488b26bf536ceed30776"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTIyMTEyNw==", "bodyText": "Created an Issue #860 to change the endpoint. This review comment will be addressed in follow-up PR.\nURIs configured in this filter matches with RequestMapping's in Controller classes. This is same approach followed in other services for  token introspection.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/851#discussion_r481221127", "createdAt": "2020-09-01T15:14:12Z", "author": {"login": "dhanyak-btc"}, "path": "response-server-module/response-server-service/src/main/java/com/google/cloud/healthcare/fdamystudies/filter/TokenIntrospectionFilter.java", "diffHunk": "@@ -0,0 +1,58 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.filter;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+import javax.annotation.PostConstruct;\n+import javax.servlet.ServletContext;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.core.annotation.Order;\n+import org.springframework.http.HttpMethod;\n+import org.springframework.stereotype.Component;\n+\n+@Component\n+@Order(2)\n+public class TokenIntrospectionFilter extends BaseTokenIntrospectionFilter {\n+\n+  private Map<String, String[]> uriTemplateAndMethods = new HashMap<>();\n+\n+  @Autowired ServletContext context;\n+\n+  @PostConstruct\n+  public void init() {\n+\n+    uriTemplateAndMethods.put(\n+        String.format(\"%s/participant/add\", context.getContextPath()),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDE4ODQyMQ=="}, "originalCommit": {"oid": "a5769a16385c481b62a8488b26bf536ceed30776"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwMjU0OTM0OnYy", "diffSide": "RIGHT", "path": "response-server-module/response-server-service/src/main/resources/application.properties", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxNTowMzoyOFrOHJ8jCA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQxNTozODowM1rOHL1TXA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDE5MTI0MA==", "bodyText": "what is this value? please add better comment to describe what this value should be?\nalso this does not follow the URI we are using for our deployments script in tf-deployment.yaml files. I would suggest using the same URL to keep things consistent.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/851#discussion_r480191240", "createdAt": "2020-08-31T15:03:28Z", "author": {"login": "zohrehj"}, "path": "response-server-module/response-server-service/src/main/resources/application.properties", "diffHunk": "@@ -27,7 +27,7 @@ spring.datasource.hikari.minimum-idle=5\n spring.datasource.hikari.maximum-pool-size=50\n \n # EMBEDDED SERVER CONFIGURATION\n-server.servlet.contextPath=/mystudies-response-server\n+server.servlet.context-path=/mystudies-response-server", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a5769a16385c481b62a8488b26bf536ceed30776"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTIyMzI3OA==", "bodyText": "We noticed the spring boot context path property was incorrect, hence changed it. Spring Boot Change Context Path", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/851#discussion_r481223278", "createdAt": "2020-09-01T15:17:02Z", "author": {"login": "dhanyak-btc"}, "path": "response-server-module/response-server-service/src/main/resources/application.properties", "diffHunk": "@@ -27,7 +27,7 @@ spring.datasource.hikari.minimum-idle=5\n spring.datasource.hikari.maximum-pool-size=50\n \n # EMBEDDED SERVER CONFIGURATION\n-server.servlet.contextPath=/mystudies-response-server\n+server.servlet.context-path=/mystudies-response-server", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDE5MTI0MA=="}, "originalCommit": {"oid": "a5769a16385c481b62a8488b26bf536ceed30776"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjE2OTY5Mg==", "bodyText": "Approach makes sense, but both in the test URLs and here, I would suggest using the same value that's used in the tf-deployment config and in our deployment strategy.\nsee response-server's tf-deployment.yaml\nThe whole idea is to minimize the amount of changes users need to do when deploying this platform.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/851#discussion_r482169692", "createdAt": "2020-09-02T15:38:03Z", "author": {"login": "zohrehj"}, "path": "response-server-module/response-server-service/src/main/resources/application.properties", "diffHunk": "@@ -27,7 +27,7 @@ spring.datasource.hikari.minimum-idle=5\n spring.datasource.hikari.maximum-pool-size=50\n \n # EMBEDDED SERVER CONFIGURATION\n-server.servlet.contextPath=/mystudies-response-server\n+server.servlet.context-path=/mystudies-response-server", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDE5MTI0MA=="}, "originalCommit": {"oid": "a5769a16385c481b62a8488b26bf536ceed30776"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwMjU2MDM1OnYy", "diffSide": "RIGHT", "path": "response-server-module/response-server-service/src/test/java/com/google/cloud/healthcare/fdamystudies/common/ApiEndpoint.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxNTowNjoyMFrOHJ8p4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMVQxNToyNTozOVrOHK75qA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDE5Mjk5Mg==", "bodyText": "maybe move http://localhost:8004 to a variable to make future edits easier", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/851#discussion_r480192992", "createdAt": "2020-08-31T15:06:20Z", "author": {"login": "zohrehj"}, "path": "response-server-module/response-server-service/src/test/java/com/google/cloud/healthcare/fdamystudies/common/ApiEndpoint.java", "diffHunk": "@@ -12,7 +12,24 @@\n import java.net.URL;\n \n public enum ApiEndpoint {\n-  HEALTH(\"http://localhost:8004/mystudies-response-server/healthCheck\");\n+  HEALTH(\"http://localhost:8004/mystudies-response-server/healthCheck\"),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a5769a16385c481b62a8488b26bf536ceed30776"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTIyOTIyNA==", "bodyText": "Initially, we used TestRestTemplate for writing integration tests, so we added complete URL in ApiEndpoint.  After few PR's Nik suggested us to use MockMVC  which requires only the path, so added a method to extract the Path from URL : URL(url).getPath()\nI agree with your comment, but we've followed the same pattern in all the services for integration tests.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/851#discussion_r481229224", "createdAt": "2020-09-01T15:25:39Z", "author": {"login": "dhanyak-btc"}, "path": "response-server-module/response-server-service/src/test/java/com/google/cloud/healthcare/fdamystudies/common/ApiEndpoint.java", "diffHunk": "@@ -12,7 +12,24 @@\n import java.net.URL;\n \n public enum ApiEndpoint {\n-  HEALTH(\"http://localhost:8004/mystudies-response-server/healthCheck\");\n+  HEALTH(\"http://localhost:8004/mystudies-response-server/healthCheck\"),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDE5Mjk5Mg=="}, "originalCommit": {"oid": "a5769a16385c481b62a8488b26bf536ceed30776"}, "originalPosition": 5}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1912, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}