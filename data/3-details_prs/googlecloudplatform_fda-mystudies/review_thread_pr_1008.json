{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkwOTUwMTg0", "number": 1008, "reviewThreads": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxNDo0OTozNFrOEmH2rw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QyMDozMDowMVrOEmxVcw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA4NDEwMDMxOnYy", "diffSide": "RIGHT", "path": "oauth-scim-module/oauth-scim-service/src/main/java/com/google/cloud/healthcare/fdamystudies/oauthscim/model/UserEntity.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yMlQxNDo0OTozNVrOHV9-5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QwNzo0MzozMVrOHWallw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjc5NzY3MQ==", "bodyText": "Primary key and foreign keys should have indexes generated by default.\nAlso we use used a pattern for index names, I believe it was:\n<table name>_<index column names>_idx", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1008#discussion_r492797671", "createdAt": "2020-09-22T14:49:35Z", "author": {"login": "zohrehj"}, "path": "oauth-scim-module/oauth-scim-service/src/main/java/com/google/cloud/healthcare/fdamystudies/oauthscim/model/UserEntity.java", "diffHunk": "@@ -27,7 +28,14 @@\n @Setter\n @Getter\n @Entity\n-@Table(name = \"users\")\n+@Table(\n+    name = \"users\",\n+    indexes = {\n+      @Index(name = \"id_index\", columnList = \"id\", unique = true),\n+      @Index(name = \"user_id_index\", columnList = \"user_id\", unique = true),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d0b68f749c78d01314a8f7fee84de2380287b985"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzI2NjMyNw==", "bodyText": "Requested changes fixed.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1008#discussion_r493266327", "createdAt": "2020-09-23T07:43:31Z", "author": {"login": "chiranjibi009"}, "path": "oauth-scim-module/oauth-scim-service/src/main/java/com/google/cloud/healthcare/fdamystudies/oauthscim/model/UserEntity.java", "diffHunk": "@@ -27,7 +28,14 @@\n @Setter\n @Getter\n @Entity\n-@Table(name = \"users\")\n+@Table(\n+    name = \"users\",\n+    indexes = {\n+      @Index(name = \"id_index\", columnList = \"id\", unique = true),\n+      @Index(name = \"user_id_index\", columnList = \"user_id\", unique = true),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjc5NzY3MQ=="}, "originalCommit": {"oid": "d0b68f749c78d01314a8f7fee84de2380287b985"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA5MDg3NTU4OnYy", "diffSide": "RIGHT", "path": "oauth-scim-module/oauth-scim-service/src/main/java/com/google/cloud/healthcare/fdamystudies/oauthscim/model/UserEntity.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QyMDoyMzozNFrOHW_mLQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNFQxMjo0MjoyMlrOHXYw3g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mzg3MjY4NQ==", "bodyText": "I am seeing this value change all the time between PRs, without any code change.\nPlease explain why it is being changed yet again?", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1008#discussion_r493872685", "createdAt": "2020-09-23T20:23:34Z", "author": {"login": "zohrehj"}, "path": "oauth-scim-module/oauth-scim-service/src/main/java/com/google/cloud/healthcare/fdamystudies/oauthscim/model/UserEntity.java", "diffHunk": "@@ -49,7 +56,7 @@\n   private Timestamp created;\n \n   @ToString.Exclude\n-  @Column(name = \"tempRegId\", nullable = true, length = 64)\n+  @Column(name = \"temp_reg_id\", nullable = true, length = 64)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "77ce4200fdac66bdd5a691274275c2733f8952e0"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDI4NTAyMg==", "bodyText": "Initially, temp_reg_id was used in query params for auto sign-in after registration but later changed to camelCase format, angular developer also used tempRegId in their code.\nWe are not following camelCase format on Entity column names. I also noticed JPA DDL converts tempRegId into temp_reg_id hence asked the developer to change the name to temp_reg_id.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1008#discussion_r494285022", "createdAt": "2020-09-24T12:42:22Z", "author": {"login": "dhanyak-btc"}, "path": "oauth-scim-module/oauth-scim-service/src/main/java/com/google/cloud/healthcare/fdamystudies/oauthscim/model/UserEntity.java", "diffHunk": "@@ -49,7 +56,7 @@\n   private Timestamp created;\n \n   @ToString.Exclude\n-  @Column(name = \"tempRegId\", nullable = true, length = 64)\n+  @Column(name = \"temp_reg_id\", nullable = true, length = 64)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mzg3MjY4NQ=="}, "originalCommit": {"oid": "77ce4200fdac66bdd5a691274275c2733f8952e0"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzA5MDg5NjUxOnYy", "diffSide": "RIGHT", "path": "oauth-scim-module/oauth-scim-service/src/main/java/com/google/cloud/healthcare/fdamystudies/oauthscim/model/UserEntity.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yM1QyMDozMDowMVrOHW_y_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yNVQwODowMzo1MlrOHX5RCg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mzg3NTk2Ng==", "bodyText": "I was under the impression that hibernate would create indexes for columns with@unique  automatically.\nI am not seeing a unique=true annotation on wither user_id or temp_reg_id however.\nPlease add those annotation first, dump the automatically generated schema, and only add indexes manually if hibernate does not create them automatically.\nAlso it might be a good idea to export db schema after each db change and include it in the PR so that we can verify indexes are correctly generated.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1008#discussion_r493875966", "createdAt": "2020-09-23T20:30:01Z", "author": {"login": "zohrehj"}, "path": "oauth-scim-module/oauth-scim-service/src/main/java/com/google/cloud/healthcare/fdamystudies/oauthscim/model/UserEntity.java", "diffHunk": "@@ -27,7 +28,13 @@\n @Setter\n @Getter\n @Entity\n-@Table(name = \"users\")\n+@Table(\n+    name = \"users\",\n+    indexes = {\n+      @Index(name = \"users_user_id_idx\", columnList = \"user_id\", unique = true),\n+      @Index(name = \"users_temp_reg_id_idx\", columnList = \"temp_reg_id\", unique = true),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "77ce4200fdac66bdd5a691274275c2733f8952e0"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDgxNzU0Ng==", "bodyText": "Fixed review comment. Added unique=true to user_id and temp_reg_id; removed @Index for temp_reg_id and user_id \nCREATE TABLE `users` (\n  `id` varchar(255) NOT NULL,\n  `app_id` varchar(100) NOT NULL,\n  `created` timestamp NULL DEFAULT CURRENT_TIMESTAMP,\n  `email` varchar(320) NOT NULL,\n  `status` int(11) NOT NULL,\n  `temp_reg_id` varchar(64) DEFAULT NULL,\n  `user_id` varchar(64) DEFAULT NULL,\n  `user_info` json NOT NULL,\n  PRIMARY KEY (`id`),\n  UNIQUE KEY `UK_onuvh020q8e92n6pgygqxjgro` (`temp_reg_id`),\n  UNIQUE KEY `UK_6efs5vmce86ymf5q7lmvn2uuf` (`user_id`),\n  KEY `users_app_id_email_idx` (`app_id`,`email`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1008#discussion_r494817546", "createdAt": "2020-09-25T08:03:52Z", "author": {"login": "dhanyak-btc"}, "path": "oauth-scim-module/oauth-scim-service/src/main/java/com/google/cloud/healthcare/fdamystudies/oauthscim/model/UserEntity.java", "diffHunk": "@@ -27,7 +28,13 @@\n @Setter\n @Getter\n @Entity\n-@Table(name = \"users\")\n+@Table(\n+    name = \"users\",\n+    indexes = {\n+      @Index(name = \"users_user_id_idx\", columnList = \"user_id\", unique = true),\n+      @Index(name = \"users_temp_reg_id_idx\", columnList = \"temp_reg_id\", unique = true),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mzg3NTk2Ng=="}, "originalCommit": {"oid": "77ce4200fdac66bdd5a691274275c2733f8952e0"}, "originalPosition": 17}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1800, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}