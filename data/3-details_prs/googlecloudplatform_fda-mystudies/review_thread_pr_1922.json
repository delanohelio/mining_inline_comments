{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE3ODA0MzUz", "number": 1922, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxNDozMTowOFrOE2ytqQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQyMToyNTo0MVrOE29ZBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI1ODg5NDQ5OnYy", "diffSide": "RIGHT", "path": "participant-datastore/enroll-mgmt-module/enroll-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/dao/EnrollmentTokenDaoImpl.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxNDozMTowOFrOHvxfhA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxNDozNzoyMVrOHvxwvQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTg1NjAwNA==", "bodyText": "[enroll-mgmt Checks] reported by reviewdog \ud83d\udc36\nLine is longer than 100 characters (found 131).", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1922#discussion_r519856004", "createdAt": "2020-11-09T14:31:08Z", "author": {"login": "github-actions"}, "path": "participant-datastore/enroll-mgmt-module/enroll-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/dao/EnrollmentTokenDaoImpl.java", "diffHunk": "@@ -108,27 +108,16 @@ public boolean hasParticipant(@NotNull String studyId, @NotNull String tokenValu\n     logger.info(\"EnrollmentTokenDaoImpl hasParticipant() - Started \");\n     List<Object[]> participantList = null;\n     Session session = this.sessionFactory.getCurrentSession();\n-    List<String> studyStateStatus = new ArrayList<>();\n-    studyStateStatus.add(ParticipantStudyStateStatus.ENROLLED.getValue());\n-    studyStateStatus.add(ParticipantStudyStateStatus.WITHDRAWN.getValue());\n-    studyStateStatus.add(ParticipantStudyStateStatus.INPROGRESS.getValue());\n \n-    List<String> onboardingStatus = new ArrayList<>();\n-    onboardingStatus.add(OnboardingStatus.INVITED.getCode());\n-    onboardingStatus.add(OnboardingStatus.ENROLLED.getCode());\n-    onboardingStatus.add(OnboardingStatus.DISABLED.getCode());\n     participantList =\n         session\n             .createQuery(\n                 \"from ParticipantStudyEntity PS,StudyEntity SB, ParticipantRegistrySiteEntity PR\"\n                     + \" where SB.id =PS.study.id and PS.participantRegistrySite.id=PR.id\"\n-                    + \" and PS.status in (:studyStateStatus) \"\n-                    + \" and PR.onboardingStatus in (:onboardingStatus)\"\n-                    + \" and upper(trim(PR.enrollmentToken))=:token and SB.customId=:studyId\")\n-            .setParameter(\"studyStateStatus\", studyStateStatus)\n-            .setParameter(\"onboardingStatus\", onboardingStatus)\n+                    + \" and upper(trim(PR.enrollmentToken))=:token and SB.customId=:studyId and PR.enrollmentTokenUsed=:tokenUsed\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "590e38588408a62c919d54b9fe44749bb3572b66"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTg2MDQxMw==", "bodyText": "Fixed", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1922#discussion_r519860413", "createdAt": "2020-11-09T14:37:21Z", "author": {"login": "madhurya-btc"}, "path": "participant-datastore/enroll-mgmt-module/enroll-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/dao/EnrollmentTokenDaoImpl.java", "diffHunk": "@@ -108,27 +108,16 @@ public boolean hasParticipant(@NotNull String studyId, @NotNull String tokenValu\n     logger.info(\"EnrollmentTokenDaoImpl hasParticipant() - Started \");\n     List<Object[]> participantList = null;\n     Session session = this.sessionFactory.getCurrentSession();\n-    List<String> studyStateStatus = new ArrayList<>();\n-    studyStateStatus.add(ParticipantStudyStateStatus.ENROLLED.getValue());\n-    studyStateStatus.add(ParticipantStudyStateStatus.WITHDRAWN.getValue());\n-    studyStateStatus.add(ParticipantStudyStateStatus.INPROGRESS.getValue());\n \n-    List<String> onboardingStatus = new ArrayList<>();\n-    onboardingStatus.add(OnboardingStatus.INVITED.getCode());\n-    onboardingStatus.add(OnboardingStatus.ENROLLED.getCode());\n-    onboardingStatus.add(OnboardingStatus.DISABLED.getCode());\n     participantList =\n         session\n             .createQuery(\n                 \"from ParticipantStudyEntity PS,StudyEntity SB, ParticipantRegistrySiteEntity PR\"\n                     + \" where SB.id =PS.study.id and PS.participantRegistrySite.id=PR.id\"\n-                    + \" and PS.status in (:studyStateStatus) \"\n-                    + \" and PR.onboardingStatus in (:onboardingStatus)\"\n-                    + \" and upper(trim(PR.enrollmentToken))=:token and SB.customId=:studyId\")\n-            .setParameter(\"studyStateStatus\", studyStateStatus)\n-            .setParameter(\"onboardingStatus\", onboardingStatus)\n+                    + \" and upper(trim(PR.enrollmentToken))=:token and SB.customId=:studyId and PR.enrollmentTokenUsed=:tokenUsed\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTg1NjAwNA=="}, "originalCommit": {"oid": "590e38588408a62c919d54b9fe44749bb3572b66"}, "originalPosition": 51}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzI2MDY0Mzg4OnYy", "diffSide": "LEFT", "path": "participant-datastore/enroll-mgmt-module/enroll-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/dao/EnrollmentTokenDaoImpl.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQyMToyNTo0MVrOHwCN0w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xMFQwODoyMDo1NlrOHwQ4Tw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDEzMDAwMw==", "bodyText": "Why are these removed? Is it relevant to the current bug to be fixed?", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1922#discussion_r520130003", "createdAt": "2020-11-09T21:25:41Z", "author": {"login": "saminguyen"}, "path": "participant-datastore/enroll-mgmt-module/enroll-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/dao/EnrollmentTokenDaoImpl.java", "diffHunk": "@@ -108,27 +108,17 @@ public boolean hasParticipant(@NotNull String studyId, @NotNull String tokenValu\n     logger.info(\"EnrollmentTokenDaoImpl hasParticipant() - Started \");\n     List<Object[]> participantList = null;\n     Session session = this.sessionFactory.getCurrentSession();\n-    List<String> studyStateStatus = new ArrayList<>();\n-    studyStateStatus.add(ParticipantStudyStateStatus.ENROLLED.getValue());\n-    studyStateStatus.add(ParticipantStudyStateStatus.WITHDRAWN.getValue());\n-    studyStateStatus.add(ParticipantStudyStateStatus.INPROGRESS.getValue());\n \n-    List<String> onboardingStatus = new ArrayList<>();\n-    onboardingStatus.add(OnboardingStatus.INVITED.getCode());\n-    onboardingStatus.add(OnboardingStatus.ENROLLED.getCode());\n-    onboardingStatus.add(OnboardingStatus.DISABLED.getCode());\n     participantList =\n         session\n             .createQuery(\n                 \"from ParticipantStudyEntity PS,StudyEntity SB, ParticipantRegistrySiteEntity PR\"\n                     + \" where SB.id =PS.study.id and PS.participantRegistrySite.id=PR.id\"\n-                    + \" and PS.status in (:studyStateStatus) \"\n-                    + \" and PR.onboardingStatus in (:onboardingStatus)\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "13b85f9178a7d1243c791165c3c56abc4f41ad39"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDM3MDI1NQ==", "bodyText": "With these status we were unable to find exactly whether token is already used or not, hence we have introduced a new column to check Token is used or not .", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1922#discussion_r520370255", "createdAt": "2020-11-10T08:20:56Z", "author": {"login": "madhurya-btc"}, "path": "participant-datastore/enroll-mgmt-module/enroll-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/dao/EnrollmentTokenDaoImpl.java", "diffHunk": "@@ -108,27 +108,17 @@ public boolean hasParticipant(@NotNull String studyId, @NotNull String tokenValu\n     logger.info(\"EnrollmentTokenDaoImpl hasParticipant() - Started \");\n     List<Object[]> participantList = null;\n     Session session = this.sessionFactory.getCurrentSession();\n-    List<String> studyStateStatus = new ArrayList<>();\n-    studyStateStatus.add(ParticipantStudyStateStatus.ENROLLED.getValue());\n-    studyStateStatus.add(ParticipantStudyStateStatus.WITHDRAWN.getValue());\n-    studyStateStatus.add(ParticipantStudyStateStatus.INPROGRESS.getValue());\n \n-    List<String> onboardingStatus = new ArrayList<>();\n-    onboardingStatus.add(OnboardingStatus.INVITED.getCode());\n-    onboardingStatus.add(OnboardingStatus.ENROLLED.getCode());\n-    onboardingStatus.add(OnboardingStatus.DISABLED.getCode());\n     participantList =\n         session\n             .createQuery(\n                 \"from ParticipantStudyEntity PS,StudyEntity SB, ParticipantRegistrySiteEntity PR\"\n                     + \" where SB.id =PS.study.id and PS.participantRegistrySite.id=PR.id\"\n-                    + \" and PS.status in (:studyStateStatus) \"\n-                    + \" and PR.onboardingStatus in (:onboardingStatus)\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDEzMDAwMw=="}, "originalCommit": {"oid": "13b85f9178a7d1243c791165c3c56abc4f41ad39"}, "originalPosition": 47}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1655, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}