{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI4NDE3Mzcx", "number": 454, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQxMzozNjoxN1rOEC9Vpw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQxMzo0NjoxNVrOEC9kmA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxNTM3NTc1OnYy", "diffSide": "RIGHT", "path": "WCP-WS/src/main/java/com/hphc/mystudies/integration/AppMetaDataOrchestration.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQxMzozNjoxN1rOGfuxTg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQxMzozNjoxN1rOGfuxTg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTkyNTMyNg==", "bodyText": "moving this to the the top as an early exit would reduce code nesting be one level, i.e.\nif (appVersionInfo == null) {\n     return null;\n}\n// the rest of the code does not need to be in an else block.\nandroid.setLatestVersion(appVersionInfo.getAndroidVersion());\n...", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/454#discussion_r435925326", "createdAt": "2020-06-05T13:36:17Z", "author": {"login": "zohrehj"}, "path": "WCP-WS/src/main/java/com/hphc/mystudies/integration/AppMetaDataOrchestration.java", "diffHunk": "@@ -121,27 +121,44 @@ public String updateAppVersionDetails(\n     return updateAppVersionResponse;\n   }\n \n-  public AppVersionInfoBean getAppVersionInfo() {\n+  public AppVersionInfoBean getAppVersionInfo(String appId, String orgId) {\n     LOGGER.info(\"INFO: AppMetaDataOrchestration - getAppVersionInfo() :: Starts\");\n \n-    AppVersionInfoBean aAppVersionInfoBean = new AppVersionInfoBean();\n+    AppVersionInfoBean aAppVersionInfoBean;\n     AppVersionInfo appVersionInfo = null;\n     DeviceVersion android = new DeviceVersion();\n     DeviceVersion ios = new DeviceVersion();\n \n-    appVersionInfo = appMetaDataDao.getAppVersionInfo();\n+    appVersionInfo = appMetaDataDao.getAppVersionInfo(appId, orgId);\n \n-    android.setLatestVersion(appVersionInfo.getAndroidVersion());\n-    android.setForceUpdate(\"true\");\n+    if (appVersionInfo != null) {\n+      android.setLatestVersion(appVersionInfo.getAndroidVersion());\n \n-    ios.setForceUpdate(\"true\");\n-    ios.setLatestVersion(appVersionInfo.getIosVersion());\n+      if (appVersionInfo.getAndroidForceUpdate() != null\n+          && appVersionInfo.getAndroidForceUpdate()) {\n+        android.setForceUpdate(\"true\");\n+      } else {\n+        android.setForceUpdate(\"false\");\n+      }\n+\n+      if (appVersionInfo.getIosForceUpdate() != null && appVersionInfo.getIosForceUpdate()) {\n+        ios.setForceUpdate(\"true\");\n+      } else {\n+        ios.setForceUpdate(\"false\");\n+      }\n \n-    aAppVersionInfoBean.setAndroid(android);\n-    aAppVersionInfoBean.setIos(ios);\n+      ios.setLatestVersion(appVersionInfo.getIosVersion());\n \n-    LOGGER.info(\"INFO: AppMetaDataOrchestration - getAppVersionInfo() :: Ends\");\n-    return aAppVersionInfoBean;\n+      aAppVersionInfoBean = new AppVersionInfoBean();\n+      aAppVersionInfoBean.setAndroid(android);\n+      aAppVersionInfoBean.setIos(ios);\n+\n+      LOGGER.info(\"INFO: AppMetaDataOrchestration - getAppVersionInfo() :: Ends\");\n+      return aAppVersionInfoBean;\n+    } else {\n+      LOGGER.info(\"INFO: AppMetaDataOrchestration - getAppVersionInfo() :: Ends\");\n+      return null;\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1bfb6a88f7c8f070dce97483f940f49f568c954a"}, "originalPosition": 52}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcxNTQxNDAwOnYy", "diffSide": "RIGHT", "path": "WCP-WS/src/main/java/com/hphc/mystudies/service/StudyMetaDataService.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQxMzo0NjoxNVrOGfvJtA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQwNjoxNzozMFrOGgQang==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTkzMTU3Mg==", "bodyText": "this case can be moved outside of the try block if you revert the initial condition, i.e.\nif (!StringUtils.isNotEmpty(appId) || !StringUtils.isNotEmpty(orgId)) {\n  StudyMetaDataUtil.getFailureResponse(\n            ErrorCodes.STATUS_102,\n            ErrorCodes.UNKNOWN,\n            StudyMetaDataConstants.INVALID_INPUT_ERROR_MSG,\n            response);\n        return Response.status(Response.Status.NOT_FOUND)\n            .entity(StudyMetaDataConstants.INVALID_INPUT)\n            .build();\n}\n\ntry {\n  appVersionInfoBean = appMetaDataOrchestration.getAppVersionInfo(appId, orgId);\n        if (appVersionInfoBean == null) {\n          StudyMetaDataUtil.getFailureResponse(\n              ErrorCodes.STATUS_103, ErrorCodes.NO_DATA, StudyMetaDataConstants.FAILURE, response);\n          return Response.status(Response.Status.NOT_FOUND)\n              .entity(StudyMetaDataConstants.NO_RECORD)\n              .build();\n        }\n} catch (Exception e) {\n      LOGGER.error(\"ERROR: StudyMetaDataService - getAppVersionInfo()\", e);\n      return Response.status(Response.Status.INTERNAL_SERVER_ERROR)\n          .entity(StudyMetaDataConstants.FAILURE)\n          .build();\n    }", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/454#discussion_r435931572", "createdAt": "2020-06-05T13:46:15Z", "author": {"login": "zohrehj"}, "path": "WCP-WS/src/main/java/com/hphc/mystudies/service/StudyMetaDataService.java", "diffHunk": "@@ -968,10 +931,39 @@ public Object study(\n   @Produces(MediaType.APPLICATION_JSON)\n   @Consumes(MediaType.APPLICATION_JSON)\n   @Path(\"versionInfo\")\n-  public Object getAppVersionInfo() {\n+  public Object getAppVersionInfo(\n+      @HeaderParam(\"applicationId\") String appId,\n+      @HeaderParam(\"orgId\") String orgId,\n+      @Context HttpServletResponse response) {\n     AppVersionInfoBean appVersionInfoBean = null;\n     LOGGER.info(\"INFO: StudyMetaDataService - getAppVersionInfo() :: Starts\");\n-    appVersionInfoBean = appMetaDataOrchestration.getAppVersionInfo();\n+    try {\n+      if (StringUtils.isNotEmpty(appId) && StringUtils.isNotEmpty(orgId)) {\n+        appVersionInfoBean = appMetaDataOrchestration.getAppVersionInfo(appId, orgId);\n+        if (appVersionInfoBean == null) {\n+          StudyMetaDataUtil.getFailureResponse(\n+              ErrorCodes.STATUS_103, ErrorCodes.NO_DATA, StudyMetaDataConstants.FAILURE, response);\n+          return Response.status(Response.Status.NOT_FOUND)\n+              .entity(StudyMetaDataConstants.NO_RECORD)\n+              .build();\n+        }\n+      } else {\n+        StudyMetaDataUtil.getFailureResponse(\n+            ErrorCodes.STATUS_102,\n+            ErrorCodes.UNKNOWN,\n+            StudyMetaDataConstants.INVALID_INPUT_ERROR_MSG,\n+            response);\n+        return Response.status(Response.Status.NOT_FOUND)\n+            .entity(StudyMetaDataConstants.INVALID_INPUT)\n+            .build();\n+      }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1bfb6a88f7c8f070dce97483f940f49f568c954a"}, "originalPosition": 82}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQ3NjU3NA==", "bodyText": "Done the changes as suggested.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/454#discussion_r436476574", "createdAt": "2020-06-08T06:17:30Z", "author": {"login": "aswinijena100"}, "path": "WCP-WS/src/main/java/com/hphc/mystudies/service/StudyMetaDataService.java", "diffHunk": "@@ -968,10 +931,39 @@ public Object study(\n   @Produces(MediaType.APPLICATION_JSON)\n   @Consumes(MediaType.APPLICATION_JSON)\n   @Path(\"versionInfo\")\n-  public Object getAppVersionInfo() {\n+  public Object getAppVersionInfo(\n+      @HeaderParam(\"applicationId\") String appId,\n+      @HeaderParam(\"orgId\") String orgId,\n+      @Context HttpServletResponse response) {\n     AppVersionInfoBean appVersionInfoBean = null;\n     LOGGER.info(\"INFO: StudyMetaDataService - getAppVersionInfo() :: Starts\");\n-    appVersionInfoBean = appMetaDataOrchestration.getAppVersionInfo();\n+    try {\n+      if (StringUtils.isNotEmpty(appId) && StringUtils.isNotEmpty(orgId)) {\n+        appVersionInfoBean = appMetaDataOrchestration.getAppVersionInfo(appId, orgId);\n+        if (appVersionInfoBean == null) {\n+          StudyMetaDataUtil.getFailureResponse(\n+              ErrorCodes.STATUS_103, ErrorCodes.NO_DATA, StudyMetaDataConstants.FAILURE, response);\n+          return Response.status(Response.Status.NOT_FOUND)\n+              .entity(StudyMetaDataConstants.NO_RECORD)\n+              .build();\n+        }\n+      } else {\n+        StudyMetaDataUtil.getFailureResponse(\n+            ErrorCodes.STATUS_102,\n+            ErrorCodes.UNKNOWN,\n+            StudyMetaDataConstants.INVALID_INPUT_ERROR_MSG,\n+            response);\n+        return Response.status(Response.Status.NOT_FOUND)\n+            .entity(StudyMetaDataConstants.INVALID_INPUT)\n+            .build();\n+      }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTkzMTU3Mg=="}, "originalCommit": {"oid": "1bfb6a88f7c8f070dce97483f940f49f568c954a"}, "originalPosition": 82}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2371, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}