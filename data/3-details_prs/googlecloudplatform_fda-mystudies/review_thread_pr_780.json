{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcwODE0OTM2", "number": 780, "reviewThreads": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQxMDoyNjowNlrOEadeIQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxNDo0MDo0N1rOEeVhfA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk2MTgxMjgxOnYy", "diffSide": "RIGHT", "path": "user-registration-server-ws/consent-mgmt-module/consent-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/common/ConsentAuditHelper.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQxMDoyNjowNlrOHD6DyQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQxMDoyNjowNlrOHD6DyQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mzg1OTAxNw==", "bodyText": "[consent-mgmt Checks] reported by reviewdog \ud83d\udc36\nMissing a Javadoc comment.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/780#discussion_r473859017", "createdAt": "2020-08-20T10:26:06Z", "author": {"login": "github-actions"}, "path": "user-registration-server-ws/consent-mgmt-module/consent-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/common/ConsentAuditHelper.java", "diffHunk": "@@ -0,0 +1,33 @@\n+package com.google.cloud.healthcare.fdamystudies.common;\n+\n+import com.google.cloud.healthcare.fdamystudies.beans.AuditLogEventRequest;\n+import com.google.cloud.healthcare.fdamystudies.mapper.AuditEventMapper;\n+import com.google.cloud.healthcare.fdamystudies.service.AuditEventService;\n+import java.util.Map;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.stereotype.Component;\n+\n+@Component\n+public class ConsentAuditHelper {\n+\n+  @Autowired AuditEventService auditService;\n+\n+  @Autowired private CommonApplicationPropertyConfig commonPropConfig;\n+\n+  public void logEvent(AuditLogEvent eventEnum, AuditLogEventRequest auditRequest) {\n+    logEvent(eventEnum, auditRequest, null);\n+  }\n+\n+  public void logEvent(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "679804f525adfdc04eb8decd34a0451178c406f5"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk2MTgxMjgzOnYy", "diffSide": "RIGHT", "path": "user-registration-server-ws/consent-mgmt-module/consent-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/common/ConsentManagementEnum.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMFQxMDoyNjowNlrOHD6DzQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yM1QxNTo0MzoxNFrOHFN-nA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mzg1OTAyMQ==", "bodyText": "[consent-mgmt Checks] reported by reviewdog \ud83d\udc36\nLine is longer than 100 characters (found 146).", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/780#discussion_r473859021", "createdAt": "2020-08-20T10:26:06Z", "author": {"login": "github-actions"}, "path": "user-registration-server-ws/consent-mgmt-module/consent-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/common/ConsentManagementEnum.java", "diffHunk": "@@ -0,0 +1,78 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.common;\n+\n+import static com.google.cloud.healthcare.fdamystudies.common.PlatformComponent.MOBILE_APPS;\n+import static com.google.cloud.healthcare.fdamystudies.common.PlatformComponent.PARTICIPANT_DATASTORE;\n+\n+import java.util.Optional;\n+import lombok.Getter;\n+\n+@Getter\n+public enum ConsentManagementEnum implements AuditLogEvent {\n+  INFORMED_CONSENT_PROVIDED_FOR_STUDY(\n+      MOBILE_APPS,\n+      PARTICIPANT_DATASTORE,\n+      null,\n+      \"Informed consent provided by app user for the study (consent version: ${consent_version}, data-sharing consent: ${data_sharing_consent}).\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "679804f525adfdc04eb8decd34a0451178c406f5"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDI2MDg0OQ==", "bodyText": "+1 @monica-BTC split -> 2 lines", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/780#discussion_r474260849", "createdAt": "2020-08-20T20:42:30Z", "author": {"login": "saminguyen"}, "path": "user-registration-server-ws/consent-mgmt-module/consent-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/common/ConsentManagementEnum.java", "diffHunk": "@@ -0,0 +1,78 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.common;\n+\n+import static com.google.cloud.healthcare.fdamystudies.common.PlatformComponent.MOBILE_APPS;\n+import static com.google.cloud.healthcare.fdamystudies.common.PlatformComponent.PARTICIPANT_DATASTORE;\n+\n+import java.util.Optional;\n+import lombok.Getter;\n+\n+@Getter\n+public enum ConsentManagementEnum implements AuditLogEvent {\n+  INFORMED_CONSENT_PROVIDED_FOR_STUDY(\n+      MOBILE_APPS,\n+      PARTICIPANT_DATASTORE,\n+      null,\n+      \"Informed consent provided by app user for the study (consent version: ${consent_version}, data-sharing consent: ${data_sharing_consent}).\",", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mzg1OTAyMQ=="}, "originalCommit": {"oid": "679804f525adfdc04eb8decd34a0451178c406f5"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTIzMzk0OA==", "bodyText": "Splitted into 2 lines.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/780#discussion_r475233948", "createdAt": "2020-08-23T15:43:14Z", "author": {"login": "monica-BTC"}, "path": "user-registration-server-ws/consent-mgmt-module/consent-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/common/ConsentManagementEnum.java", "diffHunk": "@@ -0,0 +1,78 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.common;\n+\n+import static com.google.cloud.healthcare.fdamystudies.common.PlatformComponent.MOBILE_APPS;\n+import static com.google.cloud.healthcare.fdamystudies.common.PlatformComponent.PARTICIPANT_DATASTORE;\n+\n+import java.util.Optional;\n+import lombok.Getter;\n+\n+@Getter\n+public enum ConsentManagementEnum implements AuditLogEvent {\n+  INFORMED_CONSENT_PROVIDED_FOR_STUDY(\n+      MOBILE_APPS,\n+      PARTICIPANT_DATASTORE,\n+      null,\n+      \"Informed consent provided by app user for the study (consent version: ${consent_version}, data-sharing consent: ${data_sharing_consent}).\",", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mzg1OTAyMQ=="}, "originalCommit": {"oid": "679804f525adfdc04eb8decd34a0451178c406f5"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5NjA3NDkxOnYy", "diffSide": "RIGHT", "path": "user-registration-server-ws/consent-mgmt-module/consent-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/common/ConsentManagementEnum.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxMzowMToyNFrOHJD_8w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxMzowMToyNFrOHJD_8w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTI2NDc1NQ==", "bodyText": "[consent-mgmt Checks] reported by reviewdog \ud83d\udc36\nLine is longer than 100 characters (found 117).", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/780#discussion_r479264755", "createdAt": "2020-08-28T13:01:24Z", "author": {"login": "github-actions"}, "path": "user-registration-server-ws/consent-mgmt-module/consent-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/common/ConsentManagementEnum.java", "diffHunk": "@@ -0,0 +1,80 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.common;\n+\n+import static com.google.cloud.healthcare.fdamystudies.common.PlatformComponent.CLOUD_STORAGE;\n+import static com.google.cloud.healthcare.fdamystudies.common.PlatformComponent.MOBILE_APPS;\n+import static com.google.cloud.healthcare.fdamystudies.common.PlatformComponent.PARTICIPANT_DATASTORE;\n+\n+import java.util.Optional;\n+import lombok.Getter;\n+\n+@Getter\n+public enum ConsentManagementEnum implements AuditLogEvent {\n+  INFORMED_CONSENT_PROVIDED_FOR_STUDY(\n+      MOBILE_APPS,\n+      PARTICIPANT_DATASTORE,\n+      null,\n+      \"Informed consent provided by app user for the study (consent version: ${consent_version}, \"\n+          + \"data-sharing consent: ${data_sharing_consent}).\",\n+      \"INFORMED_CONSENT_PROVIDED_FOR_STUDY\"),\n+\n+  USER_ENROLLED_INTO_STUDY(\n+      MOBILE_APPS, PARTICIPANT_DATASTORE, null, null, \"USER_ENROLLED_INTO_STUDY\"),\n+\n+  STUDY_ENROLLMENT_FAILED(\n+      MOBILE_APPS, PARTICIPANT_DATASTORE, null, null, \"STUDY_ENROLLMENT_FAILED\"),\n+\n+  READ_OPERATION_SUCCEEDED_FOR_SIGNED_CONSENT_DOCUMENT(\n+      MOBILE_APPS,\n+      CLOUD_STORAGE,\n+      PARTICIPANT_DATASTORE,\n+      \"Participant's consent document (${file_name}) retrieved.\",\n+      \"READ_OPERATION_SUCCEEDED_FOR_SIGNED_CONSENT_DOCUMENT\"),\n+\n+  READ_OPERATION_FAILED_FOR_SIGNED_CONSENT_DOCUMENT(\n+      MOBILE_APPS,\n+      CLOUD_STORAGE,\n+      PARTICIPANT_DATASTORE,\n+      \"Attempt to retrieve participant's consent document failed.\",\n+      \"READ_OPERATION_FAILED_FOR_SIGNED_CONSENT_DOCUMENT\"),\n+\n+  SIGNED_CONSENT_DOCUMENT_SAVED(\n+      MOBILE_APPS,\n+      CLOUD_STORAGE,\n+      PARTICIPANT_DATASTORE,\n+      \"Consent document (${file_name}) for consent version ${consent_version} saved in directory ${directory_name}.\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c364b055c6c456ce375a48e6b3cb54b4d1127b51"}, "originalPosition": 52}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5NjA3NDkzOnYy", "diffSide": "RIGHT", "path": "user-registration-server-ws/consent-mgmt-module/consent-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/common/ConsentManagementEnum.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxMzowMToyNVrOHJD_9w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxMzowMToyNVrOHJD_9w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTI2NDc1OQ==", "bodyText": "[consent-mgmt Checks] reported by reviewdog \ud83d\udc36\nLine is longer than 100 characters (found 130).", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/780#discussion_r479264759", "createdAt": "2020-08-28T13:01:25Z", "author": {"login": "github-actions"}, "path": "user-registration-server-ws/consent-mgmt-module/consent-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/common/ConsentManagementEnum.java", "diffHunk": "@@ -0,0 +1,80 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.common;\n+\n+import static com.google.cloud.healthcare.fdamystudies.common.PlatformComponent.CLOUD_STORAGE;\n+import static com.google.cloud.healthcare.fdamystudies.common.PlatformComponent.MOBILE_APPS;\n+import static com.google.cloud.healthcare.fdamystudies.common.PlatformComponent.PARTICIPANT_DATASTORE;\n+\n+import java.util.Optional;\n+import lombok.Getter;\n+\n+@Getter\n+public enum ConsentManagementEnum implements AuditLogEvent {\n+  INFORMED_CONSENT_PROVIDED_FOR_STUDY(\n+      MOBILE_APPS,\n+      PARTICIPANT_DATASTORE,\n+      null,\n+      \"Informed consent provided by app user for the study (consent version: ${consent_version}, \"\n+          + \"data-sharing consent: ${data_sharing_consent}).\",\n+      \"INFORMED_CONSENT_PROVIDED_FOR_STUDY\"),\n+\n+  USER_ENROLLED_INTO_STUDY(\n+      MOBILE_APPS, PARTICIPANT_DATASTORE, null, null, \"USER_ENROLLED_INTO_STUDY\"),\n+\n+  STUDY_ENROLLMENT_FAILED(\n+      MOBILE_APPS, PARTICIPANT_DATASTORE, null, null, \"STUDY_ENROLLMENT_FAILED\"),\n+\n+  READ_OPERATION_SUCCEEDED_FOR_SIGNED_CONSENT_DOCUMENT(\n+      MOBILE_APPS,\n+      CLOUD_STORAGE,\n+      PARTICIPANT_DATASTORE,\n+      \"Participant's consent document (${file_name}) retrieved.\",\n+      \"READ_OPERATION_SUCCEEDED_FOR_SIGNED_CONSENT_DOCUMENT\"),\n+\n+  READ_OPERATION_FAILED_FOR_SIGNED_CONSENT_DOCUMENT(\n+      MOBILE_APPS,\n+      CLOUD_STORAGE,\n+      PARTICIPANT_DATASTORE,\n+      \"Attempt to retrieve participant's consent document failed.\",\n+      \"READ_OPERATION_FAILED_FOR_SIGNED_CONSENT_DOCUMENT\"),\n+\n+  SIGNED_CONSENT_DOCUMENT_SAVED(\n+      MOBILE_APPS,\n+      CLOUD_STORAGE,\n+      PARTICIPANT_DATASTORE,\n+      \"Consent document (${file_name}) for consent version ${consent_version} saved in directory ${directory_name}.\",\n+      \"SIGNED_CONSENT_DOCUMENT_SAVED\"),\n+\n+  SIGNED_CONSENT_DOCUMENT_SAVE_FAILED(\n+      MOBILE_APPS,\n+      CLOUD_STORAGE,\n+      PARTICIPANT_DATASTORE,\n+      \"Consent document (${file_name}) for consent version ${consent_version} could not be saved in directory ${directory_name}.\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c364b055c6c456ce375a48e6b3cb54b4d1127b51"}, "originalPosition": 59}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwMjQxMzY0OnYy", "diffSide": "RIGHT", "path": "common-modules/common-tests/src/main/java/com/google/cloud/healthcare/fdamystudies/common/BaseMockIT.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxNDozMTo0MFrOHJ7SPg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxNToxMTozOFrOHJ83GA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDE3MDU1OA==", "bodyText": "remove debug log", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/780#discussion_r480170558", "createdAt": "2020-08-31T14:31:40Z", "author": {"login": "zohrehj"}, "path": "common-modules/common-tests/src/main/java/com/google/cloud/healthcare/fdamystudies/common/BaseMockIT.java", "diffHunk": "@@ -224,7 +226,7 @@ protected void verifyAuditEventCall(AuditLogEvent... auditEvents) {\n \n     for (AuditLogEvent auditEvent : auditEvents) {\n       AuditLogEventRequest auditRequest = auditRequestByEventCode.get(auditEvent.getEventCode());\n-\n+      logger.debug(auditRequest.toString());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "713a80a1df77ba15ef3466267b30e70660a07f9b"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDE5NjM3Ng==", "bodyText": "Removed debug log.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/780#discussion_r480196376", "createdAt": "2020-08-31T15:11:38Z", "author": {"login": "monica-BTC"}, "path": "common-modules/common-tests/src/main/java/com/google/cloud/healthcare/fdamystudies/common/BaseMockIT.java", "diffHunk": "@@ -224,7 +226,7 @@ protected void verifyAuditEventCall(AuditLogEvent... auditEvents) {\n \n     for (AuditLogEvent auditEvent : auditEvents) {\n       AuditLogEventRequest auditRequest = auditRequestByEventCode.get(auditEvent.getEventCode());\n-\n+      logger.debug(auditRequest.toString());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDE3MDU1OA=="}, "originalCommit": {"oid": "713a80a1df77ba15ef3466267b30e70660a07f9b"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwMjQ0MzM1OnYy", "diffSide": "RIGHT", "path": "user-registration-server-ws/consent-mgmt-module/consent-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/controller/UserConsentManagementController.java", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxNDozODoxOFrOHJ7jcA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxNTozMTo0OFrOHJ9omQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDE3NDk2MA==", "bodyText": "nit: I would prefer if audit log call is called here and not bundled with saving to cloudstorage.\nIt would be more consistent with how it is called in other scenarios.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/780#discussion_r480174960", "createdAt": "2020-08-31T14:38:18Z", "author": {"login": "zohrehj"}, "path": "user-registration-server-ws/consent-mgmt-module/consent-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/controller/UserConsentManagementController.java", "diffHunk": "@@ -126,10 +149,9 @@ public String ping() {\n                           + \"_\"\n                           + new SimpleDateFormat(\"MMddyyyyHHmmss\").format(new Date())\n                           + \".pdf\";\n-                  String content = consentStatusBean.getConsent().getPdf();\n-                  String path = cloudStorageService.saveFile(fileName, content, underDirectory);\n-                  studyConsent.setPdfPath(path);\n-                  studyConsent.setPdfStorage(1);\n+\n+                  saveToCloudAndLogAudit(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "713a80a1df77ba15ef3466267b30e70660a07f9b"}, "originalPosition": 87}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDE5OTYyNw==", "bodyText": "Changed method name saveToCloudAndLogAudit() to saveDocumentToCloudStorage().", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/780#discussion_r480199627", "createdAt": "2020-08-31T15:16:39Z", "author": {"login": "monica-BTC"}, "path": "user-registration-server-ws/consent-mgmt-module/consent-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/controller/UserConsentManagementController.java", "diffHunk": "@@ -126,10 +149,9 @@ public String ping() {\n                           + \"_\"\n                           + new SimpleDateFormat(\"MMddyyyyHHmmss\").format(new Date())\n                           + \".pdf\";\n-                  String content = consentStatusBean.getConsent().getPdf();\n-                  String path = cloudStorageService.saveFile(fileName, content, underDirectory);\n-                  studyConsent.setPdfPath(path);\n-                  studyConsent.setPdfStorage(1);\n+\n+                  saveToCloudAndLogAudit(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDE3NDk2MA=="}, "originalCommit": {"oid": "713a80a1df77ba15ef3466267b30e70660a07f9b"}, "originalPosition": 87}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDIwOTA0OQ==", "bodyText": "My comment was about moving outside of the method, not about its name.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/780#discussion_r480209049", "createdAt": "2020-08-31T15:31:48Z", "author": {"login": "zohrehj"}, "path": "user-registration-server-ws/consent-mgmt-module/consent-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/controller/UserConsentManagementController.java", "diffHunk": "@@ -126,10 +149,9 @@ public String ping() {\n                           + \"_\"\n                           + new SimpleDateFormat(\"MMddyyyyHHmmss\").format(new Date())\n                           + \".pdf\";\n-                  String content = consentStatusBean.getConsent().getPdf();\n-                  String path = cloudStorageService.saveFile(fileName, content, underDirectory);\n-                  studyConsent.setPdfPath(path);\n-                  studyConsent.setPdfStorage(1);\n+\n+                  saveToCloudAndLogAudit(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDE3NDk2MA=="}, "originalCommit": {"oid": "713a80a1df77ba15ef3466267b30e70660a07f9b"}, "originalPosition": 87}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzAwMjQ1MzcyOnYy", "diffSide": "RIGHT", "path": "user-registration-server-ws/consent-mgmt-module/consent-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/controller/UserConsentManagementController.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxNDo0MDo0N1rOHJ7pmw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxNToxODo1NVrOHJ9JGQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDE3NjUzOQ==", "bodyText": "where is the success scenario audit log gets submitted?", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/780#discussion_r480176539", "createdAt": "2020-08-31T14:40:47Z", "author": {"login": "zohrehj"}, "path": "user-registration-server-ws/consent-mgmt-module/consent-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/controller/UserConsentManagementController.java", "diffHunk": "@@ -232,11 +280,16 @@ public String ping() {\n         studyInfoBean = userConsentManagementService.getStudyInfoId(studyId);\n         consentStudyResponseBean =\n             userConsentManagementService.getStudyConsentDetails(\n-                userId, studyInfoBean.getStudyInfoId(), consentVersion);\n-        if (consentStudyResponseBean != null) {\n+                userId, studyInfoBean.getStudyInfoId(), consentVersion, auditRequest);\n+        auditRequest.setUserId(userId);\n+        auditRequest.setStudyId(studyId);\n+\n+        if (consentStudyResponseBean.getConsent().getContent() != null) {\n           consentStudyResponseBean.setMessage(\n               MyStudiesUserRegUtil.ErrorCodes.SUCCESS.getValue().toLowerCase());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "713a80a1df77ba15ef3466267b30e70660a07f9b"}, "originalPosition": 184}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDIwMDk4NQ==", "bodyText": "In UserConsentManagementServiceImpl class, READ_OPERATION_SUCCEEDED_FOR_SIGNED_CONSENT_DOCUMENT audit log event gets submitted for success scenario.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/780#discussion_r480200985", "createdAt": "2020-08-31T15:18:55Z", "author": {"login": "monica-BTC"}, "path": "user-registration-server-ws/consent-mgmt-module/consent-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/controller/UserConsentManagementController.java", "diffHunk": "@@ -232,11 +280,16 @@ public String ping() {\n         studyInfoBean = userConsentManagementService.getStudyInfoId(studyId);\n         consentStudyResponseBean =\n             userConsentManagementService.getStudyConsentDetails(\n-                userId, studyInfoBean.getStudyInfoId(), consentVersion);\n-        if (consentStudyResponseBean != null) {\n+                userId, studyInfoBean.getStudyInfoId(), consentVersion, auditRequest);\n+        auditRequest.setUserId(userId);\n+        auditRequest.setStudyId(studyId);\n+\n+        if (consentStudyResponseBean.getConsent().getContent() != null) {\n           consentStudyResponseBean.setMessage(\n               MyStudiesUserRegUtil.ErrorCodes.SUCCESS.getValue().toLowerCase());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDE3NjUzOQ=="}, "originalCommit": {"oid": "713a80a1df77ba15ef3466267b30e70660a07f9b"}, "originalPosition": 184}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2165, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}