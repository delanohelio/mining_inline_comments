{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTA2OTUwNzEx", "number": 1561, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQxOToyNjo1OVrOEwb7IA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQxOToyNjo1OVrOEwb7IA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzE5MjI0NjA4OnYy", "diffSide": "LEFT", "path": "participant-datastore/enroll-mgmt-module/enroll-mgmt/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/tests/StudyStateControllerTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yMVQxOToyNjo1OVrOHmAAVg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0yM1QxMTowNToyM1rOHnJOOg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTYwODAyMg==", "bodyText": "Why are all these checks being removed", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1561#discussion_r509608022", "createdAt": "2020-10-21T19:26:59Z", "author": {"login": "saminguyen"}, "path": "participant-datastore/enroll-mgmt-module/enroll-mgmt/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/tests/StudyStateControllerTest.java", "diffHunk": "@@ -273,40 +271,18 @@ public void withdrawFromStudySuccess() throws Exception {\n \n     verifyTokenIntrospectRequest();\n \n-    MvcResult result =\n-        mockMvc\n-            .perform(\n-                get(ApiEndpoint.STUDY_STATE_PATH.getPath())\n-                    .headers(headers)\n-                    .contextPath(getContextPath()))\n-            .andDo(print())\n-            .andExpect(status().isOk())\n-            .andReturn();\n+    mockMvc\n+        .perform(\n+            get(ApiEndpoint.STUDY_STATE_PATH.getPath())\n+                .headers(headers)\n+                .contextPath(getContextPath()))\n+        .andDo(print())\n+        .andExpect(status().isOk())\n+        .andExpect(jsonPath(\"$.studies[3].participantId\").isEmpty())\n+        .andExpect(jsonPath(\"$.studies[3].status\", is(EnrollmentStatus.WITHDRAWN.getStatus())))\n+        .andReturn();\n \n     verifyTokenIntrospectRequest(2);\n-\n-    StudyStateResponse response =\n-        getObjectMapper()\n-            .readValue(result.getResponse().getContentAsString(), StudyStateResponse.class);\n-    Optional<StudyStateBean> study =\n-        response\n-            .getStudies()\n-            .stream()\n-            .filter(s -> s.getParticipantId().equals(Constants.PARTICIPANT_ID))\n-            .findFirst();\n-\n-    Optional<ParticipantStudyEntity> participantStudy =\n-        participantStudyRepository.findByParticipantId(Constants.PARTICIPANT_ID);\n-\n-    Optional<ParticipantRegistrySiteEntity> optParticipantRegistrySite =\n-        participantRegistrySiteRepository.findById(\n-            participantStudy.get().getParticipantRegistrySite().getId());\n-\n-    assertTrue(study.isPresent());\n-    assertEquals(\n-        optParticipantRegistrySite.get().getOnboardingStatus(),\n-        OnboardingStatus.DISABLED.getCode());\n-    assertEquals(AppConstants.WITHDRAWN, study.get().getStatus());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7d9551ed7962a725b15ec5d1f55c333a701e3d59"}, "originalPosition": 89}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDgwNzYxMA==", "bodyText": "Hi Sami, Now we are making the participantId as null in withdrawal process. So due to this changes, all these checks will not work. Instead, JsonPath is used for assertation.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1561#discussion_r510807610", "createdAt": "2020-10-23T11:05:23Z", "author": {"login": "chiranjibi009"}, "path": "participant-datastore/enroll-mgmt-module/enroll-mgmt/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/tests/StudyStateControllerTest.java", "diffHunk": "@@ -273,40 +271,18 @@ public void withdrawFromStudySuccess() throws Exception {\n \n     verifyTokenIntrospectRequest();\n \n-    MvcResult result =\n-        mockMvc\n-            .perform(\n-                get(ApiEndpoint.STUDY_STATE_PATH.getPath())\n-                    .headers(headers)\n-                    .contextPath(getContextPath()))\n-            .andDo(print())\n-            .andExpect(status().isOk())\n-            .andReturn();\n+    mockMvc\n+        .perform(\n+            get(ApiEndpoint.STUDY_STATE_PATH.getPath())\n+                .headers(headers)\n+                .contextPath(getContextPath()))\n+        .andDo(print())\n+        .andExpect(status().isOk())\n+        .andExpect(jsonPath(\"$.studies[3].participantId\").isEmpty())\n+        .andExpect(jsonPath(\"$.studies[3].status\", is(EnrollmentStatus.WITHDRAWN.getStatus())))\n+        .andReturn();\n \n     verifyTokenIntrospectRequest(2);\n-\n-    StudyStateResponse response =\n-        getObjectMapper()\n-            .readValue(result.getResponse().getContentAsString(), StudyStateResponse.class);\n-    Optional<StudyStateBean> study =\n-        response\n-            .getStudies()\n-            .stream()\n-            .filter(s -> s.getParticipantId().equals(Constants.PARTICIPANT_ID))\n-            .findFirst();\n-\n-    Optional<ParticipantStudyEntity> participantStudy =\n-        participantStudyRepository.findByParticipantId(Constants.PARTICIPANT_ID);\n-\n-    Optional<ParticipantRegistrySiteEntity> optParticipantRegistrySite =\n-        participantRegistrySiteRepository.findById(\n-            participantStudy.get().getParticipantRegistrySite().getId());\n-\n-    assertTrue(study.isPresent());\n-    assertEquals(\n-        optParticipantRegistrySite.get().getOnboardingStatus(),\n-        OnboardingStatus.DISABLED.getCode());\n-    assertEquals(AppConstants.WITHDRAWN, study.get().getStatus());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTYwODAyMg=="}, "originalCommit": {"oid": "7d9551ed7962a725b15ec5d1f55c333a701e3d59"}, "originalPosition": 89}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1699, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}