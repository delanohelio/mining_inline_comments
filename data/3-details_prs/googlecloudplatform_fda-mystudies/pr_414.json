{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDIxNDk4NjU3", "number": 414, "title": "Fix storing dashboard data back to DB on new session.", "bodyText": "Fixes #413.", "createdAt": "2020-05-21T18:08:55Z", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/414", "merged": true, "mergeCommit": {"oid": "0c11eb507676aedb75bc1097ac7153980309c68a"}, "closed": true, "closedAt": "2020-05-28T13:17:11Z", "author": {"login": "tushar-boston"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcjhoLXgH2gAyNDIxNDk4NjU3OjA1MjdkMzQ1ZTFmNGJhOTY4ZDRjYjY3ZWU1YjBhZGE5OWY1NjQ3M2Y=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcltpmngH2gAyNDIxNDk4NjU3OmZjMzQ3MmYxZmJkNzFlOWJkMjVhNjJhZGI0NTIwMzdmZjlkZjBjOTE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "0527d345e1f4ba968d4cb67ee5b0ada99f56473f", "author": {"user": {"login": "tushar-boston", "name": "Tushar Katyal"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/0527d345e1f4ba968d4cb67ee5b0ada99f56473f", "committedDate": "2020-05-21T18:04:11Z", "message": "Fix storing dashboard data back to DB on new session."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE2Mzk0Njc2", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/414#pullrequestreview-416394676", "createdAt": "2020-05-21T18:37:04Z", "commit": {"oid": "0527d345e1f4ba968d4cb67ee5b0ada99f56473f"}, "state": "COMMENTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQxODozNzowNFrOGY-Reg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0yMVQxOTozMjowNVrOGY__6w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODgzOTI5MA==", "bodyText": "why is \"labkeyresponse\" text is needed?\nincidentally, I would prefer if we remove the work labkey entirely from the code, since it is accurate anymore.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/414#discussion_r428839290", "createdAt": "2020-05-21T18:37:04Z", "author": {"login": "zohrehj"}, "path": "iOS/HPHC/HPHC/Views/UIViews+Additions/Activity/ActivitySchedule/ActivitySchedules.swift", "diffHunk": "@@ -228,29 +228,30 @@ class ResponseDataFetch: NMWebServiceDelegate {\n           let count = (value[\"count\"] as? Float)!\n           let dateString = value[\"date\"] as? String ?? \"\"\n           // SetData Format\n-          if let date = ResponseDataFetch.responseDateFormatter.date(from: dateString) {\n-            let localDateAsString = ResponseDataFetch.localDateFormatter.string(from: date)\n-            if let localDate = ResponseDataFetch.localDateFormatter.date(\n-              from: localDateAsString\n-            ) {\n-              // Save Stats to DB\n-              DBHandler.saveStatisticsDataFor(\n-                activityId: activityId!,\n-                key: key!,\n-                data: responseValue,\n-                fkDuration: Int(count),\n-                date: localDate\n-              )\n-            }\n+          if let date = ResponseDataFetch.responseDateFormatter.date(from: dateString),\n+            let key = key,\n+            let activityID = activityId\n+          {\n+            // Save Stats to DB\n+            DBHandler.saveStatisticsDataFor(\n+              activityId: activityID,\n+              key: key,\n+              data: responseValue,\n+              fkDuration: Int(count),\n+              date: date\n+            )\n           }\n         }\n       }\n-      let key = \"LabKeyResponse\" + (Study.currentStudy?.studyId)!\n+    }\n+\n+    if let studyID = Study.currentStudy?.studyId {\n+      let key = \"LabKeyResponse\" + studyID", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0527d345e1f4ba968d4cb67ee5b0ada99f56473f"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODg0MTAzMQ==", "bodyText": "what happens if the casting fails? it doesn't look like the case is handled.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/414#discussion_r428841031", "createdAt": "2020-05-21T18:40:23Z", "author": {"login": "zohrehj"}, "path": "iOS/HPHC/HPHC/Views/UIViews+Additions/Activity/ActivitySchedule/ActivitySchedules.swift", "diffHunk": "@@ -228,29 +228,30 @@ class ResponseDataFetch: NMWebServiceDelegate {\n           let count = (value[\"count\"] as? Float)!\n           let dateString = value[\"date\"] as? String ?? \"\"\n           // SetData Format\n-          if let date = ResponseDataFetch.responseDateFormatter.date(from: dateString) {\n-            let localDateAsString = ResponseDataFetch.localDateFormatter.string(from: date)\n-            if let localDate = ResponseDataFetch.localDateFormatter.date(\n-              from: localDateAsString\n-            ) {\n-              // Save Stats to DB\n-              DBHandler.saveStatisticsDataFor(\n-                activityId: activityId!,\n-                key: key!,\n-                data: responseValue,\n-                fkDuration: Int(count),\n-                date: localDate\n-              )\n-            }\n+          if let date = ResponseDataFetch.responseDateFormatter.date(from: dateString),\n+            let key = key,\n+            let activityID = activityId\n+          {\n+            // Save Stats to DB\n+            DBHandler.saveStatisticsDataFor(\n+              activityId: activityID,\n+              key: key,\n+              data: responseValue,\n+              fkDuration: Int(count),\n+              date: date\n+            )\n           }\n         }\n       }\n-      let key = \"LabKeyResponse\" + (Study.currentStudy?.studyId)!\n+    }\n+\n+    if let studyID = Study.currentStudy?.studyId {\n+      let key = \"LabKeyResponse\" + studyID\n       UserDefaults.standard.set(true, forKey: key)\n+    }\n \n-      let appDelegate = (UIApplication.shared.delegate as? AppDelegate)!\n+    if let appDelegate = UIApplication.shared.delegate as? AppDelegate {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0527d345e1f4ba968d4cb67ee5b0ada99f56473f"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODg0MTUyMw==", "bodyText": "if it's not an expected case, maybe use as! instead?", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/414#discussion_r428841523", "createdAt": "2020-05-21T18:41:24Z", "author": {"login": "zohrehj"}, "path": "iOS/HPHC/HPHC/Views/UIViews+Additions/Activity/ActivitySchedule/ActivitySchedules.swift", "diffHunk": "@@ -228,29 +228,30 @@ class ResponseDataFetch: NMWebServiceDelegate {\n           let count = (value[\"count\"] as? Float)!\n           let dateString = value[\"date\"] as? String ?? \"\"\n           // SetData Format\n-          if let date = ResponseDataFetch.responseDateFormatter.date(from: dateString) {\n-            let localDateAsString = ResponseDataFetch.localDateFormatter.string(from: date)\n-            if let localDate = ResponseDataFetch.localDateFormatter.date(\n-              from: localDateAsString\n-            ) {\n-              // Save Stats to DB\n-              DBHandler.saveStatisticsDataFor(\n-                activityId: activityId!,\n-                key: key!,\n-                data: responseValue,\n-                fkDuration: Int(count),\n-                date: localDate\n-              )\n-            }\n+          if let date = ResponseDataFetch.responseDateFormatter.date(from: dateString),\n+            let key = key,\n+            let activityID = activityId\n+          {\n+            // Save Stats to DB\n+            DBHandler.saveStatisticsDataFor(\n+              activityId: activityID,\n+              key: key,\n+              data: responseValue,\n+              fkDuration: Int(count),\n+              date: date\n+            )\n           }\n         }\n       }\n-      let key = \"LabKeyResponse\" + (Study.currentStudy?.studyId)!\n+    }\n+\n+    if let studyID = Study.currentStudy?.studyId {\n+      let key = \"LabKeyResponse\" + studyID\n       UserDefaults.standard.set(true, forKey: key)\n+    }\n \n-      let appDelegate = (UIApplication.shared.delegate as? AppDelegate)!\n+    if let appDelegate = UIApplication.shared.delegate as? AppDelegate {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODg0MTAzMQ=="}, "originalCommit": {"oid": "0527d345e1f4ba968d4cb67ee5b0ada99f56473f"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODg1MDUzMg==", "bodyText": "why are you removing the unwrapping of activityID and key?", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/414#discussion_r428850532", "createdAt": "2020-05-21T18:58:20Z", "author": {"login": "zohrehj"}, "path": "iOS/HPHC/HPHC/Views/UIViews+Additions/Activity/ActivitySchedule/ActivitySchedules.swift", "diffHunk": "@@ -228,29 +228,30 @@ class ResponseDataFetch: NMWebServiceDelegate {\n           let count = (value[\"count\"] as? Float)!\n           let dateString = value[\"date\"] as? String ?? \"\"\n           // SetData Format\n-          if let date = ResponseDataFetch.responseDateFormatter.date(from: dateString) {\n-            let localDateAsString = ResponseDataFetch.localDateFormatter.string(from: date)\n-            if let localDate = ResponseDataFetch.localDateFormatter.date(\n-              from: localDateAsString\n-            ) {\n-              // Save Stats to DB\n-              DBHandler.saveStatisticsDataFor(\n-                activityId: activityId!,\n-                key: key!,\n-                data: responseValue,\n-                fkDuration: Int(count),\n-                date: localDate\n-              )\n-            }\n+          if let date = ResponseDataFetch.responseDateFormatter.date(from: dateString),\n+            let key = key,\n+            let activityID = activityId\n+          {\n+            // Save Stats to DB\n+            DBHandler.saveStatisticsDataFor(\n+              activityId: activityID,\n+              key: key,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0527d345e1f4ba968d4cb67ee5b0ada99f56473f"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODg2NzU2Mw==", "bodyText": "this code is deeply nested and very complex, please consider refactoring it into smaller methods.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/414#discussion_r428867563", "createdAt": "2020-05-21T19:32:05Z", "author": {"login": "zohrehj"}, "path": "iOS/HPHC/HPHC/Networking/APIs/ResponseServices.swift", "diffHunk": "@@ -371,28 +359,28 @@ class ResponseServices: NSObject {\n             }\n \n           } else {\n-            for responseData in dashBoardResponse {\n-\n-              if let keyValue = data[responseData.key!] as? [String: Any] {\n-\n-                if Utilities.isValidValue(\n-                  someObject: keyValue[\"value\"] as AnyObject?\n-                ) {\n-                  var value: Float = 0.0\n-                  if let n = keyValue[\"value\"] as? NSNumber {\n-                    value = n.floatValue\n-                  }\n-                  let valueDetail =\n-                    [\n-                      \"value\": value,\n-                      \"count\": Float(0.0),\n-                      \"date\": date,\n-                    ] as [String: Any]\n-\n-                  responseData.values.append(valueDetail)\n-                }\n+            for (index, dict) in dataDictArr.enumerated() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0527d345e1f4ba968d4cb67ee5b0ada99f56473f"}, "originalPosition": 43}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "78d1e6540e10b6e39a5d8b57a9f4c1ab6bbc5171", "author": {"user": {"login": "tushar-boston", "name": "Tushar Katyal"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/78d1e6540e10b6e39a5d8b57a9f4c1ab6bbc5171", "committedDate": "2020-05-22T16:31:09Z", "message": "Refactor DashboardResponse."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4d72a1fdf33c9cd198d0396553de5e9728fa1ad6", "author": {"user": {"login": "tushar-boston", "name": "Tushar Katyal"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/4d72a1fdf33c9cd198d0396553de5e9728fa1ad6", "committedDate": "2020-05-22T16:31:49Z", "message": "Update StudyDashboard copyrights."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "606d4113c013fe9e204b89de38770dec58f4c658", "author": {"user": {"login": "tushar-boston", "name": "Tushar Katyal"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/606d4113c013fe9e204b89de38770dec58f4c658", "committedDate": "2020-05-22T16:39:50Z", "message": "Merge branch 'early-access' into ios-dashboard-response-patch"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE3NzM5OTkz", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/414#pullrequestreview-417739993", "createdAt": "2020-05-25T14:16:32Z", "commit": {"oid": "606d4113c013fe9e204b89de38770dec58f4c658"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4304e0562689c188f2860bb9ccf91120fcd06c44", "author": {"user": {"login": "tushar-boston", "name": "Tushar Katyal"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/4304e0562689c188f2860bb9ccf91120fcd06c44", "committedDate": "2020-05-26T08:07:09Z", "message": "Fix init."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fc3472f1fbd71e9bd25a62adb452037ff9df0c91", "author": {"user": {"login": "tushar-boston", "name": "Tushar Katyal"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/fc3472f1fbd71e9bd25a62adb452037ff9df0c91", "committedDate": "2020-05-28T13:12:27Z", "message": "Merge branch 'early-access' into ios-dashboard-response-patch"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1080, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}