{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQyNjY3NjM3", "number": 586, "title": "PUT /v1/user/reset_password implementation with integration tests", "bodyText": "PUT /v1/user/reset_password implementation with integration tests", "createdAt": "2020-07-01T12:30:04Z", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/586", "merged": true, "mergeCommit": {"oid": "812744390dc9e4339f2e301b4e978d3251932713"}, "closed": true, "closedAt": "2020-07-28T14:20:45Z", "author": {"login": "dhanyak-btc"}, "timelineItems": {"totalCount": 26, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcwpaeEAH2gAyNDQyNjY3NjM3OmZkMDNiMWFmODEwMDA3ZjE2ZmUzNTY0YTdiYTRkZTNlZmU4ODc3OWM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc5XCr9gH2gAyNDQyNjY3NjM3OmU2ZDJlZmE2NWZhMzM0YjUwNzBmYmQzYmRkM2I5NzkwMTUzYThjMGY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "fd03b1af810007f16fe3564a7ba4de3efe88779c", "author": {"user": {"login": "dhanyak-btc", "name": "Dhanya Kumar KV"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/fd03b1af810007f16fe3564a7ba4de3efe88779c", "committedDate": "2020-07-01T12:29:28Z", "message": "PUT /v1/user/reset_password implementation with integration tests\n\nPUT /v1/user/reset_password implementation with integration tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "61c1378165962b37a0438356a117c4f1bc8c5fbf", "author": {"user": {"login": "dhanyak-btc", "name": "Dhanya Kumar KV"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/61c1378165962b37a0438356a117c4f1bc8c5fbf", "committedDate": "2020-07-01T12:41:00Z", "message": "Corrected @Order for shouldDeleteTheUser() test\n\nCorrected @Order for shouldDeleteTheUser() test"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQzMDk3NjIw", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/586#pullrequestreview-443097620", "createdAt": "2020-07-06T13:55:19Z", "commit": {"oid": "61c1378165962b37a0438356a117c4f1bc8c5fbf"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxMzo1NToxOVrOGtYTKQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNlQxNjowMTowOVrOGtdjfQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDIzNzIyNQ==", "bodyText": "This should be a POST. PUT is used to set the state on the server, whereas this API requests a server action (sending an email).", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/586#discussion_r450237225", "createdAt": "2020-07-06T13:55:19Z", "author": {"login": "nikklassen"}, "path": "oauth-scim-module/oauth-scim-service/src/main/java/com/google/cloud/healthcare/fdamystudies/oauthscim/controller/UserController.java", "diffHunk": "@@ -81,7 +87,31 @@\n             ? HttpStatus.OK.value()\n             : userResponse.getHttpStatusCode();\n \n-    logger.exit(String.format(\"status=%d\", status));\n+    logger.exit(String.format(STATUS_LOG, status));\n+    return ResponseEntity.status(status).body(userResponse);\n+  }\n+\n+  @PutMapping(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61c1378165962b37a0438356a117c4f1bc8c5fbf"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDIzOTMyMw==", "bodyText": "If userResponse has a status code you should always be using that instead of setting the OK case yourself.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/586#discussion_r450239323", "createdAt": "2020-07-06T13:58:16Z", "author": {"login": "nikklassen"}, "path": "oauth-scim-module/oauth-scim-service/src/main/java/com/google/cloud/healthcare/fdamystudies/oauthscim/controller/UserController.java", "diffHunk": "@@ -81,7 +87,31 @@\n             ? HttpStatus.OK.value()\n             : userResponse.getHttpStatusCode();\n \n-    logger.exit(String.format(\"status=%d\", status));\n+    logger.exit(String.format(STATUS_LOG, status));\n+    return ResponseEntity.status(status).body(userResponse);\n+  }\n+\n+  @PutMapping(\n+      value = \"/user/reset_password\",\n+      produces = MediaType.APPLICATION_JSON_VALUE,\n+      consumes = MediaType.APPLICATION_JSON_VALUE)\n+  public ResponseEntity<?> resetPassword(\n+      @Valid @RequestBody UpdateUserRequest userRequest, HttpServletRequest request)\n+      throws JsonProcessingException {\n+    logger.entry(String.format(BEGIN_S_REQUEST_LOG, request.getRequestURI()));\n+    ValidationErrorResponse validationResult = UserValidator.validate(userRequest);\n+    if (validationResult.hasErrors()) {\n+      logger.exit(String.format(VALIDATION_ERROS_LOG, validationResult));\n+      return ResponseEntity.status(HttpStatus.BAD_REQUEST).body(validationResult);\n+    }\n+\n+    UpdateUserResponse userResponse = userService.resetPassword(userRequest);\n+    int status =\n+        StringUtils.isEmpty(userResponse.getErrorDescription())\n+            ? HttpStatus.OK.value()\n+            : userResponse.getHttpStatusCode();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61c1378165962b37a0438356a117c4f1bc8c5fbf"}, "originalPosition": 72}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDMyMDQ3OQ==", "bodyText": "Please invert this condition", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/586#discussion_r450320479", "createdAt": "2020-07-06T15:56:30Z", "author": {"login": "nikklassen"}, "path": "oauth-scim-module/oauth-scim-service/src/main/java/com/google/cloud/healthcare/fdamystudies/oauthscim/service/UserServiceImpl.java", "diffHunk": "@@ -109,13 +119,61 @@ private void setPasswordAndPasswordHistoryFields(String password, ObjectNode use\n   public UpdateUserResponse updateUser(UpdateUserRequest userRequest)\n       throws JsonProcessingException {\n     logger.entry(String.format(\"begin updateUser() for %s action\", userRequest.getAction()));\n-    if (\"change_password\".equalsIgnoreCase(userRequest.getAction())) {\n+    if (CHANGE_PASSWORD.equalsIgnoreCase(userRequest.getAction())) {\n       return changePassword(userRequest);\n     }\n \n     return new UpdateUserResponse(ErrorCode.APPLICATION_ERROR);\n   }\n \n+  public UpdateUserResponse resetPassword(UpdateUserRequest userRequest)\n+      throws JsonProcessingException {\n+    logger.entry(\"begin resetPassword()\");\n+    Optional<UserEntity> entity =\n+        repository.findByAppIdAndOrgIdAndEmail(\n+            userRequest.getAppId(), userRequest.getOrgId(), userRequest.getEmail());\n+    if (entity.isPresent()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61c1378165962b37a0438356a117c4f1bc8c5fbf"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDMyMjA5Nw==", "bodyText": "We shouldn't be using the same request for two different actions. I would prefer different request types so that this validation can be done with annotations.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/586#discussion_r450322097", "createdAt": "2020-07-06T15:59:14Z", "author": {"login": "nikklassen"}, "path": "oauth-scim-module/oauth-scim-service/src/main/java/com/google/cloud/healthcare/fdamystudies/oauthscim/validator/UserValidator.java", "diffHunk": "@@ -48,6 +49,19 @@ public static ValidationErrorResponse validate(UpdateUserRequest request) {\n       }\n     }\n \n+    // validate fields required for forgot password action\n+    if (FORGOT_PASSWORD.equalsIgnoreCase(request.getAction())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61c1378165962b37a0438356a117c4f1bc8c5fbf"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDMyMzMyNQ==", "bodyText": "This matches the local props file? You definitely don't want to be committing passwords to version control.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/586#discussion_r450323325", "createdAt": "2020-07-06T16:01:09Z", "author": {"login": "nikklassen"}, "path": "common-modules/common-tests/src/main/resources/application-mockit-common.properties", "diffHunk": "@@ -26,4 +26,17 @@ logging.level.org.hibernate.stat=ERROR\n \n # oauth configuration\n security.oauth2.health_endpoint=http://localhost:8080/oauth-scim-service/v1/health\n-security.oauth2.introspection_endpoint=http://localhost:8080/oauth-scim-service/v1/oauth2/introspect\n\\ No newline at end of file\n+security.oauth2.introspection_endpoint=http://localhost:8080/oauth-scim-service/v1/oauth2/introspect\n+\n+# mail smtp configs\n+spring.mail.default-encoding=UTF-8\n+spring.mail.host=smtp.gmail.com\n+spring.mail.username=apps@boston-technology.com\n+spring.mail.password=Btc@app@123", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "61c1378165962b37a0438356a117c4f1bc8c5fbf"}, "originalPosition": 12}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d6ae44e016bb434316937d68aecbccc4e5f05fcd", "author": {"user": {"login": "dhanyak-btc", "name": "Dhanya Kumar KV"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/d6ae44e016bb434316937d68aecbccc4e5f05fcd", "committedDate": "2020-07-07T09:38:48Z", "message": "Fixed PR#586 review comments\n\n1. Used @PostMapping for /v1/user/reset_password\n2. Added MessageCode enum for success messages and refactored the code\n3. Refactored the code for ResetPasswordRequest and ResetPasswordResponse\n4. Removed email credentials from property files and added AppConfigTest to mock the JavaMailSender bean."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8601a046cd8feb812c33c1f1edbe988b50b1e789", "author": {"user": {"login": "dhanyak-btc", "name": "Dhanya Kumar KV"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/8601a046cd8feb812c33c1f1edbe988b50b1e789", "committedDate": "2020-07-07T11:46:27Z", "message": "Added verify for mock JavaMailSender object\n\nAdded verify for mock JavaMailSender object"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "52bad23f33335e3e60dae37417069aa7feb5cb08", "author": {"user": {"login": "dhanyak-btc", "name": "Dhanya Kumar KV"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/52bad23f33335e3e60dae37417069aa7feb5cb08", "committedDate": "2020-07-07T12:40:39Z", "message": "Mock Verify for JavaMailSender - replaced atLeast() with times()\n\nMock Verify for JavaMailSender - replaced atLeast() with times()"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ0MTYxNjc2", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/586#pullrequestreview-444161676", "createdAt": "2020-07-07T18:50:49Z", "commit": {"oid": "52bad23f33335e3e60dae37417069aa7feb5cb08"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "18c0a8906cba9926dcbe8589816853160ebda62c", "author": {"user": {"login": "dhanyak-btc", "name": "Dhanya Kumar KV"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/18c0a8906cba9926dcbe8589816853160ebda62c", "committedDate": "2020-07-22T06:22:58Z", "message": "Merge branch 'develop' into oauth-scim-module-forgot-password"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "df1a072182ec4d80030296b8145b030191686068", "author": {"user": {"login": "dhanyak-btc", "name": "Dhanya Kumar KV"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/df1a072182ec4d80030296b8145b030191686068", "committedDate": "2020-07-22T06:23:32Z", "message": "Resolved conflicts\n\nResolved conflicts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b3b5f73af123481a0d2c6a4bf6b327ec66966fa", "author": {"user": {"login": "dhanyak-btc", "name": "Dhanya Kumar KV"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/4b3b5f73af123481a0d2c6a4bf6b327ec66966fa", "committedDate": "2020-07-22T06:55:43Z", "message": "Merge branch 'develop' into oauth-scim-module-forgot-password"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "566eb3f38ff2b27895118f59322f84846f94ad46", "author": {"user": {"login": "dhanyak-btc", "name": "Dhanya Kumar KV"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/566eb3f38ff2b27895118f59322f84846f94ad46", "committedDate": "2020-07-22T07:04:53Z", "message": "Resolve conflicts and fixed build issues\n\nResolve conflicts and fixed build issues"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e01245c3da90c4680f3dfd9349bf39937bf5c039", "author": {"user": {"login": "dhanyak-btc", "name": "Dhanya Kumar KV"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/e01245c3da90c4680f3dfd9349bf39937bf5c039", "committedDate": "2020-07-22T08:54:14Z", "message": "Renamed GlobalExceptionHandler to BaseController to fix build issue\n\nRenamed GlobalExceptionHandler to BaseController to fix build issue"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDUzNTE4NjI5", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/586#pullrequestreview-453518629", "createdAt": "2020-07-22T17:08:38Z", "commit": {"oid": "e01245c3da90c4680f3dfd9349bf39937bf5c039"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bb52cff2d45d95f1e20b1326c99d32bd1eb12358", "author": {"user": {"login": "dhanyak-btc", "name": "Dhanya Kumar KV"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/bb52cff2d45d95f1e20b1326c99d32bd1eb12358", "committedDate": "2020-07-23T09:31:41Z", "message": "Renamed BaseController to GlobalExceptionHandler\n\nReplaced DigestUtils.sha3_512Hex(value); with DigestUtils.sha512Hex(value);\nRemoved BaseController class reference from audit-log-service and oauth-scim-service"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fd8beb27fb29c961780f491d8ae593c36d49d24a", "author": {"user": {"login": "dhanyak-btc", "name": "Dhanya Kumar KV"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/fd8beb27fb29c961780f491d8ae593c36d49d24a", "committedDate": "2020-07-23T09:34:27Z", "message": "Merge branch 'develop' into oauth-scim-module-forgot-password"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fa2f9e41903c70db448f1a1a156776c6794a7297", "author": {"user": {"login": "dhanyak-btc", "name": "Dhanya Kumar KV"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/fa2f9e41903c70db448f1a1a156776c6794a7297", "committedDate": "2020-07-23T11:12:01Z", "message": "Added @ComponentScan to BaseMockIT to fix build issue\n\nAdded @ComponentScan to BaseMockIT to fix build issue"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU0MTM1MjQ0", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/586#pullrequestreview-454135244", "createdAt": "2020-07-23T13:34:34Z", "commit": {"oid": "fa2f9e41903c70db448f1a1a156776c6794a7297"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "008cc971898b0fb411cb6d7ae2a6ea04dfe2a81d", "author": {"user": {"login": "dhanyak-btc", "name": "Dhanya Kumar KV"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/008cc971898b0fb411cb6d7ae2a6ea04dfe2a81d", "committedDate": "2020-07-23T13:45:42Z", "message": "Merge branch 'develop' into oauth-scim-module-forgot-password"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "587fc5eb1d289e76e82438f5e8840febdcce9823", "author": {"user": {"login": "nikklassen", "name": "Nik Klassen"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/587fc5eb1d289e76e82438f5e8840febdcce9823", "committedDate": "2020-07-23T17:08:24Z", "message": "Use @Import to include common module"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cd7b6bb0236e9049dfc08d27c1549563c6e757d4", "author": {"user": {"login": "nikklassen", "name": "Nik Klassen"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/cd7b6bb0236e9049dfc08d27c1549563c6e757d4", "committedDate": "2020-07-23T17:47:49Z", "message": "Fix audit-log dependency on common-tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fba857c10c1dff15f6e7199a03d271cb9c61a34c", "author": {"user": {"login": "nikklassen", "name": "Nik Klassen"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/fba857c10c1dff15f6e7199a03d271cb9c61a34c", "committedDate": "2020-07-23T17:53:47Z", "message": "Merge branch 'develop' into oauth-scim-module-forgot-password"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "484eeeb9bf7093a42887d9c96058d8020bab6b21", "author": {"user": {"login": "nikklassen", "name": "Nik Klassen"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/484eeeb9bf7093a42887d9c96058d8020bab6b21", "committedDate": "2020-07-24T13:35:00Z", "message": "Use checkout@v1"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "be5eb23d16bb10e2d1942015787f215fc42a0b36", "author": {"user": {"login": "dhanyak-btc", "name": "Dhanya Kumar KV"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/be5eb23d16bb10e2d1942015787f215fc42a0b36", "committedDate": "2020-07-28T05:20:21Z", "message": "Merge branch 'develop' into oauth-scim-module-forgot-password"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7a76d0a3203f498a23bf9cd920a63e0ef614cdcb", "author": {"user": {"login": "dhanyak-btc", "name": "Dhanya Kumar KV"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/7a76d0a3203f498a23bf9cd920a63e0ef614cdcb", "committedDate": "2020-07-28T09:38:07Z", "message": "Merge branch 'develop' into oauth-scim-module-forgot-password"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU2NjI1ODQ0", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/586#pullrequestreview-456625844", "createdAt": "2020-07-28T13:24:08Z", "commit": {"oid": "7a76d0a3203f498a23bf9cd920a63e0ef614cdcb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e6d2efa65fa334b5070fbd3bdd3b9790153a8c0f", "author": {"user": {"login": "dhanyak-btc", "name": "Dhanya Kumar KV"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/e6d2efa65fa334b5070fbd3bdd3b9790153a8c0f", "committedDate": "2020-07-28T14:10:31Z", "message": "Merge branch 'develop' into oauth-scim-module-forgot-password"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 780, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}