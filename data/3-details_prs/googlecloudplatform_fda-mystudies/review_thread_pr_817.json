{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc0MTI2MTE5", "number": 817, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxNjo1NTozM1rOEdTtXg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxNjo1NTozM1rOEdTtXg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk5MTY3MDcwOnYy", "diffSide": "LEFT", "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/service/AuditEventServiceImpl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxNjo1NTozM1rOHIZHuw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QyMToyMzowM1rOHIhvtQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODU2MjIzNQ==", "bodyText": "nit: you have  kept the logger.entry, but removed logger.exit. let's add them consistently.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/817#discussion_r478562235", "createdAt": "2020-08-27T16:55:33Z", "author": {"login": "zohrehj"}, "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/service/AuditEventServiceImpl.java", "diffHunk": "@@ -26,15 +30,26 @@\n \n   private XLogger logger = XLoggerFactory.getXLogger(AuditEventServiceImpl.class.getName());\n \n+  private static final String AUDIT_LOG_NAME = \"application-audit-log\";\n+\n   @Override\n   public void postAuditLogEvent(AuditLogEventRequest auditRequest) {\n     logger.entry(\n         String.format(\"begin postAuditLogEvent() for %s event\", auditRequest.getEventCode()));\n \n-    JsonNode requestBody = getObjectMapper().convertValue(auditRequest, JsonNode.class);\n+    Logging logging = LoggingOptions.getDefaultInstance().getService();\n+\n+    // The data to write to the log\n+    Map<String, Object> jsonPayloadMap = getObjectMapper().convertValue(auditRequest, Map.class);\n+\n+    LogEntry entry = LogEntry.newBuilder(Payload.JsonPayload.of(jsonPayloadMap))\n+            .setTimestamp(auditRequest.getOccured().getTime())\n+            .setSeverity(Severity.INFO)\n+            .setLogName(AUDIT_LOG_NAME)\n+            .setResource(MonitoredResource.newBuilder(\"global\").build())\n+            .build();\n \n-    // TODO (#703) integration with GCP stackdriver. Please remove the requestBody from below logger\n-    // statement during stackdriver integration as it may contain PII information.\n-    logger.exit(String.format(\"audit request=%s\", requestBody));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "75200bd87fcf378bb5862ffd76095313f7ebaf94"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODcwMzU0MQ==", "bodyText": "I added it back, but not including the entire requestBody per that TODO suggests", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/817#discussion_r478703541", "createdAt": "2020-08-27T21:23:03Z", "author": {"login": "saminguyen"}, "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/service/AuditEventServiceImpl.java", "diffHunk": "@@ -26,15 +30,26 @@\n \n   private XLogger logger = XLoggerFactory.getXLogger(AuditEventServiceImpl.class.getName());\n \n+  private static final String AUDIT_LOG_NAME = \"application-audit-log\";\n+\n   @Override\n   public void postAuditLogEvent(AuditLogEventRequest auditRequest) {\n     logger.entry(\n         String.format(\"begin postAuditLogEvent() for %s event\", auditRequest.getEventCode()));\n \n-    JsonNode requestBody = getObjectMapper().convertValue(auditRequest, JsonNode.class);\n+    Logging logging = LoggingOptions.getDefaultInstance().getService();\n+\n+    // The data to write to the log\n+    Map<String, Object> jsonPayloadMap = getObjectMapper().convertValue(auditRequest, Map.class);\n+\n+    LogEntry entry = LogEntry.newBuilder(Payload.JsonPayload.of(jsonPayloadMap))\n+            .setTimestamp(auditRequest.getOccured().getTime())\n+            .setSeverity(Severity.INFO)\n+            .setLogName(AUDIT_LOG_NAME)\n+            .setResource(MonitoredResource.newBuilder(\"global\").build())\n+            .build();\n \n-    // TODO (#703) integration with GCP stackdriver. Please remove the requestBody from below logger\n-    // statement during stackdriver integration as it may contain PII information.\n-    logger.exit(String.format(\"audit request=%s\", requestBody));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODU2MjIzNQ=="}, "originalCommit": {"oid": "75200bd87fcf378bb5862ffd76095313f7ebaf94"}, "originalPosition": 45}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1888, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}