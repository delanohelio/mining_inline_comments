{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ0NzUzNjEy", "number": 595, "title": "iOS - Start activity with local notification action.", "bodyText": "fixes #215\nfixes #536 (duplicate of 215)", "createdAt": "2020-07-06T12:49:55Z", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/595", "merged": true, "mergeCommit": {"oid": "63c8147dafb0e0d0b6676d81c2ade8bf826e7121"}, "closed": true, "closedAt": "2020-07-16T16:35:32Z", "author": {"login": "tushar-boston"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcyQnX7gH2gAyNDQ0NzUzNjEyOmEwN2ZhYTA2YWQwYzE3NTlmZWI5Y2RkZjQ2YWMxNjFjYTkzZmU2ZjE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc1h5vMAH2gAyNDQ0NzUzNjEyOjdkMWY5NGVkN2NmZGM4ZTliYTIwZWU5NGJkZDgwODczNzAxYTY0Zjk=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "a07faa06ad0c1759feb9cddf46ac161ca93fe6f1", "author": {"user": {"login": "tushar-boston", "name": "Tushar Katyal"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/a07faa06ad0c1759feb9cddf46ac161ca93fe6f1", "committedDate": "2020-07-06T12:43:47Z", "message": "Start run with local notification action."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d609b3b3122261843cbfb559947c4c426327516d", "author": {"user": {"login": "tushar-boston", "name": "Tushar Katyal"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/d609b3b3122261843cbfb559947c4c426327516d", "committedDate": "2020-07-06T13:01:13Z", "message": "fix method reference."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ4MjU1ODk5", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/595#pullrequestreview-448255899", "createdAt": "2020-07-14T16:11:39Z", "commit": {"oid": "d609b3b3122261843cbfb559947c4c426327516d"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQxNjoxMTozOVrOGxa2sA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQxNjoxMzowOFrOGxa6cQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQ3MzM5Mg==", "bodyText": "should completion handler only run when application state is active or backgroud?\nWhat are the states that this should not run in?", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/595#discussion_r454473392", "createdAt": "2020-07-14T16:11:39Z", "author": {"login": "zohrehj"}, "path": "iOS/HPHC/HPHC/AppDelegate.swift", "diffHunk": "@@ -1757,12 +1758,9 @@ extension AppDelegate: UNUserNotificationCenterDelegate {\n       self.updateNotification()\n \n     } else {\n-      if UIApplication.shared.applicationState == UIApplication.State.background\n-        || (UIApplication.shared.applicationState == UIApplication.State.inactive)\n-      {\n-        self.handleLocalNotification(userInfoDetails: (userInfo as? [String: Any])!)\n-      }\n+      self.handleLocalNotification(userInfoDetails: userInfo as? JSONDictionary ?? [:])\n     }\n+    completionHandler()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d609b3b3122261843cbfb559947c4c426327516d"}, "originalPosition": 95}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQ3NDM1Mw==", "bodyText": "what happens if tableViewSections[0] does not exist? i.e. tableViewSections is null or empty?", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/595#discussion_r454474353", "createdAt": "2020-07-14T16:13:08Z", "author": {"login": "zohrehj"}, "path": "iOS/HPHC/HPHC/Controllers/StudyUI/ActivityUI/ActivitiesViewController.swift", "diffHunk": "@@ -214,23 +214,27 @@ class ActivitiesViewController: UIViewController {\n \n     } else {\n       /// check if user navigated from notification\n-      if NotificationHandler.instance.activityId.count > 0 {\n-\n-        let activityId = NotificationHandler.instance.activityId\n-\n-        let rowDetail = tableViewSections[0]\n-        let activities = (rowDetail[\"activities\"] as? [Activity])!\n-        let index = activities.firstIndex(where: { $0.actvityId == activityId })\n-        let ip = IndexPath.init(row: index!, section: 0)\n-        self.selectedIndexPath = ip\n-        self.tableView?.selectRow(at: ip, animated: true, scrollPosition: .middle)\n-        self.tableView?.delegate?.tableView!(self.tableView!, didSelectRowAt: ip)\n-\n-        NotificationHandler.instance.activityId = \"\"\n+      if !NotificationHandler.instance.activityId.isEmpty {\n+        userDidNavigateFromNotification()\n       }\n     }\n   }\n \n+  func userDidNavigateFromNotification() {\n+    let activityId = NotificationHandler.instance.activityId\n+    let rowDetail = tableViewSections[0]\n+    let activities = rowDetail[\"activities\"] as? [Activity] ?? []", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d609b3b3122261843cbfb559947c4c426327516d"}, "originalPosition": 26}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ5MjA4NzE0", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/595#pullrequestreview-449208714", "createdAt": "2020-07-15T18:07:52Z", "commit": {"oid": "d609b3b3122261843cbfb559947c4c426327516d"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7d1f94ed7cfdc8e9ba20ee94bdd80873701a64f9", "author": {"user": {"login": "tushar-boston", "name": "Tushar Katyal"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/7d1f94ed7cfdc8e9ba20ee94bdd80873701a64f9", "committedDate": "2020-07-16T16:34:00Z", "message": "Merge branch 'early-access' into ios-notifications-patch"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 798, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}