{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcwODMxMTcx", "number": 781, "reviewThreads": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQxNzoyOToxNVrOEbDHkQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxNDoyMjo1NVrOEcGAQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk2Nzk4MDk3OnYy", "diffSide": "RIGHT", "path": "user-registration-server-ws/user-mgmt-module/user-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/common/UserMgmntAuditHelper.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQxNzoyOToxNVrOHE1ccw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yM1QxNjowMzozN1rOHFOGzQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDgzMTk4Nw==", "bodyText": "missing copyright header", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/781#discussion_r474831987", "createdAt": "2020-08-21T17:29:15Z", "author": {"login": "zohrehj"}, "path": "user-registration-server-ws/user-mgmt-module/user-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/common/UserMgmntAuditHelper.java", "diffHunk": "@@ -0,0 +1,33 @@\n+package com.google.cloud.healthcare.fdamystudies.common;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5de6b5ea4c93a717c8840f262edb4b94c61668aa"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTIzNjA0NQ==", "bodyText": "added copyright", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/781#discussion_r475236045", "createdAt": "2020-08-23T16:03:37Z", "author": {"login": "navya-BTC"}, "path": "user-registration-server-ws/user-mgmt-module/user-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/common/UserMgmntAuditHelper.java", "diffHunk": "@@ -0,0 +1,33 @@\n+package com.google.cloud.healthcare.fdamystudies.common;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDgzMTk4Nw=="}, "originalCommit": {"oid": "5de6b5ea4c93a717c8840f262edb4b94c61668aa"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk2Nzk4Mzc2OnYy", "diffSide": "RIGHT", "path": "user-registration-server-ws/user-mgmt-module/user-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/config/BeanConfig.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQxNzozMDowN1rOHE1eIQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yM1QxNjowMzo0OVrOHFOG2Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDgzMjQxNw==", "bodyText": "please remove if not needed", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/781#discussion_r474832417", "createdAt": "2020-08-21T17:30:07Z", "author": {"login": "zohrehj"}, "path": "user-registration-server-ws/user-mgmt-module/user-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/config/BeanConfig.java", "diffHunk": "@@ -46,8 +45,8 @@ public void addCorsMappings(CorsRegistry registry) {\n     return authenticationBean;\n   }\n \n-  @Bean\n+  /* @Bean\n   public RestTemplate restTemplate() {\n     return new RestTemplate();\n-  }\n+  }*/", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5de6b5ea4c93a717c8840f262edb4b94c61668aa"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTIzNjA1Nw==", "bodyText": "Removed", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/781#discussion_r475236057", "createdAt": "2020-08-23T16:03:49Z", "author": {"login": "navya-BTC"}, "path": "user-registration-server-ws/user-mgmt-module/user-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/config/BeanConfig.java", "diffHunk": "@@ -46,8 +45,8 @@ public void addCorsMappings(CorsRegistry registry) {\n     return authenticationBean;\n   }\n \n-  @Bean\n+  /* @Bean\n   public RestTemplate restTemplate() {\n     return new RestTemplate();\n-  }\n+  }*/", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDgzMjQxNw=="}, "originalCommit": {"oid": "5de6b5ea4c93a717c8840f262edb4b94c61668aa"}, "originalPosition": 17}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk2ODQyNzgwOnYy", "diffSide": "RIGHT", "path": "user-registration-server-ws/user-mgmt-module/user-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/controller/VerifyEmailIdController.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQxOTo0MToyMlrOHE5w0g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yM1QxNjowNDowM1rOHFOG8g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDkwMjczOA==", "bodyText": "shouldn't this be  isAfter?", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/781#discussion_r474902738", "createdAt": "2020-08-21T19:41:22Z", "author": {"login": "zohrehj"}, "path": "user-registration-server-ws/user-mgmt-module/user-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/controller/VerifyEmailIdController.java", "diffHunk": "@@ -76,20 +97,36 @@\n         participantDetails = getParticipantDetails(verificationForm, appOrgInfoBean);\n       }\n       if (participantDetails == null) {\n+        userMgmntAuditHelper.logEvent(\n+            ACCOUNT_ACTIVATION_USER_EMAIL_VERIFICATION_FAILED, auditRequest);\n+\n         ResponseBean responseBean =\n             ResponseUtil.prepareBadRequestResponse(response, AppConstants.EMAIL_NOT_EXISTS);\n         return new ResponseEntity<>(responseBean, HttpStatus.BAD_REQUEST);\n       }\n       boolean verifyEmailCodeResponse =\n           userDetailsService.verifyCode(verificationForm.getCode().trim(), participantDetails);\n \n+      if (!verificationForm.getCode().trim().equals(participantDetails.getEmailCode())) {\n+        userMgmntAuditHelper.logEvent(\n+            ACCOUNT_ACTIVATION_USER_EMAIL_VERIFICATION_FAILED_WRONG_CODE, auditRequest);\n+      } else if (LocalDateTime.now().isBefore(participantDetails.getCodeExpireDate())) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5de6b5ea4c93a717c8840f262edb4b94c61668aa"}, "originalPosition": 81}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTIzNjA4Mg==", "bodyText": "Fixed Review Comment", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/781#discussion_r475236082", "createdAt": "2020-08-23T16:04:03Z", "author": {"login": "navya-BTC"}, "path": "user-registration-server-ws/user-mgmt-module/user-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/controller/VerifyEmailIdController.java", "diffHunk": "@@ -76,20 +97,36 @@\n         participantDetails = getParticipantDetails(verificationForm, appOrgInfoBean);\n       }\n       if (participantDetails == null) {\n+        userMgmntAuditHelper.logEvent(\n+            ACCOUNT_ACTIVATION_USER_EMAIL_VERIFICATION_FAILED, auditRequest);\n+\n         ResponseBean responseBean =\n             ResponseUtil.prepareBadRequestResponse(response, AppConstants.EMAIL_NOT_EXISTS);\n         return new ResponseEntity<>(responseBean, HttpStatus.BAD_REQUEST);\n       }\n       boolean verifyEmailCodeResponse =\n           userDetailsService.verifyCode(verificationForm.getCode().trim(), participantDetails);\n \n+      if (!verificationForm.getCode().trim().equals(participantDetails.getEmailCode())) {\n+        userMgmntAuditHelper.logEvent(\n+            ACCOUNT_ACTIVATION_USER_EMAIL_VERIFICATION_FAILED_WRONG_CODE, auditRequest);\n+      } else if (LocalDateTime.now().isBefore(participantDetails.getCodeExpireDate())) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDkwMjczOA=="}, "originalCommit": {"oid": "5de6b5ea4c93a717c8840f262edb4b94c61668aa"}, "originalPosition": 81}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk2ODQ4OTY5OnYy", "diffSide": "RIGHT", "path": "user-registration-server-ws/user-mgmt-module/user-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/service/UserManagementProfileServiceImpl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQxOTo1Mzo0NFrOHE6YhQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yM1QxNjowNDo0NFrOHFOHLw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDkxMjkwMQ==", "bodyText": "move these values into contants, enum probably", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/781#discussion_r474912901", "createdAt": "2020-08-21T19:53:44Z", "author": {"login": "zohrehj"}, "path": "user-registration-server-ws/user-mgmt-module/user-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/service/UserManagementProfileServiceImpl.java", "diffHunk": "@@ -254,21 +268,64 @@ public String deActivateAcct(\n             studyBean.setDelete(studyReqBean.getDelete());\n             studyBean.setStudyId(studyReqBean.getStudyId());\n             deleteData.add(studyReqBean.getStudyId());\n+\n+            auditRequest.setStudyId(studyBean.getStudyId());\n+            auditRequest.setParticipantId(studyBean.getParticipantId());\n+\n             retVal =\n                 userManagementUtil.withdrawParticipantFromStudy(\n-                    studyBean.getParticipantId(), studyBean.getStudyId(), studyBean.getDelete());\n+                    studyBean.getParticipantId(),\n+                    studyBean.getStudyId(),\n+                    studyBean.getDelete(),\n+                    auditRequest);\n+\n+            if (Boolean.valueOf(studyReqBean.getDelete())) {\n+              Map<String, String> map =\n+                  Stream.of(\n+                          new String[][] {\n+                            {\"delete_or_retain\", \"delete\"},", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5de6b5ea4c93a717c8840f262edb4b94c61668aa"}, "originalPosition": 72}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTIzNjE0Mw==", "bodyText": "Fixed review comment", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/781#discussion_r475236143", "createdAt": "2020-08-23T16:04:44Z", "author": {"login": "navya-BTC"}, "path": "user-registration-server-ws/user-mgmt-module/user-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/service/UserManagementProfileServiceImpl.java", "diffHunk": "@@ -254,21 +268,64 @@ public String deActivateAcct(\n             studyBean.setDelete(studyReqBean.getDelete());\n             studyBean.setStudyId(studyReqBean.getStudyId());\n             deleteData.add(studyReqBean.getStudyId());\n+\n+            auditRequest.setStudyId(studyBean.getStudyId());\n+            auditRequest.setParticipantId(studyBean.getParticipantId());\n+\n             retVal =\n                 userManagementUtil.withdrawParticipantFromStudy(\n-                    studyBean.getParticipantId(), studyBean.getStudyId(), studyBean.getDelete());\n+                    studyBean.getParticipantId(),\n+                    studyBean.getStudyId(),\n+                    studyBean.getDelete(),\n+                    auditRequest);\n+\n+            if (Boolean.valueOf(studyReqBean.getDelete())) {\n+              Map<String, String> map =\n+                  Stream.of(\n+                          new String[][] {\n+                            {\"delete_or_retain\", \"delete\"},", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDkxMjkwMQ=="}, "originalCommit": {"oid": "5de6b5ea4c93a717c8840f262edb4b94c61668aa"}, "originalPosition": 72}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk2ODUwMjk4OnYy", "diffSide": "RIGHT", "path": "user-registration-server-ws/user-mgmt-module/user-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/service/UserManagementProfileServiceImpl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQxOTo1NjozM1rOHE6hUg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yM1QxNjowNDo1MlrOHFOHVQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDkxNTE1NA==", "bodyText": "this looks like an overkill for a small map with one element", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/781#discussion_r474915154", "createdAt": "2020-08-21T19:56:33Z", "author": {"login": "zohrehj"}, "path": "user-registration-server-ws/user-mgmt-module/user-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/service/UserManagementProfileServiceImpl.java", "diffHunk": "@@ -254,21 +268,64 @@ public String deActivateAcct(\n             studyBean.setDelete(studyReqBean.getDelete());\n             studyBean.setStudyId(studyReqBean.getStudyId());\n             deleteData.add(studyReqBean.getStudyId());\n+\n+            auditRequest.setStudyId(studyBean.getStudyId());\n+            auditRequest.setParticipantId(studyBean.getParticipantId());\n+\n             retVal =\n                 userManagementUtil.withdrawParticipantFromStudy(\n-                    studyBean.getParticipantId(), studyBean.getStudyId(), studyBean.getDelete());\n+                    studyBean.getParticipantId(),\n+                    studyBean.getStudyId(),\n+                    studyBean.getDelete(),\n+                    auditRequest);\n+\n+            if (Boolean.valueOf(studyReqBean.getDelete())) {\n+              Map<String, String> map =\n+                  Stream.of(\n+                          new String[][] {\n+                            {\"delete_or_retain\", \"delete\"},\n+                          })\n+                      .collect(Collectors.toMap(data -> data[0], data -> data[1]));\n+\n+              userMgmntAuditHelper.logEvent(\n+                  DATA_RETENTION_SETTING_CAPTURED_ON_WITHDRAWAL, auditRequest, map);\n+\n+              AuditLogEvent auditEvent =\n+                  retVal.equalsIgnoreCase(MyStudiesUserRegUtil.ErrorCodes.SUCCESS.getValue())\n+                      ? PARTICIPANT_DATA_DELETED\n+                      : PARTICIPANT_DATA_DELETION_FAILED;\n+              userMgmntAuditHelper.logEvent(auditEvent, auditRequest);\n+\n+            } else {\n+              Map<String, String> map =\n+                  Stream.of(\n+                          new String[][] {\n+                            {\"delete_or_retain\", \"retain\"},\n+                          })\n+                      .collect(Collectors.toMap(data -> data[0], data -> data[1]));\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5de6b5ea4c93a717c8840f262edb4b94c61668aa"}, "originalPosition": 92}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTIzNjE4MQ==", "bodyText": "Fixed review comment", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/781#discussion_r475236181", "createdAt": "2020-08-23T16:04:52Z", "author": {"login": "navya-BTC"}, "path": "user-registration-server-ws/user-mgmt-module/user-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/service/UserManagementProfileServiceImpl.java", "diffHunk": "@@ -254,21 +268,64 @@ public String deActivateAcct(\n             studyBean.setDelete(studyReqBean.getDelete());\n             studyBean.setStudyId(studyReqBean.getStudyId());\n             deleteData.add(studyReqBean.getStudyId());\n+\n+            auditRequest.setStudyId(studyBean.getStudyId());\n+            auditRequest.setParticipantId(studyBean.getParticipantId());\n+\n             retVal =\n                 userManagementUtil.withdrawParticipantFromStudy(\n-                    studyBean.getParticipantId(), studyBean.getStudyId(), studyBean.getDelete());\n+                    studyBean.getParticipantId(),\n+                    studyBean.getStudyId(),\n+                    studyBean.getDelete(),\n+                    auditRequest);\n+\n+            if (Boolean.valueOf(studyReqBean.getDelete())) {\n+              Map<String, String> map =\n+                  Stream.of(\n+                          new String[][] {\n+                            {\"delete_or_retain\", \"delete\"},\n+                          })\n+                      .collect(Collectors.toMap(data -> data[0], data -> data[1]));\n+\n+              userMgmntAuditHelper.logEvent(\n+                  DATA_RETENTION_SETTING_CAPTURED_ON_WITHDRAWAL, auditRequest, map);\n+\n+              AuditLogEvent auditEvent =\n+                  retVal.equalsIgnoreCase(MyStudiesUserRegUtil.ErrorCodes.SUCCESS.getValue())\n+                      ? PARTICIPANT_DATA_DELETED\n+                      : PARTICIPANT_DATA_DELETION_FAILED;\n+              userMgmntAuditHelper.logEvent(auditEvent, auditRequest);\n+\n+            } else {\n+              Map<String, String> map =\n+                  Stream.of(\n+                          new String[][] {\n+                            {\"delete_or_retain\", \"retain\"},\n+                          })\n+                      .collect(Collectors.toMap(data -> data[0], data -> data[1]));\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDkxNTE1NA=="}, "originalCommit": {"oid": "5de6b5ea4c93a717c8840f262edb4b94c61668aa"}, "originalPosition": 92}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk2ODUyODM3OnYy", "diffSide": "RIGHT", "path": "user-registration-server-ws/user-mgmt-module/user-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/service/UserSupportServiceImpl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQyMDowMTozOVrOHE6xiQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yM1QxNjowNTowNVrOHFOHeQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDkxOTMwNQ==", "bodyText": "same here, this is a couple of lines without use of stream and collectors", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/781#discussion_r474919305", "createdAt": "2020-08-21T20:01:39Z", "author": {"login": "zohrehj"}, "path": "user-registration-server-ws/user-mgmt-module/user-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/service/UserSupportServiceImpl.java", "diffHunk": "@@ -40,6 +52,18 @@ public boolean feedback(String subject, String body) {\n       isEmailSent =\n           emailNotification.sendEmailNotification(\n               feedbackSubject, dynamicContent, appConfig.getFeedbackToEmail(), null, null);\n+\n+      Map<String, String> map =\n+          Stream.of(\n+                  new String[][] {\n+                    {\"feedback_destination_email_address\", appConfig.getFeedbackToEmail()},\n+                  })\n+              .collect(Collectors.toMap(data -> data[0], data -> data[1]));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5de6b5ea4c93a717c8840f262edb4b94c61668aa"}, "originalPosition": 44}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTIzNjIxNw==", "bodyText": "Fixed review comment", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/781#discussion_r475236217", "createdAt": "2020-08-23T16:05:05Z", "author": {"login": "navya-BTC"}, "path": "user-registration-server-ws/user-mgmt-module/user-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/service/UserSupportServiceImpl.java", "diffHunk": "@@ -40,6 +52,18 @@ public boolean feedback(String subject, String body) {\n       isEmailSent =\n           emailNotification.sendEmailNotification(\n               feedbackSubject, dynamicContent, appConfig.getFeedbackToEmail(), null, null);\n+\n+      Map<String, String> map =\n+          Stream.of(\n+                  new String[][] {\n+                    {\"feedback_destination_email_address\", appConfig.getFeedbackToEmail()},\n+                  })\n+              .collect(Collectors.toMap(data -> data[0], data -> data[1]));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDkxOTMwNQ=="}, "originalCommit": {"oid": "5de6b5ea4c93a717c8840f262edb4b94c61668aa"}, "originalPosition": 44}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk2ODUzNDU3OnYy", "diffSide": "RIGHT", "path": "user-registration-server-ws/user-mgmt-module/user-mgmt/src/test/java/com/google/cloud/healthcare/fdamystudies/testutils/TestUtils.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yMVQyMDowMjo1MVrOHE61bQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxMjo1ODozNlrOHGW3cQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDkyMDMwMQ==", "bodyText": "appVersion should be read from the config value, not hardcoded here.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/781#discussion_r474920301", "createdAt": "2020-08-21T20:02:51Z", "author": {"login": "zohrehj"}, "path": "user-registration-server-ws/user-mgmt-module/user-mgmt/src/test/java/com/google/cloud/healthcare/fdamystudies/testutils/TestUtils.java", "diffHunk": "@@ -12,15 +13,14 @@ public static HttpHeaders getCommonHeaders(String... addOptionalHeaderNames) {\n     headers.add(Constants.ACCESS_TOKEN_HEADER, Constants.ACCESS_TOKEN_VALUE);\n     headers.add(HttpHeaders.CONTENT_TYPE, MediaType.APPLICATION_JSON);\n     headers.add(HttpHeaders.ACCEPT, MediaType.APPLICATION_JSON);\n+    headers.add(\"correlationId\", IdGenerator.id());\n+    headers.add(\"appVersion\", \"1.0\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5de6b5ea4c93a717c8840f262edb4b94c61668aa"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTIzNTk5Nw==", "bodyText": "Refers to the version of the mobile app that was in use for the event logged. App versions can be different for iOS and Android. As appVersion is coming from headers, we can not add it in config.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/781#discussion_r475235997", "createdAt": "2020-08-23T16:03:04Z", "author": {"login": "navya-BTC"}, "path": "user-registration-server-ws/user-mgmt-module/user-mgmt/src/test/java/com/google/cloud/healthcare/fdamystudies/testutils/TestUtils.java", "diffHunk": "@@ -12,15 +13,14 @@ public static HttpHeaders getCommonHeaders(String... addOptionalHeaderNames) {\n     headers.add(Constants.ACCESS_TOKEN_HEADER, Constants.ACCESS_TOKEN_VALUE);\n     headers.add(HttpHeaders.CONTENT_TYPE, MediaType.APPLICATION_JSON);\n     headers.add(HttpHeaders.ACCEPT, MediaType.APPLICATION_JSON);\n+    headers.add(\"correlationId\", IdGenerator.id());\n+    headers.add(\"appVersion\", \"1.0\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDkyMDMwMQ=="}, "originalCommit": {"oid": "5de6b5ea4c93a717c8840f262edb4b94c61668aa"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQyODE0NQ==", "bodyText": "Finalized Columns sheet in HIPAA-grade Audit Logs - FDA MyStudies\nApp Version: Refers to the version of the mobile app that was in use for the event logged. App versions can be different for iOS and Android.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/781#discussion_r476428145", "createdAt": "2020-08-25T12:58:36Z", "author": {"login": "dhanyak-btc"}, "path": "user-registration-server-ws/user-mgmt-module/user-mgmt/src/test/java/com/google/cloud/healthcare/fdamystudies/testutils/TestUtils.java", "diffHunk": "@@ -12,15 +13,14 @@ public static HttpHeaders getCommonHeaders(String... addOptionalHeaderNames) {\n     headers.add(Constants.ACCESS_TOKEN_HEADER, Constants.ACCESS_TOKEN_VALUE);\n     headers.add(HttpHeaders.CONTENT_TYPE, MediaType.APPLICATION_JSON);\n     headers.add(HttpHeaders.ACCEPT, MediaType.APPLICATION_JSON);\n+    headers.add(\"correlationId\", IdGenerator.id());\n+    headers.add(\"appVersion\", \"1.0\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDkyMDMwMQ=="}, "originalCommit": {"oid": "5de6b5ea4c93a717c8840f262edb4b94c61668aa"}, "originalPosition": 12}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk3ODkyMjc3OnYy", "diffSide": "RIGHT", "path": "common-modules/common-tests/src/main/resources/mappings/oauth-scim-service/auth-server-register2.json", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxNDoxOTozMVrOHGaaMA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQwNjo0NTo1NVrOHG-EHQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQ4NjE5Mg==", "bodyText": "this looks unrelated to this cl", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/781#discussion_r476486192", "createdAt": "2020-08-25T14:19:31Z", "author": {"login": "zohrehj"}, "path": "common-modules/common-tests/src/main/resources/mappings/oauth-scim-service/auth-server-register2.json", "diffHunk": "@@ -0,0 +1,18 @@\n+{\n+\t\"request\": {\n+\t\t\"method\": \"POST\",\n+\t\t\"url\": \"/AuthServer/register\",\n+\t\t\"bodyPatterns\": [\n+\t\t\t{\n+\t\t\t\t\"contains\": \"Passs@*1234\"\n+\t\t\t}\n+\t\t]\n+\t},\n+\t\"response\": {\n+\t\t\"status\": 200,\n+\t\t\"headers\": {\n+\t\t\t\"Content-Type\": \"application/json;charset=UTF-8\"\n+\t\t},\n+\t\t\"bodyFileName\": \"oauth-scim-service/auth-server-register-response2.json\"\n+\t}\n+}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e7b776c7d030ba37854b1821b636be824589108d"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA3MDM2NQ==", "bodyText": "I have added additional Integration Test for VERIFICATION_EMAIL_SENT event", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/781#discussion_r477070365", "createdAt": "2020-08-26T06:45:55Z", "author": {"login": "navya-BTC"}, "path": "common-modules/common-tests/src/main/resources/mappings/oauth-scim-service/auth-server-register2.json", "diffHunk": "@@ -0,0 +1,18 @@\n+{\n+\t\"request\": {\n+\t\t\"method\": \"POST\",\n+\t\t\"url\": \"/AuthServer/register\",\n+\t\t\"bodyPatterns\": [\n+\t\t\t{\n+\t\t\t\t\"contains\": \"Passs@*1234\"\n+\t\t\t}\n+\t\t]\n+\t},\n+\t\"response\": {\n+\t\t\"status\": 200,\n+\t\t\"headers\": {\n+\t\t\t\"Content-Type\": \"application/json;charset=UTF-8\"\n+\t\t},\n+\t\t\"bodyFileName\": \"oauth-scim-service/auth-server-register-response2.json\"\n+\t}\n+}", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQ4NjE5Mg=="}, "originalCommit": {"oid": "e7b776c7d030ba37854b1821b636be824589108d"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk3ODkyNjM2OnYy", "diffSide": "RIGHT", "path": "common-modules/common-tests/src/main/resources/mappings/response-service/response-server-deactivate.json", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxNDoyMDoxMVrOHGacOw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQwNjo0ODozM1rOHG-Iqw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQ4NjcxNQ==", "bodyText": "same here, this is an auth server change and unrelated to the audit log integration", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/781#discussion_r476486715", "createdAt": "2020-08-25T14:20:11Z", "author": {"login": "zohrehj"}, "path": "common-modules/common-tests/src/main/resources/mappings/response-service/response-server-deactivate.json", "diffHunk": "@@ -1,7 +1,7 @@\n {\n \t\"request\": {\n \t\t\"method\": \"POST\",\n-\t\t\"url\": \"/mystudies-response-server/participant/withdraw?studyId=studyId1&participantId=1&deleteResponses=delete\"\n+\t\t\"url\": \"/mystudies-response-server/participant/withdraw?studyId=studyId1&participantId=1&deleteResponses=true\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e7b776c7d030ba37854b1821b636be824589108d"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA3MTUzMQ==", "bodyText": "This is changed to true to fix deactivateAccountSuccess test failure", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/781#discussion_r477071531", "createdAt": "2020-08-26T06:48:33Z", "author": {"login": "navya-BTC"}, "path": "common-modules/common-tests/src/main/resources/mappings/response-service/response-server-deactivate.json", "diffHunk": "@@ -1,7 +1,7 @@\n {\n \t\"request\": {\n \t\t\"method\": \"POST\",\n-\t\t\"url\": \"/mystudies-response-server/participant/withdraw?studyId=studyId1&participantId=1&deleteResponses=delete\"\n+\t\t\"url\": \"/mystudies-response-server/participant/withdraw?studyId=studyId1&participantId=1&deleteResponses=true\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQ4NjcxNQ=="}, "originalCommit": {"oid": "e7b776c7d030ba37854b1821b636be824589108d"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk3ODkzOTUyOnYy", "diffSide": "RIGHT", "path": "user-registration-server-ws/user-mgmt-module/user-mgmt/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/UserRegistrationControllerTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxNDoyMjo1NVrOHGakWQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNlQwNjo1MzoxNVrOHG-RGg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQ4ODc5Mw==", "bodyText": "might be out of scope of this PR but tests should not have order", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/781#discussion_r476488793", "createdAt": "2020-08-25T14:22:55Z", "author": {"login": "zohrehj"}, "path": "user-registration-server-ws/user-mgmt-module/user-mgmt/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/UserRegistrationControllerTest.java", "diffHunk": "@@ -168,6 +192,98 @@ public void shouldRegisterUser() throws Exception {\n         1,\n         postRequestedFor(urlEqualTo(\"/AuthServer/register\"))\n             .withRequestBody(new ContainsPattern(Constants.PASSWORD)));\n+\n+    AuditLogEventRequest auditRequest = new AuditLogEventRequest();\n+    auditRequest.setAppId(Constants.APP_ID_VALUE);\n+    auditRequest.setUserId(daoResp.getUserId());\n+\n+    Map<String, AuditLogEventRequest> auditEventMap = new HashedMap<>();\n+    auditEventMap.put(USER_CREATED.getEventCode(), auditRequest);\n+    auditEventMap.put(VERIFICATION_EMAIL_FAILED.getEventCode(), auditRequest);\n+\n+    verifyAuditEventCall(auditEventMap, USER_CREATED, VERIFICATION_EMAIL_FAILED);\n+  }\n+\n+  @Order(4)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e7b776c7d030ba37854b1821b636be824589108d"}, "originalPosition": 99}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA3MzY5MA==", "bodyText": "Created an issue #805 this review comment will be addressed in follow-up PR.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/781#discussion_r477073690", "createdAt": "2020-08-26T06:53:15Z", "author": {"login": "dhanyak-btc"}, "path": "user-registration-server-ws/user-mgmt-module/user-mgmt/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/UserRegistrationControllerTest.java", "diffHunk": "@@ -168,6 +192,98 @@ public void shouldRegisterUser() throws Exception {\n         1,\n         postRequestedFor(urlEqualTo(\"/AuthServer/register\"))\n             .withRequestBody(new ContainsPattern(Constants.PASSWORD)));\n+\n+    AuditLogEventRequest auditRequest = new AuditLogEventRequest();\n+    auditRequest.setAppId(Constants.APP_ID_VALUE);\n+    auditRequest.setUserId(daoResp.getUserId());\n+\n+    Map<String, AuditLogEventRequest> auditEventMap = new HashedMap<>();\n+    auditEventMap.put(USER_CREATED.getEventCode(), auditRequest);\n+    auditEventMap.put(VERIFICATION_EMAIL_FAILED.getEventCode(), auditRequest);\n+\n+    verifyAuditEventCall(auditEventMap, USER_CREATED, VERIFICATION_EMAIL_FAILED);\n+  }\n+\n+  @Order(4)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQ4ODc5Mw=="}, "originalCommit": {"oid": "e7b776c7d030ba37854b1821b636be824589108d"}, "originalPosition": 99}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2168, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}