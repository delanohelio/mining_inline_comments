{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI3NzA3ODQw", "number": 443, "title": "Integration test changes for enroll mgmt bundle", "bodyText": "PR contains changes for integration test of enroll mgmt bundle's validateEnrollmentToken,enroll and participantInfo apis only.", "createdAt": "2020-06-04T09:29:18Z", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/443", "merged": true, "mergeCommit": {"oid": "c0b8d223a21c14eb6837a3109a6585792a205bd9"}, "closed": true, "closedAt": "2020-06-10T13:58:56Z", "author": {"login": "aswinijena100"}, "timelineItems": {"totalCount": 19, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcn6nRVgH2gAyNDI3NzA3ODQwOjZhN2M3OGE4MzY1ZjVhN2FiN2QzNzY0MzQ5YzEzYjdhMmU4MjMwYWQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcp6FdXAH2gAyNDI3NzA3ODQwOmYzMDg4YzQ4NGYxNDI1YzYyZWYyMWEyOGI3ZDkwNDZkNTg5MzZmYTE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6a7c78a8365f5a7ab7d3764349c13b7a2e8230ad", "author": {"user": {"login": "aswinijena100", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/6a7c78a8365f5a7ab7d3764349c13b7a2e8230ad", "committedDate": "2020-06-04T09:26:31Z", "message": "code commit for enroll mgmt bundle( for ParticipantInformationController and EnrollmentTokenController only )  integration test changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d295d8826e528ad8d2c78ab43f897ae9860d1a4b", "author": {"user": {"login": "aswinijena100", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/d295d8826e528ad8d2c78ab43f897ae9860d1a4b", "committedDate": "2020-06-04T10:17:18Z", "message": "failed to bind exception issue fix for port 8001"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "76311a052e7bff655d0e726f62f03584496fda33", "author": {"user": {"login": "aswinijena100", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/76311a052e7bff655d0e726f62f03584496fda33", "committedDate": "2020-06-04T10:19:50Z", "message": "port changed to 8002"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5ec16c233f5b849742a607de7d0adc42ecea6dac", "author": {"user": {"login": "aswinijena100", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/5ec16c233f5b849742a607de7d0adc42ecea6dac", "committedDate": "2020-06-04T11:15:33Z", "message": "PR build check failed fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI2NTcxMDIy", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/443#pullrequestreview-426571022", "createdAt": "2020-06-08T19:53:04Z", "commit": {"oid": "5ec16c233f5b849742a607de7d0adc42ecea6dac"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQxOTo1MzowNFrOGguEog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOFQyMDoyOToyNVrOGgvNZw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjk2MjQ2Ng==", "bodyText": "performGet?", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/443#discussion_r436962466", "createdAt": "2020-06-08T19:53:04Z", "author": {"login": "nikklassen"}, "path": "user-registration-server-ws/enroll-mgmt/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/tests/EnrollmentTokenControllerTest.java", "diffHunk": "@@ -0,0 +1,185 @@\n+package com.google.cloud.healthcare.fdamystudies.controller.tests;\n+\n+import static org.junit.jupiter.api.Assertions.assertNotNull;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;\n+import static org.springframework.test.web.servlet.result.MockMvcResultHandlers.print;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;\n+import org.junit.jupiter.api.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpHeaders;\n+import com.fasterxml.jackson.core.JsonProcessingException;\n+import com.google.cloud.healthcare.fdamystudies.beans.EnrollmentBean;\n+import com.google.cloud.healthcare.fdamystudies.common.BaseMockIT;\n+import com.google.cloud.healthcare.fdamystudies.controller.EnrollmentTokenController;\n+import com.google.cloud.healthcare.fdamystudies.service.EnrollmentTokenService;\n+import com.google.cloud.healthcare.fdamystudies.testutils.Constants;\n+import com.google.cloud.healthcare.fdamystudies.testutils.TestUtils;\n+\n+public class EnrollmentTokenControllerTest extends BaseMockIT {\n+\n+  private static final String PING_PATH = \"/ping\";\n+  private static final String VALIDATE_ENROLLMENT_TOKEN_PATH = \"/validateEnrollmentToken\";\n+  private static final String ENROLL_PATH = \"/enroll\";\n+\n+  @Autowired private EnrollmentTokenController controller;\n+  @Autowired private EnrollmentTokenService enrollmentTokenService;\n+\n+  @Test\n+  public void contextLoads() {\n+    assertNotNull(controller);\n+    assertNotNull(mockMvc);\n+    assertNotNull(enrollmentTokenService);\n+  }\n+\n+  @Test\n+  public void ping() throws Exception {\n+\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    mockMvc.perform(get(PING_PATH).headers(headers)).andDo(print()).andExpect(status().isOk());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ec16c233f5b849742a607de7d0adc42ecea6dac"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjk2NDIwOA==", "bodyText": "put instead of remove then add.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/443#discussion_r436964208", "createdAt": "2020-06-08T19:56:23Z", "author": {"login": "nikklassen"}, "path": "user-registration-server-ws/enroll-mgmt/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/tests/EnrollmentTokenControllerTest.java", "diffHunk": "@@ -0,0 +1,185 @@\n+package com.google.cloud.healthcare.fdamystudies.controller.tests;\n+\n+import static org.junit.jupiter.api.Assertions.assertNotNull;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;\n+import static org.springframework.test.web.servlet.result.MockMvcResultHandlers.print;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;\n+import org.junit.jupiter.api.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpHeaders;\n+import com.fasterxml.jackson.core.JsonProcessingException;\n+import com.google.cloud.healthcare.fdamystudies.beans.EnrollmentBean;\n+import com.google.cloud.healthcare.fdamystudies.common.BaseMockIT;\n+import com.google.cloud.healthcare.fdamystudies.controller.EnrollmentTokenController;\n+import com.google.cloud.healthcare.fdamystudies.service.EnrollmentTokenService;\n+import com.google.cloud.healthcare.fdamystudies.testutils.Constants;\n+import com.google.cloud.healthcare.fdamystudies.testutils.TestUtils;\n+\n+public class EnrollmentTokenControllerTest extends BaseMockIT {\n+\n+  private static final String PING_PATH = \"/ping\";\n+  private static final String VALIDATE_ENROLLMENT_TOKEN_PATH = \"/validateEnrollmentToken\";\n+  private static final String ENROLL_PATH = \"/enroll\";\n+\n+  @Autowired private EnrollmentTokenController controller;\n+  @Autowired private EnrollmentTokenService enrollmentTokenService;\n+\n+  @Test\n+  public void contextLoads() {\n+    assertNotNull(controller);\n+    assertNotNull(mockMvc);\n+    assertNotNull(enrollmentTokenService);\n+  }\n+\n+  @Test\n+  public void ping() throws Exception {\n+\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    mockMvc.perform(get(PING_PATH).headers(headers)).andDo(print()).andExpect(status().isOk());\n+  }\n+\n+  @Test\n+  public void validateEnrollmentTokenSuccess() throws Exception {\n+\n+    String requestJson = getEnrollmentJson(Constants.TOKEN, Constants.STUDYOF_HEALTH);\n+\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    TestUtils.addContentTypeAcceptHeaders(headers);\n+\n+    performPost(VALIDATE_ENROLLMENT_TOKEN_PATH, requestJson, headers, Constants.SUCCESS, OK);\n+  }\n+\n+  @Test\n+  public void validateEnrollmentTokenBadRequests() throws Exception {\n+\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    TestUtils.addContentTypeAcceptHeaders(headers);\n+\n+    // without study id\n+    String requestJson = getEnrollmentJson(Constants.TOKEN, null);\n+    performPost(VALIDATE_ENROLLMENT_TOKEN_PATH, requestJson, headers, \"\", BAD_REQUEST);\n+\n+    // without token\n+    requestJson = getEnrollmentJson(null, Constants.STUDYOF_HEALTH_CLOSE);\n+    performPost(VALIDATE_ENROLLMENT_TOKEN_PATH, requestJson, headers, \"\", BAD_REQUEST);\n+\n+    // unkown token id\n+    requestJson = getEnrollmentJson(Constants.UNKOWN_TOKEN, Constants.STUDYOF_HEALTH);\n+    performPost(VALIDATE_ENROLLMENT_TOKEN_PATH, requestJson, headers, \"\", BAD_REQUEST);\n+  }\n+\n+  @Test\n+  public void validateEnrollmentTokenForbidden() throws Exception {\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    TestUtils.addContentTypeAcceptHeaders(headers);\n+\n+    // study id not exists\n+    String requestJson = getEnrollmentJson(Constants.TOKEN, Constants.STUDYID_NOT_EXIST);\n+    performPost(VALIDATE_ENROLLMENT_TOKEN_PATH, requestJson, headers, \"\", FORBIDDEN);\n+\n+    // token already use\n+    requestJson = getEnrollmentJson(Constants.TOKEN_ALREADY_USED, Constants.STUDYOF_HEALTH_1);\n+    performPost(VALIDATE_ENROLLMENT_TOKEN_PATH, requestJson, headers, \"\", FORBIDDEN);\n+  }\n+\n+  @Test\n+  public void validateEnrollmentTokenUnAuthorised() throws Exception {\n+    // without userId header\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    TestUtils.addContentTypeAcceptHeaders(headers);\n+    headers.remove(Constants.USER_ID_HEADER);\n+\n+    String requestJson = getEnrollmentJson(Constants.TOKEN, Constants.STUDYOF_HEALTH);\n+    performPost(VALIDATE_ENROLLMENT_TOKEN_PATH, requestJson, headers, \"\", UNAUTHORIZED);\n+  }\n+\n+  @Test\n+  public void enrollParticipantSuccessStudyTypeClose() throws Exception {\n+\n+    // study type close\n+    String requestJson = getEnrollmentJson(Constants.TOKEN_NEW, Constants.STUDYOF_HEALTH_CLOSE);\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    TestUtils.addContentTypeAcceptHeaders(headers);\n+\n+    performPost(ENROLL_PATH, requestJson, headers, Constants.SUCCESS, OK);\n+  }\n+\n+  @Test\n+  public void enrollParticipantSuccessStudyTypeOpen() throws Exception {\n+    // study type open\n+    String requestJson = getEnrollmentJson(Constants.TOKEN_NEW, Constants.STUDYOF_HEALTH);\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    TestUtils.addContentTypeAcceptHeaders(headers);\n+\n+    performPost(ENROLL_PATH, requestJson, headers, Constants.SUCCESS, OK);\n+  }\n+\n+  @Test\n+  public void enrollParticipantSuccessNewUser() throws Exception {\n+    // new user id\n+    String requestJson = getEnrollmentJson(Constants.TOKEN_NEW, Constants.STUDYOF_HEALTH);\n+\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    TestUtils.addContentTypeAcceptHeaders(headers);\n+    headers.remove(Constants.USER_ID_HEADER);\n+    headers.add(Constants.USER_ID_HEADER, Constants.NEW_USER_ID);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ec16c233f5b849742a607de7d0adc42ecea6dac"}, "originalPosition": 125}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjk2NzUyOQ==", "bodyText": "Just add this to the common headers, all requests are JSON.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/443#discussion_r436967529", "createdAt": "2020-06-08T20:02:59Z", "author": {"login": "nikklassen"}, "path": "user-registration-server-ws/enroll-mgmt/src/test/java/com/google/cloud/healthcare/fdamystudies/testutils/TestUtils.java", "diffHunk": "@@ -0,0 +1,28 @@\n+package com.google.cloud.healthcare.fdamystudies.testutils;\n+\n+import javax.ws.rs.core.MediaType;\n+import org.springframework.http.HttpHeaders;\n+\n+public class TestUtils {\n+\n+  public static void addUserIdHeader(HttpHeaders headers) {\n+    headers.add(Constants.USER_ID_HEADER, Constants.VALID_USER_ID);\n+  }\n+\n+  public static HttpHeaders getCommonHeaders() {\n+    HttpHeaders headers = new HttpHeaders();\n+    headers.add(Constants.CLIENT_TOKEN_HEADER, Constants.CLIENT_TOKEN_VALUE);\n+    headers.add(Constants.ACCESS_TOKEN_HEADER, Constants.ACCESS_TOKEN_VALUE);\n+    headers.add(Constants.USER_ID_HEADER, Constants.VALID_USER_ID);\n+    return headers;\n+  }\n+\n+  public static void addHeader(HttpHeaders headers, String headerName, String headerValue) {\n+    headers.add(headerName, headerValue);\n+  }\n+\n+  public static void addContentTypeAcceptHeaders(HttpHeaders headers) {\n+    addHeader(headers, HttpHeaders.CONTENT_TYPE, MediaType.APPLICATION_JSON);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ec16c233f5b849742a607de7d0adc42ecea6dac"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjk2ODIyMg==", "bodyText": "This just obscures the function call. Remove it and use .add directly.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/443#discussion_r436968222", "createdAt": "2020-06-08T20:04:26Z", "author": {"login": "nikklassen"}, "path": "user-registration-server-ws/enroll-mgmt/src/test/java/com/google/cloud/healthcare/fdamystudies/testutils/TestUtils.java", "diffHunk": "@@ -0,0 +1,28 @@\n+package com.google.cloud.healthcare.fdamystudies.testutils;\n+\n+import javax.ws.rs.core.MediaType;\n+import org.springframework.http.HttpHeaders;\n+\n+public class TestUtils {\n+\n+  public static void addUserIdHeader(HttpHeaders headers) {\n+    headers.add(Constants.USER_ID_HEADER, Constants.VALID_USER_ID);\n+  }\n+\n+  public static HttpHeaders getCommonHeaders() {\n+    HttpHeaders headers = new HttpHeaders();\n+    headers.add(Constants.CLIENT_TOKEN_HEADER, Constants.CLIENT_TOKEN_VALUE);\n+    headers.add(Constants.ACCESS_TOKEN_HEADER, Constants.ACCESS_TOKEN_VALUE);\n+    headers.add(Constants.USER_ID_HEADER, Constants.VALID_USER_ID);\n+    return headers;\n+  }\n+\n+  public static void addHeader(HttpHeaders headers, String headerName, String headerValue) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ec16c233f5b849742a607de7d0adc42ecea6dac"}, "originalPosition": 20}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjk2ODU0OA==", "bodyText": "function is unused.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/443#discussion_r436968548", "createdAt": "2020-06-08T20:05:04Z", "author": {"login": "nikklassen"}, "path": "user-registration-server-ws/enroll-mgmt/src/test/java/com/google/cloud/healthcare/fdamystudies/testutils/TestUtils.java", "diffHunk": "@@ -0,0 +1,28 @@\n+package com.google.cloud.healthcare.fdamystudies.testutils;\n+\n+import javax.ws.rs.core.MediaType;\n+import org.springframework.http.HttpHeaders;\n+\n+public class TestUtils {\n+\n+  public static void addUserIdHeader(HttpHeaders headers) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ec16c233f5b849742a607de7d0adc42ecea6dac"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjk4MTA5NQ==", "bodyText": "typo: unknown", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/443#discussion_r436981095", "createdAt": "2020-06-08T20:29:25Z", "author": {"login": "nikklassen"}, "path": "user-registration-server-ws/enroll-mgmt/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/tests/EnrollmentTokenControllerTest.java", "diffHunk": "@@ -0,0 +1,185 @@\n+package com.google.cloud.healthcare.fdamystudies.controller.tests;\n+\n+import static org.junit.jupiter.api.Assertions.assertNotNull;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;\n+import static org.springframework.test.web.servlet.result.MockMvcResultHandlers.print;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;\n+import org.junit.jupiter.api.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpHeaders;\n+import com.fasterxml.jackson.core.JsonProcessingException;\n+import com.google.cloud.healthcare.fdamystudies.beans.EnrollmentBean;\n+import com.google.cloud.healthcare.fdamystudies.common.BaseMockIT;\n+import com.google.cloud.healthcare.fdamystudies.controller.EnrollmentTokenController;\n+import com.google.cloud.healthcare.fdamystudies.service.EnrollmentTokenService;\n+import com.google.cloud.healthcare.fdamystudies.testutils.Constants;\n+import com.google.cloud.healthcare.fdamystudies.testutils.TestUtils;\n+\n+public class EnrollmentTokenControllerTest extends BaseMockIT {\n+\n+  private static final String PING_PATH = \"/ping\";\n+  private static final String VALIDATE_ENROLLMENT_TOKEN_PATH = \"/validateEnrollmentToken\";\n+  private static final String ENROLL_PATH = \"/enroll\";\n+\n+  @Autowired private EnrollmentTokenController controller;\n+  @Autowired private EnrollmentTokenService enrollmentTokenService;\n+\n+  @Test\n+  public void contextLoads() {\n+    assertNotNull(controller);\n+    assertNotNull(mockMvc);\n+    assertNotNull(enrollmentTokenService);\n+  }\n+\n+  @Test\n+  public void ping() throws Exception {\n+\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    mockMvc.perform(get(PING_PATH).headers(headers)).andDo(print()).andExpect(status().isOk());\n+  }\n+\n+  @Test\n+  public void validateEnrollmentTokenSuccess() throws Exception {\n+\n+    String requestJson = getEnrollmentJson(Constants.TOKEN, Constants.STUDYOF_HEALTH);\n+\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    TestUtils.addContentTypeAcceptHeaders(headers);\n+\n+    performPost(VALIDATE_ENROLLMENT_TOKEN_PATH, requestJson, headers, Constants.SUCCESS, OK);\n+  }\n+\n+  @Test\n+  public void validateEnrollmentTokenBadRequests() throws Exception {\n+\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    TestUtils.addContentTypeAcceptHeaders(headers);\n+\n+    // without study id\n+    String requestJson = getEnrollmentJson(Constants.TOKEN, null);\n+    performPost(VALIDATE_ENROLLMENT_TOKEN_PATH, requestJson, headers, \"\", BAD_REQUEST);\n+\n+    // without token\n+    requestJson = getEnrollmentJson(null, Constants.STUDYOF_HEALTH_CLOSE);\n+    performPost(VALIDATE_ENROLLMENT_TOKEN_PATH, requestJson, headers, \"\", BAD_REQUEST);\n+\n+    // unkown token id\n+    requestJson = getEnrollmentJson(Constants.UNKOWN_TOKEN, Constants.STUDYOF_HEALTH);\n+    performPost(VALIDATE_ENROLLMENT_TOKEN_PATH, requestJson, headers, \"\", BAD_REQUEST);\n+  }\n+\n+  @Test\n+  public void validateEnrollmentTokenForbidden() throws Exception {\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    TestUtils.addContentTypeAcceptHeaders(headers);\n+\n+    // study id not exists\n+    String requestJson = getEnrollmentJson(Constants.TOKEN, Constants.STUDYID_NOT_EXIST);\n+    performPost(VALIDATE_ENROLLMENT_TOKEN_PATH, requestJson, headers, \"\", FORBIDDEN);\n+\n+    // token already use\n+    requestJson = getEnrollmentJson(Constants.TOKEN_ALREADY_USED, Constants.STUDYOF_HEALTH_1);\n+    performPost(VALIDATE_ENROLLMENT_TOKEN_PATH, requestJson, headers, \"\", FORBIDDEN);\n+  }\n+\n+  @Test\n+  public void validateEnrollmentTokenUnAuthorised() throws Exception {\n+    // without userId header\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    TestUtils.addContentTypeAcceptHeaders(headers);\n+    headers.remove(Constants.USER_ID_HEADER);\n+\n+    String requestJson = getEnrollmentJson(Constants.TOKEN, Constants.STUDYOF_HEALTH);\n+    performPost(VALIDATE_ENROLLMENT_TOKEN_PATH, requestJson, headers, \"\", UNAUTHORIZED);\n+  }\n+\n+  @Test\n+  public void enrollParticipantSuccessStudyTypeClose() throws Exception {\n+\n+    // study type close\n+    String requestJson = getEnrollmentJson(Constants.TOKEN_NEW, Constants.STUDYOF_HEALTH_CLOSE);\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    TestUtils.addContentTypeAcceptHeaders(headers);\n+\n+    performPost(ENROLL_PATH, requestJson, headers, Constants.SUCCESS, OK);\n+  }\n+\n+  @Test\n+  public void enrollParticipantSuccessStudyTypeOpen() throws Exception {\n+    // study type open\n+    String requestJson = getEnrollmentJson(Constants.TOKEN_NEW, Constants.STUDYOF_HEALTH);\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    TestUtils.addContentTypeAcceptHeaders(headers);\n+\n+    performPost(ENROLL_PATH, requestJson, headers, Constants.SUCCESS, OK);\n+  }\n+\n+  @Test\n+  public void enrollParticipantSuccessNewUser() throws Exception {\n+    // new user id\n+    String requestJson = getEnrollmentJson(Constants.TOKEN_NEW, Constants.STUDYOF_HEALTH);\n+\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    TestUtils.addContentTypeAcceptHeaders(headers);\n+    headers.remove(Constants.USER_ID_HEADER);\n+    headers.add(Constants.USER_ID_HEADER, Constants.NEW_USER_ID);\n+\n+    TestUtils.addContentTypeAcceptHeaders(headers);\n+\n+    performPost(ENROLL_PATH, requestJson, headers, Constants.SUCCESS, OK);\n+  }\n+\n+  @Test\n+  public void enrollParticipantBadRequests() throws Exception {\n+\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    TestUtils.addContentTypeAcceptHeaders(headers);\n+\n+    // without study id\n+    String requestJson = getEnrollmentJson(Constants.TOKEN_NEW, null);\n+    performPost(ENROLL_PATH, requestJson, headers, \"\", BAD_REQUEST);\n+\n+    // without token\n+    requestJson = getEnrollmentJson(null, Constants.STUDYOF_HEALTH_CLOSE);\n+    performPost(ENROLL_PATH, requestJson, headers, \"\", BAD_REQUEST);\n+\n+    // unkown token id", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5ec16c233f5b849742a607de7d0adc42ecea6dac"}, "originalPosition": 146}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "494f112308cb540d64b3a6ea6ad1a2fae6ff79a5", "author": {"user": {"login": "aswinijena100", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/494f112308cb540d64b3a6ea6ad1a2fae6ff79a5", "committedDate": "2020-06-09T09:00:35Z", "message": "PR #443 comment fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6bca78ffdca30358134dda5971b54b5c40522bdf", "author": {"user": {"login": "aswinijena100", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/6bca78ffdca30358134dda5971b54b5c40522bdf", "committedDate": "2020-06-09T09:07:01Z", "message": "Merge branch 'early-access' into early-access-enroll-mgmt-integration-test-change"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3MjMzMjI1", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/443#pullrequestreview-427233225", "createdAt": "2020-06-09T14:50:47Z", "commit": {"oid": "6bca78ffdca30358134dda5971b54b5c40522bdf"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxNDo1MDo0N1rOGhN8YQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxNDo1MDo0N1rOGhN8YQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzQ4NDY0MQ==", "bodyText": "I haven't seen this used anywhere else in our code. I don't think we should start using it here.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/443#discussion_r437484641", "createdAt": "2020-06-09T14:50:47Z", "author": {"login": "nikklassen"}, "path": "user-registration-server-ws/enroll-mgmt/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/tests/EnrollmentTokenControllerTest.java", "diffHunk": "@@ -53,44 +51,47 @@ public void validateEnrollmentTokenSuccess() throws Exception {\n   public void validateEnrollmentTokenBadRequests() throws Exception {\n \n     HttpHeaders headers = TestUtils.getCommonHeaders();\n-    TestUtils.addContentTypeAcceptHeaders(headers);\n+    headers.add(Constants.USER_ID_HEADER, Constants.VALID_USER_ID);\n \n     // without study id\n     String requestJson = getEnrollmentJson(Constants.TOKEN, null);\n-    performPost(VALIDATE_ENROLLMENT_TOKEN_PATH, requestJson, headers, \"\", BAD_REQUEST);\n+    performPost(\n+        VALIDATE_ENROLLMENT_TOKEN_PATH, requestJson, headers, StringUtils.EMPTY, BAD_REQUEST);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6bca78ffdca30358134dda5971b54b5c40522bdf"}, "originalPosition": 40}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dfecdf067c9bd77da1b2b047e58d354fc47bc113", "author": {"user": {"login": "aswinijena100", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/dfecdf067c9bd77da1b2b047e58d354fc47bc113", "committedDate": "2020-06-09T14:59:08Z", "message": "Merge branch 'early-access' into early-access-enroll-mgmt-integration-test-change"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d9839b80b0456a23c5a8420cff7fe442396b23c7", "author": {"user": {"login": "aswinijena100", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/d9839b80b0456a23c5a8420cff7fe442396b23c7", "committedDate": "2020-06-09T15:05:48Z", "message": "removed StringUtils.EMPTY for code consistency"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "81f3b63556beff9c06414b9b8bc2d5e294870a74", "author": {"user": {"login": "aswinijena100", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/81f3b63556beff9c06414b9b8bc2d5e294870a74", "committedDate": "2020-06-09T15:05:59Z", "message": "Merge branch 'early-access-enroll-mgmt-integration-test-change' of https://github.com/GoogleCloudPlatform/fda-mystudies into early-access-enroll-mgmt-integration-test-change"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3MjcxMzg4", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/443#pullrequestreview-427271388", "createdAt": "2020-06-09T15:17:57Z", "commit": {"oid": "d9839b80b0456a23c5a8420cff7fe442396b23c7"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxNToxNzo1N1rOGhPgog==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxNToxNzo1N1rOGhPgog==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzUxMDMwNg==", "bodyText": "What about all the other usages?", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/443#discussion_r437510306", "createdAt": "2020-06-09T15:17:57Z", "author": {"login": "nikklassen"}, "path": "user-registration-server-ws/enroll-mgmt/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/tests/EnrollmentTokenControllerTest.java", "diffHunk": "@@ -170,7 +170,7 @@ public void enrollParticipantForbidden() throws Exception {\n \n     // study id not exists\n     requestJson = getEnrollmentJson(Constants.TOKEN_NEW, Constants.STUDYID_NOT_EXIST);\n-    performPost(ENROLL_PATH, requestJson, headers, StringUtils.EMPTY, FORBIDDEN);\n+    performPost(ENROLL_PATH, requestJson, headers, \"\", FORBIDDEN);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d9839b80b0456a23c5a8420cff7fe442396b23c7"}, "originalPosition": 5}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a59c5249c71703945dff85a367cf8a764cb75e69", "author": {"user": {"login": "aswinijena100", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/a59c5249c71703945dff85a367cf8a764cb75e69", "committedDate": "2020-06-09T15:29:40Z", "message": "removed StringUtils.EMPTY"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b19ceb9b4e3d7070021276e607b7c381235d6836", "author": {"user": {"login": "madhurya-btc", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/b19ceb9b4e3d7070021276e607b7c381235d6836", "committedDate": "2020-06-09T15:35:06Z", "message": "Stringutils.empty removed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c4eab6963e878b6cc286c466769f7716e2795f7a", "author": {"user": {"login": "aswinijena100", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/c4eab6963e878b6cc286c466769f7716e2795f7a", "committedDate": "2020-06-10T04:42:47Z", "message": "further commit to PR comment fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e9b099ac4d4d99626650f2e22366f674541d4d1b", "author": {"user": {"login": "aswinijena100", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/e9b099ac4d4d99626650f2e22366f674541d4d1b", "committedDate": "2020-06-10T04:45:37Z", "message": "Merge branch 'early-access' into early-access-enroll-mgmt-integration-test-change"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI3OTk1ODI2", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/443#pullrequestreview-427995826", "createdAt": "2020-06-10T12:21:48Z", "commit": {"oid": "e9b099ac4d4d99626650f2e22366f674541d4d1b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e623070761681f34b99f6531278f596b3a04315d", "author": {"user": {"login": "aswinijena100", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/e623070761681f34b99f6531278f596b3a04315d", "committedDate": "2020-06-10T13:19:29Z", "message": "Merge branch 'early-access' into early-access-enroll-mgmt-integration-test-change"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f3088c484f1425c62ef21a28b7d9046d58936fa1", "author": {"user": {"login": "aswinijena100", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/f3088c484f1425c62ef21a28b7d9046d58936fa1", "committedDate": "2020-06-10T13:57:26Z", "message": "Merge branch 'early-access' into early-access-enroll-mgmt-integration-test-change"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 925, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}