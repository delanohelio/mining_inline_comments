{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAwMTE1Nzg2", "number": 1235, "title": "Add script to create superadmin account for Participant Manager", "bodyText": "", "createdAt": "2020-10-08T18:44:42Z", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1235", "merged": true, "mergeCommit": {"oid": "aadb8033107fafd5c00c4b40fd257ddc22abbf6b"}, "closed": true, "closedAt": "2020-10-19T18:14:30Z", "author": {"login": "zohrehj"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdQ6pIxgFqTUwNTkwODkzNQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdUIJBegFqTUxMjAyODIzMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA1OTA4OTM1", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1235#pullrequestreview-505908935", "createdAt": "2020-10-09T18:39:27Z", "commit": {"oid": "0accff4260276cb5183ffe5c53cd8bfecf697c3a"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "26077b80727609a3916d842842b13cf703eca0e8", "author": {"user": {"login": "zohrehj", "name": "Zohreh Jabbari"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/26077b80727609a3916d842842b13cf703eca0e8", "committedDate": "2020-10-14T18:36:17Z", "message": "Add script to create superadmin account for Participant Manager"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0b2e271bb0dca7acb529b4fb8bdb9449d20d3feb", "author": {"user": {"login": "zohrehj", "name": "Zohreh Jabbari"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/0b2e271bb0dca7acb529b4fb8bdb9449d20d3feb", "committedDate": "2020-10-14T18:36:23Z", "message": "Use replace instead of update"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "28085b4a761e1a4fb85081d22240e0c9937c8722", "author": {"user": {"login": "zohrehj", "name": "Zohreh Jabbari"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/28085b4a761e1a4fb85081d22240e0c9937c8722", "committedDate": "2020-10-14T18:40:07Z", "message": "Update script with latest password hash changes"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "0accff4260276cb5183ffe5c53cd8bfecf697c3a", "author": {"user": {"login": "zohrehj", "name": "Zohreh Jabbari"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/0accff4260276cb5183ffe5c53cd8bfecf697c3a", "committedDate": "2020-10-09T14:16:53Z", "message": "Merge branch 'develop' into superadmin"}, "afterCommit": {"oid": "28085b4a761e1a4fb85081d22240e0c9937c8722", "author": {"user": {"login": "zohrehj", "name": "Zohreh Jabbari"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/28085b4a761e1a4fb85081d22240e0c9937c8722", "committedDate": "2020-10-14T18:40:07Z", "message": "Update script with latest password hash changes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "50d3a7e7272a09f624e64fbc611b684fac77032d", "author": {"user": {"login": "zohrehj", "name": "Zohreh Jabbari"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/50d3a7e7272a09f624e64fbc611b684fac77032d", "committedDate": "2020-10-14T20:02:02Z", "message": "Translate participant-datastore superadmin sql to bash"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA4NzIwNjQ2", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1235#pullrequestreview-508720646", "createdAt": "2020-10-14T20:54:42Z", "commit": {"oid": "50d3a7e7272a09f624e64fbc611b684fac77032d"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQyMDo1NDo0MlrOHhksZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQyMDo1NDo0MlrOHhksZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDk2NjI0NQ==", "bodyText": "@aswinijena100 I copied the security code from the sql script in participant manager, where is this value coming from?", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1235#discussion_r504966245", "createdAt": "2020-10-14T20:54:42Z", "author": {"login": "zohrehj"}, "path": "scripts/create_participant_manager_superadmin.sh", "diffHunk": "@@ -0,0 +1,66 @@\n+# Script to insert the first participant manager superadmin into auth server.\n+# Run like:\n+# $ ./scripts/create_participant_manager_superadmin.sh <email> <password>\n+\n+#!/bin/bash\n+\n+if [ \"$#\" -ne 2 ]; then\n+  echo 'Please provide email and password in the order of <email> <password>'\n+  exit 1\n+fi\n+\n+EMAIL=\"${1}\"\n+PWD=\"${2}\"\n+shift 2\n+\n+set -e\n+\n+DATA_PROJECT=${PREFIX}-${ENV}-data\n+SQL_IMPORT_BUCKET=${PREFIX}-${ENV}-mystudies-sql-import\n+\n+echo \"Inserting/updating superadmin user in 'oauth_server_hydra' database\"\n+echo \"USE \\`oauth_server_hydra\\`;\" >> ${TMPFILE}\n+\n+SALT=`printf \"%s\" uuidgen | iconv -t utf-8 | openssl dgst -sha512 | sed 's/^.* //'`\n+HASH=`printf \"%s%s\" $SALT $PWD | iconv -t utf-8 | openssl dgst -sha512 | sed 's/^.* //'`\n+DATE=`date -v +30d +\"%F %T\"`\n+TIMESTAMP=`date -d \"$DATE\" +'%s.%3N'`\n+\n+TMPFILE=$(mktemp)\n+\n+echo \"REPLACE into users (id, app_id, email, status, temp_reg_id, user_id, user_info)\n+  values(\n+  \\\"8ad16a8c74f823a10174f82c9a300001\\\",\n+  \\\"PARTICIPANT MANAGER\\\",\n+  \\\"${EMAIL}\\\",\n+  0,\n+  \\\"bd676334dd745c6afaa6547f9736a4c4df411a3ca2c4f514070daae31008cd9d\\\",\n+  \\\"96494ebc2ae5ac344437ec19bfc0b09267a876015b277e1f6e9bfc871f578508\\\",\n+  \\\"{\\\"password\\\": {\\\"hash\\\": \\\"${HASH}\\\", \\\"salt\\\": \\\"${SALT}\\\", \\\"expire_timestamp\\\":${TIMESTAMP}}, \\\"password_history\\\": [{\\\"hash\\\": \\\"${HASH}\\\", \\\"salt\\\": \\\"${SALT}\\\", \\\"expire_timestamp\\\":${TIMESTAMP}}]}\\\");\n+\" >> ${TMPFILE}\n+\n+\n+echo \"USE \\`mystudies_participant_datastore\\`;\" >> ${TMPFILE}\n+echo \"Insert default location\"\n+echo \"REPLACE INTO locations\n+  (id, custom_id, is_default, name, status)\n+VALUES\n+\t(\\\"1\\\", \\\"location1\\\", \\\"Y\\\", \\\"Default Location\\\", 1);\n+\" >> ${TMPFILE}\n+\n+echo \"Insert ur_admin_user record in 'mystudies_participant_datastore' database\"\n+echo \"REPLACE INTO ur_admin_user\n+  (id, created_by, email, first_name, location_permission, security_code, security_code_expire_date, status, super_admin, ur_admin_auth_id)\n+VALUES\n+  (\\\"c9d30d67-0477-4a8c-8490-0fa1e0300bd0\\\", \\\"1\\\", \\\"${EMAIL}\\\", \\\"Admin\\\", 1, \\\"af92f34e0ae6fc3c707446797b7db5b4be78ec699899061a448f8bc18990d75f\\\", \\\"2022-09-25 20:06:43\\\", 1, b'1', \\\"96494ebc2ae5ac344437ec19bfc0b09267a876015b277e1f6e9bfc871f578508\\\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "50d3a7e7272a09f624e64fbc611b684fac77032d"}, "originalPosition": 55}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "059fa019dfc7bafb4fb0f1f676398851c5e388c5", "author": {"user": {"login": "zohrehj", "name": "Zohreh Jabbari"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/059fa019dfc7bafb4fb0f1f676398851c5e388c5", "committedDate": "2020-10-16T17:26:57Z", "message": "Merge branch 'develop' into superadmin"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f19ab8a4aaa64d88cca8e212ecfede28d8d285bb", "author": {"user": {"login": "zohrehj", "name": "Zohreh Jabbari"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/f19ab8a4aaa64d88cca8e212ecfede28d8d285bb", "committedDate": "2020-10-19T14:35:30Z", "message": "Merge branch 'develop' into superadmin"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "de66fff06a029b747099b10ac8b19d885a078d17", "author": {"user": {"login": "zohrehj", "name": "Zohreh Jabbari"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/de66fff06a029b747099b10ac8b19d885a078d17", "committedDate": "2020-10-19T15:43:17Z", "message": "Update superadmin script to generate securityCode"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d3d7179c348a6710188b1cc541d4fca2afe7b23", "author": {"user": {"login": "zohrehj", "name": "Zohreh Jabbari"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/8d3d7179c348a6710188b1cc541d4fca2afe7b23", "committedDate": "2020-10-19T15:44:12Z", "message": "Merge branch 'develop' into superadmin"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTEyMDI4MjMy", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1235#pullrequestreview-512028232", "createdAt": "2020-10-19T18:04:49Z", "commit": {"oid": "8d3d7179c348a6710188b1cc541d4fca2afe7b23"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 195, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}