{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIzNTA3OTM2", "number": 2090, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQyMjoxOTowMlrOE6ympA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxNToyOToxMlrOE7G-sQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwMDgxOTU2OnYy", "diffSide": "RIGHT", "path": "deployment.hcl", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOFQyMjoxOTowMlrOH2En6Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQwNTozNzo0MlrOH2Neeg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQ2MDkwNQ==", "bodyText": "Should be inserted at line L605 so those permissions are added in the apps projects. Since the SAs are created in the same deployment, we need to ensure the permissions are granted after the SAs are created. To do that, we can use references to enforce the dependency. For example\ndo\n\"\"serviceAccount:$${google_service_account.auth_server_gke_sa.account_id}@{{$prefix}}-{{$env}}-apps.iam.gserviceaccount.com\"\ninstead of \"serviceAccount:auth-server-gke-sa@{{$prefix}}-{{$env}}-apps.iam.gserviceaccount.com\" directly.\nBe careful with the Terraform references should use _ instead of -", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2090#discussion_r526460905", "createdAt": "2020-11-18T22:19:02Z", "author": {"login": "xingao267"}, "path": "deployment.hcl", "diffHunk": "@@ -749,6 +749,19 @@ EOF\n           \"serviceAccount:participant-manager-gke-sa@{{$prefix}}-{{$env}}-apps.iam.gserviceaccount.com\",\n           \"serviceAccount:triggers-pubsub-handler-gke-sa@{{$prefix}}-{{$env}}-apps.iam.gserviceaccount.com\",\n         ]\n+        \"roles/logging.logWriter \" = [", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a951fc3fd04445ebcdc65e34c86ffa3384186792"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQ4Njc4MA==", "bodyText": "Done", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2090#discussion_r526486780", "createdAt": "2020-11-18T23:17:20Z", "author": {"login": "saminguyen"}, "path": "deployment.hcl", "diffHunk": "@@ -749,6 +749,19 @@ EOF\n           \"serviceAccount:participant-manager-gke-sa@{{$prefix}}-{{$env}}-apps.iam.gserviceaccount.com\",\n           \"serviceAccount:triggers-pubsub-handler-gke-sa@{{$prefix}}-{{$env}}-apps.iam.gserviceaccount.com\",\n         ]\n+        \"roles/logging.logWriter \" = [", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQ2MDkwNQ=="}, "originalCommit": {"oid": "a951fc3fd04445ebcdc65e34c86ffa3384186792"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjUwNzAwOQ==", "bodyText": "I guess we probably refer to the same file at different commit. Should be added after https://github.com/GoogleCloudPlatform/fda-mystudies/blob/develop/mystudies.hcl#L604", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2090#discussion_r526507009", "createdAt": "2020-11-19T00:12:34Z", "author": {"login": "xingao267"}, "path": "deployment.hcl", "diffHunk": "@@ -749,6 +749,19 @@ EOF\n           \"serviceAccount:participant-manager-gke-sa@{{$prefix}}-{{$env}}-apps.iam.gserviceaccount.com\",\n           \"serviceAccount:triggers-pubsub-handler-gke-sa@{{$prefix}}-{{$env}}-apps.iam.gserviceaccount.com\",\n         ]\n+        \"roles/logging.logWriter \" = [", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQ2MDkwNQ=="}, "originalCommit": {"oid": "a951fc3fd04445ebcdc65e34c86ffa3384186792"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjYwNTk0Ng==", "bodyText": "I think I finally got it.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2090#discussion_r526605946", "createdAt": "2020-11-19T05:37:42Z", "author": {"login": "saminguyen"}, "path": "deployment.hcl", "diffHunk": "@@ -749,6 +749,19 @@ EOF\n           \"serviceAccount:participant-manager-gke-sa@{{$prefix}}-{{$env}}-apps.iam.gserviceaccount.com\",\n           \"serviceAccount:triggers-pubsub-handler-gke-sa@{{$prefix}}-{{$env}}-apps.iam.gserviceaccount.com\",\n         ]\n+        \"roles/logging.logWriter \" = [", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQ2MDkwNQ=="}, "originalCommit": {"oid": "a951fc3fd04445ebcdc65e34c86ffa3384186792"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzMwNDE1NzkzOnYy", "diffSide": "RIGHT", "path": "mystudies.hcl", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxNToyOToxMlrOH2kJNw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xOVQxNzowODowNFrOH2o1vA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjk3NzMzNQ==", "bodyText": "Consider adding a comment why these IAM bindings are needed.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2090#discussion_r526977335", "createdAt": "2020-11-19T15:29:12Z", "author": {"login": "xingao267"}, "path": "mystudies.hcl", "diffHunk": "@@ -602,6 +602,19 @@ template \"project_apps\" {\n         { account_id = \"participant-manager-gke-sa\" },\n         { account_id = \"triggers-pubsub-handler-gke-sa\" },\n       ]\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "40744c4f72c4922be94dec0255b17a29f18bef24"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA1NDI2OA==", "bodyText": "Done", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2090#discussion_r527054268", "createdAt": "2020-11-19T17:08:04Z", "author": {"login": "saminguyen"}, "path": "mystudies.hcl", "diffHunk": "@@ -602,6 +602,19 @@ template \"project_apps\" {\n         { account_id = \"participant-manager-gke-sa\" },\n         { account_id = \"triggers-pubsub-handler-gke-sa\" },\n       ]\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjk3NzMzNQ=="}, "originalCommit": {"oid": "40744c4f72c4922be94dec0255b17a29f18bef24"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1578, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}