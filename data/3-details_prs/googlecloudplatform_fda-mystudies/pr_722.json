{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYyODM5NTU5", "number": 722, "title": "Participant Manager [PUT] /users/{userId}/profile endpoint implementation with integration tests.", "bodyText": "Participant Manager [PUT] /users/{userId}/profile endpoint implementation with integration tests.", "createdAt": "2020-08-04T15:25:59Z", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/722", "merged": true, "mergeCommit": {"oid": "d9d8d484a6ee269983ac619210d2609fe070ce18"}, "closed": true, "closedAt": "2020-08-19T16:20:35Z", "author": {"login": "madhurya-btc"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc7oQgpgH2gAyNDYyODM5NTU5OmYwNjZhZGRlOGYwYzJkYmE2NDQ4ZGFiNTMwNDRkMTQwMWRjMGMzMjE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdAeFiRAFqTQ3MDYzMDQ0Mg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f066adde8f0c2dba6448dab53044d1401dc0c321", "author": {"user": {"login": "madhurya-btc", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/f066adde8f0c2dba6448dab53044d1401dc0c321", "committedDate": "2020-08-04T15:21:51Z", "message": "Participant-manager: Update user profile implementation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "25de1c09c029d4c0a1bc202a71a5078ec86546cf", "author": {"user": {"login": "madhurya-btc", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/25de1c09c029d4c0a1bc202a71a5078ec86546cf", "committedDate": "2020-08-04T15:32:14Z", "message": "Compilation fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c6c2cfd86a6cccf9697dfd8f8526d9926c92921c", "author": {"user": {"login": "madhurya-btc", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/c6c2cfd86a6cccf9697dfd8f8526d9926c92921c", "committedDate": "2020-08-11T11:43:01Z", "message": "Merge branch 'participant-manager-get-sites' into particiapnt-manager-update-user-profile-API-implementation"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY1MzA1ODg3", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/722#pullrequestreview-465305887", "createdAt": "2020-08-11T18:04:31Z", "commit": {"oid": "c6c2cfd86a6cccf9697dfd8f8526d9926c92921c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQxODowNDozMVrOG_DQ7A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMVQxODowNzoyNFrOG_DXIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODc2Njk1Ng==", "bodyText": "create constants for these", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/722#discussion_r468766956", "createdAt": "2020-08-11T18:04:31Z", "author": {"login": "saminguyen"}, "path": "participant-manager-module/participant-manager-service/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/UserProfileControllerTest.java", "diffHunk": "@@ -151,6 +164,71 @@ public void shouldReturnUnauthorizedForUserDetailsBySecurityCode() throws Except\n             jsonPath(\"$.error_description\", is(ErrorCode.SECURITY_CODE_EXPIRED.getDescription())));\n   }\n \n+  @Test\n+  public void shouldUpdateUserProfile() throws Exception {\n+    // Step 1: Call API to update user profile\n+    HttpHeaders headers = testDataHelper.newCommonHeaders();\n+    mockMvc\n+        .perform(\n+            put(ApiEndpoint.UPDATE_USER_PROFILE.getPath(), userRegAdminEntity.getId())\n+                .content(asJsonString(getUserProfileRequest()))\n+                .headers(headers)\n+                .contextPath(getContextPath()))\n+        .andDo(print())\n+        .andExpect(status().isOk())\n+        .andExpect(jsonPath(\"$.message\", is(MessageCode.PROFILE_UPDATE_SUCCESS.getMessage())));\n+\n+    // Step 2: verify updated values\n+    Optional<UserRegAdminEntity> optUserRegAdminUser =\n+        userRegAdminRepository.findById(userRegAdminEntity.getId());\n+    UserRegAdminEntity userRegAdminEntity = optUserRegAdminUser.get();\n+    assertNotNull(userRegAdminEntity);\n+    assertEquals(\"mockit_email_updated@grr.la\", userRegAdminEntity.getEmail());\n+    assertEquals(\"mockito_updated\", userRegAdminEntity.getFirstName());\n+    assertEquals(\"mockito_updated_last_name\", userRegAdminEntity.getLastName());\n+  }\n+\n+  @Test\n+  public void shouldReturnUserNotExistsForUpdatedUserDetails() throws Exception {\n+    HttpHeaders headers = testDataHelper.newCommonHeaders();\n+    mockMvc\n+        .perform(\n+            put(ApiEndpoint.UPDATE_USER_PROFILE.getPath(), IdGenerator.id())\n+                .content(asJsonString(getUserProfileRequest()))\n+                .headers(headers)\n+                .contextPath(getContextPath()))\n+        .andDo(print())\n+        .andExpect(status().isUnauthorized())\n+        .andExpect(jsonPath(\"$.error_description\", is(ErrorCode.USER_NOT_EXISTS.getDescription())));\n+  }\n+\n+  @Test\n+  public void shouldReturnUserNotActiveForUpdatedUserDetails() throws Exception {\n+    // Step 1: change the status to inactive\n+    userRegAdminEntity.setStatus(CommonConstants.INACTIVE_STATUS);\n+    userRegAdminRepository.saveAndFlush(userRegAdminEntity);\n+\n+    // Step 2: Call API and expect error USER_NOT_ACTIVE\n+    HttpHeaders headers = testDataHelper.newCommonHeaders();\n+    mockMvc\n+        .perform(\n+            put(ApiEndpoint.UPDATE_USER_PROFILE.getPath(), userRegAdminEntity.getId())\n+                .content(asJsonString(getUserProfileRequest()))\n+                .headers(headers)\n+                .contextPath(getContextPath()))\n+        .andDo(print())\n+        .andExpect(status().isBadRequest())\n+        .andExpect(jsonPath(\"$.error_description\", is(ErrorCode.USER_NOT_ACTIVE.getDescription())));\n+  }\n+\n+  public UserProfileRequest getUserProfileRequest() {\n+    UserProfileRequest userProfileRequest = new UserProfileRequest();\n+    userProfileRequest.setFirstName(\"mockito_updated\");\n+    userProfileRequest.setLastName(\"mockito_updated_last_name\");\n+    userProfileRequest.setEmail(\"mockit_email_updated@grr.la\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c6c2cfd86a6cccf9697dfd8f8526d9926c92921c"}, "originalPosition": 92}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODc2ODQ0MQ==", "bodyText": "Please re-format the code, the imports are not in alphabetical order. All the java, org imports should be after the com.... section", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/722#discussion_r468768441", "createdAt": "2020-08-11T18:07:13Z", "author": {"login": "saminguyen"}, "path": "participant-manager-module/participant-manager-service/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/UserProfileControllerTest.java", "diffHunk": "@@ -1,13 +1,26 @@\n package com.google.cloud.healthcare.fdamystudies.controller;\n \n+import static com.google.cloud.healthcare.fdamystudies.common.JsonUtils.asJsonString;\n import static org.hamcrest.CoreMatchers.is;\n import static org.hamcrest.CoreMatchers.notNullValue;\n+import static org.junit.Assert.assertEquals;\n import static org.junit.jupiter.api.Assertions.assertNotNull;\n import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.put;\n import static org.springframework.test.web.servlet.result.MockMvcResultHandlers.print;\n import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.jsonPath;\n import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;\n \n+import java.sql.Timestamp;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c6c2cfd86a6cccf9697dfd8f8526d9926c92921c"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODc2ODU0NA==", "bodyText": "Should be done automatically by IDE?", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/722#discussion_r468768544", "createdAt": "2020-08-11T18:07:24Z", "author": {"login": "saminguyen"}, "path": "participant-manager-module/participant-manager-service/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/UserProfileControllerTest.java", "diffHunk": "@@ -1,13 +1,26 @@\n package com.google.cloud.healthcare.fdamystudies.controller;\n \n+import static com.google.cloud.healthcare.fdamystudies.common.JsonUtils.asJsonString;\n import static org.hamcrest.CoreMatchers.is;\n import static org.hamcrest.CoreMatchers.notNullValue;\n+import static org.junit.Assert.assertEquals;\n import static org.junit.jupiter.api.Assertions.assertNotNull;\n import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.put;\n import static org.springframework.test.web.servlet.result.MockMvcResultHandlers.print;\n import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.jsonPath;\n import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;\n \n+import java.sql.Timestamp;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODc2ODQ0MQ=="}, "originalCommit": {"oid": "c6c2cfd86a6cccf9697dfd8f8526d9926c92921c"}, "originalPosition": 14}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "744d6a6f224f1b3ba9c7da3501a1a95262766e12", "author": {"user": {"login": "madhurya-btc", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/744d6a6f224f1b3ba9c7da3501a1a95262766e12", "committedDate": "2020-08-12T10:40:56Z", "message": "import statements formatting"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2ODIwMTcz", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/722#pullrequestreview-466820173", "createdAt": "2020-08-13T14:31:33Z", "commit": {"oid": "744d6a6f224f1b3ba9c7da3501a1a95262766e12"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "20fa2d5d35d63257f95e07d9a4570924d4ddcca6", "author": {"user": {"login": "madhurya-btc", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/20fa2d5d35d63257f95e07d9a4570924d4ddcca6", "committedDate": "2020-08-14T06:04:04Z", "message": "passing UserRegAdminEntity from service layer to mapper"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a762906a59c850e515c4f151c24e669f15678f2e", "author": {"user": {"login": "madhurya-btc", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/a762906a59c850e515c4f151c24e669f15678f2e", "committedDate": "2020-08-14T10:37:25Z", "message": "Updating only first name and last name."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY3NzMzNDEw", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/722#pullrequestreview-467733410", "createdAt": "2020-08-14T17:04:44Z", "commit": {"oid": "a762906a59c850e515c4f151c24e669f15678f2e"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d0f71d8290b89764596ccc00b0f9b5e1b78d3db0", "author": {"user": {"login": "madhurya-btc", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/d0f71d8290b89764596ccc00b0f9b5e1b78d3db0", "committedDate": "2020-08-19T15:58:10Z", "message": "Merge branch 'develop' into particiapnt-manager-update-user-profile-API-implementation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eae7189a49d593ff0bc0980e8e9411410695d02b", "author": {"user": {"login": "madhurya-btc", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/eae7189a49d593ff0bc0980e8e9411410695d02b", "committedDate": "2020-08-19T16:05:40Z", "message": "Merge branch 'develop' of https://github.com/GoogleCloudPlatform/fda-mystudies into particiapnt-manager-update-user-profile-API-implementation\n\n# Conflicts:\n#\tcommon-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/common/MessageCode.java\n#\tparticipant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/beans/ParticipantStatusResponse.java\n#\tparticipant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/controller/SiteController.java\n#\tparticipant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/controller/UserProfileController.java\n#\tparticipant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/mapper/StudyMapper.java\n#\tparticipant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/service/SiteServiceImpl.java\n#\tparticipant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/service/UserProfileService.java\n#\tparticipant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/service/UserProfileServiceImpl.java\n#\tparticipant-manager-module/participant-manager-service/src/test/java/com/google/cloud/healthcare/fdamystudies/common/ApiEndpoint.java\n#\tparticipant-manager-module/participant-manager-service/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/SitesControllerTest.java\n#\tparticipant-manager-module/participant-manager-service/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/UserProfileControllerTest.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1fd35ce8d4312d6c69ee55a1f64105f668b53986", "author": {"user": {"login": "madhurya-btc", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/1fd35ce8d4312d6c69ee55a1f64105f668b53986", "committedDate": "2020-08-19T16:09:17Z", "message": "Merge branch 'particiapnt-manager-update-user-profile-API-implementation' of https://github.com/GoogleCloudPlatform/fda-mystudies into particiapnt-manager-update-user-profile-API-implementation\n\n# Conflicts:\n#\tcommon-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/common/MessageCode.java\n#\tparticipant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/beans/ParticipantStatusResponse.java\n#\tparticipant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/controller/SiteController.java\n#\tparticipant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/controller/UserProfileController.java\n#\tparticipant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/mapper/StudyMapper.java\n#\tparticipant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/service/UserProfileService.java\n#\tparticipant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/service/UserProfileServiceImpl.java\n#\tparticipant-manager-module/participant-manager-service/src/test/java/com/google/cloud/healthcare/fdamystudies/common/ApiEndpoint.java\n#\tparticipant-manager-module/participant-manager-service/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/UserProfileControllerTest.java"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "20282d2b47141b18d1f084950f245c9617e982b9", "author": {"user": {"login": "madhurya-btc", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/20282d2b47141b18d1f084950f245c9617e982b9", "committedDate": "2020-08-19T16:10:41Z", "message": "Merge issue fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcwNjMwNDQy", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/722#pullrequestreview-470630442", "createdAt": "2020-08-19T16:20:26Z", "commit": {"oid": "20282d2b47141b18d1f084950f245c9617e982b9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 617, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}