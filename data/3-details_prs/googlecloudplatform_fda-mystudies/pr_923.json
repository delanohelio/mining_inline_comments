{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDgyOTA0NzYz", "number": 923, "title": "Fixed Issue #905 Enroll Mgmt Module - Remove try/catch blocks from Controller/ServiceImpl classes to reuse GlobalExceptionHandler, RestExceptionHandler exception handlers", "bodyText": "Fixed Issue #905  Enroll Mgmt Module - Remove try/catch blocks from Controller/ServiceImpl classes to reuse GlobalExceptionHandler, RestExceptionHandler exception handlers.\nRemoved custom exceptions to reuse ErrorCodeException class.\nRemoved few audit log failure events.\nCode Format + Organize Imports, removed unused variables.", "createdAt": "2020-09-09T14:55:41Z", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/923", "merged": true, "mergeCommit": {"oid": "8caff23fdd169818747e858dc71f96bb17ce398e"}, "closed": true, "closedAt": "2020-09-15T14:36:43Z", "author": {"login": "harisboston"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdGzfE6gH2gAyNDgyOTA0NzYzOjVlYmJlN2U1ZTQzZDY4YWQ5NmE3MWIwYzRlYTVmMjFjOGIzNjc0OTM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdJIwGeAH2gAyNDgyOTA0NzYzOmEyNzYwOWZmOWY1OTgzZDI2N2UyNDFhOTFmODAyNWVmZWEwZjYyMjI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "5ebbe7e5e43d68ad96a71b0c4ea5f21c8b367493", "author": {"user": {"login": "harisboston", "name": "Haris Hasan"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/5ebbe7e5e43d68ad96a71b0c4ea5f21c8b367493", "committedDate": "2020-09-08T08:39:53Z", "message": "Removed Try Catch from service and controller layer to use RestExceptionHandler\n\nRemoved Try Catch from service and controller layer to use RestExceptionHandler,\ntest-green, format + organize import"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3a4ea3cc460b477502f6be2fa5f41b195093a60e", "author": {"user": {"login": "harisboston", "name": "Haris Hasan"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/3a4ea3cc460b477502f6be2fa5f41b195093a60e", "committedDate": "2020-09-09T14:48:02Z", "message": "removed try catch from controller, service, util\n\nremoved try catch from controller, service, util"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fca126efbf5f69953f470f3b76071b805a1026ad", "author": {"user": {"login": "harisboston", "name": "Haris Hasan"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/fca126efbf5f69953f470f3b76071b805a1026ad", "committedDate": "2020-09-09T15:02:13Z", "message": "Merge branch 'develop' into enroll-mgmt-exception-handling"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3ed6cd8d5da1218258161dcaa80361ea20a8cf28", "author": {"user": {"login": "harisboston", "name": "Haris Hasan"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/3ed6cd8d5da1218258161dcaa80361ea20a8cf28", "committedDate": "2020-09-10T14:33:46Z", "message": "Merge branch 'develop' into enroll-mgmt-exception-handling"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg2MzY0OTQz", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/923#pullrequestreview-486364943", "createdAt": "2020-09-10T22:54:31Z", "commit": {"oid": "3ed6cd8d5da1218258161dcaa80361ea20a8cf28"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQyMjo1NDozMVrOHQIcAQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0xMFQyMzoxNjowNFrOHQI2vg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjY3NzUwNQ==", "bodyText": "keep this log event if required - catch and rethrow the error", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/923#discussion_r486677505", "createdAt": "2020-09-10T22:54:31Z", "author": {"login": "saminguyen"}, "path": "user-registration-server-ws/enroll-mgmt-module/enroll-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/util/EnrollmentManagementUtil.java", "diffHunk": "@@ -144,95 +138,63 @@ public String getParticipantId(\n       String applicationId,\n       String hashedTokenValue,\n       String studyId,\n-      AuditLogEventRequest auditRequest)\n-      throws InvalidRequestException, UnAuthorizedRequestException, SystemException {\n+      AuditLogEventRequest auditRequest) {\n     logger.info(\"EnrollmentManagementUtil getParticipantId() - starts \");\n     HttpHeaders headers = null;\n     EnrollmentBodyProvider bodyProvider = null;\n     HttpEntity<EnrollmentBodyProvider> requestBody = null;\n     ResponseEntity<?> responseEntity = null;\n     String participantId = \"\";\n-    try {\n-      headers = new HttpHeaders();\n-      headers.setContentType(MediaType.APPLICATION_JSON);\n-      headers.set(\"applicationId\", applicationId);\n-      headers.set(\"Authorization\", \"Bearer \" + oAuthService.getAccessToken());\n-      bodyProvider = new EnrollmentBodyProvider();\n-      bodyProvider.setTokenIdentifier(hashedTokenValue);\n-      bodyProvider.setCustomStudyId(studyId);\n-      requestBody = new HttpEntity<>(bodyProvider, headers);\n-      responseEntity =\n-          restTemplate.postForEntity(appConfig.getAddParticipantId(), requestBody, String.class);\n-      if (responseEntity.getStatusCode() == HttpStatus.OK) {\n-        participantId = (String) responseEntity.getBody();\n-        auditRequest.setParticipantId(participantId);\n-\n-        enrollAuditEventHelper.logEvent(PARTICIPANT_ID_RECEIVED, auditRequest);\n-      }\n-\n-    } catch (RestClientResponseException e) {\n-\n-      if (e.getRawStatusCode() == 401) {\n-        throw new UnAuthorizedRequestException();\n-      } else if (e.getRawStatusCode() == 400) {\n-        throw new InvalidRequestException();\n-      } else {\n-        throw new SystemException();\n-      }\n-    } catch (Exception e) {\n-\n-      enrollAuditEventHelper.logEvent(PARTICIPANT_ID_NOT_RECEIVED, auditRequest);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ed6cd8d5da1218258161dcaa80361ea20a8cf28"}, "originalPosition": 80}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjY4MDMwOA==", "bodyText": "if you do add back the audit log event, make sure to re-include this as well", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/923#discussion_r486680308", "createdAt": "2020-09-10T23:03:20Z", "author": {"login": "saminguyen"}, "path": "user-registration-server-ws/enroll-mgmt-module/enroll-mgmt/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/tests/StudyStateControllerTest.java", "diffHunk": "@@ -233,9 +224,7 @@ public void getStudyStateUnauthorizedUserId() throws Exception {\n                 .headers(headers)\n                 .contextPath(getContextPath()))\n         .andDo(print())\n-        .andExpect(status().isUnauthorized());\n-\n-    verifyAuditEventCall(READ_OPERATION_FAILED_FOR_STUDY_INFO);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ed6cd8d5da1218258161dcaa80361ea20a8cf28"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjY4NDM1MA==", "bodyText": "Is this due to a change in the list of audit log events? Why deleting this here?", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/923#discussion_r486684350", "createdAt": "2020-09-10T23:16:04Z", "author": {"login": "saminguyen"}, "path": "user-registration-server-ws/enroll-mgmt-module/enroll-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/controller/EnrollmentTokenController.java", "diffHunk": "@@ -308,34 +284,9 @@ else if (enrollmentTokenfService.enrollmentTokenRequired(enrollmentBean.getStudy\n           ErrorResponseUtil.ErrorCodes.INVALID_INPUT.getValue(),\n           ErrorResponseUtil.ErrorCodes.INVALID_INPUT_ERROR_MSG.getValue(),\n           response);\n-\n-      enrollAuditEventHelper.logEvent(STUDY_ENROLLMENT_FAILED, auditRequest);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3ed6cd8d5da1218258161dcaa80361ea20a8cf28"}, "originalPosition": 369}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "27058ac5deb861dfdcf11d1de2ec1643e7d8457c", "author": {"user": {"login": "harisboston", "name": "Haris Hasan"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/27058ac5deb861dfdcf11d1de2ec1643e7d8457c", "committedDate": "2020-09-11T15:26:32Z", "message": "Added auditlog for failed conditions\n\nAdded auditlog for failed conditions"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg4MzI0MDMx", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/923#pullrequestreview-488324031", "createdAt": "2020-09-15T04:55:10Z", "commit": {"oid": "27058ac5deb861dfdcf11d1de2ec1643e7d8457c"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "654258e6552c3f72c125a303dceabb1ffac7b487", "author": {"user": {"login": "harisboston", "name": "Haris Hasan"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/654258e6552c3f72c125a303dceabb1ffac7b487", "committedDate": "2020-09-15T06:01:28Z", "message": "Merge branch 'develop' into enroll-mgmt-exception-handling"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5cb19b636ea125145936ed1b852203629ccca636", "author": {"user": {"login": "harisboston", "name": "Haris Hasan"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/5cb19b636ea125145936ed1b852203629ccca636", "committedDate": "2020-09-15T06:33:49Z", "message": "removed throws SystemException, InvalidUserIdException\n\nthrows SystemException, InvalidUserIdException, since it was causing build issue."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDg4NzAyMzc0", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/923#pullrequestreview-488702374", "createdAt": "2020-09-15T13:48:12Z", "commit": {"oid": "5cb19b636ea125145936ed1b852203629ccca636"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a27609ff9f5983d267e241a91f8025efea0f6222", "author": {"user": {"login": "harisboston", "name": "Haris Hasan"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/a27609ff9f5983d267e241a91f8025efea0f6222", "committedDate": "2020-09-15T14:34:20Z", "message": "Merge branch 'develop' into enroll-mgmt-exception-handling"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 499, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}