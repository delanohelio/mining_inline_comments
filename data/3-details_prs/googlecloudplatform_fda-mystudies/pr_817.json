{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc0MTI2MTE5", "number": 817, "title": "Implement postAuditLogEvent in common-service", "bodyText": "postAuditLog implementation using Google Cloud Logging client library.", "createdAt": "2020-08-26T20:06:42Z", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/817", "merged": true, "mergeCommit": {"oid": "30b285fe25a2b508f8e8471740b1130a67e7277a"}, "closed": true, "closedAt": "2020-08-31T15:19:43Z", "author": {"login": "saminguyen"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdCeJ4rAH2gAyNDc0MTI2MTE5Ojc1MjAwYmQ4N2ZjZjM3OGJiNTg2MmZmZDc2MDk1MzEzZjdlYmFmOTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdEUP6igH2gAyNDc0MTI2MTE5OmQ5NzM5ZDE4NDgxODBjNTlhYzFjNGY3MmExNGQzMGU1MjlmNjJjYWI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "75200bd87fcf378bb5862ffd76095313f7ebaf94", "author": {"user": {"login": "saminguyen", "name": "Sami Nguyen"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/75200bd87fcf378bb5862ffd76095313f7ebaf94", "committedDate": "2020-08-25T21:33:02Z", "message": "implement postAuditLogEvent in common-service"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc2OTEwNjQ1", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/817#pullrequestreview-476910645", "createdAt": "2020-08-27T16:55:33Z", "commit": {"oid": "75200bd87fcf378bb5862ffd76095313f7ebaf94"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxNjo1NTozM1rOHIZHuw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QxNjo1NTozM1rOHIZHuw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODU2MjIzNQ==", "bodyText": "nit: you have  kept the logger.entry, but removed logger.exit. let's add them consistently.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/817#discussion_r478562235", "createdAt": "2020-08-27T16:55:33Z", "author": {"login": "zohrehj"}, "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/service/AuditEventServiceImpl.java", "diffHunk": "@@ -26,15 +30,26 @@\n \n   private XLogger logger = XLoggerFactory.getXLogger(AuditEventServiceImpl.class.getName());\n \n+  private static final String AUDIT_LOG_NAME = \"application-audit-log\";\n+\n   @Override\n   public void postAuditLogEvent(AuditLogEventRequest auditRequest) {\n     logger.entry(\n         String.format(\"begin postAuditLogEvent() for %s event\", auditRequest.getEventCode()));\n \n-    JsonNode requestBody = getObjectMapper().convertValue(auditRequest, JsonNode.class);\n+    Logging logging = LoggingOptions.getDefaultInstance().getService();\n+\n+    // The data to write to the log\n+    Map<String, Object> jsonPayloadMap = getObjectMapper().convertValue(auditRequest, Map.class);\n+\n+    LogEntry entry = LogEntry.newBuilder(Payload.JsonPayload.of(jsonPayloadMap))\n+            .setTimestamp(auditRequest.getOccured().getTime())\n+            .setSeverity(Severity.INFO)\n+            .setLogName(AUDIT_LOG_NAME)\n+            .setResource(MonitoredResource.newBuilder(\"global\").build())\n+            .build();\n \n-    // TODO (#703) integration with GCP stackdriver. Please remove the requestBody from below logger\n-    // statement during stackdriver integration as it may contain PII information.\n-    logger.exit(String.format(\"audit request=%s\", requestBody));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "75200bd87fcf378bb5862ffd76095313f7ebaf94"}, "originalPosition": 45}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f29a57df04a8c78a90a25322943f199f0f2db87c", "author": {"user": {"login": "saminguyen", "name": "Sami Nguyen"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/f29a57df04a8c78a90a25322943f199f0f2db87c", "committedDate": "2020-08-27T21:17:52Z", "message": "added logger exit message"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9304ad847da1e4df1a5a80dce4e318325cb20b8a", "author": {"user": {"login": "saminguyen", "name": "Sami Nguyen"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/9304ad847da1e4df1a5a80dce4e318325cb20b8a", "committedDate": "2020-08-27T21:22:19Z", "message": "Merge branch 'develop' into common-service-auditlog"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4d17c46c1d4eb1b3112f0943dec8b69d5b57876b", "author": {"user": {"login": "saminguyen", "name": "Sami Nguyen"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/4d17c46c1d4eb1b3112f0943dec8b69d5b57876b", "committedDate": "2020-08-28T21:21:48Z", "message": "Merge branch 'develop' into common-service-auditlog"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3b491976ed0cafc566f5e50f6775ac862c29e706", "author": {"user": {"login": "saminguyen", "name": "Sami Nguyen"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/3b491976ed0cafc566f5e50f6775ac862c29e706", "committedDate": "2020-08-28T21:22:32Z", "message": "build error fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f2349a3456015414662ad462bea6017bf23b2ceb", "author": {"user": {"login": "saminguyen", "name": "Sami Nguyen"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/f2349a3456015414662ad462bea6017bf23b2ceb", "committedDate": "2020-08-28T21:23:51Z", "message": "Merge branch 'common-service-auditlog' of https://github.com/GoogleCloudPlatform/fda-mystudies into common-service-auditlog"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4Njg4MDcw", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/817#pullrequestreview-478688070", "createdAt": "2020-08-31T14:55:21Z", "commit": {"oid": "f2349a3456015414662ad462bea6017bf23b2ceb"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cc2105c7d9028868dc02f060a5a8a575ead4674b", "author": {"user": {"login": "saminguyen", "name": "Sami Nguyen"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/cc2105c7d9028868dc02f060a5a8a575ead4674b", "committedDate": "2020-08-31T14:59:44Z", "message": "Merge branch 'develop' into common-service-auditlog"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d9739d1848180c59ac1c4f72a14d30e529f62cab", "author": {"user": {"login": "saminguyen", "name": "Sami Nguyen"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/d9739d1848180c59ac1c4f72a14d30e529f62cab", "committedDate": "2020-08-31T15:08:25Z", "message": "Merge branch 'develop' into common-service-auditlog"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 378, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}