{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ0NzUzNjEy", "number": 595, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQxNjoxMTozOVrOEOVBrw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQxNjoxMzowOFrOEOVEEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzNDYwMDE1OnYy", "diffSide": "RIGHT", "path": "iOS/HPHC/HPHC/AppDelegate.swift", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQxNjoxMTozOVrOGxa2sA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNlQxNjozMzo0OVrOGyzFtQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQ3MzM5Mg==", "bodyText": "should completion handler only run when application state is active or backgroud?\nWhat are the states that this should not run in?", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/595#discussion_r454473392", "createdAt": "2020-07-14T16:11:39Z", "author": {"login": "zohrehj"}, "path": "iOS/HPHC/HPHC/AppDelegate.swift", "diffHunk": "@@ -1757,12 +1758,9 @@ extension AppDelegate: UNUserNotificationCenterDelegate {\n       self.updateNotification()\n \n     } else {\n-      if UIApplication.shared.applicationState == UIApplication.State.background\n-        || (UIApplication.shared.applicationState == UIApplication.State.inactive)\n-      {\n-        self.handleLocalNotification(userInfoDetails: (userInfo as? [String: Any])!)\n-      }\n+      self.handleLocalNotification(userInfoDetails: userInfo as? JSONDictionary ?? [:])\n     }\n+    completionHandler()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d609b3b3122261843cbfb559947c4c426327516d"}, "originalPosition": 95}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDkyODI3MA==", "bodyText": "It should be called at the end after performing other tasks on the same thread irrespective of state.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/595#discussion_r454928270", "createdAt": "2020-07-15T09:46:22Z", "author": {"login": "tushar-boston"}, "path": "iOS/HPHC/HPHC/AppDelegate.swift", "diffHunk": "@@ -1757,12 +1758,9 @@ extension AppDelegate: UNUserNotificationCenterDelegate {\n       self.updateNotification()\n \n     } else {\n-      if UIApplication.shared.applicationState == UIApplication.State.background\n-        || (UIApplication.shared.applicationState == UIApplication.State.inactive)\n-      {\n-        self.handleLocalNotification(userInfoDetails: (userInfo as? [String: Any])!)\n-      }\n+      self.handleLocalNotification(userInfoDetails: userInfo as? JSONDictionary ?? [:])\n     }\n+    completionHandler()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQ3MzM5Mg=="}, "originalCommit": {"oid": "d609b3b3122261843cbfb559947c4c426327516d"}, "originalPosition": 95}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTI0Mzg5OA==", "bodyText": "then maybe move it outside of the initial if", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/595#discussion_r455243898", "createdAt": "2020-07-15T18:07:37Z", "author": {"login": "zohrehj"}, "path": "iOS/HPHC/HPHC/AppDelegate.swift", "diffHunk": "@@ -1757,12 +1758,9 @@ extension AppDelegate: UNUserNotificationCenterDelegate {\n       self.updateNotification()\n \n     } else {\n-      if UIApplication.shared.applicationState == UIApplication.State.background\n-        || (UIApplication.shared.applicationState == UIApplication.State.inactive)\n-      {\n-        self.handleLocalNotification(userInfoDetails: (userInfo as? [String: Any])!)\n-      }\n+      self.handleLocalNotification(userInfoDetails: userInfo as? JSONDictionary ?? [:])\n     }\n+    completionHandler()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQ3MzM5Mg=="}, "originalCommit": {"oid": "d609b3b3122261843cbfb559947c4c426327516d"}, "originalPosition": 95}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTkxOTAyOQ==", "bodyText": "It's outside only on the main function block and getting called at the end.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/595#discussion_r455919029", "createdAt": "2020-07-16T16:33:49Z", "author": {"login": "tushar-boston"}, "path": "iOS/HPHC/HPHC/AppDelegate.swift", "diffHunk": "@@ -1757,12 +1758,9 @@ extension AppDelegate: UNUserNotificationCenterDelegate {\n       self.updateNotification()\n \n     } else {\n-      if UIApplication.shared.applicationState == UIApplication.State.background\n-        || (UIApplication.shared.applicationState == UIApplication.State.inactive)\n-      {\n-        self.handleLocalNotification(userInfoDetails: (userInfo as? [String: Any])!)\n-      }\n+      self.handleLocalNotification(userInfoDetails: userInfo as? JSONDictionary ?? [:])\n     }\n+    completionHandler()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQ3MzM5Mg=="}, "originalCommit": {"oid": "d609b3b3122261843cbfb559947c4c426327516d"}, "originalPosition": 95}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgzNDYwNjI1OnYy", "diffSide": "RIGHT", "path": "iOS/HPHC/HPHC/Controllers/StudyUI/ActivityUI/ActivitiesViewController.swift", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNFQxNjoxMzowOFrOGxa6cQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xNVQwOTo0Nzo0MFrOGx2qoA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQ3NDM1Mw==", "bodyText": "what happens if tableViewSections[0] does not exist? i.e. tableViewSections is null or empty?", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/595#discussion_r454474353", "createdAt": "2020-07-14T16:13:08Z", "author": {"login": "zohrehj"}, "path": "iOS/HPHC/HPHC/Controllers/StudyUI/ActivityUI/ActivitiesViewController.swift", "diffHunk": "@@ -214,23 +214,27 @@ class ActivitiesViewController: UIViewController {\n \n     } else {\n       /// check if user navigated from notification\n-      if NotificationHandler.instance.activityId.count > 0 {\n-\n-        let activityId = NotificationHandler.instance.activityId\n-\n-        let rowDetail = tableViewSections[0]\n-        let activities = (rowDetail[\"activities\"] as? [Activity])!\n-        let index = activities.firstIndex(where: { $0.actvityId == activityId })\n-        let ip = IndexPath.init(row: index!, section: 0)\n-        self.selectedIndexPath = ip\n-        self.tableView?.selectRow(at: ip, animated: true, scrollPosition: .middle)\n-        self.tableView?.delegate?.tableView!(self.tableView!, didSelectRowAt: ip)\n-\n-        NotificationHandler.instance.activityId = \"\"\n+      if !NotificationHandler.instance.activityId.isEmpty {\n+        userDidNavigateFromNotification()\n       }\n     }\n   }\n \n+  func userDidNavigateFromNotification() {\n+    let activityId = NotificationHandler.instance.activityId\n+    let rowDetail = tableViewSections[0]\n+    let activities = rowDetail[\"activities\"] as? [Activity] ?? []", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "d609b3b3122261843cbfb559947c4c426327516d"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDkyOTA1Ng==", "bodyText": "tableViewSections is hardcoded. However, there's a possibility of empty rowDetail for which I've added the proper checks.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/595#discussion_r454929056", "createdAt": "2020-07-15T09:47:40Z", "author": {"login": "tushar-boston"}, "path": "iOS/HPHC/HPHC/Controllers/StudyUI/ActivityUI/ActivitiesViewController.swift", "diffHunk": "@@ -214,23 +214,27 @@ class ActivitiesViewController: UIViewController {\n \n     } else {\n       /// check if user navigated from notification\n-      if NotificationHandler.instance.activityId.count > 0 {\n-\n-        let activityId = NotificationHandler.instance.activityId\n-\n-        let rowDetail = tableViewSections[0]\n-        let activities = (rowDetail[\"activities\"] as? [Activity])!\n-        let index = activities.firstIndex(where: { $0.actvityId == activityId })\n-        let ip = IndexPath.init(row: index!, section: 0)\n-        self.selectedIndexPath = ip\n-        self.tableView?.selectRow(at: ip, animated: true, scrollPosition: .middle)\n-        self.tableView?.delegate?.tableView!(self.tableView!, didSelectRowAt: ip)\n-\n-        NotificationHandler.instance.activityId = \"\"\n+      if !NotificationHandler.instance.activityId.isEmpty {\n+        userDidNavigateFromNotification()\n       }\n     }\n   }\n \n+  func userDidNavigateFromNotification() {\n+    let activityId = NotificationHandler.instance.activityId\n+    let rowDetail = tableViewSections[0]\n+    let activities = rowDetail[\"activities\"] as? [Activity] ?? []", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDQ3NDM1Mw=="}, "originalCommit": {"oid": "d609b3b3122261843cbfb559947c4c426327516d"}, "originalPosition": 26}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2259, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}