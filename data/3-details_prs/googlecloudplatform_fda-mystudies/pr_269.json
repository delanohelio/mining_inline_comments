{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDEwODM5MDQ0", "number": 269, "title": "Populate an answer for the dummy SUM question.", "bodyText": "This allows us to hide the dummy SUM question from user.", "createdAt": "2020-04-29T17:05:38Z", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/269", "merged": true, "mergeCommit": {"oid": "c209a169d4901ee8c230aefe0ebaac5b6c69f910"}, "closed": true, "closedAt": "2020-04-29T21:33:10Z", "author": {"login": "kuoyuchi"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcbQE7VAH2gAyNDEwODM5MDQ0OmQzM2ZmMjAyMWNlMmE3ZGU5YjZhZmNiZGRlNjdmOTJlZDExMzk3OTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABccfQXvAH2gAyNDEwODM5MDQ0OjQ0MTc1ZDYyZjMxN2FmNzk4ZGQzMjM4NTYzZGUzOTc5NWUyMjdjMWI=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d33ff2021ce2a7de9b6afcbdde67f92ed1139794", "author": {"user": {"login": "kuoyuchi", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/d33ff2021ce2a7de9b6afcbdde67f92ed1139794", "committedDate": "2020-04-26T01:05:54Z", "message": "populate an answer for the dummy SUM question."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0ac92b4a358474e23917ff909336c62469111335", "author": {"user": {"login": "kuoyuchi", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/0ac92b4a358474e23917ff909336c62469111335", "committedDate": "2020-04-29T17:07:49Z", "message": "Remove debug logs and add comments."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDAyODg4OTc3", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/269#pullrequestreview-402888977", "createdAt": "2020-04-29T17:34:09Z", "commit": {"oid": "0ac92b4a358474e23917ff909336c62469111335"}, "state": "APPROVED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQxNzozNDowOVrOGOJnpg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yOVQxNzo1MTo1N1rOGOKS4Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzQ5MDg1NA==", "bodyText": "can you explain why we need this case?", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/269#discussion_r417490854", "createdAt": "2020-04-29T17:34:09Z", "author": {"login": "zohrehj"}, "path": "response-server-ws/src/main/java/com/google/cloud/healthcare/fdamystudies/service/ActivityResponseProcessorServiceImpl.java", "diffHunk": "@@ -160,12 +160,46 @@ private void processActivityResponses(\n         plugInMetadataToResponses(activityMetadataBeanFromWCP, responseBean, false);\n       }\n     }\n+    if (scoreSumResponseBean == null) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0ac92b4a358474e23917ff909336c62469111335"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzQ5NzI5Ng==", "bodyText": "this would overwrite the responseBean if there are multiple matches found.\nSo it clearly expects only a single match; so maybe the method should fail if there are in fact more than a single match?", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/269#discussion_r417497296", "createdAt": "2020-04-29T17:44:46Z", "author": {"login": "zohrehj"}, "path": "response-server-ws/src/main/java/com/google/cloud/healthcare/fdamystudies/service/ActivityResponseProcessorServiceImpl.java", "diffHunk": "@@ -160,12 +160,46 @@ private void processActivityResponses(\n         plugInMetadataToResponses(activityMetadataBeanFromWCP, responseBean, false);\n       }\n     }\n+    if (scoreSumResponseBean == null) {\n+      // Try to create a response for the dummy sum question by copying from metadata.\n+      scoreSumResponseBean =\n+          maybeCreateDummySumResponseFromMetadata(activityMetadataBeanFromWCP);\n+      if (scoreSumResponseBean != null) {\n+        // If copying is successful, add it to the list of responses.\n+        questionnaireResponses.add(scoreSumResponseBean);\n+      }\n+    }\n     if (scoreSumResponseBean != null) {\n       // Iterate through responses for a second pass to calculate the score sum if the dummy sum question presents.\n       calculateScoreSum(questionnaireResponses,scoreSumResponseBean);\n     }\n   }\n \n+  // Returns an empty response with metadata copied from the dummy sum question, or null if the dummy sum question is not found in metadata.\n+  private static QuestionnaireActivityStepsBean maybeCreateDummySumResponseFromMetadata(\n+      List<QuestionnaireActivityStepsBean> activityMetadataBeanFromWCP) {\n+    List<QuestionnaireActivityStepsBean> metadataMatchList = \n+          activityMetadataBeanFromWCP\n+              .stream()\n+              .filter(QuestionnaireActivityStepsBeanPredicate.questionKeyMatch(\n+                  AppConstants.DUMMY_SUM_QUESTION_KEY))\n+              .collect(Collectors.<QuestionnaireActivityStepsBean>toList());\n+    // Return null if dummy sum question is not found from metadata.\n+    if (metadataMatchList == null || metadataMatchList.isEmpty()) return null;\n+    // Otherwise, create a new entry and copy contents from metadata.\n+    QuestionnaireActivityStepsBean responseBean = new QuestionnaireActivityStepsBean();\n+    for (QuestionnaireActivityStepsBean metadataMatchBean : metadataMatchList) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0ac92b4a358474e23917ff909336c62469111335"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzUwMTkyMQ==", "bodyText": "i.e. what's the scenario where dummy sum question has been added to the questionnaire but the response is not found in the loop above.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/269#discussion_r417501921", "createdAt": "2020-04-29T17:51:57Z", "author": {"login": "zohrehj"}, "path": "response-server-ws/src/main/java/com/google/cloud/healthcare/fdamystudies/service/ActivityResponseProcessorServiceImpl.java", "diffHunk": "@@ -160,12 +160,46 @@ private void processActivityResponses(\n         plugInMetadataToResponses(activityMetadataBeanFromWCP, responseBean, false);\n       }\n     }\n+    if (scoreSumResponseBean == null) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzQ5MDg1NA=="}, "originalCommit": {"oid": "0ac92b4a358474e23917ff909336c62469111335"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1dd4fc821b83d666be8f71f28ee910207797c5ef", "author": {"user": {"login": "kuoyuchi", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/1dd4fc821b83d666be8f71f28ee910207797c5ef", "committedDate": "2020-04-29T20:02:03Z", "message": "Check for matched metadata to be exactly 1."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "81c22d61b14dd68524472610e2598494444f4957", "author": {"user": {"login": "kuoyuchi", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/81c22d61b14dd68524472610e2598494444f4957", "committedDate": "2020-04-29T20:04:05Z", "message": "Merge branch 'early-access' into sum-question-hide"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "44175d62f317af798dd3238563de39795e227c1b", "author": {"user": {"login": "kuoyuchi", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/44175d62f317af798dd3238563de39795e227c1b", "committedDate": "2020-04-29T21:20:54Z", "message": "Merge branch 'early-access' into sum-question-hide"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1185, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}