{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI4NDE3Mzcx", "number": 454, "title": "Studybuilder app not handling version info for apps with different appId", "bodyText": "Issue fix for Studybuilder app not handling version info for apps with different appId #408", "createdAt": "2020-06-05T12:22:54Z", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/454", "merged": true, "mergeCommit": {"oid": "be6b5a462d9a7b34e7379cc900295a335a2b8ab1"}, "closed": true, "closedAt": "2020-06-08T06:19:33Z", "author": {"login": "aswinijena100"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcoRtPLgH2gAyNDI4NDE3MzcxOjFiZmI2YTg4ZjdjOGYwNzBkY2U5NzQ4M2Y5NDBmNDlmNTY4Yzk1NGE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcpKS0bgH2gAyNDI4NDE3MzcxOmIzMWYzY2ExMDQ3YmY5ZjhlMjIxMzA3OWMzMTdiNzM3NGVkZmQwYzc=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "1bfb6a88f7c8f070dce97483f940f49f568c954a", "author": {"user": {"login": "aswinijena100", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/1bfb6a88f7c8f070dce97483f940f49f568c954a", "committedDate": "2020-06-05T12:20:51Z", "message": "code commit for wcp not handling version info issue fix"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1MzA0NDgz", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/454#pullrequestreview-425304483", "createdAt": "2020-06-05T13:36:16Z", "commit": {"oid": "1bfb6a88f7c8f070dce97483f940f49f568c954a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQxMzozNjoxN1rOGfuxTg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQxMzozNjoxN1rOGfuxTg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTkyNTMyNg==", "bodyText": "moving this to the the top as an early exit would reduce code nesting be one level, i.e.\nif (appVersionInfo == null) {\n     return null;\n}\n// the rest of the code does not need to be in an else block.\nandroid.setLatestVersion(appVersionInfo.getAndroidVersion());\n...", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/454#discussion_r435925326", "createdAt": "2020-06-05T13:36:17Z", "author": {"login": "zohrehj"}, "path": "WCP-WS/src/main/java/com/hphc/mystudies/integration/AppMetaDataOrchestration.java", "diffHunk": "@@ -121,27 +121,44 @@ public String updateAppVersionDetails(\n     return updateAppVersionResponse;\n   }\n \n-  public AppVersionInfoBean getAppVersionInfo() {\n+  public AppVersionInfoBean getAppVersionInfo(String appId, String orgId) {\n     LOGGER.info(\"INFO: AppMetaDataOrchestration - getAppVersionInfo() :: Starts\");\n \n-    AppVersionInfoBean aAppVersionInfoBean = new AppVersionInfoBean();\n+    AppVersionInfoBean aAppVersionInfoBean;\n     AppVersionInfo appVersionInfo = null;\n     DeviceVersion android = new DeviceVersion();\n     DeviceVersion ios = new DeviceVersion();\n \n-    appVersionInfo = appMetaDataDao.getAppVersionInfo();\n+    appVersionInfo = appMetaDataDao.getAppVersionInfo(appId, orgId);\n \n-    android.setLatestVersion(appVersionInfo.getAndroidVersion());\n-    android.setForceUpdate(\"true\");\n+    if (appVersionInfo != null) {\n+      android.setLatestVersion(appVersionInfo.getAndroidVersion());\n \n-    ios.setForceUpdate(\"true\");\n-    ios.setLatestVersion(appVersionInfo.getIosVersion());\n+      if (appVersionInfo.getAndroidForceUpdate() != null\n+          && appVersionInfo.getAndroidForceUpdate()) {\n+        android.setForceUpdate(\"true\");\n+      } else {\n+        android.setForceUpdate(\"false\");\n+      }\n+\n+      if (appVersionInfo.getIosForceUpdate() != null && appVersionInfo.getIosForceUpdate()) {\n+        ios.setForceUpdate(\"true\");\n+      } else {\n+        ios.setForceUpdate(\"false\");\n+      }\n \n-    aAppVersionInfoBean.setAndroid(android);\n-    aAppVersionInfoBean.setIos(ios);\n+      ios.setLatestVersion(appVersionInfo.getIosVersion());\n \n-    LOGGER.info(\"INFO: AppMetaDataOrchestration - getAppVersionInfo() :: Ends\");\n-    return aAppVersionInfoBean;\n+      aAppVersionInfoBean = new AppVersionInfoBean();\n+      aAppVersionInfoBean.setAndroid(android);\n+      aAppVersionInfoBean.setIos(ios);\n+\n+      LOGGER.info(\"INFO: AppMetaDataOrchestration - getAppVersionInfo() :: Ends\");\n+      return aAppVersionInfoBean;\n+    } else {\n+      LOGGER.info(\"INFO: AppMetaDataOrchestration - getAppVersionInfo() :: Ends\");\n+      return null;\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1bfb6a88f7c8f070dce97483f940f49f568c954a"}, "originalPosition": 52}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1MzEzMjE2", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/454#pullrequestreview-425313216", "createdAt": "2020-06-05T13:46:15Z", "commit": {"oid": "1bfb6a88f7c8f070dce97483f940f49f568c954a"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQxMzo0NjoxNVrOGfvJtA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQxMzo0NjoxNVrOGfvJtA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTkzMTU3Mg==", "bodyText": "this case can be moved outside of the try block if you revert the initial condition, i.e.\nif (!StringUtils.isNotEmpty(appId) || !StringUtils.isNotEmpty(orgId)) {\n  StudyMetaDataUtil.getFailureResponse(\n            ErrorCodes.STATUS_102,\n            ErrorCodes.UNKNOWN,\n            StudyMetaDataConstants.INVALID_INPUT_ERROR_MSG,\n            response);\n        return Response.status(Response.Status.NOT_FOUND)\n            .entity(StudyMetaDataConstants.INVALID_INPUT)\n            .build();\n}\n\ntry {\n  appVersionInfoBean = appMetaDataOrchestration.getAppVersionInfo(appId, orgId);\n        if (appVersionInfoBean == null) {\n          StudyMetaDataUtil.getFailureResponse(\n              ErrorCodes.STATUS_103, ErrorCodes.NO_DATA, StudyMetaDataConstants.FAILURE, response);\n          return Response.status(Response.Status.NOT_FOUND)\n              .entity(StudyMetaDataConstants.NO_RECORD)\n              .build();\n        }\n} catch (Exception e) {\n      LOGGER.error(\"ERROR: StudyMetaDataService - getAppVersionInfo()\", e);\n      return Response.status(Response.Status.INTERNAL_SERVER_ERROR)\n          .entity(StudyMetaDataConstants.FAILURE)\n          .build();\n    }", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/454#discussion_r435931572", "createdAt": "2020-06-05T13:46:15Z", "author": {"login": "zohrehj"}, "path": "WCP-WS/src/main/java/com/hphc/mystudies/service/StudyMetaDataService.java", "diffHunk": "@@ -968,10 +931,39 @@ public Object study(\n   @Produces(MediaType.APPLICATION_JSON)\n   @Consumes(MediaType.APPLICATION_JSON)\n   @Path(\"versionInfo\")\n-  public Object getAppVersionInfo() {\n+  public Object getAppVersionInfo(\n+      @HeaderParam(\"applicationId\") String appId,\n+      @HeaderParam(\"orgId\") String orgId,\n+      @Context HttpServletResponse response) {\n     AppVersionInfoBean appVersionInfoBean = null;\n     LOGGER.info(\"INFO: StudyMetaDataService - getAppVersionInfo() :: Starts\");\n-    appVersionInfoBean = appMetaDataOrchestration.getAppVersionInfo();\n+    try {\n+      if (StringUtils.isNotEmpty(appId) && StringUtils.isNotEmpty(orgId)) {\n+        appVersionInfoBean = appMetaDataOrchestration.getAppVersionInfo(appId, orgId);\n+        if (appVersionInfoBean == null) {\n+          StudyMetaDataUtil.getFailureResponse(\n+              ErrorCodes.STATUS_103, ErrorCodes.NO_DATA, StudyMetaDataConstants.FAILURE, response);\n+          return Response.status(Response.Status.NOT_FOUND)\n+              .entity(StudyMetaDataConstants.NO_RECORD)\n+              .build();\n+        }\n+      } else {\n+        StudyMetaDataUtil.getFailureResponse(\n+            ErrorCodes.STATUS_102,\n+            ErrorCodes.UNKNOWN,\n+            StudyMetaDataConstants.INVALID_INPUT_ERROR_MSG,\n+            response);\n+        return Response.status(Response.Status.NOT_FOUND)\n+            .entity(StudyMetaDataConstants.INVALID_INPUT)\n+            .build();\n+      }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1bfb6a88f7c8f070dce97483f940f49f568c954a"}, "originalPosition": 82}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1MzE1MTE1", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/454#pullrequestreview-425315115", "createdAt": "2020-06-05T13:48:32Z", "commit": {"oid": "1bfb6a88f7c8f070dce97483f940f49f568c954a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1ae088472d79a3b9a96f5e5e65773e7109d6328c", "author": {"user": {"login": "aswinijena100", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/1ae088472d79a3b9a96f5e5e65773e7109d6328c", "committedDate": "2020-06-05T14:04:12Z", "message": "moving null check to the the top as an early exit would reduce code nesting"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7aa08892da33ed7fbd220a051acd174befbed869", "author": {"user": {"login": "aswinijena100", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/7aa08892da33ed7fbd220a051acd174befbed869", "committedDate": "2020-06-05T14:04:55Z", "message": "Merge branch 'early-access' into early-access-mystudies-versionInfo-issue-fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b31f3ca1047bf9f8e2213079c317b7374edfd0c7", "author": {"user": {"login": "aswinijena100", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/b31f3ca1047bf9f8e2213079c317b7374edfd0c7", "committedDate": "2020-06-08T06:16:35Z", "message": "moved if condition out of try block as suggested"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 934, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}