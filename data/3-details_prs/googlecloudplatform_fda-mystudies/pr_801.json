{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDczMzE0MDQ0", "number": 801, "title": "Participant Manager Service : Audit Events with Integration Test Cases", "bodyText": "Participant Manager Service : Audit Events with Integration Test Cases\nImplemented audit log events listed in HIPAA-grade Audit Logs - FDA MyStudies on Google Cloud -EAP V3.1-2020-08-01 - Participant Manager", "createdAt": "2020-08-25T16:14:39Z", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/801", "merged": true, "mergeCommit": {"oid": "b2c5edfb4c9388bb2cd4b8498622ca0ac66a7101"}, "closed": true, "closedAt": "2020-08-31T15:03:50Z", "author": {"login": "monica-BTC"}, "timelineItems": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdCYkkggH2gAyNDczMzE0MDQ0OjRhZjFmNmFkYjFmODFmNzIxNjEwY2JmMWJhNTVjZDhmOGEyYzY4YTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdEUHAOgH2gAyNDczMzE0MDQ0OmJmZjA2YjQ1MmQyZGU1OWM5ZDI4YzY4M2U2OTVmMWY1YTlmNTkwYTg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "4af1f6adb1f81f721610cbf1ba55cd8f8a2c68a0", "author": {"user": {"login": "monica-BTC", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/4af1f6adb1f81f721610cbf1ba55cd8f8a2c68a0", "committedDate": "2020-08-25T15:02:45Z", "message": "AuditLog Implementation\n\nAuditLog Implementation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7dc1bba482d1897f219d06e5aed34a753988a28d", "author": {"user": {"login": "monica-BTC", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/7dc1bba482d1897f219d06e5aed34a753988a28d", "committedDate": "2020-08-25T15:25:50Z", "message": "AuditLog event with tests\n\nAuditLog event with tests"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2867d2c61c97a4bef455b94ce8638038edfd4fa2", "author": {"user": {"login": "madhurya-btc", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/2867d2c61c97a4bef455b94ce8638038edfd4fa2", "committedDate": "2020-08-25T15:46:15Z", "message": "audit logs for location and update profile"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "29b05b6f2fd9634dc39b381db56807d21e5ad863", "author": {"user": {"login": "madhurya-btc", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/29b05b6f2fd9634dc39b381db56807d21e5ad863", "committedDate": "2020-08-25T16:05:12Z", "message": "site controller test audit logging"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "85691eb52b0576c63dd8917c3077db844aabd1f2", "author": {"user": {"login": "monica-BTC", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/85691eb52b0576c63dd8917c3077db844aabd1f2", "committedDate": "2020-08-25T16:12:56Z", "message": "Organized imports\n\nOrganized imports"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc2MzQ4Njgy", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/801#pullrequestreview-476348682", "createdAt": "2020-08-27T02:48:28Z", "commit": {"oid": "85691eb52b0576c63dd8917c3077db844aabd1f2"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwMjo0ODoyOFrOHH1pxw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwMjo0ODoyOFrOHH1pxw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Nzk4MTEyNw==", "bodyText": "nit: Inactive, not Deactive", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/801#discussion_r477981127", "createdAt": "2020-08-27T02:48:28Z", "author": {"login": "saminguyen"}, "path": "participant-manager-module/participant-manager-service/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/LocationControllerTest.java", "diffHunk": "@@ -314,6 +336,57 @@ public void shouldUpdateToReactiveLocation() throws Exception {\n     LocationEntity locationEntity = optLocationEntity.get();\n     assertNotNull(locationEntity);\n     assertEquals(ACTIVE_STATUS, locationEntity.getStatus());\n+\n+    AuditLogEventRequest auditRequest = new AuditLogEventRequest();\n+    auditRequest.setUserId(userRegAdminEntity.getId());\n+\n+    Map<String, AuditLogEventRequest> auditEventMap = new HashedMap<>();\n+    auditEventMap.put(LOCATION_ACTIVATED.getEventCode(), auditRequest);\n+\n+    verifyAuditEventCall(auditEventMap, LOCATION_ACTIVATED);\n+  }\n+\n+  @Test\n+  public void shouldUpdateToDeactiveLocation() throws Exception {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "85691eb52b0576c63dd8917c3077db844aabd1f2"}, "originalPosition": 73}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc2MzUyMjg4", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/801#pullrequestreview-476352288", "createdAt": "2020-08-27T03:00:32Z", "commit": {"oid": "85691eb52b0576c63dd8917c3077db844aabd1f2"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwMzowMDozMlrOHH2ptQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yN1QwMzowMDozMlrOHH2ptQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Nzk5NzQ5Mw==", "bodyText": "Why are you capturing the request here, I do not see argument.getAllValues() being called.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/801#discussion_r477997493", "createdAt": "2020-08-27T03:00:32Z", "author": {"login": "saminguyen"}, "path": "common-modules/common-tests/src/main/java/com/google/cloud/healthcare/fdamystudies/common/BaseMockIT.java", "diffHunk": "@@ -149,10 +170,96 @@ protected MvcResult performPost(\n         .andReturn();\n   }\n \n+  /**\n+   * @param assertOptionalFieldsForEvent is a {@link Map} collection that contains {@link eventCode}\n+   *     as key and {@link AuditLogEventRequest} with optional field values as value.\n+   * @param auditEvents audit event enums\n+   */\n+  protected void verifyAuditEventCall(\n+      Map<String, AuditLogEventRequest> assertOptionalFieldsForEvent,\n+      AuditLogEvent... auditEvents) {\n+\n+    verifyAuditEventCall(auditEvents);\n+\n+    Map<String, AuditLogEventRequest> auditRequestByEventCode =\n+        auditRequests\n+            .stream()\n+            .collect(Collectors.toMap(AuditLogEventRequest::getEventCode, Function.identity()));\n+\n+    assertOptionalFieldsForEvent.forEach(\n+        (eventCode, expectedAuditRequest) -> {\n+          AuditLogEventRequest auditRequest = auditRequestByEventCode.get(eventCode);\n+          assertEquals(expectedAuditRequest.getUserId(), auditRequest.getUserId());\n+          assertEquals(expectedAuditRequest.getParticipantId(), auditRequest.getParticipantId());\n+          assertEquals(expectedAuditRequest.getStudyId(), auditRequest.getStudyId());\n+          assertEquals(expectedAuditRequest.getStudyVersion(), auditRequest.getStudyVersion());\n+        });\n+  }\n+\n+  protected void verifyAuditEventCall(AuditLogEvent... auditEvents) {\n+    ArgumentCaptor<AuditLogEventRequest> argument =\n+        ArgumentCaptor.forClass(AuditLogEventRequest.class);\n+    verify(mockAuditService, atLeastOnce()).postAuditLogEvent(argument.capture());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "85691eb52b0576c63dd8917c3077db844aabd1f2"}, "originalPosition": 106}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "dcb4032ea99d51fa4fcdfecd1d48bf2ae45fa4d3", "author": {"user": {"login": "madhurya-btc", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/dcb4032ea99d51fa4fcdfecd1d48bf2ae45fa4d3", "committedDate": "2020-08-27T08:08:59Z", "message": "Fixed review comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0853279d9f29bff5de17a5a28646c00fb75d1cea", "author": {"user": {"login": "monica-BTC", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/0853279d9f29bff5de17a5a28646c00fb75d1cea", "committedDate": "2020-08-31T09:14:01Z", "message": "Merge branch 'develop' into participant-manager-audit-logs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e07bbb5fcafc82ad2f148a4059c899cf0f8a64b5", "author": {"user": {"login": "monica-BTC", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/e07bbb5fcafc82ad2f148a4059c899cf0f8a64b5", "committedDate": "2020-08-31T09:36:14Z", "message": "Fixed Build Issue\n\nFixed Build Issue"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4NjkwODky", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/801#pullrequestreview-478690892", "createdAt": "2020-08-31T14:58:36Z", "commit": {"oid": "e07bbb5fcafc82ad2f148a4059c899cf0f8a64b5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bff06b452d2de59c9d28c683e695f1f5a9f590a8", "author": {"user": {"login": "saminguyen", "name": "Sami Nguyen"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/bff06b452d2de59c9d28c683e695f1f5a9f590a8", "committedDate": "2020-08-31T14:58:41Z", "message": "Merge branch 'develop' into participant-manager-audit-logs"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 731, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}