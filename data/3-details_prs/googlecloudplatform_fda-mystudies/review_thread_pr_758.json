{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY4NzczMzcx", "number": 758, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNTowNTowMlrOEZFbyA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNjoxNToyMlrOEZHPtA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0NzM4ODg4OnYy", "diffSide": "RIGHT", "path": "oauth-scim-module/oauth-scim-service/src/main/resources/templates/autoLogin.html", "isResolved": false, "comments": {"totalCount": 12, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNTowNTowMlrOHBsqlw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQxNDoxODo1MlrOHCWzqA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU0MjQyMw==", "bodyText": "Why do we make the user wait 5 seconds?", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/758#discussion_r471542423", "createdAt": "2020-08-17T15:05:02Z", "author": {"login": "nikklassen"}, "path": "oauth-scim-module/oauth-scim-service/src/main/resources/templates/autoLogin.html", "diffHunk": "@@ -1,12 +1,42 @@\n+<!-- \n+  Copyright 2020 Google LLC\n+ \n+  Use of this source code is governed by an MIT-style\n+  license that can be found in the LICENSE file or at\n+  https://opensource.org/licenses/MIT. -->\n+  \n <!DOCTYPE html>\n-<!-- // TODO(#662) -->\n-<html xmlns=\"http://www.w3.org/1999/xhtml\" lang=\"\"\n-  xmlns:th=\"https://www.thymeleaf.org\"\n-  xmlns:sec=\"https://www.thymeleaf.org/thymeleaf-extras-springsecurity3\">\n+<html xmlns=\"http://www.w3.org/1999/xhtml\"\n+  xmlns:th=\"https://www.thymeleaf.org\">\n <head>\n <title>Please wait</title>\n+\n+<link rel=\"stylesheet\"\n+  href=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css\">\n+<link rel=\"stylesheet\" th:href=\"@{/css/style.css}\">\n+<link rel=\"stylesheet\" th:href=\"@{/css/utilities.css}\">\n+<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n+<script type=\"text/javascript\">\n+  window.onload = function() {\n+    window.setTimeout(function() {\n+      document.autoSignInForm.submit();\n+    }, 5000);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86d0dcf8dc50f8b765cede55a6690eaf5a2e6e5e"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU2MDQ1Nw==", "bodyText": "Jamie's feedback - The one UX comment I had was around the duration of the loading screen - is there a scenario where loading could be very quick and this screen is flashed to the viewer too quickly? Is there a mechanism to address that?\nSo added a 5 seconds delay for form submission.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/758#discussion_r471560457", "createdAt": "2020-08-17T15:31:51Z", "author": {"login": "dhanyak-btc"}, "path": "oauth-scim-module/oauth-scim-service/src/main/resources/templates/autoLogin.html", "diffHunk": "@@ -1,12 +1,42 @@\n+<!-- \n+  Copyright 2020 Google LLC\n+ \n+  Use of this source code is governed by an MIT-style\n+  license that can be found in the LICENSE file or at\n+  https://opensource.org/licenses/MIT. -->\n+  \n <!DOCTYPE html>\n-<!-- // TODO(#662) -->\n-<html xmlns=\"http://www.w3.org/1999/xhtml\" lang=\"\"\n-  xmlns:th=\"https://www.thymeleaf.org\"\n-  xmlns:sec=\"https://www.thymeleaf.org/thymeleaf-extras-springsecurity3\">\n+<html xmlns=\"http://www.w3.org/1999/xhtml\"\n+  xmlns:th=\"https://www.thymeleaf.org\">\n <head>\n <title>Please wait</title>\n+\n+<link rel=\"stylesheet\"\n+  href=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css\">\n+<link rel=\"stylesheet\" th:href=\"@{/css/style.css}\">\n+<link rel=\"stylesheet\" th:href=\"@{/css/utilities.css}\">\n+<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n+<script type=\"text/javascript\">\n+  window.onload = function() {\n+    window.setTimeout(function() {\n+      document.autoSignInForm.submit();\n+    }, 5000);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU0MjQyMw=="}, "originalCommit": {"oid": "86d0dcf8dc50f8b765cede55a6690eaf5a2e6e5e"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU2MjYzNQ==", "bodyText": "I can discuss with Jamie, but this doesn't really make sense. There's nothing to show the user here, why does it matter how fast it is? Or just don't make it auto login", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/758#discussion_r471562635", "createdAt": "2020-08-17T15:35:04Z", "author": {"login": "nikklassen"}, "path": "oauth-scim-module/oauth-scim-service/src/main/resources/templates/autoLogin.html", "diffHunk": "@@ -1,12 +1,42 @@\n+<!-- \n+  Copyright 2020 Google LLC\n+ \n+  Use of this source code is governed by an MIT-style\n+  license that can be found in the LICENSE file or at\n+  https://opensource.org/licenses/MIT. -->\n+  \n <!DOCTYPE html>\n-<!-- // TODO(#662) -->\n-<html xmlns=\"http://www.w3.org/1999/xhtml\" lang=\"\"\n-  xmlns:th=\"https://www.thymeleaf.org\"\n-  xmlns:sec=\"https://www.thymeleaf.org/thymeleaf-extras-springsecurity3\">\n+<html xmlns=\"http://www.w3.org/1999/xhtml\"\n+  xmlns:th=\"https://www.thymeleaf.org\">\n <head>\n <title>Please wait</title>\n+\n+<link rel=\"stylesheet\"\n+  href=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css\">\n+<link rel=\"stylesheet\" th:href=\"@{/css/style.css}\">\n+<link rel=\"stylesheet\" th:href=\"@{/css/utilities.css}\">\n+<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n+<script type=\"text/javascript\">\n+  window.onload = function() {\n+    window.setTimeout(function() {\n+      document.autoSignInForm.submit();\n+    }, 5000);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU0MjQyMw=="}, "originalCommit": {"oid": "86d0dcf8dc50f8b765cede55a6690eaf5a2e6e5e"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU3NzUxNw==", "bodyText": "agree with Nik. I think a better solution is to skip this screen if we find that it's flashing too quickly. Adding manual delay doesn't sound like a good user experience to me.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/758#discussion_r471577517", "createdAt": "2020-08-17T15:57:09Z", "author": {"login": "zohrehj"}, "path": "oauth-scim-module/oauth-scim-service/src/main/resources/templates/autoLogin.html", "diffHunk": "@@ -1,12 +1,42 @@\n+<!-- \n+  Copyright 2020 Google LLC\n+ \n+  Use of this source code is governed by an MIT-style\n+  license that can be found in the LICENSE file or at\n+  https://opensource.org/licenses/MIT. -->\n+  \n <!DOCTYPE html>\n-<!-- // TODO(#662) -->\n-<html xmlns=\"http://www.w3.org/1999/xhtml\" lang=\"\"\n-  xmlns:th=\"https://www.thymeleaf.org\"\n-  xmlns:sec=\"https://www.thymeleaf.org/thymeleaf-extras-springsecurity3\">\n+<html xmlns=\"http://www.w3.org/1999/xhtml\"\n+  xmlns:th=\"https://www.thymeleaf.org\">\n <head>\n <title>Please wait</title>\n+\n+<link rel=\"stylesheet\"\n+  href=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css\">\n+<link rel=\"stylesheet\" th:href=\"@{/css/style.css}\">\n+<link rel=\"stylesheet\" th:href=\"@{/css/utilities.css}\">\n+<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n+<script type=\"text/javascript\">\n+  window.onload = function() {\n+    window.setTimeout(function() {\n+      document.autoSignInForm.submit();\n+    }, 5000);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU0MjQyMw=="}, "originalCommit": {"oid": "86d0dcf8dc50f8b765cede55a6690eaf5a2e6e5e"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU3Nzg4Mg==", "bodyText": "@jkrogers18 adding you for visibility", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/758#discussion_r471577882", "createdAt": "2020-08-17T15:57:42Z", "author": {"login": "zohrehj"}, "path": "oauth-scim-module/oauth-scim-service/src/main/resources/templates/autoLogin.html", "diffHunk": "@@ -1,12 +1,42 @@\n+<!-- \n+  Copyright 2020 Google LLC\n+ \n+  Use of this source code is governed by an MIT-style\n+  license that can be found in the LICENSE file or at\n+  https://opensource.org/licenses/MIT. -->\n+  \n <!DOCTYPE html>\n-<!-- // TODO(#662) -->\n-<html xmlns=\"http://www.w3.org/1999/xhtml\" lang=\"\"\n-  xmlns:th=\"https://www.thymeleaf.org\"\n-  xmlns:sec=\"https://www.thymeleaf.org/thymeleaf-extras-springsecurity3\">\n+<html xmlns=\"http://www.w3.org/1999/xhtml\"\n+  xmlns:th=\"https://www.thymeleaf.org\">\n <head>\n <title>Please wait</title>\n+\n+<link rel=\"stylesheet\"\n+  href=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css\">\n+<link rel=\"stylesheet\" th:href=\"@{/css/style.css}\">\n+<link rel=\"stylesheet\" th:href=\"@{/css/utilities.css}\">\n+<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n+<script type=\"text/javascript\">\n+  window.onload = function() {\n+    window.setTimeout(function() {\n+      document.autoSignInForm.submit();\n+    }, 5000);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU0MjQyMw=="}, "originalCommit": {"oid": "86d0dcf8dc50f8b765cede55a6690eaf5a2e6e5e"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU4OTQ4NQ==", "bodyText": "5 second delay was the designer's suggestion. What I'm concerned about is a quick flash of a screen that confuses a user and looks unprofessional. I've seen this in other parts of the mobile app so wanted to make sure we weren't getting into another situation like that here. We should pursue the better solution if there is one. I imagine there are standard design patterns around this kind of thing.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/758#discussion_r471589485", "createdAt": "2020-08-17T16:16:34Z", "author": {"login": "jkrogers18"}, "path": "oauth-scim-module/oauth-scim-service/src/main/resources/templates/autoLogin.html", "diffHunk": "@@ -1,12 +1,42 @@\n+<!-- \n+  Copyright 2020 Google LLC\n+ \n+  Use of this source code is governed by an MIT-style\n+  license that can be found in the LICENSE file or at\n+  https://opensource.org/licenses/MIT. -->\n+  \n <!DOCTYPE html>\n-<!-- // TODO(#662) -->\n-<html xmlns=\"http://www.w3.org/1999/xhtml\" lang=\"\"\n-  xmlns:th=\"https://www.thymeleaf.org\"\n-  xmlns:sec=\"https://www.thymeleaf.org/thymeleaf-extras-springsecurity3\">\n+<html xmlns=\"http://www.w3.org/1999/xhtml\"\n+  xmlns:th=\"https://www.thymeleaf.org\">\n <head>\n <title>Please wait</title>\n+\n+<link rel=\"stylesheet\"\n+  href=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css\">\n+<link rel=\"stylesheet\" th:href=\"@{/css/style.css}\">\n+<link rel=\"stylesheet\" th:href=\"@{/css/utilities.css}\">\n+<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n+<script type=\"text/javascript\">\n+  window.onload = function() {\n+    window.setTimeout(function() {\n+      document.autoSignInForm.submit();\n+    }, 5000);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU0MjQyMw=="}, "originalCommit": {"oid": "86d0dcf8dc50f8b765cede55a6690eaf5a2e6e5e"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTc1MTUzOA==", "bodyText": "I'm not clear on the flow here, instead of sending the user to this page then submitting the form why can't we submit the form from the original screen? I think having the user manually proceed would be better than a 5 second delay, I can submit a form myself faster than that.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/758#discussion_r471751538", "createdAt": "2020-08-17T20:17:16Z", "author": {"login": "nikklassen"}, "path": "oauth-scim-module/oauth-scim-service/src/main/resources/templates/autoLogin.html", "diffHunk": "@@ -1,12 +1,42 @@\n+<!-- \n+  Copyright 2020 Google LLC\n+ \n+  Use of this source code is governed by an MIT-style\n+  license that can be found in the LICENSE file or at\n+  https://opensource.org/licenses/MIT. -->\n+  \n <!DOCTYPE html>\n-<!-- // TODO(#662) -->\n-<html xmlns=\"http://www.w3.org/1999/xhtml\" lang=\"\"\n-  xmlns:th=\"https://www.thymeleaf.org\"\n-  xmlns:sec=\"https://www.thymeleaf.org/thymeleaf-extras-springsecurity3\">\n+<html xmlns=\"http://www.w3.org/1999/xhtml\"\n+  xmlns:th=\"https://www.thymeleaf.org\">\n <head>\n <title>Please wait</title>\n+\n+<link rel=\"stylesheet\"\n+  href=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css\">\n+<link rel=\"stylesheet\" th:href=\"@{/css/style.css}\">\n+<link rel=\"stylesheet\" th:href=\"@{/css/utilities.css}\">\n+<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n+<script type=\"text/javascript\">\n+  window.onload = function() {\n+    window.setTimeout(function() {\n+      document.autoSignInForm.submit();\n+    }, 5000);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU0MjQyMw=="}, "originalCommit": {"oid": "86d0dcf8dc50f8b765cede55a6690eaf5a2e6e5e"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTk3NTI4Mw==", "bodyText": "During Hydra POC, I tried my best to skip the consent flow and get the authorization code from Hydra but unfortunately it didn't work so we discussed and decided to add a \"Please wait..\" screen with auto submit.\nDuring POC I also added a \"Accept\" button on consent page but got feedback to make it auto submit with \"Please wait...\" message for better UX.\nFor sign in after signup flow, there are nearly 10 API calls are made so IMO it's not a good UX if we open a WebView/Chrome Tabs (mobile) and display empty screen until all the API calls are completed.\n1- GET /oauth2/auth \n2- GET /login (oauth scim controller)\n3- POST /login (from oauth scim view)\n4- PUT /oauth2/auth/requests/login/accept\n5- GET /consent (oauth scim controller)\n6- GET /oauth2/auth/requests/consent\n7- POST /consent (from oauth scim view)\n8- PUT /oauth2/auth/requests/consent/accept\n9- GET /login (with 'code' in query params)\n10. Redirect to callback URL with authorization code", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/758#discussion_r471975283", "createdAt": "2020-08-18T07:35:07Z", "author": {"login": "dhanyak-btc"}, "path": "oauth-scim-module/oauth-scim-service/src/main/resources/templates/autoLogin.html", "diffHunk": "@@ -1,12 +1,42 @@\n+<!-- \n+  Copyright 2020 Google LLC\n+ \n+  Use of this source code is governed by an MIT-style\n+  license that can be found in the LICENSE file or at\n+  https://opensource.org/licenses/MIT. -->\n+  \n <!DOCTYPE html>\n-<!-- // TODO(#662) -->\n-<html xmlns=\"http://www.w3.org/1999/xhtml\" lang=\"\"\n-  xmlns:th=\"https://www.thymeleaf.org\"\n-  xmlns:sec=\"https://www.thymeleaf.org/thymeleaf-extras-springsecurity3\">\n+<html xmlns=\"http://www.w3.org/1999/xhtml\"\n+  xmlns:th=\"https://www.thymeleaf.org\">\n <head>\n <title>Please wait</title>\n+\n+<link rel=\"stylesheet\"\n+  href=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css\">\n+<link rel=\"stylesheet\" th:href=\"@{/css/style.css}\">\n+<link rel=\"stylesheet\" th:href=\"@{/css/utilities.css}\">\n+<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n+<script type=\"text/javascript\">\n+  window.onload = function() {\n+    window.setTimeout(function() {\n+      document.autoSignInForm.submit();\n+    }, 5000);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU0MjQyMw=="}, "originalCommit": {"oid": "86d0dcf8dc50f8b765cede55a6690eaf5a2e6e5e"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjE2ODE2MQ==", "bodyText": "I am okay with the flow as is, and showing the wait screen. Only objection is unnecessary wait for users. We should only wait until all the requests have been made.\nIt is also possible to display a modal with please wait message in the original screen, while all the calls are being done in the background.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/758#discussion_r472168161", "createdAt": "2020-08-18T13:00:28Z", "author": {"login": "zohrehj"}, "path": "oauth-scim-module/oauth-scim-service/src/main/resources/templates/autoLogin.html", "diffHunk": "@@ -1,12 +1,42 @@\n+<!-- \n+  Copyright 2020 Google LLC\n+ \n+  Use of this source code is governed by an MIT-style\n+  license that can be found in the LICENSE file or at\n+  https://opensource.org/licenses/MIT. -->\n+  \n <!DOCTYPE html>\n-<!-- // TODO(#662) -->\n-<html xmlns=\"http://www.w3.org/1999/xhtml\" lang=\"\"\n-  xmlns:th=\"https://www.thymeleaf.org\"\n-  xmlns:sec=\"https://www.thymeleaf.org/thymeleaf-extras-springsecurity3\">\n+<html xmlns=\"http://www.w3.org/1999/xhtml\"\n+  xmlns:th=\"https://www.thymeleaf.org\">\n <head>\n <title>Please wait</title>\n+\n+<link rel=\"stylesheet\"\n+  href=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css\">\n+<link rel=\"stylesheet\" th:href=\"@{/css/style.css}\">\n+<link rel=\"stylesheet\" th:href=\"@{/css/utilities.css}\">\n+<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n+<script type=\"text/javascript\">\n+  window.onload = function() {\n+    window.setTimeout(function() {\n+      document.autoSignInForm.submit();\n+    }, 5000);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU0MjQyMw=="}, "originalCommit": {"oid": "86d0dcf8dc50f8b765cede55a6690eaf5a2e6e5e"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjE3MjE1Mg==", "bodyText": "If we can do this as a modal on the same page that may make this a non-issue. If a rotating circle of dots shows up to indicate loading that would be good. If loading takes several seconds the user will understand, but if the loading is very fast then flashing those gray dots isn't as confusing as flashing a whole new screen.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/758#discussion_r472172152", "createdAt": "2020-08-18T13:04:34Z", "author": {"login": "jkrogers18"}, "path": "oauth-scim-module/oauth-scim-service/src/main/resources/templates/autoLogin.html", "diffHunk": "@@ -1,12 +1,42 @@\n+<!-- \n+  Copyright 2020 Google LLC\n+ \n+  Use of this source code is governed by an MIT-style\n+  license that can be found in the LICENSE file or at\n+  https://opensource.org/licenses/MIT. -->\n+  \n <!DOCTYPE html>\n-<!-- // TODO(#662) -->\n-<html xmlns=\"http://www.w3.org/1999/xhtml\" lang=\"\"\n-  xmlns:th=\"https://www.thymeleaf.org\"\n-  xmlns:sec=\"https://www.thymeleaf.org/thymeleaf-extras-springsecurity3\">\n+<html xmlns=\"http://www.w3.org/1999/xhtml\"\n+  xmlns:th=\"https://www.thymeleaf.org\">\n <head>\n <title>Please wait</title>\n+\n+<link rel=\"stylesheet\"\n+  href=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css\">\n+<link rel=\"stylesheet\" th:href=\"@{/css/style.css}\">\n+<link rel=\"stylesheet\" th:href=\"@{/css/utilities.css}\">\n+<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n+<script type=\"text/javascript\">\n+  window.onload = function() {\n+    window.setTimeout(function() {\n+      document.autoSignInForm.submit();\n+    }, 5000);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU0MjQyMw=="}, "originalCommit": {"oid": "86d0dcf8dc50f8b765cede55a6690eaf5a2e6e5e"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjE4MjM1MQ==", "bodyText": "At the very least I would reduce this to <= 2 seconds. That's plenty of time for the user to register what this page is", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/758#discussion_r472182351", "createdAt": "2020-08-18T13:14:56Z", "author": {"login": "nikklassen"}, "path": "oauth-scim-module/oauth-scim-service/src/main/resources/templates/autoLogin.html", "diffHunk": "@@ -1,12 +1,42 @@\n+<!-- \n+  Copyright 2020 Google LLC\n+ \n+  Use of this source code is governed by an MIT-style\n+  license that can be found in the LICENSE file or at\n+  https://opensource.org/licenses/MIT. -->\n+  \n <!DOCTYPE html>\n-<!-- // TODO(#662) -->\n-<html xmlns=\"http://www.w3.org/1999/xhtml\" lang=\"\"\n-  xmlns:th=\"https://www.thymeleaf.org\"\n-  xmlns:sec=\"https://www.thymeleaf.org/thymeleaf-extras-springsecurity3\">\n+<html xmlns=\"http://www.w3.org/1999/xhtml\"\n+  xmlns:th=\"https://www.thymeleaf.org\">\n <head>\n <title>Please wait</title>\n+\n+<link rel=\"stylesheet\"\n+  href=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css\">\n+<link rel=\"stylesheet\" th:href=\"@{/css/style.css}\">\n+<link rel=\"stylesheet\" th:href=\"@{/css/utilities.css}\">\n+<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n+<script type=\"text/javascript\">\n+  window.onload = function() {\n+    window.setTimeout(function() {\n+      document.autoSignInForm.submit();\n+    }, 5000);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU0MjQyMw=="}, "originalCommit": {"oid": "86d0dcf8dc50f8b765cede55a6690eaf5a2e6e5e"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjIzMjg3Mg==", "bodyText": "Reduced the wait time to 2 seconds.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/758#discussion_r472232872", "createdAt": "2020-08-18T14:18:52Z", "author": {"login": "dhanyak-btc"}, "path": "oauth-scim-module/oauth-scim-service/src/main/resources/templates/autoLogin.html", "diffHunk": "@@ -1,12 +1,42 @@\n+<!-- \n+  Copyright 2020 Google LLC\n+ \n+  Use of this source code is governed by an MIT-style\n+  license that can be found in the LICENSE file or at\n+  https://opensource.org/licenses/MIT. -->\n+  \n <!DOCTYPE html>\n-<!-- // TODO(#662) -->\n-<html xmlns=\"http://www.w3.org/1999/xhtml\" lang=\"\"\n-  xmlns:th=\"https://www.thymeleaf.org\"\n-  xmlns:sec=\"https://www.thymeleaf.org/thymeleaf-extras-springsecurity3\">\n+<html xmlns=\"http://www.w3.org/1999/xhtml\"\n+  xmlns:th=\"https://www.thymeleaf.org\">\n <head>\n <title>Please wait</title>\n+\n+<link rel=\"stylesheet\"\n+  href=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css\">\n+<link rel=\"stylesheet\" th:href=\"@{/css/style.css}\">\n+<link rel=\"stylesheet\" th:href=\"@{/css/utilities.css}\">\n+<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n+<script type=\"text/javascript\">\n+  window.onload = function() {\n+    window.setTimeout(function() {\n+      document.autoSignInForm.submit();\n+    }, 5000);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU0MjQyMw=="}, "originalCommit": {"oid": "86d0dcf8dc50f8b765cede55a6690eaf5a2e6e5e"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0NzM5MDY0OnYy", "diffSide": "RIGHT", "path": "oauth-scim-module/oauth-scim-service/src/main/resources/templates/consent.html", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNTowNToyN1rOHBsrpw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNTozMjoxOVrOHBtyUQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU0MjY5NQ==", "bodyText": "Same here", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/758#discussion_r471542695", "createdAt": "2020-08-17T15:05:27Z", "author": {"login": "nikklassen"}, "path": "oauth-scim-module/oauth-scim-service/src/main/resources/templates/consent.html", "diffHunk": "@@ -1,12 +1,43 @@\n+<!-- \n+  Copyright 2020 Google LLC\n+ \n+  Use of this source code is governed by an MIT-style\n+  license that can be found in the LICENSE file or at\n+  https://opensource.org/licenses/MIT. -->\n+  \n <!DOCTYPE html>\n-<!-- // TODO(#650) Remove this file -->\n-<html xmlns=\"http://www.w3.org/1999/xhtml\" lang=\"\"\n-  xmlns:th=\"https://www.thymeleaf.org\"\n-  xmlns:sec=\"https://www.thymeleaf.org/thymeleaf-extras-springsecurity3\">\n+<html xmlns=\"http://www.w3.org/1999/xhtml\"\n+  xmlns:th=\"https://www.thymeleaf.org\">\n <head>\n <title>Please wait</title>\n+\n+<link rel=\"stylesheet\"\n+  href=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css\">\n+<link rel=\"stylesheet\" th:href=\"@{/css/style.css}\">\n+<link rel=\"stylesheet\" th:href=\"@{/css/utilities.css}\">\n+<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n+<script type=\"text/javascript\">\n+\twindow.onload = function() {\n+\t\twindow.setTimeout(function() {\n+\t\t\tdocument.consentForm.submit();\n+\t\t}, 5000);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86d0dcf8dc50f8b765cede55a6690eaf5a2e6e5e"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU2MDc4NQ==", "bodyText": "Jamie's feedback - The one UX comment I had was around the duration of the loading screen - is there a scenario where loading could be very quick and this screen is flashed to the viewer too quickly? Is there a mechanism to address that?\nSo added a 5 seconds delay for form submission.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/758#discussion_r471560785", "createdAt": "2020-08-17T15:32:19Z", "author": {"login": "dhanyak-btc"}, "path": "oauth-scim-module/oauth-scim-service/src/main/resources/templates/consent.html", "diffHunk": "@@ -1,12 +1,43 @@\n+<!-- \n+  Copyright 2020 Google LLC\n+ \n+  Use of this source code is governed by an MIT-style\n+  license that can be found in the LICENSE file or at\n+  https://opensource.org/licenses/MIT. -->\n+  \n <!DOCTYPE html>\n-<!-- // TODO(#650) Remove this file -->\n-<html xmlns=\"http://www.w3.org/1999/xhtml\" lang=\"\"\n-  xmlns:th=\"https://www.thymeleaf.org\"\n-  xmlns:sec=\"https://www.thymeleaf.org/thymeleaf-extras-springsecurity3\">\n+<html xmlns=\"http://www.w3.org/1999/xhtml\"\n+  xmlns:th=\"https://www.thymeleaf.org\">\n <head>\n <title>Please wait</title>\n+\n+<link rel=\"stylesheet\"\n+  href=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css\">\n+<link rel=\"stylesheet\" th:href=\"@{/css/style.css}\">\n+<link rel=\"stylesheet\" th:href=\"@{/css/utilities.css}\">\n+<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n+<script type=\"text/javascript\">\n+\twindow.onload = function() {\n+\t\twindow.setTimeout(function() {\n+\t\t\tdocument.consentForm.submit();\n+\t\t}, 5000);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU0MjY5NQ=="}, "originalCommit": {"oid": "86d0dcf8dc50f8b765cede55a6690eaf5a2e6e5e"}, "originalPosition": 27}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0NzYzODAzOnYy", "diffSide": "RIGHT", "path": "oauth-scim-module/oauth-scim-service/src/main/java/com/google/cloud/healthcare/fdamystudies/oauthscim/beans/LoginRequest.java", "isResolved": false, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNjowMjo0OFrOHBvCBw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQxNDoxNDoxN1rOHCWmsw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU4MTE5MQ==", "bodyText": "nit: no need to enforce size in regex since you already have min and max specified.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/758#discussion_r471581191", "createdAt": "2020-08-17T16:02:48Z", "author": {"login": "zohrehj"}, "path": "oauth-scim-module/oauth-scim-service/src/main/java/com/google/cloud/healthcare/fdamystudies/oauthscim/beans/LoginRequest.java", "diffHunk": "@@ -0,0 +1,38 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.oauthscim.beans;\n+\n+import javax.validation.constraints.Email;\n+import javax.validation.constraints.Pattern;\n+import javax.validation.constraints.Size;\n+import lombok.Getter;\n+import lombok.Setter;\n+import lombok.ToString;\n+\n+@Getter\n+@Setter\n+public class LoginRequest {\n+\n+  private static final String PASSWORD_REGEX =\n+      \"^(?=.*[0-9])(?=.*[a-z])(?=.*[A-Z])(?=.*[!\\\\\\\\\\\\\\\"#$%&'()*+,-.:;<=>?@\\\\\\\\\\\\\\\\[\\\\\\\\\\\\\\\\]^_`{|}~]).{8,64}$\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86d0dcf8dc50f8b765cede55a6690eaf5a2e6e5e"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU4NTcwMA==", "bodyText": "It doesn't look like we are requiring spacial characters in the password here, which I thought was a requirement.\nAlso not sure why we are limiting the spacial characters that the user can use?\nwhy not just accept whatever they provide, and just enforce the min character?", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/758#discussion_r471585700", "createdAt": "2020-08-17T16:10:04Z", "author": {"login": "zohrehj"}, "path": "oauth-scim-module/oauth-scim-service/src/main/java/com/google/cloud/healthcare/fdamystudies/oauthscim/beans/LoginRequest.java", "diffHunk": "@@ -0,0 +1,38 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.oauthscim.beans;\n+\n+import javax.validation.constraints.Email;\n+import javax.validation.constraints.Pattern;\n+import javax.validation.constraints.Size;\n+import lombok.Getter;\n+import lombok.Setter;\n+import lombok.ToString;\n+\n+@Getter\n+@Setter\n+public class LoginRequest {\n+\n+  private static final String PASSWORD_REGEX =\n+      \"^(?=.*[0-9])(?=.*[a-z])(?=.*[A-Z])(?=.*[!\\\\\\\\\\\\\\\"#$%&'()*+,-.:;<=>?@\\\\\\\\\\\\\\\\[\\\\\\\\\\\\\\\\]^_`{|}~]).{8,64}$\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU4MTE5MQ=="}, "originalCommit": {"oid": "86d0dcf8dc50f8b765cede55a6690eaf5a2e6e5e"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTYwMzc1MA==", "bodyText": "I copied this regex from old auth server to keep the password requirement AS-IS. This regex is used in create account, change password and authentication, kindly a create an issue if the password requirements has changed so that I can fix it in all 3 places together.\nI noticed so many slash () added by STS when the regex is copy-pasted, fixed this.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/758#discussion_r471603750", "createdAt": "2020-08-17T16:41:28Z", "author": {"login": "dhanyak-btc"}, "path": "oauth-scim-module/oauth-scim-service/src/main/java/com/google/cloud/healthcare/fdamystudies/oauthscim/beans/LoginRequest.java", "diffHunk": "@@ -0,0 +1,38 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.oauthscim.beans;\n+\n+import javax.validation.constraints.Email;\n+import javax.validation.constraints.Pattern;\n+import javax.validation.constraints.Size;\n+import lombok.Getter;\n+import lombok.Setter;\n+import lombok.ToString;\n+\n+@Getter\n+@Setter\n+public class LoginRequest {\n+\n+  private static final String PASSWORD_REGEX =\n+      \"^(?=.*[0-9])(?=.*[a-z])(?=.*[A-Z])(?=.*[!\\\\\\\\\\\\\\\"#$%&'()*+,-.:;<=>?@\\\\\\\\\\\\\\\\[\\\\\\\\\\\\\\\\]^_`{|}~]).{8,64}$\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU4MTE5MQ=="}, "originalCommit": {"oid": "86d0dcf8dc50f8b765cede55a6690eaf5a2e6e5e"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjE3MTQyMQ==", "bodyText": "requirement has not changed, my feedback is to simplify the regex:\n\ncombine the first three groups with [A-Za-z0-9] instead of specifying them separately\ninstead of listing spacial characters one by one, use a simpler logic, e.g, [^A-Za-z0-9] which is the negation of the alphanumeric characters.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/758#discussion_r472171421", "createdAt": "2020-08-18T13:03:47Z", "author": {"login": "zohrehj"}, "path": "oauth-scim-module/oauth-scim-service/src/main/java/com/google/cloud/healthcare/fdamystudies/oauthscim/beans/LoginRequest.java", "diffHunk": "@@ -0,0 +1,38 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.oauthscim.beans;\n+\n+import javax.validation.constraints.Email;\n+import javax.validation.constraints.Pattern;\n+import javax.validation.constraints.Size;\n+import lombok.Getter;\n+import lombok.Setter;\n+import lombok.ToString;\n+\n+@Getter\n+@Setter\n+public class LoginRequest {\n+\n+  private static final String PASSWORD_REGEX =\n+      \"^(?=.*[0-9])(?=.*[a-z])(?=.*[A-Z])(?=.*[!\\\\\\\\\\\\\\\"#$%&'()*+,-.:;<=>?@\\\\\\\\\\\\\\\\[\\\\\\\\\\\\\\\\]^_`{|}~]).{8,64}$\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU4MTE5MQ=="}, "originalCommit": {"oid": "86d0dcf8dc50f8b765cede55a6690eaf5a2e6e5e"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjIyOTU1NQ==", "bodyText": "Created an issue #769", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/758#discussion_r472229555", "createdAt": "2020-08-18T14:14:17Z", "author": {"login": "dhanyak-btc"}, "path": "oauth-scim-module/oauth-scim-service/src/main/java/com/google/cloud/healthcare/fdamystudies/oauthscim/beans/LoginRequest.java", "diffHunk": "@@ -0,0 +1,38 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.oauthscim.beans;\n+\n+import javax.validation.constraints.Email;\n+import javax.validation.constraints.Pattern;\n+import javax.validation.constraints.Size;\n+import lombok.Getter;\n+import lombok.Setter;\n+import lombok.ToString;\n+\n+@Getter\n+@Setter\n+public class LoginRequest {\n+\n+  private static final String PASSWORD_REGEX =\n+      \"^(?=.*[0-9])(?=.*[a-z])(?=.*[A-Z])(?=.*[!\\\\\\\\\\\\\\\"#$%&'()*+,-.:;<=>?@\\\\\\\\\\\\\\\\[\\\\\\\\\\\\\\\\]^_`{|}~]).{8,64}$\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU4MTE5MQ=="}, "originalCommit": {"oid": "86d0dcf8dc50f8b765cede55a6690eaf5a2e6e5e"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0NzY3NTA1OnYy", "diffSide": "RIGHT", "path": "oauth-scim-module/oauth-scim-service/src/main/java/com/google/cloud/healthcare/fdamystudies/oauthscim/common/CookieHelper.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNjoxMjozMFrOHBvZQA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xOFQxMzowNjoxOFrOHCTNPg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU4NzEzNg==", "bodyText": "this is not adding the cookie prefix, it is removing it form the name before adding the cookie; the opposite of what I was referring to.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/758#discussion_r471587136", "createdAt": "2020-08-17T16:12:30Z", "author": {"login": "zohrehj"}, "path": "oauth-scim-module/oauth-scim-service/src/main/java/com/google/cloud/healthcare/fdamystudies/oauthscim/common/CookieHelper.java", "diffHunk": "@@ -20,10 +21,17 @@\n \n   @Autowired private AppPropertyConfig appConfig;\n \n+  private static final String COOKIE_PREFIX = \"mystudies_\";\n+\n   public void addCookies(\n       HttpServletResponse response, MultiValueMap<String, String> params, String... cookieNames) {\n+    String paramName = null;\n     for (String cookieName : cookieNames) {\n-      addCookie(response, cookieName, params.getFirst(cookieName));\n+      paramName =\n+          StringUtils.startsWith(cookieName, COOKIE_PREFIX)\n+              ? cookieName.substring(cookieName.indexOf('_') + 1)\n+              : cookieName;\n+      addCookie(response, cookieName, params.getFirst(paramName));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86d0dcf8dc50f8b765cede55a6690eaf5a2e6e5e"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTYwNTg5MA==", "bodyText": "I added a prefix \"mystudies_\" to previously used cookie variables. I've tested this in browser cookies tab, prefix is present in all cookie names. cookieName sets the name with prefix, paramName gets the value from params map for cookie value.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/758#discussion_r471605890", "createdAt": "2020-08-17T16:45:10Z", "author": {"login": "dhanyak-btc"}, "path": "oauth-scim-module/oauth-scim-service/src/main/java/com/google/cloud/healthcare/fdamystudies/oauthscim/common/CookieHelper.java", "diffHunk": "@@ -20,10 +21,17 @@\n \n   @Autowired private AppPropertyConfig appConfig;\n \n+  private static final String COOKIE_PREFIX = \"mystudies_\";\n+\n   public void addCookies(\n       HttpServletResponse response, MultiValueMap<String, String> params, String... cookieNames) {\n+    String paramName = null;\n     for (String cookieName : cookieNames) {\n-      addCookie(response, cookieName, params.getFirst(cookieName));\n+      paramName =\n+          StringUtils.startsWith(cookieName, COOKIE_PREFIX)\n+              ? cookieName.substring(cookieName.indexOf('_') + 1)\n+              : cookieName;\n+      addCookie(response, cookieName, params.getFirst(paramName));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU4NzEzNg=="}, "originalCommit": {"oid": "86d0dcf8dc50f8b765cede55a6690eaf5a2e6e5e"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjE3Mzg4Ng==", "bodyText": "I see. I was expecting you to be adding the cookie prefix here, instead of at each method; but that woks too.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/758#discussion_r472173886", "createdAt": "2020-08-18T13:06:18Z", "author": {"login": "zohrehj"}, "path": "oauth-scim-module/oauth-scim-service/src/main/java/com/google/cloud/healthcare/fdamystudies/oauthscim/common/CookieHelper.java", "diffHunk": "@@ -20,10 +21,17 @@\n \n   @Autowired private AppPropertyConfig appConfig;\n \n+  private static final String COOKIE_PREFIX = \"mystudies_\";\n+\n   public void addCookies(\n       HttpServletResponse response, MultiValueMap<String, String> params, String... cookieNames) {\n+    String paramName = null;\n     for (String cookieName : cookieNames) {\n-      addCookie(response, cookieName, params.getFirst(cookieName));\n+      paramName =\n+          StringUtils.startsWith(cookieName, COOKIE_PREFIX)\n+              ? cookieName.substring(cookieName.indexOf('_') + 1)\n+              : cookieName;\n+      addCookie(response, cookieName, params.getFirst(paramName));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU4NzEzNg=="}, "originalCommit": {"oid": "86d0dcf8dc50f8b765cede55a6690eaf5a2e6e5e"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0NzY3OTU4OnYy", "diffSide": "RIGHT", "path": "oauth-scim-module/oauth-scim-service/src/main/java/com/google/cloud/healthcare/fdamystudies/oauthscim/service/HydraOAuthServiceImpl.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNjoxMzo1NlrOHBvcOw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNjo0NTo1OVrOHBwkXQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU4Nzg5OQ==", "bodyText": "please log error here", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/758#discussion_r471587899", "createdAt": "2020-08-17T16:13:56Z", "author": {"login": "zohrehj"}, "path": "oauth-scim-module/oauth-scim-service/src/main/java/com/google/cloud/healthcare/fdamystudies/oauthscim/service/HydraOAuthServiceImpl.java", "diffHunk": "@@ -86,27 +89,33 @@ public void init() {\n \n   public ResponseEntity<?> getToken(MultiValueMap<String, String> paramMap, HttpHeaders headers)\n       throws JsonProcessingException {\n+    logger.entry(String.format(\"getToken() for grant_type=%s\", paramMap.getFirst(GRANT_TYPE)));\n+\n     headers.add(CONTENT_TYPE, APPLICATION_X_WWW_FORM_URLENCODED_CHARSET_UTF_8);\n \n-    if (REFRESH_TOKEN.equals(paramMap.getFirst(GRANT_TYPE))) {\n+    String grantType = paramMap.getFirst(GRANT_TYPE);\n+    if (REFRESH_TOKEN.equals(grantType) || AUTHORIZATION_CODE.equals(grantType)) {\n       headers.set(AUTHORIZATION, encodedAuthorization);\n     }\n \n     HttpEntity<Object> requestEntity = new HttpEntity<>(paramMap, headers);\n     ResponseEntity<JsonNode> response =\n         getRestTemplate().postForEntity(tokenEndpoint, requestEntity, JsonNode.class);\n \n-    String grantType = paramMap.getFirst(GRANT_TYPE);\n     if ((REFRESH_TOKEN.equals(grantType) || AUTHORIZATION_CODE.equals(grantType))\n         && response.getBody().hasNonNull(REFRESH_TOKEN)) {\n       String refreshToken = getTextValue(response.getBody(), REFRESH_TOKEN);\n       UserResponse userResponse =\n           userService.revokeAndReplaceRefreshToken(paramMap.getFirst(USER_ID), refreshToken);\n       if (!HttpStatus.valueOf(userResponse.getHttpStatusCode()).is2xxSuccessful()) {\n+        logger.exit(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86d0dcf8dc50f8b765cede55a6690eaf5a2e6e5e"}, "originalPosition": 47}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTYwNjM2NQ==", "bodyText": "Fixed review comment.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/758#discussion_r471606365", "createdAt": "2020-08-17T16:45:59Z", "author": {"login": "dhanyak-btc"}, "path": "oauth-scim-module/oauth-scim-service/src/main/java/com/google/cloud/healthcare/fdamystudies/oauthscim/service/HydraOAuthServiceImpl.java", "diffHunk": "@@ -86,27 +89,33 @@ public void init() {\n \n   public ResponseEntity<?> getToken(MultiValueMap<String, String> paramMap, HttpHeaders headers)\n       throws JsonProcessingException {\n+    logger.entry(String.format(\"getToken() for grant_type=%s\", paramMap.getFirst(GRANT_TYPE)));\n+\n     headers.add(CONTENT_TYPE, APPLICATION_X_WWW_FORM_URLENCODED_CHARSET_UTF_8);\n \n-    if (REFRESH_TOKEN.equals(paramMap.getFirst(GRANT_TYPE))) {\n+    String grantType = paramMap.getFirst(GRANT_TYPE);\n+    if (REFRESH_TOKEN.equals(grantType) || AUTHORIZATION_CODE.equals(grantType)) {\n       headers.set(AUTHORIZATION, encodedAuthorization);\n     }\n \n     HttpEntity<Object> requestEntity = new HttpEntity<>(paramMap, headers);\n     ResponseEntity<JsonNode> response =\n         getRestTemplate().postForEntity(tokenEndpoint, requestEntity, JsonNode.class);\n \n-    String grantType = paramMap.getFirst(GRANT_TYPE);\n     if ((REFRESH_TOKEN.equals(grantType) || AUTHORIZATION_CODE.equals(grantType))\n         && response.getBody().hasNonNull(REFRESH_TOKEN)) {\n       String refreshToken = getTextValue(response.getBody(), REFRESH_TOKEN);\n       UserResponse userResponse =\n           userService.revokeAndReplaceRefreshToken(paramMap.getFirst(USER_ID), refreshToken);\n       if (!HttpStatus.valueOf(userResponse.getHttpStatusCode()).is2xxSuccessful()) {\n+        logger.exit(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU4Nzg5OQ=="}, "originalCommit": {"oid": "86d0dcf8dc50f8b765cede55a6690eaf5a2e6e5e"}, "originalPosition": 47}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk0NzY4NTY0OnYy", "diffSide": "RIGHT", "path": "oauth-scim-module/oauth-scim-service/src/main/resources/templates/login.html", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNjoxNToyMlrOHBvfpw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNzowMjozMFrOHBxJOg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU4ODc3NQ==", "bodyText": "please keep indentation to 2 spaces, similar to the html one", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/758#discussion_r471588775", "createdAt": "2020-08-17T16:15:22Z", "author": {"login": "zohrehj"}, "path": "oauth-scim-module/oauth-scim-service/src/main/resources/templates/login.html", "diffHunk": "@@ -1,13 +1,117 @@\n+<!-- \n+  Copyright 2020 Google LLC\n+ \n+  Use of this source code is governed by an MIT-style\n+  license that can be found in the LICENSE file or at\n+  https://opensource.org/licenses/MIT. -->\n+\n <!DOCTYPE html>\n-<!-- // TODO(#662) -->\n-<html xmlns=\"http://www.w3.org/1999/xhtml\" lang=\"\"\n-  xmlns:th=\"https://www.thymeleaf.org\"\n-  xmlns:sec=\"https://www.thymeleaf.org/thymeleaf-extras-springsecurity3\">\n+<html xmlns=\"http://www.w3.org/1999/xhtml\"\n+  xmlns:th=\"https://www.thymeleaf.org\">\n <head>\n <title>Login</title>\n+\n+<link rel=\"stylesheet\"\n+  href=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css\">\n+<link rel=\"stylesheet\" th:href=\"@{/css/style.css}\">\n+<link rel=\"stylesheet\" th:href=\"@{/css/utilities.css}\">\n+<link rel=\"stylesheet\"\n+  href=\"https://fonts.googleapis.com/css?family=Muli:200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i&display=swap\">\n+\n+<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n+\n+<script type=\"text/javascript\">\n+\tfunction validateField(elementId) {\n+\t\tvar element = document.getElementById(elementId);\n+\t\tvar isValid = element.checkValidity();\n+\t\tvar errorDiv = document.getElementById(elementId + \"_error\");\n+\n+\t\tif (isValid) {\n+\t\t\terrorDiv.style.display = \"none\";\n+\t\t} else {\n+\t\t\terrorDiv.style.display = \"block\";\n+\t\t}\n+\n+\t\treturn isValid;\n+\t}\n+\n+\tfunction validateform() {\n+\t\treturn validateField(\"email\") && validateField(\"password\");\n+\t}\n+</script>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "86d0dcf8dc50f8b765cede55a6690eaf5a2e6e5e"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTYxNTgwMg==", "bodyText": "STS IDE is not formatting the javascript code inside html files, so extracted the javascript code to *.js files.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/758#discussion_r471615802", "createdAt": "2020-08-17T17:02:30Z", "author": {"login": "dhanyak-btc"}, "path": "oauth-scim-module/oauth-scim-service/src/main/resources/templates/login.html", "diffHunk": "@@ -1,13 +1,117 @@\n+<!-- \n+  Copyright 2020 Google LLC\n+ \n+  Use of this source code is governed by an MIT-style\n+  license that can be found in the LICENSE file or at\n+  https://opensource.org/licenses/MIT. -->\n+\n <!DOCTYPE html>\n-<!-- // TODO(#662) -->\n-<html xmlns=\"http://www.w3.org/1999/xhtml\" lang=\"\"\n-  xmlns:th=\"https://www.thymeleaf.org\"\n-  xmlns:sec=\"https://www.thymeleaf.org/thymeleaf-extras-springsecurity3\">\n+<html xmlns=\"http://www.w3.org/1999/xhtml\"\n+  xmlns:th=\"https://www.thymeleaf.org\">\n <head>\n <title>Login</title>\n+\n+<link rel=\"stylesheet\"\n+  href=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css\">\n+<link rel=\"stylesheet\" th:href=\"@{/css/style.css}\">\n+<link rel=\"stylesheet\" th:href=\"@{/css/utilities.css}\">\n+<link rel=\"stylesheet\"\n+  href=\"https://fonts.googleapis.com/css?family=Muli:200,200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i&display=swap\">\n+\n+<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n+\n+<script type=\"text/javascript\">\n+\tfunction validateField(elementId) {\n+\t\tvar element = document.getElementById(elementId);\n+\t\tvar isValid = element.checkValidity();\n+\t\tvar errorDiv = document.getElementById(elementId + \"_error\");\n+\n+\t\tif (isValid) {\n+\t\t\terrorDiv.style.display = \"none\";\n+\t\t} else {\n+\t\t\terrorDiv.style.display = \"block\";\n+\t\t}\n+\n+\t\treturn isValid;\n+\t}\n+\n+\tfunction validateform() {\n+\t\treturn validateField(\"email\") && validateField(\"password\");\n+\t}\n+</script>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU4ODc3NQ=="}, "originalCommit": {"oid": "86d0dcf8dc50f8b765cede55a6690eaf5a2e6e5e"}, "originalPosition": 45}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2129, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}