{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI3ODc3NTc1", "number": 444, "reviewThreads": {"totalCount": 22, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxNTo0NDoyMVrOED8kkQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxMzo1NTowMVrOEEsgNA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyNTczNTg1OnYy", "diffSide": "RIGHT", "path": "audit-log-service/src/main/java/com/google/cloud/healthcare/fdamystudies/auditlog/common/ErrorMessages.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxNTo0NDoyMVrOGhQ46Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQwNTo0MzoxOVrOGiPPIA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzUzMjkwNQ==", "bodyText": "This shows up in every service. I'd really like to see a common module that the microservices can include to share this stuff.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/444#discussion_r437532905", "createdAt": "2020-06-09T15:44:21Z", "author": {"login": "nikklassen"}, "path": "audit-log-service/src/main/java/com/google/cloud/healthcare/fdamystudies/auditlog/common/ErrorMessages.java", "diffHunk": "@@ -0,0 +1,34 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.auditlog.common;\n+\n+import lombok.Getter;\n+import lombok.RequiredArgsConstructor;\n+import lombok.ToString;\n+\n+@Getter\n+@ToString\n+@RequiredArgsConstructor\n+public enum ErrorMessages {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "754e186be1f1668728fc27ba085d29658f9db7a8"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODU1NDQwMA==", "bodyText": "Renamed to ErrorCode and moved this enum to common-service module", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/444#discussion_r438554400", "createdAt": "2020-06-11T05:43:19Z", "author": {"login": "dhanyak-btc"}, "path": "audit-log-service/src/main/java/com/google/cloud/healthcare/fdamystudies/auditlog/common/ErrorMessages.java", "diffHunk": "@@ -0,0 +1,34 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.auditlog.common;\n+\n+import lombok.Getter;\n+import lombok.RequiredArgsConstructor;\n+import lombok.ToString;\n+\n+@Getter\n+@ToString\n+@RequiredArgsConstructor\n+public enum ErrorMessages {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzUzMjkwNQ=="}, "originalCommit": {"oid": "754e186be1f1668728fc27ba085d29658f9db7a8"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyNTc0ODg1OnYy", "diffSide": "RIGHT", "path": "audit-log-service/src/main/java/com/google/cloud/healthcare/fdamystudies/auditlog/common/FieldNames.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxNTo0NzoxNlrOGhRBZg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxMzo1ODo0M1rOGieuEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzUzNTA3OA==", "bodyText": "Some of these properties, like PATH, STATE, etc. don't have enough context to be useful. Other people reading this code aren't going to know what PATH is for. If they are being serialization just keep the field names in that class.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/444#discussion_r437535078", "createdAt": "2020-06-09T15:47:16Z", "author": {"login": "nikklassen"}, "path": "audit-log-service/src/main/java/com/google/cloud/healthcare/fdamystudies/auditlog/common/FieldNames.java", "diffHunk": "@@ -0,0 +1,65 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.auditlog.common;\n+\n+public final class FieldNames {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "754e186be1f1668728fc27ba085d29658f9db7a8"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODU1NTYxMg==", "bodyText": "Removed above mentioned properties from FieldNames and copied to individual classes to fix compilation-error.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/444#discussion_r438555612", "createdAt": "2020-06-11T05:47:32Z", "author": {"login": "dhanyak-btc"}, "path": "audit-log-service/src/main/java/com/google/cloud/healthcare/fdamystudies/auditlog/common/FieldNames.java", "diffHunk": "@@ -0,0 +1,65 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.auditlog.common;\n+\n+public final class FieldNames {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzUzNTA3OA=="}, "originalCommit": {"oid": "754e186be1f1668728fc27ba085d29658f9db7a8"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODgwODA4MQ==", "bodyText": "This file is now unused. Please remove.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/444#discussion_r438808081", "createdAt": "2020-06-11T13:58:43Z", "author": {"login": "nikklassen"}, "path": "audit-log-service/src/main/java/com/google/cloud/healthcare/fdamystudies/auditlog/common/FieldNames.java", "diffHunk": "@@ -0,0 +1,65 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.auditlog.common;\n+\n+public final class FieldNames {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzUzNTA3OA=="}, "originalCommit": {"oid": "754e186be1f1668728fc27ba085d29658f9db7a8"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyNTc1MjU1OnYy", "diffSide": "RIGHT", "path": "audit-log-service/src/main/java/com/google/cloud/healthcare/fdamystudies/auditlog/common/ErrorResponse.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxNTo0ODowNVrOGhRDwg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQwNTo0ODowOFrOGiPUiw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzUzNTY4Mg==", "bodyText": "This is usually \"dateTime\".", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/444#discussion_r437535682", "createdAt": "2020-06-09T15:48:05Z", "author": {"login": "nikklassen"}, "path": "audit-log-service/src/main/java/com/google/cloud/healthcare/fdamystudies/auditlog/common/ErrorResponse.java", "diffHunk": "@@ -0,0 +1,43 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.auditlog.common;\n+\n+import static com.google.cloud.healthcare.fdamystudies.auditlog.common.FieldNames.ERROR_DESCRIPTION;\n+import static com.google.cloud.healthcare.fdamystudies.auditlog.common.FieldNames.PATH;\n+import static com.google.cloud.healthcare.fdamystudies.auditlog.common.FieldNames.STATUS;\n+import java.time.Instant;\n+import org.springframework.web.client.RestClientResponseException;\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.databind.node.ObjectNode;\n+\n+public class ErrorResponse {\n+\n+  private String requestUri = null;\n+\n+  private RestClientResponseException restClientResponseException = null;\n+\n+  public ErrorResponse(String requestUri, RestClientResponseException restClientResponseException) {\n+    this.requestUri = requestUri;\n+    this.restClientResponseException = restClientResponseException;\n+  }\n+\n+  public JsonNode toJson() {\n+    ObjectMapper mapper = new ObjectMapper();\n+    ObjectNode errorResponse = mapper.createObjectNode();\n+    errorResponse.put(PATH, requestUri);\n+    errorResponse.put(\"datetime\", Instant.now().toEpochMilli());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "754e186be1f1668728fc27ba085d29658f9db7a8"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODU1NTc4Nw==", "bodyText": "Replaced \"dateTime\" with \"timestamp\"", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/444#discussion_r438555787", "createdAt": "2020-06-11T05:48:08Z", "author": {"login": "dhanyak-btc"}, "path": "audit-log-service/src/main/java/com/google/cloud/healthcare/fdamystudies/auditlog/common/ErrorResponse.java", "diffHunk": "@@ -0,0 +1,43 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.auditlog.common;\n+\n+import static com.google.cloud.healthcare.fdamystudies.auditlog.common.FieldNames.ERROR_DESCRIPTION;\n+import static com.google.cloud.healthcare.fdamystudies.auditlog.common.FieldNames.PATH;\n+import static com.google.cloud.healthcare.fdamystudies.auditlog.common.FieldNames.STATUS;\n+import java.time.Instant;\n+import org.springframework.web.client.RestClientResponseException;\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.databind.node.ObjectNode;\n+\n+public class ErrorResponse {\n+\n+  private String requestUri = null;\n+\n+  private RestClientResponseException restClientResponseException = null;\n+\n+  public ErrorResponse(String requestUri, RestClientResponseException restClientResponseException) {\n+    this.requestUri = requestUri;\n+    this.restClientResponseException = restClientResponseException;\n+  }\n+\n+  public JsonNode toJson() {\n+    ObjectMapper mapper = new ObjectMapper();\n+    ObjectNode errorResponse = mapper.createObjectNode();\n+    errorResponse.put(PATH, requestUri);\n+    errorResponse.put(\"datetime\", Instant.now().toEpochMilli());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzUzNTY4Mg=="}, "originalCommit": {"oid": "754e186be1f1668728fc27ba085d29658f9db7a8"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyNTc2MDQwOnYy", "diffSide": "RIGHT", "path": "audit-log-service/src/main/java/com/google/cloud/healthcare/fdamystudies/auditlog/controller/HealthController.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxNTo1MDowNVrOGhRJHg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxODowMDoyMlrOGio0Ow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzUzNzA1NA==", "bodyText": "I personally don't like entry/exit logging, but if you're going to do it then the XLogger extension for SLF4J would be much better.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/444#discussion_r437537054", "createdAt": "2020-06-09T15:50:05Z", "author": {"login": "nikklassen"}, "path": "audit-log-service/src/main/java/com/google/cloud/healthcare/fdamystudies/auditlog/controller/HealthController.java", "diffHunk": "@@ -0,0 +1,42 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.auditlog.controller;\n+\n+import javax.servlet.http.HttpServletRequest;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.http.MediaType;\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.web.bind.annotation.GetMapping;\n+import org.springframework.web.bind.annotation.RequestMapping;\n+import org.springframework.web.bind.annotation.RestController;\n+import com.fasterxml.jackson.databind.JsonNode;\n+\n+@RestController\n+@RequestMapping(\"/v1\")\n+public class HealthController extends BaseController {\n+\n+  private static final Logger LOG = LoggerFactory.getLogger(HealthController.class);\n+\n+  @GetMapping(\n+      value = \"/health\",\n+      produces = {MediaType.APPLICATION_JSON_VALUE})\n+  public ResponseEntity<JsonNode> health(HttpServletRequest request) {\n+    if (LOG.isInfoEnabled()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "754e186be1f1668728fc27ba085d29658f9db7a8"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODU1NjIyOA==", "bodyText": "Replaced logger statements with XLogger entry and exit methods.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/444#discussion_r438556228", "createdAt": "2020-06-11T05:49:50Z", "author": {"login": "dhanyak-btc"}, "path": "audit-log-service/src/main/java/com/google/cloud/healthcare/fdamystudies/auditlog/controller/HealthController.java", "diffHunk": "@@ -0,0 +1,42 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.auditlog.controller;\n+\n+import javax.servlet.http.HttpServletRequest;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.http.MediaType;\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.web.bind.annotation.GetMapping;\n+import org.springframework.web.bind.annotation.RequestMapping;\n+import org.springframework.web.bind.annotation.RestController;\n+import com.fasterxml.jackson.databind.JsonNode;\n+\n+@RestController\n+@RequestMapping(\"/v1\")\n+public class HealthController extends BaseController {\n+\n+  private static final Logger LOG = LoggerFactory.getLogger(HealthController.class);\n+\n+  @GetMapping(\n+      value = \"/health\",\n+      produces = {MediaType.APPLICATION_JSON_VALUE})\n+  public ResponseEntity<JsonNode> health(HttpServletRequest request) {\n+    if (LOG.isInfoEnabled()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzUzNzA1NA=="}, "originalCommit": {"oid": "754e186be1f1668728fc27ba085d29658f9db7a8"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODk3MzQ5OQ==", "bodyText": "I'd like to see this used throughout the other services as well.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/444#discussion_r438973499", "createdAt": "2020-06-11T18:00:22Z", "author": {"login": "nikklassen"}, "path": "audit-log-service/src/main/java/com/google/cloud/healthcare/fdamystudies/auditlog/controller/HealthController.java", "diffHunk": "@@ -0,0 +1,42 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.auditlog.controller;\n+\n+import javax.servlet.http.HttpServletRequest;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.http.MediaType;\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.web.bind.annotation.GetMapping;\n+import org.springframework.web.bind.annotation.RequestMapping;\n+import org.springframework.web.bind.annotation.RestController;\n+import com.fasterxml.jackson.databind.JsonNode;\n+\n+@RestController\n+@RequestMapping(\"/v1\")\n+public class HealthController extends BaseController {\n+\n+  private static final Logger LOG = LoggerFactory.getLogger(HealthController.class);\n+\n+  @GetMapping(\n+      value = \"/health\",\n+      produces = {MediaType.APPLICATION_JSON_VALUE})\n+  public ResponseEntity<JsonNode> health(HttpServletRequest request) {\n+    if (LOG.isInfoEnabled()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzUzNzA1NA=="}, "originalCommit": {"oid": "754e186be1f1668728fc27ba085d29658f9db7a8"}, "originalPosition": 31}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyNTgwMzk5OnYy", "diffSide": "RIGHT", "path": "audit-log-service/src/main/java/com/google/cloud/healthcare/fdamystudies/auditlog/service/BaseServiceImpl.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxNTo1OTozNVrOGhRlDA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQwNTo1MjoxNlrOGiPY9A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzU0NDIwNA==", "bodyText": "Use generics instead of Object for request.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/444#discussion_r437544204", "createdAt": "2020-06-09T15:59:35Z", "author": {"login": "nikklassen"}, "path": "audit-log-service/src/main/java/com/google/cloud/healthcare/fdamystudies/auditlog/service/BaseServiceImpl.java", "diffHunk": "@@ -0,0 +1,70 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.auditlog.service;\n+\n+import static com.google.cloud.healthcare.fdamystudies.auditlog.common.FieldNames.ERROR_CODE;\n+import static com.google.cloud.healthcare.fdamystudies.auditlog.common.FieldNames.ERROR_DESCRIPTION;\n+import static com.google.cloud.healthcare.fdamystudies.auditlog.common.FieldNames.ERROR_TYPE;\n+import static com.google.cloud.healthcare.fdamystudies.auditlog.common.FieldNames.STATUS;\n+import java.util.Collections;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpEntity;\n+import org.springframework.http.HttpHeaders;\n+import org.springframework.http.HttpMethod;\n+import org.springframework.http.MediaType;\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.web.client.HttpClientErrorException;\n+import org.springframework.web.client.HttpServerErrorException;\n+import org.springframework.web.client.RestTemplate;\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.databind.node.ObjectNode;\n+import com.google.cloud.healthcare.fdamystudies.auditlog.common.ErrorMessages;\n+import com.google.cloud.healthcare.fdamystudies.auditlog.common.ErrorResponse;\n+\n+abstract class BaseServiceImpl {\n+\n+  private static final Logger LOG = LoggerFactory.getLogger(BaseServiceImpl.class);\n+\n+  @Autowired private ObjectMapper objectMapper;\n+\n+  @Autowired private RestTemplate restTemplate;\n+\n+  public ResponseEntity<JsonNode> exchangeForJson(\n+      String url, HttpHeaders headers, Object request, HttpMethod httpMethod) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "754e186be1f1668728fc27ba085d29658f9db7a8"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODU1NjkxNg==", "bodyText": "Moved this class to common-service module and added overload methods for MultiValueMap<String, String> and JsonNode request body.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/444#discussion_r438556916", "createdAt": "2020-06-11T05:52:16Z", "author": {"login": "dhanyak-btc"}, "path": "audit-log-service/src/main/java/com/google/cloud/healthcare/fdamystudies/auditlog/service/BaseServiceImpl.java", "diffHunk": "@@ -0,0 +1,70 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.auditlog.service;\n+\n+import static com.google.cloud.healthcare.fdamystudies.auditlog.common.FieldNames.ERROR_CODE;\n+import static com.google.cloud.healthcare.fdamystudies.auditlog.common.FieldNames.ERROR_DESCRIPTION;\n+import static com.google.cloud.healthcare.fdamystudies.auditlog.common.FieldNames.ERROR_TYPE;\n+import static com.google.cloud.healthcare.fdamystudies.auditlog.common.FieldNames.STATUS;\n+import java.util.Collections;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpEntity;\n+import org.springframework.http.HttpHeaders;\n+import org.springframework.http.HttpMethod;\n+import org.springframework.http.MediaType;\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.web.client.HttpClientErrorException;\n+import org.springframework.web.client.HttpServerErrorException;\n+import org.springframework.web.client.RestTemplate;\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.databind.node.ObjectNode;\n+import com.google.cloud.healthcare.fdamystudies.auditlog.common.ErrorMessages;\n+import com.google.cloud.healthcare.fdamystudies.auditlog.common.ErrorResponse;\n+\n+abstract class BaseServiceImpl {\n+\n+  private static final Logger LOG = LoggerFactory.getLogger(BaseServiceImpl.class);\n+\n+  @Autowired private ObjectMapper objectMapper;\n+\n+  @Autowired private RestTemplate restTemplate;\n+\n+  public ResponseEntity<JsonNode> exchangeForJson(\n+      String url, HttpHeaders headers, Object request, HttpMethod httpMethod) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzU0NDIwNA=="}, "originalCommit": {"oid": "754e186be1f1668728fc27ba085d29658f9db7a8"}, "originalPosition": 42}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyNTgwNzIwOnYy", "diffSide": "RIGHT", "path": "audit-log-service/src/main/java/com/google/cloud/healthcare/fdamystudies/auditlog/service/BaseServiceImpl.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxNjowMDoyMVrOGhRnCg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQwNjozNDoxN1rOGiQP7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzU0NDcxNA==", "bodyText": "Don't catch Exception. Add a @ControllerAdvice to handle expected exceptions.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/444#discussion_r437544714", "createdAt": "2020-06-09T16:00:21Z", "author": {"login": "nikklassen"}, "path": "audit-log-service/src/main/java/com/google/cloud/healthcare/fdamystudies/auditlog/service/BaseServiceImpl.java", "diffHunk": "@@ -0,0 +1,70 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.auditlog.service;\n+\n+import static com.google.cloud.healthcare.fdamystudies.auditlog.common.FieldNames.ERROR_CODE;\n+import static com.google.cloud.healthcare.fdamystudies.auditlog.common.FieldNames.ERROR_DESCRIPTION;\n+import static com.google.cloud.healthcare.fdamystudies.auditlog.common.FieldNames.ERROR_TYPE;\n+import static com.google.cloud.healthcare.fdamystudies.auditlog.common.FieldNames.STATUS;\n+import java.util.Collections;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpEntity;\n+import org.springframework.http.HttpHeaders;\n+import org.springframework.http.HttpMethod;\n+import org.springframework.http.MediaType;\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.web.client.HttpClientErrorException;\n+import org.springframework.web.client.HttpServerErrorException;\n+import org.springframework.web.client.RestTemplate;\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.databind.node.ObjectNode;\n+import com.google.cloud.healthcare.fdamystudies.auditlog.common.ErrorMessages;\n+import com.google.cloud.healthcare.fdamystudies.auditlog.common.ErrorResponse;\n+\n+abstract class BaseServiceImpl {\n+\n+  private static final Logger LOG = LoggerFactory.getLogger(BaseServiceImpl.class);\n+\n+  @Autowired private ObjectMapper objectMapper;\n+\n+  @Autowired private RestTemplate restTemplate;\n+\n+  public ResponseEntity<JsonNode> exchangeForJson(\n+      String url, HttpHeaders headers, Object request, HttpMethod httpMethod) {\n+    headers.setAccept(Collections.singletonList(MediaType.APPLICATION_JSON));\n+    HttpEntity<Object> requestEntity = new HttpEntity<>(request, headers);\n+    try {\n+      return restTemplate.exchange(url, httpMethod, requestEntity, JsonNode.class);\n+    } catch (HttpClientErrorException | HttpServerErrorException e) {\n+      LOG.error(String.format(\"%s request failed with an exception\", url), e);\n+      ErrorResponse err = new ErrorResponse(url, e);\n+      return ResponseEntity.status(e.getRawStatusCode()).body(err.toJson());\n+    } catch (Exception e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "754e186be1f1668728fc27ba085d29658f9db7a8"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODE3MzQ4OA==", "bodyText": "See #482 for an example.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/444#discussion_r438173488", "createdAt": "2020-06-10T14:36:47Z", "author": {"login": "nikklassen"}, "path": "audit-log-service/src/main/java/com/google/cloud/healthcare/fdamystudies/auditlog/service/BaseServiceImpl.java", "diffHunk": "@@ -0,0 +1,70 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.auditlog.service;\n+\n+import static com.google.cloud.healthcare.fdamystudies.auditlog.common.FieldNames.ERROR_CODE;\n+import static com.google.cloud.healthcare.fdamystudies.auditlog.common.FieldNames.ERROR_DESCRIPTION;\n+import static com.google.cloud.healthcare.fdamystudies.auditlog.common.FieldNames.ERROR_TYPE;\n+import static com.google.cloud.healthcare.fdamystudies.auditlog.common.FieldNames.STATUS;\n+import java.util.Collections;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpEntity;\n+import org.springframework.http.HttpHeaders;\n+import org.springframework.http.HttpMethod;\n+import org.springframework.http.MediaType;\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.web.client.HttpClientErrorException;\n+import org.springframework.web.client.HttpServerErrorException;\n+import org.springframework.web.client.RestTemplate;\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.databind.node.ObjectNode;\n+import com.google.cloud.healthcare.fdamystudies.auditlog.common.ErrorMessages;\n+import com.google.cloud.healthcare.fdamystudies.auditlog.common.ErrorResponse;\n+\n+abstract class BaseServiceImpl {\n+\n+  private static final Logger LOG = LoggerFactory.getLogger(BaseServiceImpl.class);\n+\n+  @Autowired private ObjectMapper objectMapper;\n+\n+  @Autowired private RestTemplate restTemplate;\n+\n+  public ResponseEntity<JsonNode> exchangeForJson(\n+      String url, HttpHeaders headers, Object request, HttpMethod httpMethod) {\n+    headers.setAccept(Collections.singletonList(MediaType.APPLICATION_JSON));\n+    HttpEntity<Object> requestEntity = new HttpEntity<>(request, headers);\n+    try {\n+      return restTemplate.exchange(url, httpMethod, requestEntity, JsonNode.class);\n+    } catch (HttpClientErrorException | HttpServerErrorException e) {\n+      LOG.error(String.format(\"%s request failed with an exception\", url), e);\n+      ErrorResponse err = new ErrorResponse(url, e);\n+      return ResponseEntity.status(e.getRawStatusCode()).body(err.toJson());\n+    } catch (Exception e) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzU0NDcxNA=="}, "originalCommit": {"oid": "754e186be1f1668728fc27ba085d29658f9db7a8"}, "originalPosition": 51}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODU3MDk5MQ==", "bodyText": "Added RestExceptionHandler class in common-service module. Sometimes, we need to catch Exception to post audit log event to central audit log system.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/444#discussion_r438570991", "createdAt": "2020-06-11T06:34:17Z", "author": {"login": "dhanyak-btc"}, "path": "audit-log-service/src/main/java/com/google/cloud/healthcare/fdamystudies/auditlog/service/BaseServiceImpl.java", "diffHunk": "@@ -0,0 +1,70 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.auditlog.service;\n+\n+import static com.google.cloud.healthcare.fdamystudies.auditlog.common.FieldNames.ERROR_CODE;\n+import static com.google.cloud.healthcare.fdamystudies.auditlog.common.FieldNames.ERROR_DESCRIPTION;\n+import static com.google.cloud.healthcare.fdamystudies.auditlog.common.FieldNames.ERROR_TYPE;\n+import static com.google.cloud.healthcare.fdamystudies.auditlog.common.FieldNames.STATUS;\n+import java.util.Collections;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpEntity;\n+import org.springframework.http.HttpHeaders;\n+import org.springframework.http.HttpMethod;\n+import org.springframework.http.MediaType;\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.web.client.HttpClientErrorException;\n+import org.springframework.web.client.HttpServerErrorException;\n+import org.springframework.web.client.RestTemplate;\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.databind.node.ObjectNode;\n+import com.google.cloud.healthcare.fdamystudies.auditlog.common.ErrorMessages;\n+import com.google.cloud.healthcare.fdamystudies.auditlog.common.ErrorResponse;\n+\n+abstract class BaseServiceImpl {\n+\n+  private static final Logger LOG = LoggerFactory.getLogger(BaseServiceImpl.class);\n+\n+  @Autowired private ObjectMapper objectMapper;\n+\n+  @Autowired private RestTemplate restTemplate;\n+\n+  public ResponseEntity<JsonNode> exchangeForJson(\n+      String url, HttpHeaders headers, Object request, HttpMethod httpMethod) {\n+    headers.setAccept(Collections.singletonList(MediaType.APPLICATION_JSON));\n+    HttpEntity<Object> requestEntity = new HttpEntity<>(request, headers);\n+    try {\n+      return restTemplate.exchange(url, httpMethod, requestEntity, JsonNode.class);\n+    } catch (HttpClientErrorException | HttpServerErrorException e) {\n+      LOG.error(String.format(\"%s request failed with an exception\", url), e);\n+      ErrorResponse err = new ErrorResponse(url, e);\n+      return ResponseEntity.status(e.getRawStatusCode()).body(err.toJson());\n+    } catch (Exception e) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzU0NDcxNA=="}, "originalCommit": {"oid": "754e186be1f1668728fc27ba085d29658f9db7a8"}, "originalPosition": 51}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyNjAzNDQzOnYy", "diffSide": "RIGHT", "path": "audit-log-service/src/main/java/com/google/cloud/healthcare/fdamystudies/auditlog/service/OAuthService.java", "isResolved": false, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxNjo1OTo0NVrOGhT5dQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQyMDoxOToyOFrOGkBUbA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzU4MjE5Nw==", "bodyText": "It would be better to use a real type here instead of JsonNode.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/444#discussion_r437582197", "createdAt": "2020-06-09T16:59:45Z", "author": {"login": "nikklassen"}, "path": "audit-log-service/src/main/java/com/google/cloud/healthcare/fdamystudies/auditlog/service/OAuthService.java", "diffHunk": "@@ -0,0 +1,17 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.auditlog.service;\n+\n+import org.springframework.http.ResponseEntity;\n+import com.fasterxml.jackson.databind.JsonNode;\n+\n+public interface OAuthService {\n+\n+  public ResponseEntity<JsonNode> health();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "754e186be1f1668728fc27ba085d29658f9db7a8"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODU3NDA0Ng==", "bodyText": "I've used Jakson's JsonNode/ObjectNode for REST API's request/response payload. I've also used JSON Schema validator for request payload validation.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/444#discussion_r438574046", "createdAt": "2020-06-11T06:42:37Z", "author": {"login": "dhanyak-btc"}, "path": "audit-log-service/src/main/java/com/google/cloud/healthcare/fdamystudies/auditlog/service/OAuthService.java", "diffHunk": "@@ -0,0 +1,17 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.auditlog.service;\n+\n+import org.springframework.http.ResponseEntity;\n+import com.fasterxml.jackson.databind.JsonNode;\n+\n+public interface OAuthService {\n+\n+  public ResponseEntity<JsonNode> health();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzU4MjE5Nw=="}, "originalCommit": {"oid": "754e186be1f1668728fc27ba085d29658f9db7a8"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODk3NTIyNQ==", "bodyText": "The Jackson JsonNode API isn't really intended to be used in your code, only during serialization/deserialization. In your code you should be using your own business data classes. Most, if not all, serialization should take place automatically.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/444#discussion_r438975225", "createdAt": "2020-06-11T18:03:34Z", "author": {"login": "nikklassen"}, "path": "audit-log-service/src/main/java/com/google/cloud/healthcare/fdamystudies/auditlog/service/OAuthService.java", "diffHunk": "@@ -0,0 +1,17 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.auditlog.service;\n+\n+import org.springframework.http.ResponseEntity;\n+import com.fasterxml.jackson.databind.JsonNode;\n+\n+public interface OAuthService {\n+\n+  public ResponseEntity<JsonNode> health();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzU4MjE5Nw=="}, "originalCommit": {"oid": "754e186be1f1668728fc27ba085d29658f9db7a8"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTk0NjQ5MQ==", "bodyText": "I believe we can use JsonNode API's. I found this article useful: Jackson\u2019s JsonNode for Payload unaware request Handling", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/444#discussion_r439946491", "createdAt": "2020-06-15T06:03:46Z", "author": {"login": "dhanyak-btc"}, "path": "audit-log-service/src/main/java/com/google/cloud/healthcare/fdamystudies/auditlog/service/OAuthService.java", "diffHunk": "@@ -0,0 +1,17 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.auditlog.service;\n+\n+import org.springframework.http.ResponseEntity;\n+import com.fasterxml.jackson.databind.JsonNode;\n+\n+public interface OAuthService {\n+\n+  public ResponseEntity<JsonNode> health();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzU4MjE5Nw=="}, "originalCommit": {"oid": "754e186be1f1668728fc27ba085d29658f9db7a8"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDQyMzUzMg==", "bodyText": "That blog post does cover this case, where we are just passing the packet through, so it's probably fine. However, if we need to analyze this response at all we should parse it.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/444#discussion_r440423532", "createdAt": "2020-06-15T20:19:28Z", "author": {"login": "nikklassen"}, "path": "audit-log-service/src/main/java/com/google/cloud/healthcare/fdamystudies/auditlog/service/OAuthService.java", "diffHunk": "@@ -0,0 +1,17 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.auditlog.service;\n+\n+import org.springframework.http.ResponseEntity;\n+import com.fasterxml.jackson.databind.JsonNode;\n+\n+public interface OAuthService {\n+\n+  public ResponseEntity<JsonNode> health();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzU4MjE5Nw=="}, "originalCommit": {"oid": "754e186be1f1668728fc27ba085d29658f9db7a8"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyNjAzNjYwOnYy", "diffSide": "RIGHT", "path": "audit-log-service/src/main/java/com/google/cloud/healthcare/fdamystudies/auditlog/service/OAuthServiceImpl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxNzowMDoyM1rOGhT7BA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQwNjo1NDowOFrOGiQteQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzU4MjU5Ng==", "bodyText": "You are already adding this in BaseServiceImpl", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/444#discussion_r437582596", "createdAt": "2020-06-09T17:00:23Z", "author": {"login": "nikklassen"}, "path": "audit-log-service/src/main/java/com/google/cloud/healthcare/fdamystudies/auditlog/service/OAuthServiceImpl.java", "diffHunk": "@@ -0,0 +1,34 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.auditlog.service;\n+\n+import java.util.Collections;\n+import org.springframework.beans.factory.annotation.Value;\n+import org.springframework.http.HttpHeaders;\n+import org.springframework.http.HttpMethod;\n+import org.springframework.http.MediaType;\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.stereotype.Service;\n+import com.fasterxml.jackson.databind.JsonNode;\n+\n+@Service\n+class OAuthServiceImpl extends BaseServiceImpl implements OAuthService {\n+\n+  @Value(\"${security.oauth2.health_endpoint}\")\n+  private String healthEndpoint;\n+\n+  @Override\n+  public ResponseEntity<JsonNode> health() {\n+    HttpHeaders headers = new HttpHeaders();\n+    headers.setAccept(Collections.singletonList(MediaType.APPLICATION_JSON));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "754e186be1f1668728fc27ba085d29658f9db7a8"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODU3ODU1Mw==", "bodyText": "Removed Accept header from this method.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/444#discussion_r438578553", "createdAt": "2020-06-11T06:54:08Z", "author": {"login": "dhanyak-btc"}, "path": "audit-log-service/src/main/java/com/google/cloud/healthcare/fdamystudies/auditlog/service/OAuthServiceImpl.java", "diffHunk": "@@ -0,0 +1,34 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.auditlog.service;\n+\n+import java.util.Collections;\n+import org.springframework.beans.factory.annotation.Value;\n+import org.springframework.http.HttpHeaders;\n+import org.springframework.http.HttpMethod;\n+import org.springframework.http.MediaType;\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.stereotype.Service;\n+import com.fasterxml.jackson.databind.JsonNode;\n+\n+@Service\n+class OAuthServiceImpl extends BaseServiceImpl implements OAuthService {\n+\n+  @Value(\"${security.oauth2.health_endpoint}\")\n+  private String healthEndpoint;\n+\n+  @Override\n+  public ResponseEntity<JsonNode> health() {\n+    HttpHeaders headers = new HttpHeaders();\n+    headers.setAccept(Collections.singletonList(MediaType.APPLICATION_JSON));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzU4MjU5Ng=="}, "originalCommit": {"oid": "754e186be1f1668728fc27ba085d29658f9db7a8"}, "originalPosition": 29}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyNjAzODYzOnYy", "diffSide": "RIGHT", "path": "audit-log-service/src/main/java/com/google/cloud/healthcare/fdamystudies/auditlog/service/OAuthServiceImpl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxNzowMDo1NVrOGhT8Rw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQwNjo1NDo0NVrOGiQugg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzU4MjkxOQ==", "bodyText": "Do this in BaseServiceImpl, we are using JSON for everything.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/444#discussion_r437582919", "createdAt": "2020-06-09T17:00:55Z", "author": {"login": "nikklassen"}, "path": "audit-log-service/src/main/java/com/google/cloud/healthcare/fdamystudies/auditlog/service/OAuthServiceImpl.java", "diffHunk": "@@ -0,0 +1,34 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.auditlog.service;\n+\n+import java.util.Collections;\n+import org.springframework.beans.factory.annotation.Value;\n+import org.springframework.http.HttpHeaders;\n+import org.springframework.http.HttpMethod;\n+import org.springframework.http.MediaType;\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.stereotype.Service;\n+import com.fasterxml.jackson.databind.JsonNode;\n+\n+@Service\n+class OAuthServiceImpl extends BaseServiceImpl implements OAuthService {\n+\n+  @Value(\"${security.oauth2.health_endpoint}\")\n+  private String healthEndpoint;\n+\n+  @Override\n+  public ResponseEntity<JsonNode> health() {\n+    HttpHeaders headers = new HttpHeaders();\n+    headers.setAccept(Collections.singletonList(MediaType.APPLICATION_JSON));\n+    headers.setContentType(MediaType.APPLICATION_JSON);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "754e186be1f1668728fc27ba085d29658f9db7a8"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODU3ODgxOA==", "bodyText": "Removed Accept & ContentType header from this method", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/444#discussion_r438578818", "createdAt": "2020-06-11T06:54:45Z", "author": {"login": "dhanyak-btc"}, "path": "audit-log-service/src/main/java/com/google/cloud/healthcare/fdamystudies/auditlog/service/OAuthServiceImpl.java", "diffHunk": "@@ -0,0 +1,34 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.auditlog.service;\n+\n+import java.util.Collections;\n+import org.springframework.beans.factory.annotation.Value;\n+import org.springframework.http.HttpHeaders;\n+import org.springframework.http.HttpMethod;\n+import org.springframework.http.MediaType;\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.stereotype.Service;\n+import com.fasterxml.jackson.databind.JsonNode;\n+\n+@Service\n+class OAuthServiceImpl extends BaseServiceImpl implements OAuthService {\n+\n+  @Value(\"${security.oauth2.health_endpoint}\")\n+  private String healthEndpoint;\n+\n+  @Override\n+  public ResponseEntity<JsonNode> health() {\n+    HttpHeaders headers = new HttpHeaders();\n+    headers.setAccept(Collections.singletonList(MediaType.APPLICATION_JSON));\n+    headers.setContentType(MediaType.APPLICATION_JSON);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzU4MjkxOQ=="}, "originalCommit": {"oid": "754e186be1f1668728fc27ba085d29658f9db7a8"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyNjA0MTYzOnYy", "diffSide": "RIGHT", "path": "audit-log-service/src/main/java/com/google/cloud/healthcare/fdamystudies/auditlog/service/OAuthServiceImpl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxNzowMTo0OFrOGhT-OA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQwNjo1NjoxMFrOGiQxEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzU4MzQxNg==", "bodyText": "Better to create an overload for GET because it will never have a request", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/444#discussion_r437583416", "createdAt": "2020-06-09T17:01:48Z", "author": {"login": "nikklassen"}, "path": "audit-log-service/src/main/java/com/google/cloud/healthcare/fdamystudies/auditlog/service/OAuthServiceImpl.java", "diffHunk": "@@ -0,0 +1,34 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.auditlog.service;\n+\n+import java.util.Collections;\n+import org.springframework.beans.factory.annotation.Value;\n+import org.springframework.http.HttpHeaders;\n+import org.springframework.http.HttpMethod;\n+import org.springframework.http.MediaType;\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.stereotype.Service;\n+import com.fasterxml.jackson.databind.JsonNode;\n+\n+@Service\n+class OAuthServiceImpl extends BaseServiceImpl implements OAuthService {\n+\n+  @Value(\"${security.oauth2.health_endpoint}\")\n+  private String healthEndpoint;\n+\n+  @Override\n+  public ResponseEntity<JsonNode> health() {\n+    HttpHeaders headers = new HttpHeaders();\n+    headers.setAccept(Collections.singletonList(MediaType.APPLICATION_JSON));\n+    headers.setContentType(MediaType.APPLICATION_JSON);\n+\n+    return exchangeForJson(healthEndpoint, headers, null, HttpMethod.GET);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "754e186be1f1668728fc27ba085d29658f9db7a8"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODU3OTQ3Mg==", "bodyText": "Added a method for GET in BaseServiceImpl (in common-service module)", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/444#discussion_r438579472", "createdAt": "2020-06-11T06:56:10Z", "author": {"login": "dhanyak-btc"}, "path": "audit-log-service/src/main/java/com/google/cloud/healthcare/fdamystudies/auditlog/service/OAuthServiceImpl.java", "diffHunk": "@@ -0,0 +1,34 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.auditlog.service;\n+\n+import java.util.Collections;\n+import org.springframework.beans.factory.annotation.Value;\n+import org.springframework.http.HttpHeaders;\n+import org.springframework.http.HttpMethod;\n+import org.springframework.http.MediaType;\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.stereotype.Service;\n+import com.fasterxml.jackson.databind.JsonNode;\n+\n+@Service\n+class OAuthServiceImpl extends BaseServiceImpl implements OAuthService {\n+\n+  @Value(\"${security.oauth2.health_endpoint}\")\n+  private String healthEndpoint;\n+\n+  @Override\n+  public ResponseEntity<JsonNode> health() {\n+    HttpHeaders headers = new HttpHeaders();\n+    headers.setAccept(Collections.singletonList(MediaType.APPLICATION_JSON));\n+    headers.setContentType(MediaType.APPLICATION_JSON);\n+\n+    return exchangeForJson(healthEndpoint, headers, null, HttpMethod.GET);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzU4MzQxNg=="}, "originalCommit": {"oid": "754e186be1f1668728fc27ba085d29658f9db7a8"}, "originalPosition": 32}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyNjA5MTAwOnYy", "diffSide": "RIGHT", "path": "audit-log-service/src/main/java/com/google/cloud/healthcare/fdamystudies/auditlog/service/BaseServiceImpl.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxNzoxNjowN1rOGhUe_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQwNjo1Nzo1NlrOGiQ0BA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzU5MTgwNQ==", "bodyText": "serialization should be implemented in the ErrorMessage class, see my example in this commit", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/444#discussion_r437591805", "createdAt": "2020-06-09T17:16:07Z", "author": {"login": "nikklassen"}, "path": "audit-log-service/src/main/java/com/google/cloud/healthcare/fdamystudies/auditlog/service/BaseServiceImpl.java", "diffHunk": "@@ -0,0 +1,70 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.auditlog.service;\n+\n+import static com.google.cloud.healthcare.fdamystudies.auditlog.common.FieldNames.ERROR_CODE;\n+import static com.google.cloud.healthcare.fdamystudies.auditlog.common.FieldNames.ERROR_DESCRIPTION;\n+import static com.google.cloud.healthcare.fdamystudies.auditlog.common.FieldNames.ERROR_TYPE;\n+import static com.google.cloud.healthcare.fdamystudies.auditlog.common.FieldNames.STATUS;\n+import java.util.Collections;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpEntity;\n+import org.springframework.http.HttpHeaders;\n+import org.springframework.http.HttpMethod;\n+import org.springframework.http.MediaType;\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.web.client.HttpClientErrorException;\n+import org.springframework.web.client.HttpServerErrorException;\n+import org.springframework.web.client.RestTemplate;\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.databind.node.ObjectNode;\n+import com.google.cloud.healthcare.fdamystudies.auditlog.common.ErrorMessages;\n+import com.google.cloud.healthcare.fdamystudies.auditlog.common.ErrorResponse;\n+\n+abstract class BaseServiceImpl {\n+\n+  private static final Logger LOG = LoggerFactory.getLogger(BaseServiceImpl.class);\n+\n+  @Autowired private ObjectMapper objectMapper;\n+\n+  @Autowired private RestTemplate restTemplate;\n+\n+  public ResponseEntity<JsonNode> exchangeForJson(\n+      String url, HttpHeaders headers, Object request, HttpMethod httpMethod) {\n+    headers.setAccept(Collections.singletonList(MediaType.APPLICATION_JSON));\n+    HttpEntity<Object> requestEntity = new HttpEntity<>(request, headers);\n+    try {\n+      return restTemplate.exchange(url, httpMethod, requestEntity, JsonNode.class);\n+    } catch (HttpClientErrorException | HttpServerErrorException e) {\n+      LOG.error(String.format(\"%s request failed with an exception\", url), e);\n+      ErrorResponse err = new ErrorResponse(url, e);\n+      return ResponseEntity.status(e.getRawStatusCode()).body(err.toJson());\n+    } catch (Exception e) {\n+      LOG.error(String.format(\"%s request failed with an exception\", url), e);\n+      return ResponseEntity.status(ErrorMessages.APPLICATION_ERROR.getStatusCode())\n+          .body(getErrorResponse(ErrorMessages.APPLICATION_ERROR));\n+    }\n+  }\n+\n+  protected ObjectNode getObjectNode() {\n+    return objectMapper.createObjectNode();\n+  }\n+\n+  protected JsonNode getErrorResponse(ErrorMessages error) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "754e186be1f1668728fc27ba085d29658f9db7a8"}, "originalPosition": 62}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODU4MDIyOA==", "bodyText": "Thank you for providing an example.\nRenamed this enum to ErrorCode and implemented serialization as per the example.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/444#discussion_r438580228", "createdAt": "2020-06-11T06:57:56Z", "author": {"login": "dhanyak-btc"}, "path": "audit-log-service/src/main/java/com/google/cloud/healthcare/fdamystudies/auditlog/service/BaseServiceImpl.java", "diffHunk": "@@ -0,0 +1,70 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.auditlog.service;\n+\n+import static com.google.cloud.healthcare.fdamystudies.auditlog.common.FieldNames.ERROR_CODE;\n+import static com.google.cloud.healthcare.fdamystudies.auditlog.common.FieldNames.ERROR_DESCRIPTION;\n+import static com.google.cloud.healthcare.fdamystudies.auditlog.common.FieldNames.ERROR_TYPE;\n+import static com.google.cloud.healthcare.fdamystudies.auditlog.common.FieldNames.STATUS;\n+import java.util.Collections;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpEntity;\n+import org.springframework.http.HttpHeaders;\n+import org.springframework.http.HttpMethod;\n+import org.springframework.http.MediaType;\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.web.client.HttpClientErrorException;\n+import org.springframework.web.client.HttpServerErrorException;\n+import org.springframework.web.client.RestTemplate;\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.databind.node.ObjectNode;\n+import com.google.cloud.healthcare.fdamystudies.auditlog.common.ErrorMessages;\n+import com.google.cloud.healthcare.fdamystudies.auditlog.common.ErrorResponse;\n+\n+abstract class BaseServiceImpl {\n+\n+  private static final Logger LOG = LoggerFactory.getLogger(BaseServiceImpl.class);\n+\n+  @Autowired private ObjectMapper objectMapper;\n+\n+  @Autowired private RestTemplate restTemplate;\n+\n+  public ResponseEntity<JsonNode> exchangeForJson(\n+      String url, HttpHeaders headers, Object request, HttpMethod httpMethod) {\n+    headers.setAccept(Collections.singletonList(MediaType.APPLICATION_JSON));\n+    HttpEntity<Object> requestEntity = new HttpEntity<>(request, headers);\n+    try {\n+      return restTemplate.exchange(url, httpMethod, requestEntity, JsonNode.class);\n+    } catch (HttpClientErrorException | HttpServerErrorException e) {\n+      LOG.error(String.format(\"%s request failed with an exception\", url), e);\n+      ErrorResponse err = new ErrorResponse(url, e);\n+      return ResponseEntity.status(e.getRawStatusCode()).body(err.toJson());\n+    } catch (Exception e) {\n+      LOG.error(String.format(\"%s request failed with an exception\", url), e);\n+      return ResponseEntity.status(ErrorMessages.APPLICATION_ERROR.getStatusCode())\n+          .body(getErrorResponse(ErrorMessages.APPLICATION_ERROR));\n+    }\n+  }\n+\n+  protected ObjectNode getObjectNode() {\n+    return objectMapper.createObjectNode();\n+  }\n+\n+  protected JsonNode getErrorResponse(ErrorMessages error) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzU5MTgwNQ=="}, "originalCommit": {"oid": "754e186be1f1668728fc27ba085d29658f9db7a8"}, "originalPosition": 62}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyNjEwNDM4OnYy", "diffSide": "RIGHT", "path": "audit-log-service/src/main/java/com/google/cloud/healthcare/fdamystudies/auditlog/common/ErrorMessages.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxNzoyMDowNVrOGhUnvw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQwNjo1ODoxOVrOGiQ0nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzU5NDA0Nw==", "bodyText": "Should be something like ErrorCode, is not just a message.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/444#discussion_r437594047", "createdAt": "2020-06-09T17:20:05Z", "author": {"login": "nikklassen"}, "path": "audit-log-service/src/main/java/com/google/cloud/healthcare/fdamystudies/auditlog/common/ErrorMessages.java", "diffHunk": "@@ -0,0 +1,34 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.auditlog.common;\n+\n+import lombok.Getter;\n+import lombok.RequiredArgsConstructor;\n+import lombok.ToString;\n+\n+@Getter\n+@ToString\n+@RequiredArgsConstructor\n+public enum ErrorMessages {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "754e186be1f1668728fc27ba085d29658f9db7a8"}, "originalPosition": 18}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODU4MDM4Mw==", "bodyText": "Renamed this enum to ErrorCode", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/444#discussion_r438580383", "createdAt": "2020-06-11T06:58:19Z", "author": {"login": "dhanyak-btc"}, "path": "audit-log-service/src/main/java/com/google/cloud/healthcare/fdamystudies/auditlog/common/ErrorMessages.java", "diffHunk": "@@ -0,0 +1,34 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.auditlog.common;\n+\n+import lombok.Getter;\n+import lombok.RequiredArgsConstructor;\n+import lombok.ToString;\n+\n+@Getter\n+@ToString\n+@RequiredArgsConstructor\n+public enum ErrorMessages {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzU5NDA0Nw=="}, "originalCommit": {"oid": "754e186be1f1668728fc27ba085d29658f9db7a8"}, "originalPosition": 18}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyNjEwNjg3OnYy", "diffSide": "RIGHT", "path": "audit-log-service/src/test/java/com/google/cloud/healthcare/fdamystudies/auditlog/common/ApiEndpoints.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxNzoyMDo0MlrOGhUpTA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQwNjo1ODo0MFrOGiQ1Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzU5NDQ0NA==", "bodyText": "Enums shouldn't be plural", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/444#discussion_r437594444", "createdAt": "2020-06-09T17:20:42Z", "author": {"login": "nikklassen"}, "path": "audit-log-service/src/test/java/com/google/cloud/healthcare/fdamystudies/auditlog/common/ApiEndpoints.java", "diffHunk": "@@ -0,0 +1,35 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.auditlog.common;\n+\n+import org.apache.commons.lang3.StringUtils;\n+\n+public enum ApiEndpoints {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "754e186be1f1668728fc27ba085d29658f9db7a8"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODU4MDUzMQ==", "bodyText": "Renamed the enum to ApiEndpoint", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/444#discussion_r438580531", "createdAt": "2020-06-11T06:58:40Z", "author": {"login": "dhanyak-btc"}, "path": "audit-log-service/src/test/java/com/google/cloud/healthcare/fdamystudies/auditlog/common/ApiEndpoints.java", "diffHunk": "@@ -0,0 +1,35 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.auditlog.common;\n+\n+import org.apache.commons.lang3.StringUtils;\n+\n+public enum ApiEndpoints {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzU5NDQ0NA=="}, "originalCommit": {"oid": "754e186be1f1668728fc27ba085d29658f9db7a8"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyNjExODQ4OnYy", "diffSide": "RIGHT", "path": "audit-log-service/src/test/java/com/google/cloud/healthcare/fdamystudies/auditlog/common/ApiEndpoints.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxNzoyNDowNVrOGhUw4g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQwNjo1OTo1NVrOGiQ3WA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzU5NjM4Ng==", "bodyText": "URLs with a different port should be a different URL", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/444#discussion_r437596386", "createdAt": "2020-06-09T17:24:05Z", "author": {"login": "nikklassen"}, "path": "audit-log-service/src/test/java/com/google/cloud/healthcare/fdamystudies/auditlog/common/ApiEndpoints.java", "diffHunk": "@@ -0,0 +1,35 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.auditlog.common;\n+\n+import org.apache.commons.lang3.StringUtils;\n+\n+public enum ApiEndpoints {\n+  HEALTH(\"http://localhost:8001/audit-log-service/v1/health\"),\n+\n+  EVENTS(\"http://localhost:8001/audit-log-service/v1/events\");\n+\n+  private String url;\n+\n+  private ApiEndpoints(String url) {\n+    this.url = url;\n+  }\n+\n+  public String getUrl(int port) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "754e186be1f1668728fc27ba085d29658f9db7a8"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODU4MTA4MA==", "bodyText": "Removed this unused method.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/444#discussion_r438581080", "createdAt": "2020-06-11T06:59:55Z", "author": {"login": "dhanyak-btc"}, "path": "audit-log-service/src/test/java/com/google/cloud/healthcare/fdamystudies/auditlog/common/ApiEndpoints.java", "diffHunk": "@@ -0,0 +1,35 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.auditlog.common;\n+\n+import org.apache.commons.lang3.StringUtils;\n+\n+public enum ApiEndpoints {\n+  HEALTH(\"http://localhost:8001/audit-log-service/v1/health\"),\n+\n+  EVENTS(\"http://localhost:8001/audit-log-service/v1/events\");\n+\n+  private String url;\n+\n+  private ApiEndpoints(String url) {\n+    this.url = url;\n+  }\n+\n+  public String getUrl(int port) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzU5NjM4Ng=="}, "originalCommit": {"oid": "754e186be1f1668728fc27ba085d29658f9db7a8"}, "originalPosition": 24}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyNjEyMDE1OnYy", "diffSide": "RIGHT", "path": "audit-log-service/src/test/java/com/google/cloud/healthcare/fdamystudies/auditlog/common/BaseMockIT.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxNzoyNDozNFrOGhUx9Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQwNzowMToxOFrOGiQ6CA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzU5NjY2MQ==", "bodyText": "This is another class that would be great to share across services.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/444#discussion_r437596661", "createdAt": "2020-06-09T17:24:34Z", "author": {"login": "nikklassen"}, "path": "audit-log-service/src/test/java/com/google/cloud/healthcare/fdamystudies/auditlog/common/BaseMockIT.java", "diffHunk": "@@ -0,0 +1,99 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.auditlog.common;\n+\n+import static org.hamcrest.CoreMatchers.containsString;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.post;\n+import static org.springframework.test.web.servlet.result.MockMvcResultHandlers.print;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.content;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;\n+import org.apache.commons.lang3.StringUtils;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.beans.factory.annotation.Value;\n+import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;\n+import org.springframework.boot.test.context.SpringBootTest;\n+import org.springframework.boot.test.context.SpringBootTest.WebEnvironment;\n+import org.springframework.http.HttpHeaders;\n+import org.springframework.test.context.ActiveProfiles;\n+import org.springframework.test.context.ContextConfiguration;\n+import org.springframework.test.web.servlet.MockMvc;\n+import org.springframework.test.web.servlet.ResultMatcher;\n+import com.github.tomakehurst.wiremock.WireMockServer;\n+import com.google.cloud.healthcare.fdamystudies.auditlog.config.WireMockInitializer;\n+\n+@ContextConfiguration(initializers = {WireMockInitializer.class})\n+@SpringBootTest(webEnvironment = WebEnvironment.RANDOM_PORT)\n+@AutoConfigureMockMvc\n+@ActiveProfiles(\"mockit\")\n+public class BaseMockIT {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "754e186be1f1668728fc27ba085d29658f9db7a8"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODU4MTc2OA==", "bodyText": "Moved this class and WireMockInitializer to common-tests module.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/444#discussion_r438581768", "createdAt": "2020-06-11T07:01:18Z", "author": {"login": "dhanyak-btc"}, "path": "audit-log-service/src/test/java/com/google/cloud/healthcare/fdamystudies/auditlog/common/BaseMockIT.java", "diffHunk": "@@ -0,0 +1,99 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.auditlog.common;\n+\n+import static org.hamcrest.CoreMatchers.containsString;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.post;\n+import static org.springframework.test.web.servlet.result.MockMvcResultHandlers.print;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.content;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;\n+import org.apache.commons.lang3.StringUtils;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.beans.factory.annotation.Value;\n+import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;\n+import org.springframework.boot.test.context.SpringBootTest;\n+import org.springframework.boot.test.context.SpringBootTest.WebEnvironment;\n+import org.springframework.http.HttpHeaders;\n+import org.springframework.test.context.ActiveProfiles;\n+import org.springframework.test.context.ContextConfiguration;\n+import org.springframework.test.web.servlet.MockMvc;\n+import org.springframework.test.web.servlet.ResultMatcher;\n+import com.github.tomakehurst.wiremock.WireMockServer;\n+import com.google.cloud.healthcare.fdamystudies.auditlog.config.WireMockInitializer;\n+\n+@ContextConfiguration(initializers = {WireMockInitializer.class})\n+@SpringBootTest(webEnvironment = WebEnvironment.RANDOM_PORT)\n+@AutoConfigureMockMvc\n+@ActiveProfiles(\"mockit\")\n+public class BaseMockIT {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzU5NjY2MQ=="}, "originalCommit": {"oid": "754e186be1f1668728fc27ba085d29658f9db7a8"}, "originalPosition": 35}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyNjEyNjE0OnYy", "diffSide": "RIGHT", "path": "audit-log-service/src/test/java/com/google/cloud/healthcare/fdamystudies/auditlog/common/BaseMockIT.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxNzoyNjowOFrOGhU1tA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQwNzozODoxOFrOGiR-JA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzU5NzYyMA==", "bodyText": "Only wrap the revelant part of the code in the condition. i.e.\nrequest = get(path)\nif (!StringUtils.isEmpty(requestBody)) {\n    request = request.content(requestBody)\n}\n\nBut if we don't perform get requests with a body than this is unnecessary.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/444#discussion_r437597620", "createdAt": "2020-06-09T17:26:08Z", "author": {"login": "nikklassen"}, "path": "audit-log-service/src/test/java/com/google/cloud/healthcare/fdamystudies/auditlog/common/BaseMockIT.java", "diffHunk": "@@ -0,0 +1,99 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.auditlog.common;\n+\n+import static org.hamcrest.CoreMatchers.containsString;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.post;\n+import static org.springframework.test.web.servlet.result.MockMvcResultHandlers.print;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.content;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;\n+import org.apache.commons.lang3.StringUtils;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.beans.factory.annotation.Value;\n+import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;\n+import org.springframework.boot.test.context.SpringBootTest;\n+import org.springframework.boot.test.context.SpringBootTest.WebEnvironment;\n+import org.springframework.http.HttpHeaders;\n+import org.springframework.test.context.ActiveProfiles;\n+import org.springframework.test.context.ContextConfiguration;\n+import org.springframework.test.web.servlet.MockMvc;\n+import org.springframework.test.web.servlet.ResultMatcher;\n+import com.github.tomakehurst.wiremock.WireMockServer;\n+import com.google.cloud.healthcare.fdamystudies.auditlog.config.WireMockInitializer;\n+\n+@ContextConfiguration(initializers = {WireMockInitializer.class})\n+@SpringBootTest(webEnvironment = WebEnvironment.RANDOM_PORT)\n+@AutoConfigureMockMvc\n+@ActiveProfiles(\"mockit\")\n+public class BaseMockIT {\n+\n+  protected static final String VALID_BEARER_TOKEN = \"Bearer 7fd50c2c-d618-493c-89d6-f1887e3e4bb8\";\n+\n+  protected static final String INVALID_BEARER_TOKEN =\n+      \"Bearer cd57710c-1d19-4058-8bfe-a6aac3a39e35\";\n+\n+  protected static final ResultMatcher OK = status().isOk();\n+\n+  protected static final ResultMatcher BAD_REQUEST = status().isBadRequest();\n+\n+  protected static final ResultMatcher UNAUTHORIZED = status().isUnauthorized();\n+\n+  protected static final ResultMatcher CREATED = status().isCreated();\n+\n+  protected static final ResultMatcher NOT_FOUND = status().isNotFound();\n+\n+  @Autowired private WireMockServer wireMockServer;\n+\n+  @Autowired protected MockMvc mockMvc;\n+\n+  @Value(\"${server.servlet.contextPath}\")\n+  protected String contextPath;\n+\n+  protected WireMockServer getWireMockServer() {\n+    return wireMockServer;\n+  }\n+\n+  protected void performPost(\n+      String path,\n+      String requestBody,\n+      HttpHeaders headers,\n+      String expectedTextInResponseBody,\n+      ResultMatcher httpStatusMatcher)\n+      throws Exception {\n+    mockMvc\n+        .perform(post(path).contextPath(contextPath).content(requestBody).headers(headers))\n+        .andDo(print())\n+        .andExpect(httpStatusMatcher)\n+        .andExpect(content().string(containsString(expectedTextInResponseBody)));\n+  }\n+\n+  protected void performGet(\n+      String path,\n+      String requestBody,\n+      HttpHeaders headers,\n+      String expectedTextInResponseBody,\n+      ResultMatcher httpStatusMatcher)\n+      throws Exception {\n+\n+    if (StringUtils.isEmpty(requestBody)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "754e186be1f1668728fc27ba085d29658f9db7a8"}, "originalPosition": 85}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODU5OTIwNA==", "bodyText": "I've used MockHttpServletRequestBuilder to conditionally add request body, cookies and query params. Please review the refactored code in common-tests module.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/444#discussion_r438599204", "createdAt": "2020-06-11T07:38:18Z", "author": {"login": "dhanyak-btc"}, "path": "audit-log-service/src/test/java/com/google/cloud/healthcare/fdamystudies/auditlog/common/BaseMockIT.java", "diffHunk": "@@ -0,0 +1,99 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.auditlog.common;\n+\n+import static org.hamcrest.CoreMatchers.containsString;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.post;\n+import static org.springframework.test.web.servlet.result.MockMvcResultHandlers.print;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.content;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;\n+import org.apache.commons.lang3.StringUtils;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.beans.factory.annotation.Value;\n+import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;\n+import org.springframework.boot.test.context.SpringBootTest;\n+import org.springframework.boot.test.context.SpringBootTest.WebEnvironment;\n+import org.springframework.http.HttpHeaders;\n+import org.springframework.test.context.ActiveProfiles;\n+import org.springframework.test.context.ContextConfiguration;\n+import org.springframework.test.web.servlet.MockMvc;\n+import org.springframework.test.web.servlet.ResultMatcher;\n+import com.github.tomakehurst.wiremock.WireMockServer;\n+import com.google.cloud.healthcare.fdamystudies.auditlog.config.WireMockInitializer;\n+\n+@ContextConfiguration(initializers = {WireMockInitializer.class})\n+@SpringBootTest(webEnvironment = WebEnvironment.RANDOM_PORT)\n+@AutoConfigureMockMvc\n+@ActiveProfiles(\"mockit\")\n+public class BaseMockIT {\n+\n+  protected static final String VALID_BEARER_TOKEN = \"Bearer 7fd50c2c-d618-493c-89d6-f1887e3e4bb8\";\n+\n+  protected static final String INVALID_BEARER_TOKEN =\n+      \"Bearer cd57710c-1d19-4058-8bfe-a6aac3a39e35\";\n+\n+  protected static final ResultMatcher OK = status().isOk();\n+\n+  protected static final ResultMatcher BAD_REQUEST = status().isBadRequest();\n+\n+  protected static final ResultMatcher UNAUTHORIZED = status().isUnauthorized();\n+\n+  protected static final ResultMatcher CREATED = status().isCreated();\n+\n+  protected static final ResultMatcher NOT_FOUND = status().isNotFound();\n+\n+  @Autowired private WireMockServer wireMockServer;\n+\n+  @Autowired protected MockMvc mockMvc;\n+\n+  @Value(\"${server.servlet.contextPath}\")\n+  protected String contextPath;\n+\n+  protected WireMockServer getWireMockServer() {\n+    return wireMockServer;\n+  }\n+\n+  protected void performPost(\n+      String path,\n+      String requestBody,\n+      HttpHeaders headers,\n+      String expectedTextInResponseBody,\n+      ResultMatcher httpStatusMatcher)\n+      throws Exception {\n+    mockMvc\n+        .perform(post(path).contextPath(contextPath).content(requestBody).headers(headers))\n+        .andDo(print())\n+        .andExpect(httpStatusMatcher)\n+        .andExpect(content().string(containsString(expectedTextInResponseBody)));\n+  }\n+\n+  protected void performGet(\n+      String path,\n+      String requestBody,\n+      HttpHeaders headers,\n+      String expectedTextInResponseBody,\n+      ResultMatcher httpStatusMatcher)\n+      throws Exception {\n+\n+    if (StringUtils.isEmpty(requestBody)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzU5NzYyMA=="}, "originalCommit": {"oid": "754e186be1f1668728fc27ba085d29658f9db7a8"}, "originalPosition": 85}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjcyNjI0ODQxOnYy", "diffSide": "RIGHT", "path": "audit-log-service/src/test/java/com/google/cloud/healthcare/fdamystudies/auditlog/controller/HealthControllerTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wOVQxODowMDozMlrOGhWEqA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQwNzozODo1OFrOGiR_Ug==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzYxNzgzMg==", "bodyText": "We don't need to add this to requests, we know the API produces JSON", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/444#discussion_r437617832", "createdAt": "2020-06-09T18:00:32Z", "author": {"login": "nikklassen"}, "path": "audit-log-service/src/test/java/com/google/cloud/healthcare/fdamystudies/auditlog/controller/HealthControllerTest.java", "diffHunk": "@@ -0,0 +1,27 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.auditlog.controller;\n+\n+import java.util.Collections;\n+import org.junit.jupiter.api.Test;\n+import org.springframework.http.HttpHeaders;\n+import org.springframework.http.MediaType;\n+import com.google.cloud.healthcare.fdamystudies.auditlog.common.ApiEndpoints;\n+import com.google.cloud.healthcare.fdamystudies.auditlog.common.BaseMockIT;\n+\n+public class HealthControllerTest extends BaseMockIT {\n+\n+  @Test\n+  public void health() throws Exception {\n+    HttpHeaders headers = new HttpHeaders();\n+    headers.setAccept(Collections.singletonList(MediaType.APPLICATION_JSON));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "754e186be1f1668728fc27ba085d29658f9db7a8"}, "originalPosition": 23}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODU5OTUwNg==", "bodyText": "Removed the Accept header.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/444#discussion_r438599506", "createdAt": "2020-06-11T07:38:58Z", "author": {"login": "dhanyak-btc"}, "path": "audit-log-service/src/test/java/com/google/cloud/healthcare/fdamystudies/auditlog/controller/HealthControllerTest.java", "diffHunk": "@@ -0,0 +1,27 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.auditlog.controller;\n+\n+import java.util.Collections;\n+import org.junit.jupiter.api.Test;\n+import org.springframework.http.HttpHeaders;\n+import org.springframework.http.MediaType;\n+import com.google.cloud.healthcare.fdamystudies.auditlog.common.ApiEndpoints;\n+import com.google.cloud.healthcare.fdamystudies.auditlog.common.BaseMockIT;\n+\n+public class HealthControllerTest extends BaseMockIT {\n+\n+  @Test\n+  public void health() throws Exception {\n+    HttpHeaders headers = new HttpHeaders();\n+    headers.setAccept(Collections.singletonList(MediaType.APPLICATION_JSON));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzYxNzgzMg=="}, "originalCommit": {"oid": "754e186be1f1668728fc27ba085d29658f9db7a8"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczMzQ3MTI3OnYy", "diffSide": "RIGHT", "path": "audit-log-service/pom.xml", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxMzozNToxOFrOGidXOg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQwOTo0Njo0NlrOGjq-7A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODc4NTg1MA==", "bodyText": "I believe you can add the common modules to here with <modules> so they will automatically get built when you build this service.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/444#discussion_r438785850", "createdAt": "2020-06-11T13:35:18Z", "author": {"login": "nikklassen"}, "path": "audit-log-service/pom.xml", "diffHunk": "@@ -0,0 +1,187 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce220e268b7a878a45159ef63a1cec57d3fab284"}, "originalPosition": 2}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODgzOTkyNw==", "bodyText": "I tried with <modules><module>common-tests<module><module>common-service<module></modules> and changed the package with pom, it didn't work so added it has a dependency. I'll look into this comment and try to fix this in next PR. Is this fine with you?", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/444#discussion_r438839927", "createdAt": "2020-06-11T14:44:59Z", "author": {"login": "dhanyak-btc"}, "path": "audit-log-service/pom.xml", "diffHunk": "@@ -0,0 +1,187 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODc4NTg1MA=="}, "originalCommit": {"oid": "ce220e268b7a878a45159ef63a1cec57d3fab284"}, "originalPosition": 2}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODk3OTkxNw==", "bodyText": "Yes, let's do it as a follow up. I think it's going to be frustrating if the developers can't easily see the changes from the shared package in the other ones without building/installing.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/444#discussion_r438979917", "createdAt": "2020-06-11T18:12:02Z", "author": {"login": "nikklassen"}, "path": "audit-log-service/pom.xml", "diffHunk": "@@ -0,0 +1,187 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODc4NTg1MA=="}, "originalCommit": {"oid": "ce220e268b7a878a45159ef63a1cec57d3fab284"}, "originalPosition": 2}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDA1NzU4MA==", "bodyText": "Created common-modules and audit-log-module with parent pom.xml", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/444#discussion_r440057580", "createdAt": "2020-06-15T09:46:46Z", "author": {"login": "dhanyak-btc"}, "path": "audit-log-service/pom.xml", "diffHunk": "@@ -0,0 +1,187 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<project xmlns=\"http://maven.apache.org/POM/4.0.0\"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODc4NTg1MA=="}, "originalCommit": {"oid": "ce220e268b7a878a45159ef63a1cec57d3fab284"}, "originalPosition": 2}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczMzUwNjE5OnYy", "diffSide": "RIGHT", "path": "common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/common/ErrorResponse.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxMzo0MTowNlrOGidsZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQwNjoyMzo0N1rOGjkmHg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODc5MTI2OA==", "bodyText": "This should also be a StdSerializer.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/444#discussion_r438791268", "createdAt": "2020-06-11T13:41:06Z", "author": {"login": "nikklassen"}, "path": "common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/common/ErrorResponse.java", "diffHunk": "@@ -0,0 +1,48 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.common;\n+\n+import java.time.Instant;\n+import org.springframework.web.client.RestClientResponseException;\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.databind.node.ObjectNode;\n+\n+public class ErrorResponse {\n+\n+  public static final String PATH = \"path\";\n+\n+  public static final String STATUS = \"status\";\n+\n+  public static final String ERROR_DESCRIPTION = \"error_description\";\n+\n+  private String requestUri;\n+\n+  private RestClientResponseException restClientResponseException;\n+\n+  public ErrorResponse(String requestUri, RestClientResponseException restClientResponseException) {\n+    this.requestUri = requestUri;\n+    this.restClientResponseException = restClientResponseException;\n+  }\n+\n+  public JsonNode toJson() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce220e268b7a878a45159ef63a1cec57d3fab284"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODg0OTM4Mg==", "bodyText": "Refactored the code to use StdSerializer", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/444#discussion_r438849382", "createdAt": "2020-06-11T14:58:14Z", "author": {"login": "dhanyak-btc"}, "path": "common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/common/ErrorResponse.java", "diffHunk": "@@ -0,0 +1,48 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.common;\n+\n+import java.time.Instant;\n+import org.springframework.web.client.RestClientResponseException;\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.databind.node.ObjectNode;\n+\n+public class ErrorResponse {\n+\n+  public static final String PATH = \"path\";\n+\n+  public static final String STATUS = \"status\";\n+\n+  public static final String ERROR_DESCRIPTION = \"error_description\";\n+\n+  private String requestUri;\n+\n+  private RestClientResponseException restClientResponseException;\n+\n+  public ErrorResponse(String requestUri, RestClientResponseException restClientResponseException) {\n+    this.requestUri = requestUri;\n+    this.restClientResponseException = restClientResponseException;\n+  }\n+\n+  public JsonNode toJson() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODc5MTI2OA=="}, "originalCommit": {"oid": "ce220e268b7a878a45159ef63a1cec57d3fab284"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODk2OTYxNw==", "bodyText": "You shouldn't need this method anymore then. Jackson should automatically be called to serialize your ErrorResponse when you use ResponseEntity.body(new ErrorResponse()). That's the main advantage of doing this way, and the ability to compose serialization.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/444#discussion_r438969617", "createdAt": "2020-06-11T17:54:46Z", "author": {"login": "nikklassen"}, "path": "common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/common/ErrorResponse.java", "diffHunk": "@@ -0,0 +1,48 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.common;\n+\n+import java.time.Instant;\n+import org.springframework.web.client.RestClientResponseException;\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.databind.node.ObjectNode;\n+\n+public class ErrorResponse {\n+\n+  public static final String PATH = \"path\";\n+\n+  public static final String STATUS = \"status\";\n+\n+  public static final String ERROR_DESCRIPTION = \"error_description\";\n+\n+  private String requestUri;\n+\n+  private RestClientResponseException restClientResponseException;\n+\n+  public ErrorResponse(String requestUri, RestClientResponseException restClientResponseException) {\n+    this.requestUri = requestUri;\n+    this.restClientResponseException = restClientResponseException;\n+  }\n+\n+  public JsonNode toJson() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODc5MTI2OA=="}, "originalCommit": {"oid": "ce220e268b7a878a45159ef63a1cec57d3fab284"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTk1MjkyNg==", "bodyText": "Removed toJson() method from ErrorCode enum and ErrorResponse class. Fixed compilation issues.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/444#discussion_r439952926", "createdAt": "2020-06-15T06:23:47Z", "author": {"login": "dhanyak-btc"}, "path": "common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/common/ErrorResponse.java", "diffHunk": "@@ -0,0 +1,48 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.common;\n+\n+import java.time.Instant;\n+import org.springframework.web.client.RestClientResponseException;\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.databind.node.ObjectNode;\n+\n+public class ErrorResponse {\n+\n+  public static final String PATH = \"path\";\n+\n+  public static final String STATUS = \"status\";\n+\n+  public static final String ERROR_DESCRIPTION = \"error_description\";\n+\n+  private String requestUri;\n+\n+  private RestClientResponseException restClientResponseException;\n+\n+  public ErrorResponse(String requestUri, RestClientResponseException restClientResponseException) {\n+    this.requestUri = requestUri;\n+    this.restClientResponseException = restClientResponseException;\n+  }\n+\n+  public JsonNode toJson() {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODc5MTI2OA=="}, "originalCommit": {"oid": "ce220e268b7a878a45159ef63a1cec57d3fab284"}, "originalPosition": 34}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczMzUxNDY2OnYy", "diffSide": "RIGHT", "path": "common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/common/RestExceptionHandler.java", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxMzo0MjozNFrOGidxxw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxNzo0NzoyMVrOGioMKA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODc5MjY0Nw==", "bodyText": "Shouldn't we always be logging errors?", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/444#discussion_r438792647", "createdAt": "2020-06-11T13:42:34Z", "author": {"login": "nikklassen"}, "path": "common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/common/RestExceptionHandler.java", "diffHunk": "@@ -0,0 +1,37 @@\n+package com.google.cloud.healthcare.fdamystudies.common;\n+\n+import javax.servlet.http.HttpServletRequest;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.web.bind.annotation.ControllerAdvice;\n+import org.springframework.web.bind.annotation.ExceptionHandler;\n+import org.springframework.web.context.request.ServletWebRequest;\n+import org.springframework.web.context.request.WebRequest;\n+import org.springframework.web.servlet.mvc.method.annotation.ResponseEntityExceptionHandler;\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.node.ObjectNode;\n+\n+@ControllerAdvice\n+public class RestExceptionHandler extends ResponseEntityExceptionHandler {\n+\n+  private static final Logger LOG = LoggerFactory.getLogger(RestExceptionHandler.class);\n+\n+  private static final String REQUEST_FAILED_WITH_AN_EXCEPTION =\n+      \"%s request failed with an exception\";\n+\n+  @ExceptionHandler(Exception.class)\n+  public ResponseEntity<JsonNode> handleSystemException(Exception ex, WebRequest request) {\n+    HttpServletRequest httpRequest = ((ServletWebRequest) request).getRequest();\n+\n+    if (LOG.isErrorEnabled()) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce220e268b7a878a45159ef63a1cec57d3fab284"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODgyMzQwMg==", "bodyText": "I personally don't like conditional logging but this is a SonarLint issue.  Please refer Sonarlint rules and the example in Compliant Solution. Please let us know if we need to ignore this SonarLint rule. I'll remove all conditional logging.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/444#discussion_r438823402", "createdAt": "2020-06-11T14:21:36Z", "author": {"login": "dhanyak-btc"}, "path": "common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/common/RestExceptionHandler.java", "diffHunk": "@@ -0,0 +1,37 @@\n+package com.google.cloud.healthcare.fdamystudies.common;\n+\n+import javax.servlet.http.HttpServletRequest;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.web.bind.annotation.ControllerAdvice;\n+import org.springframework.web.bind.annotation.ExceptionHandler;\n+import org.springframework.web.context.request.ServletWebRequest;\n+import org.springframework.web.context.request.WebRequest;\n+import org.springframework.web.servlet.mvc.method.annotation.ResponseEntityExceptionHandler;\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.node.ObjectNode;\n+\n+@ControllerAdvice\n+public class RestExceptionHandler extends ResponseEntityExceptionHandler {\n+\n+  private static final Logger LOG = LoggerFactory.getLogger(RestExceptionHandler.class);\n+\n+  private static final String REQUEST_FAILED_WITH_AN_EXCEPTION =\n+      \"%s request failed with an exception\";\n+\n+  @ExceptionHandler(Exception.class)\n+  public ResponseEntity<JsonNode> handleSystemException(Exception ex, WebRequest request) {\n+    HttpServletRequest httpRequest = ((ServletWebRequest) request).getRequest();\n+\n+    if (LOG.isErrorEnabled()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODc5MjY0Nw=="}, "originalCommit": {"oid": "ce220e268b7a878a45159ef63a1cec57d3fab284"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODk2MzI0MA==", "bodyText": "Thanks for the context on this being a Sonarlint rule, that explains why I saw other PRs with it too. I definitely think it's an over-optimization except maybe in performance critical code. I think we should disable this rule, but follow their advice for using the builtin formatting instead of String.format when possible.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/444#discussion_r438963240", "createdAt": "2020-06-11T17:47:21Z", "author": {"login": "nikklassen"}, "path": "common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/common/RestExceptionHandler.java", "diffHunk": "@@ -0,0 +1,37 @@\n+package com.google.cloud.healthcare.fdamystudies.common;\n+\n+import javax.servlet.http.HttpServletRequest;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.web.bind.annotation.ControllerAdvice;\n+import org.springframework.web.bind.annotation.ExceptionHandler;\n+import org.springframework.web.context.request.ServletWebRequest;\n+import org.springframework.web.context.request.WebRequest;\n+import org.springframework.web.servlet.mvc.method.annotation.ResponseEntityExceptionHandler;\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.node.ObjectNode;\n+\n+@ControllerAdvice\n+public class RestExceptionHandler extends ResponseEntityExceptionHandler {\n+\n+  private static final Logger LOG = LoggerFactory.getLogger(RestExceptionHandler.class);\n+\n+  private static final String REQUEST_FAILED_WITH_AN_EXCEPTION =\n+      \"%s request failed with an exception\";\n+\n+  @ExceptionHandler(Exception.class)\n+  public ResponseEntity<JsonNode> handleSystemException(Exception ex, WebRequest request) {\n+    HttpServletRequest httpRequest = ((ServletWebRequest) request).getRequest();\n+\n+    if (LOG.isErrorEnabled()) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODc5MjY0Nw=="}, "originalCommit": {"oid": "ce220e268b7a878a45159ef63a1cec57d3fab284"}, "originalPosition": 28}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczMzUyNzM4OnYy", "diffSide": "RIGHT", "path": "common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/common/RestExceptionHandler.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxMzo0NDozMFrOGid5bA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxNTowMDoyMFrOGihVRg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODc5NDYwNA==", "bodyText": "What value does this serve? The client knows what request they made.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/444#discussion_r438794604", "createdAt": "2020-06-11T13:44:30Z", "author": {"login": "nikklassen"}, "path": "common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/common/RestExceptionHandler.java", "diffHunk": "@@ -0,0 +1,37 @@\n+package com.google.cloud.healthcare.fdamystudies.common;\n+\n+import javax.servlet.http.HttpServletRequest;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.web.bind.annotation.ControllerAdvice;\n+import org.springframework.web.bind.annotation.ExceptionHandler;\n+import org.springframework.web.context.request.ServletWebRequest;\n+import org.springframework.web.context.request.WebRequest;\n+import org.springframework.web.servlet.mvc.method.annotation.ResponseEntityExceptionHandler;\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.node.ObjectNode;\n+\n+@ControllerAdvice\n+public class RestExceptionHandler extends ResponseEntityExceptionHandler {\n+\n+  private static final Logger LOG = LoggerFactory.getLogger(RestExceptionHandler.class);\n+\n+  private static final String REQUEST_FAILED_WITH_AN_EXCEPTION =\n+      \"%s request failed with an exception\";\n+\n+  @ExceptionHandler(Exception.class)\n+  public ResponseEntity<JsonNode> handleSystemException(Exception ex, WebRequest request) {\n+    HttpServletRequest httpRequest = ((ServletWebRequest) request).getRequest();\n+\n+    if (LOG.isErrorEnabled()) {\n+      LOG.error(String.format(REQUEST_FAILED_WITH_AN_EXCEPTION, httpRequest.getRequestURI()), ex);\n+    }\n+\n+    ObjectNode response = (ObjectNode) ErrorCode.APPLICATION_ERROR.toJson();\n+    response.put(\"path\", httpRequest.getPathInfo());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce220e268b7a878a45159ef63a1cec57d3fab284"}, "originalPosition": 33}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODg1MDg4Ng==", "bodyText": "Removed the \"path\".", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/444#discussion_r438850886", "createdAt": "2020-06-11T15:00:20Z", "author": {"login": "dhanyak-btc"}, "path": "common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/common/RestExceptionHandler.java", "diffHunk": "@@ -0,0 +1,37 @@\n+package com.google.cloud.healthcare.fdamystudies.common;\n+\n+import javax.servlet.http.HttpServletRequest;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.web.bind.annotation.ControllerAdvice;\n+import org.springframework.web.bind.annotation.ExceptionHandler;\n+import org.springframework.web.context.request.ServletWebRequest;\n+import org.springframework.web.context.request.WebRequest;\n+import org.springframework.web.servlet.mvc.method.annotation.ResponseEntityExceptionHandler;\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.node.ObjectNode;\n+\n+@ControllerAdvice\n+public class RestExceptionHandler extends ResponseEntityExceptionHandler {\n+\n+  private static final Logger LOG = LoggerFactory.getLogger(RestExceptionHandler.class);\n+\n+  private static final String REQUEST_FAILED_WITH_AN_EXCEPTION =\n+      \"%s request failed with an exception\";\n+\n+  @ExceptionHandler(Exception.class)\n+  public ResponseEntity<JsonNode> handleSystemException(Exception ex, WebRequest request) {\n+    HttpServletRequest httpRequest = ((ServletWebRequest) request).getRequest();\n+\n+    if (LOG.isErrorEnabled()) {\n+      LOG.error(String.format(REQUEST_FAILED_WITH_AN_EXCEPTION, httpRequest.getRequestURI()), ex);\n+    }\n+\n+    ObjectNode response = (ObjectNode) ErrorCode.APPLICATION_ERROR.toJson();\n+    response.put(\"path\", httpRequest.getPathInfo());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODc5NDYwNA=="}, "originalCommit": {"oid": "ce220e268b7a878a45159ef63a1cec57d3fab284"}, "originalPosition": 33}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczMzU4OTAwOnYy", "diffSide": "RIGHT", "path": "common-tests/src/main/java/com/google/cloud/healthcare/fdamystudies/common/BaseMockIT.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxMzo1NTowMVrOGief2w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQwNjoxMDo1NFrOGjkVRQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODgwNDQ0Mw==", "bodyText": "The whole point of the fluent/builder API is to be flexible. You are essentially undoing that by creating overloads for every possible way of making a request. I am fine with a couple \"abbreviations\", but if there is a one-off method that needs to use cookies they can just write the full request themselves. Also, you don't know what you are going to need yet, so only write helpers for things that exist.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/444#discussion_r438804443", "createdAt": "2020-06-11T13:55:01Z", "author": {"login": "nikklassen"}, "path": "common-tests/src/main/java/com/google/cloud/healthcare/fdamystudies/common/BaseMockIT.java", "diffHunk": "@@ -0,0 +1,315 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.common;\n+\n+import static org.hamcrest.CoreMatchers.containsString;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.delete;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.patch;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.post;\n+import static org.springframework.test.web.servlet.result.MockMvcResultHandlers.print;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.content;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.redirectedUrl;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;\n+import java.util.Base64;\n+import java.util.Collections;\n+import javax.servlet.http.Cookie;\n+import org.apache.commons.lang3.StringUtils;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.beans.factory.annotation.Value;\n+import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;\n+import org.springframework.boot.test.context.SpringBootTest;\n+import org.springframework.boot.test.context.SpringBootTest.WebEnvironment;\n+import org.springframework.boot.web.server.LocalServerPort;\n+import org.springframework.http.HttpHeaders;\n+import org.springframework.http.MediaType;\n+import org.springframework.test.context.ActiveProfiles;\n+import org.springframework.test.context.ContextConfiguration;\n+import org.springframework.test.web.servlet.MockMvc;\n+import org.springframework.test.web.servlet.MvcResult;\n+import org.springframework.test.web.servlet.ResultMatcher;\n+import org.springframework.test.web.servlet.request.MockHttpServletRequestBuilder;\n+import org.springframework.util.MultiValueMap;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.databind.node.ObjectNode;\n+import com.github.tomakehurst.wiremock.WireMockServer;\n+import com.google.cloud.healthcare.fdamystudies.config.WireMockInitializer;\n+\n+@ContextConfiguration(initializers = {WireMockInitializer.class})\n+@SpringBootTest(webEnvironment = WebEnvironment.RANDOM_PORT)\n+@AutoConfigureMockMvc\n+@ActiveProfiles(\"mockit\")\n+public class BaseMockIT {\n+\n+  protected static final String AUTHORIZATION = \"Authorization\";\n+\n+  public static final String CORRELATION_ID = \"correlation_id\";\n+\n+  protected static final String VALID_BEARER_TOKEN = \"Bearer 7fd50c2c-d618-493c-89d6-f1887e3e4bb8\";\n+\n+  protected static final String INVALID_BEARER_TOKEN =\n+      \"Bearer cd57710c-1d19-4058-8bfe-a6aac3a39e35\";\n+\n+  protected static final String VALID_CORRELATION_ID = \"8a56d20c-d755-4487-b80d-22d5fa383046\";\n+\n+  protected static final ResultMatcher OK = status().isOk();\n+\n+  protected static final ResultMatcher BAD_REQUEST = status().isBadRequest();\n+\n+  protected static final ResultMatcher UNAUTHORIZED = status().isUnauthorized();\n+\n+  protected static final ResultMatcher CREATED = status().isCreated();\n+\n+  protected static final ResultMatcher NOT_FOUND = status().isNotFound();\n+\n+  protected static final ResultMatcher UNSUPPORTED_MEDIATYPE = status().isUnsupportedMediaType();\n+\n+  protected static final ResultMatcher REDIRECTION = status().is3xxRedirection();\n+\n+  protected static final ResultMatcher CONFLICT = status().isConflict();\n+\n+  @Autowired private WireMockServer wireMockServer;\n+\n+  @LocalServerPort protected int randomServerPort;\n+\n+  @Autowired private ObjectMapper objectMapper;\n+\n+  @Autowired private MockMvc mockMvc;\n+\n+  @Value(\"${server.servlet.contextPath}\")\n+  private String contextPath;\n+\n+  protected WireMockServer getWireMockServer() {\n+    return wireMockServer;\n+  }\n+\n+  protected ObjectNode getObjectNode() {\n+    return objectMapper.createObjectNode();\n+  }\n+\n+  protected ObjectMapper getObjectMapper() {\n+    return objectMapper;\n+  }\n+\n+  protected String getEncodedAuthorization(String clientId, String clientSecret) {\n+    String credentials = clientId + \":\" + clientSecret;\n+    return Base64.getEncoder().encodeToString(credentials.getBytes());\n+  }\n+\n+  protected HttpHeaders getCommonHeaders() {\n+    HttpHeaders headers = new HttpHeaders();\n+    headers.setAccept(Collections.singletonList(MediaType.APPLICATION_JSON));\n+    headers.setContentType(MediaType.APPLICATION_JSON);\n+    headers.add(AUTHORIZATION, VALID_BEARER_TOKEN);\n+    headers.add(CORRELATION_ID, VALID_CORRELATION_ID);\n+    return headers;\n+  }\n+\n+  protected MvcResult performPost(\n+      String path,\n+      String requestBody,\n+      HttpHeaders headers,\n+      String expectedTextInResponseBody,\n+      ResultMatcher httpStatusMatcher,\n+      Cookie... cookies)\n+      throws Exception {\n+\n+    MockHttpServletRequestBuilder reqBuilder =\n+        post(path).contextPath(contextPath).content(requestBody).headers(headers);\n+\n+    if (cookies.length > 0) {\n+      reqBuilder.cookie(cookies);\n+    }\n+\n+    return mockMvc\n+        .perform(reqBuilder)\n+        .andDo(print())\n+        .andExpect(httpStatusMatcher)\n+        .andExpect(content().string(containsString(expectedTextInResponseBody)))\n+        .andReturn();\n+  }\n+\n+  protected MvcResult performPost(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ce220e268b7a878a45159ef63a1cec57d3fab284"}, "originalPosition": 138}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODgyODEwMw==", "bodyText": "We've used all these methods in different services (for integration tests) so added them here since it's a common BaseMockIT for all services. Please let me know if I need to keep only methods related to this PR.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/444#discussion_r438828103", "createdAt": "2020-06-11T14:28:08Z", "author": {"login": "dhanyak-btc"}, "path": "common-tests/src/main/java/com/google/cloud/healthcare/fdamystudies/common/BaseMockIT.java", "diffHunk": "@@ -0,0 +1,315 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.common;\n+\n+import static org.hamcrest.CoreMatchers.containsString;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.delete;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.patch;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.post;\n+import static org.springframework.test.web.servlet.result.MockMvcResultHandlers.print;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.content;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.redirectedUrl;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;\n+import java.util.Base64;\n+import java.util.Collections;\n+import javax.servlet.http.Cookie;\n+import org.apache.commons.lang3.StringUtils;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.beans.factory.annotation.Value;\n+import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;\n+import org.springframework.boot.test.context.SpringBootTest;\n+import org.springframework.boot.test.context.SpringBootTest.WebEnvironment;\n+import org.springframework.boot.web.server.LocalServerPort;\n+import org.springframework.http.HttpHeaders;\n+import org.springframework.http.MediaType;\n+import org.springframework.test.context.ActiveProfiles;\n+import org.springframework.test.context.ContextConfiguration;\n+import org.springframework.test.web.servlet.MockMvc;\n+import org.springframework.test.web.servlet.MvcResult;\n+import org.springframework.test.web.servlet.ResultMatcher;\n+import org.springframework.test.web.servlet.request.MockHttpServletRequestBuilder;\n+import org.springframework.util.MultiValueMap;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.databind.node.ObjectNode;\n+import com.github.tomakehurst.wiremock.WireMockServer;\n+import com.google.cloud.healthcare.fdamystudies.config.WireMockInitializer;\n+\n+@ContextConfiguration(initializers = {WireMockInitializer.class})\n+@SpringBootTest(webEnvironment = WebEnvironment.RANDOM_PORT)\n+@AutoConfigureMockMvc\n+@ActiveProfiles(\"mockit\")\n+public class BaseMockIT {\n+\n+  protected static final String AUTHORIZATION = \"Authorization\";\n+\n+  public static final String CORRELATION_ID = \"correlation_id\";\n+\n+  protected static final String VALID_BEARER_TOKEN = \"Bearer 7fd50c2c-d618-493c-89d6-f1887e3e4bb8\";\n+\n+  protected static final String INVALID_BEARER_TOKEN =\n+      \"Bearer cd57710c-1d19-4058-8bfe-a6aac3a39e35\";\n+\n+  protected static final String VALID_CORRELATION_ID = \"8a56d20c-d755-4487-b80d-22d5fa383046\";\n+\n+  protected static final ResultMatcher OK = status().isOk();\n+\n+  protected static final ResultMatcher BAD_REQUEST = status().isBadRequest();\n+\n+  protected static final ResultMatcher UNAUTHORIZED = status().isUnauthorized();\n+\n+  protected static final ResultMatcher CREATED = status().isCreated();\n+\n+  protected static final ResultMatcher NOT_FOUND = status().isNotFound();\n+\n+  protected static final ResultMatcher UNSUPPORTED_MEDIATYPE = status().isUnsupportedMediaType();\n+\n+  protected static final ResultMatcher REDIRECTION = status().is3xxRedirection();\n+\n+  protected static final ResultMatcher CONFLICT = status().isConflict();\n+\n+  @Autowired private WireMockServer wireMockServer;\n+\n+  @LocalServerPort protected int randomServerPort;\n+\n+  @Autowired private ObjectMapper objectMapper;\n+\n+  @Autowired private MockMvc mockMvc;\n+\n+  @Value(\"${server.servlet.contextPath}\")\n+  private String contextPath;\n+\n+  protected WireMockServer getWireMockServer() {\n+    return wireMockServer;\n+  }\n+\n+  protected ObjectNode getObjectNode() {\n+    return objectMapper.createObjectNode();\n+  }\n+\n+  protected ObjectMapper getObjectMapper() {\n+    return objectMapper;\n+  }\n+\n+  protected String getEncodedAuthorization(String clientId, String clientSecret) {\n+    String credentials = clientId + \":\" + clientSecret;\n+    return Base64.getEncoder().encodeToString(credentials.getBytes());\n+  }\n+\n+  protected HttpHeaders getCommonHeaders() {\n+    HttpHeaders headers = new HttpHeaders();\n+    headers.setAccept(Collections.singletonList(MediaType.APPLICATION_JSON));\n+    headers.setContentType(MediaType.APPLICATION_JSON);\n+    headers.add(AUTHORIZATION, VALID_BEARER_TOKEN);\n+    headers.add(CORRELATION_ID, VALID_CORRELATION_ID);\n+    return headers;\n+  }\n+\n+  protected MvcResult performPost(\n+      String path,\n+      String requestBody,\n+      HttpHeaders headers,\n+      String expectedTextInResponseBody,\n+      ResultMatcher httpStatusMatcher,\n+      Cookie... cookies)\n+      throws Exception {\n+\n+    MockHttpServletRequestBuilder reqBuilder =\n+        post(path).contextPath(contextPath).content(requestBody).headers(headers);\n+\n+    if (cookies.length > 0) {\n+      reqBuilder.cookie(cookies);\n+    }\n+\n+    return mockMvc\n+        .perform(reqBuilder)\n+        .andDo(print())\n+        .andExpect(httpStatusMatcher)\n+        .andExpect(content().string(containsString(expectedTextInResponseBody)))\n+        .andReturn();\n+  }\n+\n+  protected MvcResult performPost(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODgwNDQ0Mw=="}, "originalCommit": {"oid": "ce220e268b7a878a45159ef63a1cec57d3fab284"}, "originalPosition": 138}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODk3MTg4MA==", "bodyText": "Yes, please only keep the ones relevant for this PR. If the other integration tests are all making requests in slightly different ways then that's a code smell we should look into refactoring.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/444#discussion_r438971880", "createdAt": "2020-06-11T17:57:26Z", "author": {"login": "nikklassen"}, "path": "common-tests/src/main/java/com/google/cloud/healthcare/fdamystudies/common/BaseMockIT.java", "diffHunk": "@@ -0,0 +1,315 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.common;\n+\n+import static org.hamcrest.CoreMatchers.containsString;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.delete;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.patch;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.post;\n+import static org.springframework.test.web.servlet.result.MockMvcResultHandlers.print;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.content;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.redirectedUrl;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;\n+import java.util.Base64;\n+import java.util.Collections;\n+import javax.servlet.http.Cookie;\n+import org.apache.commons.lang3.StringUtils;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.beans.factory.annotation.Value;\n+import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;\n+import org.springframework.boot.test.context.SpringBootTest;\n+import org.springframework.boot.test.context.SpringBootTest.WebEnvironment;\n+import org.springframework.boot.web.server.LocalServerPort;\n+import org.springframework.http.HttpHeaders;\n+import org.springframework.http.MediaType;\n+import org.springframework.test.context.ActiveProfiles;\n+import org.springframework.test.context.ContextConfiguration;\n+import org.springframework.test.web.servlet.MockMvc;\n+import org.springframework.test.web.servlet.MvcResult;\n+import org.springframework.test.web.servlet.ResultMatcher;\n+import org.springframework.test.web.servlet.request.MockHttpServletRequestBuilder;\n+import org.springframework.util.MultiValueMap;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.databind.node.ObjectNode;\n+import com.github.tomakehurst.wiremock.WireMockServer;\n+import com.google.cloud.healthcare.fdamystudies.config.WireMockInitializer;\n+\n+@ContextConfiguration(initializers = {WireMockInitializer.class})\n+@SpringBootTest(webEnvironment = WebEnvironment.RANDOM_PORT)\n+@AutoConfigureMockMvc\n+@ActiveProfiles(\"mockit\")\n+public class BaseMockIT {\n+\n+  protected static final String AUTHORIZATION = \"Authorization\";\n+\n+  public static final String CORRELATION_ID = \"correlation_id\";\n+\n+  protected static final String VALID_BEARER_TOKEN = \"Bearer 7fd50c2c-d618-493c-89d6-f1887e3e4bb8\";\n+\n+  protected static final String INVALID_BEARER_TOKEN =\n+      \"Bearer cd57710c-1d19-4058-8bfe-a6aac3a39e35\";\n+\n+  protected static final String VALID_CORRELATION_ID = \"8a56d20c-d755-4487-b80d-22d5fa383046\";\n+\n+  protected static final ResultMatcher OK = status().isOk();\n+\n+  protected static final ResultMatcher BAD_REQUEST = status().isBadRequest();\n+\n+  protected static final ResultMatcher UNAUTHORIZED = status().isUnauthorized();\n+\n+  protected static final ResultMatcher CREATED = status().isCreated();\n+\n+  protected static final ResultMatcher NOT_FOUND = status().isNotFound();\n+\n+  protected static final ResultMatcher UNSUPPORTED_MEDIATYPE = status().isUnsupportedMediaType();\n+\n+  protected static final ResultMatcher REDIRECTION = status().is3xxRedirection();\n+\n+  protected static final ResultMatcher CONFLICT = status().isConflict();\n+\n+  @Autowired private WireMockServer wireMockServer;\n+\n+  @LocalServerPort protected int randomServerPort;\n+\n+  @Autowired private ObjectMapper objectMapper;\n+\n+  @Autowired private MockMvc mockMvc;\n+\n+  @Value(\"${server.servlet.contextPath}\")\n+  private String contextPath;\n+\n+  protected WireMockServer getWireMockServer() {\n+    return wireMockServer;\n+  }\n+\n+  protected ObjectNode getObjectNode() {\n+    return objectMapper.createObjectNode();\n+  }\n+\n+  protected ObjectMapper getObjectMapper() {\n+    return objectMapper;\n+  }\n+\n+  protected String getEncodedAuthorization(String clientId, String clientSecret) {\n+    String credentials = clientId + \":\" + clientSecret;\n+    return Base64.getEncoder().encodeToString(credentials.getBytes());\n+  }\n+\n+  protected HttpHeaders getCommonHeaders() {\n+    HttpHeaders headers = new HttpHeaders();\n+    headers.setAccept(Collections.singletonList(MediaType.APPLICATION_JSON));\n+    headers.setContentType(MediaType.APPLICATION_JSON);\n+    headers.add(AUTHORIZATION, VALID_BEARER_TOKEN);\n+    headers.add(CORRELATION_ID, VALID_CORRELATION_ID);\n+    return headers;\n+  }\n+\n+  protected MvcResult performPost(\n+      String path,\n+      String requestBody,\n+      HttpHeaders headers,\n+      String expectedTextInResponseBody,\n+      ResultMatcher httpStatusMatcher,\n+      Cookie... cookies)\n+      throws Exception {\n+\n+    MockHttpServletRequestBuilder reqBuilder =\n+        post(path).contextPath(contextPath).content(requestBody).headers(headers);\n+\n+    if (cookies.length > 0) {\n+      reqBuilder.cookie(cookies);\n+    }\n+\n+    return mockMvc\n+        .perform(reqBuilder)\n+        .andDo(print())\n+        .andExpect(httpStatusMatcher)\n+        .andExpect(content().string(containsString(expectedTextInResponseBody)))\n+        .andReturn();\n+  }\n+\n+  protected MvcResult performPost(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODgwNDQ0Mw=="}, "originalCommit": {"oid": "ce220e268b7a878a45159ef63a1cec57d3fab284"}, "originalPosition": 138}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTk0ODYxMw==", "bodyText": "Removed unused perform* methods from BaseMockIT class.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/444#discussion_r439948613", "createdAt": "2020-06-15T06:10:54Z", "author": {"login": "dhanyak-btc"}, "path": "common-tests/src/main/java/com/google/cloud/healthcare/fdamystudies/common/BaseMockIT.java", "diffHunk": "@@ -0,0 +1,315 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.common;\n+\n+import static org.hamcrest.CoreMatchers.containsString;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.delete;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.patch;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.post;\n+import static org.springframework.test.web.servlet.result.MockMvcResultHandlers.print;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.content;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.redirectedUrl;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;\n+import java.util.Base64;\n+import java.util.Collections;\n+import javax.servlet.http.Cookie;\n+import org.apache.commons.lang3.StringUtils;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.beans.factory.annotation.Value;\n+import org.springframework.boot.test.autoconfigure.web.servlet.AutoConfigureMockMvc;\n+import org.springframework.boot.test.context.SpringBootTest;\n+import org.springframework.boot.test.context.SpringBootTest.WebEnvironment;\n+import org.springframework.boot.web.server.LocalServerPort;\n+import org.springframework.http.HttpHeaders;\n+import org.springframework.http.MediaType;\n+import org.springframework.test.context.ActiveProfiles;\n+import org.springframework.test.context.ContextConfiguration;\n+import org.springframework.test.web.servlet.MockMvc;\n+import org.springframework.test.web.servlet.MvcResult;\n+import org.springframework.test.web.servlet.ResultMatcher;\n+import org.springframework.test.web.servlet.request.MockHttpServletRequestBuilder;\n+import org.springframework.util.MultiValueMap;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.databind.node.ObjectNode;\n+import com.github.tomakehurst.wiremock.WireMockServer;\n+import com.google.cloud.healthcare.fdamystudies.config.WireMockInitializer;\n+\n+@ContextConfiguration(initializers = {WireMockInitializer.class})\n+@SpringBootTest(webEnvironment = WebEnvironment.RANDOM_PORT)\n+@AutoConfigureMockMvc\n+@ActiveProfiles(\"mockit\")\n+public class BaseMockIT {\n+\n+  protected static final String AUTHORIZATION = \"Authorization\";\n+\n+  public static final String CORRELATION_ID = \"correlation_id\";\n+\n+  protected static final String VALID_BEARER_TOKEN = \"Bearer 7fd50c2c-d618-493c-89d6-f1887e3e4bb8\";\n+\n+  protected static final String INVALID_BEARER_TOKEN =\n+      \"Bearer cd57710c-1d19-4058-8bfe-a6aac3a39e35\";\n+\n+  protected static final String VALID_CORRELATION_ID = \"8a56d20c-d755-4487-b80d-22d5fa383046\";\n+\n+  protected static final ResultMatcher OK = status().isOk();\n+\n+  protected static final ResultMatcher BAD_REQUEST = status().isBadRequest();\n+\n+  protected static final ResultMatcher UNAUTHORIZED = status().isUnauthorized();\n+\n+  protected static final ResultMatcher CREATED = status().isCreated();\n+\n+  protected static final ResultMatcher NOT_FOUND = status().isNotFound();\n+\n+  protected static final ResultMatcher UNSUPPORTED_MEDIATYPE = status().isUnsupportedMediaType();\n+\n+  protected static final ResultMatcher REDIRECTION = status().is3xxRedirection();\n+\n+  protected static final ResultMatcher CONFLICT = status().isConflict();\n+\n+  @Autowired private WireMockServer wireMockServer;\n+\n+  @LocalServerPort protected int randomServerPort;\n+\n+  @Autowired private ObjectMapper objectMapper;\n+\n+  @Autowired private MockMvc mockMvc;\n+\n+  @Value(\"${server.servlet.contextPath}\")\n+  private String contextPath;\n+\n+  protected WireMockServer getWireMockServer() {\n+    return wireMockServer;\n+  }\n+\n+  protected ObjectNode getObjectNode() {\n+    return objectMapper.createObjectNode();\n+  }\n+\n+  protected ObjectMapper getObjectMapper() {\n+    return objectMapper;\n+  }\n+\n+  protected String getEncodedAuthorization(String clientId, String clientSecret) {\n+    String credentials = clientId + \":\" + clientSecret;\n+    return Base64.getEncoder().encodeToString(credentials.getBytes());\n+  }\n+\n+  protected HttpHeaders getCommonHeaders() {\n+    HttpHeaders headers = new HttpHeaders();\n+    headers.setAccept(Collections.singletonList(MediaType.APPLICATION_JSON));\n+    headers.setContentType(MediaType.APPLICATION_JSON);\n+    headers.add(AUTHORIZATION, VALID_BEARER_TOKEN);\n+    headers.add(CORRELATION_ID, VALID_CORRELATION_ID);\n+    return headers;\n+  }\n+\n+  protected MvcResult performPost(\n+      String path,\n+      String requestBody,\n+      HttpHeaders headers,\n+      String expectedTextInResponseBody,\n+      ResultMatcher httpStatusMatcher,\n+      Cookie... cookies)\n+      throws Exception {\n+\n+    MockHttpServletRequestBuilder reqBuilder =\n+        post(path).contextPath(contextPath).content(requestBody).headers(headers);\n+\n+    if (cookies.length > 0) {\n+      reqBuilder.cookie(cookies);\n+    }\n+\n+    return mockMvc\n+        .perform(reqBuilder)\n+        .andDo(print())\n+        .andExpect(httpStatusMatcher)\n+        .andExpect(content().string(containsString(expectedTextInResponseBody)))\n+        .andReturn();\n+  }\n+\n+  protected MvcResult performPost(", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODgwNDQ0Mw=="}, "originalCommit": {"oid": "ce220e268b7a878a45159ef63a1cec57d3fab284"}, "originalPosition": 138}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2366, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}