{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTAyMDc0NDAw", "number": 1332, "title": "Participant Manager : Fixed issue #1322, for GET /apps endpoint", "bodyText": "Fixed issue #1322, get Apps for Super Admin User.", "createdAt": "2020-10-13T07:53:48Z", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1332", "merged": true, "mergeCommit": {"oid": "32399f3b475e3fa20cbccae3c1f8764c2f4178ae"}, "closed": true, "closedAt": "2020-10-15T14:31:57Z", "author": {"login": "monica-BTC"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdSDwUjAH2gAyNTAyMDc0NDAwOmJlMzhjZjFlZDQ3YzhmYmU3YjMxYTJhZWVkZTU2MjY1NTc2YWEzYzY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdSyjaGAH2gAyNTAyMDc0NDAwOjhlN2UyMGQ0NGFmYzZjNTM4MjE0ODM5Yzg5YmI2YjY4MjI1ODBlOTg=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "be38cf1ed47c8fbe7b31a2aeede56265576aa3c6", "author": {"user": {"login": "monica-BTC", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/be38cf1ed47c8fbe7b31a2aeede56265576aa3c6", "committedDate": "2020-10-13T07:50:22Z", "message": "Fixed issue #1322\n\nFixed issue #1322"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA4NDI3Mzk0", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1332#pullrequestreview-508427394", "createdAt": "2020-10-14T14:46:30Z", "commit": {"oid": "be38cf1ed47c8fbe7b31a2aeede56265576aa3c6"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNDo0NjozMFrOHhWzaQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0xNFQxNDo0NzozM1rOHhW2ig==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDczODY2NQ==", "bodyText": "Could you briefly explain this query and why this is needed to be created specifically for superadmin cases? Could we get the invited count for superadmin and other users in the same query?", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1332#discussion_r504738665", "createdAt": "2020-10-14T14:46:30Z", "author": {"login": "saminguyen"}, "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/repository/AppRepository.java", "diffHunk": "@@ -24,4 +26,31 @@\n \n   @Query(\"SELECT app from AppEntity app where app.appId=:appId\")\n   public Optional<AppEntity> findByAppId(String appId);\n+\n+  @Query(\n+      value =\n+          \"SELECT appId, SUM(target_invited_count) AS count \"\n+              + \"FROM ( \"\n+              + \"SELECT app.id AS appId, SUM(site.target_enrollment) AS target_invited_count \"\n+              + \"FROM app_info app, study_info AS si, sites site \"\n+              + \"WHERE app.id=si.app_info_id AND si.id=site.study_id AND si.type='OPEN' \"\n+              + \"GROUP BY app.id \"\n+              + \"UNION ALL \"\n+              + \"SELECT app.id AS appId, SUM(invitation_count) AS target_invited_count \"\n+              + \"FROM app_info app, study_info AS si, participant_registry_site prs \"\n+              + \"WHERE app.id=si.app_info_id AND si.id=prs.study_info_id \"\n+              + \"GROUP BY app.id \"\n+              + \") rstAlias \"\n+              + \"GROUP BY appId \",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "be38cf1ed47c8fbe7b31a2aeede56265576aa3c6"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDczOTQ2Ng==", "bodyText": "Check for other values in app details as well? Like the invited, enrollment counts and enrollmentPercentage", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1332#discussion_r504739466", "createdAt": "2020-10-14T14:47:33Z", "author": {"login": "saminguyen"}, "path": "participant-manager-datastore/participant-manager-service/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/AppControllerTest.java", "diffHunk": "@@ -79,8 +79,29 @@ public void contextLoads() {\n     assertNotNull(appService);\n   }\n \n+  @Test\n+  public void shouldReturnAppsRegisteredByUserForSuperAdmin() throws Exception {\n+    HttpHeaders headers = testDataHelper.newCommonHeaders();\n+    headers.add(USER_ID_HEADER, userRegAdminEntity.getId());\n+\n+    mockMvc\n+        .perform(get(ApiEndpoint.GET_APPS.getPath()).headers(headers).contextPath(getContextPath()))\n+        .andDo(print())\n+        .andExpect(status().isOk())\n+        .andExpect(jsonPath(\"$.apps\").isArray())\n+        .andExpect(jsonPath(\"$.apps\", hasSize(1)))\n+        .andExpect(jsonPath(\"$.apps[0].customId\").value(appEntity.getAppId()))\n+        .andExpect(jsonPath(\"$.apps[0].name\").value(appEntity.getAppName()))\n+        .andExpect(jsonPath(\"$.superAdmin\").value(true));\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "be38cf1ed47c8fbe7b31a2aeede56265576aa3c6"}, "originalPosition": 18}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9e84a1aae67c42aab0d80e3d3319f6c2104e224e", "author": {"user": {"login": "monica-BTC", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/9e84a1aae67c42aab0d80e3d3319f6c2104e224e", "committedDate": "2020-10-14T16:16:30Z", "message": "Merge branch 'develop' into participant-manager-getApps-for-superAdmin-user"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "458267111591cea9f3738b1c8f4dc995328c0879", "author": {"user": {"login": "monica-BTC", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/458267111591cea9f3738b1c8f4dc995328c0879", "committedDate": "2020-10-14T16:42:33Z", "message": "fixed review comment\n\nfixed review comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6dc08884ee9b510a0c195003c5a493fb56a96296", "author": {"user": {"login": "monica-BTC", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/6dc08884ee9b510a0c195003c5a493fb56a96296", "committedDate": "2020-10-14T16:43:13Z", "message": "Merge branch 'participant-manager-getApps-for-superAdmin-user' of https://github.com/GoogleCloudPlatform/fda-mystudies into participant-manager-getApps-for-superAdmin-user"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cfcd7cb9930d243a483ce30972dc9afd4a42d3a5", "author": {"user": {"login": "monica-BTC", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/cfcd7cb9930d243a483ce30972dc9afd4a42d3a5", "committedDate": "2020-10-15T13:33:24Z", "message": "Merge branch 'develop' into participant-manager-getApps-for-superAdmin-user"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTA5NDMzNTY1", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1332#pullrequestreview-509433565", "createdAt": "2020-10-15T14:20:46Z", "commit": {"oid": "cfcd7cb9930d243a483ce30972dc9afd4a42d3a5"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8e7e20d44afc6c538214839c89bb6b6822580e98", "author": {"user": {"login": "monica-BTC", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/8e7e20d44afc6c538214839c89bb6b6822580e98", "committedDate": "2020-10-15T14:21:48Z", "message": "Merge branch 'develop' into participant-manager-getApps-for-superAdmin-user"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 213, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}