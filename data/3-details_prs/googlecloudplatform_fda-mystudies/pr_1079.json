{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDk0OTc0Nzky", "number": 1079, "title": "User Management Service: /deactivate api endpoint with integration test cases", "bodyText": "Return USER_NOT_FOUND if userId is invalid.\nChange status to DEACTIVATE_PENDING.\nCall DELETE ${SCIM_AUTH_URL}/users/{userId} API to delete user account from OAuth Scim server.\nChange the status DEACTIVATED.\nAdded DeactivateAccountScheduledTask scheduler to repeat Step 3 and 4 for Users with status DEACTIVATE_PENDING.", "createdAt": "2020-09-29T16:59:41Z", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1079", "merged": true, "mergeCommit": {"oid": "31e4db1aaedc2ef7eb499d6883cdd7487666b1bb"}, "closed": true, "closedAt": "2020-10-01T17:07:51Z", "author": {"login": "madhurya-btc"}, "timelineItems": {"totalCount": 23, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdNjDtngH2gAyNDk0OTc0NzkyOjcyZmUwNzVkYzY5ZjMxODc1YjI2YTdjNTdiNDNiODA5YTA2MzQ4NDM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdOUh0egFqTUwMDU1MjAyNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "72fe075dc69f31875b26a7c57b43b809a0634843", "author": {"user": {"login": "madhurya-btc", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/72fe075dc69f31875b26a7c57b43b809a0634843", "committedDate": "2020-09-29T07:28:59Z", "message": "deactivate url implementation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eb7bf00fe8ce7af29e2e7f55bd3b4b4a9883104e", "author": {"user": {"login": "madhurya-btc", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/eb7bf00fe8ce7af29e2e7f55bd3b4b4a9883104e", "committedDate": "2020-09-29T11:49:01Z", "message": "integration test cases"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d5c73fcac274e0dc5796a73781b7706cd4538005", "author": {"user": {"login": "madhurya-btc", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/d5c73fcac274e0dc5796a73781b7706cd4538005", "committedDate": "2020-09-29T13:44:25Z", "message": "deactivate api endpoint"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e66ff63c1c8c30cdc5b2120549f1c97528dfb84c", "author": {"user": {"login": "madhurya-btc", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/e66ff63c1c8c30cdc5b2120549f1c97528dfb84c", "committedDate": "2020-09-29T16:01:54Z", "message": "/deactivate api endpoint"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "526a4ae188770ce36561672cec38e82605bac368", "author": {"user": {"login": "madhurya-btc", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/526a4ae188770ce36561672cec38e82605bac368", "committedDate": "2020-09-29T16:53:07Z", "message": "deactivate api endpoint"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "69ea36d82468c1e0f8cc85ad4c537540d4e7e15a", "author": {"user": {"login": "madhurya-btc", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/69ea36d82468c1e0f8cc85ad4c537540d4e7e15a", "committedDate": "2020-09-29T17:07:19Z", "message": "Merge branch 'develop' into user-management-deactive-api-endpoint"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "862c3a38b90be98487a2d9f3441497c7fc565fd0", "author": {"user": {"login": "madhurya-btc", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/862c3a38b90be98487a2d9f3441497c7fc565fd0", "committedDate": "2020-09-29T17:45:00Z", "message": "build issue"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4NzU5MzE0", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1079#pullrequestreview-498759314", "createdAt": "2020-09-29T18:19:55Z", "commit": {"oid": "862c3a38b90be98487a2d9f3441497c7fc565fd0"}, "state": "DISMISSED", "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxODoxOTo1NVrOHZ7K8A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOVQxODo0NzoxOVrOHZ8Ifg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njk0NTkwNA==", "bodyText": "nit: deactivateAcct", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1079#discussion_r496945904", "createdAt": "2020-09-29T18:19:55Z", "author": {"login": "zohrehj"}, "path": "user-registration-server-ws/user-mgmt-module/user-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/dao/UserProfileManagementDao.java", "diffHunk": "@@ -36,5 +36,7 @@ public ErrorBean updateUserProfile(\n \n   public UserDetailsEntity getParticipantDetails(String id);\n \n-  public boolean deActivateAcct(String userId, List<String> deleteData, String userDetailsId);\n+  public void deActivateAcct(String userId, List<String> deleteData, String userDetailsId);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "862c3a38b90be98487a2d9f3441497c7fc565fd0"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njk1MzIyNg==", "bodyText": "why set the userId to null? userId which is the primary key should not be nullable anyway, so I am not sure what the reasoning is here.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1079#discussion_r496953226", "createdAt": "2020-09-29T18:32:18Z", "author": {"login": "zohrehj"}, "path": "user-registration-server-ws/user-mgmt-module/user-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/dao/UserProfileManagementDaoImpl.java", "diffHunk": "@@ -342,4 +329,13 @@ public AppEntity getAppPropertiesDetailsByAppId(String appId) {\n     }\n     return appPropertiesDetails;\n   }\n+\n+  @Override\n+  public void deactivateUserAccount(String userId) {\n+    Optional<UserDetailsEntity> optUserDetails = userDetailsRepository.findByUserId(userId);\n+    UserDetailsEntity userDetailsEntity = optUserDetails.get();\n+    userDetailsEntity.setStatus(UserStatus.DEACTIVATED.getValue());\n+    userDetailsEntity.setUserId(null);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "862c3a38b90be98487a2d9f3441497c7fc565fd0"}, "originalPosition": 118}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njk1NTE5MQ==", "bodyText": "looks like you can move userProfileManagementDao.deactivateUserAccount(userDetails.getUserId());  outside the try catch.\nplease add comment as to why you are ignoring exception in the auth server call.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1079#discussion_r496955191", "createdAt": "2020-09-29T18:36:01Z", "author": {"login": "zohrehj"}, "path": "user-registration-server-ws/user-mgmt-module/user-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/service/UserManagementProfileServiceImpl.java", "diffHunk": "@@ -223,89 +224,114 @@ public UserDetailsEntity saveParticipant(UserDetailsEntity participant) {\n     return userDetails;\n   }\n \n+  @Override\n+  public void processDeactivatePendingRequests() {\n+    // findUsers With Status DEACTIVATE_PENDING\n+    List<UserDetailsEntity> listOfUserDetails =\n+        (List<UserDetailsEntity>)\n+            CollectionUtils.emptyIfNull(\n+                userDetailsRepository.findByStatus(UserStatus.DEACTIVATE_PENDING.getValue()));\n+\n+    // call deactivateUserAccount() for each userID's\n+    listOfUserDetails.forEach(\n+        userDetails -> {\n+          try {\n+            userManagementUtil.deleteUserInfoInAuthServer(userDetails.getUserId());\n+            userProfileManagementDao.deactivateUserAccount(userDetails.getUserId());\n+          } catch (ErrorCodeException e) {\n+            if (e.getErrorCode() == ErrorCode.USER_NOT_FOUND) {\n+              userProfileManagementDao.deactivateUserAccount(userDetails.getUserId());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "862c3a38b90be98487a2d9f3441497c7fc565fd0"}, "originalPosition": 74}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njk2MTY2Mg==", "bodyText": "might be a good idea to move these values into application.properties", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1079#discussion_r496961662", "createdAt": "2020-09-29T18:47:19Z", "author": {"login": "zohrehj"}, "path": "user-registration-server-ws/user-mgmt-module/user-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/task/DeactivateAccountScheduledTask.java", "diffHunk": "@@ -0,0 +1,31 @@\n+package com.google.cloud.healthcare.fdamystudies.task;\n+\n+import com.google.cloud.healthcare.fdamystudies.service.UserManagementProfileService;\n+import org.slf4j.ext.XLogger;\n+import org.slf4j.ext.XLoggerFactory;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.scheduling.annotation.Scheduled;\n+import org.springframework.stereotype.Component;\n+\n+@Component\n+public class DeactivateAccountScheduledTask {\n+\n+  private static final int INITIAL_DELAY_MILLI_SEC = 10000;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "862c3a38b90be98487a2d9f3441497c7fc565fd0"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c715d4266d0de7b04e9bda52333fd9fd366f4447", "author": {"user": {"login": "madhurya-btc", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/c715d4266d0de7b04e9bda52333fd9fd366f4447", "committedDate": "2020-09-30T17:36:50Z", "message": "Fixed review comments"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6daa5b37efb6cf640873c7b0742193e5f3848b9f", "author": {"user": {"login": "madhurya-btc", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/6daa5b37efb6cf640873c7b0742193e5f3848b9f", "committedDate": "2020-09-30T17:37:39Z", "message": "Merge branch 'develop' into user-management-deactive-api-endpoint"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "aad9a2d597d312eeb06e7e9c753e900bcd109892", "author": {"user": {"login": "madhurya-btc", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/aad9a2d597d312eeb06e7e9c753e900bcd109892", "committedDate": "2020-09-30T17:38:37Z", "message": "Merge branch 'user-management-deactive-api-endpoint' of https://github.com/GoogleCloudPlatform/fda-mystudies into user-management-deactive-api-endpoint"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5NzI5OTU0", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1079#pullrequestreview-499729954", "createdAt": "2020-09-30T19:06:04Z", "commit": {"oid": "862c3a38b90be98487a2d9f3441497c7fc565fd0"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxOTowNjowNFrOHardsA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0zMFQxOToyMjowNVrOHar-zg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzczNzEzNg==", "bodyText": "other errors are still getting ignored here, and there is a chance that a user will get stuck in this step forever and we never get notified.\nPlease add a log statement (warning) that includes the the exception message, but also mentions that this will be retried.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1079#discussion_r497737136", "createdAt": "2020-09-30T19:06:04Z", "author": {"login": "zohrehj"}, "path": "user-registration-server-ws/user-mgmt-module/user-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/service/UserManagementProfileServiceImpl.java", "diffHunk": "@@ -223,89 +224,114 @@ public UserDetailsEntity saveParticipant(UserDetailsEntity participant) {\n     return userDetails;\n   }\n \n+  @Override\n+  public void processDeactivatePendingRequests() {\n+    // findUsers With Status DEACTIVATE_PENDING\n+    List<UserDetailsEntity> listOfUserDetails =\n+        (List<UserDetailsEntity>)\n+            CollectionUtils.emptyIfNull(\n+                userDetailsRepository.findByStatus(UserStatus.DEACTIVATE_PENDING.getValue()));\n+\n+    // call deactivateUserAccount() for each userID's\n+    listOfUserDetails.forEach(\n+        userDetails -> {\n+          try {\n+            userManagementUtil.deleteUserInfoInAuthServer(userDetails.getUserId());\n+            userProfileManagementDao.deactivateUserAccount(userDetails.getUserId());\n+          } catch (ErrorCodeException e) {\n+            if (e.getErrorCode() == ErrorCode.USER_NOT_FOUND) {\n+              userProfileManagementDao.deactivateUserAccount(userDetails.getUserId());", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njk1NTE5MQ=="}, "originalCommit": {"oid": "862c3a38b90be98487a2d9f3441497c7fc565fd0"}, "originalPosition": 74}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzczOTEwOA==", "bodyText": "This is generally not a good practice.\nby turning the user_id to null, we are losing valuable information, e.g. if we later on decide to find user associated with an audit log we will not be able to because the user_id captured in the log no longer exists.\nIt also introduces potential future bug, since another user can now have this user_id, and if we have any assets that are still pointing to this user_id, we could accidentally expose the first user's information to the second one.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1079#discussion_r497739108", "createdAt": "2020-09-30T19:09:43Z", "author": {"login": "zohrehj"}, "path": "user-registration-server-ws/user-mgmt-module/user-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/dao/UserProfileManagementDaoImpl.java", "diffHunk": "@@ -342,4 +329,13 @@ public AppEntity getAppPropertiesDetailsByAppId(String appId) {\n     }\n     return appPropertiesDetails;\n   }\n+\n+  @Override\n+  public void deactivateUserAccount(String userId) {\n+    Optional<UserDetailsEntity> optUserDetails = userDetailsRepository.findByUserId(userId);\n+    UserDetailsEntity userDetailsEntity = optUserDetails.get();\n+    userDetailsEntity.setStatus(UserStatus.DEACTIVATED.getValue());\n+    userDetailsEntity.setUserId(null);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njk1MzIyNg=="}, "originalCommit": {"oid": "862c3a38b90be98487a2d9f3441497c7fc565fd0"}, "originalPosition": 118}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Nzc0NTYxNA==", "bodyText": "see https://stackoverflow.com/questions/45192373/how-to-assign-a-value-from-application-properties-to-a-static-variable", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1079#discussion_r497745614", "createdAt": "2020-09-30T19:22:05Z", "author": {"login": "zohrehj"}, "path": "user-registration-server-ws/user-mgmt-module/user-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/task/DeactivateAccountScheduledTask.java", "diffHunk": "@@ -0,0 +1,31 @@\n+package com.google.cloud.healthcare.fdamystudies.task;\n+\n+import com.google.cloud.healthcare.fdamystudies.service.UserManagementProfileService;\n+import org.slf4j.ext.XLogger;\n+import org.slf4j.ext.XLoggerFactory;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.scheduling.annotation.Scheduled;\n+import org.springframework.stereotype.Component;\n+\n+@Component\n+public class DeactivateAccountScheduledTask {\n+\n+  private static final int INITIAL_DELAY_MILLI_SEC = 10000;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njk2MTY2Mg=="}, "originalCommit": {"oid": "862c3a38b90be98487a2d9f3441497c7fc565fd0"}, "originalPosition": 13}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4e4685111a9965fb47cd47c1f71d6e4f7853e235", "author": {"user": {"login": "madhurya-btc", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/4e4685111a9965fb47cd47c1f71d6e4f7853e235", "committedDate": "2020-10-01T15:33:25Z", "message": "Fixed review comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4a3272b90556b613759dfe7025e55a9fe39bf8e6", "author": {"user": {"login": "madhurya-btc", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/4a3272b90556b613759dfe7025e55a9fe39bf8e6", "committedDate": "2020-10-01T16:06:43Z", "message": "Review comment fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f22b19c1aefe8ebb7c19ffb49c1c98bf9e9fcb58", "author": {"user": {"login": "madhurya-btc", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/f22b19c1aefe8ebb7c19ffb49c1c98bf9e9fcb58", "committedDate": "2020-10-01T16:07:28Z", "message": "Merge branch 'develop' into user-management-deactive-api-endpoint"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAwNTEwNDk5", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1079#pullrequestreview-500510499", "createdAt": "2020-10-01T16:14:41Z", "commit": {"oid": "f22b19c1aefe8ebb7c19ffb49c1c98bf9e9fcb58"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxNjoxNDo0MVrOHbRwIg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxNjoxNDo0MVrOHbRwIg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODM2NDQ1MA==", "bodyText": "please add test to cover this functionality", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1079#discussion_r498364450", "createdAt": "2020-10-01T16:14:41Z", "author": {"login": "zohrehj"}, "path": "user-registration-server-ws/user-mgmt-module/user-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/dao/UserProfileManagementDaoImpl.java", "diffHunk": "@@ -342,4 +331,18 @@ public AppEntity getAppPropertiesDetailsByAppId(String appId) {\n     }\n     return appPropertiesDetails;\n   }\n+\n+  @Override\n+  public void deactivateUserAccount(String userId) {\n+    Optional<UserDetailsEntity> optUserDetails = userDetailsRepository.findByUserId(userId);\n+    UserDetailsEntity userDetailsEntity = optUserDetails.get();\n+    String alteredEmail =\n+        userDetailsEntity.getEmail() + \"_DEACTIVATED_\" + Instant.now().toEpochMilli();\n+    if (alteredEmail.length() > CommonConstants.EMAIL_LENGTH) {\n+      alteredEmail = alteredEmail.substring(0, CommonConstants.EMAIL_LENGTH);\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f22b19c1aefe8ebb7c19ffb49c1c98bf9e9fcb58"}, "originalPosition": 123}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cc63a35f7aa3595fff73e8498b1d56b3e0570b10", "author": {"user": {"login": "madhurya-btc", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/cc63a35f7aa3595fff73e8498b1d56b3e0570b10", "committedDate": "2020-10-01T16:44:04Z", "message": "Fixed review comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e8c7848cac439bb96bc1380b350a0753ba0967dd", "author": {"user": {"login": "madhurya-btc", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/e8c7848cac439bb96bc1380b350a0753ba0967dd", "committedDate": "2020-10-01T16:44:15Z", "message": "Merge branch 'user-management-deactive-api-endpoint' of https://github.com/GoogleCloudPlatform/fda-mystudies into user-management-deactive-api-endpoint"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "07d383ce1ef52e529420803401d11cfe6fba20a6", "author": {"user": {"login": "madhurya-btc", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/07d383ce1ef52e529420803401d11cfe6fba20a6", "committedDate": "2020-10-01T16:45:14Z", "message": "Merge branch 'develop' into user-management-deactive-api-endpoint"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAwNTQwOTk1", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1079#pullrequestreview-500540995", "createdAt": "2020-10-01T16:52:49Z", "commit": {"oid": "07d383ce1ef52e529420803401d11cfe6fba20a6"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxNjo1Mjo0OVrOHbTGYA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMC0wMVQxNjo1Mjo0OVrOHbTGYA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODM4NjUyOA==", "bodyText": "can you assert that email has been updated and contains \"DEACTIVATED\" after account is deactivated?", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1079#discussion_r498386528", "createdAt": "2020-10-01T16:52:49Z", "author": {"login": "zohrehj"}, "path": "user-registration-server-ws/user-mgmt-module/user-mgmt/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/UserProfileControllerTest.java", "diffHunk": "@@ -205,20 +215,21 @@ public void deactivateAccountSuccess() throws Exception {\n \n     verifyTokenIntrospectRequest(1);\n \n-    UserDetailsEntity daoResp = service.loadUserDetailsByUserId(Constants.VALID_USER_ID);\n-    assertEquals(3, daoResp.getStatus());\n+    UserDetailsEntity daoResp = service.loadUserDetailsByUserId(Constants.USER_ID);\n+    assertNotNull(daoResp);\n+    assertTrue(daoResp.getEmail().length() == CommonConstants.EMAIL_LENGTH);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "07d383ce1ef52e529420803401d11cfe6fba20a6"}, "originalPosition": 60}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "618444710d39d108665e4a8fbbc1a9e25233a560", "author": {"user": {"login": "madhurya-btc", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/618444710d39d108665e4a8fbbc1a9e25233a560", "committedDate": "2020-10-01T17:00:08Z", "message": "Fixed review comment"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e6ddde39cd3836c4bcf189a4fda0205a99646bc3", "author": {"user": {"login": "madhurya-btc", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/e6ddde39cd3836c4bcf189a4fda0205a99646bc3", "committedDate": "2020-10-01T17:00:44Z", "message": "Merge branch 'user-management-deactive-api-endpoint' of https://github.com/GoogleCloudPlatform/fda-mystudies into user-management-deactive-api-endpoint"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTAwNTUyMDI2", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1079#pullrequestreview-500552026", "createdAt": "2020-10-01T17:07:13Z", "commit": {"oid": "e6ddde39cd3836c4bcf189a4fda0205a99646bc3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 330, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}