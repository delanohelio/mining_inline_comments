{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEzOTM4MTk0", "number": 1763, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNDo1NToyM1rOE0aXqg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNToyMjoyOVrOE0bHCw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMzkzNDUwOnYy", "diffSide": "RIGHT", "path": "study-builder/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/dao/StudyQuestionnaireDAOImpl.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNDo1NToyM1rOHsHzyQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwNTo0MDozOVrOHsg0cg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjAyNzMzNw==", "bodyText": ":questionnaireId", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1763#discussion_r516027337", "createdAt": "2020-11-02T14:55:23Z", "author": {"login": "zohrehj"}, "path": "study-builder/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/dao/StudyQuestionnaireDAOImpl.java", "diffHunk": "@@ -3132,22 +3191,26 @@ public String reOrderQuestionnaireSteps(\n               \"update response_sub_type_value rs,questionnaires_steps q set rs.destination_step_id = NULL \"\n                   + \"where rs.response_type_id=q.instruction_form_id and q.step_type='\"\n                   + FdahpStudyDesignerConstants.QUESTION_STEP\n-                  + \"' and q.questionnaires_id=\"\n-                  + questionnaireId\n+                  + \"' and q.questionnaires_id=questionnaireId \"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cfaba01d02e590f18c4fb354a2daaf5736f0e35d"}, "originalPosition": 1444}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQzNzEwNg==", "bodyText": "Resolved", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1763#discussion_r516437106", "createdAt": "2020-11-03T05:40:39Z", "author": {"login": "vinuth1488"}, "path": "study-builder/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/dao/StudyQuestionnaireDAOImpl.java", "diffHunk": "@@ -3132,22 +3191,26 @@ public String reOrderQuestionnaireSteps(\n               \"update response_sub_type_value rs,questionnaires_steps q set rs.destination_step_id = NULL \"\n                   + \"where rs.response_type_id=q.instruction_form_id and q.step_type='\"\n                   + FdahpStudyDesignerConstants.QUESTION_STEP\n-                  + \"' and q.questionnaires_id=\"\n-                  + questionnaireId\n+                  + \"' and q.questionnaires_id=questionnaireId \"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjAyNzMzNw=="}, "originalCommit": {"oid": "cfaba01d02e590f18c4fb354a2daaf5736f0e35d"}, "originalPosition": 1444}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMzk0MTEwOnYy", "diffSide": "RIGHT", "path": "study-builder/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/dao/StudyQuestionnaireDAOImpl.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNDo1Njo1MlrOHsH3_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwNTo0MDo0N1rOHsg0hQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjAyODQxMw==", "bodyText": "please pass this as a parameter as well", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1763#discussion_r516028413", "createdAt": "2020-11-02T14:56:52Z", "author": {"login": "zohrehj"}, "path": "study-builder/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/dao/StudyQuestionnaireDAOImpl.java", "diffHunk": "@@ -3404,14 +3473,16 @@ public InstructionsBo saveOrUpdateInstructionsBo(\n         instructionsBo.setQuestionnairesStepsBo(questionnairesStepsBo);\n         if ((questionnairesStepsBo != null) && (count > 0)) {\n           String updateQuery =\n-              \"update QuestionnairesStepsBo QSBO set QSBO.destinationStep=\"\n-                  + questionnairesStepsBo.getStepId()\n+              \"update QuestionnairesStepsBo QSBO set QSBO.destinationStep=:stepId \"\n                   + \" where \"\n                   + \"QSBO.destinationStep=0 and QSBO.sequenceNo=\"\n                   + (count - 1)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cfaba01d02e590f18c4fb354a2daaf5736f0e35d"}, "originalPosition": 1532}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQzNzEyNQ==", "bodyText": "Resolved", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1763#discussion_r516437125", "createdAt": "2020-11-03T05:40:47Z", "author": {"login": "vinuth1488"}, "path": "study-builder/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/dao/StudyQuestionnaireDAOImpl.java", "diffHunk": "@@ -3404,14 +3473,16 @@ public InstructionsBo saveOrUpdateInstructionsBo(\n         instructionsBo.setQuestionnairesStepsBo(questionnairesStepsBo);\n         if ((questionnairesStepsBo != null) && (count > 0)) {\n           String updateQuery =\n-              \"update QuestionnairesStepsBo QSBO set QSBO.destinationStep=\"\n-                  + questionnairesStepsBo.getStepId()\n+              \"update QuestionnairesStepsBo QSBO set QSBO.destinationStep=:stepId \"\n                   + \" where \"\n                   + \"QSBO.destinationStep=0 and QSBO.sequenceNo=\"\n                   + (count - 1)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjAyODQxMw=="}, "originalCommit": {"oid": "cfaba01d02e590f18c4fb354a2daaf5736f0e35d"}, "originalPosition": 1532}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMzk1MDU1OnYy", "diffSide": "RIGHT", "path": "study-builder/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/dao/StudyQuestionnaireDAOImpl.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNDo1OTowNVrOHsH-Dw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwNTo0MDo1NlrOHsg0ow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjAyOTk2Nw==", "bodyText": "nit: :stepType", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1763#discussion_r516029967", "createdAt": "2020-11-02T14:59:05Z", "author": {"login": "zohrehj"}, "path": "study-builder/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/dao/StudyQuestionnaireDAOImpl.java", "diffHunk": "@@ -3572,13 +3645,14 @@ public QuestionsBo saveOrUpdateQuestion(QuestionsBo questionsBo) {\n         if (!questionsBo.getStatus()) {\n           if (questionsBo.getQuestionnaireId() != null) {\n             query =\n-                session.createQuery(\n-                    \"From QuestionnairesStepsBo QSBO where QSBO.instructionFormId=\"\n-                        + questionsBo.getFromId()\n-                        + \" and QSBO.stepType='\"\n-                        + FdahpStudyDesignerConstants.FORM_STEP\n-                        + \"' and QSBO.active=1 and QSBO.questionnairesId=\"\n-                        + questionsBo.getQuestionnaireId());\n+                session\n+                    .createQuery(\n+                        \"From QuestionnairesStepsBo QSBO where QSBO.instructionFormId=:fromId \"\n+                            + \" and QSBO.stepType=:setType \"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cfaba01d02e590f18c4fb354a2daaf5736f0e35d"}, "originalPosition": 1574}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQzNzE1NQ==", "bodyText": "Resolved", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1763#discussion_r516437155", "createdAt": "2020-11-03T05:40:56Z", "author": {"login": "vinuth1488"}, "path": "study-builder/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/dao/StudyQuestionnaireDAOImpl.java", "diffHunk": "@@ -3572,13 +3645,14 @@ public QuestionsBo saveOrUpdateQuestion(QuestionsBo questionsBo) {\n         if (!questionsBo.getStatus()) {\n           if (questionsBo.getQuestionnaireId() != null) {\n             query =\n-                session.createQuery(\n-                    \"From QuestionnairesStepsBo QSBO where QSBO.instructionFormId=\"\n-                        + questionsBo.getFromId()\n-                        + \" and QSBO.stepType='\"\n-                        + FdahpStudyDesignerConstants.FORM_STEP\n-                        + \"' and QSBO.active=1 and QSBO.questionnairesId=\"\n-                        + questionsBo.getQuestionnaireId());\n+                session\n+                    .createQuery(\n+                        \"From QuestionnairesStepsBo QSBO where QSBO.instructionFormId=:fromId \"\n+                            + \" and QSBO.stepType=:setType \"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjAyOTk2Nw=="}, "originalCommit": {"oid": "cfaba01d02e590f18c4fb354a2daaf5736f0e35d"}, "originalPosition": 1574}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzMzk1NTM2OnYy", "diffSide": "RIGHT", "path": "study-builder/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/dao/StudyQuestionnaireDAOImpl.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNTowMDowN1rOHsIA_g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwNTo0MToyNlrOHsg09A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjAzMDcxOA==", "bodyText": "nit: :formId", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1763#discussion_r516030718", "createdAt": "2020-11-02T15:00:07Z", "author": {"login": "zohrehj"}, "path": "study-builder/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/dao/StudyQuestionnaireDAOImpl.java", "diffHunk": "@@ -3609,10 +3684,11 @@ public QuestionsBo saveOrUpdateQuestion(QuestionsBo questionsBo) {\n           formMappingBo.setActive(true);\n           int sequenceNo = 0;\n           query =\n-              session.createQuery(\n-                  \"From FormMappingBo FMBO where FMBO.formId=\"\n-                      + questionsBo.getFromId()\n-                      + \" and FMBO.active=1 order by FMBO.sequenceNo DESC\");\n+              session\n+                  .createQuery(\n+                      \"From FormMappingBo FMBO where FMBO.formId=:fromId \"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cfaba01d02e590f18c4fb354a2daaf5736f0e35d"}, "originalPosition": 1606}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQzNzIzNg==", "bodyText": "Resolved", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1763#discussion_r516437236", "createdAt": "2020-11-03T05:41:26Z", "author": {"login": "vinuth1488"}, "path": "study-builder/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/dao/StudyQuestionnaireDAOImpl.java", "diffHunk": "@@ -3609,10 +3684,11 @@ public QuestionsBo saveOrUpdateQuestion(QuestionsBo questionsBo) {\n           formMappingBo.setActive(true);\n           int sequenceNo = 0;\n           query =\n-              session.createQuery(\n-                  \"From FormMappingBo FMBO where FMBO.formId=\"\n-                      + questionsBo.getFromId()\n-                      + \" and FMBO.active=1 order by FMBO.sequenceNo DESC\");\n+              session\n+                  .createQuery(\n+                      \"From FormMappingBo FMBO where FMBO.formId=:fromId \"", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjAzMDcxOA=="}, "originalCommit": {"oid": "cfaba01d02e590f18c4fb354a2daaf5736f0e35d"}, "originalPosition": 1606}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzNDA1NDA4OnYy", "diffSide": "RIGHT", "path": "study-builder/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/dao/StudyQuestionnaireDAOImpl.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNToyMjowMlrOHsI9bg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwNTo0MTowNFrOHsg0sQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA0NjE5MA==", "bodyText": "missed midified_date", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1763#discussion_r516046190", "createdAt": "2020-11-02T15:22:02Z", "author": {"login": "zohrehj"}, "path": "study-builder/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/dao/StudyQuestionnaireDAOImpl.java", "diffHunk": "@@ -4648,27 +4786,25 @@ public String updateAnchordateInQuestionnaire(\n                   session\n                       .createSQLQuery(\n                           \"update questionnaires set status=0,anchor_date_id=null,\"\n-                              + \"modified_by=\"\n-                              + sessionObject.getUserId()\n+                              + \"modified_by=:userId \"\n                               + \",modified_date='\"\n                               + FdahpStudyDesignerUtil.getCurrentDateTime()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cfaba01d02e590f18c4fb354a2daaf5736f0e35d"}, "originalPosition": 2168}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQzNzE2OQ==", "bodyText": "Resolved", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1763#discussion_r516437169", "createdAt": "2020-11-03T05:41:04Z", "author": {"login": "vinuth1488"}, "path": "study-builder/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/dao/StudyQuestionnaireDAOImpl.java", "diffHunk": "@@ -4648,27 +4786,25 @@ public String updateAnchordateInQuestionnaire(\n                   session\n                       .createSQLQuery(\n                           \"update questionnaires set status=0,anchor_date_id=null,\"\n-                              + \"modified_by=\"\n-                              + sessionObject.getUserId()\n+                              + \"modified_by=:userId \"\n                               + \",modified_date='\"\n                               + FdahpStudyDesignerUtil.getCurrentDateTime()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA0NjE5MA=="}, "originalCommit": {"oid": "cfaba01d02e590f18c4fb354a2daaf5736f0e35d"}, "originalPosition": 2168}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzIzNDA1NTc5OnYy", "diffSide": "RIGHT", "path": "study-builder/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/dao/StudyQuestionnaireDAOImpl.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNToyMjoyOVrOHsI-kQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wM1QwNTo0MToxMVrOHsg0zQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA0NjQ4MQ==", "bodyText": "same here, you missed modified_date", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1763#discussion_r516046481", "createdAt": "2020-11-02T15:22:29Z", "author": {"login": "zohrehj"}, "path": "study-builder/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/dao/StudyQuestionnaireDAOImpl.java", "diffHunk": "@@ -4648,27 +4786,25 @@ public String updateAnchordateInQuestionnaire(\n                   session\n                       .createSQLQuery(\n                           \"update questionnaires set status=0,anchor_date_id=null,\"\n-                              + \"modified_by=\"\n-                              + sessionObject.getUserId()\n+                              + \"modified_by=:userId \"\n                               + \",modified_date='\"\n                               + FdahpStudyDesignerUtil.getCurrentDateTime()\n-                              + \"' where active=1 and anchor_date_id in(\"\n-                              + StringUtils.join(anchorIds, \",\")\n-                              + \")\")\n+                              + \"' where active=1 and anchor_date_id in( :anchorIds ) \")\n+                      .setInteger(\"userId\", sessionObject.getUserId())\n+                      .setParameterList(\"anchorIds\", anchorIds)\n                       .executeUpdate();\n               if (count1 > 0) {\n                 studySequence.setStudyExcQuestionnaries(false);\n               }\n               int count2 =\n                   session\n                       .createSQLQuery(\n-                          \"update active_task set action=0 ,anchor_date_id=null, modified_by=\"\n-                              + sessionObject.getUserId()\n+                          \"update active_task set action=0 ,anchor_date_id=null, modified_by=:userId \"\n                               + \",modified_date='\"\n                               + FdahpStudyDesignerUtil.getCurrentDateTime()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cfaba01d02e590f18c4fb354a2daaf5736f0e35d"}, "originalPosition": 2186}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQzNzE5Nw==", "bodyText": "Resolved", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1763#discussion_r516437197", "createdAt": "2020-11-03T05:41:11Z", "author": {"login": "vinuth1488"}, "path": "study-builder/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/dao/StudyQuestionnaireDAOImpl.java", "diffHunk": "@@ -4648,27 +4786,25 @@ public String updateAnchordateInQuestionnaire(\n                   session\n                       .createSQLQuery(\n                           \"update questionnaires set status=0,anchor_date_id=null,\"\n-                              + \"modified_by=\"\n-                              + sessionObject.getUserId()\n+                              + \"modified_by=:userId \"\n                               + \",modified_date='\"\n                               + FdahpStudyDesignerUtil.getCurrentDateTime()\n-                              + \"' where active=1 and anchor_date_id in(\"\n-                              + StringUtils.join(anchorIds, \",\")\n-                              + \")\")\n+                              + \"' where active=1 and anchor_date_id in( :anchorIds ) \")\n+                      .setInteger(\"userId\", sessionObject.getUserId())\n+                      .setParameterList(\"anchorIds\", anchorIds)\n                       .executeUpdate();\n               if (count1 > 0) {\n                 studySequence.setStudyExcQuestionnaries(false);\n               }\n               int count2 =\n                   session\n                       .createSQLQuery(\n-                          \"update active_task set action=0 ,anchor_date_id=null, modified_by=\"\n-                              + sessionObject.getUserId()\n+                          \"update active_task set action=0 ,anchor_date_id=null, modified_by=:userId \"\n                               + \",modified_date='\"\n                               + FdahpStudyDesignerUtil.getCurrentDateTime()", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA0NjQ4MQ=="}, "originalCommit": {"oid": "cfaba01d02e590f18c4fb354a2daaf5736f0e35d"}, "originalPosition": 2186}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1631, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}