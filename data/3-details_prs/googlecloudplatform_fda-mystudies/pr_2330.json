{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTM2MTAwNTUy", "number": 2330, "title": "PM Web App -App participant registry server side pagination", "bodyText": "", "createdAt": "2020-12-10T17:22:01Z", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2330", "merged": true, "mergeCommit": {"oid": "64b8e543b8426c4e552ba5a82073c19ac2e7d715"}, "closed": true, "closedAt": "2020-12-15T14:50:23Z", "author": {"login": "firdosebtc1"}, "timelineItems": {"totalCount": 16, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdk2qEcAH2gAyNTM2MTAwNTUyOjI5Yjc5YmQ2ODY5NzlhYjUzZjNiZmEyZWQ4MjUxZDMzMDVkYjVmZjA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdmbhJcAH2gAyNTM2MTAwNTUyOjI5YzU4MzgwMzQyMWJiMDU4ODk5ZTUyNDdlMDlhNDk4YjliMTc2NjU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "29b79bd686979ab53f3bfa2ed8251d3305db5ff0", "author": {"user": {"login": "firdosebtc1", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/29b79bd686979ab53f3bfa2ed8251d3305db5ff0", "committedDate": "2020-12-10T17:19:20Z", "message": "app participant registry server side pagination"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "375fce69af013ab3a51b32da88ce3948cc09777b", "author": {"user": {"login": "firdosebtc1", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/375fce69af013ab3a51b32da88ce3948cc09777b", "committedDate": "2020-12-10T17:22:49Z", "message": "Merge branch 'develop' into pm-webapp-app-participant-pagination"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ5ODAwNzA2", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2330#pullrequestreview-549800706", "createdAt": "2020-12-11T04:53:20Z", "commit": {"oid": "375fce69af013ab3a51b32da88ce3948cc09777b"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQwNDo1MzoyMFrOIDpFUA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQwNDo1MzoyMFrOIDpFUA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDY4OTc0NA==", "bodyText": "this should check whether page > 1, to prevent ever returning a negative offset.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2330#discussion_r540689744", "createdAt": "2020-12-11T04:53:20Z", "author": {"login": "zohrehj"}, "path": "participant-manager/src/app/site-coordinator/apps/app-details/app-details.component.ts", "diffHunk": "@@ -59,23 +63,45 @@ export class AppDetailsComponent\n \n   fetchParticipantsDetails(): void {\n     this.appDetail$ = combineLatest(\n-      this.appDetailsService.get(this.appId),\n-      this.query$,\n+      this.appDetailsService.get(\n+        this.appId,\n+        this.offset,\n+        this.limit,\n+        this.searchTerm,\n+        this.sortBy[0].replace('_', ''),\n+        this.sortOrder,\n+      ),\n     ).pipe(\n-      map(([appDetails, query]) => {\n-        this.appDetailsBackup = JSON.parse(\n-          JSON.stringify(appDetails),\n-        ) as AppDetails;\n-        this.appDetailsBackup.participants = this.appDetailsBackup.participants.filter(\n-          (participant: Participant) =>\n-            participant.email?.toLowerCase().includes(query.toLowerCase()),\n-        );\n-        return this.appDetailsBackup;\n+      map(([appDetails]) => {\n+        return appDetails;\n       }),\n     );\n   }\n \n   search(query: string): void {\n-    this.query$.next(query.trim());\n+    this.currentPage = 1;\n+    this.offset = 0;\n+    this.searchTerm = query.trim().toLowerCase();\n+    this.fetchParticipantsDetails();\n+  }\n+\n+  pageChange(page: number): void {\n+    this.currentPage = page;\n+    this.offset = (page - 1) * this.limit;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "375fce69af013ab3a51b32da88ce3948cc09777b"}, "originalPosition": 72}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "80b90311632938f9418838f9210288439909b6f5", "author": {"user": {"login": "firdosebtc1", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/80b90311632938f9418838f9210288439909b6f5", "committedDate": "2020-12-11T05:59:38Z", "message": "code review comments has been resolved"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e88bf312cb325125acad03b20b0c523c4b2187de", "author": {"user": {"login": "firdosebtc1", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/e88bf312cb325125acad03b20b0c523c4b2187de", "committedDate": "2020-12-11T06:05:49Z", "message": "Merge branch 'develop' into pm-webapp-app-participant-pagination"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUwMzcyNDEw", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2330#pullrequestreview-550372410", "createdAt": "2020-12-11T17:52:11Z", "commit": {"oid": "e88bf312cb325125acad03b20b0c523c4b2187de"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQxNzo1MjoxMVrOIEDhiQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xMVQxNzo1MjoxMVrOIEDhiQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTEyMjk1Mw==", "bodyText": "you need to handle the case when page =0, your code does nothing right now", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2330#discussion_r541122953", "createdAt": "2020-12-11T17:52:11Z", "author": {"login": "zohrehj"}, "path": "participant-manager/src/app/site-coordinator/apps/app-details/app-details.component.ts", "diffHunk": "@@ -59,23 +63,47 @@ export class AppDetailsComponent\n \n   fetchParticipantsDetails(): void {\n     this.appDetail$ = combineLatest(\n-      this.appDetailsService.get(this.appId),\n-      this.query$,\n+      this.appDetailsService.get(\n+        this.appId,\n+        this.offset,\n+        this.limit,\n+        this.searchTerm,\n+        this.sortBy[0].replace('_', ''),\n+        this.sortOrder,\n+      ),\n     ).pipe(\n-      map(([appDetails, query]) => {\n-        this.appDetailsBackup = JSON.parse(\n-          JSON.stringify(appDetails),\n-        ) as AppDetails;\n-        this.appDetailsBackup.participants = this.appDetailsBackup.participants.filter(\n-          (participant: Participant) =>\n-            participant.email?.toLowerCase().includes(query.toLowerCase()),\n-        );\n-        return this.appDetailsBackup;\n+      map(([appDetails]) => {\n+        return appDetails;\n       }),\n     );\n   }\n \n   search(query: string): void {\n-    this.query$.next(query.trim());\n+    this.currentPage = 1;\n+    this.offset = 0;\n+    this.searchTerm = query.trim().toLowerCase();\n+    this.fetchParticipantsDetails();\n+  }\n+\n+  pageChange(page: number): void {\n+    if (page >= 1) {\n+      this.currentPage = page;\n+      this.offset = (page - 1) * this.limit;\n+      this.fetchParticipantsDetails();\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e88bf312cb325125acad03b20b0c523c4b2187de"}, "originalPosition": 75}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e5053968c9535358f2c07e9d2505b215deb8cd50", "author": {"user": {"login": "firdosebtc1", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/e5053968c9535358f2c07e9d2505b215deb8cd50", "committedDate": "2020-12-14T13:55:04Z", "message": "Merge branch 'develop' into pm-webapp-app-participant-pagination"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUxMzkyNDA3", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2330#pullrequestreview-551392407", "createdAt": "2020-12-14T14:00:40Z", "commit": {"oid": "e5053968c9535358f2c07e9d2505b215deb8cd50"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQxNDowMDo0MFrOIFRyjg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQxNDowMDo0MFrOIFRyjg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjQwNTI2Mg==", "bodyText": "by default current page will be 1 on page load", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2330#discussion_r542405262", "createdAt": "2020-12-14T14:00:40Z", "author": {"login": "firdosebtc1"}, "path": "participant-manager/src/app/site-coordinator/apps/app-details/app-details.component.ts", "diffHunk": "@@ -18,13 +18,17 @@ export class AppDetailsComponent\n   extends UnsubscribeOnDestroyAdapter\n   implements OnInit {\n   appId = '';\n-  query$ = new BehaviorSubject('');\n   appDetail$: Observable<AppDetails> = of();\n-  appDetailsBackup = {} as AppDetails;\n   statusEnum = Status;\n   enrolledStudies: EnrolledStudy[] = [];\n   studyTypes = StudyType;\n-\n+  // pagination\n+  limit = 10;\n+  currentPage = 1;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e5053968c9535358f2c07e9d2505b215deb8cd50"}, "originalPosition": 24}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUxNDM2MDY2", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2330#pullrequestreview-551436066", "createdAt": "2020-12-14T14:44:16Z", "commit": {"oid": "e5053968c9535358f2c07e9d2505b215deb8cd50"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQxNDo0NDoxNlrOIFTztw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0xNFQxNDo0NDoxNlrOIFTztw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjQzODMyNw==", "bodyText": "then why are onSortOrder and other methods setting it to 0?", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2330#discussion_r542438327", "createdAt": "2020-12-14T14:44:16Z", "author": {"login": "zohrehj"}, "path": "participant-manager/src/app/site-coordinator/apps/app-details/app-details.component.ts", "diffHunk": "@@ -18,13 +18,17 @@ export class AppDetailsComponent\n   extends UnsubscribeOnDestroyAdapter\n   implements OnInit {\n   appId = '';\n-  query$ = new BehaviorSubject('');\n   appDetail$: Observable<AppDetails> = of();\n-  appDetailsBackup = {} as AppDetails;\n   statusEnum = Status;\n   enrolledStudies: EnrolledStudy[] = [];\n   studyTypes = StudyType;\n-\n+  // pagination\n+  limit = 10;\n+  currentPage = 1;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjQwNTI2Mg=="}, "originalCommit": {"oid": "e5053968c9535358f2c07e9d2505b215deb8cd50"}, "originalPosition": 24}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "47a617decbdc619ff1b0b56a733e1a429f610f98", "author": {"user": {"login": "firdosebtc1", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/47a617decbdc619ff1b0b56a733e1a429f610f98", "committedDate": "2020-12-14T17:27:58Z", "message": "code review comments has been resolved"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUxNzc4Mzkw", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2330#pullrequestreview-551778390", "createdAt": "2020-12-14T18:30:40Z", "commit": {"oid": "47a617decbdc619ff1b0b56a733e1a429f610f98"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5b152ed0d2a6ff1ab691e4196ea0f756b1ca5667", "author": {"user": {"login": "firdosebtc1", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/5b152ed0d2a6ff1ab691e4196ea0f756b1ca5667", "committedDate": "2020-12-15T06:11:42Z", "message": "Merge branch 'develop' of https://github.com/GoogleCloudPlatform/fda-mystudies into pm-webapp-app-participant-pagination\n\n# Conflicts:\n#\tparticipant-manager/src/app/site-coordinator/apps/apps.module.ts"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8de64068250fd58ed8d44e9da0e888a7470bf829", "author": {"user": {"login": "firdosebtc1", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/8de64068250fd58ed8d44e9da0e888a7470bf829", "committedDate": "2020-12-15T14:45:46Z", "message": "Merge branch 'develop' into pm-webapp-app-participant-pagination"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d07e7717ab487e86ee0e2dc49dbc5527f7e14290", "author": {"user": {"login": "firdosebtc1", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/d07e7717ab487e86ee0e2dc49dbc5527f7e14290", "committedDate": "2020-12-15T14:48:50Z", "message": "Merge branch 'develop' into pm-webapp-app-participant-pagination"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTUyNTM2Mjgw", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/2330#pullrequestreview-552536280", "createdAt": "2020-12-15T14:49:28Z", "commit": {"oid": "d07e7717ab487e86ee0e2dc49dbc5527f7e14290"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "29c583803421bb058899e5247e09a498b9b17665", "author": {"user": {"login": "firdosebtc1", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/29c583803421bb058899e5247e09a498b9b17665", "committedDate": "2020-12-15T14:50:00Z", "message": "Merge branch 'develop' into pm-webapp-app-participant-pagination"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1009, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}