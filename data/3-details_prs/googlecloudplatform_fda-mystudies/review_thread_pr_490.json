{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMyNjI3NTI2", "number": 490, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxNToyNzo1MlrOEEu64A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxODo1NTowMFrOEFqCzw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczMzk4NDk2OnYy", "diffSide": "RIGHT", "path": "user-registration-server-ws/enroll-mgmt/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/tests/StudyStateControllerTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxNToyNzo1MlrOGiihRA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxMzozNzo0NFrOGjXmOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODg3MDM0MA==", "bodyText": "Use underscores to separate words.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/490#discussion_r438870340", "createdAt": "2020-06-11T15:27:52Z", "author": {"login": "nikklassen"}, "path": "user-registration-server-ws/enroll-mgmt/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/tests/StudyStateControllerTest.java", "diffHunk": "@@ -0,0 +1,144 @@\n+package com.google.cloud.healthcare.fdamystudies.controller.tests;\n+\n+import static org.junit.jupiter.api.Assertions.assertNotNull;\n+import java.util.ArrayList;\n+import java.util.List;\n+import org.junit.jupiter.api.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpHeaders;\n+import com.fasterxml.jackson.core.JsonProcessingException;\n+import com.google.cloud.healthcare.fdamystudies.beans.StudiesBean;\n+import com.google.cloud.healthcare.fdamystudies.beans.StudyStateReqBean;\n+import com.google.cloud.healthcare.fdamystudies.beans.WithdrawFromStudyBean;\n+import com.google.cloud.healthcare.fdamystudies.common.BaseMockIT;\n+import com.google.cloud.healthcare.fdamystudies.controller.StudyStateController;\n+import com.google.cloud.healthcare.fdamystudies.service.StudyStateService;\n+import com.google.cloud.healthcare.fdamystudies.testutils.Constants;\n+import com.google.cloud.healthcare.fdamystudies.testutils.TestUtils;\n+\n+public class StudyStateControllerTest extends BaseMockIT {\n+\n+  private static final String WITHDRAWFROMSTUDY_PATH = \"/withdrawfromstudy\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "432f37811a39c73a26164c26e84331b8d766ddf6"}, "originalPosition": 21}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTczOTk2MQ==", "bodyText": "changed as per suggestion.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/490#discussion_r439739961", "createdAt": "2020-06-13T13:37:44Z", "author": {"login": "aswinijena100"}, "path": "user-registration-server-ws/enroll-mgmt/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/tests/StudyStateControllerTest.java", "diffHunk": "@@ -0,0 +1,144 @@\n+package com.google.cloud.healthcare.fdamystudies.controller.tests;\n+\n+import static org.junit.jupiter.api.Assertions.assertNotNull;\n+import java.util.ArrayList;\n+import java.util.List;\n+import org.junit.jupiter.api.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpHeaders;\n+import com.fasterxml.jackson.core.JsonProcessingException;\n+import com.google.cloud.healthcare.fdamystudies.beans.StudiesBean;\n+import com.google.cloud.healthcare.fdamystudies.beans.StudyStateReqBean;\n+import com.google.cloud.healthcare.fdamystudies.beans.WithdrawFromStudyBean;\n+import com.google.cloud.healthcare.fdamystudies.common.BaseMockIT;\n+import com.google.cloud.healthcare.fdamystudies.controller.StudyStateController;\n+import com.google.cloud.healthcare.fdamystudies.service.StudyStateService;\n+import com.google.cloud.healthcare.fdamystudies.testutils.Constants;\n+import com.google.cloud.healthcare.fdamystudies.testutils.TestUtils;\n+\n+public class StudyStateControllerTest extends BaseMockIT {\n+\n+  private static final String WITHDRAWFROMSTUDY_PATH = \"/withdrawfromstudy\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODg3MDM0MA=="}, "originalCommit": {"oid": "432f37811a39c73a26164c26e84331b8d766ddf6"}, "originalPosition": 21}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczMzk5MDgwOnYy", "diffSide": "RIGHT", "path": "user-registration-server-ws/enroll-mgmt/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/tests/StudyStateControllerTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxNToyODo0OFrOGiik4A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxMzozODoyMVrOGjXmYA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODg3MTI2NA==", "bodyText": "Don't add this header if you're going to replace it right afterwards.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/490#discussion_r438871264", "createdAt": "2020-06-11T15:28:48Z", "author": {"login": "nikklassen"}, "path": "user-registration-server-ws/enroll-mgmt/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/tests/StudyStateControllerTest.java", "diffHunk": "@@ -0,0 +1,144 @@\n+package com.google.cloud.healthcare.fdamystudies.controller.tests;\n+\n+import static org.junit.jupiter.api.Assertions.assertNotNull;\n+import java.util.ArrayList;\n+import java.util.List;\n+import org.junit.jupiter.api.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpHeaders;\n+import com.fasterxml.jackson.core.JsonProcessingException;\n+import com.google.cloud.healthcare.fdamystudies.beans.StudiesBean;\n+import com.google.cloud.healthcare.fdamystudies.beans.StudyStateReqBean;\n+import com.google.cloud.healthcare.fdamystudies.beans.WithdrawFromStudyBean;\n+import com.google.cloud.healthcare.fdamystudies.common.BaseMockIT;\n+import com.google.cloud.healthcare.fdamystudies.controller.StudyStateController;\n+import com.google.cloud.healthcare.fdamystudies.service.StudyStateService;\n+import com.google.cloud.healthcare.fdamystudies.testutils.Constants;\n+import com.google.cloud.healthcare.fdamystudies.testutils.TestUtils;\n+\n+public class StudyStateControllerTest extends BaseMockIT {\n+\n+  private static final String WITHDRAWFROMSTUDY_PATH = \"/withdrawfromstudy\";\n+  private static final String STUDY_STATE_PATH = \"/studyState\";\n+  private static final String UPDATE_STUDY_STATE_PATH = \"/updateStudyState\";\n+  @Autowired private StudyStateController controller;\n+  @Autowired private StudyStateService studyStateService;\n+\n+  @Test\n+  public void contextLoads() {\n+    assertNotNull(controller);\n+    assertNotNull(mockMvc);\n+    assertNotNull(studyStateService);\n+  }\n+\n+  @Test\n+  public void updateStudyStateSuccess() throws Exception {\n+\n+    StudiesBean studiesBean =\n+        new StudiesBean(\n+            Constants.STUDYOF_HEALTH,\n+            Constants.BOOKMARKED,\n+            Constants.COMPLETION,\n+            Constants.ADHERENCE);\n+\n+    List<StudiesBean> listStudies = new ArrayList<StudiesBean>();\n+    listStudies.add(studiesBean);\n+\n+    String requestJson = getStudyStateJson(listStudies);\n+\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    headers.add(Constants.USER_ID_HEADER, Constants.VALID_USER_ID);\n+\n+    performPost(UPDATE_STUDY_STATE_PATH, requestJson, headers, Constants.SUCCESS, OK);\n+  }\n+\n+  @Test\n+  public void updateStudyStateFailure() throws Exception {\n+\n+    StudiesBean studiesBean =\n+        new StudiesBean(\n+            Constants.STUDYOF_HEALTH,\n+            Constants.BOOKMARKED,\n+            Constants.COMPLETION,\n+            Constants.ADHERENCE);\n+\n+    List<StudiesBean> listStudies = new ArrayList<StudiesBean>();\n+    listStudies.add(studiesBean);\n+\n+    String requestJson = getStudyStateJson(listStudies);\n+\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    headers.add(Constants.USER_ID_HEADER, Constants.VALID_USER_ID);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "432f37811a39c73a26164c26e84331b8d766ddf6"}, "originalPosition": 71}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc0MDAwMA==", "bodyText": "removed this header", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/490#discussion_r439740000", "createdAt": "2020-06-13T13:38:21Z", "author": {"login": "aswinijena100"}, "path": "user-registration-server-ws/enroll-mgmt/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/tests/StudyStateControllerTest.java", "diffHunk": "@@ -0,0 +1,144 @@\n+package com.google.cloud.healthcare.fdamystudies.controller.tests;\n+\n+import static org.junit.jupiter.api.Assertions.assertNotNull;\n+import java.util.ArrayList;\n+import java.util.List;\n+import org.junit.jupiter.api.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpHeaders;\n+import com.fasterxml.jackson.core.JsonProcessingException;\n+import com.google.cloud.healthcare.fdamystudies.beans.StudiesBean;\n+import com.google.cloud.healthcare.fdamystudies.beans.StudyStateReqBean;\n+import com.google.cloud.healthcare.fdamystudies.beans.WithdrawFromStudyBean;\n+import com.google.cloud.healthcare.fdamystudies.common.BaseMockIT;\n+import com.google.cloud.healthcare.fdamystudies.controller.StudyStateController;\n+import com.google.cloud.healthcare.fdamystudies.service.StudyStateService;\n+import com.google.cloud.healthcare.fdamystudies.testutils.Constants;\n+import com.google.cloud.healthcare.fdamystudies.testutils.TestUtils;\n+\n+public class StudyStateControllerTest extends BaseMockIT {\n+\n+  private static final String WITHDRAWFROMSTUDY_PATH = \"/withdrawfromstudy\";\n+  private static final String STUDY_STATE_PATH = \"/studyState\";\n+  private static final String UPDATE_STUDY_STATE_PATH = \"/updateStudyState\";\n+  @Autowired private StudyStateController controller;\n+  @Autowired private StudyStateService studyStateService;\n+\n+  @Test\n+  public void contextLoads() {\n+    assertNotNull(controller);\n+    assertNotNull(mockMvc);\n+    assertNotNull(studyStateService);\n+  }\n+\n+  @Test\n+  public void updateStudyStateSuccess() throws Exception {\n+\n+    StudiesBean studiesBean =\n+        new StudiesBean(\n+            Constants.STUDYOF_HEALTH,\n+            Constants.BOOKMARKED,\n+            Constants.COMPLETION,\n+            Constants.ADHERENCE);\n+\n+    List<StudiesBean> listStudies = new ArrayList<StudiesBean>();\n+    listStudies.add(studiesBean);\n+\n+    String requestJson = getStudyStateJson(listStudies);\n+\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    headers.add(Constants.USER_ID_HEADER, Constants.VALID_USER_ID);\n+\n+    performPost(UPDATE_STUDY_STATE_PATH, requestJson, headers, Constants.SUCCESS, OK);\n+  }\n+\n+  @Test\n+  public void updateStudyStateFailure() throws Exception {\n+\n+    StudiesBean studiesBean =\n+        new StudiesBean(\n+            Constants.STUDYOF_HEALTH,\n+            Constants.BOOKMARKED,\n+            Constants.COMPLETION,\n+            Constants.ADHERENCE);\n+\n+    List<StudiesBean> listStudies = new ArrayList<StudiesBean>();\n+    listStudies.add(studiesBean);\n+\n+    String requestJson = getStudyStateJson(listStudies);\n+\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    headers.add(Constants.USER_ID_HEADER, Constants.VALID_USER_ID);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODg3MTI2NA=="}, "originalCommit": {"oid": "432f37811a39c73a26164c26e84331b8d766ddf6"}, "originalPosition": 71}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczMzk5NDkwOnYy", "diffSide": "RIGHT", "path": "user-registration-server-ws/enroll-mgmt/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/tests/StudyStateControllerTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxNToyOTozMlrOGiinkw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxMzozODo0NFrOGjXmeg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODg3MTk1NQ==", "bodyText": "You can just reuse the same variable.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/490#discussion_r438871955", "createdAt": "2020-06-11T15:29:32Z", "author": {"login": "nikklassen"}, "path": "user-registration-server-ws/enroll-mgmt/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/tests/StudyStateControllerTest.java", "diffHunk": "@@ -0,0 +1,144 @@\n+package com.google.cloud.healthcare.fdamystudies.controller.tests;\n+\n+import static org.junit.jupiter.api.Assertions.assertNotNull;\n+import java.util.ArrayList;\n+import java.util.List;\n+import org.junit.jupiter.api.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpHeaders;\n+import com.fasterxml.jackson.core.JsonProcessingException;\n+import com.google.cloud.healthcare.fdamystudies.beans.StudiesBean;\n+import com.google.cloud.healthcare.fdamystudies.beans.StudyStateReqBean;\n+import com.google.cloud.healthcare.fdamystudies.beans.WithdrawFromStudyBean;\n+import com.google.cloud.healthcare.fdamystudies.common.BaseMockIT;\n+import com.google.cloud.healthcare.fdamystudies.controller.StudyStateController;\n+import com.google.cloud.healthcare.fdamystudies.service.StudyStateService;\n+import com.google.cloud.healthcare.fdamystudies.testutils.Constants;\n+import com.google.cloud.healthcare.fdamystudies.testutils.TestUtils;\n+\n+public class StudyStateControllerTest extends BaseMockIT {\n+\n+  private static final String WITHDRAWFROMSTUDY_PATH = \"/withdrawfromstudy\";\n+  private static final String STUDY_STATE_PATH = \"/studyState\";\n+  private static final String UPDATE_STUDY_STATE_PATH = \"/updateStudyState\";\n+  @Autowired private StudyStateController controller;\n+  @Autowired private StudyStateService studyStateService;\n+\n+  @Test\n+  public void contextLoads() {\n+    assertNotNull(controller);\n+    assertNotNull(mockMvc);\n+    assertNotNull(studyStateService);\n+  }\n+\n+  @Test\n+  public void updateStudyStateSuccess() throws Exception {\n+\n+    StudiesBean studiesBean =\n+        new StudiesBean(\n+            Constants.STUDYOF_HEALTH,\n+            Constants.BOOKMARKED,\n+            Constants.COMPLETION,\n+            Constants.ADHERENCE);\n+\n+    List<StudiesBean> listStudies = new ArrayList<StudiesBean>();\n+    listStudies.add(studiesBean);\n+\n+    String requestJson = getStudyStateJson(listStudies);\n+\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    headers.add(Constants.USER_ID_HEADER, Constants.VALID_USER_ID);\n+\n+    performPost(UPDATE_STUDY_STATE_PATH, requestJson, headers, Constants.SUCCESS, OK);\n+  }\n+\n+  @Test\n+  public void updateStudyStateFailure() throws Exception {\n+\n+    StudiesBean studiesBean =\n+        new StudiesBean(\n+            Constants.STUDYOF_HEALTH,\n+            Constants.BOOKMARKED,\n+            Constants.COMPLETION,\n+            Constants.ADHERENCE);\n+\n+    List<StudiesBean> listStudies = new ArrayList<StudiesBean>();\n+    listStudies.add(studiesBean);\n+\n+    String requestJson = getStudyStateJson(listStudies);\n+\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    headers.add(Constants.USER_ID_HEADER, Constants.VALID_USER_ID);\n+\n+    // not valid user id\n+    headers.set(Constants.USER_ID_HEADER, Constants.INVALID_USER_ID);\n+    performPost(UPDATE_STUDY_STATE_PATH, requestJson, headers, \"\", BAD_REQUEST);\n+\n+    // empty studylist\n+    List<StudiesBean> listStudies1 = new ArrayList<StudiesBean>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "432f37811a39c73a26164c26e84331b8d766ddf6"}, "originalPosition": 78}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc0MDAyNg==", "bodyText": "changed as per suggestion.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/490#discussion_r439740026", "createdAt": "2020-06-13T13:38:44Z", "author": {"login": "aswinijena100"}, "path": "user-registration-server-ws/enroll-mgmt/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/tests/StudyStateControllerTest.java", "diffHunk": "@@ -0,0 +1,144 @@\n+package com.google.cloud.healthcare.fdamystudies.controller.tests;\n+\n+import static org.junit.jupiter.api.Assertions.assertNotNull;\n+import java.util.ArrayList;\n+import java.util.List;\n+import org.junit.jupiter.api.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpHeaders;\n+import com.fasterxml.jackson.core.JsonProcessingException;\n+import com.google.cloud.healthcare.fdamystudies.beans.StudiesBean;\n+import com.google.cloud.healthcare.fdamystudies.beans.StudyStateReqBean;\n+import com.google.cloud.healthcare.fdamystudies.beans.WithdrawFromStudyBean;\n+import com.google.cloud.healthcare.fdamystudies.common.BaseMockIT;\n+import com.google.cloud.healthcare.fdamystudies.controller.StudyStateController;\n+import com.google.cloud.healthcare.fdamystudies.service.StudyStateService;\n+import com.google.cloud.healthcare.fdamystudies.testutils.Constants;\n+import com.google.cloud.healthcare.fdamystudies.testutils.TestUtils;\n+\n+public class StudyStateControllerTest extends BaseMockIT {\n+\n+  private static final String WITHDRAWFROMSTUDY_PATH = \"/withdrawfromstudy\";\n+  private static final String STUDY_STATE_PATH = \"/studyState\";\n+  private static final String UPDATE_STUDY_STATE_PATH = \"/updateStudyState\";\n+  @Autowired private StudyStateController controller;\n+  @Autowired private StudyStateService studyStateService;\n+\n+  @Test\n+  public void contextLoads() {\n+    assertNotNull(controller);\n+    assertNotNull(mockMvc);\n+    assertNotNull(studyStateService);\n+  }\n+\n+  @Test\n+  public void updateStudyStateSuccess() throws Exception {\n+\n+    StudiesBean studiesBean =\n+        new StudiesBean(\n+            Constants.STUDYOF_HEALTH,\n+            Constants.BOOKMARKED,\n+            Constants.COMPLETION,\n+            Constants.ADHERENCE);\n+\n+    List<StudiesBean> listStudies = new ArrayList<StudiesBean>();\n+    listStudies.add(studiesBean);\n+\n+    String requestJson = getStudyStateJson(listStudies);\n+\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    headers.add(Constants.USER_ID_HEADER, Constants.VALID_USER_ID);\n+\n+    performPost(UPDATE_STUDY_STATE_PATH, requestJson, headers, Constants.SUCCESS, OK);\n+  }\n+\n+  @Test\n+  public void updateStudyStateFailure() throws Exception {\n+\n+    StudiesBean studiesBean =\n+        new StudiesBean(\n+            Constants.STUDYOF_HEALTH,\n+            Constants.BOOKMARKED,\n+            Constants.COMPLETION,\n+            Constants.ADHERENCE);\n+\n+    List<StudiesBean> listStudies = new ArrayList<StudiesBean>();\n+    listStudies.add(studiesBean);\n+\n+    String requestJson = getStudyStateJson(listStudies);\n+\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    headers.add(Constants.USER_ID_HEADER, Constants.VALID_USER_ID);\n+\n+    // not valid user id\n+    headers.set(Constants.USER_ID_HEADER, Constants.INVALID_USER_ID);\n+    performPost(UPDATE_STUDY_STATE_PATH, requestJson, headers, \"\", BAD_REQUEST);\n+\n+    // empty studylist\n+    List<StudiesBean> listStudies1 = new ArrayList<StudiesBean>();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODg3MTk1NQ=="}, "originalCommit": {"oid": "432f37811a39c73a26164c26e84331b8d766ddf6"}, "originalPosition": 78}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczNDAwMzk2OnYy", "diffSide": "RIGHT", "path": "user-registration-server-ws/enroll-mgmt/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/tests/StudyStateControllerTest.java", "isResolved": true, "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMVQxNTozMTowMVrOGiiteQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xOVQxNDowOTozNlrOGmWMFg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODg3MzQ2NQ==", "bodyText": "Shouldn't there be some assertion on the database to see this change? I'd like to see something added to the rest of these tests that shows we didn't just return OK and not do anything", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/490#discussion_r438873465", "createdAt": "2020-06-11T15:31:01Z", "author": {"login": "nikklassen"}, "path": "user-registration-server-ws/enroll-mgmt/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/tests/StudyStateControllerTest.java", "diffHunk": "@@ -0,0 +1,144 @@\n+package com.google.cloud.healthcare.fdamystudies.controller.tests;\n+\n+import static org.junit.jupiter.api.Assertions.assertNotNull;\n+import java.util.ArrayList;\n+import java.util.List;\n+import org.junit.jupiter.api.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpHeaders;\n+import com.fasterxml.jackson.core.JsonProcessingException;\n+import com.google.cloud.healthcare.fdamystudies.beans.StudiesBean;\n+import com.google.cloud.healthcare.fdamystudies.beans.StudyStateReqBean;\n+import com.google.cloud.healthcare.fdamystudies.beans.WithdrawFromStudyBean;\n+import com.google.cloud.healthcare.fdamystudies.common.BaseMockIT;\n+import com.google.cloud.healthcare.fdamystudies.controller.StudyStateController;\n+import com.google.cloud.healthcare.fdamystudies.service.StudyStateService;\n+import com.google.cloud.healthcare.fdamystudies.testutils.Constants;\n+import com.google.cloud.healthcare.fdamystudies.testutils.TestUtils;\n+\n+public class StudyStateControllerTest extends BaseMockIT {\n+\n+  private static final String WITHDRAWFROMSTUDY_PATH = \"/withdrawfromstudy\";\n+  private static final String STUDY_STATE_PATH = \"/studyState\";\n+  private static final String UPDATE_STUDY_STATE_PATH = \"/updateStudyState\";\n+  @Autowired private StudyStateController controller;\n+  @Autowired private StudyStateService studyStateService;\n+\n+  @Test\n+  public void contextLoads() {\n+    assertNotNull(controller);\n+    assertNotNull(mockMvc);\n+    assertNotNull(studyStateService);\n+  }\n+\n+  @Test\n+  public void updateStudyStateSuccess() throws Exception {\n+\n+    StudiesBean studiesBean =\n+        new StudiesBean(\n+            Constants.STUDYOF_HEALTH,\n+            Constants.BOOKMARKED,\n+            Constants.COMPLETION,\n+            Constants.ADHERENCE);\n+\n+    List<StudiesBean> listStudies = new ArrayList<StudiesBean>();\n+    listStudies.add(studiesBean);\n+\n+    String requestJson = getStudyStateJson(listStudies);\n+\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    headers.add(Constants.USER_ID_HEADER, Constants.VALID_USER_ID);\n+\n+    performPost(UPDATE_STUDY_STATE_PATH, requestJson, headers, Constants.SUCCESS, OK);\n+  }\n+\n+  @Test\n+  public void updateStudyStateFailure() throws Exception {\n+\n+    StudiesBean studiesBean =\n+        new StudiesBean(\n+            Constants.STUDYOF_HEALTH,\n+            Constants.BOOKMARKED,\n+            Constants.COMPLETION,\n+            Constants.ADHERENCE);\n+\n+    List<StudiesBean> listStudies = new ArrayList<StudiesBean>();\n+    listStudies.add(studiesBean);\n+\n+    String requestJson = getStudyStateJson(listStudies);\n+\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    headers.add(Constants.USER_ID_HEADER, Constants.VALID_USER_ID);\n+\n+    // not valid user id\n+    headers.set(Constants.USER_ID_HEADER, Constants.INVALID_USER_ID);\n+    performPost(UPDATE_STUDY_STATE_PATH, requestJson, headers, \"\", BAD_REQUEST);\n+\n+    // empty studylist\n+    List<StudiesBean> listStudies1 = new ArrayList<StudiesBean>();\n+    requestJson = getStudyStateJson(listStudies1);\n+    headers.set(Constants.USER_ID_HEADER, Constants.VALID_USER_ID);\n+    performPost(UPDATE_STUDY_STATE_PATH, requestJson, headers, \"\", BAD_REQUEST);\n+  }\n+\n+  @Test\n+  public void getStudyStateSuccess() throws Exception {\n+\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    headers.add(Constants.USER_ID_HEADER, Constants.VALID_USER_ID);\n+\n+    performGet(STUDY_STATE_PATH, headers, Constants.SUCCESS.toUpperCase(), OK);\n+  }\n+\n+  @Test\n+  public void getStudyStateUnauthorizedUserId() throws Exception {\n+\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    headers.add(Constants.USER_ID_HEADER, Constants.INVALID_USER_ID);\n+    performGet(STUDY_STATE_PATH, headers, \"\", UNAUTHORIZED);\n+  }\n+\n+  @Test\n+  public void withdrawFromStudySuccess() throws Exception {\n+\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    headers.add(Constants.USER_ID_HEADER, Constants.VALID_USER_ID);\n+\n+    String requestJson =\n+        getWithDrawJson(\n+            Constants.PARTICIPANT_ID, Constants.STUDY_ID_OF_PARTICIPANT, Constants.DELETE);\n+    performPost(WITHDRAWFROMSTUDY_PATH, requestJson, headers, Constants.SUCCESS.toUpperCase(), OK);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "432f37811a39c73a26164c26e84331b8d766ddf6"}, "originalPosition": 110}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc0MDUzMg==", "bodyText": "Added below code snippet to check whether the database data got changed or not .    Please check and let us know if understanding is correct on this point.\nMvcResult result = performGet(STUDY_STATE_PATH, headers, Constants.SUCCESS.toUpperCase(), OK);\nList<Map<String, String>> studyList =\nJsonPath.read(result.getResponse().getContentAsString(), \"$.studies[*]\");\nfor (Map<String, String> studyMap : studyList) {\nif (studyMap.get(\"participantId\").equals(Constants.PARTICIPANT_ID)) {\nassertTrue(studyMap.get(\"status\").equals(AppConstants.WITHDRAWN));\nbreak;\n}\n}", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/490#discussion_r439740532", "createdAt": "2020-06-13T13:46:48Z", "author": {"login": "aswinijena100"}, "path": "user-registration-server-ws/enroll-mgmt/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/tests/StudyStateControllerTest.java", "diffHunk": "@@ -0,0 +1,144 @@\n+package com.google.cloud.healthcare.fdamystudies.controller.tests;\n+\n+import static org.junit.jupiter.api.Assertions.assertNotNull;\n+import java.util.ArrayList;\n+import java.util.List;\n+import org.junit.jupiter.api.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpHeaders;\n+import com.fasterxml.jackson.core.JsonProcessingException;\n+import com.google.cloud.healthcare.fdamystudies.beans.StudiesBean;\n+import com.google.cloud.healthcare.fdamystudies.beans.StudyStateReqBean;\n+import com.google.cloud.healthcare.fdamystudies.beans.WithdrawFromStudyBean;\n+import com.google.cloud.healthcare.fdamystudies.common.BaseMockIT;\n+import com.google.cloud.healthcare.fdamystudies.controller.StudyStateController;\n+import com.google.cloud.healthcare.fdamystudies.service.StudyStateService;\n+import com.google.cloud.healthcare.fdamystudies.testutils.Constants;\n+import com.google.cloud.healthcare.fdamystudies.testutils.TestUtils;\n+\n+public class StudyStateControllerTest extends BaseMockIT {\n+\n+  private static final String WITHDRAWFROMSTUDY_PATH = \"/withdrawfromstudy\";\n+  private static final String STUDY_STATE_PATH = \"/studyState\";\n+  private static final String UPDATE_STUDY_STATE_PATH = \"/updateStudyState\";\n+  @Autowired private StudyStateController controller;\n+  @Autowired private StudyStateService studyStateService;\n+\n+  @Test\n+  public void contextLoads() {\n+    assertNotNull(controller);\n+    assertNotNull(mockMvc);\n+    assertNotNull(studyStateService);\n+  }\n+\n+  @Test\n+  public void updateStudyStateSuccess() throws Exception {\n+\n+    StudiesBean studiesBean =\n+        new StudiesBean(\n+            Constants.STUDYOF_HEALTH,\n+            Constants.BOOKMARKED,\n+            Constants.COMPLETION,\n+            Constants.ADHERENCE);\n+\n+    List<StudiesBean> listStudies = new ArrayList<StudiesBean>();\n+    listStudies.add(studiesBean);\n+\n+    String requestJson = getStudyStateJson(listStudies);\n+\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    headers.add(Constants.USER_ID_HEADER, Constants.VALID_USER_ID);\n+\n+    performPost(UPDATE_STUDY_STATE_PATH, requestJson, headers, Constants.SUCCESS, OK);\n+  }\n+\n+  @Test\n+  public void updateStudyStateFailure() throws Exception {\n+\n+    StudiesBean studiesBean =\n+        new StudiesBean(\n+            Constants.STUDYOF_HEALTH,\n+            Constants.BOOKMARKED,\n+            Constants.COMPLETION,\n+            Constants.ADHERENCE);\n+\n+    List<StudiesBean> listStudies = new ArrayList<StudiesBean>();\n+    listStudies.add(studiesBean);\n+\n+    String requestJson = getStudyStateJson(listStudies);\n+\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    headers.add(Constants.USER_ID_HEADER, Constants.VALID_USER_ID);\n+\n+    // not valid user id\n+    headers.set(Constants.USER_ID_HEADER, Constants.INVALID_USER_ID);\n+    performPost(UPDATE_STUDY_STATE_PATH, requestJson, headers, \"\", BAD_REQUEST);\n+\n+    // empty studylist\n+    List<StudiesBean> listStudies1 = new ArrayList<StudiesBean>();\n+    requestJson = getStudyStateJson(listStudies1);\n+    headers.set(Constants.USER_ID_HEADER, Constants.VALID_USER_ID);\n+    performPost(UPDATE_STUDY_STATE_PATH, requestJson, headers, \"\", BAD_REQUEST);\n+  }\n+\n+  @Test\n+  public void getStudyStateSuccess() throws Exception {\n+\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    headers.add(Constants.USER_ID_HEADER, Constants.VALID_USER_ID);\n+\n+    performGet(STUDY_STATE_PATH, headers, Constants.SUCCESS.toUpperCase(), OK);\n+  }\n+\n+  @Test\n+  public void getStudyStateUnauthorizedUserId() throws Exception {\n+\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    headers.add(Constants.USER_ID_HEADER, Constants.INVALID_USER_ID);\n+    performGet(STUDY_STATE_PATH, headers, \"\", UNAUTHORIZED);\n+  }\n+\n+  @Test\n+  public void withdrawFromStudySuccess() throws Exception {\n+\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    headers.add(Constants.USER_ID_HEADER, Constants.VALID_USER_ID);\n+\n+    String requestJson =\n+        getWithDrawJson(\n+            Constants.PARTICIPANT_ID, Constants.STUDY_ID_OF_PARTICIPANT, Constants.DELETE);\n+    performPost(WITHDRAWFROMSTUDY_PATH, requestJson, headers, Constants.SUCCESS.toUpperCase(), OK);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODg3MzQ2NQ=="}, "originalCommit": {"oid": "432f37811a39c73a26164c26e84331b8d766ddf6"}, "originalPosition": 110}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDM3OTQ1Mg==", "bodyText": "Yes, this looks ok. But I would prefer you use the objectMapper to convert the response into a List<StudyStateBean>, it's much less brittle than using this JsonPath library.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/490#discussion_r440379452", "createdAt": "2020-06-15T18:53:54Z", "author": {"login": "nikklassen"}, "path": "user-registration-server-ws/enroll-mgmt/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/tests/StudyStateControllerTest.java", "diffHunk": "@@ -0,0 +1,144 @@\n+package com.google.cloud.healthcare.fdamystudies.controller.tests;\n+\n+import static org.junit.jupiter.api.Assertions.assertNotNull;\n+import java.util.ArrayList;\n+import java.util.List;\n+import org.junit.jupiter.api.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpHeaders;\n+import com.fasterxml.jackson.core.JsonProcessingException;\n+import com.google.cloud.healthcare.fdamystudies.beans.StudiesBean;\n+import com.google.cloud.healthcare.fdamystudies.beans.StudyStateReqBean;\n+import com.google.cloud.healthcare.fdamystudies.beans.WithdrawFromStudyBean;\n+import com.google.cloud.healthcare.fdamystudies.common.BaseMockIT;\n+import com.google.cloud.healthcare.fdamystudies.controller.StudyStateController;\n+import com.google.cloud.healthcare.fdamystudies.service.StudyStateService;\n+import com.google.cloud.healthcare.fdamystudies.testutils.Constants;\n+import com.google.cloud.healthcare.fdamystudies.testutils.TestUtils;\n+\n+public class StudyStateControllerTest extends BaseMockIT {\n+\n+  private static final String WITHDRAWFROMSTUDY_PATH = \"/withdrawfromstudy\";\n+  private static final String STUDY_STATE_PATH = \"/studyState\";\n+  private static final String UPDATE_STUDY_STATE_PATH = \"/updateStudyState\";\n+  @Autowired private StudyStateController controller;\n+  @Autowired private StudyStateService studyStateService;\n+\n+  @Test\n+  public void contextLoads() {\n+    assertNotNull(controller);\n+    assertNotNull(mockMvc);\n+    assertNotNull(studyStateService);\n+  }\n+\n+  @Test\n+  public void updateStudyStateSuccess() throws Exception {\n+\n+    StudiesBean studiesBean =\n+        new StudiesBean(\n+            Constants.STUDYOF_HEALTH,\n+            Constants.BOOKMARKED,\n+            Constants.COMPLETION,\n+            Constants.ADHERENCE);\n+\n+    List<StudiesBean> listStudies = new ArrayList<StudiesBean>();\n+    listStudies.add(studiesBean);\n+\n+    String requestJson = getStudyStateJson(listStudies);\n+\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    headers.add(Constants.USER_ID_HEADER, Constants.VALID_USER_ID);\n+\n+    performPost(UPDATE_STUDY_STATE_PATH, requestJson, headers, Constants.SUCCESS, OK);\n+  }\n+\n+  @Test\n+  public void updateStudyStateFailure() throws Exception {\n+\n+    StudiesBean studiesBean =\n+        new StudiesBean(\n+            Constants.STUDYOF_HEALTH,\n+            Constants.BOOKMARKED,\n+            Constants.COMPLETION,\n+            Constants.ADHERENCE);\n+\n+    List<StudiesBean> listStudies = new ArrayList<StudiesBean>();\n+    listStudies.add(studiesBean);\n+\n+    String requestJson = getStudyStateJson(listStudies);\n+\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    headers.add(Constants.USER_ID_HEADER, Constants.VALID_USER_ID);\n+\n+    // not valid user id\n+    headers.set(Constants.USER_ID_HEADER, Constants.INVALID_USER_ID);\n+    performPost(UPDATE_STUDY_STATE_PATH, requestJson, headers, \"\", BAD_REQUEST);\n+\n+    // empty studylist\n+    List<StudiesBean> listStudies1 = new ArrayList<StudiesBean>();\n+    requestJson = getStudyStateJson(listStudies1);\n+    headers.set(Constants.USER_ID_HEADER, Constants.VALID_USER_ID);\n+    performPost(UPDATE_STUDY_STATE_PATH, requestJson, headers, \"\", BAD_REQUEST);\n+  }\n+\n+  @Test\n+  public void getStudyStateSuccess() throws Exception {\n+\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    headers.add(Constants.USER_ID_HEADER, Constants.VALID_USER_ID);\n+\n+    performGet(STUDY_STATE_PATH, headers, Constants.SUCCESS.toUpperCase(), OK);\n+  }\n+\n+  @Test\n+  public void getStudyStateUnauthorizedUserId() throws Exception {\n+\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    headers.add(Constants.USER_ID_HEADER, Constants.INVALID_USER_ID);\n+    performGet(STUDY_STATE_PATH, headers, \"\", UNAUTHORIZED);\n+  }\n+\n+  @Test\n+  public void withdrawFromStudySuccess() throws Exception {\n+\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    headers.add(Constants.USER_ID_HEADER, Constants.VALID_USER_ID);\n+\n+    String requestJson =\n+        getWithDrawJson(\n+            Constants.PARTICIPANT_ID, Constants.STUDY_ID_OF_PARTICIPANT, Constants.DELETE);\n+    performPost(WITHDRAWFROMSTUDY_PATH, requestJson, headers, Constants.SUCCESS.toUpperCase(), OK);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODg3MzQ2NQ=="}, "originalCommit": {"oid": "432f37811a39c73a26164c26e84331b8d766ddf6"}, "originalPosition": 110}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDc0ODMwNQ==", "bodyText": "changed the logic to assert the response , instead of asserting inside the loop.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/490#discussion_r440748305", "createdAt": "2020-06-16T10:27:17Z", "author": {"login": "aswinijena100"}, "path": "user-registration-server-ws/enroll-mgmt/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/tests/StudyStateControllerTest.java", "diffHunk": "@@ -0,0 +1,144 @@\n+package com.google.cloud.healthcare.fdamystudies.controller.tests;\n+\n+import static org.junit.jupiter.api.Assertions.assertNotNull;\n+import java.util.ArrayList;\n+import java.util.List;\n+import org.junit.jupiter.api.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpHeaders;\n+import com.fasterxml.jackson.core.JsonProcessingException;\n+import com.google.cloud.healthcare.fdamystudies.beans.StudiesBean;\n+import com.google.cloud.healthcare.fdamystudies.beans.StudyStateReqBean;\n+import com.google.cloud.healthcare.fdamystudies.beans.WithdrawFromStudyBean;\n+import com.google.cloud.healthcare.fdamystudies.common.BaseMockIT;\n+import com.google.cloud.healthcare.fdamystudies.controller.StudyStateController;\n+import com.google.cloud.healthcare.fdamystudies.service.StudyStateService;\n+import com.google.cloud.healthcare.fdamystudies.testutils.Constants;\n+import com.google.cloud.healthcare.fdamystudies.testutils.TestUtils;\n+\n+public class StudyStateControllerTest extends BaseMockIT {\n+\n+  private static final String WITHDRAWFROMSTUDY_PATH = \"/withdrawfromstudy\";\n+  private static final String STUDY_STATE_PATH = \"/studyState\";\n+  private static final String UPDATE_STUDY_STATE_PATH = \"/updateStudyState\";\n+  @Autowired private StudyStateController controller;\n+  @Autowired private StudyStateService studyStateService;\n+\n+  @Test\n+  public void contextLoads() {\n+    assertNotNull(controller);\n+    assertNotNull(mockMvc);\n+    assertNotNull(studyStateService);\n+  }\n+\n+  @Test\n+  public void updateStudyStateSuccess() throws Exception {\n+\n+    StudiesBean studiesBean =\n+        new StudiesBean(\n+            Constants.STUDYOF_HEALTH,\n+            Constants.BOOKMARKED,\n+            Constants.COMPLETION,\n+            Constants.ADHERENCE);\n+\n+    List<StudiesBean> listStudies = new ArrayList<StudiesBean>();\n+    listStudies.add(studiesBean);\n+\n+    String requestJson = getStudyStateJson(listStudies);\n+\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    headers.add(Constants.USER_ID_HEADER, Constants.VALID_USER_ID);\n+\n+    performPost(UPDATE_STUDY_STATE_PATH, requestJson, headers, Constants.SUCCESS, OK);\n+  }\n+\n+  @Test\n+  public void updateStudyStateFailure() throws Exception {\n+\n+    StudiesBean studiesBean =\n+        new StudiesBean(\n+            Constants.STUDYOF_HEALTH,\n+            Constants.BOOKMARKED,\n+            Constants.COMPLETION,\n+            Constants.ADHERENCE);\n+\n+    List<StudiesBean> listStudies = new ArrayList<StudiesBean>();\n+    listStudies.add(studiesBean);\n+\n+    String requestJson = getStudyStateJson(listStudies);\n+\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    headers.add(Constants.USER_ID_HEADER, Constants.VALID_USER_ID);\n+\n+    // not valid user id\n+    headers.set(Constants.USER_ID_HEADER, Constants.INVALID_USER_ID);\n+    performPost(UPDATE_STUDY_STATE_PATH, requestJson, headers, \"\", BAD_REQUEST);\n+\n+    // empty studylist\n+    List<StudiesBean> listStudies1 = new ArrayList<StudiesBean>();\n+    requestJson = getStudyStateJson(listStudies1);\n+    headers.set(Constants.USER_ID_HEADER, Constants.VALID_USER_ID);\n+    performPost(UPDATE_STUDY_STATE_PATH, requestJson, headers, \"\", BAD_REQUEST);\n+  }\n+\n+  @Test\n+  public void getStudyStateSuccess() throws Exception {\n+\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    headers.add(Constants.USER_ID_HEADER, Constants.VALID_USER_ID);\n+\n+    performGet(STUDY_STATE_PATH, headers, Constants.SUCCESS.toUpperCase(), OK);\n+  }\n+\n+  @Test\n+  public void getStudyStateUnauthorizedUserId() throws Exception {\n+\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    headers.add(Constants.USER_ID_HEADER, Constants.INVALID_USER_ID);\n+    performGet(STUDY_STATE_PATH, headers, \"\", UNAUTHORIZED);\n+  }\n+\n+  @Test\n+  public void withdrawFromStudySuccess() throws Exception {\n+\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    headers.add(Constants.USER_ID_HEADER, Constants.VALID_USER_ID);\n+\n+    String requestJson =\n+        getWithDrawJson(\n+            Constants.PARTICIPANT_ID, Constants.STUDY_ID_OF_PARTICIPANT, Constants.DELETE);\n+    performPost(WITHDRAWFROMSTUDY_PATH, requestJson, headers, Constants.SUCCESS.toUpperCase(), OK);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODg3MzQ2NQ=="}, "originalCommit": {"oid": "432f37811a39c73a26164c26e84331b8d766ddf6"}, "originalPosition": 110}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDg3OTk2Ng==", "bodyText": "I mean to use Java to write the more complex assertion. I think jsonPath is ok for simple property checks, but Java works well for more complex logic.\n    StudyStateResponse response = getObjectMapper().readValue(result.getResponse().getContentAsString(),\n        StudyStateResponse.class);\n    Optional<StudyStateBean> study = response.getStudies().stream()\n        .filter(s -> s.getParticipantId().equals(Constants.PARTICIPANT_ID))\n        .findFirst();\n\n    assertTrue(study.isPresent());\n    assertEquals(AppConstants.WITHDRAWN, study.get().getStatus());", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/490#discussion_r440879966", "createdAt": "2020-06-16T14:08:31Z", "author": {"login": "nikklassen"}, "path": "user-registration-server-ws/enroll-mgmt/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/tests/StudyStateControllerTest.java", "diffHunk": "@@ -0,0 +1,144 @@\n+package com.google.cloud.healthcare.fdamystudies.controller.tests;\n+\n+import static org.junit.jupiter.api.Assertions.assertNotNull;\n+import java.util.ArrayList;\n+import java.util.List;\n+import org.junit.jupiter.api.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpHeaders;\n+import com.fasterxml.jackson.core.JsonProcessingException;\n+import com.google.cloud.healthcare.fdamystudies.beans.StudiesBean;\n+import com.google.cloud.healthcare.fdamystudies.beans.StudyStateReqBean;\n+import com.google.cloud.healthcare.fdamystudies.beans.WithdrawFromStudyBean;\n+import com.google.cloud.healthcare.fdamystudies.common.BaseMockIT;\n+import com.google.cloud.healthcare.fdamystudies.controller.StudyStateController;\n+import com.google.cloud.healthcare.fdamystudies.service.StudyStateService;\n+import com.google.cloud.healthcare.fdamystudies.testutils.Constants;\n+import com.google.cloud.healthcare.fdamystudies.testutils.TestUtils;\n+\n+public class StudyStateControllerTest extends BaseMockIT {\n+\n+  private static final String WITHDRAWFROMSTUDY_PATH = \"/withdrawfromstudy\";\n+  private static final String STUDY_STATE_PATH = \"/studyState\";\n+  private static final String UPDATE_STUDY_STATE_PATH = \"/updateStudyState\";\n+  @Autowired private StudyStateController controller;\n+  @Autowired private StudyStateService studyStateService;\n+\n+  @Test\n+  public void contextLoads() {\n+    assertNotNull(controller);\n+    assertNotNull(mockMvc);\n+    assertNotNull(studyStateService);\n+  }\n+\n+  @Test\n+  public void updateStudyStateSuccess() throws Exception {\n+\n+    StudiesBean studiesBean =\n+        new StudiesBean(\n+            Constants.STUDYOF_HEALTH,\n+            Constants.BOOKMARKED,\n+            Constants.COMPLETION,\n+            Constants.ADHERENCE);\n+\n+    List<StudiesBean> listStudies = new ArrayList<StudiesBean>();\n+    listStudies.add(studiesBean);\n+\n+    String requestJson = getStudyStateJson(listStudies);\n+\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    headers.add(Constants.USER_ID_HEADER, Constants.VALID_USER_ID);\n+\n+    performPost(UPDATE_STUDY_STATE_PATH, requestJson, headers, Constants.SUCCESS, OK);\n+  }\n+\n+  @Test\n+  public void updateStudyStateFailure() throws Exception {\n+\n+    StudiesBean studiesBean =\n+        new StudiesBean(\n+            Constants.STUDYOF_HEALTH,\n+            Constants.BOOKMARKED,\n+            Constants.COMPLETION,\n+            Constants.ADHERENCE);\n+\n+    List<StudiesBean> listStudies = new ArrayList<StudiesBean>();\n+    listStudies.add(studiesBean);\n+\n+    String requestJson = getStudyStateJson(listStudies);\n+\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    headers.add(Constants.USER_ID_HEADER, Constants.VALID_USER_ID);\n+\n+    // not valid user id\n+    headers.set(Constants.USER_ID_HEADER, Constants.INVALID_USER_ID);\n+    performPost(UPDATE_STUDY_STATE_PATH, requestJson, headers, \"\", BAD_REQUEST);\n+\n+    // empty studylist\n+    List<StudiesBean> listStudies1 = new ArrayList<StudiesBean>();\n+    requestJson = getStudyStateJson(listStudies1);\n+    headers.set(Constants.USER_ID_HEADER, Constants.VALID_USER_ID);\n+    performPost(UPDATE_STUDY_STATE_PATH, requestJson, headers, \"\", BAD_REQUEST);\n+  }\n+\n+  @Test\n+  public void getStudyStateSuccess() throws Exception {\n+\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    headers.add(Constants.USER_ID_HEADER, Constants.VALID_USER_ID);\n+\n+    performGet(STUDY_STATE_PATH, headers, Constants.SUCCESS.toUpperCase(), OK);\n+  }\n+\n+  @Test\n+  public void getStudyStateUnauthorizedUserId() throws Exception {\n+\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    headers.add(Constants.USER_ID_HEADER, Constants.INVALID_USER_ID);\n+    performGet(STUDY_STATE_PATH, headers, \"\", UNAUTHORIZED);\n+  }\n+\n+  @Test\n+  public void withdrawFromStudySuccess() throws Exception {\n+\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    headers.add(Constants.USER_ID_HEADER, Constants.VALID_USER_ID);\n+\n+    String requestJson =\n+        getWithDrawJson(\n+            Constants.PARTICIPANT_ID, Constants.STUDY_ID_OF_PARTICIPANT, Constants.DELETE);\n+    performPost(WITHDRAWFROMSTUDY_PATH, requestJson, headers, Constants.SUCCESS.toUpperCase(), OK);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODg3MzQ2NQ=="}, "originalCommit": {"oid": "432f37811a39c73a26164c26e84331b8d766ddf6"}, "originalPosition": 110}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjg2MjYxNA==", "bodyText": "As suggested, used objectMapper instead of jsonPath", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/490#discussion_r442862614", "createdAt": "2020-06-19T14:09:36Z", "author": {"login": "madhurya-btc"}, "path": "user-registration-server-ws/enroll-mgmt/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/tests/StudyStateControllerTest.java", "diffHunk": "@@ -0,0 +1,144 @@\n+package com.google.cloud.healthcare.fdamystudies.controller.tests;\n+\n+import static org.junit.jupiter.api.Assertions.assertNotNull;\n+import java.util.ArrayList;\n+import java.util.List;\n+import org.junit.jupiter.api.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpHeaders;\n+import com.fasterxml.jackson.core.JsonProcessingException;\n+import com.google.cloud.healthcare.fdamystudies.beans.StudiesBean;\n+import com.google.cloud.healthcare.fdamystudies.beans.StudyStateReqBean;\n+import com.google.cloud.healthcare.fdamystudies.beans.WithdrawFromStudyBean;\n+import com.google.cloud.healthcare.fdamystudies.common.BaseMockIT;\n+import com.google.cloud.healthcare.fdamystudies.controller.StudyStateController;\n+import com.google.cloud.healthcare.fdamystudies.service.StudyStateService;\n+import com.google.cloud.healthcare.fdamystudies.testutils.Constants;\n+import com.google.cloud.healthcare.fdamystudies.testutils.TestUtils;\n+\n+public class StudyStateControllerTest extends BaseMockIT {\n+\n+  private static final String WITHDRAWFROMSTUDY_PATH = \"/withdrawfromstudy\";\n+  private static final String STUDY_STATE_PATH = \"/studyState\";\n+  private static final String UPDATE_STUDY_STATE_PATH = \"/updateStudyState\";\n+  @Autowired private StudyStateController controller;\n+  @Autowired private StudyStateService studyStateService;\n+\n+  @Test\n+  public void contextLoads() {\n+    assertNotNull(controller);\n+    assertNotNull(mockMvc);\n+    assertNotNull(studyStateService);\n+  }\n+\n+  @Test\n+  public void updateStudyStateSuccess() throws Exception {\n+\n+    StudiesBean studiesBean =\n+        new StudiesBean(\n+            Constants.STUDYOF_HEALTH,\n+            Constants.BOOKMARKED,\n+            Constants.COMPLETION,\n+            Constants.ADHERENCE);\n+\n+    List<StudiesBean> listStudies = new ArrayList<StudiesBean>();\n+    listStudies.add(studiesBean);\n+\n+    String requestJson = getStudyStateJson(listStudies);\n+\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    headers.add(Constants.USER_ID_HEADER, Constants.VALID_USER_ID);\n+\n+    performPost(UPDATE_STUDY_STATE_PATH, requestJson, headers, Constants.SUCCESS, OK);\n+  }\n+\n+  @Test\n+  public void updateStudyStateFailure() throws Exception {\n+\n+    StudiesBean studiesBean =\n+        new StudiesBean(\n+            Constants.STUDYOF_HEALTH,\n+            Constants.BOOKMARKED,\n+            Constants.COMPLETION,\n+            Constants.ADHERENCE);\n+\n+    List<StudiesBean> listStudies = new ArrayList<StudiesBean>();\n+    listStudies.add(studiesBean);\n+\n+    String requestJson = getStudyStateJson(listStudies);\n+\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    headers.add(Constants.USER_ID_HEADER, Constants.VALID_USER_ID);\n+\n+    // not valid user id\n+    headers.set(Constants.USER_ID_HEADER, Constants.INVALID_USER_ID);\n+    performPost(UPDATE_STUDY_STATE_PATH, requestJson, headers, \"\", BAD_REQUEST);\n+\n+    // empty studylist\n+    List<StudiesBean> listStudies1 = new ArrayList<StudiesBean>();\n+    requestJson = getStudyStateJson(listStudies1);\n+    headers.set(Constants.USER_ID_HEADER, Constants.VALID_USER_ID);\n+    performPost(UPDATE_STUDY_STATE_PATH, requestJson, headers, \"\", BAD_REQUEST);\n+  }\n+\n+  @Test\n+  public void getStudyStateSuccess() throws Exception {\n+\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    headers.add(Constants.USER_ID_HEADER, Constants.VALID_USER_ID);\n+\n+    performGet(STUDY_STATE_PATH, headers, Constants.SUCCESS.toUpperCase(), OK);\n+  }\n+\n+  @Test\n+  public void getStudyStateUnauthorizedUserId() throws Exception {\n+\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    headers.add(Constants.USER_ID_HEADER, Constants.INVALID_USER_ID);\n+    performGet(STUDY_STATE_PATH, headers, \"\", UNAUTHORIZED);\n+  }\n+\n+  @Test\n+  public void withdrawFromStudySuccess() throws Exception {\n+\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    headers.add(Constants.USER_ID_HEADER, Constants.VALID_USER_ID);\n+\n+    String requestJson =\n+        getWithDrawJson(\n+            Constants.PARTICIPANT_ID, Constants.STUDY_ID_OF_PARTICIPANT, Constants.DELETE);\n+    performPost(WITHDRAWFROMSTUDY_PATH, requestJson, headers, Constants.SUCCESS.toUpperCase(), OK);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODg3MzQ2NQ=="}, "originalCommit": {"oid": "432f37811a39c73a26164c26e84331b8d766ddf6"}, "originalPosition": 110}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjc0MzY3MTgzOnYy", "diffSide": "RIGHT", "path": "user-registration-server-ws/enroll-mgmt/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/tests/StudyStateControllerTest.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNVQxODo1NTowMFrOGj-qpQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xNlQxMDoyODoyNlrOGkVLWA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDM4MDA2OQ==", "bodyText": "else fail the test? You don't expect other studies do you?", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/490#discussion_r440380069", "createdAt": "2020-06-15T18:55:00Z", "author": {"login": "nikklassen"}, "path": "user-registration-server-ws/enroll-mgmt/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/tests/StudyStateControllerTest.java", "diffHunk": "@@ -0,0 +1,171 @@\n+package com.google.cloud.healthcare.fdamystudies.controller.tests;\n+\n+import static org.junit.Assert.assertTrue;\n+import static org.junit.jupiter.api.Assertions.assertNotNull;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Map;\n+import org.junit.jupiter.api.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpHeaders;\n+import org.springframework.test.web.servlet.MvcResult;\n+import com.fasterxml.jackson.core.JsonProcessingException;\n+import com.google.cloud.healthcare.fdamystudies.beans.StudiesBean;\n+import com.google.cloud.healthcare.fdamystudies.beans.StudyStateReqBean;\n+import com.google.cloud.healthcare.fdamystudies.beans.WithdrawFromStudyBean;\n+import com.google.cloud.healthcare.fdamystudies.common.BaseMockIT;\n+import com.google.cloud.healthcare.fdamystudies.controller.StudyStateController;\n+import com.google.cloud.healthcare.fdamystudies.service.StudyStateService;\n+import com.google.cloud.healthcare.fdamystudies.testutils.Constants;\n+import com.google.cloud.healthcare.fdamystudies.testutils.TestUtils;\n+import com.google.cloud.healthcare.fdamystudies.util.AppConstants;\n+import com.jayway.jsonpath.JsonPath;\n+\n+public class StudyStateControllerTest extends BaseMockIT {\n+\n+  private static final String WITHDRAW_FROM_STUDY_PATH = \"/withdrawfromstudy\";\n+  private static final String STUDY_STATE_PATH = \"/studyState\";\n+  private static final String UPDATE_STUDY_STATE_PATH = \"/updateStudyState\";\n+  @Autowired private StudyStateController controller;\n+  @Autowired private StudyStateService studyStateService;\n+\n+  @Test\n+  public void contextLoads() {\n+    assertNotNull(controller);\n+    assertNotNull(mockMvc);\n+    assertNotNull(studyStateService);\n+  }\n+\n+  @Test\n+  public void updateStudyStateSuccess() throws Exception {\n+\n+    StudiesBean studiesBean =\n+        new StudiesBean(\n+            Constants.STUDYOF_HEALTH,\n+            Constants.BOOKMARKED,\n+            Constants.COMPLETION,\n+            Constants.ADHERENCE);\n+\n+    List<StudiesBean> listStudies = new ArrayList<StudiesBean>();\n+    listStudies.add(studiesBean);\n+\n+    String requestJson = getStudyStateJson(listStudies);\n+\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    headers.add(Constants.USER_ID_HEADER, Constants.VALID_USER_ID);\n+\n+    performPost(UPDATE_STUDY_STATE_PATH, requestJson, headers, Constants.SUCCESS, OK);\n+\n+    MvcResult result = performGet(STUDY_STATE_PATH, headers, Constants.SUCCESS.toUpperCase(), OK);\n+    List<Map<String, Object>> studyList =\n+        JsonPath.read(result.getResponse().getContentAsString(), \"$.studies[*]\");\n+    for (Map<String, Object> studyMap : studyList) {\n+      if (studyMap.get(\"studyId\").equals(Constants.STUDYOF_HEALTH)) {\n+        assertTrue((boolean) studyMap.get(\"bookmarked\").equals(Constants.BOOKMARKED));\n+        assertTrue((int) studyMap.get(\"completion\") == Constants.COMPLETION);\n+        assertTrue((int) studyMap.get(\"adherence\") == Constants.ADHERENCE);\n+        break;\n+      }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bba0abc3de4932be2c2a09dcc8dac9029c2276db"}, "originalPosition": 68}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDc0ODg4OA==", "bodyText": "changed the logic to assert the response , instead of asserting inside the loop.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/490#discussion_r440748888", "createdAt": "2020-06-16T10:28:26Z", "author": {"login": "aswinijena100"}, "path": "user-registration-server-ws/enroll-mgmt/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/tests/StudyStateControllerTest.java", "diffHunk": "@@ -0,0 +1,171 @@\n+package com.google.cloud.healthcare.fdamystudies.controller.tests;\n+\n+import static org.junit.Assert.assertTrue;\n+import static org.junit.jupiter.api.Assertions.assertNotNull;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Map;\n+import org.junit.jupiter.api.Test;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpHeaders;\n+import org.springframework.test.web.servlet.MvcResult;\n+import com.fasterxml.jackson.core.JsonProcessingException;\n+import com.google.cloud.healthcare.fdamystudies.beans.StudiesBean;\n+import com.google.cloud.healthcare.fdamystudies.beans.StudyStateReqBean;\n+import com.google.cloud.healthcare.fdamystudies.beans.WithdrawFromStudyBean;\n+import com.google.cloud.healthcare.fdamystudies.common.BaseMockIT;\n+import com.google.cloud.healthcare.fdamystudies.controller.StudyStateController;\n+import com.google.cloud.healthcare.fdamystudies.service.StudyStateService;\n+import com.google.cloud.healthcare.fdamystudies.testutils.Constants;\n+import com.google.cloud.healthcare.fdamystudies.testutils.TestUtils;\n+import com.google.cloud.healthcare.fdamystudies.util.AppConstants;\n+import com.jayway.jsonpath.JsonPath;\n+\n+public class StudyStateControllerTest extends BaseMockIT {\n+\n+  private static final String WITHDRAW_FROM_STUDY_PATH = \"/withdrawfromstudy\";\n+  private static final String STUDY_STATE_PATH = \"/studyState\";\n+  private static final String UPDATE_STUDY_STATE_PATH = \"/updateStudyState\";\n+  @Autowired private StudyStateController controller;\n+  @Autowired private StudyStateService studyStateService;\n+\n+  @Test\n+  public void contextLoads() {\n+    assertNotNull(controller);\n+    assertNotNull(mockMvc);\n+    assertNotNull(studyStateService);\n+  }\n+\n+  @Test\n+  public void updateStudyStateSuccess() throws Exception {\n+\n+    StudiesBean studiesBean =\n+        new StudiesBean(\n+            Constants.STUDYOF_HEALTH,\n+            Constants.BOOKMARKED,\n+            Constants.COMPLETION,\n+            Constants.ADHERENCE);\n+\n+    List<StudiesBean> listStudies = new ArrayList<StudiesBean>();\n+    listStudies.add(studiesBean);\n+\n+    String requestJson = getStudyStateJson(listStudies);\n+\n+    HttpHeaders headers = TestUtils.getCommonHeaders();\n+    headers.add(Constants.USER_ID_HEADER, Constants.VALID_USER_ID);\n+\n+    performPost(UPDATE_STUDY_STATE_PATH, requestJson, headers, Constants.SUCCESS, OK);\n+\n+    MvcResult result = performGet(STUDY_STATE_PATH, headers, Constants.SUCCESS.toUpperCase(), OK);\n+    List<Map<String, Object>> studyList =\n+        JsonPath.read(result.getResponse().getContentAsString(), \"$.studies[*]\");\n+    for (Map<String, Object> studyMap : studyList) {\n+      if (studyMap.get(\"studyId\").equals(Constants.STUDYOF_HEALTH)) {\n+        assertTrue((boolean) studyMap.get(\"bookmarked\").equals(Constants.BOOKMARKED));\n+        assertTrue((int) studyMap.get(\"completion\") == Constants.COMPLETION);\n+        assertTrue((int) studyMap.get(\"adherence\") == Constants.ADHERENCE);\n+        break;\n+      }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDM4MDA2OQ=="}, "originalCommit": {"oid": "bba0abc3de4932be2c2a09dcc8dac9029c2276db"}, "originalPosition": 68}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2392, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}