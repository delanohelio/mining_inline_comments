{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDY3NTA4OTAy", "number": 745, "title": "Participant manager web app study participant list", "bodyText": "", "createdAt": "2020-08-13T16:45:17Z", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/745", "merged": true, "mergeCommit": {"oid": "cd9282449cef05759641444f1ba67a0c59fe2f19"}, "closed": true, "closedAt": "2020-08-18T13:16:21Z", "author": {"login": "firdosebtc1"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc-itDRAH2gAyNDY3NTA4OTAyOjY4MjU1MjcwZWU4ZDcxZjdhYTE0NWNjNDQ5YTVmYzAwZjZmZjViYWE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdAG2ccAFqTQ2OTQ0MzU2Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "68255270ee8d71f7aa145cc449a5fc00f6ff5baa", "author": {"user": {"login": "firdosebtc1", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/68255270ee8d71f7aa145cc449a5fc00f6ff5baa", "committedDate": "2020-08-13T16:35:22Z", "message": "study participant list has been implemented"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "679f110aac3f1bba53bb8d14b1056b4b31e2a6d2", "author": {"user": {"login": "firdosebtc1", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/679f110aac3f1bba53bb8d14b1056b4b31e2a6d2", "committedDate": "2020-08-14T08:32:25Z", "message": "Merge branch 'Participant-manger-webapp-common-changes' of https://github.com/GoogleCloudPlatform/fda-mystudies into Participant-manager-wenapp-study-participant"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "737c4fa0b8ceff6db7b06d4d564b0302a44a2d72", "author": {"user": {"login": "firdosebtc1", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/737c4fa0b8ceff6db7b06d4d564b0302a44a2d72", "committedDate": "2020-08-14T15:09:07Z", "message": "build issues has been fixed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d3f034cd34150b34764a8601774298183a0a5edb", "author": {"user": {"login": "firdosebtc1", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/d3f034cd34150b34764a8601774298183a0a5edb", "committedDate": "2020-08-17T10:02:43Z", "message": "Merge branch 'develop' of https://github.com/GoogleCloudPlatform/fda-mystudies into Participant-manager-wenapp-study-participant"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c1bffbe1adab85f4ac61a774af4ef45b621858a0", "author": {"user": {"login": "firdosebtc1", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/c1bffbe1adab85f4ac61a774af4ef45b621858a0", "committedDate": "2020-08-17T10:04:15Z", "message": "changes related to permission has been done"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "37f620632c3c7a821afa11618befa0c5918e52f4", "author": {"user": {"login": "firdosebtc1", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/37f620632c3c7a821afa11618befa0c5918e52f4", "committedDate": "2020-08-17T15:03:40Z", "message": "Merge branch 'develop' into Participant-manager-wenapp-study-participant"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY4NTUyNDMw", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/745#pullrequestreview-468552430", "createdAt": "2020-08-17T15:12:02Z", "commit": {"oid": "37f620632c3c7a821afa11618befa0c5918e52f4"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNToxMjowMlrOHBs8Pg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xN1QxNToxMzoyNFrOHBs_xg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU0Njk0Mg==", "bodyText": "typo successResponse", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/745#discussion_r471546942", "createdAt": "2020-08-17T15:12:02Z", "author": {"login": "nikklassen"}, "path": "UR-web-app/src/app/site-coordinator/studies/shared/study-details.service.spec.ts", "diffHunk": "@@ -0,0 +1,124 @@\n+import {TestBed, fakeAsync, tick} from '@angular/core/testing';\n+import {StudyDetailsService} from './study-details.service';\n+import {HttpClientTestingModule} from '@angular/common/http/testing';\n+import {SiteCoordinatorModule} from '../../site-coordinator.module';\n+import {NO_ERRORS_SCHEMA} from '@angular/core';\n+import {RouterTestingModule} from '@angular/router/testing';\n+import {EntityService} from '../../../service/entity.service';\n+import {ApiResponse} from 'src/app/entity/api.response.model';\n+import {throwError, of} from 'rxjs';\n+import {StudyDetails} from './study-details';\n+import * as expectedResult from 'src/app/entity/mock-studies-data';\n+import {HttpClient} from '@angular/common/http';\n+import {ToastrModule} from 'ngx-toastr';\n+\n+describe('StudyDetailsService', () => {\n+  let studyDetailsService: StudyDetailsService;\n+  let httpServiceSpyObj: jasmine.SpyObj<HttpClient>;\n+\n+  beforeEach(() => {\n+    TestBed.configureTestingModule({\n+      imports: [\n+        HttpClientTestingModule,\n+        SiteCoordinatorModule,\n+        RouterTestingModule.withRoutes([]),\n+        ToastrModule.forRoot({\n+          positionClass: 'toast-top-center',\n+          preventDuplicates: true,\n+          enableHtml: true,\n+        }),\n+      ],\n+      schemas: [NO_ERRORS_SCHEMA],\n+      providers: [StudyDetailsService, EntityService],\n+    });\n+  });\n+\n+  it('should be created', () => {\n+    const service: StudyDetailsService = TestBed.get(\n+      StudyDetailsService,\n+    ) as StudyDetailsService;\n+    expect(service).toBeTruthy();\n+  });\n+\n+  it('should return expected study participant`s details', fakeAsync(() => {\n+    const entityServiceSpy = jasmine.createSpyObj<EntityService<StudyDetails>>(\n+      'EntityService',\n+      {get: of(expectedResult.expectedStudiesDetails)},\n+    );\n+    studyDetailsService = new StudyDetailsService(\n+      entityServiceSpy,\n+      httpServiceSpyObj,\n+    );\n+\n+    studyDetailsService\n+      .getStudyDetails(expectedResult.expectedStudyId.id.toString())\n+      .subscribe(\n+        (studyDetail) =>\n+          expect(studyDetail).toEqual(\n+            expectedResult.expectedStudiesDetails,\n+            'expected Studies Participant List',\n+          ),\n+        fail,\n+      );\n+    expect(entityServiceSpy.get).toHaveBeenCalledTimes(1);\n+  }));\n+\n+  it('should return an error when the server returns a 400', fakeAsync(() => {\n+    const errorResponses: ApiResponse = {\n+      message: 'Bad Request',\n+    } as ApiResponse;\n+\n+    const entitiyServiceSpy = jasmine.createSpyObj<EntityService<StudyDetails>>(\n+      'EntityService',\n+      {get: throwError(errorResponses)},\n+    );\n+    studyDetailsService = new StudyDetailsService(\n+      entitiyServiceSpy,\n+      httpServiceSpyObj,\n+    );\n+\n+    tick(40);\n+    studyDetailsService\n+      .getStudyDetails(expectedResult.expectedStudyId.id.toString())\n+      .subscribe(\n+        () => fail('expected an error'),\n+        (error: ApiResponse) => {\n+          expect(error.message).toBe('Bad Request');\n+        },\n+      );\n+  }));\n+\n+  it('should get the updated target enrollment data', () => {\n+    const entityServicespyobj = jasmine.createSpyObj<\n+      EntityService<StudyDetails>\n+    >('EntityService', ['get']);\n+\n+    const httpServicespyobj = jasmine.createSpyObj<HttpClient>('HttpClient', {\n+      patch: of(),\n+    });\n+    studyDetailsService = new StudyDetailsService(\n+      entityServicespyobj,\n+      httpServicespyobj,\n+    );\n+\n+    httpServicespyobj.patch.and.returnValue(\n+      of(expectedResult.expectedResponse),\n+    );\n+\n+    studyDetailsService\n+      .updateTargetEnrollment(\n+        expectedResult.expectedTargetEnrollment,\n+        expectedResult.expectedStudiesDetails.participantRegistryDetail.studyId.toString(),\n+      )\n+      .subscribe(\n+        (succesResponse: ApiResponse) =>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "37f620632c3c7a821afa11618befa0c5918e52f4"}, "originalPosition": 114}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTU0Nzg0Ng==", "bodyText": "You should combine this with the previous test case", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/745#discussion_r471547846", "createdAt": "2020-08-17T15:13:24Z", "author": {"login": "nikklassen"}, "path": "UR-web-app/src/app/site-coordinator/studies/study-details/study-details.component.spec.ts", "diffHunk": "@@ -0,0 +1,103 @@\n+import {\n+  async,\n+  ComponentFixture,\n+  TestBed,\n+  fakeAsync,\n+} from '@angular/core/testing';\n+\n+import {StudyDetailsComponent} from './study-details.component';\n+import {ModalModule, BsModalRef} from 'ngx-bootstrap/modal';\n+import {RouterTestingModule} from '@angular/router/testing';\n+import {StudiesModule} from '../studies.module';\n+import {HttpClientModule} from '@angular/common/http';\n+import {BrowserAnimationsModule} from '@angular/platform-browser/animations';\n+import {ToastrModule} from 'ngx-toastr';\n+import {StudyDetailsService} from '../shared/study-details.service';\n+import {StudyDetails} from '../shared/study-details';\n+import {expectedStudiesDetails} from 'src/app/entity/mock-studies-data';\n+import {of} from 'rxjs';\n+import {EntityService} from 'src/app/service/entity.service';\n+\n+describe('StudyDetailsComponent', () => {\n+  let component: StudyDetailsComponent;\n+  let fixture: ComponentFixture<StudyDetailsComponent>;\n+\n+  beforeEach(async(async () => {\n+    const studyServiceSpy = jasmine.createSpyObj<StudyDetailsService>(\n+      'StudyDetailsService',\n+      {getStudyDetails: of(expectedStudiesDetails)},\n+    );\n+    await TestBed.configureTestingModule({\n+      declarations: [StudyDetailsComponent],\n+      imports: [\n+        ModalModule.forRoot(),\n+        RouterTestingModule,\n+        StudiesModule,\n+        BrowserAnimationsModule,\n+        HttpClientModule,\n+        ToastrModule.forRoot({\n+          positionClass: 'toast-top-center',\n+          preventDuplicates: true,\n+          enableHtml: true,\n+        }),\n+      ],\n+      providers: [\n+        EntityService,\n+        BsModalRef,\n+        {provide: StudyDetailsService, useValue: studyServiceSpy},\n+      ],\n+    })\n+      .compileComponents()\n+      .then(() => {\n+        fixture = TestBed.createComponent(StudyDetailsComponent);\n+        component = fixture.componentInstance;\n+        studyServiceSpy.getStudyDetails.and.returnValues(\n+          of(expectedStudiesDetails),\n+        );\n+      });\n+  }));\n+\n+  it('should create', () => {\n+    expect(component).toBeTruthy();\n+  });\n+\n+  it('should NOT have study`s participant list before ngOnInit', () => {\n+    component.studyDetail$.pipe().subscribe((studyDetail: StudyDetails) => {\n+      expect(\n+        studyDetail.participantRegistryDetail.registryParticipants.length,\n+      ).toBe(0, 'should NOT have study`s participant list before ngOnInit');\n+    });\n+  });\n+\n+  describe('after get studies', () => {\n+    beforeEach(async(() => {\n+      fixture.detectChanges();\n+      void fixture.whenStable().then(() => {\n+        fixture.detectChanges();\n+      });\n+    }));\n+\n+    it('should get the list of study participants via refresh function', fakeAsync(() => {\n+      component.studyDetail$.subscribe((studyDetail) => {\n+        studyDetail;\n+        expect(\n+          studyDetail.participantRegistryDetail.registryParticipants.length,\n+        ).toEqual(\n+          expectedStudiesDetails.participantRegistryDetail.registryParticipants\n+            .length,\n+        );\n+      });\n+    }));\n+\n+    it('should check the participant list received and the appId and studyId should match', () => {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "37f620632c3c7a821afa11618befa0c5918e52f4"}, "originalPosition": 92}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f10fdaa6fba263852e84d7210d4ec98bd3e92169", "author": {"user": {"login": "firdosebtc1", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/f10fdaa6fba263852e84d7210d4ec98bd3e92169", "committedDate": "2020-08-18T11:31:32Z", "message": "code review comments has been resolved"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1ea121c46b1bebd423cf78b5864f79d9cb71a0a0", "author": {"user": {"login": "firdosebtc1", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/1ea121c46b1bebd423cf78b5864f79d9cb71a0a0", "committedDate": "2020-08-18T11:33:39Z", "message": "Merge branch 'Participant-manager-wenapp-study-participant' of https://github.com/GoogleCloudPlatform/fda-mystudies into Participant-manager-wenapp-study-participant"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY5NDQzNTY2", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/745#pullrequestreview-469443566", "createdAt": "2020-08-18T13:16:08Z", "commit": {"oid": "1ea121c46b1bebd423cf78b5864f79d9cb71a0a0"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 646, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}