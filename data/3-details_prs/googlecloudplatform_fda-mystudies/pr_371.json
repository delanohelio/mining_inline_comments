{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE1ODEyNTgw", "number": 371, "title": "Call URS from StudyMetaData server for userResources. ", "bodyText": "For now it just prints out the response. I'll update it once the real response is ready.", "createdAt": "2020-05-11T01:06:03Z", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/371", "merged": true, "mergeCommit": {"oid": "0d77ab9ca97358680f334002eba846f38e1f0c75"}, "closed": true, "closedAt": "2020-05-11T16:56:10Z", "author": {"login": "kuoyuchi"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcgEm-ZgH2gAyNDE1ODEyNTgwOjkxYzdlMmFjOTUxZmE2Y2EyZGY2MWRlZmIzMmE1ODZkZTUyZGQ0Y2I=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcgSiSWAH2gAyNDE1ODEyNTgwOmNkNDdhMjQ3ODY3YWRjNWFhMjE0YjIwMjlhNDBlNGE0YzA5MzMyZjY=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "91c7e2ac951fa6ca2df61defb32a586de52dd4cb", "author": {"user": {"login": "kuoyuchi", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/91c7e2ac951fa6ca2df61defb32a586de52dd4cb", "committedDate": "2020-05-11T00:33:51Z", "message": "Add call to URS."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d24a57292b7d401c05317dd72edb0ab462f0534c", "author": {"user": {"login": "kuoyuchi", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/d24a57292b7d401c05317dd72edb0ab462f0534c", "committedDate": "2020-05-11T01:07:23Z", "message": "Add comments."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b23d4efd0921fecb29f4edbcfde435b8efc62faf", "author": {"user": {"login": "kuoyuchi", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/b23d4efd0921fecb29f4edbcfde435b8efc62faf", "committedDate": "2020-05-11T01:08:19Z", "message": "Remove log."}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA4ODE2MTQ4", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/371#pullrequestreview-408816148", "createdAt": "2020-05-11T01:48:24Z", "commit": {"oid": "b23d4efd0921fecb29f4edbcfde435b8efc62faf"}, "state": "APPROVED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQwMTo0ODoyNVrOGTJ9tw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xMVQwMTo1MDowM1rOGTJ-8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjczOTM4Mw==", "bodyText": "What actually needs to be done here to convert the user management server response into the study metadata response? The user management server is returning json, so it seems like if the call succeeds the response should just be forwarded as is.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/371#discussion_r422739383", "createdAt": "2020-05-11T01:48:25Z", "author": {"login": "karepker"}, "path": "WCP-WS/src/main/java/com/hphc/mystudies/service/StudyMetaDataService.java", "diffHunk": "@@ -282,11 +285,27 @@ public Object resourcesForStudy(\n   @Consumes(MediaType.APPLICATION_JSON)\n   @Path(\"userResources\")\n   public Object getUserResources(\n+      @HeaderParam(\"userId\") String userId,\n+      @HeaderParam(\"clientToken\") String clientToken,\n+      @HeaderParam(\"accessToken\") String accessToken,\n       @QueryParam(\"studyId\") String studyId,\n       @Context ServletContext context,\n       @Context HttpServletResponse response) {\n-    // TODO: this endpoint should first try to get personalized user resource before falling back to\n-    // generic resources for this study.\n+    Client client = Client.create();\n+    WebResource webResource = client.resource(propMap.get(\"userRegistrationServerPersonalizedResourcesUrl\"));\n+    ClientResponse ursResponse = webResource\n+        .queryParam(\"studyId\", studyId)\n+        .header(\"userId\", userId)\n+        .header(\"clientToken\", clientToken)\n+        .header(\"accessToken\", accessToken)\n+        .get(ClientResponse.class);\n+\t\tif (ursResponse.getStatus() != 200) {\n+\t\t  LOGGER.error(\"Failed : HTTP error code : \" + ursResponse.getStatus());\n+      // Fall back to generic resources for this user.\n+      return resourcesForStudyImpl(studyId, context, response);\n+\t\t}\n+    // TODO: Actually convert ursResponse to the response of this REST call.\n+\t\tString ursOutput = ursResponse.getEntity(String.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b23d4efd0921fecb29f4edbcfde435b8efc62faf"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjczOTY5Nw==", "bodyText": "nit: Indentation seems a little weird here. As far as I can tell, the coding style appears to be two spaces for a tab (this is what Google's Java formatter does so if you have the settings for that it should work).", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/371#discussion_r422739697", "createdAt": "2020-05-11T01:50:03Z", "author": {"login": "karepker"}, "path": "WCP-WS/src/main/java/com/hphc/mystudies/service/StudyMetaDataService.java", "diffHunk": "@@ -282,11 +285,27 @@ public Object resourcesForStudy(\n   @Consumes(MediaType.APPLICATION_JSON)\n   @Path(\"userResources\")\n   public Object getUserResources(\n+      @HeaderParam(\"userId\") String userId,\n+      @HeaderParam(\"clientToken\") String clientToken,\n+      @HeaderParam(\"accessToken\") String accessToken,\n       @QueryParam(\"studyId\") String studyId,\n       @Context ServletContext context,\n       @Context HttpServletResponse response) {\n-    // TODO: this endpoint should first try to get personalized user resource before falling back to\n-    // generic resources for this study.\n+    Client client = Client.create();\n+    WebResource webResource = client.resource(propMap.get(\"userRegistrationServerPersonalizedResourcesUrl\"));\n+    ClientResponse ursResponse = webResource\n+        .queryParam(\"studyId\", studyId)\n+        .header(\"userId\", userId)\n+        .header(\"clientToken\", clientToken)\n+        .header(\"accessToken\", accessToken)\n+        .get(ClientResponse.class);\n+\t\tif (ursResponse.getStatus() != 200) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b23d4efd0921fecb29f4edbcfde435b8efc62faf"}, "originalPosition": 30}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c48ff5d44cf629a2b11ae77ec4f3bca2ec0e00ab", "author": {"user": {"login": "kuoyuchi", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/c48ff5d44cf629a2b11ae77ec4f3bca2ec0e00ab", "committedDate": "2020-05-11T03:54:05Z", "message": "Change spaces to tabs."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fce27b2394ea9e1dceff590dc79a067a3cd11707", "author": {"user": {"login": "kuoyuchi", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/fce27b2394ea9e1dceff590dc79a067a3cd11707", "committedDate": "2020-05-11T03:56:32Z", "message": "Update indent."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c8a57f07ab26ed87d26572a82a4b7cca00be8e9c", "author": {"user": {"login": "kuoyuchi", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/c8a57f07ab26ed87d26572a82a4b7cca00be8e9c", "committedDate": "2020-05-11T03:57:51Z", "message": "Update comment."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9d47ae0c63a80d0a161abac5b83babe5c740e168", "author": {"user": {"login": "kuoyuchi", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/9d47ae0c63a80d0a161abac5b83babe5c740e168", "committedDate": "2020-05-11T03:59:17Z", "message": "Merge branch 'early-access' into study-meta-data-urs-call"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5MjE0ODQw", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/371#pullrequestreview-409214840", "createdAt": "2020-05-11T14:16:41Z", "commit": {"oid": "9d47ae0c63a80d0a161abac5b83babe5c740e168"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cd47a247867adc5aa214b2029a40e4a4c09332f6", "author": {"user": {"login": "kuoyuchi", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/cd47a247867adc5aa214b2029a40e4a4c09332f6", "committedDate": "2020-05-11T16:47:24Z", "message": "Merge branch 'early-access' into study-meta-data-urs-call"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1031, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}