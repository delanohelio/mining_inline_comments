{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDYwMjM2NjQy", "number": 713, "title": "Data integrity checks for entities", "bodyText": "This PR contains below list of changes.\n\nImplemented data integrity checks as per the ticket #707\nMoved all the entity classes to common service", "createdAt": "2020-07-31T15:14:02Z", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713", "merged": true, "mergeCommit": {"oid": "71d23ad3e33b4f89854bb5eb92a4649f9b43cc49"}, "closed": true, "closedAt": "2020-08-20T12:23:45Z", "author": {"login": "aswinijena100"}, "timelineItems": {"totalCount": 32, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABc6VaxIAH2gAyNDYwMjM2NjQyOmY4MDVmNjBjZmJiM2JmMDg2YzQ4ZDZhOTFhYzI1NzI5NjU3MWFmYTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdAvPzVAFqTQ3MTUzODQ2Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f805f60cfbb3bf086c48d6a91ac257296571afa7", "author": {"user": {"login": "aswinijena100", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/f805f60cfbb3bf086c48d6a91ac257296571afa7", "committedDate": "2020-07-31T14:50:56Z", "message": "data integrity checks for all the entity classes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec1c42537c2ae6e9cd789ab7a45ba10c5891dac9", "author": {"user": {"login": "aswinijena100", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/ec1c42537c2ae6e9cd789ab7a45ba10c5891dac9", "committedDate": "2020-07-31T15:10:29Z", "message": "modified with string comparison"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU5MjY3NDI4", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#pullrequestreview-459267428", "createdAt": "2020-07-31T15:32:35Z", "commit": {"oid": "ec1c42537c2ae6e9cd789ab7a45ba10c5891dac9"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 18, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQxNTozMjozNVrOG6M1QA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQxNzo0NDowOFrOG6QvxA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzY4MDgzMg==", "bodyText": "please remove these line breaks. Import statements should be added in only two blocks, one for static and one for non static imports. Please refer to the style guide for more detail.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#discussion_r463680832", "createdAt": "2020-07-31T15:32:35Z", "author": {"login": "zohrehj"}, "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/model/AppEntity.java", "diffHunk": "@@ -12,6 +12,7 @@\n import java.sql.Timestamp;\n import java.util.ArrayList;\n import java.util.List;\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec1c42537c2ae6e9cd789ab7a45ba10c5891dac9"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzY4MTE4OQ==", "bodyText": "doesn't look in scope, also not why we should ignore the case here?\nIgnoring the code significantly reduces the complexity of the code and makes it much easier to brute force.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#discussion_r463681189", "createdAt": "2020-07-31T15:33:15Z", "author": {"login": "zohrehj"}, "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/common/OnboardingStatus.java", "diffHunk": "@@ -28,7 +28,7 @@ private OnboardingStatus(String code, String status) {\n \n   public static OnboardingStatus fromCode(String code) {\n     for (OnboardingStatus e : OnboardingStatus.values()) {\n-      if (e.code == code) {\n+      if (e.code.equalsIgnoreCase(code)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec1c42537c2ae6e9cd789ab7a45ba10c5891dac9"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzY4MjE1MQ==", "bodyText": "I am fairly sure that study builder UI limits this to 15 characters.\nPlease make sure these conditions are exactly the same.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#discussion_r463682151", "createdAt": "2020-07-31T15:34:58Z", "author": {"login": "zohrehj"}, "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/model/AppEntity.java", "diffHunk": "@@ -44,18 +50,27 @@\n   @Id\n   @GeneratedValue(generator = \"system-uuid\")\n   @GenericGenerator(name = \"system-uuid\", strategy = \"uuid\")\n-  @Column(name = \"app_info_id\", updatable = false, nullable = false)\n+  @Column(\n+      name = \"app_info_id\",\n+      updatable = false,\n+      nullable = false,\n+      length = ColumnConstraints.ID_LENGTH)\n   private String id;\n \n   @ToString.Exclude\n-  @Column(name = \"custom_app_id\")\n+  @Column(\n+      name = \"custom_app_id\",\n+      nullable = false,\n+      unique = true,\n+      length = ColumnConstraints.XS_LENGTH)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec1c42537c2ae6e9cd789ab7a45ba10c5891dac9"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzY4MzAwMw==", "bodyText": "No need to add a length constraint for autogenerated values. Let's go with the default.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#discussion_r463683003", "createdAt": "2020-07-31T15:36:26Z", "author": {"login": "zohrehj"}, "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/model/AppEntity.java", "diffHunk": "@@ -44,18 +50,27 @@\n   @Id\n   @GeneratedValue(generator = \"system-uuid\")\n   @GenericGenerator(name = \"system-uuid\", strategy = \"uuid\")\n-  @Column(name = \"app_info_id\", updatable = false, nullable = false)\n+  @Column(\n+      name = \"app_info_id\",\n+      updatable = false,\n+      nullable = false,\n+      length = ColumnConstraints.ID_LENGTH)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec1c42537c2ae6e9cd789ab7a45ba10c5891dac9"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzcwODkwNQ==", "bodyText": "this column should not be null, we need to start pulling this value for the branding text so makes sense to ensure its not empty.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#discussion_r463708905", "createdAt": "2020-07-31T16:26:39Z", "author": {"login": "zohrehj"}, "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/model/AppEntity.java", "diffHunk": "@@ -44,18 +50,27 @@\n   @Id\n   @GeneratedValue(generator = \"system-uuid\")\n   @GenericGenerator(name = \"system-uuid\", strategy = \"uuid\")\n-  @Column(name = \"app_info_id\", updatable = false, nullable = false)\n+  @Column(\n+      name = \"app_info_id\",\n+      updatable = false,\n+      nullable = false,\n+      length = ColumnConstraints.ID_LENGTH)\n   private String id;\n \n   @ToString.Exclude\n-  @Column(name = \"custom_app_id\")\n+  @Column(\n+      name = \"custom_app_id\",\n+      nullable = false,\n+      unique = true,\n+      length = ColumnConstraints.XS_LENGTH)\n   private String appId;\n \n   @ToString.Exclude\n-  @Column(name = \"app_name\")\n+  @Column(name = \"app_name\", length = ColumnConstraints.SMALL_LENGTH)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec1c42537c2ae6e9cd789ab7a45ba10c5891dac9"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzcxMTk0Nw==", "bodyText": "feel free to remove all org related information for now", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#discussion_r463711947", "createdAt": "2020-07-31T16:32:58Z", "author": {"login": "zohrehj"}, "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/model/AppEntity.java", "diffHunk": "@@ -64,61 +79,64 @@\n   private OrgInfoEntity orgInfo;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec1c42537c2ae6e9cd789ab7a45ba10c5891dac9"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzcxNDE2Mg==", "bodyText": "I had assumed this would be foreign key to a user table etc\nWhat is expected to be stored here that requires large amount of space?", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#discussion_r463714162", "createdAt": "2020-07-31T16:37:41Z", "author": {"login": "zohrehj"}, "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/model/AppEntity.java", "diffHunk": "@@ -64,61 +79,64 @@\n   private OrgInfoEntity orgInfo;\n \n   @ToString.Exclude\n-  @Column(name = \"ios_bundle_id\")\n+  @Column(name = \"ios_bundle_id\", length = ColumnConstraints.SMALL_LENGTH)\n   private String iosBundleId;\n \n   @ToString.Exclude\n-  @Column(name = \"android_bundle_id\")\n+  @Column(name = \"android_bundle_id\", length = ColumnConstraints.SMALL_LENGTH)\n   private String androidBundleId;\n \n   @ToString.Exclude\n   @Column(name = \"ios_certificate\")\n+  @Type(type = \"text\")\n   private String iosCertificate;\n \n   @ToString.Exclude\n-  @Column(name = \"ios_certificate_password\")\n+  @Column(name = \"ios_certificate_password\", length = ColumnConstraints.SMALL_LENGTH)\n   private String iosCertificatePassword;\n \n   @ToString.Exclude\n-  @Column(name = \"android_server_key\")\n+  @Column(name = \"android_server_key\", length = ColumnConstraints.LARGE_LENGTH)\n   private String androidServerKey;\n \n   @ToString.Exclude\n-  @Column(name = \"from_email_id\")\n+  @Column(name = \"from_email_id\", length = ColumnConstraints.LARGE_LENGTH)\n   private String formEmailId;\n \n   @ToString.Exclude\n-  @Column(name = \"from_email_password\")\n+  @Column(name = \"from_email_password\", length = ColumnConstraints.LARGE_LENGTH)\n   private String fromEmailPassword;\n \n   @ToString.Exclude\n-  @Column(name = \"reg_email_sub\")\n+  @Column(name = \"reg_email_sub\", length = ColumnConstraints.LARGE_LENGTH)\n   private String regEmailSub;\n \n   @ToString.Exclude\n   @Column(name = \"reg_email_body\")\n+  @Type(type = \"text\")\n   private String regEmailBody;\n \n   @ToString.Exclude\n-  @Column(name = \"forgot_email_sub\")\n+  @Column(name = \"forgot_email_sub\", length = ColumnConstraints.LARGE_LENGTH)\n   private String forgotEmailSub;\n \n   @Column(name = \"forgot_email_body\")\n+  @Type(type = \"text\")\n   private String forgotEmailBody;\n \n-  @Column(name = \"method_handler\")\n+  @Column(name = \"method_handler\", length = ColumnConstraints.TINY_LENGTH)\n   private Integer methodHandler;\n \n-  @Column(name = \"created_by\")\n+  @Column(name = \"created_by\", length = ColumnConstraints.LARGE_LENGTH)\n   private String createdBy;\n \n-  @Column(name = \"modified_by\")\n+  @Column(name = \"modified_by\", length = ColumnConstraints.LARGE_LENGTH)\n   private String modifiedBy;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec1c42537c2ae6e9cd789ab7a45ba10c5891dac9"}, "originalPosition": 120}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzcxNTg4OQ==", "bodyText": "Should probably use @UpdateTimestamp instead of manually updating this", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#discussion_r463715889", "createdAt": "2020-07-31T16:41:24Z", "author": {"login": "zohrehj"}, "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/model/AppEntity.java", "diffHunk": "@@ -64,61 +79,64 @@\n   private OrgInfoEntity orgInfo;\n \n   @ToString.Exclude\n-  @Column(name = \"ios_bundle_id\")\n+  @Column(name = \"ios_bundle_id\", length = ColumnConstraints.SMALL_LENGTH)\n   private String iosBundleId;\n \n   @ToString.Exclude\n-  @Column(name = \"android_bundle_id\")\n+  @Column(name = \"android_bundle_id\", length = ColumnConstraints.SMALL_LENGTH)\n   private String androidBundleId;\n \n   @ToString.Exclude\n   @Column(name = \"ios_certificate\")\n+  @Type(type = \"text\")\n   private String iosCertificate;\n \n   @ToString.Exclude\n-  @Column(name = \"ios_certificate_password\")\n+  @Column(name = \"ios_certificate_password\", length = ColumnConstraints.SMALL_LENGTH)\n   private String iosCertificatePassword;\n \n   @ToString.Exclude\n-  @Column(name = \"android_server_key\")\n+  @Column(name = \"android_server_key\", length = ColumnConstraints.LARGE_LENGTH)\n   private String androidServerKey;\n \n   @ToString.Exclude\n-  @Column(name = \"from_email_id\")\n+  @Column(name = \"from_email_id\", length = ColumnConstraints.LARGE_LENGTH)\n   private String formEmailId;\n \n   @ToString.Exclude\n-  @Column(name = \"from_email_password\")\n+  @Column(name = \"from_email_password\", length = ColumnConstraints.LARGE_LENGTH)\n   private String fromEmailPassword;\n \n   @ToString.Exclude\n-  @Column(name = \"reg_email_sub\")\n+  @Column(name = \"reg_email_sub\", length = ColumnConstraints.LARGE_LENGTH)\n   private String regEmailSub;\n \n   @ToString.Exclude\n   @Column(name = \"reg_email_body\")\n+  @Type(type = \"text\")\n   private String regEmailBody;\n \n   @ToString.Exclude\n-  @Column(name = \"forgot_email_sub\")\n+  @Column(name = \"forgot_email_sub\", length = ColumnConstraints.LARGE_LENGTH)\n   private String forgotEmailSub;\n \n   @Column(name = \"forgot_email_body\")\n+  @Type(type = \"text\")\n   private String forgotEmailBody;\n \n-  @Column(name = \"method_handler\")\n+  @Column(name = \"method_handler\", length = ColumnConstraints.TINY_LENGTH)\n   private Integer methodHandler;\n \n-  @Column(name = \"created_by\")\n+  @Column(name = \"created_by\", length = ColumnConstraints.LARGE_LENGTH)\n   private String createdBy;\n \n-  @Column(name = \"modified_by\")\n+  @Column(name = \"modified_by\", length = ColumnConstraints.LARGE_LENGTH)\n   private String modifiedBy;\n \n   @Column(\n       name = \"modified_date\",\n       insertable = false,\n-      updatable = false,\n+      updatable = true,\n       columnDefinition = \"TIMESTAMP DEFAULT CURRENT_TIMESTAMP\")\n   private Timestamp modified;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec1c42537c2ae6e9cd789ab7a45ba10c5891dac9"}, "originalPosition": 128}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzcyMDk4Mw==", "bodyText": "why change this?\nAlso you can probably use @CreateTimestamp annotation here", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#discussion_r463720983", "createdAt": "2020-07-31T16:52:26Z", "author": {"login": "zohrehj"}, "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/model/AppPermissionEntity.java", "diffHunk": "@@ -56,12 +61,12 @@\n   private Integer edit;\n \n   @Column(\n-      name = \"created\",\n+      name = \"created_on\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec1c42537c2ae6e9cd789ab7a45ba10c5891dac9"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzcyMzgyNQ==", "bodyText": "please remove orgId", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#discussion_r463723825", "createdAt": "2020-07-31T16:58:31Z", "author": {"login": "zohrehj"}, "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/model/OrgInfoEntity.java", "diffHunk": "@@ -45,13 +47,17 @@\n   @Id\n   @GeneratedValue(generator = \"system-uuid\")\n   @GenericGenerator(name = \"system-uuid\", strategy = \"uuid\")\n-  @Column(name = \"id\", updatable = false, nullable = false)\n+  @Column(\n+      name = \"org_info_id\",\n+      updatable = false,\n+      nullable = false,\n+      length = ColumnConstraints.ID_LENGTH)\n   private String id;\n \n-  @Column(name = \"name\")\n+  @Column(name = \"name\", length = ColumnConstraints.SMALL_LENGTH)\n   private String name;\n \n-  @Column(name = \"org_id\")\n+  @Column(name = \"org_id\", nullable = false, unique = true, length = ColumnConstraints.XS_LENGTH)\n   private String orgId;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec1c42537c2ae6e9cd789ab7a45ba10c5891dac9"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzcyNjc5MQ==", "bodyText": "I think the length of enrollment token in the code is significantly smaller.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#discussion_r463726791", "createdAt": "2020-07-31T17:04:39Z", "author": {"login": "zohrehj"}, "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/model/ParticipantRegistrySiteEntity.java", "diffHunk": "@@ -90,22 +99,32 @@\n   private Timestamp enrollmentTokenExpiry;\n \n   @ToString.Exclude\n-  @Column(name = \"onboarding_status\")\n+  @Column(name = \"onboarding_status\", length = ColumnConstraints.TINY_LENGTH)\n   private String onboardingStatus;\n \n-  @Column(name = \"enrollment_token\")\n+  @Column(name = \"enrollment_token\", unique = true, length = ColumnConstraints.SMALL_LENGTH)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec1c42537c2ae6e9cd789ab7a45ba10c5891dac9"}, "originalPosition": 61}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzcyNzYyMQ==", "bodyText": "I was under the impression that participant_id would be unique across entire table.\nThis constraint means that you could have the same participant registered under more than one site. Is that what we want?", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#discussion_r463727621", "createdAt": "2020-07-31T17:06:25Z", "author": {"login": "zohrehj"}, "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/model/ParticipantStudyEntity.java", "diffHunk": "@@ -36,7 +40,13 @@\n @Setter\n @Getter\n @Entity\n-@Table(name = \"participant_study_info\")\n+@Table(\n+    name = \"participant_study_info\",\n+    uniqueConstraints = {\n+      @UniqueConstraint(\n+          columnNames = {\"participant_id\", \"site_id\"},", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec1c42537c2ae6e9cd789ab7a45ba10c5891dac9"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzczMTM3MA==", "bodyText": "what is an example of the content of sharing column?\nI know we had a boolean field to enable sharing of data for each participant, this is however a text column; please explain what this is used for.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#discussion_r463731370", "createdAt": "2020-07-31T17:14:43Z", "author": {"login": "zohrehj"}, "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/model/ParticipantStudyEntity.java", "diffHunk": "@@ -87,6 +97,7 @@\n   private Timestamp enrolledDate;\n \n   @Column(name = \"sharing\")\n+  @Type(type = \"text\")\n   private String sharing;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec1c42537c2ae6e9cd789ab7a45ba10c5891dac9"}, "originalPosition": 61}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzczMjk1MQ==", "bodyText": "why not use @UpdateTimestamp?", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#discussion_r463732951", "createdAt": "2020-07-31T17:18:11Z", "author": {"login": "zohrehj"}, "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/model/SiteEntity.java", "diffHunk": "@@ -63,27 +72,27 @@\n   @Column(name = \"target_enrollment\")\n   private Integer targetEnrollment;\n \n-  @Column(name = \"name\")\n+  @Column(name = \"name\", length = ColumnConstraints.SMALL_LENGTH)\n   private String name;\n \n   @Column(\n-      name = \"created\",\n+      name = \"created_on\",\n       insertable = false,\n       updatable = false,\n       columnDefinition = \"TIMESTAMP DEFAULT CURRENT_TIMESTAMP\")\n   private Timestamp created;\n \n-  @Column(name = \"created_by\")\n+  @Column(name = \"created_by\", length = ColumnConstraints.LARGE_LENGTH)\n   private String createdBy;\n \n   @Column(", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec1c42537c2ae6e9cd789ab7a45ba10c5891dac9"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzc0MjI2Nw==", "bodyText": "how about using this pattern for naming this unique constraints:\n${table_name}__#{columns names joined via \"_\"}_uidx\ne.g.\nparticipant_registry_site__email_study_info_id_uidx ?\nPlease rename other instances using the same pattern.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#discussion_r463742267", "createdAt": "2020-07-31T17:38:19Z", "author": {"login": "zohrehj"}, "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/model/ParticipantRegistrySiteEntity.java", "diffHunk": "@@ -38,15 +41,21 @@\n @Setter\n @Getter\n @Entity\n-@Table(name = \"participant_registry_site\")\n+@Table(\n+    name = \"participant_registry_site\",\n+    uniqueConstraints = {\n+      @UniqueConstraint(\n+          columnNames = {\"email\", \"study_info_id\"},\n+          name = \"uk_participant_registry_site_email_study\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec1c42537c2ae6e9cd789ab7a45ba10c5891dac9"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzc0MzI0MQ==", "bodyText": "what happens if this flag is false here?\nWould the table not be rendered?", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#discussion_r463743241", "createdAt": "2020-07-31T17:40:23Z", "author": {"login": "zohrehj"}, "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/model/StudyConsentEntity.java", "diffHunk": "@@ -21,20 +21,23 @@\n import javax.persistence.Table;\n \n import org.hibernate.annotations.GenericGenerator;\n+import org.hibernate.annotations.Type;\n import org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;\n \n+import com.google.cloud.healthcare.fdamystudies.common.ColumnConstraints;\n+\n import lombok.Getter;\n import lombok.Setter;\n import lombok.ToString;\n \n-@ConditionalOnProperty(\n-    value = \"participant.manager.entities.enabled\",\n-    havingValue = \"true\",\n-    matchIfMissing = false)\n @Setter\n @Getter\n @Entity\n @Table(name = \"study_consent\")\n+@ConditionalOnProperty(\n+    value = \"participant.manager.entities.enabled\",\n+    havingValue = \"true\",\n+    matchIfMissing = false)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec1c42537c2ae6e9cd789ab7a45ba10c5891dac9"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzc0NDU3Ng==", "bodyText": "user details table has a user_id in addition to the default Id.  what is user_id used for?", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#discussion_r463744576", "createdAt": "2020-07-31T17:43:17Z", "author": {"login": "zohrehj"}, "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/model/UserDetailsEntity.java", "diffHunk": "@@ -113,39 +112,53 @@\n   private Timestamp verificationDate;\n \n   @Column(\n-      name = \"temp_password_date\",\n+      name = \"code_expire_date\",\n       insertable = false,\n       updatable = false,\n       columnDefinition = \"TIMESTAMP DEFAULT CURRENT_TIMESTAMP\")\n-  private Timestamp tempPasswordDate;\n+  private Timestamp codeExpireDate;\n \n-  @Column(\n-      name = \"password_updated_date\",\n-      insertable = false,\n-      updatable = false,\n-      columnDefinition = \"TIMESTAMP DEFAULT CURRENT_TIMESTAMP\")\n-  private Timestamp passwordUpdatedDate;\n-\n-  @Column(name = \"reminder_lead_time\")\n+  @Column(name = \"reminder_lead_time\", length = ColumnConstraints.SMALL_LENGTH)\n   private String reminderLeadTime;\n \n   @ToString.Exclude\n-  @Column(name = \"security_token\")\n+  @Column(name = \"security_token\", length = ColumnConstraints.MEDIUM_LENGTH)\n   private String securityToken;\n \n   @ToString.Exclude\n-  @Column(name = \"email_code\")\n+  @Column(name = \"email_code\", length = ColumnConstraints.XS_LENGTH)\n   private String emailCode;\n \n   @ToString.Exclude\n-  @Column(name = \"user_id\")\n+  @Column(name = \"user_id\", length = ColumnConstraints.SMALL_LENGTH)\n   private String userId;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec1c42537c2ae6e9cd789ab7a45ba10c5891dac9"}, "originalPosition": 123}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzc0NDk2NA==", "bodyText": "this change seems like it should have a corresponding code change", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#discussion_r463744964", "createdAt": "2020-07-31T17:44:08Z", "author": {"login": "zohrehj"}, "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/model/UserDetailsEntity.java", "diffHunk": "@@ -113,39 +112,53 @@\n   private Timestamp verificationDate;\n \n   @Column(\n-      name = \"temp_password_date\",\n+      name = \"code_expire_date\",\n       insertable = false,\n       updatable = false,\n       columnDefinition = \"TIMESTAMP DEFAULT CURRENT_TIMESTAMP\")\n-  private Timestamp tempPasswordDate;\n+  private Timestamp codeExpireDate;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec1c42537c2ae6e9cd789ab7a45ba10c5891dac9"}, "originalPosition": 97}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU5MjgzNzQ1", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#pullrequestreview-459283745", "createdAt": "2020-07-31T15:56:10Z", "commit": {"oid": "ec1c42537c2ae6e9cd789ab7a45ba10c5891dac9"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 20, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQxNTo1NjoxMFrOG6NnwA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMVQxODo1NDo1OVrOG6SuHQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzY5Mzc2MA==", "bodyText": "Can we create a new attribute that combines all of these attributes?", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#discussion_r463693760", "createdAt": "2020-07-31T15:56:10Z", "author": {"login": "nikklassen"}, "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/model/AppEntity.java", "diffHunk": "@@ -44,18 +50,27 @@\n   @Id\n   @GeneratedValue(generator = \"system-uuid\")\n   @GenericGenerator(name = \"system-uuid\", strategy = \"uuid\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec1c42537c2ae6e9cd789ab7a45ba10c5891dac9"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzY5NDMzMg==", "bodyText": "This is the default so I'd just remove it", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#discussion_r463694332", "createdAt": "2020-07-31T15:57:13Z", "author": {"login": "nikklassen"}, "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/model/AppEntity.java", "diffHunk": "@@ -64,61 +79,64 @@\n   private OrgInfoEntity orgInfo;\n \n   @ToString.Exclude\n-  @Column(name = \"ios_bundle_id\")\n+  @Column(name = \"ios_bundle_id\", length = ColumnConstraints.SMALL_LENGTH)\n   private String iosBundleId;\n \n   @ToString.Exclude\n-  @Column(name = \"android_bundle_id\")\n+  @Column(name = \"android_bundle_id\", length = ColumnConstraints.SMALL_LENGTH)\n   private String androidBundleId;\n \n   @ToString.Exclude\n   @Column(name = \"ios_certificate\")\n+  @Type(type = \"text\")\n   private String iosCertificate;\n \n   @ToString.Exclude\n-  @Column(name = \"ios_certificate_password\")\n+  @Column(name = \"ios_certificate_password\", length = ColumnConstraints.SMALL_LENGTH)\n   private String iosCertificatePassword;\n \n   @ToString.Exclude\n-  @Column(name = \"android_server_key\")\n+  @Column(name = \"android_server_key\", length = ColumnConstraints.LARGE_LENGTH)\n   private String androidServerKey;\n \n   @ToString.Exclude\n-  @Column(name = \"from_email_id\")\n+  @Column(name = \"from_email_id\", length = ColumnConstraints.LARGE_LENGTH)\n   private String formEmailId;\n \n   @ToString.Exclude\n-  @Column(name = \"from_email_password\")\n+  @Column(name = \"from_email_password\", length = ColumnConstraints.LARGE_LENGTH)\n   private String fromEmailPassword;\n \n   @ToString.Exclude\n-  @Column(name = \"reg_email_sub\")\n+  @Column(name = \"reg_email_sub\", length = ColumnConstraints.LARGE_LENGTH)\n   private String regEmailSub;\n \n   @ToString.Exclude\n   @Column(name = \"reg_email_body\")\n+  @Type(type = \"text\")\n   private String regEmailBody;\n \n   @ToString.Exclude\n-  @Column(name = \"forgot_email_sub\")\n+  @Column(name = \"forgot_email_sub\", length = ColumnConstraints.LARGE_LENGTH)\n   private String forgotEmailSub;\n \n   @Column(name = \"forgot_email_body\")\n+  @Type(type = \"text\")\n   private String forgotEmailBody;\n \n-  @Column(name = \"method_handler\")\n+  @Column(name = \"method_handler\", length = ColumnConstraints.TINY_LENGTH)\n   private Integer methodHandler;\n \n-  @Column(name = \"created_by\")\n+  @Column(name = \"created_by\", length = ColumnConstraints.LARGE_LENGTH)\n   private String createdBy;\n \n-  @Column(name = \"modified_by\")\n+  @Column(name = \"modified_by\", length = ColumnConstraints.LARGE_LENGTH)\n   private String modifiedBy;\n \n   @Column(\n       name = \"modified_date\",\n       insertable = false,\n-      updatable = false,\n+      updatable = true,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec1c42537c2ae6e9cd789ab7a45ba10c5891dac9"}, "originalPosition": 126}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzcyODIxNA==", "bodyText": "This is handled by the DB, so unless you need the back reference right away this probably isn't necessary.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#discussion_r463728214", "createdAt": "2020-07-31T17:07:43Z", "author": {"login": "nikklassen"}, "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/model/AppEntity.java", "diffHunk": "@@ -180,4 +198,20 @@ public void addStudyEntity(StudyEntity study) {\n     studies.add(study);\n     study.setAppInfo(this);\n   }\n+\n+  @OneToMany(cascade = CascadeType.ALL, fetch = FetchType.LAZY, mappedBy = \"appInfo\")\n+  private List<AuthInfoEntity> apps = new ArrayList<>();\n+\n+  public void addAuthInfoEntity(AuthInfoEntity authInfoEntity) {\n+    apps.add(authInfoEntity);\n+    authInfoEntity.setAppInfo(this);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec1c42537c2ae6e9cd789ab7a45ba10c5891dac9"}, "originalPosition": 140}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzcyODc2Mg==", "bodyText": "This class is called AppInfo. Shouldn't this be AppEntity app?", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#discussion_r463728762", "createdAt": "2020-07-31T17:09:05Z", "author": {"login": "nikklassen"}, "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/model/AuthInfoEntity.java", "diffHunk": "@@ -0,0 +1,99 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.model;\n+\n+import java.io.Serializable;\n+import java.sql.Timestamp;\n+\n+import javax.persistence.CascadeType;\n+import javax.persistence.Column;\n+import javax.persistence.Entity;\n+import javax.persistence.GeneratedValue;\n+import javax.persistence.Id;\n+import javax.persistence.JoinColumn;\n+import javax.persistence.ManyToOne;\n+import javax.persistence.Table;\n+\n+import org.hibernate.annotations.GenericGenerator;\n+import org.hibernate.annotations.Type;\n+import org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;\n+\n+import com.google.cloud.healthcare.fdamystudies.common.ColumnConstraints;\n+\n+import lombok.Getter;\n+import lombok.Setter;\n+import lombok.ToString;\n+\n+@Setter\n+@Getter\n+@Entity\n+@Table(name = \"auth_info\")\n+@ConditionalOnProperty(\n+    value = \"participant.datastore.entities.enabled\",\n+    havingValue = \"true\",\n+    matchIfMissing = false)\n+public class AuthInfoEntity implements Serializable {\n+\n+  private static final long serialVersionUID = 4985607753888575491L;\n+\n+  @ToString.Exclude\n+  @Id\n+  @GeneratedValue(generator = \"system-uuid\")\n+  @GenericGenerator(name = \"system-uuid\", strategy = \"uuid\")\n+  @Column(name = \"auth_id\", nullable = false, length = ColumnConstraints.ID_LENGTH)\n+  private Integer authId;\n+\n+  @ManyToOne(cascade = CascadeType.MERGE)\n+  @JoinColumn(name = \"app_info_id\", nullable = false)\n+  private AppEntity appInfo;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec1c42537c2ae6e9cd789ab7a45ba10c5891dac9"}, "originalPosition": 54}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzcyOTU4OA==", "bodyText": "UUIDs are strings", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#discussion_r463729588", "createdAt": "2020-07-31T17:10:46Z", "author": {"login": "nikklassen"}, "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/model/AuthInfoEntity.java", "diffHunk": "@@ -0,0 +1,99 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.model;\n+\n+import java.io.Serializable;\n+import java.sql.Timestamp;\n+\n+import javax.persistence.CascadeType;\n+import javax.persistence.Column;\n+import javax.persistence.Entity;\n+import javax.persistence.GeneratedValue;\n+import javax.persistence.Id;\n+import javax.persistence.JoinColumn;\n+import javax.persistence.ManyToOne;\n+import javax.persistence.Table;\n+\n+import org.hibernate.annotations.GenericGenerator;\n+import org.hibernate.annotations.Type;\n+import org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;\n+\n+import com.google.cloud.healthcare.fdamystudies.common.ColumnConstraints;\n+\n+import lombok.Getter;\n+import lombok.Setter;\n+import lombok.ToString;\n+\n+@Setter\n+@Getter\n+@Entity\n+@Table(name = \"auth_info\")\n+@ConditionalOnProperty(\n+    value = \"participant.datastore.entities.enabled\",\n+    havingValue = \"true\",\n+    matchIfMissing = false)\n+public class AuthInfoEntity implements Serializable {\n+\n+  private static final long serialVersionUID = 4985607753888575491L;\n+\n+  @ToString.Exclude\n+  @Id\n+  @GeneratedValue(generator = \"system-uuid\")\n+  @GenericGenerator(name = \"system-uuid\", strategy = \"uuid\")\n+  @Column(name = \"auth_id\", nullable = false, length = ColumnConstraints.ID_LENGTH)\n+  private Integer authId;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec1c42537c2ae6e9cd789ab7a45ba10c5891dac9"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzczMDg2Ng==", "bodyText": "Why exclude the id? Here and elsewhere", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#discussion_r463730866", "createdAt": "2020-07-31T17:13:36Z", "author": {"login": "nikklassen"}, "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/model/AuthInfoEntity.java", "diffHunk": "@@ -0,0 +1,99 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.model;\n+\n+import java.io.Serializable;\n+import java.sql.Timestamp;\n+\n+import javax.persistence.CascadeType;\n+import javax.persistence.Column;\n+import javax.persistence.Entity;\n+import javax.persistence.GeneratedValue;\n+import javax.persistence.Id;\n+import javax.persistence.JoinColumn;\n+import javax.persistence.ManyToOne;\n+import javax.persistence.Table;\n+\n+import org.hibernate.annotations.GenericGenerator;\n+import org.hibernate.annotations.Type;\n+import org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;\n+\n+import com.google.cloud.healthcare.fdamystudies.common.ColumnConstraints;\n+\n+import lombok.Getter;\n+import lombok.Setter;\n+import lombok.ToString;\n+\n+@Setter\n+@Getter\n+@Entity\n+@Table(name = \"auth_info\")\n+@ConditionalOnProperty(\n+    value = \"participant.datastore.entities.enabled\",\n+    havingValue = \"true\",\n+    matchIfMissing = false)\n+public class AuthInfoEntity implements Serializable {\n+\n+  private static final long serialVersionUID = 4985607753888575491L;\n+\n+  @ToString.Exclude", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec1c42537c2ae6e9cd789ab7a45ba10c5891dac9"}, "originalPosition": 45}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzczMzA0OQ==", "bodyText": "It looks like we are using @CreationTimestamp in PersonalizedUserReportEntity.java. Can this and @UpdateTimestamp be applied everywhere?\nCan we consistent also be consistent in how we name these? It seems like it should be created_on and updated_on, or created_date and updated_date. Personally I like createdTime and updatedTime best because it's a date and time, not just a date, but use whatever you prefer, as long as it's consistent. Final note though, is there any reason we can't just use the automatically generated column names for these? Using created seems fine if that's what the name of this Java field is.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#discussion_r463733049", "createdAt": "2020-07-31T17:18:25Z", "author": {"login": "nikklassen"}, "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/model/AuthInfoEntity.java", "diffHunk": "@@ -0,0 +1,99 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.model;\n+\n+import java.io.Serializable;\n+import java.sql.Timestamp;\n+\n+import javax.persistence.CascadeType;\n+import javax.persistence.Column;\n+import javax.persistence.Entity;\n+import javax.persistence.GeneratedValue;\n+import javax.persistence.Id;\n+import javax.persistence.JoinColumn;\n+import javax.persistence.ManyToOne;\n+import javax.persistence.Table;\n+\n+import org.hibernate.annotations.GenericGenerator;\n+import org.hibernate.annotations.Type;\n+import org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;\n+\n+import com.google.cloud.healthcare.fdamystudies.common.ColumnConstraints;\n+\n+import lombok.Getter;\n+import lombok.Setter;\n+import lombok.ToString;\n+\n+@Setter\n+@Getter\n+@Entity\n+@Table(name = \"auth_info\")\n+@ConditionalOnProperty(\n+    value = \"participant.datastore.entities.enabled\",\n+    havingValue = \"true\",\n+    matchIfMissing = false)\n+public class AuthInfoEntity implements Serializable {\n+\n+  private static final long serialVersionUID = 4985607753888575491L;\n+\n+  @ToString.Exclude\n+  @Id\n+  @GeneratedValue(generator = \"system-uuid\")\n+  @GenericGenerator(name = \"system-uuid\", strategy = \"uuid\")\n+  @Column(name = \"auth_id\", nullable = false, length = ColumnConstraints.ID_LENGTH)\n+  private Integer authId;\n+\n+  @ManyToOne(cascade = CascadeType.MERGE)\n+  @JoinColumn(name = \"app_info_id\", nullable = false)\n+  private AppEntity appInfo;\n+\n+  @ManyToOne(cascade = CascadeType.MERGE)\n+  @JoinColumn(name = \"user_details_id\", nullable = false)\n+  private UserDetailsEntity userDetails;\n+\n+  @Column(name = \"auth_key\", length = ColumnConstraints.SMALL_LENGTH)\n+  private String authKey;\n+\n+  @Column(name = \"device_token\")\n+  @Type(type = \"text\")\n+  private String deviceToken;\n+\n+  @Column(name = \"device_type\", length = ColumnConstraints.SMALL_LENGTH)\n+  private String deviceType;\n+\n+  @Column(name = \"android_app_version\", length = ColumnConstraints.SMALL_LENGTH)\n+  private String androidAppVersion;\n+\n+  @Column(name = \"ios_app_version\", length = ColumnConstraints.SMALL_LENGTH)\n+  private String iosAppVersion;\n+\n+  @Column(\n+      name = \"created_on\",\n+      insertable = false,\n+      updatable = false,\n+      columnDefinition = \"TIMESTAMP DEFAULT CURRENT_TIMESTAMP\")\n+  private Timestamp created;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec1c42537c2ae6e9cd789ab7a45ba10c5891dac9"}, "originalPosition": 81}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzczMzU3MA==", "bodyText": "What is this timestamp for? You've already got created", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#discussion_r463733570", "createdAt": "2020-07-31T17:19:32Z", "author": {"login": "nikklassen"}, "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/model/AuthInfoEntity.java", "diffHunk": "@@ -0,0 +1,99 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.model;\n+\n+import java.io.Serializable;\n+import java.sql.Timestamp;\n+\n+import javax.persistence.CascadeType;\n+import javax.persistence.Column;\n+import javax.persistence.Entity;\n+import javax.persistence.GeneratedValue;\n+import javax.persistence.Id;\n+import javax.persistence.JoinColumn;\n+import javax.persistence.ManyToOne;\n+import javax.persistence.Table;\n+\n+import org.hibernate.annotations.GenericGenerator;\n+import org.hibernate.annotations.Type;\n+import org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;\n+\n+import com.google.cloud.healthcare.fdamystudies.common.ColumnConstraints;\n+\n+import lombok.Getter;\n+import lombok.Setter;\n+import lombok.ToString;\n+\n+@Setter\n+@Getter\n+@Entity\n+@Table(name = \"auth_info\")\n+@ConditionalOnProperty(\n+    value = \"participant.datastore.entities.enabled\",\n+    havingValue = \"true\",\n+    matchIfMissing = false)\n+public class AuthInfoEntity implements Serializable {\n+\n+  private static final long serialVersionUID = 4985607753888575491L;\n+\n+  @ToString.Exclude\n+  @Id\n+  @GeneratedValue(generator = \"system-uuid\")\n+  @GenericGenerator(name = \"system-uuid\", strategy = \"uuid\")\n+  @Column(name = \"auth_id\", nullable = false, length = ColumnConstraints.ID_LENGTH)\n+  private Integer authId;\n+\n+  @ManyToOne(cascade = CascadeType.MERGE)\n+  @JoinColumn(name = \"app_info_id\", nullable = false)\n+  private AppEntity appInfo;\n+\n+  @ManyToOne(cascade = CascadeType.MERGE)\n+  @JoinColumn(name = \"user_details_id\", nullable = false)\n+  private UserDetailsEntity userDetails;\n+\n+  @Column(name = \"auth_key\", length = ColumnConstraints.SMALL_LENGTH)\n+  private String authKey;\n+\n+  @Column(name = \"device_token\")\n+  @Type(type = \"text\")\n+  private String deviceToken;\n+\n+  @Column(name = \"device_type\", length = ColumnConstraints.SMALL_LENGTH)\n+  private String deviceType;\n+\n+  @Column(name = \"android_app_version\", length = ColumnConstraints.SMALL_LENGTH)\n+  private String androidAppVersion;\n+\n+  @Column(name = \"ios_app_version\", length = ColumnConstraints.SMALL_LENGTH)\n+  private String iosAppVersion;\n+\n+  @Column(\n+      name = \"created_on\",\n+      insertable = false,\n+      updatable = false,\n+      columnDefinition = \"TIMESTAMP DEFAULT CURRENT_TIMESTAMP\")\n+  private Timestamp created;\n+\n+  @Column(\n+      name = \"modified_date\",\n+      insertable = false,\n+      updatable = true,\n+      columnDefinition = \"TIMESTAMP DEFAULT CURRENT_TIMESTAMP\")\n+  private Timestamp modified;\n+\n+  @Column(name = \"remote_notification_flag\", length = ColumnConstraints.TINY_LENGTH)\n+  private Boolean remoteNotificationFlag = false;\n+\n+  @Column(\n+      name = \"timestamp\",\n+      insertable = false,\n+      updatable = false,\n+      columnDefinition = \"TIMESTAMP DEFAULT CURRENT_TIMESTAMP\")\n+  private Timestamp timestamp;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec1c42537c2ae6e9cd789ab7a45ba10c5891dac9"}, "originalPosition": 98}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzczMzg3MA==", "bodyText": "modified_on for consistency?", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#discussion_r463733870", "createdAt": "2020-07-31T17:20:07Z", "author": {"login": "nikklassen"}, "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/model/AuditEventEntity.java", "diffHunk": "@@ -48,14 +53,14 @@\n   private long retryCount;\n \n   @Column(\n-      name = \"created\",\n+      name = \"created_on\",\n       insertable = false,\n       updatable = false,\n       columnDefinition = \"TIMESTAMP DEFAULT CURRENT_TIMESTAMP\")\n   private Timestamp created;\n \n   @Column(\n-      name = \"modified\",\n+      name = \"modified_date\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec1c42537c2ae6e9cd789ab7a45ba10c5891dac9"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzczNDU2NA==", "bodyText": "I think we need greater consistency on how booleans are represented. Sometimes they are Integer, sometimes TINYINT, sometimes 'N'.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#discussion_r463734564", "createdAt": "2020-07-31T17:21:44Z", "author": {"login": "nikklassen"}, "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/model/LocationEntity.java", "diffHunk": "@@ -43,35 +50,47 @@\n   @Id\n   @GeneratedValue(generator = \"system-uuid\")\n   @GenericGenerator(name = \"system-uuid\", strategy = \"uuid\")\n-  @Column(name = \"id\", updatable = false, nullable = false)\n+  @Column(name = \"id\", updatable = false, nullable = false, length = ColumnConstraints.ID_LENGTH)\n   private String id;\n \n-  @Column(name = \"custom_id\", length = 200)\n+  @Column(name = \"custom_id\", nullable = false, length = ColumnConstraints.SMALL_LENGTH)\n   private String customId;\n \n-  @Column(name = \"status\", length = 1)\n+  @Column(name = \"status\", length = ColumnConstraints.TINY_LENGTH)\n   private Integer status;\n \n-  @Column(name = \"name\", length = 200)\n+  @Column(name = \"name\", length = ColumnConstraints.LARGE_LENGTH)\n   private String name;\n \n-  @Column(name = \"description\", length = 500)\n+  @Column(name = \"description\")\n+  @Type(type = \"text\")\n   private String description;\n \n-  @Column(name = \"is_default\", length = 1)\n+  @Column(name = \"is_default\", nullable = false, columnDefinition = \"Varchar(1) default 'N'\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec1c42537c2ae6e9cd789ab7a45ba10c5891dac9"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzczNTIzMQ==", "bodyText": "The other data object use \"id\" as the name for their ID. Can this one by changed without too much trouble? Ideally every data object has a primary identifier called \"id\"", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#discussion_r463735231", "createdAt": "2020-07-31T17:23:11Z", "author": {"login": "nikklassen"}, "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/model/AuthInfoEntity.java", "diffHunk": "@@ -0,0 +1,99 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.model;\n+\n+import java.io.Serializable;\n+import java.sql.Timestamp;\n+\n+import javax.persistence.CascadeType;\n+import javax.persistence.Column;\n+import javax.persistence.Entity;\n+import javax.persistence.GeneratedValue;\n+import javax.persistence.Id;\n+import javax.persistence.JoinColumn;\n+import javax.persistence.ManyToOne;\n+import javax.persistence.Table;\n+\n+import org.hibernate.annotations.GenericGenerator;\n+import org.hibernate.annotations.Type;\n+import org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;\n+\n+import com.google.cloud.healthcare.fdamystudies.common.ColumnConstraints;\n+\n+import lombok.Getter;\n+import lombok.Setter;\n+import lombok.ToString;\n+\n+@Setter\n+@Getter\n+@Entity\n+@Table(name = \"auth_info\")\n+@ConditionalOnProperty(\n+    value = \"participant.datastore.entities.enabled\",\n+    havingValue = \"true\",\n+    matchIfMissing = false)\n+public class AuthInfoEntity implements Serializable {\n+\n+  private static final long serialVersionUID = 4985607753888575491L;\n+\n+  @ToString.Exclude\n+  @Id\n+  @GeneratedValue(generator = \"system-uuid\")\n+  @GenericGenerator(name = \"system-uuid\", strategy = \"uuid\")\n+  @Column(name = \"auth_id\", nullable = false, length = ColumnConstraints.ID_LENGTH)\n+  private Integer authId;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec1c42537c2ae6e9cd789ab7a45ba10c5891dac9"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzczNTk4Mg==", "bodyText": "Can these be non-nullable? What is their primary purpose?", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#discussion_r463735982", "createdAt": "2020-07-31T17:24:42Z", "author": {"login": "nikklassen"}, "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/model/LocationEntity.java", "diffHunk": "@@ -43,35 +50,47 @@\n   @Id\n   @GeneratedValue(generator = \"system-uuid\")\n   @GenericGenerator(name = \"system-uuid\", strategy = \"uuid\")\n-  @Column(name = \"id\", updatable = false, nullable = false)\n+  @Column(name = \"id\", updatable = false, nullable = false, length = ColumnConstraints.ID_LENGTH)\n   private String id;\n \n-  @Column(name = \"custom_id\", length = 200)\n+  @Column(name = \"custom_id\", nullable = false, length = ColumnConstraints.SMALL_LENGTH)\n   private String customId;\n \n-  @Column(name = \"status\", length = 1)\n+  @Column(name = \"status\", length = ColumnConstraints.TINY_LENGTH)\n   private Integer status;\n \n-  @Column(name = \"name\", length = 200)\n+  @Column(name = \"name\", length = ColumnConstraints.LARGE_LENGTH)\n   private String name;\n \n-  @Column(name = \"description\", length = 500)\n+  @Column(name = \"description\")\n+  @Type(type = \"text\")\n   private String description;\n \n-  @Column(name = \"is_default\", length = 1)\n+  @Column(name = \"is_default\", nullable = false, columnDefinition = \"Varchar(1) default 'N'\")\n   private String isDefault;\n \n   @Column(\n-      name = \"created\",\n+      name = \"created_on\",\n       insertable = false,\n       updatable = false,\n       columnDefinition = \"TIMESTAMP DEFAULT CURRENT_TIMESTAMP\")\n   private Timestamp created;\n \n   @ToString.Exclude\n-  @Column(name = \"created_by\", length = 64)\n+  @Column(name = \"created_by\", length = ColumnConstraints.LARGE_LENGTH)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec1c42537c2ae6e9cd789ab7a45ba10c5891dac9"}, "originalPosition": 66}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzc3MDY0MA==", "bodyText": "This is the issue I was referring to on Thursday. Looks like we aren't doing this anymore", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#discussion_r463770640", "createdAt": "2020-07-31T18:39:29Z", "author": {"login": "nikklassen"}, "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/model/PersonalizedUserReportEntity.java", "diffHunk": "@@ -0,0 +1,78 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+package com.google.cloud.healthcare.fdamystudies.model;\n+\n+import java.io.Serializable;\n+import java.sql.Timestamp;\n+\n+import javax.persistence.Column;\n+import javax.persistence.Entity;\n+import javax.persistence.GeneratedValue;\n+import javax.persistence.Id;\n+import javax.persistence.JoinColumn;\n+import javax.persistence.ManyToOne;\n+import javax.persistence.Table;\n+\n+import org.hibernate.annotations.CreationTimestamp;\n+import org.hibernate.annotations.GenericGenerator;\n+import org.hibernate.annotations.Type;\n+import org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;\n+\n+import com.google.cloud.healthcare.fdamystudies.common.ColumnConstraints;\n+\n+import lombok.AllArgsConstructor;\n+import lombok.Builder;\n+import lombok.Getter;\n+import lombok.NoArgsConstructor;\n+import lombok.Setter;\n+import lombok.ToString;\n+\n+@AllArgsConstructor\n+@Builder\n+@Setter\n+@Getter\n+@Entity\n+@NoArgsConstructor\n+@Table(name = \"personalized_user_report\")\n+@ConditionalOnProperty(\n+    value = \"participant.datastore.entities.enabled\",\n+    havingValue = \"true\",\n+    matchIfMissing = false)\n+public class PersonalizedUserReportEntity implements Serializable {\n+\n+  private static final long serialVersionUID = -3019529323339411129L;\n+\n+  @ToString.Exclude\n+  @Id\n+  @GeneratedValue(generator = \"system-uuid\")\n+  @GenericGenerator(name = \"system-uuid\", strategy = \"uuid\")\n+  @Column(name = \"id\", updatable = false, nullable = false, length = ColumnConstraints.ID_LENGTH)\n+  private String id;\n+\n+  @ManyToOne\n+  @JoinColumn(name = \"user_id\")\n+  private UserDetailsEntity userDetails;\n+\n+  @ManyToOne\n+  @JoinColumn(name = \"study_info_id\")\n+  private StudyEntity studyInfo;\n+\n+  @Column(name = \"report_title\", length = ColumnConstraints.MEDIUM_LENGTH)\n+  private String reportTitle;\n+\n+  // Length is an arbitrary multiple of 100 > 2^15 and < 2^16 to guarantee we", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec1c42537c2ae6e9cd789ab7a45ba10c5891dac9"}, "originalPosition": 68}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzc3NDIzOQ==", "bodyText": "Mentioned in my comment on the create/update timestamps, can we just remove the name attribute when it matches the property name? I don't think we need to explicitly name every column.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#discussion_r463774239", "createdAt": "2020-07-31T18:47:53Z", "author": {"login": "nikklassen"}, "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/model/StudyEntity.java", "diffHunk": "@@ -84,25 +100,25 @@\n       columnDefinition = \"TIMESTAMP DEFAULT CURRENT_TIMESTAMP\")\n   private Timestamp modified;\n \n-  @Column(name = \"modified_by\")\n+  @Column(name = \"modified_by\", length = ColumnConstraints.LARGE_LENGTH)\n   private String modifiedBy;\n \n   @Column(name = \"version\")\n   private Float version;\n \n-  @Column(name = \"status\")\n+  @Column(name = \"status\", length = ColumnConstraints.XS_LENGTH)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec1c42537c2ae6e9cd789ab7a45ba10c5891dac9"}, "originalPosition": 93}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzc3NDMxNw==", "bodyText": "String?", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#discussion_r463774317", "createdAt": "2020-07-31T18:48:05Z", "author": {"login": "nikklassen"}, "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/model/UserAppDetailsEntity.java", "diffHunk": "@@ -0,0 +1,69 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.model;\n+\n+import java.io.Serializable;\n+import java.sql.Timestamp;\n+\n+import javax.persistence.CascadeType;\n+import javax.persistence.Column;\n+import javax.persistence.Entity;\n+import javax.persistence.GeneratedValue;\n+import javax.persistence.Id;\n+import javax.persistence.JoinColumn;\n+import javax.persistence.ManyToOne;\n+import javax.persistence.Table;\n+\n+import org.hibernate.annotations.GenericGenerator;\n+import org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;\n+\n+import com.google.cloud.healthcare.fdamystudies.common.ColumnConstraints;\n+\n+import lombok.Getter;\n+import lombok.Setter;\n+import lombok.ToString;\n+\n+@Setter\n+@Getter\n+@Entity\n+@Table(name = \"user_app_details\")\n+@ConditionalOnProperty(\n+    value = \"participant.manager.entities.enabled\",\n+    havingValue = \"true\",\n+    matchIfMissing = false)\n+public class UserAppDetailsEntity implements Serializable {\n+\n+  private static final long serialVersionUID = 4985607753888575491L;\n+\n+  @ToString.Exclude\n+  @Id\n+  @GeneratedValue(generator = \"system-uuid\")\n+  @GenericGenerator(name = \"system-uuid\", strategy = \"uuid\")\n+  @Column(\n+      name = \"user_app_details_id\",\n+      updatable = false,\n+      nullable = false,\n+      length = ColumnConstraints.ID_LENGTH)\n+  private Integer userAppDetailsId;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec1c42537c2ae6e9cd789ab7a45ba10c5891dac9"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzc3NDM2Nw==", "bodyText": "app?", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#discussion_r463774367", "createdAt": "2020-07-31T18:48:15Z", "author": {"login": "nikklassen"}, "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/model/UserAppDetailsEntity.java", "diffHunk": "@@ -0,0 +1,69 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.model;\n+\n+import java.io.Serializable;\n+import java.sql.Timestamp;\n+\n+import javax.persistence.CascadeType;\n+import javax.persistence.Column;\n+import javax.persistence.Entity;\n+import javax.persistence.GeneratedValue;\n+import javax.persistence.Id;\n+import javax.persistence.JoinColumn;\n+import javax.persistence.ManyToOne;\n+import javax.persistence.Table;\n+\n+import org.hibernate.annotations.GenericGenerator;\n+import org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;\n+\n+import com.google.cloud.healthcare.fdamystudies.common.ColumnConstraints;\n+\n+import lombok.Getter;\n+import lombok.Setter;\n+import lombok.ToString;\n+\n+@Setter\n+@Getter\n+@Entity\n+@Table(name = \"user_app_details\")\n+@ConditionalOnProperty(\n+    value = \"participant.manager.entities.enabled\",\n+    havingValue = \"true\",\n+    matchIfMissing = false)\n+public class UserAppDetailsEntity implements Serializable {\n+\n+  private static final long serialVersionUID = 4985607753888575491L;\n+\n+  @ToString.Exclude\n+  @Id\n+  @GeneratedValue(generator = \"system-uuid\")\n+  @GenericGenerator(name = \"system-uuid\", strategy = \"uuid\")\n+  @Column(\n+      name = \"user_app_details_id\",\n+      updatable = false,\n+      nullable = false,\n+      length = ColumnConstraints.ID_LENGTH)\n+  private Integer userAppDetailsId;\n+\n+  @ManyToOne\n+  @JoinColumn(name = \"app_info_id\", insertable = true, updatable = false)\n+  private AppEntity appInfo;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec1c42537c2ae6e9cd789ab7a45ba10c5891dac9"}, "originalPosition": 57}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzc3NDYzOQ==", "bodyText": "I don't think the insertable annotation is necessary", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#discussion_r463774639", "createdAt": "2020-07-31T18:48:54Z", "author": {"login": "nikklassen"}, "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/model/UserAppDetailsEntity.java", "diffHunk": "@@ -0,0 +1,69 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.model;\n+\n+import java.io.Serializable;\n+import java.sql.Timestamp;\n+\n+import javax.persistence.CascadeType;\n+import javax.persistence.Column;\n+import javax.persistence.Entity;\n+import javax.persistence.GeneratedValue;\n+import javax.persistence.Id;\n+import javax.persistence.JoinColumn;\n+import javax.persistence.ManyToOne;\n+import javax.persistence.Table;\n+\n+import org.hibernate.annotations.GenericGenerator;\n+import org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;\n+\n+import com.google.cloud.healthcare.fdamystudies.common.ColumnConstraints;\n+\n+import lombok.Getter;\n+import lombok.Setter;\n+import lombok.ToString;\n+\n+@Setter\n+@Getter\n+@Entity\n+@Table(name = \"user_app_details\")\n+@ConditionalOnProperty(\n+    value = \"participant.manager.entities.enabled\",\n+    havingValue = \"true\",\n+    matchIfMissing = false)\n+public class UserAppDetailsEntity implements Serializable {\n+\n+  private static final long serialVersionUID = 4985607753888575491L;\n+\n+  @ToString.Exclude\n+  @Id\n+  @GeneratedValue(generator = \"system-uuid\")\n+  @GenericGenerator(name = \"system-uuid\", strategy = \"uuid\")\n+  @Column(\n+      name = \"user_app_details_id\",\n+      updatable = false,\n+      nullable = false,\n+      length = ColumnConstraints.ID_LENGTH)\n+  private Integer userAppDetailsId;\n+\n+  @ManyToOne\n+  @JoinColumn(name = \"app_info_id\", insertable = true, updatable = false)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec1c42537c2ae6e9cd789ab7a45ba10c5891dac9"}, "originalPosition": 56}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzc3NTY4OQ==", "bodyText": "UUID?", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#discussion_r463775689", "createdAt": "2020-07-31T18:51:22Z", "author": {"login": "nikklassen"}, "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/model/UserInstitutionEntity.java", "diffHunk": "@@ -0,0 +1,49 @@\n+package com.google.cloud.healthcare.fdamystudies.model;\n+\n+import javax.persistence.Column;\n+import javax.persistence.Entity;\n+import javax.persistence.FetchType;\n+import javax.persistence.GeneratedValue;\n+import javax.persistence.GenerationType;\n+import javax.persistence.Id;\n+import javax.persistence.JoinColumn;\n+import javax.persistence.OneToOne;\n+import javax.persistence.Table;\n+import javax.validation.constraints.NotNull;\n+\n+import org.hibernate.annotations.OnDelete;\n+import org.hibernate.annotations.OnDeleteAction;\n+import org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;\n+\n+import lombok.AllArgsConstructor;\n+import lombok.Builder;\n+import lombok.Getter;\n+import lombok.NoArgsConstructor;\n+import lombok.Setter;\n+\n+@Setter\n+@Getter\n+@Entity\n+@AllArgsConstructor\n+@Builder\n+@NoArgsConstructor\n+@Table(name = \"user_institution\")\n+@ConditionalOnProperty(\n+    value = \"participant.datastore.entities.enabled\",\n+    havingValue = \"true\",\n+    matchIfMissing = false)\n+public class UserInstitutionEntity {\n+  @Id\n+  @Column(name = \"user_institution_id\", unique = true)\n+  @GeneratedValue(strategy = GenerationType.IDENTITY)\n+  private Long userInstitutionId;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec1c42537c2ae6e9cd789ab7a45ba10c5891dac9"}, "originalPosition": 39}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzc3NjkxNg==", "bodyText": "Does this actually add a non-null constraint to the table?", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#discussion_r463776916", "createdAt": "2020-07-31T18:54:13Z", "author": {"login": "nikklassen"}, "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/model/UserInstitutionEntity.java", "diffHunk": "@@ -0,0 +1,49 @@\n+package com.google.cloud.healthcare.fdamystudies.model;\n+\n+import javax.persistence.Column;\n+import javax.persistence.Entity;\n+import javax.persistence.FetchType;\n+import javax.persistence.GeneratedValue;\n+import javax.persistence.GenerationType;\n+import javax.persistence.Id;\n+import javax.persistence.JoinColumn;\n+import javax.persistence.OneToOne;\n+import javax.persistence.Table;\n+import javax.validation.constraints.NotNull;\n+\n+import org.hibernate.annotations.OnDelete;\n+import org.hibernate.annotations.OnDeleteAction;\n+import org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;\n+\n+import lombok.AllArgsConstructor;\n+import lombok.Builder;\n+import lombok.Getter;\n+import lombok.NoArgsConstructor;\n+import lombok.Setter;\n+\n+@Setter\n+@Getter\n+@Entity\n+@AllArgsConstructor\n+@Builder\n+@NoArgsConstructor\n+@Table(name = \"user_institution\")\n+@ConditionalOnProperty(\n+    value = \"participant.datastore.entities.enabled\",\n+    havingValue = \"true\",\n+    matchIfMissing = false)\n+public class UserInstitutionEntity {\n+  @Id\n+  @Column(name = \"user_institution_id\", unique = true)\n+  @GeneratedValue(strategy = GenerationType.IDENTITY)\n+  private Long userInstitutionId;\n+\n+  @NotNull", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec1c42537c2ae6e9cd789ab7a45ba10c5891dac9"}, "originalPosition": 41}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzc3NzMwOQ==", "bodyText": "Can you put all these deletes in a helper function on testDataHelper?", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#discussion_r463777309", "createdAt": "2020-07-31T18:54:59Z", "author": {"login": "nikklassen"}, "path": "participant-manager-module/participant-manager-service/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/SitesControllerTest.java", "diffHunk": "@@ -732,10 +731,6 @@ public void shouldInviteParticipant() throws Exception {\n \n   @AfterEach\n   public void cleanUp() {\n-    if (StringUtils.isNotEmpty(siteId)) {\n-      siteRepository.deleteById(siteId);\n-      siteId = null;\n-    }\n     testDataHelper.getStudyConsentRepository().deleteAll();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ec1c42537c2ae6e9cd789ab7a45ba10c5891dac9"}, "originalPosition": 16}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a2aea29d61f60d56494d19cfbed92cb2905be21b", "author": {"user": {"login": "aswinijena100", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/a2aea29d61f60d56494d19cfbed92cb2905be21b", "committedDate": "2020-08-03T15:25:42Z", "message": "review comment fix"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8292d3f30dbff9790fa53a0daf318e2b4e7024d8", "author": {"user": {"login": "aswinijena100", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/8292d3f30dbff9790fa53a0daf318e2b4e7024d8", "committedDate": "2020-08-04T05:01:10Z", "message": "review comments fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d6d4480a4d3d4b911b7aefb3e7dbeb237d7230db", "author": {"user": {"login": "aswinijena100", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/d6d4480a4d3d4b911b7aefb3e7dbeb237d7230db", "committedDate": "2020-08-04T09:47:43Z", "message": "review comment fixes for remaining entities\n\nreview comment fixes for remaining entities"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "60139c8d5ca2a067be8d0a5b554168db0f1c958a", "author": {"user": {"login": "aswinijena100", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/60139c8d5ca2a067be8d0a5b554168db0f1c958a", "committedDate": "2020-08-04T11:05:06Z", "message": "Merge branch 'participant-manager-invite-participants' into data-integrity-checks-entities"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4fbbf2c9cd9c8bf7f6ad851be7401b72393ad4f4", "author": {"user": {"login": "aswinijena100", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/4fbbf2c9cd9c8bf7f6ad851be7401b72393ad4f4", "committedDate": "2020-08-04T12:51:32Z", "message": "changes after resolved conflict\n\nchanges after resolved conflict"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwODMzODE2", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#pullrequestreview-460833816", "createdAt": "2020-08-04T13:53:59Z", "commit": {"oid": "4fbbf2c9cd9c8bf7f6ad851be7401b72393ad4f4"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQxMzo1Mzo1OVrOG7hbIQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQxMzo1NjowMFrOG7hg_w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTA2Njc4NQ==", "bodyText": "let me rephrase: is it okay for one participant_id to be registered in more than one site?\nif that's not what we want, then we could make it unique per study_id instead. or unique on its own, if it gets generated within a study context, i.e. if new participant_id is generated per user, per study", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#discussion_r465066785", "createdAt": "2020-08-04T13:53:59Z", "author": {"login": "zohrehj"}, "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/model/ParticipantStudyEntity.java", "diffHunk": "@@ -36,7 +40,13 @@\n @Setter\n @Getter\n @Entity\n-@Table(name = \"participant_study_info\")\n+@Table(\n+    name = \"participant_study_info\",\n+    uniqueConstraints = {\n+      @UniqueConstraint(\n+          columnNames = {\"participant_id\", \"site_id\"},", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzcyNzYyMQ=="}, "originalCommit": {"oid": "ec1c42537c2ae6e9cd789ab7a45ba10c5891dac9"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTA2NzE5Mg==", "bodyText": "I believe you missed this question.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#discussion_r465067192", "createdAt": "2020-08-04T13:54:32Z", "author": {"login": "zohrehj"}, "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/model/ParticipantStudyEntity.java", "diffHunk": "@@ -87,6 +97,7 @@\n   private Timestamp enrolledDate;\n \n   @Column(name = \"sharing\")\n+  @Type(type = \"text\")\n   private String sharing;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzczMTM3MA=="}, "originalCommit": {"oid": "ec1c42537c2ae6e9cd789ab7a45ba10c5891dac9"}, "originalPosition": 61}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTA2ODI4Nw==", "bodyText": "please address all formatting issues across the PR.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#discussion_r465068287", "createdAt": "2020-08-04T13:56:00Z", "author": {"login": "zohrehj"}, "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/model/AppEntity.java", "diffHunk": "@@ -12,6 +12,7 @@\n import java.sql.Timestamp;\n import java.util.ArrayList;\n import java.util.List;\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzY4MDgzMg=="}, "originalCommit": {"oid": "ec1c42537c2ae6e9cd789ab7a45ba10c5891dac9"}, "originalPosition": 4}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYwODcwMzU1", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#pullrequestreview-460870355", "createdAt": "2020-08-04T14:30:31Z", "commit": {"oid": "4fbbf2c9cd9c8bf7f6ad851be7401b72393ad4f4"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQxNDozMDozMVrOG7jIYA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNFQxNDo0OToyNVrOG7j_Ow==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTA5NDc1Mg==", "bodyText": "Unfortunate, Spring seems to allow this pattern so I thought it would work. Nevermind then.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#discussion_r465094752", "createdAt": "2020-08-04T14:30:31Z", "author": {"login": "nikklassen"}, "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/model/AppEntity.java", "diffHunk": "@@ -44,18 +50,27 @@\n   @Id\n   @GeneratedValue(generator = \"system-uuid\")\n   @GenericGenerator(name = \"system-uuid\", strategy = \"uuid\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzY5Mzc2MA=="}, "originalCommit": {"oid": "ec1c42537c2ae6e9cd789ab7a45ba10c5891dac9"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTEwNDAwMQ==", "bodyText": "My apologies, for the old schemas we were using TINYINT, but I see it's done with the automatic mapping for boolean in this PR, so that's good. But for permissions, can you use enums with @Enumerated(EnumType.STRING) then? It's not clear what values this field can take just from looking at this class.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#discussion_r465104001", "createdAt": "2020-08-04T14:42:48Z", "author": {"login": "nikklassen"}, "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/model/LocationEntity.java", "diffHunk": "@@ -43,35 +50,47 @@\n   @Id\n   @GeneratedValue(generator = \"system-uuid\")\n   @GenericGenerator(name = \"system-uuid\", strategy = \"uuid\")\n-  @Column(name = \"id\", updatable = false, nullable = false)\n+  @Column(name = \"id\", updatable = false, nullable = false, length = ColumnConstraints.ID_LENGTH)\n   private String id;\n \n-  @Column(name = \"custom_id\", length = 200)\n+  @Column(name = \"custom_id\", nullable = false, length = ColumnConstraints.SMALL_LENGTH)\n   private String customId;\n \n-  @Column(name = \"status\", length = 1)\n+  @Column(name = \"status\", length = ColumnConstraints.TINY_LENGTH)\n   private Integer status;\n \n-  @Column(name = \"name\", length = 200)\n+  @Column(name = \"name\", length = ColumnConstraints.LARGE_LENGTH)\n   private String name;\n \n-  @Column(name = \"description\", length = 500)\n+  @Column(name = \"description\")\n+  @Type(type = \"text\")\n   private String description;\n \n-  @Column(name = \"is_default\", length = 1)\n+  @Column(name = \"is_default\", nullable = false, columnDefinition = \"Varchar(1) default 'N'\")", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzczNDU2NA=="}, "originalCommit": {"oid": "ec1c42537c2ae6e9cd789ab7a45ba10c5891dac9"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTEwNDgyMA==", "bodyText": "OK", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#discussion_r465104820", "createdAt": "2020-08-04T14:44:01Z", "author": {"login": "nikklassen"}, "path": "participant-manager-module/participant-manager-service/src/test/java/com/google/cloud/healthcare/fdamystudies/controller/SitesControllerTest.java", "diffHunk": "@@ -732,10 +731,6 @@ public void shouldInviteParticipant() throws Exception {\n \n   @AfterEach\n   public void cleanUp() {\n-    if (StringUtils.isNotEmpty(siteId)) {\n-      siteRepository.deleteById(siteId);\n-      siteId = null;\n-    }\n     testDataHelper.getStudyConsentRepository().deleteAll();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzc3NzMwOQ=="}, "originalCommit": {"oid": "ec1c42537c2ae6e9cd789ab7a45ba10c5891dac9"}, "originalPosition": 16}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTEwNzAyMQ==", "bodyText": "What about the field name?", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#discussion_r465107021", "createdAt": "2020-08-04T14:46:59Z", "author": {"login": "nikklassen"}, "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/model/AuthInfoEntity.java", "diffHunk": "@@ -0,0 +1,99 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.model;\n+\n+import java.io.Serializable;\n+import java.sql.Timestamp;\n+\n+import javax.persistence.CascadeType;\n+import javax.persistence.Column;\n+import javax.persistence.Entity;\n+import javax.persistence.GeneratedValue;\n+import javax.persistence.Id;\n+import javax.persistence.JoinColumn;\n+import javax.persistence.ManyToOne;\n+import javax.persistence.Table;\n+\n+import org.hibernate.annotations.GenericGenerator;\n+import org.hibernate.annotations.Type;\n+import org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;\n+\n+import com.google.cloud.healthcare.fdamystudies.common.ColumnConstraints;\n+\n+import lombok.Getter;\n+import lombok.Setter;\n+import lombok.ToString;\n+\n+@Setter\n+@Getter\n+@Entity\n+@Table(name = \"auth_info\")\n+@ConditionalOnProperty(\n+    value = \"participant.datastore.entities.enabled\",\n+    havingValue = \"true\",\n+    matchIfMissing = false)\n+public class AuthInfoEntity implements Serializable {\n+\n+  private static final long serialVersionUID = 4985607753888575491L;\n+\n+  @ToString.Exclude\n+  @Id\n+  @GeneratedValue(generator = \"system-uuid\")\n+  @GenericGenerator(name = \"system-uuid\", strategy = \"uuid\")\n+  @Column(name = \"auth_id\", nullable = false, length = ColumnConstraints.ID_LENGTH)\n+  private Integer authId;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzczNTIzMQ=="}, "originalCommit": {"oid": "ec1c42537c2ae6e9cd789ab7a45ba10c5891dac9"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTEwNzQzMA==", "bodyText": "So is this something that needs to be filled in for compliance?", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#discussion_r465107430", "createdAt": "2020-08-04T14:47:32Z", "author": {"login": "nikklassen"}, "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/model/LocationEntity.java", "diffHunk": "@@ -43,35 +50,47 @@\n   @Id\n   @GeneratedValue(generator = \"system-uuid\")\n   @GenericGenerator(name = \"system-uuid\", strategy = \"uuid\")\n-  @Column(name = \"id\", updatable = false, nullable = false)\n+  @Column(name = \"id\", updatable = false, nullable = false, length = ColumnConstraints.ID_LENGTH)\n   private String id;\n \n-  @Column(name = \"custom_id\", length = 200)\n+  @Column(name = \"custom_id\", nullable = false, length = ColumnConstraints.SMALL_LENGTH)\n   private String customId;\n \n-  @Column(name = \"status\", length = 1)\n+  @Column(name = \"status\", length = ColumnConstraints.TINY_LENGTH)\n   private Integer status;\n \n-  @Column(name = \"name\", length = 200)\n+  @Column(name = \"name\", length = ColumnConstraints.LARGE_LENGTH)\n   private String name;\n \n-  @Column(name = \"description\", length = 500)\n+  @Column(name = \"description\")\n+  @Type(type = \"text\")\n   private String description;\n \n-  @Column(name = \"is_default\", length = 1)\n+  @Column(name = \"is_default\", nullable = false, columnDefinition = \"Varchar(1) default 'N'\")\n   private String isDefault;\n \n   @Column(\n-      name = \"created\",\n+      name = \"created_on\",\n       insertable = false,\n       updatable = false,\n       columnDefinition = \"TIMESTAMP DEFAULT CURRENT_TIMESTAMP\")\n   private Timestamp created;\n \n   @ToString.Exclude\n-  @Column(name = \"created_by\", length = 64)\n+  @Column(name = \"created_by\", length = ColumnConstraints.LARGE_LENGTH)", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzczNTk4Mg=="}, "originalCommit": {"oid": "ec1c42537c2ae6e9cd789ab7a45ba10c5891dac9"}, "originalPosition": 66}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTEwODc5NQ==", "bodyText": "Booleans shouldn't need a length. You've only specified it on some of them as well.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#discussion_r465108795", "createdAt": "2020-08-04T14:49:25Z", "author": {"login": "nikklassen"}, "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/model/AuthInfoEntity.java", "diffHunk": "@@ -46,54 +49,41 @@\n   @Id\n   @GeneratedValue(generator = \"system-uuid\")\n   @GenericGenerator(name = \"system-uuid\", strategy = \"uuid\")\n-  @Column(name = \"auth_id\", nullable = false, length = ColumnConstraints.ID_LENGTH)\n-  private Integer authId;\n+  @Column(name = \"id\", nullable = false)\n+  private String authId;\n \n   @ManyToOne(cascade = CascadeType.MERGE)\n   @JoinColumn(name = \"app_info_id\", nullable = false)\n-  private AppEntity appInfo;\n+  private AppEntity app;\n \n   @ManyToOne(cascade = CascadeType.MERGE)\n   @JoinColumn(name = \"user_details_id\", nullable = false)\n   private UserDetailsEntity userDetails;\n \n-  @Column(name = \"auth_key\", length = ColumnConstraints.SMALL_LENGTH)\n+  @Column(name = \"auth_key\", length = SMALL_LENGTH)\n   private String authKey;\n \n   @Column(name = \"device_token\")\n   @Type(type = \"text\")\n   private String deviceToken;\n \n-  @Column(name = \"device_type\", length = ColumnConstraints.SMALL_LENGTH)\n+  @Column(name = \"device_type\", length = SMALL_LENGTH)\n   private String deviceType;\n \n-  @Column(name = \"android_app_version\", length = ColumnConstraints.SMALL_LENGTH)\n+  @Column(name = \"android_app_version\", length = SMALL_LENGTH)\n   private String androidAppVersion;\n \n-  @Column(name = \"ios_app_version\", length = ColumnConstraints.SMALL_LENGTH)\n+  @Column(name = \"ios_app_version\", length = SMALL_LENGTH)\n   private String iosAppVersion;\n \n-  @Column(\n-      name = \"created_on\",\n-      insertable = false,\n-      updatable = false,\n-      columnDefinition = \"TIMESTAMP DEFAULT CURRENT_TIMESTAMP\")\n+  @Column(name = \"created_time\")\n+  @CreationTimestamp\n   private Timestamp created;\n \n-  @Column(\n-      name = \"modified_date\",\n-      insertable = false,\n-      updatable = true,\n-      columnDefinition = \"TIMESTAMP DEFAULT CURRENT_TIMESTAMP\")\n+  @Column(name = \"updated_time\")\n+  @UpdateTimestamp\n   private Timestamp modified;\n \n-  @Column(name = \"remote_notification_flag\", length = ColumnConstraints.TINY_LENGTH)\n+  @Column(name = \"remote_notification_flag\", length = TINY_LENGTH)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4fbbf2c9cd9c8bf7f6ad851be7401b72393ad4f4"}, "originalPosition": 82}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cd6d7c00e718cdeda7babb06e581b30766beea5b", "author": {"user": {"login": "aswinijena100", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/cd6d7c00e718cdeda7babb06e581b30766beea5b", "committedDate": "2020-08-05T14:30:57Z", "message": "Review comment fixes on 5thAug2020\n\nReview comment fixes on 5thAug2020"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cf183e56c5d9c18c4fe5c565d1d99b3eae708c0f", "author": {"user": {"login": "aswinijena100", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/cf183e56c5d9c18c4fe5c565d1d99b3eae708c0f", "committedDate": "2020-08-05T15:32:40Z", "message": "PR review comment fix to implement  @Enumerated(EnumType.ORDINAL)\n\nPR review comment fix to implement  @Enumerated(EnumType.ORDINAL)"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxODIyNTk1", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#pullrequestreview-461822595", "createdAt": "2020-08-05T16:20:30Z", "commit": {"oid": "cf183e56c5d9c18c4fe5c565d1d99b3eae708c0f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxNjoyMDozMFrOG8RCBA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQxNjoyOToyMVrOG8RZBA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTg0Njc4OA==", "bodyText": "I don't understand, you've marked the column as \"text\". But then you say Marking \"columnDefinition = Text\" is not portable and doesn't work in tests.. My issue is only regarding this comment, if the text is big then fine, but this comment doesn't make sense.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#discussion_r465846788", "createdAt": "2020-08-05T16:20:30Z", "author": {"login": "nikklassen"}, "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/model/PersonalizedUserReportEntity.java", "diffHunk": "@@ -0,0 +1,78 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+package com.google.cloud.healthcare.fdamystudies.model;\n+\n+import java.io.Serializable;\n+import java.sql.Timestamp;\n+\n+import javax.persistence.Column;\n+import javax.persistence.Entity;\n+import javax.persistence.GeneratedValue;\n+import javax.persistence.Id;\n+import javax.persistence.JoinColumn;\n+import javax.persistence.ManyToOne;\n+import javax.persistence.Table;\n+\n+import org.hibernate.annotations.CreationTimestamp;\n+import org.hibernate.annotations.GenericGenerator;\n+import org.hibernate.annotations.Type;\n+import org.springframework.boot.autoconfigure.condition.ConditionalOnProperty;\n+\n+import com.google.cloud.healthcare.fdamystudies.common.ColumnConstraints;\n+\n+import lombok.AllArgsConstructor;\n+import lombok.Builder;\n+import lombok.Getter;\n+import lombok.NoArgsConstructor;\n+import lombok.Setter;\n+import lombok.ToString;\n+\n+@AllArgsConstructor\n+@Builder\n+@Setter\n+@Getter\n+@Entity\n+@NoArgsConstructor\n+@Table(name = \"personalized_user_report\")\n+@ConditionalOnProperty(\n+    value = \"participant.datastore.entities.enabled\",\n+    havingValue = \"true\",\n+    matchIfMissing = false)\n+public class PersonalizedUserReportEntity implements Serializable {\n+\n+  private static final long serialVersionUID = -3019529323339411129L;\n+\n+  @ToString.Exclude\n+  @Id\n+  @GeneratedValue(generator = \"system-uuid\")\n+  @GenericGenerator(name = \"system-uuid\", strategy = \"uuid\")\n+  @Column(name = \"id\", updatable = false, nullable = false, length = ColumnConstraints.ID_LENGTH)\n+  private String id;\n+\n+  @ManyToOne\n+  @JoinColumn(name = \"user_id\")\n+  private UserDetailsEntity userDetails;\n+\n+  @ManyToOne\n+  @JoinColumn(name = \"study_info_id\")\n+  private StudyEntity studyInfo;\n+\n+  @Column(name = \"report_title\", length = ColumnConstraints.MEDIUM_LENGTH)\n+  private String reportTitle;\n+\n+  // Length is an arbitrary multiple of 100 > 2^15 and < 2^16 to guarantee we", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzc3MDY0MA=="}, "originalCommit": {"oid": "ec1c42537c2ae6e9cd789ab7a45ba10c5891dac9"}, "originalPosition": 68}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTg1MjUzNQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                int edit = site != null && site.getPermission() == 1 ? 0 : 1;\n          \n          \n            \n                sitePermission.setCanEdit(edit);\n          \n          \n            \n                sitePermission.setCanEdit(edit == 0 ? Permission.READ_VIEW : Permission.READ_EDIT);\n          \n          \n            \n            Permission edit = site != null && site.getPermission() == 1 ? Permission.READ_VIEW : Permission.READ_EDIT;\n          \n          \n            \n            sitePermission.setCanEdit(edit);", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#discussion_r465852535", "createdAt": "2020-08-05T16:29:08Z", "author": {"login": "nikklassen"}, "path": "participant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/mapper/UserMapper.java", "diffHunk": "@@ -75,7 +74,7 @@ public static SitePermissionEntity newSitePermissionEntity(\n     sitePermission.setSite(siteDetails);\n     sitePermission.setCreatedBy(user.getSuperAdminUserId());\n     int edit = site != null && site.getPermission() == 1 ? 0 : 1;\n-    sitePermission.setCanEdit(edit);\n+    sitePermission.setCanEdit(edit == 0 ? Permission.READ_VIEW : Permission.READ_EDIT);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cf183e56c5d9c18c4fe5c565d1d99b3eae708c0f"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTg1MjY3Ng==", "bodyText": "Same as above. Throughtout file", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#discussion_r465852676", "createdAt": "2020-08-05T16:29:21Z", "author": {"login": "nikklassen"}, "path": "participant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/mapper/UserMapper.java", "diffHunk": "@@ -90,7 +89,7 @@ public static SitePermissionEntity newSitePermissionEntity(\n     sitePermission.setApp(studyDetails.getApp());\n     sitePermission.setCreatedBy(user.getSuperAdminUserId());\n     int edit = study.getPermission() == 1 ? 0 : 1;\n-    sitePermission.setCanEdit(edit);\n+    sitePermission.setCanEdit(edit == 0 ? Permission.READ_VIEW : Permission.READ_EDIT);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cf183e56c5d9c18c4fe5c565d1d99b3eae708c0f"}, "originalPosition": 49}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDYxOTk0MjYz", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#pullrequestreview-461994263", "createdAt": "2020-08-05T20:20:21Z", "commit": {"oid": "cf183e56c5d9c18c4fe5c565d1d99b3eae708c0f"}, "state": "COMMENTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQyMDoyMDoyMVrOG8ZMSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0wNVQyMDoyMzoyMlrOG8ZSVw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTk4MDQ5MA==", "bodyText": "and my original question:\n\" is it okay for one participant_id to be registered in more than one site?\"", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#discussion_r465980490", "createdAt": "2020-08-05T20:20:21Z", "author": {"login": "zohrehj"}, "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/model/ParticipantStudyEntity.java", "diffHunk": "@@ -36,7 +40,13 @@\n @Setter\n @Getter\n @Entity\n-@Table(name = \"participant_study_info\")\n+@Table(\n+    name = \"participant_study_info\",\n+    uniqueConstraints = {\n+      @UniqueConstraint(\n+          columnNames = {\"participant_id\", \"site_id\"},", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzcyNzYyMQ=="}, "originalCommit": {"oid": "ec1c42537c2ae6e9cd789ab7a45ba10c5891dac9"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTk4MTYzNg==", "bodyText": "I don't remember ever hearing about these four values. Can you please describe what each one is used for and why we do not simply use boolean? null (not provided or not applicable) and true or false for provided values?", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#discussion_r465981636", "createdAt": "2020-08-05T20:22:34Z", "author": {"login": "zohrehj"}, "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/model/ParticipantStudyEntity.java", "diffHunk": "@@ -87,6 +97,7 @@\n   private Timestamp enrolledDate;\n \n   @Column(name = \"sharing\")\n+  @Type(type = \"text\")\n   private String sharing;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzczMTM3MA=="}, "originalCommit": {"oid": "ec1c42537c2ae6e9cd789ab7a45ba10c5891dac9"}, "originalPosition": 61}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTk4MjAzOQ==", "bodyText": "this should be renamed too. If it takes a lot of work, please file a bug", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#discussion_r465982039", "createdAt": "2020-08-05T20:23:22Z", "author": {"login": "zohrehj"}, "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/model/ParticipantStudyEntity.java", "diffHunk": "@@ -68,38 +76,28 @@\n   private UserDetailsEntity userDetails;\n \n   @Column(name = \"consent_status\")\n-  private Boolean consentStatus;\n+  private Boolean consentStatus = false;\n \n-  @Column(name = \"status\")\n+  @Column(length = SMALL_LENGTH)\n   private String status;\n \n-  @Column(name = \"bookmark\")\n   private Boolean bookmark;\n \n-  @Column(name = \"eligibility\")\n   private Boolean eligibility;\n \n-  @Column(\n-      name = \"enrolled_date\",\n-      insertable = false,\n-      updatable = false,\n-      columnDefinition = \"TIMESTAMP DEFAULT CURRENT_TIMESTAMP\")\n+  @Column(name = \"enrolled_time\")\n+  @CreationTimestamp\n   private Timestamp enrolledDate;\n \n-  @Column(name = \"sharing\")\n+  @Column(length = XS_LENGTH)\n   private String sharing;\n \n-  @Column(name = \"completion\")\n   private Integer completion;\n \n-  @Column(name = \"adherence\")\n   private Integer adherence;\n \n-  @Column(\n-      name = \"withdrawal_date\",\n-      insertable = false,\n-      updatable = false,\n-      columnDefinition = \"TIMESTAMP DEFAULT CURRENT_TIMESTAMP\")\n+  @Column(name = \"withdrawal_time\")\n+  @CreationTimestamp\n   private Timestamp withdrawalDate;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cf183e56c5d9c18c4fe5c565d1d99b3eae708c0f"}, "originalPosition": 97}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "27a1f058e81af4d962eeda2922903199ae3fb705", "author": {"user": {"login": "aswinijena100", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/27a1f058e81af4d962eeda2922903199ae3fb705", "committedDate": "2020-08-10T05:35:03Z", "message": "Added Permission type instead of int type\n\nAdded Permission type instead of int type"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0Mjk0MTQy", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#pullrequestreview-464294142", "createdAt": "2020-08-10T14:44:01Z", "commit": {"oid": "27a1f058e81af4d962eeda2922903199ae3fb705"}, "state": "COMMENTED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "2bde28b8b28266211c828b0254359ee3b852dc43", "author": {"user": {"login": "aswinijena100", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/2bde28b8b28266211c828b0254359ee3b852dc43", "committedDate": "2020-08-10T14:48:49Z", "message": "removed unwanted comment\n\nremoved unwanted comment"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0Mzg0MzIw", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#pullrequestreview-464384320", "createdAt": "2020-08-10T16:23:46Z", "commit": {"oid": "2bde28b8b28266211c828b0254359ee3b852dc43"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQxNjoyMzo0NlrOG-WFLA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMFQxNjo1MjowNlrOG-XGXQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODAyNjY2OA==", "bodyText": "nit: can these permissions be renamed to simply VIEW and EDIT ?", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#discussion_r468026668", "createdAt": "2020-08-10T16:23:46Z", "author": {"login": "zohrehj"}, "path": "participant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/mapper/UserMapper.java", "diffHunk": "@@ -108,15 +110,15 @@ public static SitePermissionEntity newSitePermissionEntity(\n         SitePermissionEntity sitePermission = new SitePermissionEntity();\n         sitePermission.setApp(appDetails);\n         sitePermission.setCreatedBy(user.getSuperAdminUserId());\n-        int edit = app != null && app.getPermission() == 1 ? 0 : 1;\n-        sitePermission.setCanEdit(edit == 0 ? Permission.READ_VIEW : Permission.READ_EDIT);\n+        Permission edit =\n+            app != null && app.getPermission() == 1 ? Permission.READ_VIEW : Permission.READ_EDIT;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2bde28b8b28266211c828b0254359ee3b852dc43"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODAyOTczNA==", "bodyText": "this looks like a bug to me. We have a column disabled_time, it's set to the creation time and it is not updatable.\nIs this column ever used? if not, it should be removed.\nIf it is used, how do we change the value?", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#discussion_r468029734", "createdAt": "2020-08-10T16:28:54Z", "author": {"login": "zohrehj"}, "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/model/ParticipantRegistrySiteEntity.java", "diffHunk": "@@ -50,62 +61,57 @@\n   private String id;\n \n   @ManyToOne(cascade = CascadeType.MERGE)\n-  @JoinColumn(name = \"site_id\", insertable = true, updatable = false)\n+  @JoinColumn(name = \"site_id\", updatable = false)\n   private SiteEntity site;\n \n   @ManyToOne(cascade = CascadeType.MERGE)\n-  @JoinColumn(name = \"study_info_id\", insertable = true, updatable = true)\n+  @JoinColumn(name = \"study_info_id\")\n   private StudyEntity study;\n \n   @ToString.Exclude\n-  @Column(name = \"email\")\n+  @Column(length = LARGE_LENGTH)\n   private String email;\n \n   @ToString.Exclude\n-  @Column(name = \"name\")\n+  @Column(length = MEDIUM_LENGTH)\n   private String name;\n \n-  @Column(\n-      name = \"invitation_date\",\n-      insertable = false,\n-      updatable = false,\n-      columnDefinition = \"TIMESTAMP DEFAULT CURRENT_TIMESTAMP\")\n+  @Column(name = \"invitation_time\")\n+  @CreationTimestamp\n   private Timestamp invitationDate;\n \n   @Column(name = \"invitation_count\", columnDefinition = \"BIGINT DEFAULT 0\")\n   private Long invitationCount;\n \n-  @Column(\n-      name = \"disabled_date\",\n-      insertable = false,\n-      updatable = false,\n-      columnDefinition = \"TIMESTAMP DEFAULT CURRENT_TIMESTAMP\")\n+  @Column(name = \"disabled_time\")\n+  @CreationTimestamp\n   private Timestamp disabledDate;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2bde28b8b28266211c828b0254359ee3b852dc43"}, "originalPosition": 89}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODAzMDUyMg==", "bodyText": "this also looks like a bug. Token is immediately expired? why exactly do we need to store this time in the database then? doesn't its existence alone not indicate that it is expired?", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#discussion_r468030522", "createdAt": "2020-08-10T16:30:13Z", "author": {"login": "zohrehj"}, "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/model/ParticipantRegistrySiteEntity.java", "diffHunk": "@@ -50,62 +61,57 @@\n   private String id;\n \n   @ManyToOne(cascade = CascadeType.MERGE)\n-  @JoinColumn(name = \"site_id\", insertable = true, updatable = false)\n+  @JoinColumn(name = \"site_id\", updatable = false)\n   private SiteEntity site;\n \n   @ManyToOne(cascade = CascadeType.MERGE)\n-  @JoinColumn(name = \"study_info_id\", insertable = true, updatable = true)\n+  @JoinColumn(name = \"study_info_id\")\n   private StudyEntity study;\n \n   @ToString.Exclude\n-  @Column(name = \"email\")\n+  @Column(length = LARGE_LENGTH)\n   private String email;\n \n   @ToString.Exclude\n-  @Column(name = \"name\")\n+  @Column(length = MEDIUM_LENGTH)\n   private String name;\n \n-  @Column(\n-      name = \"invitation_date\",\n-      insertable = false,\n-      updatable = false,\n-      columnDefinition = \"TIMESTAMP DEFAULT CURRENT_TIMESTAMP\")\n+  @Column(name = \"invitation_time\")\n+  @CreationTimestamp\n   private Timestamp invitationDate;\n \n   @Column(name = \"invitation_count\", columnDefinition = \"BIGINT DEFAULT 0\")\n   private Long invitationCount;\n \n-  @Column(\n-      name = \"disabled_date\",\n-      insertable = false,\n-      updatable = false,\n-      columnDefinition = \"TIMESTAMP DEFAULT CURRENT_TIMESTAMP\")\n+  @Column(name = \"disabled_time\")\n+  @CreationTimestamp\n   private Timestamp disabledDate;\n \n-  @Column(\n-      name = \"enrollment_token_expiry\",\n-      insertable = false,\n-      updatable = false,\n-      columnDefinition = \"TIMESTAMP DEFAULT CURRENT_TIMESTAMP\")\n+  @Column(name = \"enrollment_token_expiry\")\n+  @CreationTimestamp\n   private Timestamp enrollmentTokenExpiry;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "2bde28b8b28266211c828b0254359ee3b852dc43"}, "originalPosition": 98}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODAzNzEyMw==", "bodyText": "This index is only useful if a participant might be added to the same site more than once; it will prevent that form happening.\nHowever from what you are explaining you need a restrictive rule; you need to make sure that a participant does not get added to a study more than once. It is more restrictive because since sites belong to studies, uniqueness at site level will make sure that the user is also not added to ant site more than once either.\nNow, you are saying that participant_id is recreated per user and study, so this is what you need:\n\n\nuniqueConstraint on the participants table for user_id and study_id (make sure a user_study combo is only ever associated with one participant_id)\n\n\nuniqueConstraint on participants table on participant_id column if it's different than the primary key of the table; since it's an ID after all.\n\n\nuniqueConstraint on participant_study_info table on participant_id column. Since there should be only one record per participant there, and we have already made sure that it is unique per study with the previous conditions.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#discussion_r468037123", "createdAt": "2020-08-10T16:41:18Z", "author": {"login": "zohrehj"}, "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/model/ParticipantStudyEntity.java", "diffHunk": "@@ -36,7 +40,13 @@\n @Setter\n @Getter\n @Entity\n-@Table(name = \"participant_study_info\")\n+@Table(\n+    name = \"participant_study_info\",\n+    uniqueConstraints = {\n+      @UniqueConstraint(\n+          columnNames = {\"participant_id\", \"site_id\"},", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzcyNzYyMQ=="}, "originalCommit": {"oid": "ec1c42537c2ae6e9cd789ab7a45ba10c5891dac9"}, "originalPosition": 25}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODA0MzEyNw==", "bodyText": "then you should use Boolean:\nhttps://www.mysqltutorial.org/mysql-boolean/\nSince we want to allow for null values (\"n/a\") then it should be implemented with @Type(type=\"java.lang.Boolean\") which supports Nulls.\nThis way at the db level this would be the mapping:\n\n\n\nMySQL DB\nMyStudies Application\n\n\n\n\n0\nFALSE\n\n\n1\nTRUE\n\n\nNULL\nn/a", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#discussion_r468043127", "createdAt": "2020-08-10T16:51:45Z", "author": {"login": "zohrehj"}, "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/model/ParticipantStudyEntity.java", "diffHunk": "@@ -87,6 +97,7 @@\n   private Timestamp enrolledDate;\n \n   @Column(name = \"sharing\")\n+  @Type(type = \"text\")\n   private String sharing;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzczMTM3MA=="}, "originalCommit": {"oid": "ec1c42537c2ae6e9cd789ab7a45ba10c5891dac9"}, "originalPosition": 61}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODA0MzM1Nw==", "bodyText": "\ud83d\udc4d", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#discussion_r468043357", "createdAt": "2020-08-10T16:52:06Z", "author": {"login": "zohrehj"}, "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/model/ParticipantStudyEntity.java", "diffHunk": "@@ -68,38 +76,28 @@\n   private UserDetailsEntity userDetails;\n \n   @Column(name = \"consent_status\")\n-  private Boolean consentStatus;\n+  private Boolean consentStatus = false;\n \n-  @Column(name = \"status\")\n+  @Column(length = SMALL_LENGTH)\n   private String status;\n \n-  @Column(name = \"bookmark\")\n   private Boolean bookmark;\n \n-  @Column(name = \"eligibility\")\n   private Boolean eligibility;\n \n-  @Column(\n-      name = \"enrolled_date\",\n-      insertable = false,\n-      updatable = false,\n-      columnDefinition = \"TIMESTAMP DEFAULT CURRENT_TIMESTAMP\")\n+  @Column(name = \"enrolled_time\")\n+  @CreationTimestamp\n   private Timestamp enrolledDate;\n \n-  @Column(name = \"sharing\")\n+  @Column(length = XS_LENGTH)\n   private String sharing;\n \n-  @Column(name = \"completion\")\n   private Integer completion;\n \n-  @Column(name = \"adherence\")\n   private Integer adherence;\n \n-  @Column(\n-      name = \"withdrawal_date\",\n-      insertable = false,\n-      updatable = false,\n-      columnDefinition = \"TIMESTAMP DEFAULT CURRENT_TIMESTAMP\")\n+  @Column(name = \"withdrawal_time\")\n+  @CreationTimestamp\n   private Timestamp withdrawalDate;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTk4MjAzOQ=="}, "originalCommit": {"oid": "cf183e56c5d9c18c4fe5c565d1d99b3eae708c0f"}, "originalPosition": 97}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY0NDE4OTU3", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#pullrequestreview-464418957", "createdAt": "2020-08-10T17:10:52Z", "commit": {"oid": "2bde28b8b28266211c828b0254359ee3b852dc43"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c77eef69e3222be0ec044af59f2c7235e1dab99b", "author": {"user": {"login": "aswinijena100", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/c77eef69e3222be0ec044af59f2c7235e1dab99b", "committedDate": "2020-08-11T07:28:08Z", "message": "Review Comment fixes\n\nReview Comment fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cf3504822bbc791f0b288bc7eb78a9a4fc3abc91", "author": {"user": {"login": "aswinijena100", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/cf3504822bbc791f0b288bc7eb78a9a4fc3abc91", "committedDate": "2020-08-11T08:05:18Z", "message": "removed insert/update false not required.\n\nremoved insert/update false not required."}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9e6f0a0422183e5c0716a61c62f6d9668aa28cf0", "author": {"user": {"login": "aswinijena100", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/9e6f0a0422183e5c0716a61c62f6d9668aa28cf0", "committedDate": "2020-08-11T08:43:42Z", "message": "changed type for sharing\n\nchanged type for sharing"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2MjAyODU2", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#pullrequestreview-466202856", "createdAt": "2020-08-12T19:18:04Z", "commit": {"oid": "2bde28b8b28266211c828b0254359ee3b852dc43"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQxOToxODowNFrOG_vFNw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xMlQxOToxOToyM1rOG_vHsQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTQ4NDg1NQ==", "bodyText": "I believe you missed this comment as well", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#discussion_r469484855", "createdAt": "2020-08-12T19:18:04Z", "author": {"login": "zohrehj"}, "path": "participant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/mapper/UserMapper.java", "diffHunk": "@@ -108,15 +110,15 @@ public static SitePermissionEntity newSitePermissionEntity(\n         SitePermissionEntity sitePermission = new SitePermissionEntity();\n         sitePermission.setApp(appDetails);\n         sitePermission.setCreatedBy(user.getSuperAdminUserId());\n-        int edit = app != null && app.getPermission() == 1 ? 0 : 1;\n-        sitePermission.setCanEdit(edit == 0 ? Permission.READ_VIEW : Permission.READ_EDIT);\n+        Permission edit =\n+            app != null && app.getPermission() == 1 ? Permission.READ_VIEW : Permission.READ_EDIT;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODAyNjY2OA=="}, "originalCommit": {"oid": "2bde28b8b28266211c828b0254359ee3b852dc43"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTQ4NTQ4OQ==", "bodyText": "please fix", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#discussion_r469485489", "createdAt": "2020-08-12T19:19:23Z", "author": {"login": "zohrehj"}, "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/model/ParticipantRegistrySiteEntity.java", "diffHunk": "@@ -50,62 +61,57 @@\n   private String id;\n \n   @ManyToOne(cascade = CascadeType.MERGE)\n-  @JoinColumn(name = \"site_id\", insertable = true, updatable = false)\n+  @JoinColumn(name = \"site_id\", updatable = false)\n   private SiteEntity site;\n \n   @ManyToOne(cascade = CascadeType.MERGE)\n-  @JoinColumn(name = \"study_info_id\", insertable = true, updatable = true)\n+  @JoinColumn(name = \"study_info_id\")\n   private StudyEntity study;\n \n   @ToString.Exclude\n-  @Column(name = \"email\")\n+  @Column(length = LARGE_LENGTH)\n   private String email;\n \n   @ToString.Exclude\n-  @Column(name = \"name\")\n+  @Column(length = MEDIUM_LENGTH)\n   private String name;\n \n-  @Column(\n-      name = \"invitation_date\",\n-      insertable = false,\n-      updatable = false,\n-      columnDefinition = \"TIMESTAMP DEFAULT CURRENT_TIMESTAMP\")\n+  @Column(name = \"invitation_time\")\n+  @CreationTimestamp\n   private Timestamp invitationDate;\n \n   @Column(name = \"invitation_count\", columnDefinition = \"BIGINT DEFAULT 0\")\n   private Long invitationCount;\n \n-  @Column(\n-      name = \"disabled_date\",\n-      insertable = false,\n-      updatable = false,\n-      columnDefinition = \"TIMESTAMP DEFAULT CURRENT_TIMESTAMP\")\n+  @Column(name = \"disabled_time\")\n+  @CreationTimestamp\n   private Timestamp disabledDate;\n \n-  @Column(\n-      name = \"enrollment_token_expiry\",\n-      insertable = false,\n-      updatable = false,\n-      columnDefinition = \"TIMESTAMP DEFAULT CURRENT_TIMESTAMP\")\n+  @Column(name = \"enrollment_token_expiry\")\n+  @CreationTimestamp\n   private Timestamp enrollmentTokenExpiry;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODAzMDUyMg=="}, "originalCommit": {"oid": "2bde28b8b28266211c828b0254359ee3b852dc43"}, "originalPosition": 98}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7e1fccb2f56f8e791aae5702804bd6486538166a", "author": {"user": {"login": "aswinijena100", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/7e1fccb2f56f8e791aae5702804bd6486538166a", "committedDate": "2020-08-13T07:36:12Z", "message": "Review comment fixes to rename Read_VIEW to VIEW\n\nReview comment fixes to rename Read_VIEW to VIEW"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDY2OTQ5NTcx", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#pullrequestreview-466949571", "createdAt": "2020-08-13T16:56:55Z", "commit": {"oid": "7e1fccb2f56f8e791aae5702804bd6486538166a"}, "state": "DISMISSED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNjo1Njo1NVrOHAUNbQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0xM1QxNjo1ODowMlrOHAUQAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDA5MzE2NQ==", "bodyText": "please remove extra line", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#discussion_r470093165", "createdAt": "2020-08-13T16:56:55Z", "author": {"login": "zohrehj"}, "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/repository/StudyRepository.java", "diffHunk": "@@ -10,11 +10,13 @@\n \n import java.util.List;\n import java.util.Optional;\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7e1fccb2f56f8e791aae5702804bd6486538166a"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDA5MzI5NA==", "bodyText": "same here, please remove the unnecessary separation", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#discussion_r470093294", "createdAt": "2020-08-13T16:57:09Z", "author": {"login": "zohrehj"}, "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/repository/StudyRepository.java", "diffHunk": "@@ -28,22 +30,22 @@\n   @Query(\"SELECT study from StudyEntity study where study.id=:studyId\")\n   public Optional<StudyEntity> findByStudyId(String studyId);\n ", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7e1fccb2f56f8e791aae5702804bd6486538166a"}, "originalPosition": 17}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDA5MzgyNg==", "bodyText": "please remove all these unrelated formatting changes out of this CL.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#discussion_r470093826", "createdAt": "2020-08-13T16:58:02Z", "author": {"login": "zohrehj"}, "path": "common-modules/common-tests/pom.xml", "diffHunk": "@@ -88,10 +88,10 @@\n \t\t\t<groupId>org.assertj</groupId>\n \t\t\t<artifactId>assertj-core</artifactId>\n \t\t</dependency>\n-        <dependency>\n-      <groupId>org.slf4j</groupId>\n-      <artifactId>slf4j-ext</artifactId>\n-    </dependency>\n+\t\t<dependency>\n+\t\t\t<groupId>org.slf4j</groupId>\n+\t\t\t<artifactId>slf4j-ext</artifactId>\n+\t\t</dependency>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "7e1fccb2f56f8e791aae5702804bd6486538166a"}, "originalPosition": 11}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "37e6f7a1b0704e458b925f1cd2760fc846a96c1a", "author": {"user": {"login": "aswinijena100", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/37e6f7a1b0704e458b925f1cd2760fc846a96c1a", "committedDate": "2020-08-14T06:15:42Z", "message": "formatted all the source files\n\nformatted all the source files"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "05e6b9132b9d077bc8e2cd628d55f2240f3b406a", "author": {"user": {"login": "aswinijena100", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/05e6b9132b9d077bc8e2cd628d55f2240f3b406a", "committedDate": "2020-08-14T06:18:23Z", "message": "Merge branch 'participant-manager-invite-participants' into data-integrity-checks-entities"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bd3dc71d84f0edf8a99fefca21553dadde6faf57", "author": {"user": {"login": "aswinijena100", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/bd3dc71d84f0edf8a99fefca21553dadde6faf57", "committedDate": "2020-08-20T07:05:14Z", "message": "Merge branch 'develop' into data-integrity-checks-entities"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d445bd137289c8ba3573251f8be6729eb19ef71b", "author": {"user": {"login": "madhurya-btc", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/d445bd137289c8ba3573251f8be6729eb19ef71b", "committedDate": "2020-08-20T07:45:43Z", "message": "Conflict issue fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ba31806ed07bdb859a71e11237dc30232d95fc2c", "author": {"user": {"login": "aswinijena100", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/ba31806ed07bdb859a71e11237dc30232d95fc2c", "committedDate": "2020-08-20T08:22:32Z", "message": "test case failed issue fix after resolving conflict issue\n\ntest case failed issue fix after resolving conflict issue"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDcxNTM4NDY3", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/713#pullrequestreview-471538467", "createdAt": "2020-08-20T12:20:03Z", "commit": {"oid": "ba31806ed07bdb859a71e11237dc30232d95fc2c"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 596, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}