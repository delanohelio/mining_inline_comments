{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDcyNjI0MzY0", "number": 798, "reviewThreads": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxNDowMzoyOFrOEcFaQg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxNDowNDozMlrOEcFcSg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk3ODg0MjI2OnYy", "diffSide": "RIGHT", "path": "iOS/HPHC/HPHC/Views/UIViews+Additions/ForceUpdate/AppUpdateBlocker.swift", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxNDowMzoyOFrOHGZpVA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxNjo1MzowOFrOHGhDSA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQ3MzY4NA==", "bodyText": "the appLink created here would be different from the one you were using previously:\nhttps://itunes.apple.com/us/app/fda-my-studies/id1242835330?ls=1&mt=8\nvs what you are creating for appleID: 1242835330\nhttps://apps.apple.com/app/apple-store/id1242835330 ?", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/798#discussion_r476473684", "createdAt": "2020-08-25T14:03:28Z", "author": {"login": "zohrehj"}, "path": "iOS/HPHC/HPHC/Views/UIViews+Additions/ForceUpdate/AppUpdateBlocker.swift", "diffHunk": "@@ -35,28 +49,34 @@ class AppUpdateBlocker: UIView {\n   /// - Parameters:\n   ///   - frame: Rect for the view\n   /// - Returns: New object of `AppUpdateBlocker` Type\n-  class func instanceFromNib(frame: CGRect) -> AppUpdateBlocker {\n-\n+  class func instanceFromNib(\n+    frame: CGRect,\n+    detail: JSONDictionary\n+  ) -> AppUpdateBlocker {\n     let view =\n-      UINib(nibName: \"AppUpdateBlocker\", bundle: nil).instantiate(\n-        withOwner: nil,\n-        options: nil\n-      )[0] as! AppUpdateBlocker\n+      UINib(nibName: \"AppUpdateBlocker\", bundle: nil).instantiate(withOwner: nil, options: nil)[0] as! AppUpdateBlocker\n     view.frame = frame\n     view.layoutIfNeeded()\n     return view\n+  }\n \n+  func configureView(with latestVersion: String) {\n+    self.buttonUpgrade.layer.borderColor = #colorLiteral(red: 0, green: 0.4862745098, blue: 0.7294117647, alpha: 1)\n+    self.labelMessage.text = LocalizableString.blockerScreenLabelText.localizedString\n+    self.appIconView.image = self.appIcon\n   }\n \n-  // MARK: - Action\n+  // MARK: - Actions\n \n   @IBAction func buttonUpgradeAction() {\n-    guard\n-      let url = URL(\n-        string: \"https://itunes.apple.com/us/app/fda-my-studies/id1242835330?ls=1&mt=8\"\n-      )\n-    else { return }\n-    if UIApplication.shared.canOpenURL(url) {\n+    guard let appleID = Branding.appleID, !appleID.isEmpty else {\n+      // Ask user to update from AppStore.\n+      self.makeToast(LocalizableString.appStoreUpdateText.localizedString)\n+      return\n+    }\n+    let appStoreLink = \"https://apps.apple.com/app/apple-store\"\n+    let appLink = appStoreLink + \"/id\" + appleID", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9887db0988656e428360e02d1fa47a2fedfdf054"}, "originalPosition": 64}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjU5NTAxNg==", "bodyText": "This is a new URL and not any country-specific. We have tested this and redirection works fine with any country App Apple ID.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/798#discussion_r476595016", "createdAt": "2020-08-25T16:53:08Z", "author": {"login": "tushar-boston"}, "path": "iOS/HPHC/HPHC/Views/UIViews+Additions/ForceUpdate/AppUpdateBlocker.swift", "diffHunk": "@@ -35,28 +49,34 @@ class AppUpdateBlocker: UIView {\n   /// - Parameters:\n   ///   - frame: Rect for the view\n   /// - Returns: New object of `AppUpdateBlocker` Type\n-  class func instanceFromNib(frame: CGRect) -> AppUpdateBlocker {\n-\n+  class func instanceFromNib(\n+    frame: CGRect,\n+    detail: JSONDictionary\n+  ) -> AppUpdateBlocker {\n     let view =\n-      UINib(nibName: \"AppUpdateBlocker\", bundle: nil).instantiate(\n-        withOwner: nil,\n-        options: nil\n-      )[0] as! AppUpdateBlocker\n+      UINib(nibName: \"AppUpdateBlocker\", bundle: nil).instantiate(withOwner: nil, options: nil)[0] as! AppUpdateBlocker\n     view.frame = frame\n     view.layoutIfNeeded()\n     return view\n+  }\n \n+  func configureView(with latestVersion: String) {\n+    self.buttonUpgrade.layer.borderColor = #colorLiteral(red: 0, green: 0.4862745098, blue: 0.7294117647, alpha: 1)\n+    self.labelMessage.text = LocalizableString.blockerScreenLabelText.localizedString\n+    self.appIconView.image = self.appIcon\n   }\n \n-  // MARK: - Action\n+  // MARK: - Actions\n \n   @IBAction func buttonUpgradeAction() {\n-    guard\n-      let url = URL(\n-        string: \"https://itunes.apple.com/us/app/fda-my-studies/id1242835330?ls=1&mt=8\"\n-      )\n-    else { return }\n-    if UIApplication.shared.canOpenURL(url) {\n+    guard let appleID = Branding.appleID, !appleID.isEmpty else {\n+      // Ask user to update from AppStore.\n+      self.makeToast(LocalizableString.appStoreUpdateText.localizedString)\n+      return\n+    }\n+    let appStoreLink = \"https://apps.apple.com/app/apple-store\"\n+    let appLink = appStoreLink + \"/id\" + appleID", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQ3MzY4NA=="}, "originalCommit": {"oid": "9887db0988656e428360e02d1fa47a2fedfdf054"}, "originalPosition": 64}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjk3ODg0NzQ2OnYy", "diffSide": "RIGHT", "path": "iOS/HPHC/HPHC/Branding/Branding.swift", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxNDowNDozMlrOHGZscg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yNVQxNzowMTowMVrOHGhWsA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQ3NDQ4Mg==", "bodyText": "typo: AppStore Connect\nplease provide an example of what this ID looks like", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/798#discussion_r476474482", "createdAt": "2020-08-25T14:04:32Z", "author": {"login": "zohrehj"}, "path": "iOS/HPHC/HPHC/Branding/Branding.swift", "diffHunk": "@@ -107,4 +108,9 @@ enum Branding {\n     return brandConfig[JSONKey.standaloneStudyID] as? String ?? \"\"\n   }\n \n+  /// Unique ID of the App generated by Apple on AppStore Conect.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9887db0988656e428360e02d1fa47a2fedfdf054"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjU5OTk4NA==", "bodyText": "Updated.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/798#discussion_r476599984", "createdAt": "2020-08-25T17:01:01Z", "author": {"login": "tushar-boston"}, "path": "iOS/HPHC/HPHC/Branding/Branding.swift", "diffHunk": "@@ -107,4 +108,9 @@ enum Branding {\n     return brandConfig[JSONKey.standaloneStudyID] as? String ?? \"\"\n   }\n \n+  /// Unique ID of the App generated by Apple on AppStore Conect.", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQ3NDQ4Mg=="}, "originalCommit": {"oid": "9887db0988656e428360e02d1fa47a2fedfdf054"}, "originalPosition": 12}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 2185, "cost": 1, "resetAt": "2021-11-12T19:05:54Z"}}}