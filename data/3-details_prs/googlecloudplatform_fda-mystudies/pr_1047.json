{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkzNTkwNTI2", "number": 1047, "title": "Study Builder - Audit log Implementation for Login and Users Controller with Test Cases", "bodyText": "Audit log Implementation for Login and Users Controller with Test Cases\nCode Format + Organize imports", "createdAt": "2020-09-26T15:26:14Z", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1047", "merged": true, "mergeCommit": {"oid": "41d905ed028fc00e9ceafa690dd55e210ad9875c"}, "closed": true, "closedAt": "2020-09-30T14:48:13Z", "author": {"login": "chiranjibi009"}, "timelineItems": {"totalCount": 21, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdMRdaFAH2gAyNDkzNTkwNTI2OmIxYmM5M2FmZDhiOTExYzlhMGUzMzFkNjExMDU1NzNiN2U3YmU5ZDA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdN98HFgFqTQ5OTUxMzY2Mw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b1bc93afd8b911c9a0e331d61105573b7e7be9d0", "author": {"user": {"login": "chiranjibi009", "name": "Chiranjibi Dash"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/b1bc93afd8b911c9a0e331d61105573b7e7be9d0", "committedDate": "2020-09-25T08:24:50Z", "message": "user and login controller test cases has been implemented"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bba595c71c716857dea31077a6b1a405aed19675", "author": {"user": {"login": "chiranjibi009", "name": "Chiranjibi Dash"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/bba595c71c716857dea31077a6b1a405aed19675", "committedDate": "2020-09-25T15:46:03Z", "message": "audit log test cases implemented for login controller"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0386e5a0582e19de170375c63828cd48a43a114f", "author": {"user": {"login": "chiranjibi009", "name": "Chiranjibi Dash"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/0386e5a0582e19de170375c63828cd48a43a114f", "committedDate": "2020-09-26T08:05:45Z", "message": "user controller auditlog test cases implemented"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "12251136e8bc83a830f8416a945e1a3a81843266", "author": {"user": {"login": "chiranjibi009", "name": "Chiranjibi Dash"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/12251136e8bc83a830f8416a945e1a3a81843266", "committedDate": "2020-09-26T14:48:26Z", "message": "code formatted and bug fixed for login and user controller"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fb1a5e589dc3aeded860f9225959a3ff473cf738", "author": {"user": {"login": "chiranjibi009", "name": "Chiranjibi Dash"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/fb1a5e589dc3aeded860f9225959a3ff473cf738", "committedDate": "2020-09-26T15:23:27Z", "message": "Merge branch 'develop' of https://github.com/GoogleCloudPlatform/fda-mystudies into study-builder-login-user-controller-auditlog-test-cases\n\n# Conflicts:\n#\tWCP/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/common/StudyBuilderAuditEvent.java\n#\tWCP/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/common/StudyBuilderConstants.java\n#\tWCP/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/controller/DashBoardAndProfileController.java\n#\tWCP/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/controller/NotificationController.java\n#\tWCP/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/controller/UsersController.java\n#\tWCP/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/dao/NotificationDAOImpl.java\n#\tWCP/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/dao/StudyDAO.java\n#\tWCP/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/service/DashBoardAndProfileServiceImpl.java\n#\tWCP/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/service/LoginServiceImpl.java\n#\tWCP/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/service/UsersServiceImpl.java\n#\tWCP/fdahpStudyDesigner/src/test/java/com/fdahpstudydesigner/common/BaseMockIT.java\n#\tWCP/fdahpStudyDesigner/src/test/java/com/fdahpstudydesigner/common/PathMappingUri.java\n#\tWCP/fdahpStudyDesigner/src/test/resources/import.sql"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "85bdafd1a2e014acf672a47d668fa81e0c2e67dc", "author": {"user": {"login": "chiranjibi009", "name": "Chiranjibi Dash"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/85bdafd1a2e014acf672a47d668fa81e0c2e67dc", "committedDate": "2020-09-26T15:25:14Z", "message": "code formatted and organized imported"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1261aa43921fe1558e70a3e32399018da1be5333", "author": {"user": {"login": "chiranjibi009", "name": "Chiranjibi Dash"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/1261aa43921fe1558e70a3e32399018da1be5333", "committedDate": "2020-09-28T09:25:15Z", "message": "build issue fixed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3985904233a8dfe2e82e26fed44a05794eb2a04e", "author": {"user": {"login": "Kantharajut-btc", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/3985904233a8dfe2e82e26fed44a05794eb2a04e", "committedDate": "2020-09-28T14:02:12Z", "message": "Merge branch 'develop' into study-builder-login-user-controller-auditlog-test-cases"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b06a33f2a822bfdd914e2be5fc5518c478c9482d", "author": {"user": {"login": "chiranjibi009", "name": "Chiranjibi Dash"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/b06a33f2a822bfdd914e2be5fc5518c478c9482d", "committedDate": "2020-09-28T17:12:25Z", "message": "Merge branch 'develop' into study-builder-login-user-controller-auditlog-test-cases"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3Nzc1NTU4", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1047#pullrequestreview-497775558", "createdAt": "2020-09-28T18:06:33Z", "commit": {"oid": "3985904233a8dfe2e82e26fed44a05794eb2a04e"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxODowODoyNVrOHZJ-VQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxODowODoyNVrOHZJ-VQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjEzOTg2MQ==", "bodyText": "typo, please rename", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1047#discussion_r496139861", "createdAt": "2020-09-28T18:08:25Z", "author": {"login": "saminguyen"}, "path": "WCP/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/controller/UsersController.java", "diffHunk": "@@ -62,6 +79,8 @@\n \n   @Autowired private UsersService usersService;\n \n+  @Autowired private StudyBuilderAuditEventHelper auditLogEvEntHelper;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b06a33f2a822bfdd914e2be5fc5518c478c9482d"}, "originalPosition": 39}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk3Nzk0NDM5", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1047#pullrequestreview-497794439", "createdAt": "2020-09-28T18:33:42Z", "commit": {"oid": "b06a33f2a822bfdd914e2be5fc5518c478c9482d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxODozMzo0MlrOHZKzpQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0yOFQxODozMzo0MlrOHZKzpQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjE1MzUwOQ==", "bodyText": "Do we not check for the values being passed into the audit event in unit tests? We should check if the audit event call has the correct ${edited_user_id}, and same with other audit log requests", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1047#discussion_r496153509", "createdAt": "2020-09-28T18:33:42Z", "author": {"login": "saminguyen"}, "path": "WCP/fdahpStudyDesigner/src/test/java/com/fdahpstudydesigner/controller/UsersControllerTest.java", "diffHunk": "@@ -0,0 +1,204 @@\n+package com.fdahpstudydesigner.controller;\n+\n+import static com.fdahpstudydesigner.common.StudyBuilderAuditEvent.ACCOUNT_DETAILS_VIEWED;\n+import static com.fdahpstudydesigner.common.StudyBuilderAuditEvent.NEW_USER_CREATION_FAILED;\n+import static com.fdahpstudydesigner.common.StudyBuilderAuditEvent.PASSWORD_CHANGE_ENFORCED_FOR_ALL_USERS;\n+import static com.fdahpstudydesigner.common.StudyBuilderAuditEvent.PASSWORD_CHANGE_ENFORCED_FOR_USER;\n+import static com.fdahpstudydesigner.common.StudyBuilderAuditEvent.PASSWORD_CHANGE_ENFORCEMENT_EMAIL_FAILED;\n+import static com.fdahpstudydesigner.common.StudyBuilderAuditEvent.PASSWORD_HELP_EMAIL_FAILED;\n+import static com.fdahpstudydesigner.common.StudyBuilderAuditEvent.USER_ACCOUNT_UPDATED_FAILED;\n+import static com.fdahpstudydesigner.common.StudyBuilderAuditEvent.USER_RECORD_VIEWED;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.post;\n+import static org.springframework.test.web.servlet.result.MockMvcResultHandlers.print;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.view;\n+import com.fdahpstudydesigner.common.BaseMockIT;\n+import com.fdahpstudydesigner.common.PathMappingUri;\n+import com.fdahpstudydesigner.util.FdahpStudyDesignerConstants;\n+import com.fdahpstudydesigner.util.SessionObject;\n+import java.util.HashMap;\n+import java.util.UUID;\n+import org.junit.Test;\n+import org.springframework.http.HttpHeaders;\n+\n+public class UsersControllerTest extends BaseMockIT {\n+\n+  @Test\n+  public void shouldViewUserDetails() throws Exception {\n+    HttpHeaders headers = getCommonHeaders();\n+\n+    mockMvc\n+        .perform(\n+            post(PathMappingUri.VIEW_USER_DETAILS.getPath())\n+                .param(\"userId\", \"2\")\n+                .param(\"checkViewRefreshFlag\", \"true\")\n+                .headers(headers)\n+                .sessionAttrs(getSession()))\n+        .andDo(print())\n+        .andExpect(status().isOk())\n+        .andExpect(view().name(\"addOrEditUserPage\"));\n+\n+    verifyAuditEventCall(ACCOUNT_DETAILS_VIEWED);\n+  }\n+\n+  @Test\n+  public void shouldUserRecordViewed() throws Exception {\n+    HttpHeaders headers = getCommonHeaders();\n+\n+    SessionObject session = new SessionObject();\n+    session.setSessionId(UUID.randomUUID().toString());\n+    session.setEmail(\"super@gmail.com\");\n+    session.setFirstName(\"firstname\");\n+    session.setLastName(\"lastname\");\n+    session.setAccessLevel(\"2\");\n+    session.setUserId(1);\n+\n+    HashMap<String, Object> sessionAttributes = new HashMap<String, Object>();\n+    sessionAttributes.put(FdahpStudyDesignerConstants.SESSION_OBJECT, session);\n+\n+    mockMvc\n+        .perform(\n+            post(PathMappingUri.VIEW_USER_DETAILS.getPath())\n+                .param(\"userId\", \"2\")\n+                .param(\"checkViewRefreshFlag\", \"true\")\n+                .headers(headers)\n+                .sessionAttrs(sessionAttributes))\n+        .andDo(print())\n+        .andExpect(status().isOk())\n+        .andExpect(view().name(\"addOrEditUserPage\"));\n+\n+    verifyAuditEventCall(USER_RECORD_VIEWED);\n+  }\n+\n+  @Test\n+  public void shouldResendActivateDetailsLink() throws Exception {\n+    HttpHeaders headers = getCommonHeaders();\n+\n+    mockMvc\n+        .perform(\n+            post(PathMappingUri.RESEND_ACTIVATE_DETAILS_LINK.getPath())\n+                .param(\"userId\", \"2\")\n+                .headers(headers)\n+                .sessionAttrs(getSession()))\n+        .andDo(print())\n+        .andExpect(status().isFound())\n+        .andExpect(view().name(\"redirect:/adminUsersView/getUserList.do\"));\n+\n+    // H2 database doesn't support Column \"BINARY\". Expect LoginDAOImpl throws\n+    // org.h2.jdbc.JdbcSQLException: Column \"BINARY\" not found;\n+    verifyAuditEventCall(PASSWORD_HELP_EMAIL_FAILED);\n+  }\n+\n+  @Test\n+  public void shouldEnforcePasswordChange() throws Exception {\n+    HttpHeaders headers = getCommonHeaders();\n+\n+    mockMvc\n+        .perform(\n+            post(PathMappingUri.ENFORCE_PASSWORD_CHANGE.getPath())\n+                .param(\"changePassworduserId\", \"2\")\n+                .param(\"emailId\", \"super@gmail.com\")\n+                .headers(headers)\n+                .sessionAttrs(getSession()))\n+        .andDo(print())\n+        .andExpect(status().isFound())\n+        .andExpect(view().name(\"redirect:/adminUsersView/getUserList.do\"));\n+\n+    verifyAuditEventCall(PASSWORD_CHANGE_ENFORCED_FOR_USER);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b06a33f2a822bfdd914e2be5fc5518c478c9482d"}, "originalPosition": 107}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a611ef53a9c51c67bc8ccf3def2ddc1c43540c8b", "author": {"user": {"login": "chiranjibi009", "name": "Chiranjibi Dash"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/a611ef53a9c51c67bc8ccf3def2ddc1c43540c8b", "committedDate": "2020-09-29T04:33:23Z", "message": "typo error fixed"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "87dc720f8a200e91c5663dac0212f3900dd04d13", "author": {"user": {"login": "chiranjibi009", "name": "Chiranjibi Dash"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/87dc720f8a200e91c5663dac0212f3900dd04d13", "committedDate": "2020-09-29T05:28:42Z", "message": "Merge branch 'develop' of https://github.com/GoogleCloudPlatform/fda-mystudies into study-builder-login-user-controller-auditlog-test-cases\n\n# Conflicts:\n#\tWCP/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/common/StudyBuilderAuditEvent.java\n#\tWCP/fdahpStudyDesigner/src/test/java/com/fdahpstudydesigner/common/PathMappingUri.java\n#\tWCP/fdahpStudyDesigner/src/test/java/com/fdahpstudydesigner/controller/StudyControllerTest.java\n#\tWCP/fdahpStudyDesigner/src/test/resources/import.sql"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "570ceb527046eff0396181d4ee4f044f149dab2c", "author": {"user": {"login": "chiranjibi009", "name": "Chiranjibi Dash"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/570ceb527046eff0396181d4ee4f044f149dab2c", "committedDate": "2020-09-29T08:58:28Z", "message": "missing audit log added"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3a9710d53b3c0bc40659dcaf7b89ac2b3ef6ebeb", "author": {"user": {"login": "chiranjibi009", "name": "Chiranjibi Dash"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/3a9710d53b3c0bc40659dcaf7b89ac2b3ef6ebeb", "committedDate": "2020-09-29T11:57:47Z", "message": "events added with test cases"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0e66df7e36dcd6d224f02d7830ce0507c9a8f5f1", "author": {"user": {"login": "chiranjibi009", "name": "Chiranjibi Dash"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/0e66df7e36dcd6d224f02d7830ce0507c9a8f5f1", "committedDate": "2020-09-29T16:38:08Z", "message": "Merge branch 'develop' of https://github.com/GoogleCloudPlatform/fda-mystudies into study-builder-login-user-controller-auditlog-test-cases\n\n# Conflicts:\n#\tWCP/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/service/LoginServiceImpl.java\n#\tWCP/fdahpStudyDesigner/src/test/resources/import.sql"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "566e5b6240ec497525e44a93e71f4acfa006f17f", "author": {"user": {"login": "chiranjibi009", "name": "Chiranjibi Dash"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/566e5b6240ec497525e44a93e71f4acfa006f17f", "committedDate": "2020-09-29T16:42:54Z", "message": "typo error fixed"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk4ODgyODA0", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1047#pullrequestreview-498882804", "createdAt": "2020-09-29T20:51:19Z", "commit": {"oid": "566e5b6240ec497525e44a93e71f4acfa006f17f"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "afa6c3b5b6f47918e4107dfdd8add72ae55150df", "author": {"user": {"login": "saminguyen", "name": "Sami Nguyen"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/afa6c3b5b6f47918e4107dfdd8add72ae55150df", "committedDate": "2020-09-29T20:51:25Z", "message": "Merge branch 'develop' into study-builder-login-user-controller-auditlog-test-cases"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ec6ff0c3cc9a8e2f69a3bb8b17d4d0c38140529a", "author": {"user": {"login": "chiranjibi009", "name": "Chiranjibi Dash"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/ec6ff0c3cc9a8e2f69a3bb8b17d4d0c38140529a", "committedDate": "2020-09-30T05:43:00Z", "message": "Merge branch 'develop' of https://github.com/GoogleCloudPlatform/fda-mystudies into study-builder-login-user-controller-auditlog-test-cases\n\n# Conflicts:\n#\tWCP/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/common/StudyBuilderAuditEvent.java"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDk5NTEzNjYz", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1047#pullrequestreview-499513663", "createdAt": "2020-09-30T14:48:07Z", "commit": {"oid": "ec6ff0c3cc9a8e2f69a3bb8b17d4d0c38140529a"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 317, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}