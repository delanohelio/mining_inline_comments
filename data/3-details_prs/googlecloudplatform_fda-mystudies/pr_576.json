{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQwODU0OTMw", "number": 576, "title": "/v1/oauth2/token endpoint implementation with integration tests", "bodyText": "/v1/oauth2/token endpoint implementation with integration tests", "createdAt": "2020-06-27T03:42:08Z", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/576", "merged": true, "mergeCommit": {"oid": "a172b3fb1037c1b0375edc147da3f6f2639e0605"}, "closed": true, "closedAt": "2020-07-17T07:55:34Z", "author": {"login": "dhanyak-btc"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcvPdWAgH2gAyNDQwODU0OTMwOmYxNWRhYWRkZjRiODRmOTEwNzMzNWM5NzBiNTgxYjc2ZTUzYWRiZTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc1vDgPAH2gAyNDQwODU0OTMwOmFjZTI1MTYxYjg3OGM3MWIwZWFmNGZiYjRmYWFmOGY3NDc5Y2Y5M2M=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "f15daaddf4b84f9107335c970b581b76e53adbe7", "author": {"user": {"login": "dhanyak-btc", "name": "Dhanya Kumar KV"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/f15daaddf4b84f9107335c970b581b76e53adbe7", "committedDate": "2020-06-27T03:41:09Z", "message": "/v1/oauth2/token endpoint implementation with integration tests\n\n/v1/oauth2/token endpoint implementation with integration tests"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ0MzcyMDY4", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/576#pullrequestreview-444372068", "createdAt": "2020-07-08T02:33:55Z", "commit": {"oid": "f15daaddf4b84f9107335c970b581b76e53adbe7"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwMjozMzo1NlrOGuV91A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wOFQwMjo1NzoyOVrOGuWViw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTI0NzU3Mg==", "bodyText": "any reason why we are storing test files in __files directory? is that a common pattern?", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/576#discussion_r451247572", "createdAt": "2020-07-08T02:33:56Z", "author": {"login": "zohrehj"}, "path": "common-modules/common-tests/src/main/resources/__files/hydra/authroization_code_token_response.json", "diffHunk": "@@ -0,0 +1,8 @@\n+{", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f15daaddf4b84f9107335c970b581b76e53adbe7"}, "originalPosition": 1}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTI0Nzg3Ng==", "bodyText": "indented with tab, other files are using 4-spaces. Indentation should be consistent and follow style guide.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/576#discussion_r451247876", "createdAt": "2020-07-08T02:35:11Z", "author": {"login": "zohrehj"}, "path": "common-modules/common-tests/src/main/resources/mappings/hydra/authorization_code_token_request.json", "diffHunk": "@@ -0,0 +1,18 @@\n+{\n+\t\"request\": {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f15daaddf4b84f9107335c970b581b76e53adbe7"}, "originalPosition": 2}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTI0OTc4MA==", "bodyText": "you have defined grantType above. just use that.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/576#discussion_r451249780", "createdAt": "2020-07-08T02:42:33Z", "author": {"login": "zohrehj"}, "path": "oauth-scim-module/oauth-scim-service/src/main/java/com/google/cloud/healthcare/fdamystudies/oauthscim/controller/OAuthController.java", "diffHunk": "@@ -0,0 +1,83 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.oauthscim.controller;\n+\n+import static com.google.cloud.healthcare.fdamystudies.common.RequestParamValidator.validateRequiredParams;\n+import static com.google.cloud.healthcare.fdamystudies.oauthscim.common.AuthScimConstants.AUTHORIZATION_CODE;\n+import static com.google.cloud.healthcare.fdamystudies.oauthscim.common.AuthScimConstants.CLIENT_ID;\n+import static com.google.cloud.healthcare.fdamystudies.oauthscim.common.AuthScimConstants.CODE;\n+import static com.google.cloud.healthcare.fdamystudies.oauthscim.common.AuthScimConstants.CODE_VERIFIER;\n+import static com.google.cloud.healthcare.fdamystudies.oauthscim.common.AuthScimConstants.GRANT_TYPE;\n+import static com.google.cloud.healthcare.fdamystudies.oauthscim.common.AuthScimConstants.REDIRECT_URI;\n+import static com.google.cloud.healthcare.fdamystudies.oauthscim.common.AuthScimConstants.REFRESH_TOKEN;\n+import static com.google.cloud.healthcare.fdamystudies.oauthscim.common.AuthScimConstants.SCOPE;\n+import static com.google.cloud.healthcare.fdamystudies.oauthscim.common.AuthScimConstants.USER_ID;\n+\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.google.cloud.healthcare.fdamystudies.beans.ValidationErrorResponse;\n+import com.google.cloud.healthcare.fdamystudies.oauthscim.service.OAuthService;\n+import javax.servlet.http.HttpServletRequest;\n+import org.slf4j.ext.XLogger;\n+import org.slf4j.ext.XLoggerFactory;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpHeaders;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.http.MediaType;\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.util.MultiValueMap;\n+import org.springframework.web.bind.annotation.CrossOrigin;\n+import org.springframework.web.bind.annotation.PostMapping;\n+import org.springframework.web.bind.annotation.RequestHeader;\n+import org.springframework.web.bind.annotation.RequestMapping;\n+import org.springframework.web.bind.annotation.RequestParam;\n+import org.springframework.web.bind.annotation.RestController;\n+\n+@CrossOrigin\n+@RestController\n+@RequestMapping(\"/v1\")\n+public class OAuthController {\n+\n+  private XLogger logger = XLoggerFactory.getXLogger(OAuthController.class.getName());\n+\n+  @Autowired private OAuthService oauthService;\n+\n+  @PostMapping(\n+      value = \"/oauth2/token\",\n+      produces = MediaType.APPLICATION_JSON_VALUE,\n+      consumes = MediaType.APPLICATION_FORM_URLENCODED_VALUE)\n+  public ResponseEntity<?> getToken(\n+      @RequestParam MultiValueMap<String, String> paramMap,\n+      @RequestHeader HttpHeaders headers,\n+      HttpServletRequest request) {\n+    logger.entry(String.format(\"begin %s request\", request.getRequestURI()));\n+\n+    String grantType = paramMap.getFirst(GRANT_TYPE);\n+\n+    // validate required params\n+    ValidationErrorResponse errors = null;\n+    if (REFRESH_TOKEN.equals(paramMap.getFirst(GRANT_TYPE))) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f15daaddf4b84f9107335c970b581b76e53adbe7"}, "originalPosition": 64}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTI1MDE3OQ==", "bodyText": "nit: could be more readable as a switch statement.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/576#discussion_r451250179", "createdAt": "2020-07-08T02:44:04Z", "author": {"login": "zohrehj"}, "path": "oauth-scim-module/oauth-scim-service/src/main/java/com/google/cloud/healthcare/fdamystudies/oauthscim/controller/OAuthController.java", "diffHunk": "@@ -0,0 +1,83 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.oauthscim.controller;\n+\n+import static com.google.cloud.healthcare.fdamystudies.common.RequestParamValidator.validateRequiredParams;\n+import static com.google.cloud.healthcare.fdamystudies.oauthscim.common.AuthScimConstants.AUTHORIZATION_CODE;\n+import static com.google.cloud.healthcare.fdamystudies.oauthscim.common.AuthScimConstants.CLIENT_ID;\n+import static com.google.cloud.healthcare.fdamystudies.oauthscim.common.AuthScimConstants.CODE;\n+import static com.google.cloud.healthcare.fdamystudies.oauthscim.common.AuthScimConstants.CODE_VERIFIER;\n+import static com.google.cloud.healthcare.fdamystudies.oauthscim.common.AuthScimConstants.GRANT_TYPE;\n+import static com.google.cloud.healthcare.fdamystudies.oauthscim.common.AuthScimConstants.REDIRECT_URI;\n+import static com.google.cloud.healthcare.fdamystudies.oauthscim.common.AuthScimConstants.REFRESH_TOKEN;\n+import static com.google.cloud.healthcare.fdamystudies.oauthscim.common.AuthScimConstants.SCOPE;\n+import static com.google.cloud.healthcare.fdamystudies.oauthscim.common.AuthScimConstants.USER_ID;\n+\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.google.cloud.healthcare.fdamystudies.beans.ValidationErrorResponse;\n+import com.google.cloud.healthcare.fdamystudies.oauthscim.service.OAuthService;\n+import javax.servlet.http.HttpServletRequest;\n+import org.slf4j.ext.XLogger;\n+import org.slf4j.ext.XLoggerFactory;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpHeaders;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.http.MediaType;\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.util.MultiValueMap;\n+import org.springframework.web.bind.annotation.CrossOrigin;\n+import org.springframework.web.bind.annotation.PostMapping;\n+import org.springframework.web.bind.annotation.RequestHeader;\n+import org.springframework.web.bind.annotation.RequestMapping;\n+import org.springframework.web.bind.annotation.RequestParam;\n+import org.springframework.web.bind.annotation.RestController;\n+\n+@CrossOrigin\n+@RestController\n+@RequestMapping(\"/v1\")\n+public class OAuthController {\n+\n+  private XLogger logger = XLoggerFactory.getXLogger(OAuthController.class.getName());\n+\n+  @Autowired private OAuthService oauthService;\n+\n+  @PostMapping(\n+      value = \"/oauth2/token\",\n+      produces = MediaType.APPLICATION_JSON_VALUE,\n+      consumes = MediaType.APPLICATION_FORM_URLENCODED_VALUE)\n+  public ResponseEntity<?> getToken(\n+      @RequestParam MultiValueMap<String, String> paramMap,\n+      @RequestHeader HttpHeaders headers,\n+      HttpServletRequest request) {\n+    logger.entry(String.format(\"begin %s request\", request.getRequestURI()));\n+\n+    String grantType = paramMap.getFirst(GRANT_TYPE);\n+\n+    // validate required params\n+    ValidationErrorResponse errors = null;\n+    if (REFRESH_TOKEN.equals(paramMap.getFirst(GRANT_TYPE))) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTI0OTc4MA=="}, "originalCommit": {"oid": "f15daaddf4b84f9107335c970b581b76e53adbe7"}, "originalPosition": 64}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTI1MTU0Nw==", "bodyText": "this piece is getting repeated everywhere, it would be nice to extract and reuse it instead.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/576#discussion_r451251547", "createdAt": "2020-07-08T02:49:47Z", "author": {"login": "zohrehj"}, "path": "oauth-scim-module/oauth-scim-service/src/main/java/com/google/cloud/healthcare/fdamystudies/oauthscim/service/HydraOAuthServiceImpl.java", "diffHunk": "@@ -0,0 +1,54 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.oauthscim.service;\n+\n+import static com.google.cloud.healthcare.fdamystudies.oauthscim.common.AuthScimConstants.AUTHORIZATION;\n+import static com.google.cloud.healthcare.fdamystudies.oauthscim.common.AuthScimConstants.GRANT_TYPE;\n+import static com.google.cloud.healthcare.fdamystudies.oauthscim.common.AuthScimConstants.REFRESH_TOKEN;\n+\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.google.cloud.healthcare.fdamystudies.service.BaseServiceImpl;\n+import java.util.Base64;\n+import javax.annotation.PostConstruct;\n+import org.springframework.beans.factory.annotation.Value;\n+import org.springframework.http.HttpHeaders;\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.stereotype.Service;\n+import org.springframework.util.MultiValueMap;\n+\n+@Service\n+class HydraOAuthServiceImpl extends BaseServiceImpl implements OAuthService {\n+\n+  @Value(\"${security.oauth2.hydra.token_endpoint}\")\n+  private String tokenEndpoint;\n+\n+  @Value(\"${security.oauth2.hydra.client.client-id}\")\n+  private String clientId;\n+\n+  @Value(\"${security.oauth2.hydra.client.client-secret}\")\n+  private String clientSecret;\n+\n+  private String encodedAuthorization;\n+\n+  @PostConstruct\n+  public void init() {\n+    String credentials = clientId + \":\" + clientSecret;\n+    encodedAuthorization = \"Basic \" + Base64.getEncoder().encodeToString(credentials.getBytes());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f15daaddf4b84f9107335c970b581b76e53adbe7"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTI1MzY0Mw==", "bodyText": "As far as I know this is the only server with versioning in the URL, I don't remember any designs or plans to include versioning here; please explain this approach and share the appropriate design doc/discussion with me.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/576#discussion_r451253643", "createdAt": "2020-07-08T02:57:29Z", "author": {"login": "zohrehj"}, "path": "oauth-scim-module/oauth-scim-service/src/main/java/com/google/cloud/healthcare/fdamystudies/oauthscim/controller/OAuthController.java", "diffHunk": "@@ -0,0 +1,83 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.oauthscim.controller;\n+\n+import static com.google.cloud.healthcare.fdamystudies.common.RequestParamValidator.validateRequiredParams;\n+import static com.google.cloud.healthcare.fdamystudies.oauthscim.common.AuthScimConstants.AUTHORIZATION_CODE;\n+import static com.google.cloud.healthcare.fdamystudies.oauthscim.common.AuthScimConstants.CLIENT_ID;\n+import static com.google.cloud.healthcare.fdamystudies.oauthscim.common.AuthScimConstants.CODE;\n+import static com.google.cloud.healthcare.fdamystudies.oauthscim.common.AuthScimConstants.CODE_VERIFIER;\n+import static com.google.cloud.healthcare.fdamystudies.oauthscim.common.AuthScimConstants.GRANT_TYPE;\n+import static com.google.cloud.healthcare.fdamystudies.oauthscim.common.AuthScimConstants.REDIRECT_URI;\n+import static com.google.cloud.healthcare.fdamystudies.oauthscim.common.AuthScimConstants.REFRESH_TOKEN;\n+import static com.google.cloud.healthcare.fdamystudies.oauthscim.common.AuthScimConstants.SCOPE;\n+import static com.google.cloud.healthcare.fdamystudies.oauthscim.common.AuthScimConstants.USER_ID;\n+\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.google.cloud.healthcare.fdamystudies.beans.ValidationErrorResponse;\n+import com.google.cloud.healthcare.fdamystudies.oauthscim.service.OAuthService;\n+import javax.servlet.http.HttpServletRequest;\n+import org.slf4j.ext.XLogger;\n+import org.slf4j.ext.XLoggerFactory;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.HttpHeaders;\n+import org.springframework.http.HttpStatus;\n+import org.springframework.http.MediaType;\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.util.MultiValueMap;\n+import org.springframework.web.bind.annotation.CrossOrigin;\n+import org.springframework.web.bind.annotation.PostMapping;\n+import org.springframework.web.bind.annotation.RequestHeader;\n+import org.springframework.web.bind.annotation.RequestMapping;\n+import org.springframework.web.bind.annotation.RequestParam;\n+import org.springframework.web.bind.annotation.RestController;\n+\n+@CrossOrigin\n+@RestController\n+@RequestMapping(\"/v1\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f15daaddf4b84f9107335c970b581b76e53adbe7"}, "originalPosition": 43}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7ccbd6b280c1e63e910378b11d34fb6fe1dcb135", "author": {"user": {"login": "dhanyak-btc", "name": "Dhanya Kumar KV"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/7ccbd6b280c1e63e910378b11d34fb6fe1dcb135", "committedDate": "2020-07-08T06:20:02Z", "message": "PR#576: Fixed Review Comments\n\nRemoved /v1 from API endpoints\nReplaced if..elseif with switch in OAuthController classes\nFormatted JSON files using JSON Editor Plugin 1.1.2"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ0NzgyNDY5", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/576#pullrequestreview-444782469", "createdAt": "2020-07-08T13:48:25Z", "commit": {"oid": "7ccbd6b280c1e63e910378b11d34fb6fe1dcb135"}, "state": "DISMISSED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "794437c2e0fea43f20f61cc1033a220360164d9f", "author": {"user": {"login": "dhanyak-btc", "name": "Dhanya Kumar KV"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/794437c2e0fea43f20f61cc1033a220360164d9f", "committedDate": "2020-07-13T11:03:25Z", "message": "Merge branch 'develop' into oauth-scim-module_token_endpoint"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQ5MjA2ODEx", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/576#pullrequestreview-449206811", "createdAt": "2020-07-15T18:05:14Z", "commit": {"oid": "794437c2e0fea43f20f61cc1033a220360164d9f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ace25161b878c71b0eaf4fbb4faaf8f7479cf93c", "author": {"user": {"login": "dhanyak-btc", "name": "Dhanya Kumar KV"}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/ace25161b878c71b0eaf4fbb4faaf8f7479cf93c", "committedDate": "2020-07-17T07:53:26Z", "message": "Merge branch 'develop' into oauth-scim-module_token_endpoint"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 771, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}