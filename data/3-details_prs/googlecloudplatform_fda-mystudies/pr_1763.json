{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTEzOTM4MTk0", "number": 1763, "title": "Sql Injection issue fixes for StudyQuestionnaireDAOImpl", "bodyText": "Sql Injection issue fixes for StudyQuestionnaireDAOImpl.java class.\nFix for issue #1177", "createdAt": "2020-11-02T09:55:39Z", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1763", "merged": true, "mergeCommit": {"oid": "f7ee556baa7d9e4a3ceb1091e5c816c55e81308d"}, "closed": true, "closedAt": "2020-11-03T13:44:58Z", "author": {"login": "vinuth1488"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdYhdjhAH2gAyNTEzOTM4MTk0OmNmYWJhMDFkMDJlNTkwZjE4YzRmYjM1NGEyZGFhZjU3MzZmMGUzNWQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdY5Y1eAH2gAyNTEzOTM4MTk0OmIyODkwZTY1Yzc5ZmYwYmFiZGYzM2E2MjI2Yjk5Yjk3NDRkMDE3ZWU=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "cfaba01d02e590f18c4fb354a2daaf5736f0e35d", "author": {"user": {"login": "vinuth1488", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/cfaba01d02e590f18c4fb354a2daaf5736f0e35d", "committedDate": "2020-11-02T09:50:34Z", "message": "SQL_Injection queries updated"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIxNzAyMTUz", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1763#pullrequestreview-521702153", "createdAt": "2020-11-02T14:55:23Z", "commit": {"oid": "cfaba01d02e590f18c4fb354a2daaf5736f0e35d"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNDo1NToyM1rOHsHzyQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wMlQxNToyMjoyOVrOHsI-kQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjAyNzMzNw==", "bodyText": ":questionnaireId", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1763#discussion_r516027337", "createdAt": "2020-11-02T14:55:23Z", "author": {"login": "zohrehj"}, "path": "study-builder/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/dao/StudyQuestionnaireDAOImpl.java", "diffHunk": "@@ -3132,22 +3191,26 @@ public String reOrderQuestionnaireSteps(\n               \"update response_sub_type_value rs,questionnaires_steps q set rs.destination_step_id = NULL \"\n                   + \"where rs.response_type_id=q.instruction_form_id and q.step_type='\"\n                   + FdahpStudyDesignerConstants.QUESTION_STEP\n-                  + \"' and q.questionnaires_id=\"\n-                  + questionnaireId\n+                  + \"' and q.questionnaires_id=questionnaireId \"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cfaba01d02e590f18c4fb354a2daaf5736f0e35d"}, "originalPosition": 1444}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjAyODQxMw==", "bodyText": "please pass this as a parameter as well", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1763#discussion_r516028413", "createdAt": "2020-11-02T14:56:52Z", "author": {"login": "zohrehj"}, "path": "study-builder/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/dao/StudyQuestionnaireDAOImpl.java", "diffHunk": "@@ -3404,14 +3473,16 @@ public InstructionsBo saveOrUpdateInstructionsBo(\n         instructionsBo.setQuestionnairesStepsBo(questionnairesStepsBo);\n         if ((questionnairesStepsBo != null) && (count > 0)) {\n           String updateQuery =\n-              \"update QuestionnairesStepsBo QSBO set QSBO.destinationStep=\"\n-                  + questionnairesStepsBo.getStepId()\n+              \"update QuestionnairesStepsBo QSBO set QSBO.destinationStep=:stepId \"\n                   + \" where \"\n                   + \"QSBO.destinationStep=0 and QSBO.sequenceNo=\"\n                   + (count - 1)", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cfaba01d02e590f18c4fb354a2daaf5736f0e35d"}, "originalPosition": 1532}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjAyOTk2Nw==", "bodyText": "nit: :stepType", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1763#discussion_r516029967", "createdAt": "2020-11-02T14:59:05Z", "author": {"login": "zohrehj"}, "path": "study-builder/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/dao/StudyQuestionnaireDAOImpl.java", "diffHunk": "@@ -3572,13 +3645,14 @@ public QuestionsBo saveOrUpdateQuestion(QuestionsBo questionsBo) {\n         if (!questionsBo.getStatus()) {\n           if (questionsBo.getQuestionnaireId() != null) {\n             query =\n-                session.createQuery(\n-                    \"From QuestionnairesStepsBo QSBO where QSBO.instructionFormId=\"\n-                        + questionsBo.getFromId()\n-                        + \" and QSBO.stepType='\"\n-                        + FdahpStudyDesignerConstants.FORM_STEP\n-                        + \"' and QSBO.active=1 and QSBO.questionnairesId=\"\n-                        + questionsBo.getQuestionnaireId());\n+                session\n+                    .createQuery(\n+                        \"From QuestionnairesStepsBo QSBO where QSBO.instructionFormId=:fromId \"\n+                            + \" and QSBO.stepType=:setType \"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cfaba01d02e590f18c4fb354a2daaf5736f0e35d"}, "originalPosition": 1574}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjAzMDcxOA==", "bodyText": "nit: :formId", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1763#discussion_r516030718", "createdAt": "2020-11-02T15:00:07Z", "author": {"login": "zohrehj"}, "path": "study-builder/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/dao/StudyQuestionnaireDAOImpl.java", "diffHunk": "@@ -3609,10 +3684,11 @@ public QuestionsBo saveOrUpdateQuestion(QuestionsBo questionsBo) {\n           formMappingBo.setActive(true);\n           int sequenceNo = 0;\n           query =\n-              session.createQuery(\n-                  \"From FormMappingBo FMBO where FMBO.formId=\"\n-                      + questionsBo.getFromId()\n-                      + \" and FMBO.active=1 order by FMBO.sequenceNo DESC\");\n+              session\n+                  .createQuery(\n+                      \"From FormMappingBo FMBO where FMBO.formId=:fromId \"", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cfaba01d02e590f18c4fb354a2daaf5736f0e35d"}, "originalPosition": 1606}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA0NjE5MA==", "bodyText": "missed midified_date", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1763#discussion_r516046190", "createdAt": "2020-11-02T15:22:02Z", "author": {"login": "zohrehj"}, "path": "study-builder/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/dao/StudyQuestionnaireDAOImpl.java", "diffHunk": "@@ -4648,27 +4786,25 @@ public String updateAnchordateInQuestionnaire(\n                   session\n                       .createSQLQuery(\n                           \"update questionnaires set status=0,anchor_date_id=null,\"\n-                              + \"modified_by=\"\n-                              + sessionObject.getUserId()\n+                              + \"modified_by=:userId \"\n                               + \",modified_date='\"\n                               + FdahpStudyDesignerUtil.getCurrentDateTime()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cfaba01d02e590f18c4fb354a2daaf5736f0e35d"}, "originalPosition": 2168}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjA0NjQ4MQ==", "bodyText": "same here, you missed modified_date", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1763#discussion_r516046481", "createdAt": "2020-11-02T15:22:29Z", "author": {"login": "zohrehj"}, "path": "study-builder/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/dao/StudyQuestionnaireDAOImpl.java", "diffHunk": "@@ -4648,27 +4786,25 @@ public String updateAnchordateInQuestionnaire(\n                   session\n                       .createSQLQuery(\n                           \"update questionnaires set status=0,anchor_date_id=null,\"\n-                              + \"modified_by=\"\n-                              + sessionObject.getUserId()\n+                              + \"modified_by=:userId \"\n                               + \",modified_date='\"\n                               + FdahpStudyDesignerUtil.getCurrentDateTime()\n-                              + \"' where active=1 and anchor_date_id in(\"\n-                              + StringUtils.join(anchorIds, \",\")\n-                              + \")\")\n+                              + \"' where active=1 and anchor_date_id in( :anchorIds ) \")\n+                      .setInteger(\"userId\", sessionObject.getUserId())\n+                      .setParameterList(\"anchorIds\", anchorIds)\n                       .executeUpdate();\n               if (count1 > 0) {\n                 studySequence.setStudyExcQuestionnaries(false);\n               }\n               int count2 =\n                   session\n                       .createSQLQuery(\n-                          \"update active_task set action=0 ,anchor_date_id=null, modified_by=\"\n-                              + sessionObject.getUserId()\n+                          \"update active_task set action=0 ,anchor_date_id=null, modified_by=:userId \"\n                               + \",modified_date='\"\n                               + FdahpStudyDesignerUtil.getCurrentDateTime()", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "cfaba01d02e590f18c4fb354a2daaf5736f0e35d"}, "originalPosition": 2186}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "44f3cd80e8eb6bcc59061a33ff7d549508354ef3", "author": {"user": {"login": "vinuth1488", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/44f3cd80e8eb6bcc59061a33ff7d549508354ef3", "committedDate": "2020-11-03T05:37:40Z", "message": "SQL_Changes asked by zohrehj"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTIyNTAwMTMy", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1763#pullrequestreview-522500132", "createdAt": "2020-11-03T13:37:02Z", "commit": {"oid": "44f3cd80e8eb6bcc59061a33ff7d549508354ef3"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b2890e65c79ff0babdf33a6226b99b9744d017ee", "author": {"user": {"login": "aswinijena100", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/b2890e65c79ff0babdf33a6226b99b9744d017ee", "committedDate": "2020-11-03T13:43:08Z", "message": "Merge branch 'develop' into studybuilder_sql_issues_vinuth2_PR"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1385, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}