{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDc1NTIzMTk1", "number": 851, "title": "Response Server: Integration with OAuth Scim Service for Token Introspection", "bodyText": "Removed old auth server code related to token validation\nAdded TokenIntrospectionFilter with integration tests TokenIntrospectionFilterTest\nAdded AppConfigTest for mockAuditService", "createdAt": "2020-08-28T16:53:01Z", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/851", "merged": true, "mergeCommit": {"oid": "dcc8960184157b1386bed3cd0556a89dc1771967"}, "closed": true, "closedAt": "2020-09-03T14:10:05Z", "author": {"login": "navya-BTC"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdDX6-7gH2gAyNDc1NTIzMTk1OmFhMGExOWY1MWY0ZWQyYjViYmRjZWYyYzhmNGM1YjEyNzBlMmFhNGY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdFRIOzAH2gAyNDc1NTIzMTk1OjhlNjMxMmNkZmI4ZDhlN2U4OTgzMTQ2ZTE4MTQ5NTM1MjJhYzdjMWM=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "aa0a19f51f4ed2b5bbdcef2c8f4c5b1270e2aa4f", "author": {"user": {"login": "navya-BTC", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/aa0a19f51f4ed2b5bbdcef2c8f4c5b1270e2aa4f", "committedDate": "2020-08-28T16:51:15Z", "message": "Response-server Token-introspect\n\nResponse-server Token-introspect"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc3ODg0MDMz", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/851#pullrequestreview-477884033", "createdAt": "2020-08-28T16:53:46Z", "commit": {"oid": "aa0a19f51f4ed2b5bbdcef2c8f4c5b1270e2aa4f"}, "state": "COMMENTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNjo1Mzo0NlrOHJNuaw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0yOFQxNjo1Mzo0NlrOHJNubg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQyNDEwNw==", "bodyText": "[response-server Checks] reported by reviewdog \ud83d\udc36\n'package' should be separated from previous statement.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/851#discussion_r479424107", "createdAt": "2020-08-28T16:53:46Z", "author": {"login": "github-actions"}, "path": "response-server-module/response-server-service/src/test/java/com/google/cloud/healthcare/fdamystudies/common/AppConfigTest.java", "diffHunk": "@@ -0,0 +1,28 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+package com.google.cloud.healthcare.fdamystudies.common;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aa0a19f51f4ed2b5bbdcef2c8f4c5b1270e2aa4f"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQyNDExMA==", "bodyText": "[response-server Checks] reported by reviewdog \ud83d\udc36\nMissing a Javadoc comment.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/851#discussion_r479424110", "createdAt": "2020-08-28T16:53:46Z", "author": {"login": "github-actions"}, "path": "response-server-module/response-server-service/src/main/java/com/google/cloud/healthcare/fdamystudies/filter/TokenIntrospectionFilter.java", "diffHunk": "@@ -0,0 +1,58 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.filter;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+import javax.annotation.PostConstruct;\n+import javax.servlet.ServletContext;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.core.annotation.Order;\n+import org.springframework.http.HttpMethod;\n+import org.springframework.stereotype.Component;\n+\n+@Component\n+@Order(2)\n+public class TokenIntrospectionFilter extends BaseTokenIntrospectionFilter {\n+\n+  private Map<String, String[]> uriTemplateAndMethods = new HashMap<>();\n+\n+  @Autowired ServletContext context;\n+\n+  @PostConstruct", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "aa0a19f51f4ed2b5bbdcef2c8f4c5b1270e2aa4f"}, "originalPosition": 28}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a5769a16385c481b62a8488b26bf536ceed30776", "author": {"user": {"login": "navya-BTC", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/a5769a16385c481b62a8488b26bf536ceed30776", "committedDate": "2020-08-28T16:57:32Z", "message": "sourse format\n\nsourse format"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDc4NjkxMzE0", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/851#pullrequestreview-478691314", "createdAt": "2020-08-31T14:59:01Z", "commit": {"oid": "a5769a16385c481b62a8488b26bf536ceed30776"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxNDo1OTowMVrOHJ8YBQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOC0zMVQxNTowNjoyMFrOHJ8p4A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDE4ODQyMQ==", "bodyText": "what are these URI's from? and why are they being set here?\nA few other areas of concern:\n\nURL should not be hardcoded here within the code\nthey should follow the rest patterns, e.g. POST .../participants to create one, instead of .../participant/add", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/851#discussion_r480188421", "createdAt": "2020-08-31T14:59:01Z", "author": {"login": "zohrehj"}, "path": "response-server-module/response-server-service/src/main/java/com/google/cloud/healthcare/fdamystudies/filter/TokenIntrospectionFilter.java", "diffHunk": "@@ -0,0 +1,58 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+\n+package com.google.cloud.healthcare.fdamystudies.filter;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+import javax.annotation.PostConstruct;\n+import javax.servlet.ServletContext;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.core.annotation.Order;\n+import org.springframework.http.HttpMethod;\n+import org.springframework.stereotype.Component;\n+\n+@Component\n+@Order(2)\n+public class TokenIntrospectionFilter extends BaseTokenIntrospectionFilter {\n+\n+  private Map<String, String[]> uriTemplateAndMethods = new HashMap<>();\n+\n+  @Autowired ServletContext context;\n+\n+  @PostConstruct\n+  public void init() {\n+\n+    uriTemplateAndMethods.put(\n+        String.format(\"%s/participant/add\", context.getContextPath()),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a5769a16385c481b62a8488b26bf536ceed30776"}, "originalPosition": 32}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDE5MTI0MA==", "bodyText": "what is this value? please add better comment to describe what this value should be?\nalso this does not follow the URI we are using for our deployments script in tf-deployment.yaml files. I would suggest using the same URL to keep things consistent.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/851#discussion_r480191240", "createdAt": "2020-08-31T15:03:28Z", "author": {"login": "zohrehj"}, "path": "response-server-module/response-server-service/src/main/resources/application.properties", "diffHunk": "@@ -27,7 +27,7 @@ spring.datasource.hikari.minimum-idle=5\n spring.datasource.hikari.maximum-pool-size=50\n \n # EMBEDDED SERVER CONFIGURATION\n-server.servlet.contextPath=/mystudies-response-server\n+server.servlet.context-path=/mystudies-response-server", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a5769a16385c481b62a8488b26bf536ceed30776"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDE5Mjk5Mg==", "bodyText": "maybe move http://localhost:8004 to a variable to make future edits easier", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/851#discussion_r480192992", "createdAt": "2020-08-31T15:06:20Z", "author": {"login": "zohrehj"}, "path": "response-server-module/response-server-service/src/test/java/com/google/cloud/healthcare/fdamystudies/common/ApiEndpoint.java", "diffHunk": "@@ -12,7 +12,24 @@\n import java.net.URL;\n \n public enum ApiEndpoint {\n-  HEALTH(\"http://localhost:8004/mystudies-response-server/healthCheck\");\n+  HEALTH(\"http://localhost:8004/mystudies-response-server/healthCheck\"),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a5769a16385c481b62a8488b26bf536ceed30776"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgwOTUwODg3", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/851#pullrequestreview-480950887", "createdAt": "2020-09-02T15:38:03Z", "commit": {"oid": "a5769a16385c481b62a8488b26bf536ceed30776"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQxNTozODowM1rOHL1TXA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wOS0wMlQxNTozODowM1rOHL1TXA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjE2OTY5Mg==", "bodyText": "Approach makes sense, but both in the test URLs and here, I would suggest using the same value that's used in the tf-deployment config and in our deployment strategy.\nsee response-server's tf-deployment.yaml\nThe whole idea is to minimize the amount of changes users need to do when deploying this platform.", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/851#discussion_r482169692", "createdAt": "2020-09-02T15:38:03Z", "author": {"login": "zohrehj"}, "path": "response-server-module/response-server-service/src/main/resources/application.properties", "diffHunk": "@@ -27,7 +27,7 @@ spring.datasource.hikari.minimum-idle=5\n spring.datasource.hikari.maximum-pool-size=50\n \n # EMBEDDED SERVER CONFIGURATION\n-server.servlet.contextPath=/mystudies-response-server\n+server.servlet.context-path=/mystudies-response-server", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDE5MTI0MA=="}, "originalCommit": {"oid": "a5769a16385c481b62a8488b26bf536ceed30776"}, "originalPosition": 5}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDgxODUyNzg0", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/851#pullrequestreview-481852784", "createdAt": "2020-09-03T13:43:55Z", "commit": {"oid": "a5769a16385c481b62a8488b26bf536ceed30776"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8e6312cdfb8d8e7e8983146e1814953522ac7c1c", "author": {"user": {"login": "navya-BTC", "name": null}}, "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/8e6312cdfb8d8e7e8983146e1814953522ac7c1c", "committedDate": "2020-09-03T14:04:14Z", "message": "Merge branch 'develop' into response-server-token-introspect"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 402, "cost": 1, "resetAt": "2021-11-01T14:20:25Z"}}}