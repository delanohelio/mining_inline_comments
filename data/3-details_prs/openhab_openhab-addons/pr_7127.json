{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzg1MzAzNDI5", "number": 7127, "title": "[lgwebos] Fix Channel Subscription and Support RefreshType", "bodyText": "This PR improves channel subscription and introduces support for RefreshType commands, which are relevant to update the state of a channel, when items are linked to channels for the first time.\nWhich addresses bug #7118", "createdAt": "2020-03-08T19:26:28Z", "url": "https://github.com/openhab/openhab-addons/pull/7127", "merged": true, "mergeCommit": {"oid": "0b541220f1b7d83cba6c758fcfd84c2435689b1d"}, "closed": true, "closedAt": "2020-03-11T21:48:58Z", "author": {"login": "sprehn"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcL829ZgFqTM3MTEwNDc2Nw==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcMuQt8AFqTM3MzE0ODA1NA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxMTA0NzY3", "url": "https://github.com/openhab/openhab-addons/pull/7127#pullrequestreview-371104767", "createdAt": "2020-03-09T11:58:46Z", "commit": {"oid": "ebaf0f60f87c1d3de204a915d4da19b333564241"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQxMTo1ODo0NlrOFzkPxw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQxMjowODoyMFrOFzkfrg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTYxNTU1OQ==", "bodyText": "Blank line to be suppressed.", "url": "https://github.com/openhab/openhab-addons/pull/7127#discussion_r389615559", "createdAt": "2020-03-09T11:58:46Z", "author": {"login": "lolodomo"}, "path": "bundles/org.openhab.binding.lgwebos/src/main/java/org/openhab/binding/lgwebos/internal/LauncherApplication.java", "diffHunk": "@@ -94,11 +100,16 @@ public void onReceiveCommand(String channelId, LGWebOSHandler handler, Command c\n \n     @Override\n     protected Optional<ServiceSubscription<AppInfo>> getSubscription(String channelId, LGWebOSHandler handler) {\n-        return Optional.of(handler.getSocket().subscribeRunningApp(new ResponseListener<AppInfo>() {\n+        return Optional.of(handler.getSocket().subscribeRunningApp(createResponseListener(channelId, handler)));\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ebaf0f60f87c1d3de204a915d4da19b333564241"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTYxNjYwOA==", "bodyText": "WARN level is really too high (look at the OH recommendations).\nShould be DEBUG, max INFO.", "url": "https://github.com/openhab/openhab-addons/pull/7127#discussion_r389616608", "createdAt": "2020-03-09T12:01:16Z", "author": {"login": "lolodomo"}, "path": "bundles/org.openhab.binding.lgwebos/src/main/java/org/openhab/binding/lgwebos/internal/MediaControlPlayer.java", "diffHunk": "@@ -42,7 +45,8 @@ public void onReceiveCommand(String channelId, LGWebOSHandler handler, Command c\n         } else if (RewindFastforwardType.REWIND == command) {\n             handler.getSocket().rewind(getDefaultResponseListener());\n         } else {\n-            logger.warn(\"Only accept PlayPauseType, RewindFastforwardType. Type was {}.\", command.getClass());\n+            logger.warn(\"Only accept PlayPauseType, RewindFastforwardType, RefreshType. Type was {}.\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ebaf0f60f87c1d3de204a915d4da19b333564241"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTYxNjgyMg==", "bodyText": "WARN level is really too high. Should be DEBUG, max INFO.", "url": "https://github.com/openhab/openhab-addons/pull/7127#discussion_r389616822", "createdAt": "2020-03-09T12:01:44Z", "author": {"login": "lolodomo"}, "path": "bundles/org.openhab.binding.lgwebos/src/main/java/org/openhab/binding/lgwebos/internal/PowerControlPower.java", "diffHunk": "@@ -46,7 +51,7 @@ public void onReceiveCommand(String channelId, LGWebOSHandler handler, Command c\n         } else if (OnOffType.OFF == command) {\n             handler.getSocket().powerOff(getDefaultResponseListener());\n         } else {\n-            logger.warn(\"Only accept OnOffType. Type was {}.\", command.getClass());\n+            logger.warn(\"Only accept OnOffType, RefreshType. Type was {}.\", command.getClass());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ebaf0f60f87c1d3de204a915d4da19b333564241"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTYxNjk2NA==", "bodyText": "Blank line to suppress", "url": "https://github.com/openhab/openhab-addons/pull/7127#discussion_r389616964", "createdAt": "2020-03-09T12:02:06Z", "author": {"login": "lolodomo"}, "path": "bundles/org.openhab.binding.lgwebos/src/main/java/org/openhab/binding/lgwebos/internal/TVControlChannel.java", "diffHunk": "@@ -91,11 +97,16 @@ public void onReceiveCommand(String channelId, LGWebOSHandler handler, Command c\n \n     @Override\n     protected Optional<ServiceSubscription<ChannelInfo>> getSubscription(String channelId, LGWebOSHandler handler) {\n-        return Optional.of(handler.getSocket().subscribeCurrentChannel(new ResponseListener<ChannelInfo>() {\n+        return Optional.of(handler.getSocket().subscribeCurrentChannel(createResponseListener(channelId, handler)));\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ebaf0f60f87c1d3de204a915d4da19b333564241"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTYxNzE2Mw==", "bodyText": "Blank line to suppress", "url": "https://github.com/openhab/openhab-addons/pull/7127#discussion_r389617163", "createdAt": "2020-03-09T12:02:37Z", "author": {"login": "lolodomo"}, "path": "bundles/org.openhab.binding.lgwebos/src/main/java/org/openhab/binding/lgwebos/internal/TVControlChannelName.java", "diffHunk": "@@ -37,15 +38,25 @@\n \n     @Override\n     public void onReceiveCommand(String channelId, LGWebOSHandler handler, Command command) {\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ebaf0f60f87c1d3de204a915d4da19b333564241"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTYxNzI1OQ==", "bodyText": "Blank line to suppress", "url": "https://github.com/openhab/openhab-addons/pull/7127#discussion_r389617259", "createdAt": "2020-03-09T12:02:50Z", "author": {"login": "lolodomo"}, "path": "bundles/org.openhab.binding.lgwebos/src/main/java/org/openhab/binding/lgwebos/internal/TVControlChannelName.java", "diffHunk": "@@ -37,15 +38,25 @@\n \n     @Override\n     public void onReceiveCommand(String channelId, LGWebOSHandler handler, Command command) {\n+\n+        if (RefreshType.REFRESH == command) {\n+            handler.getSocket().getCurrentChannel(createResponseListener(channelId, handler));\n+            return;\n+        }\n         // nothing to do, this is read only.\n     }\n \n     @Override\n     protected Optional<ServiceSubscription<ChannelInfo>> getSubscription(String channelId, LGWebOSHandler handler) {\n-        return Optional.of(handler.getSocket().subscribeCurrentChannel(new ResponseListener<ChannelInfo>() {\n+        return Optional.of(handler.getSocket().subscribeCurrentChannel(createResponseListener(channelId, handler)));\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ebaf0f60f87c1d3de204a915d4da19b333564241"}, "originalPosition": 24}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTYxNzQxOQ==", "bodyText": "WARN level is really too high. Should be DEBUG, max INFO.", "url": "https://github.com/openhab/openhab-addons/pull/7127#discussion_r389617419", "createdAt": "2020-03-09T12:03:11Z", "author": {"login": "lolodomo"}, "path": "bundles/org.openhab.binding.lgwebos/src/main/java/org/openhab/binding/lgwebos/internal/VolumeControlMute.java", "diffHunk": "@@ -38,20 +39,26 @@\n \n     @Override\n     public void onReceiveCommand(String channelId, LGWebOSHandler handler, Command command) {\n-        if (OnOffType.ON == command || OnOffType.OFF == command) {\n+        if (RefreshType.REFRESH == command) {\n+            handler.getSocket().getMute(createResponseListener(channelId, handler));\n+        } else if (OnOffType.ON == command || OnOffType.OFF == command) {\n             handler.getSocket().setMute(OnOffType.ON == command, objResponseListener);\n         } else {\n-            logger.warn(\"Only accept OnOffType. Type was {}.\", command.getClass());\n+            logger.warn(\"Only accept OnOffType, RefreshType. Type was {}.\", command.getClass());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ebaf0f60f87c1d3de204a915d4da19b333564241"}, "originalPosition": 19}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTYxODM0NQ==", "bodyText": "Maybe suppress this return and add else jus after like you do in the class MediaControlPlayer or VolumeControlMute ?", "url": "https://github.com/openhab/openhab-addons/pull/7127#discussion_r389618345", "createdAt": "2020-03-09T12:05:27Z", "author": {"login": "lolodomo"}, "path": "bundles/org.openhab.binding.lgwebos/src/main/java/org/openhab/binding/lgwebos/internal/PowerControlPower.java", "diffHunk": "@@ -32,6 +33,10 @@\n \n     @Override\n     public void onReceiveCommand(String channelId, LGWebOSHandler handler, Command command) {\n+        if (RefreshType.REFRESH == command) {\n+            handler.postUpdate(channelId, handler.getSocket().isConnected() ? OnOffType.ON : OnOffType.OFF);\n+            return;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ebaf0f60f87c1d3de204a915d4da19b333564241"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTYxOTQzOA==", "bodyText": "Maybe suppress this return and add else jus after like you do in the class MediaControlPlayer or VolumeControlMute ?", "url": "https://github.com/openhab/openhab-addons/pull/7127#discussion_r389619438", "createdAt": "2020-03-09T12:07:54Z", "author": {"login": "lolodomo"}, "path": "bundles/org.openhab.binding.lgwebos/src/main/java/org/openhab/binding/lgwebos/internal/VolumeControlVolume.java", "diffHunk": "@@ -44,6 +45,10 @@\n     @Override\n     public void onReceiveCommand(String channelId, LGWebOSHandler handler, Command command) {\n         final PercentType percent;\n+        if (RefreshType.REFRESH == command) {\n+            handler.getSocket().getVolume(createResponseListener(channelId, handler));\n+            return;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ebaf0f60f87c1d3de204a915d4da19b333564241"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTYxOTYzMA==", "bodyText": "WARN level is really too high. Should be DEBUG, max INFO.", "url": "https://github.com/openhab/openhab-addons/pull/7127#discussion_r389619630", "createdAt": "2020-03-09T12:08:20Z", "author": {"login": "lolodomo"}, "path": "bundles/org.openhab.binding.lgwebos/src/main/java/org/openhab/binding/lgwebos/internal/VolumeControlVolume.java", "diffHunk": "@@ -63,17 +68,22 @@ public void onReceiveCommand(String channelId, LGWebOSHandler handler, Command c\n         } else if (OnOffType.OFF == command || OnOffType.ON == command) {\n             handler.getSocket().setMute(OnOffType.OFF == command, objResponseListener);\n         } else {\n-            logger.warn(\"Only accept PercentType, DecimalType, StringType command. Type was {}.\", command.getClass());\n+            logger.warn(\"Only accept PercentType, DecimalType, StringType, RefreshType. Type was {}.\",", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ebaf0f60f87c1d3de204a915d4da19b333564241"}, "originalPosition": 24}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcxMTE0MjU5", "url": "https://github.com/openhab/openhab-addons/pull/7127#pullrequestreview-371114259", "createdAt": "2020-03-09T12:16:38Z", "commit": {"oid": "ebaf0f60f87c1d3de204a915d4da19b333564241"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQxMjoxNjozOFrOFzktkQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wOVQxMjoxNjozOFrOFzktkQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTYyMzE4NQ==", "bodyText": "Please add a test here if the channel is linked. If not, no need to update its state.", "url": "https://github.com/openhab/openhab-addons/pull/7127#discussion_r389623185", "createdAt": "2020-03-09T12:16:38Z", "author": {"login": "lolodomo"}, "path": "bundles/org.openhab.binding.lgwebos/src/main/java/org/openhab/binding/lgwebos/internal/handler/LGWebOSHandler.java", "diffHunk": "@@ -293,35 +303,12 @@ public void onError(String error) {\n \n     public void postUpdate(String channelId, State state) {\n         updateState(channelId, state);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "ebaf0f60f87c1d3de204a915d4da19b333564241"}, "originalPosition": 46}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "43028daba32fc185c41974ce01440cbfafd006cf", "author": {"user": {"login": "sprehn", "name": "Sebastian Prehn"}}, "url": "https://github.com/openhab/openhab-addons/commit/43028daba32fc185c41974ce01440cbfafd006cf", "committedDate": "2020-03-10T19:30:17Z", "message": "Removed check if channel is linked before subscribing.\nAdded special handling of channel number and name.\n\nSigned-off-by: Sebastian Prehn <sebastian.prehn@gmx.de>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "666de616a2d78300f76a09a4e20b1f04bd1fa42c", "author": {"user": {"login": "sprehn", "name": "Sebastian Prehn"}}, "url": "https://github.com/openhab/openhab-addons/commit/666de616a2d78300f76a09a4e20b1f04bd1fa42c", "committedDate": "2020-03-10T19:30:17Z", "message": "Only subscribe when to channel changes in LiveTV app.\nSigned-off-by: Sebastian Prehn <sebastian.prehn@gmx.de>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9fd75de2bfb7681e3fd33c22e770833b96c3be37", "author": {"user": {"login": "sprehn", "name": "Sebastian Prehn"}}, "url": "https://github.com/openhab/openhab-addons/commit/9fd75de2bfb7681e3fd33c22e770833b96c3be37", "committedDate": "2020-03-10T19:35:59Z", "message": "Implementation of RefreshType Command.\nSigned-off-by: Sebastian Prehn <sebastian.prehn@gmx.de>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "58ddebc47bf4d24a2e26eb419bdb05dca4fb1c7c", "author": {"user": {"login": "sprehn", "name": "Sebastian Prehn"}}, "url": "https://github.com/openhab/openhab-addons/commit/58ddebc47bf4d24a2e26eb419bdb05dca4fb1c7c", "committedDate": "2020-03-10T19:35:59Z", "message": "Addressing code review comments.\nSigned-off-by: Sebastian Prehn <sebastian.prehn@gmx.de>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8d9c7e33480b933709063b431bd1af86d1bd95b7", "author": {"user": {"login": "sprehn", "name": "Sebastian Prehn"}}, "url": "https://github.com/openhab/openhab-addons/commit/8d9c7e33480b933709063b431bd1af86d1bd95b7", "committedDate": "2020-03-10T19:35:59Z", "message": "Addressing Review Comment.\nSigned-off-by: Sebastian Prehn <sebastian.prehn@gmx.de>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e40c6c444e0168e31b656a905fcd6444eb58bd5b", "author": {"user": {"login": "sprehn", "name": "Sebastian Prehn"}}, "url": "https://github.com/openhab/openhab-addons/commit/e40c6c444e0168e31b656a905fcd6444eb58bd5b", "committedDate": "2020-03-10T19:35:59Z", "message": "Only post update if channel is linked.\nSigned-off-by: Sebastian Prehn <sebastian.prehn@gmx.de>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "5533f6fdbbe738a966b47dca6e2e9314cf84e9ba", "author": {"user": {"login": "sprehn", "name": "Sebastian Prehn"}}, "url": "https://github.com/openhab/openhab-addons/commit/5533f6fdbbe738a966b47dca6e2e9314cf84e9ba", "committedDate": "2020-03-09T19:58:43Z", "message": "Addressing Review Comment.\nSigned-off-by: Sebastian Prehn <sebastian.prehn@gmx.de>"}, "afterCommit": {"oid": "e40c6c444e0168e31b656a905fcd6444eb58bd5b", "author": {"user": {"login": "sprehn", "name": "Sebastian Prehn"}}, "url": "https://github.com/openhab/openhab-addons/commit/e40c6c444e0168e31b656a905fcd6444eb58bd5b", "committedDate": "2020-03-10T19:35:59Z", "message": "Only post update if channel is linked.\nSigned-off-by: Sebastian Prehn <sebastian.prehn@gmx.de>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzcyMzU3MzE4", "url": "https://github.com/openhab/openhab-addons/pull/7127#pullrequestreview-372357318", "createdAt": "2020-03-10T22:11:36Z", "commit": {"oid": "e40c6c444e0168e31b656a905fcd6444eb58bd5b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzczMTQ4MDU0", "url": "https://github.com/openhab/openhab-addons/pull/7127#pullrequestreview-373148054", "createdAt": "2020-03-11T21:47:04Z", "commit": {"oid": "e40c6c444e0168e31b656a905fcd6444eb58bd5b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1118, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}