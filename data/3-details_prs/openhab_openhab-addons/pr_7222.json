{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzkzODcwNDAx", "number": 7222, "title": "[miio] compiler warnings & spotbugs cleanup", "bodyText": "no new functionality, just eliminating many warnings\nSigned-off-by: Marcel Verpaalen marcel@verpaalen.com", "createdAt": "2020-03-25T23:02:42Z", "url": "https://github.com/openhab/openhab-addons/pull/7222", "merged": true, "mergeCommit": {"oid": "10cf600889d9c58410378eb22e6f7a6033638f5f"}, "closed": true, "closedAt": "2020-03-28T15:47:11Z", "author": {"login": "marcelrv"}, "timelineItems": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcRPswBgH2gAyMzkzODcwNDAxOjEwM2E3MjYwODg3MjNiZDM0MjQwMjFlNDI4ODQ3NjdlZTBkOGFkMzU=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcSHSsCAFqTM4MzMyMzgwMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "103a726088723bd3424021e42884767ee0d8ad35", "author": {"user": {"login": "marcelrv", "name": "Marcel"}}, "url": "https://github.com/openhab/openhab-addons/commit/103a726088723bd3424021e42884767ee0d8ad35", "committedDate": "2020-03-25T23:00:15Z", "message": "[miio] compiler warnings & spotbugs cleanup\n\nSigned-off-by: Marcel Verpaalen <marcel@verpaalen.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgxNjAxMzMx", "url": "https://github.com/openhab/openhab-addons/pull/7222#pullrequestreview-381601331", "createdAt": "2020-03-25T23:08:23Z", "commit": {"oid": "103a726088723bd3424021e42884767ee0d8ad35"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQyMzowODoyM1rOF7xuKw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNVQyMzoyMDoyN1rOF7x-Cw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODIyNDkzOQ==", "bodyText": "If these aren't supposed to be mutable you should return a Collections.emptyList() instead.", "url": "https://github.com/openhab/openhab-addons/pull/7222#discussion_r398224939", "createdAt": "2020-03-25T23:08:23Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.miio/src/main/java/org/openhab/binding/miio/internal/basic/MiIoBasicChannel.java", "diffHunk": "@@ -25,102 +28,111 @@\n  *\n  * @author Marcel Verpaalen - Initial contribution\n  */\n+@NonNullByDefault\n public class MiIoBasicChannel {\n \n     @SerializedName(\"property\")\n     @Expose\n-    private String property;\n+    private @Nullable String property;\n     @SerializedName(\"friendlyName\")\n     @Expose\n-    private String friendlyName;\n+    private @Nullable String friendlyName;\n     @SerializedName(\"channel\")\n     @Expose\n-    private String channel;\n+    private @Nullable String channel;\n     @SerializedName(\"channelType\")\n     @Expose\n-    private String channelType;\n+    private @Nullable String channelType;\n     @SerializedName(\"type\")\n     @Expose\n-    private String type;\n+    private @Nullable String type;\n     @SerializedName(\"refresh\")\n     @Expose\n-    private Boolean refresh;\n+    private @Nullable Boolean refresh;\n     @SerializedName(\"transformation\")\n     @Expose\n-    private String transfortmation;\n+    private @Nullable String transfortmation;\n     @SerializedName(\"ChannelGroup\")\n     @Expose\n-    private String channelGroup;\n+    private @Nullable String channelGroup;\n     @SerializedName(\"actions\")\n     @Expose\n-    private List<MiIoDeviceAction> miIoDeviceActions = new ArrayList<MiIoDeviceAction>();\n+    private @Nullable List<MiIoDeviceAction> miIoDeviceActions = new ArrayList<MiIoDeviceAction>();\n \n     public String getProperty() {\n-        return property;\n+        final String property = this.property;\n+        return (property != null) ? property : \"\";\n     }\n \n     public void setProperty(String property) {\n         this.property = property;\n     }\n \n     public String getFriendlyName() {\n-        return type == null || friendlyName.isEmpty() ? channel : friendlyName;\n+        final String fn = friendlyName;\n+        return (fn == null || type == null || fn.isEmpty()) ? getChannel() : fn;\n     }\n \n     public void setFriendlyName(String friendlyName) {\n         this.friendlyName = friendlyName;\n     }\n \n     public String getChannel() {\n-        return channel;\n+        final @Nullable String channel = this.channel;\n+        return channel != null ? channel : \"\";\n     }\n \n     public void setChannel(String channel) {\n         this.channel = channel;\n     }\n \n     public String getChannelType() {\n-        return channelType == null || channelType.isEmpty() ? BINDING_ID + \":\" + channel\n-                : (channelType.startsWith(\"system\") ? channelType : BINDING_ID + \":\" + channelType);\n+        final @Nullable String ct = channelType;\n+        return ct == null || ct.isEmpty() ? BINDING_ID + \":\" + channel\n+                : (ct.startsWith(\"system\") ? ct : BINDING_ID + \":\" + ct);\n     }\n \n     public void setChannelType(String channelType) {\n         this.channelType = channelType;\n     }\n \n     public String getType() {\n-        return type == null ? \"\" : type;\n+        final @Nullable String type = this.type;\n+        return type != null ? type : \"\";\n     }\n \n     public void setType(String type) {\n         this.type = type;\n     }\n \n     public Boolean getRefresh() {\n-        return refresh && !property.isEmpty();\n+        final @Nullable Boolean rf = refresh;\n+        return rf != null && rf.booleanValue() && !getProperty().isEmpty();\n     }\n \n     public void setRefresh(Boolean refresh) {\n         this.refresh = refresh;\n     }\n \n     public String getChannelGroup() {\n-        return channelGroup;\n+        final @Nullable String channelGroup = this.channelGroup;\n+        return channelGroup != null ? channelGroup : \"\";\n     }\n \n     public void setChannelGroup(String channelGroup) {\n         this.channelGroup = channelGroup;\n     }\n \n     public List<MiIoDeviceAction> getActions() {\n-        return miIoDeviceActions;\n+        final @Nullable List<MiIoDeviceAction> miIoDeviceActions = this.miIoDeviceActions;\n+        return (miIoDeviceActions != null) ? miIoDeviceActions : new ArrayList<MiIoDeviceAction>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "103a726088723bd3424021e42884767ee0d8ad35"}, "originalPosition": 129}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODIyNTUxMw==", "bodyText": "This Gson instance should be reused, but I guess you can do that in another PR.", "url": "https://github.com/openhab/openhab-addons/pull/7222#discussion_r398225513", "createdAt": "2020-03-25T23:09:55Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.miio/src/main/java/org/openhab/binding/miio/internal/basic/MiIoDatabaseWatchService.java", "diffHunk": "@@ -109,14 +112,11 @@ private void populateDatabase() {\n         for (URL db : urlEntries) {\n             logger.trace(\"Adding devices for db file: {}\", db);\n             try {\n-                @Nullable\n                 JsonObject deviceMapping = Utils.convertFileToJSON(db);\n-                if (deviceMapping != null) {\n-                    Gson gson = new GsonBuilder().serializeNulls().create();\n-                    MiIoBasicDevice devdb = gson.fromJson(deviceMapping, MiIoBasicDevice.class);\n-                    for (String id : devdb.getDevice().getId()) {\n-                        workingDatabaseList.put(id, db);\n-                    }\n+                Gson gson = new GsonBuilder().serializeNulls().create();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "103a726088723bd3424021e42884767ee0d8ad35"}, "originalPosition": 28}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODIyNTY1MA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        this.miIoDiscoveryJob = scheduler.scheduleWithFixedDelay(() -> discover(), 0, SEARCH_INTERVAL,\n          \n          \n            \n                        this.miIoDiscoveryJob = scheduler.scheduleWithFixedDelay(this::discover, 0, SEARCH_INTERVAL,", "url": "https://github.com/openhab/openhab-addons/pull/7222#discussion_r398225650", "createdAt": "2020-03-25T23:10:23Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.miio/src/main/java/org/openhab/binding/miio/internal/discovery/MiIoDiscovery.java", "diffHunk": "@@ -71,36 +74,44 @@ public MiIoDiscovery() throws IllegalArgumentException {\n     @Override\n     protected void startBackgroundDiscovery() {\n         logger.debug(\"Start Xiaomi Mi IO background discovery\");\n+        final @Nullable ScheduledFuture<?> miIoDiscoveryJob = this.miIoDiscoveryJob;\n         if (miIoDiscoveryJob == null || miIoDiscoveryJob.isCancelled()) {\n-            miIoDiscoveryJob = scheduler.scheduleWithFixedDelay(() -> discover(), 0, SEARCH_INTERVAL, TimeUnit.SECONDS);\n+            this.miIoDiscoveryJob = scheduler.scheduleWithFixedDelay(() -> discover(), 0, SEARCH_INTERVAL,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "103a726088723bd3424021e42884767ee0d8ad35"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODIyNzMwMA==", "bodyText": "I don't think you should grab the configuration until the handler is initialized, especially since configurations can change.", "url": "https://github.com/openhab/openhab-addons/pull/7222#discussion_r398227300", "createdAt": "2020-03-25T23:15:24Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.miio/src/main/java/org/openhab/binding/miio/internal/handler/MiIoAbstractHandler.java", "diffHunk": "@@ -58,32 +58,34 @@\n  *\n  * @author Marcel Verpaalen - Initial contribution\n  */\n+@NonNullByDefault\n public abstract class MiIoAbstractHandler extends BaseThingHandler implements MiIoMessageListener {\n     protected static final int MAX_QUEUE = 5;\n \n-    protected ScheduledFuture<?> pollingJob;\n+    protected @Nullable ScheduledFuture<?> pollingJob;\n     protected MiIoBindingConfiguration configuration;\n     protected MiIoDevices miDevice = MiIoDevices.UNKNOWN;\n     protected boolean isIdentified;\n \n     protected JsonParser parser;\n-    protected byte[] token;\n+    protected byte[] token = new byte[0];\n \n-    protected MiIoAsyncCommunication miioCom;\n+    protected @Nullable MiIoAsyncCommunication miioCom;\n     protected int lastId;\n \n     protected Map<Integer, String> cmds = new ConcurrentHashMap<Integer, String>();\n-    protected ExpiringCache<String> network;\n+    protected @Nullable ExpiringCache<String> network;\n     protected static final long CACHE_EXPIRY = TimeUnit.SECONDS.toMillis(5);\n     protected static final long CACHE_EXPIRY_NETWORK = TimeUnit.SECONDS.toMillis(60);\n \n     private final Logger logger = LoggerFactory.getLogger(MiIoAbstractHandler.class);\n     protected MiIoDatabaseWatchService miIoDatabaseWatchService;\n \n-    @NonNullByDefault\n-    public MiIoAbstractHandler(Thing thing) {\n+    public MiIoAbstractHandler(Thing thing, MiIoDatabaseWatchService miIoDatabaseWatchService) {\n         super(thing);\n         parser = new JsonParser();\n+        this.miIoDatabaseWatchService = miIoDatabaseWatchService;\n+        this.configuration = getConfigAs(MiIoBindingConfiguration.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "103a726088723bd3424021e42884767ee0d8ad35"}, "originalPosition": 53}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODIyODU5MQ==", "bodyText": "fanLevel?", "url": "https://github.com/openhab/openhab-addons/pull/7222#discussion_r398228591", "createdAt": "2020-03-25T23:19:09Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.miio/src/main/java/org/openhab/binding/miio/internal/handler/MiIoVacuumHandler.java", "diffHunk": "@@ -139,7 +201,8 @@ private boolean updateVacuumStatus(JsonObject statusData) {\n         int fanLevel = statusData.get(\"fan_power\").getAsInt();\n         updateState(CHANNEL_FAN_POWER, new DecimalType(fanLevel));\n         updateState(CHANNEL_FAN_CONTROL, new DecimalType(FanModeType.getType(fanLevel).getId()));\n-        updateState(CHANNEL_IN_CLEANING, new DecimalType(statusData.get(\"in_cleaning\").getAsBigDecimal()));\n+        inCleaning = statusData.get(\"in_cleaning\").getAsInt();\n+        updateState(CHANNEL_IN_CLEANING, new DecimalType(fanLevel));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "103a726088723bd3424021e42884767ee0d8ad35"}, "originalPosition": 143}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODIyOTAwMw==", "bodyText": "You can reuse threads like this?", "url": "https://github.com/openhab/openhab-addons/pull/7222#discussion_r398229003", "createdAt": "2020-03-25T23:20:27Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.miio/src/main/java/org/openhab/binding/miio/internal/transport/MiIoAsyncCommunication.java", "diffHunk": "@@ -191,19 +195,22 @@ MiIoSendCommand sendMiIoSendCommand(MiIoSendCommand miIoSendCommand) {\n     }\n \n     public synchronized void startReceiver() {\n+        MessageSenderThread senderThread = this.senderThread;\n         if (senderThread == null) {\n             senderThread = new MessageSenderThread();\n         }\n         if (!senderThread.isAlive()) {\n             senderThread.start();\n         }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "103a726088723bd3424021e42884767ee0d8ad35"}, "originalPosition": 59}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "472f897316c6118ba66edced6744c16abd93fdb8", "author": {"user": {"login": "marcelrv", "name": "Marcel"}}, "url": "https://github.com/openhab/openhab-addons/commit/472f897316c6118ba66edced6744c16abd93fdb8", "committedDate": "2020-03-26T18:30:59Z", "message": "[miio] processing changes based on feedback\n\nSigned-off-by: Marcel Verpaalen <marcel@verpaalen.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "788de10a10237cf77d6373d5f3e75c140e439990", "author": {"user": {"login": "marcelrv", "name": "Marcel"}}, "url": "https://github.com/openhab/openhab-addons/commit/788de10a10237cf77d6373d5f3e75c140e439990", "committedDate": "2020-03-26T18:18:57Z", "message": "[miio] processing changes based on feedback"}, "afterCommit": {"oid": "472f897316c6118ba66edced6744c16abd93fdb8", "author": {"user": {"login": "marcelrv", "name": "Marcel"}}, "url": "https://github.com/openhab/openhab-addons/commit/472f897316c6118ba66edced6744c16abd93fdb8", "committedDate": "2020-03-26T18:30:59Z", "message": "[miio] processing changes based on feedback\n\nSigned-off-by: Marcel Verpaalen <marcel@verpaalen.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgyMzk4NzMy", "url": "https://github.com/openhab/openhab-addons/pull/7222#pullrequestreview-382398732", "createdAt": "2020-03-26T20:38:31Z", "commit": {"oid": "472f897316c6118ba66edced6744c16abd93fdb8"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQyMDozODozMVrOF8ZfqQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yNlQyMDo1Mjo0NVrOF8Z-Bg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODg3NjU4NQ==", "bodyText": "too many conditional operators and \":\" mixed with :. Can you make this more readable?", "url": "https://github.com/openhab/openhab-addons/pull/7222#discussion_r398876585", "createdAt": "2020-03-26T20:38:31Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.miio/src/main/java/org/openhab/binding/miio/internal/basic/MiIoBasicChannel.java", "diffHunk": "@@ -25,102 +29,111 @@\n  *\n  * @author Marcel Verpaalen - Initial contribution\n  */\n+@NonNullByDefault\n public class MiIoBasicChannel {\n \n     @SerializedName(\"property\")\n     @Expose\n-    private String property;\n+    private @Nullable String property;\n     @SerializedName(\"friendlyName\")\n     @Expose\n-    private String friendlyName;\n+    private @Nullable String friendlyName;\n     @SerializedName(\"channel\")\n     @Expose\n-    private String channel;\n+    private @Nullable String channel;\n     @SerializedName(\"channelType\")\n     @Expose\n-    private String channelType;\n+    private @Nullable String channelType;\n     @SerializedName(\"type\")\n     @Expose\n-    private String type;\n+    private @Nullable String type;\n     @SerializedName(\"refresh\")\n     @Expose\n-    private Boolean refresh;\n+    private @Nullable Boolean refresh;\n     @SerializedName(\"transformation\")\n     @Expose\n-    private String transfortmation;\n+    private @Nullable String transfortmation;\n     @SerializedName(\"ChannelGroup\")\n     @Expose\n-    private String channelGroup;\n+    private @Nullable String channelGroup;\n     @SerializedName(\"actions\")\n     @Expose\n-    private List<MiIoDeviceAction> miIoDeviceActions = new ArrayList<MiIoDeviceAction>();\n+    private @Nullable List<MiIoDeviceAction> miIoDeviceActions = new ArrayList<MiIoDeviceAction>();\n \n     public String getProperty() {\n-        return property;\n+        final String property = this.property;\n+        return (property != null) ? property : \"\";\n     }\n \n     public void setProperty(String property) {\n         this.property = property;\n     }\n \n     public String getFriendlyName() {\n-        return type == null || friendlyName.isEmpty() ? channel : friendlyName;\n+        final String fn = friendlyName;\n+        return (fn == null || type == null || fn.isEmpty()) ? getChannel() : fn;\n     }\n \n     public void setFriendlyName(String friendlyName) {\n         this.friendlyName = friendlyName;\n     }\n \n     public String getChannel() {\n-        return channel;\n+        final @Nullable String channel = this.channel;\n+        return channel != null ? channel : \"\";\n     }\n \n     public void setChannel(String channel) {\n         this.channel = channel;\n     }\n \n     public String getChannelType() {\n-        return channelType == null || channelType.isEmpty() ? BINDING_ID + \":\" + channel\n-                : (channelType.startsWith(\"system\") ? channelType : BINDING_ID + \":\" + channelType);\n+        final @Nullable String ct = channelType;\n+        return ct == null || ct.isEmpty() ? BINDING_ID + \":\" + channel\n+                : (ct.startsWith(\"system\") ? ct : BINDING_ID + \":\" + ct);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "472f897316c6118ba66edced6744c16abd93fdb8"}, "originalPosition": 92}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODg3OTYyNg==", "bodyText": "Why can't this be created in the constructor? That way you can make the network field non-null and final.", "url": "https://github.com/openhab/openhab-addons/pull/7222#discussion_r398879626", "createdAt": "2020-03-26T20:44:03Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.miio/src/main/java/org/openhab/binding/miio/internal/handler/MiIoAbstractHandler.java", "diffHunk": "@@ -335,9 +336,11 @@ protected boolean initializeData() {\n \n     /**\n      * Prepares the ExpiringCache for network data\n+     *\n+     * @return\n      */\n-    protected void initalizeNetworkCache() {\n-        network = new ExpiringCache<String>(CACHE_EXPIRY_NETWORK, () -> {\n+    protected ExpiringCache<String> initalizeNetworkCache() {\n+        final ExpiringCache<String> network = new ExpiringCache<String>(CACHE_EXPIRY_NETWORK, () -> {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "472f897316c6118ba66edced6744c16abd93fdb8"}, "originalPosition": 210}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODg4MjExOQ==", "bodyText": "If you create a new thread isn't it still supposed to be started here? right now you are starting the thread in the constructor (and elsewhere maybe, I didn't check too thoroughly).", "url": "https://github.com/openhab/openhab-addons/pull/7222#discussion_r398882119", "createdAt": "2020-03-26T20:48:35Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.miio/src/main/java/org/openhab/binding/miio/internal/transport/MiIoAsyncCommunication.java", "diffHunk": "@@ -191,12 +195,11 @@ MiIoSendCommand sendMiIoSendCommand(MiIoSendCommand miIoSendCommand) {\n     }\n \n     public synchronized void startReceiver() {\n-        if (senderThread == null) {\n+        MessageSenderThread senderThread = this.senderThread;\n+        if (senderThread == null || !senderThread.isAlive()) {\n             senderThread = new MessageSenderThread();\n         }\n-        if (!senderThread.isAlive()) {\n-            senderThread.start();\n-        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "472f897316c6118ba66edced6744c16abd93fdb8"}, "originalPosition": 60}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODg4Mjg0Ng==", "bodyText": "looks like a good place to use a switch statement.", "url": "https://github.com/openhab/openhab-addons/pull/7222#discussion_r398882846", "createdAt": "2020-03-26T20:49:51Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.miio/src/main/java/org/openhab/binding/miio/internal/handler/MiIoBasicHandler.java", "diffHunk": "@@ -394,36 +413,39 @@ private void updatePropsFromJsonObject(MiIoSendCommand response) {\n \n     private void updateChannel(@Nullable MiIoBasicChannel basicChannel, String param, JsonElement value) {\n         JsonElement val = value;\n-        if (basicChannel != null) {\n-            if (basicChannel.getTransfortmation() != null) {\n-                JsonElement transformed = Conversions.execute(basicChannel.getTransfortmation(), val);\n-                logger.debug(\"Transformed with '{}': {} {} -> {} \", basicChannel.getTransfortmation(),\n-                        basicChannel.getFriendlyName(), val, transformed);\n-                val = transformed;\n+        if (basicChannel == null) {\n+            logger.debug(\"Channel not found for {}\", param);\n+            return;\n+        }\n+        final String transformation = basicChannel.getTransfortmation();\n+        if (transformation != null) {\n+            JsonElement transformed = Conversions.execute(transformation, val);\n+            logger.debug(\"Transformed with '{}': {} {} -> {} \", transformation, basicChannel.getFriendlyName(), val,\n+                    transformed);\n+            val = transformed;\n+        }\n+        try {\n+            if (basicChannel.getType().equals(\"Number\")) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "472f897316c6118ba66edced6744c16abd93fdb8"}, "originalPosition": 232}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODg4Mzc0Nw==", "bodyText": "Why return here?", "url": "https://github.com/openhab/openhab-addons/pull/7222#discussion_r398883747", "createdAt": "2020-03-26T20:51:38Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.miio/src/main/java/org/openhab/binding/miio/internal/handler/MiIoBasicHandler.java", "diffHunk": "@@ -191,11 +194,17 @@ public void handleCommand(ChannelUID channelUID, Command command) {\n \n     @Override\n     protected synchronized void updateData() {\n+        final MiIoBindingConfiguration configuration = getConfigAs(MiIoBindingConfiguration.class);\n         logger.debug(\"Periodic update for '{}' ({})\", getThing().getUID().toString(), getThing().getThingTypeUID());\n+        final MiIoAsyncCommunication miioCom = this.miioCom;\n         try {\n             if (!hasConnection() || skipUpdate()) {\n                 return;\n             }\n+            if (miioCom == null) {\n+                initializeData();\n+                return;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "472f897316c6118ba66edced6744c16abd93fdb8"}, "originalPosition": 82}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODg4NDM1OA==", "bodyText": "Any specific exceptions you are trying to catch? If so please list them instead of catching a generic exception.", "url": "https://github.com/openhab/openhab-addons/pull/7222#discussion_r398884358", "createdAt": "2020-03-26T20:52:45Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.miio/src/main/java/org/openhab/binding/miio/internal/handler/MiIoBasicHandler.java", "diffHunk": "@@ -394,36 +413,39 @@ private void updatePropsFromJsonObject(MiIoSendCommand response) {\n \n     private void updateChannel(@Nullable MiIoBasicChannel basicChannel, String param, JsonElement value) {\n         JsonElement val = value;\n-        if (basicChannel != null) {\n-            if (basicChannel.getTransfortmation() != null) {\n-                JsonElement transformed = Conversions.execute(basicChannel.getTransfortmation(), val);\n-                logger.debug(\"Transformed with '{}': {} {} -> {} \", basicChannel.getTransfortmation(),\n-                        basicChannel.getFriendlyName(), val, transformed);\n-                val = transformed;\n+        if (basicChannel == null) {\n+            logger.debug(\"Channel not found for {}\", param);\n+            return;\n+        }\n+        final String transformation = basicChannel.getTransfortmation();\n+        if (transformation != null) {\n+            JsonElement transformed = Conversions.execute(transformation, val);\n+            logger.debug(\"Transformed with '{}': {} {} -> {} \", transformation, basicChannel.getFriendlyName(), val,\n+                    transformed);\n+            val = transformed;\n+        }\n+        try {\n+            if (basicChannel.getType().equals(\"Number\")) {\n+                updateState(basicChannel.getChannel(), new DecimalType(val.getAsBigDecimal()));\n             }\n-            try {\n-                if (basicChannel.getType().equals(\"Number\")) {\n-                    updateState(basicChannel.getChannel(), new DecimalType(val.getAsBigDecimal()));\n-                }\n-                if (basicChannel.getType().equals(\"String\")) {\n-                    updateState(basicChannel.getChannel(), new StringType(val.getAsString()));\n-                }\n-                if (basicChannel.getType().equals(\"Switch\")) {\n-                    updateState(basicChannel.getChannel(), val.getAsString().toLowerCase().equals(\"on\")\n-                            || val.getAsString().toLowerCase().equals(\"true\") ? OnOffType.ON : OnOffType.OFF);\n-                }\n-                if (basicChannel.getType().equals(\"Color\")) {\n-                    Color rgb = new Color(val.getAsInt());\n-                    HSBType hsb = HSBType.fromRGB(rgb.getRed(), rgb.getGreen(), rgb.getBlue());\n-                    updateState(basicChannel.getChannel(), hsb);\n-                }\n-            } catch (Exception e) {\n-                logger.debug(\"Error updating {} property {} with '{}' : {}: {}\", getThing().getUID(),\n-                        basicChannel.getChannel(), val, e.getClass().getCanonicalName(), e.getMessage());\n-                logger.trace(\"Property update error detail:\", e);\n+            if (basicChannel.getType().equals(\"String\")) {\n+                updateState(basicChannel.getChannel(), new StringType(val.getAsString()));\n             }\n-        } else {\n-            logger.debug(\"Channel not found for {}\", param);\n+            if (basicChannel.getType().equals(\"Switch\")) {\n+                updateState(basicChannel.getChannel(),\n+                        val.getAsString().toLowerCase().equals(\"on\") || val.getAsString().toLowerCase().equals(\"true\")\n+                                ? OnOffType.ON\n+                                : OnOffType.OFF);\n+            }\n+            if (basicChannel.getType().equals(\"Color\")) {\n+                Color rgb = new Color(val.getAsInt());\n+                HSBType hsb = HSBType.fromRGB(rgb.getRed(), rgb.getGreen(), rgb.getBlue());\n+                updateState(basicChannel.getChannel(), hsb);\n+            }\n+        } catch (Exception e) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "472f897316c6118ba66edced6744c16abd93fdb8"}, "originalPosition": 271}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "93784cdb9406b73afcd84fb8ac0289eb903aefd1", "author": {"user": {"login": "marcelrv", "name": "Marcel"}}, "url": "https://github.com/openhab/openhab-addons/commit/93784cdb9406b73afcd84fb8ac0289eb903aefd1", "committedDate": "2020-03-27T22:11:56Z", "message": "[miio] improvements based on review comments\n\nSigned-off-by: Marcel Verpaalen <marcel@verpaalen.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4e07fb0bf49be07f399490ef0176418caf67fda9", "author": {"user": {"login": "marcelrv", "name": "Marcel"}}, "url": "https://github.com/openhab/openhab-addons/commit/4e07fb0bf49be07f399490ef0176418caf67fda9", "committedDate": "2020-03-27T22:18:26Z", "message": "[miio] fix confusion channel codeing\n\nSigned-off-by: Marcel Verpaalen <marcel@verpaalen.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzMjQ0NDQz", "url": "https://github.com/openhab/openhab-addons/pull/7222#pullrequestreview-383244443", "createdAt": "2020-03-27T23:02:35Z", "commit": {"oid": "4e07fb0bf49be07f399490ef0176418caf67fda9"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QyMzowMjozNVrOF9EKQA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0yN1QyMzowMjozNVrOF9EKQA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTU3NTYxNg==", "bodyText": "Why was this made a field?", "url": "https://github.com/openhab/openhab-addons/pull/7222#discussion_r399575616", "createdAt": "2020-03-27T23:02:35Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.miio/src/main/java/org/openhab/binding/miio/internal/handler/MiIoVacuumHandler.java", "diffHunk": "@@ -51,19 +52,63 @@\n  *\n  * @author Marcel Verpaalen - Initial contribution\n  */\n+@NonNullByDefault\n public class MiIoVacuumHandler extends MiIoAbstractHandler {\n     private final Logger logger = LoggerFactory.getLogger(MiIoVacuumHandler.class);\n-\n     private ExpiringCache<String> status;\n     private ExpiringCache<String> consumables;\n     private ExpiringCache<String> dnd;\n     private ExpiringCache<String> history;\n-    private String lastHistoryId;\n+    private String lastHistoryId = \"\";\n+    private int inCleaning;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4e07fb0bf49be07f399490ef0176418caf67fda9"}, "originalPosition": 22}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzgzMzIzODAy", "url": "https://github.com/openhab/openhab-addons/pull/7222#pullrequestreview-383323802", "createdAt": "2020-03-28T15:46:28Z", "commit": {"oid": "4e07fb0bf49be07f399490ef0176418caf67fda9"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1269, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}