{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ0Mjk5MTMy", "number": 8075, "title": "[kodi] Thing handler factory with null annotations and constructor injection", "bodyText": "Signed-off-by: Laurent Garnier lg.hc@free.fr", "createdAt": "2020-07-04T15:45:29Z", "url": "https://github.com/openhab/openhab-addons/pull/8075", "merged": true, "mergeCommit": {"oid": "eba4892685c4b95888f93db9722fceb839916512"}, "closed": true, "closedAt": "2020-07-05T09:41:16Z", "author": {"login": "lolodomo"}, "timelineItems": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcxp-9jgH2gAyNDQ0Mjk5MTMyOmI1ZDVmMDk1NTg2ZjhhMWNlMGIxYTViZDBhNWQ4YmE1NDZjZTRmNTE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcx5ZRlAFqTQ0MjY2MjMwMQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "b5d5f095586f8a1ce0b1a5bd0a5d8ba546ce4f51", "author": {"user": {"login": "lolodomo", "name": "lolodomo"}}, "url": "https://github.com/openhab/openhab-addons/commit/b5d5f095586f8a1ce0b1a5bd0a5d8ba546ce4f51", "committedDate": "2020-07-04T15:43:15Z", "message": "[kodi] Thing handler factory with null annotations and constructor injection\n\nSigned-off-by: Laurent Garnier <lg.hc@free.fr>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e020ad0d4ad592256faa0d3da184263927223e51", "author": {"user": {"login": "lolodomo", "name": "lolodomo"}}, "url": "https://github.com/openhab/openhab-addons/commit/e020ad0d4ad592256faa0d3da184263927223e51", "committedDate": "2020-07-04T16:44:01Z", "message": "final added to few class fields\n\nSigned-off-by: Laurent Garnier <lg.hc@free.fr>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyNjI4Mjg5", "url": "https://github.com/openhab/openhab-addons/pull/8075#pullrequestreview-442628289", "createdAt": "2020-07-04T19:50:13Z", "commit": {"oid": "e020ad0d4ad592256faa0d3da184263927223e51"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNFQxOTo1MDoxM1rOGs9ppg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wNFQxOTo1MDoxM1rOGs9ppg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTgwMDYxNA==", "bodyText": "Please add @Activate annotation here too. Otherwise this method will be ignored in favor of all annotated activation methods.\nAnother option would be to pass the ComponentContext parameter to the constructor and move all the logic inside this method into the constructor too.", "url": "https://github.com/openhab/openhab-addons/pull/8075#discussion_r449800614", "createdAt": "2020-07-04T19:50:13Z", "author": {"login": "cweitkamp"}, "path": "bundles/org.openhab.binding.kodi/src/main/java/org/openhab/binding/kodi/internal/KodiHandlerFactory.java", "diffHunk": "@@ -45,21 +48,32 @@\n  * @author Paul Frank - Initial contribution\n  * @author Christoph Weitkamp - Improvements on channels for opening PVR TV or Radio streams\n  */\n+@NonNullByDefault\n @Component(service = ThingHandlerFactory.class, configurationPid = \"binding.kodi\")\n public class KodiHandlerFactory extends BaseThingHandlerFactory {\n \n-    private Logger logger = LoggerFactory.getLogger(KodiHandlerFactory.class);\n+    private final Logger logger = LoggerFactory.getLogger(KodiHandlerFactory.class);\n \n-    private AudioHTTPServer audioHTTPServer;\n-    private NetworkAddressService networkAddressService;\n-    private WebSocketClient webSocketClient;\n+    private final AudioHTTPServer audioHTTPServer;\n+    private final NetworkAddressService networkAddressService;\n+    private final KodiDynamicStateDescriptionProvider stateDescriptionProvider;\n+    private final WebSocketClient webSocketClient;\n \n-    // url (scheme+server+port) to use for playing notification sounds\n-    private String callbackUrl = null;\n+    private final Map<String, @Nullable ServiceRegistration<AudioSink>> audioSinkRegistrations = new ConcurrentHashMap<>();\n \n-    private Map<String, ServiceRegistration<AudioSink>> audioSinkRegistrations = new ConcurrentHashMap<>();\n+    // url (scheme+server+port) to use for playing notification sounds\n+    private @Nullable String callbackUrl;\n \n-    private KodiDynamicStateDescriptionProvider stateDescriptionProvider;\n+    @Activate\n+    public KodiHandlerFactory(final @Reference AudioHTTPServer audioHTTPServer,\n+            final @Reference NetworkAddressService networkAddressService,\n+            final @Reference KodiDynamicStateDescriptionProvider stateDescriptionProvider,\n+            final @Reference WebSocketFactory webSocketFactory) {\n+        this.audioHTTPServer = audioHTTPServer;\n+        this.networkAddressService = networkAddressService;\n+        this.stateDescriptionProvider = stateDescriptionProvider;\n+        this.webSocketClient = webSocketFactory.getCommonWebSocketClient();\n+    }\n \n     @Override\n     protected void activate(ComponentContext componentContext) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e020ad0d4ad592256faa0d3da184263927223e51"}, "originalPosition": 57}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyNjYyMzAx", "url": "https://github.com/openhab/openhab-addons/pull/8075#pullrequestreview-442662301", "createdAt": "2020-07-05T09:40:34Z", "commit": {"oid": "e020ad0d4ad592256faa0d3da184263927223e51"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 111, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}