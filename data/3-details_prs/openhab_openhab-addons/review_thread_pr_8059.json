{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ0MDgyNDA4", "number": 8059, "reviewThreads": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QxNjo1OToxM1rOELTHvA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QxNzowMzoxMlrOELTJzw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwMjgzMDY4OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.lcn/src/main/java/org/openhab/binding/lcn/internal/LcnModuleActions.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QxNjo1OToxM1rOGs1GOQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QxNjo1OToxM1rOGs1GOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY2MDQ3Mw==", "bodyText": "Words in labels should be capitalized. See https://www.openhab.org/docs/developer/bindings/thing-xml.html#formatting-labels-and-descriptions\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                @RuleAction(label = \"LCN startRelayTimer\", description = \"Start an lcn relay timer\")\n          \n          \n            \n                @RuleAction(label = \"LCN Relay Timer\", description = \"Start an LCN relay timer\")", "url": "https://github.com/openhab/openhab-addons/pull/8059#discussion_r449660473", "createdAt": "2020-07-03T16:59:13Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.lcn/src/main/java/org/openhab/binding/lcn/internal/LcnModuleActions.java", "diffHunk": "@@ -156,6 +156,24 @@ public void sendDynamicText(\n         }\n     }\n \n+    /**\n+     * Start an lcn relay timer with the given duration [ms]\n+     *\n+     * @param relaynumber 1-based number of the relay to use\n+     * @param duration duration of the relay timer in milliseconds\n+     */\n+    @Override\n+    @RuleAction(label = \"LCN startRelayTimer\", description = \"Start an lcn relay timer\")", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a94b61ff89653aa27af510e390138f143ee1946d"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwMjgzMTAwOnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.lcn/src/main/java/org/openhab/binding/lcn/internal/LcnModuleActions.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QxNjo1OToyOVrOGs1GZQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QxNjo1OToyOVrOGs1GZQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY2MDUxNw==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        @ActionInput(name = \"relaynumber\", required = true, type = \"java.lang.Integer\", label = \"Relay number\", description = \"The relay number (1-8)\") int relayNumber,\n          \n          \n            \n                        @ActionInput(name = \"relaynumber\", required = true, type = \"java.lang.Integer\", label = \"Relay Number\", description = \"The relay number (1-8)\") int relayNumber,", "url": "https://github.com/openhab/openhab-addons/pull/8059#discussion_r449660517", "createdAt": "2020-07-03T16:59:29Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.lcn/src/main/java/org/openhab/binding/lcn/internal/LcnModuleActions.java", "diffHunk": "@@ -156,6 +156,24 @@ public void sendDynamicText(\n         }\n     }\n \n+    /**\n+     * Start an lcn relay timer with the given duration [ms]\n+     *\n+     * @param relaynumber 1-based number of the relay to use\n+     * @param duration duration of the relay timer in milliseconds\n+     */\n+    @Override\n+    @RuleAction(label = \"LCN startRelayTimer\", description = \"Start an lcn relay timer\")\n+    public void startRelayTimer(\n+            @ActionInput(name = \"relaynumber\", required = true, type = \"java.lang.Integer\", label = \"Relay number\", description = \"The relay number (1-8)\") int relayNumber,", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a94b61ff89653aa27af510e390138f143ee1946d"}, "originalPosition": 13}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwMjgzMjg3OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.lcn/src/main/java/org/openhab/binding/lcn/internal/common/PckGenerator.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QxNzowMDo0OFrOGs1Hgg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QxNzowMDo0OFrOGs1Hgg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY2MDgwMg==", "bodyText": "Primitive types should be used where possible.\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private static Integer convertMsecToLCNTimer(double ms) {\n          \n          \n            \n                private static int convertMsecToLCNTimer(double ms) {", "url": "https://github.com/openhab/openhab-addons/pull/8059#discussion_r449660802", "createdAt": "2020-07-03T17:00:48Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.lcn/src/main/java/org/openhab/binding/lcn/internal/common/PckGenerator.java", "diffHunk": "@@ -777,4 +797,28 @@ private static int timeToRampValue(int timeMSec) {\n         }\n         return ret;\n     }\n+\n+    /**\n+     * Converts duration in milliseconds to lcntimer value\n+     * Source: https://www.symcon.de/forum/threads/38603-LCN-Relais-Kurzzeit-Timer-umrechnen\n+     *\n+     * @param ms time in milliseconds\n+     * @return lcn timer value\n+     */\n+    private static Integer convertMsecToLCNTimer(double ms) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a94b61ff89653aa27af510e390138f143ee1946d"}, "originalPosition": 39}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwMjgzMzYzOnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.lcn/src/main/java/org/openhab/binding/lcn/internal/common/PckGenerator.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QxNzowMToyNlrOGs1IDw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QxNzowMToyNlrOGs1IDw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY2MDk0Mw==", "bodyText": "This should be sematically the same:\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        lcntimer = (new Double(offset + (mod * 32))).intValue();\n          \n          \n            \n                        lcntimer = (int) (offset + mod * 32);", "url": "https://github.com/openhab/openhab-addons/pull/8059#discussion_r449660943", "createdAt": "2020-07-03T17:01:26Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.lcn/src/main/java/org/openhab/binding/lcn/internal/common/PckGenerator.java", "diffHunk": "@@ -777,4 +797,28 @@ private static int timeToRampValue(int timeMSec) {\n         }\n         return ret;\n     }\n+\n+    /**\n+     * Converts duration in milliseconds to lcntimer value\n+     * Source: https://www.symcon.de/forum/threads/38603-LCN-Relais-Kurzzeit-Timer-umrechnen\n+     *\n+     * @param ms time in milliseconds\n+     * @return lcn timer value\n+     */\n+    private static Integer convertMsecToLCNTimer(double ms) {\n+        Integer lcntimer = -1;\n+        if (ms >= 0 && ms <= 240960) {\n+            double a = ms / 1000 / 0.03;\n+            double b = (a / 32.0) + 1.0;\n+            double c = Math.log(b) / Math.log(2);\n+            double mod = Math.floor(c);\n+            double faktor = 32 * (Math.pow(2, mod) - 1);\n+            double offset = (a - faktor) / Math.pow(2, mod);\n+            lcntimer = (new Double(offset + (mod * 32))).intValue();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a94b61ff89653aa27af510e390138f143ee1946d"}, "originalPosition": 48}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwMjgzNDcxOnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.lcn/src/main/java/org/openhab/binding/lcn/internal/common/PckGenerator.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QxNzowMjoyMVrOGs1Izw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QyMTowNDozNFrOGs3uOQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY2MTEzNQ==", "bodyText": "Bindings should only log to error if something severe happened, like the detection of a bug in the code. You could make this warn.", "url": "https://github.com/openhab/openhab-addons/pull/8059#discussion_r449661135", "createdAt": "2020-07-03T17:02:21Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.lcn/src/main/java/org/openhab/binding/lcn/internal/common/PckGenerator.java", "diffHunk": "@@ -777,4 +797,28 @@ private static int timeToRampValue(int timeMSec) {\n         }\n         return ret;\n     }\n+\n+    /**\n+     * Converts duration in milliseconds to lcntimer value\n+     * Source: https://www.symcon.de/forum/threads/38603-LCN-Relais-Kurzzeit-Timer-umrechnen\n+     *\n+     * @param ms time in milliseconds\n+     * @return lcn timer value\n+     */\n+    private static Integer convertMsecToLCNTimer(double ms) {\n+        Integer lcntimer = -1;\n+        if (ms >= 0 && ms <= 240960) {\n+            double a = ms / 1000 / 0.03;\n+            double b = (a / 32.0) + 1.0;\n+            double c = Math.log(b) / Math.log(2);\n+            double mod = Math.floor(c);\n+            double faktor = 32 * (Math.pow(2, mod) - 1);\n+            double offset = (a - faktor) / Math.pow(2, mod);\n+            lcntimer = (new Double(offset + (mod * 32))).intValue();\n+        } else {\n+            LOGGER.error(\"Timer not in [0,240960] ms\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a94b61ff89653aa27af510e390138f143ee1946d"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTcwMzQ4MQ==", "bodyText": "@fwolter Thanks for your hints and suggestions. I have changed the log level to warn. Furthermore I corrected upper bound regarding duration in startRelayTimer to 240960 (was 240000).\nHopefully the formatting issues where fixed too.", "url": "https://github.com/openhab/openhab-addons/pull/8059#discussion_r449703481", "createdAt": "2020-07-03T21:04:34Z", "author": {"login": "toweosp"}, "path": "bundles/org.openhab.binding.lcn/src/main/java/org/openhab/binding/lcn/internal/common/PckGenerator.java", "diffHunk": "@@ -777,4 +797,28 @@ private static int timeToRampValue(int timeMSec) {\n         }\n         return ret;\n     }\n+\n+    /**\n+     * Converts duration in milliseconds to lcntimer value\n+     * Source: https://www.symcon.de/forum/threads/38603-LCN-Relais-Kurzzeit-Timer-umrechnen\n+     *\n+     * @param ms time in milliseconds\n+     * @return lcn timer value\n+     */\n+    private static Integer convertMsecToLCNTimer(double ms) {\n+        Integer lcntimer = -1;\n+        if (ms >= 0 && ms <= 240960) {\n+            double a = ms / 1000 / 0.03;\n+            double b = (a / 32.0) + 1.0;\n+            double c = Math.log(b) / Math.log(2);\n+            double mod = Math.floor(c);\n+            double faktor = 32 * (Math.pow(2, mod) - 1);\n+            double offset = (a - faktor) / Math.pow(2, mod);\n+            lcntimer = (new Double(offset + (mod * 32))).intValue();\n+        } else {\n+            LOGGER.error(\"Timer not in [0,240960] ms\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY2MTEzNQ=="}, "originalCommit": {"oid": "a94b61ff89653aa27af510e390138f143ee1946d"}, "originalPosition": 50}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgwMjgzNTk5OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.lcn/src/main/java/org/openhab/binding/lcn/internal/common/PckGenerator.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QxNzowMzoxMlrOGs1JmQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQyMjowMzoxNlrOGwG4uA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY2MTMzNw==", "bodyText": "I honestly don't know how to handle this from the license perspective. I'll clarify this.", "url": "https://github.com/openhab/openhab-addons/pull/8059#discussion_r449661337", "createdAt": "2020-07-03T17:03:12Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.lcn/src/main/java/org/openhab/binding/lcn/internal/common/PckGenerator.java", "diffHunk": "@@ -777,4 +797,28 @@ private static int timeToRampValue(int timeMSec) {\n         }\n         return ret;\n     }\n+\n+    /**\n+     * Converts duration in milliseconds to lcntimer value\n+     * Source: https://www.symcon.de/forum/threads/38603-LCN-Relais-Kurzzeit-Timer-umrechnen", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a94b61ff89653aa27af510e390138f143ee1946d"}, "originalPosition": 34}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzA5NzY1Ng==", "bodyText": "I'd say it is ok. The code is not copied from there, but clearly self-written as it is a different programming language - so we don't have any copyright issues here.", "url": "https://github.com/openhab/openhab-addons/pull/8059#discussion_r453097656", "createdAt": "2020-07-10T22:03:16Z", "author": {"login": "kaikreuzer"}, "path": "bundles/org.openhab.binding.lcn/src/main/java/org/openhab/binding/lcn/internal/common/PckGenerator.java", "diffHunk": "@@ -777,4 +797,28 @@ private static int timeToRampValue(int timeMSec) {\n         }\n         return ret;\n     }\n+\n+    /**\n+     * Converts duration in milliseconds to lcntimer value\n+     * Source: https://www.symcon.de/forum/threads/38603-LCN-Relais-Kurzzeit-Timer-umrechnen", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY2MTMzNw=="}, "originalCommit": {"oid": "a94b61ff89653aa27af510e390138f143ee1946d"}, "originalPosition": 34}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4692, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}