{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDM3NTYxMjcx", "number": 7969, "title": "[amazonechocontrol] add support for smarthome devices", "bodyText": "This is a follow-up to the abandoned PR #6140 and includes mainly the changes from the PR and some improvements. All feature credits go to @lkn94 and @mgeramb, I merely fixed some codestyle issues and resolved merge conflicts.\nAlso-By: Lukas Knoeller lukask@hobbyblogging.de\nAlso-By: Michael Geramb mail@michael-geramb.at\nSigned-Off-By: Jan N. Klug jan.n.klug@rub.de", "createdAt": "2020-06-21T15:33:13Z", "url": "https://github.com/openhab/openhab-addons/pull/7969", "merged": true, "mergeCommit": {"oid": "8fe3e73e1e4263cd869e20b62ce06adec3cbf703"}, "closed": true, "closedAt": "2020-07-07T20:43:53Z", "author": {"login": "J-N-K"}, "timelineItems": {"totalCount": 132, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABbSPdo9gH2gAyNDM3NTYxMjcxOmQzNWM2OWI4MjNjOWQwMjIwNGRjNmIxMjE2M2MzNzg1OGNhNzJmMTA=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcx6j0FgH2gAyNDM3NTYxMjcxOmM4NDAyMGUxMDkyMjllMjgyMmFjZWQ0ODJlZDliMzU0NjQ1NGJmNDE=", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "d35c69b823c9d02204dc6b12163c37858ca72f10", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/d35c69b823c9d02204dc6b12163c37858ca72f10", "committedDate": "2019-09-12T05:06:31Z", "message": "[amazonechocontrol]\nPolling Interval changed to minutes\nSigned-off-by: Michael Geramb <mail@michael-geramb.at> (github: mgeramb)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "58984fda4597814e23b33d33614241fbe6cd7798", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/58984fda4597814e23b33d33614241fbe6cd7798", "committedDate": "2019-09-12T05:07:47Z", "message": "[amazonechocontrol]\nPolling Interval changed to minutes\nSigned-off-by: Michael Geramb <mail@michael-geramb.at> (github: mgeramb)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "61a37f3c96cc775a178216f093a35963f682c1cd", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/61a37f3c96cc775a178216f093a35963f682c1cd", "committedDate": "2019-09-12T05:11:26Z", "message": "[amazonechocontrol]\nPolling Interval changed to minutes\nSigned-off-by: Michael Geramb <mail@michael-geramb.at> (github: mgeramb)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e908d22365eaec65a26302f4f08b09cce6abf668", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/e908d22365eaec65a26302f4f08b09cce6abf668", "committedDate": "2019-09-13T16:50:58Z", "message": "[amazonechocontrol]\nFix readme\nSigned-off-by: Michael Geramb <mail@michael-geramb.at> (github: mgeramb)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6783587c4be1edd7621bf2cb7bfd796357f8d956", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/6783587c4be1edd7621bf2cb7bfd796357f8d956", "committedDate": "2019-09-21T08:23:19Z", "message": "[amazonechocontrol]\nGuard support and code cleanup\nSigned-off-by: Michael Geramb <mail@michael-geramb.at> (github: mgeramb)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "da9e8cc599ad67c00f971ad809782a52c7a18f6e", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/da9e8cc599ad67c00f971ad809782a52c7a18f6e", "committedDate": "2019-09-24T17:45:23Z", "message": "Merge branch 'master' of https://github.com/openhab/openhab2-addons"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a2ccc5cae5eea0674195e59c02c1b7577cde1178", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/a2ccc5cae5eea0674195e59c02c1b7577cde1178", "committedDate": "2019-09-25T19:05:25Z", "message": "[amazonechocontrol]\nFix delayed update\nSigned-off-by: Michael Geramb <mail@michael-geramb.at> (github: mgeramb)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1d28a5502330c097a141ec526cb8a534652fc9d8", "author": {"user": {"login": "lkn94", "name": "Lukas Knoeller"}}, "url": "https://github.com/openhab/openhab-addons/commit/1d28a5502330c097a141ec526cb8a534652fc9d8", "committedDate": "2019-09-27T19:05:54Z", "message": "Merge pull request #6 from mgeramb/HandleOnOffInPercentageChannel\n\n[amazonechocontrol]"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bb711ee07f78712c58d2919e7181826d6295a73d", "author": {"user": {"login": "lkn94", "name": "Lukas Knoeller"}}, "url": "https://github.com/openhab/openhab-addons/commit/bb711ee07f78712c58d2919e7181826d6295a73d", "committedDate": "2019-09-27T19:44:14Z", "message": "Conflicts resolved"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f3ac308e3b476f86ad0a8be6b1f485d1003b982e", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/f3ac308e3b476f86ad0a8be6b1f485d1003b982e", "committedDate": "2019-10-02T18:11:28Z", "message": "[amazonechocontrol]\nSmartHome update groups\nSigned-off-by: Michael Geramb <mail@michael-geramb.at> (github: mgeramb)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8365a5bfd3a32f485d16980048d95acf9796ac54", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/8365a5bfd3a32f485d16980048d95acf9796ac54", "committedDate": "2019-10-02T18:20:18Z", "message": "[amazonechocontrol]\nSmartHome update groups\nSigned-off-by: Michael Geramb <mail@michael-geramb.at> (github: mgeramb)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1dd4e208fc29b4e0dc582d9173b7e70d9036abb9", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/1dd4e208fc29b4e0dc582d9173b7e70d9036abb9", "committedDate": "2019-10-16T17:22:41Z", "message": "Merge branch 'master' of https://github.com/openhab/openhab2-addons"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f4dfe2d8a5d4e0e5f92e514c7114dffef3fbd904", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/f4dfe2d8a5d4e0e5f92e514c7114dffef3fbd904", "committedDate": "2019-10-16T17:31:13Z", "message": "[amazonechocontrol]\nFix spelling\nSigned-off-by: Michael Geramb <mail@michael-geramb.at> (github: mgeramb)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e12ba9cdfdc85ffb1cb90bbb095d78a7ac7c8c76", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/e12ba9cdfdc85ffb1cb90bbb095d78a7ac7c8c76", "committedDate": "2019-10-16T18:57:02Z", "message": "[amazonechocontrol]\nFix group initialization\nSigned-off-by: Michael Geramb <mail@michael-geramb.at> (github: mgeramb)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "417f3f800a9b3723ca0e9c121bffaa19e2b044da", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/417f3f800a9b3723ca0e9c121bffaa19e2b044da", "committedDate": "2019-11-17T20:15:04Z", "message": "Merge branch 'master' of https://github.com/openhab/openhab2-addons"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b42de5dbca388dfa5b1cc51df1f2ccd4ea00444c", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/b42de5dbca388dfa5b1cc51df1f2ccd4ea00444c", "committedDate": "2019-11-17T21:13:04Z", "message": "[amazonechocontrol]\nMerge master\nSigned-off-by: Michael Geramb <mail@michael-geramb.at> (github: mgeramb)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f2ae58075b23e3e404556ea54f5c7c52b675eef7", "author": {"user": {"login": "lkn94", "name": "Lukas Knoeller"}}, "url": "https://github.com/openhab/openhab-addons/commit/f2ae58075b23e3e404556ea54f5c7c52b675eef7", "committedDate": "2019-11-18T05:18:54Z", "message": "Merge pull request #11 from mgeramb/SmartHomeDeviceHandling\n\nMerge of openhab master and improve readme"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "892b51b11713d1afab37a09fd8fbedb58ecce57a", "author": {"user": {"login": "lkn94", "name": "Lukas Knoeller"}}, "url": "https://github.com/openhab/openhab-addons/commit/892b51b11713d1afab37a09fd8fbedb58ecce57a", "committedDate": "2019-11-20T17:38:20Z", "message": "Removed unused file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "11ce859e4838826af6227be5efd057377cbeb4f6", "author": {"user": {"login": "lkn94", "name": "Lukas Knoeller"}}, "url": "https://github.com/openhab/openhab-addons/commit/11ce859e4838826af6227be5efd057377cbeb4f6", "committedDate": "2019-11-20T17:47:10Z", "message": "Removed unused file"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "306f57be2160044bb50dfa55c3c72b417f333e73", "author": {"user": {"login": "lkn94", "name": "Lukas Knoeller"}}, "url": "https://github.com/openhab/openhab-addons/commit/306f57be2160044bb50dfa55c3c72b417f333e73", "committedDate": "2019-11-20T18:16:10Z", "message": "Error fixes"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f37c709e0a670b5192777218a618fe3369598dab", "author": {"user": {"login": "J-N-K", "name": null}}, "url": "https://github.com/openhab/openhab-addons/commit/f37c709e0a670b5192777218a618fe3369598dab", "committedDate": "2020-06-20T08:07:29Z", "message": "codestyle\n\nSigned-off-by: Jan N. Klug <jan.n.klug@rub.de>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "fc99c6ea3d99a0f14bb98ddc26b92eabfdbe4eec", "author": {"user": {"login": "J-N-K", "name": null}}, "url": "https://github.com/openhab/openhab-addons/commit/fc99c6ea3d99a0f14bb98ddc26b92eabfdbe4eec", "committedDate": "2020-06-20T08:22:09Z", "message": "Merge branch '2.5.x' into lkn94_SmartHome\n\n# Conflicts:\n#\tbundles/org.openhab.binding.amazonechocontrol/README.md\n#\tbundles/org.openhab.binding.amazonechocontrol/pom.xml\n#\tbundles/org.openhab.binding.amazonechocontrol/src/main/feature/feature.xml\n#\tbundles/org.openhab.binding.amazonechocontrol/src/main/java/org/openhab/binding/amazonechocontrol/internal/AmazonEchoControlBindingConstants.java\n#\tbundles/org.openhab.binding.amazonechocontrol/src/main/java/org/openhab/binding/amazonechocontrol/internal/AmazonEchoControlHandlerFactory.java\n#\tbundles/org.openhab.binding.amazonechocontrol/src/main/java/org/openhab/binding/amazonechocontrol/internal/WebSocketConnection.java\n#\tbundles/org.openhab.binding.amazonechocontrol/src/main/java/org/openhab/binding/amazonechocontrol/internal/discovery/AmazonEchoDiscovery.java\n#\tbundles/org.openhab.binding.amazonechocontrol/src/main/resources/ESH-INF/binding/binding.xml\n#\tbundles/org.openhab.binding.amazonechocontrol/src/main/resources/ESH-INF/thing/thing-types.xml"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM0NTEzMTc3", "url": "https://github.com/openhab/openhab-addons/pull/7969#pullrequestreview-434513177", "createdAt": "2020-06-21T16:00:53Z", "commit": {"oid": "35529199fe2b59ede77d01a66e2a1a368bc80e10"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2MTExMzQ2", "url": "https://github.com/openhab/openhab-addons/pull/7969#pullrequestreview-436111346", "createdAt": "2020-06-23T20:00:27Z", "commit": {"oid": "1b5420d0c2985a42b5f8f8f5594ad63354a87216"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QyMDowMDoyN1rOGn4gaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yM1QyMDo1MDoxNVrOGn6CsA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDQ3MzQ0OA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            | amazonMusicTrackId    | String      | R/W         | echo, echoshow, echospot, wha | Start playing of a Amazon Music track by it's id od stops playing if a empty string was provided\n          \n          \n            \n            | amazonMusicTrackId    | String      | R/W         | echo, echoshow, echospot, wha | Start playing of an Amazon Music track by specifying its id or stops playing if an empty string was provided", "url": "https://github.com/openhab/openhab-addons/pull/7969#discussion_r444473448", "createdAt": "2020-06-23T20:00:27Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.amazonechocontrol/README.md", "diffHunk": "@@ -119,21 +161,23 @@ It will be configured at runtime by using the save channel to store the current\n | bluetoothDeviceName   | String      | R           | echo, echoshow, echospot      | User friendly name of the connected bluetooth device\n | radioStationId        | String      | R/W         | echo, echoshow, echospot, wha | Start playing of a TuneIn radio station by specifying its id or stops playing if an empty string was provided\n | radio                 | Switch      | R/W         | echo, echoshow, echospot, wha | Start playing of the last used TuneIn radio station (works after the radio station started after the openhab start)\n+| amazonMusicTrackId    | String      | R/W         | echo, echoshow, echospot, wha | Start playing of a Amazon Music track by it's id od stops playing if a empty string was provided", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b5420d0c2985a42b5f8f8f5594ad63354a87216"}, "originalPosition": 130}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDQ3MzY5Mg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            | amazonMusicPlayListId | String      | W           | echo, echoshow, echospot, wha | Write Only! Start playing of a Amazon Music playlist by specifying it's id od stops playing if a empty string was provided. Selection will only work in PaperUI\n          \n          \n            \n            | amazonMusicPlayListId | String      | W           | echo, echoshow, echospot, wha | Write Only! Start playing of an Amazon Music playlist by specifying its id or stops playing if an empty string was provided. Selection will only work in PaperUI", "url": "https://github.com/openhab/openhab-addons/pull/7969#discussion_r444473692", "createdAt": "2020-06-23T20:00:51Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.amazonechocontrol/README.md", "diffHunk": "@@ -119,21 +161,23 @@ It will be configured at runtime by using the save channel to store the current\n | bluetoothDeviceName   | String      | R           | echo, echoshow, echospot      | User friendly name of the connected bluetooth device\n | radioStationId        | String      | R/W         | echo, echoshow, echospot, wha | Start playing of a TuneIn radio station by specifying its id or stops playing if an empty string was provided\n | radio                 | Switch      | R/W         | echo, echoshow, echospot, wha | Start playing of the last used TuneIn radio station (works after the radio station started after the openhab start)\n+| amazonMusicTrackId    | String      | R/W         | echo, echoshow, echospot, wha | Start playing of a Amazon Music track by it's id od stops playing if a empty string was provided\n+| amazonMusicPlayListId | String      | W           | echo, echoshow, echospot, wha | Write Only! Start playing of a Amazon Music playlist by specifying it's id od stops playing if a empty string was provided. Selection will only work in PaperUI", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b5420d0c2985a42b5f8f8f5594ad63354a87216"}, "originalPosition": 131}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDQ4Mjg1MQ==", "bodyText": "Isn't ExtendedDiscoveryService deprecated?", "url": "https://github.com/openhab/openhab-addons/pull/7969#discussion_r444482851", "createdAt": "2020-06-23T20:19:28Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.amazonechocontrol/src/main/java/org/openhab/binding/amazonechocontrol/internal/discovery/AmazonEchoDiscovery.java", "diffHunk": "@@ -44,17 +54,24 @@\n  * @author Michael Geramb - Initial contribution\n  */\n @NonNullByDefault\n-public class AmazonEchoDiscovery extends AbstractDiscoveryService {\n+public class AmazonEchoDiscovery extends AbstractDiscoveryService implements ExtendedDiscoveryService {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b5420d0c2985a42b5f8f8f5594ad63354a87216"}, "originalPosition": 31}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDQ5MDE5MA==", "bodyText": "What is the point of this using Function<String, HandlerBase>  values instead of Supplier<HandlerBase> values? None of the statically constructed values even use the String argument.", "url": "https://github.com/openhab/openhab-addons/pull/7969#discussion_r444490190", "createdAt": "2020-06-23T20:33:50Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.amazonechocontrol/src/main/java/org/openhab/binding/amazonechocontrol/internal/smarthome/Constants.java", "diffHunk": "@@ -0,0 +1,59 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.amazonechocontrol.internal.smarthome;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.function.Function;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.thing.type.ChannelTypeUID;\n+import org.openhab.binding.amazonechocontrol.internal.AmazonEchoControlBindingConstants;\n+\n+/**\n+ * @author Michael Geramb - Initial contribution\n+ */\n+@NonNullByDefault\n+public class Constants {\n+    public static final Map<String, @Nullable Function<String, HandlerBase>> HANDLER_FACTORY = new HashMap<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b5420d0c2985a42b5f8f8f5594ad63354a87216"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDQ5NDk2Ng==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        SmartHomeCapability capabilities[] = shd.capabilities;\n          \n          \n            \n                        SmartHomeCapability[] capabilities = shd.capabilities;", "url": "https://github.com/openhab/openhab-addons/pull/7969#discussion_r444494966", "createdAt": "2020-06-23T20:43:16Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.amazonechocontrol/src/main/java/org/openhab/binding/amazonechocontrol/internal/handler/SmartHomeDeviceHandler.java", "diffHunk": "@@ -0,0 +1,391 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.amazonechocontrol.internal.handler;\n+\n+import static org.openhab.binding.amazonechocontrol.internal.AmazonEchoControlBindingConstants.DEVICE_PROPERTY_ID;\n+import static org.openhab.binding.amazonechocontrol.internal.smarthome.Constants.SUPPORTED_INTERFACES;\n+\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Locale;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.function.Function;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.Channel;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.BridgeHandler;\n+import org.eclipse.smarthome.core.thing.binding.builder.ChannelBuilder;\n+import org.eclipse.smarthome.core.thing.type.ChannelTypeUID;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.eclipse.smarthome.core.types.State;\n+import org.eclipse.smarthome.core.types.StateDescription;\n+import org.openhab.binding.amazonechocontrol.internal.Connection;\n+import org.openhab.binding.amazonechocontrol.internal.jsons.JsonSmartHomeCapabilities.SmartHomeCapability;\n+import org.openhab.binding.amazonechocontrol.internal.jsons.JsonSmartHomeDevices.SmartHomeDevice;\n+import org.openhab.binding.amazonechocontrol.internal.jsons.JsonSmartHomeGroups.SmartHomeGroup;\n+import org.openhab.binding.amazonechocontrol.internal.jsons.SmartHomeBaseDevice;\n+import org.openhab.binding.amazonechocontrol.internal.smarthome.Constants;\n+import org.openhab.binding.amazonechocontrol.internal.smarthome.HandlerBase;\n+import org.openhab.binding.amazonechocontrol.internal.smarthome.HandlerBase.ChannelInfo;\n+import org.openhab.binding.amazonechocontrol.internal.smarthome.HandlerBase.UpdateChannelResult;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import com.google.gson.Gson;\n+import com.google.gson.JsonArray;\n+import com.google.gson.JsonElement;\n+import com.google.gson.JsonObject;\n+\n+/**\n+ * @author Lukas Knoeller - Initial contribution\n+ */\n+@NonNullByDefault\n+public class SmartHomeDeviceHandler extends BaseThingHandler {\n+    private final Logger logger = LoggerFactory.getLogger(SmartHomeDeviceHandler.class);\n+\n+    private @Nullable SmartHomeBaseDevice smartHomeBaseDevice;\n+    private final Gson gson;\n+    private final Map<String, @Nullable HandlerBase> handlers = new HashMap<>();\n+    private final Map<String, @Nullable JsonArray> lastStates = new HashMap<>();\n+\n+    public SmartHomeDeviceHandler(Thing thing, Gson gson) {\n+        super(thing);\n+        this.gson = gson;\n+    }\n+\n+    public synchronized void setDeviceAndUpdateThingState(AccountHandler accountHandler,\n+            @Nullable SmartHomeBaseDevice smartHomeBaseDevice) {\n+        if (smartHomeBaseDevice == null) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.NONE, \"Can't find smarthomeBaseDevice\");\n+            return;\n+        }\n+        boolean changed = this.smartHomeBaseDevice == null;\n+        this.smartHomeBaseDevice = smartHomeBaseDevice;\n+\n+        Set<String> unusedChannels = new HashSet<>();\n+        thing.getChannels().forEach(channel -> unusedChannels.add(channel.getUID().getId()));\n+\n+        Set<String> unusedHandlers = new HashSet<>(handlers.keySet());\n+\n+        Map<String, List<SmartHomeCapability>> capabilities = new HashMap<>();\n+        getCapabilities(capabilities, accountHandler, smartHomeBaseDevice);\n+\n+        for (String interfaceName : capabilities.keySet()) {\n+            HandlerBase handler = handlers.get(interfaceName);\n+            if (handler != null) {\n+                unusedHandlers.remove(interfaceName);\n+            } else {\n+                Function<String, HandlerBase> creator = Constants.HANDLER_FACTORY.get(interfaceName);\n+                if (creator != null) {\n+                    handler = creator.apply(interfaceName);\n+                    handlers.put(interfaceName, handler);\n+                }\n+            }\n+            if (handler != null) {\n+                Collection<ChannelInfo> required = handler.initialize(this, capabilities.get(interfaceName));\n+                for (ChannelInfo channelInfo : required) {\n+                    unusedChannels.remove(channelInfo.channelId);\n+                    if (addChannelToDevice(channelInfo.channelId, channelInfo.itemType, channelInfo.channelTypeUID)) {\n+                        changed = true;\n+                    }\n+                }\n+            }\n+        }\n+\n+        unusedHandlers.forEach(handlers::remove);\n+        if (!unusedChannels.isEmpty()) {\n+            changed = true;\n+            unusedChannels.forEach(this::removeChannelFromDevice);\n+        }\n+\n+        if (changed) {\n+            updateStatus(ThingStatus.UNKNOWN, ThingStatusDetail.NONE, \"Thing has changed.\");\n+            accountHandler.forceDelayedSmartHomeStateUpdate(findId());\n+        }\n+    }\n+\n+    public String findId() {\n+        String id = (String) getConfig().get(DEVICE_PROPERTY_ID);\n+        if (id == null) {\n+            return \"\";\n+        }\n+        return id;\n+    }\n+\n+    @Override\n+    public void updateState(String channelId, State state) {\n+        super.updateState(new ChannelUID(thing.getUID(), channelId), state);\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        logger.info(\"initializing {}\", thing.getUID());\n+        AccountHandler accountHandler = getAccountHandler();\n+        if (accountHandler != null) {\n+            accountHandler.addSmartHomeDeviceHandler(this);\n+            setDeviceAndUpdateThingState(accountHandler, smartHomeBaseDevice);\n+        } else {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, \"Bridgehandler not found\");\n+        }\n+    }\n+\n+    private boolean addChannelToDevice(String channelId, String itemType, ChannelTypeUID channelTypeUID) {\n+        Channel channel = thing.getChannel(channelId);\n+        if (channel != null) {\n+            if (channelTypeUID.equals(channel.getChannelTypeUID()) && itemType.equals(channel.getAcceptedItemType())) {\n+                // channel exist with the same settings\n+                return false;\n+            }\n+            // channel exist with other settings, remove it first\n+            removeChannelFromDevice(channelId);\n+        }\n+        updateThing(\n+                editThing().withChannel(ChannelBuilder.create(new ChannelUID(getThing().getUID(), channelId), itemType)\n+                        .withType(channelTypeUID).build()).build());\n+        return true;\n+    }\n+\n+    private void removeChannelFromDevice(String channelId) {\n+        updateThing(editThing().withoutChannel(new ChannelUID(getThing().getUID(), channelId)).build());\n+    }\n+\n+    public void updateChannelStates(List<SmartHomeBaseDevice> allDevices,\n+            Map<String, JsonArray> applianceIdToCapabilityStates) {\n+        AccountHandler accountHandler = getAccountHandler();\n+        SmartHomeBaseDevice smartHomeBaseDevice = this.smartHomeBaseDevice;\n+        if (smartHomeBaseDevice == null) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.NONE, \"Can't find smarthomeBaseDevice!\");\n+            return;\n+        }\n+\n+        boolean stateFound = false;\n+        Map<String, List<JsonObject>> mapInterfaceToStates = new HashMap<>();\n+        SmartHomeDevice firstDevice = null;\n+        for (SmartHomeDevice shd : getSupportedSmartHomeDevices(smartHomeBaseDevice, allDevices)) {\n+            JsonArray states = applianceIdToCapabilityStates.get(shd.applianceId);\n+            String applianceId = shd.applianceId;\n+            if (applianceId == null) {\n+                continue;\n+            }\n+            if (states != null) {\n+                stateFound = true;\n+                if (smartHomeBaseDevice.isGroup()) {\n+                    // for groups, store the last state of all devices\n+                    lastStates.put(applianceId, states);\n+                }\n+            } else {\n+                states = lastStates.get(applianceId);\n+                if (states == null) {\n+                    continue;\n+                }\n+            }\n+            if (firstDevice == null) {\n+                firstDevice = shd;\n+            }\n+            for (JsonElement stateElement : states) {\n+                String stateJson = stateElement.getAsString();\n+                if (stateJson.startsWith(\"{\") && stateJson.endsWith(\"}\")) {\n+                    JsonObject state = gson.fromJson(stateJson, JsonObject.class);\n+                    String interfaceName = state.get(\"namespace\").getAsString();\n+                    mapInterfaceToStates.computeIfAbsent(interfaceName, k -> new ArrayList<>()).add(state);\n+                }\n+            }\n+        }\n+        for (HandlerBase handlerBase : handlers.values()) {\n+            if (handlerBase == null) {\n+                continue;\n+            }\n+            UpdateChannelResult result = new UpdateChannelResult();\n+\n+            for (String interfaceName : handlerBase.getSupportedInterface()) {\n+                List<JsonObject> stateList = mapInterfaceToStates.getOrDefault(interfaceName, Collections.emptyList());\n+                try {\n+                    handlerBase.updateChannels(interfaceName, stateList, result);\n+                } catch (Exception e) {\n+                    // We catch all exceptions, otherwise all other things are not updated!\n+                    logger.debug(\"Updating states failed\", e);\n+                    updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR, e.getLocalizedMessage());\n+                }\n+            }\n+\n+            if (result.needSingleUpdate && smartHomeBaseDevice instanceof SmartHomeDevice && accountHandler != null) {\n+                SmartHomeDevice shd = (SmartHomeDevice) smartHomeBaseDevice;\n+                accountHandler.forceDelayedSmartHomeStateUpdate(shd.findId());\n+            }\n+        }\n+\n+        if (stateFound) {\n+            updateStatus(ThingStatus.ONLINE);\n+        } else {\n+            updateStatus(ThingStatus.UNKNOWN, ThingStatusDetail.NONE, \"State not found\");\n+        }\n+    }\n+\n+    private @Nullable AccountHandler getAccountHandler() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            BridgeHandler bridgeHandler = bridge.getHandler();\n+            if (bridgeHandler instanceof AccountHandler) {\n+                return (AccountHandler) bridgeHandler;\n+            }\n+        }\n+\n+        return null;\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        AccountHandler accountHandler = getAccountHandler();\n+        if (accountHandler == null) {\n+            logger.debug(\"accountHandler is null in {}\", thing.getUID());\n+            return;\n+        }\n+        Connection connection = accountHandler.findConnection();\n+        if (connection == null) {\n+            logger.debug(\"connection is null in {}\", thing.getUID());\n+            return;\n+        }\n+\n+        try {\n+            if (command instanceof RefreshType) {\n+                accountHandler.forceDelayedSmartHomeStateUpdate(findId());\n+                return;\n+            }\n+            SmartHomeBaseDevice smartHomeBaseDevice = this.smartHomeBaseDevice;\n+            if (smartHomeBaseDevice == null) {\n+                logger.debug(\"smarthomeBaseDevice is null in {}\", thing.getUID());\n+                return;\n+            }\n+            Set<SmartHomeDevice> devices = getSupportedSmartHomeDevices(smartHomeBaseDevice,\n+                    accountHandler.getLastKnownSmartHomeDevice());\n+            String channelId = channelUID.getId();\n+\n+            for (String interfaceName : handlers.keySet()) {\n+                HandlerBase handlerBase = handlers.get(interfaceName);\n+                if (handlerBase == null || !handlerBase.hasChannel(channelId)) {\n+                    continue;\n+                }\n+                for (SmartHomeDevice shd : devices) {\n+                    String entityId = shd.entityId;\n+                    if (entityId == null) {\n+                        continue;\n+                    }\n+                    SmartHomeCapability[] capabilities = shd.capabilities;\n+                    if (capabilities == null) {\n+                        logger.debug(\"capabilities is null in {}\", thing.getUID());\n+                        return;\n+                    }\n+                    accountHandler.forceDelayedSmartHomeStateUpdate(findId()); // block updates\n+                    if (handlerBase.handleCommand(connection, shd, entityId, capabilities, channelUID.getId(),\n+                            command)) {\n+                        accountHandler.forceDelayedSmartHomeStateUpdate(findId()); // force update again to restart\n+                        // update timer\n+                        logger.debug(\"Command {} sent to {}\", command, shd.findId());\n+                    }\n+                }\n+            }\n+        } catch (Exception e) {\n+            logger.warn(\"Handle command failed\", e);\n+        }\n+    }\n+\n+    private static void getCapabilities(Map<String, List<SmartHomeCapability>> result, AccountHandler accountHandler,\n+            SmartHomeBaseDevice device) {\n+        if (device instanceof SmartHomeDevice) {\n+            SmartHomeDevice shd = (SmartHomeDevice) device;\n+            SmartHomeCapability capabilities[] = shd.capabilities;\n+            if (capabilities == null) {\n+                return;\n+            }\n+            for (SmartHomeCapability capability : capabilities) {\n+                String interfaceName = capability.interfaceName;\n+                if (interfaceName != null) {\n+                    result.computeIfAbsent(interfaceName, name -> new ArrayList<>()).add(capability);\n+                }\n+            }\n+        }\n+        if (device instanceof SmartHomeGroup) {\n+            for (SmartHomeDevice shd : getSupportedSmartHomeDevices(device,\n+                    accountHandler.getLastKnownSmartHomeDevice())) {\n+                getCapabilities(result, accountHandler, shd);\n+            }\n+        }\n+    }\n+\n+    public static Set<SmartHomeDevice> getSupportedSmartHomeDevices(@Nullable SmartHomeBaseDevice baseDevice,\n+            List<SmartHomeBaseDevice> allDevices) {\n+        Set<SmartHomeDevice> result = new HashSet<>();\n+        if (baseDevice == null) {\n+            return Collections.emptySet();\n+        }\n+        if (baseDevice instanceof SmartHomeDevice) {\n+            SmartHomeDevice shd = (SmartHomeDevice) baseDevice;\n+            SmartHomeCapability capabilities[] = shd.capabilities;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b5420d0c2985a42b5f8f8f5594ad63354a87216"}, "originalPosition": 347}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDQ5NTE1Mw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                    SmartHomeCapability capabilities[] = shd.capabilities;\n          \n          \n            \n                                    SmartHomeCapability[] capabilities = shd.capabilities;", "url": "https://github.com/openhab/openhab-addons/pull/7969#discussion_r444495153", "createdAt": "2020-06-23T20:43:38Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.amazonechocontrol/src/main/java/org/openhab/binding/amazonechocontrol/internal/handler/SmartHomeDeviceHandler.java", "diffHunk": "@@ -0,0 +1,391 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.amazonechocontrol.internal.handler;\n+\n+import static org.openhab.binding.amazonechocontrol.internal.AmazonEchoControlBindingConstants.DEVICE_PROPERTY_ID;\n+import static org.openhab.binding.amazonechocontrol.internal.smarthome.Constants.SUPPORTED_INTERFACES;\n+\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Locale;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.function.Function;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.Channel;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.BridgeHandler;\n+import org.eclipse.smarthome.core.thing.binding.builder.ChannelBuilder;\n+import org.eclipse.smarthome.core.thing.type.ChannelTypeUID;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.eclipse.smarthome.core.types.State;\n+import org.eclipse.smarthome.core.types.StateDescription;\n+import org.openhab.binding.amazonechocontrol.internal.Connection;\n+import org.openhab.binding.amazonechocontrol.internal.jsons.JsonSmartHomeCapabilities.SmartHomeCapability;\n+import org.openhab.binding.amazonechocontrol.internal.jsons.JsonSmartHomeDevices.SmartHomeDevice;\n+import org.openhab.binding.amazonechocontrol.internal.jsons.JsonSmartHomeGroups.SmartHomeGroup;\n+import org.openhab.binding.amazonechocontrol.internal.jsons.SmartHomeBaseDevice;\n+import org.openhab.binding.amazonechocontrol.internal.smarthome.Constants;\n+import org.openhab.binding.amazonechocontrol.internal.smarthome.HandlerBase;\n+import org.openhab.binding.amazonechocontrol.internal.smarthome.HandlerBase.ChannelInfo;\n+import org.openhab.binding.amazonechocontrol.internal.smarthome.HandlerBase.UpdateChannelResult;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import com.google.gson.Gson;\n+import com.google.gson.JsonArray;\n+import com.google.gson.JsonElement;\n+import com.google.gson.JsonObject;\n+\n+/**\n+ * @author Lukas Knoeller - Initial contribution\n+ */\n+@NonNullByDefault\n+public class SmartHomeDeviceHandler extends BaseThingHandler {\n+    private final Logger logger = LoggerFactory.getLogger(SmartHomeDeviceHandler.class);\n+\n+    private @Nullable SmartHomeBaseDevice smartHomeBaseDevice;\n+    private final Gson gson;\n+    private final Map<String, @Nullable HandlerBase> handlers = new HashMap<>();\n+    private final Map<String, @Nullable JsonArray> lastStates = new HashMap<>();\n+\n+    public SmartHomeDeviceHandler(Thing thing, Gson gson) {\n+        super(thing);\n+        this.gson = gson;\n+    }\n+\n+    public synchronized void setDeviceAndUpdateThingState(AccountHandler accountHandler,\n+            @Nullable SmartHomeBaseDevice smartHomeBaseDevice) {\n+        if (smartHomeBaseDevice == null) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.NONE, \"Can't find smarthomeBaseDevice\");\n+            return;\n+        }\n+        boolean changed = this.smartHomeBaseDevice == null;\n+        this.smartHomeBaseDevice = smartHomeBaseDevice;\n+\n+        Set<String> unusedChannels = new HashSet<>();\n+        thing.getChannels().forEach(channel -> unusedChannels.add(channel.getUID().getId()));\n+\n+        Set<String> unusedHandlers = new HashSet<>(handlers.keySet());\n+\n+        Map<String, List<SmartHomeCapability>> capabilities = new HashMap<>();\n+        getCapabilities(capabilities, accountHandler, smartHomeBaseDevice);\n+\n+        for (String interfaceName : capabilities.keySet()) {\n+            HandlerBase handler = handlers.get(interfaceName);\n+            if (handler != null) {\n+                unusedHandlers.remove(interfaceName);\n+            } else {\n+                Function<String, HandlerBase> creator = Constants.HANDLER_FACTORY.get(interfaceName);\n+                if (creator != null) {\n+                    handler = creator.apply(interfaceName);\n+                    handlers.put(interfaceName, handler);\n+                }\n+            }\n+            if (handler != null) {\n+                Collection<ChannelInfo> required = handler.initialize(this, capabilities.get(interfaceName));\n+                for (ChannelInfo channelInfo : required) {\n+                    unusedChannels.remove(channelInfo.channelId);\n+                    if (addChannelToDevice(channelInfo.channelId, channelInfo.itemType, channelInfo.channelTypeUID)) {\n+                        changed = true;\n+                    }\n+                }\n+            }\n+        }\n+\n+        unusedHandlers.forEach(handlers::remove);\n+        if (!unusedChannels.isEmpty()) {\n+            changed = true;\n+            unusedChannels.forEach(this::removeChannelFromDevice);\n+        }\n+\n+        if (changed) {\n+            updateStatus(ThingStatus.UNKNOWN, ThingStatusDetail.NONE, \"Thing has changed.\");\n+            accountHandler.forceDelayedSmartHomeStateUpdate(findId());\n+        }\n+    }\n+\n+    public String findId() {\n+        String id = (String) getConfig().get(DEVICE_PROPERTY_ID);\n+        if (id == null) {\n+            return \"\";\n+        }\n+        return id;\n+    }\n+\n+    @Override\n+    public void updateState(String channelId, State state) {\n+        super.updateState(new ChannelUID(thing.getUID(), channelId), state);\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        logger.info(\"initializing {}\", thing.getUID());\n+        AccountHandler accountHandler = getAccountHandler();\n+        if (accountHandler != null) {\n+            accountHandler.addSmartHomeDeviceHandler(this);\n+            setDeviceAndUpdateThingState(accountHandler, smartHomeBaseDevice);\n+        } else {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, \"Bridgehandler not found\");\n+        }\n+    }\n+\n+    private boolean addChannelToDevice(String channelId, String itemType, ChannelTypeUID channelTypeUID) {\n+        Channel channel = thing.getChannel(channelId);\n+        if (channel != null) {\n+            if (channelTypeUID.equals(channel.getChannelTypeUID()) && itemType.equals(channel.getAcceptedItemType())) {\n+                // channel exist with the same settings\n+                return false;\n+            }\n+            // channel exist with other settings, remove it first\n+            removeChannelFromDevice(channelId);\n+        }\n+        updateThing(\n+                editThing().withChannel(ChannelBuilder.create(new ChannelUID(getThing().getUID(), channelId), itemType)\n+                        .withType(channelTypeUID).build()).build());\n+        return true;\n+    }\n+\n+    private void removeChannelFromDevice(String channelId) {\n+        updateThing(editThing().withoutChannel(new ChannelUID(getThing().getUID(), channelId)).build());\n+    }\n+\n+    public void updateChannelStates(List<SmartHomeBaseDevice> allDevices,\n+            Map<String, JsonArray> applianceIdToCapabilityStates) {\n+        AccountHandler accountHandler = getAccountHandler();\n+        SmartHomeBaseDevice smartHomeBaseDevice = this.smartHomeBaseDevice;\n+        if (smartHomeBaseDevice == null) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.NONE, \"Can't find smarthomeBaseDevice!\");\n+            return;\n+        }\n+\n+        boolean stateFound = false;\n+        Map<String, List<JsonObject>> mapInterfaceToStates = new HashMap<>();\n+        SmartHomeDevice firstDevice = null;\n+        for (SmartHomeDevice shd : getSupportedSmartHomeDevices(smartHomeBaseDevice, allDevices)) {\n+            JsonArray states = applianceIdToCapabilityStates.get(shd.applianceId);\n+            String applianceId = shd.applianceId;\n+            if (applianceId == null) {\n+                continue;\n+            }\n+            if (states != null) {\n+                stateFound = true;\n+                if (smartHomeBaseDevice.isGroup()) {\n+                    // for groups, store the last state of all devices\n+                    lastStates.put(applianceId, states);\n+                }\n+            } else {\n+                states = lastStates.get(applianceId);\n+                if (states == null) {\n+                    continue;\n+                }\n+            }\n+            if (firstDevice == null) {\n+                firstDevice = shd;\n+            }\n+            for (JsonElement stateElement : states) {\n+                String stateJson = stateElement.getAsString();\n+                if (stateJson.startsWith(\"{\") && stateJson.endsWith(\"}\")) {\n+                    JsonObject state = gson.fromJson(stateJson, JsonObject.class);\n+                    String interfaceName = state.get(\"namespace\").getAsString();\n+                    mapInterfaceToStates.computeIfAbsent(interfaceName, k -> new ArrayList<>()).add(state);\n+                }\n+            }\n+        }\n+        for (HandlerBase handlerBase : handlers.values()) {\n+            if (handlerBase == null) {\n+                continue;\n+            }\n+            UpdateChannelResult result = new UpdateChannelResult();\n+\n+            for (String interfaceName : handlerBase.getSupportedInterface()) {\n+                List<JsonObject> stateList = mapInterfaceToStates.getOrDefault(interfaceName, Collections.emptyList());\n+                try {\n+                    handlerBase.updateChannels(interfaceName, stateList, result);\n+                } catch (Exception e) {\n+                    // We catch all exceptions, otherwise all other things are not updated!\n+                    logger.debug(\"Updating states failed\", e);\n+                    updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR, e.getLocalizedMessage());\n+                }\n+            }\n+\n+            if (result.needSingleUpdate && smartHomeBaseDevice instanceof SmartHomeDevice && accountHandler != null) {\n+                SmartHomeDevice shd = (SmartHomeDevice) smartHomeBaseDevice;\n+                accountHandler.forceDelayedSmartHomeStateUpdate(shd.findId());\n+            }\n+        }\n+\n+        if (stateFound) {\n+            updateStatus(ThingStatus.ONLINE);\n+        } else {\n+            updateStatus(ThingStatus.UNKNOWN, ThingStatusDetail.NONE, \"State not found\");\n+        }\n+    }\n+\n+    private @Nullable AccountHandler getAccountHandler() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            BridgeHandler bridgeHandler = bridge.getHandler();\n+            if (bridgeHandler instanceof AccountHandler) {\n+                return (AccountHandler) bridgeHandler;\n+            }\n+        }\n+\n+        return null;\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        AccountHandler accountHandler = getAccountHandler();\n+        if (accountHandler == null) {\n+            logger.debug(\"accountHandler is null in {}\", thing.getUID());\n+            return;\n+        }\n+        Connection connection = accountHandler.findConnection();\n+        if (connection == null) {\n+            logger.debug(\"connection is null in {}\", thing.getUID());\n+            return;\n+        }\n+\n+        try {\n+            if (command instanceof RefreshType) {\n+                accountHandler.forceDelayedSmartHomeStateUpdate(findId());\n+                return;\n+            }\n+            SmartHomeBaseDevice smartHomeBaseDevice = this.smartHomeBaseDevice;\n+            if (smartHomeBaseDevice == null) {\n+                logger.debug(\"smarthomeBaseDevice is null in {}\", thing.getUID());\n+                return;\n+            }\n+            Set<SmartHomeDevice> devices = getSupportedSmartHomeDevices(smartHomeBaseDevice,\n+                    accountHandler.getLastKnownSmartHomeDevice());\n+            String channelId = channelUID.getId();\n+\n+            for (String interfaceName : handlers.keySet()) {\n+                HandlerBase handlerBase = handlers.get(interfaceName);\n+                if (handlerBase == null || !handlerBase.hasChannel(channelId)) {\n+                    continue;\n+                }\n+                for (SmartHomeDevice shd : devices) {\n+                    String entityId = shd.entityId;\n+                    if (entityId == null) {\n+                        continue;\n+                    }\n+                    SmartHomeCapability[] capabilities = shd.capabilities;\n+                    if (capabilities == null) {\n+                        logger.debug(\"capabilities is null in {}\", thing.getUID());\n+                        return;\n+                    }\n+                    accountHandler.forceDelayedSmartHomeStateUpdate(findId()); // block updates\n+                    if (handlerBase.handleCommand(connection, shd, entityId, capabilities, channelUID.getId(),\n+                            command)) {\n+                        accountHandler.forceDelayedSmartHomeStateUpdate(findId()); // force update again to restart\n+                        // update timer\n+                        logger.debug(\"Command {} sent to {}\", command, shd.findId());\n+                    }\n+                }\n+            }\n+        } catch (Exception e) {\n+            logger.warn(\"Handle command failed\", e);\n+        }\n+    }\n+\n+    private static void getCapabilities(Map<String, List<SmartHomeCapability>> result, AccountHandler accountHandler,\n+            SmartHomeBaseDevice device) {\n+        if (device instanceof SmartHomeDevice) {\n+            SmartHomeDevice shd = (SmartHomeDevice) device;\n+            SmartHomeCapability capabilities[] = shd.capabilities;\n+            if (capabilities == null) {\n+                return;\n+            }\n+            for (SmartHomeCapability capability : capabilities) {\n+                String interfaceName = capability.interfaceName;\n+                if (interfaceName != null) {\n+                    result.computeIfAbsent(interfaceName, name -> new ArrayList<>()).add(capability);\n+                }\n+            }\n+        }\n+        if (device instanceof SmartHomeGroup) {\n+            for (SmartHomeDevice shd : getSupportedSmartHomeDevices(device,\n+                    accountHandler.getLastKnownSmartHomeDevice())) {\n+                getCapabilities(result, accountHandler, shd);\n+            }\n+        }\n+    }\n+\n+    public static Set<SmartHomeDevice> getSupportedSmartHomeDevices(@Nullable SmartHomeBaseDevice baseDevice,\n+            List<SmartHomeBaseDevice> allDevices) {\n+        Set<SmartHomeDevice> result = new HashSet<>();\n+        if (baseDevice == null) {\n+            return Collections.emptySet();\n+        }\n+        if (baseDevice instanceof SmartHomeDevice) {\n+            SmartHomeDevice shd = (SmartHomeDevice) baseDevice;\n+            SmartHomeCapability capabilities[] = shd.capabilities;\n+            if (capabilities == null) {\n+                return Collections.emptySet();\n+            }\n+            if (Arrays.stream(capabilities).map(capability -> capability.interfaceName)\n+                    .anyMatch(SUPPORTED_INTERFACES::contains)) {\n+                result.add(shd);\n+            }\n+        } else {\n+            SmartHomeGroup shg = (SmartHomeGroup) baseDevice;\n+            for (SmartHomeBaseDevice device : allDevices) {\n+                if (device instanceof SmartHomeDevice) {\n+                    SmartHomeDevice shd = (SmartHomeDevice) device;\n+                    if (shd.tags != null && shd.tags.tagNameToValueSetMap != null\n+                            && shd.tags.tagNameToValueSetMap.groupIdentity != null\n+                            && shg.applianceGroupIdentifier != null && shg.applianceGroupIdentifier.value != null\n+                            && Arrays.asList(shd.tags.tagNameToValueSetMap.groupIdentity)\n+                                    .contains(shg.applianceGroupIdentifier.value)) {\n+                        SmartHomeCapability capabilities[] = shd.capabilities;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b5420d0c2985a42b5f8f8f5594ad63354a87216"}, "originalPosition": 365}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDQ5Njc0OQ==", "bodyText": "This is highly inefficient, each iteration of the loop results in a fresh edit of the Thing and thus triggers a lot of events that could be avoided if you just called editThing once, removed all the unwanted channels from the builder, then called updateThing.", "url": "https://github.com/openhab/openhab-addons/pull/7969#discussion_r444496749", "createdAt": "2020-06-23T20:46:47Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.amazonechocontrol/src/main/java/org/openhab/binding/amazonechocontrol/internal/handler/SmartHomeDeviceHandler.java", "diffHunk": "@@ -0,0 +1,391 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.amazonechocontrol.internal.handler;\n+\n+import static org.openhab.binding.amazonechocontrol.internal.AmazonEchoControlBindingConstants.DEVICE_PROPERTY_ID;\n+import static org.openhab.binding.amazonechocontrol.internal.smarthome.Constants.SUPPORTED_INTERFACES;\n+\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Locale;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.function.Function;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.Channel;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.BridgeHandler;\n+import org.eclipse.smarthome.core.thing.binding.builder.ChannelBuilder;\n+import org.eclipse.smarthome.core.thing.type.ChannelTypeUID;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.eclipse.smarthome.core.types.State;\n+import org.eclipse.smarthome.core.types.StateDescription;\n+import org.openhab.binding.amazonechocontrol.internal.Connection;\n+import org.openhab.binding.amazonechocontrol.internal.jsons.JsonSmartHomeCapabilities.SmartHomeCapability;\n+import org.openhab.binding.amazonechocontrol.internal.jsons.JsonSmartHomeDevices.SmartHomeDevice;\n+import org.openhab.binding.amazonechocontrol.internal.jsons.JsonSmartHomeGroups.SmartHomeGroup;\n+import org.openhab.binding.amazonechocontrol.internal.jsons.SmartHomeBaseDevice;\n+import org.openhab.binding.amazonechocontrol.internal.smarthome.Constants;\n+import org.openhab.binding.amazonechocontrol.internal.smarthome.HandlerBase;\n+import org.openhab.binding.amazonechocontrol.internal.smarthome.HandlerBase.ChannelInfo;\n+import org.openhab.binding.amazonechocontrol.internal.smarthome.HandlerBase.UpdateChannelResult;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import com.google.gson.Gson;\n+import com.google.gson.JsonArray;\n+import com.google.gson.JsonElement;\n+import com.google.gson.JsonObject;\n+\n+/**\n+ * @author Lukas Knoeller - Initial contribution\n+ */\n+@NonNullByDefault\n+public class SmartHomeDeviceHandler extends BaseThingHandler {\n+    private final Logger logger = LoggerFactory.getLogger(SmartHomeDeviceHandler.class);\n+\n+    private @Nullable SmartHomeBaseDevice smartHomeBaseDevice;\n+    private final Gson gson;\n+    private final Map<String, @Nullable HandlerBase> handlers = new HashMap<>();\n+    private final Map<String, @Nullable JsonArray> lastStates = new HashMap<>();\n+\n+    public SmartHomeDeviceHandler(Thing thing, Gson gson) {\n+        super(thing);\n+        this.gson = gson;\n+    }\n+\n+    public synchronized void setDeviceAndUpdateThingState(AccountHandler accountHandler,\n+            @Nullable SmartHomeBaseDevice smartHomeBaseDevice) {\n+        if (smartHomeBaseDevice == null) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.NONE, \"Can't find smarthomeBaseDevice\");\n+            return;\n+        }\n+        boolean changed = this.smartHomeBaseDevice == null;\n+        this.smartHomeBaseDevice = smartHomeBaseDevice;\n+\n+        Set<String> unusedChannels = new HashSet<>();\n+        thing.getChannels().forEach(channel -> unusedChannels.add(channel.getUID().getId()));\n+\n+        Set<String> unusedHandlers = new HashSet<>(handlers.keySet());\n+\n+        Map<String, List<SmartHomeCapability>> capabilities = new HashMap<>();\n+        getCapabilities(capabilities, accountHandler, smartHomeBaseDevice);\n+\n+        for (String interfaceName : capabilities.keySet()) {\n+            HandlerBase handler = handlers.get(interfaceName);\n+            if (handler != null) {\n+                unusedHandlers.remove(interfaceName);\n+            } else {\n+                Function<String, HandlerBase> creator = Constants.HANDLER_FACTORY.get(interfaceName);\n+                if (creator != null) {\n+                    handler = creator.apply(interfaceName);\n+                    handlers.put(interfaceName, handler);\n+                }\n+            }\n+            if (handler != null) {\n+                Collection<ChannelInfo> required = handler.initialize(this, capabilities.get(interfaceName));\n+                for (ChannelInfo channelInfo : required) {\n+                    unusedChannels.remove(channelInfo.channelId);\n+                    if (addChannelToDevice(channelInfo.channelId, channelInfo.itemType, channelInfo.channelTypeUID)) {\n+                        changed = true;\n+                    }\n+                }\n+            }\n+        }\n+\n+        unusedHandlers.forEach(handlers::remove);\n+        if (!unusedChannels.isEmpty()) {\n+            changed = true;\n+            unusedChannels.forEach(this::removeChannelFromDevice);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b5420d0c2985a42b5f8f8f5594ad63354a87216"}, "originalPosition": 122}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDQ5NzQ1OQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        SmartHomeCapability capabilities[] = shd.capabilities;\n          \n          \n            \n                        SmartHomeCapability[] capabilities = shd.capabilities;", "url": "https://github.com/openhab/openhab-addons/pull/7969#discussion_r444497459", "createdAt": "2020-06-23T20:48:05Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.amazonechocontrol/src/main/java/org/openhab/binding/amazonechocontrol/internal/handler/SmartHomeDeviceHandler.java", "diffHunk": "@@ -0,0 +1,391 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.amazonechocontrol.internal.handler;\n+\n+import static org.openhab.binding.amazonechocontrol.internal.AmazonEchoControlBindingConstants.DEVICE_PROPERTY_ID;\n+import static org.openhab.binding.amazonechocontrol.internal.smarthome.Constants.SUPPORTED_INTERFACES;\n+\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Locale;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.function.Function;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.Channel;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.BridgeHandler;\n+import org.eclipse.smarthome.core.thing.binding.builder.ChannelBuilder;\n+import org.eclipse.smarthome.core.thing.type.ChannelTypeUID;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.eclipse.smarthome.core.types.State;\n+import org.eclipse.smarthome.core.types.StateDescription;\n+import org.openhab.binding.amazonechocontrol.internal.Connection;\n+import org.openhab.binding.amazonechocontrol.internal.jsons.JsonSmartHomeCapabilities.SmartHomeCapability;\n+import org.openhab.binding.amazonechocontrol.internal.jsons.JsonSmartHomeDevices.SmartHomeDevice;\n+import org.openhab.binding.amazonechocontrol.internal.jsons.JsonSmartHomeGroups.SmartHomeGroup;\n+import org.openhab.binding.amazonechocontrol.internal.jsons.SmartHomeBaseDevice;\n+import org.openhab.binding.amazonechocontrol.internal.smarthome.Constants;\n+import org.openhab.binding.amazonechocontrol.internal.smarthome.HandlerBase;\n+import org.openhab.binding.amazonechocontrol.internal.smarthome.HandlerBase.ChannelInfo;\n+import org.openhab.binding.amazonechocontrol.internal.smarthome.HandlerBase.UpdateChannelResult;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import com.google.gson.Gson;\n+import com.google.gson.JsonArray;\n+import com.google.gson.JsonElement;\n+import com.google.gson.JsonObject;\n+\n+/**\n+ * @author Lukas Knoeller - Initial contribution\n+ */\n+@NonNullByDefault\n+public class SmartHomeDeviceHandler extends BaseThingHandler {\n+    private final Logger logger = LoggerFactory.getLogger(SmartHomeDeviceHandler.class);\n+\n+    private @Nullable SmartHomeBaseDevice smartHomeBaseDevice;\n+    private final Gson gson;\n+    private final Map<String, @Nullable HandlerBase> handlers = new HashMap<>();\n+    private final Map<String, @Nullable JsonArray> lastStates = new HashMap<>();\n+\n+    public SmartHomeDeviceHandler(Thing thing, Gson gson) {\n+        super(thing);\n+        this.gson = gson;\n+    }\n+\n+    public synchronized void setDeviceAndUpdateThingState(AccountHandler accountHandler,\n+            @Nullable SmartHomeBaseDevice smartHomeBaseDevice) {\n+        if (smartHomeBaseDevice == null) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.NONE, \"Can't find smarthomeBaseDevice\");\n+            return;\n+        }\n+        boolean changed = this.smartHomeBaseDevice == null;\n+        this.smartHomeBaseDevice = smartHomeBaseDevice;\n+\n+        Set<String> unusedChannels = new HashSet<>();\n+        thing.getChannels().forEach(channel -> unusedChannels.add(channel.getUID().getId()));\n+\n+        Set<String> unusedHandlers = new HashSet<>(handlers.keySet());\n+\n+        Map<String, List<SmartHomeCapability>> capabilities = new HashMap<>();\n+        getCapabilities(capabilities, accountHandler, smartHomeBaseDevice);\n+\n+        for (String interfaceName : capabilities.keySet()) {\n+            HandlerBase handler = handlers.get(interfaceName);\n+            if (handler != null) {\n+                unusedHandlers.remove(interfaceName);\n+            } else {\n+                Function<String, HandlerBase> creator = Constants.HANDLER_FACTORY.get(interfaceName);\n+                if (creator != null) {\n+                    handler = creator.apply(interfaceName);\n+                    handlers.put(interfaceName, handler);\n+                }\n+            }\n+            if (handler != null) {\n+                Collection<ChannelInfo> required = handler.initialize(this, capabilities.get(interfaceName));\n+                for (ChannelInfo channelInfo : required) {\n+                    unusedChannels.remove(channelInfo.channelId);\n+                    if (addChannelToDevice(channelInfo.channelId, channelInfo.itemType, channelInfo.channelTypeUID)) {\n+                        changed = true;\n+                    }\n+                }\n+            }\n+        }\n+\n+        unusedHandlers.forEach(handlers::remove);\n+        if (!unusedChannels.isEmpty()) {\n+            changed = true;\n+            unusedChannels.forEach(this::removeChannelFromDevice);\n+        }\n+\n+        if (changed) {\n+            updateStatus(ThingStatus.UNKNOWN, ThingStatusDetail.NONE, \"Thing has changed.\");\n+            accountHandler.forceDelayedSmartHomeStateUpdate(findId());\n+        }\n+    }\n+\n+    public String findId() {\n+        String id = (String) getConfig().get(DEVICE_PROPERTY_ID);\n+        if (id == null) {\n+            return \"\";\n+        }\n+        return id;\n+    }\n+\n+    @Override\n+    public void updateState(String channelId, State state) {\n+        super.updateState(new ChannelUID(thing.getUID(), channelId), state);\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        logger.info(\"initializing {}\", thing.getUID());\n+        AccountHandler accountHandler = getAccountHandler();\n+        if (accountHandler != null) {\n+            accountHandler.addSmartHomeDeviceHandler(this);\n+            setDeviceAndUpdateThingState(accountHandler, smartHomeBaseDevice);\n+        } else {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, \"Bridgehandler not found\");\n+        }\n+    }\n+\n+    private boolean addChannelToDevice(String channelId, String itemType, ChannelTypeUID channelTypeUID) {\n+        Channel channel = thing.getChannel(channelId);\n+        if (channel != null) {\n+            if (channelTypeUID.equals(channel.getChannelTypeUID()) && itemType.equals(channel.getAcceptedItemType())) {\n+                // channel exist with the same settings\n+                return false;\n+            }\n+            // channel exist with other settings, remove it first\n+            removeChannelFromDevice(channelId);\n+        }\n+        updateThing(\n+                editThing().withChannel(ChannelBuilder.create(new ChannelUID(getThing().getUID(), channelId), itemType)\n+                        .withType(channelTypeUID).build()).build());\n+        return true;\n+    }\n+\n+    private void removeChannelFromDevice(String channelId) {\n+        updateThing(editThing().withoutChannel(new ChannelUID(getThing().getUID(), channelId)).build());\n+    }\n+\n+    public void updateChannelStates(List<SmartHomeBaseDevice> allDevices,\n+            Map<String, JsonArray> applianceIdToCapabilityStates) {\n+        AccountHandler accountHandler = getAccountHandler();\n+        SmartHomeBaseDevice smartHomeBaseDevice = this.smartHomeBaseDevice;\n+        if (smartHomeBaseDevice == null) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.NONE, \"Can't find smarthomeBaseDevice!\");\n+            return;\n+        }\n+\n+        boolean stateFound = false;\n+        Map<String, List<JsonObject>> mapInterfaceToStates = new HashMap<>();\n+        SmartHomeDevice firstDevice = null;\n+        for (SmartHomeDevice shd : getSupportedSmartHomeDevices(smartHomeBaseDevice, allDevices)) {\n+            JsonArray states = applianceIdToCapabilityStates.get(shd.applianceId);\n+            String applianceId = shd.applianceId;\n+            if (applianceId == null) {\n+                continue;\n+            }\n+            if (states != null) {\n+                stateFound = true;\n+                if (smartHomeBaseDevice.isGroup()) {\n+                    // for groups, store the last state of all devices\n+                    lastStates.put(applianceId, states);\n+                }\n+            } else {\n+                states = lastStates.get(applianceId);\n+                if (states == null) {\n+                    continue;\n+                }\n+            }\n+            if (firstDevice == null) {\n+                firstDevice = shd;\n+            }\n+            for (JsonElement stateElement : states) {\n+                String stateJson = stateElement.getAsString();\n+                if (stateJson.startsWith(\"{\") && stateJson.endsWith(\"}\")) {\n+                    JsonObject state = gson.fromJson(stateJson, JsonObject.class);\n+                    String interfaceName = state.get(\"namespace\").getAsString();\n+                    mapInterfaceToStates.computeIfAbsent(interfaceName, k -> new ArrayList<>()).add(state);\n+                }\n+            }\n+        }\n+        for (HandlerBase handlerBase : handlers.values()) {\n+            if (handlerBase == null) {\n+                continue;\n+            }\n+            UpdateChannelResult result = new UpdateChannelResult();\n+\n+            for (String interfaceName : handlerBase.getSupportedInterface()) {\n+                List<JsonObject> stateList = mapInterfaceToStates.getOrDefault(interfaceName, Collections.emptyList());\n+                try {\n+                    handlerBase.updateChannels(interfaceName, stateList, result);\n+                } catch (Exception e) {\n+                    // We catch all exceptions, otherwise all other things are not updated!\n+                    logger.debug(\"Updating states failed\", e);\n+                    updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR, e.getLocalizedMessage());\n+                }\n+            }\n+\n+            if (result.needSingleUpdate && smartHomeBaseDevice instanceof SmartHomeDevice && accountHandler != null) {\n+                SmartHomeDevice shd = (SmartHomeDevice) smartHomeBaseDevice;\n+                accountHandler.forceDelayedSmartHomeStateUpdate(shd.findId());\n+            }\n+        }\n+\n+        if (stateFound) {\n+            updateStatus(ThingStatus.ONLINE);\n+        } else {\n+            updateStatus(ThingStatus.UNKNOWN, ThingStatusDetail.NONE, \"State not found\");\n+        }\n+    }\n+\n+    private @Nullable AccountHandler getAccountHandler() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            BridgeHandler bridgeHandler = bridge.getHandler();\n+            if (bridgeHandler instanceof AccountHandler) {\n+                return (AccountHandler) bridgeHandler;\n+            }\n+        }\n+\n+        return null;\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        AccountHandler accountHandler = getAccountHandler();\n+        if (accountHandler == null) {\n+            logger.debug(\"accountHandler is null in {}\", thing.getUID());\n+            return;\n+        }\n+        Connection connection = accountHandler.findConnection();\n+        if (connection == null) {\n+            logger.debug(\"connection is null in {}\", thing.getUID());\n+            return;\n+        }\n+\n+        try {\n+            if (command instanceof RefreshType) {\n+                accountHandler.forceDelayedSmartHomeStateUpdate(findId());\n+                return;\n+            }\n+            SmartHomeBaseDevice smartHomeBaseDevice = this.smartHomeBaseDevice;\n+            if (smartHomeBaseDevice == null) {\n+                logger.debug(\"smarthomeBaseDevice is null in {}\", thing.getUID());\n+                return;\n+            }\n+            Set<SmartHomeDevice> devices = getSupportedSmartHomeDevices(smartHomeBaseDevice,\n+                    accountHandler.getLastKnownSmartHomeDevice());\n+            String channelId = channelUID.getId();\n+\n+            for (String interfaceName : handlers.keySet()) {\n+                HandlerBase handlerBase = handlers.get(interfaceName);\n+                if (handlerBase == null || !handlerBase.hasChannel(channelId)) {\n+                    continue;\n+                }\n+                for (SmartHomeDevice shd : devices) {\n+                    String entityId = shd.entityId;\n+                    if (entityId == null) {\n+                        continue;\n+                    }\n+                    SmartHomeCapability[] capabilities = shd.capabilities;\n+                    if (capabilities == null) {\n+                        logger.debug(\"capabilities is null in {}\", thing.getUID());\n+                        return;\n+                    }\n+                    accountHandler.forceDelayedSmartHomeStateUpdate(findId()); // block updates\n+                    if (handlerBase.handleCommand(connection, shd, entityId, capabilities, channelUID.getId(),\n+                            command)) {\n+                        accountHandler.forceDelayedSmartHomeStateUpdate(findId()); // force update again to restart\n+                        // update timer\n+                        logger.debug(\"Command {} sent to {}\", command, shd.findId());\n+                    }\n+                }\n+            }\n+        } catch (Exception e) {\n+            logger.warn(\"Handle command failed\", e);\n+        }\n+    }\n+\n+    private static void getCapabilities(Map<String, List<SmartHomeCapability>> result, AccountHandler accountHandler,\n+            SmartHomeBaseDevice device) {\n+        if (device instanceof SmartHomeDevice) {\n+            SmartHomeDevice shd = (SmartHomeDevice) device;\n+            SmartHomeCapability capabilities[] = shd.capabilities;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b5420d0c2985a42b5f8f8f5594ad63354a87216"}, "originalPosition": 320}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDQ5ODYwOA==", "bodyText": "Same issue as I mentioned earlier.", "url": "https://github.com/openhab/openhab-addons/pull/7969#discussion_r444498608", "createdAt": "2020-06-23T20:50:15Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.amazonechocontrol/src/main/java/org/openhab/binding/amazonechocontrol/internal/handler/SmartHomeDeviceHandler.java", "diffHunk": "@@ -0,0 +1,391 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.amazonechocontrol.internal.handler;\n+\n+import static org.openhab.binding.amazonechocontrol.internal.AmazonEchoControlBindingConstants.DEVICE_PROPERTY_ID;\n+import static org.openhab.binding.amazonechocontrol.internal.smarthome.Constants.SUPPORTED_INTERFACES;\n+\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Locale;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.function.Function;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.Channel;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.BridgeHandler;\n+import org.eclipse.smarthome.core.thing.binding.builder.ChannelBuilder;\n+import org.eclipse.smarthome.core.thing.type.ChannelTypeUID;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.eclipse.smarthome.core.types.State;\n+import org.eclipse.smarthome.core.types.StateDescription;\n+import org.openhab.binding.amazonechocontrol.internal.Connection;\n+import org.openhab.binding.amazonechocontrol.internal.jsons.JsonSmartHomeCapabilities.SmartHomeCapability;\n+import org.openhab.binding.amazonechocontrol.internal.jsons.JsonSmartHomeDevices.SmartHomeDevice;\n+import org.openhab.binding.amazonechocontrol.internal.jsons.JsonSmartHomeGroups.SmartHomeGroup;\n+import org.openhab.binding.amazonechocontrol.internal.jsons.SmartHomeBaseDevice;\n+import org.openhab.binding.amazonechocontrol.internal.smarthome.Constants;\n+import org.openhab.binding.amazonechocontrol.internal.smarthome.HandlerBase;\n+import org.openhab.binding.amazonechocontrol.internal.smarthome.HandlerBase.ChannelInfo;\n+import org.openhab.binding.amazonechocontrol.internal.smarthome.HandlerBase.UpdateChannelResult;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import com.google.gson.Gson;\n+import com.google.gson.JsonArray;\n+import com.google.gson.JsonElement;\n+import com.google.gson.JsonObject;\n+\n+/**\n+ * @author Lukas Knoeller - Initial contribution\n+ */\n+@NonNullByDefault\n+public class SmartHomeDeviceHandler extends BaseThingHandler {\n+    private final Logger logger = LoggerFactory.getLogger(SmartHomeDeviceHandler.class);\n+\n+    private @Nullable SmartHomeBaseDevice smartHomeBaseDevice;\n+    private final Gson gson;\n+    private final Map<String, @Nullable HandlerBase> handlers = new HashMap<>();\n+    private final Map<String, @Nullable JsonArray> lastStates = new HashMap<>();\n+\n+    public SmartHomeDeviceHandler(Thing thing, Gson gson) {\n+        super(thing);\n+        this.gson = gson;\n+    }\n+\n+    public synchronized void setDeviceAndUpdateThingState(AccountHandler accountHandler,\n+            @Nullable SmartHomeBaseDevice smartHomeBaseDevice) {\n+        if (smartHomeBaseDevice == null) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.NONE, \"Can't find smarthomeBaseDevice\");\n+            return;\n+        }\n+        boolean changed = this.smartHomeBaseDevice == null;\n+        this.smartHomeBaseDevice = smartHomeBaseDevice;\n+\n+        Set<String> unusedChannels = new HashSet<>();\n+        thing.getChannels().forEach(channel -> unusedChannels.add(channel.getUID().getId()));\n+\n+        Set<String> unusedHandlers = new HashSet<>(handlers.keySet());\n+\n+        Map<String, List<SmartHomeCapability>> capabilities = new HashMap<>();\n+        getCapabilities(capabilities, accountHandler, smartHomeBaseDevice);\n+\n+        for (String interfaceName : capabilities.keySet()) {\n+            HandlerBase handler = handlers.get(interfaceName);\n+            if (handler != null) {\n+                unusedHandlers.remove(interfaceName);\n+            } else {\n+                Function<String, HandlerBase> creator = Constants.HANDLER_FACTORY.get(interfaceName);\n+                if (creator != null) {\n+                    handler = creator.apply(interfaceName);\n+                    handlers.put(interfaceName, handler);\n+                }\n+            }\n+            if (handler != null) {\n+                Collection<ChannelInfo> required = handler.initialize(this, capabilities.get(interfaceName));\n+                for (ChannelInfo channelInfo : required) {\n+                    unusedChannels.remove(channelInfo.channelId);\n+                    if (addChannelToDevice(channelInfo.channelId, channelInfo.itemType, channelInfo.channelTypeUID)) {\n+                        changed = true;\n+                    }\n+                }\n+            }\n+        }\n+\n+        unusedHandlers.forEach(handlers::remove);\n+        if (!unusedChannels.isEmpty()) {\n+            changed = true;\n+            unusedChannels.forEach(this::removeChannelFromDevice);\n+        }\n+\n+        if (changed) {\n+            updateStatus(ThingStatus.UNKNOWN, ThingStatusDetail.NONE, \"Thing has changed.\");\n+            accountHandler.forceDelayedSmartHomeStateUpdate(findId());\n+        }\n+    }\n+\n+    public String findId() {\n+        String id = (String) getConfig().get(DEVICE_PROPERTY_ID);\n+        if (id == null) {\n+            return \"\";\n+        }\n+        return id;\n+    }\n+\n+    @Override\n+    public void updateState(String channelId, State state) {\n+        super.updateState(new ChannelUID(thing.getUID(), channelId), state);\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        logger.info(\"initializing {}\", thing.getUID());\n+        AccountHandler accountHandler = getAccountHandler();\n+        if (accountHandler != null) {\n+            accountHandler.addSmartHomeDeviceHandler(this);\n+            setDeviceAndUpdateThingState(accountHandler, smartHomeBaseDevice);\n+        } else {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, \"Bridgehandler not found\");\n+        }\n+    }\n+\n+    private boolean addChannelToDevice(String channelId, String itemType, ChannelTypeUID channelTypeUID) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1b5420d0c2985a42b5f8f8f5594ad63354a87216"}, "originalPosition": 156}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM2OTQzNTA1", "url": "https://github.com/openhab/openhab-addons/pull/7969#pullrequestreview-436943505", "createdAt": "2020-06-24T19:29:07Z", "commit": {"oid": "9596b49de93355da60e75d6284c239b5192e958f"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQxOToyOTowN1rOGogFgQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNFQyMDoyMjozNFrOGohw8Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTEyMTkyMQ==", "bodyText": "This log can be removed", "url": "https://github.com/openhab/openhab-addons/pull/7969#discussion_r445121921", "createdAt": "2020-06-24T19:29:07Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.amazonechocontrol/src/main/java/org/openhab/binding/amazonechocontrol/internal/handler/SmartHomeDeviceHandler.java", "diffHunk": "@@ -0,0 +1,392 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.amazonechocontrol.internal.handler;\n+\n+import static org.openhab.binding.amazonechocontrol.internal.AmazonEchoControlBindingConstants.DEVICE_PROPERTY_ID;\n+import static org.openhab.binding.amazonechocontrol.internal.smarthome.Constants.SUPPORTED_INTERFACES;\n+\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Locale;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.function.Supplier;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.Channel;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.BridgeHandler;\n+import org.eclipse.smarthome.core.thing.binding.builder.ChannelBuilder;\n+import org.eclipse.smarthome.core.thing.binding.builder.ThingBuilder;\n+import org.eclipse.smarthome.core.thing.type.ChannelTypeUID;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.eclipse.smarthome.core.types.State;\n+import org.eclipse.smarthome.core.types.StateDescription;\n+import org.openhab.binding.amazonechocontrol.internal.Connection;\n+import org.openhab.binding.amazonechocontrol.internal.jsons.JsonSmartHomeCapabilities.SmartHomeCapability;\n+import org.openhab.binding.amazonechocontrol.internal.jsons.JsonSmartHomeDevices.SmartHomeDevice;\n+import org.openhab.binding.amazonechocontrol.internal.jsons.JsonSmartHomeGroups.SmartHomeGroup;\n+import org.openhab.binding.amazonechocontrol.internal.jsons.SmartHomeBaseDevice;\n+import org.openhab.binding.amazonechocontrol.internal.smarthome.Constants;\n+import org.openhab.binding.amazonechocontrol.internal.smarthome.HandlerBase;\n+import org.openhab.binding.amazonechocontrol.internal.smarthome.HandlerBase.ChannelInfo;\n+import org.openhab.binding.amazonechocontrol.internal.smarthome.HandlerBase.UpdateChannelResult;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import com.google.gson.Gson;\n+import com.google.gson.JsonArray;\n+import com.google.gson.JsonElement;\n+import com.google.gson.JsonObject;\n+\n+/**\n+ * @author Lukas Knoeller - Initial contribution\n+ */\n+@NonNullByDefault\n+public class SmartHomeDeviceHandler extends BaseThingHandler {\n+    private final Logger logger = LoggerFactory.getLogger(SmartHomeDeviceHandler.class);\n+\n+    private @Nullable SmartHomeBaseDevice smartHomeBaseDevice;\n+    private final Gson gson;\n+    private final Map<String, @Nullable HandlerBase> handlers = new HashMap<>();\n+    private final Map<String, @Nullable JsonArray> lastStates = new HashMap<>();\n+\n+    public SmartHomeDeviceHandler(Thing thing, Gson gson) {\n+        super(thing);\n+        this.gson = gson;\n+    }\n+\n+    public synchronized void setDeviceAndUpdateThingState(AccountHandler accountHandler,\n+            @Nullable SmartHomeBaseDevice smartHomeBaseDevice) {\n+        if (smartHomeBaseDevice == null) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.NONE, \"Can't find smarthomeBaseDevice\");\n+            return;\n+        }\n+        boolean changed = this.smartHomeBaseDevice == null;\n+        this.smartHomeBaseDevice = smartHomeBaseDevice;\n+\n+        Set<String> unusedChannels = new HashSet<>();\n+        thing.getChannels().forEach(channel -> unusedChannels.add(channel.getUID().getId()));\n+\n+        Set<String> unusedHandlers = new HashSet<>(handlers.keySet());\n+\n+        Map<String, List<SmartHomeCapability>> capabilities = new HashMap<>();\n+        getCapabilities(capabilities, accountHandler, smartHomeBaseDevice);\n+\n+        ThingBuilder thingBuilder = editThing();\n+\n+        for (String interfaceName : capabilities.keySet()) {\n+            HandlerBase handler = handlers.get(interfaceName);\n+            if (handler != null) {\n+                unusedHandlers.remove(interfaceName);\n+            } else {\n+                Supplier<HandlerBase> creator = Constants.HANDLER_FACTORY.get(interfaceName);\n+                if (creator != null) {\n+                    handler = creator.get();\n+                    handlers.put(interfaceName, handler);\n+                }\n+            }\n+            if (handler != null) {\n+                Collection<ChannelInfo> required = handler.initialize(this, capabilities.get(interfaceName));\n+                for (ChannelInfo channelInfo : required) {\n+                    unusedChannels.remove(channelInfo.channelId);\n+                    if (addChannelToDevice(thingBuilder, channelInfo.channelId, channelInfo.itemType,\n+                            channelInfo.channelTypeUID)) {\n+                        changed = true;\n+                    }\n+                }\n+            }\n+        }\n+\n+        unusedHandlers.forEach(handlers::remove);\n+        if (!unusedChannels.isEmpty()) {\n+            changed = true;\n+            unusedChannels.stream().map(id -> new ChannelUID(thing.getUID(), id)).forEach(thingBuilder::withoutChannel);\n+        }\n+\n+        if (changed) {\n+            updateThing(thingBuilder.build());\n+            updateStatus(ThingStatus.UNKNOWN, ThingStatusDetail.NONE, \"Thing has changed.\");\n+            accountHandler.forceDelayedSmartHomeStateUpdate(findId());\n+        }\n+    }\n+\n+    public String findId() {\n+        String id = (String) getConfig().get(DEVICE_PROPERTY_ID);\n+        if (id == null) {\n+            return \"\";\n+        }\n+        return id;\n+    }\n+\n+    @Override\n+    public void updateState(String channelId, State state) {\n+        super.updateState(new ChannelUID(thing.getUID(), channelId), state);\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        logger.info(\"initializing {}\", thing.getUID());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9596b49de93355da60e75d6284c239b5192e958f"}, "originalPosition": 151}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTEyMjMwNA==", "bodyText": "Is there a reason this was overriden?", "url": "https://github.com/openhab/openhab-addons/pull/7969#discussion_r445122304", "createdAt": "2020-06-24T19:29:55Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.amazonechocontrol/src/main/java/org/openhab/binding/amazonechocontrol/internal/handler/SmartHomeDeviceHandler.java", "diffHunk": "@@ -0,0 +1,392 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.amazonechocontrol.internal.handler;\n+\n+import static org.openhab.binding.amazonechocontrol.internal.AmazonEchoControlBindingConstants.DEVICE_PROPERTY_ID;\n+import static org.openhab.binding.amazonechocontrol.internal.smarthome.Constants.SUPPORTED_INTERFACES;\n+\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Locale;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.function.Supplier;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.Channel;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.BridgeHandler;\n+import org.eclipse.smarthome.core.thing.binding.builder.ChannelBuilder;\n+import org.eclipse.smarthome.core.thing.binding.builder.ThingBuilder;\n+import org.eclipse.smarthome.core.thing.type.ChannelTypeUID;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.eclipse.smarthome.core.types.State;\n+import org.eclipse.smarthome.core.types.StateDescription;\n+import org.openhab.binding.amazonechocontrol.internal.Connection;\n+import org.openhab.binding.amazonechocontrol.internal.jsons.JsonSmartHomeCapabilities.SmartHomeCapability;\n+import org.openhab.binding.amazonechocontrol.internal.jsons.JsonSmartHomeDevices.SmartHomeDevice;\n+import org.openhab.binding.amazonechocontrol.internal.jsons.JsonSmartHomeGroups.SmartHomeGroup;\n+import org.openhab.binding.amazonechocontrol.internal.jsons.SmartHomeBaseDevice;\n+import org.openhab.binding.amazonechocontrol.internal.smarthome.Constants;\n+import org.openhab.binding.amazonechocontrol.internal.smarthome.HandlerBase;\n+import org.openhab.binding.amazonechocontrol.internal.smarthome.HandlerBase.ChannelInfo;\n+import org.openhab.binding.amazonechocontrol.internal.smarthome.HandlerBase.UpdateChannelResult;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import com.google.gson.Gson;\n+import com.google.gson.JsonArray;\n+import com.google.gson.JsonElement;\n+import com.google.gson.JsonObject;\n+\n+/**\n+ * @author Lukas Knoeller - Initial contribution\n+ */\n+@NonNullByDefault\n+public class SmartHomeDeviceHandler extends BaseThingHandler {\n+    private final Logger logger = LoggerFactory.getLogger(SmartHomeDeviceHandler.class);\n+\n+    private @Nullable SmartHomeBaseDevice smartHomeBaseDevice;\n+    private final Gson gson;\n+    private final Map<String, @Nullable HandlerBase> handlers = new HashMap<>();\n+    private final Map<String, @Nullable JsonArray> lastStates = new HashMap<>();\n+\n+    public SmartHomeDeviceHandler(Thing thing, Gson gson) {\n+        super(thing);\n+        this.gson = gson;\n+    }\n+\n+    public synchronized void setDeviceAndUpdateThingState(AccountHandler accountHandler,\n+            @Nullable SmartHomeBaseDevice smartHomeBaseDevice) {\n+        if (smartHomeBaseDevice == null) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.NONE, \"Can't find smarthomeBaseDevice\");\n+            return;\n+        }\n+        boolean changed = this.smartHomeBaseDevice == null;\n+        this.smartHomeBaseDevice = smartHomeBaseDevice;\n+\n+        Set<String> unusedChannels = new HashSet<>();\n+        thing.getChannels().forEach(channel -> unusedChannels.add(channel.getUID().getId()));\n+\n+        Set<String> unusedHandlers = new HashSet<>(handlers.keySet());\n+\n+        Map<String, List<SmartHomeCapability>> capabilities = new HashMap<>();\n+        getCapabilities(capabilities, accountHandler, smartHomeBaseDevice);\n+\n+        ThingBuilder thingBuilder = editThing();\n+\n+        for (String interfaceName : capabilities.keySet()) {\n+            HandlerBase handler = handlers.get(interfaceName);\n+            if (handler != null) {\n+                unusedHandlers.remove(interfaceName);\n+            } else {\n+                Supplier<HandlerBase> creator = Constants.HANDLER_FACTORY.get(interfaceName);\n+                if (creator != null) {\n+                    handler = creator.get();\n+                    handlers.put(interfaceName, handler);\n+                }\n+            }\n+            if (handler != null) {\n+                Collection<ChannelInfo> required = handler.initialize(this, capabilities.get(interfaceName));\n+                for (ChannelInfo channelInfo : required) {\n+                    unusedChannels.remove(channelInfo.channelId);\n+                    if (addChannelToDevice(thingBuilder, channelInfo.channelId, channelInfo.itemType,\n+                            channelInfo.channelTypeUID)) {\n+                        changed = true;\n+                    }\n+                }\n+            }\n+        }\n+\n+        unusedHandlers.forEach(handlers::remove);\n+        if (!unusedChannels.isEmpty()) {\n+            changed = true;\n+            unusedChannels.stream().map(id -> new ChannelUID(thing.getUID(), id)).forEach(thingBuilder::withoutChannel);\n+        }\n+\n+        if (changed) {\n+            updateThing(thingBuilder.build());\n+            updateStatus(ThingStatus.UNKNOWN, ThingStatusDetail.NONE, \"Thing has changed.\");\n+            accountHandler.forceDelayedSmartHomeStateUpdate(findId());\n+        }\n+    }\n+\n+    public String findId() {\n+        String id = (String) getConfig().get(DEVICE_PROPERTY_ID);\n+        if (id == null) {\n+            return \"\";\n+        }\n+        return id;\n+    }\n+\n+    @Override\n+    public void updateState(String channelId, State state) {\n+        super.updateState(new ChannelUID(thing.getUID(), channelId), state);\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9596b49de93355da60e75d6284c239b5192e958f"}, "originalPosition": 147}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTEyNTAwOA==", "bodyText": "So if a single device has null capabilities you have to return an empty collection? I'm not sure this is correct and should instead just continue;\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                        return Collections.emptySet();\n          \n          \n            \n                                        continue;", "url": "https://github.com/openhab/openhab-addons/pull/7969#discussion_r445125008", "createdAt": "2020-06-24T19:35:13Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.amazonechocontrol/src/main/java/org/openhab/binding/amazonechocontrol/internal/handler/SmartHomeDeviceHandler.java", "diffHunk": "@@ -0,0 +1,392 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.amazonechocontrol.internal.handler;\n+\n+import static org.openhab.binding.amazonechocontrol.internal.AmazonEchoControlBindingConstants.DEVICE_PROPERTY_ID;\n+import static org.openhab.binding.amazonechocontrol.internal.smarthome.Constants.SUPPORTED_INTERFACES;\n+\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Locale;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.function.Supplier;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.Channel;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.BridgeHandler;\n+import org.eclipse.smarthome.core.thing.binding.builder.ChannelBuilder;\n+import org.eclipse.smarthome.core.thing.binding.builder.ThingBuilder;\n+import org.eclipse.smarthome.core.thing.type.ChannelTypeUID;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.eclipse.smarthome.core.types.State;\n+import org.eclipse.smarthome.core.types.StateDescription;\n+import org.openhab.binding.amazonechocontrol.internal.Connection;\n+import org.openhab.binding.amazonechocontrol.internal.jsons.JsonSmartHomeCapabilities.SmartHomeCapability;\n+import org.openhab.binding.amazonechocontrol.internal.jsons.JsonSmartHomeDevices.SmartHomeDevice;\n+import org.openhab.binding.amazonechocontrol.internal.jsons.JsonSmartHomeGroups.SmartHomeGroup;\n+import org.openhab.binding.amazonechocontrol.internal.jsons.SmartHomeBaseDevice;\n+import org.openhab.binding.amazonechocontrol.internal.smarthome.Constants;\n+import org.openhab.binding.amazonechocontrol.internal.smarthome.HandlerBase;\n+import org.openhab.binding.amazonechocontrol.internal.smarthome.HandlerBase.ChannelInfo;\n+import org.openhab.binding.amazonechocontrol.internal.smarthome.HandlerBase.UpdateChannelResult;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import com.google.gson.Gson;\n+import com.google.gson.JsonArray;\n+import com.google.gson.JsonElement;\n+import com.google.gson.JsonObject;\n+\n+/**\n+ * @author Lukas Knoeller - Initial contribution\n+ */\n+@NonNullByDefault\n+public class SmartHomeDeviceHandler extends BaseThingHandler {\n+    private final Logger logger = LoggerFactory.getLogger(SmartHomeDeviceHandler.class);\n+\n+    private @Nullable SmartHomeBaseDevice smartHomeBaseDevice;\n+    private final Gson gson;\n+    private final Map<String, @Nullable HandlerBase> handlers = new HashMap<>();\n+    private final Map<String, @Nullable JsonArray> lastStates = new HashMap<>();\n+\n+    public SmartHomeDeviceHandler(Thing thing, Gson gson) {\n+        super(thing);\n+        this.gson = gson;\n+    }\n+\n+    public synchronized void setDeviceAndUpdateThingState(AccountHandler accountHandler,\n+            @Nullable SmartHomeBaseDevice smartHomeBaseDevice) {\n+        if (smartHomeBaseDevice == null) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.NONE, \"Can't find smarthomeBaseDevice\");\n+            return;\n+        }\n+        boolean changed = this.smartHomeBaseDevice == null;\n+        this.smartHomeBaseDevice = smartHomeBaseDevice;\n+\n+        Set<String> unusedChannels = new HashSet<>();\n+        thing.getChannels().forEach(channel -> unusedChannels.add(channel.getUID().getId()));\n+\n+        Set<String> unusedHandlers = new HashSet<>(handlers.keySet());\n+\n+        Map<String, List<SmartHomeCapability>> capabilities = new HashMap<>();\n+        getCapabilities(capabilities, accountHandler, smartHomeBaseDevice);\n+\n+        ThingBuilder thingBuilder = editThing();\n+\n+        for (String interfaceName : capabilities.keySet()) {\n+            HandlerBase handler = handlers.get(interfaceName);\n+            if (handler != null) {\n+                unusedHandlers.remove(interfaceName);\n+            } else {\n+                Supplier<HandlerBase> creator = Constants.HANDLER_FACTORY.get(interfaceName);\n+                if (creator != null) {\n+                    handler = creator.get();\n+                    handlers.put(interfaceName, handler);\n+                }\n+            }\n+            if (handler != null) {\n+                Collection<ChannelInfo> required = handler.initialize(this, capabilities.get(interfaceName));\n+                for (ChannelInfo channelInfo : required) {\n+                    unusedChannels.remove(channelInfo.channelId);\n+                    if (addChannelToDevice(thingBuilder, channelInfo.channelId, channelInfo.itemType,\n+                            channelInfo.channelTypeUID)) {\n+                        changed = true;\n+                    }\n+                }\n+            }\n+        }\n+\n+        unusedHandlers.forEach(handlers::remove);\n+        if (!unusedChannels.isEmpty()) {\n+            changed = true;\n+            unusedChannels.stream().map(id -> new ChannelUID(thing.getUID(), id)).forEach(thingBuilder::withoutChannel);\n+        }\n+\n+        if (changed) {\n+            updateThing(thingBuilder.build());\n+            updateStatus(ThingStatus.UNKNOWN, ThingStatusDetail.NONE, \"Thing has changed.\");\n+            accountHandler.forceDelayedSmartHomeStateUpdate(findId());\n+        }\n+    }\n+\n+    public String findId() {\n+        String id = (String) getConfig().get(DEVICE_PROPERTY_ID);\n+        if (id == null) {\n+            return \"\";\n+        }\n+        return id;\n+    }\n+\n+    @Override\n+    public void updateState(String channelId, State state) {\n+        super.updateState(new ChannelUID(thing.getUID(), channelId), state);\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        logger.info(\"initializing {}\", thing.getUID());\n+        AccountHandler accountHandler = getAccountHandler();\n+        if (accountHandler != null) {\n+            accountHandler.addSmartHomeDeviceHandler(this);\n+            setDeviceAndUpdateThingState(accountHandler, smartHomeBaseDevice);\n+        } else {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, \"Bridgehandler not found\");\n+        }\n+    }\n+\n+    private boolean addChannelToDevice(ThingBuilder thingBuilder, String channelId, String itemType,\n+            ChannelTypeUID channelTypeUID) {\n+        Channel channel = thing.getChannel(channelId);\n+        if (channel != null) {\n+            if (channelTypeUID.equals(channel.getChannelTypeUID()) && itemType.equals(channel.getAcceptedItemType())) {\n+                // channel exist with the same settings\n+                return false;\n+            }\n+            // channel exist with other settings, remove it first\n+            thingBuilder.withoutChannel(channel.getUID());\n+        }\n+        thingBuilder.withChannel(ChannelBuilder.create(new ChannelUID(thing.getUID(), channelId), itemType)\n+                .withType(channelTypeUID).build());\n+        return true;\n+    }\n+\n+    public void updateChannelStates(List<SmartHomeBaseDevice> allDevices,\n+            Map<String, JsonArray> applianceIdToCapabilityStates) {\n+        AccountHandler accountHandler = getAccountHandler();\n+        SmartHomeBaseDevice smartHomeBaseDevice = this.smartHomeBaseDevice;\n+        if (smartHomeBaseDevice == null) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.NONE, \"Can't find smarthomeBaseDevice!\");\n+            return;\n+        }\n+\n+        boolean stateFound = false;\n+        Map<String, List<JsonObject>> mapInterfaceToStates = new HashMap<>();\n+        SmartHomeDevice firstDevice = null;\n+        for (SmartHomeDevice shd : getSupportedSmartHomeDevices(smartHomeBaseDevice, allDevices)) {\n+            JsonArray states = applianceIdToCapabilityStates.get(shd.applianceId);\n+            String applianceId = shd.applianceId;\n+            if (applianceId == null) {\n+                continue;\n+            }\n+            if (states != null) {\n+                stateFound = true;\n+                if (smartHomeBaseDevice.isGroup()) {\n+                    // for groups, store the last state of all devices\n+                    lastStates.put(applianceId, states);\n+                }\n+            } else {\n+                states = lastStates.get(applianceId);\n+                if (states == null) {\n+                    continue;\n+                }\n+            }\n+            if (firstDevice == null) {\n+                firstDevice = shd;\n+            }\n+            for (JsonElement stateElement : states) {\n+                String stateJson = stateElement.getAsString();\n+                if (stateJson.startsWith(\"{\") && stateJson.endsWith(\"}\")) {\n+                    JsonObject state = gson.fromJson(stateJson, JsonObject.class);\n+                    String interfaceName = state.get(\"namespace\").getAsString();\n+                    mapInterfaceToStates.computeIfAbsent(interfaceName, k -> new ArrayList<>()).add(state);\n+                }\n+            }\n+        }\n+        for (HandlerBase handlerBase : handlers.values()) {\n+            if (handlerBase == null) {\n+                continue;\n+            }\n+            UpdateChannelResult result = new UpdateChannelResult();\n+\n+            for (String interfaceName : handlerBase.getSupportedInterface()) {\n+                List<JsonObject> stateList = mapInterfaceToStates.getOrDefault(interfaceName, Collections.emptyList());\n+                try {\n+                    handlerBase.updateChannels(interfaceName, stateList, result);\n+                } catch (Exception e) {\n+                    // We catch all exceptions, otherwise all other things are not updated!\n+                    logger.debug(\"Updating states failed\", e);\n+                    updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR, e.getLocalizedMessage());\n+                }\n+            }\n+\n+            if (result.needSingleUpdate && smartHomeBaseDevice instanceof SmartHomeDevice && accountHandler != null) {\n+                SmartHomeDevice shd = (SmartHomeDevice) smartHomeBaseDevice;\n+                accountHandler.forceDelayedSmartHomeStateUpdate(shd.findId());\n+            }\n+        }\n+\n+        if (stateFound) {\n+            updateStatus(ThingStatus.ONLINE);\n+        } else {\n+            updateStatus(ThingStatus.UNKNOWN, ThingStatusDetail.NONE, \"State not found\");\n+        }\n+    }\n+\n+    private @Nullable AccountHandler getAccountHandler() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            BridgeHandler bridgeHandler = bridge.getHandler();\n+            if (bridgeHandler instanceof AccountHandler) {\n+                return (AccountHandler) bridgeHandler;\n+            }\n+        }\n+\n+        return null;\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        AccountHandler accountHandler = getAccountHandler();\n+        if (accountHandler == null) {\n+            logger.debug(\"accountHandler is null in {}\", thing.getUID());\n+            return;\n+        }\n+        Connection connection = accountHandler.findConnection();\n+        if (connection == null) {\n+            logger.debug(\"connection is null in {}\", thing.getUID());\n+            return;\n+        }\n+\n+        try {\n+            if (command instanceof RefreshType) {\n+                accountHandler.forceDelayedSmartHomeStateUpdate(findId());\n+                return;\n+            }\n+            SmartHomeBaseDevice smartHomeBaseDevice = this.smartHomeBaseDevice;\n+            if (smartHomeBaseDevice == null) {\n+                logger.debug(\"smarthomeBaseDevice is null in {}\", thing.getUID());\n+                return;\n+            }\n+            Set<SmartHomeDevice> devices = getSupportedSmartHomeDevices(smartHomeBaseDevice,\n+                    accountHandler.getLastKnownSmartHomeDevice());\n+            String channelId = channelUID.getId();\n+\n+            for (String interfaceName : handlers.keySet()) {\n+                HandlerBase handlerBase = handlers.get(interfaceName);\n+                if (handlerBase == null || !handlerBase.hasChannel(channelId)) {\n+                    continue;\n+                }\n+                for (SmartHomeDevice shd : devices) {\n+                    String entityId = shd.entityId;\n+                    if (entityId == null) {\n+                        continue;\n+                    }\n+                    SmartHomeCapability[] capabilities = shd.capabilities;\n+                    if (capabilities == null) {\n+                        logger.debug(\"capabilities is null in {}\", thing.getUID());\n+                        return;\n+                    }\n+                    accountHandler.forceDelayedSmartHomeStateUpdate(findId()); // block updates\n+                    if (handlerBase.handleCommand(connection, shd, entityId, capabilities, channelUID.getId(),\n+                            command)) {\n+                        accountHandler.forceDelayedSmartHomeStateUpdate(findId()); // force update again to restart\n+                        // update timer\n+                        logger.debug(\"Command {} sent to {}\", command, shd.findId());\n+                    }\n+                }\n+            }\n+        } catch (Exception e) {\n+            logger.warn(\"Handle command failed\", e);\n+        }\n+    }\n+\n+    private static void getCapabilities(Map<String, List<SmartHomeCapability>> result, AccountHandler accountHandler,\n+            SmartHomeBaseDevice device) {\n+        if (device instanceof SmartHomeDevice) {\n+            SmartHomeDevice shd = (SmartHomeDevice) device;\n+            SmartHomeCapability[] capabilities = shd.capabilities;\n+            if (capabilities == null) {\n+                return;\n+            }\n+            for (SmartHomeCapability capability : capabilities) {\n+                String interfaceName = capability.interfaceName;\n+                if (interfaceName != null) {\n+                    result.computeIfAbsent(interfaceName, name -> new ArrayList<>()).add(capability);\n+                }\n+            }\n+        }\n+        if (device instanceof SmartHomeGroup) {\n+            for (SmartHomeDevice shd : getSupportedSmartHomeDevices(device,\n+                    accountHandler.getLastKnownSmartHomeDevice())) {\n+                getCapabilities(result, accountHandler, shd);\n+            }\n+        }\n+    }\n+\n+    public static Set<SmartHomeDevice> getSupportedSmartHomeDevices(@Nullable SmartHomeBaseDevice baseDevice,\n+            List<SmartHomeBaseDevice> allDevices) {\n+        Set<SmartHomeDevice> result = new HashSet<>();\n+        if (baseDevice == null) {\n+            return Collections.emptySet();\n+        }\n+        if (baseDevice instanceof SmartHomeDevice) {\n+            SmartHomeDevice shd = (SmartHomeDevice) baseDevice;\n+            SmartHomeCapability[] capabilities = shd.capabilities;\n+            if (capabilities == null) {\n+                return Collections.emptySet();\n+            }\n+            if (Arrays.stream(capabilities).map(capability -> capability.interfaceName)\n+                    .anyMatch(SUPPORTED_INTERFACES::contains)) {\n+                result.add(shd);\n+            }\n+        } else {\n+            SmartHomeGroup shg = (SmartHomeGroup) baseDevice;\n+            for (SmartHomeBaseDevice device : allDevices) {\n+                if (device instanceof SmartHomeDevice) {\n+                    SmartHomeDevice shd = (SmartHomeDevice) device;\n+                    if (shd.tags != null && shd.tags.tagNameToValueSetMap != null\n+                            && shd.tags.tagNameToValueSetMap.groupIdentity != null\n+                            && shg.applianceGroupIdentifier != null && shg.applianceGroupIdentifier.value != null\n+                            && Arrays.asList(shd.tags.tagNameToValueSetMap.groupIdentity)\n+                                    .contains(shg.applianceGroupIdentifier.value)) {\n+                        SmartHomeCapability[] capabilities = shd.capabilities;\n+                        if (capabilities == null) {\n+                            return Collections.emptySet();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9596b49de93355da60e75d6284c239b5192e958f"}, "originalPosition": 368}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTEyNTMzMw==", "bodyText": "This continue doesn't do anything, it can be removed.", "url": "https://github.com/openhab/openhab-addons/pull/7969#discussion_r445125333", "createdAt": "2020-06-24T19:35:54Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.amazonechocontrol/src/main/java/org/openhab/binding/amazonechocontrol/internal/handler/SmartHomeDeviceHandler.java", "diffHunk": "@@ -0,0 +1,392 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.amazonechocontrol.internal.handler;\n+\n+import static org.openhab.binding.amazonechocontrol.internal.AmazonEchoControlBindingConstants.DEVICE_PROPERTY_ID;\n+import static org.openhab.binding.amazonechocontrol.internal.smarthome.Constants.SUPPORTED_INTERFACES;\n+\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Locale;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.function.Supplier;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.thing.Bridge;\n+import org.eclipse.smarthome.core.thing.Channel;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.thing.ThingStatus;\n+import org.eclipse.smarthome.core.thing.ThingStatusDetail;\n+import org.eclipse.smarthome.core.thing.binding.BaseThingHandler;\n+import org.eclipse.smarthome.core.thing.binding.BridgeHandler;\n+import org.eclipse.smarthome.core.thing.binding.builder.ChannelBuilder;\n+import org.eclipse.smarthome.core.thing.binding.builder.ThingBuilder;\n+import org.eclipse.smarthome.core.thing.type.ChannelTypeUID;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.RefreshType;\n+import org.eclipse.smarthome.core.types.State;\n+import org.eclipse.smarthome.core.types.StateDescription;\n+import org.openhab.binding.amazonechocontrol.internal.Connection;\n+import org.openhab.binding.amazonechocontrol.internal.jsons.JsonSmartHomeCapabilities.SmartHomeCapability;\n+import org.openhab.binding.amazonechocontrol.internal.jsons.JsonSmartHomeDevices.SmartHomeDevice;\n+import org.openhab.binding.amazonechocontrol.internal.jsons.JsonSmartHomeGroups.SmartHomeGroup;\n+import org.openhab.binding.amazonechocontrol.internal.jsons.SmartHomeBaseDevice;\n+import org.openhab.binding.amazonechocontrol.internal.smarthome.Constants;\n+import org.openhab.binding.amazonechocontrol.internal.smarthome.HandlerBase;\n+import org.openhab.binding.amazonechocontrol.internal.smarthome.HandlerBase.ChannelInfo;\n+import org.openhab.binding.amazonechocontrol.internal.smarthome.HandlerBase.UpdateChannelResult;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import com.google.gson.Gson;\n+import com.google.gson.JsonArray;\n+import com.google.gson.JsonElement;\n+import com.google.gson.JsonObject;\n+\n+/**\n+ * @author Lukas Knoeller - Initial contribution\n+ */\n+@NonNullByDefault\n+public class SmartHomeDeviceHandler extends BaseThingHandler {\n+    private final Logger logger = LoggerFactory.getLogger(SmartHomeDeviceHandler.class);\n+\n+    private @Nullable SmartHomeBaseDevice smartHomeBaseDevice;\n+    private final Gson gson;\n+    private final Map<String, @Nullable HandlerBase> handlers = new HashMap<>();\n+    private final Map<String, @Nullable JsonArray> lastStates = new HashMap<>();\n+\n+    public SmartHomeDeviceHandler(Thing thing, Gson gson) {\n+        super(thing);\n+        this.gson = gson;\n+    }\n+\n+    public synchronized void setDeviceAndUpdateThingState(AccountHandler accountHandler,\n+            @Nullable SmartHomeBaseDevice smartHomeBaseDevice) {\n+        if (smartHomeBaseDevice == null) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.NONE, \"Can't find smarthomeBaseDevice\");\n+            return;\n+        }\n+        boolean changed = this.smartHomeBaseDevice == null;\n+        this.smartHomeBaseDevice = smartHomeBaseDevice;\n+\n+        Set<String> unusedChannels = new HashSet<>();\n+        thing.getChannels().forEach(channel -> unusedChannels.add(channel.getUID().getId()));\n+\n+        Set<String> unusedHandlers = new HashSet<>(handlers.keySet());\n+\n+        Map<String, List<SmartHomeCapability>> capabilities = new HashMap<>();\n+        getCapabilities(capabilities, accountHandler, smartHomeBaseDevice);\n+\n+        ThingBuilder thingBuilder = editThing();\n+\n+        for (String interfaceName : capabilities.keySet()) {\n+            HandlerBase handler = handlers.get(interfaceName);\n+            if (handler != null) {\n+                unusedHandlers.remove(interfaceName);\n+            } else {\n+                Supplier<HandlerBase> creator = Constants.HANDLER_FACTORY.get(interfaceName);\n+                if (creator != null) {\n+                    handler = creator.get();\n+                    handlers.put(interfaceName, handler);\n+                }\n+            }\n+            if (handler != null) {\n+                Collection<ChannelInfo> required = handler.initialize(this, capabilities.get(interfaceName));\n+                for (ChannelInfo channelInfo : required) {\n+                    unusedChannels.remove(channelInfo.channelId);\n+                    if (addChannelToDevice(thingBuilder, channelInfo.channelId, channelInfo.itemType,\n+                            channelInfo.channelTypeUID)) {\n+                        changed = true;\n+                    }\n+                }\n+            }\n+        }\n+\n+        unusedHandlers.forEach(handlers::remove);\n+        if (!unusedChannels.isEmpty()) {\n+            changed = true;\n+            unusedChannels.stream().map(id -> new ChannelUID(thing.getUID(), id)).forEach(thingBuilder::withoutChannel);\n+        }\n+\n+        if (changed) {\n+            updateThing(thingBuilder.build());\n+            updateStatus(ThingStatus.UNKNOWN, ThingStatusDetail.NONE, \"Thing has changed.\");\n+            accountHandler.forceDelayedSmartHomeStateUpdate(findId());\n+        }\n+    }\n+\n+    public String findId() {\n+        String id = (String) getConfig().get(DEVICE_PROPERTY_ID);\n+        if (id == null) {\n+            return \"\";\n+        }\n+        return id;\n+    }\n+\n+    @Override\n+    public void updateState(String channelId, State state) {\n+        super.updateState(new ChannelUID(thing.getUID(), channelId), state);\n+    }\n+\n+    @Override\n+    public void initialize() {\n+        logger.info(\"initializing {}\", thing.getUID());\n+        AccountHandler accountHandler = getAccountHandler();\n+        if (accountHandler != null) {\n+            accountHandler.addSmartHomeDeviceHandler(this);\n+            setDeviceAndUpdateThingState(accountHandler, smartHomeBaseDevice);\n+        } else {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.CONFIGURATION_ERROR, \"Bridgehandler not found\");\n+        }\n+    }\n+\n+    private boolean addChannelToDevice(ThingBuilder thingBuilder, String channelId, String itemType,\n+            ChannelTypeUID channelTypeUID) {\n+        Channel channel = thing.getChannel(channelId);\n+        if (channel != null) {\n+            if (channelTypeUID.equals(channel.getChannelTypeUID()) && itemType.equals(channel.getAcceptedItemType())) {\n+                // channel exist with the same settings\n+                return false;\n+            }\n+            // channel exist with other settings, remove it first\n+            thingBuilder.withoutChannel(channel.getUID());\n+        }\n+        thingBuilder.withChannel(ChannelBuilder.create(new ChannelUID(thing.getUID(), channelId), itemType)\n+                .withType(channelTypeUID).build());\n+        return true;\n+    }\n+\n+    public void updateChannelStates(List<SmartHomeBaseDevice> allDevices,\n+            Map<String, JsonArray> applianceIdToCapabilityStates) {\n+        AccountHandler accountHandler = getAccountHandler();\n+        SmartHomeBaseDevice smartHomeBaseDevice = this.smartHomeBaseDevice;\n+        if (smartHomeBaseDevice == null) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.NONE, \"Can't find smarthomeBaseDevice!\");\n+            return;\n+        }\n+\n+        boolean stateFound = false;\n+        Map<String, List<JsonObject>> mapInterfaceToStates = new HashMap<>();\n+        SmartHomeDevice firstDevice = null;\n+        for (SmartHomeDevice shd : getSupportedSmartHomeDevices(smartHomeBaseDevice, allDevices)) {\n+            JsonArray states = applianceIdToCapabilityStates.get(shd.applianceId);\n+            String applianceId = shd.applianceId;\n+            if (applianceId == null) {\n+                continue;\n+            }\n+            if (states != null) {\n+                stateFound = true;\n+                if (smartHomeBaseDevice.isGroup()) {\n+                    // for groups, store the last state of all devices\n+                    lastStates.put(applianceId, states);\n+                }\n+            } else {\n+                states = lastStates.get(applianceId);\n+                if (states == null) {\n+                    continue;\n+                }\n+            }\n+            if (firstDevice == null) {\n+                firstDevice = shd;\n+            }\n+            for (JsonElement stateElement : states) {\n+                String stateJson = stateElement.getAsString();\n+                if (stateJson.startsWith(\"{\") && stateJson.endsWith(\"}\")) {\n+                    JsonObject state = gson.fromJson(stateJson, JsonObject.class);\n+                    String interfaceName = state.get(\"namespace\").getAsString();\n+                    mapInterfaceToStates.computeIfAbsent(interfaceName, k -> new ArrayList<>()).add(state);\n+                }\n+            }\n+        }\n+        for (HandlerBase handlerBase : handlers.values()) {\n+            if (handlerBase == null) {\n+                continue;\n+            }\n+            UpdateChannelResult result = new UpdateChannelResult();\n+\n+            for (String interfaceName : handlerBase.getSupportedInterface()) {\n+                List<JsonObject> stateList = mapInterfaceToStates.getOrDefault(interfaceName, Collections.emptyList());\n+                try {\n+                    handlerBase.updateChannels(interfaceName, stateList, result);\n+                } catch (Exception e) {\n+                    // We catch all exceptions, otherwise all other things are not updated!\n+                    logger.debug(\"Updating states failed\", e);\n+                    updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR, e.getLocalizedMessage());\n+                }\n+            }\n+\n+            if (result.needSingleUpdate && smartHomeBaseDevice instanceof SmartHomeDevice && accountHandler != null) {\n+                SmartHomeDevice shd = (SmartHomeDevice) smartHomeBaseDevice;\n+                accountHandler.forceDelayedSmartHomeStateUpdate(shd.findId());\n+            }\n+        }\n+\n+        if (stateFound) {\n+            updateStatus(ThingStatus.ONLINE);\n+        } else {\n+            updateStatus(ThingStatus.UNKNOWN, ThingStatusDetail.NONE, \"State not found\");\n+        }\n+    }\n+\n+    private @Nullable AccountHandler getAccountHandler() {\n+        Bridge bridge = getBridge();\n+        if (bridge != null) {\n+            BridgeHandler bridgeHandler = bridge.getHandler();\n+            if (bridgeHandler instanceof AccountHandler) {\n+                return (AccountHandler) bridgeHandler;\n+            }\n+        }\n+\n+        return null;\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        AccountHandler accountHandler = getAccountHandler();\n+        if (accountHandler == null) {\n+            logger.debug(\"accountHandler is null in {}\", thing.getUID());\n+            return;\n+        }\n+        Connection connection = accountHandler.findConnection();\n+        if (connection == null) {\n+            logger.debug(\"connection is null in {}\", thing.getUID());\n+            return;\n+        }\n+\n+        try {\n+            if (command instanceof RefreshType) {\n+                accountHandler.forceDelayedSmartHomeStateUpdate(findId());\n+                return;\n+            }\n+            SmartHomeBaseDevice smartHomeBaseDevice = this.smartHomeBaseDevice;\n+            if (smartHomeBaseDevice == null) {\n+                logger.debug(\"smarthomeBaseDevice is null in {}\", thing.getUID());\n+                return;\n+            }\n+            Set<SmartHomeDevice> devices = getSupportedSmartHomeDevices(smartHomeBaseDevice,\n+                    accountHandler.getLastKnownSmartHomeDevice());\n+            String channelId = channelUID.getId();\n+\n+            for (String interfaceName : handlers.keySet()) {\n+                HandlerBase handlerBase = handlers.get(interfaceName);\n+                if (handlerBase == null || !handlerBase.hasChannel(channelId)) {\n+                    continue;\n+                }\n+                for (SmartHomeDevice shd : devices) {\n+                    String entityId = shd.entityId;\n+                    if (entityId == null) {\n+                        continue;\n+                    }\n+                    SmartHomeCapability[] capabilities = shd.capabilities;\n+                    if (capabilities == null) {\n+                        logger.debug(\"capabilities is null in {}\", thing.getUID());\n+                        return;\n+                    }\n+                    accountHandler.forceDelayedSmartHomeStateUpdate(findId()); // block updates\n+                    if (handlerBase.handleCommand(connection, shd, entityId, capabilities, channelUID.getId(),\n+                            command)) {\n+                        accountHandler.forceDelayedSmartHomeStateUpdate(findId()); // force update again to restart\n+                        // update timer\n+                        logger.debug(\"Command {} sent to {}\", command, shd.findId());\n+                    }\n+                }\n+            }\n+        } catch (Exception e) {\n+            logger.warn(\"Handle command failed\", e);\n+        }\n+    }\n+\n+    private static void getCapabilities(Map<String, List<SmartHomeCapability>> result, AccountHandler accountHandler,\n+            SmartHomeBaseDevice device) {\n+        if (device instanceof SmartHomeDevice) {\n+            SmartHomeDevice shd = (SmartHomeDevice) device;\n+            SmartHomeCapability[] capabilities = shd.capabilities;\n+            if (capabilities == null) {\n+                return;\n+            }\n+            for (SmartHomeCapability capability : capabilities) {\n+                String interfaceName = capability.interfaceName;\n+                if (interfaceName != null) {\n+                    result.computeIfAbsent(interfaceName, name -> new ArrayList<>()).add(capability);\n+                }\n+            }\n+        }\n+        if (device instanceof SmartHomeGroup) {\n+            for (SmartHomeDevice shd : getSupportedSmartHomeDevices(device,\n+                    accountHandler.getLastKnownSmartHomeDevice())) {\n+                getCapabilities(result, accountHandler, shd);\n+            }\n+        }\n+    }\n+\n+    public static Set<SmartHomeDevice> getSupportedSmartHomeDevices(@Nullable SmartHomeBaseDevice baseDevice,\n+            List<SmartHomeBaseDevice> allDevices) {\n+        Set<SmartHomeDevice> result = new HashSet<>();\n+        if (baseDevice == null) {\n+            return Collections.emptySet();\n+        }\n+        if (baseDevice instanceof SmartHomeDevice) {\n+            SmartHomeDevice shd = (SmartHomeDevice) baseDevice;\n+            SmartHomeCapability[] capabilities = shd.capabilities;\n+            if (capabilities == null) {\n+                return Collections.emptySet();\n+            }\n+            if (Arrays.stream(capabilities).map(capability -> capability.interfaceName)\n+                    .anyMatch(SUPPORTED_INTERFACES::contains)) {\n+                result.add(shd);\n+            }\n+        } else {\n+            SmartHomeGroup shg = (SmartHomeGroup) baseDevice;\n+            for (SmartHomeBaseDevice device : allDevices) {\n+                if (device instanceof SmartHomeDevice) {\n+                    SmartHomeDevice shd = (SmartHomeDevice) device;\n+                    if (shd.tags != null && shd.tags.tagNameToValueSetMap != null\n+                            && shd.tags.tagNameToValueSetMap.groupIdentity != null\n+                            && shg.applianceGroupIdentifier != null && shg.applianceGroupIdentifier.value != null\n+                            && Arrays.asList(shd.tags.tagNameToValueSetMap.groupIdentity)\n+                                    .contains(shg.applianceGroupIdentifier.value)) {\n+                        SmartHomeCapability[] capabilities = shd.capabilities;\n+                        if (capabilities == null) {\n+                            return Collections.emptySet();\n+                        }\n+                        if (Arrays.stream(capabilities).map(capability -> capability.interfaceName)\n+                                .anyMatch(SUPPORTED_INTERFACES::contains)) {\n+                            result.add(shd);\n+                            continue;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9596b49de93355da60e75d6284c239b5192e958f"}, "originalPosition": 373}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTEzNDQ3OA==", "bodyText": "You can remove all the synchronization used around this field if you just make it thread-safe to begin with.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private final Set<SmartHomeDeviceHandler> smartHomeDeviceHandlers = new HashSet<>();\n          \n          \n            \n                private final Set<SmartHomeDeviceHandler> smartHomeDeviceHandlers = new CopyOnWriteArraySet<>();", "url": "https://github.com/openhab/openhab-addons/pull/7969#discussion_r445134478", "createdAt": "2020-06-24T19:53:29Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.amazonechocontrol/src/main/java/org/openhab/binding/amazonechocontrol/internal/handler/AccountHandler.java", "diffHunk": "@@ -83,24 +91,32 @@\n  */\n @NonNullByDefault\n public class AccountHandler extends BaseBridgeHandler implements IWebSocketCommandHandler, IAmazonThingHandler {\n-\n     private final Logger logger = LoggerFactory.getLogger(AccountHandler.class);\n     private Storage<String> stateStorage;\n     private @Nullable Connection connection;\n     private @Nullable WebSocketConnection webSocketConnection;\n+\n     private final Set<EchoHandler> echoHandlers = new HashSet<>();\n+    private final Set<SmartHomeDeviceHandler> smartHomeDeviceHandlers = new HashSet<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9596b49de93355da60e75d6284c239b5192e958f"}, "originalPosition": 55}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTEzNTE2OA==", "bodyText": "Either change the name of this method or make it return a boolean instead.", "url": "https://github.com/openhab/openhab-addons/pull/7969#discussion_r445135168", "createdAt": "2020-06-24T19:54:50Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.amazonechocontrol/src/main/java/org/openhab/binding/amazonechocontrol/internal/handler/AccountHandler.java", "diffHunk": "@@ -800,4 +862,187 @@ private void handlePushActivity(@Nullable String payload) {\n     void refreshAfterCommand() {\n         refreshData();\n     }\n+\n+    private @Nullable SmartHomeBaseDevice findSmartDeviceHomeJson(SmartHomeDeviceHandler handler) {\n+        String id = handler.findId();\n+        if (!id.isEmpty()) {\n+            return jsonIdSmartHomeDeviceMapping.get(id);\n+        }\n+        return null;\n+    }\n+\n+    public int shouldDiscoverSmartHomeDevices() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9596b49de93355da60e75d6284c239b5192e958f"}, "originalPosition": 325}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTEzNjQxNA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        logger.error(\"updateSmartHomeState fails with unexpected error\", e);\n          \n          \n            \n                        logger.warn(\"updateSmartHomeState fails with unexpected error\", e);", "url": "https://github.com/openhab/openhab-addons/pull/7969#discussion_r445136414", "createdAt": "2020-06-24T19:57:09Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.amazonechocontrol/src/main/java/org/openhab/binding/amazonechocontrol/internal/handler/AccountHandler.java", "diffHunk": "@@ -800,4 +862,187 @@ private void handlePushActivity(@Nullable String payload) {\n     void refreshAfterCommand() {\n         refreshData();\n     }\n+\n+    private @Nullable SmartHomeBaseDevice findSmartDeviceHomeJson(SmartHomeDeviceHandler handler) {\n+        String id = handler.findId();\n+        if (!id.isEmpty()) {\n+            return jsonIdSmartHomeDeviceMapping.get(id);\n+        }\n+        return null;\n+    }\n+\n+    public int shouldDiscoverSmartHomeDevices() {\n+        Configuration config = getThing().getConfiguration();\n+        Object discoverSmartHomeConfig = config.getProperties().get(\"discoverSmartHome\");\n+        int discoverSmartHome = 0;\n+        if (discoverSmartHomeConfig instanceof Boolean) {\n+            discoverSmartHome = ((boolean) discoverSmartHomeConfig) ? 2 : 0;\n+        }\n+        if (discoverSmartHomeConfig instanceof BigDecimal) {\n+            discoverSmartHome = ((BigDecimal) discoverSmartHomeConfig).intValue();\n+        }\n+        return discoverSmartHome;\n+    }\n+\n+    public boolean shouldDiscoverOpenHABSmartHomeDevices() {\n+        Configuration config = getThing().getConfiguration();\n+        Boolean discoverOpenHabSmartHomeDevices = (Boolean) config.getProperties()\n+                .get(\"discoverOpenHabSmartHomeDevices\");\n+        if (discoverOpenHabSmartHomeDevices == null) {\n+            return false;\n+        }\n+        return discoverOpenHabSmartHomeDevices;\n+    }\n+\n+    public List<SmartHomeBaseDevice> updateSmartHomeDeviceList(boolean forceUpdate) {\n+        Connection currentConnection = connection;\n+        if (currentConnection == null) {\n+            return Collections.emptyList();\n+        }\n+\n+        if (!forceUpdate && this.smartHomeDeviceHandlers.isEmpty() && shouldDiscoverSmartHomeDevices() == 0) {\n+            return Collections.emptyList();\n+        }\n+\n+        List<SmartHomeBaseDevice> smartHomeDevices = null;\n+        try {\n+            if (currentConnection.getIsLoggedIn()) {\n+                smartHomeDevices = currentConnection.getSmarthomeDeviceList();\n+            }\n+        } catch (IOException | URISyntaxException e) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR, e.getLocalizedMessage());\n+        }\n+        if (smartHomeDevices != null) {\n+            // create new id map\n+            Map<String, SmartHomeBaseDevice> newJsonIdSmartHomeDeviceMapping = new HashMap<>();\n+            for (Object smartHomeDevice : smartHomeDevices) {\n+                if (smartHomeDevice instanceof SmartHomeBaseDevice) {\n+                    SmartHomeBaseDevice smartHomeBaseDevice = (SmartHomeBaseDevice) smartHomeDevice;\n+                    String id = smartHomeBaseDevice.findId();\n+                    if (id != null) {\n+                        newJsonIdSmartHomeDeviceMapping.put(id, smartHomeBaseDevice);\n+                    }\n+                }\n+            }\n+            jsonIdSmartHomeDeviceMapping.clear();\n+            jsonIdSmartHomeDeviceMapping.putAll(newJsonIdSmartHomeDeviceMapping);\n+        }\n+        // update handlers\n+        synchronized (smartHomeDeviceHandlers) {\n+            smartHomeDeviceHandlers\n+                    .forEach(child -> child.setDeviceAndUpdateThingState(this, findSmartDeviceHomeJson(child)));\n+        }\n+\n+        if (smartHomeDevices != null) {\n+            Map<String, SmartHomeDevice> newJsonSerialDeviceMapping = new HashMap<>();\n+            for (Object smartDevice : smartHomeDevices) {\n+                if (smartDevice instanceof SmartHomeDevice) {\n+                    SmartHomeDevice shd = (SmartHomeDevice) smartDevice;\n+                    String entityId = shd.entityId;\n+                    if (entityId != null) {\n+                        newJsonSerialDeviceMapping.put(entityId, shd);\n+                    }\n+                }\n+            }\n+        }\n+        if (smartHomeDevices != null) {\n+            return smartHomeDevices;\n+        }\n+\n+        return Collections.emptyList();\n+    }\n+\n+    public void forceDelayedSmartHomeStateUpdate(@Nullable String deviceId) {\n+        if (deviceId == null) {\n+            return;\n+        }\n+        synchronized (synchronizeSmartHomeJobScheduler) {\n+            requestedDeviceUpdates.add(deviceId);\n+            ScheduledFuture<?> refreshSmartHomeAfterCommandJob = this.refreshSmartHomeAfterCommandJob;\n+            if (refreshSmartHomeAfterCommandJob != null) {\n+                refreshSmartHomeAfterCommandJob.cancel(false);\n+            }\n+            this.refreshSmartHomeAfterCommandJob = scheduler.schedule(this::updateSmartHomeStateJob, 500,\n+                    TimeUnit.MILLISECONDS);\n+        }\n+    }\n+\n+    private void updateSmartHomeStateJob() {\n+        Set<String> deviceUpdates = new HashSet<>();\n+\n+        synchronized (synchronizeSmartHomeJobScheduler) {\n+            Connection connection = this.connection;\n+            if (connection == null || !connection.getIsLoggedIn()) {\n+                this.refreshSmartHomeAfterCommandJob = scheduler.schedule(this::updateSmartHomeStateJob, 1000,\n+                        TimeUnit.MILLISECONDS);\n+                return;\n+            }\n+            requestedDeviceUpdates.drainTo(deviceUpdates);\n+            this.refreshSmartHomeAfterCommandJob = null;\n+        }\n+\n+        deviceUpdates.forEach(this::updateSmartHomeState);\n+    }\n+\n+    private synchronized void updateSmartHomeState(@Nullable String deviceFilterId) {\n+        try {\n+            logger.debug(\"updateSmartHomeState started\");\n+            Connection connection = this.connection;\n+            if (connection == null || !connection.getIsLoggedIn()) {\n+                return;\n+            }\n+            List<SmartHomeBaseDevice> allDevices = this.getLastKnownSmartHomeDevice();\n+            Set<String> applianceIds = new HashSet<>();\n+            if (deviceFilterId != null) {\n+                applianceIds.add(deviceFilterId);\n+            } else {\n+                SmartHomeDeviceStateGroupUpdateCalculator smartHomeDeviceStateGroupUpdateCalculator = this.smartHomeDeviceStateGroupUpdateCalculator;\n+                if (smartHomeDeviceStateGroupUpdateCalculator == null) {\n+                    return;\n+                }\n+                synchronized (this.smartHomeDeviceHandlers) {\n+                    if (this.smartHomeDeviceHandlers.size() == 0) {\n+                        return;\n+                    }\n+                    List<SmartHomeDevice> devicesToUpdate = new ArrayList<>();\n+                    for (SmartHomeDeviceHandler device : smartHomeDeviceHandlers) {\n+                        String id = device.findId();\n+                        SmartHomeBaseDevice baseDevice = jsonIdSmartHomeDeviceMapping.get(id);\n+                        SmartHomeDeviceHandler.getSupportedSmartHomeDevices(baseDevice, allDevices)\n+                                .forEach(devicesToUpdate::add);\n+                    }\n+                    smartHomeDeviceStateGroupUpdateCalculator.removeDevicesWithNoUpdate(devicesToUpdate);\n+                    for (SmartHomeDevice shd : devicesToUpdate) {\n+                        String applianceId = shd.applianceId;\n+                        if (applianceId != null) {\n+                            applianceIds.add(applianceId);\n+                        }\n+                    }\n+                    if (applianceIds.size() == 0) {\n+                        return;\n+                    }\n+                }\n+            }\n+            Map<String, JsonArray> applianceIdToCapabilityStates = connection\n+                    .getSmartHomeDeviceStatesJson(applianceIds);\n+\n+            synchronized (this.smartHomeDeviceHandlers) {\n+                for (SmartHomeDeviceHandler smartHomeDeviceHandler : smartHomeDeviceHandlers) {\n+                    String id = smartHomeDeviceHandler.findId();\n+                    if (requestedDeviceUpdates.contains(id)) {\n+                        logger.debug(\"Device update {} suspended\", id);\n+                        continue;\n+                    }\n+                    if (deviceFilterId == null || deviceFilterId.equals(id)) {\n+                        smartHomeDeviceHandler.updateChannelStates(allDevices, applianceIdToCapabilityStates);\n+                    }\n+                }\n+            }\n+            logger.debug(\"updateSmartHomeState finished\");\n+        } catch (HttpException | JsonSyntaxException | ConnectionException e) {\n+            logger.debug(\"updateSmartHomeState fails\", e);\n+        } catch (Exception e) { // this handler can be removed later, if we know that nothing else can fail.\n+            logger.error(\"updateSmartHomeState fails with unexpected error\", e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9596b49de93355da60e75d6284c239b5192e958f"}, "originalPosition": 496}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTE0MTc2Ng==", "bodyText": "Since this class isn't an osgi service I don't know if adding @Activate serves any purpose here.", "url": "https://github.com/openhab/openhab-addons/pull/7969#discussion_r445141766", "createdAt": "2020-06-24T20:07:20Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.amazonechocontrol/src/main/java/org/openhab/binding/amazonechocontrol/internal/discovery/SmartHomeDevicesDiscovery.java", "diffHunk": "@@ -0,0 +1,255 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.amazonechocontrol.internal.discovery;\n+\n+import static org.openhab.binding.amazonechocontrol.internal.AmazonEchoControlBindingConstants.DEVICE_PROPERTY_ID;\n+import static org.openhab.binding.amazonechocontrol.internal.AmazonEchoControlBindingConstants.SUPPORTED_SMART_HOME_THING_TYPES_UIDS;\n+import static org.openhab.binding.amazonechocontrol.internal.AmazonEchoControlBindingConstants.THING_TYPE_SMART_HOME_DEVICE;\n+import static org.openhab.binding.amazonechocontrol.internal.AmazonEchoControlBindingConstants.THING_TYPE_SMART_HOME_DEVICE_GROUP;\n+\n+import java.util.Date;\n+import java.util.HashMap;\n+import java.util.Hashtable;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.config.discovery.AbstractDiscoveryService;\n+import org.eclipse.smarthome.config.discovery.DiscoveryResult;\n+import org.eclipse.smarthome.config.discovery.DiscoveryResultBuilder;\n+import org.eclipse.smarthome.config.discovery.DiscoveryServiceCallback;\n+import org.eclipse.smarthome.config.discovery.ExtendedDiscoveryService;\n+import org.eclipse.smarthome.core.thing.ThingUID;\n+import org.openhab.binding.amazonechocontrol.internal.Connection;\n+import org.openhab.binding.amazonechocontrol.internal.handler.AccountHandler;\n+import org.openhab.binding.amazonechocontrol.internal.handler.SmartHomeDeviceHandler;\n+import org.openhab.binding.amazonechocontrol.internal.jsons.JsonSmartHomeCapabilities.SmartHomeCapability;\n+import org.openhab.binding.amazonechocontrol.internal.jsons.JsonSmartHomeDevices.DriverIdentity;\n+import org.openhab.binding.amazonechocontrol.internal.jsons.JsonSmartHomeDevices.SmartHomeDevice;\n+import org.openhab.binding.amazonechocontrol.internal.jsons.JsonSmartHomeGroups.SmartHomeGroup;\n+import org.openhab.binding.amazonechocontrol.internal.jsons.SmartHomeBaseDevice;\n+import org.openhab.binding.amazonechocontrol.internal.smarthome.Constants;\n+import org.osgi.service.component.annotations.Activate;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * @author Lukas Knoeller - Initial contribution\n+ */\n+@NonNullByDefault\n+public class SmartHomeDevicesDiscovery extends AbstractDiscoveryService implements ExtendedDiscoveryService {\n+\n+    private AccountHandler accountHandler;\n+    private final Logger logger = LoggerFactory.getLogger(SmartHomeDevicesDiscovery.class);\n+\n+    private @Nullable ScheduledFuture<?> startScanStateJob;\n+    private @Nullable Long activateTimeStamp;\n+\n+    private @Nullable DiscoveryServiceCallback discoveryServiceCallback;\n+\n+    @Override\n+    public void setDiscoveryServiceCallback(DiscoveryServiceCallback discoveryServiceCallback) {\n+        this.discoveryServiceCallback = discoveryServiceCallback;\n+    }\n+\n+    public SmartHomeDevicesDiscovery(AccountHandler accountHandler) {\n+        super(SUPPORTED_SMART_HOME_THING_TYPES_UIDS, 10);\n+        this.accountHandler = accountHandler;\n+    }\n+\n+    public void activate() {\n+        activate(new Hashtable<String, @Nullable Object>());\n+    }\n+\n+    @Override\n+    public void deactivate() {\n+        super.deactivate();\n+    }\n+\n+    @Override\n+    protected void startScan() {\n+        stopScanJob();\n+        Long activateTimeStamp = this.activateTimeStamp;\n+        if (activateTimeStamp != null) {\n+            removeOlderResults(activateTimeStamp);\n+        }\n+        setSmartHomeDevices(accountHandler.updateSmartHomeDeviceList(false));\n+    }\n+\n+    protected void startAutomaticScan() {\n+        if (!this.accountHandler.getThing().getThings().isEmpty()) {\n+            stopScanJob();\n+            return;\n+        }\n+        Connection connection = this.accountHandler.findConnection();\n+        if (connection == null) {\n+            return;\n+        }\n+        Date verifyTime = connection.tryGetVerifyTime();\n+        if (verifyTime == null) {\n+            return;\n+        }\n+        if (new Date().getTime() - verifyTime.getTime() < 10000) {\n+            return;\n+        }\n+        startScan();\n+    }\n+\n+    @Override\n+    protected void startBackgroundDiscovery() {\n+        stopScanJob();\n+        startScanStateJob = scheduler.scheduleWithFixedDelay(this::startAutomaticScan, 3000, 1000,\n+                TimeUnit.MILLISECONDS);\n+    }\n+\n+    @Override\n+    protected void stopBackgroundDiscovery() {\n+        stopScanJob();\n+    }\n+\n+    void stopScanJob() {\n+        ScheduledFuture<?> currentStartScanStateJob = startScanStateJob;\n+        if (currentStartScanStateJob != null) {\n+            currentStartScanStateJob.cancel(false);\n+            startScanStateJob = null;\n+        }\n+        super.stopScan();\n+    }\n+\n+    @Override\n+    @Activate", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9596b49de93355da60e75d6284c239b5192e958f"}, "originalPosition": 134}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTE0MzUyNA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            boolean supportedDevice = false;\n          \n          \n            \n                            for (SmartHomeCapability capability : shd.capabilities) {\n          \n          \n            \n                                if (capability != null && Constants.SUPPORTED_INTERFACES.contains(capability.interfaceName)) {\n          \n          \n            \n                                    supportedDevice = true;\n          \n          \n            \n                                    break;\n          \n          \n            \n                                }\n          \n          \n            \n                            }\n          \n          \n            \n                            if (!supportedDevice) {\n          \n          \n            \n                            if (Stream.of(shd.capabilities).noneMatch(capability -> capability != null && Constants.SUPPORTED_INTERFACES.contains(capability.interfaceName))) {", "url": "https://github.com/openhab/openhab-addons/pull/7969#discussion_r445143524", "createdAt": "2020-06-24T20:10:55Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.amazonechocontrol/src/main/java/org/openhab/binding/amazonechocontrol/internal/discovery/SmartHomeDevicesDiscovery.java", "diffHunk": "@@ -0,0 +1,255 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.amazonechocontrol.internal.discovery;\n+\n+import static org.openhab.binding.amazonechocontrol.internal.AmazonEchoControlBindingConstants.DEVICE_PROPERTY_ID;\n+import static org.openhab.binding.amazonechocontrol.internal.AmazonEchoControlBindingConstants.SUPPORTED_SMART_HOME_THING_TYPES_UIDS;\n+import static org.openhab.binding.amazonechocontrol.internal.AmazonEchoControlBindingConstants.THING_TYPE_SMART_HOME_DEVICE;\n+import static org.openhab.binding.amazonechocontrol.internal.AmazonEchoControlBindingConstants.THING_TYPE_SMART_HOME_DEVICE_GROUP;\n+\n+import java.util.Date;\n+import java.util.HashMap;\n+import java.util.Hashtable;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.concurrent.ScheduledFuture;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.config.discovery.AbstractDiscoveryService;\n+import org.eclipse.smarthome.config.discovery.DiscoveryResult;\n+import org.eclipse.smarthome.config.discovery.DiscoveryResultBuilder;\n+import org.eclipse.smarthome.config.discovery.DiscoveryServiceCallback;\n+import org.eclipse.smarthome.config.discovery.ExtendedDiscoveryService;\n+import org.eclipse.smarthome.core.thing.ThingUID;\n+import org.openhab.binding.amazonechocontrol.internal.Connection;\n+import org.openhab.binding.amazonechocontrol.internal.handler.AccountHandler;\n+import org.openhab.binding.amazonechocontrol.internal.handler.SmartHomeDeviceHandler;\n+import org.openhab.binding.amazonechocontrol.internal.jsons.JsonSmartHomeCapabilities.SmartHomeCapability;\n+import org.openhab.binding.amazonechocontrol.internal.jsons.JsonSmartHomeDevices.DriverIdentity;\n+import org.openhab.binding.amazonechocontrol.internal.jsons.JsonSmartHomeDevices.SmartHomeDevice;\n+import org.openhab.binding.amazonechocontrol.internal.jsons.JsonSmartHomeGroups.SmartHomeGroup;\n+import org.openhab.binding.amazonechocontrol.internal.jsons.SmartHomeBaseDevice;\n+import org.openhab.binding.amazonechocontrol.internal.smarthome.Constants;\n+import org.osgi.service.component.annotations.Activate;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+/**\n+ * @author Lukas Knoeller - Initial contribution\n+ */\n+@NonNullByDefault\n+public class SmartHomeDevicesDiscovery extends AbstractDiscoveryService implements ExtendedDiscoveryService {\n+\n+    private AccountHandler accountHandler;\n+    private final Logger logger = LoggerFactory.getLogger(SmartHomeDevicesDiscovery.class);\n+\n+    private @Nullable ScheduledFuture<?> startScanStateJob;\n+    private @Nullable Long activateTimeStamp;\n+\n+    private @Nullable DiscoveryServiceCallback discoveryServiceCallback;\n+\n+    @Override\n+    public void setDiscoveryServiceCallback(DiscoveryServiceCallback discoveryServiceCallback) {\n+        this.discoveryServiceCallback = discoveryServiceCallback;\n+    }\n+\n+    public SmartHomeDevicesDiscovery(AccountHandler accountHandler) {\n+        super(SUPPORTED_SMART_HOME_THING_TYPES_UIDS, 10);\n+        this.accountHandler = accountHandler;\n+    }\n+\n+    public void activate() {\n+        activate(new Hashtable<String, @Nullable Object>());\n+    }\n+\n+    @Override\n+    public void deactivate() {\n+        super.deactivate();\n+    }\n+\n+    @Override\n+    protected void startScan() {\n+        stopScanJob();\n+        Long activateTimeStamp = this.activateTimeStamp;\n+        if (activateTimeStamp != null) {\n+            removeOlderResults(activateTimeStamp);\n+        }\n+        setSmartHomeDevices(accountHandler.updateSmartHomeDeviceList(false));\n+    }\n+\n+    protected void startAutomaticScan() {\n+        if (!this.accountHandler.getThing().getThings().isEmpty()) {\n+            stopScanJob();\n+            return;\n+        }\n+        Connection connection = this.accountHandler.findConnection();\n+        if (connection == null) {\n+            return;\n+        }\n+        Date verifyTime = connection.tryGetVerifyTime();\n+        if (verifyTime == null) {\n+            return;\n+        }\n+        if (new Date().getTime() - verifyTime.getTime() < 10000) {\n+            return;\n+        }\n+        startScan();\n+    }\n+\n+    @Override\n+    protected void startBackgroundDiscovery() {\n+        stopScanJob();\n+        startScanStateJob = scheduler.scheduleWithFixedDelay(this::startAutomaticScan, 3000, 1000,\n+                TimeUnit.MILLISECONDS);\n+    }\n+\n+    @Override\n+    protected void stopBackgroundDiscovery() {\n+        stopScanJob();\n+    }\n+\n+    void stopScanJob() {\n+        ScheduledFuture<?> currentStartScanStateJob = startScanStateJob;\n+        if (currentStartScanStateJob != null) {\n+            currentStartScanStateJob.cancel(false);\n+            startScanStateJob = null;\n+        }\n+        super.stopScan();\n+    }\n+\n+    @Override\n+    @Activate\n+    public void activate(@Nullable Map<String, @Nullable Object> config) {\n+        super.activate(config);\n+        if (config != null) {\n+            modified(config);\n+        }\n+        Long activateTimeStamp = this.activateTimeStamp;\n+        if (activateTimeStamp == null) {\n+            this.activateTimeStamp = new Date().getTime();\n+        }\n+    };\n+\n+    synchronized void setSmartHomeDevices(List<SmartHomeBaseDevice> deviceList) {\n+        DiscoveryServiceCallback discoveryServiceCallback = this.discoveryServiceCallback;\n+\n+        if (discoveryServiceCallback == null) {\n+            return;\n+        }\n+        int shouldDiscoverSmartHomeDevice = accountHandler.shouldDiscoverSmartHomeDevices();\n+        if (shouldDiscoverSmartHomeDevice == 0) {\n+            return;\n+        }\n+        boolean shouldDiscoverOpenHabDevices = accountHandler.shouldDiscoverOpenHABSmartHomeDevices();\n+\n+        for (Object smartHomeDevice : deviceList) {\n+            ThingUID bridgeThingUID = this.accountHandler.getThing().getUID();\n+            ThingUID thingUID = null;\n+            String deviceName = null;\n+            Map<String, Object> props = new HashMap<>();\n+\n+            if (smartHomeDevice instanceof SmartHomeDevice) {\n+                SmartHomeDevice shd = (SmartHomeDevice) smartHomeDevice;\n+\n+                String entityId = shd.entityId;\n+                if (entityId == null) {\n+                    // No entity id\n+                    continue;\n+                }\n+                String id = shd.findId();\n+                if (id == null) {\n+                    // No id\n+                    continue;\n+                }\n+                boolean isSkillDevice = false;\n+                DriverIdentity driverIdentity = shd.driverIdentity;\n+                isSkillDevice = driverIdentity != null && \"SKILL\".equals(driverIdentity.namespace);\n+\n+                if (shouldDiscoverSmartHomeDevice == 1 && isSkillDevice) {\n+                    // Connected through skill\n+                    continue;\n+                }\n+                if (!shouldDiscoverOpenHabDevices && \"openHAB\".equalsIgnoreCase(shd.manufacturerName)) {\n+                    // OpenHAB device\n+                    continue;\n+                }\n+\n+                boolean supportedDevice = false;\n+                for (SmartHomeCapability capability : shd.capabilities) {\n+                    if (capability != null && Constants.SUPPORTED_INTERFACES.contains(capability.interfaceName)) {\n+                        supportedDevice = true;\n+                        break;\n+                    }\n+                }\n+                if (!supportedDevice) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9596b49de93355da60e75d6284c239b5192e958f"}, "originalPosition": 197}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTE0NTY4Mg==", "bodyText": "Why replace the contents when you can just replace the instance?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        jsonIdSmartHomeDeviceMapping.clear();\n          \n          \n            \n                        jsonIdSmartHomeDeviceMapping.putAll(newJsonIdSmartHomeDeviceMapping);\n          \n          \n            \n                        jsonIdSmartHomeDeviceMapping = newJsonIdSmartHomeDeviceMapping;", "url": "https://github.com/openhab/openhab-addons/pull/7969#discussion_r445145682", "createdAt": "2020-06-24T20:15:17Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.amazonechocontrol/src/main/java/org/openhab/binding/amazonechocontrol/internal/handler/AccountHandler.java", "diffHunk": "@@ -800,4 +862,187 @@ private void handlePushActivity(@Nullable String payload) {\n     void refreshAfterCommand() {\n         refreshData();\n     }\n+\n+    private @Nullable SmartHomeBaseDevice findSmartDeviceHomeJson(SmartHomeDeviceHandler handler) {\n+        String id = handler.findId();\n+        if (!id.isEmpty()) {\n+            return jsonIdSmartHomeDeviceMapping.get(id);\n+        }\n+        return null;\n+    }\n+\n+    public int shouldDiscoverSmartHomeDevices() {\n+        Configuration config = getThing().getConfiguration();\n+        Object discoverSmartHomeConfig = config.getProperties().get(\"discoverSmartHome\");\n+        int discoverSmartHome = 0;\n+        if (discoverSmartHomeConfig instanceof Boolean) {\n+            discoverSmartHome = ((boolean) discoverSmartHomeConfig) ? 2 : 0;\n+        }\n+        if (discoverSmartHomeConfig instanceof BigDecimal) {\n+            discoverSmartHome = ((BigDecimal) discoverSmartHomeConfig).intValue();\n+        }\n+        return discoverSmartHome;\n+    }\n+\n+    public boolean shouldDiscoverOpenHABSmartHomeDevices() {\n+        Configuration config = getThing().getConfiguration();\n+        Boolean discoverOpenHabSmartHomeDevices = (Boolean) config.getProperties()\n+                .get(\"discoverOpenHabSmartHomeDevices\");\n+        if (discoverOpenHabSmartHomeDevices == null) {\n+            return false;\n+        }\n+        return discoverOpenHabSmartHomeDevices;\n+    }\n+\n+    public List<SmartHomeBaseDevice> updateSmartHomeDeviceList(boolean forceUpdate) {\n+        Connection currentConnection = connection;\n+        if (currentConnection == null) {\n+            return Collections.emptyList();\n+        }\n+\n+        if (!forceUpdate && this.smartHomeDeviceHandlers.isEmpty() && shouldDiscoverSmartHomeDevices() == 0) {\n+            return Collections.emptyList();\n+        }\n+\n+        List<SmartHomeBaseDevice> smartHomeDevices = null;\n+        try {\n+            if (currentConnection.getIsLoggedIn()) {\n+                smartHomeDevices = currentConnection.getSmarthomeDeviceList();\n+            }\n+        } catch (IOException | URISyntaxException e) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR, e.getLocalizedMessage());\n+        }\n+        if (smartHomeDevices != null) {\n+            // create new id map\n+            Map<String, SmartHomeBaseDevice> newJsonIdSmartHomeDeviceMapping = new HashMap<>();\n+            for (Object smartHomeDevice : smartHomeDevices) {\n+                if (smartHomeDevice instanceof SmartHomeBaseDevice) {\n+                    SmartHomeBaseDevice smartHomeBaseDevice = (SmartHomeBaseDevice) smartHomeDevice;\n+                    String id = smartHomeBaseDevice.findId();\n+                    if (id != null) {\n+                        newJsonIdSmartHomeDeviceMapping.put(id, smartHomeBaseDevice);\n+                    }\n+                }\n+            }\n+            jsonIdSmartHomeDeviceMapping.clear();\n+            jsonIdSmartHomeDeviceMapping.putAll(newJsonIdSmartHomeDeviceMapping);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9596b49de93355da60e75d6284c239b5192e958f"}, "originalPosition": 379}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTE0NjAzNQ==", "bodyText": "Is this code incomplete? It doesn't look like it does anything.", "url": "https://github.com/openhab/openhab-addons/pull/7969#discussion_r445146035", "createdAt": "2020-06-24T20:16:00Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.amazonechocontrol/src/main/java/org/openhab/binding/amazonechocontrol/internal/handler/AccountHandler.java", "diffHunk": "@@ -800,4 +862,187 @@ private void handlePushActivity(@Nullable String payload) {\n     void refreshAfterCommand() {\n         refreshData();\n     }\n+\n+    private @Nullable SmartHomeBaseDevice findSmartDeviceHomeJson(SmartHomeDeviceHandler handler) {\n+        String id = handler.findId();\n+        if (!id.isEmpty()) {\n+            return jsonIdSmartHomeDeviceMapping.get(id);\n+        }\n+        return null;\n+    }\n+\n+    public int shouldDiscoverSmartHomeDevices() {\n+        Configuration config = getThing().getConfiguration();\n+        Object discoverSmartHomeConfig = config.getProperties().get(\"discoverSmartHome\");\n+        int discoverSmartHome = 0;\n+        if (discoverSmartHomeConfig instanceof Boolean) {\n+            discoverSmartHome = ((boolean) discoverSmartHomeConfig) ? 2 : 0;\n+        }\n+        if (discoverSmartHomeConfig instanceof BigDecimal) {\n+            discoverSmartHome = ((BigDecimal) discoverSmartHomeConfig).intValue();\n+        }\n+        return discoverSmartHome;\n+    }\n+\n+    public boolean shouldDiscoverOpenHABSmartHomeDevices() {\n+        Configuration config = getThing().getConfiguration();\n+        Boolean discoverOpenHabSmartHomeDevices = (Boolean) config.getProperties()\n+                .get(\"discoverOpenHabSmartHomeDevices\");\n+        if (discoverOpenHabSmartHomeDevices == null) {\n+            return false;\n+        }\n+        return discoverOpenHabSmartHomeDevices;\n+    }\n+\n+    public List<SmartHomeBaseDevice> updateSmartHomeDeviceList(boolean forceUpdate) {\n+        Connection currentConnection = connection;\n+        if (currentConnection == null) {\n+            return Collections.emptyList();\n+        }\n+\n+        if (!forceUpdate && this.smartHomeDeviceHandlers.isEmpty() && shouldDiscoverSmartHomeDevices() == 0) {\n+            return Collections.emptyList();\n+        }\n+\n+        List<SmartHomeBaseDevice> smartHomeDevices = null;\n+        try {\n+            if (currentConnection.getIsLoggedIn()) {\n+                smartHomeDevices = currentConnection.getSmarthomeDeviceList();\n+            }\n+        } catch (IOException | URISyntaxException e) {\n+            updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR, e.getLocalizedMessage());\n+        }\n+        if (smartHomeDevices != null) {\n+            // create new id map\n+            Map<String, SmartHomeBaseDevice> newJsonIdSmartHomeDeviceMapping = new HashMap<>();\n+            for (Object smartHomeDevice : smartHomeDevices) {\n+                if (smartHomeDevice instanceof SmartHomeBaseDevice) {\n+                    SmartHomeBaseDevice smartHomeBaseDevice = (SmartHomeBaseDevice) smartHomeDevice;\n+                    String id = smartHomeBaseDevice.findId();\n+                    if (id != null) {\n+                        newJsonIdSmartHomeDeviceMapping.put(id, smartHomeBaseDevice);\n+                    }\n+                }\n+            }\n+            jsonIdSmartHomeDeviceMapping.clear();\n+            jsonIdSmartHomeDeviceMapping.putAll(newJsonIdSmartHomeDeviceMapping);\n+        }\n+        // update handlers\n+        synchronized (smartHomeDeviceHandlers) {\n+            smartHomeDeviceHandlers\n+                    .forEach(child -> child.setDeviceAndUpdateThingState(this, findSmartDeviceHomeJson(child)));\n+        }\n+\n+        if (smartHomeDevices != null) {\n+            Map<String, SmartHomeDevice> newJsonSerialDeviceMapping = new HashMap<>();\n+            for (Object smartDevice : smartHomeDevices) {\n+                if (smartDevice instanceof SmartHomeDevice) {\n+                    SmartHomeDevice shd = (SmartHomeDevice) smartDevice;\n+                    String entityId = shd.entityId;\n+                    if (entityId != null) {\n+                        newJsonSerialDeviceMapping.put(entityId, shd);\n+                    }\n+                }\n+            }\n+        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9596b49de93355da60e75d6284c239b5192e958f"}, "originalPosition": 398}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTE0ODA5NQ==", "bodyText": "Perhaps you should increase/decrease by more than just a single percent. A change of a single percent is probably unnoticeable to the user so I think 10% is probably a better value.", "url": "https://github.com/openhab/openhab-addons/pull/7969#discussion_r445148095", "createdAt": "2020-06-24T20:20:03Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.amazonechocontrol/src/main/java/org/openhab/binding/amazonechocontrol/internal/smarthome/HandlerPercentageController.java", "diffHunk": "@@ -0,0 +1,143 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.amazonechocontrol.internal.smarthome;\n+\n+import static org.openhab.binding.amazonechocontrol.internal.smarthome.Constants.ITEM_TYPE_DIMMER;\n+\n+import java.io.IOException;\n+import java.util.List;\n+import java.util.Locale;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.library.types.IncreaseDecreaseType;\n+import org.eclipse.smarthome.core.library.types.OnOffType;\n+import org.eclipse.smarthome.core.library.types.PercentType;\n+import org.eclipse.smarthome.core.thing.type.ChannelTypeUID;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.StateDescription;\n+import org.eclipse.smarthome.core.types.UnDefType;\n+import org.openhab.binding.amazonechocontrol.internal.AmazonEchoControlBindingConstants;\n+import org.openhab.binding.amazonechocontrol.internal.Connection;\n+import org.openhab.binding.amazonechocontrol.internal.jsons.JsonSmartHomeCapabilities.SmartHomeCapability;\n+import org.openhab.binding.amazonechocontrol.internal.jsons.JsonSmartHomeDevices.SmartHomeDevice;\n+\n+import com.google.gson.JsonObject;\n+\n+/**\n+ * The {@link HandlerPercentageController} is responsible for the Alexa.PowerControllerInterface\n+ *\n+ * @author Lukas Knoeller - Initial contribution\n+ * @author Michael Geramb - Initial contribution\n+ */\n+@NonNullByDefault\n+public class HandlerPercentageController extends HandlerBase {\n+    // Interface\n+    public static final String INTERFACE = \"Alexa.PercentageController\";\n+\n+    // Channel types\n+    private static final ChannelTypeUID CHANNEL_TYPE_PERCENTAGE = new ChannelTypeUID(\n+            AmazonEchoControlBindingConstants.BINDING_ID, \"percentage\");\n+\n+    // Channel definitions\n+    private static final ChannelInfo PERCENTAGE = new ChannelInfo(\"percentage\" /* propertyName */ ,\n+            \"percentage\" /* ChannelId */, CHANNEL_TYPE_PERCENTAGE /* Channel Type */ ,\n+            ITEM_TYPE_DIMMER /* Item Type */);\n+\n+    private @Nullable Integer lastPercentage;\n+\n+    @Override\n+    public String[] getSupportedInterface() {\n+        return new String[] { INTERFACE };\n+    }\n+\n+    @Override\n+    protected ChannelInfo @Nullable [] findChannelInfos(SmartHomeCapability capability, String property) {\n+        if (PERCENTAGE.propertyName.equals(property)) {\n+            return new ChannelInfo[] { PERCENTAGE };\n+        }\n+        return null;\n+    }\n+\n+    @Override\n+    public void updateChannels(String interfaceName, List<JsonObject> stateList, UpdateChannelResult result) {\n+        Integer percentageValue = null;\n+        for (JsonObject state : stateList) {\n+            if (PERCENTAGE.propertyName.equals(state.get(\"name\").getAsString())) {\n+                int value = state.get(\"value\").getAsInt();\n+                // For groups take the maximum\n+                if (percentageValue == null) {\n+                    percentageValue = value;\n+                } else if (value > percentageValue) {\n+                    percentageValue = value;\n+                }\n+            }\n+        }\n+        if (percentageValue != null) {\n+            lastPercentage = percentageValue;\n+        }\n+        updateState(PERCENTAGE.channelId, percentageValue == null ? UnDefType.UNDEF : new PercentType(percentageValue));\n+    }\n+\n+    @Override\n+    public boolean handleCommand(Connection connection, SmartHomeDevice shd, String entityId,\n+            SmartHomeCapability[] capabilties, String channelId, Command command) throws IOException {\n+        if (channelId.equals(PERCENTAGE.channelId)) {\n+            if (containsCapabilityProperty(capabilties, PERCENTAGE.propertyName)) {\n+                if (command.equals(IncreaseDecreaseType.INCREASE)) {\n+                    Integer lastPercentage = this.lastPercentage;\n+                    if (lastPercentage != null) {\n+                        int newValue = lastPercentage++;\n+                        if (newValue > 100) {\n+                            newValue = 100;\n+                        }\n+                        this.lastPercentage = newValue;\n+                        connection.smartHomeCommand(entityId, \"setPercentage\", PERCENTAGE.propertyName, newValue);\n+                        return true;\n+                    }\n+                } else if (command.equals(IncreaseDecreaseType.DECREASE)) {\n+                    Integer lastPercentage = this.lastPercentage;\n+                    if (lastPercentage != null) {\n+                        int newValue = lastPercentage--;\n+                        if (newValue < 0) {\n+                            newValue = 0;\n+                        }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9596b49de93355da60e75d6284c239b5192e958f"}, "originalPosition": 114}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTE0OTQyNQ==", "bodyText": "All of other methods suggest that setPercentage is supposed to range from 0-100, not 0-1. Is it supposed to be this instead?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                connection.smartHomeCommand(entityId, \"setPercentage\", PERCENTAGE.propertyName,\n          \n          \n            \n                                        ((PercentType) command).floatValue() / 100);\n          \n          \n            \n                                connection.smartHomeCommand(entityId, \"setPercentage\", PERCENTAGE.propertyName,\n          \n          \n            \n                                        lastPercentage);", "url": "https://github.com/openhab/openhab-addons/pull/7969#discussion_r445149425", "createdAt": "2020-06-24T20:22:34Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.amazonechocontrol/src/main/java/org/openhab/binding/amazonechocontrol/internal/smarthome/HandlerPercentageController.java", "diffHunk": "@@ -0,0 +1,143 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.amazonechocontrol.internal.smarthome;\n+\n+import static org.openhab.binding.amazonechocontrol.internal.smarthome.Constants.ITEM_TYPE_DIMMER;\n+\n+import java.io.IOException;\n+import java.util.List;\n+import java.util.Locale;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.eclipse.smarthome.core.library.types.IncreaseDecreaseType;\n+import org.eclipse.smarthome.core.library.types.OnOffType;\n+import org.eclipse.smarthome.core.library.types.PercentType;\n+import org.eclipse.smarthome.core.thing.type.ChannelTypeUID;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.eclipse.smarthome.core.types.StateDescription;\n+import org.eclipse.smarthome.core.types.UnDefType;\n+import org.openhab.binding.amazonechocontrol.internal.AmazonEchoControlBindingConstants;\n+import org.openhab.binding.amazonechocontrol.internal.Connection;\n+import org.openhab.binding.amazonechocontrol.internal.jsons.JsonSmartHomeCapabilities.SmartHomeCapability;\n+import org.openhab.binding.amazonechocontrol.internal.jsons.JsonSmartHomeDevices.SmartHomeDevice;\n+\n+import com.google.gson.JsonObject;\n+\n+/**\n+ * The {@link HandlerPercentageController} is responsible for the Alexa.PowerControllerInterface\n+ *\n+ * @author Lukas Knoeller - Initial contribution\n+ * @author Michael Geramb - Initial contribution\n+ */\n+@NonNullByDefault\n+public class HandlerPercentageController extends HandlerBase {\n+    // Interface\n+    public static final String INTERFACE = \"Alexa.PercentageController\";\n+\n+    // Channel types\n+    private static final ChannelTypeUID CHANNEL_TYPE_PERCENTAGE = new ChannelTypeUID(\n+            AmazonEchoControlBindingConstants.BINDING_ID, \"percentage\");\n+\n+    // Channel definitions\n+    private static final ChannelInfo PERCENTAGE = new ChannelInfo(\"percentage\" /* propertyName */ ,\n+            \"percentage\" /* ChannelId */, CHANNEL_TYPE_PERCENTAGE /* Channel Type */ ,\n+            ITEM_TYPE_DIMMER /* Item Type */);\n+\n+    private @Nullable Integer lastPercentage;\n+\n+    @Override\n+    public String[] getSupportedInterface() {\n+        return new String[] { INTERFACE };\n+    }\n+\n+    @Override\n+    protected ChannelInfo @Nullable [] findChannelInfos(SmartHomeCapability capability, String property) {\n+        if (PERCENTAGE.propertyName.equals(property)) {\n+            return new ChannelInfo[] { PERCENTAGE };\n+        }\n+        return null;\n+    }\n+\n+    @Override\n+    public void updateChannels(String interfaceName, List<JsonObject> stateList, UpdateChannelResult result) {\n+        Integer percentageValue = null;\n+        for (JsonObject state : stateList) {\n+            if (PERCENTAGE.propertyName.equals(state.get(\"name\").getAsString())) {\n+                int value = state.get(\"value\").getAsInt();\n+                // For groups take the maximum\n+                if (percentageValue == null) {\n+                    percentageValue = value;\n+                } else if (value > percentageValue) {\n+                    percentageValue = value;\n+                }\n+            }\n+        }\n+        if (percentageValue != null) {\n+            lastPercentage = percentageValue;\n+        }\n+        updateState(PERCENTAGE.channelId, percentageValue == null ? UnDefType.UNDEF : new PercentType(percentageValue));\n+    }\n+\n+    @Override\n+    public boolean handleCommand(Connection connection, SmartHomeDevice shd, String entityId,\n+            SmartHomeCapability[] capabilties, String channelId, Command command) throws IOException {\n+        if (channelId.equals(PERCENTAGE.channelId)) {\n+            if (containsCapabilityProperty(capabilties, PERCENTAGE.propertyName)) {\n+                if (command.equals(IncreaseDecreaseType.INCREASE)) {\n+                    Integer lastPercentage = this.lastPercentage;\n+                    if (lastPercentage != null) {\n+                        int newValue = lastPercentage++;\n+                        if (newValue > 100) {\n+                            newValue = 100;\n+                        }\n+                        this.lastPercentage = newValue;\n+                        connection.smartHomeCommand(entityId, \"setPercentage\", PERCENTAGE.propertyName, newValue);\n+                        return true;\n+                    }\n+                } else if (command.equals(IncreaseDecreaseType.DECREASE)) {\n+                    Integer lastPercentage = this.lastPercentage;\n+                    if (lastPercentage != null) {\n+                        int newValue = lastPercentage--;\n+                        if (newValue < 0) {\n+                            newValue = 0;\n+                        }\n+                        this.lastPercentage = newValue;\n+                        connection.smartHomeCommand(entityId, \"setPercentage\", PERCENTAGE.propertyName, newValue);\n+                        return true;\n+                    }\n+                } else if (command.equals(OnOffType.OFF)) {\n+                    lastPercentage = 0;\n+                    connection.smartHomeCommand(entityId, \"setPercentage\", PERCENTAGE.propertyName, 0);\n+                    return true;\n+                } else if (command.equals(OnOffType.ON)) {\n+                    lastPercentage = 100;\n+                    connection.smartHomeCommand(entityId, \"setPercentage\", PERCENTAGE.propertyName, 100);\n+                    return true;\n+                } else if (command instanceof PercentType) {\n+                    lastPercentage = ((PercentType) command).intValue();\n+                    connection.smartHomeCommand(entityId, \"setPercentage\", PERCENTAGE.propertyName,\n+                            ((PercentType) command).floatValue() / 100);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9596b49de93355da60e75d6284c239b5192e958f"}, "originalPosition": 130}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3MTM0MDIy", "url": "https://github.com/openhab/openhab-addons/pull/7969#pullrequestreview-437134022", "createdAt": "2020-06-25T02:50:36Z", "commit": {"oid": "6ded87597331cfd222f3ea203480a4c2f31ae440"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQwMjo1MDozNlrOGoppHw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0yNVQwMjo1OTozMFrOGopxFg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTI3ODQ5NQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Unfortunately, the binding can get broken if Amazon change the web site.\n          \n          \n            \n            Unfortunately, this binding can break if Amazon changes the web site.", "url": "https://github.com/openhab/openhab-addons/pull/7969#discussion_r445278495", "createdAt": "2020-06-25T02:50:36Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.amazonechocontrol/README.md", "diffHunk": "@@ -463,6 +680,23 @@ then\n end\n ```\n \n+## Advanced Feature Technically Experienced Users\n+\n+The url <YOUR_OPENHAB>/amazonechocontrol/<YOUR_ACCOUNT>/PROXY/<API_URL> provides a proxy server with an authenticated connection to the Amazon Alexa server.\n+This can be used to call Alexa API from rules.\n+\n+E.g. to read out the history call from an installation on openhab:8080 with an account named account1:\n+\n+http://openhab:8080/amazonechocontrol/account1/PROXY/api/activities?startTime=&size=50&offset=1\n+\n+## Note\n+\n+This binding uses the same API as the Web-Browser-Based Alexa site (alexa.amazon.de).\n+In other words, it simulates a user which is using the web page.\n+Unfortunately, the binding can get broken if Amazon change the web site.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6ded87597331cfd222f3ea203480a4c2f31ae440"}, "originalPosition": 438}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTI3OTMxMw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            Take a look in the channel description above to know, which channels are supported by your thing type.\n          \n          \n            \n            Take a look in the channel description above to know which channels are supported by your thing type.", "url": "https://github.com/openhab/openhab-addons/pull/7969#discussion_r445279313", "createdAt": "2020-06-25T02:54:08Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.amazonechocontrol/README.md", "diffHunk": "@@ -314,13 +423,119 @@ sitemap amazonechocontrol label=\"Echo Devices\"\n }\n ```\n \n+## Smart Home Devices\n+\n+Note: the cannels of smartHomeDevices and smartHomeDeviceGroup will be created dynamically based on the capabilities reported by the amazon server. This can take a little bit of time. \n+The polling interval configured in the Account Thing to get the state is specified in minutes and has a minimum of 10. This means it takes up to 10 minutes to see the state of a channel. The reason for this low interval is, that the polling causes a big server load for the Smart Home Skills.\n+\n+#### Supported Things\n+\n+| Thing type id        | Name                                  |\n+|----------------------|---------------------------------------|\n+| smartHomeDevice      | Smart Home Device                     |\n+| smartHomeDeviceGroup | Smart Home Device group               |\n+\n+\n+#### Thing configuration of smartHomeDevice, smartHomeDeviceGroup\n+\n+| Configuration name       | Description                                                               |\n+|--------------------------|---------------------------------------------------------------------------|\n+| id                       | The id of the device or device group                                      |\n+\n+The only possibility to find out the id is by using the discover function in the PaperUI. You can use then the id, if you want define the Thing in a file.\n+\n+#### Channels\n+\n+The channels of the smarthome devices will be generated at runtime. Check in the paperUI thing configurations, which channels are created.\n+\n+| Channel Type ID          | Item Type | Access Mode | Thing Type                    | Description                                                                                                                                                                \n+|--------------------------|-----------|-------------|-------------------------------|------------------------------------------------------------------------------------------\n+| powerState               | Switch    | R/W         | smartHomeDevice, smartHomeDeviceGroup | Shows and changes the state (ON/OFF) of your device\n+| brightness               | Dimmer    | R/W         | smartHomeDevice, smartHomeDeviceGroup | Shows and changes the brightness of your lamp\n+| color                    | Color     | R           | smartHomeDevice, smartHomeDeviceGroup | Shows the color of your light\n+| colorName                | String    | R/W         | smartHomeDevice, smartHomeDeviceGroup | Shows and changes the color name of your light (groups are not able to show their color)\n+| colorTemperatureName     | String    | R/W         | smartHomeDevice, smartHomeDeviceGroup | White temperatures name of your lights (groups are not able to show their color)\n+| armState                 | String    | R/W         | smartHomeDevice, smartHomeDeviceGroup | State of your alarm guard. Options: ARMED_AWAY, ARMED_STAY, ARMED_NIGHT, DISARMED (groups are not able to show their state)\n+| burglaryAlarm            | Contact   | R           | smartHomeDevice | Burglary alarm\n+| carbonMonoxideAlarm      | Contact   | R           | smartHomeDevice | Carbon monoxide detection alarm\n+| fireAlarm                | Contact   | R           | smartHomeDevice | Fire alarm\n+| waterAlarm               | Contact   | R           | smartHomeDevice | Water alarm\n+| glassBreakDetectionState | Contact   | R           | smartHomeDevice | Glas break detection alarm\n+| smokeAlarmDetectionState | Contact   | R           | smartHomeDevice | Smoke detection alarm\n+| temperature              | Number    | R           | smartHomeDevice | Temperature\n+\n+### Example\n+\n+#### smarthome.things\n+\n+```\n+Bridge amazonechocontrol:account:account1 \"Amazon Account\" @ \"Accounts\" [discoverSmartHome=2, pollingIntervalSmartHomeAlexa=30, pollingIntervalSmartSkills=120]\n+{\n+    Thing smartHomeDevice      smartHomeDevice1 \"Smart Home Device 1\" @ \"Living Room\" [id=\"ID\"]\n+    Thing smartHomeDevice      smartHomeDevice2 \"Smart Home Device 2\" @ \"Living Room\" [id=\"ID\"]\n+    Thing smartHomeDevice      smartHomeDevice3 \"Smart Home Device 3\" @ \"Living Room\" [id=\"ID\"]\n+    Thing smartHomeDeviceGroup smartHomeDeviceGroup1 \"Living Room Group\" @   \"Living Room\" [id=\"ID\"]\n+}\n+```\n+\n+#### smarthome.items:\n+\n+Sample for the Thing echo1 only. But it will work in the same way for the other things, only replace the thing name in the channel link.\n+Take a look in the channel description above to know, which channels are supported by your thing type.", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6ded87597331cfd222f3ea203480a4c2f31ae440"}, "originalPosition": 347}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTI3OTM4OQ==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            | glassBreakDetectionState | Contact   | R           | smartHomeDevice | Glas break detection alarm\n          \n          \n            \n            | glassBreakDetectionState | Contact   | R           | smartHomeDevice | Glass break detection alarm", "url": "https://github.com/openhab/openhab-addons/pull/7969#discussion_r445279389", "createdAt": "2020-06-25T02:54:30Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.amazonechocontrol/README.md", "diffHunk": "@@ -314,13 +423,119 @@ sitemap amazonechocontrol label=\"Echo Devices\"\n }\n ```\n \n+## Smart Home Devices\n+\n+Note: the cannels of smartHomeDevices and smartHomeDeviceGroup will be created dynamically based on the capabilities reported by the amazon server. This can take a little bit of time. \n+The polling interval configured in the Account Thing to get the state is specified in minutes and has a minimum of 10. This means it takes up to 10 minutes to see the state of a channel. The reason for this low interval is, that the polling causes a big server load for the Smart Home Skills.\n+\n+#### Supported Things\n+\n+| Thing type id        | Name                                  |\n+|----------------------|---------------------------------------|\n+| smartHomeDevice      | Smart Home Device                     |\n+| smartHomeDeviceGroup | Smart Home Device group               |\n+\n+\n+#### Thing configuration of smartHomeDevice, smartHomeDeviceGroup\n+\n+| Configuration name       | Description                                                               |\n+|--------------------------|---------------------------------------------------------------------------|\n+| id                       | The id of the device or device group                                      |\n+\n+The only possibility to find out the id is by using the discover function in the PaperUI. You can use then the id, if you want define the Thing in a file.\n+\n+#### Channels\n+\n+The channels of the smarthome devices will be generated at runtime. Check in the paperUI thing configurations, which channels are created.\n+\n+| Channel Type ID          | Item Type | Access Mode | Thing Type                    | Description                                                                                                                                                                \n+|--------------------------|-----------|-------------|-------------------------------|------------------------------------------------------------------------------------------\n+| powerState               | Switch    | R/W         | smartHomeDevice, smartHomeDeviceGroup | Shows and changes the state (ON/OFF) of your device\n+| brightness               | Dimmer    | R/W         | smartHomeDevice, smartHomeDeviceGroup | Shows and changes the brightness of your lamp\n+| color                    | Color     | R           | smartHomeDevice, smartHomeDeviceGroup | Shows the color of your light\n+| colorName                | String    | R/W         | smartHomeDevice, smartHomeDeviceGroup | Shows and changes the color name of your light (groups are not able to show their color)\n+| colorTemperatureName     | String    | R/W         | smartHomeDevice, smartHomeDeviceGroup | White temperatures name of your lights (groups are not able to show their color)\n+| armState                 | String    | R/W         | smartHomeDevice, smartHomeDeviceGroup | State of your alarm guard. Options: ARMED_AWAY, ARMED_STAY, ARMED_NIGHT, DISARMED (groups are not able to show their state)\n+| burglaryAlarm            | Contact   | R           | smartHomeDevice | Burglary alarm\n+| carbonMonoxideAlarm      | Contact   | R           | smartHomeDevice | Carbon monoxide detection alarm\n+| fireAlarm                | Contact   | R           | smartHomeDevice | Fire alarm\n+| waterAlarm               | Contact   | R           | smartHomeDevice | Water alarm\n+| glassBreakDetectionState | Contact   | R           | smartHomeDevice | Glas break detection alarm", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6ded87597331cfd222f3ea203480a4c2f31ae440"}, "originalPosition": 326}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTI3OTkzMg==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\t<parameter name=\"pollingIntervalSmartHomeAlexa\" type=\"decimal\" min=\"10\">\n          \n          \n            \n            \t\t\t<parameter name=\"pollingIntervalSmartHomeAlexa\" type=\"decimal\" min=\"10\" unit=\"s\">", "url": "https://github.com/openhab/openhab-addons/pull/7969#discussion_r445279932", "createdAt": "2020-06-25T02:56:49Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.amazonechocontrol/src/main/resources/ESH-INF/thing/thing-types.xml", "diffHunk": "@@ -1,471 +1,531 @@\n-<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n-<thing:thing-descriptions xmlns:thing=\"https://openhab.org/schemas/thing-description/v1.0.0\"\n-\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" bindingId=\"amazonechocontrol\"\n-\txsi:schemaLocation=\"https://openhab.org/schemas/thing-description/v1.0.0 https://openhab.org/schemas/thing-description-1.0.0.xsd\">\n-\t<bridge-type id=\"account\">\n-\t\t<label>Amazon Account</label>\n-\t\t<description>Amazon Account where the amazon echo devices are registered.</description>\n-\t\t<channels>\n-\t\t\t<channel id=\"sendMessage\" typeId=\"sendMessage\"/>\n-\t\t</channels>\n-\t</bridge-type>\n-\t<thing-type id=\"echo\">\n-\t\t<supported-bridge-type-refs>\n-\t\t\t<bridge-type-ref id=\"account\"/>\n-\t\t</supported-bridge-type-refs>\n-\t\t<label>Amazon Echo</label>\n-\t\t<description>Amazon Echo device (Amazon Echo, Amazon Echo Dot, Amazon Echo Plus...)</description>\n-\t\t<channels>\n-\t\t\t<channel id=\"player\" typeId=\"player\"/>\n-\t\t\t<channel id=\"mediaProgress\" typeId=\"mediaProgress\"/>\n-\t\t\t<channel id=\"mediaProgressTime\" typeId=\"mediaProgressTime\"/>\n-\t\t\t<channel id=\"mediaLength\" typeId=\"mediaLength\"/>\n-\t\t\t<channel id=\"volume\" typeId=\"volume\"/>\n-\t\t\t<channel id=\"equalizerTreble\" typeId=\"equalizerTreble\"/>\n-\t\t\t<channel id=\"equalizerMidrange\" typeId=\"equalizerMidrange\"/>\n-\t\t\t<channel id=\"equalizerBass\" typeId=\"equalizerBass\"/>\n-\t\t\t<channel id=\"shuffle\" typeId=\"shuffle\"/>\n-\t\t\t<channel id=\"imageUrl\" typeId=\"imageUrl\"/>\n-\t\t\t<channel id=\"title\" typeId=\"title\"/>\n-\t\t\t<channel id=\"subtitle1\" typeId=\"subtitle1\"/>\n-\t\t\t<channel id=\"subtitle2\" typeId=\"subtitle2\"/>\n-\t\t\t<channel id=\"providerDisplayName\" typeId=\"providerDisplayName\"/>\n-\t\t\t<channel id=\"musicProviderId\" typeId=\"musicProviderId\"/>\n-\t\t\t<channel id=\"playMusicVoiceCommand\" typeId=\"playMusicVoiceCommand\"/>\n-\t\t\t<channel id=\"startCommand\" typeId=\"startCommand\"/>\n-\t\t\t<channel id=\"radioStationId\" typeId=\"radioStationId\"/>\n-\t\t\t<channel id=\"radio\" typeId=\"radio\"/>\n-\t\t\t<channel id=\"amazonMusicTrackId\" typeId=\"amazonMusicTrackId\"/>\n-\t\t\t<channel id=\"amazonMusicPlayListId\" typeId=\"amazonMusicPlayListId\"/>\n-\t\t\t<channel id=\"amazonMusic\" typeId=\"amazonMusic\"/>\n-\t\t\t<channel id=\"announcement\" typeId=\"announcement\"/>\n-\t\t\t<channel id=\"textToSpeech\" typeId=\"textToSpeech\"/>\n-\t\t\t<channel id=\"textToSpeechVolume\" typeId=\"textToSpeechVolume\"/>\n-\t\t\t<channel id=\"remind\" typeId=\"remind\"/>\n-\t\t\t<channel id=\"nextReminder\" typeId=\"nextReminder\"/>\n-\t\t\t<channel id=\"playAlarmSound\" typeId=\"playAlarmSound\"/>\n-\t\t\t<channel id=\"nextAlarm\" typeId=\"nextAlarm\"/>\n-\t\t\t<channel id=\"nextMusicAlarm\" typeId=\"nextMusicAlarm\"/>\n-\t\t\t<channel id=\"nextTimer\" typeId=\"nextTimer\"/>\n-\t\t\t<channel id=\"startRoutine\" typeId=\"startRoutine\"/>\n-\t\t\t<channel id=\"bluetoothMAC\" typeId=\"bluetoothMAC\"/>\n-\t\t\t<channel id=\"bluetooth\" typeId=\"bluetooth\"/>\n-\t\t\t<channel id=\"bluetoothDeviceName\" typeId=\"bluetoothDeviceName\"/>\n-\t\t\t<channel id=\"lastVoiceCommand\" typeId=\"lastVoiceCommand\"/>\n-\t\t\t<channel id=\"notificationVolume\" typeId=\"notificationVolume\"/>\n-\t\t\t<channel id=\"ascendingAlarm\" typeId=\"ascendingAlarm\"/>\n-\t\t</channels>\n-\t\t<representation-property>serialNumber</representation-property>\n-\t\t<config-description>\n-\t\t\t<parameter name=\"serialNumber\" type=\"text\" required=\"true\">\n-\t\t\t\t<label>Serial Number</label>\n-\t\t\t\t<description>The serial number of the device from the Alexa app</description>\n-\t\t\t</parameter>\n-\t\t</config-description>\n-\t</thing-type>\n-\t<thing-type id=\"echospot\">\n-\t\t<supported-bridge-type-refs>\n-\t\t\t<bridge-type-ref id=\"account\"/>\n-\t\t</supported-bridge-type-refs>\n-\t\t<label>Amazon Echo Spot</label>\n-\t\t<description>Amazon Echo Spot device</description>\n-\t\t<channels>\n-\t\t\t<channel id=\"player\" typeId=\"player\"/>\n-\t\t\t<channel id=\"mediaProgress\" typeId=\"mediaProgress\"/>\n-\t\t\t<channel id=\"mediaProgressTime\" typeId=\"mediaProgressTime\"/>\n-\t\t\t<channel id=\"mediaLength\" typeId=\"mediaLength\"/>\n-\t\t\t<channel id=\"volume\" typeId=\"volume\"/>\n-\t\t\t<channel id=\"equalizerTreble\" typeId=\"equalizerTreble\"/>\n-\t\t\t<channel id=\"equalizerMidrange\" typeId=\"equalizerMidrange\"/>\n-\t\t\t<channel id=\"equalizerBass\" typeId=\"equalizerBass\"/>\n-\t\t\t<channel id=\"shuffle\" typeId=\"shuffle\"/>\n-\t\t\t<channel id=\"imageUrl\" typeId=\"imageUrl\"/>\n-\t\t\t<channel id=\"title\" typeId=\"title\"/>\n-\t\t\t<channel id=\"subtitle1\" typeId=\"subtitle1\"/>\n-\t\t\t<channel id=\"subtitle2\" typeId=\"subtitle2\"/>\n-\t\t\t<channel id=\"providerDisplayName\" typeId=\"providerDisplayName\"/>\n-\t\t\t<channel id=\"musicProviderId\" typeId=\"musicProviderId\"/>\n-\t\t\t<channel id=\"playMusicVoiceCommand\" typeId=\"playMusicVoiceCommand\"/>\n-\t\t\t<channel id=\"startCommand\" typeId=\"startCommand\"/>\n-\t\t\t<channel id=\"radioStationId\" typeId=\"radioStationId\"/>\n-\t\t\t<channel id=\"radio\" typeId=\"radio\"/>\n-\t\t\t<channel id=\"amazonMusicTrackId\" typeId=\"amazonMusicTrackId\"/>\n-\t\t\t<channel id=\"amazonMusicPlayListId\" typeId=\"amazonMusicPlayListId\"/>\n-\t\t\t<channel id=\"amazonMusic\" typeId=\"amazonMusic\"/>\n-\t\t\t<channel id=\"announcement\" typeId=\"announcement\"/>\n-\t\t\t<channel id=\"textToSpeech\" typeId=\"textToSpeech\"/>\n-\t\t\t<channel id=\"textToSpeechVolume\" typeId=\"textToSpeechVolume\"/>\n-\t\t\t<channel id=\"remind\" typeId=\"remind\"/>\n-\t\t\t<channel id=\"nextReminder\" typeId=\"nextReminder\"/>\n-\t\t\t<channel id=\"playAlarmSound\" typeId=\"playAlarmSound\"/>\n-\t\t\t<channel id=\"nextAlarm\" typeId=\"nextAlarm\"/>\n-\t\t\t<channel id=\"nextMusicAlarm\" typeId=\"nextMusicAlarm\"/>\n-\t\t\t<channel id=\"nextTimer\" typeId=\"nextTimer\"/>\n-\t\t\t<channel id=\"startRoutine\" typeId=\"startRoutine\"/>\n-\t\t\t<channel id=\"bluetoothMAC\" typeId=\"bluetoothMAC\"/>\n-\t\t\t<channel id=\"bluetooth\" typeId=\"bluetooth\"/>\n-\t\t\t<channel id=\"bluetoothDeviceName\" typeId=\"bluetoothDeviceName\"/>\n-\t\t\t<channel id=\"lastVoiceCommand\" typeId=\"lastVoiceCommand\"/>\n-\t\t\t<channel id=\"notificationVolume\" typeId=\"notificationVolume\"/>\n-\t\t\t<channel id=\"ascendingAlarm\" typeId=\"ascendingAlarm\"/>\n-\t\t</channels>\n-\t\t<representation-property>serialNumber</representation-property>\n-\t\t<config-description>\n-\t\t\t<parameter name=\"serialNumber\" type=\"text\" required=\"true\">\n-\t\t\t\t<label>Serial Number</label>\n-\t\t\t\t<description>The serial number of the device from the Alexa app</description>\n-\t\t\t</parameter>\n-\t\t</config-description>\n-\t</thing-type>\n-\t<thing-type id=\"echoshow\">\n-\t\t<supported-bridge-type-refs>\n-\t\t\t<bridge-type-ref id=\"account\"/>\n-\t\t</supported-bridge-type-refs>\n-\t\t<label>Amazon Echo Show</label>\n-\t\t<description>Amazon Echo Show device</description>\n-\t\t<channels>\n-\t\t\t<channel id=\"player\" typeId=\"player\"/>\n-\t\t\t<channel id=\"mediaProgress\" typeId=\"mediaProgress\"/>\n-\t\t\t<channel id=\"mediaProgressTime\" typeId=\"mediaProgressTime\"/>\n-\t\t\t<channel id=\"mediaLength\" typeId=\"mediaLength\"/>\n-\t\t\t<channel id=\"volume\" typeId=\"volume\"/>\n-\t\t\t<channel id=\"equalizerTreble\" typeId=\"equalizerTreble\"/>\n-\t\t\t<channel id=\"equalizerMidrange\" typeId=\"equalizerMidrange\"/>\n-\t\t\t<channel id=\"equalizerBass\" typeId=\"equalizerBass\"/>\n-\t\t\t<channel id=\"shuffle\" typeId=\"shuffle\"/>\n-\t\t\t<channel id=\"imageUrl\" typeId=\"imageUrl\"/>\n-\t\t\t<channel id=\"title\" typeId=\"title\"/>\n-\t\t\t<channel id=\"subtitle1\" typeId=\"subtitle1\"/>\n-\t\t\t<channel id=\"subtitle2\" typeId=\"subtitle2\"/>\n-\t\t\t<channel id=\"providerDisplayName\" typeId=\"providerDisplayName\"/>\n-\t\t\t<channel id=\"musicProviderId\" typeId=\"musicProviderId\"/>\n-\t\t\t<channel id=\"playMusicVoiceCommand\" typeId=\"playMusicVoiceCommand\"/>\n-\t\t\t<channel id=\"startCommand\" typeId=\"startCommand\"/>\n-\t\t\t<channel id=\"radioStationId\" typeId=\"radioStationId\"/>\n-\t\t\t<channel id=\"radio\" typeId=\"radio\"/>\n-\t\t\t<channel id=\"amazonMusicTrackId\" typeId=\"amazonMusicTrackId\"/>\n-\t\t\t<channel id=\"amazonMusicPlayListId\" typeId=\"amazonMusicPlayListId\"/>\n-\t\t\t<channel id=\"amazonMusic\" typeId=\"amazonMusic\"/>\n-\t\t\t<channel id=\"announcement\" typeId=\"announcement\"/>\n-\t\t\t<channel id=\"textToSpeech\" typeId=\"textToSpeech\"/>\n-\t\t\t<channel id=\"textToSpeechVolume\" typeId=\"textToSpeechVolume\"/>\n-\t\t\t<channel id=\"remind\" typeId=\"remind\"/>\n-\t\t\t<channel id=\"nextReminder\" typeId=\"nextReminder\"/>\n-\t\t\t<channel id=\"playAlarmSound\" typeId=\"playAlarmSound\"/>\n-\t\t\t<channel id=\"nextAlarm\" typeId=\"nextAlarm\"/>\n-\t\t\t<channel id=\"nextMusicAlarm\" typeId=\"nextMusicAlarm\"/>\n-\t\t\t<channel id=\"nextTimer\" typeId=\"nextTimer\"/>\n-\t\t\t<channel id=\"startRoutine\" typeId=\"startRoutine\"/>\n-\t\t\t<channel id=\"bluetoothMAC\" typeId=\"bluetoothMAC\"/>\n-\t\t\t<channel id=\"bluetooth\" typeId=\"bluetooth\"/>\n-\t\t\t<channel id=\"bluetoothDeviceName\" typeId=\"bluetoothDeviceName\"/>\n-\t\t\t<channel id=\"lastVoiceCommand\" typeId=\"lastVoiceCommand\"/>\n-\t\t\t<channel id=\"notificationVolume\" typeId=\"notificationVolume\"/>\n-\t\t\t<channel id=\"ascendingAlarm\" typeId=\"ascendingAlarm\"/>\n-\t\t</channels>\n-\t\t<representation-property>serialNumber</representation-property>\n-\t\t<config-description>\n-\t\t\t<parameter name=\"serialNumber\" type=\"text\" required=\"true\">\n-\t\t\t\t<label>Serial Number</label>\n-\t\t\t\t<description>The serial number of the device from the Alexa app</description>\n-\t\t\t</parameter>\n-\t\t</config-description>\n-\t</thing-type>\n-\t<thing-type id=\"wha\">\n-\t\t<supported-bridge-type-refs>\n-\t\t\t<bridge-type-ref id=\"account\"/>\n-\t\t</supported-bridge-type-refs>\n-\t\t<label>Amazon Echo Whole House Audio Control</label>\n-\t\t<description>Amazon Multiroom Music</description>\n-\t\t<channels>\n-\t\t\t<channel id=\"player\" typeId=\"player\"/>\n-\t\t\t<channel id=\"mediaProgressTime\" typeId=\"mediaProgressTime\"/>\n-\t\t\t<channel id=\"mediaProgress\" typeId=\"mediaProgress\"/>\n-\t\t\t<channel id=\"mediaLength\" typeId=\"mediaLength\"/>\n-\t\t\t<channel id=\"shuffle\" typeId=\"shuffle\"/>\n-\t\t\t<channel id=\"imageUrl\" typeId=\"imageUrl\"/>\n-\t\t\t<channel id=\"title\" typeId=\"title\"/>\n-\t\t\t<channel id=\"subtitle1\" typeId=\"subtitle1\"/>\n-\t\t\t<channel id=\"subtitle2\" typeId=\"subtitle2\"/>\n-\t\t\t<channel id=\"providerDisplayName\" typeId=\"providerDisplayName\"/>\n-\t\t\t<channel id=\"radioStationId\" typeId=\"radioStationId\"/>\n-\t\t\t<channel id=\"radio\" typeId=\"radio\"/>\n-\t\t\t<channel id=\"amazonMusicTrackId\" typeId=\"amazonMusicTrackId\"/>\n-\t\t\t<channel id=\"amazonMusicPlayListId\" typeId=\"amazonMusicPlayListId\"/>\n-\t\t\t<channel id=\"amazonMusic\" typeId=\"amazonMusic\"/>\n-\t\t</channels>\n-\t\t<representation-property>serialNumber</representation-property>\n-\t\t<config-description>\n-\t\t\t<parameter name=\"serialNumber\" type=\"text\" required=\"true\">\n-\t\t\t\t<label>Serial Number</label>\n-\t\t\t\t<description>The serial number of the device from the Alexa app</description>\n-\t\t\t</parameter>\n-\t\t</config-description>\n-\t</thing-type>\n-\n-\t<thing-type id=\"flashbriefingprofile\">\n-\t\t<supported-bridge-type-refs>\n-\t\t\t<bridge-type-ref id=\"account\"/>\n-\t\t</supported-bridge-type-refs>\n-\t\t<label>Flash Briefing Profile</label>\n-\t\t<description>Store and load a flash briefing configuration</description>\n-\t\t<channels>\n-\t\t\t<channel id=\"save\" typeId=\"save\"/>\n-\t\t\t<channel id=\"active\" typeId=\"active\"/>\n-\t\t\t<channel id=\"playOnDevice\" typeId=\"playOnDevice\"/>\n-\t\t</channels>\n-\t</thing-type>\n-\t<channel-type id=\"save\">\n-\t\t<item-type>Switch</item-type>\n-\t\t<label>Save</label>\n-\t\t<description>Save the current flash briefing configuration (Write only)</description>\n-\t</channel-type>\n-\t<channel-type id=\"active\">\n-\t\t<item-type>Switch</item-type>\n-\t\t<label>Active</label>\n-\t\t<description>Activate this flash briefing configuration</description>\n-\t</channel-type>\n-\t<channel-type id=\"playOnDevice\" advanced=\"true\">\n-\t\t<item-type>String</item-type>\n-\t\t<label>Play On Device</label>\n-\t\t<description>Plays the briefing on the device (serial number or name, write only)</description>\n-\t</channel-type>\n-\t<channel-type id=\"bluetoothDeviceName\" advanced=\"true\">\n-\t\t<item-type>String</item-type>\n-\t\t<label>Bluetooth Device</label>\n-\t\t<description>Connected bluetooth device</description>\n-\t\t<state readOnly=\"true\"/>\n-\t</channel-type>\n-\t<channel-type id=\"radioStationId\" advanced=\"true\">\n-\t\t<item-type>String</item-type>\n-\t\t<label>TuneIn Radio Station Id</label>\n-\t\t<description>Id of the radio station</description>\n-\t</channel-type>\n-\t<channel-type id=\"remind\" advanced=\"true\">\n-\t\t<item-type>String</item-type>\n-\t\t<label>Remind</label>\n-\t\t<description>Speak the reminder and send a notification to the Alexa app</description>\n-\t</channel-type>\n-\t<channel-type id=\"startRoutine\" advanced=\"true\">\n-\t\t<item-type>String</item-type>\n-\t\t<label>Start a Routine</label>\n-\t\t<description>The command which must be spoken to active the routing without the preceding \"Alexa,\" (Write Only)\n-\t\t</description>\n-\t</channel-type>\n-\t<channel-type id=\"playAlarmSound\" advanced=\"true\">\n-\t\t<item-type>String</item-type>\n-\t\t<label>Alarm Sound</label>\n-\t\t<description>Plays an alarm sound</description>\n-\t</channel-type>\n-\t<channel-type id=\"amazonMusicTrackId\" advanced=\"true\">\n-\t\t<item-type>String</item-type>\n-\t\t<label>Amazon Music Track Id</label>\n-\t\t<description>Id of the amazon music track</description>\n-\t</channel-type>\n-\t<channel-type id=\"amazonMusic\" advanced=\"true\">\n-\t\t<item-type>Switch</item-type>\n-\t\t<label>Amazon Music</label>\n-\t\t<description>Amazon Music turned on</description>\n-\t</channel-type>\n-\t<channel-type id=\"amazonMusicPlayListId\" advanced=\"true\">\n-\t\t<item-type>String</item-type>\n-\t\t<label>Amazon Music Play List Id</label>\n-\t\t<description>Amazon Music play list id (Write only, no current state)</description>\n-\t</channel-type>\n-\t<channel-type id=\"amazonMusicPlayListIdLastUsed\" advanced=\"true\">\n-\t\t<item-type>String</item-type>\n-\t\t<label>Amazon Music Last Selected Playlist Id</label>\n-\t\t<description>Id of the playlist which was started with openHAB</description>\n-\t</channel-type>\n-\t<channel-type id=\"providerDisplayName\" advanced=\"true\">\n-\t\t<item-type>String</item-type>\n-\t\t<label>Provider Name</label>\n-\t\t<description>Name of music provider</description>\n-\t\t<state readOnly=\"true\"/>\n-\t</channel-type>\n-\t<channel-type id=\"bluetoothMAC\">\n-\t\t<item-type>String</item-type>\n-\t\t<label>Bluetooth Connection</label>\n-\t\t<description>MAC-Address of the bluetooth connected device</description>\n-\t</channel-type>\n-\t<channel-type id=\"imageUrl\" advanced=\"true\">\n-\t\t<item-type>String</item-type>\n-\t\t<label>Image Url</label>\n-\t\t<description>Url of the album image or radio station logo</description>\n-\t\t<state readOnly=\"true\"/>\n-\t</channel-type>\n-\t<channel-type id=\"title\">\n-\t\t<item-type>String</item-type>\n-\t\t<label>Title</label>\n-\t\t<description>Title</description>\n-\t\t<state readOnly=\"true\"/>\n-\t</channel-type>\n-\t<channel-type id=\"subtitle1\" advanced=\"true\">\n-\t\t<item-type>String</item-type>\n-\t\t<label>Subtitle 1</label>\n-\t\t<description>Subtitle 1</description>\n-\t\t<state readOnly=\"true\"/>\n-\t</channel-type>\n-\t<channel-type id=\"subtitle2\" advanced=\"true\">\n-\t\t<item-type>String</item-type>\n-\t\t<label>Subtitle 2</label>\n-\t\t<description>Subtitle 2</description>\n-\t\t<state readOnly=\"true\"/>\n-\t</channel-type>\n-\t<channel-type id=\"radio\" advanced=\"true\">\n-\t\t<item-type>Switch</item-type>\n-\t\t<label>TuneIn Radio</label>\n-\t\t<description>Radio turned on</description>\n-\t</channel-type>\n-\t<channel-type id=\"bluetooth\" advanced=\"true\">\n-\t\t<item-type>Switch</item-type>\n-\t\t<label>Bluetooth Connection</label>\n-\t\t<description>Connect to last used device</description>\n-\t</channel-type>\n-\t<channel-type id=\"loop\">\n-\t\t<item-type>Switch</item-type>\n-\t\t<label>Loop</label>\n-\t\t<description>Loop</description>\n-\t</channel-type>\n-\t<channel-type id=\"shuffle\">\n-\t\t<item-type>Switch</item-type>\n-\t\t<label>Shuffle</label>\n-\t\t<description>Shuffle play</description>\n-\t</channel-type>\n-\t<channel-type id=\"player\">\n-\t\t<item-type>Player</item-type>\n-\t\t<label>Player</label>\n-\t\t<description>Music Player</description>\n-\t</channel-type>\n-\t<channel-type id=\"volume\">\n-\t\t<item-type>Dimmer</item-type>\n-\t\t<label>Volume</label>\n-\t\t<description>Volume of the sound</description>\n-\t</channel-type>\n-\t<channel-type id=\"equalizerTreble\">\n-\t\t<item-type>Number</item-type>\n-\t\t<label>Treble</label>\n-\t\t<description>Equalizer Treble</description>\n-\t\t<state min=\"-6\" max=\"6\" step=\"1\"></state>\n-\t</channel-type>\n-\t<channel-type id=\"equalizerMidrange\">\n-\t\t<item-type>Number</item-type>\n-\t\t<label>Midrange</label>\n-\t\t<description>Equalizer Midrange</description>\n-\t\t<state min=\"-6\" max=\"6\" step=\"1\"></state>\n-\t</channel-type>\n-\t<channel-type id=\"equalizerBass\">\n-\t\t<item-type>Number</item-type>\n-\t\t<label>Bass</label>\n-\t\t<description>Equalizer Bass</description>\n-\t\t<state min=\"-6\" max=\"6\" step=\"1\"></state>\n-\t</channel-type>\n-\t<channel-type id=\"musicProviderId\">\n-\t\t<item-type>String</item-type>\n-\t\t<label>Music Provider</label>\n-\t\t<description>Music provider</description>\n-\t</channel-type>\n-\t<channel-type id=\"playMusicVoiceCommand\">\n-\t\t<item-type>String</item-type>\n-\t\t<label>Music Voice Command</label>\n-\t\t<description>Voice command as text. E.g. 'Yesterday from the Beatles' (Write only)</description>\n-\t</channel-type>\n-\t<channel-type id=\"sendMessage\" advanced=\"false\">\n-\t\t<item-type>String</item-type>\n-\t\t<label>Send Message</label>\n-\t\t<description>Sends a message to the Echo devices (Write only).</description>\n-\t</channel-type>\n-\t<channel-type id=\"announcement\" advanced=\"true\">\n-\t\t<item-type>String</item-type>\n-\t\t<label>Announcement</label>\n-\t\t<description>Display the announcement message on the display (Write only). See in the tutorial section of the binding\n-\t\t\tdescription to learn how it's possible to set the title and turn off the sound.</description>\n-\t</channel-type>\n-\t<channel-type id=\"textToSpeech\" advanced=\"true\">\n-\t\t<item-type>String</item-type>\n-\t\t<label>Speak</label>\n-\t\t<description>Speak the text (Write only). It is possible to use plain text or SSML: &lt;speak&gt;I want to tell you a\n-\t\t\tsecret.&lt;amazon:effect name=&quot;whispered&quot;&gt;I am not a real human.&lt;/amazon:effect&gt;.Can you believe\n-\t\t\tit?&lt;/speak&gt;</description>\n-\t</channel-type>\n-\t<channel-type id=\"textToSpeechVolume\" advanced=\"true\">\n-\t\t<item-type>Dimmer</item-type>\n-\t\t<label>Speak Volume</label>\n-\t\t<description>Volume of the Speak channel. If 0, the current volume will be used.</description>\n-\t</channel-type>\n-\t<channel-type id=\"lastVoiceCommand\" advanced=\"true\">\n-\t\t<item-type>String</item-type>\n-\t\t<label>Last Voice Command</label>\n-\t\t<description>Last voice command spoken to the device. Writing to the channel starts voice output.</description>\n-\t\t<state readOnly=\"false\"/>\n-\t</channel-type>\n-\t<channel-type id=\"mediaProgress\" advanced=\"false\">\n-\t\t<item-type>Dimmer</item-type>\n-\t\t<label>Media Progress</label>\n-\t\t<description>Media progress in percent</description>\n-\t\t<state readOnly=\"false\"/>\n-\t</channel-type>\n-\t<channel-type id=\"mediaProgressTime\" advanced=\"true\">\n-\t\t<item-type>Number:Time</item-type>\n-\t\t<label>Media Play Time</label>\n-\t\t<description>Media play time</description>\n-\t\t<state readOnly=\"false\" pattern=\"%d %unit%\"/>\n-\t</channel-type>\n-\t<channel-type id=\"mediaLength\" advanced=\"true\">\n-\t\t<item-type>Number:Time</item-type>\n-\t\t<label>Media Length</label>\n-\t\t<description>Media length</description>\n-\t\t<state readOnly=\"true\" pattern=\"%d %unit%\"/>\n-\t</channel-type>\n-\t<channel-type id=\"startCommand\">\n-\t\t<item-type>String</item-type>\n-\t\t<label>Start</label>\n-\t\t<description>Start information (Write only)</description>\n-\t\t<state pattern=\"String\" readOnly=\"false\">\n-\t\t\t<options>\n-\t\t\t\t<option value=\"Weather\">Weather</option>\n-\t\t\t\t<option value=\"Traffic\">Traffic</option>\n-\t\t\t\t<option value=\"GoodMorning\">Good morning</option>\n-\t\t\t\t<option value=\"SingASong\">Song</option>\n-\t\t\t\t<option value=\"TellStory\">Story</option>\n-\t\t\t\t<option value=\"FlashBriefing\">Flash briefing</option>\n-\t\t\t</options>\n-\t\t</state>\n-\t</channel-type>\n-\t<channel-type id=\"notificationVolume\" advanced=\"true\">\n-\t\t<item-type>Dimmer</item-type>\n-\t\t<label>Notification Volume</label>\n-\t\t<description>Notification Volume</description>\n-\t\t<state readOnly=\"false\"/>\n-\t</channel-type>\n-\t<channel-type id=\"ascendingAlarm\" advanced=\"true\">\n-\t\t<item-type>Switch</item-type>\n-\t\t<label>Ascending Alarm</label>\n-\t\t<description>Ascending alarm up to the configured volume</description>\n-\t\t<state readOnly=\"false\"/>\n-\t</channel-type>\n-\t<channel-type id=\"nextReminder\" advanced=\"true\">\n-\t\t<item-type>DateTime</item-type>\n-\t\t<label>Next Reminder</label>\n-\t\t<description>Next Reminder</description>\n-\t\t<state readOnly=\"true\"/>\n-\t</channel-type>\n-\t<channel-type id=\"nextAlarm\" advanced=\"true\">\n-\t\t<item-type>DateTime</item-type>\n-\t\t<label>Next Alarm</label>\n-\t\t<description>Next alarm</description>\n-\t\t<state readOnly=\"true\"/>\n-\t</channel-type>\n-\t<channel-type id=\"nextMusicAlarm\" advanced=\"true\">\n-\t\t<item-type>DateTime</item-type>\n-\t\t<label>Next Music Alarm</label>\n-\t\t<description>Next music alarm</description>\n-\t\t<state readOnly=\"true\"/>\n-\t</channel-type>\n-\t<channel-type id=\"nextTimer\" advanced=\"true\">\n-\t\t<item-type>DateTime</item-type>\n-\t\t<label>Next Timer</label>\n-\t\t<description>Next timer</description>\n-\t\t<state readOnly=\"true\"/>\n-\t</channel-type>\n-</thing:thing-descriptions>\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n+<thing:thing-descriptions xmlns:thing=\"https://openhab.org/schemas/thing-description/v1.0.0\"\r\n+\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" bindingId=\"amazonechocontrol\"\r\n+\txsi:schemaLocation=\"https://openhab.org/schemas/thing-description/v1.0.0 https://openhab.org/schemas/thing-description-1.0.0.xsd\">\r\n+\t<bridge-type id=\"account\">\r\n+\t\t<label>Amazon Account</label>\r\n+\t\t<description>Amazon Account where the amazon echo devices are registered.</description>\r\n+\t\t<channels>\r\n+\t\t\t<channel id=\"sendMessage\" typeId=\"sendMessage\"/>\r\n+\t\t</channels>\r\n+\t\t<config-description>\r\n+\t\t\t<parameter name=\"discoverSmartHome\" type=\"integer\">\r\n+\t\t\t\t<default>0</default>\r\n+\t\t\t\t<description>Defines if openHAB should discover devices connected to the Amazon Echo.</description>\r\n+\t\t\t\t<options>\r\n+\t\t\t\t\t<option value=\"0\">No Discover</option>\r\n+\t\t\t\t\t<option value=\"1\">Direct connected</option>\r\n+\t\t\t\t\t<option value=\"2\">Direct and over Alexa skill</option>\r\n+\t\t\t\t</options>\r\n+\t\t\t</parameter>\r\n+\t\t\t<parameter name=\"pollingIntervalSmartHomeAlexa\" type=\"decimal\" min=\"10\">\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6ded87597331cfd222f3ea203480a4c2f31ae440"}, "originalPosition": 492}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTI4MDQyMA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\t<parameter name=\"pollingIntervalSmartSkills\" type=\"decimal\" min=\"60\">\n          \n          \n            \n            \t\t\t<parameter name=\"pollingIntervalSmartSkills\" type=\"decimal\" min=\"60\" unit=\"s\">", "url": "https://github.com/openhab/openhab-addons/pull/7969#discussion_r445280420", "createdAt": "2020-06-25T02:59:00Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.amazonechocontrol/src/main/resources/ESH-INF/thing/thing-types.xml", "diffHunk": "@@ -1,471 +1,531 @@\n-<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n-<thing:thing-descriptions xmlns:thing=\"https://openhab.org/schemas/thing-description/v1.0.0\"\n-\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" bindingId=\"amazonechocontrol\"\n-\txsi:schemaLocation=\"https://openhab.org/schemas/thing-description/v1.0.0 https://openhab.org/schemas/thing-description-1.0.0.xsd\">\n-\t<bridge-type id=\"account\">\n-\t\t<label>Amazon Account</label>\n-\t\t<description>Amazon Account where the amazon echo devices are registered.</description>\n-\t\t<channels>\n-\t\t\t<channel id=\"sendMessage\" typeId=\"sendMessage\"/>\n-\t\t</channels>\n-\t</bridge-type>\n-\t<thing-type id=\"echo\">\n-\t\t<supported-bridge-type-refs>\n-\t\t\t<bridge-type-ref id=\"account\"/>\n-\t\t</supported-bridge-type-refs>\n-\t\t<label>Amazon Echo</label>\n-\t\t<description>Amazon Echo device (Amazon Echo, Amazon Echo Dot, Amazon Echo Plus...)</description>\n-\t\t<channels>\n-\t\t\t<channel id=\"player\" typeId=\"player\"/>\n-\t\t\t<channel id=\"mediaProgress\" typeId=\"mediaProgress\"/>\n-\t\t\t<channel id=\"mediaProgressTime\" typeId=\"mediaProgressTime\"/>\n-\t\t\t<channel id=\"mediaLength\" typeId=\"mediaLength\"/>\n-\t\t\t<channel id=\"volume\" typeId=\"volume\"/>\n-\t\t\t<channel id=\"equalizerTreble\" typeId=\"equalizerTreble\"/>\n-\t\t\t<channel id=\"equalizerMidrange\" typeId=\"equalizerMidrange\"/>\n-\t\t\t<channel id=\"equalizerBass\" typeId=\"equalizerBass\"/>\n-\t\t\t<channel id=\"shuffle\" typeId=\"shuffle\"/>\n-\t\t\t<channel id=\"imageUrl\" typeId=\"imageUrl\"/>\n-\t\t\t<channel id=\"title\" typeId=\"title\"/>\n-\t\t\t<channel id=\"subtitle1\" typeId=\"subtitle1\"/>\n-\t\t\t<channel id=\"subtitle2\" typeId=\"subtitle2\"/>\n-\t\t\t<channel id=\"providerDisplayName\" typeId=\"providerDisplayName\"/>\n-\t\t\t<channel id=\"musicProviderId\" typeId=\"musicProviderId\"/>\n-\t\t\t<channel id=\"playMusicVoiceCommand\" typeId=\"playMusicVoiceCommand\"/>\n-\t\t\t<channel id=\"startCommand\" typeId=\"startCommand\"/>\n-\t\t\t<channel id=\"radioStationId\" typeId=\"radioStationId\"/>\n-\t\t\t<channel id=\"radio\" typeId=\"radio\"/>\n-\t\t\t<channel id=\"amazonMusicTrackId\" typeId=\"amazonMusicTrackId\"/>\n-\t\t\t<channel id=\"amazonMusicPlayListId\" typeId=\"amazonMusicPlayListId\"/>\n-\t\t\t<channel id=\"amazonMusic\" typeId=\"amazonMusic\"/>\n-\t\t\t<channel id=\"announcement\" typeId=\"announcement\"/>\n-\t\t\t<channel id=\"textToSpeech\" typeId=\"textToSpeech\"/>\n-\t\t\t<channel id=\"textToSpeechVolume\" typeId=\"textToSpeechVolume\"/>\n-\t\t\t<channel id=\"remind\" typeId=\"remind\"/>\n-\t\t\t<channel id=\"nextReminder\" typeId=\"nextReminder\"/>\n-\t\t\t<channel id=\"playAlarmSound\" typeId=\"playAlarmSound\"/>\n-\t\t\t<channel id=\"nextAlarm\" typeId=\"nextAlarm\"/>\n-\t\t\t<channel id=\"nextMusicAlarm\" typeId=\"nextMusicAlarm\"/>\n-\t\t\t<channel id=\"nextTimer\" typeId=\"nextTimer\"/>\n-\t\t\t<channel id=\"startRoutine\" typeId=\"startRoutine\"/>\n-\t\t\t<channel id=\"bluetoothMAC\" typeId=\"bluetoothMAC\"/>\n-\t\t\t<channel id=\"bluetooth\" typeId=\"bluetooth\"/>\n-\t\t\t<channel id=\"bluetoothDeviceName\" typeId=\"bluetoothDeviceName\"/>\n-\t\t\t<channel id=\"lastVoiceCommand\" typeId=\"lastVoiceCommand\"/>\n-\t\t\t<channel id=\"notificationVolume\" typeId=\"notificationVolume\"/>\n-\t\t\t<channel id=\"ascendingAlarm\" typeId=\"ascendingAlarm\"/>\n-\t\t</channels>\n-\t\t<representation-property>serialNumber</representation-property>\n-\t\t<config-description>\n-\t\t\t<parameter name=\"serialNumber\" type=\"text\" required=\"true\">\n-\t\t\t\t<label>Serial Number</label>\n-\t\t\t\t<description>The serial number of the device from the Alexa app</description>\n-\t\t\t</parameter>\n-\t\t</config-description>\n-\t</thing-type>\n-\t<thing-type id=\"echospot\">\n-\t\t<supported-bridge-type-refs>\n-\t\t\t<bridge-type-ref id=\"account\"/>\n-\t\t</supported-bridge-type-refs>\n-\t\t<label>Amazon Echo Spot</label>\n-\t\t<description>Amazon Echo Spot device</description>\n-\t\t<channels>\n-\t\t\t<channel id=\"player\" typeId=\"player\"/>\n-\t\t\t<channel id=\"mediaProgress\" typeId=\"mediaProgress\"/>\n-\t\t\t<channel id=\"mediaProgressTime\" typeId=\"mediaProgressTime\"/>\n-\t\t\t<channel id=\"mediaLength\" typeId=\"mediaLength\"/>\n-\t\t\t<channel id=\"volume\" typeId=\"volume\"/>\n-\t\t\t<channel id=\"equalizerTreble\" typeId=\"equalizerTreble\"/>\n-\t\t\t<channel id=\"equalizerMidrange\" typeId=\"equalizerMidrange\"/>\n-\t\t\t<channel id=\"equalizerBass\" typeId=\"equalizerBass\"/>\n-\t\t\t<channel id=\"shuffle\" typeId=\"shuffle\"/>\n-\t\t\t<channel id=\"imageUrl\" typeId=\"imageUrl\"/>\n-\t\t\t<channel id=\"title\" typeId=\"title\"/>\n-\t\t\t<channel id=\"subtitle1\" typeId=\"subtitle1\"/>\n-\t\t\t<channel id=\"subtitle2\" typeId=\"subtitle2\"/>\n-\t\t\t<channel id=\"providerDisplayName\" typeId=\"providerDisplayName\"/>\n-\t\t\t<channel id=\"musicProviderId\" typeId=\"musicProviderId\"/>\n-\t\t\t<channel id=\"playMusicVoiceCommand\" typeId=\"playMusicVoiceCommand\"/>\n-\t\t\t<channel id=\"startCommand\" typeId=\"startCommand\"/>\n-\t\t\t<channel id=\"radioStationId\" typeId=\"radioStationId\"/>\n-\t\t\t<channel id=\"radio\" typeId=\"radio\"/>\n-\t\t\t<channel id=\"amazonMusicTrackId\" typeId=\"amazonMusicTrackId\"/>\n-\t\t\t<channel id=\"amazonMusicPlayListId\" typeId=\"amazonMusicPlayListId\"/>\n-\t\t\t<channel id=\"amazonMusic\" typeId=\"amazonMusic\"/>\n-\t\t\t<channel id=\"announcement\" typeId=\"announcement\"/>\n-\t\t\t<channel id=\"textToSpeech\" typeId=\"textToSpeech\"/>\n-\t\t\t<channel id=\"textToSpeechVolume\" typeId=\"textToSpeechVolume\"/>\n-\t\t\t<channel id=\"remind\" typeId=\"remind\"/>\n-\t\t\t<channel id=\"nextReminder\" typeId=\"nextReminder\"/>\n-\t\t\t<channel id=\"playAlarmSound\" typeId=\"playAlarmSound\"/>\n-\t\t\t<channel id=\"nextAlarm\" typeId=\"nextAlarm\"/>\n-\t\t\t<channel id=\"nextMusicAlarm\" typeId=\"nextMusicAlarm\"/>\n-\t\t\t<channel id=\"nextTimer\" typeId=\"nextTimer\"/>\n-\t\t\t<channel id=\"startRoutine\" typeId=\"startRoutine\"/>\n-\t\t\t<channel id=\"bluetoothMAC\" typeId=\"bluetoothMAC\"/>\n-\t\t\t<channel id=\"bluetooth\" typeId=\"bluetooth\"/>\n-\t\t\t<channel id=\"bluetoothDeviceName\" typeId=\"bluetoothDeviceName\"/>\n-\t\t\t<channel id=\"lastVoiceCommand\" typeId=\"lastVoiceCommand\"/>\n-\t\t\t<channel id=\"notificationVolume\" typeId=\"notificationVolume\"/>\n-\t\t\t<channel id=\"ascendingAlarm\" typeId=\"ascendingAlarm\"/>\n-\t\t</channels>\n-\t\t<representation-property>serialNumber</representation-property>\n-\t\t<config-description>\n-\t\t\t<parameter name=\"serialNumber\" type=\"text\" required=\"true\">\n-\t\t\t\t<label>Serial Number</label>\n-\t\t\t\t<description>The serial number of the device from the Alexa app</description>\n-\t\t\t</parameter>\n-\t\t</config-description>\n-\t</thing-type>\n-\t<thing-type id=\"echoshow\">\n-\t\t<supported-bridge-type-refs>\n-\t\t\t<bridge-type-ref id=\"account\"/>\n-\t\t</supported-bridge-type-refs>\n-\t\t<label>Amazon Echo Show</label>\n-\t\t<description>Amazon Echo Show device</description>\n-\t\t<channels>\n-\t\t\t<channel id=\"player\" typeId=\"player\"/>\n-\t\t\t<channel id=\"mediaProgress\" typeId=\"mediaProgress\"/>\n-\t\t\t<channel id=\"mediaProgressTime\" typeId=\"mediaProgressTime\"/>\n-\t\t\t<channel id=\"mediaLength\" typeId=\"mediaLength\"/>\n-\t\t\t<channel id=\"volume\" typeId=\"volume\"/>\n-\t\t\t<channel id=\"equalizerTreble\" typeId=\"equalizerTreble\"/>\n-\t\t\t<channel id=\"equalizerMidrange\" typeId=\"equalizerMidrange\"/>\n-\t\t\t<channel id=\"equalizerBass\" typeId=\"equalizerBass\"/>\n-\t\t\t<channel id=\"shuffle\" typeId=\"shuffle\"/>\n-\t\t\t<channel id=\"imageUrl\" typeId=\"imageUrl\"/>\n-\t\t\t<channel id=\"title\" typeId=\"title\"/>\n-\t\t\t<channel id=\"subtitle1\" typeId=\"subtitle1\"/>\n-\t\t\t<channel id=\"subtitle2\" typeId=\"subtitle2\"/>\n-\t\t\t<channel id=\"providerDisplayName\" typeId=\"providerDisplayName\"/>\n-\t\t\t<channel id=\"musicProviderId\" typeId=\"musicProviderId\"/>\n-\t\t\t<channel id=\"playMusicVoiceCommand\" typeId=\"playMusicVoiceCommand\"/>\n-\t\t\t<channel id=\"startCommand\" typeId=\"startCommand\"/>\n-\t\t\t<channel id=\"radioStationId\" typeId=\"radioStationId\"/>\n-\t\t\t<channel id=\"radio\" typeId=\"radio\"/>\n-\t\t\t<channel id=\"amazonMusicTrackId\" typeId=\"amazonMusicTrackId\"/>\n-\t\t\t<channel id=\"amazonMusicPlayListId\" typeId=\"amazonMusicPlayListId\"/>\n-\t\t\t<channel id=\"amazonMusic\" typeId=\"amazonMusic\"/>\n-\t\t\t<channel id=\"announcement\" typeId=\"announcement\"/>\n-\t\t\t<channel id=\"textToSpeech\" typeId=\"textToSpeech\"/>\n-\t\t\t<channel id=\"textToSpeechVolume\" typeId=\"textToSpeechVolume\"/>\n-\t\t\t<channel id=\"remind\" typeId=\"remind\"/>\n-\t\t\t<channel id=\"nextReminder\" typeId=\"nextReminder\"/>\n-\t\t\t<channel id=\"playAlarmSound\" typeId=\"playAlarmSound\"/>\n-\t\t\t<channel id=\"nextAlarm\" typeId=\"nextAlarm\"/>\n-\t\t\t<channel id=\"nextMusicAlarm\" typeId=\"nextMusicAlarm\"/>\n-\t\t\t<channel id=\"nextTimer\" typeId=\"nextTimer\"/>\n-\t\t\t<channel id=\"startRoutine\" typeId=\"startRoutine\"/>\n-\t\t\t<channel id=\"bluetoothMAC\" typeId=\"bluetoothMAC\"/>\n-\t\t\t<channel id=\"bluetooth\" typeId=\"bluetooth\"/>\n-\t\t\t<channel id=\"bluetoothDeviceName\" typeId=\"bluetoothDeviceName\"/>\n-\t\t\t<channel id=\"lastVoiceCommand\" typeId=\"lastVoiceCommand\"/>\n-\t\t\t<channel id=\"notificationVolume\" typeId=\"notificationVolume\"/>\n-\t\t\t<channel id=\"ascendingAlarm\" typeId=\"ascendingAlarm\"/>\n-\t\t</channels>\n-\t\t<representation-property>serialNumber</representation-property>\n-\t\t<config-description>\n-\t\t\t<parameter name=\"serialNumber\" type=\"text\" required=\"true\">\n-\t\t\t\t<label>Serial Number</label>\n-\t\t\t\t<description>The serial number of the device from the Alexa app</description>\n-\t\t\t</parameter>\n-\t\t</config-description>\n-\t</thing-type>\n-\t<thing-type id=\"wha\">\n-\t\t<supported-bridge-type-refs>\n-\t\t\t<bridge-type-ref id=\"account\"/>\n-\t\t</supported-bridge-type-refs>\n-\t\t<label>Amazon Echo Whole House Audio Control</label>\n-\t\t<description>Amazon Multiroom Music</description>\n-\t\t<channels>\n-\t\t\t<channel id=\"player\" typeId=\"player\"/>\n-\t\t\t<channel id=\"mediaProgressTime\" typeId=\"mediaProgressTime\"/>\n-\t\t\t<channel id=\"mediaProgress\" typeId=\"mediaProgress\"/>\n-\t\t\t<channel id=\"mediaLength\" typeId=\"mediaLength\"/>\n-\t\t\t<channel id=\"shuffle\" typeId=\"shuffle\"/>\n-\t\t\t<channel id=\"imageUrl\" typeId=\"imageUrl\"/>\n-\t\t\t<channel id=\"title\" typeId=\"title\"/>\n-\t\t\t<channel id=\"subtitle1\" typeId=\"subtitle1\"/>\n-\t\t\t<channel id=\"subtitle2\" typeId=\"subtitle2\"/>\n-\t\t\t<channel id=\"providerDisplayName\" typeId=\"providerDisplayName\"/>\n-\t\t\t<channel id=\"radioStationId\" typeId=\"radioStationId\"/>\n-\t\t\t<channel id=\"radio\" typeId=\"radio\"/>\n-\t\t\t<channel id=\"amazonMusicTrackId\" typeId=\"amazonMusicTrackId\"/>\n-\t\t\t<channel id=\"amazonMusicPlayListId\" typeId=\"amazonMusicPlayListId\"/>\n-\t\t\t<channel id=\"amazonMusic\" typeId=\"amazonMusic\"/>\n-\t\t</channels>\n-\t\t<representation-property>serialNumber</representation-property>\n-\t\t<config-description>\n-\t\t\t<parameter name=\"serialNumber\" type=\"text\" required=\"true\">\n-\t\t\t\t<label>Serial Number</label>\n-\t\t\t\t<description>The serial number of the device from the Alexa app</description>\n-\t\t\t</parameter>\n-\t\t</config-description>\n-\t</thing-type>\n-\n-\t<thing-type id=\"flashbriefingprofile\">\n-\t\t<supported-bridge-type-refs>\n-\t\t\t<bridge-type-ref id=\"account\"/>\n-\t\t</supported-bridge-type-refs>\n-\t\t<label>Flash Briefing Profile</label>\n-\t\t<description>Store and load a flash briefing configuration</description>\n-\t\t<channels>\n-\t\t\t<channel id=\"save\" typeId=\"save\"/>\n-\t\t\t<channel id=\"active\" typeId=\"active\"/>\n-\t\t\t<channel id=\"playOnDevice\" typeId=\"playOnDevice\"/>\n-\t\t</channels>\n-\t</thing-type>\n-\t<channel-type id=\"save\">\n-\t\t<item-type>Switch</item-type>\n-\t\t<label>Save</label>\n-\t\t<description>Save the current flash briefing configuration (Write only)</description>\n-\t</channel-type>\n-\t<channel-type id=\"active\">\n-\t\t<item-type>Switch</item-type>\n-\t\t<label>Active</label>\n-\t\t<description>Activate this flash briefing configuration</description>\n-\t</channel-type>\n-\t<channel-type id=\"playOnDevice\" advanced=\"true\">\n-\t\t<item-type>String</item-type>\n-\t\t<label>Play On Device</label>\n-\t\t<description>Plays the briefing on the device (serial number or name, write only)</description>\n-\t</channel-type>\n-\t<channel-type id=\"bluetoothDeviceName\" advanced=\"true\">\n-\t\t<item-type>String</item-type>\n-\t\t<label>Bluetooth Device</label>\n-\t\t<description>Connected bluetooth device</description>\n-\t\t<state readOnly=\"true\"/>\n-\t</channel-type>\n-\t<channel-type id=\"radioStationId\" advanced=\"true\">\n-\t\t<item-type>String</item-type>\n-\t\t<label>TuneIn Radio Station Id</label>\n-\t\t<description>Id of the radio station</description>\n-\t</channel-type>\n-\t<channel-type id=\"remind\" advanced=\"true\">\n-\t\t<item-type>String</item-type>\n-\t\t<label>Remind</label>\n-\t\t<description>Speak the reminder and send a notification to the Alexa app</description>\n-\t</channel-type>\n-\t<channel-type id=\"startRoutine\" advanced=\"true\">\n-\t\t<item-type>String</item-type>\n-\t\t<label>Start a Routine</label>\n-\t\t<description>The command which must be spoken to active the routing without the preceding \"Alexa,\" (Write Only)\n-\t\t</description>\n-\t</channel-type>\n-\t<channel-type id=\"playAlarmSound\" advanced=\"true\">\n-\t\t<item-type>String</item-type>\n-\t\t<label>Alarm Sound</label>\n-\t\t<description>Plays an alarm sound</description>\n-\t</channel-type>\n-\t<channel-type id=\"amazonMusicTrackId\" advanced=\"true\">\n-\t\t<item-type>String</item-type>\n-\t\t<label>Amazon Music Track Id</label>\n-\t\t<description>Id of the amazon music track</description>\n-\t</channel-type>\n-\t<channel-type id=\"amazonMusic\" advanced=\"true\">\n-\t\t<item-type>Switch</item-type>\n-\t\t<label>Amazon Music</label>\n-\t\t<description>Amazon Music turned on</description>\n-\t</channel-type>\n-\t<channel-type id=\"amazonMusicPlayListId\" advanced=\"true\">\n-\t\t<item-type>String</item-type>\n-\t\t<label>Amazon Music Play List Id</label>\n-\t\t<description>Amazon Music play list id (Write only, no current state)</description>\n-\t</channel-type>\n-\t<channel-type id=\"amazonMusicPlayListIdLastUsed\" advanced=\"true\">\n-\t\t<item-type>String</item-type>\n-\t\t<label>Amazon Music Last Selected Playlist Id</label>\n-\t\t<description>Id of the playlist which was started with openHAB</description>\n-\t</channel-type>\n-\t<channel-type id=\"providerDisplayName\" advanced=\"true\">\n-\t\t<item-type>String</item-type>\n-\t\t<label>Provider Name</label>\n-\t\t<description>Name of music provider</description>\n-\t\t<state readOnly=\"true\"/>\n-\t</channel-type>\n-\t<channel-type id=\"bluetoothMAC\">\n-\t\t<item-type>String</item-type>\n-\t\t<label>Bluetooth Connection</label>\n-\t\t<description>MAC-Address of the bluetooth connected device</description>\n-\t</channel-type>\n-\t<channel-type id=\"imageUrl\" advanced=\"true\">\n-\t\t<item-type>String</item-type>\n-\t\t<label>Image Url</label>\n-\t\t<description>Url of the album image or radio station logo</description>\n-\t\t<state readOnly=\"true\"/>\n-\t</channel-type>\n-\t<channel-type id=\"title\">\n-\t\t<item-type>String</item-type>\n-\t\t<label>Title</label>\n-\t\t<description>Title</description>\n-\t\t<state readOnly=\"true\"/>\n-\t</channel-type>\n-\t<channel-type id=\"subtitle1\" advanced=\"true\">\n-\t\t<item-type>String</item-type>\n-\t\t<label>Subtitle 1</label>\n-\t\t<description>Subtitle 1</description>\n-\t\t<state readOnly=\"true\"/>\n-\t</channel-type>\n-\t<channel-type id=\"subtitle2\" advanced=\"true\">\n-\t\t<item-type>String</item-type>\n-\t\t<label>Subtitle 2</label>\n-\t\t<description>Subtitle 2</description>\n-\t\t<state readOnly=\"true\"/>\n-\t</channel-type>\n-\t<channel-type id=\"radio\" advanced=\"true\">\n-\t\t<item-type>Switch</item-type>\n-\t\t<label>TuneIn Radio</label>\n-\t\t<description>Radio turned on</description>\n-\t</channel-type>\n-\t<channel-type id=\"bluetooth\" advanced=\"true\">\n-\t\t<item-type>Switch</item-type>\n-\t\t<label>Bluetooth Connection</label>\n-\t\t<description>Connect to last used device</description>\n-\t</channel-type>\n-\t<channel-type id=\"loop\">\n-\t\t<item-type>Switch</item-type>\n-\t\t<label>Loop</label>\n-\t\t<description>Loop</description>\n-\t</channel-type>\n-\t<channel-type id=\"shuffle\">\n-\t\t<item-type>Switch</item-type>\n-\t\t<label>Shuffle</label>\n-\t\t<description>Shuffle play</description>\n-\t</channel-type>\n-\t<channel-type id=\"player\">\n-\t\t<item-type>Player</item-type>\n-\t\t<label>Player</label>\n-\t\t<description>Music Player</description>\n-\t</channel-type>\n-\t<channel-type id=\"volume\">\n-\t\t<item-type>Dimmer</item-type>\n-\t\t<label>Volume</label>\n-\t\t<description>Volume of the sound</description>\n-\t</channel-type>\n-\t<channel-type id=\"equalizerTreble\">\n-\t\t<item-type>Number</item-type>\n-\t\t<label>Treble</label>\n-\t\t<description>Equalizer Treble</description>\n-\t\t<state min=\"-6\" max=\"6\" step=\"1\"></state>\n-\t</channel-type>\n-\t<channel-type id=\"equalizerMidrange\">\n-\t\t<item-type>Number</item-type>\n-\t\t<label>Midrange</label>\n-\t\t<description>Equalizer Midrange</description>\n-\t\t<state min=\"-6\" max=\"6\" step=\"1\"></state>\n-\t</channel-type>\n-\t<channel-type id=\"equalizerBass\">\n-\t\t<item-type>Number</item-type>\n-\t\t<label>Bass</label>\n-\t\t<description>Equalizer Bass</description>\n-\t\t<state min=\"-6\" max=\"6\" step=\"1\"></state>\n-\t</channel-type>\n-\t<channel-type id=\"musicProviderId\">\n-\t\t<item-type>String</item-type>\n-\t\t<label>Music Provider</label>\n-\t\t<description>Music provider</description>\n-\t</channel-type>\n-\t<channel-type id=\"playMusicVoiceCommand\">\n-\t\t<item-type>String</item-type>\n-\t\t<label>Music Voice Command</label>\n-\t\t<description>Voice command as text. E.g. 'Yesterday from the Beatles' (Write only)</description>\n-\t</channel-type>\n-\t<channel-type id=\"sendMessage\" advanced=\"false\">\n-\t\t<item-type>String</item-type>\n-\t\t<label>Send Message</label>\n-\t\t<description>Sends a message to the Echo devices (Write only).</description>\n-\t</channel-type>\n-\t<channel-type id=\"announcement\" advanced=\"true\">\n-\t\t<item-type>String</item-type>\n-\t\t<label>Announcement</label>\n-\t\t<description>Display the announcement message on the display (Write only). See in the tutorial section of the binding\n-\t\t\tdescription to learn how it's possible to set the title and turn off the sound.</description>\n-\t</channel-type>\n-\t<channel-type id=\"textToSpeech\" advanced=\"true\">\n-\t\t<item-type>String</item-type>\n-\t\t<label>Speak</label>\n-\t\t<description>Speak the text (Write only). It is possible to use plain text or SSML: &lt;speak&gt;I want to tell you a\n-\t\t\tsecret.&lt;amazon:effect name=&quot;whispered&quot;&gt;I am not a real human.&lt;/amazon:effect&gt;.Can you believe\n-\t\t\tit?&lt;/speak&gt;</description>\n-\t</channel-type>\n-\t<channel-type id=\"textToSpeechVolume\" advanced=\"true\">\n-\t\t<item-type>Dimmer</item-type>\n-\t\t<label>Speak Volume</label>\n-\t\t<description>Volume of the Speak channel. If 0, the current volume will be used.</description>\n-\t</channel-type>\n-\t<channel-type id=\"lastVoiceCommand\" advanced=\"true\">\n-\t\t<item-type>String</item-type>\n-\t\t<label>Last Voice Command</label>\n-\t\t<description>Last voice command spoken to the device. Writing to the channel starts voice output.</description>\n-\t\t<state readOnly=\"false\"/>\n-\t</channel-type>\n-\t<channel-type id=\"mediaProgress\" advanced=\"false\">\n-\t\t<item-type>Dimmer</item-type>\n-\t\t<label>Media Progress</label>\n-\t\t<description>Media progress in percent</description>\n-\t\t<state readOnly=\"false\"/>\n-\t</channel-type>\n-\t<channel-type id=\"mediaProgressTime\" advanced=\"true\">\n-\t\t<item-type>Number:Time</item-type>\n-\t\t<label>Media Play Time</label>\n-\t\t<description>Media play time</description>\n-\t\t<state readOnly=\"false\" pattern=\"%d %unit%\"/>\n-\t</channel-type>\n-\t<channel-type id=\"mediaLength\" advanced=\"true\">\n-\t\t<item-type>Number:Time</item-type>\n-\t\t<label>Media Length</label>\n-\t\t<description>Media length</description>\n-\t\t<state readOnly=\"true\" pattern=\"%d %unit%\"/>\n-\t</channel-type>\n-\t<channel-type id=\"startCommand\">\n-\t\t<item-type>String</item-type>\n-\t\t<label>Start</label>\n-\t\t<description>Start information (Write only)</description>\n-\t\t<state pattern=\"String\" readOnly=\"false\">\n-\t\t\t<options>\n-\t\t\t\t<option value=\"Weather\">Weather</option>\n-\t\t\t\t<option value=\"Traffic\">Traffic</option>\n-\t\t\t\t<option value=\"GoodMorning\">Good morning</option>\n-\t\t\t\t<option value=\"SingASong\">Song</option>\n-\t\t\t\t<option value=\"TellStory\">Story</option>\n-\t\t\t\t<option value=\"FlashBriefing\">Flash briefing</option>\n-\t\t\t</options>\n-\t\t</state>\n-\t</channel-type>\n-\t<channel-type id=\"notificationVolume\" advanced=\"true\">\n-\t\t<item-type>Dimmer</item-type>\n-\t\t<label>Notification Volume</label>\n-\t\t<description>Notification Volume</description>\n-\t\t<state readOnly=\"false\"/>\n-\t</channel-type>\n-\t<channel-type id=\"ascendingAlarm\" advanced=\"true\">\n-\t\t<item-type>Switch</item-type>\n-\t\t<label>Ascending Alarm</label>\n-\t\t<description>Ascending alarm up to the configured volume</description>\n-\t\t<state readOnly=\"false\"/>\n-\t</channel-type>\n-\t<channel-type id=\"nextReminder\" advanced=\"true\">\n-\t\t<item-type>DateTime</item-type>\n-\t\t<label>Next Reminder</label>\n-\t\t<description>Next Reminder</description>\n-\t\t<state readOnly=\"true\"/>\n-\t</channel-type>\n-\t<channel-type id=\"nextAlarm\" advanced=\"true\">\n-\t\t<item-type>DateTime</item-type>\n-\t\t<label>Next Alarm</label>\n-\t\t<description>Next alarm</description>\n-\t\t<state readOnly=\"true\"/>\n-\t</channel-type>\n-\t<channel-type id=\"nextMusicAlarm\" advanced=\"true\">\n-\t\t<item-type>DateTime</item-type>\n-\t\t<label>Next Music Alarm</label>\n-\t\t<description>Next music alarm</description>\n-\t\t<state readOnly=\"true\"/>\n-\t</channel-type>\n-\t<channel-type id=\"nextTimer\" advanced=\"true\">\n-\t\t<item-type>DateTime</item-type>\n-\t\t<label>Next Timer</label>\n-\t\t<description>Next timer</description>\n-\t\t<state readOnly=\"true\"/>\n-\t</channel-type>\n-</thing:thing-descriptions>\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n+<thing:thing-descriptions xmlns:thing=\"https://openhab.org/schemas/thing-description/v1.0.0\"\r\n+\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" bindingId=\"amazonechocontrol\"\r\n+\txsi:schemaLocation=\"https://openhab.org/schemas/thing-description/v1.0.0 https://openhab.org/schemas/thing-description-1.0.0.xsd\">\r\n+\t<bridge-type id=\"account\">\r\n+\t\t<label>Amazon Account</label>\r\n+\t\t<description>Amazon Account where the amazon echo devices are registered.</description>\r\n+\t\t<channels>\r\n+\t\t\t<channel id=\"sendMessage\" typeId=\"sendMessage\"/>\r\n+\t\t</channels>\r\n+\t\t<config-description>\r\n+\t\t\t<parameter name=\"discoverSmartHome\" type=\"integer\">\r\n+\t\t\t\t<default>0</default>\r\n+\t\t\t\t<description>Defines if openHAB should discover devices connected to the Amazon Echo.</description>\r\n+\t\t\t\t<options>\r\n+\t\t\t\t\t<option value=\"0\">No Discover</option>\r\n+\t\t\t\t\t<option value=\"1\">Direct connected</option>\r\n+\t\t\t\t\t<option value=\"2\">Direct and over Alexa skill</option>\r\n+\t\t\t\t</options>\r\n+\t\t\t</parameter>\r\n+\t\t\t<parameter name=\"pollingIntervalSmartHomeAlexa\" type=\"decimal\" min=\"10\">\r\n+\t\t\t\t<default>30</default>\r\n+\t\t\t\t<description>\r\n+\t\t\t\t\tDefines the time in seconds for openHAB to pull the\r\n+\t\t\t\t\tstate of the Alexa connected devices. The minimum is\r\n+\t\t\t\t\t10 seconds.\r\n+\t\t\t\t</description>\r\n+\t\t\t</parameter>\r\n+\t\t\t<parameter name=\"pollingIntervalSmartSkills\" type=\"decimal\" min=\"60\">\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6ded87597331cfd222f3ea203480a4c2f31ae440"}, "originalPosition": 500}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTI4MDUzNA==", "bodyText": "shouldn't these parameters have labels?", "url": "https://github.com/openhab/openhab-addons/pull/7969#discussion_r445280534", "createdAt": "2020-06-25T02:59:30Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.amazonechocontrol/src/main/resources/ESH-INF/thing/thing-types.xml", "diffHunk": "@@ -1,471 +1,531 @@\n-<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n-<thing:thing-descriptions xmlns:thing=\"https://openhab.org/schemas/thing-description/v1.0.0\"\n-\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" bindingId=\"amazonechocontrol\"\n-\txsi:schemaLocation=\"https://openhab.org/schemas/thing-description/v1.0.0 https://openhab.org/schemas/thing-description-1.0.0.xsd\">\n-\t<bridge-type id=\"account\">\n-\t\t<label>Amazon Account</label>\n-\t\t<description>Amazon Account where the amazon echo devices are registered.</description>\n-\t\t<channels>\n-\t\t\t<channel id=\"sendMessage\" typeId=\"sendMessage\"/>\n-\t\t</channels>\n-\t</bridge-type>\n-\t<thing-type id=\"echo\">\n-\t\t<supported-bridge-type-refs>\n-\t\t\t<bridge-type-ref id=\"account\"/>\n-\t\t</supported-bridge-type-refs>\n-\t\t<label>Amazon Echo</label>\n-\t\t<description>Amazon Echo device (Amazon Echo, Amazon Echo Dot, Amazon Echo Plus...)</description>\n-\t\t<channels>\n-\t\t\t<channel id=\"player\" typeId=\"player\"/>\n-\t\t\t<channel id=\"mediaProgress\" typeId=\"mediaProgress\"/>\n-\t\t\t<channel id=\"mediaProgressTime\" typeId=\"mediaProgressTime\"/>\n-\t\t\t<channel id=\"mediaLength\" typeId=\"mediaLength\"/>\n-\t\t\t<channel id=\"volume\" typeId=\"volume\"/>\n-\t\t\t<channel id=\"equalizerTreble\" typeId=\"equalizerTreble\"/>\n-\t\t\t<channel id=\"equalizerMidrange\" typeId=\"equalizerMidrange\"/>\n-\t\t\t<channel id=\"equalizerBass\" typeId=\"equalizerBass\"/>\n-\t\t\t<channel id=\"shuffle\" typeId=\"shuffle\"/>\n-\t\t\t<channel id=\"imageUrl\" typeId=\"imageUrl\"/>\n-\t\t\t<channel id=\"title\" typeId=\"title\"/>\n-\t\t\t<channel id=\"subtitle1\" typeId=\"subtitle1\"/>\n-\t\t\t<channel id=\"subtitle2\" typeId=\"subtitle2\"/>\n-\t\t\t<channel id=\"providerDisplayName\" typeId=\"providerDisplayName\"/>\n-\t\t\t<channel id=\"musicProviderId\" typeId=\"musicProviderId\"/>\n-\t\t\t<channel id=\"playMusicVoiceCommand\" typeId=\"playMusicVoiceCommand\"/>\n-\t\t\t<channel id=\"startCommand\" typeId=\"startCommand\"/>\n-\t\t\t<channel id=\"radioStationId\" typeId=\"radioStationId\"/>\n-\t\t\t<channel id=\"radio\" typeId=\"radio\"/>\n-\t\t\t<channel id=\"amazonMusicTrackId\" typeId=\"amazonMusicTrackId\"/>\n-\t\t\t<channel id=\"amazonMusicPlayListId\" typeId=\"amazonMusicPlayListId\"/>\n-\t\t\t<channel id=\"amazonMusic\" typeId=\"amazonMusic\"/>\n-\t\t\t<channel id=\"announcement\" typeId=\"announcement\"/>\n-\t\t\t<channel id=\"textToSpeech\" typeId=\"textToSpeech\"/>\n-\t\t\t<channel id=\"textToSpeechVolume\" typeId=\"textToSpeechVolume\"/>\n-\t\t\t<channel id=\"remind\" typeId=\"remind\"/>\n-\t\t\t<channel id=\"nextReminder\" typeId=\"nextReminder\"/>\n-\t\t\t<channel id=\"playAlarmSound\" typeId=\"playAlarmSound\"/>\n-\t\t\t<channel id=\"nextAlarm\" typeId=\"nextAlarm\"/>\n-\t\t\t<channel id=\"nextMusicAlarm\" typeId=\"nextMusicAlarm\"/>\n-\t\t\t<channel id=\"nextTimer\" typeId=\"nextTimer\"/>\n-\t\t\t<channel id=\"startRoutine\" typeId=\"startRoutine\"/>\n-\t\t\t<channel id=\"bluetoothMAC\" typeId=\"bluetoothMAC\"/>\n-\t\t\t<channel id=\"bluetooth\" typeId=\"bluetooth\"/>\n-\t\t\t<channel id=\"bluetoothDeviceName\" typeId=\"bluetoothDeviceName\"/>\n-\t\t\t<channel id=\"lastVoiceCommand\" typeId=\"lastVoiceCommand\"/>\n-\t\t\t<channel id=\"notificationVolume\" typeId=\"notificationVolume\"/>\n-\t\t\t<channel id=\"ascendingAlarm\" typeId=\"ascendingAlarm\"/>\n-\t\t</channels>\n-\t\t<representation-property>serialNumber</representation-property>\n-\t\t<config-description>\n-\t\t\t<parameter name=\"serialNumber\" type=\"text\" required=\"true\">\n-\t\t\t\t<label>Serial Number</label>\n-\t\t\t\t<description>The serial number of the device from the Alexa app</description>\n-\t\t\t</parameter>\n-\t\t</config-description>\n-\t</thing-type>\n-\t<thing-type id=\"echospot\">\n-\t\t<supported-bridge-type-refs>\n-\t\t\t<bridge-type-ref id=\"account\"/>\n-\t\t</supported-bridge-type-refs>\n-\t\t<label>Amazon Echo Spot</label>\n-\t\t<description>Amazon Echo Spot device</description>\n-\t\t<channels>\n-\t\t\t<channel id=\"player\" typeId=\"player\"/>\n-\t\t\t<channel id=\"mediaProgress\" typeId=\"mediaProgress\"/>\n-\t\t\t<channel id=\"mediaProgressTime\" typeId=\"mediaProgressTime\"/>\n-\t\t\t<channel id=\"mediaLength\" typeId=\"mediaLength\"/>\n-\t\t\t<channel id=\"volume\" typeId=\"volume\"/>\n-\t\t\t<channel id=\"equalizerTreble\" typeId=\"equalizerTreble\"/>\n-\t\t\t<channel id=\"equalizerMidrange\" typeId=\"equalizerMidrange\"/>\n-\t\t\t<channel id=\"equalizerBass\" typeId=\"equalizerBass\"/>\n-\t\t\t<channel id=\"shuffle\" typeId=\"shuffle\"/>\n-\t\t\t<channel id=\"imageUrl\" typeId=\"imageUrl\"/>\n-\t\t\t<channel id=\"title\" typeId=\"title\"/>\n-\t\t\t<channel id=\"subtitle1\" typeId=\"subtitle1\"/>\n-\t\t\t<channel id=\"subtitle2\" typeId=\"subtitle2\"/>\n-\t\t\t<channel id=\"providerDisplayName\" typeId=\"providerDisplayName\"/>\n-\t\t\t<channel id=\"musicProviderId\" typeId=\"musicProviderId\"/>\n-\t\t\t<channel id=\"playMusicVoiceCommand\" typeId=\"playMusicVoiceCommand\"/>\n-\t\t\t<channel id=\"startCommand\" typeId=\"startCommand\"/>\n-\t\t\t<channel id=\"radioStationId\" typeId=\"radioStationId\"/>\n-\t\t\t<channel id=\"radio\" typeId=\"radio\"/>\n-\t\t\t<channel id=\"amazonMusicTrackId\" typeId=\"amazonMusicTrackId\"/>\n-\t\t\t<channel id=\"amazonMusicPlayListId\" typeId=\"amazonMusicPlayListId\"/>\n-\t\t\t<channel id=\"amazonMusic\" typeId=\"amazonMusic\"/>\n-\t\t\t<channel id=\"announcement\" typeId=\"announcement\"/>\n-\t\t\t<channel id=\"textToSpeech\" typeId=\"textToSpeech\"/>\n-\t\t\t<channel id=\"textToSpeechVolume\" typeId=\"textToSpeechVolume\"/>\n-\t\t\t<channel id=\"remind\" typeId=\"remind\"/>\n-\t\t\t<channel id=\"nextReminder\" typeId=\"nextReminder\"/>\n-\t\t\t<channel id=\"playAlarmSound\" typeId=\"playAlarmSound\"/>\n-\t\t\t<channel id=\"nextAlarm\" typeId=\"nextAlarm\"/>\n-\t\t\t<channel id=\"nextMusicAlarm\" typeId=\"nextMusicAlarm\"/>\n-\t\t\t<channel id=\"nextTimer\" typeId=\"nextTimer\"/>\n-\t\t\t<channel id=\"startRoutine\" typeId=\"startRoutine\"/>\n-\t\t\t<channel id=\"bluetoothMAC\" typeId=\"bluetoothMAC\"/>\n-\t\t\t<channel id=\"bluetooth\" typeId=\"bluetooth\"/>\n-\t\t\t<channel id=\"bluetoothDeviceName\" typeId=\"bluetoothDeviceName\"/>\n-\t\t\t<channel id=\"lastVoiceCommand\" typeId=\"lastVoiceCommand\"/>\n-\t\t\t<channel id=\"notificationVolume\" typeId=\"notificationVolume\"/>\n-\t\t\t<channel id=\"ascendingAlarm\" typeId=\"ascendingAlarm\"/>\n-\t\t</channels>\n-\t\t<representation-property>serialNumber</representation-property>\n-\t\t<config-description>\n-\t\t\t<parameter name=\"serialNumber\" type=\"text\" required=\"true\">\n-\t\t\t\t<label>Serial Number</label>\n-\t\t\t\t<description>The serial number of the device from the Alexa app</description>\n-\t\t\t</parameter>\n-\t\t</config-description>\n-\t</thing-type>\n-\t<thing-type id=\"echoshow\">\n-\t\t<supported-bridge-type-refs>\n-\t\t\t<bridge-type-ref id=\"account\"/>\n-\t\t</supported-bridge-type-refs>\n-\t\t<label>Amazon Echo Show</label>\n-\t\t<description>Amazon Echo Show device</description>\n-\t\t<channels>\n-\t\t\t<channel id=\"player\" typeId=\"player\"/>\n-\t\t\t<channel id=\"mediaProgress\" typeId=\"mediaProgress\"/>\n-\t\t\t<channel id=\"mediaProgressTime\" typeId=\"mediaProgressTime\"/>\n-\t\t\t<channel id=\"mediaLength\" typeId=\"mediaLength\"/>\n-\t\t\t<channel id=\"volume\" typeId=\"volume\"/>\n-\t\t\t<channel id=\"equalizerTreble\" typeId=\"equalizerTreble\"/>\n-\t\t\t<channel id=\"equalizerMidrange\" typeId=\"equalizerMidrange\"/>\n-\t\t\t<channel id=\"equalizerBass\" typeId=\"equalizerBass\"/>\n-\t\t\t<channel id=\"shuffle\" typeId=\"shuffle\"/>\n-\t\t\t<channel id=\"imageUrl\" typeId=\"imageUrl\"/>\n-\t\t\t<channel id=\"title\" typeId=\"title\"/>\n-\t\t\t<channel id=\"subtitle1\" typeId=\"subtitle1\"/>\n-\t\t\t<channel id=\"subtitle2\" typeId=\"subtitle2\"/>\n-\t\t\t<channel id=\"providerDisplayName\" typeId=\"providerDisplayName\"/>\n-\t\t\t<channel id=\"musicProviderId\" typeId=\"musicProviderId\"/>\n-\t\t\t<channel id=\"playMusicVoiceCommand\" typeId=\"playMusicVoiceCommand\"/>\n-\t\t\t<channel id=\"startCommand\" typeId=\"startCommand\"/>\n-\t\t\t<channel id=\"radioStationId\" typeId=\"radioStationId\"/>\n-\t\t\t<channel id=\"radio\" typeId=\"radio\"/>\n-\t\t\t<channel id=\"amazonMusicTrackId\" typeId=\"amazonMusicTrackId\"/>\n-\t\t\t<channel id=\"amazonMusicPlayListId\" typeId=\"amazonMusicPlayListId\"/>\n-\t\t\t<channel id=\"amazonMusic\" typeId=\"amazonMusic\"/>\n-\t\t\t<channel id=\"announcement\" typeId=\"announcement\"/>\n-\t\t\t<channel id=\"textToSpeech\" typeId=\"textToSpeech\"/>\n-\t\t\t<channel id=\"textToSpeechVolume\" typeId=\"textToSpeechVolume\"/>\n-\t\t\t<channel id=\"remind\" typeId=\"remind\"/>\n-\t\t\t<channel id=\"nextReminder\" typeId=\"nextReminder\"/>\n-\t\t\t<channel id=\"playAlarmSound\" typeId=\"playAlarmSound\"/>\n-\t\t\t<channel id=\"nextAlarm\" typeId=\"nextAlarm\"/>\n-\t\t\t<channel id=\"nextMusicAlarm\" typeId=\"nextMusicAlarm\"/>\n-\t\t\t<channel id=\"nextTimer\" typeId=\"nextTimer\"/>\n-\t\t\t<channel id=\"startRoutine\" typeId=\"startRoutine\"/>\n-\t\t\t<channel id=\"bluetoothMAC\" typeId=\"bluetoothMAC\"/>\n-\t\t\t<channel id=\"bluetooth\" typeId=\"bluetooth\"/>\n-\t\t\t<channel id=\"bluetoothDeviceName\" typeId=\"bluetoothDeviceName\"/>\n-\t\t\t<channel id=\"lastVoiceCommand\" typeId=\"lastVoiceCommand\"/>\n-\t\t\t<channel id=\"notificationVolume\" typeId=\"notificationVolume\"/>\n-\t\t\t<channel id=\"ascendingAlarm\" typeId=\"ascendingAlarm\"/>\n-\t\t</channels>\n-\t\t<representation-property>serialNumber</representation-property>\n-\t\t<config-description>\n-\t\t\t<parameter name=\"serialNumber\" type=\"text\" required=\"true\">\n-\t\t\t\t<label>Serial Number</label>\n-\t\t\t\t<description>The serial number of the device from the Alexa app</description>\n-\t\t\t</parameter>\n-\t\t</config-description>\n-\t</thing-type>\n-\t<thing-type id=\"wha\">\n-\t\t<supported-bridge-type-refs>\n-\t\t\t<bridge-type-ref id=\"account\"/>\n-\t\t</supported-bridge-type-refs>\n-\t\t<label>Amazon Echo Whole House Audio Control</label>\n-\t\t<description>Amazon Multiroom Music</description>\n-\t\t<channels>\n-\t\t\t<channel id=\"player\" typeId=\"player\"/>\n-\t\t\t<channel id=\"mediaProgressTime\" typeId=\"mediaProgressTime\"/>\n-\t\t\t<channel id=\"mediaProgress\" typeId=\"mediaProgress\"/>\n-\t\t\t<channel id=\"mediaLength\" typeId=\"mediaLength\"/>\n-\t\t\t<channel id=\"shuffle\" typeId=\"shuffle\"/>\n-\t\t\t<channel id=\"imageUrl\" typeId=\"imageUrl\"/>\n-\t\t\t<channel id=\"title\" typeId=\"title\"/>\n-\t\t\t<channel id=\"subtitle1\" typeId=\"subtitle1\"/>\n-\t\t\t<channel id=\"subtitle2\" typeId=\"subtitle2\"/>\n-\t\t\t<channel id=\"providerDisplayName\" typeId=\"providerDisplayName\"/>\n-\t\t\t<channel id=\"radioStationId\" typeId=\"radioStationId\"/>\n-\t\t\t<channel id=\"radio\" typeId=\"radio\"/>\n-\t\t\t<channel id=\"amazonMusicTrackId\" typeId=\"amazonMusicTrackId\"/>\n-\t\t\t<channel id=\"amazonMusicPlayListId\" typeId=\"amazonMusicPlayListId\"/>\n-\t\t\t<channel id=\"amazonMusic\" typeId=\"amazonMusic\"/>\n-\t\t</channels>\n-\t\t<representation-property>serialNumber</representation-property>\n-\t\t<config-description>\n-\t\t\t<parameter name=\"serialNumber\" type=\"text\" required=\"true\">\n-\t\t\t\t<label>Serial Number</label>\n-\t\t\t\t<description>The serial number of the device from the Alexa app</description>\n-\t\t\t</parameter>\n-\t\t</config-description>\n-\t</thing-type>\n-\n-\t<thing-type id=\"flashbriefingprofile\">\n-\t\t<supported-bridge-type-refs>\n-\t\t\t<bridge-type-ref id=\"account\"/>\n-\t\t</supported-bridge-type-refs>\n-\t\t<label>Flash Briefing Profile</label>\n-\t\t<description>Store and load a flash briefing configuration</description>\n-\t\t<channels>\n-\t\t\t<channel id=\"save\" typeId=\"save\"/>\n-\t\t\t<channel id=\"active\" typeId=\"active\"/>\n-\t\t\t<channel id=\"playOnDevice\" typeId=\"playOnDevice\"/>\n-\t\t</channels>\n-\t</thing-type>\n-\t<channel-type id=\"save\">\n-\t\t<item-type>Switch</item-type>\n-\t\t<label>Save</label>\n-\t\t<description>Save the current flash briefing configuration (Write only)</description>\n-\t</channel-type>\n-\t<channel-type id=\"active\">\n-\t\t<item-type>Switch</item-type>\n-\t\t<label>Active</label>\n-\t\t<description>Activate this flash briefing configuration</description>\n-\t</channel-type>\n-\t<channel-type id=\"playOnDevice\" advanced=\"true\">\n-\t\t<item-type>String</item-type>\n-\t\t<label>Play On Device</label>\n-\t\t<description>Plays the briefing on the device (serial number or name, write only)</description>\n-\t</channel-type>\n-\t<channel-type id=\"bluetoothDeviceName\" advanced=\"true\">\n-\t\t<item-type>String</item-type>\n-\t\t<label>Bluetooth Device</label>\n-\t\t<description>Connected bluetooth device</description>\n-\t\t<state readOnly=\"true\"/>\n-\t</channel-type>\n-\t<channel-type id=\"radioStationId\" advanced=\"true\">\n-\t\t<item-type>String</item-type>\n-\t\t<label>TuneIn Radio Station Id</label>\n-\t\t<description>Id of the radio station</description>\n-\t</channel-type>\n-\t<channel-type id=\"remind\" advanced=\"true\">\n-\t\t<item-type>String</item-type>\n-\t\t<label>Remind</label>\n-\t\t<description>Speak the reminder and send a notification to the Alexa app</description>\n-\t</channel-type>\n-\t<channel-type id=\"startRoutine\" advanced=\"true\">\n-\t\t<item-type>String</item-type>\n-\t\t<label>Start a Routine</label>\n-\t\t<description>The command which must be spoken to active the routing without the preceding \"Alexa,\" (Write Only)\n-\t\t</description>\n-\t</channel-type>\n-\t<channel-type id=\"playAlarmSound\" advanced=\"true\">\n-\t\t<item-type>String</item-type>\n-\t\t<label>Alarm Sound</label>\n-\t\t<description>Plays an alarm sound</description>\n-\t</channel-type>\n-\t<channel-type id=\"amazonMusicTrackId\" advanced=\"true\">\n-\t\t<item-type>String</item-type>\n-\t\t<label>Amazon Music Track Id</label>\n-\t\t<description>Id of the amazon music track</description>\n-\t</channel-type>\n-\t<channel-type id=\"amazonMusic\" advanced=\"true\">\n-\t\t<item-type>Switch</item-type>\n-\t\t<label>Amazon Music</label>\n-\t\t<description>Amazon Music turned on</description>\n-\t</channel-type>\n-\t<channel-type id=\"amazonMusicPlayListId\" advanced=\"true\">\n-\t\t<item-type>String</item-type>\n-\t\t<label>Amazon Music Play List Id</label>\n-\t\t<description>Amazon Music play list id (Write only, no current state)</description>\n-\t</channel-type>\n-\t<channel-type id=\"amazonMusicPlayListIdLastUsed\" advanced=\"true\">\n-\t\t<item-type>String</item-type>\n-\t\t<label>Amazon Music Last Selected Playlist Id</label>\n-\t\t<description>Id of the playlist which was started with openHAB</description>\n-\t</channel-type>\n-\t<channel-type id=\"providerDisplayName\" advanced=\"true\">\n-\t\t<item-type>String</item-type>\n-\t\t<label>Provider Name</label>\n-\t\t<description>Name of music provider</description>\n-\t\t<state readOnly=\"true\"/>\n-\t</channel-type>\n-\t<channel-type id=\"bluetoothMAC\">\n-\t\t<item-type>String</item-type>\n-\t\t<label>Bluetooth Connection</label>\n-\t\t<description>MAC-Address of the bluetooth connected device</description>\n-\t</channel-type>\n-\t<channel-type id=\"imageUrl\" advanced=\"true\">\n-\t\t<item-type>String</item-type>\n-\t\t<label>Image Url</label>\n-\t\t<description>Url of the album image or radio station logo</description>\n-\t\t<state readOnly=\"true\"/>\n-\t</channel-type>\n-\t<channel-type id=\"title\">\n-\t\t<item-type>String</item-type>\n-\t\t<label>Title</label>\n-\t\t<description>Title</description>\n-\t\t<state readOnly=\"true\"/>\n-\t</channel-type>\n-\t<channel-type id=\"subtitle1\" advanced=\"true\">\n-\t\t<item-type>String</item-type>\n-\t\t<label>Subtitle 1</label>\n-\t\t<description>Subtitle 1</description>\n-\t\t<state readOnly=\"true\"/>\n-\t</channel-type>\n-\t<channel-type id=\"subtitle2\" advanced=\"true\">\n-\t\t<item-type>String</item-type>\n-\t\t<label>Subtitle 2</label>\n-\t\t<description>Subtitle 2</description>\n-\t\t<state readOnly=\"true\"/>\n-\t</channel-type>\n-\t<channel-type id=\"radio\" advanced=\"true\">\n-\t\t<item-type>Switch</item-type>\n-\t\t<label>TuneIn Radio</label>\n-\t\t<description>Radio turned on</description>\n-\t</channel-type>\n-\t<channel-type id=\"bluetooth\" advanced=\"true\">\n-\t\t<item-type>Switch</item-type>\n-\t\t<label>Bluetooth Connection</label>\n-\t\t<description>Connect to last used device</description>\n-\t</channel-type>\n-\t<channel-type id=\"loop\">\n-\t\t<item-type>Switch</item-type>\n-\t\t<label>Loop</label>\n-\t\t<description>Loop</description>\n-\t</channel-type>\n-\t<channel-type id=\"shuffle\">\n-\t\t<item-type>Switch</item-type>\n-\t\t<label>Shuffle</label>\n-\t\t<description>Shuffle play</description>\n-\t</channel-type>\n-\t<channel-type id=\"player\">\n-\t\t<item-type>Player</item-type>\n-\t\t<label>Player</label>\n-\t\t<description>Music Player</description>\n-\t</channel-type>\n-\t<channel-type id=\"volume\">\n-\t\t<item-type>Dimmer</item-type>\n-\t\t<label>Volume</label>\n-\t\t<description>Volume of the sound</description>\n-\t</channel-type>\n-\t<channel-type id=\"equalizerTreble\">\n-\t\t<item-type>Number</item-type>\n-\t\t<label>Treble</label>\n-\t\t<description>Equalizer Treble</description>\n-\t\t<state min=\"-6\" max=\"6\" step=\"1\"></state>\n-\t</channel-type>\n-\t<channel-type id=\"equalizerMidrange\">\n-\t\t<item-type>Number</item-type>\n-\t\t<label>Midrange</label>\n-\t\t<description>Equalizer Midrange</description>\n-\t\t<state min=\"-6\" max=\"6\" step=\"1\"></state>\n-\t</channel-type>\n-\t<channel-type id=\"equalizerBass\">\n-\t\t<item-type>Number</item-type>\n-\t\t<label>Bass</label>\n-\t\t<description>Equalizer Bass</description>\n-\t\t<state min=\"-6\" max=\"6\" step=\"1\"></state>\n-\t</channel-type>\n-\t<channel-type id=\"musicProviderId\">\n-\t\t<item-type>String</item-type>\n-\t\t<label>Music Provider</label>\n-\t\t<description>Music provider</description>\n-\t</channel-type>\n-\t<channel-type id=\"playMusicVoiceCommand\">\n-\t\t<item-type>String</item-type>\n-\t\t<label>Music Voice Command</label>\n-\t\t<description>Voice command as text. E.g. 'Yesterday from the Beatles' (Write only)</description>\n-\t</channel-type>\n-\t<channel-type id=\"sendMessage\" advanced=\"false\">\n-\t\t<item-type>String</item-type>\n-\t\t<label>Send Message</label>\n-\t\t<description>Sends a message to the Echo devices (Write only).</description>\n-\t</channel-type>\n-\t<channel-type id=\"announcement\" advanced=\"true\">\n-\t\t<item-type>String</item-type>\n-\t\t<label>Announcement</label>\n-\t\t<description>Display the announcement message on the display (Write only). See in the tutorial section of the binding\n-\t\t\tdescription to learn how it's possible to set the title and turn off the sound.</description>\n-\t</channel-type>\n-\t<channel-type id=\"textToSpeech\" advanced=\"true\">\n-\t\t<item-type>String</item-type>\n-\t\t<label>Speak</label>\n-\t\t<description>Speak the text (Write only). It is possible to use plain text or SSML: &lt;speak&gt;I want to tell you a\n-\t\t\tsecret.&lt;amazon:effect name=&quot;whispered&quot;&gt;I am not a real human.&lt;/amazon:effect&gt;.Can you believe\n-\t\t\tit?&lt;/speak&gt;</description>\n-\t</channel-type>\n-\t<channel-type id=\"textToSpeechVolume\" advanced=\"true\">\n-\t\t<item-type>Dimmer</item-type>\n-\t\t<label>Speak Volume</label>\n-\t\t<description>Volume of the Speak channel. If 0, the current volume will be used.</description>\n-\t</channel-type>\n-\t<channel-type id=\"lastVoiceCommand\" advanced=\"true\">\n-\t\t<item-type>String</item-type>\n-\t\t<label>Last Voice Command</label>\n-\t\t<description>Last voice command spoken to the device. Writing to the channel starts voice output.</description>\n-\t\t<state readOnly=\"false\"/>\n-\t</channel-type>\n-\t<channel-type id=\"mediaProgress\" advanced=\"false\">\n-\t\t<item-type>Dimmer</item-type>\n-\t\t<label>Media Progress</label>\n-\t\t<description>Media progress in percent</description>\n-\t\t<state readOnly=\"false\"/>\n-\t</channel-type>\n-\t<channel-type id=\"mediaProgressTime\" advanced=\"true\">\n-\t\t<item-type>Number:Time</item-type>\n-\t\t<label>Media Play Time</label>\n-\t\t<description>Media play time</description>\n-\t\t<state readOnly=\"false\" pattern=\"%d %unit%\"/>\n-\t</channel-type>\n-\t<channel-type id=\"mediaLength\" advanced=\"true\">\n-\t\t<item-type>Number:Time</item-type>\n-\t\t<label>Media Length</label>\n-\t\t<description>Media length</description>\n-\t\t<state readOnly=\"true\" pattern=\"%d %unit%\"/>\n-\t</channel-type>\n-\t<channel-type id=\"startCommand\">\n-\t\t<item-type>String</item-type>\n-\t\t<label>Start</label>\n-\t\t<description>Start information (Write only)</description>\n-\t\t<state pattern=\"String\" readOnly=\"false\">\n-\t\t\t<options>\n-\t\t\t\t<option value=\"Weather\">Weather</option>\n-\t\t\t\t<option value=\"Traffic\">Traffic</option>\n-\t\t\t\t<option value=\"GoodMorning\">Good morning</option>\n-\t\t\t\t<option value=\"SingASong\">Song</option>\n-\t\t\t\t<option value=\"TellStory\">Story</option>\n-\t\t\t\t<option value=\"FlashBriefing\">Flash briefing</option>\n-\t\t\t</options>\n-\t\t</state>\n-\t</channel-type>\n-\t<channel-type id=\"notificationVolume\" advanced=\"true\">\n-\t\t<item-type>Dimmer</item-type>\n-\t\t<label>Notification Volume</label>\n-\t\t<description>Notification Volume</description>\n-\t\t<state readOnly=\"false\"/>\n-\t</channel-type>\n-\t<channel-type id=\"ascendingAlarm\" advanced=\"true\">\n-\t\t<item-type>Switch</item-type>\n-\t\t<label>Ascending Alarm</label>\n-\t\t<description>Ascending alarm up to the configured volume</description>\n-\t\t<state readOnly=\"false\"/>\n-\t</channel-type>\n-\t<channel-type id=\"nextReminder\" advanced=\"true\">\n-\t\t<item-type>DateTime</item-type>\n-\t\t<label>Next Reminder</label>\n-\t\t<description>Next Reminder</description>\n-\t\t<state readOnly=\"true\"/>\n-\t</channel-type>\n-\t<channel-type id=\"nextAlarm\" advanced=\"true\">\n-\t\t<item-type>DateTime</item-type>\n-\t\t<label>Next Alarm</label>\n-\t\t<description>Next alarm</description>\n-\t\t<state readOnly=\"true\"/>\n-\t</channel-type>\n-\t<channel-type id=\"nextMusicAlarm\" advanced=\"true\">\n-\t\t<item-type>DateTime</item-type>\n-\t\t<label>Next Music Alarm</label>\n-\t\t<description>Next music alarm</description>\n-\t\t<state readOnly=\"true\"/>\n-\t</channel-type>\n-\t<channel-type id=\"nextTimer\" advanced=\"true\">\n-\t\t<item-type>DateTime</item-type>\n-\t\t<label>Next Timer</label>\n-\t\t<description>Next timer</description>\n-\t\t<state readOnly=\"true\"/>\n-\t</channel-type>\n-</thing:thing-descriptions>\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n+<thing:thing-descriptions xmlns:thing=\"https://openhab.org/schemas/thing-description/v1.0.0\"\r\n+\txmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" bindingId=\"amazonechocontrol\"\r\n+\txsi:schemaLocation=\"https://openhab.org/schemas/thing-description/v1.0.0 https://openhab.org/schemas/thing-description-1.0.0.xsd\">\r\n+\t<bridge-type id=\"account\">\r\n+\t\t<label>Amazon Account</label>\r\n+\t\t<description>Amazon Account where the amazon echo devices are registered.</description>\r\n+\t\t<channels>\r\n+\t\t\t<channel id=\"sendMessage\" typeId=\"sendMessage\"/>\r\n+\t\t</channels>\r\n+\t\t<config-description>\r\n+\t\t\t<parameter name=\"discoverSmartHome\" type=\"integer\">\r\n+\t\t\t\t<default>0</default>\r\n+\t\t\t\t<description>Defines if openHAB should discover devices connected to the Amazon Echo.</description>\r", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "6ded87597331cfd222f3ea203480a4c2f31ae440"}, "originalPosition": 485}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDM3NzczOTcy", "url": "https://github.com/openhab/openhab-addons/pull/7969#pullrequestreview-437773972", "createdAt": "2020-06-25T18:57:07Z", "commit": {"oid": "9f58cb39656f09a129b0e3edae57d94479d99176"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0fea431286f0ab2d1801526d861d518296e10121", "author": {"user": {"login": "J-N-K", "name": null}}, "url": "https://github.com/openhab/openhab-addons/commit/0fea431286f0ab2d1801526d861d518296e10121", "committedDate": "2020-06-26T14:53:50Z", "message": "Fix issues, codestyle and refactoring\n\nSigned-off-by: Jan N. Klug <jan.n.klug@rub.de>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9f58cb39656f09a129b0e3edae57d94479d99176", "author": {"user": {"login": "J-N-K", "name": null}}, "url": "https://github.com/openhab/openhab-addons/commit/9f58cb39656f09a129b0e3edae57d94479d99176", "committedDate": "2020-06-25T16:29:20Z", "message": "address review comments\n\nSigned-off-by: Jan N. Klug <jan.n.klug@rub.de>"}, "afterCommit": {"oid": "0fea431286f0ab2d1801526d861d518296e10121", "author": {"user": {"login": "J-N-K", "name": null}}, "url": "https://github.com/openhab/openhab-addons/commit/0fea431286f0ab2d1801526d861d518296e10121", "committedDate": "2020-06-26T14:53:50Z", "message": "Fix issues, codestyle and refactoring\n\nSigned-off-by: Jan N. Klug <jan.n.klug@rub.de>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyNDM4MDA5", "url": "https://github.com/openhab/openhab-addons/pull/7969#pullrequestreview-442438009", "createdAt": "2020-07-03T14:09:55Z", "commit": {"oid": "0fea431286f0ab2d1801526d861d518296e10121"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QxNDowOTo1NVrOGsxj9g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QxNDowOTo1NVrOGsxj9g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTYwMjU1MA==", "bodyText": "Duplicate channel row", "url": "https://github.com/openhab/openhab-addons/pull/7969#discussion_r449602550", "createdAt": "2020-07-03T14:09:55Z", "author": {"login": "digitaldan"}, "path": "bundles/org.openhab.binding.amazonechocontrol/README.md", "diffHunk": "@@ -119,21 +162,23 @@ It will be configured at runtime by using the save channel to store the current\n | bluetoothDeviceName   | String      | R           | echo, echoshow, echospot      | User friendly name of the connected bluetooth device\n | radioStationId        | String      | R/W         | echo, echoshow, echospot, wha | Start playing of a TuneIn radio station by specifying its id or stops playing if an empty string was provided\n | radio                 | Switch      | R/W         | echo, echoshow, echospot, wha | Start playing of the last used TuneIn radio station (works after the radio station started after the openhab start)\n+| amazonMusicTrackId    | String      | R/W         | echo, echoshow, echospot, wha | Start playing of an Amazon Music track by specifying its id or stops playing if an empty string was provided\n+| amazonMusicPlayListId | String      | W           | echo, echoshow, echospot, wha | Write Only! Start playing of an Amazon Music playlist by specifying its id or stops playing if an empty string was provided. Selection will only work in PaperUI\n | amazonMusicTrackId    | String      | R/W         | echo, echoshow, echospot, wha | Start playing of an Amazon Music track by its id or stops playing if an empty string was provided", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0fea431286f0ab2d1801526d861d518296e10121"}, "originalPosition": 133}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDQyNDM4MTE3", "url": "https://github.com/openhab/openhab-addons/pull/7969#pullrequestreview-442438117", "createdAt": "2020-07-03T14:10:05Z", "commit": {"oid": "0fea431286f0ab2d1801526d861d518296e10121"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QxNDoxMDowNVrOGsxkSg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0wM1QxNDoxMDowNVrOGsxkSg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTYwMjYzNA==", "bodyText": "Duplicate channel row", "url": "https://github.com/openhab/openhab-addons/pull/7969#discussion_r449602634", "createdAt": "2020-07-03T14:10:05Z", "author": {"login": "digitaldan"}, "path": "bundles/org.openhab.binding.amazonechocontrol/README.md", "diffHunk": "@@ -119,21 +162,23 @@ It will be configured at runtime by using the save channel to store the current\n | bluetoothDeviceName   | String      | R           | echo, echoshow, echospot      | User friendly name of the connected bluetooth device\n | radioStationId        | String      | R/W         | echo, echoshow, echospot, wha | Start playing of a TuneIn radio station by specifying its id or stops playing if an empty string was provided\n | radio                 | Switch      | R/W         | echo, echoshow, echospot, wha | Start playing of the last used TuneIn radio station (works after the radio station started after the openhab start)\n+| amazonMusicTrackId    | String      | R/W         | echo, echoshow, echospot, wha | Start playing of an Amazon Music track by specifying its id or stops playing if an empty string was provided\n+| amazonMusicPlayListId | String      | W           | echo, echoshow, echospot, wha | Write Only! Start playing of an Amazon Music playlist by specifying its id or stops playing if an empty string was provided. Selection will only work in PaperUI\n | amazonMusicTrackId    | String      | R/W         | echo, echoshow, echospot, wha | Start playing of an Amazon Music track by its id or stops playing if an empty string was provided\n | amazonMusicPlayListId | String      | W           | echo, echoshow, echospot, wha | Write Only! Start playing of an Amazon Music playlist by specifying its id or stops playing if an empty string was provided. Selection will only work in PaperUI", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0fea431286f0ab2d1801526d861d518296e10121"}, "originalPosition": 134}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c84020e109229e2822aced482ed9b3546454bf41", "author": {"user": {"login": "J-N-K", "name": null}}, "url": "https://github.com/openhab/openhab-addons/commit/c84020e109229e2822aced482ed9b3546454bf41", "committedDate": "2020-07-05T11:01:59Z", "message": "address review comment\n\nSigned-off-by: Jan N. Klug <jan.n.klug@rub.de>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7c839a7c1a25e13fbe5ae926861eb9360e8c8052", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/7c839a7c1a25e13fbe5ae926861eb9360e8c8052", "committedDate": "2019-05-11T11:12:52Z", "message": "[amazonechocontrol]\nFix json parsing\nSigned-off-by: Michael Geramb <mail@michael-geramb.at> (github: mgeramb)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "35154c11a43fd0d49630d86f34bc36e1442b2559", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/35154c11a43fd0d49630d86f34bc36e1442b2559", "committedDate": "2019-05-12T06:19:52Z", "message": "[amazonechocontrol]\nImprove error handling\nSigned-off-by: Michael Geramb <mail@michael-geramb.at> (github: mgeramb)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "94494da65440dbe8ee1a48e3edfca2af736f63de", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/94494da65440dbe8ee1a48e3edfca2af736f63de", "committedDate": "2019-05-12T08:27:17Z", "message": "[amazonechocontrol]\nRemove unused Exception\nSigned-off-by: Michael Geramb <mail@michael-geramb.at> (github: mgeramb)\n\nSigned-off-by: Michael Geramb <mail@michael-geramb.at>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d75261f09cddae509cdcebccd631217f563e3fcd", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/d75261f09cddae509cdcebccd631217f563e3fcd", "committedDate": "2019-05-15T16:07:13Z", "message": "Merge branch 'master' of https://github.com/openhab/openhab2-addons"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "eef3b2eb37c873095432a972f6aab59f4558c385", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/eef3b2eb37c873095432a972f6aab59f4558c385", "committedDate": "2019-05-20T18:04:57Z", "message": "Merge branch 'master' of https://github.com/openhab/openhab2-addons"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "43e814448bdf0c34be07e8ab5fde1ae41e6a4871", "author": {"user": {"login": "lkn94", "name": "Lukas Knoeller"}}, "url": "https://github.com/openhab/openhab-addons/commit/43e814448bdf0c34be07e8ab5fde1ae41e6a4871", "committedDate": "2019-06-08T20:44:31Z", "message": "Changes for new build system"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "611b9fd6ba39a4583ae3018502dd300ba62e0e89", "author": {"user": {"login": "lkn94", "name": "Lukas Knoeller"}}, "url": "https://github.com/openhab/openhab-addons/commit/611b9fd6ba39a4583ae3018502dd300ba62e0e89", "committedDate": "2019-06-09T17:29:50Z", "message": "Original"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bbdcbf8c5586f7ae2f973e84eb54087b02b2c17c", "author": {"user": {"login": "lkn94", "name": "Lukas Knoeller"}}, "url": "https://github.com/openhab/openhab-addons/commit/bbdcbf8c5586f7ae2f973e84eb54087b02b2c17c", "committedDate": "2019-06-09T19:35:14Z", "message": "Bugfixed for new version and merge request"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "987d8ebe73d35694ba8d1bfe1b5084e806f61cee", "author": {"user": {"login": "lkn94", "name": "Lukas Knoeller"}}, "url": "https://github.com/openhab/openhab-addons/commit/987d8ebe73d35694ba8d1bfe1b5084e806f61cee", "committedDate": "2019-06-09T19:39:48Z", "message": "Added license information and author"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b2d9d0f5e74d93c39dff5fcd834e9d40e344838e", "author": {"user": {"login": "lkn94", "name": "Lukas Knoeller"}}, "url": "https://github.com/openhab/openhab-addons/commit/b2d9d0f5e74d93c39dff5fcd834e9d40e344838e", "committedDate": "2019-06-10T07:52:00Z", "message": "Added contributor and readme information"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "286eb47bca61d60e13e36173442151de4c9bf1ee", "author": {"user": {"login": "lkn94", "name": "Lukas Knoeller"}}, "url": "https://github.com/openhab/openhab-addons/commit/286eb47bca61d60e13e36173442151de4c9bf1ee", "committedDate": "2019-06-22T14:35:06Z", "message": "Uncommented test comment for production use"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "336a7e1cf4bb9d46eb2edc7ff0bc8d50bea82581", "author": {"user": {"login": "lkn94", "name": "Lukas Knoeller"}}, "url": "https://github.com/openhab/openhab-addons/commit/336a7e1cf4bb9d46eb2edc7ff0bc8d50bea82581", "committedDate": "2019-06-22T14:40:23Z", "message": "Removed the waitForUpdate variable - not used"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4b8a52083a3e8cc4eebef6f7b6d2792d6b1dd8bd", "author": {"user": {"login": "lkn94", "name": "Lukas Knoeller"}}, "url": "https://github.com/openhab/openhab-addons/commit/4b8a52083a3e8cc4eebef6f7b6d2792d6b1dd8bd", "committedDate": "2019-06-30T10:55:17Z", "message": "Added two configurations params for pulling interval and activating the smart bulbs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "01f74fb46e6dd0a48438bc0175982e9dc19f060a", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/01f74fb46e6dd0a48438bc0175982e9dc19f060a", "committedDate": "2019-07-04T19:05:03Z", "message": "Merge branch 'master' of https://github.com/openhab/openhab2-addons"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "18603269aa9450969997e2db6e60eecce25c4dd7", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/18603269aa9450969997e2db6e60eecce25c4dd7", "committedDate": "2019-07-04T19:22:43Z", "message": "Merge branch 'SmartHome' into original"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "59c9d18c0d90585b714b7769cea6be07f7fd1613", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/59c9d18c0d90585b714b7769cea6be07f7fd1613", "committedDate": "2019-07-04T19:23:42Z", "message": "Merge pull request #2 from lkn94/original\n\nAdded new functions for the binding"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7e234da391317dd73dcd868caf8e6e12fff0ed38", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/7e234da391317dd73dcd868caf8e6e12fff0ed38", "committedDate": "2019-07-04T19:47:35Z", "message": "[amazonechocontrol]\nFormatting change\nSigned-off-by: Michael Geramb <mail@michael-geramb.at>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "08d8636f165d978517a4b82af6374bf9e122bfd9", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/08d8636f165d978517a4b82af6374bf9e122bfd9", "committedDate": "2019-07-14T20:11:05Z", "message": "[amazonechocontrol]\nFix for Announcment Channel\nSigned-off-by: Michael Geramb <mail@michael-geramb.at> (github: mgeramb)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "35434d9ddf1e7806ae6a387a1c3ebee24eaf15b8", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/35434d9ddf1e7806ae6a387a1c3ebee24eaf15b8", "committedDate": "2019-07-14T20:26:00Z", "message": "[amazonechocontrol]\nFix for Announcment Channel\nSigned-off-by: Michael Geramb <mail@michael-geramb.at> (github: mgeramb)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "717cded710c60d0c8326bf23644f5a64ff3c960a", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/717cded710c60d0c8326bf23644f5a64ff3c960a", "committedDate": "2019-07-14T20:37:13Z", "message": "[amazonechocontrol]\nFix for Announcment Channel\nSigned-off-by: Michael Geramb <mail@michael-geramb.at> (github: mgeramb)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1f352a411c10feaa7b1a49f1343e58e87ed72af5", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/1f352a411c10feaa7b1a49f1343e58e87ed72af5", "committedDate": "2019-07-14T20:42:38Z", "message": "[amazonechocontrol]\nFix for Announcment Channel\nSigned-off-by: Michael Geramb <mail@michael-geramb.at> (github: mgeramb)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0b9b4387caf732ff02dbe1673d773875b3fb12af", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/0b9b4387caf732ff02dbe1673d773875b3fb12af", "committedDate": "2019-07-14T20:54:52Z", "message": "[amazonechocontrol]\nFix for Announcment Channel\nSigned-off-by: Michael Geramb <mail@michael-geramb.at> (github: mgeramb)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3dd6b570aeb9c013ee14f2015daedb72ef0f53fe", "author": {"user": {"login": "lkn94", "name": "Lukas Knoeller"}}, "url": "https://github.com/openhab/openhab-addons/commit/3dd6b570aeb9c013ee14f2015daedb72ef0f53fe", "committedDate": "2019-07-17T18:04:52Z", "message": "Merge pull request #1 from mgeramb/SmartHome\n\nSmart home"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "208d6f55229c78ae79a0513bfd224719424d037b", "author": {"user": {"login": "lkn94", "name": "Lukas Knoeller"}}, "url": "https://github.com/openhab/openhab-addons/commit/208d6f55229c78ae79a0513bfd224719424d037b", "committedDate": "2019-07-17T20:49:44Z", "message": "Bugfixed discovery"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5def872ba7609e573950ec96516401c7ee6be167", "author": {"user": {"login": "lkn94", "name": "Lukas Knoeller"}}, "url": "https://github.com/openhab/openhab-addons/commit/5def872ba7609e573950ec96516401c7ee6be167", "committedDate": "2019-07-17T20:50:28Z", "message": "Merge branch 'original' of https://github.com/lkn94/openhab2-addons into original"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0ea5cde20ab0ca8d105ae2bb7a7ff0a670330d02", "author": {"user": {"login": "lkn94", "name": "Lukas Knoeller"}}, "url": "https://github.com/openhab/openhab-addons/commit/0ea5cde20ab0ca8d105ae2bb7a7ff0a670330d02", "committedDate": "2019-07-17T20:57:53Z", "message": "Bugfixed wrong entries of the amazon echo devices as lights"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4d44bdaef1ac325c225281a01d0d40b4990ea7a7", "author": {"user": {"login": "lkn94", "name": "Lukas Knoeller"}}, "url": "https://github.com/openhab/openhab-addons/commit/4d44bdaef1ac325c225281a01d0d40b4990ea7a7", "committedDate": "2019-07-17T20:59:41Z", "message": "Merge pull request #2 from lkn94/original\n\nOriginal"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a0f751be66701019778f99835438f0fc3c589339", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/a0f751be66701019778f99835438f0fc3c589339", "committedDate": "2019-07-18T11:36:10Z", "message": "Merge pull request #3 from lkn94/SmartHome\n\nBugfixed amazon echo/smart home discovery"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "73796fb917048631235f2b0e07fbe5aabab3ccba", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/73796fb917048631235f2b0e07fbe5aabab3ccba", "committedDate": "2019-07-18T12:42:23Z", "message": "[amazonechocontrol]\nFix for Announcment Channel\nSigned-off-by: Michael Geramb <mail@michael-geramb.at> (github: mgeramb)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "340e4f6e41cf01bae12feee7b2e4b82b50fc0048", "author": {"user": {"login": "lkn94", "name": "Lukas Knoeller"}}, "url": "https://github.com/openhab/openhab-addons/commit/340e4f6e41cf01bae12feee7b2e4b82b50fc0048", "committedDate": "2019-07-18T13:26:35Z", "message": "Merge pull request #3 from mgeramb/TestSmartHomeDeviceList\n\nTest smart home device list"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "49901188ef004464dfa26e7b389106e930c839d2", "author": {"user": {"login": "lkn94", "name": "Lukas Knoeller"}}, "url": "https://github.com/openhab/openhab-addons/commit/49901188ef004464dfa26e7b389106e930c839d2", "committedDate": "2019-07-25T22:09:24Z", "message": "Implemented recursive searching for devices, filtered smart plugs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0eb5d490a76bbea2a7acab29265f745b4cfaa65e", "author": {"user": {"login": "lkn94", "name": "Lukas Knoeller"}}, "url": "https://github.com/openhab/openhab-addons/commit/0eb5d490a76bbea2a7acab29265f745b4cfaa65e", "committedDate": "2019-07-26T08:33:44Z", "message": "Added smart plugs"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7683a3e09fd89f389387d3d58ff52f54ea8dcd08", "author": {"user": {"login": "lkn94", "name": "Lukas Knoeller"}}, "url": "https://github.com/openhab/openhab-addons/commit/7683a3e09fd89f389387d3d58ff52f54ea8dcd08", "committedDate": "2019-07-26T22:14:28Z", "message": "Removed unused code, renamed new function and it's references"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7fdb24c6087ae5ffed66d494c78e1f37139a3d45", "author": {"user": {"login": "lkn94", "name": "Lukas Knoeller"}}, "url": "https://github.com/openhab/openhab-addons/commit/7fdb24c6087ae5ffed66d494c78e1f37139a3d45", "committedDate": "2019-07-27T11:25:22Z", "message": "Added translation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e9586a4798529d7d1796d1a3cefe5d55daf3d564", "author": {"user": {"login": "lkn94", "name": "Lukas Knoeller"}}, "url": "https://github.com/openhab/openhab-addons/commit/e9586a4798529d7d1796d1a3cefe5d55daf3d564", "committedDate": "2019-07-27T11:31:11Z", "message": "Added documentation"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9f22076f10c36959bb42080f0f2350e59ee49c2d", "author": {"user": {"login": "lkn94", "name": "Lukas Knoeller"}}, "url": "https://github.com/openhab/openhab-addons/commit/9f22076f10c36959bb42080f0f2350e59ee49c2d", "committedDate": "2019-07-28T16:07:29Z", "message": "Added capabilities to smart home device"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a679e716fbde6411752f8fcb95ee3895cc02836e", "author": {"user": {"login": "lkn94", "name": "Lukas Knoeller"}}, "url": "https://github.com/openhab/openhab-addons/commit/a679e716fbde6411752f8fcb95ee3895cc02836e", "committedDate": "2019-07-31T21:19:18Z", "message": "Added dynamic channel adding"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a5210e693f43d6ba467145bbced96a6e722666fa", "author": {"user": {"login": "lkn94", "name": "Lukas Knoeller"}}, "url": "https://github.com/openhab/openhab-addons/commit/a5210e693f43d6ba467145bbced96a6e722666fa", "committedDate": "2019-07-31T21:25:05Z", "message": "Merge pull request #4 from lkn94/TestSmartHomeDeviceList\n\nTest smart home device list"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e85bea82cb8ded6fe6e8cb3c16ffb49526780ffa", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/e85bea82cb8ded6fe6e8cb3c16ffb49526780ffa", "committedDate": "2019-08-05T17:41:05Z", "message": "Merge pull request #4 from lkn94/SmartHome\n\nSmart home"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "58e54cd97f61aad9ba0a9c05db0352a3fe308e2c", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/58e54cd97f61aad9ba0a9c05db0352a3fe308e2c", "committedDate": "2019-08-05T18:42:45Z", "message": "[amazonechocontrol]\nImprove smart home discover and and add options for openHAB smarthome devices\nSigned-off-by: Michael Geramb <mail@michael-geramb.at> (github: mgeramb)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bc792118ee777f1ebc12aa223f74939be8a432e5", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/bc792118ee777f1ebc12aa223f74939be8a432e5", "committedDate": "2019-08-15T07:16:09Z", "message": "Merge branch 'master' of https://github.com/openhab/openhab2-addons"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6cd3a7cb6c865728694cd7a27da6d24b73480225", "author": {"user": {"login": "lkn94", "name": "Lukas Knoeller"}}, "url": "https://github.com/openhab/openhab-addons/commit/6cd3a7cb6c865728694cd7a27da6d24b73480225", "committedDate": "2019-08-18T11:50:56Z", "message": "Merge pull request #5 from mgeramb/SmartHome\n\nSmart home"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4879687490219a610bf28f0659f71209ad9aa6d5", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/4879687490219a610bf28f0659f71209ad9aa6d5", "committedDate": "2019-09-01T08:17:57Z", "message": "[amazonechocontrol]\nHandle on/off in percentage channel\nSigned-off-by: Michael Geramb <mail@michael-geramb.at> (github: mgeramb)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a87ca63eb842196cc85e2b140f3afdd17234739b", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/a87ca63eb842196cc85e2b140f3afdd17234739b", "committedDate": "2019-09-01T13:08:26Z", "message": "[amazonechocontrol]\nSmart Home Device Handling\nSigned-off-by: Michael Geramb <mail@michael-geramb.at> (github: mgeramb)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "018b7d1bc390d35c262ca842a178e84d97f37747", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/018b7d1bc390d35c262ca842a178e84d97f37747", "committedDate": "2019-09-02T21:28:00Z", "message": "[amazonechocontrol]\nUpdate Smart Home Device Handling\nSigned-off-by: Michael Geramb <mail@michael-geramb.at> (github: mgeramb)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "37e83877443035d1923c94caa605ecc815847d8d", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/37e83877443035d1923c94caa605ecc815847d8d", "committedDate": "2019-09-03T05:59:33Z", "message": "[amazonechocontrol]\nMove Polling Timer to Account Handler\nSigned-off-by: Michael Geramb <mail@michael-geramb.at> (github: mgeramb)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "981c903bf4f69e7dc4c367691d0a2ff6dea2b112", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/981c903bf4f69e7dc4c367691d0a2ff6dea2b112", "committedDate": "2019-09-03T06:07:12Z", "message": "[amazonechocontrol]\nRemove polling from smart home handler\nSigned-off-by: Michael Geramb <mail@michael-geramb.at> (github: mgeramb)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ce86f74517bed867a522b59d9b020062d36af7b4", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/ce86f74517bed867a522b59d9b020062d36af7b4", "committedDate": "2019-09-04T18:52:41Z", "message": "[amazonechocontrol]\nupdate state\nSigned-off-by: Michael Geramb <mail@michael-geramb.at> (github: mgeramb)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a39a2510085d861c93824b6f2e49ab87df61b11f", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/a39a2510085d861c93824b6f2e49ab87df61b11f", "committedDate": "2019-09-04T20:40:04Z", "message": "[amazonechocontrol]\nUpdate State\nSigned-off-by: Michael Geramb <mail@michael-geramb.at> (github: mgeramb)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4c4dd8558ff83bc5d16f7c0642f1bf19378aac26", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/4c4dd8558ff83bc5d16f7c0642f1bf19378aac26", "committedDate": "2019-09-05T18:29:51Z", "message": "[amazonechocontrol]\nupdate state handling and readme\nSigned-off-by: Michael Geramb <mail@michael-geramb.at> (github: mgeramb)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32c9cd0fa4bad7ab858dc7916fc88399b65b049d", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/32c9cd0fa4bad7ab858dc7916fc88399b65b049d", "committedDate": "2019-09-05T19:44:37Z", "message": "[amazonechocontrol]\nAlexa guard support\nSigned-off-by: Michael Geramb <mail@michael-geramb.at> (github: mgeramb)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "47c8a5ee1d9b9f732adf4baf00b2aaafbfcc651f", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/47c8a5ee1d9b9f732adf4baf00b2aaafbfcc651f", "committedDate": "2019-09-06T15:53:24Z", "message": "[amazonechocontrol]\nMerge master from OH\nSigned-off-by: Michael Geramb <mail@michael-geramb.at> (github: mgeramb)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e757bdebaddad0d0dfa4793cbd607ea05aa6cf42", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/e757bdebaddad0d0dfa4793cbd607ea05aa6cf42", "committedDate": "2019-09-06T17:09:35Z", "message": "Merge branch 'master' of https://github.com/openhab/openhab2-addons"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "be69b72df9533892c9f39eb87c9031f2f987342f", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/be69b72df9533892c9f39eb87c9031f2f987342f", "committedDate": "2019-09-06T17:11:47Z", "message": "[amazonechocontrol] Bugfix for login in Australia (#6034)\n\nSigned-off-by: Michael Geramb <mail@michael-geramb.at>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "529dcf3feddba1ac724b4428d9dc27f30c0bf429", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/529dcf3feddba1ac724b4428d9dc27f30c0bf429", "committedDate": "2019-09-07T08:13:39Z", "message": "[amazonechocontrol]\nFix invalid device state\nSigned-off-by: Michael Geramb <mail@michael-geramb.at> (github: mgeramb)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "842bf2fa1bf52d1db40094ee347a1047acf70b3b", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/842bf2fa1bf52d1db40094ee347a1047acf70b3b", "committedDate": "2019-09-07T09:00:06Z", "message": "[amazonechocontrol]\nBugfix and docu for announcment\nSigned-off-by: Michael Geramb <mail@michael-geramb.at> (github: mgeramb)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "de011da6ea701678bd88fcec89573c5a7c9133b9", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/de011da6ea701678bd88fcec89573c5a7c9133b9", "committedDate": "2019-09-07T09:21:26Z", "message": "[amazonechocontrol]\nMerge from master\nSigned-off-by: Michael Geramb <mail@michael-geramb.at> (github: mgeramb)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e6469bd6b04fdf7a29cccc4c292c639bb902a629", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/e6469bd6b04fdf7a29cccc4c292c639bb902a629", "committedDate": "2019-09-07T09:31:39Z", "message": "[amazonechocontrol]\nBugfix and docu for announcment\nSigned-off-by: Michael Geramb <mail@michael-geramb.at> (github: mgeramb)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8751a781a6b397c7237d9a6efeaa149d748e9305", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/8751a781a6b397c7237d9a6efeaa149d748e9305", "committedDate": "2019-09-07T19:16:46Z", "message": "[amazonechocontrol]\nRefactoring\nSigned-off-by: Michael Geramb <mail@michael-geramb.at> (github: mgeramb)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "06e817d05f0c44b52385fa3bb96b4ccbe26d1ef5", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/06e817d05f0c44b52385fa3bb96b4ccbe26d1ef5", "committedDate": "2019-09-07T20:27:04Z", "message": "[amazonechocontrol]\nFix duplicate channel registration\nSigned-off-by: Michael Geramb <mail@michael-geramb.at> (github: mgeramb)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9511d971a7f39568f458e82a12793579d51a3640", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/9511d971a7f39568f458e82a12793579d51a3640", "committedDate": "2019-09-07T22:01:45Z", "message": "[amazonechocontrol]\nFix updates\nSigned-off-by: Michael Geramb <mail@michael-geramb.at> (github: mgeramb)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f190c7e9c0210f8699e7045c8bd50389cc1eab75", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/f190c7e9c0210f8699e7045c8bd50389cc1eab75", "committedDate": "2019-09-08T07:02:34Z", "message": "[amazonechocontrol]\nSkill device detection\nSigned-off-by: Michael Geramb <mail@michael-geramb.at> (github: mgeramb)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7f14476a8b59f60796d0fa9787c10faa83e9747d", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/7f14476a8b59f60796d0fa9787c10faa83e9747d", "committedDate": "2019-09-08T08:04:11Z", "message": "[amazonechocontrol]\nImprove channel handling\nSigned-off-by: Michael Geramb <mail@michael-geramb.at> (github: mgeramb)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "af25daf001532f86b50a1565f0337cb4e0b4c87e", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/af25daf001532f86b50a1565f0337cb4e0b4c87e", "committedDate": "2019-09-08T08:43:33Z", "message": "[amazonechocontrol]\nColor Name handling\nSigned-off-by: Michael Geramb <mail@michael-geramb.at> (github: mgeramb)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "60d884ac1a208ff59d13a545db7fb6c1582032c8", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/60d884ac1a208ff59d13a545db7fb6c1582032c8", "committedDate": "2019-09-08T10:05:37Z", "message": "[amazonechocontrol]\nSingle device update\nSigned-off-by: Michael Geramb <mail@michael-geramb.at> (github: mgeramb)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7263e92f08c248792a981fa6e53da3db3ef01ac5", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/7263e92f08c248792a981fa6e53da3db3ef01ac5", "committedDate": "2019-09-08T10:52:26Z", "message": "[amazonechocontrol]\nColor handling\nSigned-off-by: Michael Geramb <mail@michael-geramb.at> (github: mgeramb)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "32f943f23e4b458182e4a50ff99a1e8ea672e408", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/32f943f23e4b458182e4a50ff99a1e8ea672e408", "committedDate": "2019-09-09T04:57:07Z", "message": "[amazonechocontrol]\nHandle Security Panel Controller\nSigned-off-by: Michael Geramb <mail@michael-geramb.at> (github: mgeramb)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8a5b69a6393db3d4279ed9ed038c429c8224fa0e", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/8a5b69a6393db3d4279ed9ed038c429c8224fa0e", "committedDate": "2019-09-09T16:45:53Z", "message": "[amazonechocontrol]\nColor handling\nSigned-off-by: Michael Geramb <mail@michael-geramb.at> (github: mgeramb)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6addb5885d86b08c7ee5540cab9d3c0c3b2a6d58", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/6addb5885d86b08c7ee5540cab9d3c0c3b2a6d58", "committedDate": "2019-09-09T18:05:04Z", "message": "[amazonechocontrol]\nAlexa.AcousticEventSensor added\nSigned-off-by: Michael Geramb <mail@michael-geramb.at> (github: mgeramb)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b46f8ec7d8ed50f860b7b1813f97bf3e64b6440f", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/b46f8ec7d8ed50f860b7b1813f97bf3e64b6440f", "committedDate": "2019-09-09T18:31:10Z", "message": "[amazonechocontrol]\nCode cleanup\nSigned-off-by: Michael Geramb <mail@michael-geramb.at> (github: mgeramb)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e33ba2842960a42b056103f36dd8b983732f5aa3", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/e33ba2842960a42b056103f36dd8b983732f5aa3", "committedDate": "2019-09-09T19:26:46Z", "message": "[amazonechocontrol]\nAlexa.TemperatureSensor Interface\nSigned-off-by: Michael Geramb <mail@michael-geramb.at> (github: mgeramb)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "083c53278ab3a19c9b8d55408456dc61f685b27b", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/083c53278ab3a19c9b8d55408456dc61f685b27b", "committedDate": "2019-09-09T19:54:22Z", "message": "[amazonechocontrol]\nPowerLevelController, PercentageController\nSigned-off-by: Michael Geramb <mail@michael-geramb.at> (github: mgeramb)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cf83c0e9b2f5b29fc0e293b8f3a9b2fcfadded71", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/cf83c0e9b2f5b29fc0e293b8f3a9b2fcfadded71", "committedDate": "2019-09-10T05:03:10Z", "message": "[amazonechocontrol]\nAdd readme\nSigned-off-by: Michael Geramb <mail@michael-geramb.at> (github: mgeramb)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "cc13a4a8c5ab5f7dfe6b993244c71f545db6591b", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/cc13a4a8c5ab5f7dfe6b993244c71f545db6591b", "committedDate": "2019-09-10T05:04:29Z", "message": "[amazonechocontrol]\nAdd To Do List\nSigned-off-by: Michael Geramb <mail@michael-geramb.at> (github: mgeramb)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7d296bf89bde522da1e3e3fd6037f8b74b2a6790", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/7d296bf89bde522da1e3e3fd6037f8b74b2a6790", "committedDate": "2019-09-10T20:02:59Z", "message": "[amazonechocontrol]\nFix nullable warning in Announcment\nSigned-off-by: Michael Geramb <mail@michael-geramb.at> (github: mgeramb)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "da6e2e562b36e53a1c2c340e1b133267870723d9", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/da6e2e562b36e53a1c2c340e1b133267870723d9", "committedDate": "2019-09-10T20:04:47Z", "message": "[amazonechocontrol]\nFix nullable warnings\nSigned-off-by: Michael Geramb <mail@michael-geramb.at> (github: mgeramb)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ece83d3efb51c2044a82d754aa023141662f3c1b", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/ece83d3efb51c2044a82d754aa023141662f3c1b", "committedDate": "2019-09-10T20:05:16Z", "message": "Merge branch 'master' of https://github.com/openhab/openhab2-addons"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "abfe19098b34026ad96c2bb1ebd3c9d8ce06e306", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/abfe19098b34026ad96c2bb1ebd3c9d8ce06e306", "committedDate": "2019-09-11T15:53:43Z", "message": "Update ___Do_To's___.md"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "184a6dcf17fcc76688f8543da9ae82224e290f49", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/184a6dcf17fcc76688f8543da9ae82224e290f49", "committedDate": "2019-09-11T15:59:58Z", "message": "Update ___Do_To's___.md"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4775940d6b0ac7aa90bcd83447b58d17515b8333", "author": {"user": {"login": "lkn94", "name": "Lukas Knoeller"}}, "url": "https://github.com/openhab/openhab-addons/commit/4775940d6b0ac7aa90bcd83447b58d17515b8333", "committedDate": "2019-09-11T16:32:46Z", "message": "Update README.md"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "33e541217cdc5228ab4e6a4ac076ad502eead8b1", "author": {"user": {"login": "lkn94", "name": "Lukas Knoeller"}}, "url": "https://github.com/openhab/openhab-addons/commit/33e541217cdc5228ab4e6a4ac076ad502eead8b1", "committedDate": "2019-09-11T16:33:20Z", "message": "Update README.md"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "47a190d8634d9663b6fab3562b91c66dc70bdbcd", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/47a190d8634d9663b6fab3562b91c66dc70bdbcd", "committedDate": "2019-09-11T16:41:21Z", "message": "[amazonechocontrol]\nBugfixing\nSigned-off-by: Michael Geramb <mail@michael-geramb.at> (github: mgeramb)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6669eedd64ef65b1969ea82d6de4fa11cfac226c", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/6669eedd64ef65b1969ea82d6de4fa11cfac226c", "committedDate": "2019-09-11T16:42:51Z", "message": "Merge branch 'SmartHomeDeviceHandling' of https://github.com/mgeramb/openhab2-addons into SmartHomeDeviceHandling"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c4cf560d25999d19085f11e068615f4103d3fea7", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/c4cf560d25999d19085f11e068615f4103d3fea7", "committedDate": "2019-09-11T17:14:52Z", "message": "[amazonechocontrol]\nPrepare Release Notes\nSigned-off-by: Michael Geramb <mail@michael-geramb.at> (github: mgeramb)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "62be95d5ac2b537d527136ab69fea00b0ceef8bf", "author": {"user": {"login": "lkn94", "name": "Lukas Knoeller"}}, "url": "https://github.com/openhab/openhab-addons/commit/62be95d5ac2b537d527136ab69fea00b0ceef8bf", "committedDate": "2019-09-11T17:26:42Z", "message": "Update README.md"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6cb3702553cb9c432f4969ab576519a8d979c7a4", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/6cb3702553cb9c432f4969ab576519a8d979c7a4", "committedDate": "2019-09-11T17:28:16Z", "message": "[amazonechocontrol]\nPrepare Relase notes\nSigned-off-by: Michael Geramb <mail@michael-geramb.at> (github: mgeramb)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "53573c63aaf6dc47542c5e021fed64ae02f6a535", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/53573c63aaf6dc47542c5e021fed64ae02f6a535", "committedDate": "2019-09-11T17:31:03Z", "message": "[amazonechocontrol]\nWelcome message\nSigned-off-by: Michael Geramb <mail@michael-geramb.at> (github: mgeramb)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0b505fcf813a9a695037b4324dab0043475a7b7a", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/0b505fcf813a9a695037b4324dab0043475a7b7a", "committedDate": "2019-09-11T17:31:20Z", "message": "Merge branch 'SmartHomeDeviceHandling' of https://github.com/mgeramb/openhab2-addons into SmartHomeDeviceHandling"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a967c658b41aec658a7a75a7819870b6e43e2b98", "author": {"user": {"login": "lkn94", "name": "Lukas Knoeller"}}, "url": "https://github.com/openhab/openhab-addons/commit/a967c658b41aec658a7a75a7819870b6e43e2b98", "committedDate": "2019-09-11T17:38:22Z", "message": "Update ___Release_Notes___.md"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "abfdba8e4dffb95a2964a669b1aa18325d4596f8", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/abfdba8e4dffb95a2964a669b1aa18325d4596f8", "committedDate": "2019-09-11T17:40:24Z", "message": "[amazonechocontrol]\nTop most posting old thread\nSigned-off-by: Michael Geramb <mail@michael-geramb.at> (github: mgeramb)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "ef3e63ae2d46230eda638bd00bed215376a99b94", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/ef3e63ae2d46230eda638bd00bed215376a99b94", "committedDate": "2019-09-11T17:40:38Z", "message": "Merge branch 'SmartHomeDeviceHandling' of https://github.com/mgeramb/openhab2-addons into SmartHomeDeviceHandling"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b74ac50e10ceeb1461714f96b1d361a9f3aec783", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/b74ac50e10ceeb1461714f96b1d361a9f3aec783", "committedDate": "2019-09-11T17:54:16Z", "message": "[amazonechocontrol]\nTop most posting old thread\nSigned-off-by: Michael Geramb <mail@michael-geramb.at> (github: mgeramb)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "05f1c845d949c618ba77b85711a5f7c84f6fb0fe", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/05f1c845d949c618ba77b85711a5f7c84f6fb0fe", "committedDate": "2019-09-11T17:56:36Z", "message": "[amazonechocontrol]\nTop most posting old thread\nSigned-off-by: Michael Geramb <mail@michael-geramb.at> (github: mgeramb)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3aff30cce8e54f0eb08929886c2d9eff45db3d2c", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/3aff30cce8e54f0eb08929886c2d9eff45db3d2c", "committedDate": "2019-09-11T18:12:37Z", "message": "[amazonechocontrol]\nTop most posting new thread\nSigned-off-by: Michael Geramb <mail@michael-geramb.at> (github: mgeramb)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "7922e7d78788b89d92c1f3d14ed86f1e3e6d8ed2", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/7922e7d78788b89d92c1f3d14ed86f1e3e6d8ed2", "committedDate": "2019-09-11T18:15:55Z", "message": "[amazonechocontrol]\nTop most posting new thread\nSigned-off-by: Michael Geramb <mail@michael-geramb.at> (github: mgeramb)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "9ad4a7ad392b35bfe4dc3762861464cb11b69da5", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/9ad4a7ad392b35bfe4dc3762861464cb11b69da5", "committedDate": "2019-09-11T18:16:35Z", "message": "[amazonechocontrol]\nTop most posting new thread\nSigned-off-by: Michael Geramb <mail@michael-geramb.at> (github: mgeramb)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b45f51e0fb4afb72e2a350a820e5540954b48c1e", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/b45f51e0fb4afb72e2a350a820e5540954b48c1e", "committedDate": "2019-09-11T18:22:20Z", "message": "[amazonechocontrol]\nTop most posting old thread\nSigned-off-by: Michael Geramb <mail@michael-geramb.at> (github: mgeramb)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f569693e908fbcd31b6264092897f873af0413e4", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/f569693e908fbcd31b6264092897f873af0413e4", "committedDate": "2019-09-11T18:49:50Z", "message": "[amazonechocontrol]\nTop most posting old thread\nSigned-off-by: Michael Geramb <mail@michael-geramb.at> (github: mgeramb)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a5dffba5c1c2c00d218f0d1b35db037bb323f5a3", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/a5dffba5c1c2c00d218f0d1b35db037bb323f5a3", "committedDate": "2019-09-11T19:22:54Z", "message": "[amazonechocontrol]\nTop most posting new thread\nSigned-off-by: Michael Geramb <mail@michael-geramb.at> (github: mgeramb)"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "b799b1310c4b1b04c74f3f1333791e83da3ab246", "author": {"user": {"login": "mgeramb", "name": "Michael Geramb"}}, "url": "https://github.com/openhab/openhab-addons/commit/b799b1310c4b1b04c74f3f1333791e83da3ab246", "committedDate": "2019-09-11T20:20:11Z", "message": "[amazonechocontrol]\nTemporary files removed\nSigned-off-by: Michael Geramb <mail@michael-geramb.at> (github: mgeramb)"}}]}}}, "rateLimit": {"limit": 5000, "remaining": 318, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}