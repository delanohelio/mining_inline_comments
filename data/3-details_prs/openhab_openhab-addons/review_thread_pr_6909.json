{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY3MjUwNzY3", "number": 6909, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQxMDozODo0OVrODcMlRw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQxMDozODo0OVrODcMlRw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjMwODkyODcxOnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.io.hueemulation/src/main/java/org/openhab/io/hueemulation/internal/StateUtils.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQxMDozODo0OVrOFkHfnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0zMVQxMDozODo0OVrOFkHfnQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzQxNTgzNw==", "bodyText": "Usage of as is tricky here. Because the as as used with the openHAB State class returns a new instance. So the contract to be assumed should be the method returns a new instance. Here it's assumed it returns the same object. But if that would change this code will break here. Because the code below will than make changes on the local variable only and not on the object returned. It would be better to do an instanceof check and a cast :\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                HueStateColorBulb c = hueState.as(HueStateColorBulb.class);\n          \n          \n            \n                                HueStateColorBulb c = (HueStateColorBulb) hueState;\n          \n      \n    \n    \n  \n\nSame below with HueStateBulb", "url": "https://github.com/openhab/openhab-addons/pull/6909#discussion_r373415837", "createdAt": "2020-01-31T10:38:49Z", "author": {"login": "Hilbrand"}, "path": "bundles/org.openhab.io.hueemulation/src/main/java/org/openhab/io/hueemulation/internal/StateUtils.java", "diffHunk": "@@ -413,4 +413,48 @@ public static Command commandByItemState(State state) throws IllegalStateExcepti\n         }\n         return t;\n     }\n+\n+    /**\n+     * Compute the hue state from a given item state and a device type.\n+     * If the item state matches the last command. the hue state is adjusted\n+     * to use the values from the last hue state change. This is done to prevent\n+     * Alexa reporting device errors.\n+     * \n+     * @param itemState The item state\n+     * @param deviceType The device type\n+     * @param lastCommand The last command\n+     * @param lastHueChange The last hue state change\n+     * @return A hue light state\n+     */\n+    public static AbstractHueState adjustedColorStateFromItemState(State itemState, @Nullable DeviceType deviceType,\n+            @Nullable Command lastCommand, @Nullable HueStateChange lastHueChange) {\n+\n+        AbstractHueState hueState = colorStateFromItemState(itemState, deviceType);\n+\n+        if (lastCommand != null && lastHueChange != null) {\n+            if (lastCommand instanceof HSBType) {\n+                if (itemState.as(HSBType.class).equals(lastCommand)) {\n+                    HueStateColorBulb c = hueState.as(HueStateColorBulb.class);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "fdc567ad9e765cb7c65aa7adf2477ca4a70e58ed"}, "originalPosition": 25}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 759, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}