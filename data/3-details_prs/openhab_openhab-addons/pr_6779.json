{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU5NjAxNjA2", "number": 6779, "title": "[miio] Xiaomi Robot Vacuum Channel \"state_code\" and \"error_code\" added", "bodyText": "Up to now, the status and error codes have only been output as text. On the one hand, this makes it complicated to create a mapping for your own status/error message (for example, in another language), and on the other hand, messages that are not yet implemented are only passed on as \"UNKNOWN\".\nThe two channels state_code and error_code now output the integers directly, so a mapping to numbers can be easily done and new codes are also output.\nSigned-off-by: Markus Schraufstetter markus.schraufstetter@gmail.com", "createdAt": "2020-01-06T15:56:48Z", "url": "https://github.com/openhab/openhab-addons/pull/6779", "merged": true, "mergeCommit": {"oid": "494c325776388c7622243528309fdc1467740df0"}, "closed": true, "closedAt": "2020-01-11T14:00:18Z", "author": {"login": "Markkuuss"}, "timelineItems": {"totalCount": 11, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABb3uKyngH2gAyMzU5NjAxNjA2OjgyNzM5ZTM1NGYzMWNmMGE0MDkwN2YwMTNhZWE4MDIyNzFlMDFlNzI=", "endCursor": "Y3Vyc29yOnYyOpPPAAABb5Tnd3gFqTM0MTUyMzcxMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "82739e354f31cf0a40907f013aea802271e01e72", "author": {"user": null}, "url": "https://github.com/openhab/openhab-addons/commit/82739e354f31cf0a40907f013aea802271e01e72", "committedDate": "2020-01-06T15:48:11Z", "message": "[miio] Channel state_code and error_code added\n\nUp to now, the status and error codes have only been output as text. On the one hand, this makes it complicated to create a mapping for your own status/error message (for example, in another language), and on the other hand, messages that are not yet implemented are only passed on as \"UNKNOWN\".\n\nThe two channels state_code and error_code now output the integers directly, so a mapping to numbers can be easily done and new codes are also output.\n\nSigned-off-by: Markus Schraufstetter <markus.schraufstetter@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3d3220526848af89cd79c1fa02adf5616ce2690e", "author": {"user": null}, "url": "https://github.com/openhab/openhab-addons/commit/3d3220526848af89cd79c1fa02adf5616ce2690e", "committedDate": "2020-01-06T22:22:02Z", "message": "[miio] Direct forwarding of the codes so that status/error codes which are not known to the binding are also forwarded and are not displayed as status code 0 or error code -1.\n\nSigned-off-by: Markus Schraufstetter <markus.schraufstetter@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwNDQ4MTYw", "url": "https://github.com/openhab/openhab-addons/pull/6779#pullrequestreview-340448160", "createdAt": "2020-01-09T11:14:16Z", "commit": {"oid": "3d3220526848af89cd79c1fa02adf5616ce2690e"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxMToxNDoxNlrOFbyiSw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxMToxNDo0NVrOFbyi7w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDY4Mzg1MQ==", "bodyText": "I think the label should also be Error Code to avoid duplicated label with different values", "url": "https://github.com/openhab/openhab-addons/pull/6779#discussion_r364683851", "createdAt": "2020-01-09T11:14:16Z", "author": {"login": "marcelrv"}, "path": "bundles/org.openhab.binding.miio/src/main/resources/ESH-INF/thing/vacuumThing.xml", "diffHunk": "@@ -106,11 +108,16 @@\n \t\t<item-type>Switch</item-type>\n \t\t<label>Do Not Disturb</label>\n \t</channel-type>\n-\t<channel-type id=\"error_code\">\n+\t<channel-type id=\"error\">\n \t\t<item-type>String</item-type>\n \t\t<label>Error</label>\n \t\t<state readOnly=\"true\" />\n \t</channel-type>\n+\t<channel-type id=\"error_code\">\n+\t\t<item-type>Number</item-type>\n+\t\t<label>Error</label>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3d3220526848af89cd79c1fa02adf5616ce2690e"}, "originalPosition": 27}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDY4NDAxNQ==", "bodyText": "Same here, please prevent the same label for 2 different channels", "url": "https://github.com/openhab/openhab-addons/pull/6779#discussion_r364684015", "createdAt": "2020-01-09T11:14:45Z", "author": {"login": "marcelrv"}, "path": "bundles/org.openhab.binding.miio/src/main/resources/ESH-INF/thing/vacuumThing.xml", "diffHunk": "@@ -137,6 +144,11 @@\n \t\t<label>State</label>\n \t\t<state readOnly=\"true\" />\n \t</channel-type>\n+\t<channel-type id=\"state_code\">\n+\t\t<item-type>Number</item-type>\n+\t\t<label>State</label>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "3d3220526848af89cd79c1fa02adf5616ce2690e"}, "originalPosition": 39}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1bc03762cc6f50fe9c6a6ad523d0a5e52958f911", "author": {"user": null}, "url": "https://github.com/openhab/openhab-addons/commit/1bc03762cc6f50fe9c6a6ad523d0a5e52958f911", "committedDate": "2020-01-09T11:29:09Z", "message": "[miio] Fixed unique labels for the two new channels\n\nSigned-off-by: Markus Schraufstetter <markus.schraufstetter@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwNDY0MzU0", "url": "https://github.com/openhab/openhab-addons/pull/6779#pullrequestreview-340464354", "createdAt": "2020-01-09T11:45:35Z", "commit": {"oid": "1bc03762cc6f50fe9c6a6ad523d0a5e52958f911"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxMTo0NTozNlrOFbzT0g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wOVQxMTo0NTozNlrOFbzT0g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDY5NjUzMA==", "bodyText": "Sorry for catching this not in the earlier review, but the codechecker also complaints that this is not camelcase\nShould be changed to errorCode", "url": "https://github.com/openhab/openhab-addons/pull/6779#discussion_r364696530", "createdAt": "2020-01-09T11:45:36Z", "author": {"login": "marcelrv"}, "path": "bundles/org.openhab.binding.miio/src/main/java/org/openhab/binding/miio/internal/handler/MiIoVacuumHandler.java", "diffHunk": "@@ -131,8 +131,9 @@ private boolean updateVacuumStatus(JsonObject statusData) {\n         updateState(CHANNEL_CLEAN_TIME,\n                 new DecimalType(TimeUnit.SECONDS.toMinutes(statusData.get(\"clean_time\").getAsLong())));\n         updateState(CHANNEL_DND_ENABLED, new DecimalType(statusData.get(\"dnd_enabled\").getAsBigDecimal()));\n-        updateState(CHANNEL_ERROR_CODE,\n-                new StringType(VacuumErrorType.getType(statusData.get(\"error_code\").getAsInt()).getDescription()));\n+        VacuumErrorType error_code = VacuumErrorType.getType(statusData.get(\"error_code\").getAsInt());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1bc03762cc6f50fe9c6a6ad523d0a5e52958f911"}, "originalPosition": 6}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "642dec1368322e0ab8d8ee2f0b86fd995bc61b25", "author": {"user": null}, "url": "https://github.com/openhab/openhab-addons/commit/642dec1368322e0ab8d8ee2f0b86fd995bc61b25", "committedDate": "2020-01-09T11:59:33Z", "message": "[miio] camelcase formatting\n\nSigned-off-by: Markus Schraufstetter <markus.schraufstetter@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQwNDc0ODc4", "url": "https://github.com/openhab/openhab-addons/pull/6779#pullrequestreview-340474878", "createdAt": "2020-01-09T12:06:51Z", "commit": {"oid": "642dec1368322e0ab8d8ee2f0b86fd995bc61b25"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQxNDA4MzI1", "url": "https://github.com/openhab/openhab-addons/pull/6779#pullrequestreview-341408325", "createdAt": "2020-01-10T20:35:41Z", "commit": {"oid": "642dec1368322e0ab8d8ee2f0b86fd995bc61b25"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMFQyMDozNTo0MVrOFcfdlQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0xMFQyMDo0MDowOFrOFcfjjA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTQxOTkyNQ==", "bodyText": "What is the benefit of writing this in two lines instead of one?", "url": "https://github.com/openhab/openhab-addons/pull/6779#discussion_r365419925", "createdAt": "2020-01-10T20:35:41Z", "author": {"login": "J-N-K"}, "path": "bundles/org.openhab.binding.miio/src/main/java/org/openhab/binding/miio/internal/handler/MiIoVacuumHandler.java", "diffHunk": "@@ -131,16 +131,18 @@ private boolean updateVacuumStatus(JsonObject statusData) {\n         updateState(CHANNEL_CLEAN_TIME,\n                 new DecimalType(TimeUnit.SECONDS.toMinutes(statusData.get(\"clean_time\").getAsLong())));\n         updateState(CHANNEL_DND_ENABLED, new DecimalType(statusData.get(\"dnd_enabled\").getAsBigDecimal()));\n-        updateState(CHANNEL_ERROR_CODE,\n-                new StringType(VacuumErrorType.getType(statusData.get(\"error_code\").getAsInt()).getDescription()));\n+        VacuumErrorType errorCode = VacuumErrorType.getType(statusData.get(\"error_code\").getAsInt());", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "642dec1368322e0ab8d8ee2f0b86fd995bc61b25"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTQyMDEyNQ==", "bodyText": "Same here: why is thsi a local variable (and other states are not)?", "url": "https://github.com/openhab/openhab-addons/pull/6779#discussion_r365420125", "createdAt": "2020-01-10T20:36:12Z", "author": {"login": "J-N-K"}, "path": "bundles/org.openhab.binding.miio/src/main/java/org/openhab/binding/miio/internal/handler/MiIoVacuumHandler.java", "diffHunk": "@@ -131,16 +131,18 @@ private boolean updateVacuumStatus(JsonObject statusData) {\n         updateState(CHANNEL_CLEAN_TIME,\n                 new DecimalType(TimeUnit.SECONDS.toMinutes(statusData.get(\"clean_time\").getAsLong())));\n         updateState(CHANNEL_DND_ENABLED, new DecimalType(statusData.get(\"dnd_enabled\").getAsBigDecimal()));\n-        updateState(CHANNEL_ERROR_CODE,\n-                new StringType(VacuumErrorType.getType(statusData.get(\"error_code\").getAsInt()).getDescription()));\n+        VacuumErrorType errorCode = VacuumErrorType.getType(statusData.get(\"error_code\").getAsInt());\n+        updateState(CHANNEL_ERROR, new StringType(errorCode.getDescription()));\n+        updateState(CHANNEL_ERROR_CODE, new DecimalType(statusData.get(\"error_code\").getAsInt()));\n         int fanLevel = statusData.get(\"fan_power\").getAsInt();\n-        FanModeType fanpower = FanModeType.getType(fanLevel);\n+        FanModeType fanPower = FanModeType.getType(fanLevel);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "642dec1368322e0ab8d8ee2f0b86fd995bc61b25"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTQyMTQ1Mg==", "bodyText": "When has the vacuumThing been introduced? If it is already present in 2.5.0 this is a breaking change.  In any case, documentations needs to be updated.", "url": "https://github.com/openhab/openhab-addons/pull/6779#discussion_r365421452", "createdAt": "2020-01-10T20:40:08Z", "author": {"login": "J-N-K"}, "path": "bundles/org.openhab.binding.miio/src/main/resources/ESH-INF/thing/vacuumThing.xml", "diffHunk": "@@ -106,11 +108,16 @@\n \t\t<item-type>Switch</item-type>\n \t\t<label>Do Not Disturb</label>\n \t</channel-type>\n-\t<channel-type id=\"error_code\">\n+\t<channel-type id=\"error\">", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "642dec1368322e0ab8d8ee2f0b86fd995bc61b25"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a9cb4a46ca9ca7f8d8f312ff3ea01dff160c8161", "author": {"user": null}, "url": "https://github.com/openhab/openhab-addons/commit/a9cb4a46ca9ca7f8d8f312ff3ea01dff160c8161", "committedDate": "2020-01-11T12:33:56Z", "message": "[miio] Renamed to \"ID\" to avoid breaking changes.\n\nSigned-off-by: Markus Schraufstetter <markus.schraufstetter@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "00683b75564945231c83f55482231b225467ae26", "author": {"user": null}, "url": "https://github.com/openhab/openhab-addons/commit/00683b75564945231c83f55482231b225467ae26", "committedDate": "2020-01-11T12:44:28Z", "message": "[miio] Code refactoring\n\nSigned-off-by: Markus Schraufstetter <markus.schraufstetter@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzQxNTIzNzEy", "url": "https://github.com/openhab/openhab-addons/pull/6779#pullrequestreview-341523712", "createdAt": "2020-01-11T13:59:55Z", "commit": {"oid": "00683b75564945231c83f55482231b225467ae26"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1559, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}