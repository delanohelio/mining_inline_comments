{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTE0NDg3ODM0", "number": 8948, "title": "[ipcamera] Improve ONVIF preset naming", "bodyText": "Improvement: Display actual ONVIF preset names instead of generic \"Preset 1\" previously used.\nImprovement: Allow -rtsp_transport tcp default option to be over-ridden as it was hard coded and not able to be changed.\nImprovement: Allow snapshot arguments to be specified for FFmpeg and default quality of jpg is now much higher.\nBug Fix: Camera may report an actual IP in responses that don't match what is given in setup. eg. Hostname used.\nBug Fix: Prevent possible endless loop.\nBug Fix: HLS would return an old playlist if it was not already running.\nBug Fix: If a hostname is used instead of an IP, some camera reply's failed to match the hostname as the camera gave an IP.\nThe main change that users will notice is the ONVIF names will now display correctly with the custom name they gave when the preset was created. Instead of a generic 'preset 1' they will now see 'gate' or 'doorway'. The other changes 90% of users will not notice.\nSigned-off-by: Matthew Skinner matt@pcmus.com", "createdAt": "2020-11-03T05:18:52Z", "url": "https://github.com/openhab/openhab-addons/pull/8948", "merged": true, "mergeCommit": {"oid": "8b3c633b8dcb6624e648056c6b332ef813ea8583"}, "closed": true, "closedAt": "2020-11-21T06:27:50Z", "author": {"login": "Skinah"}, "timelineItems": {"totalCount": 19, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdYybnVAH2gAyNTE0NDg3ODM0Ojg4ZmJlZjhlZmFmYzc1ODZhOGE1NDE3ZTc2ZjA5MGE1NGJmN2RjYTc=", "endCursor": "Y3Vyc29yOnYyOpPPAAABddQFUoAFqTUzMTk3NTM0Nw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "88fbef8efafc7586a8a5417e76f090a54bf7dca7", "author": {"user": {"login": "Skinah", "name": "Matthew Skinner"}}, "url": "https://github.com/openhab/openhab-addons/commit/88fbef8efafc7586a8a5417e76f090a54bf7dca7", "committedDate": "2020-11-03T05:36:50Z", "message": "Refactor to prevent endless loop.\n\nSigned-off-by: Matthew Skinner <matt@pcmus.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "1e08eafff40ad1bb3b5bfd58e6ce1da10597dc66", "author": {"user": {"login": "Skinah", "name": "Matthew Skinner"}}, "url": "https://github.com/openhab/openhab-addons/commit/1e08eafff40ad1bb3b5bfd58e6ce1da10597dc66", "committedDate": "2020-11-03T05:36:50Z", "message": "Allow `-rtsp_transport tcp` to be over-ridden.\n\nSigned-off-by: Matthew Skinner <matt@pcmus.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a89fa12db85adcc284197cfd0cf52400d098b8bd", "author": {"user": {"login": "Skinah", "name": "Matthew Skinner"}}, "url": "https://github.com/openhab/openhab-addons/commit/a89fa12db85adcc284197cfd0cf52400d098b8bd", "committedDate": "2020-11-03T05:36:50Z", "message": "Display actual preset names\n\n\nSigned-off-by: Matthew Skinner <matt@pcmus.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "50e823760fcd4a4a6df916d31ecaf668e60fd4e9", "author": {"user": {"login": "Skinah", "name": "Matthew Skinner"}}, "url": "https://github.com/openhab/openhab-addons/commit/50e823760fcd4a4a6df916d31ecaf668e60fd4e9", "committedDate": "2020-11-03T05:36:50Z", "message": "Allow IP to not match due to Hostname given in setup.\n\n\nSigned-off-by: Matthew Skinner <matt@pcmus.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6e6699590c519bd440e5397cd67758d026993555", "author": {"user": {"login": "Skinah", "name": "Matthew Skinner"}}, "url": "https://github.com/openhab/openhab-addons/commit/6e6699590c519bd440e5397cd67758d026993555", "committedDate": "2020-11-03T05:36:50Z", "message": "Fix index off by 1\n\n\nSigned-off-by: Matthew Skinner <matt@pcmus.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "f45b73781f06e649b8a5eac80fb862264ea5d80b", "author": {"user": {"login": "Skinah", "name": "Matthew Skinner"}}, "url": "https://github.com/openhab/openhab-addons/commit/f45b73781f06e649b8a5eac80fb862264ea5d80b", "committedDate": "2020-11-03T12:28:31Z", "message": "Reduce null compiler warnings.\n\nSigned-off-by: Matthew Skinner <matt@pcmus.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "517cbaa193fb55c1105ebbb5fb4e39808fa81099", "author": {"user": {"login": "Skinah", "name": "Matthew Skinner"}}, "url": "https://github.com/openhab/openhab-addons/commit/517cbaa193fb55c1105ebbb5fb4e39808fa81099", "committedDate": "2020-11-04T11:26:23Z", "message": "Clean up last of the null compiler warnings.\n\nSigned-off-by: Matthew Skinner <matt@pcmus.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "655cbb488b8d37ede5725653401c59bab2517bff", "author": {"user": {"login": "Skinah", "name": "Matthew Skinner"}}, "url": "https://github.com/openhab/openhab-addons/commit/655cbb488b8d37ede5725653401c59bab2517bff", "committedDate": "2020-11-04T23:09:27Z", "message": "Merge branch 'main' into ipcameraV3"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "97ffaf4de1c1035fa10cea89aa480acc2dbc8f5b", "author": {"user": {"login": "Skinah", "name": "Matthew Skinner"}}, "url": "https://github.com/openhab/openhab-addons/commit/97ffaf4de1c1035fa10cea89aa480acc2dbc8f5b", "committedDate": "2020-11-06T07:00:09Z", "message": "Change to a single line log output.\n\n\nSigned-off-by: Matthew Skinner <matt@pcmus.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "feb3a657b58f0fc28186ab236899d0d78d45eeac", "author": {"user": {"login": "Skinah", "name": "Matthew Skinner"}}, "url": "https://github.com/openhab/openhab-addons/commit/feb3a657b58f0fc28186ab236899d0d78d45eeac", "committedDate": "2020-11-08T13:30:39Z", "message": "Remove dead code already handled earlier.\n\n\nSigned-off-by: Matthew Skinner <matt@pcmus.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI1ODgyODg2", "url": "https://github.com/openhab/openhab-addons/pull/8948#pullrequestreview-525882886", "createdAt": "2020-11-09T02:10:10Z", "commit": {"oid": "feb3a657b58f0fc28186ab236899d0d78d45eeac"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQwMjoxMDoxMFrOHvc2ZA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQwMjoxMjoxMVrOHvc35w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTUxNzc5Ng==", "bodyText": "Some minor simplification.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (filename == null && localHandler != null) {\n          \n          \n            \n                        localHandler.recordGif(\"ipcamera\", secondsToRecord);\n          \n          \n            \n                    } else if (localHandler != null && filename != null) {\n          \n          \n            \n                        localHandler.recordGif(filename, secondsToRecord);\n          \n          \n            \n                    }\n          \n          \n            \n                    if(localHandler != null){\n          \n          \n            \n                        localHandler.recordGif(filename != null ? filename : \"ipcamera\", secondsToRecord);\n          \n          \n            \n                    }", "url": "https://github.com/openhab/openhab-addons/pull/8948#discussion_r519517796", "createdAt": "2020-11-09T02:10:10Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.ipcamera/src/main/java/org/openhab/binding/ipcamera/internal/IpCameraActions.java", "diffHunk": "@@ -66,10 +67,11 @@ public void recordGIF(\n             @ActionInput(name = \"filename\", label = \"Filename\", description = \"Name that the recording will have once created, don't include the .mp4.\") @Nullable String filename,\n             @ActionInput(name = \"secondsToRecord\", label = \"Seconds to Record\", description = \"Enter a number of how many seconds to record.\") int secondsToRecord) {\n         logger.debug(\"Recording {}.gif for {} seconds.\", filename, secondsToRecord);\n-        if (filename == null && handler != null) {\n-            handler.recordGif(\"ipcamera\", secondsToRecord);\n-        } else if (handler != null && filename != null) {\n-            handler.recordGif(filename, secondsToRecord);\n+        IpCameraHandler localHandler = handler;\n+        if (filename == null && localHandler != null) {\n+            localHandler.recordGif(\"ipcamera\", secondsToRecord);\n+        } else if (localHandler != null && filename != null) {\n+            localHandler.recordGif(filename, secondsToRecord);\n         }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "feb3a657b58f0fc28186ab236899d0d78d45eeac"}, "originalPosition": 29}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTUxNzk4OA==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (filename == null && localHandler != null) {\n          \n          \n            \n                        localHandler.recordMp4(\"ipcamera\", secondsToRecord);\n          \n          \n            \n                    } else if (localHandler != null && filename != null) {\n          \n          \n            \n                        localHandler.recordMp4(filename, secondsToRecord);\n          \n          \n            \n                    }\n          \n          \n            \n                    if (localHandler != null) {\n          \n          \n            \n                        localHandler.recordMp4(filename != null ? filename : \"ipcamera\", secondsToRecord);\n          \n          \n            \n                    }", "url": "https://github.com/openhab/openhab-addons/pull/8948#discussion_r519517988", "createdAt": "2020-11-09T02:11:09Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.ipcamera/src/main/java/org/openhab/binding/ipcamera/internal/IpCameraActions.java", "diffHunk": "@@ -50,10 +50,11 @@ public void recordMP4(\n             @ActionInput(name = \"filename\", label = \"Filename\", description = \"Name that the recording will have once created, don't include the .mp4.\") @Nullable String filename,\n             @ActionInput(name = \"secondsToRecord\", label = \"Seconds to Record\", description = \"Enter a number of how many seconds to record.\") int secondsToRecord) {\n         logger.debug(\"Recording {}.mp4 for {} seconds.\", filename, secondsToRecord);\n-        if (filename == null && handler != null) {\n-            handler.recordMp4(\"ipcamera\", secondsToRecord);\n-        } else if (handler != null && filename != null) {\n-            handler.recordMp4(filename, secondsToRecord);\n+        IpCameraHandler localHandler = handler;\n+        if (filename == null && localHandler != null) {\n+            localHandler.recordMp4(\"ipcamera\", secondsToRecord);\n+        } else if (localHandler != null && filename != null) {\n+            localHandler.recordMp4(filename, secondsToRecord);\n         }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "feb3a657b58f0fc28186ab236899d0d78d45eeac"}, "originalPosition": 13}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTUxODE4Mw==", "bodyText": "Why are you removing this?", "url": "https://github.com/openhab/openhab-addons/pull/8948#discussion_r519518183", "createdAt": "2020-11-09T02:12:11Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.ipcamera/src/main/java/org/openhab/binding/ipcamera/internal/AmcrestHandler.java", "diffHunk": "@@ -206,19 +205,6 @@ public void handleCommand(ChannelUID channelUID, Command command) {\n                     ipCameraHandler.sendHttpGET(\"/cgi-bin/configManager.cgi?action=setConfig&AlarmOut[1].Mode=0\");\n                 }\n                 return;\n-            case CHANNEL_FFMPEG_MOTION_CONTROL:\n-                if (OnOffType.ON.equals(command)) {\n-                    ipCameraHandler.motionAlarmEnabled = true;\n-                } else if (OnOffType.OFF.equals(command) || DecimalType.ZERO.equals(command)) {\n-                    ipCameraHandler.motionAlarmEnabled = false;\n-                    ipCameraHandler.noMotionDetected(CHANNEL_MOTION_ALARM);\n-                } else {\n-                    ipCameraHandler.motionAlarmEnabled = true;\n-                    ipCameraHandler.motionThreshold = Double.valueOf(command.toString());\n-                    ipCameraHandler.motionThreshold = ipCameraHandler.motionThreshold / 10000;\n-                }\n-                ipCameraHandler.setupFfmpegFormat(FFmpegFormat.RTSP_ALARMS);\n-                return;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "feb3a657b58f0fc28186ab236899d0d78d45eeac"}, "originalPosition": 24}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d945e9aebd557854abe716c577f53cfd5a60a3de", "author": {"user": {"login": "Skinah", "name": "Matthew Skinner"}}, "url": "https://github.com/openhab/openhab-addons/commit/d945e9aebd557854abe716c577f53cfd5a60a3de", "committedDate": "2020-11-09T13:10:29Z", "message": "Update bundles/org.openhab.binding.ipcamera/src/main/java/org/openhab/binding/ipcamera/internal/IpCameraActions.java\r\n\r\nSigned-off-by: Matthew Skinner <matt@pcmus.com>\n\nCo-authored-by: Connor Petty <mistercpp2000@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3342fb511d44addd9825f2848fecb063cca933a5", "author": {"user": {"login": "Skinah", "name": "Matthew Skinner"}}, "url": "https://github.com/openhab/openhab-addons/commit/3342fb511d44addd9825f2848fecb063cca933a5", "committedDate": "2020-11-09T13:10:50Z", "message": "Update bundles/org.openhab.binding.ipcamera/src/main/java/org/openhab/binding/ipcamera/internal/IpCameraActions.java\r\n\r\nSigned-off-by: Matthew Skinner <matt@pcmus.com>\n\nCo-authored-by: Connor Petty <mistercpp2000@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0874ed4f87cf7041dd7690fd113b1265c6f0cdc3", "author": {"user": {"login": "Skinah", "name": "Matthew Skinner"}}, "url": "https://github.com/openhab/openhab-addons/commit/0874ed4f87cf7041dd7690fd113b1265c6f0cdc3", "committedDate": "2020-11-09T13:11:13Z", "message": "Apply spotless fixes.\n\n\nSigned-off-by: Matthew Skinner <matt@pcmus.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTI2NDgwNTEw", "url": "https://github.com/openhab/openhab-addons/pull/8948#pullrequestreview-526480510", "createdAt": "2020-11-09T17:19:43Z", "commit": {"oid": "0874ed4f87cf7041dd7690fd113b1265c6f0cdc3"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxNzoxOTo0NFrOHv5TnQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0wOVQxNzoxOTo0NFrOHv5TnQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTk4NDAyOQ==", "bodyText": "remove commented code", "url": "https://github.com/openhab/openhab-addons/pull/8948#discussion_r519984029", "createdAt": "2020-11-09T17:19:44Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.ipcamera/src/main/java/org/openhab/binding/ipcamera/internal/StreamServerHandler.java", "diffHunk": "@@ -96,20 +96,16 @@ public void channelRead(@Nullable ChannelHandlerContext ctx, @Nullable Object ms\n                     QueryStringDecoder queryStringDecoder = new QueryStringDecoder(httpRequest.uri());\n                     switch (queryStringDecoder.path()) {\n                         case \"/ipcamera.m3u8\":\n-                            if (ipCameraHandler.ffmpegHLS != null) {\n-                                if (!ipCameraHandler.ffmpegHLS.getIsAlive()) {\n-                                    if (ipCameraHandler.ffmpegHLS != null) {\n-                                        ipCameraHandler.ffmpegHLS.startConverting();\n-                                    }\n-                                }\n-                            } else {\n+                            Ffmpeg localFfmpeg = ipCameraHandler.ffmpegHLS;\n+                            if (localFfmpeg == null) {\n                                 ipCameraHandler.setupFfmpegFormat(FFmpegFormat.HLS);\n-                            }\n-                            if (ipCameraHandler.ffmpegHLS != null) {\n-                                ipCameraHandler.ffmpegHLS.setKeepAlive(8);\n+                            } else if (!localFfmpeg.getIsAlive()) {\n+                                localFfmpeg.startConverting();\n+                            } else {\n+                                localFfmpeg.setKeepAlive(8);\n                             }\n                             sendFile(ctx, httpRequest.uri(), \"application/x-mpegurl\");\n-                            ctx.close();\n+                            // ctx.close();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0874ed4f87cf7041dd7690fd113b1265c6f0cdc3"}, "originalPosition": 24}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "86f4bce7c5af68e2fd0e864fb96831b41ec10d79", "author": {"user": {"login": "Skinah", "name": "Matthew Skinner"}}, "url": "https://github.com/openhab/openhab-addons/commit/86f4bce7c5af68e2fd0e864fb96831b41ec10d79", "committedDate": "2020-11-11T06:18:03Z", "message": "Bug fixes for HLS\n\n\nSigned-off-by: Matthew Skinner <matt@pcmus.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "24cb8f63fc5b4d299a870fbf1cbe5e78582b1e33", "author": {"user": {"login": "Skinah", "name": "Matthew Skinner"}}, "url": "https://github.com/openhab/openhab-addons/commit/24cb8f63fc5b4d299a870fbf1cbe5e78582b1e33", "committedDate": "2020-11-14T23:41:29Z", "message": "Compatibility fix for GotoPreset\n\n\nSigned-off-by: Matthew Skinner <matt@pcmus.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "d1d3633fec7d273c3655137fee077079e0927990", "author": {"user": {"login": "Skinah", "name": "Matthew Skinner"}}, "url": "https://github.com/openhab/openhab-addons/commit/d1d3633fec7d273c3655137fee077079e0927990", "committedDate": "2020-11-16T06:51:45Z", "message": "Improve default snapshot quality and allow FFmpeg arguments to be\nchanged.\n\n\nSigned-off-by: Matthew Skinner <matt@pcmus.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMxOTc1MzQ3", "url": "https://github.com/openhab/openhab-addons/pull/8948#pullrequestreview-531975347", "createdAt": "2020-11-17T02:25:20Z", "commit": {"oid": "d1d3633fec7d273c3655137fee077079e0927990"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4246, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}