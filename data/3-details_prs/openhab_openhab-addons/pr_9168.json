{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI5MDk5NTQw", "number": 9168, "title": "[ojelectronics] Add discovery; enable writable properties", "bodyText": "I added some new features.\n\nAdded writable properties\nAdded discovery of thermostats\n\nI will enjoy your code review.\nPlease let me know if further information are needed.", "createdAt": "2020-11-29T12:08:49Z", "url": "https://github.com/openhab/openhab-addons/pull/9168", "merged": true, "mergeCommit": {"oid": "8d389b7e2ef8426f8575d9999205809f597d608e"}, "closed": true, "closedAt": "2020-12-08T01:23:05Z", "author": {"login": "EvilPingu"}, "timelineItems": {"totalCount": 13, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdhTLEEgBqjQwNDkxNzY0NTE=", "endCursor": "Y3Vyc29yOnYyOpPPAAABdj92-7gFqTU0NjYxNDMyNg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "50dfedc3b9e198621a38080c2457c519fa899afd", "author": {"user": {"login": "EvilPingu", "name": "Christian Kittel"}}, "url": "https://github.com/openhab/openhab-addons/commit/50dfedc3b9e198621a38080c2457c519fa899afd", "committedDate": "2020-11-29T14:12:15Z", "message": "Fixed warnings\n\nSigned-off-by: EvilPingu <ckittel@gmx.de>"}, "afterCommit": {"oid": "bbda3043e092ae6f1669629c2d7aabc98ce34427", "author": {"user": {"login": "EvilPingu", "name": "Christian Kittel"}}, "url": "https://github.com/openhab/openhab-addons/commit/bbda3043e092ae6f1669629c2d7aabc98ce34427", "committedDate": "2020-11-29T16:08:13Z", "message": "Fixed warnings\n\nSigned-off-by: EvilPingu <ckittel@gmx.de>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQxNDExOTMw", "url": "https://github.com/openhab/openhab-addons/pull/9168#pullrequestreview-541411930", "createdAt": "2020-12-01T00:59:16Z", "commit": {"oid": "bbda3043e092ae6f1669629c2d7aabc98ce34427"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQwMDo1OToxN1rOH8T76Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQwMToxMzo0MlrOH8UOzw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzAwMzI0MQ==", "bodyText": "Why not make updatedValues a non-null field and just initially populate it with an empty list?", "url": "https://github.com/openhab/openhab-addons/pull/9168#discussion_r533003241", "createdAt": "2020-12-01T00:59:17Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.ojelectronics/src/main/java/org/openhab/binding/ojelectronics/internal/ThermostatHandler.java", "diffHunk": "@@ -101,31 +122,106 @@ public void handleThermostatRefresh(Thermostat thermostat) {\n         channelrefreshActions.forEach((channelUID, action) -> action.accept(thermostat));\n     }\n \n+    /**\n+     * Gets a {@link Thermostat} with changed values or null if nothing has changed\n+     *\n+     * @return The changed {@link Thermostat}\n+     */\n+    public @Nullable Thermostat tryHandleAndGetUpdatedThermostat() {\n+        final LinkedList<SimpleImmutableEntry<String, Command>> updatedValues = this.updatedValues;\n+        if (updatedValues == null || updatedValues.size() == 0) {\n+            return null;\n+        }\n+        this.updatedValues = null;\n+        updatedValues.forEach(item -> {\n+            if (updateThermostatValueActions.containsKey(item.getKey())) {\n+                final @Nullable Consumer<Command> consumer = updateThermostatValueActions.get(item.getKey());\n+                if (consumer != null) {\n+                    consumer.accept(item.getValue());\n+                }\n+            }\n+        });\n+        return currentThermostat;\n+    }\n+\n+    private LinkedList<SimpleImmutableEntry<String, Command>> ensureUpdatedValueListExists() {\n+        final LinkedList<SimpleImmutableEntry<String, Command>> updatedValues = this.updatedValues;\n+        if (updatedValues != null) {\n+            return updatedValues;\n+        }\n+        LinkedList<SimpleImmutableEntry<String, Command>> internalUpdatedValue = new LinkedList<>();\n+        this.updatedValues = internalUpdatedValue;\n+        return internalUpdatedValue;\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bbda3043e092ae6f1669629c2d7aabc98ce34427"}, "originalPosition": 101}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzAwNTc0OA==", "bodyText": "?", "url": "https://github.com/openhab/openhab-addons/pull/9168#discussion_r533005748", "createdAt": "2020-12-01T01:06:28Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.ojelectronics/src/main/java/org/openhab/binding/ojelectronics/internal/OJCloudHandlerFactory.java", "diffHunk": "@@ -69,5 +69,5 @@ public boolean supportsThingType(ThingTypeUID thingTypeUID) {\n             return handler;\n         }\n         return null;\n-    }\n+    };", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bbda3043e092ae6f1669629c2d7aabc98ce34427"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzAwODA3OQ==", "bodyText": "Instead of using the default ZoneId, try using the one provided by the TimeZoneProvider osgi service. You will have to get the service as a @Reference in the ThingHandlerFactory and then pass it in through the constructor of this handler.", "url": "https://github.com/openhab/openhab-addons/pull/9168#discussion_r533008079", "createdAt": "2020-12-01T01:13:42Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.ojelectronics/src/main/java/org/openhab/binding/ojelectronics/internal/ThermostatHandler.java", "diffHunk": "@@ -158,6 +254,42 @@ private void updateGroupName(Thermostat thermostat) {\n         updateState(BindingConstants.CHANNEL_OWD5_GROUPNAME, StringType.valueOf(thermostat.groupName));\n     }\n \n+    private void updateVacationEnabled(Thermostat thermostat) {\n+        updateState(BindingConstants.CHANNEL_OWD5_VACATIONENABLED,\n+                thermostat.online ? OpenClosedType.OPEN : OpenClosedType.CLOSED);\n+    }\n+\n+    private void updateVacationBeginDay(Thermostat thermostat) {\n+        updateState(BindingConstants.CHANNEL_OWD5_VACATIONBEGINDAY,\n+                new DateTimeType(\n+                        ZonedDateTime.ofInstant(thermostat.vacationBeginDay.toInstant(), ZoneId.systemDefault())\n+                                .truncatedTo(ChronoUnit.DAYS)));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bbda3043e092ae6f1669629c2d7aabc98ce34427"}, "originalPosition": 187}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e331a261ebd3980db7f0ecac6c97ed71cd5de31d", "author": {"user": {"login": "EvilPingu", "name": "Christian Kittel"}}, "url": "https://github.com/openhab/openhab-addons/commit/e331a261ebd3980db7f0ecac6c97ed71cd5de31d", "committedDate": "2020-12-01T15:50:11Z", "message": "Add methods to update via Command; Add discovery\n\nSigned-off-by: EvilPingu <ckittel@gmx.de>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a1842cb9cf5c1781f633d8654dde75acf972cda1", "author": {"user": {"login": "EvilPingu", "name": "Christian Kittel"}}, "url": "https://github.com/openhab/openhab-addons/commit/a1842cb9cf5c1781f633d8654dde75acf972cda1", "committedDate": "2020-12-01T15:50:11Z", "message": "add vacation channels; rework README\n\nSigned-off-by: EvilPingu <ckittel@gmx.de>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b318b89d5e82a86c30a73138363c5571ae6178c", "author": {"user": {"login": "EvilPingu", "name": "Christian Kittel"}}, "url": "https://github.com/openhab/openhab-addons/commit/8b318b89d5e82a86c30a73138363c5571ae6178c", "committedDate": "2020-12-01T15:50:11Z", "message": "Fixed warnings\n\nSigned-off-by: EvilPingu <ckittel@gmx.de>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "33f996bcea3f9ae93a883525c2e5ea3fc0d290a1", "author": {"user": {"login": "EvilPingu", "name": "Christian Kittel"}}, "url": "https://github.com/openhab/openhab-addons/commit/33f996bcea3f9ae93a883525c2e5ea3fc0d290a1", "committedDate": "2020-12-01T15:51:02Z", "message": "Merge remote-tracking branch 'EvilPingu/development' into development"}, "afterCommit": {"oid": "8b318b89d5e82a86c30a73138363c5571ae6178c", "author": {"user": {"login": "EvilPingu", "name": "Christian Kittel"}}, "url": "https://github.com/openhab/openhab-addons/commit/8b318b89d5e82a86c30a73138363c5571ae6178c", "committedDate": "2020-12-01T15:50:11Z", "message": "Fixed warnings\n\nSigned-off-by: EvilPingu <ckittel@gmx.de>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5151869e5f2450672d7fde8369ff470b388eb72e", "author": {"user": {"login": "EvilPingu", "name": "Christian Kittel"}}, "url": "https://github.com/openhab/openhab-addons/commit/5151869e5f2450672d7fde8369ff470b388eb72e", "committedDate": "2020-12-02T19:15:41Z", "message": "Fixed code review issues\n\nSigned-off-by: EvilPingu <ckittel@gmx.de>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1ee60943d0181dedba51c3b3866d96beb70557a2", "author": {"user": {"login": "EvilPingu", "name": "Christian Kittel"}}, "url": "https://github.com/openhab/openhab-addons/commit/1ee60943d0181dedba51c3b3866d96beb70557a2", "committedDate": "2020-12-01T16:09:36Z", "message": "Fixed code review issues\n\nSigned-off-by: EvilPingu <ckittel@gmx.de>"}, "afterCommit": {"oid": "5151869e5f2450672d7fde8369ff470b388eb72e", "author": {"user": {"login": "EvilPingu", "name": "Christian Kittel"}}, "url": "https://github.com/openhab/openhab-addons/commit/5151869e5f2450672d7fde8369ff470b388eb72e", "committedDate": "2020-12-02T19:15:41Z", "message": "Fixed code review issues\n\nSigned-off-by: EvilPingu <ckittel@gmx.de>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ0MzcwOTM0", "url": "https://github.com/openhab/openhab-addons/pull/9168#pullrequestreview-544370934", "createdAt": "2020-12-03T20:05:32Z", "commit": {"oid": "5151869e5f2450672d7fde8369ff470b388eb72e"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QyMDowNTozMlrOH-vTKQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QyMDowNTozMlrOH-vTKQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTU0ODcxMw==", "bodyText": "Since the user can change the timezone in the openHAB during runtime, you shouldn't cache time zone from TimeZoneProvider. So you will need to pass the TimeZoneProvider into the ThermostatHandler instead.", "url": "https://github.com/openhab/openhab-addons/pull/9168#discussion_r535548713", "createdAt": "2020-12-03T20:05:32Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.ojelectronics/src/main/java/org/openhab/binding/ojelectronics/internal/ThermostatHandlerFactory.java", "diffHunk": "@@ -36,6 +40,17 @@\n public class ThermostatHandlerFactory extends BaseThingHandlerFactory {\n \n     private static final Set<ThingTypeUID> SUPPORTED_THING_TYPES_UIDS = Collections.singleton(THING_TYPE_OWD5);\n+    private final ZoneId timeZone;\n+\n+    /**\n+     * Creates a new factory\n+     *\n+     * @param httpClientFactory Factory for HttpClient\n+     */\n+    @Activate\n+    public ThermostatHandlerFactory(@Reference TimeZoneProvider timeZoneProvider) {\n+        this.timeZone = timeZoneProvider.getTimeZone();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5151869e5f2450672d7fde8369ff470b388eb72e"}, "originalPosition": 35}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "d6902b638cb4363b98c0de9101d043768f03e360", "author": {"user": {"login": "EvilPingu", "name": "Christian Kittel"}}, "url": "https://github.com/openhab/openhab-addons/commit/d6902b638cb4363b98c0de9101d043768f03e360", "committedDate": "2020-12-04T11:17:20Z", "message": "Fixed code review issues: Corrected TimeZone-Hanlding\n\nSigned-off-by: EvilPingu <ckittel@gmx.de>"}, "afterCommit": {"oid": "2beeaca59e058dc782c8b152d31ce7075f7fe8ac", "author": {"user": {"login": "EvilPingu", "name": "Christian Kittel"}}, "url": "https://github.com/openhab/openhab-addons/commit/2beeaca59e058dc782c8b152d31ce7075f7fe8ac", "committedDate": "2020-12-05T08:55:32Z", "message": "Fixed code review issues: Corrected TimeZone-Hanlding\n\nSigned-off-by: EvilPingu <ckittel@gmx.de>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "716a1a66d0c98effd5fce8a19e81f746036c3e33", "author": {"user": {"login": "EvilPingu", "name": "Christian Kittel"}}, "url": "https://github.com/openhab/openhab-addons/commit/716a1a66d0c98effd5fce8a19e81f746036c3e33", "committedDate": "2020-12-06T16:14:48Z", "message": "Fixed code review issues: Corrected TimeZone-Handling\n\nSigned-off-by: EvilPingu <ckittel@gmx.de>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2beeaca59e058dc782c8b152d31ce7075f7fe8ac", "author": {"user": {"login": "EvilPingu", "name": "Christian Kittel"}}, "url": "https://github.com/openhab/openhab-addons/commit/2beeaca59e058dc782c8b152d31ce7075f7fe8ac", "committedDate": "2020-12-05T08:55:32Z", "message": "Fixed code review issues: Corrected TimeZone-Hanlding\n\nSigned-off-by: EvilPingu <ckittel@gmx.de>"}, "afterCommit": {"oid": "716a1a66d0c98effd5fce8a19e81f746036c3e33", "author": {"user": {"login": "EvilPingu", "name": "Christian Kittel"}}, "url": "https://github.com/openhab/openhab-addons/commit/716a1a66d0c98effd5fce8a19e81f746036c3e33", "committedDate": "2020-12-06T16:14:48Z", "message": "Fixed code review issues: Corrected TimeZone-Handling\n\nSigned-off-by: EvilPingu <ckittel@gmx.de>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ2NjE0MzI2", "url": "https://github.com/openhab/openhab-addons/pull/9168#pullrequestreview-546614326", "createdAt": "2020-12-07T23:08:51Z", "commit": {"oid": "716a1a66d0c98effd5fce8a19e81f746036c3e33"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3878, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}