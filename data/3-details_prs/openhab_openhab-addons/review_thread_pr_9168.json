{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTI5MDk5NTQw", "number": 9168, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQwMDo1OToxN1rOE-57ew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QyMDowNTozMlrOFAcUAg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM0Mzk2MjgzOnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.ojelectronics/src/main/java/org/openhab/binding/ojelectronics/internal/ThermostatHandler.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQwMDo1OToxN1rOH8T76Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQxNjoyNToyMlrOH81Gog==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzAwMzI0MQ==", "bodyText": "Why not make updatedValues a non-null field and just initially populate it with an empty list?", "url": "https://github.com/openhab/openhab-addons/pull/9168#discussion_r533003241", "createdAt": "2020-12-01T00:59:17Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.ojelectronics/src/main/java/org/openhab/binding/ojelectronics/internal/ThermostatHandler.java", "diffHunk": "@@ -101,31 +122,106 @@ public void handleThermostatRefresh(Thermostat thermostat) {\n         channelrefreshActions.forEach((channelUID, action) -> action.accept(thermostat));\n     }\n \n+    /**\n+     * Gets a {@link Thermostat} with changed values or null if nothing has changed\n+     *\n+     * @return The changed {@link Thermostat}\n+     */\n+    public @Nullable Thermostat tryHandleAndGetUpdatedThermostat() {\n+        final LinkedList<SimpleImmutableEntry<String, Command>> updatedValues = this.updatedValues;\n+        if (updatedValues == null || updatedValues.size() == 0) {\n+            return null;\n+        }\n+        this.updatedValues = null;\n+        updatedValues.forEach(item -> {\n+            if (updateThermostatValueActions.containsKey(item.getKey())) {\n+                final @Nullable Consumer<Command> consumer = updateThermostatValueActions.get(item.getKey());\n+                if (consumer != null) {\n+                    consumer.accept(item.getValue());\n+                }\n+            }\n+        });\n+        return currentThermostat;\n+    }\n+\n+    private LinkedList<SimpleImmutableEntry<String, Command>> ensureUpdatedValueListExists() {\n+        final LinkedList<SimpleImmutableEntry<String, Command>> updatedValues = this.updatedValues;\n+        if (updatedValues != null) {\n+            return updatedValues;\n+        }\n+        LinkedList<SimpleImmutableEntry<String, Command>> internalUpdatedValue = new LinkedList<>();\n+        this.updatedValues = internalUpdatedValue;\n+        return internalUpdatedValue;\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bbda3043e092ae6f1669629c2d7aabc98ce34427"}, "originalPosition": 101}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzU0NjY1OA==", "bodyText": "I fixed it too.", "url": "https://github.com/openhab/openhab-addons/pull/9168#discussion_r533546658", "createdAt": "2020-12-01T16:25:22Z", "author": {"login": "EvilPingu"}, "path": "bundles/org.openhab.binding.ojelectronics/src/main/java/org/openhab/binding/ojelectronics/internal/ThermostatHandler.java", "diffHunk": "@@ -101,31 +122,106 @@ public void handleThermostatRefresh(Thermostat thermostat) {\n         channelrefreshActions.forEach((channelUID, action) -> action.accept(thermostat));\n     }\n \n+    /**\n+     * Gets a {@link Thermostat} with changed values or null if nothing has changed\n+     *\n+     * @return The changed {@link Thermostat}\n+     */\n+    public @Nullable Thermostat tryHandleAndGetUpdatedThermostat() {\n+        final LinkedList<SimpleImmutableEntry<String, Command>> updatedValues = this.updatedValues;\n+        if (updatedValues == null || updatedValues.size() == 0) {\n+            return null;\n+        }\n+        this.updatedValues = null;\n+        updatedValues.forEach(item -> {\n+            if (updateThermostatValueActions.containsKey(item.getKey())) {\n+                final @Nullable Consumer<Command> consumer = updateThermostatValueActions.get(item.getKey());\n+                if (consumer != null) {\n+                    consumer.accept(item.getValue());\n+                }\n+            }\n+        });\n+        return currentThermostat;\n+    }\n+\n+    private LinkedList<SimpleImmutableEntry<String, Command>> ensureUpdatedValueListExists() {\n+        final LinkedList<SimpleImmutableEntry<String, Command>> updatedValues = this.updatedValues;\n+        if (updatedValues != null) {\n+            return updatedValues;\n+        }\n+        LinkedList<SimpleImmutableEntry<String, Command>> internalUpdatedValue = new LinkedList<>();\n+        this.updatedValues = internalUpdatedValue;\n+        return internalUpdatedValue;\n+    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzAwMzI0MQ=="}, "originalCommit": {"oid": "bbda3043e092ae6f1669629c2d7aabc98ce34427"}, "originalPosition": 101}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM0Mzk4MDQxOnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.ojelectronics/src/main/java/org/openhab/binding/ojelectronics/internal/OJCloudHandlerFactory.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQwMTowNjoyOFrOH8UFtA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQxNjoyMzo0NFrOH81BkQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzAwNTc0OA==", "bodyText": "?", "url": "https://github.com/openhab/openhab-addons/pull/9168#discussion_r533005748", "createdAt": "2020-12-01T01:06:28Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.ojelectronics/src/main/java/org/openhab/binding/ojelectronics/internal/OJCloudHandlerFactory.java", "diffHunk": "@@ -69,5 +69,5 @@ public boolean supportsThingType(ThingTypeUID thingTypeUID) {\n             return handler;\n         }\n         return null;\n-    }\n+    };", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bbda3043e092ae6f1669629c2d7aabc98ce34427"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzU0NTM2MQ==", "bodyText": "I fixed it", "url": "https://github.com/openhab/openhab-addons/pull/9168#discussion_r533545361", "createdAt": "2020-12-01T16:23:44Z", "author": {"login": "EvilPingu"}, "path": "bundles/org.openhab.binding.ojelectronics/src/main/java/org/openhab/binding/ojelectronics/internal/OJCloudHandlerFactory.java", "diffHunk": "@@ -69,5 +69,5 @@ public boolean supportsThingType(ThingTypeUID thingTypeUID) {\n             return handler;\n         }\n         return null;\n-    }\n+    };", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzAwNTc0OA=="}, "originalCommit": {"oid": "bbda3043e092ae6f1669629c2d7aabc98ce34427"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM0Mzk5NTg5OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.ojelectronics/src/main/java/org/openhab/binding/ojelectronics/internal/ThermostatHandler.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQwMToxMzo0MlrOH8UOzw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMVQxNjoyNDo1M1rOH81FQg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzAwODA3OQ==", "bodyText": "Instead of using the default ZoneId, try using the one provided by the TimeZoneProvider osgi service. You will have to get the service as a @Reference in the ThingHandlerFactory and then pass it in through the constructor of this handler.", "url": "https://github.com/openhab/openhab-addons/pull/9168#discussion_r533008079", "createdAt": "2020-12-01T01:13:42Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.ojelectronics/src/main/java/org/openhab/binding/ojelectronics/internal/ThermostatHandler.java", "diffHunk": "@@ -158,6 +254,42 @@ private void updateGroupName(Thermostat thermostat) {\n         updateState(BindingConstants.CHANNEL_OWD5_GROUPNAME, StringType.valueOf(thermostat.groupName));\n     }\n \n+    private void updateVacationEnabled(Thermostat thermostat) {\n+        updateState(BindingConstants.CHANNEL_OWD5_VACATIONENABLED,\n+                thermostat.online ? OpenClosedType.OPEN : OpenClosedType.CLOSED);\n+    }\n+\n+    private void updateVacationBeginDay(Thermostat thermostat) {\n+        updateState(BindingConstants.CHANNEL_OWD5_VACATIONBEGINDAY,\n+                new DateTimeType(\n+                        ZonedDateTime.ofInstant(thermostat.vacationBeginDay.toInstant(), ZoneId.systemDefault())\n+                                .truncatedTo(ChronoUnit.DAYS)));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "bbda3043e092ae6f1669629c2d7aabc98ce34427"}, "originalPosition": 187}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzU0NjMwNg==", "bodyText": "Thanks for the hint. I fixed it.", "url": "https://github.com/openhab/openhab-addons/pull/9168#discussion_r533546306", "createdAt": "2020-12-01T16:24:53Z", "author": {"login": "EvilPingu"}, "path": "bundles/org.openhab.binding.ojelectronics/src/main/java/org/openhab/binding/ojelectronics/internal/ThermostatHandler.java", "diffHunk": "@@ -158,6 +254,42 @@ private void updateGroupName(Thermostat thermostat) {\n         updateState(BindingConstants.CHANNEL_OWD5_GROUPNAME, StringType.valueOf(thermostat.groupName));\n     }\n \n+    private void updateVacationEnabled(Thermostat thermostat) {\n+        updateState(BindingConstants.CHANNEL_OWD5_VACATIONENABLED,\n+                thermostat.online ? OpenClosedType.OPEN : OpenClosedType.CLOSED);\n+    }\n+\n+    private void updateVacationBeginDay(Thermostat thermostat) {\n+        updateState(BindingConstants.CHANNEL_OWD5_VACATIONBEGINDAY,\n+                new DateTimeType(\n+                        ZonedDateTime.ofInstant(thermostat.vacationBeginDay.toInstant(), ZoneId.systemDefault())\n+                                .truncatedTo(ChronoUnit.DAYS)));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzAwODA3OQ=="}, "originalCommit": {"oid": "bbda3043e092ae6f1669629c2d7aabc98ce34427"}, "originalPosition": 187}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzM2MDA4MTk0OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.ojelectronics/src/main/java/org/openhab/binding/ojelectronics/internal/ThermostatHandlerFactory.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wM1QyMDowNTozMlrOH-vTKQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wN1QyMzowNzo1NVrOIA-62g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTU0ODcxMw==", "bodyText": "Since the user can change the timezone in the openHAB during runtime, you shouldn't cache time zone from TimeZoneProvider. So you will need to pass the TimeZoneProvider into the ThermostatHandler instead.", "url": "https://github.com/openhab/openhab-addons/pull/9168#discussion_r535548713", "createdAt": "2020-12-03T20:05:32Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.ojelectronics/src/main/java/org/openhab/binding/ojelectronics/internal/ThermostatHandlerFactory.java", "diffHunk": "@@ -36,6 +40,17 @@\n public class ThermostatHandlerFactory extends BaseThingHandlerFactory {\n \n     private static final Set<ThingTypeUID> SUPPORTED_THING_TYPES_UIDS = Collections.singleton(THING_TYPE_OWD5);\n+    private final ZoneId timeZone;\n+\n+    /**\n+     * Creates a new factory\n+     *\n+     * @param httpClientFactory Factory for HttpClient\n+     */\n+    @Activate\n+    public ThermostatHandlerFactory(@Reference TimeZoneProvider timeZoneProvider) {\n+        this.timeZone = timeZoneProvider.getTimeZone();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5151869e5f2450672d7fde8369ff470b388eb72e"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjAzNzM4Nw==", "bodyText": "I changed this.", "url": "https://github.com/openhab/openhab-addons/pull/9168#discussion_r536037387", "createdAt": "2020-12-04T11:38:24Z", "author": {"login": "EvilPingu"}, "path": "bundles/org.openhab.binding.ojelectronics/src/main/java/org/openhab/binding/ojelectronics/internal/ThermostatHandlerFactory.java", "diffHunk": "@@ -36,6 +40,17 @@\n public class ThermostatHandlerFactory extends BaseThingHandlerFactory {\n \n     private static final Set<ThingTypeUID> SUPPORTED_THING_TYPES_UIDS = Collections.singleton(THING_TYPE_OWD5);\n+    private final ZoneId timeZone;\n+\n+    /**\n+     * Creates a new factory\n+     *\n+     * @param httpClientFactory Factory for HttpClient\n+     */\n+    @Activate\n+    public ThermostatHandlerFactory(@Reference TimeZoneProvider timeZoneProvider) {\n+        this.timeZone = timeZoneProvider.getTimeZone();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTU0ODcxMw=="}, "originalCommit": {"oid": "5151869e5f2450672d7fde8369ff470b388eb72e"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjA3OTAwNw==", "bodyText": "@cpmeister By the way: Why does my builds always fail?", "url": "https://github.com/openhab/openhab-addons/pull/9168#discussion_r536079007", "createdAt": "2020-12-04T12:54:03Z", "author": {"login": "EvilPingu"}, "path": "bundles/org.openhab.binding.ojelectronics/src/main/java/org/openhab/binding/ojelectronics/internal/ThermostatHandlerFactory.java", "diffHunk": "@@ -36,6 +40,17 @@\n public class ThermostatHandlerFactory extends BaseThingHandlerFactory {\n \n     private static final Set<ThingTypeUID> SUPPORTED_THING_TYPES_UIDS = Collections.singleton(THING_TYPE_OWD5);\n+    private final ZoneId timeZone;\n+\n+    /**\n+     * Creates a new factory\n+     *\n+     * @param httpClientFactory Factory for HttpClient\n+     */\n+    @Activate\n+    public ThermostatHandlerFactory(@Reference TimeZoneProvider timeZoneProvider) {\n+        this.timeZone = timeZoneProvider.getTimeZone();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTU0ODcxMw=="}, "originalCommit": {"oid": "5151869e5f2450672d7fde8369ff470b388eb72e"}, "originalPosition": 35}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzkwMTc4Ng==", "bodyText": "Almost all of the jenkins builds are failing for one reason or another. It mostly has to do with timing dependent unit tests that are failing because of the high load on the server. As long as your project builds and your project's unit tests pass I wouldn't worry about it.", "url": "https://github.com/openhab/openhab-addons/pull/9168#discussion_r537901786", "createdAt": "2020-12-07T23:07:55Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.ojelectronics/src/main/java/org/openhab/binding/ojelectronics/internal/ThermostatHandlerFactory.java", "diffHunk": "@@ -36,6 +40,17 @@\n public class ThermostatHandlerFactory extends BaseThingHandlerFactory {\n \n     private static final Set<ThingTypeUID> SUPPORTED_THING_TYPES_UIDS = Collections.singleton(THING_TYPE_OWD5);\n+    private final ZoneId timeZone;\n+\n+    /**\n+     * Creates a new factory\n+     *\n+     * @param httpClientFactory Factory for HttpClient\n+     */\n+    @Activate\n+    public ThermostatHandlerFactory(@Reference TimeZoneProvider timeZoneProvider) {\n+        this.timeZone = timeZoneProvider.getTimeZone();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTU0ODcxMw=="}, "originalCommit": {"oid": "5151869e5f2450672d7fde8369ff470b388eb72e"}, "originalPosition": 35}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3743, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}