{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQwODM3MTky", "number": 8017, "title": "[mqtt][homie] Delete '$name' subscription in discovery service", "bodyText": "Context:\nAlthough we thought that #7723 would solve #7252, the truth is that after the release of openHAB 2.5.6, new users started complaining that their Homie devices were not behaving correctly ($name message does not arrive). Taking into account that there are some problems with subscriptions and retained messages (in some circumstances the binding does not receive all the messages it should), it has been decided to remove the subscription to the \"homie/xxx/$name\" topic in the Homie300Discovery class. The only problem with this solution is that the name of the thing will be the same as the device id of Homie, but I think that this small loss of functionality will compensate for the advantage of fixing the bug. Also, the transport.io.mqtt library is already being improved to fix its bugs (openhab/openhab-core@cc3f140, thanks @jochen314), although these changes are only valid for openHAB Core 3, so I think that, until openHAB3 is released, it is better to opt for this workaround.\nAlso, in the PR a new timeout has been added in the HomieThingHandler, which represents the maximum time the device can take to be completely processed. This timeout does have a high value (5000 milliseconds), although the other two timeouts still have values below 500 milliseconds. This improvement ends up defining the changes introduced in #7760, since the previous code could fail in devices with many nodes and properties.\nWhat do you think @jochen314, @cpmeister, @J-N-K?\nThanks!\nCloses #7252", "createdAt": "2020-06-27T00:48:12Z", "url": "https://github.com/openhab/openhab-addons/pull/8017", "merged": true, "mergeCommit": {"oid": "dc8b85cc9196057e9171acee36f883d73e6f461c"}, "closed": true, "closedAt": "2020-07-30T18:49:19Z", "author": {"login": "bodiroga"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcvWePgAH2gAyNDQwODM3MTkyOmU3YTIwYjA0Yjk5YmRkMjQxMzdhMWYyMTIwNzgyNjM5MWI4MDllNjg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABc6EOA4gFqTQ1ODY2Njk5MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "e7a20b04b99bdd24137a1f21207826391b809e68", "author": {"user": {"login": "bodiroga", "name": "Aitor Iturrioz"}}, "url": "https://github.com/openhab/openhab-addons/commit/e7a20b04b99bdd24137a1f21207826391b809e68", "committedDate": "2020-06-27T11:51:28Z", "message": "[mqtt][homie] Delete 'name' subscription in discovery service\n\nSigned-off-by: Aitor Iturrioz <riturrioz@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "dc8166677ce8c7fc42bb309b5aba8808ec275709", "author": {"user": {"login": "bodiroga", "name": "Aitor Iturrioz"}}, "url": "https://github.com/openhab/openhab-addons/commit/dc8166677ce8c7fc42bb309b5aba8808ec275709", "committedDate": "2020-06-27T00:11:43Z", "message": "[mqtt][homie] Delete 'name' subscription in discovery service"}, "afterCommit": {"oid": "e7a20b04b99bdd24137a1f21207826391b809e68", "author": {"user": {"login": "bodiroga", "name": "Aitor Iturrioz"}}, "url": "https://github.com/openhab/openhab-addons/commit/e7a20b04b99bdd24137a1f21207826391b809e68", "committedDate": "2020-06-27T11:51:28Z", "message": "[mqtt][homie] Delete 'name' subscription in discovery service\n\nSigned-off-by: Aitor Iturrioz <riturrioz@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4MzA5NTUx", "url": "https://github.com/openhab/openhab-addons/pull/8017#pullrequestreview-458309551", "createdAt": "2020-07-30T11:21:18Z", "commit": {"oid": "e7a20b04b99bdd24137a1f21207826391b809e68"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxMToyMToxOVrOG5e32A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0zMFQxMToyMToxOVrOG5e32A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjkyNzgzMg==", "bodyText": "Nice to put them in constants. Can you add the unit on these constants:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public static final int HOMIE_DEVICE_TIMEOUT = 5000;\n          \n          \n            \n                public static final int HOMIE_SUBSCRIBE_TIMEOUT = 500;\n          \n          \n            \n                public static final int HOMIE_ATTRIBUTE_TIMEOUT = 200;\n          \n          \n            \n                public static final int HOMIE_DEVICE_TIMEOUT_MS = 5000;\n          \n          \n            \n                public static final int HOMIE_SUBSCRIBE_TIMEOUT_MS = 500;\n          \n          \n            \n                public static final int HOMIE_ATTRIBUTE_TIMEOUT_MS = 200;", "url": "https://github.com/openhab/openhab-addons/pull/8017#discussion_r462927832", "createdAt": "2020-07-30T11:21:19Z", "author": {"login": "Hilbrand"}, "path": "bundles/org.openhab.binding.mqtt.homie/src/main/java/org/openhab/binding/mqtt/homie/generic/internal/MqttBindingConstants.java", "diffHunk": "@@ -33,4 +33,8 @@\n \n     public static final String HOMIE_PROPERTY_VERSION = \"homieversion\";\n     public static final String HOMIE_PROPERTY_HEARTBEAT_INTERVAL = \"heartbeat_interval\";\n+\n+    public static final int HOMIE_DEVICE_TIMEOUT = 5000;\n+    public static final int HOMIE_SUBSCRIBE_TIMEOUT = 500;\n+    public static final int HOMIE_ATTRIBUTE_TIMEOUT = 200;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "e7a20b04b99bdd24137a1f21207826391b809e68"}, "originalPosition": 7}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "e48ee14125dae444a85bda00de6980aa723caefe", "author": {"user": {"login": "bodiroga", "name": "Aitor Iturrioz"}}, "url": "https://github.com/openhab/openhab-addons/commit/e48ee14125dae444a85bda00de6980aa723caefe", "committedDate": "2020-07-30T15:11:57Z", "message": "Address review comments\n\nSigned-off-by: Aitor Iturrioz <riturrioz@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDU4NjY2OTkw", "url": "https://github.com/openhab/openhab-addons/pull/8017#pullrequestreview-458666990", "createdAt": "2020-07-30T18:48:37Z", "commit": {"oid": "e48ee14125dae444a85bda00de6980aa723caefe"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 373, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}