{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDkwMTgyNzMy", "number": 8516, "reviewThreads": {"totalCount": 19, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0yNlQxODowMToxM1rOFrDeQA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNS0wNlQwNzowNzoxMlrOF68PUg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzgwNjg5OTg0OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.automation.jsscripting/.classpath", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0yNlQxODowMToxM1rOI-lPxg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0yNlQxODowMToxM1rOI-lPxg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMjQ5Mjg3MA==", "bodyText": "We no longer add these files to the repo so please remove it.", "url": "https://github.com/openhab/openhab-addons/pull/8516#discussion_r602492870", "createdAt": "2021-03-26T18:01:13Z", "author": {"login": "wborn"}, "path": "bundles/org.openhab.automation.jsscripting/.classpath", "diffHunk": "@@ -0,0 +1,32 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9dead4836e01237e3a679b8f9efde5599114faac"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzgwNjkwMDM4OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.automation.jsscripting/.project", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0yNlQxODowMToyM1rOI-lQEw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0yNlQxODowMToyM1rOI-lQEw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMjQ5Mjk0Nw==", "bodyText": "We no longer add these files to the repo so please remove it.", "url": "https://github.com/openhab/openhab-addons/pull/8516#discussion_r602492947", "createdAt": "2021-03-26T18:01:23Z", "author": {"login": "wborn"}, "path": "bundles/org.openhab.automation.jsscripting/.project", "diffHunk": "@@ -0,0 +1,23 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9dead4836e01237e3a679b8f9efde5599114faac"}, "originalPosition": 1}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzgwNjkwMTA0OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.automation.jsscripting/README.md", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0yNlQxODowMTozNVrOI-lQew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0yNlQxODowMTozNVrOI-lQew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMjQ5MzA1MQ==", "bodyText": "Please add something similar to the Jython and Groovy add-ons.", "url": "https://github.com/openhab/openhab-addons/pull/8516#discussion_r602493051", "createdAt": "2021-03-26T18:01:35Z", "author": {"login": "wborn"}, "path": "bundles/org.openhab.automation.jsscripting/README.md", "diffHunk": "@@ -0,0 +1,3 @@\n+# JSScripting\n+\n+TODO", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9dead4836e01237e3a679b8f9efde5599114faac"}, "originalPosition": 3}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzgwNjkwMjc1OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.automation.jsscripting/pom.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0yNlQxODowMjowM1rOI-lRhg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0yNlQxODowMjowM1rOI-lRhg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMjQ5MzMxOA==", "bodyText": "No headers in POM files please:\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            <!--\n          \n          \n            \n              Copyright (c) 2010-2020 Contributors to the openHAB project\n          \n          \n            \n            \n          \n          \n            \n              See the NOTICE file(s) distributed with this work for additional\n          \n          \n            \n              information.\n          \n          \n            \n            \n          \n          \n            \n              This program and the accompanying materials are made available under the\n          \n          \n            \n              terms of the Eclipse Public License 2.0 which is available at\n          \n          \n            \n              http://www.eclipse.org/legal/epl-2.0\n          \n          \n            \n            \n          \n          \n            \n              SPDX-License-Identifier: EPL-2.0\n          \n          \n            \n            -->", "url": "https://github.com/openhab/openhab-addons/pull/8516#discussion_r602493318", "createdAt": "2021-03-26T18:02:03Z", "author": {"login": "wborn"}, "path": "bundles/org.openhab.automation.jsscripting/pom.xml", "diffHunk": "@@ -0,0 +1,140 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!--\n+  Copyright (c) 2010-2020 Contributors to the openHAB project\n+\n+  See the NOTICE file(s) distributed with this work for additional\n+  information.\n+\n+  This program and the accompanying materials are made available under the\n+  terms of the Eclipse Public License 2.0 which is available at\n+  http://www.eclipse.org/legal/epl-2.0\n+\n+  SPDX-License-Identifier: EPL-2.0\n+-->\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9dead4836e01237e3a679b8f9efde5599114faac"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzgwNjkwMzU1OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.automation.jsscripting/pom.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0yNlQxODowMjoxNVrOI-lR-g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0yNlQxODowMjoxNVrOI-lR-g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMjQ5MzQzNA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                <version>3.0.0-SNAPSHOT</version>\n          \n          \n            \n                <version>3.1.0-SNAPSHOT</version>", "url": "https://github.com/openhab/openhab-addons/pull/8516#discussion_r602493434", "createdAt": "2021-03-26T18:02:15Z", "author": {"login": "wborn"}, "path": "bundles/org.openhab.automation.jsscripting/pom.xml", "diffHunk": "@@ -0,0 +1,140 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!--\n+  Copyright (c) 2010-2020 Contributors to the openHAB project\n+\n+  See the NOTICE file(s) distributed with this work for additional\n+  information.\n+\n+  This program and the accompanying materials are made available under the\n+  terms of the Eclipse Public License 2.0 which is available at\n+  http://www.eclipse.org/legal/epl-2.0\n+\n+  SPDX-License-Identifier: EPL-2.0\n+-->\n+\n+<project xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+  xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+\n+  <modelVersion>4.0.0</modelVersion>\n+\n+  <parent>\n+    <groupId>org.openhab.addons.bundles</groupId>\n+    <artifactId>org.openhab.addons.reactor.bundles</artifactId>\n+    <version>3.0.0-SNAPSHOT</version>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9dead4836e01237e3a679b8f9efde5599114faac"}, "originalPosition": 23}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzgwNjkwNzU5OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.automation.jsscripting/pom.xml", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0yNlQxODowMzoxN1rOI-lUYQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0yNlQxODowMzoxN1rOI-lUYQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMjQ5NDA0OQ==", "bodyText": "Is it possible to also add this to the bnd.bnd file?", "url": "https://github.com/openhab/openhab-addons/pull/8516#discussion_r602494049", "createdAt": "2021-03-26T18:03:17Z", "author": {"login": "wborn"}, "path": "bundles/org.openhab.automation.jsscripting/pom.xml", "diffHunk": "@@ -0,0 +1,140 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!--\n+  Copyright (c) 2010-2020 Contributors to the openHAB project\n+\n+  See the NOTICE file(s) distributed with this work for additional\n+  information.\n+\n+  This program and the accompanying materials are made available under the\n+  terms of the Eclipse Public License 2.0 which is available at\n+  http://www.eclipse.org/legal/epl-2.0\n+\n+  SPDX-License-Identifier: EPL-2.0\n+-->\n+\n+<project xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+  xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+\n+  <modelVersion>4.0.0</modelVersion>\n+\n+  <parent>\n+    <groupId>org.openhab.addons.bundles</groupId>\n+    <artifactId>org.openhab.addons.reactor.bundles</artifactId>\n+    <version>3.0.0-SNAPSHOT</version>\n+  </parent>\n+\n+  <artifactId>org.openhab.automation.jsscripting</artifactId>\n+\n+  <name>openHAB Add-ons :: Bundles :: Automation :: JSScripting</name>\n+\n+  <properties>\n+    <bnd.importpackage>\n+      !sun.misc.*,\n+      !sun.reflect.*,\n+      !com.sun.management.*,\n+      !jdk.internal.reflect.*,\n+      !jdk.vm.ci.services\n+    </bnd.importpackage>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9dead4836e01237e3a679b8f9efde5599114faac"}, "originalPosition": 37}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzgwNjkxODg0OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.automation.jsscripting/src/main/java/org/openhab/automation/jsscripting/internal/OpenhabGraalJSScriptEngine.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0yNlQxODowNjoxM1rOI-lbdA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0yNlQxODowNjoxM1rOI-lbdA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMjQ5NTg2MA==", "bodyText": "It's more clear and saves 1 line when you annotate the type:\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                @NonNullByDefault({})\n          \n          \n            \n                private String engineIdentifier;\n          \n          \n            \n                private @NonNullByDefault({}) String engineIdentifier;\n          \n      \n    \n    \n  \n\nPlease also check the others.", "url": "https://github.com/openhab/openhab-addons/pull/8516#discussion_r602495860", "createdAt": "2021-03-26T18:06:13Z", "author": {"login": "wborn"}, "path": "bundles/org.openhab.automation.jsscripting/src/main/java/org/openhab/automation/jsscripting/internal/OpenhabGraalJSScriptEngine.java", "diffHunk": "@@ -0,0 +1,132 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+\n+package org.openhab.automation.jsscripting.internal;\n+\n+import static org.openhab.core.automation.module.script.ScriptEngineFactory.*;\n+\n+import java.io.File;\n+import java.io.IOException;\n+import java.nio.channels.SeekableByteChannel;\n+import java.nio.file.FileSystems;\n+import java.nio.file.OpenOption;\n+import java.nio.file.Path;\n+import java.nio.file.attribute.FileAttribute;\n+import java.util.Set;\n+import java.util.function.Consumer;\n+import java.util.function.Function;\n+\n+import javax.script.*;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.graalvm.polyglot.Context;\n+import org.openhab.automation.jsscripting.internal.fs.DelegatingFileSystem;\n+import org.openhab.automation.jsscripting.internal.fs.PrefixedSeekableByteChannel;\n+import org.openhab.automation.jsscripting.internal.scriptengine.InvocationInterceptingScriptEngineWithInvocable;\n+import org.openhab.core.OpenHAB;\n+import org.openhab.core.automation.module.script.ScriptExtensionAccessor;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import com.oracle.truffle.js.scriptengine.GraalJSScriptEngine;\n+\n+/**\n+ * GraalJS Script Engine implementation\n+ *\n+ * @author Jonathan Gilbert - Initial contribution\n+ */\n+public class OpenhabGraalJSScriptEngine extends InvocationInterceptingScriptEngineWithInvocable<GraalJSScriptEngine> {\n+\n+    private static final Logger logger = LoggerFactory.getLogger(OpenhabGraalJSScriptEngine.class);\n+\n+    private static final String REQUIRE_WRAPPER_NAME = \"__wraprequire__\";\n+    private static final String MODULE_DIR = String.join(File.separator, OpenHAB.getConfigFolder(), \"automation\", \"lib\",\n+            \"javascript\", \"personal\");\n+\n+    // these fields start as null because they are populated on first use\n+    @NonNullByDefault({})\n+    private String engineIdentifier;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9dead4836e01237e3a679b8f9efde5599114faac"}, "originalPosition": 58}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzgwNjkyMzc4OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.automation.jsscripting/src/main/java/org/openhab/automation/jsscripting/internal/scriptengine/InvocationInterceptingScriptEngineWithInvocable.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0yNlQxODowNzoyN1rOI-leYg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0yNlQxODowNzoyN1rOI-leYg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMjQ5NjYxMA==", "bodyText": "All headers probably need to be updated to 2021:\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             * Copyright (c) 2010-2020 Contributors to the openHAB project\n          \n          \n            \n             * Copyright (c) 2010-2021 Contributors to the openHAB project", "url": "https://github.com/openhab/openhab-addons/pull/8516#discussion_r602496610", "createdAt": "2021-03-26T18:07:27Z", "author": {"login": "wborn"}, "path": "bundles/org.openhab.automation.jsscripting/src/main/java/org/openhab/automation/jsscripting/internal/scriptengine/InvocationInterceptingScriptEngineWithInvocable.java", "diffHunk": "@@ -0,0 +1,123 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9dead4836e01237e3a679b8f9efde5599114faac"}, "originalPosition": 2}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzgwNjkzMTI0OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.automation.jsscripting/src/main/java/org/openhab/automation/jsscripting/internal/scriptengine/InvocationInterceptingScriptEngineWithInvocable.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0yNlQxODowOToxOFrOI-li0A==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0yNlQyMjoyMDo1NlrOI-skAA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMjQ5Nzc0NA==", "bodyText": "Please remove any @NonNull annotations, see https://www.openhab.org/docs/developer/guidelines.html#null-annotations. Only @NonNullByDefault  and  @Nullable should be used.", "url": "https://github.com/openhab/openhab-addons/pull/8516#discussion_r602497744", "createdAt": "2021-03-26T18:09:18Z", "author": {"login": "wborn"}, "path": "bundles/org.openhab.automation.jsscripting/src/main/java/org/openhab/automation/jsscripting/internal/scriptengine/InvocationInterceptingScriptEngineWithInvocable.java", "diffHunk": "@@ -0,0 +1,123 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+\n+package org.openhab.automation.jsscripting.internal.scriptengine;\n+\n+import java.io.Reader;\n+\n+import javax.script.*;\n+\n+import org.eclipse.jdt.annotation.NonNull;\n+\n+/**\n+ * Delegate allowing AOP-style interception of calls, either before Invocation, or upon a {@link ScriptException}.\n+ * being thrown.\n+ *\n+ * @author Jonathan Gilbert - Initial contribution\n+ *\n+ * @param <T> The delegate class\n+ */\n+public abstract class InvocationInterceptingScriptEngineWithInvocable<T extends ScriptEngine & Invocable>\n+        extends DelegatingScriptEngineWithInvocable<T> {\n+\n+    public InvocationInterceptingScriptEngineWithInvocable(T delegate) {\n+        super(delegate);\n+    }\n+\n+    protected void beforeInvocation() {\n+    }\n+\n+    protected @NonNull ScriptException afterThrowsInvocation(@NonNull ScriptException se) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9dead4836e01237e3a679b8f9efde5599114faac"}, "originalPosition": 40}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMjYxMjczNg==", "bodyText": "I have a question about this: I originally started with @NonNullByDefault but because this is a delegate class which implements something without null annotations, it requires @NonNull annotations on pretty much everything in the class.  This is why I inverted the annotations. In this case should I proceed and put @NonNull on everything? Or maybe just remove the @NonNullByDefault annotation entirely?", "url": "https://github.com/openhab/openhab-addons/pull/8516#discussion_r602612736", "createdAt": "2021-03-26T22:20:56Z", "author": {"login": "jpg0"}, "path": "bundles/org.openhab.automation.jsscripting/src/main/java/org/openhab/automation/jsscripting/internal/scriptengine/InvocationInterceptingScriptEngineWithInvocable.java", "diffHunk": "@@ -0,0 +1,123 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+\n+package org.openhab.automation.jsscripting.internal.scriptengine;\n+\n+import java.io.Reader;\n+\n+import javax.script.*;\n+\n+import org.eclipse.jdt.annotation.NonNull;\n+\n+/**\n+ * Delegate allowing AOP-style interception of calls, either before Invocation, or upon a {@link ScriptException}.\n+ * being thrown.\n+ *\n+ * @author Jonathan Gilbert - Initial contribution\n+ *\n+ * @param <T> The delegate class\n+ */\n+public abstract class InvocationInterceptingScriptEngineWithInvocable<T extends ScriptEngine & Invocable>\n+        extends DelegatingScriptEngineWithInvocable<T> {\n+\n+    public InvocationInterceptingScriptEngineWithInvocable(T delegate) {\n+        super(delegate);\n+    }\n+\n+    protected void beforeInvocation() {\n+    }\n+\n+    protected @NonNull ScriptException afterThrowsInvocation(@NonNull ScriptException se) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMjQ5Nzc0NA=="}, "originalCommit": {"oid": "9dead4836e01237e3a679b8f9efde5599114faac"}, "originalPosition": 40}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzgwNjkzMzUzOnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.automation.jsscripting/src/main/java/org/openhab/automation/jsscripting/internal/threading/ThreadsafeSimpleRuleDelegate.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0yNlQxODowOTo0OFrOI-lkEQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0yNlQxODowOTo0OFrOI-lkEQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMjQ5ODA2NQ==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                @Nullable\n          \n          \n            \n                public String getTemplateUID() {\n          \n          \n            \n                public @Nullable String getTemplateUID() {\n          \n      \n    \n    \n  \n\nPlease also fix the others.", "url": "https://github.com/openhab/openhab-addons/pull/8516#discussion_r602498065", "createdAt": "2021-03-26T18:09:48Z", "author": {"login": "wborn"}, "path": "bundles/org.openhab.automation.jsscripting/src/main/java/org/openhab/automation/jsscripting/internal/threading/ThreadsafeSimpleRuleDelegate.java", "diffHunk": "@@ -0,0 +1,185 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.automation.jsscripting.internal.threading;\n+\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Set;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.openhab.core.automation.Action;\n+import org.openhab.core.automation.Condition;\n+import org.openhab.core.automation.Module;\n+import org.openhab.core.automation.Rule;\n+import org.openhab.core.automation.Trigger;\n+import org.openhab.core.automation.Visibility;\n+import org.openhab.core.automation.module.script.rulesupport.shared.simple.SimpleRule;\n+import org.openhab.core.automation.module.script.rulesupport.shared.simple.SimpleRuleActionHandler;\n+import org.openhab.core.config.core.ConfigDescriptionParameter;\n+import org.openhab.core.config.core.Configuration;\n+\n+/**\n+ * An version of {@link SimpleRule} which controls multithreaded execution access to this specific rule. This is useful\n+ * for rules which wrap GraalJS Contexts, which are not multithreaded.\n+ *\n+ * @author Jonathan Gilbert - Initial contribution\n+ */\n+@NonNullByDefault\n+class ThreadsafeSimpleRuleDelegate implements Rule, SimpleRuleActionHandler {\n+\n+    private final Object lock;\n+    private final SimpleRule delegate;\n+\n+    /**\n+     * Constructor requires a lock object and delegate to forward invocations to.\n+     *\n+     * @param lock rule executions will synchronize on this object\n+     * @param delegate the delegate to forward invocations to\n+     */\n+    ThreadsafeSimpleRuleDelegate(Object lock, SimpleRule delegate) {\n+        this.lock = lock;\n+        this.delegate = delegate;\n+    }\n+\n+    @Override\n+    @NonNullByDefault({})\n+    public Object execute(Action module, Map<String, ?> inputs) {\n+        synchronized (lock) {\n+            return delegate.execute(module, inputs);\n+        }\n+    }\n+\n+    @Override\n+    public String getUID() {\n+        return delegate.getUID();\n+    }\n+\n+    @Override\n+    @Nullable\n+    public String getTemplateUID() {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9dead4836e01237e3a679b8f9efde5599114faac"}, "originalPosition": 70}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzgwNjkzNTk0OnYy", "diffSide": "RIGHT", "path": "bundles/pom.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0yNlQxODoxMDoyM1rOI-lleg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0yNlQxODoxMDoyM1rOI-lleg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMjQ5ODQyNg==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change", "url": "https://github.com/openhab/openhab-addons/pull/8516#discussion_r602498426", "createdAt": "2021-03-26T18:10:23Z", "author": {"login": "wborn"}, "path": "bundles/pom.xml", "diffHunk": "@@ -20,7 +20,9 @@\n     <!-- automation -->\n     <module>org.openhab.automation.groovyscripting</module>\n     <module>org.openhab.automation.jythonscripting</module>\n+    <module>org.openhab.automation.jsscripting</module>\n     <module>org.openhab.automation.pidcontroller</module>\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9dead4836e01237e3a679b8f9efde5599114faac"}, "originalPosition": 6}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzgwNjkzOTcwOnYy", "diffSide": "RIGHT", "path": "bundles/pom.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0yNlQxODoxMToyNlrOI-lnzQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0yNlQxODoxMToyNlrOI-lnzQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMjQ5OTAyMQ==", "bodyText": "Please also add the add-on to bom/openhab-addons/pom.xml.", "url": "https://github.com/openhab/openhab-addons/pull/8516#discussion_r602499021", "createdAt": "2021-03-26T18:11:26Z", "author": {"login": "wborn"}, "path": "bundles/pom.xml", "diffHunk": "@@ -20,7 +20,9 @@\n     <!-- automation -->\n     <module>org.openhab.automation.groovyscripting</module>\n     <module>org.openhab.automation.jythonscripting</module>\n+    <module>org.openhab.automation.jsscripting</module>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9dead4836e01237e3a679b8f9efde5599114faac"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzgwNjk0NDE0OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.automation.jsscripting/src/main/java/org/openhab/automation/jsscripting/internal/DebuggingGraalScriptEngine.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0yNlQxODoxMjo0NVrOI-lqjg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0yNlQxODoxMjo0NVrOI-lqjg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMjQ5OTcyNg==", "bodyText": "Please check your IDE settings. * imports should only be used with static imports. The next time an openHAB Eclipse IDE user saves this file it will results in unnecessary diffs. \ud83d\ude41", "url": "https://github.com/openhab/openhab-addons/pull/8516#discussion_r602499726", "createdAt": "2021-03-26T18:12:45Z", "author": {"login": "wborn"}, "path": "bundles/org.openhab.automation.jsscripting/src/main/java/org/openhab/automation/jsscripting/internal/DebuggingGraalScriptEngine.java", "diffHunk": "@@ -0,0 +1,47 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+\n+package org.openhab.automation.jsscripting.internal;\n+\n+import javax.script.*;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9dead4836e01237e3a679b8f9efde5599114faac"}, "originalPosition": 16}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzgwNjk5Njc4OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.automation.jsscripting/pom.xml", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0yNlQxODoyNjo1OVrOI-mJuw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0yN1QwMzoxNzo0NFrOI-vhyQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMjUwNzcwNw==", "bodyText": "Why are these Core BOMs dependencies here? Normally those should be inherited.", "url": "https://github.com/openhab/openhab-addons/pull/8516#discussion_r602507707", "createdAt": "2021-03-26T18:26:59Z", "author": {"login": "wborn"}, "path": "bundles/org.openhab.automation.jsscripting/pom.xml", "diffHunk": "@@ -0,0 +1,140 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!--\n+  Copyright (c) 2010-2020 Contributors to the openHAB project\n+\n+  See the NOTICE file(s) distributed with this work for additional\n+  information.\n+\n+  This program and the accompanying materials are made available under the\n+  terms of the Eclipse Public License 2.0 which is available at\n+  http://www.eclipse.org/legal/epl-2.0\n+\n+  SPDX-License-Identifier: EPL-2.0\n+-->\n+\n+<project xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+  xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+\n+  <modelVersion>4.0.0</modelVersion>\n+\n+  <parent>\n+    <groupId>org.openhab.addons.bundles</groupId>\n+    <artifactId>org.openhab.addons.reactor.bundles</artifactId>\n+    <version>3.0.0-SNAPSHOT</version>\n+  </parent>\n+\n+  <artifactId>org.openhab.automation.jsscripting</artifactId>\n+\n+  <name>openHAB Add-ons :: Bundles :: Automation :: JSScripting</name>\n+\n+  <properties>\n+    <bnd.importpackage>\n+      !sun.misc.*,\n+      !sun.reflect.*,\n+      !com.sun.management.*,\n+      !jdk.internal.reflect.*,\n+      !jdk.vm.ci.services\n+    </bnd.importpackage>\n+    <graal.version>20.1.0</graal.version>\n+    <asm.version>6.2.1</asm.version>\n+    <oh.version>${project.version}</oh.version>\n+  </properties>\n+\n+  <build>\n+    <plugins>\n+      <plugin>\n+        <groupId>org.apache.maven.plugins</groupId>\n+        <artifactId>maven-dependency-plugin</artifactId>\n+        <executions>\n+          <execution>\n+            <id>embed-dependencies</id>\n+            <goals>\n+              <goal>unpack-dependencies</goal>\n+            </goals>\n+            <configuration>\n+              <excludes>META-INF/services/com.oracle.truffle.api.TruffleLanguage$Provider</excludes> <!-- we'll provide this -->\n+            </configuration>\n+          </execution>\n+        </executions>\n+      </plugin>\n+    </plugins>\n+  </build>\n+\n+  <dependencies>\n+    <dependency>\n+      <groupId>org.graalvm.truffle</groupId>\n+      <artifactId>truffle-api</artifactId>\n+      <version>${graal.version}</version>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.graalvm.js</groupId>\n+      <artifactId>js-scriptengine</artifactId>\n+      <version>${graal.version}</version>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.graalvm.js</groupId>\n+      <artifactId>js-launcher</artifactId>\n+      <version>${graal.version}</version>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.graalvm.sdk</groupId>\n+      <artifactId>graal-sdk</artifactId>\n+      <version>${graal.version}</version>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.graalvm.regex</groupId>\n+      <artifactId>regex</artifactId>\n+      <version>${graal.version}</version>\n+    </dependency>\n+    <dependency> <!-- this must come AFTER the regex lib -->\n+      <groupId>org.graalvm.js</groupId>\n+      <artifactId>js</artifactId>\n+      <version>${graal.version}</version>\n+    </dependency>\n+    <dependency>\n+      <groupId>com.ibm.icu</groupId>\n+      <artifactId>icu4j</artifactId>\n+      <version>62.1</version>\n+    </dependency>\n+\n+    <!-- include as version required is older than OH provides -->\n+    <dependency>\n+      <groupId>org.ow2.asm</groupId>\n+      <artifactId>asm</artifactId>\n+      <version>${asm.version}</version>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.ow2.asm</groupId>\n+      <artifactId>asm-commons</artifactId>\n+      <version>${asm.version}</version>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.ow2.asm</groupId>\n+      <artifactId>asm-tree</artifactId>\n+      <version>${asm.version}</version>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.ow2.asm</groupId>\n+      <artifactId>asm-util</artifactId>\n+      <version>${asm.version}</version>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.ow2.asm</groupId>\n+      <artifactId>asm-analysis</artifactId>\n+      <version>${asm.version}</version>\n+    </dependency>\n+\n+    <dependency>\n+      <groupId>org.openhab.core.bom</groupId>\n+      <artifactId>org.openhab.core.bom.compile</artifactId>\n+      <type>pom</type>\n+      <scope>provided</scope>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.openhab.core.bom</groupId>\n+      <artifactId>org.openhab.core.bom.openhab-core</artifactId>\n+      <type>pom</type>\n+      <scope>provided</scope>\n+    </dependency>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9dead4836e01237e3a679b8f9efde5599114faac"}, "originalPosition": 138}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMjYxOTUyOQ==", "bodyText": "Not sure. It was a while ago. I'll try removing them.", "url": "https://github.com/openhab/openhab-addons/pull/8516#discussion_r602619529", "createdAt": "2021-03-26T22:44:32Z", "author": {"login": "jpg0"}, "path": "bundles/org.openhab.automation.jsscripting/pom.xml", "diffHunk": "@@ -0,0 +1,140 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!--\n+  Copyright (c) 2010-2020 Contributors to the openHAB project\n+\n+  See the NOTICE file(s) distributed with this work for additional\n+  information.\n+\n+  This program and the accompanying materials are made available under the\n+  terms of the Eclipse Public License 2.0 which is available at\n+  http://www.eclipse.org/legal/epl-2.0\n+\n+  SPDX-License-Identifier: EPL-2.0\n+-->\n+\n+<project xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+  xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+\n+  <modelVersion>4.0.0</modelVersion>\n+\n+  <parent>\n+    <groupId>org.openhab.addons.bundles</groupId>\n+    <artifactId>org.openhab.addons.reactor.bundles</artifactId>\n+    <version>3.0.0-SNAPSHOT</version>\n+  </parent>\n+\n+  <artifactId>org.openhab.automation.jsscripting</artifactId>\n+\n+  <name>openHAB Add-ons :: Bundles :: Automation :: JSScripting</name>\n+\n+  <properties>\n+    <bnd.importpackage>\n+      !sun.misc.*,\n+      !sun.reflect.*,\n+      !com.sun.management.*,\n+      !jdk.internal.reflect.*,\n+      !jdk.vm.ci.services\n+    </bnd.importpackage>\n+    <graal.version>20.1.0</graal.version>\n+    <asm.version>6.2.1</asm.version>\n+    <oh.version>${project.version}</oh.version>\n+  </properties>\n+\n+  <build>\n+    <plugins>\n+      <plugin>\n+        <groupId>org.apache.maven.plugins</groupId>\n+        <artifactId>maven-dependency-plugin</artifactId>\n+        <executions>\n+          <execution>\n+            <id>embed-dependencies</id>\n+            <goals>\n+              <goal>unpack-dependencies</goal>\n+            </goals>\n+            <configuration>\n+              <excludes>META-INF/services/com.oracle.truffle.api.TruffleLanguage$Provider</excludes> <!-- we'll provide this -->\n+            </configuration>\n+          </execution>\n+        </executions>\n+      </plugin>\n+    </plugins>\n+  </build>\n+\n+  <dependencies>\n+    <dependency>\n+      <groupId>org.graalvm.truffle</groupId>\n+      <artifactId>truffle-api</artifactId>\n+      <version>${graal.version}</version>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.graalvm.js</groupId>\n+      <artifactId>js-scriptengine</artifactId>\n+      <version>${graal.version}</version>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.graalvm.js</groupId>\n+      <artifactId>js-launcher</artifactId>\n+      <version>${graal.version}</version>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.graalvm.sdk</groupId>\n+      <artifactId>graal-sdk</artifactId>\n+      <version>${graal.version}</version>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.graalvm.regex</groupId>\n+      <artifactId>regex</artifactId>\n+      <version>${graal.version}</version>\n+    </dependency>\n+    <dependency> <!-- this must come AFTER the regex lib -->\n+      <groupId>org.graalvm.js</groupId>\n+      <artifactId>js</artifactId>\n+      <version>${graal.version}</version>\n+    </dependency>\n+    <dependency>\n+      <groupId>com.ibm.icu</groupId>\n+      <artifactId>icu4j</artifactId>\n+      <version>62.1</version>\n+    </dependency>\n+\n+    <!-- include as version required is older than OH provides -->\n+    <dependency>\n+      <groupId>org.ow2.asm</groupId>\n+      <artifactId>asm</artifactId>\n+      <version>${asm.version}</version>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.ow2.asm</groupId>\n+      <artifactId>asm-commons</artifactId>\n+      <version>${asm.version}</version>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.ow2.asm</groupId>\n+      <artifactId>asm-tree</artifactId>\n+      <version>${asm.version}</version>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.ow2.asm</groupId>\n+      <artifactId>asm-util</artifactId>\n+      <version>${asm.version}</version>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.ow2.asm</groupId>\n+      <artifactId>asm-analysis</artifactId>\n+      <version>${asm.version}</version>\n+    </dependency>\n+\n+    <dependency>\n+      <groupId>org.openhab.core.bom</groupId>\n+      <artifactId>org.openhab.core.bom.compile</artifactId>\n+      <type>pom</type>\n+      <scope>provided</scope>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.openhab.core.bom</groupId>\n+      <artifactId>org.openhab.core.bom.openhab-core</artifactId>\n+      <type>pom</type>\n+      <scope>provided</scope>\n+    </dependency>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMjUwNzcwNw=="}, "originalCommit": {"oid": "9dead4836e01237e3a679b8f9efde5599114faac"}, "originalPosition": 138}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMjY2MTMyMQ==", "bodyText": "Looks fine without them, so I've removed them.", "url": "https://github.com/openhab/openhab-addons/pull/8516#discussion_r602661321", "createdAt": "2021-03-27T03:17:44Z", "author": {"login": "jpg0"}, "path": "bundles/org.openhab.automation.jsscripting/pom.xml", "diffHunk": "@@ -0,0 +1,140 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!--\n+  Copyright (c) 2010-2020 Contributors to the openHAB project\n+\n+  See the NOTICE file(s) distributed with this work for additional\n+  information.\n+\n+  This program and the accompanying materials are made available under the\n+  terms of the Eclipse Public License 2.0 which is available at\n+  http://www.eclipse.org/legal/epl-2.0\n+\n+  SPDX-License-Identifier: EPL-2.0\n+-->\n+\n+<project xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+  xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+\n+  <modelVersion>4.0.0</modelVersion>\n+\n+  <parent>\n+    <groupId>org.openhab.addons.bundles</groupId>\n+    <artifactId>org.openhab.addons.reactor.bundles</artifactId>\n+    <version>3.0.0-SNAPSHOT</version>\n+  </parent>\n+\n+  <artifactId>org.openhab.automation.jsscripting</artifactId>\n+\n+  <name>openHAB Add-ons :: Bundles :: Automation :: JSScripting</name>\n+\n+  <properties>\n+    <bnd.importpackage>\n+      !sun.misc.*,\n+      !sun.reflect.*,\n+      !com.sun.management.*,\n+      !jdk.internal.reflect.*,\n+      !jdk.vm.ci.services\n+    </bnd.importpackage>\n+    <graal.version>20.1.0</graal.version>\n+    <asm.version>6.2.1</asm.version>\n+    <oh.version>${project.version}</oh.version>\n+  </properties>\n+\n+  <build>\n+    <plugins>\n+      <plugin>\n+        <groupId>org.apache.maven.plugins</groupId>\n+        <artifactId>maven-dependency-plugin</artifactId>\n+        <executions>\n+          <execution>\n+            <id>embed-dependencies</id>\n+            <goals>\n+              <goal>unpack-dependencies</goal>\n+            </goals>\n+            <configuration>\n+              <excludes>META-INF/services/com.oracle.truffle.api.TruffleLanguage$Provider</excludes> <!-- we'll provide this -->\n+            </configuration>\n+          </execution>\n+        </executions>\n+      </plugin>\n+    </plugins>\n+  </build>\n+\n+  <dependencies>\n+    <dependency>\n+      <groupId>org.graalvm.truffle</groupId>\n+      <artifactId>truffle-api</artifactId>\n+      <version>${graal.version}</version>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.graalvm.js</groupId>\n+      <artifactId>js-scriptengine</artifactId>\n+      <version>${graal.version}</version>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.graalvm.js</groupId>\n+      <artifactId>js-launcher</artifactId>\n+      <version>${graal.version}</version>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.graalvm.sdk</groupId>\n+      <artifactId>graal-sdk</artifactId>\n+      <version>${graal.version}</version>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.graalvm.regex</groupId>\n+      <artifactId>regex</artifactId>\n+      <version>${graal.version}</version>\n+    </dependency>\n+    <dependency> <!-- this must come AFTER the regex lib -->\n+      <groupId>org.graalvm.js</groupId>\n+      <artifactId>js</artifactId>\n+      <version>${graal.version}</version>\n+    </dependency>\n+    <dependency>\n+      <groupId>com.ibm.icu</groupId>\n+      <artifactId>icu4j</artifactId>\n+      <version>62.1</version>\n+    </dependency>\n+\n+    <!-- include as version required is older than OH provides -->\n+    <dependency>\n+      <groupId>org.ow2.asm</groupId>\n+      <artifactId>asm</artifactId>\n+      <version>${asm.version}</version>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.ow2.asm</groupId>\n+      <artifactId>asm-commons</artifactId>\n+      <version>${asm.version}</version>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.ow2.asm</groupId>\n+      <artifactId>asm-tree</artifactId>\n+      <version>${asm.version}</version>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.ow2.asm</groupId>\n+      <artifactId>asm-util</artifactId>\n+      <version>${asm.version}</version>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.ow2.asm</groupId>\n+      <artifactId>asm-analysis</artifactId>\n+      <version>${asm.version}</version>\n+    </dependency>\n+\n+    <dependency>\n+      <groupId>org.openhab.core.bom</groupId>\n+      <artifactId>org.openhab.core.bom.compile</artifactId>\n+      <type>pom</type>\n+      <scope>provided</scope>\n+    </dependency>\n+    <dependency>\n+      <groupId>org.openhab.core.bom</groupId>\n+      <artifactId>org.openhab.core.bom.openhab-core</artifactId>\n+      <type>pom</type>\n+      <scope>provided</scope>\n+    </dependency>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMjUwNzcwNw=="}, "originalCommit": {"oid": "9dead4836e01237e3a679b8f9efde5599114faac"}, "originalPosition": 138}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzgwNzAwMTgwOnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.automation.jsscripting/src/main/feature/feature.xml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0yNlQxODoyODoxM1rOI-mMsw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0yNlQxODo0NTowM1rOI-mxWg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMjUwODQ2Nw==", "bodyText": "This header already gets added when the features are aggregated. Probably we need to update this in the skeleton.\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            <!--\n          \n          \n            \n            \tCopyright (c) 2010-2020 Contributors to the openHAB project\n          \n          \n            \n            \n          \n          \n            \n            \tSee the NOTICE file(s) distributed with this work for additional\n          \n          \n            \n            \tinformation.\n          \n          \n            \n            \n          \n          \n            \n            \tThis program and the accompanying materials are made available under the\n          \n          \n            \n            \tterms of the Eclipse Public License 2.0 which is available at\n          \n          \n            \n            \thttp://www.eclipse.org/legal/epl-2.0\n          \n          \n            \n            \n          \n          \n            \n            \tSPDX-License-Identifier: EPL-2.0\n          \n          \n            \n            -->", "url": "https://github.com/openhab/openhab-addons/pull/8516#discussion_r602508467", "createdAt": "2021-03-26T18:28:13Z", "author": {"login": "wborn"}, "path": "bundles/org.openhab.automation.jsscripting/src/main/feature/feature.xml", "diffHunk": "@@ -0,0 +1,22 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!--\n+\tCopyright (c) 2010-2020 Contributors to the openHAB project\n+\n+\tSee the NOTICE file(s) distributed with this work for additional\n+\tinformation.\n+\n+\tThis program and the accompanying materials are made available under the\n+\tterms of the Eclipse Public License 2.0 which is available at\n+\thttp://www.eclipse.org/legal/epl-2.0\n+\n+\tSPDX-License-Identifier: EPL-2.0\n+-->\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9dead4836e01237e3a679b8f9efde5599114faac"}, "originalPosition": 14}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMjUxNzg1MA==", "bodyText": "We fixed that in openhab/openhab-core#2063 after you started this PR. \ud83d\ude09", "url": "https://github.com/openhab/openhab-addons/pull/8516#discussion_r602517850", "createdAt": "2021-03-26T18:45:03Z", "author": {"login": "wborn"}, "path": "bundles/org.openhab.automation.jsscripting/src/main/feature/feature.xml", "diffHunk": "@@ -0,0 +1,22 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!--\n+\tCopyright (c) 2010-2020 Contributors to the openHAB project\n+\n+\tSee the NOTICE file(s) distributed with this work for additional\n+\tinformation.\n+\n+\tThis program and the accompanying materials are made available under the\n+\tterms of the Eclipse Public License 2.0 which is available at\n+\thttp://www.eclipse.org/legal/epl-2.0\n+\n+\tSPDX-License-Identifier: EPL-2.0\n+-->\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMjUwODQ2Nw=="}, "originalCommit": {"oid": "9dead4836e01237e3a679b8f9efde5599114faac"}, "originalPosition": 14}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzgwNzAwNDc5OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.automation.jsscripting/pom.xml", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0yNlQxODoyOTowMlrOI-mOgg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNS0wNlQwNzowMzowOFrOJWFZKg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMjUwODkzMA==", "bodyText": "Did you look into embedding this content with BND?", "url": "https://github.com/openhab/openhab-addons/pull/8516#discussion_r602508930", "createdAt": "2021-03-26T18:29:02Z", "author": {"login": "wborn"}, "path": "bundles/org.openhab.automation.jsscripting/pom.xml", "diffHunk": "@@ -0,0 +1,140 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!--\n+  Copyright (c) 2010-2020 Contributors to the openHAB project\n+\n+  See the NOTICE file(s) distributed with this work for additional\n+  information.\n+\n+  This program and the accompanying materials are made available under the\n+  terms of the Eclipse Public License 2.0 which is available at\n+  http://www.eclipse.org/legal/epl-2.0\n+\n+  SPDX-License-Identifier: EPL-2.0\n+-->\n+\n+<project xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+  xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+\n+  <modelVersion>4.0.0</modelVersion>\n+\n+  <parent>\n+    <groupId>org.openhab.addons.bundles</groupId>\n+    <artifactId>org.openhab.addons.reactor.bundles</artifactId>\n+    <version>3.0.0-SNAPSHOT</version>\n+  </parent>\n+\n+  <artifactId>org.openhab.automation.jsscripting</artifactId>\n+\n+  <name>openHAB Add-ons :: Bundles :: Automation :: JSScripting</name>\n+\n+  <properties>\n+    <bnd.importpackage>\n+      !sun.misc.*,\n+      !sun.reflect.*,\n+      !com.sun.management.*,\n+      !jdk.internal.reflect.*,\n+      !jdk.vm.ci.services\n+    </bnd.importpackage>\n+    <graal.version>20.1.0</graal.version>\n+    <asm.version>6.2.1</asm.version>\n+    <oh.version>${project.version}</oh.version>\n+  </properties>\n+\n+  <build>\n+    <plugins>\n+      <plugin>\n+        <groupId>org.apache.maven.plugins</groupId>\n+        <artifactId>maven-dependency-plugin</artifactId>\n+        <executions>\n+          <execution>\n+            <id>embed-dependencies</id>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9dead4836e01237e3a679b8f9efde5599114faac"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMjYxOTQwMA==", "bodyText": "I have not, but I will do...", "url": "https://github.com/openhab/openhab-addons/pull/8516#discussion_r602619400", "createdAt": "2021-03-26T22:44:03Z", "author": {"login": "jpg0"}, "path": "bundles/org.openhab.automation.jsscripting/pom.xml", "diffHunk": "@@ -0,0 +1,140 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!--\n+  Copyright (c) 2010-2020 Contributors to the openHAB project\n+\n+  See the NOTICE file(s) distributed with this work for additional\n+  information.\n+\n+  This program and the accompanying materials are made available under the\n+  terms of the Eclipse Public License 2.0 which is available at\n+  http://www.eclipse.org/legal/epl-2.0\n+\n+  SPDX-License-Identifier: EPL-2.0\n+-->\n+\n+<project xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+  xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+\n+  <modelVersion>4.0.0</modelVersion>\n+\n+  <parent>\n+    <groupId>org.openhab.addons.bundles</groupId>\n+    <artifactId>org.openhab.addons.reactor.bundles</artifactId>\n+    <version>3.0.0-SNAPSHOT</version>\n+  </parent>\n+\n+  <artifactId>org.openhab.automation.jsscripting</artifactId>\n+\n+  <name>openHAB Add-ons :: Bundles :: Automation :: JSScripting</name>\n+\n+  <properties>\n+    <bnd.importpackage>\n+      !sun.misc.*,\n+      !sun.reflect.*,\n+      !com.sun.management.*,\n+      !jdk.internal.reflect.*,\n+      !jdk.vm.ci.services\n+    </bnd.importpackage>\n+    <graal.version>20.1.0</graal.version>\n+    <asm.version>6.2.1</asm.version>\n+    <oh.version>${project.version}</oh.version>\n+  </properties>\n+\n+  <build>\n+    <plugins>\n+      <plugin>\n+        <groupId>org.apache.maven.plugins</groupId>\n+        <artifactId>maven-dependency-plugin</artifactId>\n+        <executions>\n+          <execution>\n+            <id>embed-dependencies</id>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMjUwODkzMA=="}, "originalCommit": {"oid": "9dead4836e01237e3a679b8f9efde5599114faac"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMjY2MjA4MA==", "bodyText": "The reason that this is in here is because Graal uses ServiceLoaders to load its language definitions, and has one per language per jar. This means that for each jar there is a single META-INF/services/com.oracle.truffle.api.TruffleLanguage$Provider file which is used to inform the ServiceLoader. The problem we have is that we need two languages (javascript & tregex), but when the multiple jars are all expanded and added into this bundle, we end up with a single one of the above files (as they are present at the same path in the jar). The way that I have got around this is to provide my own version of this file, with both languages in it, and exclude the ones coming from the Graal jars (this declaration in the pom.xml just overrides the inherited one and instructs it to exclude this file).\nIt seems that there are a few options here:\n\nDo what I've done so far\nAttempt to merge the files from the distinct jars (I tried this, it was a lot of complexity wrestling with Maven)\nBundle the jars into META-INF/lib rather than repack them (I'm aware that this isn't recommended for openHAB)\nAttempt to put my own file over the top of whatever gets included by inserted it at a later build phase. Maybe this is what you mean by using BND?", "url": "https://github.com/openhab/openhab-addons/pull/8516#discussion_r602662080", "createdAt": "2021-03-27T03:26:46Z", "author": {"login": "jpg0"}, "path": "bundles/org.openhab.automation.jsscripting/pom.xml", "diffHunk": "@@ -0,0 +1,140 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!--\n+  Copyright (c) 2010-2020 Contributors to the openHAB project\n+\n+  See the NOTICE file(s) distributed with this work for additional\n+  information.\n+\n+  This program and the accompanying materials are made available under the\n+  terms of the Eclipse Public License 2.0 which is available at\n+  http://www.eclipse.org/legal/epl-2.0\n+\n+  SPDX-License-Identifier: EPL-2.0\n+-->\n+\n+<project xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+  xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+\n+  <modelVersion>4.0.0</modelVersion>\n+\n+  <parent>\n+    <groupId>org.openhab.addons.bundles</groupId>\n+    <artifactId>org.openhab.addons.reactor.bundles</artifactId>\n+    <version>3.0.0-SNAPSHOT</version>\n+  </parent>\n+\n+  <artifactId>org.openhab.automation.jsscripting</artifactId>\n+\n+  <name>openHAB Add-ons :: Bundles :: Automation :: JSScripting</name>\n+\n+  <properties>\n+    <bnd.importpackage>\n+      !sun.misc.*,\n+      !sun.reflect.*,\n+      !com.sun.management.*,\n+      !jdk.internal.reflect.*,\n+      !jdk.vm.ci.services\n+    </bnd.importpackage>\n+    <graal.version>20.1.0</graal.version>\n+    <asm.version>6.2.1</asm.version>\n+    <oh.version>${project.version}</oh.version>\n+  </properties>\n+\n+  <build>\n+    <plugins>\n+      <plugin>\n+        <groupId>org.apache.maven.plugins</groupId>\n+        <artifactId>maven-dependency-plugin</artifactId>\n+        <executions>\n+          <execution>\n+            <id>embed-dependencies</id>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMjUwODkzMA=="}, "originalCommit": {"oid": "9dead4836e01237e3a679b8f9efde5599114faac"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyNzEzNjgxMA==", "bodyText": "Sounds like something non-trivial to rework. So let's stick with what works. \ud83d\ude09", "url": "https://github.com/openhab/openhab-addons/pull/8516#discussion_r627136810", "createdAt": "2021-05-06T07:03:08Z", "author": {"login": "wborn"}, "path": "bundles/org.openhab.automation.jsscripting/pom.xml", "diffHunk": "@@ -0,0 +1,140 @@\n+<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n+<!--\n+  Copyright (c) 2010-2020 Contributors to the openHAB project\n+\n+  See the NOTICE file(s) distributed with this work for additional\n+  information.\n+\n+  This program and the accompanying materials are made available under the\n+  terms of the Eclipse Public License 2.0 which is available at\n+  http://www.eclipse.org/legal/epl-2.0\n+\n+  SPDX-License-Identifier: EPL-2.0\n+-->\n+\n+<project xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns=\"http://maven.apache.org/POM/4.0.0\"\n+  xsi:schemaLocation=\"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd\">\n+\n+  <modelVersion>4.0.0</modelVersion>\n+\n+  <parent>\n+    <groupId>org.openhab.addons.bundles</groupId>\n+    <artifactId>org.openhab.addons.reactor.bundles</artifactId>\n+    <version>3.0.0-SNAPSHOT</version>\n+  </parent>\n+\n+  <artifactId>org.openhab.automation.jsscripting</artifactId>\n+\n+  <name>openHAB Add-ons :: Bundles :: Automation :: JSScripting</name>\n+\n+  <properties>\n+    <bnd.importpackage>\n+      !sun.misc.*,\n+      !sun.reflect.*,\n+      !com.sun.management.*,\n+      !jdk.internal.reflect.*,\n+      !jdk.vm.ci.services\n+    </bnd.importpackage>\n+    <graal.version>20.1.0</graal.version>\n+    <asm.version>6.2.1</asm.version>\n+    <oh.version>${project.version}</oh.version>\n+  </properties>\n+\n+  <build>\n+    <plugins>\n+      <plugin>\n+        <groupId>org.apache.maven.plugins</groupId>\n+        <artifactId>maven-dependency-plugin</artifactId>\n+        <executions>\n+          <execution>\n+            <id>embed-dependencies</id>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMjUwODkzMA=="}, "originalCommit": {"oid": "9dead4836e01237e3a679b8f9efde5599114faac"}, "originalPosition": 50}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzgwNzAzMzE0OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.automation.jsscripting/src/main/java/org/openhab/automation/jsscripting/internal/OpenhabGraalJSScriptEngine.java", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0yNlQxODozNzowOFrOI-mgGQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMy0yNlQxODozNzowOFrOI-mgGQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYwMjUxMzQzMw==", "bodyText": "Curly braces should always be used with if statements. So please again check your IDE settings.\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (initialized)\n          \n          \n            \n                        return;\n          \n          \n            \n                    if (initialized) {\n          \n          \n            \n                        return;\n          \n          \n            \n                    }", "url": "https://github.com/openhab/openhab-addons/pull/8516#discussion_r602513433", "createdAt": "2021-03-26T18:37:08Z", "author": {"login": "wborn"}, "path": "bundles/org.openhab.automation.jsscripting/src/main/java/org/openhab/automation/jsscripting/internal/OpenhabGraalJSScriptEngine.java", "diffHunk": "@@ -0,0 +1,132 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+\n+package org.openhab.automation.jsscripting.internal;\n+\n+import static org.openhab.core.automation.module.script.ScriptEngineFactory.*;\n+\n+import java.io.File;\n+import java.io.IOException;\n+import java.nio.channels.SeekableByteChannel;\n+import java.nio.file.FileSystems;\n+import java.nio.file.OpenOption;\n+import java.nio.file.Path;\n+import java.nio.file.attribute.FileAttribute;\n+import java.util.Set;\n+import java.util.function.Consumer;\n+import java.util.function.Function;\n+\n+import javax.script.*;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.graalvm.polyglot.Context;\n+import org.openhab.automation.jsscripting.internal.fs.DelegatingFileSystem;\n+import org.openhab.automation.jsscripting.internal.fs.PrefixedSeekableByteChannel;\n+import org.openhab.automation.jsscripting.internal.scriptengine.InvocationInterceptingScriptEngineWithInvocable;\n+import org.openhab.core.OpenHAB;\n+import org.openhab.core.automation.module.script.ScriptExtensionAccessor;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import com.oracle.truffle.js.scriptengine.GraalJSScriptEngine;\n+\n+/**\n+ * GraalJS Script Engine implementation\n+ *\n+ * @author Jonathan Gilbert - Initial contribution\n+ */\n+public class OpenhabGraalJSScriptEngine extends InvocationInterceptingScriptEngineWithInvocable<GraalJSScriptEngine> {\n+\n+    private static final Logger logger = LoggerFactory.getLogger(OpenhabGraalJSScriptEngine.class);\n+\n+    private static final String REQUIRE_WRAPPER_NAME = \"__wraprequire__\";\n+    private static final String MODULE_DIR = String.join(File.separator, OpenHAB.getConfigFolder(), \"automation\", \"lib\",\n+            \"javascript\", \"personal\");\n+\n+    // these fields start as null because they are populated on first use\n+    @NonNullByDefault({})\n+    private String engineIdentifier;\n+    @NonNullByDefault({})\n+    private Consumer<String> scriptDependencyListener;\n+\n+    private boolean initialized = false;\n+\n+    /**\n+     * Creates an implementation of ScriptEngine (& Invocable), wrapping the contained engine, that tracks the script\n+     * lifecycle and provides hooks for scripts to do so too.\n+     */\n+    public OpenhabGraalJSScriptEngine() {\n+        super(null); // delegate depends on fields not yet initialised, so we cannot set it immediately\n+        delegate = GraalJSScriptEngine.create(null,\n+                Context.newBuilder(\"js\").allowExperimentalOptions(true).allowAllAccess(true)\n+                        .option(\"js.commonjs-require-cwd\", MODULE_DIR).option(\"js.nashorn-compat\", \"true\") // to ease\n+                                                                                                           // migration\n+                        .option(\"js.commonjs-require\", \"true\") // enable CommonJS module support\n+                        .fileSystem(new DelegatingFileSystem(FileSystems.getDefault().provider()) {\n+                            @Override\n+                            public SeekableByteChannel newByteChannel(Path path, Set<? extends OpenOption> options,\n+                                    FileAttribute<?>... attrs) throws IOException {\n+                                if (scriptDependencyListener != null) {\n+                                    scriptDependencyListener.accept(path.toString());\n+                                }\n+\n+                                if (path.toString().endsWith(\".js\")) {\n+                                    return new PrefixedSeekableByteChannel(\n+                                            (\"require=\" + REQUIRE_WRAPPER_NAME + \"(require);\").getBytes(),\n+                                            super.newByteChannel(path, options, attrs));\n+                                } else {\n+                                    return super.newByteChannel(path, options, attrs);\n+                                }\n+                            }\n+                        }));\n+    }\n+\n+    @Override\n+    protected void beforeInvocation() {\n+        if (initialized)\n+            return;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "9dead4836e01237e3a679b8f9efde5599114faac"}, "originalPosition": 97}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzk3MzQ3NjkzOnYy", "diffSide": "RIGHT", "path": "CODEOWNERS", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNS0wNlQwNzowNDowNlrOJWFbTg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNS0wNlQwNzowNDowNlrOJWFbTg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyNzEzNzM1OA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            /bundles/org.openhab.automation.pidcontroller/ @fwolter\n          \n          \n            \n            /bundles/org.openhab.automation.jsscripting/ @jpg0\n          \n          \n            \n            /bundles/org.openhab.automation.jsscripting/ @jpg0\n          \n          \n            \n            /bundles/org.openhab.automation.pidcontroller/ @fwolter", "url": "https://github.com/openhab/openhab-addons/pull/8516#discussion_r627137358", "createdAt": "2021-05-06T07:04:06Z", "author": {"login": "wborn"}, "path": "CODEOWNERS", "diffHunk": "@@ -8,6 +8,7 @@\n /bundles/org.openhab.automation.groovyscripting/ @wborn\n /bundles/org.openhab.automation.jythonscripting/ @openhab/add-ons-maintainers\n /bundles/org.openhab.automation.pidcontroller/ @fwolter\n+/bundles/org.openhab.automation.jsscripting/ @jpg0", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a43e61670eea21de5f03f66dd3e1f95444cceaa2"}, "originalPosition": 4}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMzk3MzQ4NjkwOnYy", "diffSide": "RIGHT", "path": "CODEOWNERS", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNS0wNlQwNzowNzoxMlrOJWFhaA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wNS0wNlQwNzowNzoxMlrOJWFhaA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyNzEzODkyMA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            /bundles/org.openhab.automation.jythonscripting/ @openhab/add-ons-maintainers\n          \n          \n            \n            /bundles/org.openhab.automation.jsscripting/ @jpg0\n          \n          \n            \n            /bundles/org.openhab.automation.jsscripting/ @jpg0\n          \n          \n            \n            /bundles/org.openhab.automation.jythonscripting/ @openhab/add-ons-maintainers", "url": "https://github.com/openhab/openhab-addons/pull/8516#discussion_r627138920", "createdAt": "2021-05-06T07:07:12Z", "author": {"login": "wborn"}, "path": "CODEOWNERS", "diffHunk": "@@ -7,6 +7,7 @@\n # Add-on maintainers:\n /bundles/org.openhab.automation.groovyscripting/ @wborn\n /bundles/org.openhab.automation.jythonscripting/ @openhab/add-ons-maintainers\n+/bundles/org.openhab.automation.jsscripting/ @jpg0", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0a51afaad17d748ece7af0c765731552232ea6dc"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4297, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}