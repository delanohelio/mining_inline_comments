{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTQ2OTkyMjQ2", "number": 9603, "title": "[nikobus] open connection on refresh even if no modules exist", "bodyText": "Signed-off-by: Wouter Denayer wouter@denayer.com\nopen connection on refresh even if no modules exist\ncurrently, when no modules are defined the connection to nikobus is not opened and therefore the button presses are not detected.", "createdAt": "2020-12-30T15:42:16Z", "url": "https://github.com/openhab/openhab-addons/pull/9603", "merged": true, "mergeCommit": {"oid": "1f3b0e2865e547e245bc5874740bdca066f54c4b"}, "closed": true, "closedAt": "2021-01-04T11:10:37Z", "author": {"login": "gitwouter"}, "timelineItems": {"totalCount": 14, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdrRfHUgBqjQxNTc3NDE1MzM=", "endCursor": "Y3Vyc29yOnYyOpPPAAABds0XWKAFqTU2MDk0OTUzNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "9be9e768bf50b1ec3c2ddf4be8e6d5288d0acf14", "author": {"user": null}, "url": "https://github.com/openhab/openhab-addons/commit/9be9e768bf50b1ec3c2ddf4be8e6d5288d0acf14", "committedDate": "2020-12-28T14:15:10Z", "message": "open connection on refresh even if no modules exist\n\nSigned-off-by: Wouter Denayer <wouter@denayer.com>"}, "afterCommit": {"oid": "38d9c9e72dcb47e2d970b602bffd13a582244558", "author": {"user": null}, "url": "https://github.com/openhab/openhab-addons/commit/38d9c9e72dcb47e2d970b602bffd13a582244558", "committedDate": "2020-12-30T15:57:59Z", "message": "open connection on refresh even if no modules exist\n\nSigned-off-by: Wouter Denayer <wouter@denayer.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "38d9c9e72dcb47e2d970b602bffd13a582244558", "author": {"user": null}, "url": "https://github.com/openhab/openhab-addons/commit/38d9c9e72dcb47e2d970b602bffd13a582244558", "committedDate": "2020-12-30T15:57:59Z", "message": "open connection on refresh even if no modules exist\n\nSigned-off-by: Wouter Denayer <wouter@denayer.com>"}, "afterCommit": {"oid": "4cf0bed3c508483391e4b3b7e55e7ff5c04e702f", "author": {"user": null}, "url": "https://github.com/openhab/openhab-addons/commit/4cf0bed3c508483391e4b3b7e55e7ff5c04e702f", "committedDate": "2020-12-30T16:06:22Z", "message": "open connection on refresh even if no modules exist\n\nSigned-off-by: Wouter Denayer <wouter@denayer.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0baf8e5dfab3a831eea7502f6cb11093f1738c15", "author": {"user": null}, "url": "https://github.com/openhab/openhab-addons/commit/0baf8e5dfab3a831eea7502f6cb11093f1738c15", "committedDate": "2020-12-31T10:05:58Z", "message": "open connection on refresh even if no modules exist\n\nSigned-off-by: Wouter Denayer <wouter@denayer.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "4cf0bed3c508483391e4b3b7e55e7ff5c04e702f", "author": {"user": null}, "url": "https://github.com/openhab/openhab-addons/commit/4cf0bed3c508483391e4b3b7e55e7ff5c04e702f", "committedDate": "2020-12-30T16:06:22Z", "message": "open connection on refresh even if no modules exist\n\nSigned-off-by: Wouter Denayer <wouter@denayer.com>"}, "afterCommit": {"oid": "0baf8e5dfab3a831eea7502f6cb11093f1738c15", "author": {"user": null}, "url": "https://github.com/openhab/openhab-addons/commit/0baf8e5dfab3a831eea7502f6cb11093f1738c15", "committedDate": "2020-12-31T10:05:58Z", "message": "open connection on refresh even if no modules exist\n\nSigned-off-by: Wouter Denayer <wouter@denayer.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYwMzU0MDE1", "url": "https://github.com/openhab/openhab-addons/pull/9603#pullrequestreview-560354015", "createdAt": "2020-12-31T13:48:42Z", "commit": {"oid": "0baf8e5dfab3a831eea7502f6cb11093f1738c15"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMVQxMzo0ODo0M1rOIM_Dyw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMVQxMzo0ODo0M1rOIM_Dyw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDQ4Njk4Nw==", "bodyText": "The log message could be removed, as the status update is already logged by the framework.\nThe state change originated by updateStatus() is logged to events.log. Including the status detail message.", "url": "https://github.com/openhab/openhab-addons/pull/9603#discussion_r550486987", "createdAt": "2020-12-31T13:48:43Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.nikobus/src/main/java/org/openhab/binding/nikobus/internal/handler/NikobusPcLinkHandler.java", "diffHunk": "@@ -329,6 +329,22 @@ private void refresh() {\n         List<Thing> things = getThing().getThings().stream()\n                 .filter(thing -> thing.getHandler() instanceof NikobusModuleHandler).collect(Collectors.toList());\n \n+\n+        // if there are command listeners then we need an open connection even if no modules exist\n+        if (!commandListeners.isEmpty()) {\n+            NikobusConnection connection = this.connection;\n+            if (connection == null) {\n+                return;\n+            }        \t\n+            try {\n+                connectIfNeeded(connection);\n+            } catch (IOException e) {\n+                logger.debug(\"refresh failed due {}\", e.getMessage(), e);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0baf8e5dfab3a831eea7502f6cb11093f1738c15"}, "originalPosition": 25}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "5a6a187a1c330a7b005bbf9adcf975220a77f662", "author": {"user": null}, "url": "https://github.com/openhab/openhab-addons/commit/5a6a187a1c330a7b005bbf9adcf975220a77f662", "committedDate": "2020-12-31T14:16:52Z", "message": "ran mvn spotless:apply\n\nSigned-off-by: Wouter Denayer <wouter@denayer.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYwNDI0Mzc5", "url": "https://github.com/openhab/openhab-addons/pull/9603#pullrequestreview-560424379", "createdAt": "2020-12-31T15:01:46Z", "commit": {"oid": "5a6a187a1c330a7b005bbf9adcf975220a77f662"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMVQxNTowMTo0NlrOIM_3nQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0zMVQxNTowMTo0NlrOIM_3nQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDUwMDI1Mw==", "bodyText": "Can you remove this?", "url": "https://github.com/openhab/openhab-addons/pull/9603#discussion_r550500253", "createdAt": "2020-12-31T15:01:46Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.daikin/deploy.sh", "diffHunk": "@@ -0,0 +1,2 @@\n+cp ./target/org.openhab.binding.daikin-3.1.0-SNAPSHOT.jar /Volumes/openhab/share/addons/", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "5a6a187a1c330a7b005bbf9adcf975220a77f662"}, "originalPosition": 1}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8b5fde768308e1ee809c8d0e83a326674610674f", "author": {"user": null}, "url": "https://github.com/openhab/openhab-addons/commit/8b5fde768308e1ee809c8d0e83a326674610674f", "committedDate": "2020-12-31T16:14:59Z", "message": "removed unnecessary file\n\nSigned-off-by: Wouter Denayer <wouter@denayer.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYwNjA1MDEz", "url": "https://github.com/openhab/openhab-addons/pull/9603#pullrequestreview-560605013", "createdAt": "2021-01-01T20:49:55Z", "commit": {"oid": "8b5fde768308e1ee809c8d0e83a326674610674f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYwNjUzMzA3", "url": "https://github.com/openhab/openhab-addons/pull/9603#pullrequestreview-560653307", "createdAt": "2021-01-02T20:06:22Z", "commit": {"oid": "8b5fde768308e1ee809c8d0e83a326674610674f"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wMlQyMDowNjoyM1rOINZQmA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMS0wMS0wMlQyMDowNjoyM1rOINZQmA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDkxNjI0OA==", "bodyText": "Should this function return at this point? Or should the handler still be refreshed even if the thing is offline?", "url": "https://github.com/openhab/openhab-addons/pull/9603#discussion_r550916248", "createdAt": "2021-01-02T20:06:23Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.nikobus/src/main/java/org/openhab/binding/nikobus/internal/handler/NikobusPcLinkHandler.java", "diffHunk": "@@ -329,6 +329,20 @@ private void refresh() {\n         List<Thing> things = getThing().getThings().stream()\n                 .filter(thing -> thing.getHandler() instanceof NikobusModuleHandler).collect(Collectors.toList());\n \n+        // if there are command listeners then we need an open connection even if no modules exist\n+        if (!commandListeners.isEmpty()) {\n+            NikobusConnection connection = this.connection;\n+            if (connection == null) {\n+                return;\n+            }\n+            try {\n+                connectIfNeeded(connection);\n+            } catch (IOException e) {\n+                connection.close();\n+                updateStatus(ThingStatus.OFFLINE, ThingStatusDetail.COMMUNICATION_ERROR, e.getMessage());\n+            }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "8b5fde768308e1ee809c8d0e83a326674610674f"}, "originalPosition": 26}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "8021ce10c12577f82629401fe95d6e957a3178f2", "author": {"user": null}, "url": "https://github.com/openhab/openhab-addons/commit/8021ce10c12577f82629401fe95d6e957a3178f2", "committedDate": "2021-01-03T18:25:52Z", "message": "returning when the connection is offline since following code won't work\neither.\n\nSigned-off-by: Wouter Denayer <wouter@denayer.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "720409bc9e34bcc57f64dd9eae10bd353a65535a", "author": {"user": null}, "url": "https://github.com/openhab/openhab-addons/commit/720409bc9e34bcc57f64dd9eae10bd353a65535a", "committedDate": "2021-01-03T08:42:54Z", "message": "returning when the connection is offline since following code won't work\neither."}, "afterCommit": {"oid": "8021ce10c12577f82629401fe95d6e957a3178f2", "author": {"user": null}, "url": "https://github.com/openhab/openhab-addons/commit/8021ce10c12577f82629401fe95d6e957a3178f2", "committedDate": "2021-01-03T18:25:52Z", "message": "returning when the connection is offline since following code won't work\neither.\n\nSigned-off-by: Wouter Denayer <wouter@denayer.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYwNzg4ODM1", "url": "https://github.com/openhab/openhab-addons/pull/9603#pullrequestreview-560788835", "createdAt": "2021-01-04T05:37:23Z", "commit": {"oid": "8021ce10c12577f82629401fe95d6e957a3178f2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTYwOTQ5NTM1", "url": "https://github.com/openhab/openhab-addons/pull/9603#pullrequestreview-560949535", "createdAt": "2021-01-04T11:10:28Z", "commit": {"oid": "8021ce10c12577f82629401fe95d6e957a3178f2"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3510, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}