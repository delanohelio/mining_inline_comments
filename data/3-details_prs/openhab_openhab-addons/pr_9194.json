{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTMwNTU5ODc5", "number": 9194, "title": "[digitalstrom] fixes StringIndexOutOfBoundsException", "bodyText": "Related to #9048\nThis Bugfix catches any exception that could occurs when a device is added.\nI hesitate with specifically checking for the string length and silently ignore if the hardware info is not here, but I think it's best to log an error when something is wrong on digitalstrom side. This log could help us identify the root cause.\nThis try and catch will also avoid that the module crashes on open hab side.", "createdAt": "2020-12-01T20:35:26Z", "url": "https://github.com/openhab/openhab-addons/pull/9194", "merged": true, "mergeCommit": {"oid": "f9866b2c7770511cb8fa768bdde77fbf8f55e892"}, "closed": true, "closedAt": "2020-12-05T00:07:00Z", "author": {"login": "gaetancollaud"}, "timelineItems": {"totalCount": 6, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABdiSAvxAFqTU0MzA3MjU2MA==", "endCursor": "Y3Vyc29yOnYyOpPPAAABdjA3ljAFqTU0NTM3MjA2MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQzMDcyNTYw", "url": "https://github.com/openhab/openhab-addons/pull/9194#pullrequestreview-543072560", "createdAt": "2020-12-02T17:28:09Z", "commit": {"oid": "82b31b205b6686668806e517199aaf4795c4fd54"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQxNzoyODowOVrOH9mG3Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMi0wMlQxNzoyODowOVrOH9mG3Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDM0OTUzMw==", "bodyText": "The error logging level should be reserved for issues catastrophic enough to threaten the operation of openHab itself. An error in a binding shouldn't qualify for this. Please read the openHab coding guidelines for expected use of logging in bindings.\nI suggest logging warn instead. Also please try to catch specific exceptions or at the very least RuntimeException. In addition, you should always log the exception or at the very least the exception message to make debugging easier.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    } catch (Exception ex) {\n          \n          \n            \n                        logger.error(\"Unable to add devices {}\", device);\n          \n          \n            \n                    } catch (RuntimeException ex) {\n          \n          \n            \n                        logger.warn(\"Unable to add devices {}: {}\", device, ex.getMessage());", "url": "https://github.com/openhab/openhab-addons/pull/9194#discussion_r534349533", "createdAt": "2020-12-02T17:28:09Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.digitalstrom/src/main/java/org/openhab/binding/digitalstrom/internal/discovery/DiscoveryServiceManager.java", "diffHunk": "@@ -194,20 +198,25 @@ public void onDeviceRemoved(GeneralDeviceInformation device) {\n \n     @Override\n     public void onDeviceAdded(GeneralDeviceInformation device) {\n-        if (device instanceof Device) {\n-            String id = ((Device) device).getHWinfo().substring(0, 2);\n-            if (((Device) device).isSensorDevice()) {\n-                id = ((Device) device).getHWinfo();\n-            }\n-            if (discoveryServices.get(id) != null) {\n-                ((DeviceDiscoveryService) discoveryServices.get(id)).onDeviceAdded(device);\n+        try {\n+            if (device instanceof Device) {\n+                String id = ((Device) device).getHWinfo().substring(0, 2);\n+                if (((Device) device).isSensorDevice()) {\n+                    id = ((Device) device).getHWinfo();\n+                }\n+                if (discoveryServices.get(id) != null) {\n+                    ((DeviceDiscoveryService) discoveryServices.get(id)).onDeviceAdded(device);\n+                }\n             }\n-        }\n-        if (device instanceof Circuit) {\n-            if (discoveryServices.get(DsDeviceThingTypeProvider.SupportedThingTypes.circuit.toString()) != null) {\n-                ((DeviceDiscoveryService) discoveryServices\n-                        .get(DsDeviceThingTypeProvider.SupportedThingTypes.circuit.toString())).onDeviceAdded(device);\n+            if (device instanceof Circuit) {\n+                if (discoveryServices.get(DsDeviceThingTypeProvider.SupportedThingTypes.circuit.toString()) != null) {\n+                    ((DeviceDiscoveryService) discoveryServices\n+                            .get(DsDeviceThingTypeProvider.SupportedThingTypes.circuit.toString()))\n+                                    .onDeviceAdded(device);\n+                }\n             }\n+        } catch (Exception ex) {\n+            logger.error(\"Unable to add devices {}\", device);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "82b31b205b6686668806e517199aaf4795c4fd54"}, "originalPosition": 52}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "a001d717078bc469840d5a81b659157e89e493bb", "author": {"user": {"login": "gaetancollaud", "name": "Ga\u00e9tan Collaud"}}, "url": "https://github.com/openhab/openhab-addons/commit/a001d717078bc469840d5a81b659157e89e493bb", "committedDate": "2020-12-02T18:48:40Z", "message": "[digitalstrom] catch issues when adding devices\n\nSigned-off-by: Ga\u00e9tan Collaud <gaetancollaud@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "44d98d4cb591080c54eaf81f1e1b03ee29cf1af2", "author": {"user": {"login": "gaetancollaud", "name": "Ga\u00e9tan Collaud"}}, "url": "https://github.com/openhab/openhab-addons/commit/44d98d4cb591080c54eaf81f1e1b03ee29cf1af2", "committedDate": "2020-12-02T18:48:40Z", "message": "Update bundles/org.openhab.binding.digitalstrom/src/main/java/org/openhab/binding/digitalstrom/internal/discovery/DiscoveryServiceManager.java\n\nCo-authored-by: Connor Petty <mistercpp2000@gmail.com>\nSigned-off-by: Ga\u00e9tan Collaud <gaetancollaud@gmail.com>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "bc22f550ceca11c56566243029dfa70a1a8cb43e", "author": {"user": {"login": "gaetancollaud", "name": "Ga\u00e9tan Collaud"}}, "url": "https://github.com/openhab/openhab-addons/commit/bc22f550ceca11c56566243029dfa70a1a8cb43e", "committedDate": "2020-12-02T18:48:40Z", "message": "print stacktrace in case of error\n\nSigned-off-by: Ga\u00e9tan Collaud <gaetancollaud@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "2fbfd522df4001d352a3da3dd7c985d7dc53da92", "author": {"user": {"login": "gaetancollaud", "name": "Ga\u00e9tan Collaud"}}, "url": "https://github.com/openhab/openhab-addons/commit/2fbfd522df4001d352a3da3dd7c985d7dc53da92", "committedDate": "2020-12-02T18:48:02Z", "message": "print stacktrace in case of error"}, "afterCommit": {"oid": "bc22f550ceca11c56566243029dfa70a1a8cb43e", "author": {"user": {"login": "gaetancollaud", "name": "Ga\u00e9tan Collaud"}}, "url": "https://github.com/openhab/openhab-addons/commit/bc22f550ceca11c56566243029dfa70a1a8cb43e", "committedDate": "2020-12-02T18:48:40Z", "message": "print stacktrace in case of error\n\nSigned-off-by: Ga\u00e9tan Collaud <gaetancollaud@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTQ1MzcyMDYw", "url": "https://github.com/openhab/openhab-addons/pull/9194#pullrequestreview-545372060", "createdAt": "2020-12-05T00:05:18Z", "commit": {"oid": "bc22f550ceca11c56566243029dfa70a1a8cb43e"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 3951, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}