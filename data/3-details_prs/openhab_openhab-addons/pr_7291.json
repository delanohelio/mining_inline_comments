{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0Mzk4Njg4MDk5", "number": 7291, "title": "[tradfri] Do a dispose() and initialize() when loosing contact with GW.", "bodyText": "This PR tries to resolve the issue with the TRADFRI binding lossing contact with IKEA GW reported in many community threads.\nThe binding had implementation for some reconnect attempt but that was not sufficient. This PR instead perfroms a dispod/initialize of the binding when this communication error occurs.\nI have tested in successfully in my production environment, here are logs for when the binding re-initialized during a communication error:\n2020-03-31 19:30:37.791 [DEBUG] [internal.handler.TradfriLightHandler] - Setting state to OFF\n2020-03-31 19:31:00.696 [DEBUG] [g.tradfri.internal.TradfriCoapClient] - CoAP GET request\nuri: coaps://192.168.1.134:5684/15011/15012\n2020-03-31 19:31:57.045 [DEBUG] [iscovery.TradfriDiscoveryParticipant] - Discovered Tradfri gateway: [ServiceInfoImpl@13643927 name: 'gw-dcefcaba3a07._CC32E753._sub._coap._udp.local.' address: '/192.168.1\n.134:5684 /fe80:0:0:0:deef:caff:feba:3a07:5684 ' status: 'NO DNS state: probing 1 task: null' is persistent, has data\n        version: 1.10.29]\n2020-03-31 19:31:57.085 [DEBUG] [iscovery.TradfriDiscoveryParticipant] - Discovered Tradfri gateway: [ServiceInfoImpl@5785623 name: 'gw-dcefcaba3a07._CC32E753._sub._coap._udp.local.' address: '/192.168.1.\n134:5684 /fe80:0:0:0:deef:caff:feba:3a07:5684 ' status: 'NO DNS state: probing 1 task: null' is persistent, has data\n        version: 1.10.30]\n2020-03-31 19:32:00.707 [DEBUG] [g.tradfri.internal.TradfriCoapClient] - CoAP GET request\nuri: coaps://192.168.1.134:5684/15011/15012\n2020-03-31 19:32:07.019 [DEBUG] [.tradfri.internal.TradfriCoapHandler] - CoAP onError\n2020-03-31 19:32:31.509 [DEBUG] [.tradfri.internal.TradfriCoapHandler] - CoAP onError\n2020-03-31 19:32:31.510 [DEBUG] [ternal.handler.TradfriGatewayHandler] - Gateway communication error. Forcing a re-initialization!\n2020-03-31 19:32:31.511 [DEBUG] [ternal.handler.TradfriGatewayHandler] - In dispose()\n2020-03-31 19:32:32.020 [DEBUG] [ternal.handler.TradfriGatewayHandler] - In initialize()\n2020-03-31 19:32:32.109 [DEBUG] [g.tradfri.internal.TradfriCoapClient] - CoAP GET request\nuri: coaps://192.168.1.134:5684/15011/15012\n2020-03-31 19:32:32.300 [DEBUG] [.tradfri.internal.TradfriCoapHandler] - CoAP response\noptions: {\"Content-Format\":\"application/json\", \"Max-Age\":604800}\npayload: {\"9023\":\"1.tradfri.pool.ntp.org\",\"9092\":0,\"9066\":5,\"9059\":1585675952,\"9201\":2,\"9060\":\"2020-03-31T17:32:32.029392Z\",\"9062\":0,\"9061\":0,\"9106\":0,\"9071\":1,\"9076\":10,\"9200\":\"fe120050-7d40-497e-b4b0-f5200c7ff684\",\"9029\":\"1.10.30\",\"9105\":0,\"9081\":\"7e183552044000f1\",\"9082\":true,\"9083\":\"276-82-287\",\"9075\":0,\"9054\":0,\"9055\":100,\"9118\":0,\"9069\":1585675761,\"9072\":3,\"9073\":29,\"9074\":1,\"9077\":25,\"9078\":1,\"9079\":0,\"9080\":60,\"9103\":\"\",\"9093\":0,\"9107\":0,\"9202\":1580365713}\n2020-03-31 19:32:32.302 [DEBUG] [ternal.handler.TradfriGatewayHandler] - requestGatewayInfo response: {\"9023\":\"1.tradfri.pool.ntp.org\",\"9092\":0,\"9066\":5,\"9059\":1585675952,\"9201\":2,\"9060\":\"2020-03-31T17:32:32.029392Z\",\"9062\":0,\"9061\":0,\"9106\":0,\"9071\":1,\"9076\":10,\"9200\":\"fe120050-7d40-497e-b4b0-f5200c7ff684\",\"9029\":\"1.10.30\",\"9105\":0,\"9081\":\"7e183552044000f1\",\"9082\":true,\"9083\":\"276-82-287\",\"9075\":0,\"9054\":0,\"9055\":100,\"9118\":0,\"9069\":1585675761,\"9072\":3,\"9073\":29,\"9074\":1,\"9077\":25,\"9078\":1,\"9079\":0,\"9080\":60,\"9103\":\"\",\"9093\":0,\"9107\":0,\"9202\":1580365713}\n2020-03-31 19:32:32.311 [DEBUG] [.tradfri.internal.TradfriCoapHandler] - CoAP response\noptions: {\"Content-Format\":\"application/json\", \"Max-Age\":604800}\n\nFixes #7152.\nSigned-off-by: Jan Gustafsson jannegpriv@gmail.com", "createdAt": "2020-04-04T19:04:06Z", "url": "https://github.com/openhab/openhab-addons/pull/7291", "merged": true, "mergeCommit": {"oid": "cdd0284c829382713fac372784d894383afeca5c"}, "closed": true, "closedAt": "2020-05-11T23:09:15Z", "author": {"login": "jannegpriv"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcUlklggBqjMyMDE1MzE4NDg=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcgX9TVAFqTQwOTU5MTEzMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "55a2f2b058e93c866e428be4102d7b02cd5232a3", "author": {"user": {"login": "jannegpriv", "name": "Jan Gustafsson"}}, "url": "https://github.com/openhab/openhab-addons/commit/55a2f2b058e93c866e428be4102d7b02cd5232a3", "committedDate": "2020-04-04T18:41:16Z", "message": "Do a dispose() and initialize() when loosing contact with GW.\nFixes #7152.\n\nSigned-off-by: Jan Gustafsson <jannegpriv@gmail.com>"}, "afterCommit": {"oid": "1fcea5beac1f42950cd80fcc1c3767dc519f5575", "author": {"user": {"login": "jannegpriv", "name": "Jan Gustafsson"}}, "url": "https://github.com/openhab/openhab-addons/commit/1fcea5beac1f42950cd80fcc1c3767dc519f5575", "committedDate": "2020-04-05T08:10:06Z", "message": "Do a dispose() and initialize() when loosing contact with GW.\nFixes #7152.\n\nSigned-off-by: Jan Gustafsson <jannegpriv@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3Mzk0ODYyMDY2", "url": "https://github.com/openhab/openhab-addons/pull/7291#pullrequestreview-394862066", "createdAt": "2020-04-16T17:44:48Z", "commit": {"oid": "1fcea5beac1f42950cd80fcc1c3767dc519f5575"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxNzo0NDo0OFrOGGwZsg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0xNlQxNzo0NDo1NFrOGGwZ5A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTczNzY1MA==", "bodyText": "Please remove this logging", "url": "https://github.com/openhab/openhab-addons/pull/7291#discussion_r409737650", "createdAt": "2020-04-16T17:44:48Z", "author": {"login": "J-N-K"}, "path": "bundles/org.openhab.binding.tradfri/src/main/java/org/openhab/binding/tradfri/internal/handler/TradfriGatewayHandler.java", "diffHunk": "@@ -97,6 +96,7 @@ public void handleCommand(ChannelUID channelUID, Command command) {\n \n     @Override\n     public void initialize() {\n+        logger.debug(\"In initialize()\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1fcea5beac1f42950cd80fcc1c3767dc519f5575"}, "originalPosition": 12}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTczNzcwMA==", "bodyText": "Please remove this logging", "url": "https://github.com/openhab/openhab-addons/pull/7291#discussion_r409737700", "createdAt": "2020-04-16T17:44:54Z", "author": {"login": "J-N-K"}, "path": "bundles/org.openhab.binding.tradfri/src/main/java/org/openhab/binding/tradfri/internal/handler/TradfriGatewayHandler.java", "diffHunk": "@@ -262,6 +262,7 @@ protected boolean obtainIdentityAndPreSharedKey() {\n \n     @Override\n     public void dispose() {\n+        logger.debug(\"In dispose()\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1fcea5beac1f42950cd80fcc1c3767dc519f5575"}, "originalPosition": 20}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "3132a642e0a3bd41c05d1a78cef4fc001682a409", "author": {"user": {"login": "jannegpriv", "name": "Jan Gustafsson"}}, "url": "https://github.com/openhab/openhab-addons/commit/3132a642e0a3bd41c05d1a78cef4fc001682a409", "committedDate": "2020-04-24T19:22:16Z", "message": "Do a dispose() and initialize() when loosing contact with GW.\nFixes #7152.\n\nSigned-off-by: Jan Gustafsson <jannegpriv@gmail.com>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "1fcea5beac1f42950cd80fcc1c3767dc519f5575", "author": {"user": {"login": "jannegpriv", "name": "Jan Gustafsson"}}, "url": "https://github.com/openhab/openhab-addons/commit/1fcea5beac1f42950cd80fcc1c3767dc519f5575", "committedDate": "2020-04-05T08:10:06Z", "message": "Do a dispose() and initialize() when loosing contact with GW.\nFixes #7152.\n\nSigned-off-by: Jan Gustafsson <jannegpriv@gmail.com>"}, "afterCommit": {"oid": "3132a642e0a3bd41c05d1a78cef4fc001682a409", "author": {"user": {"login": "jannegpriv", "name": "Jan Gustafsson"}}, "url": "https://github.com/openhab/openhab-addons/commit/3132a642e0a3bd41c05d1a78cef4fc001682a409", "committedDate": "2020-04-24T19:22:16Z", "message": "Do a dispose() and initialize() when loosing contact with GW.\nFixes #7152.\n\nSigned-off-by: Jan Gustafsson <jannegpriv@gmail.com>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDA5NTkxMTMy", "url": "https://github.com/openhab/openhab-addons/pull/7291#pullrequestreview-409591132", "createdAt": "2020-05-11T23:06:26Z", "commit": {"oid": "3132a642e0a3bd41c05d1a78cef4fc001682a409"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1010, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}