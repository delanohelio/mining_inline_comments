{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDA2MjQ4NzY1", "number": 7432, "reviewThreads": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQyMDozNjoyNVrODz6Y3g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQyMjoyMzoxNVrOD0dtMA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU1NzYwNjA2OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.modbus.sunspec/src/main/java/org/openhab/binding/modbus/sunspec/internal/handler/AbstractSunSpecHandler.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQyMDozNjoyNVrOGImnqw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQwNjozNDozNlrOGI05ew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTY3NDUzOQ==", "bodyText": "Any reason scaleFactor couldn't be primitive?", "url": "https://github.com/openhab/openhab-addons/pull/7432#discussion_r411674539", "createdAt": "2020-04-20T20:36:25Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.modbus.sunspec/src/main/java/org/openhab/binding/modbus/sunspec/internal/handler/AbstractSunSpecHandler.java", "diffHunk": "@@ -507,6 +507,20 @@ protected State getScaled(Optional<? extends Number> value, Optional<Short> scal\n         return getScaled(value.get().longValue(), scaleFactor.get(), unit);\n     }\n \n+    /**\n+     * Returns value multiplied by the 10 on the power of scaleFactory\n+     *\n+     * @param value the value to alter\n+     * @param scaleFactor the scale factor to use (may be negative)\n+     * @return the scaled value as a DecimalType\n+     */\n+    protected State getScaled(Optional<? extends Number> value, Short scaleFactor, Unit<?> unit) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a16204e83002f1a0d0df1b265fa6256d3b537b16"}, "originalPosition": 11}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTkwODQ3NQ==", "bodyText": "In some cases the scaleFactor is also optional per spec. I didn't want to mix primitives and Optional<...>-s.\nAlso note, that optional values have to be treated differently if omitted: in case of a missing optional value we output the UnDefType. Any other case will output a reasonable default value.", "url": "https://github.com/openhab/openhab-addons/pull/7432#discussion_r411908475", "createdAt": "2020-04-21T06:34:36Z", "author": {"login": "mrbig"}, "path": "bundles/org.openhab.binding.modbus.sunspec/src/main/java/org/openhab/binding/modbus/sunspec/internal/handler/AbstractSunSpecHandler.java", "diffHunk": "@@ -507,6 +507,20 @@ protected State getScaled(Optional<? extends Number> value, Optional<Short> scal\n         return getScaled(value.get().longValue(), scaleFactor.get(), unit);\n     }\n \n+    /**\n+     * Returns value multiplied by the 10 on the power of scaleFactory\n+     *\n+     * @param value the value to alter\n+     * @param scaleFactor the scale factor to use (may be negative)\n+     * @return the scaled value as a DecimalType\n+     */\n+    protected State getScaled(Optional<? extends Number> value, Short scaleFactor, Unit<?> unit) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTY3NDUzOQ=="}, "originalCommit": {"oid": "a16204e83002f1a0d0df1b265fa6256d3b537b16"}, "originalPosition": 11}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU1NzYxMzg1OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.modbus.sunspec/src/main/java/org/openhab/binding/modbus/sunspec/internal/handler/AbstractSunSpecHandler.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQyMDozODoyMVrOGImsKA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxODozNzo0MlrOGJS1Kw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTY3NTY4OA==", "bodyText": "It is better to use what you already have. Although you could easily have the other method call this one instead.\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (!value.isPresent()) {\n          \n          \n            \n                        return UnDefType.UNDEF;\n          \n          \n            \n                    }\n          \n          \n            \n                    return getScaled(value.get().longValue(), scaleFactor, unit);\n          \n          \n            \n                    return getScaled(value, Optional.of(scaleFactor), unit);", "url": "https://github.com/openhab/openhab-addons/pull/7432#discussion_r411675688", "createdAt": "2020-04-20T20:38:21Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.modbus.sunspec/src/main/java/org/openhab/binding/modbus/sunspec/internal/handler/AbstractSunSpecHandler.java", "diffHunk": "@@ -507,6 +507,20 @@ protected State getScaled(Optional<? extends Number> value, Optional<Short> scal\n         return getScaled(value.get().longValue(), scaleFactor.get(), unit);\n     }\n \n+    /**\n+     * Returns value multiplied by the 10 on the power of scaleFactory\n+     *\n+     * @param value the value to alter\n+     * @param scaleFactor the scale factor to use (may be negative)\n+     * @return the scaled value as a DecimalType\n+     */\n+    protected State getScaled(Optional<? extends Number> value, Short scaleFactor, Unit<?> unit) {\n+        if (!value.isPresent()) {\n+            return UnDefType.UNDEF;\n+        }\n+        return getScaled(value.get().longValue(), scaleFactor, unit);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a16204e83002f1a0d0df1b265fa6256d3b537b16"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTkxMDM2MQ==", "bodyText": "Thanks I was aware of that, but that would lead to a different implementation of the getScaled, wich is incorrect in the case of mandatory fields. Mandatory fields will never output an UnDefType value.", "url": "https://github.com/openhab/openhab-addons/pull/7432#discussion_r411910361", "createdAt": "2020-04-21T06:38:06Z", "author": {"login": "mrbig"}, "path": "bundles/org.openhab.binding.modbus.sunspec/src/main/java/org/openhab/binding/modbus/sunspec/internal/handler/AbstractSunSpecHandler.java", "diffHunk": "@@ -507,6 +507,20 @@ protected State getScaled(Optional<? extends Number> value, Optional<Short> scal\n         return getScaled(value.get().longValue(), scaleFactor.get(), unit);\n     }\n \n+    /**\n+     * Returns value multiplied by the 10 on the power of scaleFactory\n+     *\n+     * @param value the value to alter\n+     * @param scaleFactor the scale factor to use (may be negative)\n+     * @return the scaled value as a DecimalType\n+     */\n+    protected State getScaled(Optional<? extends Number> value, Short scaleFactor, Unit<?> unit) {\n+        if (!value.isPresent()) {\n+            return UnDefType.UNDEF;\n+        }\n+        return getScaled(value.get().longValue(), scaleFactor, unit);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTY3NTY4OA=="}, "originalCommit": {"oid": "a16204e83002f1a0d0df1b265fa6256d3b537b16"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjM2NjEwMQ==", "bodyText": "Mandatory fields will never output an UnDefType value.\n\nI don't understand, your code clearly returns and UnDefType if it is missing a value...", "url": "https://github.com/openhab/openhab-addons/pull/7432#discussion_r412366101", "createdAt": "2020-04-21T17:50:09Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.modbus.sunspec/src/main/java/org/openhab/binding/modbus/sunspec/internal/handler/AbstractSunSpecHandler.java", "diffHunk": "@@ -507,6 +507,20 @@ protected State getScaled(Optional<? extends Number> value, Optional<Short> scal\n         return getScaled(value.get().longValue(), scaleFactor.get(), unit);\n     }\n \n+    /**\n+     * Returns value multiplied by the 10 on the power of scaleFactory\n+     *\n+     * @param value the value to alter\n+     * @param scaleFactor the scale factor to use (may be negative)\n+     * @return the scaled value as a DecimalType\n+     */\n+    protected State getScaled(Optional<? extends Number> value, Short scaleFactor, Unit<?> unit) {\n+        if (!value.isPresent()) {\n+            return UnDefType.UNDEF;\n+        }\n+        return getScaled(value.get().longValue(), scaleFactor, unit);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTY3NTY4OA=="}, "originalCommit": {"oid": "a16204e83002f1a0d0df1b265fa6256d3b537b16"}, "originalPosition": 15}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjM5ODg5MQ==", "bodyText": "ignore my previous commit, I did misunderstand you. Now I see what you meant: there is a code duplication even if it's an if, and you are absolutely right.\nI removed the duplication. By the way I removed the unitless getScaled methods, I do not intend to use them anymore.", "url": "https://github.com/openhab/openhab-addons/pull/7432#discussion_r412398891", "createdAt": "2020-04-21T18:37:42Z", "author": {"login": "mrbig"}, "path": "bundles/org.openhab.binding.modbus.sunspec/src/main/java/org/openhab/binding/modbus/sunspec/internal/handler/AbstractSunSpecHandler.java", "diffHunk": "@@ -507,6 +507,20 @@ protected State getScaled(Optional<? extends Number> value, Optional<Short> scal\n         return getScaled(value.get().longValue(), scaleFactor.get(), unit);\n     }\n \n+    /**\n+     * Returns value multiplied by the 10 on the power of scaleFactory\n+     *\n+     * @param value the value to alter\n+     * @param scaleFactor the scale factor to use (may be negative)\n+     * @return the scaled value as a DecimalType\n+     */\n+    protected State getScaled(Optional<? extends Number> value, Short scaleFactor, Unit<?> unit) {\n+        if (!value.isPresent()) {\n+            return UnDefType.UNDEF;\n+        }\n+        return getScaled(value.get().longValue(), scaleFactor, unit);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTY3NTY4OA=="}, "originalCommit": {"oid": "a16204e83002f1a0d0df1b265fa6256d3b537b16"}, "originalPosition": 15}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU1NzYyNjAwOnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.modbus.sunspec/src/main/resources/ESH-INF/thing/inverter-channel-types.xml", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQyMDo0MTozMFrOGImzTw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQwNjo1ODo1NFrOGI1tuQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTY3NzUxOQ==", "bodyText": "remove excess blank lines", "url": "https://github.com/openhab/openhab-addons/pull/7432#discussion_r411677519", "createdAt": "2020-04-20T20:41:30Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.modbus.sunspec/src/main/resources/ESH-INF/thing/inverter-channel-types.xml", "diffHunk": "@@ -45,6 +65,26 @@\n \t\t<state readOnly=\"true\" pattern=\"%d %unit%\"/>\n \t</channel-type>\n \t\n+\t<channel-type id=\"dc-current-type\">\n+\t\t<item-type>Number:ElectricCurrent</item-type>\n+\t\t<label>DC Current Value</label>\n+\t\t<state readOnly=\"true\" pattern=\"%.1f %unit%\"/>\n+\t</channel-type>\n+\n+\t<channel-type id=\"dc-voltage-type\">\n+\t\t<item-type>Number:ElectricPotential</item-type>\n+\t\t<label>DC Voltage Value</label>\n+\t\t<state readOnly=\"true\" pattern=\"%d %unit%\"/>\n+\t</channel-type>\n+\n+\t<channel-type id=\"dc-power-type\">\n+\t\t<item-type>Number:Power</item-type>\n+\t\t<label>DC Power Value</label>\n+\t\t<state readOnly=\"true\" pattern=\"%d %unit%\"/>\n+\t</channel-type>\n+\n+\n+", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a16204e83002f1a0d0df1b265fa6256d3b537b16"}, "originalPosition": 50}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTkyMTg0OQ==", "bodyText": "thanks, removed.", "url": "https://github.com/openhab/openhab-addons/pull/7432#discussion_r411921849", "createdAt": "2020-04-21T06:58:54Z", "author": {"login": "mrbig"}, "path": "bundles/org.openhab.binding.modbus.sunspec/src/main/resources/ESH-INF/thing/inverter-channel-types.xml", "diffHunk": "@@ -45,6 +65,26 @@\n \t\t<state readOnly=\"true\" pattern=\"%d %unit%\"/>\n \t</channel-type>\n \t\n+\t<channel-type id=\"dc-current-type\">\n+\t\t<item-type>Number:ElectricCurrent</item-type>\n+\t\t<label>DC Current Value</label>\n+\t\t<state readOnly=\"true\" pattern=\"%.1f %unit%\"/>\n+\t</channel-type>\n+\n+\t<channel-type id=\"dc-voltage-type\">\n+\t\t<item-type>Number:ElectricPotential</item-type>\n+\t\t<label>DC Voltage Value</label>\n+\t\t<state readOnly=\"true\" pattern=\"%d %unit%\"/>\n+\t</channel-type>\n+\n+\t<channel-type id=\"dc-power-type\">\n+\t\t<item-type>Number:Power</item-type>\n+\t\t<label>DC Power Value</label>\n+\t\t<state readOnly=\"true\" pattern=\"%d %unit%\"/>\n+\t</channel-type>\n+\n+\n+", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTY3NzUxOQ=="}, "originalCommit": {"oid": "a16204e83002f1a0d0df1b265fa6256d3b537b16"}, "originalPosition": 50}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU1NzY0MDAwOnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.modbus.sunspec/src/main/java/org/openhab/binding/modbus/sunspec/internal/handler/InverterHandler.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQyMDo0NTowN1rOGIm7vQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQwNjo1ODo0OFrOGI1thA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTY3OTY3Nw==", "bodyText": "These should be using your channelUID(...) method in instead.", "url": "https://github.com/openhab/openhab-addons/pull/7432#discussion_r411679677", "createdAt": "2020-04-20T20:45:07Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.modbus.sunspec/src/main/java/org/openhab/binding/modbus/sunspec/internal/handler/InverterHandler.java", "diffHunk": "@@ -103,12 +103,52 @@ protected void handlePolledData(ModbusRegisterArray registers) {\n                                                                                   // see:\n                                                                                   // https://github.com/openhab/openhab-core/pull/1347\n \n+        // DC General group\n+        updateState(new ChannelUID(getThing().getUID(), GROUP_DC_GENERAL, CHANNEL_DC_CURRENT),\n+                getScaled(block.dcCurrent, block.dcCurrentSF, AMPERE));\n+        updateState(new ChannelUID(getThing().getUID(), GROUP_DC_GENERAL, CHANNEL_DC_VOLTAGE),\n+                getScaled(block.dcVoltage, block.dcVoltageSF, VOLT));\n+        updateState(new ChannelUID(getThing().getUID(), GROUP_DC_GENERAL, CHANNEL_DC_POWER),\n+                getScaled(block.dcPower, block.dcPowerSF, VOLT));\n+\n         updateState(channelUID(GROUP_AC_GENERAL, CHANNEL_AC_POWER_FACTOR),\n                 getScaled(block.acPowerFactor, block.acPowerFactorSF, PERCENT));\n \n         updateState(channelUID(GROUP_AC_GENERAL, CHANNEL_AC_LIFETIME_ENERGY),\n                 getScaled(block.acEnergyLifetime, block.acEnergyLifetimeSF, WATT_HOUR));\n \n+        // AC Phase specific groups\n+        // All types of inverters\n+        updateState(new ChannelUID(getThing().getUID(), GROUP_AC_PHASE_A, CHANNEL_AC_PHASE_CURRENT),\n+                getScaled(block.acCurrentPhaseA, block.acCurrentSF, AMPERE));\n+        updateState(new ChannelUID(getThing().getUID(), GROUP_AC_PHASE_A, CHANNEL_AC_VOLTAGE_TO_NEXT),\n+                getScaled(block.acVoltageAB, block.acVoltageSF, VOLT));\n+        updateState(new ChannelUID(getThing().getUID(), GROUP_AC_PHASE_A, CHANNEL_AC_VOLTAGE_TO_N),\n+                getScaled(block.acVoltageAtoN, block.acVoltageSF, VOLT));\n+\n+        // Split phase and three phase\n+        if ((thing.getThingTypeUID().equals(THING_TYPE_INVERTER_SPLIT_PHASE)\n+                || thing.getThingTypeUID().equals(THING_TYPE_INVERTER_THREE_PHASE))\n+                && block.phaseConfiguration >= INVERTER_SPLIT_PHASE) {\n+            updateState(new ChannelUID(getThing().getUID(), GROUP_AC_PHASE_B, CHANNEL_AC_PHASE_CURRENT),\n+                    getScaled(block.acCurrentPhaseB, block.acCurrentSF, AMPERE));\n+            updateState(new ChannelUID(getThing().getUID(), GROUP_AC_PHASE_B, CHANNEL_AC_VOLTAGE_TO_NEXT),\n+                    getScaled(block.acVoltageBC, block.acVoltageSF, VOLT));\n+            updateState(new ChannelUID(getThing().getUID(), GROUP_AC_PHASE_B, CHANNEL_AC_VOLTAGE_TO_N),\n+                    getScaled(block.acVoltageBtoN, block.acVoltageSF, VOLT));\n+        }\n+\n+        // Three phase only\n+        if (thing.getThingTypeUID().equals(THING_TYPE_INVERTER_THREE_PHASE)\n+                && block.phaseConfiguration >= INVERTER_THREE_PHASE) {\n+            updateState(new ChannelUID(getThing().getUID(), GROUP_AC_PHASE_C, CHANNEL_AC_PHASE_CURRENT),", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a16204e83002f1a0d0df1b265fa6256d3b537b16"}, "originalPosition": 42}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTkyMTc5Ng==", "bodyText": "Thanks, I've overlooked this. Fixed", "url": "https://github.com/openhab/openhab-addons/pull/7432#discussion_r411921796", "createdAt": "2020-04-21T06:58:48Z", "author": {"login": "mrbig"}, "path": "bundles/org.openhab.binding.modbus.sunspec/src/main/java/org/openhab/binding/modbus/sunspec/internal/handler/InverterHandler.java", "diffHunk": "@@ -103,12 +103,52 @@ protected void handlePolledData(ModbusRegisterArray registers) {\n                                                                                   // see:\n                                                                                   // https://github.com/openhab/openhab-core/pull/1347\n \n+        // DC General group\n+        updateState(new ChannelUID(getThing().getUID(), GROUP_DC_GENERAL, CHANNEL_DC_CURRENT),\n+                getScaled(block.dcCurrent, block.dcCurrentSF, AMPERE));\n+        updateState(new ChannelUID(getThing().getUID(), GROUP_DC_GENERAL, CHANNEL_DC_VOLTAGE),\n+                getScaled(block.dcVoltage, block.dcVoltageSF, VOLT));\n+        updateState(new ChannelUID(getThing().getUID(), GROUP_DC_GENERAL, CHANNEL_DC_POWER),\n+                getScaled(block.dcPower, block.dcPowerSF, VOLT));\n+\n         updateState(channelUID(GROUP_AC_GENERAL, CHANNEL_AC_POWER_FACTOR),\n                 getScaled(block.acPowerFactor, block.acPowerFactorSF, PERCENT));\n \n         updateState(channelUID(GROUP_AC_GENERAL, CHANNEL_AC_LIFETIME_ENERGY),\n                 getScaled(block.acEnergyLifetime, block.acEnergyLifetimeSF, WATT_HOUR));\n \n+        // AC Phase specific groups\n+        // All types of inverters\n+        updateState(new ChannelUID(getThing().getUID(), GROUP_AC_PHASE_A, CHANNEL_AC_PHASE_CURRENT),\n+                getScaled(block.acCurrentPhaseA, block.acCurrentSF, AMPERE));\n+        updateState(new ChannelUID(getThing().getUID(), GROUP_AC_PHASE_A, CHANNEL_AC_VOLTAGE_TO_NEXT),\n+                getScaled(block.acVoltageAB, block.acVoltageSF, VOLT));\n+        updateState(new ChannelUID(getThing().getUID(), GROUP_AC_PHASE_A, CHANNEL_AC_VOLTAGE_TO_N),\n+                getScaled(block.acVoltageAtoN, block.acVoltageSF, VOLT));\n+\n+        // Split phase and three phase\n+        if ((thing.getThingTypeUID().equals(THING_TYPE_INVERTER_SPLIT_PHASE)\n+                || thing.getThingTypeUID().equals(THING_TYPE_INVERTER_THREE_PHASE))\n+                && block.phaseConfiguration >= INVERTER_SPLIT_PHASE) {\n+            updateState(new ChannelUID(getThing().getUID(), GROUP_AC_PHASE_B, CHANNEL_AC_PHASE_CURRENT),\n+                    getScaled(block.acCurrentPhaseB, block.acCurrentSF, AMPERE));\n+            updateState(new ChannelUID(getThing().getUID(), GROUP_AC_PHASE_B, CHANNEL_AC_VOLTAGE_TO_NEXT),\n+                    getScaled(block.acVoltageBC, block.acVoltageSF, VOLT));\n+            updateState(new ChannelUID(getThing().getUID(), GROUP_AC_PHASE_B, CHANNEL_AC_VOLTAGE_TO_N),\n+                    getScaled(block.acVoltageBtoN, block.acVoltageSF, VOLT));\n+        }\n+\n+        // Three phase only\n+        if (thing.getThingTypeUID().equals(THING_TYPE_INVERTER_THREE_PHASE)\n+                && block.phaseConfiguration >= INVERTER_THREE_PHASE) {\n+            updateState(new ChannelUID(getThing().getUID(), GROUP_AC_PHASE_C, CHANNEL_AC_PHASE_CURRENT),", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTY3OTY3Nw=="}, "originalCommit": {"oid": "a16204e83002f1a0d0df1b265fa6256d3b537b16"}, "originalPosition": 42}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU1NzY1MTAzOnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.modbus.sunspec/src/main/java/org/openhab/binding/modbus/sunspec/internal/SunSpecHandlerFactory.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQyMDo0ODowOFrOGInCXQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQwNjo0NDowMFrOGI1M0g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTY4MTM3Mw==", "bodyText": "Would this work?\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (thingTypeUID.equals(THING_TYPE_INVERTER_SINGLE_PHASE)\n          \n          \n            \n                            || thingTypeUID.equals(THING_TYPE_INVERTER_SPLIT_PHASE)\n          \n          \n            \n                            || thingTypeUID.equals(THING_TYPE_INVERTER_THREE_PHASE)) {\n          \n          \n            \n                    if (supportsThingType(thingTypeUID)) {", "url": "https://github.com/openhab/openhab-addons/pull/7432#discussion_r411681373", "createdAt": "2020-04-20T20:48:08Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.modbus.sunspec/src/main/java/org/openhab/binding/modbus/sunspec/internal/SunSpecHandlerFactory.java", "diffHunk": "@@ -69,14 +63,16 @@ public SunSpecHandlerFactory(@Reference ModbusManager manager) {\n \n     @Override\n     public boolean supportsThingType(ThingTypeUID thingTypeUID) {\n-        return SUPPORTED_THING_TYPES_UIDS.contains(thingTypeUID);\n+        return SUPPORTED_THING_TYPES_UIDS.containsValue(thingTypeUID);\n     }\n \n     @Override\n     protected @Nullable ThingHandler createHandler(Thing thing) {\n         ThingTypeUID thingTypeUID = thing.getThingTypeUID();\n \n-        if (thingTypeUID.equals(THING_TYPE_INVERTER_SINGLE_PHASE)) {\n+        if (thingTypeUID.equals(THING_TYPE_INVERTER_SINGLE_PHASE)\n+                || thingTypeUID.equals(THING_TYPE_INVERTER_SPLIT_PHASE)\n+                || thingTypeUID.equals(THING_TYPE_INVERTER_THREE_PHASE)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a16204e83002f1a0d0df1b265fa6256d3b537b16"}, "originalPosition": 37}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTkxMzQyNg==", "bodyText": "I have the 4th PR ready wich will add support for smart meters. But they use a different handler class, so this if will have an else if ... block with other thing types. That's the reason why this isn't a simple map lookup at the moment..", "url": "https://github.com/openhab/openhab-addons/pull/7432#discussion_r411913426", "createdAt": "2020-04-21T06:44:00Z", "author": {"login": "mrbig"}, "path": "bundles/org.openhab.binding.modbus.sunspec/src/main/java/org/openhab/binding/modbus/sunspec/internal/SunSpecHandlerFactory.java", "diffHunk": "@@ -69,14 +63,16 @@ public SunSpecHandlerFactory(@Reference ModbusManager manager) {\n \n     @Override\n     public boolean supportsThingType(ThingTypeUID thingTypeUID) {\n-        return SUPPORTED_THING_TYPES_UIDS.contains(thingTypeUID);\n+        return SUPPORTED_THING_TYPES_UIDS.containsValue(thingTypeUID);\n     }\n \n     @Override\n     protected @Nullable ThingHandler createHandler(Thing thing) {\n         ThingTypeUID thingTypeUID = thing.getThingTypeUID();\n \n-        if (thingTypeUID.equals(THING_TYPE_INVERTER_SINGLE_PHASE)) {\n+        if (thingTypeUID.equals(THING_TYPE_INVERTER_SINGLE_PHASE)\n+                || thingTypeUID.equals(THING_TYPE_INVERTER_SPLIT_PHASE)\n+                || thingTypeUID.equals(THING_TYPE_INVERTER_THREE_PHASE)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTY4MTM3Mw=="}, "originalCommit": {"oid": "a16204e83002f1a0d0df1b265fa6256d3b537b16"}, "originalPosition": 37}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU1NzY2MDQ2OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.modbus.sunspec/src/main/java/org/openhab/binding/modbus/sunspec/internal/SunSpecConstants.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMFQyMDo1MDowOVrOGInHig==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQwNjo0ODozN1rOGI1Wmg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTY4MjY5OA==", "bodyText": "Does this need to be a map? I don't see you using the map keys, is that for a future PR?", "url": "https://github.com/openhab/openhab-addons/pull/7432#discussion_r411682698", "createdAt": "2020-04-20T20:50:09Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.modbus.sunspec/src/main/java/org/openhab/binding/modbus/sunspec/internal/SunSpecConstants.java", "diffHunk": "@@ -33,17 +33,27 @@\n     // List of all Thing Type UIDs\n     public static final ThingTypeUID THING_TYPE_INVERTER_SINGLE_PHASE = new ThingTypeUID(BINDING_ID,\n             \"inverter-single-phase\");\n+    public static final ThingTypeUID THING_TYPE_INVERTER_SPLIT_PHASE = new ThingTypeUID(BINDING_ID,\n+            \"inverter-split-phase\");\n+    public static final ThingTypeUID THING_TYPE_INVERTER_THREE_PHASE = new ThingTypeUID(BINDING_ID,\n+            \"inverter-three-phase\");\n \n     // Block types\n     public static final int COMMON_BLOCK = 1;\n     public static final int INVERTER_SINGLE_PHASE = 101;\n+    public static final int INVERTER_SPLIT_PHASE = 102;\n+    public static final int INVERTER_THREE_PHASE = 103;\n     public static final int FINAL_BLOCK = 0xffff;\n \n     /**\n      * Map of the supported thing type uids, with their block type id\n      */\n-    public static final Map<Integer, ThingTypeUID> SUPPORTED_THING_TYPES_UIDS = Collections\n-            .singletonMap(INVERTER_SINGLE_PHASE, THING_TYPE_INVERTER_SINGLE_PHASE);\n+    public static final Map<Integer, ThingTypeUID> SUPPORTED_THING_TYPES_UIDS = new HashMap<>();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "a16204e83002f1a0d0df1b265fa6256d3b537b16"}, "originalPosition": 30}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTkxNTkzMA==", "bodyText": "This is already in use, the keys are checked by the SunspecDiscoveryProcess to recognize the block level id. See:\n\n  \n    \n      openhab-addons/bundles/org.openhab.binding.modbus.sunspec/src/main/java/org/openhab/binding/modbus/sunspec/internal/discovery/SunspecDiscoveryProcess.java\n    \n    \n        Lines 327 to 330\n      in\n      47a320c\n    \n    \n    \n    \n\n        \n          \n           if (!SUPPORTED_THING_TYPES_UIDS.containsKey(block.moduleID)) { \n        \n\n        \n          \n               logger.debug(\"ModuleID {} is not supported, skipping this block\", block.moduleID); \n        \n\n        \n          \n               return; \n        \n\n        \n          \n           } \n        \n    \n  \n\n\nBackground: in the specification device types are identified by a unique identifer for example: 101 - 1 phase inverter, 102 - 2 phase inverter, 103 - 3 phase inverter, 201 - 1 phase meter, etc.\nSUPPORTED_THING_TYPES_UIDS is a map between those identifiers and the OH thing type uids.", "url": "https://github.com/openhab/openhab-addons/pull/7432#discussion_r411915930", "createdAt": "2020-04-21T06:48:37Z", "author": {"login": "mrbig"}, "path": "bundles/org.openhab.binding.modbus.sunspec/src/main/java/org/openhab/binding/modbus/sunspec/internal/SunSpecConstants.java", "diffHunk": "@@ -33,17 +33,27 @@\n     // List of all Thing Type UIDs\n     public static final ThingTypeUID THING_TYPE_INVERTER_SINGLE_PHASE = new ThingTypeUID(BINDING_ID,\n             \"inverter-single-phase\");\n+    public static final ThingTypeUID THING_TYPE_INVERTER_SPLIT_PHASE = new ThingTypeUID(BINDING_ID,\n+            \"inverter-split-phase\");\n+    public static final ThingTypeUID THING_TYPE_INVERTER_THREE_PHASE = new ThingTypeUID(BINDING_ID,\n+            \"inverter-three-phase\");\n \n     // Block types\n     public static final int COMMON_BLOCK = 1;\n     public static final int INVERTER_SINGLE_PHASE = 101;\n+    public static final int INVERTER_SPLIT_PHASE = 102;\n+    public static final int INVERTER_THREE_PHASE = 103;\n     public static final int FINAL_BLOCK = 0xffff;\n \n     /**\n      * Map of the supported thing type uids, with their block type id\n      */\n-    public static final Map<Integer, ThingTypeUID> SUPPORTED_THING_TYPES_UIDS = Collections\n-            .singletonMap(INVERTER_SINGLE_PHASE, THING_TYPE_INVERTER_SINGLE_PHASE);\n+    public static final Map<Integer, ThingTypeUID> SUPPORTED_THING_TYPES_UIDS = new HashMap<>();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTY4MjY5OA=="}, "originalCommit": {"oid": "a16204e83002f1a0d0df1b265fa6256d3b537b16"}, "originalPosition": 30}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU2MjMyMjU1OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.modbus.sunspec/src/main/java/org/openhab/binding/modbus/sunspec/internal/SunSpecConstants.java", "isResolved": true, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQxODowMDoxN1rOGJRR0Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQyMDo1MTo0MlrOGJX9DA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjM3MzQ1Nw==", "bodyText": "Is that the naming used by the protocol specification? Otherwise I would prefer L1, L2, L3, which is the common naming.", "url": "https://github.com/openhab/openhab-addons/pull/7432#discussion_r412373457", "createdAt": "2020-04-21T18:00:17Z", "author": {"login": "J-N-K"}, "path": "bundles/org.openhab.binding.modbus.sunspec/src/main/java/org/openhab/binding/modbus/sunspec/internal/SunSpecConstants.java", "diffHunk": "@@ -58,6 +68,10 @@\n     // Channel group ids\n     public static final String GROUP_DEVICE_INFO = \"deviceInformation\";\n     public static final String GROUP_AC_GENERAL = \"acGeneral\";\n+    public static final String GROUP_AC_PHASE_A = \"acPhaseA\";", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "0ced75653c0e6f4577ca33f1e3102156cce6ff41"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjM5NDI0Nw==", "bodyText": "This specification use Phase A/B/C. For example here is one doc available: https://www.solaredge.com/sites/default/files/sunspec-implementation-technical-note.pdf see page 17.\nBut I understand your point as well. Maybe we could just change the labels?", "url": "https://github.com/openhab/openhab-addons/pull/7432#discussion_r412394247", "createdAt": "2020-04-21T18:30:28Z", "author": {"login": "mrbig"}, "path": "bundles/org.openhab.binding.modbus.sunspec/src/main/java/org/openhab/binding/modbus/sunspec/internal/SunSpecConstants.java", "diffHunk": "@@ -58,6 +68,10 @@\n     // Channel group ids\n     public static final String GROUP_DEVICE_INFO = \"deviceInformation\";\n     public static final String GROUP_AC_GENERAL = \"acGeneral\";\n+    public static final String GROUP_AC_PHASE_A = \"acPhaseA\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjM3MzQ1Nw=="}, "originalCommit": {"oid": "0ced75653c0e6f4577ca33f1e3102156cce6ff41"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjM5Njc3Mg==", "bodyText": "If A B C is the notation used by the standard this is probably how the devices are labeled, too. So we should keep that.\nAs you pointed out, we could use something like A (L1) for the labels.", "url": "https://github.com/openhab/openhab-addons/pull/7432#discussion_r412396772", "createdAt": "2020-04-21T18:34:21Z", "author": {"login": "J-N-K"}, "path": "bundles/org.openhab.binding.modbus.sunspec/src/main/java/org/openhab/binding/modbus/sunspec/internal/SunSpecConstants.java", "diffHunk": "@@ -58,6 +68,10 @@\n     // Channel group ids\n     public static final String GROUP_DEVICE_INFO = \"deviceInformation\";\n     public static final String GROUP_AC_GENERAL = \"acGeneral\";\n+    public static final String GROUP_AC_PHASE_A = \"acPhaseA\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjM3MzQ1Nw=="}, "originalCommit": {"oid": "0ced75653c0e6f4577ca33f1e3102156cce6ff41"}, "originalPosition": 43}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjQ4MjgyOA==", "bodyText": "Thanks, rephased the group labels. Also found a typo I was overlooking so far.", "url": "https://github.com/openhab/openhab-addons/pull/7432#discussion_r412482828", "createdAt": "2020-04-21T20:51:42Z", "author": {"login": "mrbig"}, "path": "bundles/org.openhab.binding.modbus.sunspec/src/main/java/org/openhab/binding/modbus/sunspec/internal/SunSpecConstants.java", "diffHunk": "@@ -58,6 +68,10 @@\n     // Channel group ids\n     public static final String GROUP_DEVICE_INFO = \"deviceInformation\";\n     public static final String GROUP_AC_GENERAL = \"acGeneral\";\n+    public static final String GROUP_AC_PHASE_A = \"acPhaseA\";", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjM3MzQ1Nw=="}, "originalCommit": {"oid": "0ced75653c0e6f4577ca33f1e3102156cce6ff41"}, "originalPosition": 43}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjU2MzM5MjQ4OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.modbus.sunspec/src/main/java/org/openhab/binding/modbus/sunspec/internal/handler/InverterHandler.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQyMjoyMzoxNVrOGJa_GQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNC0yMVQyMjo1NToyMFrOGJb3BA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjUzMjUwNQ==", "bodyText": "you are using unit volts for power?", "url": "https://github.com/openhab/openhab-addons/pull/7432#discussion_r412532505", "createdAt": "2020-04-21T22:23:15Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.modbus.sunspec/src/main/java/org/openhab/binding/modbus/sunspec/internal/handler/InverterHandler.java", "diffHunk": "@@ -109,6 +108,45 @@ protected void handlePolledData(ModbusRegisterArray registers) {\n         updateState(channelUID(GROUP_AC_GENERAL, CHANNEL_AC_LIFETIME_ENERGY),\n                 getScaled(block.acEnergyLifetime, block.acEnergyLifetimeSF, WATT_HOUR));\n \n+        // DC General group\n+        updateState(channelUID(GROUP_DC_GENERAL, CHANNEL_DC_CURRENT),\n+                getScaled(block.dcCurrent, block.dcCurrentSF, AMPERE));\n+        updateState(channelUID(GROUP_DC_GENERAL, CHANNEL_DC_VOLTAGE),\n+                getScaled(block.dcVoltage, block.dcVoltageSF, VOLT));\n+        updateState(channelUID(GROUP_DC_GENERAL, CHANNEL_DC_POWER), getScaled(block.dcPower, block.dcPowerSF, VOLT));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "b9a05c095ccf1d99ef8127ebe0553696d4cbbd86"}, "originalPosition": 26}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjU0NjgyMA==", "bodyText": "bummer. Of course not. Fixed this, thanks for pointing it out.", "url": "https://github.com/openhab/openhab-addons/pull/7432#discussion_r412546820", "createdAt": "2020-04-21T22:55:20Z", "author": {"login": "mrbig"}, "path": "bundles/org.openhab.binding.modbus.sunspec/src/main/java/org/openhab/binding/modbus/sunspec/internal/handler/InverterHandler.java", "diffHunk": "@@ -109,6 +108,45 @@ protected void handlePolledData(ModbusRegisterArray registers) {\n         updateState(channelUID(GROUP_AC_GENERAL, CHANNEL_AC_LIFETIME_ENERGY),\n                 getScaled(block.acEnergyLifetime, block.acEnergyLifetimeSF, WATT_HOUR));\n \n+        // DC General group\n+        updateState(channelUID(GROUP_DC_GENERAL, CHANNEL_DC_CURRENT),\n+                getScaled(block.dcCurrent, block.dcCurrentSF, AMPERE));\n+        updateState(channelUID(GROUP_DC_GENERAL, CHANNEL_DC_VOLTAGE),\n+                getScaled(block.dcVoltage, block.dcVoltageSF, VOLT));\n+        updateState(channelUID(GROUP_DC_GENERAL, CHANNEL_DC_POWER), getScaled(block.dcPower, block.dcPowerSF, VOLT));", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjUzMjUwNQ=="}, "originalCommit": {"oid": "b9a05c095ccf1d99ef8127ebe0553696d4cbbd86"}, "originalPosition": 26}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 294, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}