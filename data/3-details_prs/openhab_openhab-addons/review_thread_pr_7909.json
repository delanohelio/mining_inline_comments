{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDMzODU0MjIx", "number": 7909, "reviewThreads": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQyMzoyNjo1OVrOEFNjfg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQyMzoyNjo1OVrOEFNjfg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjczOTAwNDE0OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.hue/src/main/java/org/openhab/binding/hue/internal/handler/HueBridgeHandler.java", "isResolved": false, "comments": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xMlQyMzoyNjo1OVrOGjT2yw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0xM1QxOToyNzoxM1rOGjZAOA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY3ODY2Nw==", "bodyText": "Let the framework handle the checking for you.\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                if (thing.getStatus() != ThingStatus.ONLINE) {\n          \n          \n            \n                                    updateStatus(ThingStatus.ONLINE);\n          \n          \n            \n                                }\n          \n          \n            \n                                updateStatus(ThingStatus.ONLINE);", "url": "https://github.com/openhab/openhab-addons/pull/7909#discussion_r439678667", "createdAt": "2020-06-12T23:26:59Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.hue/src/main/java/org/openhab/binding/hue/internal/handler/HueBridgeHandler.java", "diffHunk": "@@ -114,6 +114,9 @@ public void run() {\n                 }\n                 if (lastBridgeConnectionState) {\n                     doConnectedRun();\n+                    if (thing.getStatus() != ThingStatus.ONLINE) {\n+                        updateStatus(ThingStatus.ONLINE);\n+                    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f9f6ea69c425a2e248a2107c9c23e7a016152e7d"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTcxNDIwMw==", "bodyText": "I checked the framework code and each call to updateStatus will produce one event on the event bus (even 2 in case of status change).\nWith the sensor polling run by default twice per second and possibly every 50 ms, this could lead to a massive event publishing on the bus. My test is here to avoid that.", "url": "https://github.com/openhab/openhab-addons/pull/7909#discussion_r439714203", "createdAt": "2020-06-13T06:27:13Z", "author": {"login": "lolodomo"}, "path": "bundles/org.openhab.binding.hue/src/main/java/org/openhab/binding/hue/internal/handler/HueBridgeHandler.java", "diffHunk": "@@ -114,6 +114,9 @@ public void run() {\n                 }\n                 if (lastBridgeConnectionState) {\n                     doConnectedRun();\n+                    if (thing.getStatus() != ThingStatus.ONLINE) {\n+                        updateStatus(ThingStatus.ONLINE);\n+                    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY3ODY2Nw=="}, "originalCommit": {"oid": "f9f6ea69c425a2e248a2107c9c23e7a016152e7d"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTcxNDgyNw==", "bodyText": "I realize that we could have a massive number of OFFLINE events on the bus too. I think the same check should be applied to updateStatus(OFFLINE).\nThis case is of course less common.", "url": "https://github.com/openhab/openhab-addons/pull/7909#discussion_r439714827", "createdAt": "2020-06-13T06:38:47Z", "author": {"login": "lolodomo"}, "path": "bundles/org.openhab.binding.hue/src/main/java/org/openhab/binding/hue/internal/handler/HueBridgeHandler.java", "diffHunk": "@@ -114,6 +114,9 @@ public void run() {\n                 }\n                 if (lastBridgeConnectionState) {\n                     doConnectedRun();\n+                    if (thing.getStatus() != ThingStatus.ONLINE) {\n+                        updateStatus(ThingStatus.ONLINE);\n+                    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY3ODY2Nw=="}, "originalCommit": {"oid": "f9f6ea69c425a2e248a2107c9c23e7a016152e7d"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc2MjgwOQ==", "bodyText": "I think in general that this is something that the framework should have been optimized for since bindings shouldn't be expected to perform this check themselves.\nAfter looking up the core code it does seem that it would publish to the event bus every time you call that, but it wouldn't publish the additional change event if it hasn't changed.\nhttps://github.com/openhab/openhab-core/blob/61e17ce39e83daa7f1d8c41512dead8d95d6e5d9/bundles/org.openhab.core.thing/src/main/java/org/openhab/core/thing/internal/ThingManagerImpl.java#L1147\nSo I guess you might have a point in trying to prevent that mandatory event publish. Seems weird that it would do that but we can't really change the core atm and your check is harmless so just leave your status check in place.", "url": "https://github.com/openhab/openhab-addons/pull/7909#discussion_r439762809", "createdAt": "2020-06-13T19:24:35Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.hue/src/main/java/org/openhab/binding/hue/internal/handler/HueBridgeHandler.java", "diffHunk": "@@ -114,6 +114,9 @@ public void run() {\n                 }\n                 if (lastBridgeConnectionState) {\n                     doConnectedRun();\n+                    if (thing.getStatus() != ThingStatus.ONLINE) {\n+                        updateStatus(ThingStatus.ONLINE);\n+                    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY3ODY2Nw=="}, "originalCommit": {"oid": "f9f6ea69c425a2e248a2107c9c23e7a016152e7d"}, "originalPosition": 6}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc2MzAwMA==", "bodyText": "I realize that we could have a massive number of OFFLINE events on the bus too. I think the same check should be applied to updateStatus(OFFLINE).\nThis case is of course less common.\n\nI don't think you should check in this case since it doesn't occur as often.", "url": "https://github.com/openhab/openhab-addons/pull/7909#discussion_r439763000", "createdAt": "2020-06-13T19:27:13Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.hue/src/main/java/org/openhab/binding/hue/internal/handler/HueBridgeHandler.java", "diffHunk": "@@ -114,6 +114,9 @@ public void run() {\n                 }\n                 if (lastBridgeConnectionState) {\n                     doConnectedRun();\n+                    if (thing.getStatus() != ThingStatus.ONLINE) {\n+                        updateStatus(ThingStatus.ONLINE);\n+                    }", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY3ODY2Nw=="}, "originalCommit": {"oid": "f9f6ea69c425a2e248a2107c9c23e7a016152e7d"}, "originalPosition": 6}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4781, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}