{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzczMzM5MDIz", "number": 6993, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxNzoyNDowMlrODkvvAQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxODo1NjoxMFrODkxoWQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM5ODU3NDA5OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.somfytahoma/src/main/java/org/openhab/binding/somfytahoma/internal/handler/SomfyTahomaBaseThingHandler.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxNzoyNDowM1rOFxPVUQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxODoxNjoyN1rOFxRDbA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzE3NTc2MQ==", "bodyText": "getURL is quite expensive and called even if the log level is lower than DEBUG. Is there any reason why the URL is not set during initialization and stored in a String field? In case of configuration change the thing handler is disposed and re-initialized, so this should not be a problem. (also applies below)", "url": "https://github.com/openhab/openhab-addons/pull/6993#discussion_r387175761", "createdAt": "2020-03-03T17:24:03Z", "author": {"login": "J-N-K"}, "path": "bundles/org.openhab.binding.somfytahoma/src/main/java/org/openhab/binding/somfytahoma/internal/handler/SomfyTahomaBaseThingHandler.java", "diffHunk": "@@ -62,12 +64,29 @@ public SomfyTahomaBaseThingHandler(Thing thing) {\n \n     @Override\n     public void initialize() {\n+        if (getThing().getProperties().containsKey(RSSI_LEVEL_STATE)) {\n+            createRSSIChannel();\n+        }\n         updateStatus(ThingStatus.ONLINE);\n     }\n \n+    private void createRSSIChannel() {\n+        if (thing.getChannel(RSSI) == null) {\n+            logger.debug(\"{} Creating a rssi channel\", getURL());\n+            createChannel(RSSI, \"Number\",\"RSSI Level\");\n+        }\n+    }\n+\n+    private void createChannel(String name, String type, String label) {\n+        ThingBuilder thingBuilder = editThing();\n+        Channel channel = ChannelBuilder.create(new ChannelUID(thing.getUID(), name), type).withLabel(label).build();\n+        thingBuilder.withChannel(channel);\n+        updateThing(thingBuilder.build());\n+    }\n+\n     @Override\n     public void handleCommand(ChannelUID channelUID, Command command) {\n-        logger.debug(\"Received command {} for channel {}\", command, channelUID);\n+        logger.debug(\"{} Received command {} for channel {}\", getURL(), command, channelUID);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c29df786a9949d4a7b14fe0f2ac3cdfe926910c8"}, "originalPosition": 36}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzIwMzk0OA==", "bodyText": "nice hint! fixed", "url": "https://github.com/openhab/openhab-addons/pull/6993#discussion_r387203948", "createdAt": "2020-03-03T18:16:27Z", "author": {"login": "octa22"}, "path": "bundles/org.openhab.binding.somfytahoma/src/main/java/org/openhab/binding/somfytahoma/internal/handler/SomfyTahomaBaseThingHandler.java", "diffHunk": "@@ -62,12 +64,29 @@ public SomfyTahomaBaseThingHandler(Thing thing) {\n \n     @Override\n     public void initialize() {\n+        if (getThing().getProperties().containsKey(RSSI_LEVEL_STATE)) {\n+            createRSSIChannel();\n+        }\n         updateStatus(ThingStatus.ONLINE);\n     }\n \n+    private void createRSSIChannel() {\n+        if (thing.getChannel(RSSI) == null) {\n+            logger.debug(\"{} Creating a rssi channel\", getURL());\n+            createChannel(RSSI, \"Number\",\"RSSI Level\");\n+        }\n+    }\n+\n+    private void createChannel(String name, String type, String label) {\n+        ThingBuilder thingBuilder = editThing();\n+        Channel channel = ChannelBuilder.create(new ChannelUID(thing.getUID(), name), type).withLabel(label).build();\n+        thingBuilder.withChannel(channel);\n+        updateThing(thingBuilder.build());\n+    }\n+\n     @Override\n     public void handleCommand(ChannelUID channelUID, Command command) {\n-        logger.debug(\"Received command {} for channel {}\", command, channelUID);\n+        logger.debug(\"{} Received command {} for channel {}\", getURL(), command, channelUID);", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzE3NTc2MQ=="}, "originalCommit": {"oid": "c29df786a9949d4a7b14fe0f2ac3cdfe926910c8"}, "originalPosition": 36}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM5ODU5MjMwOnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.somfytahoma/src/main/java/org/openhab/binding/somfytahoma/internal/handler/SomfyTahomaBaseThingHandler.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxNzoyOToxNVrOFxPgxw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxODoxNzoxMFrOFxRFEA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzE3ODY5NQ==", "bodyText": "isChannelLinked is quite expensive, while parseTahomaState seems to be cheap. Is there a special reason to check the channel link state (I know that has been done before, but ...)", "url": "https://github.com/openhab/openhab-addons/pull/6993#discussion_r387178695", "createdAt": "2020-03-03T17:29:15Z", "author": {"login": "J-N-K"}, "path": "bundles/org.openhab.binding.somfytahoma/src/main/java/org/openhab/binding/somfytahoma/internal/handler/SomfyTahomaBaseThingHandler.java", "diffHunk": "@@ -275,21 +294,40 @@ private void updateThingStatus(@Nullable SomfyTahomaState state) {\n     public void updateThingChannels(List<SomfyTahomaState> states) {\n         Map<String, String> properties = new HashMap<>();\n         for (SomfyTahomaState state : states) {\n-            logger.trace(\"processing state: {} with value: {}\", state.getName(), state.getValue());\n+            logger.trace(\"{} processing state: {} with value: {}\", getURL(), state.getName(), state.getValue());\n             properties.put(state.getName(), state.getValue().toString());\n-            updateThingChannels(state);\n+            if (RSSI_LEVEL_STATE.equals(state.getName())) {\n+                // RSSI channel is a dynamic one\n+                updateRSSIChannel(state);\n+            } else {\n+                updateThingChannels(state);\n+            }\n         }\n         updateProperties(properties);\n     }\n \n+    private void updateRSSIChannel(SomfyTahomaState state) {\n+        createRSSIChannel();\n+        Channel ch = thing.getChannel(RSSI);\n+        if (ch != null && isChannelLinked(ch)) {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c29df786a9949d4a7b14fe0f2ac3cdfe926910c8"}, "originalPosition": 88}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzIwNDM2OA==", "bodyText": "removed the check for a linked channel", "url": "https://github.com/openhab/openhab-addons/pull/6993#discussion_r387204368", "createdAt": "2020-03-03T18:17:10Z", "author": {"login": "octa22"}, "path": "bundles/org.openhab.binding.somfytahoma/src/main/java/org/openhab/binding/somfytahoma/internal/handler/SomfyTahomaBaseThingHandler.java", "diffHunk": "@@ -275,21 +294,40 @@ private void updateThingStatus(@Nullable SomfyTahomaState state) {\n     public void updateThingChannels(List<SomfyTahomaState> states) {\n         Map<String, String> properties = new HashMap<>();\n         for (SomfyTahomaState state : states) {\n-            logger.trace(\"processing state: {} with value: {}\", state.getName(), state.getValue());\n+            logger.trace(\"{} processing state: {} with value: {}\", getURL(), state.getName(), state.getValue());\n             properties.put(state.getName(), state.getValue().toString());\n-            updateThingChannels(state);\n+            if (RSSI_LEVEL_STATE.equals(state.getName())) {\n+                // RSSI channel is a dynamic one\n+                updateRSSIChannel(state);\n+            } else {\n+                updateThingChannels(state);\n+            }\n         }\n         updateProperties(properties);\n     }\n \n+    private void updateRSSIChannel(SomfyTahomaState state) {\n+        createRSSIChannel();\n+        Channel ch = thing.getChannel(RSSI);\n+        if (ch != null && isChannelLinked(ch)) {", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzE3ODY5NQ=="}, "originalCommit": {"oid": "c29df786a9949d4a7b14fe0f2ac3cdfe926910c8"}, "originalPosition": 88}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM5ODYzMTQyOnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.somfytahoma/src/main/java/org/openhab/binding/somfytahoma/internal/handler/SomfyTahomaWaterSensorHandler.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxNzo0MToyMFrOFxP5Qg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxODoxODowN1rOFxRG-A==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzE4NDk2Mg==", "bodyText": "This looks strange. Maybe run the spotless formatter before we merge", "url": "https://github.com/openhab/openhab-addons/pull/6993#discussion_r387184962", "createdAt": "2020-03-03T17:41:20Z", "author": {"login": "J-N-K"}, "path": "bundles/org.openhab.binding.somfytahoma/src/main/java/org/openhab/binding/somfytahoma/internal/handler/SomfyTahomaWaterSensorHandler.java", "diffHunk": "@@ -12,8 +12,8 @@\n  */\n package org.openhab.binding.somfytahoma.internal.handler;\n \n-import static org.openhab.binding.somfytahoma.internal.SomfyTahomaBindingConstants.CONTACT;\n-import static org.openhab.binding.somfytahoma.internal.SomfyTahomaBindingConstants.WATER_DETECTION_STATE;\n+import static org.openhab.binding.somfytahoma.internal.SomfyTahomaBindingConstants.*;\n+import static org.openhab.binding.somfytahoma.internal.SomfyTahomaBindingConstants.SENSOR_DEFECT_STATE;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c29df786a9949d4a7b14fe0f2ac3cdfe926910c8"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzIwNDg1Ng==", "bodyText": "fixed", "url": "https://github.com/openhab/openhab-addons/pull/6993#discussion_r387204856", "createdAt": "2020-03-03T18:18:07Z", "author": {"login": "octa22"}, "path": "bundles/org.openhab.binding.somfytahoma/src/main/java/org/openhab/binding/somfytahoma/internal/handler/SomfyTahomaWaterSensorHandler.java", "diffHunk": "@@ -12,8 +12,8 @@\n  */\n package org.openhab.binding.somfytahoma.internal.handler;\n \n-import static org.openhab.binding.somfytahoma.internal.SomfyTahomaBindingConstants.CONTACT;\n-import static org.openhab.binding.somfytahoma.internal.SomfyTahomaBindingConstants.WATER_DETECTION_STATE;\n+import static org.openhab.binding.somfytahoma.internal.SomfyTahomaBindingConstants.*;\n+import static org.openhab.binding.somfytahoma.internal.SomfyTahomaBindingConstants.SENSOR_DEFECT_STATE;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzE4NDk2Mg=="}, "originalCommit": {"oid": "c29df786a9949d4a7b14fe0f2ac3cdfe926910c8"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjM5ODg4NDczOnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.somfytahoma/src/main/java/org/openhab/binding/somfytahoma/internal/handler/SomfyTahomaBaseThingHandler.java", "isResolved": true, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxODo1NjoxMFrOFxSZfQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMy0wM1QxODo1OTo0MlrOFxShTg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzIyNTk4MQ==", "bodyText": "Unfortunately this will not work, the config might not be available when the handler is constructed.\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private final String url = getURL();\n          \n          \n            \n                private final String url = \"\";\n          \n      \n    \n    \n  \n\nAnd call url=getURL(); in initialize();", "url": "https://github.com/openhab/openhab-addons/pull/6993#discussion_r387225981", "createdAt": "2020-03-03T18:56:10Z", "author": {"login": "J-N-K"}, "path": "bundles/org.openhab.binding.somfytahoma/src/main/java/org/openhab/binding/somfytahoma/internal/handler/SomfyTahomaBaseThingHandler.java", "diffHunk": "@@ -62,6 +62,8 @@ public SomfyTahomaBaseThingHandler(Thing thing) {\n         return stateNames;\n     }\n \n+    private final String url = getURL();", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "07f364e07152ada7b5106a44a4fbd88d57700a4e"}, "originalPosition": 4}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzIyNzk4Mg==", "bodyText": "fixed, thanks", "url": "https://github.com/openhab/openhab-addons/pull/6993#discussion_r387227982", "createdAt": "2020-03-03T18:59:42Z", "author": {"login": "octa22"}, "path": "bundles/org.openhab.binding.somfytahoma/src/main/java/org/openhab/binding/somfytahoma/internal/handler/SomfyTahomaBaseThingHandler.java", "diffHunk": "@@ -62,6 +62,8 @@ public SomfyTahomaBaseThingHandler(Thing thing) {\n         return stateNames;\n     }\n \n+    private final String url = getURL();", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzIyNTk4MQ=="}, "originalCommit": {"oid": "07f364e07152ada7b5106a44a4fbd88d57700a4e"}, "originalPosition": 4}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 913, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}