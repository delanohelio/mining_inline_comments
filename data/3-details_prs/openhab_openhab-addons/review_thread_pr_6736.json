{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzU4NTA2MDI2", "number": 6736, "reviewThreads": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wMlQwNjowNzowM1rODVYolw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNlQyMDo1ODo0M1rODWFa3g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjIzNzUwMjk1OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.telegram/src/main/java/org/openhab/binding/telegram/bot/TelegramActions.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wMlQwNjowNzowM1rOFZlwCQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wMlQxNzo0MjozOVrOFZxERA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjM3NzIyNQ==", "bodyText": "The input parameter photoURL must not be assigned to.", "url": "https://github.com/openhab/openhab-addons/pull/6736#discussion_r362377225", "createdAt": "2020-01-02T06:07:03Z", "author": {"login": "9037568"}, "path": "bundles/org.openhab.binding.telegram/src/main/java/org/openhab/binding/telegram/bot/TelegramActions.java", "diffHunk": "@@ -341,6 +341,15 @@ public boolean sendTelegramPhoto(@ActionInput(name = \"chatId\") @Nullable Long ch\n                 // Load image from provided base64 image\n                 logger.debug(\"Photo base64 provided; converting to binary.\");\n                 try {\n+                    if (photoURL.startsWith(\"data:\")) // support data URI scheme\n+                    {\n+                        String[] photoURLParts = photoURL.split(\",\");\n+                        if (photoURLParts.length > 1) {\n+                            photoURL = photoURLParts[1];", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "df9d9cbb1356eb1bb5278ab714d59b2384f92473"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjQ3Njk0NQ==", "bodyText": "What exactly do you mean with \"must not be assigned to\"? From the functional point of view, such an operation is harmless as it doesn't modify the callers data. Do you want to avoid reusing the photoURL because it is a method input argument? The thing is that the photo URL can be both either a payload (e.g. \"F3A693C...\") or a data URI scheme (\"data:image/png;base64,F3A693C...\"). By removing the header, the photoURL is still in a format that could also come directly from the user and thus still applies to the \"method contract\". I would agree if I would misuse the method argument for any other data.\nAnyway, I can change it, but then I would introduce a new local variable that is either set to the input argument directly or to the photoURLParts[1]. Is that what you have in mind?", "url": "https://github.com/openhab/openhab-addons/pull/6736#discussion_r362476945", "createdAt": "2020-01-02T13:44:32Z", "author": {"login": "ZzetT"}, "path": "bundles/org.openhab.binding.telegram/src/main/java/org/openhab/binding/telegram/bot/TelegramActions.java", "diffHunk": "@@ -341,6 +341,15 @@ public boolean sendTelegramPhoto(@ActionInput(name = \"chatId\") @Nullable Long ch\n                 // Load image from provided base64 image\n                 logger.debug(\"Photo base64 provided; converting to binary.\");\n                 try {\n+                    if (photoURL.startsWith(\"data:\")) // support data URI scheme\n+                    {\n+                        String[] photoURLParts = photoURL.split(\",\");\n+                        if (photoURLParts.length > 1) {\n+                            photoURL = photoURLParts[1];", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjM3NzIyNQ=="}, "originalCommit": {"oid": "df9d9cbb1356eb1bb5278ab714d59b2384f92473"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjU0ODU5NA==", "bodyText": "Yes please.", "url": "https://github.com/openhab/openhab-addons/pull/6736#discussion_r362548594", "createdAt": "2020-01-02T17:00:12Z", "author": {"login": "J-N-K"}, "path": "bundles/org.openhab.binding.telegram/src/main/java/org/openhab/binding/telegram/bot/TelegramActions.java", "diffHunk": "@@ -341,6 +341,15 @@ public boolean sendTelegramPhoto(@ActionInput(name = \"chatId\") @Nullable Long ch\n                 // Load image from provided base64 image\n                 logger.debug(\"Photo base64 provided; converting to binary.\");\n                 try {\n+                    if (photoURL.startsWith(\"data:\")) // support data URI scheme\n+                    {\n+                        String[] photoURLParts = photoURL.split(\",\");\n+                        if (photoURLParts.length > 1) {\n+                            photoURL = photoURLParts[1];", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjM3NzIyNQ=="}, "originalCommit": {"oid": "df9d9cbb1356eb1bb5278ab714d59b2384f92473"}, "originalPosition": 8}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjU2MjYyOA==", "bodyText": "fixed", "url": "https://github.com/openhab/openhab-addons/pull/6736#discussion_r362562628", "createdAt": "2020-01-02T17:42:39Z", "author": {"login": "ZzetT"}, "path": "bundles/org.openhab.binding.telegram/src/main/java/org/openhab/binding/telegram/bot/TelegramActions.java", "diffHunk": "@@ -341,6 +341,15 @@ public boolean sendTelegramPhoto(@ActionInput(name = \"chatId\") @Nullable Long ch\n                 // Load image from provided base64 image\n                 logger.debug(\"Photo base64 provided; converting to binary.\");\n                 try {\n+                    if (photoURL.startsWith(\"data:\")) // support data URI scheme\n+                    {\n+                        String[] photoURLParts = photoURL.split(\",\");\n+                        if (photoURLParts.length > 1) {\n+                            photoURL = photoURLParts[1];", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjM3NzIyNQ=="}, "originalCommit": {"oid": "df9d9cbb1356eb1bb5278ab714d59b2384f92473"}, "originalPosition": 8}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjIzNzUwNDU5OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.telegram/README.md", "isResolved": false, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wMlQwNjowOTozNVrOFZlw_Q==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wMlQxNzo0Mjo1MlrOFZxEiA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjM3NzQ2OQ==", "bodyText": "I think we need an extended sample of this \"URI scheme\" format in the body somewhere to show what it is expected to contain.", "url": "https://github.com/openhab/openhab-addons/pull/6736#discussion_r362377469", "createdAt": "2020-01-02T06:09:35Z", "author": {"login": "9037568"}, "path": "bundles/org.openhab.binding.telegram/README.md", "diffHunk": "@@ -95,7 +95,7 @@ These actions will send a message to all chat ids configured for this bot.\n | sendTelegram(String format, Object... args)          | Sends a formatted message (See https://docs.oracle.com/javase/8/docs/api/java/util/Formatter.html for more information).\n | sendTelegramQuery(String message, String replyId, String... buttons) | Sends a question to the user that can be answered via the defined buttons. The replyId can be freely choosen and is sent back with the answer. Then, the id is required to identify what question has been answered (e.g. in case of multiple open questions). The final result looks like this: ![Telegram Inline Keyboard](doc/queryExample.png). |\n | sendTelegramAnswer(String replyId, String message) | Sends a message after the user has answered a question. You should *always* call this method after you received an answer. It will remove buttons from the specific question and will also stop the progress bar displayed at the client side. If no message is necessary, just pass `null` here. |\n-| sendTelegramPhoto(String photoURL, String caption) | Sends a picture. The URL can be specified using the http, https, and file protocols or a base64 encoded image. |\n+| sendTelegramPhoto(String photoURL, String caption) | Sends a picture. The URL can be specified using the http, https, and file protocols or a base64 encoded image (simple base64 data or data URI scheme). |", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "df9d9cbb1356eb1bb5278ab714d59b2384f92473"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjQ3Nzk0OA==", "bodyText": "The term \"data URI scheme\" is well-specified (first result in google, has it's own wiki page) where it explains the exact format for that.\nBut yes, I could modify the rule in doc \"Send telegram with base64 image and caption\" and in the same rule, also send a base64 image with such a header.", "url": "https://github.com/openhab/openhab-addons/pull/6736#discussion_r362477948", "createdAt": "2020-01-02T13:47:58Z", "author": {"login": "ZzetT"}, "path": "bundles/org.openhab.binding.telegram/README.md", "diffHunk": "@@ -95,7 +95,7 @@ These actions will send a message to all chat ids configured for this bot.\n | sendTelegram(String format, Object... args)          | Sends a formatted message (See https://docs.oracle.com/javase/8/docs/api/java/util/Formatter.html for more information).\n | sendTelegramQuery(String message, String replyId, String... buttons) | Sends a question to the user that can be answered via the defined buttons. The replyId can be freely choosen and is sent back with the answer. Then, the id is required to identify what question has been answered (e.g. in case of multiple open questions). The final result looks like this: ![Telegram Inline Keyboard](doc/queryExample.png). |\n | sendTelegramAnswer(String replyId, String message) | Sends a message after the user has answered a question. You should *always* call this method after you received an answer. It will remove buttons from the specific question and will also stop the progress bar displayed at the client side. If no message is necessary, just pass `null` here. |\n-| sendTelegramPhoto(String photoURL, String caption) | Sends a picture. The URL can be specified using the http, https, and file protocols or a base64 encoded image. |\n+| sendTelegramPhoto(String photoURL, String caption) | Sends a picture. The URL can be specified using the http, https, and file protocols or a base64 encoded image (simple base64 data or data URI scheme). |", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjM3NzQ2OQ=="}, "originalCommit": {"oid": "df9d9cbb1356eb1bb5278ab714d59b2384f92473"}, "originalPosition": 5}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjU2MjY5Ng==", "bodyText": "improved doc", "url": "https://github.com/openhab/openhab-addons/pull/6736#discussion_r362562696", "createdAt": "2020-01-02T17:42:52Z", "author": {"login": "ZzetT"}, "path": "bundles/org.openhab.binding.telegram/README.md", "diffHunk": "@@ -95,7 +95,7 @@ These actions will send a message to all chat ids configured for this bot.\n | sendTelegram(String format, Object... args)          | Sends a formatted message (See https://docs.oracle.com/javase/8/docs/api/java/util/Formatter.html for more information).\n | sendTelegramQuery(String message, String replyId, String... buttons) | Sends a question to the user that can be answered via the defined buttons. The replyId can be freely choosen and is sent back with the answer. Then, the id is required to identify what question has been answered (e.g. in case of multiple open questions). The final result looks like this: ![Telegram Inline Keyboard](doc/queryExample.png). |\n | sendTelegramAnswer(String replyId, String message) | Sends a message after the user has answered a question. You should *always* call this method after you received an answer. It will remove buttons from the specific question and will also stop the progress bar displayed at the client side. If no message is necessary, just pass `null` here. |\n-| sendTelegramPhoto(String photoURL, String caption) | Sends a picture. The URL can be specified using the http, https, and file protocols or a base64 encoded image. |\n+| sendTelegramPhoto(String photoURL, String caption) | Sends a picture. The URL can be specified using the http, https, and file protocols or a base64 encoded image (simple base64 data or data URI scheme). |", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjM3NzQ2OQ=="}, "originalCommit": {"oid": "df9d9cbb1356eb1bb5278ab714d59b2384f92473"}, "originalPosition": 5}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjIzNzUwODc1OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.telegram/src/main/java/org/openhab/binding/telegram/bot/TelegramActions.java", "isResolved": false, "comments": {"totalCount": 2, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wMlQwNjoxNToyMVrOFZlzMA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wMlQxNzo0Mjo1OVrOFZxErA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjM3ODAzMg==", "bodyText": "\"The provided base64 string is not a valid data URI scheme\"", "url": "https://github.com/openhab/openhab-addons/pull/6736#discussion_r362378032", "createdAt": "2020-01-02T06:15:21Z", "author": {"login": "9037568"}, "path": "bundles/org.openhab.binding.telegram/src/main/java/org/openhab/binding/telegram/bot/TelegramActions.java", "diffHunk": "@@ -341,6 +341,15 @@ public boolean sendTelegramPhoto(@ActionInput(name = \"chatId\") @Nullable Long ch\n                 // Load image from provided base64 image\n                 logger.debug(\"Photo base64 provided; converting to binary.\");\n                 try {\n+                    if (photoURL.startsWith(\"data:\")) // support data URI scheme\n+                    {\n+                        String[] photoURLParts = photoURL.split(\",\");\n+                        if (photoURLParts.length > 1) {\n+                            photoURL = photoURLParts[1];\n+                        } else {\n+                            logger.warn(\"The provided base64 string doesn't seem to a be valid data URI schema\");", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "df9d9cbb1356eb1bb5278ab714d59b2384f92473"}, "originalPosition": 10}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjU2MjczMg==", "bodyText": "fixed", "url": "https://github.com/openhab/openhab-addons/pull/6736#discussion_r362562732", "createdAt": "2020-01-02T17:42:59Z", "author": {"login": "ZzetT"}, "path": "bundles/org.openhab.binding.telegram/src/main/java/org/openhab/binding/telegram/bot/TelegramActions.java", "diffHunk": "@@ -341,6 +341,15 @@ public boolean sendTelegramPhoto(@ActionInput(name = \"chatId\") @Nullable Long ch\n                 // Load image from provided base64 image\n                 logger.debug(\"Photo base64 provided; converting to binary.\");\n                 try {\n+                    if (photoURL.startsWith(\"data:\")) // support data URI scheme\n+                    {\n+                        String[] photoURLParts = photoURL.split(\",\");\n+                        if (photoURLParts.length > 1) {\n+                            photoURL = photoURLParts[1];\n+                        } else {\n+                            logger.warn(\"The provided base64 string doesn't seem to a be valid data URI schema\");", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjM3ODAzMg=="}, "originalCommit": {"oid": "df9d9cbb1356eb1bb5278ab714d59b2384f92473"}, "originalPosition": 10}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI0NDgzNzg0OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.telegram/src/main/java/org/openhab/binding/telegram/bot/TelegramActions.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNlQyMDo1NzozOFrOFapCBg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNlQyMDo1NzozOFrOFapCBg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzQ3OTU1OA==", "bodyText": "Please apply correct formatting. brackets should be on the same line.", "url": "https://github.com/openhab/openhab-addons/pull/6736#discussion_r363479558", "createdAt": "2020-01-06T20:57:38Z", "author": {"login": "Hilbrand"}, "path": "bundles/org.openhab.binding.telegram/src/main/java/org/openhab/binding/telegram/bot/TelegramActions.java", "diffHunk": "@@ -341,7 +341,22 @@ public boolean sendTelegramPhoto(@ActionInput(name = \"chatId\") @Nullable Long ch\n                 // Load image from provided base64 image\n                 logger.debug(\"Photo base64 provided; converting to binary.\");\n                 try {\n-                    InputStream is = Base64.getDecoder().wrap(new ByteArrayInputStream(photoURL.getBytes(\"UTF-8\")));\n+                    final String photoB64Data;\n+                    if (photoURL.startsWith(\"data:\")) // support data URI scheme\n+                    {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1b620fa4844faab5768a69b599f3fd7e89de4d7"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjI0NDg0MDYyOnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.telegram/src/main/java/org/openhab/binding/telegram/bot/TelegramActions.java", "isResolved": false, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNlQyMDo1ODo0M1rOFapDsw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMS0wNlQyMDo1ODo0M1rOFapDsw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzQ3OTk4Nw==", "bodyText": "Use StandardCharsets.UTF_8 instead of string", "url": "https://github.com/openhab/openhab-addons/pull/6736#discussion_r363479987", "createdAt": "2020-01-06T20:58:43Z", "author": {"login": "Hilbrand"}, "path": "bundles/org.openhab.binding.telegram/src/main/java/org/openhab/binding/telegram/bot/TelegramActions.java", "diffHunk": "@@ -341,7 +341,22 @@ public boolean sendTelegramPhoto(@ActionInput(name = \"chatId\") @Nullable Long ch\n                 // Load image from provided base64 image\n                 logger.debug(\"Photo base64 provided; converting to binary.\");\n                 try {\n-                    InputStream is = Base64.getDecoder().wrap(new ByteArrayInputStream(photoURL.getBytes(\"UTF-8\")));\n+                    final String photoB64Data;\n+                    if (photoURL.startsWith(\"data:\")) // support data URI scheme\n+                    {\n+                        String[] photoURLParts = photoURL.split(\",\");\n+                        if (photoURLParts.length > 1) {\n+                            photoB64Data = photoURLParts[1];\n+                        } else {\n+                            logger.warn(\"The provided base64 string is not a valid data URI scheme\");\n+                            return false;\n+                        }\n+                    }\n+                    else\n+                    {\n+                        photoB64Data = photoURL;\n+                    }\n+                    InputStream is = Base64.getDecoder().wrap(new ByteArrayInputStream(photoB64Data.getBytes(\"UTF-8\")));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "f1b620fa4844faab5768a69b599f3fd7e89de4d7"}, "originalPosition": 20}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1132, "cost": 1, "resetAt": "2021-11-12T20:44:06Z"}}}