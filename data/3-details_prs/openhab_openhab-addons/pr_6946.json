{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0MzY5ODY3MDg1", "number": 6946, "title": "[mqtt] Fix increment commands in PercentageValue.", "bodyText": "[mqtt] Fix increment commands in PercentageValue.\nThe MQTT Things and Channels plugin specifies channels with a min, max, and a step size (such as the dimmer type here: https://www.openhab.org/addons/bindings/mqtt.generic/#channel-type-dimmer).  The internal openhab percentages are converted to this range when commands are sent and values are received.\nThis PR fixes a bug where the step size used as a percentage, rather than in the min/max range, and the limits of the INCREASE/DECREASE/UP/DOWN commands are compared against min and max, rather than the percentages, meaning the value can go out of bounds in either direction and raise internal errors.  The PR converts the step size to a percentage before using, and compares against 0/100 instead of min/max, ensuring the increment commands work as expected from the documentation.", "createdAt": "2020-02-01T07:12:06Z", "url": "https://github.com/openhab/openhab-addons/pull/6946", "merged": true, "mergeCommit": {"oid": "1cdb369d7eaf7c6098bba482fe988c4255faccc0"}, "closed": true, "closedAt": "2020-02-16T18:04:24Z", "author": {"login": "scarito"}, "timelineItems": {"totalCount": 5, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcAAMa_gFqTM1MTg3NDU5NQ==", "endCursor": "Y3Vyc29yOnYyOpPPAAABcE8sDWAFqTM1OTQxOTQxMg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxODc0NTk1", "url": "https://github.com/openhab/openhab-addons/pull/6946#pullrequestreview-351874595", "createdAt": "2020-02-01T09:19:38Z", "commit": {"oid": "139c7cc498a2055229fe2cebf154845051869eed"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wMVQwOToxOTozOFrOFkdBew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wMVQwOToxOTozOFrOFkdBew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzc2ODU3MQ==", "bodyText": "Do we have to calculate this every time?\nCan't this be a member variable?", "url": "https://github.com/openhab/openhab-addons/pull/6946#discussion_r373768571", "createdAt": "2020-02-01T09:19:38Z", "author": {"login": "jochen314"}, "path": "bundles/org.openhab.binding.mqtt.generic/src/main/java/org/openhab/binding/mqtt/generic/values/PercentageValue.java", "diffHunk": "@@ -95,12 +95,13 @@ public void update(Command command) throws IllegalArgumentException {\n         } else //\n                // Increase or decrease by \"step\"\n         if (command instanceof IncreaseDecreaseType) {\n+            final BigDecimal stepPercent = step.multiply(HUNDRED).divide(span, MathContext.DECIMAL128);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "139c7cc498a2055229fe2cebf154845051869eed"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "c157704d6f109fe5c211b25e3b63d0f425fda5b1", "author": {"user": {"login": "scarito", "name": null}}, "url": "https://github.com/openhab/openhab-addons/commit/c157704d6f109fe5c211b25e3b63d0f425fda5b1", "committedDate": "2020-02-01T19:21:10Z", "message": "[mqtt] Fix increment commands in PercentageValue.\n\nConvert step size to percentage before using with\nINCREASE/DECREASE/UP/DOWN commands.  The raw min, max,\nand step size were being used with the percentage value.\n\nSigned-off-by: Michael Scarito <ms.github@mit.edu>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "139c7cc498a2055229fe2cebf154845051869eed", "author": {"user": null}, "url": "https://github.com/openhab/openhab-addons/commit/139c7cc498a2055229fe2cebf154845051869eed", "committedDate": "2020-01-27T09:09:31Z", "message": "[mqtt] Fix increment commands in PercentageValue.\n\nConvert step size to percentage before using with\nINCREASE/DECREASE/UP/DOWN commands.  The raw min, max,\nand step size were being used with the percentage value.\n\nSigned-off-by: Michael Scarito <ms+github@mit.edu>"}, "afterCommit": {"oid": "c157704d6f109fe5c211b25e3b63d0f425fda5b1", "author": {"user": {"login": "scarito", "name": null}}, "url": "https://github.com/openhab/openhab-addons/commit/c157704d6f109fe5c211b25e3b63d0f425fda5b1", "committedDate": "2020-02-01T19:21:10Z", "message": "[mqtt] Fix increment commands in PercentageValue.\n\nConvert step size to percentage before using with\nINCREASE/DECREASE/UP/DOWN commands.  The raw min, max,\nand step size were being used with the percentage value.\n\nSigned-off-by: Michael Scarito <ms.github@mit.edu>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzUxOTI2NTUx", "url": "https://github.com/openhab/openhab-addons/pull/6946#pullrequestreview-351926551", "createdAt": "2020-02-02T08:28:55Z", "commit": {"oid": "c157704d6f109fe5c211b25e3b63d0f425fda5b1"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wMlQwODoyODo1NVrOFkgrew==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wMi0wMlQwODoyODo1NVrOFkgrew==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzgyODQ3NQ==", "bodyText": "For performance sake: Do we really need DECIMAL128 or would something lower be sufficient?", "url": "https://github.com/openhab/openhab-addons/pull/6946#discussion_r373828475", "createdAt": "2020-02-02T08:28:55Z", "author": {"login": "J-N-K"}, "path": "bundles/org.openhab.binding.mqtt.generic/src/main/java/org/openhab/binding/mqtt/generic/values/PercentageValue.java", "diffHunk": "@@ -69,6 +70,7 @@ public PercentageValue(@Nullable BigDecimal min, @Nullable BigDecimal max, @Null\n         }\n         this.span = this.max.subtract(this.min);\n         this.step = step == null ? BigDecimal.ONE : step;\n+        this.stepPercent = this.step.multiply(HUNDRED).divide(this.span, MathContext.DECIMAL128);", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "c157704d6f109fe5c211b25e3b63d0f425fda5b1"}, "originalPosition": 12}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3MzU5NDE5NDEy", "url": "https://github.com/openhab/openhab-addons/pull/6946#pullrequestreview-359419412", "createdAt": "2020-02-16T18:04:12Z", "commit": {"oid": "c157704d6f109fe5c211b25e3b63d0f425fda5b1"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 1337, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}