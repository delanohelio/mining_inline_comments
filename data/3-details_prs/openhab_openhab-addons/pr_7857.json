{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDI4MDQzMzUy", "number": 7857, "title": "[telegram] allow access restrictions on chat ids", "bodyText": "Adds the ability to use access modifiers on chat is. Use-case: Some chat ids (e.g. children) should receive notifications but should not be allowed to send commands.\nFully backward compatible, no modifier = sending and receiving\nSigned-off-by: Jan N. Klug jan.n.klug@rub.de", "createdAt": "2020-06-04T19:29:39Z", "url": "https://github.com/openhab/openhab-addons/pull/7857", "merged": true, "mergeCommit": {"oid": "3eeb6a5034551d4ea7bec71eb14d90cd51940f47"}, "closed": true, "closedAt": "2020-06-06T08:15:12Z", "author": {"login": "J-N-K"}, "timelineItems": {"totalCount": 8, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcoDB87AH2gAyNDI4MDQzMzUyOjIwODMyZDc3NmVjZDM4MWFmMWU5MzhmMDNhYzdiOWIxY2VmMjFiMTY=", "endCursor": "Y3Vyc29yOnYyOpPPAAABcoixpPgFqTQyNTcyMzcxNQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "20832d776ecd381af1e938f03ac7b9b1cef21b16", "author": {"user": {"login": "J-N-K", "name": null}}, "url": "https://github.com/openhab/openhab-addons/commit/20832d776ecd381af1e938f03ac7b9b1cef21b16", "committedDate": "2020-06-04T19:14:54Z", "message": "allow access restrictions on chat ids\n\nSigned-off-by: Jan N. Klug <jan.n.klug@rub.de>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1MDQ2NzA2", "url": "https://github.com/openhab/openhab-addons/pull/7857#pullrequestreview-425046706", "createdAt": "2020-06-05T07:10:00Z", "commit": {"oid": "20832d776ecd381af1e938f03ac7b9b1cef21b16"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQwNzoxMDowMFrOGfi1Kw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQwNzoxMDowMFrOGfi1Kw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTcyOTcwNw==", "bodyText": "Minor suggestion: use chatIdStr.substring(1) to remove the first character", "url": "https://github.com/openhab/openhab-addons/pull/7857#discussion_r435729707", "createdAt": "2020-06-05T07:10:00Z", "author": {"login": "ZzetT"}, "path": "bundles/org.openhab.binding.telegram/src/main/java/org/openhab/binding/telegram/internal/TelegramHandler.java", "diffHunk": "@@ -138,10 +140,23 @@ public void initialize() {\n         TelegramConfiguration config = getConfigAs(TelegramConfiguration.class);\n \n         String botToken = config.getBotToken();\n-        chatIds.clear();\n+        authorizedSenderChatId.clear();\n+        receiverChatId.clear();\n+\n         for (String chatIdStr : config.getChatIds()) {\n             try {\n-                chatIds.add(Long.valueOf(chatIdStr));\n+                if (chatIdStr.startsWith(\"<\")) {\n+                    // inbound only\n+                    authorizedSenderChatId.add(Long.valueOf(chatIdStr.replace(\"<\", \"\")));\n+                } else if (chatIdStr.startsWith(\">\")) {\n+                    // outbound only\n+                    receiverChatId.add(Long.valueOf(chatIdStr.replace(\">\", \"\")));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "20832d776ecd381af1e938f03ac7b9b1cef21b16"}, "originalPosition": 27}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1MDQ2NzIx", "url": "https://github.com/openhab/openhab-addons/pull/7857#pullrequestreview-425046721", "createdAt": "2020-06-05T07:10:02Z", "commit": {"oid": "20832d776ecd381af1e938f03ac7b9b1cef21b16"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQwNzoxMDowMlrOGfi1Ng==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNVQwNzoxMDowMlrOGfi1Ng==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTcyOTcxOA==", "bodyText": "I guess you removed the tags here to not confuse the user with the send/receive characters. Could we modify this example to also show how it would look with the prefix e.g. use \">ID2\" and to update the text in parenthesis (\"... where ID2 can only receive messages\"? Then we would also avoid confusions whether a space is required or not.", "url": "https://github.com/openhab/openhab-addons/pull/7857#discussion_r435729718", "createdAt": "2020-06-05T07:10:02Z", "author": {"login": "ZzetT"}, "path": "bundles/org.openhab.binding.telegram/README.md", "diffHunk": "@@ -62,29 +62,34 @@ In order to send a message, an action must be used instead.\n | `proxyPort`             |  None   | No       | Proxy port for telegram binding.                                                             |\n | `proxyType`             |  SOCKS5 | No       | Type of proxy server for telegram binding (SOCKS5 or HTTP). Default: SOCKS5                  |\n \n+By default chat ids are bi-directionally, i.e. they can send and receive messages.\n+They can be prefixed with an access modifier:\n+- `<` restricts the chat to send only, i.e. this chat id can send messages to openHAB, but will never receive a notification.\n+- `>` restricts the chat to receive only, i.e. this chat id will receive all notifications, but messages from this chat id will be discarded. \n+To use the reply function, chat ids need to be bi-directional.\n \n telegram.thing (no proxy):\n \n ```\n-Thing telegram:telegramBot:Telegram_Bot [ chatIds=\"< ID >\", botToken=\"< TOKEN >\" ]\n+Thing telegram:telegramBot:Telegram_Bot [ chatIds=\"ID\", botToken=\"TOKEN\" ]\n ```\n \n telegram.thing (multiple chat ids and markdown format):\n \n ```\n-Thing telegram:telegramBot:Telegram_Bot [ chatIds=\"< ID1 >\",\"< ID2 >\", botToken=\"< TOKEN >\", parseMode =\"Markdown\" ]\n+Thing telegram:telegramBot:Telegram_Bot [ chatIds=\"ID1\",\"ID2\", botToken=\"TOKEN\", parseMode =\"Markdown\" ]\n ```", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "20832d776ecd381af1e938f03ac7b9b1cef21b16"}, "originalPosition": 22}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "4c7f7a87476a1a2508fcfbe6835ce544bcd18655", "author": {"user": {"login": "J-N-K", "name": null}}, "url": "https://github.com/openhab/openhab-addons/commit/4c7f7a87476a1a2508fcfbe6835ce544bcd18655", "committedDate": "2020-06-05T13:30:47Z", "message": "address review comments\n\nSigned-off-by: Jan N. Klug <jan.n.klug@rub.de>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1NTk3NDYw", "url": "https://github.com/openhab/openhab-addons/pull/7857#pullrequestreview-425597460", "createdAt": "2020-06-05T20:13:04Z", "commit": {"oid": "4c7f7a87476a1a2508fcfbe6835ce544bcd18655"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1NzIyMTE1", "url": "https://github.com/openhab/openhab-addons/pull/7857#pullrequestreview-425722115", "createdAt": "2020-06-06T07:44:15Z", "commit": {"oid": "4c7f7a87476a1a2508fcfbe6835ce544bcd18655"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNlQwNzo0NDoxNVrOGgCd6g==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNi0wNlQwNzo0NDoxNVrOGgCd6g==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI0ODA0Mg==", "bodyText": "If you trim() earlier it is not a good idea to use substring(1) on the not trimmed String. Maybe introduced a local variable for the `trimmedChatId and use it here and in the following lines.", "url": "https://github.com/openhab/openhab-addons/pull/7857#discussion_r436248042", "createdAt": "2020-06-06T07:44:15Z", "author": {"login": "cweitkamp"}, "path": "bundles/org.openhab.binding.telegram/src/main/java/org/openhab/binding/telegram/internal/TelegramHandler.java", "diffHunk": "@@ -138,10 +140,23 @@ public void initialize() {\n         TelegramConfiguration config = getConfigAs(TelegramConfiguration.class);\n \n         String botToken = config.getBotToken();\n-        chatIds.clear();\n+        authorizedSenderChatId.clear();\n+        receiverChatId.clear();\n+\n         for (String chatIdStr : config.getChatIds()) {\n             try {\n-                chatIds.add(Long.valueOf(chatIdStr));\n+                if (chatIdStr.trim().startsWith(\"<\")) {\n+                    // inbound only\n+                    authorizedSenderChatId.add(Long.valueOf(chatIdStr.substring(1)));", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "4c7f7a87476a1a2508fcfbe6835ce544bcd18655"}, "originalPosition": 24}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0e53bb61098a3f7b4a419c893280110f86e8341b", "author": {"user": {"login": "J-N-K", "name": null}}, "url": "https://github.com/openhab/openhab-addons/commit/0e53bb61098a3f7b4a419c893280110f86e8341b", "committedDate": "2020-06-06T08:06:14Z", "message": "address more review comments\n\nSigned-off-by: Jan N. Klug <jan.n.klug@rub.de>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDI1NzIzNzE1", "url": "https://github.com/openhab/openhab-addons/pull/7857#pullrequestreview-425723715", "createdAt": "2020-06-06T08:14:03Z", "commit": {"oid": "0e53bb61098a3f7b4a419c893280110f86e8341b"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 526, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}