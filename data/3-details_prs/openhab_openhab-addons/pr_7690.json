{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDE5NzMzNTA2", "number": 7690, "title": "[yeelight] Added support Ceiling 1 with Night Mode", "bodyText": "Signed-off-by: Nikita Pogudalov dragonnp@ya.ru\n\nSupport Yeelight Ceiling Light 1 with night mode\n\n\n[yeelight] Added Ceiling 1 support\nAdd support for Yeelight Ceiling Light with night mode\nIn this update, you can add Yeelight Ceiling 1 devices with night mode. Updated README\n\n\n\n\nYou can download the JAR file from this link: https://drive.google.com/open?id=1dtmXRw_gESHKkrOTgbh-lQzMZnflhU0w", "createdAt": "2020-05-18T20:45:52Z", "url": "https://github.com/openhab/openhab-addons/pull/7690", "merged": true, "mergeCommit": {"oid": "eefe9e23f8b24bce9f5ca5a580e428fae453ef3c"}, "closed": true, "closedAt": "2020-05-19T20:02:38Z", "author": {"login": "DragonNP"}, "timelineItems": {"totalCount": 7, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABcimEKngH2gAyNDE5NzMzNTA2OjZlYTI5ZGUyNjg1ZTUyZDQ1YTcwOTViYjU2YmU0ODk4MmQ0OGI3ZTk=", "endCursor": "Y3Vyc29yOnYyOpPPAAABci6G2agFqTQxNDc3OTc2MA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "PullRequestCommit", "commit": {"oid": "6ea29de2685e52d45a7095bb56be48982d48b7e9", "author": {"user": {"login": "DragonNP", "name": "Nikita"}}, "url": "https://github.com/openhab/openhab-addons/commit/6ea29de2685e52d45a7095bb56be48982d48b7e9", "committedDate": "2020-05-18T20:40:27Z", "message": "Added support Ceiling 1\n\nSigned-off-by: DragonNP <dragonnp@ya.ru>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "103a851fec7cf6b10af2e436bfdc2049655d697c", "author": {"user": {"login": "DragonNP", "name": "Nikita"}}, "url": "https://github.com/openhab/openhab-addons/commit/103a851fec7cf6b10af2e436bfdc2049655d697c", "committedDate": "2020-05-19T11:37:00Z", "message": "Changed Author\n\nSigned-off-by: DragonNP <dragonnp@ya.ru>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "adb6d034f74ce24568ea3ff8df21e278c6345cf5", "author": {"user": {"login": "DragonNP", "name": "Nikita"}}, "url": "https://github.com/openhab/openhab-addons/commit/adb6d034f74ce24568ea3ff8df21e278c6345cf5", "committedDate": "2020-05-19T11:34:39Z", "message": "Changed Author"}, "afterCommit": {"oid": "103a851fec7cf6b10af2e436bfdc2049655d697c", "author": {"user": {"login": "DragonNP", "name": "Nikita"}}, "url": "https://github.com/openhab/openhab-addons/commit/103a851fec7cf6b10af2e436bfdc2049655d697c", "committedDate": "2020-05-19T11:37:00Z", "message": "Changed Author\n\nSigned-off-by: DragonNP <dragonnp@ya.ru>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0NjkxNzAy", "url": "https://github.com/openhab/openhab-addons/pull/7690#pullrequestreview-414691702", "createdAt": "2020-05-19T17:57:44Z", "commit": {"oid": "103a851fec7cf6b10af2e436bfdc2049655d697c"}, "state": "CHANGES_REQUESTED", "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxNzo1Nzo0NFrOGXsKAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxODowNDozOVrOGXsa-Q==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzQ5Mzg5MQ==", "bodyText": "Some of our build tools don't like EOF without a newline. So add a newline here.", "url": "https://github.com/openhab/openhab-addons/pull/7690#discussion_r427493891", "createdAt": "2020-05-19T17:57:44Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.yeelight/src/main/java/org/openhab/binding/yeelight/internal/lib/device/CeilingDeviceWithNightDevice.java", "diffHunk": "@@ -0,0 +1,70 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.yeelight.internal.lib.device;\n+\n+import org.openhab.binding.yeelight.internal.lib.enums.ActiveMode;\n+import org.openhab.binding.yeelight.internal.lib.enums.DeviceType;\n+import org.openhab.binding.yeelight.internal.lib.enums.MethodAction;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import com.google.gson.JsonArray;\n+import com.google.gson.JsonObject;\n+import com.google.gson.JsonParser;\n+\n+/**\n+ * The {@link CeilingDeviceWithNightDevice} contains methods for handling the ceiling device with ambient light.\n+ *\n+ * @author DragonNP - Initial contribution\n+ */\n+public class CeilingDeviceWithNightDevice extends CeilingDevice\n+        implements DeviceWithNightlight {\n+    private final Logger logger = LoggerFactory.getLogger(CeilingDeviceWithNightDevice.class);\n+\n+    public CeilingDeviceWithNightDevice(String id) {\n+        super(id);\n+\n+        mDeviceType = DeviceType.ceiling1;\n+    }\n+\n+    @Override\n+    public void onNotify(String msg) {\n+        logger.debug(\"Got state: {}\", msg);\n+\n+        JsonObject result = new JsonParser().parse(msg).getAsJsonObject();\n+\n+        if (result.has(\"id\")) {\n+            String id = result.get(\"id\").getAsString();\n+            // for cmd transaction.\n+\n+            if (mQueryList.contains(id)) {\n+                JsonArray status = result.get(\"result\").getAsJsonArray();\n+\n+                final int activeMode = status.get(8).getAsInt();\n+                mDeviceStatus.setActiveMode(ActiveMode.values()[activeMode]);\n+            }\n+        }\n+\n+        super.onNotify(msg);\n+    }\n+\n+    @Override\n+    public void toggleNightlightMode(boolean turnOn) {\n+        if (turnOn) {\n+            mConnection.invoke(\n+                    new DeviceMethod(MethodAction.SCENE, new Object[] { \"nightlight\", mDeviceStatus.getBrightness() }));\n+        } else {\n+            mConnection.invoke(MethodFactory.buildCTMethod(mDeviceStatus.getCt(), DeviceMethod.EFFECT_SMOOTH, 500));\n+        }\n+    }\n+}", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "103a851fec7cf6b10af2e436bfdc2049655d697c"}, "originalPosition": 70}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzQ5NjMwNA==", "bodyText": "I don't think you need to override this. YeelightCeilingHandler already implements this for you, unless you want to fix the string instead.", "url": "https://github.com/openhab/openhab-addons/pull/7690#discussion_r427496304", "createdAt": "2020-05-19T18:01:26Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.yeelight/src/main/java/org/openhab/binding/yeelight/internal/handler/YeelightCeilingWithNightHandler.java", "diffHunk": "@@ -0,0 +1,47 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.yeelight.internal.handler;\n+\n+import org.eclipse.smarthome.core.library.types.OnOffType;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.openhab.binding.yeelight.internal.YeelightBindingConstants;\n+import org.openhab.binding.yeelight.internal.lib.device.DeviceStatus;\n+import org.openhab.binding.yeelight.internal.lib.enums.ActiveMode;\n+\n+/**\n+ * The {@link YeelightCeilingWithNightHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author DragonNP - Initial contribution\n+ */\n+public class YeelightCeilingWithNightHandler extends YeelightHandlerBase {\n+\n+    public YeelightCeilingWithNightHandler(Thing thing) {\n+        super(thing);\n+    }\n+\n+    @Override\n+    public void handleCommand(ChannelUID channelUID, Command command) {\n+        handleCommandHelper(channelUID, command, \"Handle ceiling ambient light command\");\n+    }", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "103a851fec7cf6b10af2e436bfdc2049655d697c"}, "originalPosition": 38}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzQ5ODIzMw==", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            public class YeelightCeilingWithNightHandler extends YeelightHandlerBase {\n          \n          \n            \n            public class YeelightCeilingWithNightHandler extends YeelightCeilingHandler {", "url": "https://github.com/openhab/openhab-addons/pull/7690#discussion_r427498233", "createdAt": "2020-05-19T18:04:39Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.yeelight/src/main/java/org/openhab/binding/yeelight/internal/handler/YeelightCeilingWithNightHandler.java", "diffHunk": "@@ -0,0 +1,47 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.yeelight.internal.handler;\n+\n+import org.eclipse.smarthome.core.library.types.OnOffType;\n+import org.eclipse.smarthome.core.thing.ChannelUID;\n+import org.eclipse.smarthome.core.thing.Thing;\n+import org.eclipse.smarthome.core.types.Command;\n+import org.openhab.binding.yeelight.internal.YeelightBindingConstants;\n+import org.openhab.binding.yeelight.internal.lib.device.DeviceStatus;\n+import org.openhab.binding.yeelight.internal.lib.enums.ActiveMode;\n+\n+/**\n+ * The {@link YeelightCeilingWithNightHandler} is responsible for handling commands, which are\n+ * sent to one of the channels.\n+ *\n+ * @author DragonNP - Initial contribution\n+ */\n+public class YeelightCeilingWithNightHandler extends YeelightHandlerBase {", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "103a851fec7cf6b10af2e436bfdc2049655d697c"}, "originalPosition": 29}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0Njk4Mzg1", "url": "https://github.com/openhab/openhab-addons/pull/7690#pullrequestreview-414698385", "createdAt": "2020-05-19T18:06:13Z", "commit": {"oid": "103a851fec7cf6b10af2e436bfdc2049655d697c"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxODowNjoxM1rOGXserg==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNS0xOVQxODowNjoxM1rOGXserg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzQ5OTE4Mg==", "bodyText": "Also, please use your real name in the authoring tags", "url": "https://github.com/openhab/openhab-addons/pull/7690#discussion_r427499182", "createdAt": "2020-05-19T18:06:13Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.yeelight/src/main/java/org/openhab/binding/yeelight/internal/YeelightHandlerFactory.java", "diffHunk": "@@ -29,6 +29,7 @@\n  * The {@link YeelightHandlerFactory} is responsible for returning supported things and handlers for the devices.\n  *\n  * @author Coaster Li - Initial contribution\n+ * @author DragonNP - Added YeelightCeilingWithNightHandler for Ceiling 3", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "103a851fec7cf6b10af2e436bfdc2049655d697c"}, "originalPosition": 4}]}}, {"__typename": "PullRequestCommit", "commit": {"oid": "0d72b3c12fcc6df5f1c6dd9d25ef7e325e0eb507", "author": {"user": {"login": "DragonNP", "name": "Nikita"}}, "url": "https://github.com/openhab/openhab-addons/commit/0d72b3c12fcc6df5f1c6dd9d25ef7e325e0eb507", "committedDate": "2020-05-19T18:52:35Z", "message": "Fixing bugs\n\nSigned-off-by: Nikita Pogudalov <dragonnp@ya.ru>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NDE0Nzc5NzYw", "url": "https://github.com/openhab/openhab-addons/pull/7690#pullrequestreview-414779760", "createdAt": "2020-05-19T20:01:29Z", "commit": {"oid": "0d72b3c12fcc6df5f1c6dd9d25ef7e325e0eb507"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 586, "cost": 1, "resetAt": "2021-10-28T19:08:13Z"}}}