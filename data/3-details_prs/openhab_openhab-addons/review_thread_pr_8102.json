{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NDQ3NjM1MTAw", "number": 8102, "reviewThreads": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQyMTo0MjowM1rOENbELQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QyMTo0OToyOFrOERoLtA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyNTEwMzgxOnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.lcn/src/main/resources/ESH-INF/thing/thing-types.xml", "isResolved": true, "comments": {"totalCount": 3, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQyMTo0MjowM1rOGwGaRA==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQyMjowNzo1NFrOGwG-vg==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzA4OTg2MA==", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\t\t<description>Per default lcn binary sensor state 0 corresponds to \"closed\" while 1 corresponds to \"open\". Use this parameter to invert that logic.</description>\n          \n          \n            \n            \t\t\t\t<description>Per default a binary sensor state 0 corresponds to \"closed\" while 1 corresponds to \"open\". Use this parameter to invert that logic.</description>", "url": "https://github.com/openhab/openhab-addons/pull/8102#discussion_r453089860", "createdAt": "2020-07-10T21:42:03Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.lcn/src/main/resources/ESH-INF/thing/thing-types.xml", "diffHunk": "@@ -277,6 +277,13 @@\n \t\t<item-type>Contact</item-type>\n \t\t<label>Binary Sensor</label>\n \t\t<autoUpdatePolicy>veto</autoUpdatePolicy>\n+\t\t<config-description>\n+\t\t\t<parameter name=\"invertOpenClosed\" type=\"boolean\">\n+\t\t\t\t<label>Invert Open/Closed</label>\n+\t\t\t\t<description>Per default lcn binary sensor state 0 corresponds to \"closed\" while 1 corresponds to \"open\". Use this parameter to invert that logic.</description>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "629404d2abb7eb8291a9fb7221b64b3dbf5eeb44"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzA5NzE4OQ==", "bodyText": "I mentioned \"lcn binary sensor state\" explicitly because \"0\" and \"1\" refer to their use in the lcn/pck's binary sensor state status message Bx<w> with w=0.255. Nevertheless \u00edf you see a problem with this wording I can change it.", "url": "https://github.com/openhab/openhab-addons/pull/8102#discussion_r453097189", "createdAt": "2020-07-10T22:02:30Z", "author": {"login": "toweosp"}, "path": "bundles/org.openhab.binding.lcn/src/main/resources/ESH-INF/thing/thing-types.xml", "diffHunk": "@@ -277,6 +277,13 @@\n \t\t<item-type>Contact</item-type>\n \t\t<label>Binary Sensor</label>\n \t\t<autoUpdatePolicy>veto</autoUpdatePolicy>\n+\t\t<config-description>\n+\t\t\t<parameter name=\"invertOpenClosed\" type=\"boolean\">\n+\t\t\t\t<label>Invert Open/Closed</label>\n+\t\t\t\t<description>Per default lcn binary sensor state 0 corresponds to \"closed\" while 1 corresponds to \"open\". Use this parameter to invert that logic.</description>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzA4OTg2MA=="}, "originalCommit": {"oid": "629404d2abb7eb8291a9fb7221b64b3dbf5eeb44"}, "originalPosition": 7}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzA5OTE5OA==", "bodyText": "Since this is the LCN binding, it don't need to be repeated.", "url": "https://github.com/openhab/openhab-addons/pull/8102#discussion_r453099198", "createdAt": "2020-07-10T22:07:54Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.lcn/src/main/resources/ESH-INF/thing/thing-types.xml", "diffHunk": "@@ -277,6 +277,13 @@\n \t\t<item-type>Contact</item-type>\n \t\t<label>Binary Sensor</label>\n \t\t<autoUpdatePolicy>veto</autoUpdatePolicy>\n+\t\t<config-description>\n+\t\t\t<parameter name=\"invertOpenClosed\" type=\"boolean\">\n+\t\t\t\t<label>Invert Open/Closed</label>\n+\t\t\t\t<description>Per default lcn binary sensor state 0 corresponds to \"closed\" while 1 corresponds to \"open\". Use this parameter to invert that logic.</description>", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzA4OTg2MA=="}, "originalCommit": {"oid": "629404d2abb7eb8291a9fb7221b64b3dbf5eeb44"}, "originalPosition": 7}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjgyNTEwNzEwOnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.lcn/src/main/java/org/openhab/binding/lcn/internal/LcnModuleHandler.java", "isResolved": false, "comments": {"totalCount": 9, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0xMFQyMTo0Mzo0MFrOGwGcQw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxNDozMjo1OFrOG066qA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzA5MDM3MQ==", "bodyText": "Can you move this into LcnModuleBinarySensorSubHandler similar to the inversion of the roller shutter up/down in LcnModuleRollershutterRelaySubHandler?", "url": "https://github.com/openhab/openhab-addons/pull/8102#discussion_r453090371", "createdAt": "2020-07-10T21:43:40Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.lcn/src/main/java/org/openhab/binding/lcn/internal/LcnModuleHandler.java", "diffHunk": "@@ -290,6 +291,22 @@ public void updateChannel(LcnChannelGroup channelGroup, String channelId, State\n         if (converter != null) {\n             convertedState = converter.onStateUpdateFromHandler(state);\n         }\n+\n+        if (channelGroup.equals(LcnChannelGroup.BINARYSENSOR)) {\n+            Channel channel = thing.getChannel(channelUid);\n+            if (channel != null) {\n+                Object invertConfig = channel.getConfiguration().get(\"invertOpenClosed\");\n+                boolean invertOpenClosed = invertConfig instanceof Boolean && (boolean) invertConfig;\n+                if (invertOpenClosed) {\n+                    if (state.equals(OpenClosedType.OPEN)) {\n+                        convertedState = OpenClosedType.CLOSED;\n+                    } else {\n+                        convertedState = OpenClosedType.OPEN;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "629404d2abb7eb8291a9fb7221b64b3dbf5eeb44"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE2NjY5MA==", "bodyText": "BaseThingHandler.updateState is not visible from AbstractLcnModuleSubHandler. So one can not delegate channel update handling to a sub handler similar to the rollershutter command handling (without revealing BaseThingHandler.updateState in LcnModuleHandler). We could delegate state conversion within LcnModuleHandler.updateChannel to a converter (similar to Converter.onStateUpdateFromHandler(State)). This would require Converter to be an (abstract) superclass or better interface for arbitrary converters which are initialized in LcnModuleHandler.initialize. At the moment Converter is specialized to deal with variables only.\nWhat do you think?", "url": "https://github.com/openhab/openhab-addons/pull/8102#discussion_r453166690", "createdAt": "2020-07-11T07:19:12Z", "author": {"login": "toweosp"}, "path": "bundles/org.openhab.binding.lcn/src/main/java/org/openhab/binding/lcn/internal/LcnModuleHandler.java", "diffHunk": "@@ -290,6 +291,22 @@ public void updateChannel(LcnChannelGroup channelGroup, String channelId, State\n         if (converter != null) {\n             convertedState = converter.onStateUpdateFromHandler(state);\n         }\n+\n+        if (channelGroup.equals(LcnChannelGroup.BINARYSENSOR)) {\n+            Channel channel = thing.getChannel(channelUid);\n+            if (channel != null) {\n+                Object invertConfig = channel.getConfiguration().get(\"invertOpenClosed\");\n+                boolean invertOpenClosed = invertConfig instanceof Boolean && (boolean) invertConfig;\n+                if (invertOpenClosed) {\n+                    if (state.equals(OpenClosedType.OPEN)) {\n+                        convertedState = OpenClosedType.CLOSED;\n+                    } else {\n+                        convertedState = OpenClosedType.OPEN;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzA5MDM3MQ=="}, "originalCommit": {"oid": "629404d2abb7eb8291a9fb7221b64b3dbf5eeb44"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE3NjcwNA==", "bodyText": "If I see correctly, BaseThingHandler.updateState() is invoked via LcnModuleHandler.updateChannel() -> AbstractLcnModuleSubHandler.fireUpdate() -> LcnModuleBinarySensorSubHandler.handleStatusMessage(). I think the conversion could happen in LcnModuleBinarySensorSubHandler:55.", "url": "https://github.com/openhab/openhab-addons/pull/8102#discussion_r453176704", "createdAt": "2020-07-11T09:30:04Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.lcn/src/main/java/org/openhab/binding/lcn/internal/LcnModuleHandler.java", "diffHunk": "@@ -290,6 +291,22 @@ public void updateChannel(LcnChannelGroup channelGroup, String channelId, State\n         if (converter != null) {\n             convertedState = converter.onStateUpdateFromHandler(state);\n         }\n+\n+        if (channelGroup.equals(LcnChannelGroup.BINARYSENSOR)) {\n+            Channel channel = thing.getChannel(channelUid);\n+            if (channel != null) {\n+                Object invertConfig = channel.getConfiguration().get(\"invertOpenClosed\");\n+                boolean invertOpenClosed = invertConfig instanceof Boolean && (boolean) invertConfig;\n+                if (invertOpenClosed) {\n+                    if (state.equals(OpenClosedType.OPEN)) {\n+                        convertedState = OpenClosedType.CLOSED;\n+                    } else {\n+                        convertedState = OpenClosedType.OPEN;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzA5MDM3MQ=="}, "originalCommit": {"oid": "629404d2abb7eb8291a9fb7221b64b3dbf5eeb44"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzI5MDcyMg==", "bodyText": "Thanks for your feedback! If I didn't miss something when following your suggestion channel update (and status message handling resp.) would differ between binary sensors and variables. So from a design perspective I think we should choose between using the converter approach or uniquely handle value conversion within the sub-handler's handleStatusMessage.\nWould you like to decide how to uniquely handle value conversion and adapt the code correspondingly? Perhaps it would make sense to handle this on a separate enhancement/pull request due to the necessary refactorings.", "url": "https://github.com/openhab/openhab-addons/pull/8102#discussion_r453290722", "createdAt": "2020-07-12T09:13:24Z", "author": {"login": "toweosp"}, "path": "bundles/org.openhab.binding.lcn/src/main/java/org/openhab/binding/lcn/internal/LcnModuleHandler.java", "diffHunk": "@@ -290,6 +291,22 @@ public void updateChannel(LcnChannelGroup channelGroup, String channelId, State\n         if (converter != null) {\n             convertedState = converter.onStateUpdateFromHandler(state);\n         }\n+\n+        if (channelGroup.equals(LcnChannelGroup.BINARYSENSOR)) {\n+            Channel channel = thing.getChannel(channelUid);\n+            if (channel != null) {\n+                Object invertConfig = channel.getConfiguration().get(\"invertOpenClosed\");\n+                boolean invertOpenClosed = invertConfig instanceof Boolean && (boolean) invertConfig;\n+                if (invertOpenClosed) {\n+                    if (state.equals(OpenClosedType.OPEN)) {\n+                        convertedState = OpenClosedType.CLOSED;\n+                    } else {\n+                        convertedState = OpenClosedType.OPEN;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzA5MDM3MQ=="}, "originalCommit": {"oid": "629404d2abb7eb8291a9fb7221b64b3dbf5eeb44"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzg1NzQxMg==", "bodyText": "Although I'm a fan a of abstracting things, I wouldn't combine conversion of raw data into human readable values and the inversion of binary sensor states. First is a conversion, the other is a manipulation. From the functional perspective, I think they have to less in common to merge these functions.", "url": "https://github.com/openhab/openhab-addons/pull/8102#discussion_r453857412", "createdAt": "2020-07-13T18:46:10Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.lcn/src/main/java/org/openhab/binding/lcn/internal/LcnModuleHandler.java", "diffHunk": "@@ -290,6 +291,22 @@ public void updateChannel(LcnChannelGroup channelGroup, String channelId, State\n         if (converter != null) {\n             convertedState = converter.onStateUpdateFromHandler(state);\n         }\n+\n+        if (channelGroup.equals(LcnChannelGroup.BINARYSENSOR)) {\n+            Channel channel = thing.getChannel(channelUid);\n+            if (channel != null) {\n+                Object invertConfig = channel.getConfiguration().get(\"invertOpenClosed\");\n+                boolean invertOpenClosed = invertConfig instanceof Boolean && (boolean) invertConfig;\n+                if (invertOpenClosed) {\n+                    if (state.equals(OpenClosedType.OPEN)) {\n+                        convertedState = OpenClosedType.CLOSED;\n+                    } else {\n+                        convertedState = OpenClosedType.OPEN;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzA5MDM3MQ=="}, "originalCommit": {"oid": "629404d2abb7eb8291a9fb7221b64b3dbf5eeb44"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njg3ODE4OQ==", "bodyText": "WDYT?", "url": "https://github.com/openhab/openhab-addons/pull/8102#discussion_r456878189", "createdAt": "2020-07-19T08:22:34Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.lcn/src/main/java/org/openhab/binding/lcn/internal/LcnModuleHandler.java", "diffHunk": "@@ -290,6 +291,22 @@ public void updateChannel(LcnChannelGroup channelGroup, String channelId, State\n         if (converter != null) {\n             convertedState = converter.onStateUpdateFromHandler(state);\n         }\n+\n+        if (channelGroup.equals(LcnChannelGroup.BINARYSENSOR)) {\n+            Channel channel = thing.getChannel(channelUid);\n+            if (channel != null) {\n+                Object invertConfig = channel.getConfiguration().get(\"invertOpenClosed\");\n+                boolean invertOpenClosed = invertConfig instanceof Boolean && (boolean) invertConfig;\n+                if (invertOpenClosed) {\n+                    if (state.equals(OpenClosedType.OPEN)) {\n+                        convertedState = OpenClosedType.CLOSED;\n+                    } else {\n+                        convertedState = OpenClosedType.OPEN;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzA5MDM3MQ=="}, "originalCommit": {"oid": "629404d2abb7eb8291a9fb7221b64b3dbf5eeb44"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjkxMDczMQ==", "bodyText": "From my point of view there is no conceptual difference between converting raw variable data (i.e. lcn value) into temperature, speed etc. and converting raw lcn binary sensor data (0 or 1) into open/closed states. In my opinion in both cases conversion applies semantic to raw sensor data leading to human readable values.", "url": "https://github.com/openhab/openhab-addons/pull/8102#discussion_r456910731", "createdAt": "2020-07-19T13:45:12Z", "author": {"login": "toweosp"}, "path": "bundles/org.openhab.binding.lcn/src/main/java/org/openhab/binding/lcn/internal/LcnModuleHandler.java", "diffHunk": "@@ -290,6 +291,22 @@ public void updateChannel(LcnChannelGroup channelGroup, String channelId, State\n         if (converter != null) {\n             convertedState = converter.onStateUpdateFromHandler(state);\n         }\n+\n+        if (channelGroup.equals(LcnChannelGroup.BINARYSENSOR)) {\n+            Channel channel = thing.getChannel(channelUid);\n+            if (channel != null) {\n+                Object invertConfig = channel.getConfiguration().get(\"invertOpenClosed\");\n+                boolean invertOpenClosed = invertConfig instanceof Boolean && (boolean) invertConfig;\n+                if (invertOpenClosed) {\n+                    if (state.equals(OpenClosedType.OPEN)) {\n+                        convertedState = OpenClosedType.CLOSED;\n+                    } else {\n+                        convertedState = OpenClosedType.OPEN;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzA5MDM3MQ=="}, "originalCommit": {"oid": "629404d2abb7eb8291a9fb7221b64b3dbf5eeb44"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Njk1Mzg3MQ==", "bodyText": "Ok, you convinced me. I refactored the conversion code and made Converter an interface. Do you want to implement an inversion Converter?\nCan you give me access rights to merge the changes into your branch? Alternatively, you could merge my lcn-converter branch into yours. Before doing so you have to rebase this PR's branch to bb6722c.", "url": "https://github.com/openhab/openhab-addons/pull/8102#discussion_r456953871", "createdAt": "2020-07-19T20:48:19Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.lcn/src/main/java/org/openhab/binding/lcn/internal/LcnModuleHandler.java", "diffHunk": "@@ -290,6 +291,22 @@ public void updateChannel(LcnChannelGroup channelGroup, String channelId, State\n         if (converter != null) {\n             convertedState = converter.onStateUpdateFromHandler(state);\n         }\n+\n+        if (channelGroup.equals(LcnChannelGroup.BINARYSENSOR)) {\n+            Channel channel = thing.getChannel(channelUid);\n+            if (channel != null) {\n+                Object invertConfig = channel.getConfiguration().get(\"invertOpenClosed\");\n+                boolean invertOpenClosed = invertConfig instanceof Boolean && (boolean) invertConfig;\n+                if (invertOpenClosed) {\n+                    if (state.equals(OpenClosedType.OPEN)) {\n+                        convertedState = OpenClosedType.CLOSED;\n+                    } else {\n+                        convertedState = OpenClosedType.OPEN;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzA5MDM3MQ=="}, "originalCommit": {"oid": "629404d2abb7eb8291a9fb7221b64b3dbf5eeb44"}, "originalPosition": 22}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODE0NDQyNA==", "bodyText": "I added an InversionConverter. For this I moved Converter.onCommandFromItem(double) and Converter.onCommandFromItem(QuantityType<?>) down the hierarchy to ValueConverter because I think these methods make only sense when converting numerical values. The InversionConverter might later additionally be used e.g. for visualizing channels with inversed OnOff or UpDown states.", "url": "https://github.com/openhab/openhab-addons/pull/8102#discussion_r458144424", "createdAt": "2020-07-21T14:32:58Z", "author": {"login": "toweosp"}, "path": "bundles/org.openhab.binding.lcn/src/main/java/org/openhab/binding/lcn/internal/LcnModuleHandler.java", "diffHunk": "@@ -290,6 +291,22 @@ public void updateChannel(LcnChannelGroup channelGroup, String channelId, State\n         if (converter != null) {\n             convertedState = converter.onStateUpdateFromHandler(state);\n         }\n+\n+        if (channelGroup.equals(LcnChannelGroup.BINARYSENSOR)) {\n+            Channel channel = thing.getChannel(channelUid);\n+            if (channel != null) {\n+                Object invertConfig = channel.getConfiguration().get(\"invertOpenClosed\");\n+                boolean invertOpenClosed = invertConfig instanceof Boolean && (boolean) invertConfig;\n+                if (invertOpenClosed) {\n+                    if (state.equals(OpenClosedType.OPEN)) {\n+                        convertedState = OpenClosedType.CLOSED;\n+                    } else {\n+                        convertedState = OpenClosedType.OPEN;", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzA5MDM3MQ=="}, "originalCommit": {"oid": "629404d2abb7eb8291a9fb7221b64b3dbf5eeb44"}, "originalPosition": 22}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg1OTAyOTE1OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.lcn/src/main/java/org/openhab/binding/lcn/internal/LcnModuleHandler.java", "isResolved": false, "comments": {"totalCount": 4, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yMVQxNDo0NjozN1rOG07kQQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QyMDo0MTowMVrOG2azsA==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODE1NTA3Mw==", "bodyText": "This casting bothers me a bit. Is there an other way?", "url": "https://github.com/openhab/openhab-addons/pull/8102#discussion_r458155073", "createdAt": "2020-07-21T14:46:37Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.lcn/src/main/java/org/openhab/binding/lcn/internal/LcnModuleHandler.java", "diffHunk": "@@ -169,12 +180,23 @@ public void handleCommand(ChannelUID channelUid, Command command) {\n                 subHandler.handleCommandString((StringType) command, number.get());\n             } else if (command instanceof DecimalType) {\n                 DecimalType decimalType = (DecimalType) command;\n-                DecimalType nativeValue = getConverter(channelUid).onCommandFromItem(decimalType.doubleValue());\n-                subHandler.handleCommandDecimal(nativeValue, channelGroup, number.get());\n+                Converter valueConverter = getConverter(channelUid);\n+                if (valueConverter instanceof ValueConverter) {\n+                    DecimalType nativeValue = ((ValueConverter) valueConverter)\n+                            .onCommandFromItem(decimalType.doubleValue());\n+                    subHandler.handleCommandDecimal(nativeValue, channelGroup, number.get());\n+                }else{", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "50b01a456265d4105e6bd17cc2c5ce24a19cca49"}, "originalPosition": 87}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODM5NTI1MA==", "bodyText": "Sorry, had some issues with my eclipse/EGit installation. I hopefully managed to \"clean\" the branch from the commits not belonging to this PR, but I still have the following issues:\n\nI can't satisfy DCO (your commit apparently was missing signature). Tried to apply the steps mentioned in the DCO log but with no success.\nJ-N-K is still listed as a reviewer for this PR, although the commits not belonging to this PR are now (hopefully) removed.\n\nTo your question regarding the cast: One could move ValueConverter.onCommandFromItem(double) and ValueConverter.onCommandFromItem(QuantityType<?>) up to Converter again making them Nullable so InversionConverter could return null. But in my opinion this would violate separation of concerns, see my last comment.\nFrom a design perspective it might be better to separate conversion for representation (lcn bus -> UI) from conversion of commands (UI -> lcn bus) leading to two different converter hierarchies/interfaces, e.g. StateRepresentationConverter.onStateUpdateFromHandler and CommandConverter.onCommandFromItem - or to be okay with the casting ;-)", "url": "https://github.com/openhab/openhab-addons/pull/8102#discussion_r458395250", "createdAt": "2020-07-21T21:21:09Z", "author": {"login": "toweosp"}, "path": "bundles/org.openhab.binding.lcn/src/main/java/org/openhab/binding/lcn/internal/LcnModuleHandler.java", "diffHunk": "@@ -169,12 +180,23 @@ public void handleCommand(ChannelUID channelUid, Command command) {\n                 subHandler.handleCommandString((StringType) command, number.get());\n             } else if (command instanceof DecimalType) {\n                 DecimalType decimalType = (DecimalType) command;\n-                DecimalType nativeValue = getConverter(channelUid).onCommandFromItem(decimalType.doubleValue());\n-                subHandler.handleCommandDecimal(nativeValue, channelGroup, number.get());\n+                Converter valueConverter = getConverter(channelUid);\n+                if (valueConverter instanceof ValueConverter) {\n+                    DecimalType nativeValue = ((ValueConverter) valueConverter)\n+                            .onCommandFromItem(decimalType.doubleValue());\n+                    subHandler.handleCommandDecimal(nativeValue, channelGroup, number.get());\n+                }else{", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODE1NTA3Mw=="}, "originalCommit": {"oid": "50b01a456265d4105e6bd17cc2c5ce24a19cca49"}, "originalPosition": 87}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTA3NTcwNg==", "bodyText": "I'd go for a modified version of your first proposal. Move the methods back to Converter. Make Converter a class and add a default implementation for all four methods, that return the identity. Then, Nullable is not needed. Casting, instanceof and semantic based null values violate OOP paradigms most often.\nI don't think splitting the converters by the message direction doesn't solve the problem as the differentiation between values and binary states is still necessary.", "url": "https://github.com/openhab/openhab-addons/pull/8102#discussion_r459075706", "createdAt": "2020-07-22T20:51:50Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.lcn/src/main/java/org/openhab/binding/lcn/internal/LcnModuleHandler.java", "diffHunk": "@@ -169,12 +180,23 @@ public void handleCommand(ChannelUID channelUid, Command command) {\n                 subHandler.handleCommandString((StringType) command, number.get());\n             } else if (command instanceof DecimalType) {\n                 DecimalType decimalType = (DecimalType) command;\n-                DecimalType nativeValue = getConverter(channelUid).onCommandFromItem(decimalType.doubleValue());\n-                subHandler.handleCommandDecimal(nativeValue, channelGroup, number.get());\n+                Converter valueConverter = getConverter(channelUid);\n+                if (valueConverter instanceof ValueConverter) {\n+                    DecimalType nativeValue = ((ValueConverter) valueConverter)\n+                            .onCommandFromItem(decimalType.doubleValue());\n+                    subHandler.handleCommandDecimal(nativeValue, channelGroup, number.get());\n+                }else{", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODE1NTA3Mw=="}, "originalCommit": {"oid": "50b01a456265d4105e6bd17cc2c5ce24a19cca49"}, "originalPosition": 87}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTcxNTUwNA==", "bodyText": "Converters refactored as you requested.", "url": "https://github.com/openhab/openhab-addons/pull/8102#discussion_r459715504", "createdAt": "2020-07-23T20:41:01Z", "author": {"login": "toweosp"}, "path": "bundles/org.openhab.binding.lcn/src/main/java/org/openhab/binding/lcn/internal/LcnModuleHandler.java", "diffHunk": "@@ -169,12 +180,23 @@ public void handleCommand(ChannelUID channelUid, Command command) {\n                 subHandler.handleCommandString((StringType) command, number.get());\n             } else if (command instanceof DecimalType) {\n                 DecimalType decimalType = (DecimalType) command;\n-                DecimalType nativeValue = getConverter(channelUid).onCommandFromItem(decimalType.doubleValue());\n-                subHandler.handleCommandDecimal(nativeValue, channelGroup, number.get());\n+                Converter valueConverter = getConverter(channelUid);\n+                if (valueConverter instanceof ValueConverter) {\n+                    DecimalType nativeValue = ((ValueConverter) valueConverter)\n+                            .onCommandFromItem(decimalType.doubleValue());\n+                    subHandler.handleCommandDecimal(nativeValue, channelGroup, number.get());\n+                }else{", "state": "SUBMITTED", "replyTo": {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODE1NTA3Mw=="}, "originalCommit": {"oid": "50b01a456265d4105e6bd17cc2c5ce24a19cca49"}, "originalPosition": 87}]}}, {"id": "MDIzOlB1bGxSZXF1ZXN0UmV2aWV3VGhyZWFkMjg2OTE5NjA0OnYy", "diffSide": "RIGHT", "path": "bundles/org.openhab.binding.lcn/src/main/resources/ESH-INF/thing/thing-types.xml", "isResolved": true, "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QyMTo0OToyOFrOG2cxFQ==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0wNy0yM1QyMTo0OToyOFrOG2cxFQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTc0NzYwNQ==", "bodyText": "Words in labels should be capitalized. See https://www.openhab.org/docs/developer/bindings/thing-xml.html#formatting-labels-and-descriptions", "url": "https://github.com/openhab/openhab-addons/pull/8102#discussion_r459747605", "createdAt": "2020-07-23T21:49:28Z", "author": {"login": "fwolter"}, "path": "bundles/org.openhab.binding.lcn/src/main/resources/ESH-INF/thing/thing-types.xml", "diffHunk": "@@ -277,6 +277,14 @@\n \t\t<item-type>Contact</item-type>\n \t\t<label>Binary Sensor</label>\n \t\t<autoUpdatePolicy>veto</autoUpdatePolicy>\n+\t\t<config-description>\n+\t\t\t<parameter name=\"invertState\" type=\"boolean\">\n+\t\t\t\t<label>Invert state</label>", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "1aeaabe6c1921347596787d2d22e11992bd8fad9"}, "originalPosition": 6}]}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4714, "cost": 1, "resetAt": "2021-11-13T12:10:21Z"}}}