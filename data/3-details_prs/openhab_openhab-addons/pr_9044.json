{"data": {"repository": {"pullRequest": {"id": "MDExOlB1bGxSZXF1ZXN0NTIxODMyMzU1", "number": 9044, "title": "[dsmr] Use ThingHandlerService for discovery", "bodyText": "This simplifies the DSMRHandlerFactory code so it no longer needs to register and keep track of a discovery service for each bridge.\nAlso contains a few other improvements:\n\nmore constructor injection\nadd a few missing @NonNullByDefault on test classes", "createdAt": "2020-11-16T17:57:29Z", "url": "https://github.com/openhab/openhab-addons/pull/9044", "merged": true, "mergeCommit": {"oid": "5d99a7f524bc0c03b2836c8fcd940ed9812f79cb"}, "closed": true, "closedAt": "2021-04-08T20:49:15Z", "author": {"login": "wborn"}, "timelineItems": {"totalCount": 10, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpPPAAABddI1VUABqjQwMDE2MTA3MTQ=", "endCursor": "Y3Vyc29yOnYyOpPPAAABeLM-5bgFqTYzMTgyMDQ4OQ==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6476afe8cde9d2a07ea2d5f605d8dc42ebb8c73e", "author": {"user": {"login": "wborn", "name": "Wouter Born"}}, "url": "https://github.com/openhab/openhab-addons/commit/6476afe8cde9d2a07ea2d5f605d8dc42ebb8c73e", "committedDate": "2020-11-16T17:53:24Z", "message": "[dsmr] Use ThingHandlerService for discovery\n\nThis simplifies the DSMRHandlerFactory code so it no longer needs to register and keep track of a discovery service for each bridge.\n\nAlso contains a few other improvements:\n\n* more constructor injection\n* add a few missing @NonNullByDefault on test classes\n\nSigned-off-by: Wouter Born <github@maindrain.net>"}, "afterCommit": {"oid": "645bcb2382905188e9bdd9259a9463e18a32ff7e", "author": {"user": {"login": "wborn", "name": "Wouter Born"}}, "url": "https://github.com/openhab/openhab-addons/commit/645bcb2382905188e9bdd9259a9463e18a32ff7e", "committedDate": "2020-11-16T17:58:24Z", "message": "[dsmr] Use ThingHandlerService for discovery\n\nThis simplifies the DSMRHandlerFactory code so it no longer needs to register and keep track of a discovery service for each bridge.\n\nAlso contains a few other improvements:\n\n* more constructor injection\n* add a few missing @NonNullByDefault on test classes\n\nSigned-off-by: Wouter Born <github@maindrain.net>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMyNjg4NDg4", "url": "https://github.com/openhab/openhab-addons/pull/9044#pullrequestreview-532688488", "createdAt": "2020-11-17T18:53:30Z", "commit": {"oid": "645bcb2382905188e9bdd9259a9463e18a32ff7e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxODo1MzozMFrOH1ER5w==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxODo1MzozMFrOH1ER5w==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTQwNjY5NQ==", "bodyText": "Surely there is a better way to implement this rather than using static fields? Can ThingServiceHandler osgi wiring support be added to the core?", "url": "https://github.com/openhab/openhab-addons/pull/9044#discussion_r525406695", "createdAt": "2020-11-17T18:53:30Z", "author": {"login": "cpmeister"}, "path": "bundles/org.openhab.binding.dsmr/src/main/java/org/openhab/binding/dsmr/internal/discovery/DSMRI18nProviderTracker.java", "diffHunk": "@@ -0,0 +1,50 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.dsmr.internal.discovery;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.openhab.core.i18n.LocaleProvider;\n+import org.openhab.core.i18n.TranslationProvider;\n+import org.openhab.core.thing.binding.ThingHandlerService;\n+import org.osgi.service.component.annotations.Activate;\n+import org.osgi.service.component.annotations.Component;\n+import org.osgi.service.component.annotations.Deactivate;\n+import org.osgi.service.component.annotations.Reference;\n+\n+/**\n+ * Tracks the i18n provider dependencies of the {@link DSMRMeterDiscoveryService}. The {@link DSMRMeterDiscoveryService}\n+ * is a {@link ThingHandlerService} so its i18n dependencies cannot be injected using service component annotations.\n+ *\n+ * @author Wouter Born - Initial contribution\n+ */\n+@Component\n+@NonNullByDefault\n+public class DSMRI18nProviderTracker {\n+\n+    static @Nullable TranslationProvider i18nProvider;\n+    static @Nullable LocaleProvider localeProvider;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "645bcb2382905188e9bdd9259a9463e18a32ff7e"}, "originalPosition": 36}]}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NTMyMzk1MDMx", "url": "https://github.com/openhab/openhab-addons/pull/9044#pullrequestreview-532395031", "createdAt": "2020-11-17T14:06:50Z", "commit": {"oid": "645bcb2382905188e9bdd9259a9463e18a32ff7e"}, "state": "COMMENTED", "comments": {"totalCount": 1, "pageInfo": {"startCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNDowNjo1MVrOH02eAw==", "endCursor": "Y3Vyc29yOnYyOpK0MjAyMC0xMS0xN1QxNDowNjo1MVrOH02eAw==", "hasNextPage": false, "hasPreviousPage": false}, "nodes": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTE4MDQxOQ==", "bodyText": "Hmm setting static fields in a constructor doesn't seem really nice... Maybe pass the providers to the bridge from the factory and than when setThingHandler is called in DSMRMeterDiscoveryService get the providers from the bridge passed and set them.", "url": "https://github.com/openhab/openhab-addons/pull/9044#discussion_r525180419", "createdAt": "2020-11-17T14:06:51Z", "author": {"login": "Hilbrand"}, "path": "bundles/org.openhab.binding.dsmr/src/main/java/org/openhab/binding/dsmr/internal/discovery/DSMRI18nProviderTracker.java", "diffHunk": "@@ -0,0 +1,50 @@\n+/**\n+ * Copyright (c) 2010-2020 Contributors to the openHAB project\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+package org.openhab.binding.dsmr.internal.discovery;\n+\n+import org.eclipse.jdt.annotation.NonNullByDefault;\n+import org.eclipse.jdt.annotation.Nullable;\n+import org.openhab.core.i18n.LocaleProvider;\n+import org.openhab.core.i18n.TranslationProvider;\n+import org.openhab.core.thing.binding.ThingHandlerService;\n+import org.osgi.service.component.annotations.Activate;\n+import org.osgi.service.component.annotations.Component;\n+import org.osgi.service.component.annotations.Deactivate;\n+import org.osgi.service.component.annotations.Reference;\n+\n+/**\n+ * Tracks the i18n provider dependencies of the {@link DSMRMeterDiscoveryService}. The {@link DSMRMeterDiscoveryService}\n+ * is a {@link ThingHandlerService} so its i18n dependencies cannot be injected using service component annotations.\n+ *\n+ * @author Wouter Born - Initial contribution\n+ */\n+@Component\n+@NonNullByDefault\n+public class DSMRI18nProviderTracker {\n+\n+    static @Nullable TranslationProvider i18nProvider;\n+    static @Nullable LocaleProvider localeProvider;\n+\n+    @Activate\n+    public DSMRI18nProviderTracker(final @Reference TranslationProvider i18nProvider,\n+            final @Reference LocaleProvider localeProvider) {\n+        DSMRI18nProviderTracker.i18nProvider = i18nProvider;\n+        DSMRI18nProviderTracker.localeProvider = localeProvider;", "state": "SUBMITTED", "replyTo": null, "originalCommit": {"oid": "645bcb2382905188e9bdd9259a9463e18a32ff7e"}, "originalPosition": 42}]}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "645bcb2382905188e9bdd9259a9463e18a32ff7e", "author": {"user": {"login": "wborn", "name": "Wouter Born"}}, "url": "https://github.com/openhab/openhab-addons/commit/645bcb2382905188e9bdd9259a9463e18a32ff7e", "committedDate": "2020-11-16T17:58:24Z", "message": "[dsmr] Use ThingHandlerService for discovery\n\nThis simplifies the DSMRHandlerFactory code so it no longer needs to register and keep track of a discovery service for each bridge.\n\nAlso contains a few other improvements:\n\n* more constructor injection\n* add a few missing @NonNullByDefault on test classes\n\nSigned-off-by: Wouter Born <github@maindrain.net>"}, "afterCommit": {"oid": "565bda42652060ca6fccbed8258f3626f2e2beb0", "author": {"user": {"login": "wborn", "name": "Wouter Born"}}, "url": "https://github.com/openhab/openhab-addons/commit/565bda42652060ca6fccbed8258f3626f2e2beb0", "committedDate": "2021-01-03T13:45:04Z", "message": "[dsmr] Use ThingHandlerService for discovery\n\nThis simplifies the DSMRHandlerFactory code so it no longer needs to register and keep track of a discovery service for each bridge.\n\nAlso contains a few other improvements:\n\n* more constructor injection\n* add a few missing @NonNullByDefault on test classes\n\nSigned-off-by: Wouter Born <github@maindrain.net>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "565bda42652060ca6fccbed8258f3626f2e2beb0", "author": {"user": {"login": "wborn", "name": "Wouter Born"}}, "url": "https://github.com/openhab/openhab-addons/commit/565bda42652060ca6fccbed8258f3626f2e2beb0", "committedDate": "2021-01-03T13:45:04Z", "message": "[dsmr] Use ThingHandlerService for discovery\n\nThis simplifies the DSMRHandlerFactory code so it no longer needs to register and keep track of a discovery service for each bridge.\n\nAlso contains a few other improvements:\n\n* more constructor injection\n* add a few missing @NonNullByDefault on test classes\n\nSigned-off-by: Wouter Born <github@maindrain.net>"}, "afterCommit": {"oid": "6f7bd0bffa137d76b5824f10a2e3b45ba7089883", "author": {"user": {"login": "wborn", "name": "Wouter Born"}}, "url": "https://github.com/openhab/openhab-addons/commit/6f7bd0bffa137d76b5824f10a2e3b45ba7089883", "committedDate": "2021-01-14T09:52:11Z", "message": "[dsmr] Use ThingHandlerService for discovery\n\nThis simplifies the DSMRHandlerFactory code so it no longer needs to register and keep track of a discovery service for each bridge.\n\nAlso contains a few other improvements:\n\n* more constructor injection\n* add a few missing @NonNullByDefault on test classes\n\nSigned-off-by: Wouter Born <github@maindrain.net>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "6f7bd0bffa137d76b5824f10a2e3b45ba7089883", "author": {"user": {"login": "wborn", "name": "Wouter Born"}}, "url": "https://github.com/openhab/openhab-addons/commit/6f7bd0bffa137d76b5824f10a2e3b45ba7089883", "committedDate": "2021-01-14T09:52:11Z", "message": "[dsmr] Use ThingHandlerService for discovery\n\nThis simplifies the DSMRHandlerFactory code so it no longer needs to register and keep track of a discovery service for each bridge.\n\nAlso contains a few other improvements:\n\n* more constructor injection\n* add a few missing @NonNullByDefault on test classes\n\nSigned-off-by: Wouter Born <github@maindrain.net>"}, "afterCommit": {"oid": "80cb5738bd7c46cffa3377e65da314fcd15add48", "author": {"user": {"login": "wborn", "name": "Wouter Born"}}, "url": "https://github.com/openhab/openhab-addons/commit/80cb5738bd7c46cffa3377e65da314fcd15add48", "committedDate": "2021-01-23T13:02:27Z", "message": "[dsmr] Use ThingHandlerService for discovery\n\nThis simplifies the DSMRHandlerFactory code so it no longer needs to register and keep track of a discovery service for each bridge.\n\nAlso contains a few other improvements:\n\n* more constructor injection\n* add a few missing @NonNullByDefault on test classes\n\nSigned-off-by: Wouter Born <github@maindrain.net>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "80cb5738bd7c46cffa3377e65da314fcd15add48", "author": {"user": {"login": "wborn", "name": "Wouter Born"}}, "url": "https://github.com/openhab/openhab-addons/commit/80cb5738bd7c46cffa3377e65da314fcd15add48", "committedDate": "2021-01-23T13:02:27Z", "message": "[dsmr] Use ThingHandlerService for discovery\n\nThis simplifies the DSMRHandlerFactory code so it no longer needs to register and keep track of a discovery service for each bridge.\n\nAlso contains a few other improvements:\n\n* more constructor injection\n* add a few missing @NonNullByDefault on test classes\n\nSigned-off-by: Wouter Born <github@maindrain.net>"}, "afterCommit": {"oid": "095406a0708c507f3d091bfd63d797f2555718e8", "author": {"user": {"login": "wborn", "name": "Wouter Born"}}, "url": "https://github.com/openhab/openhab-addons/commit/095406a0708c507f3d091bfd63d797f2555718e8", "committedDate": "2021-03-02T16:01:10Z", "message": "[dsmr] Use ThingHandlerService for discovery\n\nThis simplifies the DSMRHandlerFactory code so it no longer needs to register and keep track of a discovery service for each bridge.\n\nAlso contains a few other improvements:\n\n* more constructor injection\n* add a few missing @NonNullByDefault on test classes\n\nSigned-off-by: Wouter Born <github@maindrain.net>"}}, {"__typename": "PullRequestCommit", "commit": {"oid": "6b50e34b8c33764a7256e6672f5306048861793f", "author": {"user": {"login": "wborn", "name": "Wouter Born"}}, "url": "https://github.com/openhab/openhab-addons/commit/6b50e34b8c33764a7256e6672f5306048861793f", "committedDate": "2021-03-21T11:10:55Z", "message": "[dsmr] Use ThingHandlerService for discovery\n\nThis simplifies the DSMRHandlerFactory code so it no longer needs to register and keep track of a discovery service for each bridge.\n\nAlso contains a few other improvements:\n\n* more constructor injection\n* add a few missing @NonNullByDefault on test classes\n\nSigned-off-by: Wouter Born <github@maindrain.net>"}}, {"__typename": "HeadRefForcePushedEvent", "beforeCommit": {"oid": "095406a0708c507f3d091bfd63d797f2555718e8", "author": {"user": {"login": "wborn", "name": "Wouter Born"}}, "url": "https://github.com/openhab/openhab-addons/commit/095406a0708c507f3d091bfd63d797f2555718e8", "committedDate": "2021-03-02T16:01:10Z", "message": "[dsmr] Use ThingHandlerService for discovery\n\nThis simplifies the DSMRHandlerFactory code so it no longer needs to register and keep track of a discovery service for each bridge.\n\nAlso contains a few other improvements:\n\n* more constructor injection\n* add a few missing @NonNullByDefault on test classes\n\nSigned-off-by: Wouter Born <github@maindrain.net>"}, "afterCommit": {"oid": "6b50e34b8c33764a7256e6672f5306048861793f", "author": {"user": {"login": "wborn", "name": "Wouter Born"}}, "url": "https://github.com/openhab/openhab-addons/commit/6b50e34b8c33764a7256e6672f5306048861793f", "committedDate": "2021-03-21T11:10:55Z", "message": "[dsmr] Use ThingHandlerService for discovery\n\nThis simplifies the DSMRHandlerFactory code so it no longer needs to register and keep track of a discovery service for each bridge.\n\nAlso contains a few other improvements:\n\n* more constructor injection\n* add a few missing @NonNullByDefault on test classes\n\nSigned-off-by: Wouter Born <github@maindrain.net>"}}, {"__typename": "PullRequestReview", "id": "MDE3OlB1bGxSZXF1ZXN0UmV2aWV3NjMxODIwNDg5", "url": "https://github.com/openhab/openhab-addons/pull/9044#pullrequestreview-631820489", "createdAt": "2021-04-08T20:49:07Z", "commit": {"oid": "6b50e34b8c33764a7256e6672f5306048861793f"}, "state": "APPROVED", "comments": {"totalCount": 0, "pageInfo": {"startCursor": null, "endCursor": null, "hasNextPage": false, "hasPreviousPage": false}, "nodes": []}}]}}}, "rateLimit": {"limit": 5000, "remaining": 4099, "cost": 1, "resetAt": "2021-10-28T20:13:43Z"}}}